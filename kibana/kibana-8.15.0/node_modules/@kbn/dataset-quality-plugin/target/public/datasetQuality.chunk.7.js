/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.datasetQuality_bundle_jsonpfunction=window.datasetQuality_bundle_jsonpfunction||[]).push([[7],{162:function(t,e,a){"use strict";t.exports=function t(e,a){if(e===a)return!0;if(e&&a&&"object"==typeof e&&"object"==typeof a){if(e.constructor!==a.constructor)return!1;var s,i,n;if(Array.isArray(e)){if((s=e.length)!=a.length)return!1;for(i=s;0!=i--;)if(!t(e[i],a[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===a.source&&e.flags===a.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===a.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===a.toString();if((s=(n=Object.keys(e)).length)!==Object.keys(a).length)return!1;for(i=s;0!=i--;)if(!Object.prototype.hasOwnProperty.call(a,n[i]))return!1;for(i=s;0!=i--;){var o=n[i];if(!t(e[o],a[o]))return!1}return!0}return e!=e&&a!=a}},167:function(t,e,a){"use strict";a.r(e),a.d(e,"createDatasetQualityControllerFactory",(function(){return b}));var s=a(49);a(15);var i=a(36),n=a(162),o=a.n(n),r=a(10),d=a(7),l=a(14),g=a(5);const c={type:g.b,table:{page:0,rowsPerPage:10,sort:{field:g.i,direction:g.h}},datasetUserPrivileges:{canRead:!0,canMonitor:!0,canViewIntegrations:!0},dataStreamStats:[],filters:{inactive:!0,fullNames:!1,timeRange:{from:"now-24h",to:"now",refresh:{pause:!0,value:6e4}},integrations:[],namespaces:[],qualities:[]},flyout:{degradedFields:{table:{page:0,rowsPerPage:10,sort:{field:g.f,direction:g.e}}}},datasets:[],isSizeStatsAvailable:!0,nonAggregatableDatasets:[]};var u=a(1);const f=(t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchDatasetDetailsFailed",{defaultMessage:"We couldn't get your data set details."}),text:e.message})},D=(t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchDatasetSettingsFailed",{defaultMessage:"Data set settings couldn't be loaded."}),text:e.message})},y=u.i18n.translate("xpack.datasetQuality.fetchDatasetDetailsFailed.noDatasetSelected",{defaultMessage:"No data set have been selected"}),b=({core:t,dataStreamStatsClient:e,dataStreamDetailsClient:a})=>async({initialState:n=c})=>{var g,b,S,m,h,F,p,E,A;const O=(({initialContext:t=c,toasts:e,dataStreamStatsClient:a,dataStreamDetailsClient:i})=>(t=>Object(s.createMachine)({context:t,predictableActionArguments:!0,id:"DatasetQualityController",type:"parallel",states:{datasets:{initial:"fetching",states:{fetching:{invoke:{src:"loadDataStreamStats",onDone:{target:"loaded",actions:["storeDataStreamStats","storeDatasets"]},onError:{target:"loaded",actions:["notifyFetchDatasetStatsFailed"]}}},loaded:{}},on:{UPDATE_TIME_RANGE:{target:"datasets.fetching",actions:["storeTimeRange"]},REFRESH_DATA:{target:"datasets.fetching"}}},degradedDocs:{initial:"fetching",states:{fetching:{invoke:{src:"loadDegradedDocs",onDone:{target:"loaded",actions:["storeDegradedDocStats","storeDatasets"]},onError:[{target:"unauthorized",cond:"checkIfActionForbidden"},{target:"loaded",actions:["notifyFetchDegradedStatsFailed"]}]}},loaded:{},unauthorized:{type:"final"}},on:{UPDATE_TIME_RANGE:{target:"degradedDocs.fetching",actions:["storeTimeRange"]},REFRESH_DATA:{target:"degradedDocs.fetching"}}},integrations:{initial:"fetching",states:{fetching:{invoke:{src:"loadIntegrations",onDone:{target:"loaded",actions:["storeIntegrations","storeDatasets"]},onError:{target:"loaded",actions:["notifyFetchIntegrationsFailed","storeEmptyIntegrations","storeDatasets"]}}},loaded:{on:{UPDATE_TABLE_CRITERIA:{target:"loaded",actions:["storeTableOptions"]},TOGGLE_INACTIVE_DATASETS:{target:"loaded",actions:["storeInactiveDatasetsVisibility","resetPage"]},TOGGLE_FULL_DATASET_NAMES:{target:"loaded",actions:["storeFullDatasetNamesVisibility"]}}}},on:{UPDATE_TIME_RANGE:{target:"integrations.fetching",actions:["storeTimeRange"]},REFRESH_DATA:{target:"integrations.fetching"},UPDATE_INTEGRATIONS:{target:"integrations.loaded",actions:["storeIntegrationsFilter"]},UPDATE_NAMESPACES:{target:"integrations.loaded",actions:["storeNamespaces"]},UPDATE_QUALITIES:{target:"integrations.loaded",actions:["storeQualities"]},UPDATE_QUERY:{actions:["storeQuery"]}}},nonAggregatableDatasets:{initial:"fetching",states:{fetching:{invoke:{src:"loadNonAggregatableDatasets",onDone:{target:"loaded",actions:["storeNonAggregatableDatasets"]},onError:[{target:"unauthorized",cond:"checkIfActionForbidden"},{target:"loaded",actions:["notifyFetchNonAggregatableDatasetsFailed"]}]}},loaded:{},unauthorized:{type:"final"}},on:{UPDATE_TIME_RANGE:{target:"nonAggregatableDatasets.fetching"},REFRESH_DATA:{target:"nonAggregatableDatasets.fetching"}}},flyout:{initial:"closed",states:{initializing:{type:"parallel",states:{nonAggregatableDataset:{initial:"fetching",states:{fetching:{invoke:{src:"loadDatasetIsNonAggregatable",onDone:{target:"done",actions:["storeDatasetIsNonAggregatable"]},onError:{target:"done",actions:["notifyFetchNonAggregatableDatasetsFailed"]}}},done:{on:{UPDATE_INSIGHTS_TIME_RANGE:{target:"fetching",actions:["storeFlyoutOptions"]},SELECT_DATASET:{target:"fetching",actions:["storeFlyoutOptions"]}}}}},dataStreamSettings:{initial:"fetching",states:{fetching:{invoke:{src:"loadDataStreamSettings",onDone:{target:"done",actions:["storeDataStreamSettings"]},onError:{target:"done",actions:["notifyFetchDatasetSettingsFailed"]}}},done:{type:"final"}}},dataStreamDetails:{initial:"fetching",states:{fetching:{invoke:{src:"loadDataStreamDetails",onDone:{target:"done",actions:["storeDatasetDetails"]},onError:{target:"done",actions:["notifyFetchDatasetDetailsFailed"]}}},done:{on:{UPDATE_INSIGHTS_TIME_RANGE:{target:"fetching",actions:["storeFlyoutOptions"]},BREAKDOWN_FIELD_CHANGE:{actions:["storeFlyoutOptions"]}}}}},integrationDashboards:{initial:"fetching",states:{fetching:{invoke:{src:"loadIntegrationDashboards",onDone:{target:"done",actions:["storeIntegrationDashboards"]},onError:[{target:"unauthorized",cond:"checkIfActionForbidden"},{target:"done",actions:["notifyFetchIntegrationDashboardsFailed"]}]}},done:{type:"final"},unauthorized:{type:"final"}}},dataStreamDegradedFields:{initial:"fetching",states:{fetching:{invoke:{src:"loadDegradedFieldsPerDataStream",onDone:{target:"done",actions:["storeDegradedFields"]},onError:{target:"done"}}},done:{on:{UPDATE_INSIGHTS_TIME_RANGE:{target:"fetching",actions:["resetDegradedFieldPage"]},UPDATE_DEGRADED_FIELDS_TABLE_CRITERIA:{target:"done",actions:["storeDegradedFieldTableOptions"]}}}}}},onDone:{target:"#DatasetQualityController.flyout.loaded"}},loaded:{on:{CLOSE_FLYOUT:{target:"closed",actions:["resetFlyoutOptions"]}}},closed:{on:{OPEN_FLYOUT:{target:"#DatasetQualityController.flyout.initializing",actions:["storeFlyoutOptions"]}}}},on:{SELECT_NEW_DATASET:{target:"#DatasetQualityController.flyout.initializing",actions:["storeFlyoutOptions"]},CLOSE_FLYOUT:{target:"#DatasetQualityController.flyout.closed",actions:["resetFlyoutOptions"]}}}}},{actions:{storeTableOptions:Object(s.assign)(((t,e)=>"dataset_criteria"in e?{table:e.dataset_criteria}:{})),storeDegradedFieldTableOptions:Object(s.assign)(((t,e)=>"degraded_field_criteria"in e?{flyout:{...t.flyout,degradedFields:{...t.flyout.degradedFields,table:e.degraded_field_criteria}}}:{})),resetPage:Object(s.assign)(((t,e)=>({table:{...t.table,page:0}}))),resetDegradedFieldPage:Object(s.assign)(((t,e)=>({flyout:{...t.flyout,degradedFields:{...t.flyout.degradedFields,table:{...t.flyout.degradedFields.table,page:0,rowsPerPage:10}}}}))),storeInactiveDatasetsVisibility:Object(s.assign)(((t,e)=>({filters:{...t.filters,inactive:!t.filters.inactive}}))),storeFullDatasetNamesVisibility:Object(s.assign)(((t,e)=>({filters:{...t.filters,fullNames:!t.filters.fullNames}}))),storeTimeRange:Object(s.assign)(((t,e)=>"timeRange"in e?{filters:{...t.filters,timeRange:e.timeRange}}:{})),storeIntegrationsFilter:Object(s.assign)(((t,e)=>"integrations"in e?{filters:{...t.filters,integrations:e.integrations}}:{})),storeNamespaces:Object(s.assign)(((t,e)=>"namespaces"in e?{filters:{...t.filters,namespaces:e.namespaces}}:{})),storeQualities:Object(s.assign)(((t,e)=>"qualities"in e?{filters:{...t.filters,qualities:e.qualities}}:{})),storeQuery:Object(s.assign)(((t,e)=>"query"in e?{filters:{...t.filters,query:e.query}}:{})),storeFlyoutOptions:Object(s.assign)(((t,e)=>{var a,s,i,n,o,r;const d="timeRange"in e?e.timeRange:null!==(a=null===(s=t.flyout)||void 0===s?void 0:s.insightsTimeRange)&&void 0!==a?a:null===(i=t.filters)||void 0===i?void 0:i.timeRange,l="dataset"in e?e.dataset:null===(n=t.flyout)||void 0===n?void 0:n.dataset,g="breakdownField"in e?null!==(o=e.breakdownField)&&void 0!==o?o:void 0:null===(r=t.flyout)||void 0===r?void 0:r.breakdownField;return{flyout:{...t.flyout,dataset:l,insightsTimeRange:d,breakdownField:g}}})),resetFlyoutOptions:Object(s.assign)(((t,e)=>({flyout:c.flyout}))),storeDataStreamStats:Object(s.assign)(((t,e)=>{if("data"in e&&"dataStreamsStats"in e.data){const t=e.data.dataStreamsStats,a=e.data.datasetUserPrivileges,s=!t.length||t.some((t=>null!==t.totalDocs));return{dataStreamStats:t,isSizeStatsAvailable:s,datasetUserPrivileges:a}}return{}})),storeDegradedDocStats:Object(s.assign)(((t,e)=>"data"in e?{degradedDocStats:e.data}:{})),storeDegradedFields:Object(s.assign)(((t,e)=>"data"in e?{flyout:{...t.flyout,degradedFields:{...t.flyout.degradedFields,data:e.data.degradedFields}}}:{})),storeNonAggregatableDatasets:Object(s.assign)(((t,e)=>"data"in e?{nonAggregatableDatasets:e.data.datasets}:{})),storeDataStreamSettings:Object(s.assign)(((t,e)=>{var a;return"data"in e?{flyout:{...t.flyout,datasetSettings:null!==(a=e.data)&&void 0!==a?a:{}}}:{}})),storeDatasetDetails:Object(s.assign)(((t,e)=>"data"in e?{flyout:{...t.flyout,datasetDetails:e.data}}:{})),storeDatasetIsNonAggregatable:Object(s.assign)(((t,e)=>"data"in e?{flyout:{...t.flyout,isNonAggregatable:!e.data.aggregatable}}:{})),storeIntegrations:Object(s.assign)(((t,e)=>"data"in e?{integrations:e.data}:{})),storeEmptyIntegrations:Object(s.assign)((t=>({integrations:[]}))),storeIntegrationDashboards:Object(s.assign)(((t,e)=>{var a;return"data"in e&&"dashboards"in e.data?{flyout:{...t.flyout,dataset:{...t.flyout.dataset,integration:{...null===(a=t.flyout.dataset)||void 0===a?void 0:a.integration,dashboards:e.data.dashboards}}}}:{}})),storeDatasets:Object(s.assign)(((t,e)=>t.integrations&&(t.dataStreamStats||t.degradedDocStats)?{datasets:Object(l.b)(t.dataStreamStats,t.degradedDocStats,t.integrations)}:{}))},guards:{checkIfActionForbidden:(t,e)=>"data"in e&&"statusCode"in e.data&&403===e.data.statusCode}}))(t).withConfig({actions:{notifyFetchDatasetStatsFailed:(t,a)=>((t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchDatasetStatsFailed",{defaultMessage:"We couldn't get your data sets."}),text:e.message})})(e,a.data),notifyFetchDegradedStatsFailed:(t,a)=>((t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchDegradedStatsFailed",{defaultMessage:"We couldn't get your degraded docs information."}),text:e.message})})(e,a.data),notifyFetchNonAggregatableDatasetsFailed:(t,a)=>((t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchNonAggregatableDatasetsFailed",{defaultMessage:"We couldn't get non aggregatable datasets information."}),text:e.message})})(e,a.data),notifyFetchDatasetSettingsFailed:(t,a)=>D(e,a.data),notifyFetchDatasetDetailsFailed:(t,a)=>f(e,a.data),notifyFetchIntegrationDashboardsFailed:(t,a)=>((t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchIntegrationDashboardsFailed",{defaultMessage:"We couldn't get your integration dashboards."}),text:e.message})})(e,a.data),notifyFetchIntegrationsFailed:(t,a)=>((t,e)=>{t.addDanger({title:u.i18n.translate("xpack.datasetQuality.fetchIntegrationsFailed",{defaultMessage:"We couldn't get your integrations."}),text:e.message})})(e,a.data)},services:{loadDataStreamStats:t=>a.getDataStreamsStats({type:t.type,datasetQuery:t.filters.query}),loadDegradedDocs:t=>{const{startDate:e,endDate:s}=Object(r.a)(t.filters.timeRange);return a.getDataStreamsDegradedStats({type:t.type,datasetQuery:t.filters.query,start:e,end:s})},loadDegradedFieldsPerDataStream:t=>{if(!t.flyout.dataset||!t.flyout.insightsTimeRange)return Promise.resolve({});const{startDate:e,endDate:a}=Object(r.a)(t.flyout.insightsTimeRange),{type:s,name:n,namespace:o}=t.flyout.dataset;return i.getDataStreamDegradedFields({dataStream:Object(d.a)({type:s,dataset:n,namespace:o}),start:e,end:a})},loadIntegrations:t=>a.getIntegrations({type:t.type}),loadNonAggregatableDatasets:t=>{const{startDate:e,endDate:s}=Object(r.a)(t.filters.timeRange);return a.getNonAggregatableDatasets({type:t.type,start:e,end:s})},loadDataStreamSettings:t=>{if(!t.flyout.dataset)return D(e,new Error(y)),Promise.resolve({});const{type:a,name:s,namespace:n}=t.flyout.dataset;return i.getDataStreamSettings({dataStream:Object(d.a)({type:a,dataset:s,namespace:n})})},loadDataStreamDetails:t=>{if(!t.flyout.dataset||!t.flyout.insightsTimeRange)return f(e,new Error(y)),Promise.resolve({});const{type:a,name:s,namespace:n}=t.flyout.dataset,{startDate:o,endDate:l}=Object(r.a)(t.flyout.insightsTimeRange);return i.getDataStreamDetails({dataStream:Object(d.a)({type:a,dataset:s,namespace:n}),start:o,end:l})},loadIntegrationDashboards:t=>{if(!t.flyout.dataset)return f(e,new Error(y)),Promise.resolve({});const{integration:a}=t.flyout.dataset;return a?i.getIntegrationDashboards({integration:a.name}):Promise.resolve({})},loadDatasetIsNonAggregatable:async t=>{if(!t.flyout.dataset||!t.flyout.insightsTimeRange)return f(e,new Error(y)),Promise.resolve({});const{type:s,name:i,namespace:n}=t.flyout.dataset,{startDate:o,endDate:l}=Object(r.a)(t.flyout.insightsTimeRange);return a.getNonAggregatableDatasets({type:t.type,start:o,end:l,dataStream:Object(d.a)({type:s,dataset:i,namespace:n})})}}}))({initialContext:(g=null!=n?n:{},{...c,table:{...c.table,...g.table,sort:null!==(b=g.table)&&void 0!==b&&b.sort?{...null===(S=g.table)||void 0===S?void 0:S.sort,field:null===(m=g.table)||void 0===m?void 0:m.sort.field}:c.table.sort},flyout:{...c.flyout,...g.flyout,degradedFields:{table:{...c.flyout.degradedFields.table,...null===(h=g.flyout)||void 0===h||null===(F=h.degradedFields)||void 0===F?void 0:F.table,sort:null!==(p=g.flyout)&&void 0!==p&&null!==(E=p.degradedFields)&&void 0!==E&&null!==(A=E.table)&&void 0!==A&&A.sort?{...g.flyout.degradedFields.table.sort,field:g.flyout.degradedFields.table.sort.field}:c.flyout.degradedFields.table.sort}}},filters:{...c.filters,...g.filters}}),toasts:t.notifications.toasts,dataStreamStatsClient:e,dataStreamDetailsClient:a}),v=Object(s.interpret)(O,{devTools:!1});return{state$:Object(i.from)(v).pipe(Object(i.map)((({context:t})=>(t=>({table:t.table,flyout:t.flyout,filters:t.filters}))(t))),Object(i.distinctUntilChanged)(o.a)),service:v}}}}]);