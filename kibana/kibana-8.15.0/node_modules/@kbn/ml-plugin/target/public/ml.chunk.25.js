/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[25],{160:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(26),i=a.n(l),s=a(7),n=a(2),o=a(517),r=a(417),c=a(153);const u=()=>{const e=Object(o.c)(),t=()=>{const{from:t,to:a}=e.getTime();return{start:t,end:a}},a=Object(n.useMemo)((()=>Object(s.merge)(r.a,e.getTimeUpdate$().pipe(Object(s.map)((()=>({lastRefresh:Date.now(),timeRange:t()})))),c.b.pipe(Object(s.map)((e=>({lastRefresh:e})))))),[]);return i()(a)}},210:function(e,t,a){e.exports=a(57)(8)},268:function(e,t,a){"use strict";a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return m})),a(2);var l=a(25),i=a(5),s=a(68),n=a(6);const o=[{value:"auto",text:i.i18n.translate("xpack.ml.controls.selectInterval.autoLabel",{defaultMessage:"Auto"})},{value:"hour",text:i.i18n.translate("xpack.ml.controls.selectInterval.hourLabel",{defaultMessage:"1 hour"})},{value:"day",text:i.i18n.translate("xpack.ml.controls.selectInterval.dayLabel",{defaultMessage:"1 day"})},{value:"second",text:i.i18n.translate("xpack.ml.controls.selectInterval.showAllLabel",{defaultMessage:"Show all"})}];function r(e){const t=o.find((t=>t.value===e));let a={display:o[0].text,val:o[0].value};return void 0!==t&&(a={display:t.text,val:t.value}),a}const c=r("auto"),u=()=>{const[e,t]=Object(s.c)("mlSelectInterval",c);return[e,t]},m=()=>{const[e,t]=u();return Object(n.jsx)(d,{interval:e,onChange:t})},d=({interval:e,onChange:t})=>Object(n.jsx)(l.EuiSelect,{"data-test-subj":"mlAnomalyIntervalControls",prepend:i.i18n.translate("xpack.ml.controls.selectInterval.intervalLabel",{defaultMessage:"Interval"}),append:Object(n.jsx)(l.EuiToolTip,{content:i.i18n.translate("xpack.ml.controls.selectInterval.intervalTooltip",{defaultMessage:"Show only the highest severity anomaly for each interval (such as hour or day) or show all anomalies in the selected time period."})},Object(n.jsx)(l.EuiIcon,{type:"questionInCircle",color:"subdued"})),compressed:!0,options:o,value:e.val,onChange:e=>{t(r(e.target.value))},"aria-label":i.i18n.translate("xpack.ml.controls.selectInterval.ariaLabel",{defaultMessage:"Select interval"})})},279:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var l=a(120),i=a.n(l),s=(a(2),a(25)),n=a(5),o=a(150),r=a(6);const c=({icon:e,id:t,isGroup:a=!1,numJobs:l,removeId:c})=>{let u,m={color:a?Object(o.a)(t):"hollow"};return!0===e&&c&&(m={...m,iconType:"cross",iconSide:"right",onClick:()=>c(t),onClickAriaLabel:"Remove id"}),void 0!==l&&(u=n.i18n.translate("xpack.ml.jobSelector.selectedGroupJobs",{defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:l}})),Object(r.jsx)(s.EuiBadge,i()({key:`${t}-id`,"data-test-subj":`mlJobSelectionBadge ${t}`},m),`${t}${u||""}`)}},323:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var l=a(6);a(2);const i={name:"1v0pok0",styles:"min-width:300px"},s=({title:e})=>Object(l.jsx)("div",{css:i},e)},375:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var l=a(2),i=a(203),s=a(96),n=a(9);const o=e=>{const{services:{cases:t}}=Object(n.a)(),a=null==t?void 0:t.hooks.useCasesAddToExistingCaseModal();return Object(l.useCallback)((t=>{const l={...t,id:Object(i.a)(JSON.stringify(t)).toString()};if(!a)throw new Error("Cases modal is not available");a.open({getAttachments:()=>[{type:s.AttachmentType.persistableState,persistableStateAttachmentTypeId:e,persistableStateAttachmentState:JSON.parse(JSON.stringify(l))}]})}),[e])}},391:function(e,t,a){"use strict";a.d(t,"b",(function(){return F})),a.d(t,"a",(function(){return I}));var l=a(2),i=a.n(l),s=a(25),n=a(5),o=a(15),r=a(68),c=(a(767),a(189)),u=a(16),m=a(210),d=a(279),b=a(6);function p({limit:e,maps:t,onLinkClick:a,selectedIds:l,showAllBarBadges:o}){const r=[],c=[];for(let e=0;e<l.length;e++){const a=l[e];void 0!==t.groupsMap[a]&&(c.push(a),r.push(Object(b.jsx)(s.EuiFlexItem,{grow:!1,key:a},Object(b.jsx)(d.a,{id:a,isGroup:!0,numJobs:t.groupsMap[a].length}))))}for(let e=0;e<l.length;e++){const a=l[e];if(void 0===t.groupsMap[a]){if(!1!==(t.jobsMap[a]||[]).some((e=>c.includes(e))))continue;r.push(Object(b.jsx)(s.EuiFlexItem,{grow:!1,key:a},Object(b.jsx)(d.a,{id:a})))}}if(o||r.length<=e)return r.length>e&&r.push(Object(b.jsx)(s.EuiLink,{key:"more-badges-bar-link",onClick:a},Object(b.jsx)(s.EuiText,{grow:!1,size:"xs"},n.i18n.translate("xpack.ml.jobSelector.hideBarBadges",{defaultMessage:"Hide"})))),Object(b.jsx)(i.a.Fragment,null,r);{const t=r.length-e;return r.splice(e),r.push(Object(b.jsx)(s.EuiLink,{key:"more-badges-bar-link",onClick:a},Object(b.jsx)(s.EuiText,{grow:!1,size:"xs"},n.i18n.translate("xpack.ml.jobSelector.showBarBadges",{defaultMessage:"And {overFlow} more",values:{overFlow:t}})))),Object(b.jsx)(i.a.Fragment,null,r)}}p.propTypes={limit:m.PropTypes.number,maps:m.PropTypes.shape({jobsMap:m.PropTypes.object,groupsMap:m.PropTypes.object}),onLinkClick:m.PropTypes.func,selectedIds:m.PropTypes.array,showAllBarBadges:m.PropTypes.bool};var j=a(492),g=a(179),x=a(138),f=a.n(x),h=a(10),y=a(122),O=a(52),v=a(27);const T=(e,t,a,l)=>{const i=new URL(e);return t&&i.searchParams.append("entry.548460210",t),a&&i.searchParams.append("entry.573002982",a),l&&i.searchParams.append("entry.1876422621",l),i.href},E=({formUrl:e,"data-test-subj":t,onClickCapture:a,defaultButton:l,kibanaVersion:i,isCloudEnv:n,isServerlessEnv:r,sanitizedPath:c,surveyButtonText:u=Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.featureFeedbackButton.tellUsWhatYouThinkLink",defaultMessage:"Tell us what you think!"})})=>{const m=void 0!==n||void 0!==r?((e,t)=>t?"Serverless (fully-managed projects)":e?"Elastic Cloud (we manage)":"Self-Managed (you manage)")(n,r):void 0;return Object(b.jsx)(s.EuiButton,{href:T(e,i,m,c),target:"_blank",color:l?void 0:"warning",iconType:l?void 0:"editorComment","data-test-subj":t,onClickCapture:a},u)},k=["ml-module-metrics-ui-hosts"],M=({jobIds:e,page:t})=>{const{jobs:a}=Object(O.useJobsApiService)(),{services:{kibanaVersion:i}}=Object(h.d)(),{isCloud:s}=Object(v.a)(),{showNodeInfo:n}=Object(y.d)(),[o,r]=Object(l.useState)(null),[c,m]=Object(l.useState)(!1),d=Object(l.useMemo)((()=>function(e){switch(e){case u.a.SINGLE_METRIC_VIEWER:return"1FAIpQLSdlMYe3wuJh2KtBLajI4EVoUljAhGjJwjZI7zUY_Kn_Sr2lug";case u.a.ANOMALY_EXPLORER:return"1FAIpQLSfF1Ry561b4lYrY7iiyXhuZpxFzAmy2c9BFUT3J2AJUevY1iw";default:return null}}(t)),[t]),p=f()();return Object(l.useEffect)((()=>{const t=e.join(",");t!==o&&""!==t&&(m(!1),r(t),a(e).then((e=>{p()&&m(e.some((e=>{var t;return k.includes(null===(t=e.custom_settings)||void 0===t?void 0:t.created_by)})))})))}),[e,a,o,p]),!1===c||null===d?null:Object(b.jsx)(E,{"data-test-subj":"mlFeatureFeedbackButton",formUrl:S(d),kibanaVersion:i,isCloudEnv:s,isServerlessEnv:!1===n})};function S(e){return`https://docs.google.com/forms/d/e/${e}/viewform?usp=pp_url`}function w(e,t,a){if(a)return e;const l=[],i=[];return t.forEach((e=>{l.push(e.groupId),i.push(...e.jobIds)})),e.forEach((e=>{!1===i.includes(e)&&l.push(e)})),l}function F(e){const t={};return e.length&&e.forEach((e=>{t[e.groupId]=e.jobIds})),t}function I({dateFormatTz:e,singleSelection:t,timeseriesOnly:a}){var m,d,x,f;const[h,y]=Object(r.d)("_g"),[O,v]=Object(c.b)(g.b,!0),T=null!==(m=null==h||null===(d=h.ml)||void 0===d?void 0:d.jobIds)&&void 0!==m?m:[],E=null!==(x=null==h||null===(f=h.ml)||void 0===f?void 0:f.groups)&&void 0!==x?x:[],[k,S]=Object(l.useState)({groupsMap:F(E),jobsMap:{}}),[I,_]=Object(l.useState)(w(T,E,t)),[C,D]=Object(l.useState)(!1),[R,A]=Object(l.useState)(!1);function L(){A(!1)}Object(l.useEffect)((()=>{_(w(T,E,t))}),[JSON.stringify([T,E])]);const N=Object(l.useCallback)((({newSelection:e,jobIds:t,groups:a,time:l})=>{_(e),y({ml:{jobIds:t,groups:a},...void 0!==l?{time:l}:{}}),L()}),[y,_]);return Object(b.jsx)("div",null,Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(s.EuiFlexGroup,{responsive:!1,gutterSize:"xs",alignItems:"center"},Object(b.jsx)(s.EuiFlexItem,{grow:!1},I.length>0?Object(b.jsx)(s.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center","data-test-subj":"mlJobSelectionBadges"},Object(b.jsx)(p,{limit:j.a,maps:k,onLinkClick:()=>D(!C),selectedIds:I,showAllBarBadges:C})):Object(b.jsx)("span",null,Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.jobSelector.noJobsSelectedLabel",defaultMessage:"No jobs selected"}))),Object(b.jsx)(s.EuiFlexItem,{grow:!1},Object(b.jsx)(s.EuiButtonEmpty,{size:"xs",iconType:"pencil",onClick:function(){A(!0)},"data-test-subj":"mlButtonEditJobSelection"},n.i18n.translate("xpack.ml.jobSelector.jobSelectionButton",{defaultMessage:"Edit job selection"}))),Object(b.jsx)(s.EuiFlexItem,null),Object(b.jsx)(s.EuiFlexItem,{grow:!1},Object(b.jsx)(M,{jobIds:I,page:t?u.a.SINGLE_METRIC_VIEWER:u.a.ANOMALY_EXPLORER}))),Object(b.jsx)(s.EuiHorizontalRule,{margin:"s"})),function(){if(R)return Object(b.jsx)(s.EuiFlyout,{onClose:L,"data-test-subj":"mlFlyoutJobSelector","aria-labelledby":"jobSelectorFlyout"},Object(b.jsx)(j.b,{dateFormatTz:e,timeseriesOnly:a,singleSelection:t,selectedIds:I,onSelectionConfirmed:N,onJobsFetched:S,onFlyoutClose:L,maps:k,applyTimeRangeConfig:O,onTimeRangeConfigChange:v}))}())}},406:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a(2);var l=a(15),i=a(6);const s=({viewBySwimlaneFieldName:e,showFilterMessage:t=!1})=>!1===t?Object(i.jsx)(l.FormattedMessage,{id:"xpack.ml.explorer.noInfluencersFoundTitle",defaultMessage:"No {viewBySwimlaneFieldName} influencers found",values:{viewBySwimlaneFieldName:e}}):Object(i.jsx)(l.FormattedMessage,{id:"xpack.ml.explorer.noInfluencersFoundTitleFilterMessage",defaultMessage:"No {viewBySwimlaneFieldName} influencers found for specified filter",values:{viewBySwimlaneFieldName:e}})},408:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var l=a(2),i=a.n(l),s=a(25),n=a(15),o=a(5),r=a(252),c=a(520),u=a(199),m=a(221),d=a(6);function b({entityName:e,entityValue:t,filter:a}){if(void 0!==a)return Object(d.jsx)(s.EuiToolTip,{content:Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.anomaliesTable.entityCell.addFilterTooltip",defaultMessage:"Add filter"})},Object(d.jsx)(s.EuiButtonIcon,{size:"s","data-test-subj":`mlAnomaliesTableEntityCellAddFilterButton-${t}`,className:"filter-button",onClick:Object(m.a)((()=>{a(e,t,r.a.ADD)})),iconType:"plusInCircle","aria-label":o.i18n.translate("xpack.ml.anomaliesTable.entityCell.addFilterAriaLabel",{defaultMessage:"Add filter"})}))}function p({entityName:e,entityValue:t,filter:a}){if(void 0!==a)return Object(d.jsx)(s.EuiToolTip,{content:Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.anomaliesTable.entityCell.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(d.jsx)(s.EuiButtonIcon,{size:"s","data-test-subj":`mlAnomaliesTableEntityCellRemoveFilterButton-${t}`,className:"filter-button",onClick:Object(m.a)((()=>{a(e,t,r.a.REMOVE)})),iconType:"minusInCircle","aria-label":o.i18n.translate("xpack.ml.anomaliesTable.entityCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})}))}const j=({entityName:e,entityValue:t,filter:a,wrapText:l=!1})=>{let n=""===t?Object(d.jsx)("i",null,u.a):t;e===c.b&&(n=`${c.b} ${n}`);const o=l?"field-value-long":"field-value-short",r=void 0!==a&&void 0!==e&&void 0!==t;return!0===l?Object(d.jsx)("div",null,Object(d.jsx)("span",{className:o},n),r&&Object(d.jsx)(i.a.Fragment,null,b({entityName:e,entityValue:t,filter:a}),p({entityName:e,entityValue:t,filter:a}))):Object(d.jsx)(s.EuiFlexGroup,{direction:"row",alignItems:"center",gutterSize:"none"},Object(d.jsx)(s.EuiFlexItem,{grow:!1,style:{maxWidth:"100%"}},Object(d.jsx)(s.EuiText,{size:"xs",className:o},n)),r&&Object(d.jsx)(s.EuiFlexItem,{grow:!1},Object(d.jsx)(s.EuiFlexGroup,{direction:"row",alignItems:"center",gutterSize:"none"},Object(d.jsx)(s.EuiFlexItem,{grow:!1},b({entityName:e,entityValue:t,filter:a})),Object(d.jsx)(s.EuiFlexItem,{grow:!1},p({entityName:e,entityValue:t,filter:a})))))}},411:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(2),i=a(25),s=a(114),n=a(5),o=a(6);const r=20;function c(e){return null!==e?n.i18n.translate("xpack.ml.jobSelector.filterBar.invalidSearchErrorMessage",{defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:e.message}}):""}function u({checkboxDisabledCheck:e,columns:t,currentPage:a=0,filterDefaultFields:u,filters:m,items:d,itemsPerPage:b=r,onTableChange:p,radioDisabledCheck:j,selectedIds:g,setCurrentPaginationData:x,singleSelection:f,sortableProperties:h,tableItemId:y="id"}){const[O,v]=Object(l.useState)(N()),[T,E]=Object(l.useState)(d),[k,M]=Object(l.useState)(g),[S,w]=Object(l.useState)(""),[F,I]=Object(l.useState)(),[_,C]=Object(l.useState)({itemsPerPage:b,firstItemIndex:0,lastItemIndex:1}),[D,R]=Object(l.useState)(i.EuiSearchBar.Query.MATCH_ALL),[A,L]=Object(l.useState)(null);function N(){const e={all:!1};return g.forEach((t=>{e[t]=!0})),e}function B({isSelected:e,itemId:t}){const a=Object.getOwnPropertyNames(O),l=T.map((e=>e[y]));let i=a.filter((e=>!0===O[e]&&e!==t));"all"!==t?!0===e&&i.push(t):!1===e?i=i.filter((e=>!1===l.includes(e))):(i=[...i,...l],i=[...new Set(i)]),x&&x({pageIndex:F.getCurrentPageIndex(),itemsPerPage:_.itemsPerPage}),p(i)}function z({query:e,error:t}){if(t)L(t);else{const t=i.EuiSearchBar.Query.execute(e,d,{defaultFields:u});L(null),E(t),R(e)}}function P(e){return!0===O[e]}function V(){return-1===T.findIndex((e=>!P(e[y])))}Object(l.useEffect)((()=>{E(d),z({query:D})}),[d]),Object(l.useEffect)((()=>{v(N())}),[g]),Object(l.useEffect)((()=>{const e=new s.Pager(T.length,b,a);C({itemsPerPage:b,firstItemIndex:e.getFirstItemIndex(),lastItemIndex:e.getLastItemIndex()}),I(e)}),[T]);const J=Object(l.useMemo)((()=>Object(i.htmlIdGenerator)()()),[]);function G(e){const t=n.i18n.translate("xpack.ml.jobSelector.customTable.selectAllCheckboxLabel",{defaultMessage:"Select all"});return Object(o.jsx)(i.EuiCheckbox,{id:`${e?"mobile-":""}${J}`,label:e?t:null,checked:V(),onChange:$})}function H(e){if(f){const t=k[0];v({...O,[t]:!1,[e]:!0}),function(e){p([e])}(e),M([e])}else{const t=!P(e);v({...O,[e]:t}),B({isSelected:t,itemId:e})}}function $(){const e=V()||!0===O.all,t={};T.forEach((a=>t[a[y]]=!e)),v(t),B({isSelected:!e,itemId:"all"})}return Object(o.jsx)(l.Fragment,null,Object(o.jsx)(i.EuiSpacer,{size:"s"}),Object(o.jsx)(i.EuiFlexGroup,{direction:"column"},Object(o.jsx)(i.EuiFlexItem,{grow:!1,"data-test-subj":"mlCustomSelectionTableSearchBar"},Object(o.jsx)(i.EuiSearchBar,{defaultQuery:D,box:{incremental:!0,placeholder:n.i18n.translate("xpack.ml.jobSelector.customTable.searchBarPlaceholder",{defaultMessage:"Search..."})},filters:m,onChange:z}),Object(o.jsx)(i.EuiFormRow,{fullWidth:!0,isInvalid:null!==A,error:c(A),style:{maxHeight:"0px"}},Object(o.jsx)(l.Fragment,null)))),Object(o.jsx)(i.EuiSpacer,{size:"m"}),Object(o.jsx)(i.EuiTableHeaderMobile,null,Object(o.jsx)(i.EuiFlexGroup,{responsive:!1,justifyContent:"spaceBetween",alignItems:"baseline"},Object(o.jsx)(i.EuiFlexItem,{grow:!1},G(!0)))),Object(o.jsx)(i.EuiTable,{"data-test-subj":"mlCustomSelectionTable"},Object(o.jsx)(i.EuiTableHeader,null,function(){const e=[];return t.forEach(((a,l)=>{a.isCheckbox&&!f?e.push(Object(o.jsx)(i.EuiTableHeaderCellCheckbox,{key:a.id,width:a.width},G())):e.push(Object(o.jsx)(i.EuiTableHeaderCell,{key:a.id,align:t[l].alignment,width:a.width,onSort:a.isSortable?()=>function(e){h.sortOn(e);const t=h.sortItems(T);E(t),w(e)}(a.id):void 0,isSorted:S===a.id,isSortAscending:!h||h.isAscendingByName(a.id),mobileOptions:a.mobileOptions},a.label))})),e.length?e:null}()),Object(o.jsx)(i.EuiTableBody,null,function(){const a=a=>{const l=t.map((t=>{const l=a[t.id];let s;return t.isCheckbox?Object(o.jsx)(i.EuiTableRowCellCheckbox,{key:t.id},!f&&Object(o.jsx)(i.EuiCheckbox,{disabled:void 0!==e?e(a):void 0,id:`${a[y]}-checkbox`,"data-test-subj":`${a[y]}-checkbox`,checked:P(a[y]),onChange:()=>H(a[y])}),f&&Object(o.jsx)(i.EuiRadio,{id:a[y],"data-test-subj":`${a[y]}-radio-button`,checked:P(a[y]),onChange:()=>H(a[y]),disabled:void 0!==j?j(a):void 0})):(s=t.render?t.render(a):l,Object(o.jsx)(i.EuiTableRowCell,{key:t.id,align:t.alignment,truncateText:l&&l.truncateText,textOnly:!l||l.textOnly,mobileOptions:{header:t.label,...t.mobileOptions}},s))}));return Object(o.jsx)(i.EuiTableRow,{key:a[y],isSelected:P(a[y]),hasSelection:!0,hasActions:!0,"data-test-subj":`mlCustomSelectionTableRow row-${a[y]}`},l)},l=[];for(let e=_.firstItemIndex;e<=_.lastItemIndex;e++){const t=T[e];if(void 0===t)break;l.push(a(t))}return l}())),Object(o.jsx)(i.EuiSpacer,{size:"m"}),void 0!==F&&Object(o.jsx)(i.EuiTablePagination,{activePage:F.getCurrentPageIndex(),itemsPerPage:_.itemsPerPage,itemsPerPageOptions:[5,10,20,50],pageCount:F.getTotalPages(),onChangeItemsPerPage:function(e){F.setItemsPerPage(e),C({..._,itemsPerPage:e,firstItemIndex:F.getFirstItemIndex(),lastItemIndex:F.getLastItemIndex()})},onChangePage:e=>function(e){F.goToPageIndex(e),C({..._,firstItemIndex:F.getFirstItemIndex(),lastItemIndex:F.getLastItemIndex()})}(e)}))}},485:function(e,t,a){"use strict";var l=a(391);a.d(t,"a",(function(){return l.a}))},486:function(e,t,a){"use strict";var l=a(268);a.d(t,"a",(function(){return l.b}))},490:function(e,t,a){"use strict";a.d(t,"a",(function(){return ee}));var l=a(120),i=a.n(l),s=a(4),n=a.n(s),o=a(8),r=a(2),c=a.n(r),u=a(25),m=a(15),d=a(68),b=a(21),p=a(5),j=a(252),g=a(830),x=a(415),f=a(6);function h({actual:e,typical:t}){const{iconType:a,message:l}=function(e,t){if(void 0===e||void 0===t)return{iconType:"empty",message:""};let a,l="warning",i=0,s=0;if(Array.isArray(e)){if(1!==e.length)return{iconType:"warning",message:p.i18n.translate("xpack.ml.formatters.metricChangeDescription.unusualValuesDescription",{defaultMessage:"Unusual values"})};i=e[0]}else i=e;if(Array.isArray(t)?1===t.length&&(s=t[0]):s=t,i===s)a=p.i18n.translate("xpack.ml.formatters.metricChangeDescription.actualSameAsTypicalDescription",{defaultMessage:"actual same as typical"});else{const e=i>s;if(l=e?"sortUp":"sortDown",0!==s&&0!==i){const t=e?i/s:s/i;a=t>1.5?t<=100?e?p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThanOneAndHalfxHigherDescription",{defaultMessage:"{factor}x higher",values:{factor:Math.round(t)}}):p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThanOneAndHalfxLowerDescription",{defaultMessage:"{factor}x lower",values:{factor:Math.round(t)}}):e?p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThan100xHigherDescription",{defaultMessage:"More than 100x higher"}):p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThan100xLowerDescription",{defaultMessage:"More than 100x lower"}):t>=1.05?e?p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThanOneAndFiveHundredthsxHigherDescription",{defaultMessage:"{factor}x higher",values:{factor:t.toPrecision(2)}}):p.i18n.translate("xpack.ml.formatters.metricChangeDescription.moreThanOneAndFiveHundredthsxLowerDescription",{defaultMessage:"{factor}x lower",values:{factor:t.toPrecision(2)}}):e?p.i18n.translate("xpack.ml.formatters.metricChangeDescription.unusuallyHighDescription",{defaultMessage:"Unusually high"}):p.i18n.translate("xpack.ml.formatters.metricChangeDescription.unusuallyLowDescription",{defaultMessage:"Unusually low"})}else a=0===i?p.i18n.translate("xpack.ml.formatters.metricChangeDescription.unexpectedZeroValueDescription",{defaultMessage:"Unexpected zero value"}):p.i18n.translate("xpack.ml.formatters.metricChangeDescription.unexpectedNonZeroValueDescription",{defaultMessage:"Unexpected non-zero value"})}return{iconType:l,message:a}}(e,t);return Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},void 0!==a&&Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)(u.EuiIcon,{type:a,size:"s"})),Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)(u.EuiText,{size:"xs"},l)))}function y({detectorDescription:e,numberOfRules:t}){let a;return void 0!==t&&t>0&&(a=Object(f.jsx)(u.EuiToolTip,{content:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.detectorCell.rulesConfiguredTooltip",defaultMessage:"rules have been configured for this detector"})},Object(f.jsx)(u.EuiIcon,{type:"controlsHorizontal",className:"detector-rules-icon"}))),Object(f.jsx)(c.a.Fragment,null,e,a)}var O=a(408),v=a(221);class influencers_cell_InfluencersCell extends r.Component{constructor(e){super(e),this.state={showAll:!1}}toggleAllInfluencers(){this.setState({showAll:!this.state.showAll})}renderInfluencers(e){const t=!1===this.state.showAll?this.props.limit:e.length,a=e.slice(0,t),{influencerFilter:l}=this.props;let i=Math.max(e.length-t,0);1===i&&(a.push(e[this.props.limit]),i=0);const s=a.map(((e,t)=>Object(f.jsx)("div",{key:t},e.influencerFieldName,": ",e.influencerFieldValue,void 0!==l&&Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiToolTip,{content:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.addFilterTooltip",defaultMessage:"Add filter"})},Object(f.jsx)(u.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(v.a)((()=>{l(e.influencerFieldName,e.influencerFieldValue,"+")})),iconType:"plusInCircle","aria-label":p.i18n.translate("xpack.ml.anomaliesTable.influencersCell.addFilterAriaLabel",{defaultMessage:"Add filter"})})),Object(f.jsx)(u.EuiToolTip,{content:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(f.jsx)(u.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(v.a)((()=>{l(e.influencerFieldName,e.influencerFieldValue,"-")})),iconType:"minusInCircle","aria-label":p.i18n.translate("xpack.ml.anomaliesTable.influencersCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})}))))));return Object(f.jsx)(c.a.Fragment,null,s,this.renderOthers(e.length,i))}renderOthers(e,t){return t>0?Object(f.jsx)("div",null,Object(f.jsx)(u.EuiLink,{onClick:()=>this.toggleAllInfluencers()},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.moreInfluencersLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:t}}))):e>this.props.limit+1?Object(f.jsx)("div",null,Object(f.jsx)(u.EuiLink,{onClick:()=>this.toggleAllInfluencers()},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.influencersCell.showLessInfluencersLinkText",defaultMessage:"show less"}))):void 0}render(){const e=this.props.influencers||[],t=[];return e.forEach((e=>{Object(o.each)(e,((e,a)=>{t.push({influencerFieldName:a,influencerFieldValue:e})}))})),Object(f.jsx)("div",null,this.renderInfluencers(t),this.renderOthers(t))}}var T=a(399),E=a(70),k=a(194);const M=500;var S=a(529),w=a(335);const F=Object(r.memo)((({score:e,isMultiBucketAnomaly:t})=>{const a=Object(S.a)(e),l=Object(w.a)(e);return t?Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",responsive:!1},Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)("svg",{width:"16",height:"16",viewBox:"-2 -2 20 20",fill:l},Object(f.jsx)("path",{d:"M-6.708203932499369,-2.23606797749979H-2.23606797749979V-6.708203932499369H2.23606797749979V-2.23606797749979H6.708203932499369V2.23606797749979H2.23606797749979V6.708203932499369H-2.23606797749979V2.23606797749979H-6.708203932499369Z",transform:"translate(8,8)"}))),Object(f.jsx)(u.EuiFlexItem,{grow:!1},a)):Object(f.jsx)(u.EuiHealth,{color:l},a)}));function I(e,t,a){return Object(j.h)(e.source)&&Object(E.checkPermission)("canUpdateJob")||t&&e.isTimeSeriesViewRecord||"mlcategory"===e.entityName||void 0!==e.customUrls||e.detector.includes(g.b.LAT_LONG)||e.sourceIndices&&e.sourceIndices((t=>void 0!==a[e.jobId][t]))}var _=a(37),C=a(843),D=a(10);function R(e,t,a){return Object(f.jsx)(O.a,{entityName:e,entityValue:t,filter:a})}var A={name:"educr3",styles:"width:180px"};const L=({anomaly:e,filter:t,modelPlotEnabled:a})=>{const l=e.source;let i=[];const s=l.causes||[];let n,o;1===s.length?void 0!==s[0].by_field_name&&(n=s[0].by_field_name,o=s[0].by_field_value):i=s.map((e=>({typical:e.typical,actual:e.actual,probability:e.probability,entityName:e.by_field_name?e.by_field_name:e.over_field_name,entityValue:e.by_field_value?e.by_field_value:e.over_field_value})));const r=[];void 0!==l.partition_field_value&&void 0!==l.partition_field_name&&r.push({title:l.partition_field_name,description:R(l.partition_field_name,String(l.partition_field_value),t)}),void 0!==l.by_field_value&&void 0!==l.by_field_name&&r.push({title:l.by_field_name,description:R(l.by_field_name,l.by_field_value,t)}),void 0!==n&&void 0!==o&&r.push({title:n,description:R(n,o,t)}),void 0!==l.over_field_value&&void 0!==l.over_field_name&&r.push({title:l.over_field_name,description:R(l.over_field_name,l.over_field_value,t)});const m=l.timestamp;let d=`${Object(x.c)(m)}`;if(void 0!==l.bucket_span){const e=m+1e3*l.bucket_span;d=p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyTimeRangeLabel",{defaultMessage:"{anomalyTime} to {anomalyEndTime}",values:{anomalyTime:Object(x.c)(m),anomalyEndTime:Object(x.c)(e)}})}r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.timeTitle",{defaultMessage:"Time"}),description:d}),r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.functionTitle",{defaultMessage:"Function"}),description:l.function!==g.b.METRIC?l.function:l.function_description}),void 0!==l.field_name&&r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.fieldNameTitle",{defaultMessage:"Field name"}),description:l.field_name});const b=l.function_description||"";var h,y,O,v;return void 0!==e.actual&&!0===Object(j.i)(b)&&r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.actualTitle",{defaultMessage:"Actual"}),description:Object(k.b)(e.actual,l.function,void 0,l)}),void 0!==e.typical&&!0===Object(j.j)(b)&&(r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.typicalTitle",{defaultMessage:"Typical"}),description:Object(k.b)(e.typical,l.function,void 0,l)}),!1===a&&void 0!==(null===(h=e.source.anomaly_score_explanation)||void 0===h?void 0:h.lower_confidence_bound)&&void 0!==(null===(y=e.source.anomaly_score_explanation)||void 0===y?void 0:y.upper_confidence_bound)&&(r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.upperBoundsTitle",{defaultMessage:"Upper bound"}),description:Object(k.b)(null===(O=e.source.anomaly_score_explanation)||void 0===O?void 0:O.upper_confidence_bound,l.function,void 0,l)}),r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.lowerBoundsTitle",{defaultMessage:"Lower bound"}),description:Object(k.b)(null===(v=e.source.anomaly_score_explanation)||void 0===v?void 0:v.lower_confidence_bound,l.function,void 0,l)}))),r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.jobIdTitle",{defaultMessage:"Job ID"}),description:e.jobId}),r.push({title:Object(f.jsx)("span",null,p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.recordScoreTitle",{defaultMessage:"Record score"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.recordScoreTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record result. This value might change as new data is analyzed."})})),description:Math.floor(1e3*l.record_score)/1e3}),r.push({title:Object(f.jsx)("span",null,p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.initialRecordScoreTitle",{defaultMessage:"Initial record score"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.initialRecordScoreTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record when the bucket was initially processed."})})),description:Math.floor(1e3*l.initial_record_score)/1e3}),r.push({title:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.probabilityTitle",{defaultMessage:"Probability"}),description:void 0!==l.probability?Number.parseFloat(l.probability).toPrecision(3):""}),i.length>1&&i.forEach(((e,t)=>{const a=0===t?p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesTitle",{defaultMessage:"{causeEntityName} values",values:{causeEntityName:e.entityName}}):"",i=p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesDescription",{defaultMessage:"{causeEntityValue} (actual {actualValue}, typical {typicalValue}, probability {probabilityValue})",values:{causeEntityValue:e.entityValue,actualValue:Object(k.b)(e.actual,l.function),typicalValue:Object(k.b)(e.typical,l.function),probabilityValue:e.probability}});r.push({title:a,description:i})})),Object(f.jsx)(c.a.Fragment,null,r.map((({title:e,description:t})=>Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"none"},Object(f.jsx)(u.EuiFlexItem,{css:A,grow:!1},e),Object(f.jsx)(u.EuiFlexItem,null,t)),Object(f.jsx)(u.EuiSpacer,{size:"xs"})))))};var N={name:"1q4vxyr",styles:"margin-left:8px"},B={name:"1v1nmsf",styles:"width:220px"};const z=({anomaly:e})=>{const{services:{docLinks:t}}=Object(D.d)(),a=t.links.ml.anomalyDetectionScoreExplanation,l=e.source.anomaly_score_explanation;if(void 0===l)return null;const i=Math.floor(1e3*e.source.initial_record_score)/1e3,s=Math.floor(1e3*e.source.record_score)/1e3,n=i-s,o=p.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.yes",{defaultMessage:"Yes"}),r=p.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.no",{defaultMessage:"No"}),d=[],b=function(e){if(void 0===e||void 0===e.anomaly_length||void 0===e.anomaly_type)return null;const t=p.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.anomalyType.dip",{defaultMessage:"Dip over {anomalyLength, plural, one {# bucket} other {# buckets}}",values:{anomalyLength:e.anomaly_length}}),a=p.i18n.translate("xpack.ml.anomaliesTable.anomalyExplanationDetails.anomalyType.spike",{defaultMessage:"Spike over {anomalyLength, plural, one {# bucket} other {# buckets}}",values:{anomalyLength:e.anomaly_length}});return"dip"===e.anomaly_type?t:a}(l);null!==b&&d.push({title:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyType",defaultMessage:"Anomaly type"}),description:Object(f.jsx)(c.a.Fragment,null,b)}),n>10&&d.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.recordScore",defaultMessage:"Record score reduction"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.recordScoreTooltip",{defaultMessage:"The initial record score has been reduced based on the analysis of subsequent data."})})),description:Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"xs"},Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)(V,{score:i})),Object(f.jsx)(u.EuiFlexItem,{grow:!1}," -> "),Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)(V,{score:s})))});const j=[];return void 0!==l.anomaly_characteristics_impact&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristics",defaultMessage:"Anomaly characteristics impact"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:G(l.anomaly_characteristics_impact,"anomaly_characteristics")})),description:Object(f.jsx)(H,{score:l.anomaly_characteristics_impact})}),void 0!==l.single_bucket_impact&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucket",defaultMessage:"Single bucket impact"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:G(l.single_bucket_impact,"single_bucket")})),description:Object(f.jsx)(H,{score:l.single_bucket_impact})}),void 0!==l.multi_bucket_impact&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucket",defaultMessage:"Multi bucket impact"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:G(l.multi_bucket_impact,"multi_bucket")})),description:Object(f.jsx)(H,{score:l.multi_bucket_impact})}),void 0!==l.high_variance_penalty&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.highVariance",defaultMessage:"High variance interval"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.highVarianceTooltip",{defaultMessage:"Indicates reduction of anomaly score for the bucket with large confidence intervals. If a bucket has large confidence intervals, the score is reduced."})})),description:l.high_variance_penalty?o:r}),void 0!==l.multimodal_distribution&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multimodal",defaultMessage:"Multi-modal distribution"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multimodalTooltip",{defaultMessage:"Indicates whether the prior distribution of the time series is multi-modal or has a single mode."})})),description:l.multimodal_distribution?o:r}),void 0!==l.incomplete_bucket_penalty&&j.push({title:Object(f.jsx)("span",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.incompleteBucket",defaultMessage:"Incomplete bucket"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",position:"left",content:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.incompleteBucketTooltip",{defaultMessage:"If the bucket contains fewer samples than expected, the score is reduced."})})),description:l.incomplete_bucket_penalty?o:r}),Object(f.jsx)("div",null,Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationTitle",defaultMessage:"Anomaly explanation {learnMoreLink}",values:{learnMoreLink:Object(f.jsx)(u.EuiLink,{href:a,target:"_blank",css:N},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanation.learnMoreLinkText",defaultMessage:"Learn more"}))}}))),Object(f.jsx)(u.EuiSpacer,{size:"s"}),d.map((({title:e,description:t})=>Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"none"},Object(f.jsx)(u.EuiFlexItem,{style:{width:"220px"},grow:!1},e),Object(f.jsx)(u.EuiFlexItem,null,t)),Object(f.jsx)(u.EuiSpacer,{size:"xs"})))),Object(f.jsx)(u.EuiSpacer,{size:"s"}),j.length?Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.impactOnScoreTitle",defaultMessage:"Impact on initial score"}))),Object(f.jsx)(u.EuiSpacer,{size:"s"}),j.map((({title:e,description:t})=>Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"none"},Object(f.jsx)(u.EuiFlexItem,{css:B,grow:!1},e),Object(f.jsx)(u.EuiFlexItem,null,t)),Object(f.jsx)(u.EuiSpacer,{size:"xs"}))))):null)};var P={name:"163mag1",styles:"border-bottom:2px solid"};const V=({score:e})=>Object(f.jsx)("div",{css:P,style:{borderBottomColor:Object(w.a)(e)}},e),J={anomaly_characteristics:{low:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.low",{defaultMessage:"Moderate impact from the duration and magnitude of the detected anomaly relative to the historical average."}),medium:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.medium",{defaultMessage:"Medium impact from the duration and magnitude of the detected anomaly relative to the historical average."}),high:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.anomalyCharacteristicsTooltip.high",{defaultMessage:"High impact from the duration and magnitude of the detected anomaly relative to the historical average."})},single_bucket:{low:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.low",{defaultMessage:"The difference between actual and typical values in this bucket has a moderate impact."}),medium:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.medium",{defaultMessage:"The difference between actual and typical values in this bucket has a significant impact."}),high:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.singleBucketTooltip.high",{defaultMessage:"The difference between actual and typical values in this bucket has a high impact."})},multi_bucket:{low:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.low",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a moderate impact."}),medium:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.medium",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a significant impact."}),high:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyExplanationDetails.multiBucketTooltip.high",{defaultMessage:"The differences between actual and typical values in the past 12 buckets have a high impact."})}};function G(e,t){const a=Object(j.c)(e);return a<3?J[t].low:a>3?J[t].high:J[t].medium}const H=({score:e})=>{const{euiTheme:{colors:t}}=Object(u.useEuiTheme)(),a=Object(j.c)(e),l="10px",i=t.lightShade,s=t.primary;return Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"xs"},Array(5).fill(null).map(((e,t)=>Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)("div",{css:Object(f.css)({height:l,width:l,borderRadius:"2px"},"",""),style:{backgroundColor:a>t?s:i}})))))},$=({anomaly:e,examples:t,definition:a,isAggregatedData:l,filter:i,influencersLimit:s,influencerFilter:n,tabIndex:o,job:r})=>{if(void 0!==t&&t.length>0){const c=[{id:"Details",name:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.detailsTitle",{defaultMessage:"Details"}),content:Object(f.jsx)(Y,{anomaly:e,filter:i,influencerFilter:n,influencersLimit:s,isAggregatedData:l,job:r})},{id:"category-examples",name:p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.categoryExamplesTitle",{defaultMessage:"Category examples"}),content:Object(f.jsx)(Q,{examples:t,definition:a})}];return Object(f.jsx)(u.EuiFlexGroup,null,Object(f.jsx)(u.EuiFlexItem,null,Object(f.jsx)(u.EuiTabbedContent,{tabs:c,size:"s",initialSelectedTab:c[o],onTabClick:()=>{}})))}return Object(f.jsx)(Y,{anomaly:e,filter:i,influencerFilter:n,influencersLimit:s,isAggregatedData:l,job:r})},Y=({anomaly:e,isAggregatedData:t,filter:a,influencersLimit:l,influencerFilter:i,job:s})=>{const{euiTheme:{colors:n}}=Object(u.useEuiTheme)(),o=Object(r.useMemo)((()=>Object(_.a)(e.source.anomaly_score_explanation)?{borderRight:`1px solid ${n.lightShade}`}:{}),[n,e]);return Object(f.jsx)(u.EuiFlexGroup,null,Object(f.jsx)(u.EuiFlexItem,null,Object(f.jsx)("div",{className:"ml-anomalies-table-details","data-test-subj":"mlAnomaliesListRowDetails"},Object(f.jsx)(q,{anomaly:e}),Object(f.jsx)(u.EuiSpacer,{size:"m"}),Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"l"},Object(f.jsx)(u.EuiFlexItem,{css:o},Object(f.jsx)(U,{anomaly:e,isAggregatedData:t,filter:a,job:s}),Object(f.jsx)(W,{anomaly:e,influencerFilter:i,influencersLimit:l})),Object(f.jsx)(u.EuiFlexItem,null,Object(f.jsx)(z,{anomaly:e}))))))},q=({anomaly:e})=>{const{anomalyDescription:t,mvDescription:a}=function(e){const t=e.source;let a=p.i18n.translate("xpack.ml.anomalyDescription.anomalyInLabel",{defaultMessage:"{anomalySeverity} anomaly in {anomalyDetector}",values:{anomalySeverity:Object(o.capitalize)(Object(C.a)(e.severity).label),anomalyDetector:e.detector}});void 0!==e.entityName&&(a+=p.i18n.translate("xpack.ml.anomalyDescription.foundForLabel",{defaultMessage:" found for {anomalyEntityName} {anomalyEntityValue}",values:{anomalyEntityName:e.entityName,anomalyEntityValue:e.entityValue}})),void 0!==t.partition_field_name&&t.partition_field_name!==e.entityName&&(a+=p.i18n.translate("xpack.ml.anomalyDescription.detectedInLabel",{defaultMessage:" detected in {sourcePartitionFieldName} {sourcePartitionFieldValue}",values:{sourcePartitionFieldName:t.partition_field_name,sourcePartitionFieldValue:t.partition_field_value}}));let l="";return void 0!==t.correlated_by_field_value&&(l=p.i18n.translate("xpack.ml.anomalyDescription.multivariateDescription",{defaultMessage:"multivariate correlations found in {sourceByFieldName}; {sourceByFieldValue} is considered anomalous given {sourceCorrelatedByFieldValue}",values:{sourceByFieldName:t.by_field_name,sourceByFieldValue:t.by_field_value,sourceCorrelatedByFieldValue:t.correlated_by_field_value}})),{anomalyDescription:a,mvDescription:l}}(e);return Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.descriptionTitle",defaultMessage:"Description"})),t),void 0!==a&&Object(f.jsx)(u.EuiText,{size:"xs"},a))},U=({anomaly:e,isAggregatedData:t,filter:a,job:l})=>{var i,s;const n=null!==(i=null===(s=e.source)||void 0===s?void 0:s.is_interim)&&void 0!==i&&i;return Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiText,{size:"xs"},!0===t?Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.detailsOnHighestSeverityAnomalyTitle",defaultMessage:"Details on highest severity anomaly"})):Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDetailsTitle",defaultMessage:"Anomaly details"})),!0===n&&Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiIcon,{type:"warning"}),Object(f.jsx)("span",{className:"interim-result"},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.interimResultLabel",defaultMessage:"Interim result"})))),Object(f.jsx)(u.EuiSpacer,{size:"xs"}),Object(f.jsx)(L,{anomaly:e,filter:a,modelPlotEnabled:l.modelPlotEnabled}))},W=({anomaly:e,influencersLimit:t,influencerFilter:a})=>{const[l,i]=Object(r.useState)(!1),s=i.bind(null,(e=>!e)),n=e.influencers;let o=[],d=0,b=0;return void 0!==n&&(b=!0===l?n.length:Math.min(t,n.length),d=Math.max(n.length-b,0),1===d&&(b++,d=0),o=function(e,t,a){const l=[];for(let i=0;i<a;i++)Object.keys(e[i]).forEach((a=>{const s=e[i][a];l.push({title:a,description:R(a,s,t)})}));return l}(n,a,b)),o.length>0?Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiSpacer,{size:"m"}),Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.influencersTitle",defaultMessage:"Influencers"}))),o.map((({title:e,description:t})=>Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexGroup,{gutterSize:"none"},Object(f.jsx)(u.EuiFlexItem,{style:{width:"180px"},grow:!1},e),Object(f.jsx)(u.EuiFlexItem,null,t)),Object(f.jsx)(u.EuiSpacer,{size:"xs"})))),d>0&&Object(f.jsx)(u.EuiLink,{onClick:()=>s()},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionListMoreLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:d}})),b>t+1&&Object(f.jsx)(u.EuiLink,{onClick:()=>s()},Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionShowLessLinkText",defaultMessage:"Show less"}))):null},Q=({definition:e,examples:t})=>Object(f.jsx)(u.EuiFlexGroup,{direction:"column",justifyContent:"center",gutterSize:"xs",className:"mlAnomalyCategoryExamples"},void 0!==e&&e.terms&&Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexItem,{key:"example-terms"},Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",{className:"mlAnomalyCategoryExamples__header"},p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.termsTitle",{defaultMessage:"Terms"}))," ",Object(f.jsx)(u.EuiIconTip,{"aria-label":p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionTooltip",defaultMessage:"A space separated list of the common tokens that are matched in values of the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:M}})})),Object(f.jsx)(u.EuiText,{size:"xs"},e.terms)),Object(f.jsx)(u.EuiSpacer,{size:"xs"})),void 0!==e&&e.regex&&Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(u.EuiFlexItem,{key:"example-regex"},Object(f.jsx)(u.EuiText,{size:"xs"},Object(f.jsx)("h4",{className:"mlAnomalyCategoryExamples__header"},p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.regexTitle",{defaultMessage:"Regex"}))," ",Object(f.jsx)(u.EuiIconTip,{"aria-label":p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionTooltip",defaultMessage:"The regular expression that is used to search for values that match the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:M}})})),Object(f.jsx)(u.EuiText,{size:"xs"},e.regex)),Object(f.jsx)(u.EuiSpacer,{size:"xs"})),t.map(((t,a)=>Object(f.jsx)(u.EuiFlexItem,{key:`example${a}`},0===a&&void 0!==e&&Object(f.jsx)(u.EuiText,{size:"s"},Object(f.jsx)("h4",null,p.i18n.translate("xpack.ml.anomaliesTable.anomalyDetails.examplesTitle",{defaultMessage:"Examples"}))),Object(f.jsx)("span",{className:"mlAnomalyCategoryExamples__item"},t)))));var Z=a(262),X=a(388),K=a(11);class anomalies_table_AnomaliesTableInternal extends r.Component{constructor(e){super(e),n()(this,"isShowingAggregatedData",(()=>"second"!==this.props.tableData.interval)),n()(this,"toggleRow",(async(e,t=0)=>{const a={...this.state.itemIdToExpandedRowMap};if(a[e.rowId])delete a[e.rowId];else{const l="mlcategory"===e.entityName?Object(o.get)(this.props.tableData,["examplesByJobId",e.jobId,e.entityValue]):void 0;let i;if(void 0!==l)try{i=await K.ml.results.getCategoryDefinition(e.jobId,e.source.mlcategory[0]),i.terms&&i.terms.length>M&&(i.terms=`${i.terms.substring(0,M)}...`),i.regex&&i.regex.length>M&&(i.terms=`${i.regex.substring(0,M)}...`)}catch(e){console.log("Error fetching category definition for row item.",e)}const s=this.props.selectedJobs.find((({id:t})=>t===e.jobId));a[e.rowId]=Object(f.jsx)($,{tabIndex:t,anomaly:e,examples:l,definition:i,isAggregatedData:this.isShowingAggregatedData(),filter:this.props.filter,influencerFilter:this.props.influencerFilter,influencersLimit:5,job:s})}this.setState({itemIdToExpandedRowMap:a})})),n()(this,"onMouseOverRow",(e=>{void 0!==this.mouseOverRecord?this.mouseOverRecord.rowId!==e.rowId&&(Z.a.rowMouseleave$.next({record:this.mouseOverRecord}),Z.a.rowMouseenter$.next({record:e})):Z.a.rowMouseenter$.next({record:e}),this.mouseOverRecord=e})),n()(this,"onMouseLeaveRow",(()=>{void 0!==this.mouseOverRecord&&(Z.a.rowMouseleave$.next({record:this.mouseOverRecord}),this.mouseOverRecord=void 0)})),n()(this,"setShowRuleEditorFlyoutFunction",(e=>{this.setState({showRuleEditorFlyout:e})})),n()(this,"unsetShowRuleEditorFlyoutFunction",(()=>{this.setState({showRuleEditorFlyout:()=>{}})})),n()(this,"onTableChange",(({page:e,sort:t})=>{const{tableState:a,updateTableState:l}=this.props;l({pageIndex:e&&void 0!==e.index?e.index:a.pageIndex,pageSize:e&&void 0!==e.size?e.size:a.pageSize,sortField:t&&void 0!==t.field&&"string"==typeof t.field?t.field:a.sortField,sortDirection:t&&void 0!==t.direction?t.direction:a.sortDirection})})),this.state={itemIdToExpandedRowMap:{},showRuleEditorFlyout:()=>{}}}static getDerivedStateFromProps(e,t){const a=t.itemIdToExpandedRowMap;return void 0!==Object.keys(a).find((t=>void 0===e.tableData.anomalies.find((e=>e.rowId===t))))?{itemIdToExpandedRowMap:{}}:null}render(){const{bounds:e,tableData:t,filter:a,influencerFilter:l,tableState:i}=this.props;if(void 0===t||void 0===t.anomalies||0===t.anomalies.length)return Object(f.jsx)(u.EuiFlexGroup,{justifyContent:"spaceAround"},Object(f.jsx)(u.EuiFlexItem,{grow:!1},Object(f.jsx)(u.EuiText,null,Object(f.jsx)("h4",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.noMatchingAnomaliesFoundTitle",defaultMessage:"No matching anomalies found"})))));const s=function(e,t,a,l,i,s,n,r,c,d,b,g,v,E){const M=[{name:Object(f.jsx)(u.EuiScreenReaderOnly,null,Object(f.jsx)("p",null,Object(f.jsx)(m.FormattedMessage,{id:"xpack.ml.anomaliesTable.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each anomaly"}))),render:e=>Object(f.jsx)(u.EuiButtonIcon,{onClick:()=>b(e),iconType:d[e.rowId]?"arrowDown":"arrowRight","aria-label":d[e.rowId]?p.i18n.translate("xpack.ml.anomaliesTable.hideDetailsAriaLabel",{defaultMessage:"Hide details"}):p.i18n.translate("xpack.ml.anomaliesTable.showDetailsAriaLabel",{defaultMessage:"Show details"}),"data-row-id":e.rowId,"data-test-subj":"mlAnomaliesListRowDetailsToggle"})},{field:"time","data-test-subj":"mlAnomaliesListColumnTime",name:p.i18n.translate("xpack.ml.anomaliesTable.timeColumnName",{defaultMessage:"Time"}),dataType:"date",scope:"row",render:e=>function(e,t){return"hour"===t?Object(x.b)(e):"second"===t?Object(x.c)(e):Object(x.a)(e)}(e,s),textOnly:!0,sortable:!0},{field:"severity","data-test-subj":"mlAnomaliesListColumnSeverity",name:Object(f.jsx)("span",null,p.i18n.translate("xpack.ml.anomaliesTable.severityColumnName",{defaultMessage:"Severity"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",content:p.i18n.translate("xpack.ml.overview.anomalyDetection.tableSeverityTooltip",{defaultMessage:"A normalized score between 0-100, which indicates the relative significance of the anomaly record results."})})),render:(e,t)=>Object(f.jsx)(F,{score:e,isMultiBucketAnomaly:Object(j.g)(t.source)}),sortable:!0},{field:"detector","data-test-subj":"mlAnomaliesListColumnDetector",name:p.i18n.translate("xpack.ml.anomaliesTable.detectorColumnName",{defaultMessage:"Detector"}),render:(e,t)=>Object(f.jsx)(y,{detectorDescription:e,numberOfRules:t.rulesLength}),textOnly:!0,sortable:!0}];return t.some((e=>void 0!==e.entityValue))&&M.push({field:"entityValue","data-test-subj":"mlAnomaliesListColumnFoundFor",name:p.i18n.translate("xpack.ml.anomaliesTable.entityValueColumnName",{defaultMessage:"Found for"}),render:(e,t)=>Object(f.jsx)(O.a,{entityName:t.entityName,entityValue:e,filter:g,wrapText:!0}),textOnly:!0,sortable:!0}),t.some((e=>void 0!==e.influencers))&&M.push({field:"influencers","data-test-subj":"mlAnomaliesListColumnInfluencers",name:p.i18n.translate("xpack.ml.anomaliesTable.influencersColumnName",{defaultMessage:"Influenced by"}),render:e=>Object(f.jsx)(influencers_cell_InfluencersCell,{limit:5,influencers:e,influencerFilter:v}),textOnly:!0,sortable:!0}),t.some((e=>void 0!==e.actual))&&M.push({field:"actualSort","data-test-subj":"mlAnomaliesListColumnActual",name:Object(f.jsx)("span",null,p.i18n.translate("xpack.ml.anomaliesTable.actualSortColumnName",{defaultMessage:"Actual"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",content:p.i18n.translate("xpack.ml.overview.anomalyDetection.tableActualTooltip",{defaultMessage:"The actual values in the anomaly record results."})})),render:(t,a)=>{const l=e.getFieldFormat(a.jobId,a.source.detector_index);return Object(k.b)(a.actual,a.source.function,l,a.source)},sortable:!0,className:"eui-textBreakNormal"}),t.some((e=>void 0!==e.typical))&&(M.push({field:"typicalSort","data-test-subj":"mlAnomaliesListColumnTypical",name:Object(f.jsx)("span",null,p.i18n.translate("xpack.ml.anomaliesTable.typicalSortColumnName",{defaultMessage:"Typical"})," ",Object(f.jsx)(u.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop",content:p.i18n.translate("xpack.ml.overview.anomalyDetection.tableTypicalTooltip",{defaultMessage:"The typical values in the anomaly record results."})})),render:(t,a)=>{const l=e.getFieldFormat(a.jobId,a.source.detector_index);return Object(k.b)(a.typical,a.source.function,l,a.source)},sortable:!0,className:"eui-textBreakNormal"}),!0===t.some((e=>{const t=e.source.function;return"time_of_day"!==t&&"time_of_week"!==t}))&&M.push({field:"metricDescriptionSort","data-test-subj":"mlAnomaliesListColumnDescription",name:p.i18n.translate("xpack.ml.anomaliesTable.metricDescriptionSortColumnName",{defaultMessage:"Description"}),render:(e,t)=>Object(f.jsx)(h,{actual:t.actual,typical:t.typical}),textOnly:!0,sortable:!0})),a&&a.length>1&&M.push({field:"jobId","data-test-subj":"mlAnomaliesListColumnJobID",name:p.i18n.translate("xpack.ml.anomaliesTable.jobIdColumnName",{defaultMessage:"Job ID"}),sortable:!0}),!0===t.some((e=>"mlcategory"===e.entityName))&&M.push({"data-test-subj":"mlAnomaliesListColumnCategoryExamples",name:p.i18n.translate("xpack.ml.anomaliesTable.categoryExamplesColumnName",{defaultMessage:"Category examples"}),truncateText:!0,render:e=>{const t=Object(o.get)(l,[e.jobId,e.entityValue],[]);return Object(f.jsx)(u.EuiLink,{className:"mlAnomalyCategoryExamples__link",onClick:()=>b(e,1)},t.map(((e,t)=>Object(f.jsx)("span",{key:`example${t}`,className:"category-example"},e))))},width:"13%"}),!0===t.some((e=>I(e,r,E)))&&M.push({"data-test-subj":"mlAnomaliesListColumnAction",name:p.i18n.translate("xpack.ml.anomaliesTable.actionsColumnName",{defaultMessage:"Actions"}),render:e=>!0===I(e,r,E)?Object(f.jsx)(T.a,{anomaly:e,bounds:n,showViewSeriesLink:r,isAggregatedData:i,interval:s,showRuleEditorFlyout:c,sourceIndicesWithGeoFields:E}):null}),M}(this.context.services.mlServices.mlFieldFormatService,t.anomalies,t.jobIds,t.examplesByJobId,this.isShowingAggregatedData(),t.interval,e,t.showViewSeriesLink,this.state.showRuleEditorFlyout,this.state.itemIdToExpandedRowMap,this.toggleRow,a,l,this.props.sourceIndicesWithGeoFields),n=s.some((e=>!0===e.truncateText))?"fixed":"auto",r={sort:{field:i.sortField,direction:i.sortDirection}},d={pageIndex:i.pageIndex,pageSize:i.pageSize,totalItemCount:t.anomalies.length,pageSizeOptions:[10,25,100]};return Object(f.jsx)(c.a.Fragment,null,Object(f.jsx)(X.a,{setShowFunction:this.setShowRuleEditorFlyoutFunction,unsetShowFunction:this.unsetShowRuleEditorFlyoutFunction}),Object(f.jsx)(u.EuiInMemoryTable,{className:"ml-anomalies-table eui-textBreakWord",items:t.anomalies,columns:s,tableLayout:n,pagination:d,sorting:r,itemId:"rowId",itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,compressed:!0,rowProps:e=>({onMouseOver:()=>this.onMouseOverRow(e),onMouseLeave:()=>this.onMouseLeaveRow(),"data-test-subj":`mlAnomaliesListRow row-${e.rowId}`}),"data-test-subj":"mlAnomaliesTable",onTableChange:this.onTableChange}))}}n()(anomalies_table_AnomaliesTableInternal,"contextType",b.context);const ee=e=>{const[t,a]=Object(d.c)("mlAnomaliesTable",{pageIndex:0,pageSize:25,sortField:"severity",sortDirection:"desc"});return Object(f.jsx)(anomalies_table_AnomaliesTableInternal,i()({},e,{tableState:t,updateTableState:a}))}},492:function(e,t,a){"use strict";a.d(t,"a",(function(){return M})),a.d(t,"b",(function(){return S}));var l=a(2),i=a.n(l),s=a(5),n=a(25),o=a(279),r=a(6);const c=({limit:e,maps:t,newSelection:a,onDeleteClick:l,onLinkClick:c,showAllBadges:u})=>{const m=[];for(let i=0;i<a.length&&!(i>=e&&!1===u);i++)m.push(Object(r.jsx)(n.EuiFlexItem,{grow:!1,key:a[i]},Object(r.jsx)(o.a,{id:a[i],icon:!0,isGroup:void 0!==t.groupsMap[a[i]],removeId:l})));return!1===u&&a.length>e?m.push(Object(r.jsx)(n.EuiLink,{key:"more-badges-link",onClick:c},Object(r.jsx)(n.EuiText,{grow:!1,size:"xs"},s.i18n.translate("xpack.ml.jobSelector.showFlyoutBadges",{defaultMessage:"And {overFlow} more",values:{overFlow:a.length-e}})))):!0===u&&a.length>e&&m.push(Object(r.jsx)(n.EuiLink,{key:"hide-badges-link",onClick:c},Object(r.jsx)(n.EuiText,{grow:!1,size:"xs"},s.i18n.translate("xpack.ml.jobSelector.hideFlyoutBadges",{defaultMessage:"Hide"})))),Object(r.jsx)(i.a.Fragment,null,m)};var u=a(411);function m({isRunning:e,timerange:t,ganttBarWidth:a}){const i={width:t.widthPx,marginLeft:t.fromPx},s="mlJobSelector__ganttBar"+(e?" mlJobSelector__ganttBarRunning":"");return Object(r.jsx)(n.EuiToolTip,{position:"top",content:t.label},Object(r.jsx)(l.Fragment,null,Object(r.jsx)("div",{className:"mlJobSelector__ganttBarBackEdge"},Object(r.jsx)("div",{className:"mlJobSelector__ganttBarDashed",style:{width:`${a}px`}})),Object(r.jsx)("div",{style:i,className:s})))}var d=a(15),b=a(10),p=a(1),j=a(0),g=a(51);const x=["job_id","groups"],f=["id"];function h({ganttBarWidth:e,groupsList:t,jobs:a,onSelection:i,selectedIds:c,singleSelection:h,timeseriesOnly:y,withTimeRangeSelector:O}){const[v,T]=Object(l.useState)(),[E,k]=Object(l.useState)(!0),[M,S]=Object(l.useState)("Jobs"),{services:{application:{navigateToApp:w,capabilities:{ml:F}}}}=Object(b.d)();Object(l.useEffect)((()=>{let e=[],t="job_id";"Jobs"===M||h?e=[{name:"job_id",getValue:e=>e.job_id.toLowerCase(),isAscending:!0},{name:"groups",getValue:e=>e.groups&&e.groups[0]?e.groups[0].toLowerCase():"",isAscending:!0}]:"Groups"===M&&(t="id",e=[{name:"id",getValue:e=>e.id.toLowerCase(),isAscending:!0}]);const a=new n.SortableProperties(e,t);T(a)}),[a,M]);const I=[{id:"Jobs",name:s.i18n.translate("xpack.ml.jobSelector.jobsTab",{defaultMessage:"Jobs"}),content:_()},{id:"Groups",name:s.i18n.translate("xpack.ml.jobSelector.groupsTab",{defaultMessage:"Groups"}),content:function(){const a=[{id:"checkbox",isCheckbox:!0,textOnly:!1,width:"32px"},{label:"group ID",id:"id",isSortable:!0,alignment:n.LEFT_ALIGNMENT,render:({id:e})=>Object(r.jsx)(o.a,{id:e,isGroup:!0})},{id:"jobs in group",label:"jobs in group",isSortable:!1,alignment:n.CENTER_ALIGNMENT,render:({jobIds:e=[]})=>e.length}];return O&&a.push({label:"time range",id:"timerange",alignment:n.LEFT_ALIGNMENT,render:({timeRange:t={}})=>Object(r.jsx)(m,{timerange:t,ganttBarWidth:e})}),Object(r.jsx)(u.a,{columns:a,filterDefaultFields:h?void 0:f,items:t,onTableChange:e=>i({selectionFromTable:e}),selectedIds:c,sortableProperties:v})}()}];function _(){const d=[{id:"checkbox",isCheckbox:!0,textOnly:!1,width:"32px"},{label:"job ID",id:"job_id",isSortable:!0,alignment:n.LEFT_ALIGNMENT},{id:"groups",label:"groups",isSortable:!0,alignment:n.LEFT_ALIGNMENT,render:({groups:e=[]})=>e.map((e=>Object(r.jsx)(o.a,{key:`${e}-key`,id:e,isGroup:!0})))}];O&&d.push({label:"time range",id:"timerange",alignment:n.LEFT_ALIGNMENT,render:({timeRange:t={},isRunning:a})=>Object(r.jsx)(m,{timerange:t,isRunning:a,ganttBarWidth:e})});const b=[{type:"field_value_selection",field:"groups",name:s.i18n.translate("xpack.ml.jobSelector.filterBar.groupLabel",{defaultMessage:"Group"}),loadingMessage:"Loading...",noOptionsMessage:"No groups found.",multiSelect:"or",cache:1e4,options:t.map((e=>({value:e.id,view:Object(r.jsx)(l.Fragment,null,Object(r.jsx)(n.EuiFlexGroup,{gutterSize:"s"},Object(r.jsx)(n.EuiFlexItem,{key:e.id,grow:!1},Object(r.jsx)(o.a,{id:e.id,isGroup:!0})),Object(r.jsx)(n.EuiFlexItem,{grow:!1},s.i18n.translate("xpack.ml.jobSelector.filterBar.jobGroupTitle",{defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:e.jobIds.length}}))))})))}];return Object(r.jsx)(u.a,{columns:d,filters:b,filterDefaultFields:h?void 0:x,items:a,onTableChange:e=>i({selectionFromTable:e}),radioDisabledCheck:e=>y&&!1===e.isSingleMetricViewerJob,selectedIds:c,singleSelection:h,sortableProperties:v,timeseriesOnly:y})}return Object(r.jsx)(l.Fragment,null,Object(r.jsx)(g.a,{nodeAvailableCallback:k}),0===a.length&&Object(r.jsx)(n.EuiCallOut,{title:Object(r.jsx)(d.FormattedMessage,{id:"xpack.ml.jobSelector.noJobsFoundTitle",defaultMessage:"No anomaly detection jobs found"}),iconType:"iInCircle"},Object(r.jsx)(n.EuiText,{textAlign:"center"},Object(r.jsx)(n.EuiButton,{color:"primary",onClick:async()=>{await w(j.g,{path:p.b.ANOMALY_DETECTION_CREATE_JOB})},disabled:!1===F.canCreateJob||!1===E},Object(r.jsx)(d.FormattedMessage,{id:"xpack.ml.jobSelector.createJobButtonLabel",defaultMessage:"Create job"})))),0!==a.length&&!0===h&&_(),0!==a.length&&!h&&Object(r.jsx)(n.EuiTabbedContent,{size:"s",tabs:I,initialSelectedTab:I[0],onTabClick:e=>{S(e.id)}}))}var y=a(39),O=a.n(y),v=a(145),T=a.n(v);function E(e){const t={},a={};return e.forEach((e=>{void 0!==e.groups&&e.groups.forEach((l=>{void 0===t[l]?(t[l]={id:l,jobIds:[e.job_id],timeRange:{to:e.timeRange.to,toMoment:null,from:e.timeRange.from,fromMoment:null,fromPx:e.timeRange.fromPx,toPx:e.timeRange.toPx,widthPx:null}},a[l]=[e.job_id]):(t[l].jobIds.push(e.job_id),a[l].push(e.job_id),(null===t[l].timeRange.to||e.timeRange.to>t[l].timeRange.to)&&(t[l].timeRange.to=e.timeRange.to,t[l].timeRange.toMoment=e.timeRange.toMoment),(null===t[l].timeRange.from||e.timeRange.from<t[l].timeRange.from)&&(t[l].timeRange.from=e.timeRange.from,t[l].timeRange.fromMoment=e.timeRange.fromMoment),(null===t[l].timeRange.toPx||e.timeRange.toPx>t[l].timeRange.toPx)&&(t[l].timeRange.toPx=e.timeRange.toPx),(null===t[l].timeRange.fromPx||e.timeRange.fromPx<t[l].timeRange.fromPx)&&(t[l].timeRange.fromPx=e.timeRange.fromPx))}))})),Object.keys(t).forEach((e=>{const a=t[e];a.timeRange.widthPx=a.timeRange.toPx-a.timeRange.fromPx,a.timeRange.toMoment=O()(a.timeRange.to),a.timeRange.fromMoment=O()(a.timeRange.from);const l=a.timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),i=a.timeRange.toMoment.format("MMM Do YYYY, HH:mm");a.timeRange.label=s.i18n.translate("xpack.ml.jobSelectList.groupTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:l,toString:i}})})),{groups:Object.keys(t).map((e=>t[e])),groupsMap:a}}function k(e,t,a){const l=e.filter((e=>void 0!==e.timeRange.to&&void 0!==e.timeRange.from)),i=Math.min(...l.map((e=>+e.timeRange.from))),n=Math.max(...l.map((e=>+e.timeRange.to))),o=T.a.scale.linear().domain([i,n]).range([1,a]);return e.forEach((e=>{if(void 0!==e.timeRange.to&&void 0!==e.timeRange.from){e.timeRange.fromPx=o(e.timeRange.from),e.timeRange.toPx=o(e.timeRange.to),e.timeRange.widthPx=e.timeRange.toPx-e.timeRange.fromPx,e.timeRange.widthPx<1&&(e.timeRange.widthPx=1),e.timeRange.toMoment=O()(e.timeRange.to).tz(t),e.timeRange.fromMoment=O()(e.timeRange.from).tz(t);const a=e.timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),l=e.timeRange.toMoment.format("MMM Do YYYY, HH:mm");e.timeRange.label=s.i18n.translate("xpack.ml.jobSelector.jobTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:a,toString:l}})}else e.timeRange.widthPx=0,e.timeRange.fromPx=0,e.timeRange.toPx=0,e.timeRange.label=s.i18n.translate("xpack.ml.jobSelector.noResultsForJobLabel",{defaultMessage:"No results"})})),e}const M=10,S=({dateFormatTz:e,selectedIds:t=[],singleSelection:a,timeseriesOnly:o,onJobsFetched:u,onSelectionConfirmed:m,onFlyoutClose:d,maps:p,applyTimeRangeConfig:j,onTimeRangeConfigChange:g,withTimeRangeSelector:x=!0})=>{const{services:{notifications:f,mlServices:{mlApiServices:y}}}=Object(b.d)(),[v,S]=Object(l.useState)(t),[w,F]=Object(l.useState)(!0),[I,_]=Object(l.useState)(!1),[C,D]=Object(l.useState)([]),[R,A]=Object(l.useState)([]),[L,N]=Object(l.useState)(299),[B,z]=Object(l.useState)(p),P=Object(l.useRef)(null),V=Object(l.useCallback)((()=>{const e=[],t=[];v.forEach((a=>{void 0!==B.groupsMap[a]?(e.push(...B.groupsMap[a]),t.push({groupId:a,jobIds:B.groupsMap[a]})):e.push(a)}));const a=Array.from(new Set(e)),l=j?function(e,t){if(e.length>0){const a=[];if(e.forEach((e=>{t.includes(e.job_id)&&(void 0!==e.timeRange.from&&a.push(e.timeRange.from),void 0!==e.timeRange.to&&a.push(e.timeRange.to))})),a.length){const e=T.a.extent(a);return{from:O()(e[0]).toISOString(),to:O()(e[1]).toISOString()}}}}(C,a):void 0;m({newSelection:a,jobIds:a,groups:t,time:l})}),[m,v,B,j]);function J(e){S(v.filter((t=>t!==e)))}function G(){g&&g(!j)}function H(){S([])}function $({selectionFromTable:e}){S(e)}const Y=Object(l.useCallback)((()=>{if(0===C.length||!P.current)return;const t=P.current.querySelectorAll("table thead th"),a=t[t.length-1].offsetWidth-16,l=k(C,e,a);D(l);const{groups:i}=E(l);A(i),N(a)}),[e,C]);return Object(l.useEffect)((()=>{!async function(){try{const t=await y.jobs.jobsWithTimerange(e),a=k(t.jobs,e,299),{groups:l,groupsMap:i}=E(a);D(a),A(l),z({groupsMap:i,jobsMap:t.jobsMap}),u&&u({groupsMap:i,jobsMap:t.jobsMap})}catch(e){console.error("Error fetching jobs with time range",e);const{toasts:t}=f;t.addDanger({title:s.i18n.translate("xpack.ml.jobSelector.jobFetchErrorMessage",{defaultMessage:"An error occurred fetching jobs. Refresh and try again."})})}F(!1)}()}),[]),Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(r.jsx)(n.EuiTitle,{size:"m"},Object(r.jsx)("h2",{id:"flyoutTitle"},s.i18n.translate("xpack.ml.jobSelector.flyoutTitle",{defaultMessage:"Job selection"})))),Object(r.jsx)(n.EuiFlyoutBody,{className:"mlJobSelectorFlyoutBody","data-test-subj":"mlJobSelectorFlyoutBody"},Object(r.jsx)(n.EuiResizeObserver,{onResize:Y},(e=>Object(r.jsx)("div",{ref:t=>{P.current=t,e(t)}},w?Object(r.jsx)(n.EuiProgress,{size:"xs",color:"accent"}):Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(n.EuiFlexGroup,{direction:"column",responsive:!1},Object(r.jsx)(n.EuiFlexItem,{grow:!1},Object(r.jsx)(n.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs",alignItems:"center"},Object(r.jsx)(c,{limit:M,maps:B,newSelection:v,onDeleteClick:J,onLinkClick:()=>_(!I),showAllBadges:I}))),Object(r.jsx)(n.EuiFlexItem,{grow:!1},Object(r.jsx)(n.EuiFlexGroup,{direction:"row",justifyContent:"spaceBetween",responsive:!1},Object(r.jsx)(n.EuiFlexItem,{grow:!1},!a&&v.length>0&&Object(r.jsx)(n.EuiButtonEmpty,{onClick:H,size:"xs","data-test-subj":"mlFlyoutJobSelectorButtonClearSelection"},s.i18n.translate("xpack.ml.jobSelector.clearAllFlyoutButton",{defaultMessage:"Clear all"}))),x&&void 0!==j&&Object(r.jsx)(n.EuiFlexItem,{grow:!1},Object(r.jsx)(n.EuiSwitch,{label:s.i18n.translate("xpack.ml.jobSelector.applyTimerangeSwitchLabel",{defaultMessage:"Apply time range"}),checked:j,onChange:G,"data-test-subj":"mlFlyoutJobSelectorSwitchApplyTimeRange"}))))),Object(r.jsx)(h,{jobs:C,ganttBarWidth:L,groupsList:R,onSelection:$,selectedIds:v,singleSelection:a,timeseriesOnly:o,withTimeRangeSelector:x})))))),Object(r.jsx)(n.EuiFlyoutFooter,null,Object(r.jsx)(n.EuiFlexGroup,null,Object(r.jsx)(n.EuiFlexItem,{grow:!1},Object(r.jsx)(n.EuiButton,{onClick:V,fill:!0,isDisabled:0===v.length,"data-test-subj":"mlFlyoutJobSelectorButtonApply"},s.i18n.translate("xpack.ml.jobSelector.applyFlyoutButton",{defaultMessage:"Apply"}))),Object(r.jsx)(n.EuiFlexItem,{grow:!1},Object(r.jsx)(n.EuiButtonEmpty,{iconType:"cross",onClick:d,"data-test-subj":"mlFlyoutJobSelectorButtonClose"},s.i18n.translate("xpack.ml.jobSelector.closeFlyoutButton",{defaultMessage:"Close"}))))))}},493:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return c})),a(406);var l=a(2),i=a.n(l),s=a(15),n=a(25),o=a(6);const r=()=>Object(o.jsx)(n.EuiEmptyPrompt,{iconType:"warning",title:Object(o.jsx)("h2",null,Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.explorer.noJobSelectedLabel",defaultMessage:"No jobs selected"})),"data-test-subj":"mlNoJobsFound"}),c=({hasResults:e,selectedJobsRunning:t})=>{const a=!0===e,l=!1===e;return Object(o.jsx)(n.EuiEmptyPrompt,{iconType:"iInCircle",title:Object(o.jsx)("h2",null,a&&Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.explorer.noAnomaliesFoundLabel",defaultMessage:"No anomalies found"}),l&&Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.explorer.noResultsFoundLabel",defaultMessage:"No results found"})),body:Object(o.jsx)(i.a.Fragment,null,t&&l&&Object(o.jsx)("p",null,Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.explorer.selectedJobsRunningLabel",defaultMessage:"One or more selected jobs are still running and results may not be available yet."})),!t&&Object(o.jsx)("p",null,Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.explorer.tryWideningTimeSelectionLabel",defaultMessage:"Try widening the time selection or moving further back in time"})))})}},503:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var l=a(2),i=a(25),s=a(5),n=a(68),o=a(10),r=a(1),c=a(6);const u=({viewId:e,selectedJobs:t})=>{const a=Object(l.useRef)(!1),u=Object(o.g)(),m=Object(o.h)(),d=0===(null!=t?t:[]).filter((e=>e.isSingleMetricViewerJob)).length,b=Object(l.useMemo)((()=>{var a;return[{id:"timeseriesexplorer",label:"explorer"===e&&d?s.i18n.translate("xpack.ml.anomalyResultsViewSelector.singleMetricViewerDisabledLabel",{defaultMessage:"Selected {jobsCount, plural, one {job is} other {jobs are}} not viewable in the Single Metric Viewer",values:{jobsCount:null!==(a=null==t?void 0:t.length)&&void 0!==a?a:0}}):s.i18n.translate("xpack.ml.anomalyResultsViewSelector.singleMetricViewerLabel",{defaultMessage:"View results in the Single Metric Viewer"}),iconType:"visLine",value:r.b.SINGLE_METRIC_VIEWER,"data-test-subj":"mlAnomalyResultsViewSelectorSingleMetricViewer",isDisabled:"explorer"===e&&d},{id:"explorer",label:s.i18n.translate("xpack.ml.anomalyResultsViewSelector.anomalyExplorerLabel",{defaultMessage:"View results in the Anomaly Explorer"}),iconType:"visTable",value:r.b.ANOMALY_EXPLORER,"data-test-subj":"mlAnomalyResultsViewSelectorExplorer"}]}),[d,null==t?void 0:t.length]),[p]=Object(n.d)("_g");return Object(l.useEffect)((()=>(a.current=!0,()=>{a.current=!1})),[]),Object(c.jsx)(i.EuiButtonGroup,{legend:s.i18n.translate("xpack.ml.anomalyResultsViewSelector.buttonGroupLegend",{defaultMessage:"Anomaly results view selector"}),name:"anomalyResultsViewSelector","data-test-subj":"mlAnomalyResultsViewSelector",options:b,idSelected:e,onChange:e=>(async e=>{if(a.current){const t=await u.getUrl({page:e,pageState:{globalState:p}});await m(t)}})(e),isIconOnly:!0})}},504:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var l=a(2),i=a(39),s=a.n(i),n=a(21),o=a(10),r=a(492),c=a(6);const u=({selectedIds:e,withTimeRangeSelector:t,dateFormatTz:a,singleSelection:i,timeseriesOnly:s,onFlyoutClose:n,onSelectionConfirmed:o,maps:u})=>{const[m,d]=Object(l.useState)(!0);return Object(c.jsx)(r.b,{selectedIds:e,withTimeRangeSelector:t,dateFormatTz:a,singleSelection:i,timeseriesOnly:s,onFlyoutClose:n,onSelectionConfirmed:o,onTimeRangeConfigChange:d,applyTimeRangeConfig:m,maps:u})};var m=a(391);function d(){const{overlays:e,services:t}=Object(o.d)(),a=Object(l.useRef)();return Object(l.useEffect)((function(){return()=>{a.current&&a.current.close()}}),[]),Object(l.useCallback)(((l={singleSelection:!1,withTimeRangeSelector:!0,timeseriesOnly:!1})=>{const{uiSettings:i}=t,o=i.get("dateFormat:tz"),r="Browser"!==o?o:s.a.tz.guess(),d={groupsMap:Object(m.b)([]),jobsMap:{}};return new Promise((async(i,s)=>{try{a.current=e.openFlyout(Object(c.jsx)(n.KibanaContextProvider,{services:t},Object(c.jsx)(u,{selectedIds:[],withTimeRangeSelector:l.withTimeRangeSelector,dateFormatTz:r,singleSelection:!!l.singleSelection,timeseriesOnly:!!l.timeseriesOnly,onFlyoutClose:()=>{s(),a.current.close()},onSelectionConfirmed:e=>{i(e),a.current.close()},maps:d})))}catch(e){s(e)}}))}),[e,t])}},767:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(768);case"v8light":return a(770)}},768:function(e,t,a){var l=a(126),i=a(769);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);l(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},769:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}",""]),e.exports=t},770:function(e,t,a){var l=a(126),i=a(771);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);l(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},771:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlJobSelectorFlyoutBody>.euiFlyoutBody__overflow{padding-top:8px}.mlJobSelector__ganttBar{background-color:#79adda;border-radius:2px;height:12px}.mlJobSelector__ganttBarBackEdge{border-left:1px solid #d6d6d6;border-right:1px solid #d6d6d6;height:16px;margin-bottom:-14px;padding-top:8px}.mlJobSelector__ganttBarDashed{border-top:1px dashed #d6d6d6;height:1px}.mlJobSelector__ganttBarRunning{animation:progress-bar-stripes 2s linear infinite;background-image:linear-gradient(45deg,#ffffff26 25%,#0000 0,#0000 50%,#ffffff26 0,#ffffff26 75%,#0000 0,#0000);background-size:40px 40px}",""]),e.exports=t},843:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var l=a(140),i=a(173);function s(e){return e>=l.a.CRITICAL?i.a.critical:e>=l.a.MAJOR?i.a.major:e>=l.a.MINOR?i.a.minor:e>=l.a.LOW?i.a.warning:i.a.unknown}}}]);