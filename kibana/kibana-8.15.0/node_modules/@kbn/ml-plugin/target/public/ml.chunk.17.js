/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[17],{138:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i(2);t.default=function(){var e=s.useRef(!1),t=s.useCallback((function(){return e.current}),[]);return s.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},184:function(e,t,i){"use strict";i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return p})),i.d(t,"a",(function(){return b})),i.d(t,"d",(function(){return m})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return E}));var s=i(8),o=i(39),n=i.n(o),a=i(31),l=i.n(a),r=i(40),c=i(135);const u="auto";function d(e,t,i){const s=e.url_value,o={...t};return s.includes("$earliest$")&&void 0!==i&&(o.earliest=i.from),s.includes("$latest$")&&void 0!==i&&(o.latest=i.to),b(e,o)}function p(e,t,i,s){const o=e.url_value,a=i[s],l="time_range"in e&&e.time_range?Object(r.a)(e.time_range):null,c={...i};if(o.includes("$earliest$")){const e=n()(a);null!==l?e.subtract(l):e.subtract(t,"s"),c.earliest=e.toISOString()}if(o.includes("$latest$")){const e=n()(a).add(t,"s");null!==l?e.add(l):e.add(t,"s"),c.latest=e.toISOString()}return b(e,c)}function b(e,t){return!0===j(e)?function(e,t){const i=e.url_value,o=i.includes("language:lucene"),n=o?c.c:x,a=Object(s.flow)(encodeURIComponent),r=e=>{const i=Object(s.flow)(o?e=>e:n,a);return e.replace(/\$([^?&$\'"]+)\$(\/)?/g,((e,o,n="")=>{let a=Object(s.get)(t,o);return a=Array.isArray(a)?a[0]:a,void 0===a?"":i(a)+n}))};return Object(s.flow)(decodeURIComponent,(e=>e.replace("$earliest$",t.earliest).replace("$latest$",t.latest)),(e=>{const i=Object(s.flow)(n,a),o=f(t,i),c=e.match(/(.+)(\(.*\blanguage:(?:lucene|kuery)\b.*?\))(.+)/);if(null!==c&&void 0!==c[2]){const[,e,t,i]=c,s=t.indexOf("language:kuery")>-1,n=l.a.decode(t);if(g(n)&&n.hasOwnProperty("query")){const[t,a]=[e,i].map(r),c=o(t,n.query,a,s);return`${t}${l.a.encode({...n,query:c})}${a}`}}return e.replace(/(.+&kuery=)(.*?)[^!](&.+)/,((t,i,s,n)=>{const[a,l]=[i,n].map(r);return`${a}${o(a,s,l,e.indexOf("language:kuery")>-1)}${l}`}))}),r)(i)}(e,t):Object(c.g)(e.url_value,t,!1)}function m(e,t,i){if(!1===/^(?:[a-z]+:)?\/\//i.test(t.url_value))"/"!==e.charAt(0)&&(e=`${i}${j(t)?"/app/":"/"}${e}`),window.open(e,"_blank");else{const t=window.open(e,"_blank","noopener,noreferrer");null!=t&&(t.opener=null)}}function j(e){const t=e.url_value;return t.startsWith("discover#/")||t.startsWith("dashboards#/")||t.startsWith("apm#/")||t.startsWith("metrics/")||t.startsWith("security/")||t.startsWith("siem#/")}function x(e){return String(e).replace(/\"/g,'\\"')}const g=e=>null!==e&&"object"==typeof e,f=(e,t)=>(i,o,n,a)=>{let l=2e3-i.length-n.length;const r=o.split(/\sand\s/i).map((e=>(e=>{let t="";for(let i=0;i<e.length;i++)if("$"===e[i]){let s=i;for(let t=s;t>-1;t--)if(":"===e[t]){s=t;break}t=e.slice(0,s).trim();let o=e.slice(s,e.length);const n=o.indexOf("$"),a=o.lastIndexOf("$");if(o=o.slice(n,a+1),o===`$${t}$`)break}return t})(String(e).replace(/\\/g,"")))),u=[];e:for(let i=0;i<r.length;i++){const o=r[i],n=a?`"${r[i]}"`:Object(c.c)(o);let d=Object(s.get)(e,o)||null;if(null===d)continue;d=Array.isArray(d)?d:[d];let p="";for(let e=0;e<d.length;e++){const i=`${e>0?" OR ":""}${n}:"${t(d[e])}"`;if(l<i.length){p.length>0&&u.push(e>0?`(${p})`:p);break e}p+=i,l-=p.length}p.length>0&&u.push(d.length>1?`(${p})`:p)}return u.join(" AND ")};function h(e,t){let i=void 0!==e&&e.trim().length>0;return!0===i&&void 0!==t&&(i=!t.map((e=>e.url_name)).includes(e)),i}function E(e){return void 0===e||0===e.length||e===u||null!==Object(r.a)(e)}},197:function(e,t,i){"use strict";i.d(t,"d",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a}));let s=function(e){return e.ANNOTATION="annotation",e.COMMENT="comment",e}({});const o=1e3,n="user",a="delayed_data"},212:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i(2),o=i(5),n=i(25),a=(i(368),i(6));const l=({onClick:e})=>Object(a.jsx)(n.EuiButtonIcon,{className:"mlHelpPopover__buttonIcon",size:"s",iconType:"help","aria-label":o.i18n.translate("xpack.ml.helpPopover.ariaLabel",{defaultMessage:"Help"}),onClick:e}),r=({anchorPosition:e,children:t,title:i})=>{const[o,r]=Object(s.useState)(!1);return Object(a.jsx)(n.EuiPopover,{anchorPosition:e,button:Object(a.jsx)(l,{onClick:r.bind(null,!o)}),className:"mlHelpPopover",closePopover:r.bind(null,!1),isOpen:o,ownFocus:!0,panelClassName:"mlHelpPopover__panel",panelPaddingSize:"none"},i&&Object(a.jsx)(n.EuiPopoverTitle,{paddingSize:"s"},i),Object(a.jsx)(n.EuiText,{className:"mlHelpPopover__content eui-scrollBar",size:"s",tabIndex:0},t))}},262:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i(7);const o={rowMouseenter$:new s.Subject,rowMouseleave$:new s.Subject}},368:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(369);case"v8light":return i(371)}},369:function(e,t,i){var s=i(126),o=i(370);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);s(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},370:function(e,t,i){(t=i(127)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},371:function(e,t,i){var s=i(126),o=i(372);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);s(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},372:function(e,t,i){(t=i(127)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},388:function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var s=i(4),o=i.n(s),n=i(2),a=i.n(n),l=i(25),r=i(5),c=i(15),u=i(21),d=i(181),p=i(194),b=i(6);function m({job:e,detector:t,anomaly:i}){const s=[{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.jobIdTitle",defaultMessage:"Job ID"}),description:e.job_id},{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.detectorTitle",defaultMessage:"Detector"}),description:t.detector_description}];if(void 0!==i.actual){const e=Object(p.b)(i.actual,i.source.function),t=Object(p.b)(i.typical,i.source.function);s.push({title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyTitle",defaultMessage:"Selected anomaly"}),description:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyDescription",defaultMessage:"actual {actual}, typical {typical}",values:{actual:e,typical:t}})})}return Object(b.jsx)(l.EuiDescriptionList,{className:"rule-detector-description-list",type:"column",columnWidths:[15,85],listItems:s})}function j({actions:e,onSkipResultChange:t,onSkipModelUpdateChange:i}){return Object(b.jsx)(a.a.Fragment,null,Object(b.jsx)(l.EuiText,null,Object(b.jsx)("p",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.chooseActionsDescription",defaultMessage:"Choose the actions to take when the job rule matches an anomaly."}))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiCheckbox,{id:"skip_result_cb",label:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.skipResultLabel",defaultMessage:"Skip result (recommended)"}),checked:e.indexOf(d.a.SKIP_RESULT)>-1,onChange:t})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiIconTip,{content:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.resultWillNotBeCreatedTooltip",defaultMessage:"The result will not be created."}),size:"s",position:"right"}))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiCheckbox,{id:"skip_model_update_cb",label:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.skipModelUpdateLabel",defaultMessage:"Skip model update"}),checked:e.indexOf(d.a.SKIP_MODEL_UPDATE)>-1,onChange:i})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiIconTip,{content:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.actionsSection.valueWillNotBeUsedToUpdateModelTooltip",defaultMessage:"The value for that series will not be used to update the model."}),size:"s",position:"right"}))))}var x=i(70),g=i(8),f=i(73),h=i(123);function E(){return{applies_to:d.b.ACTUAL,operator:d.e.LESS_THAN,value:1}}function O(){return{actions:[d.a.SKIP_RESULT],conditions:[]}}function v(e){let t=!1;if(e.actions.length>0){const i=e.conditions;if(void 0!==i&&i.length>0)t=!0;else{const i=e.scope;void 0!==i&&(t=Object.keys(i).some((e=>!0===i[e].enabled)))}}return t}function y(e,t,i,s,o){const n=e.job_id,a={detectors:[{detector_index:t,custom_rules:i}]};let l={};return void 0!==e.custom_settings&&(l={...e.custom_settings},Object(h.t)(l),a.custom_settings=l),new Promise(((e,t)=>{s.updateJob({jobId:n,job:a}).then((()=>{o.refreshJob(n).then((()=>{e({success:!0})})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))}))}function k(e){const{actions:t,conditions:i,scope:s}=e;let o="",n="",a="";return t.forEach(((e,t)=>{switch(t>0&&(o+=" AND "),e){case d.a.SKIP_RESULT:o+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.resultActionTypeText",{defaultMessage:"result",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText +xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"});break;case d.a.SKIP_MODEL_UPDATE:o+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.modelUpdateActionTypeText",{defaultMessage:"model update",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})}})),void 0!==i&&i.forEach(((e,t)=>{t>0&&(n+=" AND "),n+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.conditionsText",{defaultMessage:"{appliesTo} is {operator} {value}",values:{appliesTo:T(e.applies_to),operator:M(e.operator),value:e.value},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})})),void 0!==s&&(void 0!==i&&i.length>0&&(a+=" AND "),Object.keys(s).forEach(((e,t)=>{t>0&&(a+=" AND ");const i=s[e];a+=r.i18n.translate("xpack.ml.ruleEditor.ruleDescription.filtersText",{defaultMessage:"{fieldName} is {filterType} {filterId}",values:{fieldName:e,filterType:_(i.filter_type),filterId:i.filter_id},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})}))),r.i18n.translate("xpack.ml.ruleEditor.ruleDescription",{defaultMessage:"skip {actions} when {conditions}{filters}",values:{actions:o,conditions:n,filters:a},description:"Composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText. (Example: skip model update when actual is less than 1 AND ip is in xxx)"})}function _(e){switch(e){case d.d.INCLUDE:return r.i18n.translate("xpack.ml.ruleEditor.includeFilterTypeText",{defaultMessage:"in"});case d.d.EXCLUDE:return r.i18n.translate("xpack.ml.ruleEditor.excludeFilterTypeText",{defaultMessage:"not in"});default:return void 0!==e?e:""}}function T(e){switch(e){case d.b.ACTUAL:return r.i18n.translate("xpack.ml.ruleEditor.actualAppliesTypeText",{defaultMessage:"actual"});case d.b.TYPICAL:return r.i18n.translate("xpack.ml.ruleEditor.typicalAppliesTypeText",{defaultMessage:"typical"});case d.b.DIFF_FROM_TYPICAL:return r.i18n.translate("xpack.ml.ruleEditor.diffFromTypicalAppliesTypeText",{defaultMessage:"diff from typical"});default:return void 0!==e?e:""}}function M(e){switch(e){case d.e.LESS_THAN:return r.i18n.translate("xpack.ml.ruleEditor.lessThanOperatorTypeText",{defaultMessage:"less than"});case d.e.LESS_THAN_OR_EQUAL:return r.i18n.translate("xpack.ml.ruleEditor.lessThanOrEqualToOperatorTypeText",{defaultMessage:"less than or equal to"});case d.e.GREATER_THAN:return r.i18n.translate("xpack.ml.ruleEditor.greaterThanOperatorTypeText",{defaultMessage:"greater than"});case d.e.GREATER_THAN_OR_EQUAL:return r.i18n.translate("xpack.ml.ruleEditor.greaterThanOrEqualToOperatorTypeText",{defaultMessage:"greater than or equal to"});default:return void 0!==e?e:""}}class condition_expression_ConditionExpression extends n.Component{constructor(e){super(e),o()(this,"openAppliesTo",(()=>{this.setState({isAppliesToOpen:!0,isOperatorValueOpen:!1})})),o()(this,"closeAppliesTo",(()=>{this.setState({isAppliesToOpen:!1})})),o()(this,"openOperatorValue",(()=>{this.setState({isAppliesToOpen:!1,isOperatorValueOpen:!0})})),o()(this,"closeOperatorValue",(()=>{this.setState({isOperatorValueOpen:!1})})),o()(this,"changeAppliesTo",(e=>{const{index:t,operator:i,value:s,updateCondition:o}=this.props;o(t,e.target.value,i,s)})),o()(this,"changeOperator",(e=>{const{index:t,appliesTo:i,value:s,updateCondition:o}=this.props;o(t,i,e.target.value,s)})),o()(this,"changeValue",(e=>{const{index:t,appliesTo:i,operator:s,updateCondition:o}=this.props;o(t,i,s,+e.target.value)})),this.state={isAppliesToOpen:!1,isOperatorValueOpen:!1}}renderAppliesToPopover(){return Object(b.jsx)("div",null,Object(b.jsx)(l.EuiPopoverTitle,null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.appliesToPopoverTitle",defaultMessage:"When"})),Object(b.jsx)("div",{className:"euiExpression",style:{width:200}},Object(b.jsx)(l.EuiSelect,{value:this.props.appliesTo,onChange:this.changeAppliesTo,options:[{value:d.b.ACTUAL,text:T(d.b.ACTUAL)},{value:d.b.TYPICAL,text:T(d.b.TYPICAL)},{value:d.b.DIFF_FROM_TYPICAL,text:T(d.b.DIFF_FROM_TYPICAL)}]})))}renderOperatorValuePopover(){return Object(b.jsx)("div",null,Object(b.jsx)(l.EuiPopoverTitle,null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.operatorValuePopoverTitle",defaultMessage:"Is"})),Object(b.jsx)("div",{className:"euiExpression"},Object(b.jsx)(l.EuiFlexGroup,{style:{maxWidth:450}},Object(b.jsx)(l.EuiFlexItem,{grow:!1,style:{width:250}},Object(b.jsx)(l.EuiSelect,{value:this.props.operator,onChange:this.changeOperator,options:[{value:d.e.LESS_THAN,text:M(d.e.LESS_THAN)},{value:d.e.LESS_THAN_OR_EQUAL,text:M(d.e.LESS_THAN_OR_EQUAL)},{value:d.e.GREATER_THAN,text:M(d.e.GREATER_THAN)},{value:d.e.GREATER_THAN_OR_EQUAL,text:M(d.e.GREATER_THAN_OR_EQUAL)}]})),Object(b.jsx)(l.EuiFlexItem,{grow:!1,style:{width:200}},Object(b.jsx)(l.EuiFieldNumber,{value:+this.props.value,onChange:this.changeValue})))))}render(){const{index:e,appliesTo:t,operator:i,value:s,deleteCondition:o}=this.props;return Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"m"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiPopover,{id:"appliesToPopover",button:Object(b.jsx)(l.EuiExpression,{description:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.appliesToButtonLabel",defaultMessage:"when"}),value:T(t),isActive:this.state.isAppliesToOpen,onClick:this.openAppliesTo}),isOpen:this.state.isAppliesToOpen,closePopover:this.closeAppliesTo,panelPaddingSize:"s",ownFocus:!0,anchorPosition:"downLeft"},this.renderAppliesToPopover())),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiPopover,{id:"operatorValuePopover",button:Object(b.jsx)(l.EuiExpression,{description:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionExpression.operatorValueButtonLabel",defaultMessage:"is {operator}",values:{operator:M(i)}}),value:`${s}`,isActive:this.state.isOperatorValueOpen,onClick:this.openOperatorValue}),isOpen:this.state.isOperatorValueOpen,closePopover:this.closeOperatorValue,panelPaddingSize:"s",ownFocus:!0,withTitle:!0,anchorPosition:"downLeft"},this.renderOperatorValuePopover())),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonIcon,{size:"s",color:"danger",onClick:()=>o(e),iconType:"trash","aria-label":r.i18n.translate("xpack.ml.ruleEditor.conditionExpression.deleteConditionButtonAriaLabel",{defaultMessage:"Delete condition"})})))}}function I({isEnabled:e,conditions:t,addCondition:i,updateCondition:s,deleteCondition:o}){if(!1===e)return null;let n=[];return void 0!==t&&(n=t.map(((e,t)=>Object(b.jsx)(condition_expression_ConditionExpression,{key:t,index:t,appliesTo:e.applies_to,operator:e.operator,value:e.value,updateCondition:s,deleteCondition:o})))),Object(b.jsx)(a.a.Fragment,null,n,Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiButtonEmpty,{onClick:()=>i()},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.conditionsSection.addNewConditionButtonLabel",defaultMessage:"Add new condition"})))}function F(e){return e.map((e=>({value:e,text:e})))}class scope_expression_ScopeExpression extends n.Component{constructor(e){super(e),o()(this,"openFilterList",(()=>{this.setState({isFilterListOpen:!0})})),o()(this,"closeFilterList",(()=>{this.setState({isFilterListOpen:!1})})),o()(this,"onChangeFilterType",(e=>{const{fieldName:t,filterId:i,enabled:s,updateScope:o}=this.props;o(t,i,e.target.value,s)})),o()(this,"onChangeFilterId",(e=>{const{fieldName:t,filterType:i,enabled:s,updateScope:o}=this.props;o(t,e.target.value,i,s)})),o()(this,"onEnableChange",(e=>{const{fieldName:t,filterId:i,filterType:s,updateScope:o}=this.props;o(t,i,s,e.target.checked)})),this.state={isFilterListOpen:!1}}renderFilterListPopover(){const{filterId:e,filterType:t,filterListIds:i}=this.props;return Object(b.jsx)("div",null,Object(b.jsx)(l.EuiPopoverTitle,null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypePopoverTitle",defaultMessage:"Is"})),Object(b.jsx)("div",{className:"euiExpression"},Object(b.jsx)(l.EuiFlexGroup,{style:{maxWidth:450}},Object(b.jsx)(l.EuiFlexItem,{grow:!1,style:{width:150}},Object(b.jsx)(l.EuiSelect,{value:t,onChange:this.onChangeFilterType,options:[{value:d.d.INCLUDE,text:_(d.d.INCLUDE)},{value:d.d.EXCLUDE,text:_(d.d.EXCLUDE)}]})),Object(b.jsx)(l.EuiFlexItem,{grow:!1,style:{width:300}},Object(b.jsx)(l.EuiSelect,{value:e,onChange:this.onChangeFilterId,options:F(i)})))))}render(){const{fieldName:e,filterId:t,filterType:i,enabled:s,filterListIds:o}=this.props;return Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"m"},Object(b.jsx)(l.EuiFlexItem,{grow:!1,className:"scope-field-checkbox"},Object(b.jsx)(l.EuiCheckbox,{id:`scope_cb_${e}`,checked:s,onChange:this.onEnableChange})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiExpression,{className:"scope-field-button",description:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFieldWhenLabel",defaultMessage:"when"}),value:e,isActive:!1,onClick:e=>e.preventDefault()})),void 0!==o&&o.length>0&&Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiPopover,{id:"operatorValuePopover",button:Object(b.jsx)(l.EuiExpression,{description:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypeButtonLabel",defaultMessage:"is {filterType}",values:{filterType:_(i)}}),value:t||"",isActive:this.state.isFilterListOpen,onClick:this.openFilterList}),isOpen:this.state.isFilterListOpen,closePopover:this.closeFilterList,panelPaddingSize:"s",ownFocus:!0,anchorPosition:"downLeft"},this.renderFilterListPopover())))}}var S=i(1),A=i(10);function w(){const e=Object(A.g)(),t=Object(A.h)();return Object(b.jsx)(l.EuiCallOut,{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.noFilterListsConfiguredTitle",defaultMessage:"No filter lists configured"}),iconType:"gear"},Object(b.jsx)("p",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription",defaultMessage:"To configure scope, you must first use the {filterListsLink} settings page to create the list of values you want to include or exclude in the job rule.",values:{filterListsLink:Object(b.jsx)(l.EuiLink,{onClick:async()=>{const i=await e.getUrl({page:S.b.FILTER_LISTS_MANAGE});await t(i,!0)}},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription.filterListsLinkText",defaultMessage:"Filter Lists"}))}})))}function C(){return Object(b.jsx)(l.EuiCallOut,{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.noPermissionToViewFilterListsTitle",defaultMessage:"You do not have permission to view filter lists"}),iconType:"gear"})}function L({isEnabled:e,onEnabledChange:t,partitioningFieldNames:i,filterListIds:s,scope:o,updateScope:n}){const r=Object(x.checkPermission)("canGetFilters");if(null===i||0===i.length)return null;let u;return u=s.length>0?i.map(((e,t)=>{let i;return i=void 0!==o&&void 0!==o[e]?o[e]:function(e){const t={filter_type:d.d.INCLUDE,enabled:!1};return void 0!==e&&e.length>0&&(t.filter_id=e[0]),t}(s),Object(b.jsx)(scope_expression_ScopeExpression,{key:t,fieldName:e,filterId:i.filter_id,filterType:i.filter_type,enabled:i.enabled,filterListIds:s,updateScope:n})})):!1===r?Object(b.jsx)(C,null):Object(b.jsx)(w,null),Object(b.jsx)(a.a.Fragment,null,Object(b.jsx)(l.EuiTitle,null,Object(b.jsx)("h2",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.scopeTitle",defaultMessage:"Scope"}))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiCheckbox,{id:"enable_scope_checkbox",label:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.scopeSection.addFilterListLabel",defaultMessage:"Add a filter list to limit where the job rule applies."}),checked:e,onChange:t}),Object(b.jsx)(l.EuiSpacer,{size:"s"}),e&&Object(b.jsx)(a.a.Fragment,null,u),Object(b.jsx)(l.EuiSpacer,{size:"xxl"}))}function R({fieldValue:e,filterId:t,addItemToFilterList:i}){return Object(b.jsx)(l.EuiLink,{onClick:()=>i(e,t,!0)},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.addValueToFilterListLinkText",defaultMessage:"Add {fieldValue} to {filterId}",values:{fieldValue:e,filterId:t}}))}class delete_rule_modal_DeleteRuleModal extends n.Component{constructor(e){super(e),o()(this,"deleteRule",(()=>{const{ruleIndex:e,deleteRuleAtIndex:t}=this.props;t(e),this.closeModal()})),o()(this,"closeModal",(()=>{this.setState({isModalVisible:!1})})),o()(this,"showModal",(()=>{this.setState({isModalVisible:!0})})),this.state={isModalVisible:!1}}render(){let e;return this.state.isModalVisible&&(e=Object(b.jsx)(l.EuiConfirmModal,{title:r.i18n.translate("xpack.ml.ruleEditor.deleteRuleModal.deleteRuleTitle",{defaultMessage:"Delete rule?"}),onCancel:this.closeModal,onConfirm:this.deleteRule,buttonColor:"danger",cancelButtonText:r.i18n.translate("xpack.ml.ruleEditor.deleteRuleModal.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.ml.ruleEditor.deleteRuleModal.deleteButtonLabel",{defaultMessage:"Delete"}),defaultFocusedButton:l.EUI_MODAL_CONFIRM_BUTTON})),Object(b.jsx)(a.a.Fragment,null,Object(b.jsx)(l.EuiLink,{color:"danger",onClick:()=>this.showModal()},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteRuleLinkText",defaultMessage:"Delete rule"})),e)}}class edit_condition_link_EditConditionLink extends n.Component{constructor(e){super(e),o()(this,"onChangeValue",(e=>{const t=e.target.value;this.setState({value:""!==t?+t:""})})),o()(this,"onUpdateClick",(()=>{const{conditionIndex:e,updateConditionValue:t}=this.props;t(e,this.state.value)}));let t="";const i=this.props.anomaly,s=function(e,t){let i,s;const o=e.actual;void 0!==o&&(i=Array.isArray(o)?o[0]:o);const n=e.typical;switch(void 0!==n&&(s=Array.isArray(n)?n[0]:n),t){case d.b.ACTUAL:return i;case d.b.TYPICAL:return s;case d.b.DIFF_FROM_TYPICAL:if(void 0!==o&&void 0!==n)return Math.abs(i-s)}}(i,e.appliesTo);void 0!==s&&(t=+Object(p.b)(s,i.source.function)),this.state={value:t}}render(){const e=this.state.value;return Object(b.jsx)(l.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"s"},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.editConditionLink.updateRuleConditionFromText",defaultMessage:"Update rule condition from {conditionValue} to",values:{conditionValue:this.props.conditionValue}}))),Object(b.jsx)(l.EuiFlexItem,{grow:!1,className:"condition-edit-value-field"},Object(b.jsx)(l.EuiFieldNumber,{placeholder:r.i18n.translate("xpack.ml.ruleEditor.editConditionLink.enterValuePlaceholder",{defaultMessage:"Enter value"}),compressed:!0,value:e,onChange:this.onChangeValue,"aria-label":r.i18n.translate("xpack.ml.ruleEditor.editConditionLink.enterNumericValueForConditionAriaLabel",{defaultMessage:"Enter numeric value for condition"})})),""!==e&&Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiLink,{size:"s",onClick:()=>this.onUpdateClick()},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.editConditionLink.updateLinkText",defaultMessage:"Update"}))))}}var D=i(11);class rule_action_panel_RuleActionPanel extends n.Component{constructor(e){super(e),o()(this,"getEditRuleLink",(()=>{const{ruleIndex:e,setEditRuleIndex:t}=this.props;return Object(b.jsx)(l.EuiLink,{onClick:()=>t(e)},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.editRuleLinkText",defaultMessage:"Edit rule"}))})),o()(this,"getDeleteRuleLink",(()=>{const{ruleIndex:e,deleteRuleAtIndex:t}=this.props;return Object(b.jsx)(delete_rule_modal_DeleteRuleModal,{ruleIndex:e,deleteRuleAtIndex:t})})),o()(this,"getQuickEditConditionLink",(()=>{const e=this.rule.conditions;let t=null;return void 0!==this.rule.conditions&&1===e.length&&(t=Object(b.jsx)(edit_condition_link_EditConditionLink,{conditionIndex:0,conditionValue:e[0].value,appliesTo:e[0].applies_to,anomaly:this.props.anomaly,updateConditionValue:this.updateConditionValue})),t})),o()(this,"getQuickAddToFilterListLink",(()=>{const{anomaly:e,addItemToFilterList:t}=this.props,i=this.rule.scope,s=Object.keys(i)[0],o=e.source[s],n=i[s].filter_id;return Object(b.jsx)(R,{fieldValue:o[0],filterId:n,addItemToFilterList:t})})),o()(this,"updateConditionValue",((e,t)=>{const{job:i,anomaly:s,ruleIndex:o,updateRuleAtIndex:n}=this.props,a=i.analysis_config.detectors[s.detectorIndex],l=Object(g.cloneDeep)(a.custom_rules[o]),r=l.conditions;e<r.length&&(r[e].value=t),n(o,l)}));const{job:t,anomaly:i,ruleIndex:s}=this.props,n=t.analysis_config.detectors[i.detectorIndex].custom_rules;void 0!==n&&s<n.length&&(this.rule=n[s]),this.state={showAddToFilterListLink:!1}}componentDidMount(){const e=this.rule.scope;if(void 0!==e&&1===Object.keys(e).length){const t=Object.keys(e)[0],i=this.props.anomaly.source[t];if(void 0!==e[t]&&void 0!==i&&1===i.length&&i[0].length>0){const s=e[t].filter_id;D.ml.filters.filters({filterId:s}).then((e=>{-1===e.items.indexOf(i[0])&&this.setState({showAddToFilterListLink:!0})})).catch((e=>{console.log(`Error loading filter ${s}:`,e)}))}}}render(){if(void 0===this.rule)return null;const e=[{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.ruleTitle",defaultMessage:"Rule"}),description:k(this.rule,this.props.anomaly)},{title:"",description:this.getEditRuleLink()},{title:"",description:this.getDeleteRuleLink()}],t=this.getQuickEditConditionLink();if(null!==t&&e.splice(1,0,{title:"",description:t}),!0===this.state.showAddToFilterListLink){const t=this.getQuickAddToFilterListLink();e.splice(e.length-2,0,{title:"",description:t})}return e[1].title=Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleActionPanel.actionsTitle",defaultMessage:"Actions"}),Object(b.jsx)(l.EuiPanel,{paddingSize:"m",className:"select-rule-action-panel"},Object(b.jsx)(l.EuiDescriptionList,{type:"column",columnWidths:[15,85],listItems:e}))}}function N({job:e,anomaly:t,setEditRuleIndex:i,updateRuleAtIndex:s,deleteRuleAtIndex:o,addItemToFilterList:n}){const r=t.detectorIndex,u=e.analysis_config.detectors[r],d=u.custom_rules||[];let p;return d.length>0&&(p=d.map(((r,c)=>Object(b.jsx)(a.a.Fragment,{key:`rule_panel_${c}_${d.length}`},Object(b.jsx)(rule_action_panel_RuleActionPanel,{job:e,ruleIndex:c,anomaly:t,setEditRuleIndex:i,updateRuleAtIndex:s,deleteRuleAtIndex:o,addItemToFilterList:n}),Object(b.jsx)(l.EuiSpacer,{size:"l"}))))),Object(b.jsx)("div",{className:"select-rule-action"},d.length>0&&Object(b.jsx)(a.a.Fragment,null,Object(b.jsx)(m,{job:e,detector:u,anomaly:t}),Object(b.jsx)(l.EuiSpacer,{size:"m"}),p,Object(b.jsx)(l.EuiSpacer,{size:"m"}),Object(b.jsx)(l.EuiText,{style:{display:"inline"}},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.selectRuleAction.orText",defaultMessage:"Or "}))),Object(b.jsx)(l.EuiLink,{onClick:()=>i(d.length)},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.selectRuleAction.createRuleLinkText",defaultMessage:"create a rule"})))}var P=i(71);class rule_editor_flyout_RuleEditorFlyoutUI extends n.Component{constructor(e){super(e),o()(this,"showFlyout",(e=>{let t=-1;const i=f.mlJobService.getJob(e.jobId);if(void 0===i){const{toasts:t}=this.props.kibana.services.notifications;return t.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.unableToConfigureRulesNotificationMesssage",{defaultMessage:"Unable to configure job rules as no job found with ID {jobId}",values:{jobId:e.jobId}})),void this.setState({job:i,isFlyoutVisible:!1})}this.partitioningFieldNames=Object(h.k)(i,e.detectorIndex);const s=e.detectorIndex;void 0===i.analysis_config.detectors[s].custom_rules&&(t=0);let o=!1;0===t&&(o=0===this.partitioningFieldNames.length),this.setState({anomaly:e,job:i,ruleIndex:t,isConditionsEnabled:o,isScopeEnabled:!1,isFlyoutVisible:!0}),this.partitioningFieldNames.length>0&&this.canGetFilters&&this.props.kibana.services.mlServices.mlApiServices.filters.filters().then((e=>{const t=e.map((e=>e.filter_id));this.setState({filterListIds:t})})).catch((e=>{this.toastNotificationService.displayErrorToast(e,r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithLoadingFilterListsNotificationMesssage",{defaultMessage:"Error loading the filter lists used in the job rule scope"}))}))})),o()(this,"closeFlyout",(()=>{this.setState({isFlyoutVisible:!1})})),o()(this,"setEditRuleIndex",(e=>{const t=this.state.anomaly.detectorIndex,i=this.state.job.analysis_config.detectors[t].custom_rules,s=void 0===i||e>=i.length?O():i[e],o=0===this.partitioningFieldNames.length||void 0!==s.conditions&&s.conditions.length>0,n=void 0!==s.scope&&Object.keys(s.scope).length>0;!0===n&&Object.keys(s.scope).forEach((e=>{s.scope[e].enabled=!0})),this.setState({ruleIndex:e,rule:s,isConditionsEnabled:o,isScopeEnabled:n})})),o()(this,"onSkipResultChange",(e=>{const t=e.target.checked;this.setState((e=>{const i=[...e.rule.actions],s=i.indexOf(d.a.SKIP_RESULT);return-1===s&&t?i.push(d.a.SKIP_RESULT):s>-1&&!t&&i.splice(s,1),{rule:{...e.rule,actions:i}}}))})),o()(this,"onSkipModelUpdateChange",(e=>{const t=e.target.checked;this.setState((e=>{const i=[...e.rule.actions],s=i.indexOf(d.a.SKIP_MODEL_UPDATE);return-1===s&&t?i.push(d.a.SKIP_MODEL_UPDATE):s>-1&&!t&&i.splice(s,1),{rule:{...e.rule,actions:i}}}))})),o()(this,"onConditionsEnabledChange",(e=>{const t=e.target.checked;this.setState((e=>{let i;return i=!1===t?[]:[E()],{rule:{...e.rule,conditions:i},isConditionsEnabled:t}}))})),o()(this,"addCondition",(()=>{this.setState((e=>{const t=[...e.rule.conditions];return t.push(E()),{rule:{...e.rule,conditions:t}}}))})),o()(this,"updateCondition",((e,t,i,s)=>{this.setState((o=>{const n=[...o.rule.conditions];return e<n.length&&(n[e]={applies_to:t,operator:i,value:s}),{rule:{...o.rule,conditions:n}}}))})),o()(this,"deleteCondition",(e=>{this.setState((t=>{const i=[...t.rule.conditions];return e<i.length&&i.splice(e,1),{rule:{...t.rule,conditions:i}}}))})),o()(this,"onScopeEnabledChange",(e=>{const t=e.target.checked;this.setState((e=>{const i={...e.rule};return!1===t&&delete i.scope,{rule:i,isScopeEnabled:t}}))})),o()(this,"updateScope",((e,t,i,s)=>{this.setState((o=>{let n={...o.rule.scope};return void 0===n&&(n={}),n[e]={filter_id:t,filter_type:i,enabled:s},{rule:{...o.rule,scope:n}}}))})),o()(this,"saveEdit",(()=>{const{rule:e,ruleIndex:t}=this.state;this.updateRuleAtIndex(t,e)})),o()(this,"updateRuleAtIndex",((e,t)=>{const{toasts:i}=this.props.kibana.services.notifications,{mlApiServices:s,mlJobService:o}=this.props.kibana.services.mlServices,{job:n,anomaly:a}=this.state,l=n.job_id;(function(e,t,i,s,o,n){const a=e.analysis_config.detectors[t],l=n||f.mlJobService,r=Object(g.cloneDeep)(s),c=r.scope;void 0!==c&&Object.keys(c).forEach((e=>{!1===c[e].enabled?delete c[e]:delete c[e].enabled}));let u=[];return void 0===a.custom_rules?u=[r]:(u=Object(g.cloneDeep)(a.custom_rules),i<u.length?u[i]=r:u.push(r)),y(e,t,u,o,l)})(n,a.detectorIndex,e,t,s,o).then((e=>{e.success?(i.add({title:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageTitle",{defaultMessage:"Changes to {jobId} detector rules saved",values:{jobId:l}}),color:"success",iconType:"check",text:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})}),this.closeFlyout()):i.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:l}}))})).catch((e=>{this.toastNotificationService.displayErrorToast(e,r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:l}}))}))})),o()(this,"deleteRuleAtIndex",(e=>{const{toasts:t}=this.props.kibana.services.notifications,{mlApiServices:i,mlJobService:s}=this.props.kibana.services.mlServices,{job:o,anomaly:n}=this.state,a=o.job_id,l=n.detectorIndex;(function(e,t,i,s,o){const n=o||f.mlJobService,a=e.analysis_config.detectors[t];let l=[];return void 0!==a.custom_rules&&i<a.custom_rules.length?(l=Object(g.cloneDeep)(a.custom_rules),l.splice(i,1),y(e,t,l,s,n)):Promise.reject(new Error(r.i18n.translate("xpack.ml.ruleEditor.deleteJobRule.ruleNoLongerExistsErrorMessage",{defaultMessage:"Rule no longer exists for detector index {detectorIndex} in job {jobId}",values:{detectorIndex:t,jobId:e.job_id}})))})(o,l,e,i,s).then((e=>{if(e.success){t.addSuccess(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.ruleDeletedFromJobDetectorNotificationMessage",{defaultMessage:"Rule deleted from {jobId} detector",values:{jobId:a}}));const e=f.mlJobService.getJob(n.jobId);e.analysis_config.detectors[l].custom_rules?this.setState({job:{...e}}):this.closeFlyout()}else t.addDanger(r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:a}}))})).catch((e=>{this.toastNotificationService.displayErrorToast(e,r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:a}}))}))})),o()(this,"addItemToFilterList",((e,t,i)=>{const{toasts:s}=this.props.kibana.services.notifications,{mlApiServices:o}=this.props.kibana.services.mlServices;(function(e,t,i){return new Promise(((s,o)=>{i.filters.updateFilter(t,void 0,[e],void 0).then((e=>{s(e)})).catch((e=>{o(e)}))}))})(e,t,o).then((()=>{!0===i&&(s.add({title:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageTitle",{defaultMessage:"Added {item} to {filterId}",values:{item:e,filterId:t}}),color:"success",iconType:"check",text:r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})}),this.closeFlyout())})).catch((i=>{this.toastNotificationService.displayErrorToast(i,r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithAddingItemToFilterListNotificationMessage",{defaultMessage:"An error occurred adding {item} to filter {filterId}",values:{item:e,filterId:t}}))}))})),this.state={anomaly:{},job:{},ruleIndex:-1,rule:O(),skipModelUpdate:!1,isConditionsEnabled:!1,isScopeEnabled:!1,filterListIds:[],isFlyoutVisible:!1},this.partitioningFieldNames=[],this.canGetFilters=Object(x.checkPermission)("canGetFilters")}componentDidMount(){this.props.kibana.services.notifications&&(this.toastNotificationService=Object(P.toastNotificationServiceProvider)(this.props.kibana.services.notifications.toasts),"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout))}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}render(){var e;const t=null===(e=this.props.kibana.services.docLinks)||void 0===e?void 0:e.links.ml.customRules,{isFlyoutVisible:i,job:s,anomaly:o,ruleIndex:n,rule:u,filterListIds:p,isConditionsEnabled:x,isScopeEnabled:g}=this.state;if(!1===i)return null;let f;if(-1===n)f=Object(b.jsx)(l.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},Object(b.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},Object(b.jsx)(l.EuiTitle,{size:"m"},Object(b.jsx)("h1",{id:"flyoutTitle"},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRulesTitle",defaultMessage:"Edit job rules"})))),Object(b.jsx)(l.EuiFlyoutBody,null,Object(b.jsx)(N,{job:s,anomaly:o,setEditRuleIndex:this.setEditRuleIndex,updateRuleAtIndex:this.updateRuleAtIndex,deleteRuleAtIndex:this.deleteRuleAtIndex,addItemToFilterList:this.addItemToFilterList})),Object(b.jsx)(l.EuiFlyoutFooter,null,Object(b.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))))));else{const e=o.detectorIndex,i=s.analysis_config.detectors[e],a=i.custom_rules,h=void 0===a||n>=a.length,E=this.partitioningFieldNames&&this.partitioningFieldNames.length>0,O=-1===d.c.indexOf(o.source.function),y=r.i18n.translate("xpack.ml.ruleEditor.ruleEditorFlyout.conditionsDescription",{defaultMessage:"Add numeric conditions for when the job rule applies. Multiple conditions are combined using AND."});f=Object(b.jsx)(l.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},Object(b.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},Object(b.jsx)(l.EuiTitle,{size:"m"},Object(b.jsx)("h1",{id:"flyoutTitle"},!0===h?Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.createRuleTitle",defaultMessage:"Create job rule"}):Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRuleTitle",defaultMessage:"Edit job rule"})))),Object(b.jsx)(l.EuiFlyoutBody,null,Object(b.jsx)(m,{job:s,detector:i,anomaly:o}),Object(b.jsx)(l.EuiSpacer,{size:"m"}),Object(b.jsx)(l.EuiText,null,Object(b.jsx)("p",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription",defaultMessage:"Job rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide. When you create a job rule, you can specify conditions, scope, and actions. When the conditions of a job rule are satisfied, its actions are triggered. {learnMoreLink}",values:{learnMoreLink:Object(b.jsx)(l.EuiLink,{href:t,target:"_blank"},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}}))),Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(l.EuiTitle,null,Object(b.jsx)("h2",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.actionTitle",defaultMessage:"Action"}))),Object(b.jsx)(j,{actions:u.actions,onSkipResultChange:this.onSkipResultChange,onSkipModelUpdateChange:this.onSkipModelUpdateChange}),Object(b.jsx)(l.EuiSpacer,{size:"xl"}),Object(b.jsx)(l.EuiTitle,null,Object(b.jsx)("h2",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsTitle",defaultMessage:"Conditions"}))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),!0===O?Object(b.jsx)(l.EuiCheckbox,{id:"enable_conditions_checkbox",className:"scope-enable-checkbox",label:y,checked:x,onChange:this.onConditionsEnabledChange,disabled:!O||!E}):Object(b.jsx)(l.EuiCallOut,{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsNotSupportedTitle",defaultMessage:"Conditions are not supported for detectors using the {functionName} function",values:{functionName:o.source.function}}),iconType:"iInCircle"}),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(I,{isEnabled:x,conditions:u.conditions,addCondition:this.addCondition,updateCondition:this.updateCondition,deleteCondition:this.deleteCondition}),Object(b.jsx)(l.EuiSpacer,{size:"xl"}),Object(b.jsx)(L,{isEnabled:g,onEnabledChange:this.onScopeEnabledChange,partitioningFieldNames:this.partitioningFieldNames,filterListIds:p,scope:u.scope,updateScope:this.updateScope}),Object(b.jsx)(l.EuiCallOut,{title:Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rerunJobTitle",defaultMessage:"Rerun job"}),color:"warning",iconType:"help"},Object(b.jsx)("p",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.whenChangesTakeEffectDescription",defaultMessage:"Changes to job rules take effect for new results only."})),Object(b.jsx)("p",null,Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.howToApplyChangesToExistingResultsDescription",defaultMessage:"To apply these changes to existing results you must clone and rerun the job. Note rerunning the job may take some time and should only be done once you have completed all your changes to the rules for this job."})))),Object(b.jsx)(l.EuiFlyoutFooter,null,Object(b.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButton,{onClick:this.saveEdit,isDisabled:!v(u),fill:!0},Object(b.jsx)(c.FormattedMessage,{id:"xpack.ml.ruleEditor.ruleEditorFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return Object(b.jsx)(a.a.Fragment,null,f)}}const V=Object(u.withKibana)(rule_editor_flyout_RuleEditorFlyoutUI)},399:function(e,t,i){"use strict";i.d(t,"b",(function(){return U})),i.d(t,"a",(function(){return z}));var s=i(120),o=i.n(s),n=i(8),a=i(39),l=i.n(a),r=i(31),c=i.n(r),u=i(2),d=i(138),p=i.n(d),b=i(25),m=i(78),j=i(15),x=i(5),g=i(131),f=i(98),h=i(252),E=i(520),O=i(415),v=i(247);x.i18n.translate("xpack.ml.actions.runPatternAnalysis.title",{defaultMessage:"Run pattern analysis"}),x.i18n.translate("xpack.ml.actions.runPatternAnalysis.description",{defaultMessage:"Triggered when user wants to run pattern analysis on a field."});var y=i(67),k=i(75),_=i(82),T=i(0),M=i(166),I=i(208),F=i(40),S=i(1),A=i(123),w=i(73),C=i(11),L=i(135),R=i(184),D=i(139),N=i(70),P=i(10),V=i(77),$=i(6);const U=e=>{const t=p()(),[i,s]=Object(u.useState)(null),[o,a]=Object(u.useState)(null),[r,d]=Object(u.useState)(),[U,z]=Object(u.useState)(),[B,H]=Object(u.useState)(),[G,W]=Object(u.useState)(),[q,J]=Object(u.useState)(null),Q=Object(h.f)(e.anomaly),K=e.onItemClick,Y=Object(P.d)(),{services:{data:X,share:Z,application:ee,uiActions:te}}=Y,{getDataViewById:ie,getDataViewIdFromName:se}=Object(V.useMlIndexUtils)(),oe=Object(u.useMemo)((()=>w.mlJobService.getJob(e.anomaly.jobId)),[e.anomaly.jobId]),ne=oe.analysis_config.categorization_field_name,ae=oe.datafeed_config.indices,le=ae.join(","),re=x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.autoGeneratedDiscoverLinkErrorMessage",{defaultMessage:"Unable to link to Discover; no data view exists for index pattern ''{index}''",values:{index:le}});Object(u.useEffect)((()=>{!async function(){const e=await se(le);s(e),null===e&&H(re);const t=await se(le,oe);a(t),null===t&&z(re)}()}),[]);Object(u.useEffect)((()=>{const s=Z.url.locators.get("DISCOVER_APP_LOCATOR");if(null===o)return;if(!s){const e=x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.discoverLocatorMissingErrorMessage",{defaultMessage:"No locator for Discover detected"});return void(t()&&(z(e),H(e)))}(async()=>{const e=i?await ie(i):null;if(null===e)return;const t=Object(M.a)(e);null!==t&&J(t)})();const n=async(t=!1,i="timeRange")=>{const s=e.interval,n=e.anomaly.source,a=t?l()(n.timestamp):l()(n.timestamp).startOf(s);t?a.subtract(20*n.bucket_span,"s"):"hour"===s&&a.subtract(1,"h");const r=l()(n.timestamp).add(n.bucket_span,"s");t?r.add(20*n.bucket_span,"s"):!0===e.isAggregatedData&&("hour"===s&&r.add(1,"h"),r.subtract(1,"ms").endOf(s));const c=Object(O.d)(1e3*a.unix()),u=Object(O.d)(1e3*r.unix()),d=n.timestamp,p=n.timestamp+1e3*n.bucket_span,b=d-1e3*n.bucket_span,m=b-1e3*n.bucket_span*15;let j="";n.influencers&&!t&&(j=n.influencers.filter((e=>Object(y.a)(e))).map((e=>{const t=e.influencer_field_values;if(t.length>0){const i=Object(k.escapeQuotes)(e.influencer_field_name),s=t.filter((e=>Object(y.a)(e))).map((e=>`"${i}":"${Object(k.escapeQuotes)(e)}"`));return s.length>1?`(${s.join(" OR ")})`:s[0]}})).join(" AND ")),t&&e.anomaly.entityName&&e.anomaly.entityValue&&(""!==j&&(j+=" AND "),j=`"${Object(k.escapeQuotes)(e.anomaly.entityName)}":"${Object(k.escapeQuotes)(e.anomaly.entityValue+"")}"`);const x=o;return{indexPatternId:x,[i]:{from:c,to:u,mode:"absolute"},query:{language:"kuery",query:j},filters:null===x?[]:Object(A.i)(oe.datafeed_config.query,x,oe.job_id),...t?{wp:{bMin:m,bMax:b,dMin:d,dMax:p}}:{}}};Q||((async()=>{const e=await n(),i=await s.getRedirectUrl(e);t()&&d(i)})(),(async()=>{if("count"!==e.anomaly.source.function_description||void 0!==oe.analysis_config.summary_count_field_name&&"doc_count"!==oe.analysis_config.summary_count_field_name)return void(t()&&W(void 0));const i=Z.url.locators.get(S.a);if(!i)return void console.error("Unable to detect locator for ML or bounds");const s=await n(!0,"time"),{indexPatternId:o,wp:a,query:l,filters:r,...c}=s,u=await i.getRedirectUrl({page:S.b.AIOPS_LOG_RATE_ANALYSIS,pageState:{index:o,globalState:c,appState:{logRateAnalysis:{wp:a,...Object(_.isQuery)(l)?{filters:r,searchString:l.query,searchQueryLanguage:l.language}:{}}}}});t()&&W(u)})())}),[i,o,JSON.stringify(e.anomaly)]);const ce=async()=>{const t=Z.url.locators.get(S.a),i=e.anomaly.source,s=e.bounds;if(!t)return void console.error("Unable to detect locator for ML or bounds");if(!s||!s.min||!s.max)return void console.error("Invalid bounds");const o=s.min.toISOString(),n=s.max.toISOString(),a=l()(i.timestamp),r=a.subtract(50*i.bucket_span,"s").toISOString(),c=a.add(100*i.bucket_span,"s").toISOString(),u={};void 0!==i.partition_field_name&&void 0!==i.partition_field_value&&(u[i.partition_field_name]=i.partition_field_value),void 0!==i.over_field_name&&void 0!==i.over_field_value&&(u[i.over_field_name]=i.over_field_value),void 0!==i.by_field_name&&void 0!==i.by_field_value&&(u[i.by_field_name]=i.by_field_value);const d=await t.getUrl({page:S.b.SINGLE_METRIC_VIEWER,pageState:{jobIds:[i.job_id],refreshInterval:{display:"Off",pause:!0,value:0},timeRange:{from:o,to:n,mode:"absolute"},zoom:{from:r,to:c},detectorIndex:i.detector_index,entities:u,query_string:{analyze_wildcard:!0,query:"*"}}},{absolute:!0});window.open(d,"_blank")},ue=async()=>{const t=e.anomaly.entityValue,s=e.anomaly.source;if(void 0===oe){console.log(`viewExamples(): no job found with ID: ${e.anomaly.jobId}`);const{toasts:t}=Y.services.notifications;return void t.addDanger(x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.unableToViewExamplesErrorMessage",{defaultMessage:"Unable to view examples as no details could be found for job ID {jobId}",values:{jobId:e.anomaly.jobId}}))}if(!ne)return;let n;const a=o?await ie(o):null,r=null==a?void 0:a.getFieldByName(ne);if(r&&Array.isArray(r.esTypes)&&r.esTypes.length>0&&(n=r.esTypes[0]),n)ae.join(),u=n,C.ml.results.getCategoryDefinition(s.job_id,t).then((async e=>{if(!i)return;let t=null;if(u===g.a.KEYWORD)e.regex&&(t={language:v.a.LUCENE,query:`${ne}:/${e.regex}/`});else if(e.terms){const i=Object(D.b)(e.terms);t={language:v.a.KUERY,query:`${ne}:"`+i.split(" ").join(`" and ${ne}:"`)+'"'}}const o=l()(s.timestamp),n=o.toISOString(),a=o.add(s.bucket_span,"s").toISOString(),r=c.a.encode({refreshInterval:{display:"Off",pause:!0,value:0},time:{from:n,to:a,mode:"absolute"}}),d={index:i,filters:Object(A.i)(oe.datafeed_config.query,i,oe.job_id),...null!==t?{query:t}:{}},p=c.a.encode(d),{basePath:b}=Y.services.http,m=`${b.get()}/app/discover#/?_g=${r}&_a=${encodeURIComponent(p)}`;window.open(m,"_blank")})).catch((e=>{console.log("viewExamples(): error loading categoryDefinition:",e);const{toasts:i}=Y.services.notifications;i.addDanger(x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.loadingDetailsErrorMessage",{defaultMessage:"Unable to view examples as an error occurred loading details on category ID {categoryId}",values:{categoryId:t}}))}));else{console.log(`viewExamples(): error finding type of field ${ne} in indices:`,ae);const{toasts:e}=Y.services.notifications;e.addDanger(x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.noMappingCouldBeFoundErrorMessage",{defaultMessage:"Unable to view examples of documents with mlcategory {categoryId} as no mapping could be found for the categorization field {categorizationFieldName}",values:{categoryId:t,categorizationFieldName:ne}}))}var u},{anomaly:de,showViewSeriesLink:pe}=e,be=Object(N.usePermissionCheck)("canUpdateJob"),me=Object(h.h)(de.source)&&be,je=Object(u.useMemo)((()=>{var t,s,o;const a=[];if(void 0!==de.customUrls&&de.customUrls.forEach(((t,i)=>{a.push(Object($.jsx)(b.EuiContextMenuItem,{key:`custom_url_${i}`,icon:"popout",onClick:()=>{K(),(t=>{const{anomaly:i,interval:s,isAggregatedData:o}=e;console.log("Anomalies Table - open customUrl for record:",i);const a=Object(n.cloneDeep)(i.source),r=a.timestamp,c=t.url_value,u=void 0!==t.time_range?Object(F.a)(t.time_range):null,d=Y.services.http.basePath.get();if(c.includes("$earliest$")){let e=l()(r);null!==u?e.subtract(u):(e=l()(r).startOf(s),"hour"===s&&e.subtract(1,"h")),a.earliest=e.toISOString()}if(c.includes("$latest$")){const e=l()(r).add(a.bucket_span,"s");null!==u?e.add(u):!0===o&&("hour"===s&&e.add(1,"h"),e.subtract(1,"ms").endOf(s)),a.latest=e.toISOString()}if((c.includes("$mlcategoryterms$")||c.includes("$mlcategoryregex$"))&&void 0!==a.mlcategory){const e=a.job_id,i=a.mlcategory[0];C.ml.results.getCategoryDefinition(e,i).then((e=>{const i=e.terms.split(" ").map((e=>`+${e}`));a.mlcategoryterms=i.join(" "),a.mlcategoryregex=e.regex;const s=Object(L.g)(t.url_value,a,!0);Object(R.d)(s,t,d)})).catch((e=>{console.log("openCustomUrl(): error loading categoryDefinition:",e);const{toasts:t}=Y.services.notifications;t.addDanger(x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.unableToOpenLinkErrorMessage",{defaultMessage:"Unable to open link as an error occurred loading details on category ID {categoryId}",values:{categoryId:i}}))}))}else{const e=Object(R.a)(t,a);Object(R.d)(e,t,d)}})(t)},"data-test-subj":`mlAnomaliesListRowActionCustomUrlButton_${i}`},t.url_name))})),null!==(t=ee.capabilities.discover)&&void 0!==t&&t.show&&!Q){const e=void 0===U&&void 0===r;a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"auto_raw_data_url",icon:"discoverApp",disabled:void 0!==U||e,href:r,"data-test-subj":"mlAnomaliesListRowAction_viewInDiscoverButton"},U?Object($.jsx)(b.EuiToolTip,{content:U},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInDiscover",defaultMessage:"View in Discover"})):Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInDiscover",defaultMessage:"View in Discover"}),e?Object($.jsx)(b.EuiProgress,{size:"xs",color:"accent"}):null))}return!0===pe&&de.isTimeSeriesViewRecord&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"view_series",icon:"visLine",onClick:()=>{K(),ce()},"data-test-subj":"mlAnomaliesListRowActionViewSeriesButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewSeriesLabel",defaultMessage:"View series"}))),null!==(s=ee.capabilities.maps)&&void 0!==s&&s.show&&(!0===de.isGeoRecord?a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"view_in_maps",icon:"gisApp",onClick:async()=>{const e=await(async e=>{const t=Object(I.c)(e.jobId),s=l()(e.source.timestamp).tz(Object(D.f)()),o=s.toISOString(),n=s.add(e.source.bucket_span,"seconds").subtract(1,"ms").toISOString(),a=X.query.timefilter.timefilter.getTime();a.from=o,a.to=n;const r=Z.url.locators.get(f.MAPS_APP_LOCATOR);return await(null==r?void 0:r.getLocation({initialLayers:t,timeRange:a,...e.entityName&&e.entityValue?{query:{language:v.a.KUERY,query:Object(L.e)(e.entityName,e.entityValue)}}:{},filters:null===i?[]:Object(A.i)(oe.datafeed_config.query,i,oe.job_id)}))})(de);await ee.navigateToApp(m.APP_ID,{path:null==e?void 0:e.path})},"data-test-subj":"mlAnomaliesListRowActionViewInMapsButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewInMapsLabel",defaultMessage:"View in Maps"}))):e.sourceIndicesWithGeoFields&&e.sourceIndicesWithGeoFields[de.jobId]&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"view_in_maps",icon:"gisApp",onClick:async()=>{const t=await(async(e,t)=>{const s=Object(I.d)(t[e.jobId]),o=l()(e.source.timestamp).tz(Object(D.f)()),n=o.subtract(e.source.bucket_span,"seconds").toISOString(),a=o.add(3*e.source.bucket_span,"seconds").subtract(1,"ms").toISOString(),r=X.query.timefilter.timefilter.getTime();r.from=n,r.to=a;const c=function(e=[],t){return e.reduce(((e,i)=>(Object.entries(i).filter((([e])=>e!==t)).forEach((([t,i])=>e.push(`${t}: ${i}`))),e)),[]).join(" or ")}(e.influencers,e.entityName),u=Z.url.locators.get(f.MAPS_APP_LOCATOR),d=null===i?[]:Object(A.i)(oe.datafeed_config.query,i,oe.job_id);return await(null==u?void 0:u.getLocation({initialLayers:s,timeRange:r,filters:d.length>0?d:X.query.filterManager.getFilters(),...e.entityName&&e.entityValue?{query:{language:v.a.KUERY,query:`${Object(L.e)(e.entityName,e.entityValue)}${""!==c?` and (${c})`:""}`}}:{}}))})(de,e.sourceIndicesWithGeoFields);await ee.navigateToApp(m.APP_ID,{path:null==t?void 0:t.path})},"data-test-subj":"mlAnomaliesListRowActionViewSourceIndexInMapsButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewSourceIndexInMapsLabel",defaultMessage:"View source index in Maps"})))),null!==(o=ee.capabilities.discover)&&void 0!==o&&o.show&&Q&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"view_examples",icon:"popout",onClick:()=>{K(),ue()},"data-test-subj":"mlAnomaliesListRowActionViewExamplesButton",disabled:void 0!==B},void 0!==B?Object($.jsx)(b.EuiToolTip,{content:B},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewExamplesLabel",defaultMessage:"View examples"})):Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.viewExamplesLabel",defaultMessage:"View examples"}))),me&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"create_rule",icon:"controlsHorizontal",onClick:()=>{K(),e.showRuleEditorFlyout(de)},"data-test-subj":"mlAnomaliesListRowActionConfigureRulesButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.configureRulesLabel",defaultMessage:"Configure job rules"}))),G&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"log_rate_analysis",icon:"machineLearningApp",href:G,"data-test-subj":"mlAnomaliesListRowAction_runLogRateAnalysisButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.runLogRateAnalysis",defaultMessage:"Run log rate analysis"}))),null!==q&&a.push(Object($.jsx)(b.EuiContextMenuItem,{key:"run_pattern_analysis",icon:"machineLearningApp",onClick:()=>{K();const e=function(e){return void 0===e.entityName||void 0===e.entityValue?null:e.entityName===E.b?void 0===e.source.partition_field_name||void 0===e.source.partition_field_value?null:{name:e.source.partition_field_name,value:e.source.partition_field_value}:{name:e.entityName,value:e.entityValue}}(de);te.getTrigger("CATEGORIZE_FIELD_TRIGGER").exec({dataView:q.dataView,field:q.field,originatingApp:T.g,additionalFilter:{from:de.source.timestamp,to:de.source.timestamp+1e3*de.source.bucket_span,...null!==e?{field:{name:e.name,value:e.value}}:{}}})},"data-test-subj":"mlAnomaliesListRowActionPatternAnalysisButton"},Object($.jsx)(j.FormattedMessage,{id:"xpack.ml.anomaliesTable.linksMenu.patternAnalysisLabel",defaultMessage:"Run pattern analysis"}))),a}),[i,o,r,U,B,ue,ce,me,Q]);return Object($.jsx)(b.EuiContextMenuPanel,{items:je,"data-test-subj":"mlAnomaliesListRowActionsMenu"})},z=e=>{const[t,i]=Object(u.useState)(!1),s=i.bind(null,!t),n=i.bind(null,!1),a=Object($.jsx)(b.EuiButtonIcon,{size:"s",color:"text",onClick:s,iconType:"gear","aria-label":x.i18n.translate("xpack.ml.anomaliesTable.linksMenu.selectActionAriaLabel",{defaultMessage:"Select action for anomaly at {time}",values:{time:Object(O.c)(e.anomaly.time)}}),"data-test-subj":"mlAnomaliesListRowActionsButton"});return Object($.jsx)("div",null,Object($.jsx)(b.EuiPopover,{button:a,isOpen:t,closePopover:n,panelPaddingSize:"none",anchorPosition:"downLeft"},Object($.jsx)(U,o()({},e,{onItemClick:n}))))}}}]);