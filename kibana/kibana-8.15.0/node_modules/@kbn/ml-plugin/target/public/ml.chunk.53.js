/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[53,79],{138:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2);t.default=function(){var e=s.useRef(!1),t=s.useCallback((function(){return e.current}),[]);return s.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},140:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));let s=function(e){return e[e.CRITICAL=75]="CRITICAL",e[e.MAJOR=50]="MAJOR",e[e.MINOR=25]="MINOR",e[e.WARNING=3]="WARNING",e[e.LOW=0]="LOW",e}({})},168:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var s=a(2),o=a(5),l=a(15),n=a(25),r=a(138),i=a.n(r),c=a(10),u=a(13),d=a(6);const b=({jobsAndGroupIds:e,onChange:t,adJobsApiService:a,errors:r,multiSelect:b=!1,label:m,allowSelectAll:j=!1,createJobUrl:g,options:p})=>{const{services:{notifications:{toasts:v},application:{navigateToUrl:f}}}=Object(c.d)(),x=i()(),[y,O]=Object(s.useState)([]),h=Object(s.useMemo)((()=>new Set),[]),k=Object(s.useMemo)((()=>new Set),[]),M=Object(s.useMemo)((()=>(null!=e?e:[]).map((e=>({label:e})))),[e]),I=Object(s.useCallback)((async()=>{try{const{jobIds:e,groupIds:t}=await a.getAllJobAndGroupIds();if(e.forEach((e=>{h.add(e)})),t.forEach((e=>{k.add(e)})),!x())return;O([...j?[{label:o.i18n.translate("xpack.ml.jobSelector.selectAllGroupLabel",{defaultMessage:"Select all"}),options:[{label:o.i18n.translate("xpack.ml.jobSelector.selectAllOptionLabel",{defaultMessage:"*"}),value:u.e}]}]:[],{label:o.i18n.translate("xpack.ml.jobSelector.jobOptionsLabel",{defaultMessage:"Jobs"}),options:[...g?[{label:o.i18n.translate("xpack.ml.jobSelector.createNewLabel",{defaultMessage:"--- Create new ---"}),value:"createNew"}]:[],...e.map((e=>({label:e})))]},...b?[{label:o.i18n.translate("xpack.ml.jobSelector.groupOptionsLabel",{defaultMessage:"Groups"}),options:t.map((e=>({label:e})))}]:[]])}catch(e){v.addError(e,{title:o.i18n.translate("xpack.ml.jobSelector.fetchJobErrorTitle",{defaultMessage:"Failed to load anomaly detection jobs"})})}}),[a,j,g,k,x,h,b,v]),w=Object(s.useCallback)((async e=>{if(e.some((e=>e.value===u.e)))return void t({jobIds:[u.e]});if(g&&e.some((e=>"createNew"===e.value)))return void await f(g);const a=[],s=[];e.forEach((({label:e})=>{h.has(e)?a.push(e):k.has(e)?s.push(e):null!=p&&p.some((t=>{var a;return null===(a=t.options)||void 0===a?void 0:a.some((t=>t.label===e))}))&&a.push(e)})),t({...a.length>0?{jobIds:a}:{},...s.length>0?{groupIds:s}:{}})}),[h,k,p,g]);return Object(s.useEffect)((()=>{p||I()}),[g]),Object(d.jsx)(n.EuiFormRow,{"data-test-subj":"mlAnomalyJobSelectionControls",fullWidth:!0,label:null!=m?m:Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobSelector.formControlLabel",defaultMessage:"Select job"}),isInvalid:!(null==r||!r.length),error:r},Object(d.jsx)(n.EuiComboBox,{singleSelection:!b,selectedOptions:M,options:null!=p?p:y,onChange:w,fullWidth:!0,"data-test-subj":"mlAnomalyAlertJobSelection",isInvalid:!(null==r||!r.length)}))}},175:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={CRITICAL:"#fe5050",MAJOR:"#fba740",MINOR:"#fdec25",WARNING:"#8bc8fb",LOW:"#d2e9f7",BLANK:"#ffffff"}},192:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2);t.default=function(e){s.useEffect(e,[])}},198:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}));var s=a(5),o=a(42),l=a(18);function n(e,t,a,n){const i=Object(l.d)();if(e.contains("job_id_empty"))t.jobId.valid=!1;else if(e.contains("job_id_invalid")){t.jobId.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.jobId.message=e}else if(e.contains("job_id_invalid_max_length"))t.jobId.valid=!1,t.jobId.message=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:o.b}});else if(e.contains("job_id_already_exists")){t.jobId.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});t.jobId.message=e}if(e.contains("job_group_id_invalid")){t.groupIds.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.groupIds.message=e}else if(e.contains("job_group_id_invalid_max_length"))t.groupIds.valid=!1,t.groupIds.message=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:o.b}});else if(e.contains("job_group_id_already_exists")){t.groupIds.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});t.groupIds.message=e}if(e.contains("model_memory_limit_units_invalid")){t.modelMemoryLimit.valid=!1;const e=`${o.a.slice(0,o.a.length-1).join(", ")} or ${[...o.a].pop()}`,a=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e}});t.modelMemoryLimit.message=a}if(e.contains("model_memory_limit_invalid")){t.modelMemoryLimit.valid=!1;const e=(i.max_model_memory_limit||"").toUpperCase(),a=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:e}});t.modelMemoryLimit.message=a}if(e.contains("detectors_duplicates")){t.duplicateDetectors.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});t.duplicateDetectors.message=e}if(e.contains("categorizer_detector_missing_per_partition_field")){t.categorizerMissingPerPartition.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});t.categorizerMissingPerPartition.message=e}if(e.contains("categorizer_varying_per_partition_fields")){t.categorizerVaryingPerPartitionField.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});t.categorizerVaryingPerPartitionField.message=e}if(e.contains("bucket_span_empty")){t.bucketSpan.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});t.bucketSpan.message=e}else e.contains("bucket_span_invalid")&&(t.bucketSpan.valid=!1,t.bucketSpan.message=r(a.analysis_config.bucket_span));if(e.contains("query_empty")){t.query.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});t.query.message=e}else if(e.contains("query_invalid")){t.query.valid=!1;const e=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});t.query.message=e}e.contains("query_delay_invalid")&&(t.queryDelay.valid=!1,t.queryDelay.message=r(n.query_delay)),e.contains("frequency_invalid")&&(t.frequency.valid=!1,t.frequency.message=r(n.frequency)),e.contains("missing_summary_count_field_name")&&(t.summaryCountField.valid=!1,t.summaryCountField.message=s.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function r(e){return s.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:e,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},249:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(58).__importDefault(a(192));t.default=function(e){s.default((function(){e()}))}},322:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l}));var s=a(37);const o=e=>{var t;if(function(e){var t;return e&&void 0!==(null===(t=e.error)||void 0===t?void 0:t.reason)}(e))return{message:null!==(t=e.error.reason)&&void 0!==t?t:"",statusCode:e.status,fullError:e};if(function(e){return"string"==typeof e}(e))return{message:e};if(function(e){return!0===(null==e?void 0:e.isBoom)}(e))return{message:e.output.payload.message,statusCode:e.output.payload.statusCode};if(void 0===(null==e?void 0:e.body)&&(null==e||!e.message))return{message:""};if("string"==typeof e.body)return{message:e.body};if(function(e){return"object"==typeof e.body&&"message"in e.body}(e)){var a,o;if("object"==typeof e.body.attributes&&"string"==typeof(null===(a=e.body.attributes.body)||void 0===a||null===(o=a.error)||void 0===o?void 0:o.reason)){var l,n,r;const t={message:e.body.attributes.body.error.reason,statusCode:e.body.statusCode,fullError:e.body.attributes.body};var i,c,u;return"object"!=typeof e.body.attributes.body.error.caused_by||"string"!=typeof(null===(l=e.body.attributes.body.error.caused_by)||void 0===l?void 0:l.reason)&&"string"!=typeof(null===(n=e.body.attributes.body.error.caused_by)||void 0===n||null===(r=n.caused_by)||void 0===r?void 0:r.reason)||(t.causedBy=(null===(i=e.body.attributes.body.error.caused_by)||void 0===i||null===(c=i.caused_by)||void 0===c?void 0:c.reason)||(null===(u=e.body.attributes.body.error.caused_by)||void 0===u?void 0:u.reason)),Array.isArray(e.body.attributes.body.error.root_cause)&&"object"==typeof e.body.attributes.body.error.root_cause[0]&&Object(s.a)(e.body.attributes.body.error.root_cause[0],["script"])&&(t.causedBy=e.body.attributes.body.error.root_cause[0].script,t.message+=`: '${e.body.attributes.body.error.root_cause[0].script}'`),t}return{message:e.body.message,statusCode:e.body.statusCode}}return function(e){return e&&void 0!==e.message&&"string"==typeof e.message}(e)?{message:e.message}:{message:""}},l=e=>o(e).message},349:function(e,t,a){"use strict";a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return i}));var s=a(140),o=a(175);const l=[{stop:s.a.LOW,color:o.a.WARNING},{stop:s.a.MINOR,color:o.a.MINOR},{stop:s.a.MAJOR,color:o.a.MAJOR},{stop:s.a.CRITICAL,color:o.a.CRITICAL}],n={BUCKET:"bucket",RECORD:"record",INFLUENCER:"influencer"},r=["partition_field","over_field","by_field"],i="job_id"},386:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var s=a(120),o=a.n(s),l=a(25),n=a(2),r=a(198),i=a(59),c=a(32),u=a(6);const d=({value:e,onChange:t,label:a,...s})=>{const d=Object(n.useMemo)((()=>Object(i.composeValidators)(Object(c.g)())),[]),b=Object(n.useMemo)((()=>d(e)),[e]),m=!!e&&!!b;return Object(u.jsx)(l.EuiFormRow,{label:a,isInvalid:m,error:Object(r.a)(null!=e?e:void 0),"data-test-subj":"mlAnomalyAlertAdvancedSettingsLookbackInterval"},Object(u.jsx)(l.EuiFieldText,o()({},s,{placeholder:"15d, 6m",value:null!=e?e:"",onChange:e=>{t(e.target.value)},isInvalid:m})))}},401:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var s=a(2),o=a.n(s),l=a(5),n=a(25),r=a(140),i=a(6);const c=o.a.memo((({value:e,onChange:t})=>{const a=[{min:r.a.LOW,max:r.a.MINOR,color:"#8BC8FB"},{min:r.a.MINOR,max:r.a.MAJOR,color:"#FDEC25"},{min:r.a.MAJOR,max:r.a.CRITICAL,color:"#FBA740"},{min:r.a.CRITICAL,max:100,color:"#FE5050"}],s=l.i18n.translate("xpack.ml.severitySelector.formControlLabel",{defaultMessage:"Severity"}),o=null!=e?e:r.a.LOW,c=new Array(5).fill(null).map(((e,t)=>{const a=25*t;return{value:a,label:a}}));return Object(i.jsx)(n.EuiFormRow,{fullWidth:!0},Object(i.jsx)(n.EuiFlexGroup,{gutterSize:"s"},Object(i.jsx)(n.EuiFlexItem,{grow:!1},Object(i.jsx)(n.EuiFieldNumber,{id:"severityControl",style:{width:"70px"},compressed:!0,prepend:s,value:o,onChange:e=>t(Number(e.target.value)),min:r.a.LOW,max:100})),Object(i.jsx)(n.EuiFlexItem,{grow:!0},Object(i.jsx)(n.EuiRange,{className:"mlSeverityControl",fullWidth:!0,min:r.a.LOW,max:100,value:o,onChange:e=>t(Number(e.currentTarget.value)),"aria-label":l.i18n.translate("xpack.ml.severitySelector.formControlAriaLabel",{defaultMessage:"Select severity threshold"}),showTicks:!0,ticks:c,showRange:!1,levels:a,"data-test-subj":"mlAnomalyAlertScoreSelection"}))))}))},71:function(e,t,a){"use strict";a.r(t),a.d(t,"toastNotificationServiceProvider",(function(){return i})),a.d(t,"useToastNotificationService",(function(){return u})),a.d(t,"getToastNotificationService",(function(){return c}));var s=a(5),o=a(2),l=a(322);class MLRequestFailure extends Error{constructor(e,t){if(super(e.message),Object.setPrototypeOf(this,new.target.prototype),"string"!=typeof t&&void 0!==t)if("body"in t)this.stack=JSON.stringify(t.body,null,2);else try{this.stack=JSON.stringify(t,null,2)}catch(e){}}}var n=a(17),r=a(10);function i(e){return{displayDangerToast:function(t,a){e.addDanger(t,a)},displayWarningToast:function(t,a){e.addWarning(t,a)},displaySuccessToast:function(t,a){e.addSuccess(t,a)},displayErrorToast:function(t,a,o){const n=Object(l.b)(t);e.addError(new MLRequestFailure(n,t),{title:null!=a?a:s.i18n.translate("xpack.ml.toastNotificationService.errorTitle",{defaultMessage:"An error has occurred"}),...o?{toastLifeTimeMs:o}:{}})}}}function c(){return i(Object(n.f)())}function u(){const{toasts:e}=Object(r.i)();return Object(o.useMemo)((()=>i(e)),[])}},875:function(e,t,a){"use strict";a.r(t);var s=a(2),o=a.n(s),l=a(25),n=a(249),r=a.n(n),i=a(5),c=a(67),u=a(349),d=a(140),b=a(21),m=a(1),j=a(168),g=a(52),p=a(12),v=a(71),f=a(401),x=a(15),y=a(6);const O=o.a.memo((({value:e=[],onChange:t,availableOption:a})=>{const o=Object(s.useMemo)((()=>[{value:u.a.BUCKET,title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.bucketResultType.title",defaultMessage:"Bucket"}),description:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.bucketResultType.description",defaultMessage:"How unusual was the job within the bucket of time?"})},{value:u.a.RECORD,title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.recordResultType.title",defaultMessage:"Record"}),description:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.recordResultType.description",defaultMessage:"What individual anomalies are present in a time range?"})},{value:u.a.INFLUENCER,title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.influencerResultType.title",defaultMessage:"Influencer"}),description:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.influencerResultType.description",defaultMessage:"What are the most unusual entities in a time range?"})}].filter((e=>a.includes(e.value)))),[a]);return Object(y.jsx)(l.EuiFormRow,{fullWidth:!0,label:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.resultTypeSelector.formControlLabel",defaultMessage:"Result type"})},Object(y.jsx)(l.EuiFlexGroup,{gutterSize:"s"},o.map((({value:a,title:s,description:o})=>Object(y.jsx)(l.EuiFlexItem,{key:a},Object(y.jsx)(l.EuiCard,{title:s,titleSize:"xs",paddingSize:"s",description:Object(y.jsx)("small",null,o),selectable:{onClick:()=>{e!==a&&t(a)},isSelected:a===e},"data-test-subj":`mlAnomalyAlertResult_${a}${a===e?"_selected":""}`}))))))}));a(10);var h=a(0);var k=a(59),M=a(32),I=a(198),w=a(13);const _=o.a.memo((({jobIds:e,timestampIso8601:t,score:a,topInfluencers:s,topRecords:o})=>{const n=[{title:i.i18n.translate("xpack.ml.previewAlert.jobsLabel",{defaultMessage:"Job IDs:"}),description:e.join(", ")},{title:i.i18n.translate("xpack.ml.previewAlert.timeLabel",{defaultMessage:"Time: "}),description:t},{title:i.i18n.translate("xpack.ml.previewAlert.scoreLabel",{defaultMessage:"Anomaly score:"}),description:a},...s&&s.length>0?[{title:i.i18n.translate("xpack.ml.previewAlert.topInfluencersLabel",{defaultMessage:"Top influencers:"}),description:Object(y.jsx)("ul",null,s.map((e=>Object(y.jsx)("li",{key:e.unique_key},Object(y.jsx)(l.EuiCode,{transparentBackground:!0},e.influencer_field_name)," ="," ",e.influencer_field_value," [",e.score,"]"))))}]:[],...o&&o.length>0?[{title:i.i18n.translate("xpack.ml.previewAlert.topRecordsLabel",{defaultMessage:"Top records:"}),description:Object(y.jsx)("ul",null,o.map((e=>{var t,a;return Object(y.jsx)("li",{key:e.unique_key},Object(y.jsx)(l.EuiCode,{transparentBackground:!0},e.function,"(",e.field_name,")")," ",e.by_field_value," ",e.over_field_value," ",e.partition_field_value," [",e.score,"]; (",Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.typicalLabel",defaultMessage:"Typical:"})," ",null!==(t=e.typical)&&void 0!==t?t:"-",","," ",Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.actualLabel",defaultMessage:"Actual:"})," ",null!==(a=e.actual)&&void 0!==a?a:"-",")")})))}]:[]];return Object(y.jsx)(l.EuiDescriptionList,{type:"row",compressed:!0,listItems:n})})),A=({alertingApiService:e,alertParams:t})=>{var a,n,r,i;const c=w.d,[u,d]=Object(s.useState)(),[b,m]=Object(s.useState)(),[j,g]=Object(s.useState)(!0),[p,v]=Object(s.useState)(),[f,O]=Object(s.useState)(),h=Object(s.useMemo)((()=>Object(k.composeValidators)(Object(M.f)(),Object(M.g)())),[]),A=Object(s.useMemo)((()=>h(u)),[u]);Object(s.useEffect)((function(){O(void 0)}),[t]);const E=Object(s.useCallback)((async()=>{try{const a=await e.preview({alertParams:t,timeRange:u,sampleSize:c});O(a),m(u),v(void 0)}catch(e){var a;O(void 0),v(null!==(a=e.body)&&void 0!==a?a:e)}}),[t,u]),C=Object(s.useMemo)((()=>{if(f)return f.results}),[f]),S=((null===(a=t.jobSelection)||void 0===a||null===(n=a.jobIds)||void 0===n?void 0:n.length)>0||(null===(r=t.jobSelection)||void 0===r||null===(i=r.groupIds)||void 0===i?void 0:i.length)>0)&&!!t.resultType&&void 0!==t.severity&&null===A,F=void 0!==u&&!!A;return Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"flexEnd"},Object(y.jsx)(l.EuiFlexItem,null,Object(y.jsx)(l.EuiFormRow,{label:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.intervalLabel",defaultMessage:"Check the rule condition with an interval"}),isInvalid:F,error:Object(I.a)(u)},Object(y.jsx)(l.EuiFieldText,{placeholder:"15d, 6m",value:null!=u?u:"",onChange:e=>{d(e.target.value)},isInvalid:F,"data-test-subj":"mlAnomalyAlertPreviewInterval"}))),Object(y.jsx)(l.EuiFlexItem,{grow:!1},Object(y.jsx)(l.EuiButton,{onClick:E,disabled:!S,"data-test-subj":"mlAnomalyAlertPreviewButton"},Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.testButtonLabel",defaultMessage:"Test"})))),void 0!==p&&Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(l.EuiCallOut,{title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.previewErrorTitle",defaultMessage:"Unable to load the preview"}),color:"danger",iconType:"warning"},Object(y.jsx)("p",null,p.message))),f&&C&&Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(y.jsx)(l.EuiFlexItem,{grow:!1},Object(y.jsx)(l.EuiText,{size:"xs","data-test-subj":"mlAnomalyAlertPreviewMessage"},Object(y.jsx)("strong",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.previewMessage",defaultMessage:"Found {alertsCount, plural, one {# anomaly} other {# anomalies}} in the last {interval}.",values:{alertsCount:f.count,interval:b}})))),C.length>0&&Object(y.jsx)(l.EuiFlexItem,{grow:!1},Object(y.jsx)(l.EuiButtonEmpty,{color:"primary",size:"xs",onClick:g.bind(null,!j)},j?Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.hideResultsButtonLabel",defaultMessage:"Hide results"}):Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.showResultsButtonLabel",defaultMessage:"Show results"})))),j&&C.length>0?Object(y.jsx)(l.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1,"data-test-subj":"mlAnomalyAlertPreviewCallout"},Object(y.jsx)("ul",null,C.map(((e,t)=>Object(y.jsx)("li",{key:e.key},Object(y.jsx)(_,e),t!==C.length-1?Object(y.jsx)(l.EuiHorizontalRule,{margin:"xs"}):null)))),f.count>c?Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(l.EuiText,{size:"xs"},Object(y.jsx)("b",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.previewAlert.otherValuesLabel",defaultMessage:"and {count, plural, one {# other} other {# others}}",values:{count:f.count-c}})))):null):null))},E=o.a.memo((({value:e,onChange:t})=>Object(y.jsx)(l.EuiFormRow,null,Object(y.jsx)(l.EuiSwitch,{label:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.interimResultsControl.label",defaultMessage:"Include interim results"}),checked:null!=e&&e,onChange:t.bind(null,!e)}))));var C=a(40),S=a(30);const F=o.a.memo((({jobConfigs:e=[],alertInterval:t,alertParams:a,alertNotifyWhen:s,maxNumberOfBuckets:n})=>{var r,i;if(0===e.length)return null;const c=Object(C.a)(t).asSeconds(),u=!!a.lookbackInterval&&(null===(r=Object(C.a)(a.lookbackInterval))||void 0===r?void 0:r.asSeconds()),d=u&&u<c,b=e.filter((e=>e.datafeed_config.state!==S.a.STARTED)).map((e=>e.job_id)),m=d||b.length>0,j="onActiveAlert"===s&&u&&c<u,g=Object(C.a)(e[0].analysis_config.bucket_span),p=g?Math.ceil(g.asMinutes())*Math.min(null!==(i=a.topNBuckets)&&void 0!==i?i:w.h,null!=n?n:w.h):void 0;return Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiSpacer,{size:"m"}),m?Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiCallOut,{title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.alertConditionValidation.title",defaultMessage:"Alert condition contains the following issues:"}),color:"warning",size:"s"},Object(y.jsx)("ul",null,d?Object(y.jsx)("li",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.alertConditionValidation.alertIntervalTooHighMessage",defaultMessage:"The check interval is greater than the lookback interval. Reduce it to {lookbackInterval} to avoid potentially missing notifications.",values:{lookbackInterval:a.lookbackInterval}})):null,b.length>0?Object(y.jsx)("li",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.alertConditionValidation.stoppedDatafeedJobsMessage",defaultMessage:"The datafeed is not started for the following {count, plural, one {job} other {jobs}}: {jobIds}.",values:{count:b.length,jobIds:b.join(", ")}})):null)),Object(y.jsx)(l.EuiSpacer,{size:"m"})):null,j?Object(y.jsx)(o.a.Fragment,null,Object(y.jsx)(l.EuiCallOut,{title:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.alertConditionValidation.notifyWhenWarning",defaultMessage:"Expect to receive duplicate notifications about the same anomaly for up to {notificationDuration, plural, one {# minute} other {# minutes}}. Increase the check interval or switch to notify only on status change to avoid duplicate notifications.",values:{notificationDuration:p}}),color:"warning",size:"s"}),Object(y.jsx)(l.EuiSpacer,{size:"m"})):null)}));var R=a(348),L=a(386);const N=o.a.memo((({value:e,onChange:t})=>{var a;const o=Object(s.useMemo)((()=>Object(c.a)(e.topNBuckets)?Object(R.b)(e.topNBuckets):null),[e.topNBuckets]);return Object(y.jsx)(l.EuiAccordion,{id:"mlAnomalyAlertAdvancedSettings",buttonContent:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.advancedSettingsLabel",defaultMessage:"Advanced settings"}),"data-test-subj":"mlAnomalyAlertAdvancedSettingsTrigger"},Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(l.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:Object(y.jsx)("h4",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"})),description:Object(y.jsx)(l.EuiText,{size:"xs"},Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalDescription",defaultMessage:"Time interval to query the anomalies data during each rule condition check. By default, is derived from the bucket span of the job and the query delay of the datafeed."}))},Object(y.jsx)(L.a,{value:e.lookbackInterval,label:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.lookbackIntervalLabel",defaultMessage:"Lookback interval"}),onChange:e=>{t({lookbackInterval:e})},"data-test-subj":"mlAnomalyAlertLookbackInterval"})),Object(y.jsx)(l.EuiDescribedFormGroup,{gutterSize:"s",titleSize:"xxs",title:Object(y.jsx)("h4",null,Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"})),description:Object(y.jsx)(l.EuiText,{size:"xs"},Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsDescription",defaultMessage:"The number of latest buckets to check to obtain the highest anomaly."}))},Object(y.jsx)(l.EuiFormRow,{label:Object(y.jsx)(x.FormattedMessage,{id:"xpack.ml.anomalyDetectionAlert.topNBucketsLabel",defaultMessage:"Number of latest buckets"}),isInvalid:null!==o,"data-test-subj":"mlAnomalyAlertTopNBucketsFormRow"},Object(y.jsx)(l.EuiFieldNumber,{value:null!==(a=e.topNBuckets)&&void 0!==a?a:w.h,min:1,onChange:e=>{t({topNBuckets:Number(e.target.value)})},"data-test-subj":"mlAnomalyAlertTopNBuckets",isInvalid:null!==o}))),Object(y.jsx)(l.EuiHorizontalRule,{margin:"m"}))}));var T=a(347);t.default=({ruleParams:e,setRuleParams:t,setRuleProperty:a,errors:o,ruleInterval:n,alertNotifyWhen:x,getStartServices:k,mlCapabilities:M})=>{const{services:{http:I}}=Object(b.useKibana)(),[w,_]=Object(s.useState)(void 0);Object(s.useEffect)((()=>{let e=!0;if(M.canCreateJob)return k().then((t=>{const a=t[2].locator;a&&a.getUrl({page:m.b.ANOMALY_DETECTION_CREATE_JOB}).then((t=>{e&&_(t)}))})),()=>{e=!1}}),[k,M]);const S=Object(s.useMemo)((()=>new p.a(I)),[I]),R=Object(s.useMemo)((()=>Object(g.jobsApiProvider)(S)),[S]),L=Object(s.useMemo)((()=>{return e=S,{preview(t){const a=JSON.stringify(t);return e.http({path:`${h.d}/alerting/preview`,method:"POST",body:a,version:"1"})}};var e}),[S]),{displayErrorToast:z}=Object(v.useToastNotificationService)(),[J,D]=Object(s.useState)([]),B=Object(s.useCallback)((e=>a=>{t(e,a)}),[]),P=Object(s.useMemo)((()=>{var t;return Object.values(null!==(t=e.jobSelection)&&void 0!==t?t:{}).flat()}),[e.jobSelection]),q=Object(s.useCallback)((async()=>{try{const e=await R.jobs(P);D(e)}catch(e){z(e,i.i18n.translate("xpack.ml.anomalyDetectionAlert.errorFetchingJobs",{defaultMessage:"Unable to fetch jobs configuration"}),5e3)}}),[P]),W=Object(s.useMemo)((()=>0===J.length||(null!=J?J:[]).some((e=>{var t,a;return Boolean(null===(t=e.analysis_config)||void 0===t||null===(a=t.influencers)||void 0===a?void 0:a.length)}))?Object.values(u.a):[u.a.BUCKET,u.a.RECORD]),[J]);Object(s.useEffect)((function(){0!==P.length&&q()}),[P]),r()((function(){const{jobSelection:t,...s}=e;0===Object.keys(s).length&&a("params",{severity:d.a.CRITICAL,resultType:u.a.BUCKET,includeInterim:!1,jobSelection:t,lookbackInterval:void 0,topNBuckets:void 0})}));const G=Object(s.useMemo)((()=>{let{lookbackInterval:t,topNBuckets:a}=e;return!Object(c.a)(t)&&J.length>0&&(t=Object(T.a)(J)),!Object(c.a)(a)&&J.length>0&&(a=Object(T.c)(J[0])),{lookbackInterval:t,topNBuckets:a}}),[e.lookbackInterval,e.topNBuckets,J]),U=Object(s.useMemo)((()=>({...e,...G})),[e,G]),V=Object(s.useMemo)((()=>{if(0===J.length)return;const e=Object(C.a)(J[0].analysis_config.bucket_span),t=G.lookbackInterval?Object(C.a)(G.lookbackInterval):null;return t&&e?Math.ceil(t.asSeconds()/e.asSeconds()):void 0}),[J,G]);return Object(y.jsx)(l.EuiForm,{"data-test-subj":"mlAnomalyAlertForm"},Object(y.jsx)(j.a,{createJobUrl:w,jobsAndGroupIds:P,adJobsApiService:R,onChange:Object(s.useCallback)(B("jobSelection"),[]),errors:Array.isArray(o.jobSelection)?o.jobSelection:[]}),Object(y.jsx)(F,{jobConfigs:J,alertInterval:n,alertNotifyWhen:x,alertParams:U,maxNumberOfBuckets:V}),Object(y.jsx)(O,{value:e.resultType,availableOption:W,onChange:Object(s.useCallback)(B("resultType"),[])}),Object(y.jsx)(f.a,{value:e.severity,onChange:Object(s.useCallback)(B("severity"),[])}),Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(E,{value:e.includeInterim,onChange:Object(s.useCallback)(B("includeInterim"),[])}),Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(N,{value:G,onChange:Object(s.useCallback)((e=>{Object.keys(e).forEach((a=>{t(a,e[a])}))}),[])}),Object(y.jsx)(l.EuiSpacer,{size:"m"}),Object(y.jsx)(A,{alertingApiService:L,alertParams:e}),Object(y.jsx)(l.EuiSpacer,{size:"m"}))}}}]);