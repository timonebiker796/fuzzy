/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[26],{214:function(e,t,r){"use strict";r.d(t,"b",(function(){return p})),r.d(t,"d",(function(){return d})),r.d(t,"a",(function(){return m})),r.d(t,"c",(function(){return h})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return x})),r.d(t,"g",(function(){return b})),r.d(t,"h",(function(){return y})),r.d(t,"i",(function(){return j})),r.d(t,"o",(function(){return O})),r.d(t,"p",(function(){return k})),r.d(t,"j",(function(){return I})),r.d(t,"m",(function(){return T})),r.d(t,"k",(function(){return E})),r.d(t,"l",(function(){return w})),r.d(t,"n",(function(){return M}));var a=r(145),i=r.n(a),l=r(252),n=r(135),s=r(39),o=r.n(s),c=r(132),u=r(1);const p=7,d=5,m=10,h=100;function f(e=[],t){let r=1/0,a=-1/0;e.forEach((e=>{let t=e.value;const i=Array.isArray(e.actual)?e.actual[0]:e.actual,l=Array.isArray(e.typical)?e.typical[0]:e.typical;null===t&&void 0!==e.anomalyScore&&void 0!==e.actual&&(t=i),void 0!==e.anomalyScore&&void 0!==i?(r=Math.min(r,t,i,l),a=Math.max(a,t,i,l)):(r=Math.min(r,t),a=Math.max(a,t))}));const i={max:a,min:r};if(i.max===i.min){const e=.05*i.max;i.max+=e,i.min-=e}return"count"===t&&i.min<0&&(i.min=0),i}function x(e,t,r,a=1.5){const i=e.reduce(((t,r,a)=>{const i=e[a-1],l=e[a+1];return(void 0===i||i&&null===i.value)&&null!==r.value&&(void 0===l||l&&null===l.value)&&t.push(r),t}),[]),l=(t.select(".values-dots").empty()?t.append("g").classed("values-dots",!0):t.select(".values-dots")).selectAll("circle").data(i);l.enter().append("circle").attr("r",a),l.attr("cx",r.x()).attr("cy",r.y()),l.exit().remove()}function b(e,t){if(void 0===e||void 0===e.selectAll)throw new Error("Missing selection parameter");e.selectAll(".tick text").text((function(){const e=i.a.select(this.parentNode),r=e.node().getBBox().width,a=i.a.transform(e.attr("transform")).translate[0];if(a-r/2>=0&&a+r/2<=t)return this.textContent;e.remove()}))}const v=!0,g=!0;function y(e){let t=c.b.SINGLE_METRIC;if("lat_long"===e.functionDescription||void 0!==e.mapData)return c.b.GEO_MAP;if(v&&"rare"===e.functionDescription&&!1===e.entityFields.some((e=>"over"===e.fieldType))?t=c.b.EVENT_DISTRIBUTION:g&&"rare"!==e.functionDescription&&e.entityFields.some((e=>"over"===e.fieldType))&&null!==e.metricFunction&&(t=c.b.POPULATION_DISTRIBUTION),(t===c.b.EVENT_DISTRIBUTION||t===c.b.POPULATION_DISTRIBUTION)&&void 0!==e.datafeedConfig&&void 0!==e.datafeedConfig.script_fields){const r=Object.keys(e.datafeedConfig.script_fields),a=e.entityFields.map((e=>e.fieldName));e.metricFieldName&&a.push(e.metricFieldName),!0==(void 0!==a.find((e=>r.includes(e))))&&(t=c.b.SINGLE_METRIC)}return t}async function j(e,t,r){const a=o()(t.plotEarliest).toISOString(),i=o()(t.plotLatest).toISOString();let l;return t.entityFields.length>0&&(l={},t.entityFields.forEach((e=>{l[e.fieldName]=e.fieldValue}))),await e.getUrl({page:u.b.SINGLE_METRIC_VIEWER,pageState:{jobIds:[t.jobId],refreshInterval:{display:"Off",pause:!0,value:0},timeRange:r,zoom:{from:a,to:i},detectorIndex:t.detectorIndex,entities:l,query:{query_string:{analyze_wildcard:!0,query:"*"}}}},{absolute:!0})}function O(e){return!0===e.isMultiBucketAnomaly}function k(e){return!0===e.isMultiBucketAnomaly}function I(e){const t=void 0!==e.multiBucketImpact?Object(l.c)(e.multiBucketImpact):0;return new Array(5).fill("■ ",0,t).fill("□ ",t).join("")}function T(e,t){return e/(1.75*Object(n.a)(o()().format(t),!1))}const S={NEXT:"next",PREVIOUS:"previous"};function E(e,t,r,a){if(t<=0)throw Error("tickInterval must be larger than 0.");const i=[e];function l(e,n){let s,o;switch(n){case S.PREVIOUS:s=e-t,o=s>=r;break;case S.NEXT:s=e+t,o=s<=a}o&&(i.push(s),l(s,n))}return l(e,S.PREVIOUS),l(e,S.NEXT),i.sort(),i}const _=60;function w({detectorLabel:e,entityFields:t}){return e.length+t.map((e=>`${e.fieldName} ${e.fieldValue}`)).join(" ").length>_}function M(e,t,r,a){function l(e){return function(t){switch(e){case S.PREVIOUS:return t-r;case S.NEXT:return t+r}}}function n(t,r){const s=function(t){const r=l(t),a=function(t){const l=e.selectAll(".tick").filter((e=>e===t));if(0===l.length||0===l[0].length)return!1;const n=i.a.selectAll(l[0]),s=n.select("text").node();if(null===s)return a(r(t));const o=s.getBBox().width,c=function(e){const t=/translate\(\s*([^\s,)]+)([ ,]([^\s,)]+))?\)/.exec(e);return Array.isArray(t)&&t.length>=2?Number(t[1]):NaN}(n.attr("transform"));return{tick:n,ts:t,xMinOffset:c-(o/2+15),xMaxOffset:c+(o/2+15)}};return a}(r),o=s(t);if(!1===o)return;const c=s(l(r)(t));!1!==c&&(c.xMinOffset<0||c.xMaxOffset>a||c.xMaxOffset>o.xMinOffset&&r===S.PREVIOUS||c.xMinOffset<o.xMaxOffset&&r===S.NEXT?(c.tick.select("text").remove(),c.tick.select("line").classed("ml-tick-emphasis",!1),n(o.ts,r)):n(c.ts,r))}e.selectAll("g.tick").select("line").classed("ml-tick-emphasis",!0),n(t,S.PREVIOUS),n(t,S.NEXT)}},240:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(2),i=r.n(a),l=r(25),n=r(6);const s=({height:e,label:t})=>(e=e?+e:100,Object(n.jsx)(l.EuiFlexGroup,{justifyContent:"spaceEvenly"},Object(n.jsx)(l.EuiFlexItem,{grow:!1},Object(n.jsx)("div",{style:{height:`${e}px`},"data-test-subj":"mlLoadingIndicator"},Object(n.jsx)(l.EuiLoadingChart,{size:"xl",mono:!0}),t&&Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)(l.EuiSpacer,{size:"s"}),Object(n.jsx)("div",null,t))))))},788:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(789);case"v8light":return r(791)}},789:function(e,t,r){var a=r(126),i=r(790);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},790:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-reset-font-weight{font-weight:400}.ml-explorer-chart-container{overflow:hidden}.ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-size:12px}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#1d1e24;opacity:1}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#98a2b3;stroke-width:2px;stroke-opacity:.8}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#98a2b3;fill:#343741;pointer-events:none}.ml-explorer-chart-container .axis line,.ml-explorer-chart-container .axis path{fill:none;stroke:#343741;shape-rendering:crispEdges}.ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-explorer-chart-container .axis text{fill:#98a2b3}.ml-explorer-chart-container .axis .tick line{stroke:#343741;stroke-width:1px}.ml-explorer-chart-container .values-line{fill:none;stroke:#36a2ef;stroke-width:2}.ml-explorer-chart-container .values-dots circle,.ml-explorer-chart-container .values-dots-circle{fill:#36a2ef;stroke-width:0}.ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#535966}.ml-explorer-chart-container .metric-value{fill:#0000;stroke:#36a2ef;stroke-width:0;opacity:1}.ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#535966}.ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#36a2ef}.ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-explorer-chart-container .anomaly-marker:hover,.ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-explorer-chart{overflow:hidden}.ml-explorer-chart-content-wrapper{height:215px}.ml-explorer-chart-axis-emphasis{font-weight:700}",""]),e.exports=t},791:function(e,t,r){var a=r(126),i=r(792);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},792:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}.ml-reset-font-weight{font-weight:400}.ml-explorer-chart-container{overflow:hidden}.ml-explorer-chart-container .ml-explorer-chart-svg{font-family:Inter,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-size:12px}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect{fill:#fff;opacity:1}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval{fill:#c8c8c81a;stroke:#69707d;stroke-width:2px;stroke-opacity:.8}.ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker{stroke-width:1px;stroke:#69707d;fill:#d3dae6;pointer-events:none}.ml-explorer-chart-container .axis line,.ml-explorer-chart-container .axis path{fill:none;stroke:#d3dae6;shape-rendering:crispEdges}.ml-explorer-chart-container .axis .tick line.ml-tick-emphasis{stroke:#0003}.ml-explorer-chart-container .axis text{fill:#69707d}.ml-explorer-chart-container .axis .tick line{stroke:#d3dae6;stroke-width:1px}.ml-explorer-chart-container .values-line{fill:none;stroke:#07c;stroke-width:2}.ml-explorer-chart-container .values-dots circle,.ml-explorer-chart-container .values-dots-circle{fill:#07c;stroke-width:0}.ml-explorer-chart-container .values-dots circle.values-dots-circle-blur{fill:#98a2b3}.ml-explorer-chart-container .metric-value{fill:#0000;stroke:#07c;stroke-width:0;opacity:1}.ml-explorer-chart-container .anomaly-marker{stroke-width:1px;stroke:#98a2b3}.ml-explorer-chart-container .anomaly-marker:hover{stroke-width:6px;stroke:#07c}.ml-explorer-chart-container .anomaly-marker.critical{fill:#fe5050}.ml-explorer-chart-container .anomaly-marker.major{fill:#fba740}.ml-explorer-chart-container .anomaly-marker.minor{fill:#fdec25}.ml-explorer-chart-container .anomaly-marker.warning{fill:#8bc8fb}.ml-explorer-chart-container .anomaly-marker.low{fill:#d2e9f7}.ml-explorer-chart-container .anomaly-marker:hover,.ml-explorer-chart-container .metric-value:hover{stroke-width:6px;stroke-opacity:.65}.ml-explorer-chart{overflow:hidden}.ml-explorer-chart-content-wrapper{height:215px}.ml-explorer-chart-axis-emphasis{font-weight:700}",""]),e.exports=t},793:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(794);case"v8light":return r(796)}},794:function(e,t,r){var a=r(126),i=r(795);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},795:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}",""]),e.exports=t},796:function(e,t,r){var a=r(126),i=r(797);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},797:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-eui-icon-tip{max-width:none}.ml-explorer-chart-label-badges{align-items:center;display:flex;margin-top:4px}",""]),e.exports=t},798:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(799);case"v8light":return r(801)}},799:function(e,t,r){var a=r(126),i=r(800);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},800:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-info-tooltip{max-width:384px}.ml-explorer-chart-description{font-size:12px;font-style:italic}.ml-explorer-chart-info-tooltip .mlDescriptionList>*{margin-top:4px}.ml-explorer-chart-info-tooltip .mlDescriptionList{display:grid;grid-template-columns:max-content auto}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title{color:#fff;font-size:12px;font-weight:400;grid-column-start:1;white-space:nowrap}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description{color:#fff;font-size:12px;font-weight:700;grid-column-start:2;max-width:256px;padding-left:8px}",""]),e.exports=t},801:function(e,t,r){var a=r(126),i=r(802);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},802:function(e,t,r){(t=r(127)(!1)).push([e.i,".ml-explorer-chart-info-tooltip{max-width:384px}.ml-explorer-chart-description{font-size:12px;font-style:italic}.ml-explorer-chart-info-tooltip .mlDescriptionList>*{margin-top:4px}.ml-explorer-chart-info-tooltip .mlDescriptionList{display:grid;grid-template-columns:max-content auto}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title{color:#fff;font-size:12px;font-weight:400;grid-column-start:1;white-space:nowrap}.ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description{color:#fff;font-size:12px;font-weight:700;grid-column-start:2;max-width:256px;padding-left:8px}",""]),e.exports=t},803:function(e,t,r){switch(window.__kbnThemeTag__){case"v8dark":return r(804);case"v8light":return r(806)}},804:function(e,t,r){var a=r(126),i=r(805);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},805:function(e,t,r){(t=r(127)(!1)).push([e.i,".filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.filter-button .euiIcon{height:12px;width:12px}.filter-button:hover{opacity:1}",""]),e.exports=t},806:function(e,t,r){var a=r(126),i=r(807);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);a(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},807:function(e,t,r){(t=r(127)(!1)).push([e.i,".filter-button{height:16px;opacity:.5;transform:translateY(-1px);width:16px}.filter-button .euiIcon{height:12px;width:12px}.filter-button:hover{opacity:1}",""]),e.exports=t},811:function(e,t,r){"use strict";r.r(t),r.d(t,"getEntitiesQuery",(function(){return ae})),r.d(t,"ExplorerChartsContainerUI",(function(){return le})),r.d(t,"ExplorerChartsContainer",(function(){return ne})),r(788);var a=r(2),i=r.n(a),l=r(25),n=r(6),s=r(214),o=r(4),c=r.n(o),u=r(145),p=r.n(u),d=r(39),m=r.n(d),h=r(5),f=r(252),x=r(529),b=r(335),v=r(415),g=r(21),y=r(194),j=r(240),O=r(132);const k="rgba(0, 0, 0, 0)",I=170;var T=r(7);function S(e,t,r,a,i,l){var n,s,o,c;if(!i)return;const{lineChartXScale:u,margin:d}=i,m=t,h=p.a.select(m).select("#ml-explorer-chart-svg"+r);if(!h||!u)return;h.select(".ml-anomaly-chart-cursor-line").remove();const f=null!==(n=null==l||null===(s=l.crosshair)||void 0===s?void 0:s.line)&&void 0!==n?n:{visible:!0,stroke:"#69707D",strokeWidth:1,dash:[4,4]},x=e&&"Over"===e.type&&null!==e.x&&e.x>=a.plotEarliest&&e.x<=a.plotLatest?[e.x]:[],b=h.append("g").attr("class","ml-anomaly-chart-cursor").selectAll(".ml-anomaly-chart-cursor-line").data(x);b.enter().append("path").attr("class","ml-anomaly-chart-cursor-line").attr("d",(e=>{const t=u(e);return`M${t},170 ${t},0`})).style("stroke",f.stroke).style("stroke-width",`${f.strokeWidth}px`).style("stroke-dasharray",null!==(o=null===(c=f.dash)||void 0===c?void 0:c.join(","))&&void 0!==o?o:"4,4").attr("transform","translate("+d.left+","+d.top+")"),b.exit().remove()}class explorer_chart_distribution_ExplorerChartDistribution extends i.a.Component{constructor(e){super(e),this.chartScales=void 0,this.cursorStateSubscription=void 0}componentDidMount(){this.renderChart(),this.cursorStateSubscription=this.props.cursor$.pipe(Object(T.filter)((e=>e.isDateHistogram))).subscribe((e=>{S(e.cursor,this.rootNode,this.props.id,this.props.seriesConfig,this.chartScales,this.props.chartTheme)}))}componentWillUnmount(){var e;null===(e=this.cursorStateSubscription)||void 0===e||e.unsubscribe()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:e,tooltipService:t,timeBuckets:r,showSelectedInterval:a,onPointerUpdate:i,id:l}=this.props,n=this.rootNode,o=this.props.seriesConfig,c=this.props.severity;if(void 0===o||!1===Array.isArray(o.chartData))return;const u=this.context.services.mlServices.mlFieldFormatService.getFieldFormat(o.jobId,o.detectorIndex);let d=0;const g=Object(s.h)(o),j={top:10,right:0,bottom:30,left:0};g===O.b.POPULATION_DISTRIBUTION&&(j.left=60);let T,S=null,E=null,_=null;const w=g===O.b.EVENT_DISTRIBUTION?"entity":"value";let M=o.chartData.find((e=>void 0!==e.anomalyScore));M=M&&M.entity;var N;N=function({chartData:e,functionDescription:t}){const r=p.a.select(n).select(".content-wrapper");r.select("svg").remove();const a=n.clientWidth,i=I+j.top+j.bottom,c=r.append("svg").classed("ml-explorer-chart-svg",!0).attr("id","ml-explorer-chart-svg"+l).attr("width",a).attr("height",i),m=p.a.nest().key((e=>e.entity)).entries(e).sort(((e,t)=>t.values.length-e.values.length)).filter(((e,t)=>g!==O.b.EVENT_DISTRIBUTION||t<30||e.key===M)).map((e=>e.key));if(e=e.filter((e=>m.includes(e.entity))),g===O.b.POPULATION_DISTRIBUTION){const r=e.filter((e=>e.entity===M)),{min:a,max:i}=Object(s.e)(r,t);e=e.filter((e=>e.value<=i)),E=p.a.scale.linear().range([I,0]).domain([a<0?a:0,i]).nice()}else{if(g!==O.b.EVENT_DISTRIBUTION)throw new Error(`chartType '${g}' not supported`);{const e=5;E=p.a.scale.ordinal().rangePoints([e,I-e]).domain(m)}}const h=p.a.svg.axis().scale(E).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let f=0;const x=c.append("g").attr("class","temp-axis-label tick"),b=g===O.b.POPULATION_DISTRIBUTION?E.ticks():m;return x.selectAll("text.temp.axis").data(b).enter().append("text").text((e=>void 0!==u?u.convert(e,"text"):g===O.b.POPULATION_DISTRIBUTION?E.tickFormat()(e):e)).each((function(){f=Math.max(this.getBBox().width+h.tickPadding(),f)})).remove(),p.a.select(".temp-axis-label").remove(),(g===O.b.POPULATION_DISTRIBUTION||g===O.b.EVENT_DISTRIBUTION&&m.length<=10)&&(j.left=Math.max(f,40)),d=a-j.left-j.right,S=p.a.time.scale().range([0,d]).domain([o.plotEarliest,o.plotLatest]),_=p.a.svg.line().x((e=>S(e.date))).y((e=>E(e[w]))).defined((e=>null!==e.value)),T=c.append("g").attr("class","line-chart").attr("transform","translate("+j.left+","+j.top+")"),e}(o),T.append("rect").attr("x",0).attr("y",0).attr("height",I).attr("width",d).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),function(){const t={min:m()(o.plotEarliest),max:m()(o.plotLatest)};r.setBounds(t),r.setInterval("auto");const a=r.getScaledDateFormat(),i=Math.max(o.selectedEarliest,o.plotEarliest),l=o.selectedLatest-o.selectedEarliest+1,n=p.a.svg.axis().scale(S).orient("bottom").innerTickSize(-170).outerTickSize(0).tickPadding(10).tickFormat((e=>m()(e).format(a))),c=!0===e||l>=o.plotLatest-o.plotEarliest;if(!1===c){const e=Object(s.k)(i,l,o.plotEarliest,o.plotLatest);n.tickValues(e)}else n.ticks(Object(s.m)(d,a));const h=p.a.svg.axis().scale(E).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==u&&h.tickFormat((e=>u.convert(e,"text")));const f=T.append("g"),x=f.append("g").attr("class","x axis").attr("transform","translate(0,170)").call(n);f.append("g").attr("class","y axis").call(h),g===O.b.EVENT_DISTRIBUTION&&f.select(".y").selectAll("text").each((function(e){p.a.select(this).classed("ml-explorer-chart-axis-emphasis",e===M)})),!1===c&&Object(s.n)(x,i,l,d)}(),function(){if(!1===a)return;const e=Math.max(o.selectedEarliest,o.plotEarliest),t=Math.min(o.selectedLatest,o.plotLatest),r=S(t)-S(e);T.append("rect").attr("class","selected-interval").attr("x",S(new Date(e))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",r-4).attr("height",166)}(),function(e){e.append("rect").attr("x",0).attr("y",0).attr("height",I).attr("width",d).on("mouseout",(function(){i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Out",unit:void 0})})).on("mousemove",(function(){const e=p.a.mouse(this);i&&i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Over",unit:void 0,x:1e3*m()(S.invert(e[0])).unix()})})).style("fill",k)}(T),function(e,t,r,a=1.5){const i=(t.select(".values-dots").empty()?t.append("g").classed("values-dots",!0):t.select(".values-dots")).selectAll("circle").data(e);i.enter().append("circle").classed("values-dots-circle",!0).classed("values-dots-circle-blur",(e=>e.entity!==M)).attr("r",(e=>e.entity===M?1.5*a:a)),i.attr("cx",r.x()).attr("cy",r.y()),i.exit().remove()}(N,T,_),function(e){const r=T.append("g").attr("class","chart-markers").selectAll(".metric-value").data(e.filter((e=>null!==e.value)));r.exit().remove(),r.enter().append("circle").attr("r",s.b).on("mouseover",(function(e){!function(e,r){const a=[{label:Object(v.b)(e.date)}],i=o.detectorLabel;if(void 0!==e.entity&&a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.entityLabel",{defaultMessage:"entity"}),value:e.entity,seriesIdentifier:{key:i},valueAccessor:"entity"}),void 0!==e.anomalyScore){const t=parseInt(e.anomalyScore),r=Object(x.a)(t);a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:r,color:Object(b.a)(t),seriesIdentifier:{key:i},valueAccessor:"anomaly_score"}),g!==O.b.EVENT_DISTRIBUTION&&(a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.valueLabel",{defaultMessage:"value"}),value:Object(y.b)(e.value,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"value"}),void 0!==e.numberOfCauses&&1!==e.numberOfCauses||a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.typicalLabel",{defaultMessage:"typical"}),value:Object(y.b)(e.typical,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"typical"}),void 0!==e.byFieldName&&void 0!==e.numberOfCauses&&a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:e.numberOfCauses,byFieldName:e.byFieldName,plusSign:e.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:i},valueAccessor:"numberOfCauses"}))}else g!==O.b.EVENT_DISTRIBUTION&&a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(y.b)(e.value,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"value"});void 0!==e.scheduledEvents&&e.scheduledEvents.forEach(((t,r)=>{a.push({label:h.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.scheduledEventsLabel",{defaultMessage:"scheduled event{counter}",values:{counter:e.scheduledEvents.length>1?` #${r+1}`:""}}),value:t,seriesIdentifier:{key:i},valueAccessor:`scheduled_events_${r+1}`})})),t.show(a,r,{x:3*s.b,y:2*s.b})}(e,this)})).on("mouseout",(()=>t.hide())),r.attr("cx",(e=>S(e.date))).attr("cy",(e=>E(e[w]))).attr("class",(e=>{let t="metric-value";return void 0!==e.anomalyScore&&Number(e.anomalyScore)>=c&&(t+=" anomaly-marker ",t+=Object(f.e)(e.anomalyScore).id),t}));const a=T.select(".chart-markers").selectAll(".scheduled-event-marker").data(e.filter((e=>void 0!==e.scheduledEvents)));a.exit().remove(),a.enter().append("rect").attr("width",2*s.b).attr("height",5).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),a.attr("x",(e=>S(e.date)-s.b)).attr("y",(e=>E(e[w])-2.5))}(N),this.chartScales={lineChartXScale:S,margin:j}}shouldComponentUpdate(){return!0}setRef(e){this.rootNode=e}render(){const{seriesConfig:e}=this.props;if(void 0===e)return null;const t=e.loading;return Object(n.jsx)("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},t&&Object(n.jsx)(j.a,{height:215}),!t&&Object(n.jsx)("div",{className:"content-wrapper"}))}}c()(explorer_chart_distribution_ExplorerChartDistribution,"contextType",g.context);const E="ml-explorer-chart-content-wrapper";class explorer_chart_single_metric_ExplorerChartSingleMetric extends i.a.Component{constructor(e){super(e),this.chartScales=void 0}componentDidMount(){this.renderChart(),this.cursorStateSubscription=this.props.cursor$.pipe(Object(T.filter)((e=>e.isDateHistogram))).subscribe((e=>{S(e.cursor,this.rootNode,this.props.id,this.props.seriesConfig,this.chartScales,this.props.chartTheme)}))}componentWillUnmount(){var e;null===(e=this.cursorStateSubscription)||void 0===e||e.unsubscribe()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:e,tooltipService:t,timeBuckets:r,showSelectedInterval:a,onPointerUpdate:i,id:l}=this.props,n=this.rootNode,o=this.props.seriesConfig,c=this.props.severity;if(void 0===o||!1===Array.isArray(o.chartData))return;const u=this.context.services.mlServices.mlFieldFormatService.getFieldFormat(o.jobId,o.detectorIndex);let d=0;const g={top:10,right:0,bottom:30,left:60};let j,O=null,T=null,S=null;var _;function w(e,r){const a=[{label:Object(v.b)(e.date)}],i=o.detectorLabel;if(void 0!==e.anomalyScore){const t=parseInt(e.anomalyScore);a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:Object(x.a)(t),color:Object(b.a)(t),seriesIdentifier:{key:i},valueAccessor:"anomaly_score"}),!0===Object(s.p)(e)&&a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.multiBucketImpactLabel",{defaultMessage:"multi-bucket impact"}),value:Object(s.j)(e),seriesIdentifier:{key:i},valueAccessor:"multi_bucket_impact"}),void 0!==e.actual&&"rare"!==o.functionDescription?(a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.actualLabel",{defaultMessage:"actual"}),value:Object(y.b)(e.actual,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"actual"}),a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.typicalLabel",{defaultMessage:"typical"}),value:Object(y.b)(e.typical,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"typical"})):(a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.valueLabel",{defaultMessage:"value"}),value:Object(y.b)(e.value,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"value"}),void 0!==e.byFieldName&&void 0!==e.numberOfCauses&&a.push({label:h.i18n.translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:e.numberOfCauses,byFieldName:e.byFieldName,plusSign:e.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:i},valueAccessor:"numberOfCauses"}))}else a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(y.b)(e.value,o.functionDescription,u),seriesIdentifier:{key:i},valueAccessor:"value"});void 0!==e.scheduledEvents&&a.push({label:h.i18n.translate("xpack.ml.explorer.singleMetricChart.scheduledEventsLabel",{defaultMessage:"Scheduled events"}),value:e.scheduledEvents,seriesIdentifier:{key:i},valueAccessor:"scheduledEvents"}),t.show(a,r,{x:3*s.b,y:2*s.b})}!function(e){const t=p.a.select(n).select(`.${E}`);t.select("svg").remove();const r=n.clientWidth,a=I+g.top+g.bottom,i=t.append("svg").classed("ml-explorer-chart-svg",!0).attr("id","ml-explorer-chart-svg"+l).attr("width",r).attr("height",a);T=p.a.scale.linear().range([I,0]).domain([e.min,e.max]).nice();const s=p.a.svg.axis().scale(T).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let c=0;i.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data(T.ticks()).enter().append("text").text((e=>void 0!==u?u.convert(e,"text"):T.tickFormat()(e))).each((function(){c=Math.max(this.getBBox().width+s.tickPadding(),c)})).remove(),p.a.select(".temp-axis-label").remove(),g.left=Math.max(c,40),d=r-g.left-g.right,O=p.a.time.scale().range([0,d]).domain([o.plotEarliest,o.plotLatest]),S=p.a.svg.line().x((e=>O(e.date))).y((e=>T(e.value))).defined((e=>null!==e.value)),j=i.append("g").attr("class","line-chart").attr("transform","translate("+g.left+","+g.top+")")}(o.chartLimits),_=o.chartData,j.append("rect").attr("x",0).attr("y",0).attr("height",I).attr("width",d).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),function(){const t={min:m()(o.plotEarliest),max:m()(o.plotLatest)};r.setBounds(t),r.setInterval("auto");const a=r.getScaledDateFormat(),i=Math.max(o.selectedEarliest,o.plotEarliest),l=o.selectedLatest-o.selectedEarliest+1,n=p.a.svg.axis().scale(O).orient("bottom").innerTickSize(-170).outerTickSize(0).tickPadding(10).tickFormat((e=>m()(e).format(a))),c=!0===e||l>=o.plotLatest-o.plotEarliest;if(!1===c){const e=Object(s.k)(i,l,o.plotEarliest,o.plotLatest);n.tickValues(e)}else n.ticks(Object(s.m)(d,a));const h=p.a.svg.axis().scale(T).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==u&&h.tickFormat((e=>u.convert(e,"text")));const f=j.append("g"),x=f.append("g").attr("class","x axis").attr("transform","translate(0,170)").call(n);f.append("g").attr("class","y axis").call(h),!1===c&&Object(s.n)(x,i,l,d)}(),function(){if(!1===a)return;const e=Math.max(o.selectedEarliest,o.plotEarliest),t=Math.min(o.selectedLatest,o.plotLatest),r=O(t)-O(e);j.append("rect").attr("class","selected-interval").attr("x",O(new Date(e))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",r-4).attr("height",166)}(),function(e){e.append("rect").attr("x",0).attr("y",0).attr("height",I).attr("width",d).on("mouseout",(function(){i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Out",unit:void 0})})).on("mousemove",(function(){const e=p.a.mouse(this);i&&i({chartId:"ml-anomaly-chart-metric",scale:"time",smHorizontalValue:null,smVerticalValue:null,type:"Over",unit:void 0,x:1e3*m()(O.invert(e[0])).unix()})})).style("fill",k)}(j),function(e){j.append("path").attr("class","values-line").attr("d",S(e))}(_),Object(s.f)(_,j,S),function(e){const r=j.append("g").attr("class","chart-markers").selectAll(".metric-value").data(e.filter((e=>(null!==e.value||"number"==typeof e.anomalyScore)&&!Object(s.o)(e))));r.exit().remove(),r.enter().append("circle").attr("r",s.b).on("mouseover",(function(e){w(e,this)})).on("mouseout",(()=>t.hide()));const a=e=>void 0!==e.anomalyScore&&Number(e.anomalyScore)>=c;r.attr("cx",(e=>O(e.date))).attr("cy",(e=>T(e.value))).attr("class",(e=>{let t="metric-value";return a(e)&&(t+=` anomaly-marker ${Object(f.e)(e.anomalyScore).id}`),t}));const i=j.select(".chart-markers").selectAll(".multi-bucket").data(e.filter((e=>a(e)&&!0===Object(s.o)(e))));i.exit().remove(),i.enter().append("path").attr("d",p.a.svg.symbol().size(s.c).type("cross")).attr("transform",(e=>`translate(${O(e.date)}, ${T(e.value)})`)).attr("class",(e=>`anomaly-marker multi-bucket ${Object(f.e)(e.anomalyScore).id}`)).on("mouseover",(function(e){w(e,this)})).on("mouseout",(()=>t.hide()));const l=j.select(".chart-markers").selectAll(".scheduled-event-marker").data(e.filter((e=>void 0!==e.scheduledEvents)));l.exit().remove(),l.enter().append("rect").attr("width",2*s.b).attr("height",s.d).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),l.attr("x",(e=>O(e.date)-s.b)).attr("y",(e=>T(e.value)-s.d/2))}(_),this.chartScales={lineChartXScale:O,margin:g}}shouldComponentUpdate(){return!0}setRef(e){this.rootNode=e}render(){const{seriesConfig:e}=this.props;if(void 0===e)return null;const t=e.loading;return Object(n.jsx)("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},t&&Object(n.jsx)(j.a,{height:215}),!t&&Object(n.jsx)("div",{className:E}))}}function _({entity:e}){return Object(n.jsx)("span",{className:"ml-explorer-chart-label-badge"},Object(n.jsx)(l.EuiBadge,{color:"hollow",className:"ml-reset-font-weight"},e.fieldName," ",Object(n.jsx)("strong",null,e.fieldValue)))}c()(explorer_chart_single_metric_ExplorerChartSingleMetric,"contextType",g.context),r(793),r(798);const w={[O.b.EVENT_DISTRIBUTION]:h.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartEventDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of occurrences over time for a sample of {byFieldValuesParam} with more frequent event types at the top and rarer ones at the bottom.",values:{byFieldValuesParam:"by_field_values"}}),[O.b.POPULATION_DISTRIBUTION]:h.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartPopulationDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of values over time for a sample of {overFieldValuesParam}.",values:{overFieldValuesParam:"over_field_values"}})};function M({toolTipData:e}){return Object(n.jsx)("dl",{className:"mlDescriptionList"},e.map((({title:e,description:t})=>Object(n.jsx)(i.a.Fragment,{key:`${e} ${t}`},Object(n.jsx)("dt",{className:"mlDescriptionList__title"},e),Object(n.jsx)("dd",{className:"mlDescriptionList__description"},t)))))}const N=({jobId:e,aggregationInterval:t,chartFunction:r,chartType:a,entityFields:s=[]})=>{const o=w[a],c=[{title:h.i18n.translate("xpack.ml.explorer.charts.infoTooltip.jobIdTitle",{defaultMessage:"job ID"}),description:e},{title:h.i18n.translate("xpack.ml.explorer.charts.infoTooltip.aggregationIntervalTitle",{defaultMessage:"aggregation interval"}),description:t},{title:h.i18n.translate("xpack.ml.explorer.charts.infoTooltip.chartFunctionTitle",{defaultMessage:"chart function"}),description:r}];return s.forEach((e=>{c.push({title:e.fieldName,description:e.fieldValue})})),Object(n.jsx)("div",{className:"ml-explorer-chart-info-tooltip"},Object(n.jsx)(M,{toolTipData:c}),o&&Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)(l.EuiSpacer,{size:"s"}),Object(n.jsx)("div",{className:"ml-explorer-chart-description"},o)))};var C=r(15),F=r(221);r(803);const L=({onFilter:e,influencerFieldName:t,influencerFieldValue:r})=>Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)(l.EuiToolTip,{content:Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.entityFilter.addFilterTooltip",defaultMessage:"Add filter"})},Object(n.jsx)(l.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(F.a)((()=>{e({influencerFieldName:t,influencerFieldValue:r,action:f.a.ADD})})),iconType:"plusInCircle","aria-label":h.i18n.translate("xpack.ml.entityFilter.addFilterAriaLabel",{defaultMessage:"Add filter for {influencerFieldName} {influencerFieldValue}",values:{influencerFieldName:t,influencerFieldValue:r}})})),Object(n.jsx)(l.EuiToolTip,{content:Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.entityFilter.removeFilterTooltip",defaultMessage:"Remove filter"})},Object(n.jsx)(l.EuiButtonIcon,{size:"s",className:"filter-button",onClick:Object(F.a)((()=>{e({influencerFieldName:t,influencerFieldValue:r,action:f.a.REMOVE})})),iconType:"minusInCircle","aria-label":h.i18n.translate("xpack.ml.entityFilter.removeFilterAriaLabel",{defaultMessage:"Remove filter for {influencerFieldName} {influencerFieldValue}",values:{influencerFieldName:t,influencerFieldValue:r}})})));function A({detectorLabel:e,entityFields:t,infoTooltip:r,wrapLabel:s=!1,onSelectEntity:o}){const c=!0===s||0===t.length||0===e.length?Object(n.jsx)(i.a.Fragment,null," "):Object(n.jsx)(i.a.Fragment,null," – "),u=Object(a.useCallback)((({influencerFieldName:e,influencerFieldValue:t,action:r})=>o(e,t,r)),[o]),p=t.map((e=>{const t=`${r.chartFunction}-${e.fieldName}-${e.fieldType}-${e.fieldValue}`;return Object(n.jsx)(a.Fragment,{key:`badge-wrapper-${t}`},Object(n.jsx)(_,{entity:e}),void 0!==o&&Object(n.jsx)(L,{onFilter:u,influencerFieldName:e.fieldName,influencerFieldValue:e.fieldValue}))})),d=Object(n.jsx)("span",{className:"ml-explorer-chart-info-icon"},Object(n.jsx)(l.EuiIconTip,{className:"ml-explorer-chart-eui-icon-tip",content:Object(n.jsx)(N,r),position:"top",size:"s"}));return Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)("span",{className:"ml-explorer-chart-label"},Object(n.jsx)("span",{className:"ml-explorer-chart-label-detector"},e,c),s&&d,!s&&Object(n.jsx)(i.a.Fragment,null,p," ",d)),s&&Object(n.jsx)("span",{className:"ml-explorer-chart-label-badges"},p))}var D=r(247),B=r(309),V=r(10),P=r(830),R=r(208),U=r(78),z=r(98);const $=({errorMessagesByType:e})=>{if(!e||0===Object.keys(e).length)return null;const t=Object.keys(e).map((t=>Object(n.jsx)(l.EuiCallOut,{color:"warning",size:"s",key:t},Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.explorerCharts.errorCallOutMessage",defaultMessage:"You can't view anomaly charts for {jobs} because {reason}.",values:{jobs:[...e[t]].join(", "),reason:t}}))));return Object(n.jsx)(i.a.Fragment,null,t,Object(n.jsx)(l.EuiSpacer,{size:"m"}))};var G=r(236),Y=r(349);function W(e,t){const r=[];for(let i=0;i<e.length;i++){var a;const l=e[i],n=l.geo_results||(null==l?void 0:l.causes)&&(null==l||null===(a=l.causes[0])||void 0===a?void 0:a.geo_results),s=n&&n[t];if(void 0!==s){const e=s.split(",").map((e=>Number(e))).reverse();r.push({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{record_score:Math.floor(l.record_score),[t]:e.map((e=>Number(e.toFixed(2))))}})}}return r}const H=e=>({id:"anomalies_typical_layer",label:"Typical",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854e",type:"GEOJSON_FILE",__featureCollection:{features:W(e,"typical_point"),type:"FeatureCollection"}},visible:!0,style:{type:"VECTOR",properties:{fillColor:{type:"STATIC",options:{color:"#98A2B2"}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:U.LAYER_TYPE.GEOJSON_VECTOR}),q=e=>({id:"anomalies_actual_layer",label:"Actual",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854d",type:"GEOJSON_FILE",__fields:[{name:"record_score",type:"number"}],__featureCollection:{features:W(e,"actual_point"),type:"FeatureCollection"}},visible:!0,style:{type:"VECTOR",properties:{fillColor:{type:U.STYLE_TYPE.DYNAMIC,options:{customColorRamp:Y.d,field:{name:"record_score",origin:U.FIELD_ORIGIN.SOURCE},useCustomColorRamp:!0}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:U.LAYER_TYPE.GEOJSON_VECTOR});function X({seriesConfig:e}){const{services:{maps:t}}=Object(V.d)(),[r,i]=Object(a.useState)([]);return Object(a.useEffect)((()=>{e.mapData&&e.mapData.length>0&&i([q(e.mapData),H(e.mapData)])}),[e]),t?Object(n.jsx)("div",{"data-test-subj":"xpack.ml.explorer.embeddedMap",style:{width:"100%",height:300}},Object(n.jsx)(t.Map,{layerList:r,hideFilterActions:!0,mapSettings:{initialLocation:U.INITIAL_LOCATION.AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:!0}})):null}var J=r(108),K=r(76),Q=r(135);const Z=h.i18n.translate("xpack.ml.explorer.charts.tooManyBucketsDescription",{defaultMessage:"This selection contains too many buckets to be displayed. You should shorten the time range of the view or narrow the selection in the timeline."}),ee=h.i18n.translate("xpack.ml.explorer.charts.openInSingleMetricViewerButtonLabel",{defaultMessage:"Open in Single Metric Viewer"}),te=h.i18n.translate("xpack.ml.explorer.charts.mapsPluginMissingMessage",{defaultMessage:"maps or embeddable start plugin not found"}),re=h.i18n.translate("xpack.ml.explorer.charts.openInMapsPluginMessage",{defaultMessage:"Open in Maps"});function ae(e){var t;const r=null===(t=e.entityFields)||void 0===t?void 0:t.map((({fieldName:e,fieldValue:t})=>Object(Q.e)(e,t))).join(" or ");return{query:{language:D.a.KUERY,query:r},queryString:r}}function ie({id:e,series:t,severity:r,tooManyBuckets:o,wrapLabel:c,mlLocator:u,timeBuckets:p,timefilter:d,timeRange:m,onSelectEntity:f,recentlyAccessed:x,tooManyBucketsCalloutMsg:b,showSelectedInterval:v,chartsService:g}){const[y,j]=Object(a.useState)(""),[k,I]=Object(a.useState)(""),{services:{share:T,application:{navigateToApp:S}}}=Object(V.d)(),E=Object(a.useCallback)((async()=>{const{queryString:e,query:r}=ae(t),a=Object(R.c)(t.jobId),i=T.url.locators.get(z.MAPS_APP_LOCATOR);return await i.getLocation({initialLayers:a,timeRange:null!=m?m:null==d?void 0:d.getTime(),...void 0!==e?{query:r}:{}})}),[null==t?void 0:t.jobId,m]);Object(a.useEffect)((()=>{let e=!1;return(async()=>{let r=m;const a=null==d?void 0:d.getActiveBounds();if(!m&&a&&(r={from:a.min.toISOString(),to:a.max.toISOString()}),!e&&t.functionDescription!==P.b.LAT_LONG)try{const e=await Object(s.i)(u,t,r);j(e)}catch(e){j("")}})(),()=>{e=!0}}),[u,t,m]),Object(a.useEffect)((function(){let e=!1;if(t&&Object(s.h)(t)===O.b.GEO_MAP){const t=async()=>{try{const t=await E();e||I(null==t?void 0:t.path)}catch(e){console.error(e),I("")}};t().catch(console.error)}return()=>{e=!0}}),[t]);const _=Object(a.useRef)(null),{euiTheme:w}=Object(l.useEuiTheme)(),M=g.theme.useChartsBaseTheme(),N=Object(J.useActiveCursor)(g.activeCursor,_,{isDateHistogram:!0}),F=Object(a.useCallback)((()=>{x&&Object(G.a)("timeseriesexplorer",t.jobId,y,x)}),[y,x]),{detectorLabel:L,entityFields:D}=t,$=Object(s.h)(t);let Y=Object(n.jsx)(i.a.Fragment,null,L);if($===O.b.EVENT_DISTRIBUTION){const e=t.entityFields.find((e=>"by"===e.fieldType));void 0!==e&&(Y=Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.explorer.charts.detectorLabel",defaultMessage:'{detectorLabel}{br}y-axis event distribution split by "{fieldName}"',values:{detectorLabel:L,br:Object(n.jsx)("br",null),fieldName:e.fieldName}})),c=!0)}return Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)("div",{style:{width:0,height:0}},Object(n.jsx)(K.Chart,{ref:_},Object(n.jsx)(K.Settings,{baseTheme:K.LEGACY_LIGHT_THEME,noResults:Object(n.jsx)("div",null),width:0,height:0,locale:h.i18n.getLocale()}),Object(n.jsx)(K.BarSeries,{id:"count",xAccessor:"x",yAccessors:["y"],data:[]}))),Object(n.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(n.jsx)(l.EuiFlexItem,{grow:!1},Object(n.jsx)(A,{detectorLabel:Y,entityFields:D,infoTooltip:{...t.infoTooltip,chartType:$},wrapLabel:c,onSelectEntity:f})),Object(n.jsx)(l.EuiFlexItem,{grow:!1},Object(n.jsx)("div",{css:Object(n.css)("padding:",w.size.xs,";","")},o&&Object(n.jsx)(l.EuiIconTip,{content:null!=b?b:Z,position:"top",size:"s",type:"warning",color:"warning"}),y&&Object(n.jsx)(l.EuiToolTip,{position:"top",content:ee},Object(n.jsx)(l.EuiButtonEmpty,{iconSide:"right",iconType:"visLine",size:"xs",href:y,onClick:F},Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.explorer.charts.viewLabel",defaultMessage:"View"}))),$===O.b.GEO_MAP&&k?Object(n.jsx)(l.EuiToolTip,{position:"top",content:re},Object(n.jsx)(l.EuiButtonEmpty,{iconSide:"right",iconType:"logoMaps",size:"xs",onClick:async()=>{await S(U.APP_ID,{path:k})}},Object(n.jsx)(C.FormattedMessage,{id:"xpack.ml.explorer.charts.viewInMapsLabel",defaultMessage:"View"}))):null))),$===O.b.GEO_MAP?Object(n.jsx)(B.a,null,(e=>Object(n.jsx)(X,{seriesConfig:t,tooltipService:e}))):$===O.b.EVENT_DISTRIBUTION||$===O.b.POPULATION_DISTRIBUTION?Object(n.jsx)(B.a,null,(a=>Object(n.jsx)(explorer_chart_distribution_ExplorerChartDistribution,{id:e,timeBuckets:p,tooManyBuckets:o,seriesConfig:t,severity:r,tooltipService:a,showSelectedInterval:v,onPointerUpdate:N,chartTheme:M,cursor$:g.activeCursor.activeCursor$}))):$===O.b.SINGLE_METRIC?Object(n.jsx)(B.a,null,(a=>Object(n.jsx)(explorer_chart_single_metric_ExplorerChartSingleMetric,{id:e,timeBuckets:p,tooManyBuckets:o,seriesConfig:t,severity:r,tooltipService:a,showSelectedInterval:v,onPointerUpdate:N,chartTheme:M,cursor$:g.activeCursor.activeCursor$}))):void 0)}const le=({id:e,chartsPerRow:t,seriesToPlot:r,severity:a,tooManyBuckets:o,kibana:c,errorMessages:u,mlLocator:p,timeBuckets:d,timefilter:m,timeRange:h,onSelectEntity:f,tooManyBucketsCalloutMsg:x,showSelectedInterval:b,chartsService:v})=>{const{services:{chrome:{recentlyAccessed:g},embeddable:y,maps:j}}=c;let O;y&&j||(O=[],r.forEach((e=>{"lat_long"===e.functionDescription?void 0===u[te]?u[te]=new Set([e.jobId]):u[te].add(e.jobId):O.push(e)})));const k=void 0!==O?O:r,I=1===t?"calc(100% - 20px)":"auto",T=1===t?0:t,S=k.some((e=>Object(s.l)(e)));return Object(n.jsx)(i.a.Fragment,null,Object(n.jsx)($,{errorMessagesByType:u}),Object(n.jsx)(l.EuiFlexGrid,{columns:T,gutterSize:"m","data-test-subj":"mlExplorerChartsContainer"},k.length>0&&k.map(((t,r)=>{const i=function(e,t){const{jobId:r,detectorLabel:a}=e;return`${r}${a}`.replace(/[^a-zA-Z]+/g,"")+t}(t,"-"+(null!=e?e:"")+r);return Object(n.jsx)(l.EuiFlexItem,{key:i,className:"ml-explorer-chart-container",style:{minWidth:I}},Object(n.jsx)(ie,{key:i,id:i,series:t,severity:a,tooManyBuckets:o,wrapLabel:S,mlLocator:p,timeBuckets:d,timefilter:m,timeRange:h,onSelectEntity:f,recentlyAccessed:g,tooManyBucketsCalloutMsg:x,showSelectedInterval:b,chartsService:v}))}))))},ne=Object(g.withKibana)(le)}}]);