/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[44],{167:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var s=a(116);const i=Object(s.a)((async()=>({default:(await a.e(96).then(a.bind(null,230))).JobSpacesSyncFlyout})))},184:function(e,t,a){"use strict";a.d(t,"e",(function(){return d})),a.d(t,"f",(function(){return m})),a.d(t,"a",(function(){return b})),a.d(t,"d",(function(){return j})),a.d(t,"b",(function(){return O})),a.d(t,"c",(function(){return y}));var s=a(8),i=a(39),l=a.n(i),n=a(31),o=a.n(n),r=a(40),c=a(135);const u="auto";function d(e,t,a){const s=e.url_value,i={...t};return s.includes("$earliest$")&&void 0!==a&&(i.earliest=a.from),s.includes("$latest$")&&void 0!==a&&(i.latest=a.to),b(e,i)}function m(e,t,a,s){const i=e.url_value,n=a[s],o="time_range"in e&&e.time_range?Object(r.a)(e.time_range):null,c={...a};if(i.includes("$earliest$")){const e=l()(n);null!==o?e.subtract(o):e.subtract(t,"s"),c.earliest=e.toISOString()}if(i.includes("$latest$")){const e=l()(n).add(t,"s");null!==o?e.add(o):e.add(t,"s"),c.latest=e.toISOString()}return b(e,c)}function b(e,t){return!0===x(e)?function(e,t){const a=e.url_value,i=a.includes("language:lucene"),l=i?c.c:p,n=Object(s.flow)(encodeURIComponent),r=e=>{const a=Object(s.flow)(i?e=>e:l,n);return e.replace(/\$([^?&$\'"]+)\$(\/)?/g,((e,i,l="")=>{let n=Object(s.get)(t,i);return n=Array.isArray(n)?n[0]:n,void 0===n?"":a(n)+l}))};return Object(s.flow)(decodeURIComponent,(e=>e.replace("$earliest$",t.earliest).replace("$latest$",t.latest)),(e=>{const a=Object(s.flow)(l,n),i=g(t,a),c=e.match(/(.+)(\(.*\blanguage:(?:lucene|kuery)\b.*?\))(.+)/);if(null!==c&&void 0!==c[2]){const[,e,t,a]=c,s=t.indexOf("language:kuery")>-1,l=o.a.decode(t);if(f(l)&&l.hasOwnProperty("query")){const[t,n]=[e,a].map(r),c=i(t,l.query,n,s);return`${t}${o.a.encode({...l,query:c})}${n}`}}return e.replace(/(.+&kuery=)(.*?)[^!](&.+)/,((t,a,s,l)=>{const[n,o]=[a,l].map(r);return`${n}${i(n,s,o,e.indexOf("language:kuery")>-1)}${o}`}))}),r)(a)}(e,t):Object(c.g)(e.url_value,t,!1)}function j(e,t,a){if(!1===/^(?:[a-z]+:)?\/\//i.test(t.url_value))"/"!==e.charAt(0)&&(e=`${a}${x(t)?"/app/":"/"}${e}`),window.open(e,"_blank");else{const t=window.open(e,"_blank","noopener,noreferrer");null!=t&&(t.opener=null)}}function x(e){const t=e.url_value;return t.startsWith("discover#/")||t.startsWith("dashboards#/")||t.startsWith("apm#/")||t.startsWith("metrics/")||t.startsWith("security/")||t.startsWith("siem#/")}function p(e){return String(e).replace(/\"/g,'\\"')}const f=e=>null!==e&&"object"==typeof e,g=(e,t)=>(a,i,l,n)=>{let o=2e3-a.length-l.length;const r=i.split(/\sand\s/i).map((e=>(e=>{let t="";for(let a=0;a<e.length;a++)if("$"===e[a]){let s=a;for(let t=s;t>-1;t--)if(":"===e[t]){s=t;break}t=e.slice(0,s).trim();let i=e.slice(s,e.length);const l=i.indexOf("$"),n=i.lastIndexOf("$");if(i=i.slice(l,n+1),i===`$${t}$`)break}return t})(String(e).replace(/\\/g,"")))),u=[];e:for(let a=0;a<r.length;a++){const i=r[a],l=n?`"${r[a]}"`:Object(c.c)(i);let d=Object(s.get)(e,i)||null;if(null===d)continue;d=Array.isArray(d)?d:[d];let m="";for(let e=0;e<d.length;e++){const a=`${e>0?" OR ":""}${l}:"${t(d[e])}"`;if(o<a.length){m.length>0&&u.push(e>0?`(${m})`:m);break e}m+=a,o-=m.length}m.length>0&&u.push(d.length>1?`(${m})`:m)}return u.join(" AND ")};function O(e,t){let a=void 0!==e&&e.trim().length>0;return!0===a&&void 0!==t&&(a=!t.map((e=>e.url_name)).includes(e)),a}function y(e){return void 0===e||0===e.length||e===u||null!==Object(r.a)(e)}},212:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(2),i=a(5),l=a(25),n=(a(368),a(6));const o=({onClick:e})=>Object(n.jsx)(l.EuiButtonIcon,{className:"mlHelpPopover__buttonIcon",size:"s",iconType:"help","aria-label":i.i18n.translate("xpack.ml.helpPopover.ariaLabel",{defaultMessage:"Help"}),onClick:e}),r=({anchorPosition:e,children:t,title:a})=>{const[i,r]=Object(s.useState)(!1);return Object(n.jsx)(l.EuiPopover,{anchorPosition:e,button:Object(n.jsx)(o,{onClick:r.bind(null,!i)}),className:"mlHelpPopover",closePopover:r.bind(null,!1),isOpen:i,ownFocus:!0,panelClassName:"mlHelpPopover__panel",panelPaddingSize:"none"},a&&Object(n.jsx)(l.EuiPopoverTitle,{paddingSize:"s"},a),Object(n.jsx)(l.EuiText,{className:"mlHelpPopover__content eui-scrollBar",size:"s",tabIndex:0},t))}},267:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={id:"model_id",description:"description",createdAt:"create_time",type:"type",modelType:"model_type"}},297:function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"c",(function(){return c})),a.d(t,"j",(function(){return u})),a.d(t,"i",(function(){return d})),a.d(t,"b",(function(){return m})),a.d(t,"f",(function(){return b})),a.d(t,"a",(function(){return j})),a.d(t,"e",(function(){return x})),a.d(t,"d",(function(){return p})),a.d(t,"h",(function(){return f}));var s=a(5);const i=".elser_model_2",l=".elser_model_2_linux-x86_64",n=".multilingual-e5-small",o=".multilingual-e5-small_linux-x86_64",r=".elser_model_1",c={STARTED:"started",STARTING:"starting",STOPPING:"stopping"},u={PYTORCH:"pytorch",TREE_ENSEMBLE:"tree_ensemble",LANG_IDENT:"lang_ident"},d={NER:"ner",QUESTION_ANSWERING:"question_answering",ZERO_SHOT_CLASSIFICATION:"zero_shot_classification",TEXT_CLASSIFICATION:"text_classification",TEXT_EMBEDDING:"text_embedding",FILL_MASK:"fill_mask",TEXT_EXPANSION:"text_expansion"},m=s.i18n.translate("xpack.ml.trainedModels.modelsList.builtInModelLabel",{defaultMessage:"built-in"}),b="elastic",j="prepackaged",x="elastic",p=Object.freeze({[r]:{modelName:"elser",hidden:!0,version:1,config:{input:{field_names:["text_field"]}},description:s.i18n.translate("xpack.ml.trainedModels.modelsList.elserDescription",{defaultMessage:"Elastic Learned Sparse EncodeR v1 (Tech Preview)"}),type:["elastic","pytorch","text_expansion"]},[i]:{modelName:"elser",version:2,default:!0,config:{input:{field_names:["text_field"]}},description:s.i18n.translate("xpack.ml.trainedModels.modelsList.elserV2Description",{defaultMessage:"Elastic Learned Sparse EncodeR v2"}),type:["elastic","pytorch","text_expansion"]},[l]:{modelName:"elser",version:2,os:"Linux",arch:"amd64",config:{input:{field_names:["text_field"]}},description:s.i18n.translate("xpack.ml.trainedModels.modelsList.elserV2x86Description",{defaultMessage:"Elastic Learned Sparse EncodeR v2, optimized for linux-x86_64"}),type:["elastic","pytorch","text_expansion"]},[n]:{modelName:"e5",version:1,default:!0,config:{input:{field_names:["text_field"]}},description:s.i18n.translate("xpack.ml.trainedModels.modelsList.e5v1Description",{defaultMessage:"E5 (EmbEddings from bidirEctional Encoder rEpresentations)"}),license:"MIT",licenseUrl:"https://huggingface.co/elastic/multilingual-e5-small",type:["pytorch","text_embedding"]},[o]:{modelName:"e5",version:1,os:"Linux",arch:"amd64",config:{input:{field_names:["text_field"]}},description:s.i18n.translate("xpack.ml.trainedModels.modelsList.e5v1x86Description",{defaultMessage:"E5 (EmbEddings from bidirEctional Encoder rEpresentations), optimized for linux-x86_64"}),license:"MIT",licenseUrl:"https://huggingface.co/elastic/multilingual-e5-small_linux-x86_64",type:["pytorch","text_embedding"]}}),f={...c,DOWNLOADING:"downloading",DOWNLOADED:"downloaded",NOT_DOWNLOADED:"notDownloaded"}},368:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(369);case"v8light":return a(371)}},369:function(e,t,a){var s=a(126),i=a(370);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},370:function(e,t,a){(t=a(127)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},371:function(e,t,a){var s=a(126),i=a(372);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},372:function(e,t,a){(t=a(127)(!1)).push([e.i,'.mlHelpPopover__panel{max-width:480px}.mlHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:8px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mlHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.mlHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mlHelpPopover__content::-webkit-scrollbar-corner,.mlHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.mlHelpPopover__content:focus{outline:none}.mlHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},398:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return g}));var s=a(2),i=a.n(s),l=a(25),n=a(5),o=a(15),r=a(297),c=a(46),u=a(71),d=a(267),m=a(10),b=a(6);function j(e){return e.dest&&e.analysis&&e.id}const x=[{field:"id",name:n.i18n.translate("xpack.ml.analyticsSelector.id",{defaultMessage:"ID"}),sortable:e=>e.id,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorTableColumnId",scope:"row"},{field:"description",name:n.i18n.translate("xpack.ml.analyticsSelector.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnJobDescription"},{field:"source.index",name:n.i18n.translate("xpack.ml.analyticsSelector.sourceIndex",{defaultMessage:"Source index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnSourceIndex"},{field:"dest.index",name:n.i18n.translate("xpack.ml.analyticsSelector.destinationIndex",{defaultMessage:"Destination index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlAnalyticsSelectorColumnDestIndex"}],p=[{field:d.a.id,name:n.i18n.translate("xpack.ml.analyticsSelector.modelsList.modelIdHeader",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,"data-test-subj":"mlAnalyticsSelectorColumnId"},{field:d.a.description,width:"350px",name:n.i18n.translate("xpack.ml.analyticsSelector.modelsList.modelDescriptionHeader",{defaultMessage:"Description"}),sortable:!1,truncateText:!1,"data-test-subj":"mlAnalyticsSelectorColumnDescription"}];function f({setAnalyticsId:e,jobsOnly:t=!1,setIsIdSelectorFlyoutVisible:a}){const[i,d]=Object(s.useState)(),[f,g]=Object(s.useState)([]),[O,y]=Object(s.useState)([]),[v,h]=Object(s.useState)(!1),{displayErrorToast:E}=Object(u.useToastNotificationService)(),_=Object(c.b)(),{dataFrameAnalytics:{getDataFrameAnalytics:S}}=Object(m.c)();function M(){a(!1)}Object(s.useEffect)((()=>{!async function(){h(!0);try{const{data_frame_analytics:e}=await S();g(e)}catch(e){console.error("Error fetching analytics",e),E(e,n.i18n.translate("xpack.ml.analyticsSelector.analyticsFetchErrorMessage",{defaultMessage:"An error occurred fetching analytics jobs. Refresh and try again."}))}h(!1)}(),!1===t&&async function(){h(!0);try{const e=await _.getTrainedModels();y(e)}catch(e){console.error("Error fetching trained models",e),E(e,n.i18n.translate("xpack.ml.analyticsSelector.trainedModelsFetchErrorMessage",{defaultMessage:"An error occurred fetching trained models. Refresh and try again."}))}h(!1)}()}),[]);const T=Object(s.useCallback)((()=>{void 0!==i&&e(i),M()}),[null==i?void 0:i.model_id,null==i?void 0:i.job_id]),C={initialPageSize:20,pageSizeOptions:[5,10,20,50]},F={selectable:e=>{const t=j(e),a=t?e.id:e.model_id,s=!t&&e.tags.includes(r.a);return(void 0===i||(null==i?void 0:i.job_id)===a||(null==i?void 0:i.model_id)===a)&&!s},onSelectionChange:e=>{var t,a;const s=e[0];if(!s)return void d(void 0);const i=j(s),l=i?s.analysis:s.inference_config,n=l?Object.keys(l)[0]:void 0;d({model_id:i?void 0:s.model_id,job_id:i?s.id:null===(t=s.metadata)||void 0===t||null===(a=t.analytics_config)||void 0===a?void 0:a.id,analysis_type:n})}},I=[{id:"Jobs",name:n.i18n.translate("xpack.ml.analyticsSelector.jobsTab",{defaultMessage:"Jobs"}),content:Object(b.jsx)(l.EuiInMemoryTable,{items:f,itemId:"id",loading:v,columns:x,pagination:C,sorting:!0,selection:F})}];return!1===t&&I.push({id:"Models",name:n.i18n.translate("xpack.ml.analyticsSelector.modelsTab",{defaultMessage:"Models"}),content:Object(b.jsx)(l.EuiInMemoryTable,{items:O,itemId:"model_id",loading:v,columns:p,pagination:C,sorting:!0,selection:F})}),Object(b.jsx)(l.EuiFlyout,{onClose:M,"data-test-subj":"mlFlyoutJobSelector","aria-labelledby":"jobSelectorFlyout"},Object(b.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},Object(b.jsx)(l.EuiTitle,{size:"m"},Object(b.jsx)("h2",{id:"flyoutTitle"},n.i18n.translate("xpack.ml.analyticsSelector.flyoutTitle",{defaultMessage:"Analytics selection"})))),Object(b.jsx)(l.EuiFlyoutBody,{"data-test-subj":"mlJobSelectorFlyoutBody"},Object(b.jsx)(l.EuiTabbedContent,{size:"s",tabs:I,initialSelectedTab:I[0]})),Object(b.jsx)(l.EuiFlyoutFooter,null,Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButton,{onClick:T,fill:!0,isDisabled:void 0===i,"data-test-subj":"mlFlyoutAnalyticsSelectorButtonApply"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.analyticsSelector.applyFlyoutButton",defaultMessage:"Apply"}))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonEmpty,{iconType:"cross",onClick:M,"data-test-subj":"mlFlyoutAnalyticsSelectorButtonClose"},n.i18n.translate("xpack.ml.analyticsSelector.closeFlyoutButton",{defaultMessage:"Close"}))))))}const g=({setIsIdSelectorFlyoutVisible:e,selectedId:t})=>Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},t?Object(b.jsx)(l.EuiBadge,{key:`${t}-id`,"data-test-subj":`mlAnalyticsIdSelectionBadge ${t}`,color:"hollow"},t):null,t?null:Object(b.jsx)(l.EuiText,{size:"xs"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.dataframe.analytics.noIdsSelectedLabel",defaultMessage:"No Analytics ID selected"}))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonEmpty,{size:"xs",iconType:"pencil",onClick:e.bind(null,!0),"data-test-subj":"mlButtonEditAnalyticsIdSelection"},Object(b.jsx)(o.FormattedMessage,{id:"xpack.ml.dataframe.analytics.editSelection",defaultMessage:"Edit selection"})))),Object(b.jsx)(l.EuiHorizontalRule,null))},483:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(753);case"v8light":return a(755)}},753:function(e,t,a){var s=a(126),i=a(754);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},754:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlExpandableSection{padding:8px 16px}.mlExpandableSection-contentPadding{padding:8px}[id^=echTooltipPortal]{z-index:9000!important}",""]),e.exports=t},755:function(e,t,a){var s=a(126),i=a(756);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},756:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlExpandableSection{padding:8px 16px}.mlExpandableSection-contentPadding{padding:8px}[id^=echTooltipPortal]{z-index:9000!important}",""]),e.exports=t},758:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2),i=a(759);t.default=function(e,t){var a=i.useFirstMountState();s.useEffect((function(){if(!a)return e()}),t)}},759:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var s=a(2);t.useFirstMountState=function(){var e=s.useRef(!0);return e.current?(e.current=!1,!0):e.current}},760:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(761);case"v8light":return a(763)}},761:function(e,t,a){var s=a(126),i=a(762);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},762:function(e,t,a){(t=a(127)(!1)).push([e.i,'.mlDataFrameAnalyticsClassification{width:100%}.mlDataFrameAnalyticsClassification__evaluateSectionContent{padding:0 5%}.mlDataFrameAnalyticsClassification__evaluateSectionContent:after{clear:both;content:"";display:table}.mlDataFrameAnalyticsClassification__actualLabel{float:left;padding-top:64px;width:80px}.mlDataFrameAnalyticsClassification__dataGridMinWidth{float:left;min-width:480px;width:calc(100% - 80px)}.mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean{text-transform:none}.mlDataFrameAnalyticsClassification__evaluationMetrics{width:60%}',""]),e.exports=t},763:function(e,t,a){var s=a(126),i=a(764);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},764:function(e,t,a){(t=a(127)(!1)).push([e.i,'.mlDataFrameAnalyticsClassification{width:100%}.mlDataFrameAnalyticsClassification__evaluateSectionContent{padding:0 5%}.mlDataFrameAnalyticsClassification__evaluateSectionContent:after{clear:both;content:"";display:table}.mlDataFrameAnalyticsClassification__actualLabel{float:left;padding-top:64px;width:80px}.mlDataFrameAnalyticsClassification__dataGridMinWidth{float:left;min-width:480px;width:calc(100% - 80px)}.mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean{text-transform:none}.mlDataFrameAnalyticsClassification__evaluationMetrics{width:60%}',""]),e.exports=t},861:function(e,t,a){"use strict";a.r(t),a.d(t,"Page",(function(){return xt}));var s=a(2),i=a.n(s),l=a(25),n=a(15),o=a(68),r=a(218),c=a(5),u=a(204),d=a(145),m=a.n(d),b=a(6);const j=({colorRange:e,justifyTicks:t=!1,showTicks:a=!0,title:i,width:n=250})=>{const o=Object(s.useRef)(null),r=m.a.range(11).map((t=>({offset:t/10*100,stopColor:e(t/10)})));return Object(s.useEffect)((()=>{if(null===o.current)return;const e=n,s=t||!a?1:4,i=e-s-1;m.a.select(o.current).selectAll("*").remove();const l=m.a.select(o.current).classed("mlColorRangeLegend",!0).attr("width",e).attr("height",32).append("g").attr("transform","translate("+s+",2)"),c=l.append("defs").append("linearGradient").attr("id","mlColorRangeGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");r.forEach((function(e){c.append("stop").attr("offset",`${e.offset}%`).attr("stop-color",e.stopColor).attr("stop-opacity",1)})),l.append("rect").attr("x1",0).attr("y1",0).attr("width",i).attr("height",10).style("fill","url(#mlColorRangeGradient)");const u=m.a.scale.linear().domain([0,1]).range([0,i]),d=m.a.format(""),b=m.a.svg.axis().scale(u).orient("bottom").tickFormat(d).tickSize(14).ticks(i/40);if(l.append("g").attr("class","legend axis").attr("transform","translate(0, 0)").call(b),t||!a){const e=l.selectAll("text")[0];e.length>1&&(m.a.select(e[0]).style("text-anchor","start"),m.a.select(e[e.length-1]).style("text-anchor","end"))}a||l.selectAll(".axis line").style("display","none")}),[JSON.stringify(r),o.current]),void 0===i?Object(b.jsx)("svg",{ref:o}):Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(b.jsx)("p",null,i))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)("svg",{ref:o})))};var x=a(10);let p=function(e){return e.LINEAR="linear",e.INFLUENCER="influencer",e.SQRT="sqrt",e}({});p.LINEAR,c.i18n.translate("xpack.ml.components.colorRangeLegend.linearScaleLabel",{defaultMessage:"Linear"}),p.INFLUENCER,c.i18n.translate("xpack.ml.components.colorRangeLegend.influencerScaleLabel",{defaultMessage:"Influencer custom scale"}),p.SQRT,c.i18n.translate("xpack.ml.components.colorRangeLegend.sqrtScaleLabel",{defaultMessage:"Sqrt"});let f=function(e){return e.BLUE="blue",e.RED="red",e.RED_GREEN="red-green",e.GREEN_RED="green-red",e.YELLOW_GREEN_BLUE="yellow-green-blue",e}({});f.BLUE,c.i18n.translate("xpack.ml.components.colorRangeLegend.blueColorRangeLabel",{defaultMessage:"Blue"}),f.RED,c.i18n.translate("xpack.ml.components.colorRangeLegend.redColorRangeLabel",{defaultMessage:"Red"}),f.RED_GREEN,c.i18n.translate("xpack.ml.components.colorRangeLegend.redGreenColorRangeLabel",{defaultMessage:"Red - Green"}),f.GREEN_RED,c.i18n.translate("xpack.ml.components.colorRangeLegend.greenRedColorRangeLabel",{defaultMessage:"Green - Red"}),f.YELLOW_GREEN_BLUE,c.i18n.translate("xpack.ml.components.colorRangeLegend.yellowGreenBlueColorRangeLabel",{defaultMessage:"Yellow - Green - Blue"});const g=["#FFFFDD","#AAF191","#80D385","#61B385","#3E9583","#217681","#285285","#1F2D86","#000086"],O=m.a.range(0,1,1/(g.length-1));O.push(1);const y={[f.BLUE]:[0,1],[f.RED]:[0,1],[f.RED_GREEN]:[0,1],[f.GREEN_RED]:[0,1],[f.YELLOW_GREEN_BLUE]:O},v=(e=f.BLUE,t=p.LINEAR,a=1)=>{const{euiTheme:s}=Object(x.a)(),i={[f.BLUE]:[m.a.rgb(s.euiColorEmptyShade).toString(),m.a.rgb(s.euiColorVis1).toString()],[f.RED]:[m.a.rgb(s.euiColorEmptyShade).toString(),m.a.rgb(s.euiColorDanger).toString()],[f.RED_GREEN]:["red","green"],[f.GREEN_RED]:["green","red"],[f.YELLOW_GREEN_BLUE]:g},l=m.a.scale.linear().domain(y[e]).range(i[e]),n=(o=a,e=>o<=1?e:e<1/o?0:e<3/o?o/4*(e-1/o):e-3/o+.5);var o;const r={[p.LINEAR]:l,[p.INFLUENCER]:e=>l(n(e)),[p.SQRT]:m.a.scale.sqrt().domain(y[e]).range(i[e])};return r[t]};var h=a(316),E=a(148),_=(a(483),a(37)),S=a(247),M=a(1);function T(e){return{queryText:"",queryLanguage:S.a.KUERY,pageIndex:0,pageSize:25,analysis:!1,evaluation:!0,feature_importance:!0,results:!0,splom:!0,...Object(_.a)(e)?e:{}}}function C(e){return Object(o.c)(M.b.DATA_FRAME_ANALYTICS_EXPLORATION,T(e))}const F="header_items_loading",I=({headerItems:e,content:t,isExpanded:a,contentPadding:i=!1,dataTestId:n,title:o,docsLink:r,urlStateKey:c})=>{const u=Object(s.useMemo)((()=>void 0!==a?{[c]:a}:void 0),[c,a]),[d,m]=C(u),j=void 0!==a&&d[c]===T(u)[c]?a:d[c],x=Object(s.useCallback)((()=>{m({[c]:!j})}),[j,m,c]);return Object(b.jsx)(l.EuiPanel,{paddingSize:"none","data-test-subj":`mlDFExpandableSection-${n}`,hasShadow:!1,hasBorder:!0},Object(b.jsx)("div",{className:"mlExpandableSection"},Object(b.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"none",alignItems:"center"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"l"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiButtonEmpty,{onClick:x,iconType:j?"arrowDown":"arrowRight",iconSide:"left",flush:"left","data-test-subj":`mlDFExpandableSection-${n}-toggle-button`},Object(b.jsx)(l.EuiText,{size:"m",color:"default",style:{fontWeight:"bold"}},Object(b.jsx)("p",null,o)))),e===F&&Object(b.jsx)(l.EuiSkeletonText,{lines:1}),(p=e,Array.isArray(p)?e.map((({label:e,value:t,id:a})=>Object(b.jsx)(l.EuiFlexItem,{grow:!1,key:a,"data-test-subj":`mlDFExpandableSectionItem-${n}-${a}`},void 0!==e&&void 0!==t?Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"xs",textAlign:"center"},Object(b.jsx)("p",null,e))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiBadge,null,t))):null,void 0===e?Object(b.jsx)(l.EuiFlexGroup,{alignItems:"center"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued",textAlign:"center"},t))):null))):null))),void 0!==r&&Object(b.jsx)(l.EuiFlexItem,{grow:!1},r))),j&&Object(b.jsx)("div",{className:i?"mlExpandableSection-contentPadding":"","data-test-subj":`mlDFExpandableSection-${n}-content`},t));var p};var k=a(11),w=a(259),A=a(164),D=a(498);const R=({jobId:e})=>{const[t,a]=Object(s.useState)();Object(s.useEffect)((()=>{(async()=>{const t=await k.ml.dataFrameAnalytics.getDataFrameAnalytics(e),s=await k.ml.dataFrameAnalytics.getDataFrameAnalyticsStats(e),i=t.data_frame_analytics[0],l=Object(w.b)(s)?s.data_frame_analytics[0]:void 0;if(void 0===l)return;const n={checkpointing:{},config:i,id:i.id,job_type:Object(u.a)(i.analysis),mode:A.a.BATCH,state:l.state,stats:l};a(n)})()}),[e]);const o=(e=>{if(void 0===e)return F;const t=Array.isArray(e.config.source.index)?e.config.source.index.join():e.config.source.index;return[{id:"analysisTypeLabel",label:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisTypeLabel",defaultMessage:"Type"}),value:e.job_type},{id:"analysisSourceIndexLabel",label:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisSourceIndexLabel",defaultMessage:"Source index"}),value:t},{id:"analysisDestinationIndexLabel",label:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisDestinationIndexLabel",defaultMessage:"Destination index"}),value:e.config.dest.index}]})(t),r=Object(b.jsx)(i.a.Fragment,null,void 0===t&&Object(b.jsx)(l.EuiText,{textAlign:"center"},Object(b.jsx)(l.EuiSpacer,{size:"l"}),Object(b.jsx)(l.EuiLoadingSpinner,{size:"l"}),Object(b.jsx)(l.EuiSpacer,{size:"l"})),void 0!==t&&Object(b.jsx)(D.a,{item:t}));return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{dataTestId:"analysis",content:r,headerItems:o,urlStateKey:"analysis",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.analysisSectionTitle",defaultMessage:"Analysis"})}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))};var L=a(120),N=a.n(L),z=a(75),P=a(8),$=a(39),G=a.n($),q=a(838),B=a(229),V=a(839),H=a(17),U=a(184),Q=a(135),W=a(40);const J=({destIndex:e,color:t})=>{const{services:{http:{basePath:a},application:{capabilities:o}}}=Object(x.d)(),r=Object(s.useMemo)((()=>!0===o.savedObjectsManagement.edit||!0===o.indexPatterns.save),[o]);return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiText,{size:"xs",color:null!=t?t:"warning"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptMessage",defaultMessage:"No data view exists for index {destIndex}. ",values:{destIndex:null!=e?e:""}}),!0===r?Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptLink",defaultMessage:"{linkToDataViewManagement}{destIndex}.",values:{destIndex:e?` for ${e}`:"",linkToDataViewManagement:Object(b.jsx)(l.EuiLink,{href:`${a.get()}/app/management/kibana/dataViews/create`,target:"_blank"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.dataViewPromptLinkText",defaultMessage:"Create a data view"}))}}):null))},K=c.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.documentsShownHelpText",{defaultMessage:"Showing documents for which predictions exist"}),Y=c.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.firstDocumentsShownHelpText",{defaultMessage:"Showing first {searchSize} documents for which predictions exist",values:{searchSize:E.b}}),X=({colorRange:e,indexData:t,dataView:a,jobConfig:o,needsDestDataView:r,resultsField:d,searchQuery:m})=>{var p;const{services:{application:f,share:g,data:O,http:{basePath:y}}}=Object(x.d)(),v=null==a?void 0:a.id,h=Object(s.useMemo)((()=>g.url.locators.get("DISCOVER_APP_LOCATOR")),[g.url.locators]),_=Object(s.useMemo)((()=>{var e;return null!==(e=f.capabilities.discover)&&void 0!==e&&e.show?h?v?void 0:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.dataGridActions.autoGeneratedDiscoverLinkErrorMessage",{defaultMessage:"Unable to link to Discover; no data view exists for this index"}):c.i18n.translate("xpack.ml.dataframe.analytics.exploration.dataGridActions.discoverLocatorMissingErrorMessage",{defaultMessage:"No locator for Discover detected"}):c.i18n.translate("xpack.ml.dataframe.analytics.exploration.dataGridActions.discoverNotEnabledErrorMessage",{defaultMessage:"Discover is not enabled"})}),[null===(p=f.capabilities.discover)||void 0===p?void 0:p.show,v,h]),{columnsWithCharts:M,status:T,tableItems:C}=t,k=((e,t,a,s,i,l)=>e.length>0&&(a.length>0||t===B.b.LOADED)?[{id:"explorationTableTotalDocs",label:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTotalDocsLabel",defaultMessage:"Total docs"}),value:`${i===q.a.GTE?">":""}${s}`},...void 0!==l?[{id:"colorRangeLegend",value:Object(b.jsx)(j,{colorRange:l,title:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.colorRangeLegendTitle",{defaultMessage:"Feature influence score"})})}]:[]]:F)(M,T,C,t.rowCount,t.rowCountRelation,e),w=o&&o.analysis?Object(u.a)(o.analysis):void 0,A=Object(s.useCallback)((async e=>{const a=C[e];if(void 0!==h)return await h.getRedirectUrl({dataViewId:v,timeRange:O.query.timefilter.timefilter.getTime(),filters:O.query.filterManager.getFilters(),query:{language:S.a.KUERY,query:t.visibleColumns.filter((e=>void 0!==a[e]&&("string"==typeof a[e]||"number"==typeof a[e])&&!e.includes(d))).map((e=>`${Object(z.escapeKuery)(e)}:${Object(z.escapeKuery)(String(a[e]))}`)).join(" and ")}})}),[null==t?void 0:t.visibleColumns,h,v,d,C,O]),D=[{id:"actions",width:60,headerCellRender:()=>Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.dataGridActions.columnTitle",defaultMessage:"Actions"}),rowCellRender:function({rowIndex:e}){const t=C[e],[i,r]=Object(s.useState)(!1),c=()=>r(!1),u=[Object(b.jsx)(l.EuiContextMenuItem,{icon:"discoverApp",key:"custom_discover_url",disabled:void 0!==_,onClick:async()=>{const t=await A(e);t&&f.navigateToUrl(t)}},_?Object(b.jsx)(l.EuiToolTip,{content:_},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.dataGridActions.viewInDiscover",defaultMessage:"View in Discover"})):Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.dataGridActions.viewInDiscover",defaultMessage:"View in Discover"}))];return o&&o._meta&&Array.isArray(o._meta.custom_urls)&&(null==o||o._meta.custom_urls.forEach(((e,s)=>{u.push(Object(b.jsx)(l.EuiContextMenuItem,{key:`custom_url_${s}`,icon:"popout",onClick:()=>{c(),((e,t)=>{const s=void 0!==t.time_range?Object(W.a)(t.time_range):null;let i;if(null!==s){const l=Object(P.cloneDeep)(e),n=l[a.timeFieldName],o=t.url_value;if(o.includes("$earliest$")){const e=G()(n);e.subtract(s),l.earliest=e.toISOString()}if(o.includes("$latest$")){const e=G()(n);e.add(s),l.latest=e.toISOString()}i=Object(Q.g)(t.url_value,l,!0)}else i=Object(U.e)(t,e,O.query.timefilter.timefilter.getTime());Object(U.d)(i,t,y.get())})(t,e)},"data-test-subj":`mlExplorationDataGridRowActionCustomUrlButton_${s}`},e.url_name))}))),Object(b.jsx)(l.EuiPopover,{isOpen:i,panelPaddingSize:"none",anchorPosition:"upCenter",button:Object(b.jsx)(l.EuiButtonIcon,{"aria-label":"Show actions",iconType:"gear",color:"text",onClick:()=>r(!i)}),closePopover:c},Object(b.jsx)(l.EuiContextMenuPanel,{items:u,size:"s"}))}}],R=Object(s.useMemo)((()=>Object(E.l)({analysisType:w,baseline:t.baseline,data:t.tableItems,pagination:t.pagination,predictionFieldName:t.predictionFieldName,resultsField:t.resultsField})),[w,t.baseline,t.tableItems,t.pagination,t.predictionFieldName,t.resultsField]),L=Object(b.jsx)(i.a.Fragment,null,void 0!==o&&r&&Object(b.jsx)("div",{className:"mlExpandableSection-contentPadding"},Object(b.jsx)(J,{destIndex:o.dest.index})),void 0!==o&&(Object(u.i)(o.analysis)||Object(u.g)(o.analysis))&&Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued",className:"mlExpandableSection-contentPadding"},C.length===E.b?Y:K),(M.length>0||m!==E.c)&&void 0!==a&&Object(b.jsx)(i.a.Fragment,null,M.length>0&&(C.length>0||T===B.b.LOADED)&&Object(b.jsx)(V.a,N()({},t,{trailingControlColumns:t.visibleColumns.length?D:void 0,dataTestSubj:"mlExplorationDataGrid",renderCellPopover:R,toastNotifications:Object(H.f)()}))));return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{urlStateKey:"results",dataTestId:"results",content:L,headerItems:k,title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTitle",defaultMessage:"Results"})}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))},Z=e=>{const t=Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiHorizontalRule,{size:"full",margin:"none"}),Object(b.jsx)("div",{className:"mlExpandableSection-contentPadding"},Object(b.jsx)(h.a,e)));return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{dataTestId:"splom",urlStateKey:"splom",content:t,headerItems:void 0,isExpanded:!0,title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.splomSectionTitle",defaultMessage:"Scatterplot matrix"})}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))};var ee=a(405);const te=e=>`${e.dest.results_field}.${r.j}`,ae=(e,t=[])=>t.reduce(((t,a)=>Array.isArray(a[`${e}.${r.f}`])?Math.max(t,a[`${e}.${r.f}`].length):t),0);var se=a(414),ie=a(757),le=a(407),ne=a(758),oe=a.n(ne),re=a(885);const ce=(e,t=B.c,a)=>{const[i,l]=C(),n=Object(re.a)(e,25,t,a);return n.pagination=Object(s.useMemo)((()=>({pageSize:i.pageSize,pageIndex:i.pageIndex})),[i.pageSize,i.pageIndex]),n.setPagination=Object(s.useCallback)((e=>{l({...e})}),[l]),n.onChangePage=Object(s.useCallback)((e=>{l({pageIndex:e})}),[l]),n.onChangeItemsPerPage=Object(s.useCallback)((e=>{l({pageSize:e})}),[l]),n.resetPagination=Object(s.useCallback)((()=>{const e=T();l({pageSize:e.pageSize,pageIndex:e.pageIndex})}),[l]),oe()((function(){n.resetPagination()}),[i.queryText]),n},ue=i.a.memo((({jobId:e})=>{var t,a,n;const{dataView:o,dataViewErrorMessage:d,jobConfig:m,needsDestDataView:j}=Object(E.n)(e),[x,g]=C(),[O,y]=Object(s.useState)(E.c),_=((e,t,a)=>{var i;const l=void 0!==e&&e.title===(null==t?void 0:t.source.index[0]),n=Object(s.useMemo)((()=>{const a=[];if(void 0!==t&&void 0!==e){const e=t.dest.results_field,{fieldTypes:s}=Object(E.f)(t,l);a.push(...Object(B.i)(s,e).sort(((e,a)=>Object(se.f)(e.id,a.id,t))))}return a}),[t,e]),o=ce(n,8,(e=>!e.includes(`.${r.f}.`)&&e!==se.d&&e!==se.e));Object(s.useEffect)((()=>{void 0!==t&&o.setSortingColumns([{id:te(t),direction:"desc"}])}),[t&&t.id]),Object(s.useEffect)((()=>{const e={didCancel:!1};return Object(E.e)(t,o,a,e),()=>{e.didCancel=!0}}),[t&&t.id,o.pagination,a,o.sortingColumns]);const c=Object(s.useMemo)((()=>void 0!==e?new le.a(e,Object(H.f)()):void 0),[e]);Object(s.useEffect)((()=>{o.chartsVisible&&async function(){try{if(void 0!==t&&void 0!==c){const e=await c.loadFieldHistograms(n.filter((e=>o.visibleColumns.includes(e.id))).map((e=>({fieldName:e.id,type:Object(ie.a)(e.schema)}))),a);o.setColumnCharts(e)}}catch(e){Object(B.n)(e,Object(H.f)())}}()}),[o.chartsVisible,null==t?void 0:t.dest.index,JSON.stringify([a,[...o.visibleColumns].sort()])]);const u=v(f.BLUE,p.INFLUENCER,void 0!==t?ae(t.dest.results_field,o.tableItems):1),d=Object(B.o)(e,o.pagination,o.tableItems,null!==(i=null==t?void 0:t.dest.results_field)&&void 0!==i?i:r.d,((e,a,i,l)=>{var n;let o;const c=i[`${null!==(n=null==t?void 0:t.dest.results_field)&&void 0!==n?n:""}.${r.f}`];if(Array.isArray(c)){const t=c.find((t=>e===t.feature_name[0]));t&&(o=u(t.influence[0]))}Object(s.useEffect)((()=>{o&&l({style:{backgroundColor:String(o)}})}),[o,l])}));return{...o,renderCellValue:d}})(o,m,O),S=Object(s.useCallback)((e=>{e.query&&y(e.query),e.queryString!==x.queryText&&g({queryText:e.queryString,queryLanguage:e.language})}),[x,g]),M={query:x.queryText,language:x.queryLanguage},{columnsWithCharts:T,tableItems:F}=_,I=null!==(t=null==m?void 0:m.dest.results_field)&&void 0!==t?t:"",k=ae(I,F),w=v(f.BLUE,p.INFLUENCER,k),A=Object(u.h)(null==m?void 0:m.analysis)&&!0===(null==m?void 0:m.analysis.outlier_detection.compute_feature_influence),D=!j&&Object(u.h)(null==m?void 0:m.analysis)&&!0===(null==m?void 0:m.analysis.outlier_detection.compute_feature_influence)&&-1===T.findIndex((e=>e.id===`${I}.${r.f}`)),L=Object(h.b)(o,null==m||null===(a=m.analyzed_fields)||void 0===a?void 0:a.includes,null==m||null===(n=m.analyzed_fields)||void 0===n?void 0:n.excludes,I),N=Object(E.d)(m);return void 0!==d?Object(b.jsx)(l.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},Object(b.jsx)("p",null,d,j?Object(b.jsx)(J,{destIndex:N,color:"text"}):null))):Object(b.jsx)(i.a.Fragment,null,void 0!==(null==m?void 0:m.description)&&""!==(null==m?void 0:m.description)&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiText,null,null==m?void 0:m.description),Object(b.jsx)(l.EuiSpacer,{size:"m"})),(T.length>0||O!==E.c)&&void 0!==o&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(ee.a,{dataView:o,setSearchQuery:S,query:M}),Object(b.jsx)(l.EuiSpacer,{size:"m"})),"string"==typeof(null==m?void 0:m.id)&&Object(b.jsx)(R,{jobId:null==m?void 0:m.id}),"string"==typeof(null==m?void 0:m.id)&&L.length>1&&Object(b.jsx)(Z,{fields:L,index:null==m?void 0:m.dest.index,resultsField:null==m?void 0:m.dest.results_field,searchQuery:O,query:M}),D&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiCallOut,{size:"s",title:c.i18n.translate("xpack.ml.dataframe.analytics.outlierExploration.legacyFeatureInfluenceFormatCalloutTitle",{defaultMessage:"Color coded table cells based on feature influence are not available because the results index uses an unsupported legacy format. Please clone and rerun the job."}),iconType:"pin"}),Object(b.jsx)(l.EuiSpacer,{size:"m"})),Object(b.jsx)(X,{colorRange:A&&!D?w:void 0,indexData:_,dataView:o,jobConfig:m,needsDestDataView:j,searchQuery:O}))}));var de=a(322),me=a(46);const be=i.a.memo((({dataView:e,jobConfig:t,needsDestDataView:a,searchQuery:i})=>{const{services:{mlServices:{mlApiServices:l}}}=Object(x.d)(),n=((e,t,a,i,l)=>{var n;const[o,d]=Object(s.useState)(),m=Object(me.b)(),b=void 0!==e&&e.title===(null==t?void 0:t.source.index[0]),j=[];if(void 0!==t){const e=t.dest.results_field,{fieldTypes:a}=Object(E.f)(t,b);j.push(...Object(B.i)(a,e).sort(((e,a)=>Object(se.f)(e.id,a.id,t))))}const x=ce(j,8,(e=>!e.includes(`.${r.e}.`)&&!e.includes(`.${r.k}.`)&&e!==se.d));Object(s.useEffect)((()=>{const e={didCancel:!1};return Object(E.e)(t,x,a,e),()=>{e.didCancel=!0}}),[t&&t.id,x.pagination,a,x.sortingColumns]);const p=Object(s.useMemo)((()=>void 0!==e?new le.a(e,i):void 0),[e]);Object(s.useEffect)((()=>{x.chartsVisible&&async function(){try{if(void 0!==t&&void 0!==p){const e=await p.loadFieldHistograms(j.filter((e=>x.visibleColumns.includes(e.id))).map((e=>({fieldName:e.id,type:Object(ie.a)(e.schema)}))),a);x.setColumnCharts(e)}}catch(e){Object(B.n)(e,i)}}()}),[x.chartsVisible,null==t?void 0:t.dest.index,JSON.stringify([a,x.visibleColumns])]);const f=Object(s.useMemo)((()=>{var e;if(t)return null!==(e=Object(u.e)(t.analysis))&&void 0!==e?e:Object(u.b)(t.analysis)}),[t]),g=Object(s.useCallback)((async()=>{try{if(void 0!==t&&void 0!==t.analysis&&(Object(u.i)(t.analysis)||Object(u.g)(t.analysis))){var e;const s=t.id,i=(await m.getTrainedModels(`${s}*`,{include:"feature_importance_baseline"})).find((e=>{var t,a;return(null===(t=e.metadata)||void 0===t||null===(a=t.analytics_config)||void 0===a?void 0:a.id)===s}));var a;void 0!==(null==i||null===(e=i.metadata)||void 0===e?void 0:e.feature_importance_baseline)&&d(null==i||null===(a=i.metadata)||void 0===a?void 0:a.feature_importance_baseline)}}catch(e){const t=Object(de.a)(e);i.addDanger({title:c.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.baselineErrorMessageToast",{defaultMessage:"An error occurred getting feature importance baseline"}),text:t})}}),[l,t]);Object(s.useEffect)((()=>{g()}),[t]);const O=null!==(n=null==t?void 0:t.dest.results_field)&&void 0!==n?n:r.d,y=Object(B.o)(e,x.pagination,x.tableItems,O);return{...x,renderCellValue:y,baseline:o,predictionFieldName:f,resultsField:O}})(e,t,i,Object(H.f)(),l);return void 0===t||void 0===n?null:Object(b.jsx)("div",{"data-test-subj":"mlDFAnalyticsExplorationTablePanel"},Object(b.jsx)(X,{indexData:n,dataView:e,resultsField:null==t?void 0:t.dest.results_field,jobConfig:t,needsDestDataView:a,searchQuery:i}))})),je=c.i18n.translate("xpack.ml.dataframe.analytics.jobConfig.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the job configuration data."}),xe=c.i18n.translate("xpack.ml.dataframe.analytics.jobCaps.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the index's field data."}),pe=({jobCapsServiceErrorMessage:e,jobConfigErrorMessage:t,title:a})=>{const{services:{application:{getUrlForApp:i}}}=Object(x.d)(),n="string"==typeof e&&e.includes("locate that index-pattern")&&e.includes("click here to re-create"),o=Object(b.jsx)("p",null,t||e),r=Object(s.useMemo)((()=>i("management",{path:"kibana/indexPatterns"})),[]),c=n?Object(b.jsx)(l.EuiLink,{href:r,target:"_blank"},o):o;return Object(b.jsx)(l.EuiPanel,{grow:!1},Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(l.EuiCallOut,{title:t?je:xe,color:"danger",iconType:"cross"},c))},fe=()=>Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiPanel,{className:"eui-textCenter"},Object(b.jsx)(l.EuiLoadingSpinner,{size:"xl"})),Object(b.jsx)(l.EuiSpacer,{size:"m"}));function ge(e){return{options:[{id:"training",label:c.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.trainingSubsetLabel",{defaultMessage:"Training"})},{id:"testing",label:c.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.testingSubsetLabel",{defaultMessage:"Testing"})}],columnId:`${e}.is_training`,key:{training:!0,testing:!1}}}const Oe=({jobId:e,title:t,EvaluatePanel:a,FeatureImportanceSummaryPanel:n})=>{var o,d,m;const{dataView:j,dataViewErrorMessage:x,isInitialized:p,isLoadingJobConfig:f,jobCapsServiceErrorMessage:g,jobConfig:O,jobConfigErrorMessage:y,jobStatus:v,needsDestDataView:_,totalFeatureImportance:S}=Object(E.n)(e),[M,T]=C(),[F,I]=Object(s.useState)(E.c),k=Object(s.useCallback)((e=>{e.query&&I(e.query),e.queryString!==M.queryText&&T({queryText:e.queryString,queryLanguage:e.language})}),[M,T]),w={query:M.queryText,language:M.queryLanguage},A=null!==(o=null==O?void 0:O.dest.results_field)&&void 0!==o?o:"",D=Object(E.d)(O),L=Object(h.b)(j,null==O||null===(d=O.analyzed_fields)||void 0===d?void 0:d.includes,null==O||null===(m=O.analyzed_fields)||void 0===m?void 0:m.excludes,A);if(void 0!==x)return Object(b.jsx)(l.EuiPanel,{grow:!1},Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},Object(b.jsx)("p",null,x,_?Object(b.jsx)(J,{destIndex:D,color:"text"}):null)));if(void 0!==y||void 0!==g)return Object(b.jsx)(pe,{jobCapsServiceErrorMessage:g,jobConfigErrorMessage:y,title:t});const N=O&&O.analysis?Object(u.a)(null==O?void 0:O.analysis):void 0;return Object(b.jsx)(i.a.Fragment,null,void 0!==(null==O?void 0:O.description)&&""!==(null==O?void 0:O.description)&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiText,null,null==O?void 0:O.description),Object(b.jsx)(l.EuiSpacer,{size:"m"})),void 0!==j&&O&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiFlexGroup,{direction:"column"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(ee.a,{dataView:j,setSearchQuery:k,query:w,filters:ge(O.dest.results_field)}))))),Object(b.jsx)(l.EuiSpacer,{size:"m"})),!0===f&&void 0===O&&Object(b.jsx)(fe,null),!1===f&&void 0!==O&&!0===p&&Object(b.jsx)(R,{jobId:O.id}),!0===f&&void 0===O&&Object(b.jsx)(fe,null),!1===f&&void 0!==O&&!0===p&&Object(b.jsx)(a,{jobConfig:O,jobStatus:v,searchQuery:F}),!0===f&&void 0!==O&&void 0===S&&Object(b.jsx)(fe,null),!1===f&&void 0!==O&&void 0!==S&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(n,{totalFeatureImportance:S,jobConfig:O})),Object(b.jsx)(l.EuiSpacer,{size:"m"}),!0===f&&void 0===O&&Object(b.jsx)(fe,null),!1===f&&void 0!==O&&!0===p&&"string"==typeof(null==O?void 0:O.id)&&L.length>1&&void 0!==(null==O?void 0:O.analysis)&&Object(b.jsx)(Z,{fields:L,index:null==O?void 0:O.dest.index,dataView:j,color:N===r.b.REGRESSION||N===r.b.CLASSIFICATION?Object(u.c)(O.analysis):void 0,legendType:Object(E.g)(N),searchQuery:F}),!0===f&&void 0===O&&Object(b.jsx)(fe,null),!1===f&&void 0!==O&&void 0!==j&&!0===p&&Object(b.jsx)(be,{dataView:j,jobConfig:O,jobStatus:v,needsDestDataView:_,searchQuery:F}))};var ye=a(146);const ve={[ye.c.MSE]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorText",{defaultMessage:"Mean squared error"}),[ye.c.MSLE]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.msleText",{defaultMessage:"Mean squared logarithmic error"}),[ye.c.R_SQUARED]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredText",{defaultMessage:"R squared"}),[ye.c.HUBER]:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.huberText",defaultMessage:"{wikiLink}",values:{wikiLink:Object(b.jsx)(l.EuiLink,{href:"https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function",target:"_blank",external:!0},c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.huberLinkText",{defaultMessage:"Pseudo Huber loss function"}))}})},he={[ye.c.MSE]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorTooltipContent",{defaultMessage:"Measures how well the regression analysis model is performing. Mean squared sum of the difference between true and predicted values."}),[ye.c.MSLE]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.msleTooltipContent",{defaultMessage:"Average squared difference between the logarithm of the predicted values and the logarithm of the actual (ground truth) value."}),[ye.c.R_SQUARED]:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredTooltipContent",{defaultMessage:"Represents the goodness of fit. Measures how well the observed outcomes are replicated by the model."})},Ee=({isLoading:e,statType:t,title:a,dataTestSubj:s})=>Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"xs","data-test-subj":s},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiStat,{reverse:!0,isLoading:e,title:a,description:ve[t],titleSize:"xxs"})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},t!==ye.c.HUBER&&Object(b.jsx)(l.EuiIconTip,{anchorClassName:"mlDataFrameAnalyticsRegression__evaluateStat",content:he[t]}))),_e={mse:ye.a,msle:ye.a,huber:ye.a,rSquared:ye.a},Se={..._e,error:null},Me=({jobConfig:e,jobStatus:t,searchQuery:a})=>{var o;const{services:{docLinks:d}}=Object(x.d)(),m=d.links.ml.regressionEvaluation,[j,p]=Object(s.useState)(Se),[f,g]=Object(s.useState)(Se),[O,y]=Object(s.useState)(!1),[v,h]=Object(s.useState)(!1),[_,S]=Object(s.useState)(void 0),[M,T]=Object(s.useState)(null),[C,F]=Object(s.useState)(null),k=e.dest.index,w=Object(u.c)(e.analysis),A=Object(u.e)(e.analysis),D=null!==(o=e.dest.results_field)&&void 0!==o?o:"ml";return Object(s.useEffect)((()=>{let t;const s=Object(ye.i)(a)&&(a.bool.should||a.bool.filter);if(void 0!==s&&!1!==s)for(let e=0;e<s.length;e++){const a=s[e];if(a.match&&void 0!==a.match[`${D}.is_training`]){t=a.match[`${D}.is_training`];break}if(a.bool&&(void 0!==a.bool.should||void 0!==a.bool.filter)){const e=a.bool.should||a.bool.filter;if(void 0!==e)for(let a=0;a<e.length;a++){const s=e[a];if(s.match&&void 0!==s.match[`${D}.is_training`]){t=s.match[`${D}.is_training`];break}}}}S(t),(async()=>{(async(e=!0)=>{h(!0);const t=await Object(E.j)({isTraining:!1,index:k,dependentVariable:w,resultsField:D,predictionFieldName:A,searchQuery:a,ignoreDefaultQuery:e,jobType:r.b.REGRESSION});if(!0===t.success&&t.eval&&Object(ye.h)(t.eval)){const{mse:e,msle:a,huber:s,r_squared:i}=Object(E.h)(t.eval);g({mse:e,msle:a,huber:s,rSquared:i,error:null}),h(!1)}else h(!1),g({..._e,error:t.error})})(!1);const t=await Object(E.i)({ignoreDefaultQuery:!1,isTraining:!1,searchQuery:a,resultsField:D,destIndex:e.dest.index});!0===t.success?F(t.docsCount):F(null),(async(e=!0)=>{y(!0);const t=await Object(E.j)({isTraining:!0,index:k,dependentVariable:w,resultsField:D,predictionFieldName:A,searchQuery:a,ignoreDefaultQuery:e,jobType:r.b.REGRESSION});if(!0===t.success&&t.eval&&Object(ye.h)(t.eval)){const{mse:e,msle:a,huber:s,r_squared:i}=Object(E.h)(t.eval);p({mse:e,msle:a,huber:s,rSquared:i,error:null}),y(!1)}else y(!1),p({..._e,error:t.error})})(!1);const s=await Object(E.i)({ignoreDefaultQuery:!1,isTraining:!0,searchQuery:a,resultsField:D,destIndex:e.dest.index});!0===s.success?T(s.docsCount):T(null)})()}),[JSON.stringify(a)]),Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{urlStateKey:"evaluation",dataTestId:"RegressionEvaluation",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:Object(b.jsx)(l.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",size:"xs",color:"primary",href:m},Object(b.jsx)(l.EuiText,{size:"xs",color:"primary"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.regressionDocsLink",defaultMessage:"Regression evaluation docs "}))),headerItems:void 0!==t?[{id:"jobStatus",label:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:t}]:[],contentPadding:!0,content:Object(b.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiTitle,{size:"xxs"},Object(b.jsx)("span",null,c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.generalizationErrorTitle",{defaultMessage:"Generalization error"}))),null!==C&&Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:C}}),!0===_&&0===C&&Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationFilterText",defaultMessage:". Filtering for training data."})),Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionGenMSEstat",isLoading:v,title:f.mse,statType:ye.c.MSE})),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionGenRSquaredStat",isLoading:v,title:f.rSquared,statType:ye.c.R_SQUARED})))),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionGenMsleStat",isLoading:v,title:f.msle,statType:ye.c.MSLE})),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionGenHuberStat",isLoading:v,title:f.huber,statType:ye.c.HUBER})))))),null!==f.error&&Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"xs",color:"danger"},!0===_&&0===C&&f.error.includes("No documents found")?c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTestingDocsError",{defaultMessage:"No testing documents found"}):f.error)))),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiTitle,{size:"xxs"},Object(b.jsx)("span",null,c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.trainingErrorTitle",{defaultMessage:"Training error"}))),null!==M&&Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:M}}),!1===_&&0===M&&Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingFilterText",defaultMessage:". Filtering for testing data."})),Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMSEstat",isLoading:O,title:j.mse,statType:ye.c.MSE})),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionTrainingRSquaredStat",isLoading:O,title:j.rSquared,statType:ye.c.R_SQUARED})))),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMsleStat",isLoading:O,title:j.msle,statType:ye.c.MSLE})),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(Ee,{dataTestSubj:"mlDFAnalyticsRegressionTrainingHuberStat",isLoading:O,title:j.huber,statType:ye.c.HUBER})))))),null!==j.error&&Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{size:"xs",color:"danger"},!1===_&&0===M&&j.error.includes("No documents found")?c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTrainingDocsError",{defaultMessage:"No training documents found"}):j.error)))))}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))};var Te=a(76),Ce=a(33),Fe=a(831);const{euiColorMediumShade:Ie}=Ce.euiLightVars,ke={axes:{axisLine:{stroke:Ie},tickLabel:{fontSize:12,fill:Ie},tickLine:{stroke:Ie},gridLine:{horizontal:{dash:[1,2]},vertical:{strokeWidth:0}}},legend:{spacingBuffer:100}},we=c.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTooltipContent",{defaultMessage:"Total feature importance values indicate how significantly a field affects the predictions across all the training data."}),Ae=e=>e.classes.reduce(((e,t)=>e+t.importance.mean_magnitude),0),De=({totalFeatureImportance:e,jobConfig:t})=>{const{services:{docLinks:a}}=Object(x.d)(),[o,r,d,m]=Object(s.useMemo)((()=>{let t=[],a={xAccessor:"featureName",yAccessors:["meanImportance"],name:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceYSeriesName",{defaultMessage:"magnitude"})},s="";if(e.length<1)return[t,a,void 0,void 0];Object(Fe.b)(e[0])&&(2===e[0].classes.length&&(s="binary_classification",t=e.map((e=>({featureName:e.feature_name,meanImportance:e.classes[0].importance.mean_magnitude}))).sort(((e,t)=>t.meanImportance-e.meanImportance))),e[0].classes.length>2&&(s="multiclass_classification",e.sort(((e,t)=>Ae(t)-Ae(e))).forEach((e=>{const a=e.classes.sort(((e,t)=>t.importance.mean_magnitude-e.importance.mean_magnitude));t.push(...a.map((t=>({featureName:e.feature_name,meanImportance:t.importance.mean_magnitude,className:t.class_name}))))})),a={xAccessor:"featureName",yAccessors:["meanImportance"],splitSeriesAccessors:["className"],stackAccessors:["featureName"]})),Object(Fe.d)(e[0])&&(s="regression",t=e.map((e=>({featureName:e.feature_name,meanImportance:e.importance.mean_magnitude}))).sort(((e,t)=>t.meanImportance-e.meanImportance)));const i="multiclass_classification"===s,l=e.length*(e.length<5?40:20)+50;return[t,a,i,l]}),[e]),j=a.links.ml.featureImportance,p=Object(s.useCallback)((e=>Number(e.toPrecision(3)).toString()),[]),f=Object(s.useMemo)((()=>{if(0===e.length&&(null!=t&&t.analysis&&Object(u.i)(null==t?void 0:t.analysis)||Object(u.g)(null==t?void 0:t.analysis))){const e=Object(u.a)(t.analysis);return"unknown"!==e&&0===t.analysis[e].num_top_feature_importance_values?Object(b.jsx)(l.EuiCallOut,{"data-test-subj":"mlTotalFeatureImportanceNotCalculatedCallout",size:"s",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.totalFeatureImportanceNotCalculatedCalloutMessage",defaultMessage:"Feature importance was not calculated because num_top_feature_importance values is set to 0."})}):Object(b.jsx)(l.EuiCallOut,{"data-test-subj":"mlNoTotalFeatureImportanceCallout",size:"s",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.noTotalFeatureImportanceCalloutMessage",defaultMessage:"Total feature importance data is not available; the data set is uniform and the features have no significant impact on the prediction."})})}}),[e,t]);return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{urlStateKey:"feature_importance",isExpanded:void 0===f,dataTestId:"FeatureImportanceSummary",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTitle",defaultMessage:"Total feature importance"}),docsLink:Object(b.jsx)(l.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",size:"xs",color:"primary",href:j},Object(b.jsx)(l.EuiText,{size:"xs",color:"primary"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceDocsLink",defaultMessage:"Feature importance docs"}))),headerItems:[{id:"FeatureImportanceSummary",value:we}],content:f||Object(b.jsx)("div",{"data-test-subj":"mlTotalFeatureImportanceChart"},Object(b.jsx)(Te.Chart,{size:{width:"100%",height:m}},Object(b.jsx)(Te.Settings,{rotation:90,theme:ke,baseTheme:Te.LEGACY_LIGHT_THEME,showLegend:d,locale:c.i18n.getLocale()}),Object(b.jsx)(Te.Axis,{id:"x-axis",title:c.i18n.translate("xpack.ml.dataframe.analytics.exploration.featureImportanceXAxisTitle",{defaultMessage:"Feature importance average magnitude"}),position:Te.Position.Bottom,tickFormat:p}),Object(b.jsx)(Te.Axis,{id:"y-axis",title:"",position:Te.Position.Left}),Object(b.jsx)(Te.BarSeries,N()({id:"magnitude",xScaleType:Te.ScaleType.Ordinal,yScaleType:Te.ScaleType.Linear,data:o},r))))}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))},Re=({jobId:e})=>Object(b.jsx)(Oe,{jobId:e,title:c.i18n.translate("xpack.ml.dataframe.analytics.regressionExploration.tableJobIdTitle",{defaultMessage:"Destination index for regression job ID {jobId}",values:{jobId:e}}),EvaluatePanel:Me,FeatureImportanceSummaryPanel:De});a(760);var Le=a(507),Ne=a(367);const ze=({error:e})=>{let t=Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.generalErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},Object(b.jsx)("p",null,e));return"string"==typeof e&&e.includes("index_not_found")?t=Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.evaluateErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},Object(b.jsx)("p",null,c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noIndexCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the destination index exists and contains documents."}))):"string"==typeof e&&e.includes("No documents found")?t=Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutTitle",{defaultMessage:"Empty index query result."}),color:"primary"},Object(b.jsx)("p",null,c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the job has completed and the index contains documents."}))):"string"==typeof e&&e.includes("userProvidedQueryBuilder")&&(t=Object(b.jsx)(l.EuiCallOut,{title:c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorTitle",{defaultMessage:"Unable to parse query."}),color:"primary"},Object(b.jsx)("p",null,c.i18n.translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorBody",{defaultMessage:"The query syntax is invalid and returned no results. Please check the query syntax and try again."})))),Object(b.jsx)(s.Fragment,null,t)},Pe=({isLoading:e,title:t,description:a,dataTestSubj:s,tooltipContent:i})=>Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"xs","data-test-subj":s},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiStat,{reverse:!0,isLoading:e,title:null!==t?Math.round(1e3*t)/1e3:ye.a,description:a,titleSize:"xs"})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiIconTip,{anchorClassName:"mlDataFrameAnalyticsRegression__evaluateStat",content:i}))),$e=[{field:"className",name:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyClassColumn",{defaultMessage:"Class"}),sortable:!0,truncateText:!0},{field:"accuracy",name:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyAccuracyColumn",{defaultMessage:"Accuracy"}),render:e=>Math.round(1e3*e)/1e3},{field:"recall",name:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.recallAndAccuracyRecallColumn",{defaultMessage:"Recall"}),render:e=>Math.round(1e3*e)/1e3}],Ge=({evaluationMetricsItems:e})=>Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiAccordion,{id:"recall-and-accuracy",buttonContent:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRecallAndAccuracy",defaultMessage:"Per class recall and accuracy"})},Object(b.jsx)(l.EuiPanel,null,Object(b.jsx)(l.EuiInMemoryTable,{items:e,columns:$e,pagination:!0,sorting:!0}))));var qe=a(352);const Be=Object(l.euiPaletteGray)(1)[0],Ve="baseline",He=300,Ue=(e,t,a,s)=>{t.push({tpr:0,fpr:0,threshold:1,class_name:Ve}),t.push({tpr:1,fpr:1,threshold:1,class_name:Ve});const i=function(e){const t=[...e,Ve].sort().indexOf(Ve),a=Object(l.euiPaletteColorBlind)({rotations:2}).slice(0,e.length);return a.splice(t,0,Be),a}(e);return{$schema:"https://vega.github.io/schema/vega-lite/v4.8.1.json",background:"transparent",padding:{left:45,top:0,right:0,bottom:0},config:{legend:{orient:"right",labelColor:s.euiTextSubduedColor,titleColor:s.euiTextSubduedColor},view:{continuousHeight:He,continuousWidth:He}},data:{name:"roc-curve-data"},datasets:{"roc-curve-data":t},encoding:{color:{field:"class_name",type:qe.a.NOMINAL,scale:{range:i},legend:{title:a}},size:{value:2},strokeDash:{condition:{test:`(datum.class_name === '${Ve}')`,value:[5,5]},value:[0]},x:{field:"fpr",sort:null,title:c.i18n.translate("xpack.ml.dataframe.analytics.rocChartSpec.xAxisTitle",{defaultMessage:"False Positive Rate (FPR)"}),type:"quantitative",axis:{tickColor:Be,labelColor:s.euiTextSubduedColor,domainColor:Be,titleColor:s.euiTextSubduedColor}},y:{field:"tpr",title:c.i18n.translate("xpack.ml.dataframe.analytics.rocChartSpec.yAxisTitle",{defaultMessage:"True Positive Rate (TPR) (a.k.a Recall)"}),type:"quantitative",axis:{tickColor:Be,labelColor:s.euiTextSubduedColor,domainColor:Be,titleColor:s.euiTextSubduedColor}},tooltip:[{type:qe.a.NOMINAL,field:"class_name"},{type:qe.a.QUANTITATIVE,field:"fpr"},{type:qe.a.QUANTITATIVE,field:"tpr"}]},height:He,width:He,mark:{type:"line",strokeCap:"round",strokeJoin:"round"}}},Qe="actual_class",We="other";function Je(e,t){return[{id:"actions",width:60,headerCellRender:()=>Object(b.jsx)("span",null,`${e} more`),rowCellRender:function(){const[e,a]=Object(s.useState)(!1);return Object(b.jsx)(l.EuiPopover,{isOpen:e,anchorPosition:"upCenter",button:Object(b.jsx)(l.EuiButtonIcon,{"aria-label":c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.showActions",{defaultMessage:"Show actions"}),iconType:"boxesHorizontal",color:"text",onClick:()=>a(!e)}),closePopover:()=>a(!1),ownFocus:!0},Object(b.jsx)(l.EuiButtonEmpty,{onClick:()=>t(!0)},Object(b.jsx)(l.EuiText,{size:"s",grow:!1,textAlign:"center"},c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.showAllColumns",{defaultMessage:"Show all columns"}))))}}]}function Ke(e,t){let a;const s=Object(ye.i)(e)&&(e.bool.should||e.bool.filter);if(void 0!==s&&!1!==s)for(let e=0;e<s.length;e++){const i=s[e];if(i.match&&void 0!==i.match[`${t}.is_training`]){a=i.match[`${t}.is_training`];break}if(i.bool&&(void 0!==i.bool.should||void 0!==i.bool.filter)){const e=i.bool.should||i.bool.filter;if(void 0!==e)for(let s=0;s<e.length;s++){const i=e[s];if(i.match&&void 0!==i.match[`${t}.is_training`]){a=i.match[`${t}.is_training`];break}}}}return a}var Ye=a(215);const Xe=1e5;var Ze=a(212);const et=()=>Object(b.jsx)(Ze.a,{anchorPosition:"upCenter",title:c.i18n.translate("xpack.ml.dataframe.analytics.confusionMatrixPopoverTitle",{defaultMessage:"Normalized confusion matrix"})},Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixBasicExplanation",defaultMessage:"The multiclass confusion matrix provides a summary of the performance of the classification analysis. It contains the proportion of the data points that the analysis classified correctly with their actual class as well as the proportion of the misclassified data points."})),Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixAxisExplanation",defaultMessage:"The matrix contains the actual labels on the left side while the predicted labels are on the top. The proportion of correct and incorrect predictions is broken down for each class. This enables you to examine how the classification analysis confused the different classes while it made its predictions. If you want to see the exact number of occurrences, select a cell in the matrix and click the appearing icon."})),Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixShadeExplanation",defaultMessage:"As the number of classes in the classification analysis increases, the confusion matrix also increases in complexity. For an easier overview, darker cells indicate higher percentage of the predictions."})),Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.confusionMatrixColumnExplanation",defaultMessage:"The Columns selector enables you to toggle between showing or hiding some of the columns or all of them."}))),tt=()=>Object(b.jsx)(Ze.a,{anchorPosition:"upCenter",title:c.i18n.translate("xpack.ml.dataframe.analytics.rocCurvePopoverTitle",{defaultMessage:"Receiver operating characteristic (ROC) curve"})},Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveBasicExplanation",defaultMessage:"The ROC curve is a plot that represents the performance of the classification process at different predicted probability thresholds."})),Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveCompute",defaultMessage:"It compares the true positive rate (y-axis) for a specific class against the false positive rate (x-axis) at the different threshold levels to create the curve."})),Object(b.jsx)("p",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.rocCurveAuc",defaultMessage:"From this plot, the area under the curve (AUC) value can be computed, which is a number between 0 and 1. The closer to 1, the better the algorithm performance."})));var at=function(e){return e.TRAINING="training",e.TESTING="testing",e.ENTIRE="entire",e}(at||{});const st=c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixEntireHelpText",{defaultMessage:"Normalized confusion matrix for entire dataset"}),it=c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTestingHelpText",{defaultMessage:"Normalized confusion matrix for testing dataset"}),lt=c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTrainingHelpText",{defaultMessage:"Normalized confusion matrix for training dataset"}),nt=c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluationQualityMetricsHelpText",{defaultMessage:"Evaluation quality metrics"});function ot(e){let t=st;return e===at.TESTING?t=it:e===at.TRAINING&&(t=lt),t}const rt=({jobConfig:e,jobStatus:t,searchQuery:a})=>{const{services:{docLinks:o}}=Object(x.d)(),{euiTheme:d}=Object(x.a)(),[m,j]=Object(s.useState)([]),[p,f]=Object(s.useState)([]),[g,O]=Object(s.useState)(!1),[y,v]=Object(s.useState)(at.ENTIRE),[h,_]=Object(s.useState)((()=>m.map((({id:e})=>e)))),S=Ke(a,e.dest.results_field),{avgRecall:M,confusionMatrixData:T,docsCount:C,error:k,isLoading:w,overallAccuracy:A,evaluationMetricsItems:D}=((e,t)=>{const[a,i]=Object(s.useState)([]),[l,n]=Object(s.useState)(null),[o,c]=Object(s.useState)(null),[d,m]=Object(s.useState)([]),[b,j]=Object(s.useState)(!1),[x,p]=Object(s.useState)(null),[f,g]=Object(s.useState)(null);return Object(s.useEffect)((()=>{!async function(){j(!0);let a=!1;const s=Object(u.c)(e.analysis),l=e.dest.results_field,o=Ke(t,l);try{a=Ye.a.isKeywordAndTextType(s)}catch(e){console.error("Unable to load new field types",e)}const d=await Object(E.j)({isTraining:o,index:e.dest.index,dependentVariable:s,resultsField:l,predictionFieldName:Object(u.e)(e.analysis),searchQuery:t,jobType:r.b.CLASSIFICATION,requiresKeyword:a}),b=await Object(E.i)({isTraining:o,searchQuery:t,resultsField:l,destIndex:e.dest.index});if(!0===d.success&&d.eval&&Object(ye.g)(d.eval)){var x,f,O,y,v,h,_,S,M,T;const e=null===(x=d.eval)||void 0===x||null===(f=x.classification)||void 0===f||null===(O=f.multiclass_confusion_matrix)||void 0===O?void 0:O.confusion_matrix;g(null),i(e||[]),c((null===(y=d.eval)||void 0===y||null===(v=y.classification)||void 0===v||null===(h=v.recall)||void 0===h?void 0:h.avg_recall)||null),n((null===(_=d.eval)||void 0===_||null===(S=_.classification)||void 0===S||null===(M=S.accuracy)||void 0===M?void 0:M.overall_accuracy)||null),m(function(e){var t,a;if(void 0===e)return[];const s=(null===(t=e.accuracy)||void 0===t?void 0:t.classes)||[],i=(null===(a=e.recall)||void 0===a?void 0:a.classes)||[],l=s.reduce(((e,t)=>(e[t.class_name]={className:t.class_name,accuracy:t.value},e)),{});return i.forEach((e=>{void 0!==l[e.class_name]?l[e.class_name]={recall:e.value,...l[e.class_name]}:l[e.class_name]={className:e.class_name,recall:e.value}})),Object.values(l)}(null===(T=d.eval)||void 0===T?void 0:T.classification)),j(!1)}else j(!1),i([]),g(d.error);!0===b.success?p(b.docsCount):p(null)}()}),[JSON.stringify([e,t])]),{avgRecall:o,confusionMatrixData:a,docsCount:x,error:f,isLoading:b,overallAccuracy:l,evaluationMetricsItems:d}})(e,a);Object(s.useEffect)((()=>{v(void 0===S?at.ENTIRE:S&&!0===S?at.TRAINING:at.TESTING)}),[S]),Object(s.useEffect)((()=>{if(T.length>0){const{columns:e,columnData:t}=function(e){const t=[],a=[{id:Qe,display:Object(b.jsx)("span",null),initialWidth:165}];let s=!1;for(const i of e){const e=i.other_predicted_class_doc_count;e>0&&(s=!0);const l={actual_class:i.actual_class,actual_class_doc_count:i.actual_class_doc_count,other:e,predicted_classes_count:{}},n=i.predicted_classes||[];a.push({id:i.actual_class,initialWidth:165});for(let e=0;e<n.length;e++){const t=n[e].predicted_class,a=n[e].count;l.predicted_classes_count[t]=a}t.push(l)}return s&&a.push({id:We,initialWidth:165}),{columns:a,columnData:t}}(T);_((()=>e.map((({id:e})=>e)))),j(e),f(t)}}),[T]);const{rocCurveData:R,classificationClasses:L,error:N,isLoading:z}=((e,t,a)=>{const i=a.filter((e=>e!==Qe&&e!==We));i.length<=2&&i.splice(1);const[l,n]=Object(s.useState)([]),[o,c]=Object(s.useState)(!1),[d,m]=Object(s.useState)(null);return Object(s.useEffect)((()=>{!async function(){c(!0);const a=Object(u.c)(e.analysis),s=e.dest.results_field,l=[];let o=!1;const d=[];try{o=Ye.a.isKeywordAndTextType(a)}catch(e){console.error("Unable to load new field types",e)}for(let n=0;n<i.length;n++){const c=i[n],m=await Object(E.j)({isTraining:Ke(t,s),index:e.dest.index,dependentVariable:a,resultsField:s,predictionFieldName:Object(u.e)(e.analysis),searchQuery:t,jobType:r.b.CLASSIFICATION,requiresKeyword:o,rocCurveClassName:c,includeMulticlassConfusionMatrix:!1});if(!0===m.success&&m.eval&&Object(ye.g)(m.eval)){var b,j,x,p,f,g;const e=(null===(b=m.eval)||void 0===b||null===(j=b.classification)||void 0===j||null===(x=j.auc_roc)||void 0===x?void 0:x.value)||0,t=i.length>2?i[n]:"ROC",a=((null===(p=m.eval)||void 0===p||null===(f=p.classification)||void 0===f||null===(g=f.auc_roc)||void 0===g?void 0:g.curve)||[]).map((a=>({class_name:`${t} (AUC: ${Math.round(e*Xe)/Xe})`,...a})));l.push(...a)}else null!==m.error&&d.push(m.error)}m(d.length>0?d:null),n(l),c(!1)}()}),[JSON.stringify([e,t,a])]),{rocCurveData:l,classificationClasses:i.length>2?i:["ROC"],error:d,isLoading:o}})(e,a,m.map((e=>e.id))),P=o.links.ml.classificationEvaluation,$=p.length>6,G=p.length-6,q=!0===$&&!1===g?m.slice(0,7):m,B=!0===$&&!1===g?6:p.length;return Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(I,{urlStateKey:"evaluation",dataTestId:"ClassificationEvaluation",title:Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:Object(b.jsx)(l.EuiButtonEmpty,{target:"_blank",iconType:"help",iconSide:"left",size:"xs",color:"primary",href:P},Object(b.jsx)(l.EuiText,{size:"xs",color:"primary"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.classificationDocsLink",defaultMessage:"Classification evaluation docs "}))),headerItems:w?F:[...void 0!==t?[{id:"jobStatus",label:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:t}]:[],...null!==C?[{id:"docsEvaluated",label:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.generalizationDocsCount",{defaultMessage:"{docsCount, plural, one {doc} other {docs}} evaluated",values:{docsCount:C}}),value:C}]:[]],contentPadding:!0,content:Object(b.jsx)(i.a.Fragment,null,w?null:Object(b.jsx)(i.a.Fragment,null,null!==k&&Object(b.jsx)(ze,{error:k}),null===k&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(b.jsx)(l.EuiTitle,{size:"xxs"},Object(b.jsx)("span",null,ot(y))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(et,null))),Object(b.jsx)(l.EuiSpacer,{size:"m"}),Object(b.jsx)("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent"},Object(b.jsx)("div",{className:"mlDataFrameAnalyticsClassification__actualLabel"},Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixActualLabel",defaultMessage:"Actual class"}))),Object(b.jsx)("div",{className:"mlDataFrameAnalyticsClassification__dataGridMinWidth"},m.length>0&&p.length>0&&Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)("div",null,Object(b.jsx)(l.EuiText,{size:"xs",color:"subdued"},Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixPredictedLabel",defaultMessage:"Predicted class"}))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiDataGrid,{"data-test-subj":"mlDFAnalyticsClassificationExplorationConfusionMatrix","aria-label":c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixLabel",{defaultMessage:"Classification confusion matrix"}),columns:q,columnVisibility:{visibleColumns:h,setVisibleColumns:_},rowCount:B,renderCellValue:({rowIndex:e,columnId:t,setCellProps:a,schema:i,isDetails:l})=>{const n=t===Qe?p[e][t]:p[e].predicted_classes_count[t],o=p[e]&&p[e].actual_class_doc_count;let r="0%";if(t!==Qe&&o&&"number"==typeof n){let e=n/o;e=Math.round(100*e)/100,r=`${Math.round(100*e)}%`}Object(s.useEffect)((()=>{t!==Qe&&a({style:{backgroundColor:`rgba(0, 179, 164, ${r})`}})}),[e,t,a]);let c=t===Qe?n:r;if(l&&"numeric"===i){const a=p[e];void 0!==a&&t!==Qe&&(c=`${a.predicted_classes_count[t]} / ${a.actual_class_doc_count} * 100 = ${c}`)}return Object(b.jsx)("span",null,c)},inMemory:{level:"sorting"},toolbarVisibility:{showColumnSelector:!0,showDisplaySelector:!1,showFullScreenSelector:!1,showSortSelector:!1},gridStyle:{border:"all",fontSize:"s",cellPadding:"s",stripes:!1,rowHover:"none",header:"shade"},trailingControlColumns:!0===$&&!1===g?Je(G,O):void 0})))))),Object(b.jsx)(l.EuiSpacer,{size:"xl"}),Object(b.jsx)(l.EuiTitle,{size:"xxs"},Object(b.jsx)("span",null,nt)),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,{direction:"column",justifyContent:"center",className:"mlDataFrameAnalyticsClassification__evaluationMetrics"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"l"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(Pe,{dataTestSubj:"mlDFAEvaluateSectionOverallAccuracyStat",title:A,isLoading:w,description:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionOverallAccuracyStat",{defaultMessage:"Overall accuracy"}),tooltipContent:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionOverallAccuracyTooltip",{defaultMessage:"The ratio of the number of correct class predictions to the total number of predictions."})})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(Pe,{dataTestSubj:"mlDFAEvaluateSectionAvgRecallStat",title:M,isLoading:w,description:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionMeanRecallStat",{defaultMessage:"Mean recall"}),tooltipContent:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionAvgRecallTooltip",{defaultMessage:"Mean recall shows how many of the data points that are actual class members were identified correctly as class members."})})))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(Ge,{evaluationMetricsItems:D}))),Object(b.jsx)(l.EuiSpacer,{size:"l"}),Object(b.jsx)(l.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(b.jsx)(l.EuiTitle,{size:"xxs"},Object(b.jsx)("span",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRocTitle",defaultMessage:"Receiver operating characteristic (ROC) curve"}))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(tt,null))),Array.isArray(N)&&Object(b.jsx)(ze,{error:Object(b.jsx)(i.a.Fragment,null,N.map((e=>Object(b.jsx)(i.a.Fragment,null,e,Object(b.jsx)("br",null)))))}),!z&&null===N&&R.length>0&&Object(b.jsx)("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent","data-test-subj":"mlDFAnalyticsClassificationExplorationRocCurveChart"},Object(b.jsx)(Le.a,{vegaSpec:Ue(L,R,Object(u.c)(e.analysis),d)})),z&&Object(b.jsx)(Ne.a,null))}),Object(b.jsx)(l.EuiSpacer,{size:"m"}))},ct=({jobId:e})=>Object(b.jsx)("div",{className:"mlDataFrameAnalyticsClassification"},Object(b.jsx)(Oe,{jobId:e,title:c.i18n.translate("xpack.ml.dataframe.analytics.classificationExploration.tableJobIdTitle",{defaultMessage:"Destination index for classification job ID {jobId}",values:{jobId:e}}),EvaluatePanel:rt,FeatureImportanceSummaryPanel:De}));var ut=a(142),dt=a(134),mt=a(398),bt=a(244),jt=a(169);const xt=({jobId:e,analysisType:t})=>{const[a,c]=Object(s.useState)(),[u,d]=Object(s.useState)(!e),[m,j]=Object(s.useState)(!0),{services:{docLinks:p}}=Object(x.d)(),{dataFrameAnalytics:{getDataFrameAnalytics:f}}=Object(x.c)(),g=p.links.ml.dataFrameAnalytics,O=null!=e?e:null==a?void 0:a.job_id,[y,v]=Object(s.useState)(t||(null==a?void 0:a.analysis_type)),[,h]=Object(o.d)("_g");return Object(s.useEffect)((function(){(y!==t||null!=a&&a.analysis_type)&&v(t||(null==a?void 0:a.analysis_type))}),[a,t,y]),Object(s.useEffect)((function(){(async()=>{try{const{count:e}=await f(void 0,void 0,0);j(e>0)}catch(e){console.error("Error checking analytics jobs exist",e)}})()}),[]),Object(s.useEffect)((function(){void 0!==a&&h({ml:{...a.analysis_type?{analysisType:a.analysis_type}:{},...a.job_id?{jobId:a.job_id}:{}}})}),[null==a?void 0:a.job_id,null==a?void 0:a.model_id]),Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(mt.b,{setIsIdSelectorFlyoutVisible:d,selectedId:O}),u?Object(b.jsx)(mt.a,{setAnalyticsId:c,setIsIdSelectorFlyoutVisible:d}):null,void 0!==O&&Object(b.jsx)(dt.a,null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analyticsExploration.titleWithId",defaultMessage:"Explore results for job ID {id}",values:{id:O}})),void 0===O&&Object(b.jsx)(dt.a,null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analyticsExploration.title",defaultMessage:"Explore results"})),Object(b.jsx)(jt.a,{onCloseFlyout:()=>{v(void 0)}}),O&&y?Object(b.jsx)("div",{"data-test-subj":"mlPageDataFrameAnalyticsExploration"},y===r.b.OUTLIER_DETECTION&&Object(b.jsx)(ue,{jobId:O}),y===r.b.REGRESSION&&Object(b.jsx)(Re,{jobId:O}),y===r.b.CLASSIFICATION&&Object(b.jsx)(ct,{jobId:O})):!1===m?Object(b.jsx)(bt.a,null):Object(b.jsx)(i.a.Fragment,null,Object(b.jsx)(l.EuiEmptyPrompt,{iconType:"warning",title:Object(b.jsx)("h2",null,Object(b.jsx)(n.FormattedMessage,{id:"xpack.ml.dataframe.analyticsMap.noJobSelectedLabel",defaultMessage:"No Analytics ID selected"})),"data-test-subj":"mlNoAnalyticsFound"})),Object(b.jsx)(ut.a,{docLink:g}))}}}]);