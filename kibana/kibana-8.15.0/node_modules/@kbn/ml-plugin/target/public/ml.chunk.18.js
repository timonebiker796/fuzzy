/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[18],{196:function(e,t,a){"use strict";a.d(t,"k",(function(){return h})),a.d(t,"i",(function(){return O})),a.d(t,"j",(function(){return v})),a.d(t,"g",(function(){return y})),a.d(t,"h",(function(){return S})),a.d(t,"f",(function(){return M})),a.d(t,"m",(function(){return E})),a.d(t,"b",(function(){return k})),a.d(t,"c",(function(){return w})),a.d(t,"l",(function(){return C})),a.d(t,"d",(function(){return _})),a.d(t,"e",(function(){return F})),a.d(t,"a",(function(){return L}));var s=a(8),o=a(5),n=a(73),i=a(71),l=a(17),r=a(11),c=a(135),d=a(30),u=a(434),b=a(40),j=a(435),m=a(37),p=a(1),f=a(0),g=a(125);function h(e){return new Promise(((t,a)=>{r.ml.jobs.jobs([e]).then((a=>{if(!a.length)throw new Error(`Could not find job ${e}`);t(a[0])})).catch((e=>{a(e)}))}))}function x(e){return new Promise(((t,a)=>{r.ml.jobs.jobForCloning(e).then((a=>{if(!a)throw new Error(`Could not find job ${e}`);t(a)})).catch((e=>{a(e)}))}))}function O(e){return e.some((e=>e.datafeedState===d.a.STOPPED&&e.jobState!==d.c.CLOSING))}function v(e){return e.some((e=>e.datafeedState===d.a.STARTED||e.datafeedState===d.a.STARTING))}function y(e){return e.some((e=>e.datafeedState===d.a.STOPPED&&e.jobState!==d.c.CLOSED&&e.jobState!==d.c.CLOSING))}function S(e){return e.some((e=>{var t;return e.jobState===d.c.CLOSED||(null===(t=e.blocked)||void 0===t?void 0:t.reason)===u.a.RESET}))}function M(e,t,a,s=(()=>{})){const i=e.filter((e=>e.hasDatafeed)).map((e=>e.datafeedId));n.mlJobService.forceStartDatafeeds(i,t,a).then((e=>{T(e,d.a.STARTED),s()})).catch((e=>{Object(l.f)().addDanger(o.i18n.translate("xpack.ml.jobsList.startJobErrorMessage",{defaultMessage:"Jobs failed to start"}),e),s()}))}function E(e,t=(()=>{})){const a=e.filter((e=>e.hasDatafeed)).map((e=>e.datafeedId));n.mlJobService.stopDatafeeds(a).then((e=>{T(e,d.a.STOPPED),t()})).catch((e=>{Object(l.f)().addDanger(o.i18n.translate("xpack.ml.jobsList.stopJobErrorMessage",{defaultMessage:"Jobs failed to stop"}),e),t()}))}function T(e,t){const a=[],s=[];for(const o in e)!0===e[o][t]||!1===e[o][t]&&409===e[o].error.statusCode&&t===d.a.STARTED?a.push(o):s.push({id:o,result:e[o]});let n="",r="";t===d.a.STARTED?(n=o.i18n.translate("xpack.ml.jobsList.startActionStatusText",{defaultMessage:"start"}),r=o.i18n.translate("xpack.ml.jobsList.startedActionStatusText",{defaultMessage:"started"})):t===d.a.STOPPED?(n=o.i18n.translate("xpack.ml.jobsList.stopActionStatusText",{defaultMessage:"stop"}),r=o.i18n.translate("xpack.ml.jobsList.stoppedActionStatusText",{defaultMessage:"stopped"})):t===d.a.DELETED?(n=o.i18n.translate("xpack.ml.jobsList.deleteActionStatusText",{defaultMessage:"delete"}),r=o.i18n.translate("xpack.ml.jobsList.deletedActionStatusText",{defaultMessage:"deleted"})):t===d.c.CLOSED?(n=o.i18n.translate("xpack.ml.jobsList.closeActionStatusText",{defaultMessage:"close"}),r=o.i18n.translate("xpack.ml.jobsList.closedActionStatusText",{defaultMessage:"closed"})):t===u.a.RESET&&(n=o.i18n.translate("xpack.ml.jobsList.resetActionStatusText",{defaultMessage:"reset"}),r=o.i18n.translate("xpack.ml.jobsList.resetActionStatusText",{defaultMessage:"reset"}));const c=Object(l.f)();a.length>0&&c.addSuccess(o.i18n.translate("xpack.ml.jobsList.actionExecuteSuccessfullyNotificationMessage",{defaultMessage:"{successesJobsCount, plural, one{{successJob}} other{# jobs}} {actionTextPT} successfully",values:{successesJobsCount:a.length,successJob:a[0],actionTextPT:r}})),s.length>0&&s.forEach((e=>{Object(i.toastNotificationServiceProvider)(c).displayErrorToast(e.result.error,o.i18n.translate("xpack.ml.jobsList.actionFailedNotificationMessage",{defaultMessage:"{failureId} failed to {actionText}",values:{failureId:e.id,actionText:n}}))}))}async function k(e){try{var t;const[{job:s,datafeed:o},i]=await Promise.all([x(e),h(e)]),r=null==i||null===(t=i.custom_settings)||void 0===t?void 0:t.created_by;var a;if(void 0!==s&&void 0!==r&&r!==g.a.ADVANCED){if(n.mlJobService.tempJobCloningObjects.createdBy=null==i||null===(a=i.custom_settings)||void 0===a?void 0:a.created_by,n.mlJobService.tempJobCloningObjects.job=s,void 0!==i.data_counts.earliest_record_timestamp&&void 0!==i.data_counts.latest_record_timestamp&&void 0!==i.data_counts.latest_bucket_timestamp){let e=i.data_counts.earliest_record_timestamp,t=i.data_counts.latest_record_timestamp;if(void 0!==i.datafeed_config.aggregations){const a=Object(b.a)(i.analysis_config.bucket_span).asMilliseconds();e=Math.floor(i.data_counts.earliest_record_timestamp/a)*a,t=i.data_counts.latest_bucket_timestamp+2*a-1}n.mlJobService.tempJobCloningObjects.start=e,n.mlJobService.tempJobCloningObjects.end=t}}else n.mlJobService.tempJobCloningObjects.job=s,n.mlJobService.tempJobCloningObjects.createdBy=void 0;void 0!==o&&(n.mlJobService.tempJobCloningObjects.datafeed=o),i.calendars&&(n.mlJobService.tempJobCloningObjects.calendars=await j.a.fetchCalendarsByIds(i.calendars)),Object(l.b)().navigateToApp(f.g,{path:p.b.ANOMALY_DETECTION_CREATE_JOB})}catch(t){Object(i.getToastNotificationService)().displayErrorToast(t,o.i18n.translate("xpack.ml.jobsList.cloneJobErrorMessage",{defaultMessage:"Could not clone {jobId}. Job could not be found",values:{jobId:e}}))}}function w(e,t=(()=>{})){const a=e.map((e=>e.id));n.mlJobService.closeJobs(a).then((e=>{T(e,d.c.CLOSED),t()})).catch((e=>{Object(i.getToastNotificationService)().displayErrorToast(e,o.i18n.translate("xpack.ml.jobsList.closeJobErrorMessage",{defaultMessage:"Jobs failed to close"})),t()}))}function C(e,t,a=(()=>{})){n.mlJobService.resetJobs(e,t).then((e=>{T(e,u.a.RESET),a()})).catch((e=>{Object(i.getToastNotificationService)().displayErrorToast(e,o.i18n.translate("xpack.ml.jobsList.resetJobErrorMessage",{defaultMessage:"Jobs failed to reset"})),a()}))}function _(e,t,a,s=(()=>{})){const l=e.map((e=>e.id));n.mlJobService.deleteJobs(l,t,a).then((e=>{T(e,d.c.DELETED),s()})).catch((e=>{Object(i.getToastNotificationService)().displayErrorToast(e,o.i18n.translate("xpack.ml.jobsList.deleteJobErrorMessage",{defaultMessage:"Jobs failed to delete"})),s()}))}function F(e,t){if(0===t.length)return e;const a=e.reduce(((e,t)=>(e[t.id]={job:t,count:0},e)),{});t.forEach((t=>{const s="must"===t.match;let o=[];"term"===t.type?o=!0===s?e.filter((e=>Object(c.h)(e.id,t.value)===s||Object(c.h)(e.description,t.value)===s||Object(c.h)(e.memory_status,t.value)===s)):e.filter((e=>Object(c.h)(e.id,t.value)===s&&Object(c.h)(e.description,t.value)===s&&Object(c.h)(e.memory_status,t.value)===s)):Array.isArray(t.value)?"id"===t.field?o=e.filter((e=>t.value.indexOf(I(e,t.field))>=0)):"groups"===t.field?o=e.filter((e=>I(e,t.field).some((e=>t.value.indexOf(e)>=0)))):"job_tags"===t.field&&(o=A(e,t.value)):o="job_tags"===t.field?o=A(e,[t.value]):e.filter((e=>I(e,t.field)===t.value)),o.forEach((e=>a[e.id].count++))}));const o=[];return Object(s.each)(a,(e=>{e.count>=t.length&&o.push(e.job)})),o}function I(e,t){return e[{job_state:"jobState",datafeed_state:"datafeedState",groups:"groups",id:"id",job_tags:"jobTags"}[t]]}function A(e,t){return e.filter((e=>{const a=I(e,"job_tags");return Object.entries(a).map((e=>e.join(":"))).find((e=>t.some((t=>t===e))))}))}function L(){const e=n.mlJobService.tempJobCloningObjects.job,t=n.mlJobService.tempJobCloningObjects.datafeed;if(void 0!==e){n.mlJobService.tempJobCloningObjects.job=void 0,n.mlJobService.tempJobCloningObjects.datafeed=void 0,n.mlJobService.tempJobCloningObjects.createdBy=void 0;const a=Object(m.a)(t),s=a?t.datafeed_id:"";return{id:e.job_id,hasDatafeed:a,latestTimestampSortValue:0,datafeedId:s}}}},221:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s=e=>t=>{t.currentTarget.blur(),e()}},236:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a(5),o=a(17);function n(e,t,a,n){let i="",l=`ml-job-${t}`;switch(e){case"explorer":i=s.i18n.translate("xpack.ml.anomalyExplorerPageLabel",{defaultMessage:"Anomaly Explorer"});break;case"timeseriesexplorer":i=s.i18n.translate("xpack.ml.singleMetricViewerPageLabel",{defaultMessage:"Single Metric Viewer"});break;case"jobs/new_job/datavisualizer":i=s.i18n.translate("xpack.ml.dataVisualizerPageLabel",{defaultMessage:"Data Visualizer"}),l=`ml-datavisualizer-${t}`;break;default:return void console.error("addItemToRecentlyAccessed - No page specified")}(null!=n?n:Object(o.e)()).add(a,`ML - ${t} - ${i}`,l)}},317:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));var s=a(2),o=a.n(s),n=a(25),i=a(5),l=a(15),r=a(415),c=a(11),d=a(10),u=a(834),b=a(80),j=a(326),m=a(40),p=a(39),f=a.n(p),g=a(6);const h=({calendarEvents:e,setCalendarEvents:t,minSelectableTimeStamp:a,maxSelectableTimeStamp:r,eventRateData:c,anomalies:u,chartReady:b})=>{const j=f()(r),m=f()(a),{euiTheme:p}=Object(d.a)(),h=Object(s.useCallback)((({x:s})=>{if(s&&2===s.length){const o=s[1]<a?null:s[1];if(null!==o){const n=s[0]<a?a:s[0];t([...e,{start:f()(n),end:f()(o),description:v(e.length+1)}])}}}),[e]),y=Object(s.useCallback)(((a,s)=>{const o=e[s];void 0===o?t([...e,{start:a,end:null,description:v(s)}]):(o.start=a,t([...e]))}),[e]),S=Object(s.useCallback)(((a,s)=>{const o=e[s];void 0===o?t([...e,{start:null,end:a,description:v(s)}]):(o.end=a,t([...e]))}),[e]),M=Object(s.useCallback)(((a,s)=>{const o=e[s];void 0!==o&&(o.description=a,t([...e]))}),[e]),E=Object(s.useCallback)((a=>{if(void 0!==e[a]){const s=[...e];s.splice(a,1),t(s)}}),[e]);return Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(n.EuiSpacer,{size:"l"}),Object(g.jsx)("div",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.revertModelSnapshotFlyout.createCalendar.title",defaultMessage:"Select time range for calendar event."})),Object(g.jsx)(n.EuiSpacer,{size:"m"}),Object(g.jsx)(x,{eventRateData:c,anomalies:u,loading:!1===b,overlayRanges:e.filter(O).map((e=>({start:e.start.valueOf(),end:e.end.valueOf()}))),onBrushEnd:h,overlayColor:p.euiColorPrimary}),Object(g.jsx)(n.EuiSpacer,{size:"s"}),e.map(((e,t)=>{var a,o;return Object(g.jsx)(s.Fragment,{key:t},Object(g.jsx)(n.EuiPanel,{paddingSize:"s"},Object(g.jsx)(n.EuiFlexGroup,null,Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFlexGroup,null,Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFormRow,{label:i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.fromLabel",{defaultMessage:"From"})},Object(g.jsx)(n.EuiDatePicker,{showTimeSelect:!0,selected:e.start,minDate:m,maxDate:null!==(a=e.end)&&void 0!==a?a:j,onChange:e=>y(e,t)}))),Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFormRow,{label:i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.toLabel",{defaultMessage:"To"})},Object(g.jsx)(n.EuiDatePicker,{showTimeSelect:!0,selected:e.end,minDate:null!==(o=e.start)&&void 0!==o?o:m,maxDate:j,onChange:e=>S(e,t)})))),Object(g.jsx)(n.EuiSpacer,{size:"s"}),Object(g.jsx)(n.EuiFlexGroup,null,Object(g.jsx)(n.EuiFlexItem,null,Object(g.jsx)(n.EuiFormRow,{fullWidth:!0,label:i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.descriptionLabel",{defaultMessage:"Description"})},Object(g.jsx)(n.EuiFieldText,{fullWidth:!0,value:e.description,onChange:e=>M(e.target.value,t)}))))),Object(g.jsx)(n.EuiFlexItem,{grow:!1,style:{borderLeft:`1px solid ${p.euiColorLightShade}`,marginRight:"0px"}}),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiButtonIcon,{style:{margin:"auto"},color:"danger",onClick:()=>E(t),iconType:"trash","aria-label":i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.deleteLabel",{defaultMessage:"Delete event"})})))),Object(g.jsx)(n.EuiSpacer,{size:"m"}))})))},x=Object(s.memo)((({eventRateData:e,anomalies:t,loading:a,onBrushEnd:s,overlayRanges:o,overlayColor:n})=>Object(g.jsx)(j.a,{eventRateChartData:e,anomalyData:t,loading:a,height:"100px",width:"100%",fadeChart:!0,overlayRanges:o.map((e=>({start:e.start,end:e.end,color:n,showMarker:!1}))),onBrushEnd:s})),((e,t)=>e.overlayRanges.length===t.overlayRanges.length&&JSON.stringify(e.overlayRanges)===JSON.stringify(t.overlayRanges)));function O(e){return null!==e.start&&null!==e.end}function v(e){return i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.defaultEventDescription",{defaultMessage:"Auto created event {index}",values:{index:e}})}var y=a(71);const S=({snapshot:e,snapshots:t,job:a,closeFlyout:p,refresh:f})=>{const{toasts:x}=Object(d.i)(),{loadAnomalyDataForJob:O,loadEventRateForJob:v}=Object(s.useMemo)((()=>{return e=b.mlResultsService,{loadEventRateForJob:async function(t,a,s){const o=Math.max(Math.floor((t.data_counts.latest_record_timestamp-t.data_counts.earliest_record_timestamp)/s),a),n=await e.getEventRateData(t.datafeed_config.indices.join(),t.datafeed_config.query,t.data_description.time_field,t.data_counts.earliest_record_timestamp,t.data_counts.latest_record_timestamp,o,t.datafeed_config.runtime_mappings,t.datafeed_config.indices_options);if(void 0!==n.error)throw n.error;const i=Object.entries(n.results).map((([e,t])=>({time:+e,value:t})));return i.length&&i.push({time:i[i.length-1].time+o,value:0}),i},loadAnomalyDataForJob:async function(t,a,s){const o=Math.max(Math.floor((t.data_counts.latest_record_timestamp-t.data_counts.earliest_record_timestamp)/s),a),n=(await e.getScoresByBucket([t.job_id],t.data_counts.earliest_record_timestamp,t.data_counts.latest_record_timestamp,o,1)).results[t.job_id];if(void 0===n)return[];const i={};return i[0]=Object.entries(n).map((([e,t])=>({time:+e,value:t,severity:Object(u.a)(t)}))),i}};var e}),[]),[S,E]=Object(s.useState)(e),[T,k]=Object(s.useState)(!1),[w,C]=Object(s.useState)(!1),[_,F]=Object(s.useState)(!1),[I,A]=Object(s.useState)(!1),[L,D]=Object(s.useState)([]),[J,R]=Object(s.useState)(!0),[N,V]=Object(s.useState)([]),[z,B]=Object(s.useState)([]),[P,G]=Object(s.useState)(!1);Object(s.useEffect)((()=>{$()}),[S]),Object(s.useEffect)((()=>{const e=L.some((e=>""===e.description||null===e.end||null===e.start));R(!1===e);const t=[...new Map(L.map((e=>{var t,a;return[`${null===(t=e.start)||void 0===t?void 0:t.valueOf()}${null===(a=e.end)||void 0===a?void 0:a.valueOf()}`,e]}))).values()];t.length<L.length&&D(t)}),[L]);const $=Object(s.useCallback)((async()=>{const e=Object(m.a)(a.analysis_config.bucket_span).asMilliseconds(),t=await v(a,e,100),s=await O(a,e,100);V(t),void 0!==s[0]&&B(s[0]),G(!0)}),[a]);function q(){k(!1)}return Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(n.EuiFlyout,{onClose:p,hideCloseButton:!0,size:"m"},Object(g.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(g.jsx)(n.EuiTitle,{size:"s"},Object(g.jsx)("h5",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.title",defaultMessage:"Revert to model snapshot {ssId}",values:{ssId:S.snapshot_id}}))),Object(g.jsx)(n.EuiText,{size:"s"},Object(g.jsx)("p",null,S.description))),Object(g.jsx)(n.EuiFlyoutBody,null,!1,Object(g.jsx)(j.a,{eventRateChartData:N,anomalyData:z,loading:!1===P,height:"100px",width:"100%",fadeChart:!0,overlayRanges:[{start:S.latest_record_time_stamp,end:a.data_counts.latest_record_timestamp,color:"#ff0000"}]}),Object(g.jsx)(n.EuiSpacer,{size:"l"}),Object(g.jsx)(n.EuiSpacer,{size:"l"}),Object(g.jsx)(n.EuiCallOut,{title:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.title",{defaultMessage:"Anomaly data will be deleted"}),color:"warning",iconType:"warning"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.contents",defaultMessage:"All anomaly detection results after {date} will be deleted.",values:{date:Object(r.d)(S.latest_record_time_stamp)}})),Object(g.jsx)(n.EuiHorizontalRule,{margin:"xl"}),Object(g.jsx)(n.EuiFormRow,{fullWidth:!0,helpText:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchHelp",{defaultMessage:"Reopen job and replay analysis after the revert has been applied."})},Object(g.jsx)(n.EuiSwitch,{id:"replaySwitch",label:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchLabel",{defaultMessage:"Replay analysis"}),checked:w,onChange:e=>C(e.target.checked)})),w&&Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(n.EuiFormRow,{fullWidth:!0,helpText:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchHelp",{defaultMessage:"Job will continue to run until manually stopped. All new data added to the index will be analyzed."})},Object(g.jsx)(n.EuiSwitch,{id:"realTimeSwitch",label:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchLabel",{defaultMessage:"Run job in real time"}),checked:_,onChange:e=>F(e.target.checked)})),Object(g.jsx)(n.EuiFormRow,{fullWidth:!0,helpText:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchHelp",{defaultMessage:"Create a new calendar and event to skip over a period of time when analyzing the data."})},Object(g.jsx)(n.EuiSwitch,{id:"createCalendarSwitch",label:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchLabel",{defaultMessage:"Create calendar to skip a range of time"}),checked:I,onChange:e=>A(e.target.checked)})),I&&Object(g.jsx)(h,{calendarEvents:L,setCalendarEvents:D,minSelectableTimeStamp:e.latest_record_time_stamp,maxSelectableTimeStamp:a.data_counts.latest_record_timestamp,eventRateData:N,anomalies:z,chartReady:P}))),Object(g.jsx)(n.EuiFlyoutFooter,null,Object(g.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiButtonEmpty,{iconType:"cross",onClick:p,flush:"left"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),Object(g.jsx)(n.EuiFlexItem,{grow:!0}),Object(g.jsx)(n.EuiFlexItem,{grow:!1},Object(g.jsx)(n.EuiButton,{onClick:function(){k(!0)},disabled:!0===I&&!1===J,fill:!0},Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.saveButton",defaultMessage:"Apply"})))))),T&&Object(g.jsx)(n.EuiConfirmModal,{title:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteTitle",{defaultMessage:"Apply snapshot revert"}),onCancel:q,onConfirm:async function(){const e=w&&!1===_?a.data_counts.latest_record_timestamp:void 0;try{const t=w&&I?L.filter(M).map((e=>({start:e.start.valueOf(),end:e.end.valueOf(),description:e.description}))):void 0;c.ml.jobs.revertModelSnapshot(a.job_id,S.snapshot_id,w,e,t).then((()=>{x.addSuccess(i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.revertSuccessTitle",{defaultMessage:"Model snapshot revert successful"})),f()})).catch((e=>{const{displayErrorToast:t}=Object(y.toastNotificationServiceProvider)(x);t(e)})),q(),p()}catch(e){x.addError(new Error(e.body.message),{title:i.i18n.translate("xpack.ml.revertModelSnapshotFlyout.revertErrorTitle",{defaultMessage:"Model snapshot revert failed"})})}},cancelButtonText:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:i.i18n.translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteButton",{defaultMessage:"Apply"}),buttonColor:"danger",defaultFocusedButton:"confirm"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.modalBody",defaultMessage:"The snapshot revert will be carried out in the background and may take some time."})))};function M(e){return null!==e.start&&null!==e.end}},325:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a(2);var s=a(25),o=a(6);const[n,i,l]=["info","warning","error"],r=({message:e,showTooltip:t=!1})=>{if(void 0===e)return Object(o.jsx)("span",null);let a="primary",r="warning";return e.level===n?r="iInCircle":e.level===i?a="warning":e.level===l&&(a="danger"),t?Object(o.jsx)(s.EuiToolTip,{position:"bottom",content:e.text},Object(o.jsx)(s.EuiIcon,{type:r,color:a})):Object(o.jsx)(s.EuiIcon,{type:r,color:a})}},395:function(e,t,a){"use strict";a.d(t,"a",(function(){return F})),a.d(t,"b",(function(){return I}));var s=a(120),o=a.n(s),n=a(2),i=a.n(n),l=a(15),r=a(5),c=a(39),d=a.n(c),u=a(25),b=a(76),j=a(30),m=a(71),p=a(10),f=a(317),g=a(439),h=a(6);const x=r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.tooltipContent",{defaultMessage:"To edit the query delay, you must have permission to edit the datafeed and the datafeed cannot be running."}),O=({datafeedId:e,queryDelay:t,isEnabled:a})=>{const[s,o]=Object(n.useState)(t),[c,d]=Object(n.useState)(),[b,j]=Object(n.useState)(!1),{updateDatafeed:f}=Object(p.c)(),{displaySuccessToast:g,displayErrorToast:O}=Object(m.useToastNotificationService)(),v=Object(n.useCallback)((async()=>{try{await f({datafeedId:e,datafeedConfig:{query_delay:c}}),o(c),g(r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.changesSavedNotificationMessage",{defaultMessage:"Changes to query delay for {datafeedId} saved",values:{datafeedId:e}}))}catch(t){O(t,r.i18n.translate("xpack.ml.jobsList.datafeedChart.editQueryDelay.changesNotSavedNotificationMessage",{defaultMessage:"Could not save changes to query delay for {datafeedId}",values:{datafeedId:e}}))}j(!1)}),[e,c]),y=Object(h.jsx)(u.EuiButtonEmpty,{color:"primary",size:"xs",isDisabled:!1===a,onClick:()=>{j(!0)},iconType:"pencil"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.queryDelayLinkLabel",defaultMessage:"Query delay: {queryDelay}",values:{queryDelay:c||t}})),S=Object(h.jsx)(u.EuiToolTip,{content:x},y);return Object(h.jsx)(i.a.Fragment,null,!1===b?!1===a?S:y:null,!0===b?Object(h.jsx)(u.EuiFormRow,{label:Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.queryDelayLabel",defaultMessage:"Query delay"})},Object(h.jsx)(u.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFieldText,{value:c||t,placeholder:t,onChange:e=>{d(e.target.value)}})),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFlexGroup,{gutterSize:"none",direction:"column"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiButtonEmpty,{disabled:c===s,color:"primary",size:"xs",onClick:v},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.applyQueryDelayLabel",defaultMessage:"Apply"}))),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiButtonEmpty,{color:"text",size:"xs",onClick:()=>j(!1)},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.cancelQueryDelayUpdateLabel",defaultMessage:"Cancel"}))))))):null)},v="forward",y=["100%",380];r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartTabName",{defaultMessage:"Chart"}),r.i18n.translate("xpack.ml.jobsList.datafeedChart.messagesTabName",{defaultMessage:"Messages"});var S=a(196),M=a(70);const E=(e,t)=>{const a=new Map(e);return t.reduce(((e,t)=>{var s;return e.push(a.has(t[0])?[t[0],null!==(s=a.get(t[0]))&&void 0!==s?s:null]:[t[0],null]),e}),[])},T=Object(b.timeFormatter)("MM-DD HH:mm:ss"),k=r.i18n.translate("xpack.ml.jobsList.datafeedChart.revertSnapshotMessage",{defaultMessage:"Click to revert to this model snapshot."}),w=r.i18n.translate("xpack.ml.jobsList.datafeedChart.notAvailableMessage",{defaultMessage:"N/A"});function C(e){return e.header=T(e.dataValue),e}const _=({details:e,datum:t})=>Object(h.jsx)("div",{className:"echAnnotation__tooltip"},Object(h.jsx)("p",{className:"echAnnotation__header"},T(t.header)),Object(h.jsx)("div",{className:"echAnnotation__details"},e)),F=({jobId:e,end:t,onClose:a,onModelSnapshotAnnotationClick:s})=>{const[c,f]=Object(n.useState)({datafeedConfig:void 0,bucketSpan:void 0,isInitialized:!1,modelSnapshotData:[]}),[x,F]=Object(n.useState)(d()(t)),[I,A]=Object(n.useState)(!1),[L,D]=Object(n.useState)([]),[J,R]=Object(n.useState)({rect:[],line:[]}),[N,V]=Object(n.useState)([]),[z,B]=Object(n.useState)([]),[P,G]=Object(n.useState)([]),[$,q]=Object(n.useState)(!0),[H,W]=Object(n.useState)(!1),[U,Q]=Object(n.useState)(),X=Object(n.useMemo)((()=>Object(M.checkPermission)("canUpdateDatafeed")),[]),Y=Object(n.useMemo)((()=>Object(M.checkPermission)("canCreateJob")),[]),K=Object(n.useMemo)((()=>Object(M.checkPermission)("canStartStopDatafeed")),[]),{getModelSnapshots:Z,results:{getDatafeedResultChartData:ee}}=Object(p.c)(),{displayErrorToast:te}=Object(m.useToastNotificationService)(),{euiTheme:ae}=Object(p.a)(),se=e=>{if(void 0===c.bucketSpan)return;const t=x.clone(),a=c.bucketSpan.match(/[d | h| m | s]/g)[0],s=Number(c.bucketSpan.replace(/[^0-9]/g,""));e===v?t.add(480*s,a):t.subtract(480*s,a),F(t)},oe=Object(n.useCallback)((async()=>{if(void 0===c.bucketSpan)return;const t=d()(x).valueOf(),a=c.bucketSpan.match(/[d | h| m | s]/g)[0],s=Number(c.bucketSpan.replace(/[^0-9]/g,"")),o=x.clone().subtract(480*s,a),n=d()(o).valueOf();Q({start:String(n),end:String(t)});try{const a=await ee(e,n,t);let s=a.datafeedResults,o=a.bucketResults;s.length!==o.length&&(s.length>o.length?o=E(o,s):s=E(s,o)),G(s),D(o),R({rect:a.annotationResultsRect,line:a.annotationResultsLine.map(C)}),V(c.modelSnapshotData.filter((e=>e.dataValue>=n&&e.dataValue<=t)))}catch(e){const t=r.i18n.translate("xpack.ml.jobsList.datafeedChart.errorToastTitle",{defaultMessage:"Error fetching data"});te(e,t)}A(!1)}),[x,c.bucketSpan]),ne=Object(n.useCallback)((async()=>{try{var t;const a=await Object(S.k)(e),s=[];(null!==(t=(await Z(e)).model_snapshots)&&void 0!==t?t:[]).forEach((e=>{const t=Number(e.latest_record_time_stamp);s.push({dataValue:t,details:`${e.description}. ${Y&&K?k:""}`,modelSnapshot:e})})),f({datafeedConfig:a.datafeed_config,bucketSpan:a.analysis_config.bucket_span,isInitialized:!0,modelSnapshotData:s.map(C)})}catch(e){te(e)}}),[e]);Object(n.useEffect)((function(){ne()}),[]),Object(n.useEffect)((function(){void 0!==c.bucketSpan&&(A(!0),oe())}),[x,c.bucketSpan]);const{datafeedConfig:ie,bucketSpan:le,isInitialized:re}=c,ce=Object(n.useMemo)((()=>Object(u.htmlIdGenerator)()()),[]),de=Object(n.useMemo)((()=>Object(u.htmlIdGenerator)()()),[]),ue=Object(n.useMemo)((()=>!L.some((e=>null!==e[1]&&0!==e[1]))&&!P.some((e=>null!==e[1]&&0!==e[1]))),[L,P]);return Object(h.jsx)(u.EuiPortal,null,Object(h.jsx)(u.EuiFlyout,{size:"m",ownFocus:!0,onClose:a.bind(null,!1),"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.datafeedChartFlyoutAriaLabel",{defaultMessage:"Datafeed chart flyout"}),"data-test-subj":"mlAnnotationsViewDatafeedFlyout"},Object(h.jsx)(u.EuiFlyoutHeader,{hasBorder:!0,"data-test-subj":"mlAnnotationsViewDatafeedFlyoutTitle"},Object(h.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"xl"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiIconTip,{color:"primary",type:"help",content:Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.headerTooltipContent",defaultMessage:"Charts the event counts of the job and the source data to identify where missing data has occurred."})})),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.header",defaultMessage:"Datafeed chart for {jobId}",values:{jobId:e}})))))),Object(h.jsx)(u.EuiFlexItem,{grow:!1,style:{padding:"10px"}},Object(h.jsx)(u.EuiDatePicker,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalEndTime",{defaultMessage:"Chart interval end time"}),showTimeSelect:!0,selected:x,onChange:e=>F(e),popoverPlacement:"leftUp"})))),Object(h.jsx)(u.EuiFlyoutBody,null,I||!1===re?Object(h.jsx)(u.EuiLoadingChart,{size:"l"}):null,!I&&re&&void 0!==ie&&le?Object(h.jsx)(u.EuiFlexGroup,{direction:"column"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(O,{datafeedId:ie.datafeed_id,queryDelay:ie.query_delay,isEnabled:ie.state===j.a.STOPPED&&X})),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFlexGroup,null,Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiCheckbox,{id:ce,label:Object(h.jsx)(u.EuiText,{size:"xs"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.showAnnotationsCheckboxLabel",defaultMessage:"Show annotations"})),checked:$,onChange:()=>q(!$)})),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiCheckbox,{id:de,label:Object(h.jsx)(u.EuiText,{size:"xs"},Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.showModelSnapshotsCheckboxLabel",defaultMessage:"Show model snapshots"})),checked:H,onChange:()=>W(!H)})))))),Object(h.jsx)(u.EuiFlexItem,null,Object(h.jsx)(u.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiToolTip,{content:Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.chartLeftArrowTooltip",defaultMessage:"Previous time window"})},Object(h.jsx)(u.EuiButtonEmpty,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalLeftArrow",{defaultMessage:"Previous time window"}),color:"primary",onClick:()=>{se("back")},iconType:"arrowLeft"}))),Object(h.jsx)(u.EuiFlexItem,null,Object(h.jsx)("div",{"data-test-subj":"mlAnnotationsViewDatafeedFlyoutChart"},Object(h.jsx)(b.Chart,{size:y},Object(h.jsx)(b.Tooltip,{type:b.TooltipType.VerticalCursor,showNullValues:!0}),Object(h.jsx)(b.Settings,{showLegend:!0,legendPosition:b.Position.Bottom,onAnnotationClick:e=>{var t;Y&&K&&0!==(null===(t=e.lines)||void 0===t?void 0:t.length)&&(!e.lines||e.lines[0].id.includes("Model snapshots"))&&s(e.lines[0].datum.modelSnapshot)},theme:{lineSeriesStyle:{point:{visible:!1}}},baseTheme:b.LEGACY_LIGHT_THEME,locale:r.i18n.getLocale()}),Object(h.jsx)(b.Axis,{id:"bottom",position:b.Position.Bottom,showOverlappingTicks:!0,tickFormat:T,title:r.i18n.translate("xpack.ml.jobsList.datafeedChart.xAxisTitle",{defaultMessage:"Bucket span ({bucketSpan})",values:{bucketSpan:le}})}),Object(h.jsx)(b.Axis,{id:"left",title:r.i18n.translate("xpack.ml.jobsList.datafeedChart.yAxisTitle",{defaultMessage:"Count"}),position:b.Position.Left,domain:ue?{min:0,max:10}:void 0,tickFormat:e=>null===e?w:String(e)}),$?Object(h.jsx)(i.a.Fragment,null,Object(h.jsx)(b.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.annotationLineSeriesId",{defaultMessage:"Annotations line result"}),key:"annotation-results-line",domainType:b.AnnotationDomainType.XDomain,dataValues:J.line,marker:Object(h.jsx)(u.EuiIcon,{type:"annotation"}),markerPosition:b.Position.Top,style:{line:{strokeWidth:3,stroke:ae.euiColorDangerText,opacity:.5}}}),Object(h.jsx)(b.RectAnnotation,{key:"annotation-results-rect",customTooltip:_,dataValues:J.rect,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.annotationRectSeriesId",{defaultMessage:"Annotations rectangle result"}),style:{fill:ae.euiColorDangerText}})):null,H?Object(h.jsx)(b.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.modelSnapshotsLineSeriesId",{defaultMessage:"Model snapshots"}),key:"model-snapshots-results-line",domainType:b.AnnotationDomainType.XDomain,dataValues:N,marker:Object(h.jsx)(u.EuiIcon,{type:"asterisk"}),markerPosition:b.Position.Top,style:{line:{strokeWidth:3,stroke:ae.euiColorVis1,opacity:.5}}}):null,z.length>0?Object(h.jsx)(i.a.Fragment,null,Object(h.jsx)(b.LineAnnotation,{id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.messageLineAnnotationId",{defaultMessage:"Job messages line result"}),key:"messages-results-line",domainType:b.AnnotationDomainType.XDomain,dataValues:z,marker:Object(h.jsx)(u.EuiIcon,{type:"tableDensityNormal"}),markerPosition:b.Position.Top,style:{line:{strokeWidth:3,stroke:ae.euiColorAccent,opacity:.5}}})):null,Object(h.jsx)(b.LineSeries,{key:"source-results",color:ae.euiColorPrimary,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.sourceSeriesId",{defaultMessage:"Source indices document count"}),xScaleType:b.ScaleType.Time,yScaleType:b.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:P,curve:b.CurveType.LINEAR}),Object(h.jsx)(b.LineSeries,{key:"job-results",color:ae.euiColorAccentText,id:r.i18n.translate("xpack.ml.jobsList.datafeedChart.bucketSeriesId",{defaultMessage:"Datafeed document count"}),xScaleType:b.ScaleType.Time,yScaleType:b.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:L,curve:b.CurveType.LINEAR})))),Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiToolTip,{content:Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.chartRightArrowTooltip",defaultMessage:"Next time window"})},Object(h.jsx)(u.EuiButtonEmpty,{"aria-label":r.i18n.translate("xpack.ml.jobsList.datafeedChart.chartIntervalRightArrow",{defaultMessage:"Next time window"}),color:"primary",onClick:()=>{se(v)},iconType:"arrowRight"}))))),void 0!==U?Object(h.jsx)(u.EuiFlexItem,{grow:!1},Object(h.jsx)(u.EuiFlexGroup,{direction:"column"},Object(h.jsx)(u.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.datafeedChart.messagesTableTitle",defaultMessage:"Job messages"}))),Object(h.jsx)(g.a,o()({jobId:e},U,{actionHandler:function(e){if(z.length>0&&z[0].dataValue===e.timestamp)B([]);else{const t=C({dataValue:e.timestamp,details:e.message});B([t])}}})))):null):null)))},I=({setShowFunction:e,unsetShowFunction:t,refreshJobs:a})=>{const[s,o]=Object(n.useState)(!1),[i,l]=Object(n.useState)(),[r,c]=Object(n.useState)(),[d,u]=Object(n.useState)(!1),[b,j]=Object(n.useState)(null),m=Object(n.useCallback)((e=>{l(e),o(!0)}),[]),p=Object(n.useCallback)((async()=>{const e=await Object(S.k)(i.id);c(e),u(!0)}),[i]);return Object(n.useEffect)((()=>(e(m),()=>{t()})),[]),!0===s&&void 0!==i?Object(h.jsx)(F,{onClose:()=>o(!1),onModelSnapshotAnnotationClick:e=>{o(!1),j(e),p()},end:i.latestResultsTimestampMs||Date.now(),jobId:i.id}):!0===d&&void 0!==r&&null!==b?Object(h.jsx)(f.a,{snapshot:b,snapshots:[b],job:r,closeFlyout:()=>{u(!1)},refresh:a}):null}},404:function(e,t,a){"use strict";a.d(t,"a",(function(){return I}));var s=a(120),o=a.n(s),n=a(4),i=a.n(n),l=a(8),r=a(2),c=a(287),d=a.n(c),u=a(25),b=a(5),j=a(15),m=a(236),p=a(11),f=a(73),g=a(262),h=a(162),x=a(123),O=a(153),v=a(197),y=a(21),S=a(1),M=a(415),E=a(170),T=a(395),k=a(317),w=a(6);const C=Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.editAnnotationsTooltip",defaultMessage:"Edit annotation"}),_=Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.datafeedChartTooltip",defaultMessage:"View datafeed counts"}),F="current_series";class annotations_table_AnnotationsTableUI extends r.Component{constructor(e){super(e),i()(this,"getAnnotationsWithExtraInfo",d()((e=>{var t,a;return Array.isArray(null===(t=this.props.chartDetails)||void 0===t||null===(a=t.entityData)||void 0===a?void 0:a.entities)?e.map((e=>{var t,a;const s=null===(t=this.props.chartDetails)||void 0===t||null===(a=t.entityData)||void 0===a?void 0:a.entities.every((({fieldType:t,fieldValue:a})=>{const s=`${t}_value`;return!(!e[s]||e[s]!==a)}));return{...e,[F]:s}})):e}))),i()(this,"annotationsRefreshSubscription",null),i()(this,"previousJobId",void 0),i()(this,"openSingleMetricView",(async(e={})=>{const{services:{application:{navigateToUrl:t},share:a}}=this.props.kibana,s=this.getJob(e.job_id),o=s.data_counts,n=Object(x.j)(o.latest_record_timestamp,o.latest_bucket_timestamp),i={from:new Date(o.earliest_record_timestamp).toISOString(),to:new Date(n).toISOString(),mode:"absolute"};let l={};const r={};void 0!==e.timestamp&&void 0!==e.end_timestamp&&(l={zoom:{from:new Date(e.timestamp).toISOString(),to:new Date(e.end_timestamp).toISOString()}},e.timestamp<o.earliest_record_timestamp&&(i.from=new Date(e.timestamp).toISOString()),e.end_timestamp>o.latest_record_timestamp&&(i.to=new Date(e.end_timestamp).toISOString())),void 0!==e.detector_index&&(l.detectorIndex=e.detector_index),void 0!==e.partition_field_value&&(r[e.partition_field_name]=e.partition_field_value),void 0!==e.over_field_value&&(r[e.over_field_name]=e.over_field_value),void 0!==e.by_field_value&&(r[e.by_field_name]=e.by_field_value),l.entities=r;const c=a.url.locators.get(S.a),d=await c.getUrl({page:S.b.SINGLE_METRIC_VIEWER,pageState:{timeRange:i,refreshInterval:{display:"Off",pause:!0,value:0},jobIds:[s.job_id],query:{query_string:{analyze_wildcard:!0,query:"*"}},...l}},{absolute:!0});Object(m.a)("timeseriesexplorer",s.job_id,d),await t(d)})),i()(this,"onMouseOverRow",(e=>{void 0!==this.mouseOverRecord?this.mouseOverRecord.rowId!==e.rowId&&(g.a.rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"}),g.a.rowMouseenter$.next({record:e,type:"annotation"})):g.a.rowMouseenter$.next({record:e,type:"annotation"}),this.mouseOverRecord=e})),i()(this,"onMouseLeaveRow",(()=>{void 0!==this.mouseOverRecord&&(g.a.rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"}),this.mouseOverRecord=void 0)})),this.state={annotations:[],isLoading:!1,queryText:`event:(${v.b} or ${v.a})`,searchError:void 0,jobId:Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&void 0!==this.props.jobs[0]?this.props.jobs[0].job_id:void 0,datafeedFlyoutVisible:!1,modelSnapshot:null,revertSnapshotFlyoutVisible:!1,datafeedEnd:null},this.sorting={sort:{field:"timestamp",direction:"asc"}}}getAnnotations(){const e=this.props.jobs[0],t=e.data_counts;this.setState({isLoading:!0}),t.processed_record_count>0?p.ml.annotations.getAnnotations$({jobIds:[e.job_id],earliestMs:null,latestMs:null,maxAnnotations:h.a}).toPromise().then((e=>{this.setState(((t,a)=>({annotations:e.annotations[a.jobs[0].job_id]||[],errorMessage:void 0,isLoading:!1,jobId:a.jobs[0].job_id})))})).catch((e=>{console.log("Error loading list of annotations for jobs list:",e),this.setState({annotations:[],errorMessage:"Error loading the list of annotations for this job",isLoading:!1,jobId:void 0})})):this.setState({annotations:[],isLoading:!1,jobId:void 0})}getJob(e){if(Array.isArray(this.props.jobs)&&this.props.jobs.length>0){const t=this.props.jobs[0];if(void 0===e||t.job_id===e)return t}return f.mlJobService.getJob(e)}componentDidMount(){void 0===this.props.annotations&&Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&(this.annotationsRefreshSubscription=O.b.subscribe((()=>{this.getAnnotations()})),Object(O.c)())}componentDidUpdate(){Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&this.previousJobId!==this.props.jobs[0].job_id&&void 0===this.props.annotations&&!1===this.state.isLoading&&this.state.jobId!==this.props.jobs[0].job_id&&(Object(O.c)(),this.previousJobId=this.props.jobs[0].job_id)}componentWillUnmount(){null!==this.annotationsRefreshSubscription&&this.annotationsRefreshSubscription.unsubscribe()}render(){var e,t,a,s;const{isSingleMetricViewerLinkVisible:o=!0,isNumberBadgeVisible:n=!1,annotationUpdatesService:i}=this.props,{queryText:c,searchError:d}=this.state;if(void 0===this.props.annotations){if(!0===this.state.isLoading)return Object(w.jsx)(u.EuiFlexGroup,{justifyContent:"spaceAround"},Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return Object(w.jsx)(u.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"})}const m=this.props.annotations||this.state.annotations;if(0===m.length)return Object(w.jsx)(u.EuiCallOut,{title:Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.annotationsNotCreatedTitle",defaultMessage:"No annotations created for this job"}),iconType:"iInCircle",role:"alert"},this.state.jobId&&Object(x.r)(this.getJob(this.state.jobId))&&Object(w.jsx)("p",null,Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription",defaultMessage:"To create an annotation, open the {linkToSingleMetricView}",values:{linkToSingleMetricView:Object(w.jsx)(u.EuiLink,{onClick:()=>this.openSingleMetricView()},Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription.singleMetricViewerLinkText",defaultMessage:"Single Metric Viewer"}))}})));const p=[{field:"annotation",name:b.i18n.translate("xpack.ml.annotationsTable.annotationColumnName",{defaultMessage:"Annotation"}),sortable:!0,width:"40%",scope:"row","data-test-subj":"mlAnnotationsColumnAnnotation"},{field:"timestamp",name:b.i18n.translate("xpack.ml.annotationsTable.fromColumnName",{defaultMessage:"From"}),dataType:"date",render:M.d,sortable:!0,"data-test-subj":"mlAnnotationsColumnFrom"},{field:"end_timestamp",name:b.i18n.translate("xpack.ml.annotationsTable.toColumnName",{defaultMessage:"To"}),dataType:"date",render:M.d,sortable:!0,"data-test-subj":"mlAnnotationsColumnTo"},{field:"modified_time",name:b.i18n.translate("xpack.ml.annotationsTable.lastModifiedDateColumnName",{defaultMessage:"Last modified date"}),dataType:"date",render:M.d,sortable:!0,"data-test-subj":"mlAnnotationsColumnModifiedDate"},{field:"modified_username",name:b.i18n.translate("xpack.ml.annotationsTable.lastModifiedByColumnName",{defaultMessage:"Last modified by"}),sortable:!0,"data-test-subj":"mlAnnotationsColumnModifiedBy"},{field:"event",name:b.i18n.translate("xpack.ml.annotationsTable.eventColumnName",{defaultMessage:"Event"}),sortable:!0,width:"10%","data-test-subj":"mlAnnotationsColumnEvent"}];Object(l.uniq)(m.map((e=>e.job_id))).length>1&&p.unshift({field:"job_id",name:b.i18n.translate("xpack.ml.annotationsTable.jobIdColumnName",{defaultMessage:"job ID"}),sortable:!0,"data-test-subj":"mlAnnotationsColumnJobId"}),n&&p.unshift({field:"key",name:b.i18n.translate("xpack.ml.annotationsTable.labelColumnName",{defaultMessage:"Label"}),sortable:e=>+e,width:"60px",render:e=>Object(w.jsx)(u.EuiBadge,{color:"default"},e),"data-test-subj":"mlAnnotationsColumnLabel"});const f=[];void 0!==this.props.jobs&&void 0!==(null===(e=this.props.jobs[0])||void 0===e?void 0:e.blocked)||(f.push({name:C,description:C,icon:"pencil",type:"icon",onClick:e=>{const t=e._id,a=m.find((e=>e._id===t));i.setValue(null!=a?a:e)},"data-test-subj":"mlAnnotationsActionEdit"}),this.state.jobId&&this.props.jobs[0].analysis_config.bucket_span&&f.push({name:_,description:_,icon:"visAreaStacked",type:"icon",onClick:e=>{this.setState({datafeedFlyoutVisible:!0,datafeedEnd:e.end_timestamp})},"data-test-subj":"mlAnnotationsActionViewDatafeed"}),o&&f.push({name:e=>Object(x.r)(this.getJob(e.job_id))?Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.openInSingleMetricViewerTooltip",defaultMessage:"Open in Single Metric Viewer"}):Object(w.jsx)(u.EuiToolTip,{content:Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerTooltip",defaultMessage:"Job configuration not supported in Single Metric Viewer"})},Object(w.jsx)(j.FormattedMessage,{id:"xpack.ml.annotationsTable.openInSingleMetricViewerTooltip",defaultMessage:"Open in Single Metric Viewer"})),description:e=>Object(x.r)(this.getJob(e.job_id))?b.i18n.translate("xpack.ml.annotationsTable.openInSingleMetricViewerAriaLabel",{defaultMessage:"Open in Single Metric Viewer"}):b.i18n.translate("xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerAriaLabel",{defaultMessage:"Job configuration not supported in Single Metric Viewer"}),enabled:e=>Object(x.r)(this.getJob(e.job_id)),icon:"visLine",type:"icon",onClick:e=>this.openSingleMetricView(e),"data-test-subj":"mlAnnotationsActionOpenInSingleMetricViewer"}));const g={[v.b]:0,[v.a]:0};m.forEach((e=>{var t;const a=null!==(t=e.event)&&void 0!==t?t:v.b;void 0===g[a]&&(g[a]=0),g[a]++}));const h=[{type:"field_value_selection",field:"event",name:"Event",multiSelect:"or",options:Object.entries(g).map((([e,t])=>({value:e,name:e,view:`${e} (${t})`}))),"data-test-subj":"mlAnnotationTableEventFilter"}];var O,y;this.props.detectors&&p.push({name:b.i18n.translate("xpack.ml.annotationsTable.detectorColumnName",{defaultMessage:"Detector"}),width:"10%",render:e=>"detector_index"in e?this.props.detectors[e.detector_index].detector_description:""}),Array.isArray(null===(t=this.props.chartDetails)||void 0===t||null===(a=t.entityData)||void 0===a?void 0:a.entities)?(null===(O=this.props.chartDetails)||void 0===O||null===(y=O.entityData)||void 0===y||y.entities.forEach((e=>{"partition_field"===e.fieldType&&p.push({field:"partition_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.partitionSMVColumnName",{defaultMessage:"Partition"}),sortable:!0}),"over_field"===e.fieldType&&p.push({field:"over_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.overColumnSMVName",{defaultMessage:"Over"}),sortable:!0}),"by_field"===e.fieldType&&p.push({field:"by_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.byColumnSMVName",{defaultMessage:"By"}),sortable:!0})})),h.push({type:"is",field:F,name:b.i18n.translate("xpack.ml.annotationsTable.seriesOnlyFilterName",{defaultMessage:"Filter to series"})})):(p.push({field:"partition_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.partitionAEColumnName",{defaultMessage:"Partition"}),sortable:!0}),p.push({field:"over_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.overAEColumnName",{defaultMessage:"Over"}),sortable:!0}),p.push({field:"by_field_value",name:b.i18n.translate("xpack.ml.annotationsTable.byAEColumnName",{defaultMessage:"By"}),sortable:!0}));const S={defaultQuery:c,box:{incremental:!0,schema:!0},filters:h};p.push({align:u.RIGHT_ALIGNMENT,width:"65px",name:b.i18n.translate("xpack.ml.annotationsTable.actionsColumnName",{defaultMessage:"Actions"}),actions:f,"data-test-subj":"mlAnnotationsColumnActions"},{field:F,name:F,dataType:"boolean",width:"0px",render:()=>""});const E=this.getAnnotationsWithExtraInfo(m);return Object(w.jsx)(r.Fragment,null,Object(w.jsx)(u.EuiInMemoryTable,{"data-test-subj":"mlAnnotationsTable",error:d,className:"eui-textBreakWord",compressed:!0,items:E,columns:p,pagination:{pageSizeOptions:[5,10,25]},sorting:this.sorting,search:S,rowProps:e=>({"data-test-subj":`mlAnnotationsTableRow row-${e._id}`,onMouseOver:()=>this.onMouseOverRow(e),onMouseLeave:()=>this.onMouseLeaveRow()})}),this.state.jobId&&this.state.datafeedFlyoutVisible&&this.state.datafeedEnd?Object(w.jsx)(T.a,{onClose:()=>{this.setState({datafeedFlyoutVisible:!1})},onModelSnapshotAnnotationClick:e=>{this.setState({modelSnapshot:e,revertSnapshotFlyoutVisible:!0,datafeedFlyoutVisible:!1})},end:this.state.datafeedEnd,jobId:this.state.jobId}):null,!0===this.state.revertSnapshotFlyoutVisible&&null!==this.state.modelSnapshot?Object(w.jsx)(k.a,{snapshot:this.state.modelSnapshot,snapshots:[this.state.modelSnapshot],job:this.getJob(this.state.jobId),closeFlyout:()=>{this.setState({revertSnapshotFlyoutVisible:!1})},refresh:null!==(s=this.props.refreshJobList)&&void 0!==s?s:()=>{}}):null)}}const I=Object(y.withKibana)((e=>{const t=Object(r.useContext)(E.a);return Object(w.jsx)(annotations_table_AnnotationsTableUI,o()({annotationUpdatesService:t},e))}))},409:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var s=a(2),o=a.n(s),n=a(25),i=a(5),l=a(15),r=a(415),c=a(221),d=a(325),u=a(122),b=a(6);const j=({messages:e,loading:t,error:a,refreshMessage:j,actionHandler:m})=>{const{showNodeInfo:p}=Object(u.d)(),f=Object(s.useMemo)((()=>{const e=[{name:j?Object(b.jsx)(n.EuiToolTip,{content:i.i18n.translate("xpack.ml.jobMessages.refreshLabel",{defaultMessage:"Refresh"})},Object(b.jsx)(n.EuiButtonIcon,{onClick:Object(c.a)((()=>{j()})),iconType:"refresh","aria-label":i.i18n.translate("xpack.ml.jobMessages.refreshAriaLabel",{defaultMessage:"Refresh"})})):"",render:e=>Object(b.jsx)(d.a,{message:e}),width:"6%"},{field:"timestamp",name:i.i18n.translate("xpack.ml.jobMessages.timeLabel",{defaultMessage:"Time"}),render:r.d,width:"120px",sortable:!0},{field:"message",name:i.i18n.translate("xpack.ml.jobMessages.messageLabel",{defaultMessage:"Message"}),width:"50%"}];return p&&e.splice(2,0,{field:"node_name",name:i.i18n.translate("xpack.ml.jobMessages.nodeLabel",{defaultMessage:"Node"}),width:"150px"}),"function"==typeof m&&e.push({name:i.i18n.translate("xpack.ml.jobMessages.actionsLabel",{defaultMessage:"Actions"}),width:"10%",actions:[{render:e=>Object(b.jsx)(n.EuiToolTip,{content:Object(b.jsx)(l.FormattedMessage,{id:"xpack.ml.jobMessages.toggleInChartTooltipText",defaultMessage:"Toggle in chart"})},Object(b.jsx)(n.EuiButtonIcon,{size:"xs","aria-label":i.i18n.translate("xpack.ml.jobMessages.toggleInChartAriaLabel",{defaultMessage:"Toggle in chart"}),iconType:"visAreaStacked",onClick:()=>m(e)}))}]}),e}),[p,j,m]);return Object(b.jsx)(o.a.Fragment,null,Object(b.jsx)(n.EuiSpacer,{size:"s"}),Object(b.jsx)(n.EuiInMemoryTable,{items:e,columns:f,sorting:{sort:{field:"timestamp",direction:"desc"}},compressed:!0,loading:t,error:a,pagination:!0,"data-test-subj":"mlAnalyticsDetailsJobMessagesTable"}))}},434:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={DELETE:"delete",RESET:"reset",REVERT:"revert"},o={"cluster:admin/xpack/ml/job/delete":s.DELETE,"cluster:admin/xpack/ml/job/reset":s.RESET,"cluster:admin/xpack/ml/job/model_snapshots/revert":s.REVERT};Object.keys(o)},439:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var s=a(2),o=a.n(s),n=a(25),i=a(5),l=a(15),r=a(322),c=a(11),d=a(409),u=a(71),b=a(10),j=a(70),m=a(221),p=a(6);const f=o.a.memo((({jobId:e,start:t,end:a,actionHandler:f,refreshJobList:g,showClearButton:h})=>{const x=Object(j.checkPermission)("canCreateJob"),[O,v]=Object(s.useState)([]),[y,S]=Object(s.useState)([]),[M,E]=Object(s.useState)(!1),[T,k]=Object(s.useState)(""),[w,C]=Object(s.useState)(!1),_=Object(u.useToastNotificationService)(),{jobs:{clearJobAuditMessages:F}}=Object(b.c)(),I=async()=>{E(!0);try{const s=await c.ml.jobs.jobAuditMessages({jobId:e,start:t,end:a});v(s.messages),S(s.notificationIndices),E(!1)}catch(e){E(!1),_.displayErrorToast(e,i.i18n.translate("xpack.ml.jobService.jobAuditMessagesErrorTitle",{defaultMessage:"Error loading job messages"})),k(Object(r.a)(e))}},A=Object(s.useCallback)(I,[e]),L=Object(s.useCallback)((async()=>{C(!0);try{await F(e,y),C(!1),"function"==typeof g&&g()}catch(e){C(!1),_.displayErrorToast(e,i.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesErrorTitle",{defaultMessage:"Error clearing job message warnings and errors"}))}}),[e,JSON.stringify(y)]);Object(s.useEffect)((()=>{I()}),[]);const D=0===y.length,J=Object(p.jsx)(n.EuiButton,{size:"s",isLoading:w,isDisabled:D,onClick:Object(m.a)((()=>{L()})),"data-test-subj":"mlJobMessagesClearButton"},Object(p.jsx)(l.FormattedMessage,{id:"xpack.ml.jobMessages.clearMessagesLabel",defaultMessage:"Clear notifications"}));return Object(p.jsx)(o.a.Fragment,null,x&&h?Object(p.jsx)(n.EuiSpacer,null):null,Object(p.jsx)(n.EuiFlexGroup,{direction:"column"},x&&h?Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)("div",null,!0===D?Object(p.jsx)(n.EuiToolTip,{content:i.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesDisabledTooltip",{defaultMessage:"Notification clearing not supported."})},J):Object(p.jsx)(n.EuiToolTip,{content:i.i18n.translate("xpack.ml.jobMessages.clearJobAuditMessagesTooltip",{defaultMessage:"Clears warning icon from jobs list for messages produced in the last 24 hours."})},J))):null,Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(d.a,{refreshMessage:A,messages:O,loading:M,error:T,actionHandler:f}))))}))}}]);