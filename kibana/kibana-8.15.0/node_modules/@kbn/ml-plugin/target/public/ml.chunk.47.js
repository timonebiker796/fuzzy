/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[47],{188:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u}));var i=a(2),s=a.n(i),l=a(25),n=a(15),o=a(28),r=a(122),c=a(6);const d=({jobCount:e})=>{const{showNodeInfo:t}=Object(r.d)();return!1===t||!1===Object(o.b)()||0===e?null:Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(l.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"{jobCount, plural, one {# job} other {# jobs}} will start after autoscaling has increased ML capacity. This may take several minutes.",values:{jobCount:e}}))),Object(c.jsx)(l.EuiSpacer,{size:"m"}))},u=()=>{const{showNodeInfo:e}=Object(r.d)();return!1===Object(o.b)()?null:e?Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(l.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.newJobAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There are currently no nodes that can run the job, therefore it will remain in OPENING state until autoscaling increases ML capacity. This may take several minutes."}))),Object(c.jsx)(l.EuiSpacer,{size:"m"})):Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(l.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.serverless.title",defaultMessage:"Machine learning is starting..."}),color:"primary",iconType:"iInCircle"}),Object(c.jsx)(l.EuiSpacer,{size:"m"}))};a(44)},190:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return r})),a(2);var i=a(104),s=a(90),l=a(92),n=a(6);const{expandLiteralStrings:o}=l.XJson,r={TEXT:"text",JSON:"json",XJSON:i.XJsonLang.ID},c=({value:e,height:t="500px",width:a="100%",mode:l=r.JSON,readOnly:c=!1,onChange:d=(()=>{}),"data-test-subj":u,schema:b})=>{if(l===r.XJSON)try{e=o(e)}catch(e){console.error(e)}return Object(n.jsx)(s.CodeEditor,{languageId:l,options:{readOnly:c},value:e,width:a,height:t,onChange:d,"data-test-subj":u,editorDidMount:e=>{var t;const a=null===(t=e.getModel())||void 0===t?void 0:t.uri.toString();var s;b&&i.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,enableSchemaRequest:!1,schemaValidation:"error",schemas:[...null!==(s=i.monaco.languages.json.jsonDefaults.diagnosticsOptions.schemas)&&void 0!==s?s:[],{uri:a,fileMatch:[a],schema:b}]})}})}},198:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return o}));var i=a(5),s=a(42),l=a(18);function n(e,t,a,n){const r=Object(l.d)();if(e.contains("job_id_empty"))t.jobId.valid=!1;else if(e.contains("job_id_invalid")){t.jobId.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.jobId.message=e}else if(e.contains("job_id_invalid_max_length"))t.jobId.valid=!1,t.jobId.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:s.b}});else if(e.contains("job_id_already_exists")){t.jobId.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});t.jobId.message=e}if(e.contains("job_group_id_invalid")){t.groupIds.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.groupIds.message=e}else if(e.contains("job_group_id_invalid_max_length"))t.groupIds.valid=!1,t.groupIds.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:s.b}});else if(e.contains("job_group_id_already_exists")){t.groupIds.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});t.groupIds.message=e}if(e.contains("model_memory_limit_units_invalid")){t.modelMemoryLimit.valid=!1;const e=`${s.a.slice(0,s.a.length-1).join(", ")} or ${[...s.a].pop()}`,a=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e}});t.modelMemoryLimit.message=a}if(e.contains("model_memory_limit_invalid")){t.modelMemoryLimit.valid=!1;const e=(r.max_model_memory_limit||"").toUpperCase(),a=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:e}});t.modelMemoryLimit.message=a}if(e.contains("detectors_duplicates")){t.duplicateDetectors.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});t.duplicateDetectors.message=e}if(e.contains("categorizer_detector_missing_per_partition_field")){t.categorizerMissingPerPartition.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});t.categorizerMissingPerPartition.message=e}if(e.contains("categorizer_varying_per_partition_fields")){t.categorizerVaryingPerPartitionField.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});t.categorizerVaryingPerPartitionField.message=e}if(e.contains("bucket_span_empty")){t.bucketSpan.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});t.bucketSpan.message=e}else e.contains("bucket_span_invalid")&&(t.bucketSpan.valid=!1,t.bucketSpan.message=o(a.analysis_config.bucket_span));if(e.contains("query_empty")){t.query.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});t.query.message=e}else if(e.contains("query_invalid")){t.query.valid=!1;const e=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});t.query.message=e}e.contains("query_delay_invalid")&&(t.queryDelay.valid=!1,t.queryDelay.message=o(n.query_delay)),e.contains("frequency_invalid")&&(t.frequency.valid=!1,t.frequency.message=o(n.frequency)),e.contains("missing_summary_count_field_name")&&(t.summaryCountField.valid=!1,t.summaryCountField.message=i.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function o(e){return i.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:e,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},210:function(e,t,a){e.exports=a(57)(8)},229:function(e,t,a){"use strict";a.d(t,"c",(function(){return m})),a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return g})),a.d(t,"e",(function(){return x})),a.d(t,"f",(function(){return O})),a.d(t,"k",(function(){return f})),a.d(t,"i",(function(){return h})),a.d(t,"d",(function(){return S})),a.d(t,"g",(function(){return v})),a.d(t,"h",(function(){return F})),a.d(t,"j",(function(){return y})),a.d(t,"m",(function(){return w})),a.d(t,"o",(function(){return C})),a.d(t,"n",(function(){return M})),a.d(t,"l",(function(){return k}));var i=a(83),s=a.n(i),l=a(2),n=a(5),o=a(131),r=a(69);let c=function(e){return e.HISTOGRAM="histogram",e.COUNTER="counter",e.GAUGE="gauge",e.SUMMARY="summary",e}({});var d=a(415),u=a(414),b=a(218),j=a(322);a(37);const m=10,p=1e4;let g=function(e){return e[e.UNUSED=0]="UNUSED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.ERROR=3]="ERROR",e}({});const x={border:"all",fontSize:"s",cellPadding:"s",stripes:!1,rowHover:"none",header:"shade"},O={showColumnSelector:!0,showDisplaySelector:!1,showSortSelector:!0,showFullScreenSelector:!1},f=e=>{const t=e.fields.map((e=>e.name));return t.filter((a=>{if(e.metaFields.includes(a))return!1;const i=a.split(".");return"keyword"!==i.pop()||!t.includes(i.join("."))}))},h=(e,t)=>Object.keys(e).map((a=>{let i;const s=e[a];switch(void 0!==s&&(u.a.has(s)||u.c.has(s))&&(i="numeric"),s){case"date":i="datetime";break;case"nested":case"geo_point":i="json";break;case"boolean":i="boolean";break;case"text":i=S}return a===`${t}.${b.j}`&&(i="numeric"),a.includes(`${t}.${b.k}`)&&(i="json"),a.includes(`${t}.${b.e}`)&&(i="featureImportance"),a===`${t}.${b.f}`&&(i="featureInfluence"),{id:a,schema:i,isSortable:!0}})),S="non-aggregatable",v=e=>{let t;switch(e){case o.a.GEO_POINT:case o.a.GEO_SHAPE:t="json";break;case o.a.BOOLEAN:t="boolean";break;case o.a.DATE:case o.a.DATE_NANOS:t="datetime";break;case o.a.BYTE:case o.a.DOUBLE:case o.a.FLOAT:case o.a.HALF_FLOAT:case o.a.INTEGER:case o.a.LONG:case o.a.SCALED_FLOAT:case o.a.SHORT:case"number":t="numeric";case o.a.KEYWORD:case o.a.VERSION:case o.a.TEXT:}return t},F=e=>{var t;let a;if(e){switch(e.type){case o.b.BOOLEAN:a="boolean";break;case o.b.DATE:a="datetime";break;case o.b.GEO_POINT:case o.b.GEO_SHAPE:a="json";break;case o.b.NUMBER:a="numeric";break;case o.b.NESTED:a="json"}return void 0===a&&!1===e.aggregatable||(e=>(null==e?void 0:e.timeSeriesMetric)===c.COUNTER)(e)||"numeric"===a&&null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>e===o.a.AGGREGATE_METRIC_DOUBLE))?S:a}},E=(e,t)=>t?"true"===e:e,y=(e,t,a=!1)=>{const i=e[`${t}.feature_importance`];return void 0===i?[]:i.map((e=>({feature_name:Array.isArray(e.feature_name)?e.feature_name[0]:e.feature_name,classes:Array.isArray(e.classes)?e.classes.map((e=>{const t=k(e);return{importance:t.importance,class_name:E(t.class_name,a)}})):e.classes,importance:Array.isArray(e.importance)?e.importance[0]:e.importance})))},w=(e,t)=>{const a=e[`${t}.top_classes`];return void 0===a?[]:a.map((e=>k(e)))},C=(e,t,a,i,n)=>Object(l.useMemo)((()=>({rowIndex:l,columnId:c,setCellProps:u})=>{const j=l-t.pageIndex*t.pageSize,m=a[j];if(void 0===m)return null;if(void 0===e)return null;const p=e.fields.getByName(c);let g;void 0!==p&&(g=e.getFormatterForField(p));const x=function(e){if(a.hasOwnProperty(j)){const t=a[j];return t.hasOwnProperty(e)?t[e]:e===`${i}.feature_importance`?y(m,null!=i?i:b.d):e===`${i}.top_classes`?w(m,null!=i?i:b.d):Object(r.a)(a[j],e,null)}return null}(c);return"function"==typeof n&&n(c,x,m,u),"object"==typeof x&&null!==x?JSON.stringify(x):null==x?null:void 0!==g?g.convert(x,"text"):"string"==typeof x||null===x?x:(null==p?void 0:p.type)===o.b.DATE?Object(d.c)(1e3*s()(x).unix()):"boolean"==typeof x?x?"true":"false":x}),[null==e?void 0:e.fields,t.pageIndex,t.pageSize,a]),M=(e,t)=>{t.addDanger(n.i18n.translate("xpack.ml.dataGrid.columnChart.ErrorMessageToast",{defaultMessage:"An error occurred fetching the histogram charts data: {error}",values:{error:Object(j.a)(e)}}))},k=(e,t)=>{const a={...e};for(const e of Object.keys(a))void 0===t?Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]):!1===t(e)&&Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]);return a}},237:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i="_all"},298:function(e,t,a){"use strict";a.d(t,"c",(function(){return d})),a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return b}));var i=a(2),s=a.n(i),l=a(25),n=a(10),o=a(13),r=a(0),c=a(6);const d=({initialAlert:e,jobIds:t,onCloseFlyout:a,onSave:l})=>{const{services:{triggersActionsUi:d}}=Object(n.d)(),u=Object(i.useMemo)((()=>{if(!d)return;const i={onClose:()=>{a()},onSave:async()=>{l&&l()}};var s;return e?d.getEditRuleFlyout({...i,initialRule:{...e,ruleTypeId:null!==(s=e.ruleTypeId)&&void 0!==s?s:e.alertTypeId}}):d.getAddRuleFlyout({...i,consumer:r.g,canChangeTrigger:!1,ruleTypeId:o.g.ANOMALY_DETECTION,metadata:{},initialValues:{params:{jobSelection:{jobIds:t}}}})}),[d,null==e?void 0:e.id,t]);return Object(c.jsx)(s.a.Fragment,null,u)},u=({setShowFunction:e,unsetShowFunction:t,onSave:a})=>{const[s,l]=Object(i.useState)(!1),[n,o]=Object(i.useState)(),r=Object(i.useCallback)((e=>{o(e),l(!0)}),[]);return Object(i.useEffect)((()=>(e(r),()=>{t()})),[]),s&&n?Object(c.jsx)(d,{jobIds:n,onCloseFlyout:()=>l(!1),onSave:()=>{l(!1),a()}}):null},b=({initialAlert:e,onSave:t})=>{const[a,n]=Object(i.useState)(!1);return Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:n.bind(null,!a)},e.name),a?Object(c.jsx)(d,{initialAlert:e,onCloseFlyout:n.bind(null,!1),onSave:()=>{n(!1),t()}}):null)}},299:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a(2),s=a.n(i),l=a(5),n=a(15),o=a(25),r=a(6);const c=Object(i.memo)((({children:e,validation:t})=>{const a=l.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.title",{defaultMessage:"Groups"});return Object(r.jsx)(o.EuiDescribedFormGroup,{title:Object(r.jsx)("h3",null,a),description:Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.description",defaultMessage:" Optional grouping for jobs. New groups can be created or picked from the list of existing groups."})},Object(r.jsx)(o.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(r.jsx)(s.a.Fragment,null,e)))}))},320:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return j}));var i=a(2),s=a(5),l=a(25),n=a(150),o=a(299),r=a(6);const c=Object(i.memo)((({existingGroups:e,selectedGroups:t,onChange:a,validation:i})=>{const c=e.map((e=>({label:e,color:Object(n.a)(e)}))),d=t.map((e=>({label:e,color:Object(n.a)(e)})));function u(e){a(e.map((e=>e.label)))}return Object(r.jsx)(o.a,{validation:i},Object(r.jsx)(l.EuiComboBox,{placeholder:s.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:c,selectedOptions:d,onChange:u,onCreateOption:function(e,t){const a=e.trim().toLowerCase();if(!a)return;const i={label:e,color:Object(n.a)(e)};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&c.push(i),u([...d,i])},isClearable:!0,isInvalid:!i.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))}));var d=a(39),u=a.n(d),b=a(10);const j=({setTimeRange:e,timeRange:t})=>{const{services:{uiSettings:a}}=Object(b.d)(),n=a.get("dateFormat"),[o,c]=Object(i.useState)(u()(t.start)),[d,j]=Object(i.useState)(u()(t.end));return Object(i.useEffect)((()=>{void 0!==o&&void 0!==d&&e({start:o.valueOf(),end:d.valueOf()})}),[o,d,e]),Object(i.useEffect)((()=>{c(u()(t.start)),j(u()(t.end))}),[JSON.stringify(t)]),Object(r.jsx)(i.Fragment,null,Object(r.jsx)("div",{style:{minWidth:"512px"},"data-test-subj":"mlJobWizardDateRange"},Object(r.jsx)(l.EuiDatePickerRange,{fullWidth:!0,startDateControl:Object(r.jsx)(l.EuiDatePicker,{popperProps:{"data-test-subj":"mlJobWizardDatePickerRangeStartDate"},selected:o,onChange:function(e){c(e||void 0)},startDate:o,endDate:d,"aria-label":s.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.startDateLabel",{defaultMessage:"Start date"}),showTimeSelect:!0,dateFormat:n,maxDate:d}),endDateControl:Object(r.jsx)(l.EuiDatePicker,{popperProps:{"data-test-subj":"mlJobWizardDatePickerRangeEndDate"},selected:d,onChange:function(e){j(e||void 0)},startDate:o,endDate:d,"aria-label":s.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.endDateLabel",{defaultMessage:"End date"}),showTimeSelect:!0,dateFormat:n,minDate:o})})))}},353:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a(2),s=a(86),l=a(318);const n=e=>Object(i.useMemo)((()=>new l.a({[s.UI_SETTINGS.HISTOGRAM_MAX_BARS]:e.get(s.UI_SETTINGS.HISTOGRAM_MAX_BARS),[s.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:e.get(s.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:e.get("dateFormat"),"dateFormat:scaled":e.get("dateFormat:scaled")})),[e])},410:function(e,t,a){"use strict";a.d(t,"a",(function(){return j})),a.d(t,"b",(function(){return d}));var i=a(2),s=a.n(i),l=a(25),n=a(15),o=a(42),r=a(6);const c=e=>{switch(e){case o.c.INFO:return"primary";case o.c.ERROR:return"danger";default:return e}},d=e=>{switch(e){case o.c.INFO:return"iInCircle";case o.c.ERROR:return"cross";case o.c.SUCCESS:return"check";case o.c.WARNING:return"warning";default:return e}},u=({url:e})=>Object(r.jsx)(l.EuiLink,{href:e,target:"_BLANK"},Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.validateJob.learnMoreLinkText",defaultMessage:"Learn more"})),b=({text:e,url:t})=>Object(r.jsx)(s.a.Fragment,null,e," ",t&&Object(r.jsx)(u,{url:t})),j=({heading:e,status:t,text:a,url:i})=>Object(r.jsx)(s.a.Fragment,null,Object(r.jsx)(l.EuiCallOut,{"data-test-subj":`mlValidationCallout ${t}`,color:c(t),size:"s",title:e||Object(r.jsx)(b,{text:a,url:i}),iconType:t?d(t):"questionInCircle"},e&&Object(r.jsx)(b,{text:a,url:i})),Object(r.jsx)(l.EuiSpacer,{size:"m"}))},502:function(e,t,a){"use strict";a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return u}));var i=a(39),s=a.n(i),l=a(47),n=a.n(l),o=a(5),r=a(37),c=a(586);async function d(e,t,a,i,l,n,d="/internal/file_upload/time_field_range"){try{const u=t.getRuntimeMappings(),b=await async function(e){const{http:t,path:a,signal:i,...s}=e;return await t.fetch({path:a,method:"POST",body:JSON.stringify(s),version:"1",...i?{signal:i}:{}})}({index:t.getIndexPattern(),timeFieldName:t.timeFieldName,query:n?Object(c.a)(l):l,...Object(r.a)(u)?{runtimeMappings:u}:{},http:i,path:d});if(b.start.epoch&&b.end.epoch)return e.setTime({from:s()(b.start.epoch).toISOString(),to:s()(b.end.epoch).toISOString()}),b;if("number"==typeof b.start&&"number"==typeof b.end)return e.setTime({from:s()(b.start).toISOString(),to:s()(b.end).toISOString()}),{success:!0,start:{epoch:b.start,string:s()(b.start).toISOString()},end:{epoch:b.end,string:s()(b.end).toISOString()}};a.addWarning({title:o.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.noResults",{defaultMessage:"No results match your search criteria"})})}catch(e){a.addError(e,{title:o.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range. Please set the desired start and end times."})})}}function u(e){const t=n.a.parse(e.getTime().from),a=n.a.parse(e.getTime().to),i=void 0!==t?t.valueOf():0;return{to:void 0!==a?a.valueOf():0,from:i}}},592:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(593);case"v8light":return a(595)}},593:function(e,t,a){var i=a(126),s=a(594);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);i(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},594:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlPickFields__splitCard{border:1px solid #343741;padding-top:4px}",""]),e.exports=t},595:function(e,t,a){var i=a(126),s=a(596);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);i(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},596:function(e,t,a){(t=a(127)(!1)).push([e.i,".mlPickFields__splitCard{border:1px solid #d3dae6;padding-top:4px}",""]),e.exports=t},857:function(e,t,a){"use strict";a.r(t),a.d(t,"Page",(function(){return Ps}));var i=a(2),s=a.n(i),l=a(25),n=a(5),o=a(15),r=a(517),c=a(502),d=a(519),u=a(353),b=a(7),j=a(8),m=a(322),p=a(125),g=a(11),x=a(4),O=a.n(x),f=a(835),h=a(123),S=a(18),v=a(151),F=a(198);let E=function(e){return e[e.ERROR=0]="ERROR",e[e.WARNING=1]="WARNING",e}({});const y=n.i18n.translate("xpack.ml.newJob.wizard.validateJob.asyncJobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."}),w=n.i18n.translate("xpack.ml.newJob.wizard.validateJob.asyncGroupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing group or job."});function C(e){return e.pipe(Object(b.map)((e=>e.jobId)),Object(b.distinctUntilChanged)(((e,t)=>e===t)),Object(b.switchMap)((e=>g.ml.jobs.jobsExist$([e],!0))),Object(b.map)((e=>{const t=Object.values(e),a=!1===(null==t?void 0:t[0].exists);return{jobIdExists:{valid:a,...a?{}:{message:y}}}})))}function M(e){return e.pipe(Object(b.map)((e=>e.groups)),Object(b.distinctUntilChanged)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),Object(b.switchMap)((e=>g.ml.jobs.jobsExist$(e,!0))),Object(b.map)((e=>{const t=!1===Object.values(e).some((e=>!0===e.exists&&!1===e.isGroup));return{groupIdsExist:{valid:t,...t?{}:{message:w}}}})))}class job_validator_JobValidator{constructor(e){var t;O()(this,"_jobCreator",void 0),O()(this,"_validationSummary",void 0),O()(this,"_lastJobConfig",void 0),O()(this,"_lastDatafeedConfig",void 0),O()(this,"_validateTimeout",null),O()(this,"_asyncValidators$",[]),O()(this,"_asyncValidatorsResult$",void 0),O()(this,"_basicValidations",{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0},bucketSpan:{valid:!0},duplicateDetectors:{valid:!0},query:{valid:!0},queryDelay:{valid:!0},frequency:{valid:!0},scrollSize:{valid:!0},categorizerMissingPerPartition:{valid:!0},categorizerVaryingPerPartitionField:{valid:!0},summaryCountField:{valid:!0}}),O()(this,"_advancedValidations",{categorizationFieldValid:{valid:!0}}),O()(this,"_validating",!1),O()(this,"_basicValidationResult$",new b.ReplaySubject(2)),O()(this,"_jobCreatorSubject$",new b.Subject),O()(this,"validationResult$",void 0),O()(this,"latestValidationResult",this._basicValidations),this._jobCreator=e,this._lastJobConfig=this._jobCreator.formattedJobJson,this._lastDatafeedConfig=this._jobCreator.formattedDatafeedJson,this._validationSummary={basic:!1,advanced:!1},this._asyncValidators$=[(t=this._jobCreatorSubject$,Object(b.combineLatest)([t.pipe(Object(b.pluck)("modelPlot")),t.pipe(Object(b.filter)((e=>null==e?void 0:e.modelPlot)),Object(b.map)((e=>({jobCreator:e,analysisConfigString:JSON.stringify(e.jobConfig.analysis_config,null,2)}))),Object(b.distinctUntilChanged)(((e,t)=>e.analysisConfigString===t.analysisConfigString)),Object(b.switchMap)((({jobCreator:e})=>g.ml.validateCardinality$({...e.jobConfig,datafeed_config:e.datafeedConfig}).pipe(Object(b.map)((e=>{for(const t of e)if(void 0!==t.modelPlotCardinality)return{highCardinality:{value:t.modelPlotCardinality,severity:E.WARNING}};return null}))))),Object(b.startWith)(null))]).pipe(Object(b.map)((([e,t])=>e?t:null)))),C(this._jobCreatorSubject$),M(this._jobCreatorSubject$)],this._asyncValidatorsResult$=Object(b.combineLatest)(this._asyncValidators$).pipe(Object(b.map)((e=>e.reduce(((e,t)=>({...e,...t||{}})),{}))),Object(b.startWith)({})),this.validationResult$=Object(b.combineLatest)([this._basicValidationResult$,this._asyncValidatorsResult$]).pipe(Object(b.map)((([e,t])=>({...e,...t}))),Object(b.tap)((e=>{this.latestValidationResult=e})))}validate(e,t=!1){this._validating=!0;const a=this._jobCreator.formattedJobJson,i=this._jobCreator.formattedDatafeedJson;this._runAdvancedValidation(),t||a!==this._lastJobConfig||i!==this._lastDatafeedConfig?(null!==this._validateTimeout&&clearTimeout(this._validateTimeout),this._lastJobConfig=a,this._lastDatafeedConfig=i,this._validateTimeout=setTimeout((()=>{this._runBasicValidation(),this._jobCreatorSubject$.next(this._jobCreator),this._validating=!1,this._validateTimeout=null,e()}),500)):this._validating=null!==this._validateTimeout,e()}_resetBasicValidations(){this._validationSummary.basic=!0,Object.values(this._basicValidations).forEach((e=>{e.valid=!0,delete e.message}))}_runBasicValidation(){this._resetBasicValidations();const e=this._jobCreator.jobConfig,t=this._jobCreator.datafeedConfig,a=Object(S.d)(),i=Object(h.e)(e,void 0,a);Object(F.b)(i,this._basicValidations,e,t);const s=Object(h.c)(t);Object(F.b)(s,this._basicValidations,e,t);const l=Object(h.d)(e,t);Object(F.b)(l,this._basicValidations,e,t),this._validationSummary.basic=this._isOverallBasicValid(),this._basicValidationResult$.next(this._basicValidations)}_runAdvancedValidation(){Object(v.b)(this._jobCreator)&&(this._advancedValidations.categorizationFieldValid.valid=this._jobCreator.overallValidStatus!==f.a.INVALID)}_isOverallBasicValid(){return!1===Object.values(this._basicValidations).some((e=>!1===e.valid))}get validationSummary(){return this._validationSummary}get bucketSpan(){return this._basicValidations.bucketSpan}get summaryCountField(){return this._basicValidations.summaryCountField}get duplicateDetectors(){return this._basicValidations.duplicateDetectors}get jobId(){return this._basicValidations.jobId}get groupIds(){return this._basicValidations.groupIds}get modelMemoryLimit(){return this._basicValidations.modelMemoryLimit}get query(){return this._basicValidations.query}get queryDelay(){return this._basicValidations.queryDelay}get frequency(){return this._basicValidations.frequency}get scrollSize(){return this._basicValidations.scrollSize}set advancedValid(e){this._validationSummary.advanced=e}get validating(){return this._validating}get categorizationField(){return this._advancedValidations.categorizationFieldValid.valid}set categorizationField(e){this._advancedValidations.categorizationFieldValid.valid=e}get categorizerMissingPerPartition(){return this._basicValidations.categorizerMissingPerPartition}get categorizerVaryingPerPartitionField(){return this._basicValidations.categorizerVaryingPerPartitionField}get isPickFieldsStepValid(){return this._jobCreator.detectors.length>0&&(this._jobCreator.type!==p.f.ADVANCED||this._jobCreator.type===p.f.ADVANCED&&this.modelMemoryLimit.valid)&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&this.categorizerMissingPerPartition.valid&&this.categorizerVaryingPerPartitionField.valid&&this.summaryCountField.valid&&!this.validating&&(this._jobCreator.type!==p.f.CATEGORIZATION||this._jobCreator.type===p.f.CATEGORIZATION&&this.categorizationField)}get isModelMemoryEstimationPayloadValid(){return this._jobCreator.detectors.length>0&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&(this._jobCreator.type!==p.f.CATEGORIZATION||this._jobCreator.type===p.f.CATEGORIZATION&&this.categorizationField)}}var k=a(10);let z=function(e){return e[e.TIME_RANGE=0]="TIME_RANGE",e[e.ADVANCED_CONFIGURE_DATAFEED=1]="ADVANCED_CONFIGURE_DATAFEED",e[e.PICK_FIELDS=2]="PICK_FIELDS",e[e.JOB_DETAILS=3]="JOB_DETAILS",e[e.VALIDATION=4]="VALIDATION",e[e.SUMMARY=5]="SUMMARY",e}({});const D=Object(i.createContext)({jobCreatorUpdated:0,jobCreatorUpdate:()=>{},jobCreator:{},chartLoader:{},mapLoader:{},resultsLoader:{},chartInterval:{},jobValidator:{},jobValidatorUpdated:0,fields:[],aggs:[],existingJobsAndGroups:{}});var I=a(144),_=a(246),J=a(39),T=a.n(J);const A="exclude-frozen";var R=a(281),N=a(6);const V=e=>{const{frozenDataPreference:t,setFrozenDataPreference:a,timefilter:s,dataView:r,query:d,disabled:u,callback:b,apiPath:j}=e,{http:m,notifications:{toasts:p},showFrozenDataTierChoice:g}=Object(R.b)(),x=Object(i.useCallback)((async()=>{try{const e=await Object(c.b)(s,r,p,m,d,!1!==g&&t===A,j);"function"==typeof b&&void 0!==e&&b(e)}catch(e){p.addError(e,{title:n.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range. Please set the desired start and end times."})})}}),[s,r,p,m,d,g,t,j,b]),[O,f]=Object(i.useState)(!1),h=Object(i.useCallback)((e=>{a(e),S()}),[a]),S=()=>{f(!1)},v=Object(i.useMemo)((()=>[{id:A,label:n.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.useFullDataExcludingFrozenMenuLabel",{defaultMessage:"Exclude frozen data tier"})},{id:"include-frozen",label:n.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.useFullDataIncludingFrozenMenuLabel",{defaultMessage:"Include frozen data tier"})}]),[]),F=Object(i.useMemo)((()=>Object(N.jsx)(l.EuiPanel,null,Object(N.jsx)(l.EuiRadioGroup,{options:v,idSelected:t,onChange:h,compressed:!0}))),[v,t,h]),E=Object(i.useMemo)((()=>!1===g?Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.datePicker.fullTimeRangeSelector.useFullData",defaultMessage:"Use full range of data."}):t===A?Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.datePicker.fullTimeRangeSelector.useFullDataExcludingFrozenButtonTooltip",defaultMessage:"Use full range of data excluding frozen data tier."}):Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.datePicker.fullTimeRangeSelector.useFullDataIncludingFrozenButtonTooltip",defaultMessage:"Use full range of data including frozen data tier, which might have slower search results."})),[t,g]);return Object(N.jsx)(l.EuiFlexGroup,{responsive:!1,gutterSize:"xs"},Object(N.jsx)(l.EuiToolTip,{content:E},Object(N.jsx)(l.EuiButton,{isDisabled:u,onClick:()=>x(),"data-test-subj":"mlDatePickerButtonUseFullData"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.datePicker.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full data"}))),!1===g?null:Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiPopover,{id:"mlFullTimeRangeSelectorOption",button:Object(N.jsx)(l.EuiButtonIcon,{"data-test-subj":"mlDatePickerButtonDataTierOptions",display:"base",size:"m",iconType:"boxesVertical","aria-label":n.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.moreOptionsButtonAriaLabel",{defaultMessage:"More options"}),onClick:()=>{f(!O)}}),isOpen:O,closePopover:S,panelPaddingSize:"none",anchorPosition:"downRight"},F)))};var P=a(189),L=a(0);const B=({previous:e,previousActive:t=!0,next:a,nextActive:s=!0,children:n})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,null),Object(N.jsx)(l.EuiFlexGroup,null,e&&Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(G,{previous:e,previousActive:t})),a&&Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(U,{next:a,nextActive:s})),Object(N.jsx)(l.EuiFlexItem,{grow:!1},n),Object(N.jsx)(l.EuiFlexItem,null))),G=({previous:e,previousActive:t=!0})=>Object(N.jsx)(l.EuiButtonEmpty,{disabled:!t,onClick:e,iconType:"arrowLeft",iconSide:"left","data-test-subj":"mlJobWizardNavButtonPrevious"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.previousStepButton",defaultMessage:"Previous"})),U=({next:e,nextActive:t=!0})=>Object(N.jsx)(l.EuiButton,{fill:!0,disabled:!t,onClick:e,iconSide:"right",iconType:"arrowRight","data-test-subj":"mlJobWizardNavButtonNext"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.nextStepButton",defaultMessage:"Next"}));var H=a(122),W=a(326),q=a(320),$=a(179);const Q=({setCurrentStep:e,isCurrentStep:t})=>{const a=Object(r.c)(),{services:s}=Object(k.d)(),o=Object(H.c)(),{jobCreator:c,jobCreatorUpdate:d,jobCreatorUpdated:u,chartLoader:b,chartInterval:j}=Object(i.useContext)(D),[m,g]=Object(i.useState)({start:c.start,end:c.end}),[x,O]=Object(i.useState)([]),[f,h]=Object(i.useState)(!1),[S,v]=Object(P.b)($.e,A);return Object(i.useEffect)((()=>{const{start:e,end:t}=m;c.setTimeRange(e,t),j.setBounds({min:T()(e),max:T()(t)});const{timefilter:a}=s.data.query.timefilter;a.setTime({from:T()(e).toISOString(),to:T()(t).toISOString()}),d(),async function(){h(!0);try{var e;const t=await b.loadEventRateChart(c.start,c.end,j.getInterval().asMilliseconds(),null!==(e=c.runtimeMappings)&&void 0!==e?e:void 0,c.datafeedConfig.indices_options);O(t)}catch(e){O([])}h(!1)}()}),[c,j,m.start,m.end,d,s.data.query.timefilter]),Object(i.useEffect)((()=>{g({start:c.start,end:c.end})}),[c,u]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(q.b,{setTimeRange:g,timeRange:m})),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(V,{frozenDataPreference:S,setFrozenDataPreference:v,dataView:o.selectedDataView,query:o.combinedQuery,disabled:!1,callback:function(e){if(null!==e.start&&null!==e.end)g({start:e.start.epoch,end:e.end.epoch});else{const{toasts:e}=s.notifications;e.addDanger(n.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.fullTimeRangeError",{defaultMessage:"An error occurred obtaining the time range for the index. Please set the desired start and end times."}))}},timefilter:a,apiPath:`${L.d}/fields_service/time_field_range`})),Object(N.jsx)(l.EuiFlexItem,null)),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(W.a,{eventRateChartData:x,height:"300px",width:"100%",showAxis:!0,loading:f}),Object(N.jsx)(B,{next:()=>e(c.type===p.f.ADVANCED?z.ADVANCED_CONFIGURE_DATAFEED:z.PICK_FIELDS),nextActive:!0})))};var Y=a(226),K=a(157);const X=({fields:e,changeHandler:t,selectedOptions:a,removeOptions:s})=>{const{jobValidator:n,jobValidatorUpdated:o}=Object(i.useContext)(D),[r,c]=Object(i.useState)(n.duplicateDetectors),u=s.map(Z),{handleFieldStatsButtonClick:b,populatedFields:j}=Object(K.a)(),m=Object(i.useMemo)((()=>e.map((e=>{const t={isGroupLabelOption:!0,key:e.name,label:Object(N.jsx)(Y.a,{hideTrigger:e.id===d.a,isEmpty:e.id!==d.a&&!(null!=j&&j.has(e.name)),field:e,label:e.name,onButtonClick:b}),options:[]};return void 0!==e.aggs&&(t.options=e.aggs.filter((e=>null!==e.dslName)).map((t=>({label:`${t.title}(${e.name})`,agg:t,field:e}))).filter((e=>!1===u.includes(e.label)))),t}))),[b,e,u,null==j?void 0:j.size]);return Object(i.useEffect)((()=>{c(n.duplicateDetectors)}),[o]),Object(N.jsx)(l.EuiFormRow,{error:r.message,isInvalid:!1===r.valid,"data-test-subj":"mlJobWizardAggSelection"},Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:m,selectedOptions:a,onChange:t,isClearable:!1,isInvalid:!1===r.valid}))};function Z(e){return`${e.agg.title}(${e.field.name})`}var ee=a(159),te=a(76),ae=a(438),ie=a(200);const se={...ie.c,area:{...ie.c.area,visible:!0},line:{...ie.c.line,strokeWidth:1,opacity:.4}},le=({modelData:e})=>{const{MODEL_COLOR:t}=Object(ie.d)(),a=void 0===e?[]:e;return Object(N.jsx)(te.AreaSeries,{id:"model",xScaleType:te.ScaleType.Time,yScaleType:te.ScaleType.Linear,xAccessor:"time",yAccessors:["modelUpper"],y0Accessors:["modelLower"],data:a,curve:te.CurveType.CURVE_MONOTONE_X,areaSeriesStyle:se,color:t})},ne={...ie.c},oe=({chartData:e})=>{const{LINE_COLOR:t}=Object(ie.d)();return Object(N.jsx)(te.LineSeries,{id:"line",xScaleType:te.ScaleType.Time,yScaleType:te.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,curve:te.CurveType.CURVE_MONOTONE_X,lineSeriesStyle:ne,color:t})},re={...ie.c,line:{...ie.c.line,visible:!1},point:{...ie.c.point,visible:!0}},ce=({chartData:e})=>{const{LINE_COLOR:t}=Object(ie.d)();return Object(N.jsx)(te.LineSeries,{id:"scatter",xScaleType:te.ScaleType.Time,yScaleType:te.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,curve:te.CurveType.CURVE_MONOTONE_X,lineSeriesStyle:re,color:t})};var de=a(436),ue=a(437),be=a(278);let je=function(e){return e[e.LINE=0]="LINE",e[e.SCATTER=1]="SCATTER",e}({});const me=({chartType:e,chartData:t=[],modelData:a,anomalyData:i,height:s,width:l,loading:o=!1})=>{const r=e===je.SCATTER?function(e){return e.reduce(((e,t)=>(e.push(...t.values.map((e=>({time:t.time,value:e.value})))),e)),[])}(t):t,c=Object(ue.a)(r);return Object(N.jsx)("div",{style:{width:l,height:s},"data-test-subj":`mlAnomalyChart ${je[e]}`},Object(N.jsx)(be.a,{height:s,hasData:r.length>0,loading:o},Object(N.jsx)(te.Chart,null,Object(N.jsx)(te.Tooltip,{type:te.TooltipType.None}),Object(N.jsx)(te.Settings,{baseTheme:te.LEGACY_LIGHT_THEME,xDomain:c,locale:n.i18n.getLocale()}),Object(N.jsx)(de.a,{chartData:r}),Object(N.jsx)(ae.a,{anomalyData:i}),Object(N.jsx)(le,{modelData:a}),e===je.LINE&&Object(N.jsx)(oe,{chartData:r}),e===je.SCATTER&&Object(N.jsx)(ce,{chartData:r}))))};var pe=a(71);const ge=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s,chartLoader:l,chartInterval:n}=Object(i.useContext)(D),o=t,r=Object(i.useMemo)((()=>Object(ee.e)([...I.b.fields,...o.runtimeFields])),[]),[c,d]=Object(i.useState)(null!==o.aggFieldPair?[{label:Z(o.aggFieldPair)}]:[]),[u,b]=Object(i.useState)(o.aggFieldPair),[j,m]=Object(i.useState)({}),[p,g]=Object(i.useState)(!1),[x,O]=Object(i.useState)(o.start),[f,h]=Object(i.useState)(o.end),[S,v]=Object(i.useState)(o.bucketSpanMs);async function F(){if(null!==u){g(!0);try{const e=Object(ie.b)(o,n),t=await l.loadLineCharts(o.start,o.end,[u],null,null,e.intervalMs,o.runtimeMappings,o.datafeedConfig.indices_options);void 0!==t[0]&&m(t)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),m({})}g(!1)}}return Object(i.useEffect)((()=>{null!==u&&(o.setDetector(u.agg,u.field),a(),F(),e(null!==u))}),[o,u]),Object(i.useEffect)((()=>{o.start===x&&o.end===f||(O(o.start),h(o.end),F()),o.bucketSpanMs!==S&&(v(o.bucketSpanMs),F())}),[o,s]),Object(N.jsx)(i.Fragment,null,Object(N.jsx)(X,{fields:r,changeHandler:function(e){if(d(e),e.length){const t=e[0];b(void 0!==t?{agg:t.agg,field:t.field}:null)}},selectedOptions:c,removeOptions:[]}),(void 0!==j[0]||!0===p)&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(me,{chartType:je.LINE,chartData:j[0],modelData:[],anomalyData:[],height:"300px",width:"100%",loading:p})))},xe=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:s}=Object(i.useContext)(D),l=e,[n,o]=Object(i.useState)({}),[r,c]=Object(i.useState)(!1),[d,u]=Object(i.useState)([]),[b,j]=Object(i.useState)([]);function m(e){const t=e.model[0];void 0!==t&&u(t);const a=e.anomalies[0];void 0!==a&&j(a)}return Object(i.useEffect)((()=>{const e=a.subscribeToResults(m);return async function(){if(null!==l.aggFieldPair){c(!0);try{const e=Object(ie.b)(l,s),a=await t.loadLineCharts(l.start,l.end,[l.aggFieldPair],null,null,e.intervalMs,l.runtimeMappings,l.datafeedConfig.indices_options);void 0!==a[0]&&o(a)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),o({})}c(!1)}}(),()=>{e.unsubscribe()}}),[a]),Object(N.jsx)(i.Fragment,null,(void 0!==n[0]||!0===r)&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(me,{chartType:je.LINE,chartData:n[0],modelData:d,anomalyData:b,height:"300px",width:"100%",loading:r})))};var Oe=a(133);const fe=({bucketSpan:e,setBucketSpan:t,isInvalid:a,disabled:i})=>Object(N.jsx)(l.EuiFieldText,{disabled:i,placeholder:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.placeholder",{defaultMessage:"Bucket span"}),value:e,onChange:e=>t(e.target.value),isInvalid:a,"data-test-subj":"mlJobWizardInputBucketSpan"}),he=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.title",{defaultMessage:"Bucket span"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.description",defaultMessage:"The interval for time series analysis, typically 15m–1h."})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))}));var Se=a(520);let ve=function(e){return e[e.NOT_RUNNING=0]="NOT_RUNNING",e[e.RUNNING=1]="RUNNING",e}({});const Fe=({setEstimating:e})=>{const{jobCreator:t,jobCreatorUpdated:a}=Object(i.useContext)(D),{status:s,estimateBucketSpan:r}=function(){var e;const{jobCreator:t,jobCreatorUpdate:a}=Object(i.useContext)(D),s=Object(H.c)(),[l,o]=Object(i.useState)(ve.NOT_RUNNING),r={aggTypes:t.aggregations.map((e=>e.dslName)),duration:{start:t.start,end:t.end},fields:t.fields.map((e=>e.id===d.a?null:e.id)),index:s.selectedDataView.title,query:s.combinedQuery,splitField:void 0,timeField:s.selectedDataView.timeFieldName,runtimeMappings:null!==(e=t.runtimeMappings)&&void 0!==e?e:void 0,indicesOptions:t.datafeedConfig.indices_options};if(Object(v.d)(t)&&null!==t.splitField)r.splitField=t.splitField.id;else if(Object(v.e)(t)&&null!==t.populationField)r.splitField=t.populationField.id;else if(Object(v.f)(t)){var c;r.fields=[null],t.populationField?r.splitField=t.populationField.id:r.splitField=null===(c=t.rareField)||void 0===c?void 0:c.id}else Object(v.a)(t)&&t.richDetectors.some((e=>null!==e.partitionField?(r.splitField=e.partitionField.id,!0):null!==e.overField?(r.splitField=e.overField.id,!0):null!==e.byField?(r.splitField=e.byField.id,!0):void 0));return{status:l,estimateBucketSpan:async function(){o(ve.RUNNING);const{name:e,error:i,message:s}=await g.ml.estimateBucketSpan(r);if(o(ve.NOT_RUNNING),!0===i){const e=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpanEstimator.errorTitle",{defaultMessage:"Bucket span could not be estimated"});Object(pe.getToastNotificationService)().displayWarningToast({title:e,text:s})}else t.bucketSpan=e,a()}}}(),[c,u]=Object(i.useState)(0===t.detectors.length),[b,j]=Object(i.useState)(m());function m(){return Object(v.a)(t)&&t.detectors.some((e=>{if(e.partition_field_name===Se.b||e.over_field_name===Se.b||e.by_field_name===Se.b)return!0}))}return Object(i.useEffect)((()=>{e(s===ve.RUNNING)}),[s]),Object(i.useEffect)((()=>{u(0===t.detectors.length),j(m())}),[a]),Object(N.jsx)(l.EuiButton,{disabled:s===ve.RUNNING||!0===c||!0===b,onClick:r},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpanEstimatorButton",defaultMessage:"Estimate bucket span"}))},Ee=({setIsValid:e,hideEstimateButton:t=!1})=>{const{jobCreator:a,jobCreatorUpdate:s,jobCreatorUpdated:n,jobValidator:o,jobValidatorUpdated:r}=Object(i.useContext)(D),[c,d]=Object(i.useState)(a.bucketSpan),[u,b]=Object(i.useState)(o.bucketSpan),[j,m]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{a.bucketSpan=c,s()}),[c]),Object(i.useEffect)((()=>{d(a.bucketSpan)}),[n]),Object(i.useEffect)((()=>{b(o.bucketSpan)}),[r]),Object(i.useEffect)((()=>{e(!1===j)}),[j]),Object(N.jsx)(he,{validation:u},Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(fe,{setBucketSpan:d,bucketSpan:c,isInvalid:!1===u.valid,disabled:j})),!1===t&&Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Fe,{setEstimating:m}))))};var ye=a(830);const we=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.sparseData.description",defaultMessage:"Ignore empty buckets from being considered anomalous. Available for count and sum analysis."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Ce=()=>{const{jobCreator:e,jobCreatorUpdated:t,jobCreatorUpdate:a}=Object(i.useContext)(D),[s,o]=Object(i.useState)(e.sparseData),[r,c]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{e.sparseData=s,a()}),[s]),Object(i.useEffect)((()=>{const t=[ye.a.COUNT,ye.a.SUM],a=e.aggregations.some((e=>null!==e.dslName&&t.includes(e.dslName)));c(a),!1===a&&!0===s&&o(!1)}),[t]),Object(N.jsx)(we,null,Object(N.jsx)(l.EuiSwitch,{name:"switch",disabled:!1===r,checked:s,onChange:function(){o(!s)},"data-test-subj":"mlJobWizardSwitchSparseData",label:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"})}))},Me=({setIsValid:e})=>{const{jobCreator:t}=Object(i.useContext)(D),a=Object(k.h)();return Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ce,null))),Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{onClick:()=>{Object(Oe.e)(t,a)},"data-test-subj":"mlJobWizardButtonConvertToMultiMetric"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.singleMetricView.convertToMultiMetricButton",defaultMessage:"Convert to multi-metric job"})))))},ke=({isActive:e,setCanProceed:t})=>{const[a,s]=Object(i.useState)(!1),[n,o]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&n)}),[a,n]),Object(N.jsx)(i.Fragment,null,!1===e?Object(N.jsx)(xe,null):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(ge,{setIsValid:s}),a&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(Me,{setIsValid:o}))))},ze=({fields:e,detectorChangeHandler:t,selectedOptions:a,maxWidth:i,removeOptions:s})=>Object(N.jsx)(l.EuiFlexGroup,{style:{maxWidth:void 0!==i?i:560}},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiFormRow,{label:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.multiMetricView.addMetric",{defaultMessage:"Add metric"})},Object(N.jsx)(X,{fields:e,changeHandler:t,selectedOptions:a,removeOptions:s}))));a(592);const De=Object(i.memo)((({fieldValues:e,splitField:t,children:a,numberOfDetectors:n,jobType:r,animate:c=!1})=>{const d=[];return Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlDataSplit"},(0===e.length||0===n)&&Object(N.jsx)(s.a.Fragment,null,a),e.length>0&&n>0&&null!==t&&Object(N.jsx)(i.Fragment,null,(r===p.f.MULTI_METRIC||r===p.f.GEO)&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)("div",{style:{fontSize:"small"},"data-test-subj":`mlDataSplitTitle ${t.name}`},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitCards.dataSplitBy",defaultMessage:"Data split by {field}",values:{field:t.name}})),Object(N.jsx)(l.EuiSpacer,{size:"m"})),function(){d.length=0;const t=[...e];t.shift();let a=5;const i=t.map(((e,t)=>a+=10-t)).reverse();return!0===c&&setTimeout((()=>{d.forEach((e=>e.panel.style.marginBottom=`${e.marginBottom}px`))}),100),t.map(((e,a)=>{const s=(a+1)*(10/t.length*1.6)-100,n=i[a],o={height:"100px",marginBottom:"-100px",marginLeft:`${n}px`,marginRight:`${n}px`,...c?{transition:"margin 0.5s"}:{}};return Object(N.jsx)("div",{key:e,ref:e=>function(e,t){null!==e&&(!1===c&&(e.style.marginBottom=`${t}px`),d.push({panel:e,marginBottom:t}))}(e,s),style:o},Object(N.jsx)(l.EuiPanel,{paddingSize:"m",className:"mlPickFields__splitCard","data-test-subj":"mlSplitCard back"},Object(N.jsx)("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},e)))}))}(),Object(N.jsx)(l.EuiPanel,{paddingSize:"m",className:"mlPickFields__splitCard","data-test-subj":"mlSplitCard front"},Object(N.jsx)("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},e[0]),Object(N.jsx)(l.EuiHorizontalRule,{margin:"s"}),Object(N.jsx)(s.a.Fragment,null,a)))))}));function Ie(){const[e,t]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{setTimeout((()=>{t(!0)}),1e3)}),[]),e}const _e=({index:e,agg:t,field:a,byField:i,deleteDetector:s,children:o})=>{const r=!1===o&&void 0!==i?i.field:null;return Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)("span",{style:{fontSize:"small"},"data-test-subj":"mlDetectorTitle"},function(e,t,a){const i=`${e.title}(${t.name})`;return null===a?i:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.detectorTitle.placeholder",{defaultMessage:"{title} split by {field}",values:{title:i,field:a.name}})}(t,a,r))),!1!==o&&Object(N.jsx)(l.EuiFlexItem,{style:{width:"100%",maxWidth:"400px"}},o),Object(N.jsx)(l.EuiFlexItem,{grow:!1},void 0!==s&&Object(N.jsx)(l.EuiButtonIcon,{color:"danger",onClick:()=>s(e),iconType:"cross",size:"s","aria-label":"Next"})))},Je=({aggFieldPairList:e,chartSettings:t,splitField:a,fieldValues:s,lineChartsData:n,modelData:o,anomalyData:r,deleteDetector:c,jobType:d,loading:u=!1})=>{const b=Ie();return Object(N.jsx)(De,{fieldValues:s,splitField:a,numberOfDetectors:e.length,jobType:d,animate:b},Object(N.jsx)(l.EuiFlexGrid,{columns:t.cols},e.map(((a,s)=>Object(N.jsx)(l.EuiFlexItem,{key:s,"data-test-subj":`mlDetector ${s}`},Object(N.jsx)(i.Fragment,null,Object(N.jsx)(_e,{index:s,agg:e[s].agg,field:e[s].field,deleteDetector:c}),Object(N.jsx)(me,{chartType:je.LINE,chartData:n[s],modelData:o[s],anomalyData:r[s],height:t.height,width:t.width,loading:u})))))))},Te=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s,chartLoader:l,chartInterval:n}=Object(i.useContext)(D),o=t,r=Object(i.useMemo)((()=>Object(ee.e)([...I.b.fields,...o.runtimeFields])),[]),[c,d]=Object(i.useState)([]),[u,b]=Object(i.useState)(o.aggFieldPairs),[j,m]=Object(i.useState)({}),[p,g]=Object(i.useState)(!1),[x,O]=Object(i.useState)(o.start),[f,h]=Object(i.useState)(o.end),[S,v]=Object(i.useState)(o.bucketSpanMs),[F,E]=Object(i.useState)(ie.a),[y,w]=Object(i.useState)(o.splitField),[C,M]=Object(i.useState)([]),[k,z]=Object(i.useState)(!1);async function _(){if(k&&u.length>0&&(null===y||null!==y&&C.length>0)){g(!0);try{const e=Object(ie.b)(o,n);E(e);const t=await l.loadLineCharts(o.start,o.end,u,o.splitField,C.length>0?C[0]:null,e.intervalMs,o.runtimeMappings,o.datafeedConfig.indices_options);m(t)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),m([])}g(!1)}}return Object(i.useEffect)((()=>{z(!0)}),[]),Object(i.useEffect)((()=>{o.removeAllDetectors(),u.forEach((e=>{o.addDetector(e.agg,e.field)})),a(),_(),e(u.length>0)}),[u.length]),Object(i.useEffect)((()=>{o.start===x&&o.end===f||(O(o.start),h(o.end),_()),o.bucketSpanMs!==S&&(v(o.bucketSpanMs),_()),w(o.splitField)}),[s]),Object(i.useEffect)((()=>{null!==y?l.loadFieldExampleValues(y,o.runtimeMappings,o.datafeedConfig.indices_options).then(M).catch((e=>{Object(pe.getToastNotificationService)().displayErrorToast(e)})):M([])}),[y]),Object(i.useEffect)((()=>{_()}),[C]),Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Je,{aggFieldPairList:u,chartSettings:F,splitField:y,fieldValues:C,lineChartsData:j,modelData:[],anomalyData:[],deleteDetector:function(e){u.splice(e,1),b([...u])},jobType:o.type,loading:p}),Object(N.jsx)(ze,{fields:r,detectorChangeHandler:function(e){!function(e){if(null!==e&&e.length){const t=e[0];if(void 0!==t){const e={agg:t.agg,field:t.field};b([...u,e]),d([])}else b([])}}(e)},selectedOptions:c,removeOptions:u}))},Ae=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:s}=Object(i.useContext)(D),l=e,[n,o]=Object(i.useState)({}),[r,c]=Object(i.useState)(!1),[d,u]=Object(i.useState)([]),[b,j]=Object(i.useState)([]),[m,p]=Object(i.useState)(ie.a),[g,x]=Object(i.useState)([]);function O(e){u(e.model),j(e.anomalies)}function f(){return l.aggFieldPairs.length>0&&(null===l.splitField||null!==l.splitField&&g.length>0)}return Object(i.useEffect)((()=>{const e=a.subscribeToResults(O);return(async()=>{if(null!==l.splitField)try{const e=await t.loadFieldExampleValues(l.splitField,l.runtimeMappings,l.datafeedConfig.indices_options);x(e)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e)}})(),()=>{e.unsubscribe()}}),[t,a,l]),Object(i.useEffect)((()=>{f()&&async function(){if(f()){c(!0);try{const e=Object(ie.b)(l,s);p(e);const a=await t.loadLineCharts(l.start,l.end,l.aggFieldPairs,l.splitField,g.length>0?g[0]:null,e.intervalMs,l.runtimeMappings,l.datafeedConfig.indices_options);o(a)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),o({})}c(!1)}}()}),[g]),Object(N.jsx)(i.Fragment,null,Object.keys(n).length&&Object(N.jsx)(Je,{aggFieldPairList:l.aggFieldPairs,chartSettings:m,splitField:l.splitField,fieldValues:g,lineChartsData:n,modelData:d,anomalyData:b,deleteDetector:void 0,jobType:l.type,loading:r}))},Re=({fields:e,changeHandler:t,selectedField:a,isClearable:i,testSubject:s,placeholder:n})=>{const{renderOption:o,optionCss:r}=Object(K.a)(),c=e.map((e=>({label:e.name,field:e,css:r}))),d=[];return null!==a&&d.push({label:a.name,field:a}),Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:c,selectedOptions:d,onChange:function(e){const a=e[0];t(void 0!==a?a.field:null)},isClearable:i,placeholder:n,"data-test-subj":s,renderOption:o})},Ne=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.splitField.title",{defaultMessage:"Split field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitField.description",defaultMessage:"A field to split analysis by. Each value of this field will be modeled independently."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Ve=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,l=Object(i.useMemo)((()=>Object(ee.c)(s.runtimeFields)),[]),n=function(e,t,a){const[s,l]=Object(i.useState)(e);return Object(i.useEffect)((()=>{if(Object(v.d)(t))l(e);else{const a=t.rareField,i=t.populationField;l(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}}),[a]),s}(Object(i.useMemo)((()=>[...I.b.categoryFields,...l].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),s,a),[o,r]=Object(i.useState)(s.splitField);return Object(i.useEffect)((()=>{s.setSplitField(o),null!==o&&!1===s.influencers.includes(o.name)&&s.addInfluencer(o.name),t()}),[o]),Object(i.useEffect)((()=>{r(s.splitField)}),[a]),Object(N.jsx)(Ne,null,Object(N.jsx)(Re,{fields:n,changeHandler:r,selectedField:o,isClearable:!0,testSubject:"mlSplitFieldSelect"}))},Pe=({fields:e,changeHandler:t,selectedInfluencers:a})=>{const{jobCreator:s}=Object(i.useContext)(D),{renderOption:n,optionCss:o}=Object(K.a)(),r=[...Object(Oe.g)(e,s.additionalFields),...Object(Oe.h)(s.categorizationFieldName)].map((e=>({...e,css:o}))),c=a.map((e=>({label:e})));return Object(N.jsx)(l.EuiComboBox,{options:r,selectedOptions:c,onChange:function(e){t(e.map((e=>e.label)))},isClearable:!1,"data-test-subj":"mlInfluencerSelect",renderOption:n})},Le=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.influencers.title",{defaultMessage:"Influencers"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.influencers.description",defaultMessage:"Categorical fields that influence the results. Who/what might you 'blame' for an anomaly? 1-3 influencers are recommended."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Be=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,{fields:l}=I.b,[n,o]=Object(i.useState)([...s.influencers]);return Object(i.useEffect)((()=>{s.removeAllInfluencers(),n.forEach((e=>s.addInfluencer(e))),t()}),[n.join()]),Object(i.useEffect)((()=>{o([...s.influencers])}),[a]),Object(N.jsx)(Le,null,Object(N.jsx)(Pe,{fields:l,changeHandler:o,selectedInfluencers:n}))},Ge=({setIsValid:e})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ve,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Be,null))),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ce,null)))),Ue=({isActive:e,setCanProceed:t})=>{const[a,s]=Object(i.useState)(!1),[n,o]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&n)}),[a,n]),Object(N.jsx)(i.Fragment,null,!1===e?Object(N.jsx)(Ae,null):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Te,{setIsValid:s}),a&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(Ge,{setIsValid:o}))))},He=({fields:e,detectorChangeHandler:t,selectedOptions:a,maxWidth:i,removeOptions:s})=>Object(N.jsx)(l.EuiFlexGroup,{style:{maxWidth:void 0!==i?i:560}},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiFormRow,{label:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationView.addMetric",{defaultMessage:"Add metric"})},Object(N.jsx)(X,{fields:e,changeHandler:t,selectedOptions:a,removeOptions:s})))),We=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.title",{defaultMessage:"Population field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationField.description",defaultMessage:"All values in the selected field will be modeled together as a population."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),qe=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,l=Object(i.useMemo)((()=>Object(ee.c)(s.runtimeFields)),[]),n=function(e,t,a){const[s,l]=Object(i.useState)(e);return Object(i.useEffect)((()=>{if(Object(v.e)(t))l(e);else{const a=t.rareField,i=t.splitField;l(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}}),[a]),s}(Object(i.useMemo)((()=>[...I.b.categoryFields,...l].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),s,a),[o,r]=Object(i.useState)(s.populationField);return Object(i.useEffect)((()=>{s.setPopulationField(o),null!==o&&!1===s.influencers.includes(o.name)&&s.addInfluencer(o.name),t()}),[o]),Object(i.useEffect)((()=>{r(s.populationField)}),[a]),Object(N.jsx)(We,null,Object(N.jsx)(Re,{fields:n,changeHandler:r,selectedField:o,isClearable:!1,testSubject:"mlPopulationSplitFieldSelect"}))},$e=({detectorIndex:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s}=Object(i.useContext)(D),l=t,o=Object(i.useMemo)((()=>Object(ee.c)(l.runtimeFields)),[]),r=Object(i.useMemo)((()=>[...I.b.categoryFields,...o].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),[c,d]=Object(i.useState)(l.getByField(e)),u=function(e,t,a){const[s,l]=Object(i.useState)(e);return Object(i.useEffect)((()=>{const a=t.populationField;l(null!==a?e.filter((({name:e})=>e!==a.name)):e)}),[a]),s}(r,l,s);return Object(i.useEffect)((()=>{l.setByField(c,e),null!==c&&!1===l.influencers.includes(c.name)&&l.addInfluencer(c.name),a()}),[c]),Object(i.useEffect)((()=>{const t=l.getByField(e);d(t)}),[s]),Object(N.jsx)(Re,{fields:u,changeHandler:d,selectedField:c,isClearable:!0,testSubject:"mlByFieldSelect",placeholder:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.placeholder",{defaultMessage:"Split data"})})},Qe=({aggFieldPairList:e,chartSettings:t,splitField:a,lineChartsData:s,modelData:n,anomalyData:o,deleteDetector:r,jobType:c,fieldValuesPerDetector:d,loading:u=!1})=>{const b=Ie();return Object(N.jsx)(l.EuiFlexGrid,{columns:t.cols},e.map(((j,m)=>Object(N.jsx)(l.EuiFlexItem,{key:m,"data-test-subj":`mlDetector ${m}`},Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(_e,{index:m,agg:e[m].agg,field:e[m].field,byField:e[m].by,deleteDetector:r},void 0!==r&&Object(N.jsx)($e,{detectorIndex:m})),c===p.f.POPULATION&&Object(N.jsx)(l.EuiSpacer,{size:"s"}))),Object(N.jsx)(De,{fieldValues:d[m]||[],splitField:a,numberOfDetectors:e.length,jobType:c,animate:b},Object(N.jsx)(me,{chartType:je.SCATTER,chartData:s[m],modelData:n[m],anomalyData:o[m],height:t.height,width:t.width,loading:u})))))))},Ye=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s,chartLoader:n,chartInterval:o}=Object(i.useContext)(D),r=t,c=Object(i.useMemo)((()=>Object(ee.e)([...I.b.fields,...r.runtimeFields])),[]),[d,u]=Object(i.useState)([]),[b,j]=Object(i.useState)(r.aggFieldPairs),[m,p]=Object(i.useState)({}),[g,x]=Object(i.useState)(!1),[O,f]=Object(i.useState)(r.start),[h,S]=Object(i.useState)(r.end),[v,F]=Object(i.useState)(r.bucketSpanMs),[E,y]=Object(i.useState)(ie.a),[w,C]=Object(i.useState)(r.populationField),[M,k]=Object(i.useState)({}),[z,_]=Object(i.useReducer)((e=>e+1),0),[J,T]=Object(i.useState)(!1),A=()=>_(0);async function R(){if(function(){let e=b.length>0;return b.forEach((t=>{void 0!==t.by&&null!==t.by.field&&(e=e&&null!==t.by.value)})),e}()){x(!0);try{const e=Object(ie.b)(r,o);y(e);const t=await n.loadPopulationCharts(r.start,r.end,b,r.populationField,e.intervalMs,r.runtimeMappings,r.datafeedConfig.indices_options);p(t)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),p([])}x(!1)}}return Object(i.useEffect)((()=>{T(!0)}),[]),Object(i.useEffect)((()=>{r.removeAllDetectors(),b.forEach(((e,t)=>{r.addDetector(e.agg,e.field),void 0!==e.by&&r.setByField(e.by.field,t)})),a(),R(),e(b.length>0)}),[b.length]),Object(i.useEffect)((()=>{R()}),[JSON.stringify(M),w,J]),Object(i.useEffect)((()=>{r.start===O&&r.end===h||(f(r.start),S(r.end),R()),r.bucketSpanMs!==v&&(F(r.bucketSpanMs),R()),C(r.populationField);let e=!1;const t=[...b];t.forEach(((t,a)=>{const i=r.getByField(a);void 0!==t.by&&t.by.field!==i&&(t.by.field=i,e=!0)})),e&&(j(t),A())}),[s]),Object(i.useEffect)((()=>{!async function(){const e=[];b.forEach(((t,a)=>{void 0!==t.by&&null!==t.by.field&&e.push((async(e,t)=>({index:e,fields:await n.loadFieldExampleValues(t,r.runtimeMappings,r.datafeedConfig.indices_options)}))(a,t.by.field))}));const t=(await Promise.all(e)).reduce(((e,t)=>(e[t.index]=t.fields,e)),{}),a=b.map(((e,a)=>({...e,...void 0===e.by||null===e.by.field?{}:{by:{...e.by,value:t[a][0]}}})));j([...a]),k(t)}()}),[w,z]),Object(N.jsx)(i.Fragment,null,Object(N.jsx)(qe,null),null!==w&&Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),null!==w&&Object(N.jsx)(Qe,{aggFieldPairList:b,chartSettings:E,splitField:w,lineChartsData:m,modelData:[],anomalyData:[],deleteDetector:function(e){b.splice(e,1),j([...b]),A()},jobType:r.type,fieldValuesPerDetector:M,loading:g}),null!==w&&Object(N.jsx)(He,{fields:c,detectorChangeHandler:function(e){!function(e){if(null!==e&&e.length){const t=e[0];if(void 0!==t){const e={agg:t.agg,field:t.field,by:{field:null,value:null}};j([...b,e]),u([])}else j([])}}(e)},selectedOptions:d,removeOptions:[]}))},Ke=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:s}=Object(i.useContext)(D),n=e,[r,c]=Object(i.useState)(n.aggFieldPairs),[d,u]=Object(i.useState)({}),[b,j]=Object(i.useState)(!1),[m,p]=Object(i.useState)([]),[g,x]=Object(i.useState)([]),[O,f]=Object(i.useState)(ie.a),[h,S]=Object(i.useState)({});function v(e){p(e.model),x(e.anomalies)}function F(){let e=r.length>0;return r.forEach((t=>{void 0!==t.by&&null!==t.by.field&&(e=e&&null!==t.by.value)})),e}return Object(i.useEffect)((()=>{const e=a.subscribeToResults(v);return()=>{e.unsubscribe()}}),[]),Object(i.useEffect)((()=>{F()&&async function(){if(F()){j(!0);try{const e=Object(ie.b)(n,s);f(e);const a=await t.loadPopulationCharts(n.start,n.end,r,n.populationField,e.intervalMs,n.runtimeMappings,n.datafeedConfig.indices_options);u(a)}catch(e){Object(pe.getToastNotificationService)().displayErrorToast(e),u({})}j(!1)}}()}),[JSON.stringify(h),n.populationField]),Object(i.useEffect)((()=>{!async function(){const e=[];r.forEach(((a,i)=>{void 0!==a.by&&null!==a.by.field&&e.push((async(e,a)=>({index:e,fields:await t.loadFieldExampleValues(a,n.runtimeMappings,n.datafeedConfig.indices_options)}))(i,a.by.field))}));const a=(await Promise.all(e)).reduce(((e,t)=>(e[t.index]=t.fields,e)),{}),i=r.map(((e,t)=>({...e,...void 0===e.by||null===e.by.field?{}:{by:{...e.by,value:a[t][0]}}})));c([...i]),S(a)}()}),[n.populationField]),Object(N.jsx)(i.Fragment,null,null!==n.populationField&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationView.splitFieldTitle",defaultMessage:"Population split by {field}",values:{field:n.populationField.name}}),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(Qe,{aggFieldPairList:n.aggFieldPairs,chartSettings:O,splitField:n.populationField,lineChartsData:d,modelData:m,anomalyData:g,jobType:n.type,fieldValuesPerDetector:h,loading:b})))},Xe=({setIsValid:e})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Be,null)))),Ze=({isActive:e,setCanProceed:t})=>{const[a,s]=Object(i.useState)(!1),[n,o]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&n)}),[a,n]),Object(N.jsx)(i.Fragment,null,!1===e?Object(N.jsx)(Ke,null):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Ye,{setIsValid:s}),a&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(Xe,{setIsValid:o}))))},et=({onCreateClick:e,closeModal:t,saveEnabled:a,children:i})=>Object(N.jsx)(l.EuiModal,{onClose:t,maxWidth:1200,"data-test-subj":"mlCreateDetectorModal"},Object(N.jsx)(l.EuiModalHeader,null,Object(N.jsx)(l.EuiModalHeaderTitle,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.title",defaultMessage:"Create detector"}))),Object(N.jsx)(l.EuiModalBody,null,i),Object(N.jsx)(l.EuiModalFooter,null,Object(N.jsx)(l.EuiButtonEmpty,{onClick:t,"data-test-subj":"mlCreateDetectorModalCancelButton"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.cancelButton",defaultMessage:"Cancel"})),Object(N.jsx)(l.EuiButton,{onClick:e,isDisabled:!1===a,fill:!0,"data-test-subj":"mlCreateDetectorModalSaveButton"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.saveButton",defaultMessage:"Save"}))));var tt=a(135),at=a(154),it={name:"1btojeg",styles:"max-height:40vh"},st={name:"3s4yqf",styles:"width:400px"};const lt=Object(i.memo)((()=>{const{services:{docLinks:e}}=Object(k.d)(),[t,a]=Object(i.useState)(!1),s=Object(N.jsx)(l.EuiButtonIcon,{onClick:()=>a((e=>!e)),iconType:"help"}),r=[{field:"function",name:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.function",{defaultMessage:"Function"}),width:"150px"},{field:"description",name:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.description",{defaultMessage:"Description"})}],c=[{function:"count, high_count, low_count",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.count",{defaultMessage:"Detect anomalies when the number of events in a bucket is anomalous."})},{function:"non_zero_count, high_non_zero_count, low_non_zero_count",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.nonZeroCount",{defaultMessage:"Detect anomalies when the number of events in a bucket is anomalous, but ignore cases where the bucket count is zero."})},{function:"distinct_count, high_distinct_count, low_distinct_count",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.distinctCount",{defaultMessage:"Detect anomalies where the number of distinct values in one field is unusual."})},{function:"lat_long",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.latLong",{defaultMessage:"Detect anomalies in the geographic location of the input data."})},{function:"info_content, high_info_content, low_info_content",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.infoContent",{defaultMessage:"Detect anomalies in the amount of information that is contained in strings in a bucket."})},{function:"min",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.min",{defaultMessage:"Detect anomalies in the arithmetic minimum of a value, which is calculated for each bucket."})},{function:"max",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.max",{defaultMessage:"Detect anomalies in the arithmetic maximum of a value, which is calculated for each bucket."})},{function:"median, high_median, low_median",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.median",{defaultMessage:"Detect anomalies in the statistical median of a value, which is calculated for each bucket."})},{function:"mean, high_mean, low_mean",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.mean",{defaultMessage:"Detect anomalies in the arithmetic mean of a value, which is calculated for each bucket."})},{function:"metric",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.metric",{defaultMessage:"Combine min, max, and mean functions. Use it as a shorthand for a combined analysis. This is the default function."})},{function:"varp, high_varp, low_varp",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.varp",{defaultMessage:"Detect anomalies in the variance of a value which is a measure of the variability and spread in the data."})},{function:"rare",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.rare",{defaultMessage:"Detect anomalies according to the number of distinct rare values."})},{function:"freq_rare",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.freqRare",{defaultMessage:"Detect anomalies according to the number of times (frequency) rare values occur."})},{function:"sum, high_sum, low_sum",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.sum",{defaultMessage:"Detect anomalies where the sum of a field in a bucket is anomalous."})},{function:"non_null_sum, high_non_null_sum, low_non_null_sum",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.nonNullSum",{defaultMessage:"These functions are useful if your data is sparse. Buckets without values are ignored and buckets with a zero value are analyzed."})},{function:"time_of_day, time_of_week",description:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.functionHelp.time",{defaultMessage:"Detect events that happen at unusual times, either of the day or of the week."})}];return Object(N.jsx)(l.EuiPopover,{anchorPosition:"rightUp",button:s,isOpen:t,display:"inlineBlock",panelPaddingSize:"none",closePopover:()=>a(!1),initialFocus:"#mlAdFunctionsHelpTableId"},Object(N.jsx)(l.EuiPopoverTitle,{paddingSize:"s"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.anomalyDetection.functions.popoverTitle",defaultMessage:"Function reference"})),Object(N.jsx)(l.EuiPanel,{className:"eui-yScroll",css:it,color:"transparent",paddingSize:"s"},Object(N.jsx)(l.EuiBasicTable,{id:"mlAdFunctionsHelpTableId",css:st,tableCaption:n.i18n.translate("xpack.ml.anomalyDetection.functions.tableTitle",{defaultMessage:"Description of functions"}),items:c,compressed:!0,columns:r,responsiveBreakpoint:!1})),Object(N.jsx)(l.EuiPanel,{color:"transparent",paddingSize:"s"},Object(N.jsx)(l.EuiText,{color:"subdued",size:"xs"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.anomalyDetection.functions.learnMoreText",defaultMessage:"Learn more about {link}",values:{link:Object(N.jsx)(l.EuiLink,{href:e.links.ml.anomalyDetectionFunctions,target:"_blank",external:!0},n.i18n.translate("xpack.ml.anomalyDetection.functions.learnMoreLink",{defaultMessage:"functions"}))}}))))})),nt=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.title",{defaultMessage:"Function"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"none"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)("h3",null,t)),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(lt,null))),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.description",defaultMessage:"Analysis functions to be performed. For example, sum, count."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ot=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.title",{defaultMessage:"Field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.description",defaultMessage:"Required for functions: sum, mean, median, max, min, info_content, distinct_count, lat_long."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),rt=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.title",{defaultMessage:"By field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.description",defaultMessage:"Required for individual analysis where anomalies are detected compared to an entity's own past behavior."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ct=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.title",{defaultMessage:"Over field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.description",defaultMessage:"Required for population analysis where anomalies are detected compared to the behavior of the population."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),dt=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.title",{defaultMessage:"Partition field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.description",defaultMessage:"Allows segmentation of modeling into logical groups."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ut=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.title",{defaultMessage:"Exclude frequent"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.description",defaultMessage:"If set, it will automatically identify and exclude frequently occurring entities which may otherwise have dominated results."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),bt=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.title",{defaultMessage:"Description"});return Object(N.jsx)(l.EuiDescribedFormGroup,{fullWidth:!0,title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.description",defaultMessage:"Override the default detector description with a meaningful description of what the detector is analyzing."})},Object(N.jsx)(l.EuiFormRow,{fullWidth:!0},Object(N.jsx)(s.a.Fragment,null,e)))})),jt={label:""},mt=[{label:"all"},{label:"none"},{label:"by"},{label:"over"}],pt=({payload:e,fields:t,aggs:a,detectorChangeHandler:s,closeModal:n})=>{const{jobCreator:o}=Object(i.useContext)(D),r=o,[c,u]=Object(i.useState)(e.detector),[b,j]=Object(i.useState)(gt(c.agg)),[m,p]=Object(i.useState)(xt(c.field)),[g,x]=Object(i.useState)(xt(c.byField)),[O,f]=Object(i.useState)(xt(c.overField)),[h,S]=Object(i.useState)(xt(c.partitionField)),[v,F]=Object(i.useState)(null===(q=c.excludeFrequent)?jt:{label:q}),[E,y]=Object(i.useState)(c.description||""),[w,C]=Object(i.useState)(!0),[M,k]=Object(i.useState)(!0),[z,I]=Object(i.useState)(!0),{descriptionPlaceholder:_,setDescriptionPlaceholder:J}=function(e){const[t,a]=Object(i.useState)(ht(e));return{descriptionPlaceholder:t,setDescriptionPlaceholder:function(e){a(ht(e))}}}(c),[T,A]=Object(i.useState)([]),R=r.additionalFields.length>0,{renderOption:V,optionCss:P}=Object(K.a)(),L=a.filter((e=>function(e,t){return void 0!==e.fields&&(t||e.fields.length)}(e,R))).map(gt).map((e=>({...e,css:P}))),{currentFieldOptions:B,setCurrentFieldOptions:G}=function(e,t,a){const[s,l]=Object(i.useState)(ft(e,t));return{currentFieldOptions:s.filter((({label:e})=>!1===a.includes(e))),setCurrentFieldOptions:e=>l(ft(e,t))}}(c.agg,Object(ee.c)(r.additionalFields,!1),T),U=[...[...Object(Oe.g)(t,r.additionalFields)].sort(vt).map((e=>({...e,css:P}))),...Object(Oe.h)(r.categorizationFieldName)].sort(vt).filter((({label:e})=>!1===T.includes(e))).map((e=>({...e,css:P}))),H=t.find((e=>e.id===d.a)),W=e=>t=>{e(t[0]||jt)};var q;function $(e){return a.find((t=>t.id===e))||null}function Q(e){return e===d.c.id?d.c:t.find((t=>t.id===e))||r.additionalFields.find((t=>t.id===e))||null}return Object(i.useEffect)((()=>{const e=$(b.label);let t=Q(m.label);const a=Q(g.label),i=Q(O.label),s=Q(h.label);null!==e?(G(e),Ot(e)&&void 0!==H?(C(!0),p(jt),I(!1),t=H):(C(null!==t),I(!0)),k(null!==a||null!==i)):(C(!1),I(!1)),A([...t?[t.name]:[],...a?[a.name]:[],...i?[i.name]:[],...s?[s.name]:[]]);const l={agg:e,field:t,byField:a,overField:i,partitionField:s,excludeFrequent:""!==v.label?v.label:null,description:""!==E?E:null,customRules:null,useNull:null};u(l),J(l)}),[b,m,g,O,h,v,E]),Object(i.useEffect)((()=>{const e=$(b.label);if(C(""!==b.label),null!==e){I(!1===Ot(e));const t=Q(g.label),a=Q(O.label);k(null!==t||null!==a)}}),[]),Object(i.useEffect)((()=>{!1===M&&F(jt)}),[M]),Object(N.jsx)(et,{onCreateClick:function(){s(c,e.index)},closeModal:n,saveEnabled:w&&(!1===z||!0===z&&""!==m.label)},Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedFunctionSelect"},Object(N.jsx)(nt,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:L,selectedOptions:St(b),onChange:W(j),isClearable:!0,renderOption:V}))),Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedFieldSelect"},Object(N.jsx)(ot,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:B,selectedOptions:St(m),onChange:W(p),isClearable:!0,isDisabled:!1===z,renderOption:V})))),Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(l.EuiFlexGrid,{columns:2},Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedByFieldSelect"},Object(N.jsx)(rt,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:U,selectedOptions:St(g),onChange:W(x),isClearable:!0,isDisabled:!1===w,renderOption:V}))),Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedOverFieldSelect"},Object(N.jsx)(ct,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:U,selectedOptions:St(O),onChange:W(f),isClearable:!0,isDisabled:!1===w,renderOption:V}))),Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedPartitionFieldSelect"},Object(N.jsx)(dt,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:U,selectedOptions:St(h),onChange:W(S),isClearable:!0,isDisabled:!1===w,renderOption:V}))),Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedExcludeFrequentSelect"},Object(N.jsx)(ut,null,Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:mt,selectedOptions:St(v),onChange:W(F),isClearable:!0,isDisabled:!1===w||!1===M,renderOption:V})))),Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(bt,null,Object(N.jsx)(l.EuiTextArea,{rows:2,fullWidth:!0,placeholder:_,value:E,onChange:e=>y(e.target.value),"data-test-subj":"mlAdvancedDetectorDescriptionInput"}))))))};function gt(e){return null===e?jt:{label:e.id}}function xt(e){return null===e?jt:{label:e.name}}function Ot(e){return e.fields&&1===e.fields.length&&e.fields[0].id===d.a}function ft(e,t){return Object(Oe.g)(null!==e&&void 0!==e.fields?e.fields:[],t)}function ht(e){if(null===e.agg||null===e.field)return"";const t=Object(at.a)(e.agg,e.field);return t.by_field_name=e.byField?e.byField.id:void 0,t.over_field_name=e.overField?e.overField.id:void 0,t.partition_field_name=e.partitionField?e.partitionField.id:void 0,t.exclude_frequent=e.excludeFrequent?e.excludeFrequent:void 0,Object(tt.b)(t)}function St(e){return void 0===e||""===e.label?[]:[e]}function vt(e,t){return e.label.localeCompare(t.label)}const Ft=({payload:e,fields:t,aggs:a,detectorChangeHandler:s,closeModal:n,showModal:r})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{style:{maxWidth:560}},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(l.EuiButton,{onClick:r,"data-test-subj":"mlAddDetectorButton"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.addDetectorButton",defaultMessage:"Add detector"}))))),null!==e&&Object(N.jsx)(pt,{payload:e,fields:t,aggs:a,detectorChangeHandler:s,closeModal:n})),Et=({isActive:e,onEditJob:t,onDeleteJob:a})=>{const{jobCreator:r,jobCreatorUpdated:c,jobValidator:d,jobValidatorUpdated:u}=Object(i.useContext)(D),b=r,[j,m]=Object(i.useState)(b.detectors),[p,g]=Object(i.useState)(d.duplicateDetectors);Object(i.useEffect)((()=>{m(b.detectors)}),[c]),Object(i.useEffect)((()=>{d.duplicateDetectors.valid||g(d.duplicateDetectors),d.categorizerVaryingPerPartitionField.valid||g(d.categorizerVaryingPerPartitionField),d.categorizerMissingPerPartition.valid||g(d.categorizerMissingPerPartition)}),[u]);const x=({index:e})=>Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiButtonIcon,{color:"primary",onClick:()=>t(e),iconType:"pencil","aria-label":n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.editButton",{defaultMessage:"Edit"}),"data-test-subj":"mlAdvancedDetectorEditButton"})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiButtonIcon,{color:"danger",onClick:()=>a(e),iconType:"trash","aria-label":n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.deleteButton",{defaultMessage:"Delete"}),"data-test-subj":"mlAdvancedDetectorDeleteButton"})));return Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiTitle,{size:"xs"},Object(N.jsx)("h3",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.title",defaultMessage:"Detectors"}))),Object(N.jsx)(yt,{show:0===j.length}),Object(N.jsx)(l.EuiFlexGrid,{columns:3},j.map(((t,a)=>Object(N.jsx)(l.EuiFlexItem,{key:a,"data-test-subj":`mlAdvancedDetector ${a}`},Object(N.jsx)(l.EuiPanel,{paddingSize:"m"},Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,void 0!==t.detector_description?Object(N.jsx)("div",{style:{fontWeight:"bold"},"data-test-subj":"mlDetectorDescription"},t.detector_description):Object(N.jsx)(Ct,{detector:t})),e&&Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(x,{index:a}))),void 0!==t.detector_description&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"s"}),Object(N.jsx)(Ct,{detector:t}))))))),Object(N.jsx)(l.EuiSpacer,{size:"m"}),Object(N.jsx)(wt,{validation:p}),Object(N.jsx)(l.EuiSpacer,{size:"m"}))},yt=({show:e})=>!1===e?null:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.title",{defaultMessage:"No detectors"}),iconType:"warning","data-test-subj":"mlAdvancedNoDetectorsMessage"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.message",defaultMessage:"At least one detector is needed to create a job."}))),wt=({validation:e})=>!0===e.valid?null:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiFormRow,{error:e.message,isInvalid:!1===e.valid},Object(N.jsx)(s.a.Fragment,null))),Ct=({detector:e})=>Object(N.jsx)("div",{"data-test-subj":"mlDetectorIdentifier"},Object(tt.b)(e)),Mt={agg:null,field:null,byField:null,overField:null,partitionField:null,excludeFrequent:null,description:null,customRules:null,useNull:null},kt=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s}=Object(i.useContext)(D),l=t,{fields:n,aggs:o}=I.b,[r,c]=Object(i.useState)(null);return Object(i.useEffect)((()=>{e(l.detectors.length>0)}),[s]),Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Et,{isActive:!0,onEditJob:function(e){const t=l.richDetectors[e];void 0!==t&&c({detector:t,index:e})},onDeleteJob:function(e){l.removeDetector(e),a()}}),Object(N.jsx)(Ft,{payload:r,fields:n,aggs:o,detectorChangeHandler:function(e,t){void 0===t?l.addDetector(e.agg,e.field,e.byField,e.overField,e.partitionField,e.excludeFrequent,e.description,e.useNull):l.editDetector(e.agg,e.field,e.byField,e.overField,e.partitionField,e.excludeFrequent,e.description,t,e.useNull),a(),c(null)},showModal:function(){c({detector:Mt})},closeModal:function(){c(null)}}))},zt=()=>Object(N.jsx)(Et,{isActive:!1,onEditJob:()=>{},onDeleteJob:()=>{}}),Dt=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.title",{defaultMessage:"Model memory limit"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.description",defaultMessage:"An approximate upper limit for the amount of memory that can be used by the analytical models."})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))})),It=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:s,jobValidatorUpdated:n}=Object(i.useContext)(D),[o,r]=Object(i.useState)(s.modelMemoryLimit),[c,d]=Object(i.useState)(null===e.modelMemoryLimit?"":e.modelMemoryLimit),{anomaly_detectors:u}=Object(S.c)(),{model_memory_limit:b}=u;return Object(i.useEffect)((()=>{e.modelMemoryLimit=""===c?null:c,t()}),[c]),Object(i.useEffect)((()=>{d(null===e.modelMemoryLimit?"":e.modelMemoryLimit)}),[a]),Object(i.useEffect)((()=>{r(s.modelMemoryLimit)}),[n]),Object(N.jsx)(Dt,{validation:o},Object(N.jsx)(l.EuiFieldText,{value:c,placeholder:b,onChange:e=>d(e.target.value),isInvalid:!1===o.valid,"data-test-subj":"mlJobWizardInputModelMemoryLimit"}))},_t=({setIsValid:e})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Be,null))),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(It,null)),Object(N.jsx)(l.EuiFlexItem,null))),Jt=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:s}=Object(i.useContext)(D),{renderOption:n,optionCss:o}=Object(K.a)(),r=[...Object(Oe.f)(s.aggregationFields.length>0),...Object(Oe.g)(e,s.additionalFields)].map((e=>({...e,css:o}))),c=[];return null!==a&&c.push({label:a}),Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:r,selectedOptions:c,onChange:function(e){const a=e[0];t(void 0!==a?a.label:null)},isClearable:!0,"data-test-subj":"mlSummaryCountFieldNameSelect",renderOption:n})},Tt=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.title",{defaultMessage:"Summary count field"}),{services:{docLinks:i}}=Object(k.d)(),r=i.links.ml.aggregations;return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.description",defaultMessage:"If the input data is {aggregated}, specify the field that contains the document count.",values:{aggregated:Object(N.jsx)(l.EuiLink,{href:r,target:"_blank"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.aggregatedText",defaultMessage:"aggregated"}))}})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))})),At=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:s,jobValidatorUpdated:l}=Object(i.useContext)(D),n=e,{fields:o}=I.b,[r,c]=Object(i.useState)(n.summaryCountFieldName),[d,u]=Object(i.useState)(s.summaryCountField);return Object(i.useEffect)((()=>{u(s.summaryCountField)}),[l]),Object(i.useEffect)((()=>{n.summaryCountFieldName=r,t()}),[r]),Object(i.useEffect)((()=>{c(n.summaryCountFieldName)}),[a]),Object(N.jsx)(Tt,{validation:d},Object(N.jsx)(Jt,{fields:o,changeHandler:c,selectedField:r}))},Rt=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:s,jobCreatorUpdated:n}=Object(i.useContext)(D),{renderOption:o,optionCss:r}=Object(K.a)(),c=Object(i.useMemo)((()=>[...Object(Oe.g)(e,s.additionalFields)].map((e=>({...e,css:r})))),[e,n,r]),d=Object(i.useMemo)((()=>{const e=[];return null!==a&&e.push({label:a}),e}),[a]),u=Object(i.useCallback)((e=>{var a;return t(null!==(a=e[0]&&e[0].label)&&void 0!==a?a:null)}),[t]);return Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:c,selectedOptions:d,onChange:u,isClearable:!0,"data-test-subj":"mlCategorizationFieldNameSelect",renderOption:o})},Nt=Object(i.memo)((({children:e,isOptional:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.title",{defaultMessage:"Categorization field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(s.a.Fragment,null,t?Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldOptional.description",defaultMessage:"Optional, for use if analyzing unstructured log data. Using text data types is recommended."}):Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.description",defaultMessage:"Specifies which field will be categorized. Using text data types is recommended. Categorization works best on machine written log messages, typically logging written by a developer for the purpose of system troubleshooting."}))},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Vt=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,{catFields:l}=I.b,[n,o]=Object(i.useState)(s.categorizationFieldName),r=Object(v.b)(s);return Object(i.useEffect)((()=>{s.categorizationFieldName!==n&&(s.categorizationFieldName=n,t())}),[n]),Object(i.useEffect)((()=>{o(s.categorizationFieldName)}),[a]),Object(N.jsx)(Nt,{isOptional:!1===r},Object(N.jsx)(Rt,{fields:l,changeHandler:o,selectedField:n}))},Pt=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.perPartitionCategorization.enable.title",{defaultMessage:"Per-partition categorization"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorization.enable.description",defaultMessage:"Determine categories independently for each value of the partition field."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Lt=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,[n,r]=Object(i.useState)(s.perPartitionCategorization),c=Object(i.useCallback)((()=>r(!n)),[n]);return Object(i.useEffect)((()=>{r(s.perPartitionCategorization)}),[a]),Object(i.useEffect)((()=>{!1===n&&(s.perPartitionStopOnWarn=!1),s.perPartitionCategorization=n,t()}),[n]),Object(N.jsx)(l.EuiSwitch,{name:"categorizationPerPartitionSwitch",disabled:!1,checked:n,onChange:c,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartition",label:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorizationSwitchLabel",defaultMessage:"Enable per-partition categorization"})})},Bt=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,[n,r]=Object(i.useState)(s.perPartitionStopOnWarn),c=Object(i.useCallback)((()=>r(!n)),[n]);return Object(i.useEffect)((()=>{s.perPartitionStopOnWarn=n,t()}),[n]),Object(i.useEffect)((()=>{r(s.perPartitionStopOnWarn)}),[a]),Object(N.jsx)(l.EuiSwitch,{name:"categorizationPerPartitionStopOnWarnSwitch",disabled:!1,checked:n,onChange:c,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartitionStopOnWarn",label:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.perPartitionCategorizationtopOnWarnSwitchLabel",defaultMessage:"Stop on warn"})})},Gt=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:s,jobCreatorUpdated:n}=Object(i.useContext)(D),{renderOption:o,optionCss:r}=Object(K.a)(),c=Object(i.useMemo)((()=>[...Object(Oe.g)(e,s.additionalFields)].map((e=>({...e,css:r})))),[e,n]),d=Object(i.useMemo)((()=>{const e=[];return null!==a&&e.push({label:a}),e}),[a]),u=Object(i.useCallback)((e=>{var a;return t(null!==(a=e[0]&&e[0].label)&&void 0!==a?a:null)}),[t]);return Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:c,selectedOptions:d,onChange:u,isClearable:!0,"data-test-subj":"mlJobWizardCategorizationPerPartitionFieldNameSelect",renderOption:o})},Ut=({setEnablePerPartitionCategorization:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s}=Object(i.useContext)(D),n=t,[r,c]=Object(i.useState)(n.categorizationPerPartitionField),{categoryFields:d}=I.b,u=Object(i.useMemo)((()=>d.filter((e=>e.id!==n.categorizationFieldName))),[d,s]);return Object(i.useEffect)((()=>{n.categorizationPerPartitionField=r,a()}),[r]),Object(i.useEffect)((()=>{n.perPartitionCategorization&&null===n.categorizationPerPartitionField&&u.length>0&&(n.categorizationPerPartitionField=u[0].id),c(n.categorizationPerPartitionField),e(n.perPartitionCategorization)}),[s]),Object(N.jsx)(l.EuiFormRow,{label:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.categorizationPerPartitionFieldLabel",defaultMessage:"Partition field"})},Object(N.jsx)(Gt,{fields:u,changeHandler:c,selectedField:r||""}))},Ht=()=>{const{jobCreator:e,jobCreatorUpdated:t}=Object(i.useContext)(D),a=e,[n,r]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{r(a.perPartitionCategorization)}),[t]),Object(N.jsx)(Pt,null,Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(Lt,null)),n&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiFormRow,{label:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.stopOnWarnLabel",defaultMessage:"Stop on warn"})},Object(N.jsx)(Bt,null))),Object(v.b)(a)&&n&&Object(N.jsx)(Ut,{setEnablePerPartitionCategorization:r}))},Wt=()=>{const{jobCreator:e}=Object(i.useContext)(D),t=Object(v.a)(e)&&null!==e.categorizationFieldName;return Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Vt,null),t&&Object(N.jsx)(Ht,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(At,null))))},qt=({isActive:e,setCanProceed:t})=>{const[a,s]=Object(i.useState)(!1),[n,o]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&n)}),[a,n]),Object(N.jsx)(i.Fragment,null,!1===e?Object(N.jsx)(zt,null):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Wt,null),Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(kt,{setIsValid:s}),Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(_t,{setIsValid:o})))},$t=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorCountCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.title",{defaultMessage:"Count"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.description",defaultMessage:"Look for anomalies in the event rate of a category."}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.description2",defaultMessage:"Recommended for categorizing all messages."})),selectable:{onClick:e,isSelected:t}})),Qt=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorHighCountCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.highCountCard.title",{defaultMessage:"High count"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.highCountCard.description",defaultMessage:"Look for unusually high counts of a category in the event rate."}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.highCountCard.description2",defaultMessage:"Recommended for categorizing error messages."})),selectable:{onClick:e,isSelected:t}})),Yt=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.title",{defaultMessage:"Rare"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.description",defaultMessage:"Look for categories that occur rarely in time."})),selectable:{onClick:e,isSelected:t}}));var Kt={name:"7pb2ln",styles:"max-width:1100px"};const Xt=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),n=e,[r,c]=Object(i.useState)(n.selectedDetectorType);return Object(i.useEffect)((()=>{r!==n.selectedDetectorType&&(n.setDetectorType(r),t())}),[r]),Object(i.useEffect)((()=>{c(n.selectedDetectorType)}),[a]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiTitle,{size:"xs"},Object(N.jsx)("h3",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.title",defaultMessage:"Categorization detector"}))),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"l",css:Kt},Object(N.jsx)($t,{onClick:function(){c(ye.b.COUNT)},isSelected:r===ye.b.COUNT}),Object(N.jsx)(Qt,{onClick:function(){c(ye.b.HIGH_COUNT)},isSelected:r===ye.b.HIGH_COUNT}),Object(N.jsx)(Yt,{onClick:function(){c(ye.b.RARE)},isSelected:r===ye.b.RARE})))},Zt=({fieldExamples:e})=>{if(null===e||0===e.length)return null;const t=[{field:"example",name:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldExamples.title",{defaultMessage:"Examples"}),render:e=>Object(N.jsx)(l.EuiCodeBlock,{fontSize:"s",paddingSize:"none",transparentBackground:!0,style:{maxHeight:"200px"}},e)}],a=e.map(((e,t)=>{const a=[];let i=0,s="",l=0;for(;l<e.text.length;){const n=e.tokens[i];n&&l===n.start_offset?(a.push(s),s="",a.push(Object(N.jsx)(ea,{key:`${t}${l}`},n.token)),l+=n.end_offset-n.start_offset,i++):(s+=e.text[l],l++)}return a.push(s),{example:a}}));return Object(N.jsx)(l.EuiBasicTable,{columns:t,items:a,"data-test-subj":"mlJobWizardCategorizationExamplesTable"})},ea=({children:e})=>Object(N.jsx)("span",{style:{backgroundColor:"#b0ccf7"}},e);var ta=a(190),aa=a(180);const ia=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(i.useContext)(D),a=e,[s,r]=Object(i.useState)(!1),[c,d]=Object(i.useState)(!1),[u,b]=Object(i.useState)(JSON.stringify(a.categorizationAnalyzer,null,2));function j(e){b(e);const t=Object(aa.c)(e);d(t)}return Object(i.useEffect)((()=>{!0===s&&b(JSON.stringify(a.categorizationAnalyzer,null,2))}),[s]),Object(N.jsx)(i.Fragment,null,Object(N.jsx)(sa,{onClick:function(){d(!1),r(!s)}}),!0===s&&Object(N.jsx)(l.EuiFlyout,{onClose:()=>r(!1),hideCloseButton:!0,size:"m"},Object(N.jsx)(l.EuiFlyoutBody,null,Object(N.jsx)(la,{onChange:j,title:n.i18n.translate("xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.title",{defaultMessage:"Edit categorization analyzer JSON"}),value:u})),Object(N.jsx)(l.EuiFlyoutFooter,null,Object(N.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{iconType:"cross",onClick:()=>r(!1),flush:"left"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.closeButton",defaultMessage:"Close"}))),Object(N.jsx)(l.EuiFlexItem,{grow:!0}),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{onClick:function(){const{anomaly_detectors:e}=Object(S.c)();j(JSON.stringify(e.categorization_analyzer,null,2))}},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.useDefaultButton",defaultMessage:"Use default ML analyzer"}))),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:function(){a.categorizationAnalyzer=JSON.parse(u),t(),r(!1)},fill:!0,isDisabled:!1===c},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.saveButton",defaultMessage:"Save"})))))))},sa=({onClick:e})=>Object(N.jsx)(l.EuiButtonEmpty,{onClick:e,flush:"left","data-test-subj":"mlJobWizardButtonPreviewJobJson"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.editCategorizationAnalyzerFlyoutButton",defaultMessage:"Edit categorization analyzer"})),la=({title:e,value:t,onChange:a})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h5",null,e)),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(ta.a,{value:t,height:"800px",readOnly:!1,onChange:a})),na=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.allChecksButton",{defaultMessage:"View all checks performed"}),oa=({overallValidStatus:e,validationChecks:t,categorizationAnalyzer:a})=>{const i=Object(N.jsx)(ra,{categorizationAnalyzer:a});let s="success",o=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.valid",{defaultMessage:"Selected category field is valid"});return e===f.a.INVALID?(s="danger",o=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.invalid",{defaultMessage:"Selected category field is invalid"})):e===f.a.PARTIALLY_VALID&&(s="warning",o=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.possiblyInvalid",{defaultMessage:"Selected category field is possibly invalid"})),Object(N.jsx)(l.EuiCallOut,{color:s,title:o,"data-test-subj":`mlJobWizardCategorizationExamplesCallout ${e}`},t.map(((e,t)=>Object(N.jsx)("div",{key:t},e.message))),Object(N.jsx)(l.EuiSpacer,{size:"s"}),i,Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiAccordion,{id:"all-checks",buttonContent:na},Object(N.jsx)(ca,{validationChecks:t})))},ra=({categorizationAnalyzer:e})=>{let t=null;return void 0!==(null==e?void 0:e.tokenizer)&&"string"==typeof e.tokenizer?t=e.tokenizer:void 0!==(null==e?void 0:e.analyzer)&&(t=e.analyzer),Object(N.jsx)(s.a.Fragment,null,null!==t?Object(N.jsx)("div",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldAnalyzer",defaultMessage:"Analyzer used: {analyzer}",values:{analyzer:t}})):null,Object(N.jsx)("div",null,Object(N.jsx)(ia,null)))},ca=({validationChecks:e})=>{const t=Object.keys(f.b).map(((t,a)=>{const i=e.find((e=>e.id===a));return void 0!==i&&(null==i?void 0:i.valid)!==f.a.VALID?{iconType:"cross",label:i.message,size:"s"}:{iconType:"check",label:f.b[a],size:"s"}}));return Object(N.jsx)(l.EuiListGroup,{listItems:t,maxWidth:!1})},da=()=>Object(N.jsx)(l.EuiCallOut,{color:"warning",title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.invalidCssVersionCallout.title",{defaultMessage:"The data view appears to be cross-cluster"})},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.invalidCssVersionCallout.mesage",defaultMessage:"No example categories could be found, this could be due to one of the clusters being an unsupported version."})),ua=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:n}=Object(i.useContext)(D),o=t,[r,c]=Object(i.useState)(!1),[d,u]=Object(i.useState)(!1),[b,j]=Object(i.useState)(o.start),[m,p]=Object(i.useState)(o.end),[g,x]=Object(i.useState)(JSON.stringify(o.categorizationAnalyzer)),[O,h]=Object(i.useState)(null),[S,v]=Object(i.useState)(f.a.INVALID),[F,E]=Object(i.useState)([]),[y,w]=Object(i.useState)(o.categorizationFieldName);async function C(){if(null!==y){c(!0);try{const{examples:e,overallValidStatus:t,validationChecks:a,ccsVersionFailure:i}=await o.loadCategorizationFieldExamples();h(e),v(t),E(a),u(i),c(!1)}catch(e){c(!1),h(null),E([]),v(f.a.INVALID),Object(pe.getToastNotificationService)().displayErrorToast(e),u(!1)}}else h(null),E([]),v(f.a.INVALID),u(!1);e(null!==y)}return Object(i.useEffect)((()=>{o.categorizationFieldName!==y&&(o.categorizationFieldName=y,a()),C()}),[y]),Object(i.useEffect)((()=>{let e=!1;o.start===b&&o.end===m||(j(o.start),p(o.end),e=!0);const t=JSON.stringify(o.categorizationAnalyzer);t!==g&&(x(t),e=!0),e&&C(),o.categorizationFieldName!==y&&w(o.categorizationFieldName)}),[n]),Object(i.useEffect)((()=>{a()}),[S]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(Xt,null),Object(N.jsx)(l.EuiHorizontalRule,null),Object(N.jsx)(Vt,null),!0===r&&Object(N.jsx)(be.a,{hasData:!1,loading:!0},Object(N.jsx)("div",null)),!1===d&&null!==O&&!1===r&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(oa,{overallValidStatus:S,validationChecks:F,categorizationAnalyzer:o.categorizationAnalyzer}),Object(N.jsx)(Zt,{fieldExamples:O})),!0===d&&Object(N.jsx)(da,null),Object(N.jsx)(l.EuiHorizontalRule,null),Object(N.jsx)(Ht,null))},ba=()=>{const{displayErrorToast:e}=Object(pe.useToastNotificationService)(),{jobCreator:t,resultsLoader:a}=Object(i.useContext)(D),n=t,[r,c]=Object(i.useState)([]),[d,u]=Object(i.useState)(0);function b(t){!async function(){try{const e=await g.ml.jobs.topCategories(n.jobId,p.g);c(e.categories.map((e=>{var t;return{count:e.count,example:null!==(t=e.category.examples)&&void 0!==t&&t.length?e.category.examples[0]:""}}))),u(e.total)}catch(t){404!==Object(m.b)(t).statusCode&&e(t)}}()}Object(i.useEffect)((()=>{const e=a.subscribeToResults(b);return()=>{e.unsubscribe()}}),[]);const j=[...n.modelPlot?[{field:"count",name:"count",width:"100px",render:e=>Object(N.jsx)(l.EuiText,{size:"s"},Object(N.jsx)("code",null,e))}]:[],{field:"example",name:"Example",render:e=>Object(N.jsx)(l.EuiText,{size:"s"},Object(N.jsx)("code",null,e))}];return Object(N.jsx)(s.a.Fragment,null,d>0&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)("div",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationTotalCategories",defaultMessage:"Total categories: {totalCategories}",values:{totalCategories:d}})),Object(N.jsx)(l.EuiBasicTable,{columns:j,items:r})))},ja=()=>{const{jobCreator:e,resultsLoader:t}=Object(i.useContext)(D),a=e,[r,c]=Object(i.useState)([]),[d,u]=Object(i.useState)(),j=Object(i.useMemo)((()=>[{field:"partitionName",name:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsPreviewColumnName",{defaultMessage:"Stopped partition names"}),render:e=>Object(N.jsx)(l.EuiText,{size:"s"},Object(N.jsx)("code",null,e))}]),[]),p=Object(i.useCallback)((async()=>{try{const{jobs:e}=await g.ml.results.getCategoryStoppedPartitions([a.jobId]);if(!Array.isArray(e)&&Array.isArray(e[a.jobId])&&e[a.jobId].length>0)return e[a.jobId]}catch(e){const t=Object(m.b)(e);404!==t.statusCode&&u(t.message)}}),[a.jobId]);return Object(i.useEffect)((()=>{if(a.perPartitionCategorization&&a.perPartitionStopOnWarn){const e=t.results$.pipe(Object(b.switchMap)((()=>Object(b.from)(p()))),Object(b.tap)((e=>{Array.isArray(e)&&c(e.slice(0,5).map((e=>({partitionName:e}))))})),Object(b.takeWhile)((e=>!e||Array.isArray(e)&&e.length<=5))).subscribe();return()=>e.unsubscribe()}}),[]),Object(N.jsx)(s.a.Fragment,null,d&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiCallOut,{color:"danger",size:"s",title:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsErrorCallout",defaultMessage:"An error occurred while fetching list of stopped partitions."})})),Array.isArray(r)&&r.length>0&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)("div",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationStoppedPartitionsTitle",defaultMessage:"Stopped partitions"})),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiCallOut,{color:"warning",size:"s",title:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsExistCallout",defaultMessage:"Per-partition categorization and stop_on_warn settings are enabled. Some partitions in job ''{jobId}'' are unsuitable for categorization and have been excluded from further categorization or anomaly detection analysis.",values:{jobId:a.jobId}})}),Object(N.jsx)(l.EuiBasicTable,{columns:j,items:r})))},ma=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:l}=Object(i.useContext)(D),n=e,[o,r]=Object(i.useState)(!1),[c,d]=Object(i.useState)([]),[u,b]=Object(i.useState)([]),[j,m]=Object(i.useState)(!1);function p(e){const t=e.anomalies[0];void 0!==t&&d(t)}function g(e){m(e>0)}return Object(i.useEffect)((()=>{const e=a.subscribeToResults(p);return n.subscribeToProgress(g),async function(){r(!0);try{var e;const a=await t.loadEventRateChart(n.start,n.end,l.getInterval().asMilliseconds(),null!==(e=n.runtimeMappings)&&void 0!==e?e:void 0,n.datafeedConfig.indices_options);b(a)}catch(e){b([])}r(!1)}(),()=>{e.unsubscribe()}}),[]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(W.a,{eventRateChartData:u,anomalyData:c,height:"300px",width:"100%",showAxis:!0,loading:o,fadeChart:j}),Object(N.jsx)(ba,null),Object(N.jsx)(ja,null))},pa=({setIsValid:e})=>Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e,hideEstimateButton:!0})))),ga=({isActive:e,setCanProceed:t})=>{const[a,n]=Object(i.useState)(!1),[o,r]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&o)}),[a,o]),!1===e?Object(N.jsx)(ma,null):Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(ua,{setIsValid:n}),a&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(pa,{setIsValid:r})))},xa=({fields:e,changeHandler:t,selectedField:a,testSubject:i,placeholder:s})=>{const{renderOption:n,optionCss:o}=Object(K.a)(),r=e.map((e=>({label:e.name,field:e,css:o}))),c=[];return null!==a&&c.push({label:a.name,field:a}),Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:r,selectedOptions:c,onChange:function(e){const a=e[0];t(void 0!==a?a.field:null)},placeholder:s,"data-test-subj":i,isClearable:!1,renderOption:n})},Oa=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.splitRareField.title",{defaultMessage:"Rare field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareField.description",defaultMessage:"A field in which to detect rare values."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),fa=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,l=Object(i.useMemo)((()=>Object(ee.c)(s.runtimeFields)),[]),n=function(e,t,a){const[s,l]=Object(i.useState)(e);return Object(i.useEffect)((()=>{const a=t.populationField,i=t.splitField;l(null!==a||null!==i?e.filter((({name:e})=>e!==(null==a?void 0:a.name)&&e!==(null==i?void 0:i.name))):e)}),[a]),s}(Object(i.useMemo)((()=>[...I.b.categoryFields,...l].sort(((e,t)=>e.name.localeCompare(t.name)))),[]),s,a),[o,r]=Object(i.useState)(s.rareField);return Object(i.useEffect)((()=>{s.setRareField(o),null!==o&&!1===s.influencers.includes(o.name)&&s.addInfluencer(o.name),t()}),[o]),Object(i.useEffect)((()=>{r(s.rareField)}),[a]),Object(N.jsx)(Oa,null,Object(N.jsx)(xa,{fields:n,changeHandler:r,selectedField:o,testSubject:"mlRareFieldSelect"}))},ha=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rareCard.title",{defaultMessage:"Rare"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rareCard.description",defaultMessage:"Find rare values over time."})),selectable:{onClick:e,isSelected:t}})),Sa=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rarePopulationCard.title",{defaultMessage:"Rare in population"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.rarePopulationCard.description",defaultMessage:"Find members of a population that have rare values over time."})),selectable:{onClick:e,isSelected:t}})),va=({onClick:e,isSelected:t})=>Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiCard,{"data-test-subj":"mlJobWizardCategorizationDetectorRareCard"+(t?" selected":""),title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.freqRareCard.title",{defaultMessage:"Frequently rare in population"}),description:Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.freqRareCard.description",defaultMessage:"Find members of a population that frequently have rare values."})),selectable:{onClick:e,isSelected:t}})),Fa=({onChange:e})=>{const{jobCreator:t,jobCreatorUpdate:a}=Object(i.useContext)(D),n=t,[r,c]=Object(i.useState)(null);return Object(i.useEffect)((()=>{null!==n.rareField?null===n.populationField?c(Ma.RARE):c(n.frequentlyRare?Ma.FREQ_RARE_POPULATION:Ma.RARE_POPULATION):c(Ma.RARE)}),[]),Object(i.useEffect)((()=>{null!==r&&(e(r),r===Ma.RARE&&null!==n.populationField&&n.removePopulationField(),n.frequentlyRare=r===Ma.FREQ_RARE_POPULATION,a())}),[r]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiTitle,{size:"xs"},Object(N.jsx)("h3",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.rareDetectorSelect.title",defaultMessage:"Rare detector"}))),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"l",style:{maxWidth:"824px"}},Object(N.jsx)(ha,{onClick:function(){c(Ma.RARE)},isSelected:r===Ma.RARE}),Object(N.jsx)(Sa,{onClick:function(){c(Ma.RARE_POPULATION)},isSelected:r===Ma.RARE_POPULATION}),Object(N.jsx)(va,{onClick:function(){c(Ma.FREQ_RARE_POPULATION)},isSelected:r===Ma.FREQ_RARE_POPULATION})))},Ea=({detectorType:e})=>{const{jobCreator:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=t,[o,r]=Object(i.useState)(null);return Object(i.useEffect)((()=>{const t=function(e,t){var a,i;if(null===e.rareField)return null;const s=e.rareField.id,l=null===(a=e.populationField)||void 0===a?void 0:a.id,o=null===(i=e.splitField)||void 0===i?void 0:i.id,r=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSummary",{defaultMessage:"Detects rare {rareFieldName} values.",values:{rareFieldName:s}}),c=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSplitSummary",{defaultMessage:"For each {splitFieldName}, detects rare {rareFieldName} values.",values:{splitFieldName:o,rareFieldName:s}}),d=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.freqRarePopulationSummary",{defaultMessage:"Detects {populationFieldName} values that frequently have rare {rareFieldName} values relative to the population.",values:{populationFieldName:l,rareFieldName:s}}),u=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.freqRareSplitPopulationSummary",{defaultMessage:"For each {splitFieldName}, detects {populationFieldName} values that frequently have rare {rareFieldName} values relative to the population.",values:{splitFieldName:o,populationFieldName:l,rareFieldName:s}}),b=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rarePopulationSummary",{defaultMessage:"Detects {populationFieldName} values that have rare {rareFieldName} values relative to the population.",values:{populationFieldName:l,rareFieldName:s}}),j=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.rareSplitPopulationSummary",{defaultMessage:"For each {splitFieldName}, detects {populationFieldName} values that have rare {rareFieldName} values relative to the population.",values:{splitFieldName:o,populationFieldName:l,rareFieldName:s}});return t===Ma.RARE?void 0!==o?c:r:t===Ma.FREQ_RARE_POPULATION?void 0!==o?u:d:t===Ma.RARE_POPULATION?void 0!==o?j:b:null}(s,e);r(t)}),[a]),null===o?null:Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.rareField.plainText.calloutTitle",{defaultMessage:"Job summary"})},Object(N.jsx)("ul",null,Object(N.jsx)("li",null,o)))},ya=({setIsValid:e,rareDetectorType:t,setRareDetectorType:a})=>{const{jobCreator:n,jobCreatorUpdated:o}=Object(i.useContext)(D),r=n,[c,d]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{let a=!1;null!==r.rareField&&(t===Ma.RARE||null!==r.populationField)&&(a=!0),e(a),d(a)}),[o]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(Fa,{onChange:a}),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,null),Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(fa,null)),Object(N.jsx)(l.EuiFlexItem,null,t!==Ma.RARE&&Object(N.jsx)(qe,null))),c&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,{size:"m"}),Object(N.jsx)(Ea,{detectorType:t}))))},wa=()=>{const{jobCreator:e,chartLoader:t,resultsLoader:a,chartInterval:n,jobCreatorUpdated:o}=Object(i.useContext)(D),r=e,[c,d]=Object(i.useState)(!1),[u,b]=Object(i.useState)([]),[j,m]=Object(i.useState)([]),[p,g]=Object(i.useState)(!1),x=Object(i.useMemo)((()=>null!==r.rareField?null===r.populationField?Ma.RARE:r.frequentlyRare?Ma.FREQ_RARE_POPULATION:Ma.RARE_POPULATION:Ma.RARE),[o]);function O(e){const t=e.anomalies[0];void 0!==t&&b(t)}function f(e){g(e>0)}return Object(i.useEffect)((()=>{const e=a.subscribeToResults(O);return r.subscribeToProgress(f),async function(){d(!0);try{var e;const a=await t.loadEventRateChart(r.start,r.end,n.getInterval().asMilliseconds(),null!==(e=r.runtimeMappings)&&void 0!==e?e:void 0,r.datafeedConfig.indices_options);m(a)}catch(e){m([])}d(!1)}(),()=>{e.unsubscribe()}}),[]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(Ea,{detectorType:x}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(W.a,{eventRateChartData:j,anomalyData:u,height:"300px",width:"100%",showAxis:!0,loading:c,fadeChart:p}))},Ca=({setIsValid:e})=>Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ve,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Be,null))),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e})),Object(N.jsx)(l.EuiFlexItem,null)));let Ma=function(e){return e[e.RARE=0]="RARE",e[e.RARE_POPULATION=1]="RARE_POPULATION",e[e.FREQ_RARE_POPULATION=2]="FREQ_RARE_POPULATION",e}({});const ka=({isActive:e,setCanProceed:t})=>{const[a,n]=Object(i.useState)(!1),[o,r]=Object(i.useState)(!1),[c,d]=Object(i.useState)(Ma.RARE);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&o)}),[a,o]),!1===e?Object(N.jsx)(wa,null):Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(ya,{setIsValid:n,rareDetectorType:c,setRareDetectorType:d}),a&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(Ca,{setIsValid:r})))},za=({fields:e,changeHandler:t,selectedField:a})=>{const{renderOption:s,optionCss:n}=Object(K.a)(),o=Object(i.useMemo)((()=>e.map((e=>({label:e.name,field:e,css:n})))),[e,n]),r=Object(i.useMemo)((()=>{const e=[];return null!==a&&e.push({label:a.name,field:a}),e}),[a]),c=Object(i.useCallback)((e=>{const a=e[0];t(void 0!==a?a.field:null)}),[t]);return Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:o,selectedOptions:r,onChange:c,isClearable:!0,"data-test-subj":"mlGeoFieldNameSelect",renderOption:s})},Da=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.geoField.title",{defaultMessage:"Geo field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.pickFieldsStep.geoField.description",defaultMessage:"A geo field to detect anomalies in the geographic location of the input data."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Ia=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,{geoFields:l}=I.b,[n,o]=Object(i.useState)(s.geoField);return Object(i.useEffect)((()=>{s.setGeoField(n),t()}),[n]),Object(i.useEffect)((()=>{s.geoField&&o(s.geoField)}),[a]),Object(N.jsx)(Da,null,Object(N.jsx)(za,{fields:l,changeHandler:o,selectedField:n}))};var _a=a(78);const Ja=({geoField:e,splitField:t,fieldValues:a,geoAgg:i,layerList:n})=>{const{services:{maps:o}}=Object(k.d)(),r=Ie();return Object(N.jsx)(De,{fieldValues:a,splitField:t,numberOfDetectors:a.length,jobType:p.f.GEO,animate:r},Object(N.jsx)(l.EuiFlexGrid,{columns:1},Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlGeoMap",grow:!1},Object(N.jsx)(s.a.Fragment,null,i&&e?Object(N.jsx)(_e,{index:0,agg:i,field:e}):null,Object(N.jsx)(l.EuiSpacer,{size:"s"}),o&&Object(N.jsx)("span",{"data-test-subj":"mlGeoJobWizardMap",style:{width:"100%",height:400}},Object(N.jsx)(o.Map,{layerList:n,hideFilterActions:!0,mapSettings:{initialLocation:_a.INITIAL_LOCATION.AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:!0}}))))))},Ta=({setIsValid:e})=>{const{jobCreator:t,jobCreatorUpdated:a,chartLoader:o}=Object(i.useContext)(D),r=t,[c,d]=Object(i.useState)([]),[u,b]=Object(i.useState)([]),{services:{notifications:j}}=Object(k.d)(),{mapLoader:m}=Object(i.useContext)(D);return Object(i.useEffect)((()=>{let t=!1;null!==r.geoField&&(t=!0),e(t)}),[a]),Object(i.useEffect)((()=>{null!==r.splitField?o.loadFieldExampleValues(r.splitField,r.runtimeMappings,r.datafeedConfig.indices_options).then(d).catch((e=>{j.addDanger({title:n.i18n.translate("xpack.ml.newJob.geoWizard.fieldValuesFetchErrorTitle",{defaultMessage:"Error fetching field example values: {error}",values:{error:e}})})})):d([])}),[r.splitField]),Object(i.useEffect)((()=>{!async function(){if(r.geoField){var e;const{query:t}=null!==(e=r.savedSearchQuery)&&void 0!==e?e:{},a=await m.getMapLayersForGeoJob(r.geoField,r.splitField,c,t);b(a)}}()}),[r.geoField,r.splitField,c]),Object(N.jsx)(s.a.Fragment,null,null!==r.geoField&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(Ja,{geoField:r.geoField,splitField:r.splitField,fieldValues:c,geoAgg:r.geoAgg,layerList:u}),Object(N.jsx)(l.EuiSpacer,null)),Object(N.jsx)(Ia,null))},Aa=()=>{const[e,t]=Object(i.useState)([]),[a,s]=Object(i.useState)([]),{jobCreator:l,chartLoader:o,mapLoader:r}=Object(i.useContext)(D),c=l,d=c.geoField,u=c.splitField,{services:{notifications:b}}=Object(k.d)();return Object(i.useEffect)((()=>{null!==u?o.loadFieldExampleValues(u,c.runtimeMappings,c.datafeedConfig.indices_options).then(s).catch((e=>{b.toasts.addDanger({title:n.i18n.translate("xpack.ml.newJob.geoWizard.fieldValuesFetchErrorTitle",{defaultMessage:"Error fetching field example values: {error}",values:{error:e}})})})):s([])}),[]),Object(i.useEffect)((()=>{!async function(){if(d){var e;const{query:i}=null!==(e=c.savedSearchQuery)&&void 0!==e?e:{},s=await r.getMapLayersForGeoJob(d,u,a,i);t(s)}}()}),[a]),null===c.geoField?null:Object(N.jsx)(Ja,{geoField:c.geoField,splitField:c.splitField,fieldValues:a,geoAgg:c.geoAgg,layerList:e})},Ra=({setIsValid:e})=>Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ve,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Be,null))),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ee,{setIsValid:e,hideEstimateButton:!0})),Object(N.jsx)(l.EuiFlexItem,null))),Na=({isActive:e,setCanProceed:t})=>{const[a,s]=Object(i.useState)(!1),[n,o]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{"function"==typeof t&&t(a&&n)}),[a,n]),Object(N.jsx)(i.Fragment,null,!1===e?Object(N.jsx)(Aa,null):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Ta,{setIsValid:s}),a&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"l"}),Object(N.jsx)(Ra,{setIsValid:o}))))};var Va=a(92);const Pa=({combinedJob:e,heightOffset:t=0})=>{const{jobs:{datafeedPreview:a}}=Object(k.c)(),s=Object(i.useMemo)((()=>window.innerHeight-230-t+"px"),[t]),[r,c]=Object(i.useState)(!1),[d,u]=Object(i.useState)(""),[b,j]=Object(i.useState)(!1),[m,p]=Object(i.useState)("");Object(i.useEffect)((()=>{try{null!==e&&(""===m?g():j(JSON.stringify(e)!==m))}catch(e){}}),[e]);const g=Object(i.useCallback)((async()=>{if(u(""),null!==e)if(c(!0),p(JSON.stringify(e)),e.datafeed_config&&e.datafeed_config.indices.length){try{const{datafeed_config:t,...i}=e;if(0===i.analysis_config.detectors.length)u(n.i18n.translate("xpack.ml.newJob.wizard.datafeedPreviewFlyout.noDetectors",{defaultMessage:"No detectors configured"}));else{const e=await a(void 0,i,t);u(JSON.stringify(e,null,2))}}catch(e){u(JSON.stringify(e,null,2))}c(!1),j(!1)}else{const e=n.i18n.translate("xpack.ml.newJob.wizard.datafeedPreviewFlyout.datafeedDoesNotExistLabel",{defaultMessage:"Datafeed does not exist"});u(e)}}),[e]);return Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h5",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedPreviewFlyout.title",defaultMessage:"Datafeed preview"})))),Object(N.jsx)(l.EuiFlexItem,{grow:!1},b&&Object(N.jsx)(l.EuiButton,{size:"s",onClick:g,iconType:"refresh"},"Refresh"))),Object(N.jsx)(l.EuiSpacer,{size:"s"}),!0===r?Object(N.jsx)(l.EuiFlexGroup,{justifyContent:"spaceAround"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiSpacer,{size:"xxl"}),Object(N.jsx)(l.EuiLoadingSpinner,{size:"l"}))):Object(N.jsx)(ta.a,{value:d,height:s,readOnly:!0}))},{collapseLiteralStrings:La}=Va.XJson;let Ba=function(e){return e[e.HIDDEN=0]="HIDDEN",e[e.READONLY=1]="READONLY",e[e.EDITABLE=2]="EDITABLE",e}({});const Ga=({isDisabled:e,jobEditorMode:t,datafeedEditorMode:r})=>{const{jobCreator:c,jobCreatorUpdate:d,jobCreatorUpdated:u}=Object(i.useContext)(D),{displayErrorToast:b}=Object(pe.useToastNotificationService)(),[j,m]=Object(i.useState)(!1),[p,g]=Object(i.useState)(!1),[x,O]=Object(i.useState)(c.formattedJobJson),[f,h]=Object(i.useState)(c.formattedDatafeedJson),[S,F]=Object(i.useState)(!1),[E,y]=Object(i.useState)(null),[w,C]=Object(i.useState)(),[M,k]=Object(i.useState)();Object(i.useEffect)((()=>{O(c.formattedJobJson),h(c.formattedDatafeedJson)}),[u]),Object(i.useEffect)((()=>{!0===j?(O(c.formattedJobJson),h(c.formattedDatafeedJson),y({...JSON.parse(c.formattedJobJson),datafeed_config:JSON.parse(c.formattedDatafeedJson)}),g(!1)):y(null)}),[j]),Object(i.useEffect)((function(){a.e(107).then(a.t.bind(null,852,3)).then((e=>{C(e)})),a.e(108).then(a.t.bind(null,853,3)).then((e=>{k(e)}))}),[]);const z=t===Ba.EDITABLE||r===Ba.EDITABLE,I=t===Ba.READONLY&&r===Ba.READONLY;return Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Ua,{onClick:function(){F(!1),m(!j)},isDisabled:e,editJsonMode:z}),!0===j&&!1===e&&Object(N.jsx)(l.EuiFlyout,{onClose:()=>m(!1),hideCloseButton:!0,size:"l"},Object(N.jsx)(l.EuiFlyoutBody,null,Object(N.jsx)(l.EuiFlexGroup,null,t!==Ba.HIDDEN?Object(N.jsx)(Ha,{editJson:t===Ba.EDITABLE,onChange:function(e){O(e);const t=Object(aa.c)(e);y(t?{...JSON.parse(e),datafeed_config:JSON.parse(f)}:null),F(t)},title:n.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.job.title",{defaultMessage:"Job configuration JSON"}),value:x,heightOffset:p?100:0,schema:w}):null,r!==Ba.HIDDEN?Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(Ha,{editJson:r===Ba.EDITABLE,onChange:function(e){h(e);const t=La(e);let a=Object(aa.c)(t);if(a){const e=JSON.parse(t),i=c.indices.sort();a=i.length===e.indices.length&&i.every(((t,a)=>t===e.indices[a])),g(!1===a),y({...JSON.parse(x),datafeed_config:e})}else g(!1),y(null);F(a)},title:n.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.datafeed.title",{defaultMessage:"Datafeed configuration JSON"}),value:f,heightOffset:p?100:0,schema:M}),r===Ba.EDITABLE&&Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Pa,{combinedJob:E,heightOffset:p?100:0}))):null),p&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiCallOut,{color:"warning",size:"s",title:n.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutTitle",{defaultMessage:"Indices have changed"})},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutText",defaultMessage:"You cannot alter the indices being used by the datafeed here. To select a different data view or saved search, go to step 1 of the wizard and select the Change data view option."})))),Object(N.jsx)(l.EuiFlyoutFooter,null,Object(N.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{iconType:"cross",onClick:()=>m(!1),flush:"left"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.closeButton",defaultMessage:"Close"}))),!1===I&&Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:async function(){const e=JSON.parse(x),t=JSON.parse(La(f));if(c.cloneFromExistingJob(e,t),Object(v.a)(c))try{await c.autoSetTimeRange()}catch(e){const t=n.i18n.translate("xpack.ml.newJob.wizard.jsonFlyout.autoSetJobCreatorTimeRange.error",{defaultMessage:"Error retrieving beginning and end times of index"});b(e,t)}d(),m(!1)},fill:!0,isDisabled:!1===S},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jsonFlyout.saveButton",defaultMessage:"Save"})))))))},Ua=({isDisabled:e,onClick:t,editJsonMode:a})=>{const i=n.i18n.translate("xpack.ml.newJob.wizard.previewJsonButton",{defaultMessage:"Preview JSON"}),s=n.i18n.translate("xpack.ml.newJob.wizard.editJsonButton",{defaultMessage:"Edit JSON"});return Object(N.jsx)(l.EuiButtonEmpty,{onClick:t,isDisabled:e,"data-test-subj":"mlJobWizardButtonPreviewJobJson"},a?s:i)},Ha=({title:e,value:t,editJson:a,onChange:s,heightOffset:n=0,schema:o})=>{const r=Object(i.useMemo)((()=>window.innerHeight-230-n+"px"),[n]);return Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h5",null,e)),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(ta.a,{value:t,height:r,mode:ta.b.JSON,readOnly:!1===a,onChange:s,schema:o}))},Wa=({setCurrentStep:e,isCurrentStep:t})=>{const{jobCreator:a,jobValidator:s,jobValidatorUpdated:l}=Object(i.useContext)(D),[n,o]=Object(i.useState)(!1),[r,c]=Object(i.useState)(!1),{setIsFlyoutVisible:d,setFieldName:u}=Object(_.c)();return Object(i.useEffect)((()=>(o(r&&s.isPickFieldsStepValid),()=>{d(!1),u(void 0)})),[s,l,r,d,u]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,Object(v.g)(a)&&Object(N.jsx)(ke,{isActive:t,setCanProceed:c}),Object(v.d)(a)&&Object(N.jsx)(Ue,{isActive:t,setCanProceed:c}),Object(v.e)(a)&&Object(N.jsx)(Ze,{isActive:t,setCanProceed:c}),Object(v.a)(a)&&Object(N.jsx)(qt,{isActive:t,setCanProceed:c}),Object(v.b)(a)&&Object(N.jsx)(ga,{isActive:t,setCanProceed:c}),Object(v.f)(a)&&Object(N.jsx)(ka,{isActive:t,setCanProceed:c}),Object(v.c)(a)&&Object(N.jsx)(Na,{isActive:t,setCanProceed:c}),Object(N.jsx)(B,{previous:()=>e(Object(v.a)(a)?z.ADVANCED_CONFIGURE_DATAFEED:z.TIME_RANGE),next:()=>e(z.JOB_DETAILS),nextActive:n},Object(v.a)(a)&&Object(N.jsx)(Ga,{isDisabled:!1,jobEditorMode:Ba.EDITABLE,datafeedEditorMode:Ba.EDITABLE}))))},qa=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.title",{defaultMessage:"Job ID"}),i=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.description",{defaultMessage:'A unique identifier for the job. Spaces and the characters  / ? , " < > | * are not allowed'});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:i},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))})),$a=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:s}=Object(i.useContext)(D),[n,o]=Object(i.useState)(e.jobId),r=Object(i.useMemo)((()=>{var e,t,i;return{valid:!0==(""===n)||!0===a.jobId.valid&&!0===(null===(e=a.latestValidationResult.jobIdExists)||void 0===e?void 0:e.valid),message:null!==(t=a.jobId.message)&&void 0!==t?t:null===(i=a.latestValidationResult.jobIdExists)||void 0===i?void 0:i.message}}),[s]);return Object(i.useEffect)((()=>{e.jobId=n,t()}),[n]),Object(N.jsx)(qa,{validation:r},Object(N.jsx)(l.EuiFieldText,{value:n,onChange:e=>o(e.target.value),isInvalid:!1===r.valid,"data-test-subj":"mlJobWizardInputJobId"}))},Qa=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.title",{defaultMessage:"Job description"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.description",defaultMessage:"Optional descriptive text."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Ya=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(i.useContext)(D),[a,s]=Object(i.useState)(e.description);return Object(i.useEffect)((()=>{e.description=a,t()}),[a]),Object(N.jsx)(Qa,null,Object(N.jsx)(l.EuiTextArea,{value:a,onChange:e=>s(e.target.value),"data-test-subj":"mlJobWizardInputJobDescription"}))};var Ka=a(150),Xa=a(299);const Za=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:s}=Object(i.useContext)(D),{existingJobsAndGroups:o}=Object(i.useContext)(D),[r,c]=Object(i.useState)(e.groups),d=Object(i.useMemo)((()=>{var e,t,i;return{valid:!0===a.groupIds.valid&&!0===(null===(e=a.latestValidationResult.groupIdsExist)||void 0===e?void 0:e.valid),message:null!==(t=a.groupIds.message)&&void 0!==t?t:null===(i=a.latestValidationResult.groupIdsExist)||void 0===i?void 0:i.message}}),[s]);Object(i.useEffect)((()=>{e.groups=r,t()}),[r.join()]);const u=o.groupIds.map((e=>({label:e,color:Object(Ka.a)(e)}))),b=r.map((e=>({label:e,color:Object(Ka.a)(e)})));return Object(N.jsx)(Xa.a,{validation:d},Object(N.jsx)(l.EuiComboBox,{placeholder:n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:u,selectedOptions:b,onChange:function(e){c(e.map((e=>e.label)))},onCreateOption:function(e,t){const a=e.trim().toLowerCase();if(!a)return;const i={label:e,color:Object(Ka.a)(e)};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&u.push(i),c([...b,i].map((e=>e.label)))},isClearable:!0,isInvalid:!1===d.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))},ei=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.description",defaultMessage:"Store additional model information used for plotting model bounds. This adds overhead to the system performance. Not recommended for high cardinality data."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ti=()=>{const{jobCreator:e,jobValidator:t,jobValidatorUpdated:a}=Object(i.useContext)(D),[s,n]=Object(i.useState)(null);return Object(i.useEffect)((()=>{var e,a,i;const s=null!==(e=null===(a=t.latestValidationResult)||void 0===a||null===(i=a.highCardinality)||void 0===i?void 0:i.value)&&void 0!==e?e:null;n(s)}),[a]),e.modelPlot&&null!==s?Object(N.jsx)(l.EuiCallOut,{title:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.title",defaultMessage:"Proceed with caution!"}),color:"warning",iconType:"help"},Object(N.jsx)(l.EuiText,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.message",defaultMessage:"Creating model plots is resource intensive and not recommended where the cardinality of the selected fields is greater than 100. Estimated cardinality for this job is {highCardinality}. If you enable model plot with this configuration we recommend you use a dedicated results index.",values:{highCardinality:s}}))):null},ai=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),[o,r]=Object(i.useState)(e.modelPlot),[c,d]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{e.modelPlot=o,t()}),[o]),Object(i.useEffect)((()=>{const t=[ye.b.RARE],a=Object(v.b)(e)&&e.aggregations.some((e=>t.includes(e.id)));d(!1===a)}),[a]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(ei,null,Object(N.jsx)(l.EuiSwitch,{name:"switch",disabled:!1===c,checked:o,onChange:function(){r(!o)},"data-test-subj":"mlJobWizardSwitchModelPlot",label:n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"})})),Object(N.jsx)(ti,null))},ii=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.description",defaultMessage:"Generate annotations when the model changes significantly. For example, when step changes, periodicity or trends are detected."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),si=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),[r,c]=Object(i.useState)(e.modelChangeAnnotations),[d,u]=Object(i.useState)(e.modelPlot&&!e.modelChangeAnnotations);return Object(i.useEffect)((()=>{e.modelChangeAnnotations=r,t()}),[r]),Object(i.useEffect)((()=>{u(e.modelPlot&&!r)}),[a,r]),Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(ii,null,Object(N.jsx)(l.EuiSwitch,{name:"switch",checked:r,onChange:function(){c(!r)},"data-test-subj":"mlJobWizardSwitchAnnotations",label:n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"})})),d&&Object(N.jsx)(l.EuiCallOut,{"data-test-subj":"mlJobWizardAlsoEnableAnnotationsRecommendationCallout",title:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.annotationsSwitchCallout.title",defaultMessage:"If you enable model plot with this configuration, we recommend you also enable annotations."}),color:"primary",iconType:"help"}))},li=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.description",defaultMessage:"Store results in a separate index for this job."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ni=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(i.useContext)(D),[a,s]=Object(i.useState)(e.useDedicatedIndex);return Object(i.useEffect)((()=>{e.useDedicatedIndex=a,t()}),[a]),Object(N.jsx)(li,null,Object(N.jsx)(l.EuiSwitch,{name:"switch",checked:a,onChange:function(){s(!a)},"data-test-subj":"mlJobWizardSwitchUseDedicatedIndex",label:n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"})}))},oi=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.ignoreUnavailable.title",{defaultMessage:"Ignore unavailable indices"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.ignoreUnavailable.description",defaultMessage:"Sets the Elasticsearch {ignoreUnavailable} option on all searches done by the datafeed.",values:{ignoreUnavailable:Object(N.jsx)(l.EuiCode,{language:"JSON",transparentBackground:!0},"ignore_unavailable")}})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),ri=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(i.useContext)(D),[a,s]=Object(i.useState)(e.ignoreUnavailable);return Object(i.useEffect)((()=>{e.ignoreUnavailable=a,t()}),[a]),Object(N.jsx)(oi,null,Object(N.jsx)(l.EuiSwitch,{name:"ignoreUnavailableSwitch",checked:a,onChange:function(){s(!a)},"data-test-subj":"mlJobWizardSwitchIgnoreUnavailableIndex",label:n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.ignoreUnavailable.title",{defaultMessage:"Ignore unavailable indices"})}))},ci=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSectionButton",{defaultMessage:"Advanced"}),di=({advancedExpanded:e,setAdvancedExpanded:t})=>{const{jobCreator:a}=Object(i.useContext)(D);return a.type===p.f.ADVANCED?Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,{margin:"xl"}),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ai,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ni,null))),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(si,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ri,null)))):Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiSpacer,{size:"xl"}),Object(N.jsx)(l.EuiAccordion,{id:"advanced-section",buttonContent:ci,onToggle:t,initialIsOpen:e,"data-test-subj":"mlJobWizardToggleAdvancedSection"},Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"},"data-test-subj":"mlJobWizardAdvancedSection"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ai,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ni,null))),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"},"data-test-subj":"mlJobWizardAdvancedSection"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(si,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(ri,null))),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"},"data-test-subj":"mlJobWizardAdvancedSection"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(It,null)),Object(N.jsx)(l.EuiFlexItem,null))))};var ui=a(120),bi=a.n(ui);const ji=Object(i.memo)((({children:e})=>{const{services:{docLinks:t}}=Object(k.d)(),a=t.links.ml.calendars,i=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.title",{defaultMessage:"Calendars"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,i),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.description",defaultMessage:"A list of scheduled events you want to ignore, such as planned system outages or public holidays. {learnMoreLink}",values:{learnMoreLink:Object(N.jsx)(l.EuiLink,{href:a,target:"_blank"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))}));var mi=a(237),pi=a(1);const gi=()=>{const{services:{application:{getUrlForApp:e}}}=Object(k.d)(),{jobCreator:t,jobCreatorUpdate:a}=Object(i.useContext)(D),[s,r]=Object(i.useState)(t.calendars),[c,d]=Object(i.useState)([]),[u,b]=Object(i.useState)([]),[j,m]=Object(i.useState)(!1);async function p(){m(!0);const e=(await g.ml.calendars()).filter((e=>!1===e.job_ids.includes(mi.a)));b(e.map((e=>({label:e.calendar_id,value:e})))),d(s.map((e=>({label:e.calendar_id,value:e})))),m(!1)}Object(i.useEffect)((()=>{p()}),[]),Object(i.useEffect)((()=>{t.calendars=s,a()}),[s.join()]);const x={async:!0,options:u,selectedOptions:c,isLoading:j,onChange:e=>{d(e),r(e.map((e=>e.value)))}},O=e(L.g,{path:pi.b.CALENDARS_MANAGE});return Object(N.jsx)(ji,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiComboBox,bi()({},x,{"data-test-subj":"mlJobWizardComboBoxCalendars"}))),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiToolTip,{position:"right",content:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",defaultMessage:"Refresh calendars"})},Object(N.jsx)(l.EuiButtonIcon,{iconType:"refresh",color:"primary","aria-label":n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",{defaultMessage:"Refresh calendars"}),onClick:p})))),Object(N.jsx)(l.EuiSpacer,{size:"xs"}),Object(N.jsx)(l.EuiText,{size:"s"},Object(N.jsx)(l.EuiLink,{href:O,target:"_blank",external:!0},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.manageCalendarsButtonLabel",defaultMessage:"Manage calendars"}))))};var xi=a(293),Oi=a(312),fi={name:"nmbbfz",styles:"> .euiFlexGroup{> .euiFlexItem{&:last-child{flex-basis:50%;}}}"};const hi=Object(i.memo)((({children:e})=>{const{services:{docLinks:t}}=Object(k.d)(),a=t.links.ml.customUrls,i=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrls.title",{defaultMessage:"Custom URLs"}),r=fi;return Object(N.jsx)(l.EuiDescribedFormGroup,{fullWidth:!0,css:r,title:Object(N.jsx)("h3",null,i),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.description",defaultMessage:"Provide links from anomalies to Kibana dashboards, Discover, or other web pages. {learnMoreLink}",values:{learnMoreLink:Object(N.jsx)(l.EuiLink,{href:a,target:"_blank"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},Object(N.jsx)(l.EuiFormRow,{fullWidth:!0},Object(N.jsx)(s.a.Fragment,null,e)))})),Si=()=>{var e;const{jobCreator:t,jobCreatorUpdate:a}=Object(i.useContext)(D),s={...t.jobConfig,datafeed_config:t.datafeedConfig},l=Object(xi.a)();return Object(N.jsx)(hi,null,Object(N.jsx)(Oi.a,{job:s,jobCustomUrls:null!==(e=t.customUrls)&&void 0!==e?e:[],setCustomUrls:e=>{t.customUrls=e,a()},editMode:"modal",dashboardService:l}))},vi=n.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSectionButton",{defaultMessage:"Additional settings"}),Fi=({additionalExpanded:e,setAdditionalExpanded:t})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiAccordion,{id:"additional-section",buttonContent:vi,onToggle:t,initialIsOpen:e,"data-test-subj":"mlJobWizardToggleAdditionalSettingsSection"},Object(N.jsx)("section",{"data-test-subj":"mlJobWizardAdditionalSettingsSection"},Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Si,null))),Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(gi,null)),Object(N.jsx)(l.EuiFlexItem,null))))),Ei=({setCurrentStep:e,isCurrentStep:t,advancedExpanded:a,setAdvancedExpanded:s,additionalExpanded:n,setAdditionalExpanded:o})=>{const{jobCreator:r,jobValidator:c,jobValidatorUpdated:d}=Object(i.useContext)(D),[u,b]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{var e,t;const a=c.jobId.valid&&c.modelMemoryLimit.valid&&c.groupIds.valid&&!0===(null===(e=c.latestValidationResult.jobIdExists)||void 0===e?void 0:e.valid)&&!0===(null===(t=c.latestValidationResult.groupIdsExist)||void 0===t?void 0:t.valid)&&!1===c.validating;b(a)}),[d]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)($a,null),Object(N.jsx)(Za,null)),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(Ya,null))),Object(N.jsx)(Fi,{additionalExpanded:n,setAdditionalExpanded:o}),Object(N.jsx)(di,{advancedExpanded:a,setAdvancedExpanded:s}),Object(N.jsx)(B,{previous:()=>e(z.PICK_FIELDS),next:()=>e(z.VALIDATION),nextActive:u},Object(v.a)(r)&&Object(N.jsx)(Ga,{isDisabled:!1,jobEditorMode:Ba.EDITABLE,datafeedEditorMode:Ba.EDITABLE}))))};var yi=a(210),wi=a.n(yi),Ci=a(17),Mi=a(42),ki=a(20);const zi=Object(j.once)((e=>({categorizer_detector_missing_per_partition_field:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerMissingPerPartitionFieldHeading",{defaultMessage:"Per-partition categorization"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},categorizer_varying_per_partition_fields:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerVaryingPerPartitionFieldNamesHeading",{defaultMessage:"Per-partition categorization"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory " cannot have different partition_field_name when per-partition categorization is enabled. Found [{fields}].',values:{fields:'"{{fields}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},field_not_aggregatable:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.fieldNotAggregatableHeading",{defaultMessage:"Detector field"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.fieldNotAggregatableMessage",{defaultMessage:"{fieldName} is not an aggregatable field.",values:{fieldName:'"{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.aggregrations},fields_not_aggregatable:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.fieldsNotAggregatableHeading",{defaultMessage:"Detector fields"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.fieldsNotAggregatableMessage",{defaultMessage:"One of the detector fields is not an aggregatable field."}),url:null==e?void 0:e.links.ml.aggregrations},cardinality_no_results:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityNoResultsHeading",{defaultMessage:"Field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityNoResultsMessage",{defaultMessage:"Cardinality checks could not be run. The query to validate fields didn't return any documents."})},cardinality_field_not_exists:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityFieldNotExistsHeading",{defaultMessage:"Field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityFieldNotExistsMessage",{defaultMessage:"Cardinality checks could not be run for field {fieldName}. The query to validate the field didn't return any documents.",values:{fieldName:'"{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.aggregrations},cardinality_by_field:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityByFieldHeading",{defaultMessage:"Field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityByFieldMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000 and might result in high memory usage.",values:{fieldName:'by_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_over_field_low:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldLowHeading",{defaultMessage:"Over field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldLowMessage",{defaultMessage:"Cardinality of {fieldName} is below 10 and might not be suitable for population analysis.",values:{fieldName:'over_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_over_field_high:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldHighHeading",{defaultMessage:"Over field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityOverFieldHighMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000000 and might result in high memory usage.",values:{fieldName:'over_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_partition_field:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityPartitionFieldHeading",{defaultMessage:"Partition field cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityPartitionFieldMessage",{defaultMessage:"Cardinality of {fieldName} is above 1000 and might result in high memory usage.",values:{fieldName:'partition_field "{{fieldName}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},cardinality_model_plot_high:{status:Mi.c.WARNING,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.cardinalityModelPlotHighMessage",{defaultMessage:"The estimated cardinality of {modelPlotCardinality} of fields relevant to creating model plots might result in resource intensive jobs.",values:{modelPlotCardinality:"{{modelPlotCardinality}}"}})},categorization_filters_valid:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersValidHeading",{defaultMessage:"Categorization filters"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersValidMessage",{defaultMessage:"All checks passed."}),url:null==e?void 0:e.links.ml.anomalyDetectionConfiguringCategories},categorization_filters_invalid:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersInvalidHeading",{defaultMessage:"Categorization filters"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.categorizationFiltersInvalidMessage",{defaultMessage:"Configuration is invalid. Make sure filters are valid regular expressions and {categorizationFieldName} is set.",values:{categorizationFieldName:'"categorization_field_name"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_empty:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEmptyHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEmptyMessage",{defaultMessage:"The bucket span field must be specified."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_estimation_mismatch:{status:Mi.c.INFO,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEstimationMismatchHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanEstimationMismatchMessage",{defaultMessage:"Current bucket span is {currentBucketSpan}, but bucket span estimation returned {estimateBucketSpan}.",values:{currentBucketSpan:'"{{currentBucketSpan}}"',estimateBucketSpan:'"{{estimateBucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},bucket_span_high:{status:Mi.c.INFO,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanHighHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanHighMessage",{defaultMessage:"Bucket span is 1 day or more. Be aware that days are considered as UTC days, not local days."}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},bucket_span_valid:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanValidHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanValidMessage",{defaultMessage:"Format of {bucketSpan} is valid.",values:{bucketSpan:'"{{bucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},bucket_span_invalid:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanInvalidHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.bucketSpanInvalidMessage",{defaultMessage:"The specified bucket span is not a valid time interval format e.g. 10m, 1h. It also needs to be higher than zero."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResourceAnalysisConfig},detectors_duplicates:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsDuplicatesHeading",{defaultMessage:"Detector duplicates"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsDuplicatesMessage",{defaultMessage:"Duplicate detectors were found. Detectors having the same combined configuration for {functionParam}, {fieldNameParam}, {byFieldNameParam}, {overFieldNameParam} and {partitionFieldNameParam} are not allowed within the same job.",values:{functionParam:"'function'",fieldNameParam:"'field_name'",byFieldNameParam:"'by_field_name'",overFieldNameParam:"'over_field_name'",partitionFieldNameParam:"'partition_field_name'"}}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_empty:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsEmptyHeading",{defaultMessage:"Detectors"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsEmptyMessage",{defaultMessage:"No detectors were found. At least one detector must be specified."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_function_empty:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionEmptyHeading",{defaultMessage:"Detector functions"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionEmptyMessage",{defaultMessage:"One of the detector functions is empty."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},detectors_function_not_empty:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionNotEmptyHeading",{defaultMessage:"Detector functions"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.detectorsFunctionNotEmptyMessage",{defaultMessage:"Presence of detector functions validated in all detectors."}),url:null==e?void 0:e.links.ml.anomalyDetectionDetectors},index_fields_invalid:{status:Mi.c.ERROR,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.indexFieldsInvalidMessage",{defaultMessage:"Could not load fields from index."})},index_fields_valid:{status:Mi.c.SUCCESS,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.indexFieldsValidMessage",{defaultMessage:"Index fields are present in the datafeed."})},influencer_high:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerHighHeading",{defaultMessage:"Influencers"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerHighMessage",{defaultMessage:"The job configuration includes more than 3 influencers. Consider using fewer influencers or creating multiple jobs."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowHeading",{defaultMessage:"Influencers"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowMessage",{defaultMessage:"No influencers have been configured. Picking an influencer is strongly recommended."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low_suggestion:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionHeading",{defaultMessage:"Influencers"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionMessage",{defaultMessage:"No influencers have been configured. Consider using {influencerSuggestion} as an influencer.",values:{influencerSuggestion:"{{influencerSuggestion}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},influencer_low_suggestions:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionsHeading",{defaultMessage:"Influencers"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.influencerLowSuggestionsMessage",{defaultMessage:"No influencers have been configured. Consider using one or more of {influencerSuggestion}.",values:{influencerSuggestion:"{{influencerSuggestion}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},job_id_empty:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdEmptyHeading",{defaultMessage:"Job ID"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdEmptyMessage",{defaultMessage:"Field must not be empty."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_invalid:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidHeading",{defaultMessage:"Job ID"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidMessage",{defaultMessage:"Job ID is invalid. It can contain lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores and must start and end with an alphanumeric character."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_invalid_max_length:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidMaxLengthErrorHeading",{defaultMessage:"Job ID"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:Mi.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_id_valid:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdValidHeading",{defaultMessage:"Job ID format is valid"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobIdValidMessage",{defaultMessage:"Lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores, starts and ends with an alphanumeric character, and is no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:Mi.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_invalid:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidHeading",{defaultMessage:"Group name"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidMessage",{defaultMessage:"One of the job group names is invalid. They can contain lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores and must start and end with an alphanumeric character."}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_invalid_max_length:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidMaxLengthErrorHeading",{defaultMessage:"Group name"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:Mi.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},job_group_id_valid:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdValidHeading",{defaultMessage:"Job group id formats are valid"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.jobGroupIdValidMessage",{defaultMessage:"Lowercase alphanumeric (a-z and 0-9) characters, hyphens or underscores, starts and ends with an alphanumeric character, and is no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:Mi.b}}),url:null==e?void 0:e.links.ml.anomalyDetectionJobResource},missing_summary_count_field_name:{status:Mi.c.ERROR,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.missingSummaryCountFieldNameMessage",{defaultMessage:"A job configured with a datafeed with aggregations must set summary_count_field_name; use doc_count or suitable alternative."})},skipped_extended_tests:{status:Mi.c.WARNING,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.skippedExtendedTestsMessage",{defaultMessage:"Skipped additional checks because the basic requirements of the job configuration were not met."})},success_cardinality:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.successCardinalityHeading",{defaultMessage:"Cardinality"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.successCardinalityMessage",{defaultMessage:"Cardinality of detector fields is within recommended bounds."}),url:null==e?void 0:e.links.ml.anomalyDetectionCardinality},success_bucket_span:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.successBucketSpanHeading",{defaultMessage:"Bucket span"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.successBucketSpanMessage",{defaultMessage:"Format of {bucketSpan} is valid and passed validation checks.",values:{bucketSpan:'"{{bucketSpan}}"'}}),url:null==e?void 0:e.links.ml.anomalyDetectionBucketSpan},success_influencers:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.successInfluencersHeading",{defaultMessage:"Influencer configuration"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.successInfluencersMessage",{defaultMessage:"Passed the validation checks."}),url:null==e?void 0:e.links.ml.anomalyDetectionInfluencers},estimated_mml_greater_than_max_mml:{status:Mi.c.WARNING,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.estimatedMmlGreaterThanMaxMmlMessage",{defaultMessage:"The estimated model memory limit is greater than the max model memory limit configured for this cluster."})},mml_greater_than_effective_max_mml:{status:Mi.c.WARNING,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.mmlGreaterThanEffectiveMaxMmlMessage",{defaultMessage:"Job will not be able to run in the current cluster because model memory limit is higher than {effectiveMaxModelMemoryLimit}.",values:{effectiveMaxModelMemoryLimit:"{{effectiveMaxModelMemoryLimit}}"}})},mml_greater_than_max_mml:{status:Mi.c.ERROR,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.mmlGreaterThanMaxMmlMessage",{defaultMessage:"The model memory limit is greater than the max model memory limit configured for this cluster."})},mml_value_invalid:{status:Mi.c.ERROR,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.mmlValueInvalidHeading",{defaultMessage:"Model memory limit"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.mmlValueInvalidMessage",{defaultMessage:"{mml} is not a valid value for model memory limit. The value needs to be at least 1MB and should be specified in bytes e.g. 10MB.",values:{mml:"{{mml}}"}}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},half_estimated_mml_greater_than_mml:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.halfEstimatedMmlGreaterThanMmlHeading",{defaultMessage:"Model memory limit"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.halfEstimatedMmlGreaterThanMmlMessage",{defaultMessage:"The specified model memory limit is less than half of the estimated model memory limit and will likely hit the hard limit."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},estimated_mml_greater_than_mml:{status:Mi.c.INFO,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.halfEstimatedMmlGreaterThanMmlHeading",{defaultMessage:"Model memory limit"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.estimatedMmlGreaterThanMmlMessage",{defaultMessage:"The estimated model memory limit is greater than the model memory limit you have configured."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},success_mml:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.successMmlHeading",{defaultMessage:"Model memory limit"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.successMmlMessage",{defaultMessage:"Valid and within the estimated model memory limit."}),url:null==e?void 0:e.links.ml.anomalyDetectionModelMemoryLimits},success_time_range:{status:Mi.c.SUCCESS,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.successTimeRangeHeading",{defaultMessage:"Time range"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.successTimeRangeMessage",{defaultMessage:"Valid and long enough to model patterns in the data."})},time_field_invalid:{status:Mi.c.ERROR,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.timeFieldInvalidMessage",{defaultMessage:"{timeField} cannot be used as the time field because it is not a field of type 'date' or 'date_nanos'.",values:{timeField:"'{{timeField}}'"}})},time_range_short:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeShortHeading",{defaultMessage:"Time range"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeShortMessage",{defaultMessage:"The selected or available time range might be too short. The recommended minimum time range should be at least {minTimeSpanReadable} and {bucketSpanCompareFactor} times the bucket span.",values:{minTimeSpanReadable:"{{minTimeSpanReadable}}",bucketSpanCompareFactor:"{{bucketSpanCompareFactor}}"}})},time_range_before_epoch:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeBeforeEpochHeading",{defaultMessage:"Time range"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.timeRangeBeforeEpochMessage",{defaultMessage:"The selected or available time range contains data with timestamps before the UNIX epoch beginning. Timestamps before 01/01/1970 00:00:00 (UTC) are not supported for machine learning jobs."})},datafeed_preview_no_documents:{status:Mi.c.WARNING,heading:n.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewNoDocumentsHeading",{defaultMessage:"Datafeed preview"}),text:n.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewNoDocumentsMessage",{defaultMessage:"Running the datafeed preview over the current job configuration produces no results. If the index contains no documents this warning can be ignored, otherwise the job may be misconfigured."})},datafeed_preview_failed:{status:Mi.c.ERROR,text:n.i18n.translate("xpack.ml.models.jobValidation.messages.datafeedPreviewFailedMessage",{defaultMessage:"The datafeed preview failed. This may be due to an error in the job or datafeed configurations."})}})));var Di=a(410),Ii=a(21);const _i="questionInCircle",Ji=()=>({ui:{iconType:_i,isLoading:!0,isModalVisible:!1},data:{messages:[],success:!1},title:""}),Ti=({messages:e,idFilterList:t})=>{const a=e.filter((e=>!1===t.includes(e.id))).map(((e,t)=>Object(N.jsx)(Di.a,bi()({key:`${e.id}_${t}`},e)))),i=Object(N.jsx)(Di.a,{text:n.i18n.translate("xpack.ml.validateJob.allPassed",{defaultMessage:"All validation checks passed successfully"}),status:Mi.c.SUCCESS});return Object(N.jsx)(s.a.Fragment,null,a.length?a:i)},Ai=()=>Object(N.jsx)(l.EuiFlexGroup,{justifyContent:"spaceAround",alignItems:"center"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiLoadingSpinner,{size:"xl"}))),Ri=({close:e,title:t,children:a})=>Object(N.jsx)(l.EuiModal,{onClose:e,style:{width:"800px"}},Object(N.jsx)(l.EuiModalHeader,null,Object(N.jsx)(l.EuiModalHeaderTitle,null,t)),Object(N.jsx)(l.EuiModalBody,null,a),Object(N.jsx)(l.EuiModalFooter,null,Object(N.jsx)(l.EuiButton,{onClick:e,size:"s",fill:!0},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.modal.closeButtonLabel",defaultMessage:"Close"}))));Ri.propType={close:wi.a.func.isRequired,title:wi.a.string};class validate_job_view_ValidateJobUI extends i.Component{constructor(e){super(e),O()(this,"closeModal",(()=>{const e=Ji();e.ui.iconType=this.state.ui.iconType,this.setState(e)})),O()(this,"validate",(()=>{const e=this.props.getJobConfig(),t=this.props.getDuration,a="function"==typeof t?t():void 0,i=this.props.fields;if("object"==typeof e)if("object"==typeof a&&null!==a.start&&null!==a.end){let t=!0;this.props.ml.validateJob({duration:a,fields:i,job:e}).then((a=>{const i=((e,t)=>{const a=zi(t);return e.map((e=>{const t=e.id,i=a[t];return void 0!==i?(void 0!==i.heading&&(e.heading=Object(ki.c)(i.heading,e)),e.text=Object(ki.c)(i.text,e),void 0!==i.url&&(e.url=i.url),e.status=i.status):e.text=n.i18n.translate("xpack.ml.models.jobValidation.unknownMessageIdErrorMessage",{defaultMessage:"{messageId} (unknown message id)",values:{messageId:t}}),e}))})(a,Object(Ci.c)());t=!1,i.some((e=>e.status===Mi.c.ERROR))&&i.push({id:"job_validation_includes_error",text:n.i18n.translate("xpack.ml.validateJob.jobValidationIncludesErrorText",{defaultMessage:"Job validation has failed, but you can still continue and create the job. Please be aware the job may encounter problems when running."}),status:Mi.c.WARNING}),this.setState({...this.state,ui:{...this.state.ui,iconType:Object(Di.b)(Object(aa.b)(i)),isLoading:!1,isModalVisible:!0},data:{messages:i,success:!0},title:e.job_id}),"function"==typeof this.props.setIsValid&&this.props.setIsValid(!0)})).catch((e=>{const{toasts:t}=this.props.kibana.services.notifications;Object(pe.toastNotificationServiceProvider)(t).displayErrorToast(e,n.i18n.translate("xpack.ml.jobService.validateJobErrorTitle",{defaultMessage:"Job Validation Error"}))})),setTimeout((()=>{t&&this.setState({...this.state,ui:{...this.state.ui,isLoading:!0,isModalVisible:!1}})}),250)}else this.setState({...this.state,ui:{...this.state.ui,iconType:Object(Di.b)(Mi.c.WARNING),isLoading:!1,isModalVisible:!0},data:{messages:[{id:"job_validation_skipped",text:n.i18n.translate("xpack.ml.validateJob.jobValidationSkippedText",{defaultMessage:"Job validation could not be run because of insufficient sample data. Please be aware the job may encounter problems when running."}),status:Mi.c.WARNING}],success:!0},title:e.job_id}),"function"==typeof this.props.setIsValid&&this.props.setIsValid(!0)})),this.state=Ji()}componentDidMount(){!0===this.props.embedded&&this.validate()}render(){const e=Object(Ci.c)().links.ml.anomalyDetectionJobTips,t=!1!==this.props.fill,a=!0===this.props.isCurrentJobConfig,s=!0===this.props.isDisabled,n=!0===this.props.embedded,r=this.props.idFilterList||[],c=this.state.ui.isLoading;return Object(N.jsx)(i.Fragment,null,!1===n?Object(N.jsx)("div",null,Object(N.jsx)(l.EuiButton,{onClick:this.validate,size:"s",fill:t,iconType:a?this.state.ui.iconType:_i,iconSide:"right",isDisabled:s,isLoading:c},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.validateJobButtonLabel",defaultMessage:"Validate Job"})),!s&&this.state.ui.isModalVisible&&Object(N.jsx)(Ri,{close:this.closeModal,title:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.modal.validateJobTitle",defaultMessage:"Validate job {title}",values:{title:this.state.title}})},c?Object(N.jsx)(Ai,null):Object(N.jsx)(Ti,{messages:this.state.data.messages,idFilterList:r}),Object(N.jsx)(l.EuiText,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.modal.jobValidationDescriptionText",defaultMessage:"Job validation performs certain checks against job configurations and underlying source data and provides specific advice on how to adjust settings that are more likely to produce insightful results."})),Object(N.jsx)(l.EuiText,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.modal.linkToJobTipsText",defaultMessage:"For more information, see {mlJobTipsLink}.",values:{mlJobTipsLink:Object(N.jsx)(l.EuiLink,{href:e,target:"_blank"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.validateJob.modal.linkToJobTipsText.mlJobTipsLinkText",defaultMessage:"Machine Learning Job Tips"}))}})))):Object(N.jsx)(i.Fragment,null,c?Object(N.jsx)(Ai,null):Object(N.jsx)(Ti,{messages:this.state.data.messages,idFilterList:r})))}}const Ni=Object(Ii.withKibana)(validate_job_view_ValidateJobUI),Vi=({nextActive:e,setCurrentStep:t})=>e?null:Object(N.jsx)(l.EuiButtonEmpty,{onClick:()=>t(z.SUMMARY),iconType:"arrowRight",iconSide:"right","data-test-subj":"mlJobWizardNavButtonPrevious"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.shopValidationButton",defaultMessage:"Skip validation"})),Pi=["job_id_valid","job_group_id_valid","detectors_function_not_empty","success_bucket_span"],Li=({setCurrentStep:e,isCurrentStep:t})=>{const{jobCreator:a,jobCreatorUpdate:s,jobValidator:l}=Object(i.useContext)(D),[n,o]=Object(i.useState)(!1);return a.type===p.f.ADVANCED&&Pi.push("time_range_short","success_time_range"),Object(i.useEffect)((()=>{l.validate((()=>{}),!0),s()}),[]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Ni,{getJobConfig:function(){return{...a.jobConfig,datafeed_config:a.datafeedConfig}},getDuration:function(){return{start:a.start,end:a.end}},ml:g.ml,embedded:!0,setIsValid:function(e){l.advancedValid=e,o(e)},idFilterList:Pi}),Object(N.jsx)(B,{previous:()=>e(z.JOB_DETAILS),next:()=>e(z.SUMMARY),nextActive:n},Object(N.jsx)(Vi,{nextActive:n,setCurrentStep:e}))),!1===t&&Object(N.jsx)(i.Fragment,null))};var Bi=a(73);const Gi=n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.trueLabel",{defaultMessage:"True"}),Ui=n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.falseLabel",{defaultMessage:"False"}),Hi=n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.defaultString",{defaultMessage:"default"}),Wi=()=>Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h3",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobConfig.title",defaultMessage:"Job configuration"}))),qi=()=>Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h3",null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.datafeedConfig.title",defaultMessage:"Datafeed configuration"}))),$i=({children:e})=>Object(N.jsx)("span",{style:{fontStyle:"italic"}},e),Qi=()=>{const{jobCreator:e}=Object(i.useContext)(D),{services:{uiSettings:t}}=Object(k.d)(),a=t.get("dateFormat"),{anomaly_detectors:s}=Object(S.c)(),r=Object(v.a)(e),c=s.model_memory_limit||"",d=null!==e.modelMemoryLimit?e.modelMemoryLimit:Object(N.jsx)($i,null,`${c} (${Hi})`),u=[{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDetails.title",{defaultMessage:"Job ID"}),description:e.jobId},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.title",{defaultMessage:"Job description"}),description:e.description.length>0?e.description:Object(N.jsx)($i,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.placeholder",defaultMessage:"No description provided"}))},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.title",{defaultMessage:"Groups"}),description:e.groups.length>0?e.groups.join(", "):Object(N.jsx)($i,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.placeholder",defaultMessage:"No groups selected"}))}],b=[{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.bucketSpan.title",{defaultMessage:"Bucket span"}),description:e.bucketSpan}];Object(v.d)(e)&&b.push({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.title",{defaultMessage:"Split field"}),description:Object(v.d)(e)&&null!==e.splitField?e.splitField.name:Object(N.jsx)($i,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.placeholder",defaultMessage:"No split field selected"}))}),Object(v.e)(e)&&b.push({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.title",{defaultMessage:"Population field"}),description:Object(v.e)(e)&&null!==e.populationField?e.populationField.name:Object(N.jsx)("span",{style:{fontStyle:null!==e.populationField?"inherit":"italic"}},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.placeholder",defaultMessage:"No population field selected"}))}),r&&null!==e.categorizationFieldName&&b.push({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.categorizationField.title",{defaultMessage:"Categorization field"}),description:e.categorizationFieldName}),r&&null!==e.summaryCountFieldName&&b.push({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.summaryCountField.title",{defaultMessage:"Summary count field"}),description:e.summaryCountFieldName}),b.push({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.title",{defaultMessage:"Influencers"}),description:e.influencers.length>0?e.influencers.join(", "):Object(N.jsx)($i,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.placeholder",defaultMessage:"No influencers selected"}))});const j=[{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.enableModelPlot.title",{defaultMessage:"Enable model plot"}),description:e.modelPlot?Gi:Ui},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"}),description:e.useDedicatedIndex?Gi:Ui},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.modelMemoryLimit.title",{defaultMessage:"Model memory limit"}),description:d}],m=[{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.timeRange.start.title",{defaultMessage:"Start"}),description:T()(e.start).format(a)},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.timeRange.end.title",{defaultMessage:"End"}),description:T()(e.end).format(a)}];return Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiDescriptionList,{compressed:!0,listItems:u})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiDescriptionList,{compressed:!0,listItems:b})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiDescriptionList,{compressed:!0,listItems:j})),!1===r&&Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiDescriptionList,{compressed:!0,listItems:m})))},Yi=()=>{const{jobCreator:e}=Object(i.useContext)(D),{datafeeds:t}=Object(S.c)(),a=JSON.stringify(e.query,null,2),s=Object(h.f)(e.bucketSpanMs/1e3),o=t.scroll_size||"",r=e.queryDelay||Object(N.jsx)($i,null,`${p.d} (${Hi})`),c=e.frequency||Object(N.jsx)($i,null,`${s}s (${Hi})`),d=null!==e.scrollSize?`${e.scrollSize}`:Object(N.jsx)($i,null,`${o} (${Hi})`),u=[{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.timeField.title",{defaultMessage:"Time field"}),description:e.timeFieldName},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.queryDelay.title",{defaultMessage:"Query delay"}),description:r},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.frequency.title",{defaultMessage:"Frequency"}),description:c},{title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.scrollSize.title",{defaultMessage:"Scroll size"}),description:d}],b=n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.query.title",{defaultMessage:"Elasticsearch query"});return Object(N.jsx)(l.EuiFlexGroup,null,Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiFormRow,{label:b,fullWidth:!0},Object(N.jsx)(ta.a,{value:a,height:"200px",readOnly:!0}))),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(l.EuiDescriptionList,{compressed:!0,listItems:u})))},Ki=()=>{const{jobCreator:e}=Object(i.useContext)(D);return Object(N.jsx)(i.Fragment,null,e.type===p.f.SINGLE_METRIC&&Object(N.jsx)(ke,{isActive:!1}),e.type===p.f.MULTI_METRIC&&Object(N.jsx)(Ue,{isActive:!1}),e.type===p.f.POPULATION&&Object(N.jsx)(Ze,{isActive:!1}),e.type===p.f.ADVANCED&&Object(N.jsx)(qt,{isActive:!1}),e.type===p.f.CATEGORIZATION&&Object(N.jsx)(ga,{isActive:!1}),e.type===p.f.RARE&&Object(N.jsx)(ka,{isActive:!1}),e.type===p.f.GEO&&Object(N.jsx)(Na,{isActive:!1}))},Xi=({progress:e})=>e>0&&e<100?Object(N.jsx)(l.EuiProgress,{value:e,color:"primary",size:"xs",max:100}):null;var Zi=a(30),es=a(298);const ts=({jobRunner:e})=>{const{services:{notifications:t}}=Object(k.d)(),{jobCreator:a}=Object(i.useContext)(D),[s,r]=Object(i.useState)(Zi.a.STOPPED),[c,d]=Object(i.useState)(!1);return Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{isDisabled:s===Zi.a.STARTING||s===Zi.a.STARTED,onClick:async function(){const{toasts:i}=t;if(r(Zi.a.STARTING),null!==e)try{const t=await e.startDatafeedInRealTime(!0);r(!0===t?Zi.a.STARTED:Zi.a.STOPPED),i.addSuccess({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeSuccess",{defaultMessage:"Job {jobId} started",values:{jobId:a.jobId}})})}catch(e){r(Zi.a.STOPPED),i.addDanger({title:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeError",{defaultMessage:"Error starting job"}),text:Object(m.a)(e)})}},"data-test-subj":"mlJobWizardButtonRunInRealTime"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTime",defaultMessage:"Start job running in real time"}))),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{isDisabled:s===Zi.a.STOPPED||s===Zi.a.STARTING,onClick:d.bind(null,!0),"data-test-subj":"mlJobWizardButtonCreateAlert"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.createAlert",defaultMessage:"Create alert rule"}))),s===Zi.a.STARTED&&c&&Object(N.jsx)(es.c,{jobIds:[a.jobId],onCloseFlyout:d.bind(null,!1)}))},as=({startDatafeed:e,setStartDatafeed:t,disabled:a=!1})=>Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiSpacer,null),Object(N.jsx)(l.EuiFormRow,{helpText:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckboxHelpText",{defaultMessage:"If unselected, job can be started later from the jobs list."})},Object(N.jsx)(l.EuiSwitch,{"data-test-subj":"mlJobWizardStartDatafeedCheckbox",label:n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckbox",{defaultMessage:"Start immediately"}),checked:e,onChange:e=>t(e.target.checked),disabled:a})));var is=a(188);const ss=({setCurrentStep:e,isCurrentStep:t})=>{const{services:{notifications:a,http:{basePath:s}}}=Object(k.d)(),r=Object(k.h)(),{jobCreator:c,jobValidator:d,jobValidatorUpdated:u,resultsLoader:b}=Object(i.useContext)(D),[j,m]=Object(i.useState)(b.progress),[p,g]=Object(i.useState)(!1),[x,O]=Object(i.useState)(d.validationSummary.basic),[f,h]=Object(i.useState)(null),[S,F]=Object(i.useState)(!0),[E,y]=Object(i.useState)(!1),w=Object(v.a)(c),C=w?Ba.EDITABLE:Ba.READONLY;async function M(e=!0){try{await c.createJob(),await c.createDatafeed(),Object(Oe.a)(e?c:null,r)}catch(e){I(e)}}function I(e){const{displayErrorToast:t}=Object(pe.toastNotificationServiceProvider)(a.toasts);t(e,n.i18n.translate("xpack.ml.newJob.wizard.summaryStep.createJobError",{defaultMessage:"Job creation error"})),g(!1)}return Object(i.useEffect)((()=>{c.subscribeToProgress(m)}),[]),Object(i.useEffect)((()=>{let e=null;return null!==f&&(e=f.subscribeToJobAssignment((e=>y(!e)))),()=>{var t;null!==e&&(null===(t=e)||void 0===t||t.unsubscribe())}}),[f]),Object(i.useEffect)((()=>{O(d.validationSummary.basic)}),[u]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,w&&Object(N.jsx)(Wi,null),Object(N.jsx)(Ki,null),Object(N.jsx)(l.EuiSpacer,{size:"m"}),Object(N.jsx)(Xi,{progress:j}),Object(N.jsx)(l.EuiSpacer,{size:"m"}),Object(N.jsx)(Qi,null),!1===w&&Object(N.jsx)(as,{startDatafeed:S,setStartDatafeed:F,disabled:p}),w&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiHorizontalRule,null),Object(N.jsx)(qi,null),Object(N.jsx)(l.EuiSpacer,{size:"m"}),Object(N.jsx)(Yi,null)),Object(N.jsx)(l.EuiHorizontalRule,null),E&&Object(N.jsx)(is.b,{jobType:"anomaly-detector"}),Object(N.jsx)(l.EuiFlexGroup,null,j<100&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(G,{previous:()=>e(z.VALIDATION),previousActive:!1===p&&!0===x})),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:async function(){g(!0),w?await M():!0===S?await async function(){try{const e=await c.createAndStartJob();h(e)}catch(e){I(e)}}():await M(!1)},isDisabled:!0===p||!1===x,"data-test-subj":"mlJobWizardButtonCreateJob",fill:!0},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.createJobButton",defaultMessage:"Create job"})))),!1===p&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(Ga,{isDisabled:j>0,jobEditorMode:C,datafeedEditorMode:C})),!1===w&&Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{onClick:()=>{Object(Oe.d)(c,r)},"data-test-subj":"mlJobWizardButtonConvertToAdvancedJob"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.convertToAdvancedButton",defaultMessage:"Convert to advanced job"})))),j>0&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:function(){const e=Bi.mlJobService.createResultsUrl([c.jobId],c.start,c.end,!0===Object(v.g)(c)?"timeseriesexplorer":"explorer");r(`${s.get()}/app/ml/${e}`)},"data-test-subj":"mlJobWizardButtonViewResults"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.viewResultsButton",defaultMessage:"View results"})))),100===j&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:function(){Object(Oe.m)(c,r)},"data-test-subj":"mlJobWizardButtonResetJob"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.summaryStep.resetJobButton",defaultMessage:"Reset job"}))),Object(N.jsx)(ts,{jobRunner:f})))))},ls=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.query.title",{defaultMessage:"Elasticsearch query"});return Object(N.jsx)(l.EuiFormRow,{label:t,describedByIds:["description"],fullWidth:!0},Object(N.jsx)(s.a.Fragment,null,e))})),ns=({setIsValidQuery:e})=>{const{jobCreator:t,jobCreatorUpdate:a,jobCreatorUpdated:s}=Object(i.useContext)(D),l=t,[n,o]=Object(i.useState)(JSON.stringify(l.query,null,2));return Object(i.useEffect)((()=>{const t=Object(aa.c)(n);e(t),t&&(l.query=JSON.parse(n),a())}),[n]),Object(i.useEffect)((()=>{if(Object(aa.c)(n)){const e=JSON.parse(n),t=JSON.stringify(e,null,2),a=JSON.stringify(l.query,null,2);t!==a&&o(a)}}),[s]),Object(i.useEffect)((()=>{const t=Object(aa.c)(n);e(t)}),[]),Object(N.jsx)(ls,null,Object(N.jsx)(ta.a,{value:n,height:"400px",readOnly:!1,onChange:function(e){o(e)}}))},os=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.queryDelay.title",{defaultMessage:"Query delay"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.queryDelay.description",defaultMessage:"Time delay in seconds, between current time and latest input data time."})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))}));function rs(e){const[t,a]=Object(i.useState)(s(e));function s(e){return null===e?"":e}return{value:t,setValue:function(e){a(s(e))}}}const cs=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:s}=Object(i.useContext)(D),[n,o]=Object(i.useState)(a.queryDelay),{value:r,setValue:c}=rs(e.queryDelay);return Object(i.useEffect)((()=>{e.queryDelay=""===r?null:r,t()}),[r]),Object(i.useEffect)((()=>{c(null===e.queryDelay?"":e.queryDelay)}),[t]),Object(i.useEffect)((()=>{o(a.queryDelay)}),[s]),Object(N.jsx)(os,{validation:n},Object(N.jsx)(l.EuiFieldText,{value:r,placeholder:p.d,onChange:e=>c(e.target.value),isInvalid:!1===n.valid,"data-test-subj":"mlJobWizardInputQueryDelay"}))},ds=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.frequency.title",{defaultMessage:"Frequency"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.frequency.description",defaultMessage:"The interval between searches."})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))})),us=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a,jobValidator:s,jobValidatorUpdated:n}=Object(i.useContext)(D),[o,r]=Object(i.useState)(s.frequency),{value:c,setValue:d}=rs(e.frequency),[u,b]=Object(i.useState)(j());function j(){return`${Object(h.f)(e.bucketSpanMs/1e3)}s`}return Object(i.useEffect)((()=>{e.frequency=""===c?null:c,t()}),[c]),Object(i.useEffect)((()=>{d(e.frequency);const t=j();b(t)}),[a]),Object(i.useEffect)((()=>{r(s.frequency)}),[n]),Object(N.jsx)(ds,{validation:o},Object(N.jsx)(l.EuiFieldText,{value:c,placeholder:u,onChange:e=>d(e.target.value),isInvalid:!1===o.valid,"data-test-subj":"mlJobWizardInputFrequency"}))},bs=Object(i.memo)((({children:e,validation:t})=>{const a=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.scrollSize.title",{defaultMessage:"Scroll size"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,a),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.scrollSize.description",defaultMessage:"The maximum number of documents to return in each search request."})},Object(N.jsx)(l.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(N.jsx)(s.a.Fragment,null,e)))})),js=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobValidator:a,jobValidatorUpdated:s}=Object(i.useContext)(D),[n,o]=Object(i.useState)(a.scrollSize),[r,c]=Object(i.useState)(null===e.scrollSize?"":`${e.scrollSize}`),{datafeeds:d}=Object(S.c)(),u=void 0!==d.scroll_size?`${d.scroll_size}`:"";return Object(i.useEffect)((()=>{e.scrollSize=""===r?null:+r,t()}),[r]),Object(i.useEffect)((()=>{c(null===e.scrollSize?"":`${e.scrollSize}`)}),[t]),Object(i.useEffect)((()=>{o(a.scrollSize)}),[s]),Object(N.jsx)(bs,{validation:n},Object(N.jsx)(l.EuiFieldNumber,{min:0,placeholder:u,value:""===r?r:+r,onChange:e=>c(e.target.value),isInvalid:!1===n.valid,"data-test-subj":"mlJobWizardInputScrollSize"}))};var ms=a(147);const ps=()=>{const{jobCreator:e,jobCreatorUpdate:t}=Object(i.useContext)(D),[a,r]=Object(i.useState)(!1),[c]=Object(i.useState)(JSON.stringify(Object(ms.c)(),null,2)),d=()=>r(!1);return Object(N.jsx)(s.a.Fragment,null,a&&Object(N.jsx)(l.EuiConfirmModal,{title:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.title",{defaultMessage:"Reset datafeed query"}),onCancel:d,onConfirm:function(){e.query=Object(ms.c)(),t(),d()},cancelButtonText:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.cancel",{defaultMessage:"Cancel"}),confirmButtonText:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.confirm",{defaultMessage:"Confirm"}),defaultFocusedButton:"confirm"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.description",defaultMessage:"Set the datafeed query to be the default."}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiCodeBlock,{language:"js",fontSize:"m",paddingSize:"s"},c)),Object(N.jsx)(l.EuiButtonEmpty,{size:"s",onClick:()=>r(!0)},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryButton",defaultMessage:"Reset datafeed query to default"})))},gs=({fields:e,changeHandler:t,selectedField:a})=>{const{jobCreator:s}=Object(i.useContext)(D),n=Object(Oe.g)(e,s.additionalFields),o=[];return null!==a&&o.push({label:a}),Object(N.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:n,selectedOptions:o,onChange:function(e){const a=e[0];void 0!==a&&t(a.label)},isClearable:!1,"data-test-subj":"mlTimeFieldNameSelect"})},xs=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.timeField.title",{defaultMessage:"Time field"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.timeField.description",defaultMessage:"The default time field for the data view is automatically selected, but can be overridden."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))})),Os=()=>{const{jobCreator:e,jobCreatorUpdate:t,jobCreatorUpdated:a}=Object(i.useContext)(D),s=e,{dateFields:l}=I.b,[n,o]=Object(i.useState)(s.timeFieldName);return Object(i.useEffect)((()=>{s.timeFieldName=n,t()}),[n]),Object(i.useEffect)((()=>{o(s.timeFieldName)}),[a]),Object(N.jsx)(xs,null,Object(N.jsx)(gs,{fields:l,changeHandler:o,selectedField:n}))},fs=Object(i.memo)((({children:e})=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.title",{defaultMessage:"Data view"});return Object(N.jsx)(l.EuiDescribedFormGroup,{title:Object(N.jsx)("h3",null,t),description:Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.description",defaultMessage:"The data view that is currently used for this job."})},Object(N.jsx)(l.EuiFormRow,null,Object(N.jsx)(s.a.Fragment,null,e)))}));var hs=a(99),Ss=function(e){return e[e.PICK_DATA_VIEW=0]="PICK_DATA_VIEW",e[e.VALIDATE=1]="VALIDATE",e}(Ss||{});const vs=({onClose:e})=>{const{services:{data:{dataViews:t},contentManagement:a,uiSettings:r}}=Object(k.d)(),c=Object(k.h)(),{validateDatafeedPreview:d}=Object(k.c)(),{jobCreator:u}=Object(i.useContext)(D),b=u,[j,m]=Object(i.useState)(!1),[p,g]=Object(i.useState)(Ss.PICK_DATA_VIEW),[x,O]=Object(i.useState)(""),[f,h]=Object(i.useState)(""),[S,v]=Object(i.useState)(null);Object(i.useEffect)((function(){O(b.indexPatternTitle)}),[]),Object(i.useEffect)((function(){p===Ss.PICK_DATA_VIEW&&v(null)}),[p]);const F=Object(i.useCallback)((async e=>{m(!0);const{title:a}=await t.get(e);h(a);const i=a.split(",");if(b.detectors.length){const e={...b.datafeedConfig,indices:i},t=await d({job:{...b.jobConfig,datafeed_config:e}});v(t)}m(!1)}),[t,d,b]),E=Object(i.useCallback)((()=>{const e=f.split(",");b.indices=e,Object(Oe.l)(b,c)}),[b,f,c]);return Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiModal,{onClose:e,"data-test-subj":"mlJobMgmtImportJobsFlyout"},Object(N.jsx)(l.EuiModalHeader,null,Object(N.jsx)(l.EuiModalHeaderTitle,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step0.title",defaultMessage:"Change data view"}))),Object(N.jsx)(l.EuiModalBody,null,p===Ss.PICK_DATA_VIEW&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step1.title",defaultMessage:"Select new data view for the job"}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(hs.SavedObjectFinder,{key:"searchSavedObjectFinder",onChoose:function(e){!1===j&&(g(Ss.VALIDATE),F(e))},showFilter:!0,noItemsMessage:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.step1.noMatchingError",{defaultMessage:"No matching indices or saved searches found."}),savedObjectMetaData:[{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.step1.dataView",{defaultMessage:"Data view"})}],fixedPageSize:8,services:{contentClient:a.client,uiSettings:r}})),p===Ss.VALIDATE&&Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.title",defaultMessage:"Changing {dv1} for {dv2}",values:{dv1:x,dv2:f}}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),!0===j?Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiLoadingSpinner,null),Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.validatingText",defaultMessage:"Checking data view and job compatibility"})):Object(N.jsx)(Fs,{validationResponse:S,dataViewTitle:f}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButtonEmpty,{onClick:g.bind(null,Ss.PICK_DATA_VIEW),isDisabled:j,flush:"left"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.backButton",defaultMessage:"Back"}))),Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(l.EuiButton,{onClick:()=>E(),isDisabled:j,"data-test-subj":"mlJobsImportButton"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.step2.ApplyButton",defaultMessage:"Apply"}))))))))},Fs=({validationResponse:e,dataViewTitle:t})=>null===e?Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.noDetectors.title",{defaultMessage:"Data view valid"}),color:"primary"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.noDetectors.message",defaultMessage:"No detectors have been configured; this data view can be applied to the job."})):!0===e.valid?!0===e.documentsFound?Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.valid.title",{defaultMessage:"Data view valid"}),color:"primary"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.valid.message",defaultMessage:"This data view can be applied to this job."})):Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.possiblyInvalid.title",{defaultMessage:"Data view possibly invalid"}),color:"warning"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.possiblyInvalid.message",defaultMessage:"This data view produced no results when previewing the datafeed. There may be no documents in {dataViewTitle}.",values:{dataViewTitle:t}})):Object(N.jsx)(l.EuiCallOut,{title:n.i18n.translate("xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.title",{defaultMessage:"Data view invalid"}),color:"danger"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.message",defaultMessage:"This data view produced an error when attempting to preview the datafeed. The fields selected for this job might not exist in {dataViewTitle}.",values:{dataViewTitle:t}}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.validation.invalid.reason",defaultMessage:"Reason:"}),Object(N.jsx)(l.EuiSpacer,{size:"s"}),e.error?Object(m.a)(e.error):null),Es=({isDisabled:e})=>{const[t,a]=Object(i.useState)(!1);return Object(N.jsx)(s.a.Fragment,null,t&&Object(N.jsx)(vs,{onClose:a.bind(null,!1)}),Object(N.jsx)(fs,null,Object(N.jsx)(l.EuiButtonEmpty,{onClick:a.bind(null,!0),isDisabled:e,"data-test-subj":"mlJobsImportButton"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.datafeedStep.dataView.changeDataView.button",defaultMessage:"Change data view"}))))},ys=({setCurrentStep:e,isCurrentStep:t})=>{const{jobValidator:a,jobValidatorUpdated:s}=Object(i.useContext)(D),[n,o]=Object(i.useState)(!1),[r,c]=Object(i.useState)(!1);return Object(i.useEffect)((()=>{const e=r&&a.queryDelay.valid&&a.frequency.valid&&a.scrollSize.valid&&!1===a.validating;o(e)}),[s,r]),Object(N.jsx)(i.Fragment,null,t&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"xl"},Object(N.jsx)(l.EuiFlexItem,{"data-test-subj":"mlAdvancedDatafeedQueryEditor"},Object(N.jsx)(ns,{setIsValidQuery:c})),Object(N.jsx)(l.EuiFlexItem,null,Object(N.jsx)(cs,null),Object(N.jsx)(us,null),Object(N.jsx)(js,null),Object(N.jsx)(Os,null),Object(N.jsx)(Es,{isDisabled:!1}))),Object(N.jsx)(ps,null),Object(N.jsx)(B,{next:()=>e(z.PICK_FIELDS),nextActive:n},Object(N.jsx)(Ga,{isDisabled:!1,jobEditorMode:Ba.EDITABLE,datafeedEditorMode:Ba.EDITABLE}))))},ws=({currentStep:e,setCurrentStep:t})=>{const a=Object(H.c)(),{services:r}=Object(k.d)(),c=Object(i.useMemo)((()=>{const{uiSettings:e,data:t,fieldFormats:a,charts:i}=r;return{uiSettings:e,dataViews:t.dataViews,data:t,fieldFormats:a,charts:i}}),[r]),{jobCreator:d,jobCreatorUpdated:u}=Object(i.useContext)(D),[b,j]=Object(i.useState)(null==d?void 0:d.start),[m,p]=Object(i.useState)(null==d?void 0:d.end);Object(i.useEffect)((()=>{(d&&d.start!==b||d.end!==m)&&(j(d.start),p(d.end))}),[u]);const g=Object(i.useMemo)((()=>b&&m?{from:b,to:m}:void 0),[b,m]),[x,O]=Object(i.useState)(!1),[f,h]=Object(i.useState)(!1);return Object(N.jsx)(i.Fragment,null,e===z.TIME_RANGE&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitleTimeRange"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.timeRangeTitle",defaultMessage:"Time range"})),Object(N.jsx)(Q,{isCurrentStep:e===z.TIME_RANGE,setCurrentStep:t})),e===z.ADVANCED_CONFIGURE_DATAFEED&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitleConfigureDatafeed"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.configureDatafeedTitle",defaultMessage:"Configure datafeed"})),Object(N.jsx)(ys,{isCurrentStep:e===z.ADVANCED_CONFIGURE_DATAFEED,setCurrentStep:t})),e===z.PICK_FIELDS&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(_.b,{dataView:a.selectedDataView,fieldStatsServices:c,timeRangeMs:g,dslQuery:d.query},Object(N.jsx)(s.a.Fragment,null,Object(N.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(N.jsx)(l.EuiFlexItem,{grow:!1},Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitlePickFields"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.pickFieldsTitle",defaultMessage:"Choose fields"})))),Object(N.jsx)(Wa,{isCurrentStep:e===z.PICK_FIELDS,setCurrentStep:t})))),e===z.JOB_DETAILS&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitleJobDetails"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.jobDetailsTitle",defaultMessage:"Job details"})),Object(N.jsx)(Ei,{isCurrentStep:e===z.JOB_DETAILS,setCurrentStep:t,advancedExpanded:x,setAdvancedExpanded:O,additionalExpanded:f,setAdditionalExpanded:h})),e===z.VALIDATION&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitleValidation"},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.wizard.stepComponentWrapper.validationTitle",defaultMessage:"Validation"})),Object(N.jsx)(Li,{isCurrentStep:e===z.VALIDATION,setCurrentStep:t})),e===z.SUMMARY&&Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Cs,{"data-test-subj":"mlJobWizardStepTitleSummary"},a.selectedSavedSearch?n.i18n.translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleSavedSearch",{defaultMessage:"New job from saved search {title}",values:{title:null!==(S=a.selectedSavedSearch.title)&&void 0!==S?S:""}}):void 0!==a.selectedDataView.id?n.i18n.translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleDataView",{defaultMessage:"New job from data view {dataViewName}",values:{dataViewName:a.selectedDataView.getName()}}):""),Object(N.jsx)(ss,{isCurrentStep:e===z.SUMMARY,setCurrentStep:t})));var S},Cs=({"data-test-subj":e,children:t})=>Object(N.jsx)(i.Fragment,null,Object(N.jsx)(l.EuiTitle,{size:"s"},Object(N.jsx)("h2",{"data-test-subj":e},t)),Object(N.jsx)(l.EuiSpacer,null)),Ms=({currentStep:e,highestStep:t,setCurrentStep:a,disableSteps:i,jobType:s})=>{const o=[{title:n.i18n.translate("xpack.ml.newJob.wizard.step.timeRangeTitle",{defaultMessage:"Time range"}),...r(z.TIME_RANGE),"data-test-subj":"mlJobWizardTimeRangeStep"},{title:n.i18n.translate("xpack.ml.newJob.wizard.step.pickFieldsTitle",{defaultMessage:"Choose fields"}),...r(z.PICK_FIELDS),"data-test-subj":"mlJobWizardPickFieldsStep"},{title:n.i18n.translate("xpack.ml.newJob.wizard.step.jobDetailsTitle",{defaultMessage:"Job details"}),...r(z.JOB_DETAILS),"data-test-subj":"mlJobWizardJobDetailsStep"},{title:n.i18n.translate("xpack.ml.newJob.wizard.step.validationTitle",{defaultMessage:"Validation"}),...r(z.VALIDATION),"data-test-subj":"mlJobWizardValidationStep"},{title:n.i18n.translate("xpack.ml.newJob.wizard.step.summaryTitle",{defaultMessage:"Summary"}),...r(z.SUMMARY),"data-test-subj":"mlJobWizardSummaryStep"}];function r(s){return{onClick:()=>function(e){e<=t&&a(e)}(s),status:e===s?"selected":e>s?"complete":"incomplete",disabled:i||t<s}}return s===p.f.ADVANCED&&o.splice(0,1,{title:n.i18n.translate("xpack.ml.newJob.wizard.step.configureDatafeedTitle",{defaultMessage:"Configure datafeed"}),...r(z.ADVANCED_CONFIGURE_DATAFEED),"data-test-subj":"mlJobWizardAdvancedStep"}),Object(N.jsx)(l.EuiStepsHorizontal,{steps:o,style:{backgroundColor:"inherit"}})},ks=({jobCreator:e,chartLoader:t,mapLoader:a,resultsLoader:s,chartInterval:l,jobValidator:o,existingJobsAndGroups:r,firstWizardStep:c=z.TIME_RANGE})=>{const[d,u]=Object(i.useState)(0),x=Object(i.useCallback)((()=>{u((e=>e+1))}),[]),[O,f]=Object(i.useState)(0),h=Object(i.useCallback)((()=>{f((e=>e+1))}),[]),S={jobCreatorUpdated:d,jobCreatorUpdate:x,jobCreator:e,chartLoader:t,mapLoader:a,resultsLoader:s,chartInterval:l,jobValidator:o,jobValidatorUpdated:O,fields:I.b.fields,aggs:I.b.aggs,existingJobsAndGroups:r},v=e.type===p.f.ADVANCED?z.ADVANCED_CONFIGURE_DATAFEED:z.TIME_RANGE,[F,E]=Object(i.useState)(v),[y,w]=Object(i.useState)(v),[C,M]=Object(i.useState)(!1),[_,J]=Object(i.useState)(s.progress),[T,A]=Object(i.useState)(zs(e.jobConfig,e.datafeedConfig));return Object(i.useEffect)((()=>{const e=o.validationResult$.subscribe((()=>{h()}));return()=>e.unsubscribe()}),[o]),Object(i.useEffect)((()=>{o.validate((()=>{h()}));const t=zs(e.jobConfig,e.datafeedConfig);t!==T&&(w(F),A(t))}),[d]),Object(i.useEffect)((()=>{e.subscribeToProgress(J),E(c)}),[]),Object(i.useEffect)((()=>{M(_>0)}),[_]),Object(i.useEffect)((()=>{F>=y&&w(F)}),[F]),((e,t,a,s)=>{const{services:{notifications:l}}=Object(k.d)(),o=Object(i.useMemo)((()=>((e,t)=>{const a=new b.Subject,i=new b.Subject;return{get error$(){return i.asObservable()},get updates$(){return Object(b.combineLatest)([e.wizardInitialized$.pipe(Object(b.skipWhile)((e=>!1===e))),a]).pipe(Object(b.map)((([,e])=>e)),Object(b.debounceTime)(600),Object(b.map)(j.cloneDeep),Object(b.distinctUntilChanged)(j.isEqual),Object(b.filter)((()=>t.isModelMemoryEstimationPayloadValid)),Object(b.switchMap)((e=>g.ml.calculateModelMemoryLimit$(e).pipe(Object(b.pluck)("modelMemoryLimit"),Object(b.catchError)((e=>(console.error("Model memory limit could not be calculated",e.body),i.next(e),Object(b.of)(p.c))))))))},update(e){a.next(e)}}})(e,t)),[e,t]);Object(i.useEffect)((()=>{const t=new b.Subscription;return t.add(o.updates$.pipe(Object(b.startWith)(e.modelMemoryLimit),Object(b.pairwise)()).subscribe((([t,i])=>{null!==e.modelMemoryLimit&&e.modelMemoryLimit!==t||(e.modelMemoryLimit=i,a())}))),t.add(o.error$.subscribe((e=>{l.toasts.addWarning({title:n.i18n.translate("xpack.ml.newJob.wizard.estimateModelMemoryError",{defaultMessage:"Model memory limit could not be calculated"}),text:n.i18n.translate("xpack.ml.newJob.wizard.estimateModelMemoryErrorText",{defaultMessage:"{errorText}. You can proceed with creating the job, but check for warning messages once the job is running that the configured limit has not been exceeded.",values:{errorText:Object(m.a)(e)}})})}))),()=>{t.unsubscribe()}}),[o]),Object(i.useEffect)((()=>{o.update({datafeedConfig:e.datafeedConfig,analysisConfig:e.jobConfig.analysis_config,indexPattern:e.indexPatternTitle,query:e.datafeedConfig.query,timeFieldName:e.jobConfig.data_description.time_field,earliestMs:e.start,latestMs:e.end})}),[e,s])})(e,o,x,d),Object(N.jsx)(D.Provider,{value:S},Object(N.jsx)(Ms,{currentStep:F,highestStep:y,setCurrentStep:E,disableSteps:C,jobType:e.type}),Object(N.jsx)(ws,{currentStep:F,setCurrentStep:E}))};function zs(e,t){return JSON.stringify(e)+JSON.stringify(t)}var Ds=a(287),Is=a.n(Ds),_s=a(80);function Js(e,t,a,i,s,l){return new Promise(((n,o)=>{g.ml.esSearch({index:e,size:0,body:{query:i,aggs:{catFields:{terms:{field:t,size:a}}},...void 0!==s?{runtime_mappings:s}:{}},...null!=l?l:{}}).then((e=>{const t=Object(j.get)(e,["aggregations","catFields","buckets"],[]);n({success:!0,results:t.map((e=>e.key))})})).catch((e=>{o(e)}))}))}const Ts=(e,t)=>Object(j.isEqual)(e,t);class chart_loader_ChartLoader{constructor(e,t){O()(this,"_dataView",void 0),O()(this,"_timeFieldName",""),O()(this,"_query",{}),O()(this,"_newJobLineChart",Is()(g.ml.jobs.newJobLineChart,Ts)),O()(this,"_newJobPopulationsChart",Is()(g.ml.jobs.newJobPopulationsChart,Ts)),O()(this,"_getEventRateData",Is()(_s.mlResultsService.getEventRateData,Ts)),O()(this,"_getCategoryFields",Is()(Js,Ts)),this._dataView=e,this._query=t,"string"==typeof e.timeFieldName&&(this._timeFieldName=e.timeFieldName)}async loadLineCharts(e,t,a,i,s,l,n,o){if(""!==this._timeFieldName){if(!1===Object(Oe.b)(a))return{};const r=null!==i?i.name:null,c=a.map(As);return(await this._newJobLineChart(this._dataView.getIndexPattern(),this._timeFieldName,e,t,l,this._query,c,r,s,null!=n?n:void 0,o)).results}return{}}async loadPopulationCharts(e,t,a,i,s,l,n){if(""!==this._timeFieldName){if(!1===Object(Oe.b)(a))return{};const o=null!==i?i.name:"",r=a.map(As);return(await this._newJobPopulationsChart(this._dataView.getIndexPattern(),this._timeFieldName,e,t,s,this._query,r,o,null!=l?l:void 0,n)).results}return{}}async loadEventRateChart(e,t,a,i,s){if(""!==this._timeFieldName){const l=await this._getEventRateData(this._dataView.getIndexPattern(),this._query,this._timeFieldName,e,t,3*a,i,s);if(void 0!==l.error)throw l.error;return Object.entries(l.results).map((([e,t])=>({time:+e,value:t})))}return[]}async loadFieldExampleValues(e,t,a){const{results:i}=await this._getCategoryFields(this._dataView.getIndexPattern(),e.name,10,this._query,null!=t?t:void 0,a);return i}}function As(e){const t=void 0!==e.by&&null!==e.by.field&&null!==e.by.value?{field:e.by.field.id,value:e.by.value}:{field:null,value:null};return{agg:e.agg.dslName||"",field:e.field.id,by:t}}const Rs=(e,t)=>Object(j.isEqual)(e,t);class map_loader_MapLoader extends chart_loader_ChartLoader{constructor(e,t,a){super(e,t),O()(this,"_getMapData",void 0),this._getMapData=a?Is()(a.createLayerDescriptors.createESSearchSourceLayerDescriptor,Rs):null}async getMapLayersForGeoJob(e,t,a,i){const s=[];if(void 0!==this._dataView.id&&e){const{query:l}=null!=i?i:{},n=a.length&&t?`${t.name}:${a[0]} ${l?`and ${l}`:""}`:`${l||""}`,o={indexPatternId:this._dataView.id,geoFieldName:e.name,geoFieldType:e.type,query:{query:n,language:"kuery"}},r=this._getMapData?await this._getMapData(o):null;r&&s.push(r)}return s}}var Ns=a(497),Vs=a(134);const Ps=({existingJobsAndGroups:e,jobType:t})=>{const a=Object(r.c)(),s=Object(H.c)(),{services:{maps:b,uiSettings:j}}=Object(k.d)(),m=Object(u.a)(j),g=Object(i.useMemo)((()=>Object(v.h)(t)(s.selectedDataView,s.selectedSavedSearch,s.combinedQuery)),[t]),x=Object(i.useMemo)((()=>new job_validator_JobValidator(g)),[g]),{displayErrorToast:O}=Object(pe.useToastNotificationService)(),{from:f,to:h}=Object(c.a)(a);g.setTimeRange(f,h);let F=t===p.f.ADVANCED?z.ADVANCED_CONFIGURE_DATAFEED:z.TIME_RANGE,E=Bi.mlJobService.tempJobCloningObjects.autoSetTimeRange;if(Bi.mlJobService.tempJobCloningObjects.autoSetTimeRange=!1,void 0!==Bi.mlJobService.tempJobCloningObjects.job&&void 0!==Bi.mlJobService.tempJobCloningObjects.datafeed){const e=Bi.mlJobService.tempJobCloningObjects.job,a=Bi.mlJobService.cloneDatafeed(Bi.mlJobService.tempJobCloningObjects.datafeed);y(),g.cloneFromExistingJob(e,a),!1===Bi.mlJobService.tempJobCloningObjects.skipTimeRangeStep?g.jobId="":t!==p.f.ADVANCED&&(F=z.PICK_FIELDS),Bi.mlJobService.tempJobCloningObjects.skipTimeRangeStep=!1,Bi.mlJobService.tempJobCloningObjects.job=void 0,Bi.mlJobService.tempJobCloningObjects.datafeed=void 0,Bi.mlJobService.tempJobCloningObjects.createdBy=void 0,void 0!==Bi.mlJobService.tempJobCloningObjects.start&&void 0!==Bi.mlJobService.tempJobCloningObjects.end?(g.setTimeRange(Bi.mlJobService.tempJobCloningObjects.start,Bi.mlJobService.tempJobCloningObjects.end),Bi.mlJobService.tempJobCloningObjects.start=void 0,Bi.mlJobService.tempJobCloningObjects.end=void 0):E=E||Object(v.a)(g),Bi.mlJobService.tempJobCloningObjects.calendars&&(g.calendars=Bi.mlJobService.tempJobCloningObjects.calendars,Bi.mlJobService.tempJobCloningObjects.calendars=void 0)}else if(g.bucketSpan=p.b,g.type!==p.f.POPULATION&&g.type!==p.f.ADVANCED&&g.type!==p.f.CATEGORIZATION&&(g.modelMemoryLimit=p.c),g.type===p.f.SINGLE_METRIC&&(g.modelPlot=!0,g.modelChangeAnnotations=!0),null!==s.selectedSavedSearch&&(g.createdBy=null),E=Object(v.a)(g),y(),Object(v.b)(g)){const{catFields:e}=I.b;1===e.length&&(g.categorizationFieldName=e[0].name)}function y(){if(Object(v.b)(g)){const e=I.b.getAggById("count"),t=I.b.getAggById("high_count"),a=I.b.getAggById("rare"),i=I.b.getFieldById(d.a);g.setDefaultDetectorProperties(e,t,a,i);const{anomaly_detectors:s}=Object(S.c)();g.categorizationAnalyzer=s.categorization_analyzer}else if(Object(v.f)(g)){const e=I.b.getAggById("rare"),t=I.b.getAggById("freq_rare");g.setDefaultDetectorProperties(e,t)}else if(Object(v.c)(g)){const e=I.b.getAggById("lat_long");g.setDefaultDetectorProperties(e)}}E&&g.autoSetTimeRange().catch((e=>{const t=n.i18n.translate("xpack.ml.newJob.wizard.autoSetJobCreatorTimeRange.error",{defaultMessage:"Error retrieving beginning and end times of index"});O(e,t)})),m.setBarTarget(600),m.setMaxBars(1200),m.setInterval("auto");const w=Object(i.useMemo)((()=>new chart_loader_ChartLoader(s.selectedDataView,g.query)),[s.selectedDataView,g.query]),C=Object(i.useMemo)((()=>new map_loader_MapLoader(s.selectedDataView,g.query,b)),[s.selectedDataView,g.query,b]),M=Object(i.useMemo)((()=>new Ns.b(g,m,w)),[g,m,w]);Object(i.useEffect)((()=>()=>{g.forceStopRefreshPolls()}));const D=Object(Oe.i)(g);return Object(N.jsx)(i.Fragment,null,Object(N.jsx)(Vs.a,null,Object(N.jsx)("div",{"data-test-subj":`mlPageJobWizardHeader-${g.type}`},Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.page.createJob",defaultMessage:"Create job"}),":"," ",D)),Object(N.jsx)("div",{style:{backgroundColor:"inherit"},"data-test-subj":`mlPageJobWizard ${t}`},Object(N.jsx)(l.EuiText,{size:"s"},s.selectedDataView.isPersisted()?Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.page.createJob.dataViewName",defaultMessage:"Using data view {dataViewName}",values:{dataViewName:g.indexPatternDisplayName}}):Object(N.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.page.createJob.tempDataViewName",defaultMessage:"Using temporary data view {dataViewName}",values:{dataViewName:g.indexPatternDisplayName}})),Object(N.jsx)(ks,{jobCreator:g,chartLoader:w,mapLoader:C,resultsLoader:M,chartInterval:m,jobValidator:x,existingJobsAndGroups:e,firstWizardStep:F})))}}}]);