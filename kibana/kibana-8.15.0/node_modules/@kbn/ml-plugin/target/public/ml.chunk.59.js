/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[59],{150:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(33),i=a(203);const o=[s.euiDarkVars.euiColorVis0,s.euiDarkVars.euiColorVis1,s.euiDarkVars.euiColorVis2,s.euiDarkVars.euiColorVis3,s.euiDarkVars.euiColorVis4,s.euiDarkVars.euiColorVis5,s.euiDarkVars.euiColorVis6,s.euiDarkVars.euiColorVis7,s.euiDarkVars.euiColorVis8,s.euiDarkVars.euiColorVis9,s.euiDarkVars.euiColorDarkShade,s.euiDarkVars.euiColorPrimary],n={};function r(e){if(void 0===n[e]){const t=Object(i.a)(e),a=o[t%o.length];return n[e]=a,a}return n[e]}},188:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return b}));var s=a(2),i=a.n(s),o=a(25),n=a(15),r=a(28),l=a(122),c=a(6);const u=({jobCount:e})=>{const{showNodeInfo:t}=Object(l.d)();return!1===t||!1===Object(r.b)()||0===e?null:Object(c.jsx)(i.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"{jobCount, plural, one {# job} other {# jobs}} will start after autoscaling has increased ML capacity. This may take several minutes.",values:{jobCount:e}}))),Object(c.jsx)(o.EuiSpacer,{size:"m"}))},b=()=>{const{showNodeInfo:e}=Object(l.d)();return!1===Object(r.b)()?null:e?Object(c.jsx)(i.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.newJobAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There are currently no nodes that can run the job, therefore it will remain in OPENING state until autoscaling increases ML capacity. This may take several minutes."}))),Object(c.jsx)(o.EuiSpacer,{size:"m"})):Object(c.jsx)(i.a.Fragment,null,Object(c.jsx)(o.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.serverless.title",defaultMessage:"Machine learning is starting..."}),color:"primary",iconType:"iInCircle"}),Object(c.jsx)(o.EuiSpacer,{size:"m"}))};a(44)},203:function(e,t,a){"use strict";function s(e){let t=0,a=0;if(0===e.length)return t;for(let s=0;s<e.length;s++)a=e.charCodeAt(s),t=(t<<5)-t+a,t|=0;return t<0?-2*t:t}a.d(t,"a",(function(){return s}))},299:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var s=a(2),i=a.n(s),o=a(5),n=a(15),r=a(25),l=a(6);const c=Object(s.memo)((({children:e,validation:t})=>{const a=o.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.title",{defaultMessage:"Groups"});return Object(l.jsx)(r.EuiDescribedFormGroup,{title:Object(l.jsx)("h3",null,a),description:Object(l.jsx)(n.FormattedMessage,{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.description",defaultMessage:" Optional grouping for jobs. New groups can be created or picked from the list of existing groups."})},Object(l.jsx)(r.EuiFormRow,{error:t.message,isInvalid:!1===t.valid},Object(l.jsx)(i.a.Fragment,null,e)))}))},320:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return j}));var s=a(2),i=a(5),o=a(25),n=a(150),r=a(299),l=a(6);const c=Object(s.memo)((({existingGroups:e,selectedGroups:t,onChange:a,validation:s})=>{const c=e.map((e=>({label:e,color:Object(n.a)(e)}))),u=t.map((e=>({label:e,color:Object(n.a)(e)})));function b(e){a(e.map((e=>e.label)))}return Object(l.jsx)(r.a,{validation:s},Object(l.jsx)(o.EuiComboBox,{placeholder:i.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:c,selectedOptions:u,onChange:b,onCreateOption:function(e,t){const a=e.trim().toLowerCase();if(!a)return;const s={label:e,color:Object(n.a)(e)};-1===t.findIndex((e=>e.label.trim().toLowerCase()===a))&&c.push(s),b([...u,s])},isClearable:!0,isInvalid:!s.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))}));var u=a(39),b=a.n(u),d=a(10);const j=({setTimeRange:e,timeRange:t})=>{const{services:{uiSettings:a}}=Object(d.d)(),n=a.get("dateFormat"),[r,c]=Object(s.useState)(b()(t.start)),[u,j]=Object(s.useState)(b()(t.end));return Object(s.useEffect)((()=>{void 0!==r&&void 0!==u&&e({start:r.valueOf(),end:u.valueOf()})}),[r,u,e]),Object(s.useEffect)((()=>{c(b()(t.start)),j(b()(t.end))}),[JSON.stringify(t)]),Object(l.jsx)(s.Fragment,null,Object(l.jsx)("div",{style:{minWidth:"512px"},"data-test-subj":"mlJobWizardDateRange"},Object(l.jsx)(o.EuiDatePickerRange,{fullWidth:!0,startDateControl:Object(l.jsx)(o.EuiDatePicker,{popperProps:{"data-test-subj":"mlJobWizardDatePickerRangeStartDate"},selected:r,onChange:function(e){c(e||void 0)},startDate:r,endDate:u,"aria-label":i.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.startDateLabel",{defaultMessage:"Start date"}),showTimeSelect:!0,dateFormat:n,maxDate:u}),endDateControl:Object(l.jsx)(o.EuiDatePicker,{popperProps:{"data-test-subj":"mlJobWizardDatePickerRangeEndDate"},selected:u,onChange:function(e){j(e||void 0)},startDate:r,endDate:u,"aria-label":i.i18n.translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.endDateLabel",{defaultMessage:"End date"}),showTimeSelect:!0,dateFormat:n,minDate:r})})))}},502:function(e,t,a){"use strict";a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return b}));var s=a(39),i=a.n(s),o=a(47),n=a.n(o),r=a(5),l=a(37),c=a(586);async function u(e,t,a,s,o,n,u="/internal/file_upload/time_field_range"){try{const b=t.getRuntimeMappings(),d=await async function(e){const{http:t,path:a,signal:s,...i}=e;return await t.fetch({path:a,method:"POST",body:JSON.stringify(i),version:"1",...s?{signal:s}:{}})}({index:t.getIndexPattern(),timeFieldName:t.timeFieldName,query:n?Object(c.a)(o):o,...Object(l.a)(b)?{runtimeMappings:b}:{},http:s,path:u});if(d.start.epoch&&d.end.epoch)return e.setTime({from:i()(d.start.epoch).toISOString(),to:i()(d.end.epoch).toISOString()}),d;if("number"==typeof d.start&&"number"==typeof d.end)return e.setTime({from:i()(d.start).toISOString(),to:i()(d.end).toISOString()}),{success:!0,start:{epoch:d.start,string:i()(d.start).toISOString()},end:{epoch:d.end,string:i()(d.end).toISOString()}};a.addWarning({title:r.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.noResults",{defaultMessage:"No results match your search criteria"})})}catch(e){a.addError(e,{title:r.i18n.translate("xpack.ml.datePicker.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range. Please set the desired start and end times."})})}}function b(e){const t=n.a.parse(e.getTime().from),a=n.a.parse(e.getTime().to),s=void 0!==t?t.valueOf():0;return{to:void 0!==a?a.valueOf():0,from:s}}},586:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(8),i=a(37);const o=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const a=Object(s.cloneDeep)(e);return delete a.match_all,Object(i.a)(a.bool)?Array.isArray(a.bool.must_not)?a.bool.must_not.push(t):(Object(i.a)(a.bool.must_not)&&(a.bool.must_not=[a.bool.must_not,t]),void 0===a.bool.must_not&&(a.bool.must_not=[t])):a.bool={must_not:[t]},a}},870:function(e,t,a){"use strict";a.r(t),a.d(t,"Page",(function(){return R}));var s=a(2),i=a.n(s),o=a(15),n=a(5),r=a(25),l=a(8),c=a(39),u=a.n(c),b=a(37),d=a(586),j=a(248),g=a(122),x=a(10),m=a(6);const O=Object(s.memo)((({saveState:e,resultsUrl:t,onReset:a})=>e===P.NOT_SAVED?null:Object(m.jsx)(i.a.Fragment,null,e===P.SAVED&&Object(m.jsx)(r.EuiCallOut,{title:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobsCreatedTitle",defaultMessage:"Jobs created"}),color:"success",iconType:"checkInCircleFilled"}),e===P.FAILED&&Object(m.jsx)(r.EuiCallOut,{title:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.simple.recognize.jobsCreationFailedTitle",defaultMessage:"Jobs creation failed"}),color:"danger",iconType:"warning"}),e===P.PARTIAL_FAILURE&&Object(m.jsx)(r.EuiCallOut,{title:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.someJobsCreationFailedTitle",defaultMessage:"Some jobs failed to be created"}),color:"warning",iconType:"warning"}),Object(m.jsx)(r.EuiSpacer,{size:"l"}),Object(m.jsx)(r.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center"},e!==P.SAVING&&Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiButton,{color:"primary",fill:!1,"aria-label":n.i18n.translate("xpack.ml.newJob.recognize.jobsCreationFailed.resetButtonAriaLabel",{defaultMessage:"Reset"}),onClick:a},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.someJobsCreationFailed.resetButtonLabel",defaultMessage:"Reset"}))),(e===P.SAVED||e===P.PARTIAL_FAILURE)&&Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiButton,{color:"primary",fill:!0,href:t,"aria-label":n.i18n.translate("xpack.ml.newJob.recognize.viewResultsAriaLabel",{defaultMessage:"View results"})},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.viewResultsLinkText",defaultMessage:"View results"})))))));var p=a(322);const f=Object(s.memo)((({objectType:e,kibanaObjects:t,isSaving:a})=>{const s={dashboard:n.i18n.translate("xpack.ml.newJob.recognize.dashboardsLabel",{defaultMessage:"Dashboards"}),search:n.i18n.translate("xpack.ml.newJob.recognize.searchesLabel",{defaultMessage:"Searches"}),visualization:n.i18n.translate("xpack.ml.newJob.recognize.visualizationsLabel",{defaultMessage:"Visualizations"})};return void 0===t?null:Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiTitle,{size:"s"},Object(m.jsx)("h4",null,s[e])),Object(m.jsx)(r.EuiSpacer,{size:"s"}),Object(m.jsx)("ul",null,t.map((({id:e,title:s,success:i,exists:l,error:c},u)=>Object(m.jsx)("li",{key:e},Object(m.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(m.jsx)(r.EuiFlexItem,null,Object(m.jsx)(r.EuiFlexGroup,{gutterSize:"xs"},Object(m.jsx)(r.EuiFlexItem,null,Object(m.jsx)(r.EuiText,{size:"s",color:l?"subdued":"success"},s),!1===i&&void 0!==c&&Object(m.jsx)(r.EuiText,{size:"xs",color:"danger"},Object(p.a)(c))),l&&Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiText,{size:"xs",color:"default"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.alreadyExistsLabel",defaultMessage:"(already exists)"}))))),!l&&Object(m.jsx)(r.EuiFlexItem,{grow:!1,style:{width:"60px"}},Object(m.jsx)(r.EuiText,{textAlign:"center"},a?Object(m.jsx)(r.EuiLoadingSpinner,{size:"m"}):null,void 0!==i?Object(m.jsx)(r.EuiIcon,{type:i?"check":"cross",color:i?"success":"danger","aria-label":i?n.i18n.translate("xpack.ml.newJob.recognize.results.savedAriaLabel",{defaultMessage:"Saved"}):n.i18n.translate("xpack.ml.newJob.recognize.results.saveFailedAriaLabel",{defaultMessage:"Save failed"})}):null))),(1===t.length||u<t.length-1)&&Object(m.jsx)(r.EuiHorizontalRule,{margin:"s"}))))))}));var w=a(150);const h=Object(s.memo)((({job:e,jobOverride:t,isSaving:a,jobPrefix:s,onEditRequest:i})=>{const{id:l,config:{description:c,groups:u},datafeedResult:b,setupResult:d}=e,j=t&&t.groups||u;return Object(m.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(m.jsx)(r.EuiFlexItem,null,Object(m.jsx)(r.EuiFlexGroup,{gutterSize:"s"},Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiText,{size:"s",color:"success"},s,l)),Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiToolTip,{position:"right",content:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",defaultMessage:"Override job configuration"})},Object(m.jsx)(r.EuiButtonIcon,{"aria-label":n.i18n.translate("xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",{defaultMessage:"Override job configuration"}),iconType:"pencil",onClick:()=>i(e)})))),Object(m.jsx)(r.EuiText,{size:"s",color:"subdued"},c),Object(m.jsx)(r.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"xs"},(null!=j?j:[]).map((e=>Object(m.jsx)(r.EuiFlexItem,{grow:!1,key:e},Object(m.jsx)(r.EuiBadge,{color:Object(w.a)(e)},e))))),d&&d.error&&Object(m.jsx)(r.EuiText,{size:"xs",color:"danger"},Object(p.a)(d.error)),b&&b.error&&Object(m.jsx)(r.EuiText,{size:"xs",color:"danger"},Object(p.a)(b.error))),Object(m.jsx)(r.EuiFlexItem,{grow:!1,style:{width:M}},a&&Object(m.jsx)(r.EuiLoadingSpinner,{size:"m"}),d&&b&&Object(m.jsx)(r.EuiFlexGroup,{gutterSize:"s",wrap:!1,responsive:!1,justifyContent:"spaceAround"},Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiIcon,{type:d.success?"check":"cross",color:d.success?"success":"danger",size:"m","aria-label":d.success?n.i18n.translate("xpack.ml.newJob.recognize.job.savedAriaLabel",{defaultMessage:"Saved"}):n.i18n.translate("xpack.ml.newJob.recognize.job.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiIcon,{type:b.success?"check":"cross",color:b.success?"success":"danger",size:"m","aria-label":d.success?n.i18n.translate("xpack.ml.newJob.recognize.datafeed.savedAriaLabel",{defaultMessage:"Saved"}):n.i18n.translate("xpack.ml.newJob.recognize.datafeed.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiIcon,{type:E(b).type,color:E(b).color,size:"m","aria-label":d.success?n.i18n.translate("xpack.ml.newJob.recognize.running.startedAriaLabel",{defaultMessage:"Started"}):n.i18n.translate("xpack.ml.newJob.recognize.running.startFailedAriaLabel",{defaultMessage:"Start failed"})})))))}));function E({awaitingMlNodeAllocation:e,success:t}){return!0===e?{type:"warning",color:"warning"}:t?{type:"check",color:"success"}:{type:"cross",color:"danger"}}var S=a(32),v=a(123),F=a(42),z=a(320);const k=({job:e,jobOverride:t,existingGroupIds:a,onClose:i})=>{var n;const[l,c]=function(e){const[t,a]=Object(s.useState)(e);return[t,e=>{a({...t,...e})}]}({jobGroups:t&&t.groups||e.config.groups}),[u,b]=Object(s.useState)({}),d=Object(S.a)((e=>Object(v.l)(e)?null:{pattern:!0}),Object(S.c)(F.b));return Object(s.useEffect)((()=>{(()=>{var e;const t=(null!==(e=l.jobGroups)&&void 0!==e?e:[]).map((e=>d(e))).filter((e=>null!==e));b({jobGroups:t,formValid:0===t.length})})()}),[l.jobGroups]),Object(m.jsx)(r.EuiFlyout,{onClose:()=>i(null)},Object(m.jsx)(r.EuiFlyoutHeader,{hasBorder:!0},Object(m.jsx)(r.EuiTitle,{size:"m"},Object(m.jsx)("h2",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.overrideConfigurationHeader",defaultMessage:"Override configuration for {jobID}",values:{jobID:e.id}})))),Object(m.jsx)(r.EuiFlyoutBody,null,Object(m.jsx)(r.EuiSpacer,{size:"m"}),Object(m.jsx)(r.EuiForm,null,Object(m.jsx)(r.EuiFormRow,{fullWidth:!0},Object(m.jsx)(z.a,{existingGroups:a,selectedGroups:null!==(n=l.jobGroups)&&void 0!==n?n:[],onChange:e=>{c({jobGroups:e})},validation:{valid:!u.jobGroups||0===u.jobGroups.length,message:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobGroupAllowedCharactersDescription",defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})}}))),Object(m.jsx)(r.EuiSpacer,null)),Object(m.jsx)(r.EuiFlyoutFooter,null,Object(m.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiButtonEmpty,{iconType:"cross",onClick:()=>i(null),flush:"left"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.cancelJobOverrideLabel",defaultMessage:"Close"}))),Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)(r.EuiButton,{onClick:()=>(()=>{const t={job_id:e.id,groups:l.jobGroups};i(t)})(),fill:!0,disabled:!u.formValid},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.saveJobOverrideLabel",defaultMessage:"Save"}))))))},M="200px",I=({jobs:e,jobPrefix:t,jobOverrides:a,saveState:n,existingGroupIds:l,onJobOverridesChange:c})=>{const u=n===P.SAVING,[b,d]=Object(s.useState)(null),j=e=>a[e.id],g=null!==b?Object(m.jsx)(k,{job:b,jobOverride:j(b),onClose:e=>{d(null),null!==e&&c(e)},existingGroupIds:l}):null;return Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiTitle,{size:"s"},Object(m.jsx)("h4",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobsTitle",defaultMessage:"Jobs"}))),Object(m.jsx)(r.EuiSpacer,{size:"s"}),n!==P.SAVING&&n!==P.NOT_SAVED&&Object(m.jsx)(r.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1,gutterSize:"s"},Object(m.jsx)(r.EuiFlexItem,{style:{width:M},grow:!1},Object(m.jsx)(r.EuiFlexGroup,{justifyContent:"spaceAround",responsive:!1,gutterSize:"s"},Object(m.jsx)(r.EuiFlexItem,{grow:1},Object(m.jsx)(r.EuiText,{size:"s",textAlign:"center"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobLabel",defaultMessage:"Job"}))),Object(m.jsx)(r.EuiFlexItem,{grow:1},Object(m.jsx)(r.EuiText,{size:"s",textAlign:"center"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.datafeedLabel",defaultMessage:"Datafeed"}))),Object(m.jsx)(r.EuiFlexItem,{grow:1},Object(m.jsx)(r.EuiText,{size:"s",textAlign:"center"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.runningLabel",defaultMessage:"Running"})))))),Object(m.jsx)("ul",null,e.map(((a,s)=>Object(m.jsx)("li",{key:a.id},Object(m.jsx)(r.EuiFlexGroup,null,Object(m.jsx)(r.EuiFlexItem,null,Object(m.jsx)(h,{jobPrefix:t,job:a,jobOverride:j(a),isSaving:u,onEditRequest:()=>d(a)}))),s<e.length-1&&Object(m.jsx)(r.EuiHorizontalRule,{margin:"s"}))))),g)};var J=a(517),D=a(502),A=a(158);const C=({onSubmit:e,onJobPrefixChange:t,saveState:a,jobs:l})=>{const c=Object(J.c)(),{from:u,to:b}=Object(D.a)(c),{selectedDataView:d}=Object(A.b)(),j=Object(s.useMemo)((()=>Object(S.a)(Object(S.e)(/^([a-z0-9]+[a-z0-9\-_]*)?$/),Object(S.c)(F.b-Math.max(...l.map((({id:e})=>e.length)))))),[l]),[g,x]=Object(s.useState)(""),[O,p]=Object(s.useState)(!0),[f,w]=Object(s.useState)(!0),[h,E]=Object(s.useState)({start:u,end:b}),[v,k]=Object(s.useState)(!1),[M,I]=Object(s.useState)({}),C=Object(s.useCallback)((()=>{const e=j(g);I({jobPrefix:e,formValid:!e})}),[g,j]);return Object(s.useEffect)((()=>{C(),t(g)}),[C,g,t]),Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiForm,null,Object(m.jsx)(r.EuiDescribedFormGroup,{title:Object(m.jsx)("h4",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"})),description:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.tooltips.newJobRecognizerJobPrefixTooltip",defaultMessage:"The prefix is added to the beginning of each job ID."})},Object(m.jsx)(r.EuiFormRow,{label:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"}),isInvalid:!!M.jobPrefix,error:Object(m.jsx)(i.a.Fragment,null,M.jobPrefix&&M.jobPrefix.maxLength?Object(m.jsx)("div",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobPrefixInvalidMaxLengthErrorMessage",defaultMessage:"Job ID prefix must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:M.jobPrefix.maxLength.requiredLength}})):null,M.jobPrefix&&M.jobPrefix.pattern&&Object(m.jsx)("div",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobLabelAllowedCharactersDescription",defaultMessage:"Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})))},Object(m.jsx)(r.EuiFieldText,{name:"jobPrefix",value:g,onChange:({target:{value:e}})=>x(e),isInvalid:!!M.jobPrefix,"data-test-subj":"mlJobRecognizerWizardInputJobIdPrefix"}))),Object(m.jsx)(r.EuiSpacer,{size:"l"}),Object(m.jsx)(r.EuiFormRow,null,Object(m.jsx)(r.EuiSwitch,{id:"startDataFeed",name:"startDataFeed",label:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.startDatafeedAfterSaveLabel",defaultMessage:"Start datafeed after save"}),checked:O,onChange:({target:{checked:e}})=>{p(e)}})),Object(m.jsx)(r.EuiFormRow,null,Object(m.jsx)(r.EuiSwitch,{id:"useFullData",name:"useFullData",label:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.useFullDataLabel",defaultMessage:"Use full {dataViewIndexPattern} data",values:{dataViewIndexPattern:d.getIndexPattern()}}),checked:f,onChange:({target:{checked:e}})=>{w(e)}})),!f&&Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiSpacer,{size:"m"}),Object(m.jsx)(z.b,{setTimeRange:E,timeRange:h})),Object(m.jsx)(r.EuiSpacer,{size:"l"}),Object(m.jsx)(r.EuiAccordion,{id:"advancedOptions","aria-label":n.i18n.translate("xpack.ml.newJob.recognize.advancedSettingsAriaLabel",{defaultMessage:"Advanced settings"}),buttonContent:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.advancedLabel",defaultMessage:"Advanced"}),paddingSize:"l","data-test-subj":"mlJobWizardToggleAdvancedSection"},Object(m.jsx)(r.EuiDescribedFormGroup,{title:Object(m.jsx)("h4",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.useDedicatedIndexLabel",defaultMessage:"Use dedicated index"})),description:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.tooltips.newJobDedicatedIndexTooltip",defaultMessage:"Store results in a separate index for this job."})},Object(m.jsx)(r.EuiFormRow,{describedByIds:["ml_aria_label_new_job_dedicated_index"],"data-test-subj":"mlJobWizardAdvancedSection"},Object(m.jsx)(r.EuiSwitch,{id:"useDedicatedIndex",name:"useDedicatedIndex",checked:v,onChange:({target:{checked:e}})=>{k(e)},label:n.i18n.translate("xpack.ml.newJob.recognize.useDedicatedIndexLabel",{defaultMessage:"Use dedicated index"})})))),Object(m.jsx)(r.EuiSpacer,{size:"l"})),Object(m.jsx)(r.EuiTextAlign,{textAlign:"right"},Object(m.jsx)(r.EuiButton,{fill:!0,type:"submit",isLoading:a===P.SAVING,disabled:!M.formValid||a===P.SAVING,onClick:()=>{e({jobPrefix:g,startDatafeedAfterSave:O,useFullIndexData:f,timeRange:h,useDedicatedIndex:v})},"aria-label":n.i18n.translate("xpack.ml.newJob.recognize.createJobButtonAriaLabel",{defaultMessage:"Create job"})},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.createJobButtonLabel",defaultMessage:"Create {numberOfJobs, plural, zero {job} one {job} other {jobs}}",values:{numberOfJobs:l.length}}))))};var y=a(1),T=a(188),L=a(134);let P=function(e){return e[e.NOT_SAVED=0]="NOT_SAVED",e[e.SAVING=1]="SAVING",e[e.SAVED=2]="SAVED",e[e.FAILED=3]="FAILED",e[e.PARTIAL_FAILURE=4]="PARTIAL_FAILURE",e}({});const R=({moduleId:e,existingGroupIds:t})=>{var a;const{services:{notifications:c,mlServices:{mlApiServices:{getTimeFieldRange:p,setupDataRecognizerConfig:w,getDataRecognizerModule:h}}}}=Object(x.d)(),E=Object(x.g)(),[S,v]=Object(s.useState)(""),[F,z]=Object(s.useState)([]),[k,M]=Object(s.useState)({}),[J,D]=Object(s.useState)({}),[A,R]=Object(s.useState)(P.NOT_SAVED),[V,G]=Object(s.useState)(""),[N,_]=Object(s.useState)(t),[B,W]=Object(s.useState)(0),{selectedSavedSearch:U,selectedDataView:q,combinedQuery:H}=Object(g.c)(),Q=U?n.i18n.translate("xpack.ml.newJob.recognize.savedSearchPageTitle",{defaultMessage:"saved search {savedSearchTitle}",values:{savedSearchTitle:null!==(a=U.title)&&void 0!==a?a:""}}):n.i18n.translate("xpack.ml.newJob.recognize.dataViewPageTitle",{defaultMessage:"data view {dataViewName}",values:{dataViewName:q.getName()}}),X=null!==U,Y=null===U?void 0:H,$=Object(s.useCallback)((async()=>{try{const t=await h({moduleId:e});z(t.jobs),D(t.kibana),R(P.NOT_SAVED);const a=[...t.jobs.map((e=>e.config.groups||[]))].flat(),s=[...new Set([...N,...a])].sort();Object(l.isEqual)(s,N)||_(s)}catch(e){console.error(e)}}),[N,h,e]),K=Object(s.useCallback)((async(e,t)=>{if(e){const e=q.getComputedFields().runtimeFields,{start:t,end:a}=await p({index:q.getIndexPattern(),timeFieldName:q.timeFieldName,query:Object(d.a)(H),...Object(b.a)(e)?{runtimeMappings:e}:{}});return{start:t,end:a}}return Promise.resolve(t)}),[H,q,p]);Object(s.useEffect)((()=>{$()}),[$]);const Z=Object(s.useCallback)((async t=>{R(P.SAVING);const{jobPrefix:a,startDatafeedAfterSave:s,useDedicatedIndex:i,useFullIndexData:o,timeRange:r}=t,b=await K(o,r);try{let t=Object.values(k);t=t.length>0?t:null;const o=await w({moduleId:e,prefix:a,query:Y,indexPatternName:q.getIndexPattern(),useDedicatedIndex:i,startDatafeed:s,...null!==t?{jobOverrides:t}:{},...b}),{datafeeds:n,jobs:r,kibana:c}=o;if(z(F.map((e=>({...e,datafeedResult:n.find((({id:t})=>t.endsWith(e.id))),setupResult:r.find((({id:t})=>t===a+e.id))})))),D(Object(l.merge)(J,c)),E){const e=await E.getUrl({page:y.b.ANOMALY_EXPLORER,pageState:{jobIds:r.filter((({success:e})=>e)).map((({id:e})=>e)),timeRange:{from:u()(b.start).format(j.a),to:u()(b.end).format(j.a),mode:"absolute"}}});G(e)}const d=r.reduce(((e,{success:t})=>t?e:e+1),0),g=n.reduce(((e,{awaitingMlNodeAllocation:t})=>!0===t?e+1:e),0);W(g),R(0===d?P.SAVED:d===F.length?P.FAILED:P.PARTIAL_FAILURE)}catch(t){R(P.FAILED);const{toasts:a}=c;a.addError(t,{title:n.i18n.translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningTitle",{defaultMessage:"Error setting up module {moduleId}",values:{moduleId:e}}),toastMessage:n.i18n.translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningDescription",{defaultMessage:"An error occurred trying to create the {count, plural, one {job} other {jobs}} in the module.",values:{count:F.length}})})}}),[q,K,k,F,J,E,e,c,w,Y]),ee=[P.NOT_SAVED,P.SAVING].includes(A);return Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(L.a,null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.newJobFromTitle",defaultMessage:"New job from {pageTitle}",values:{pageTitle:Q}})),X&&Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiCallOut,{title:Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.searchWillBeOverwrittenLabel",defaultMessage:"Search will be overwritten"}),color:"warning",iconType:"warning"},Object(m.jsx)(r.EuiText,{size:"s"},Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.usingSavedSearchDescription",defaultMessage:"Using a saved search will mean the query used in the datafeeds will be different from the default ones we supply in the {moduleId} module.",values:{moduleId:e}}))),Object(m.jsx)(r.EuiSpacer,{size:"l"})),B>0&&Object(m.jsx)(T.a,{jobCount:B}),Object(m.jsx)(r.EuiFlexGroup,{wrap:!0,gutterSize:"m","data-test-subj":"mlPageJobWizard recognizer"},Object(m.jsx)(r.EuiFlexItem,{grow:1},Object(m.jsx)(r.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(m.jsx)(r.EuiTitle,{size:"s"},Object(m.jsx)("h4",null,Object(m.jsx)(o.FormattedMessage,{id:"xpack.ml.newJob.recognize.jobSettingsTitle",defaultMessage:"Job settings"}))),Object(m.jsx)(r.EuiSpacer,{size:"m"}),ee&&Object(m.jsx)(C,{onSubmit:Z,onJobPrefixChange:v,saveState:A,jobs:F}),Object(m.jsx)(O,{saveState:A,resultsUrl:V,onReset:$}))),Object(m.jsx)(r.EuiFlexItem,{grow:2},Object(m.jsx)(r.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object(m.jsx)(I,{jobs:F,jobPrefix:S,saveState:A,existingGroupIds:N,jobOverrides:k,onJobOverridesChange:e=>{if(M({...k,[e.job_id]:e}),void 0!==e.groups){const t=[...new Set([...N,...e.groups])];_(t)}}})),Object.keys(J).length>0&&Object(m.jsx)(i.a.Fragment,null,Object(m.jsx)(r.EuiSpacer,{size:"m"}),Object(m.jsx)(r.EuiPanel,{grow:!1,hasShadow:!1,hasBorder:!0},Object.keys(J).map(((e,t)=>Object(m.jsx)(s.Fragment,{key:e},Object(m.jsx)(f,{objectType:e,kibanaObjects:J[e],isSaving:A===P.SAVING}),t<Object.keys(J).length-1&&Object(m.jsx)(r.EuiSpacer,{size:"s"})))))))),Object(m.jsx)(r.EuiSpacer,{size:"l"}))}}}]);