/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[1,79],{248:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));const s="YYYY-MM-DD HH:mm:ss"},322:function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return a}));var s=o(37);const r=e=>{var t;if(function(e){var t;return e&&void 0!==(null===(t=e.error)||void 0===t?void 0:t.reason)}(e))return{message:null!==(t=e.error.reason)&&void 0!==t?t:"",statusCode:e.status,fullError:e};if(function(e){return"string"==typeof e}(e))return{message:e};if(function(e){return!0===(null==e?void 0:e.isBoom)}(e))return{message:e.output.payload.message,statusCode:e.output.payload.statusCode};if(void 0===(null==e?void 0:e.body)&&(null==e||!e.message))return{message:""};if("string"==typeof e.body)return{message:e.body};if(function(e){return"object"==typeof e.body&&"message"in e.body}(e)){var o,r;if("object"==typeof e.body.attributes&&"string"==typeof(null===(o=e.body.attributes.body)||void 0===o||null===(r=o.error)||void 0===r?void 0:r.reason)){var a,i,n;const t={message:e.body.attributes.body.error.reason,statusCode:e.body.statusCode,fullError:e.body.attributes.body};var d,c,u;return"object"!=typeof e.body.attributes.body.error.caused_by||"string"!=typeof(null===(a=e.body.attributes.body.error.caused_by)||void 0===a?void 0:a.reason)&&"string"!=typeof(null===(i=e.body.attributes.body.error.caused_by)||void 0===i||null===(n=i.caused_by)||void 0===n?void 0:n.reason)||(t.causedBy=(null===(d=e.body.attributes.body.error.caused_by)||void 0===d||null===(c=d.caused_by)||void 0===c?void 0:c.reason)||(null===(u=e.body.attributes.body.error.caused_by)||void 0===u?void 0:u.reason)),Array.isArray(e.body.attributes.body.error.root_cause)&&"object"==typeof e.body.attributes.body.error.root_cause[0]&&Object(s.a)(e.body.attributes.body.error.root_cause[0],["script"])&&(t.causedBy=e.body.attributes.body.error.root_cause[0].script,t.message+=`: '${e.body.attributes.body.error.root_cause[0].script}'`),t}return{message:e.body.message,statusCode:e.body.statusCode}}return function(e){return e&&void 0!==e.message&&"string"==typeof e.message}(e)?{message:e.message}:{message:""}},a=e=>r(e).message},415:function(e,t,o){"use strict";o.d(t,"a",(function(){return n})),o.d(t,"b",(function(){return d})),o.d(t,"c",(function(){return c})),o.d(t,"e",(function(){return u})),o.d(t,"d",(function(){return l}));var s=o(47),r=o.n(s),a=o(25),i=o(248);function n(e){return Object(a.formatDate)(e,"MMMM Do YYYY")}function d(e){return Object(a.formatDate)(e,"MMMM Do YYYY, HH:mm")}function c(e){return Object(a.formatDate)(e,"MMMM Do YYYY, HH:mm:ss")}function u(e){if(!e)return!1;const t=r.a.parse(e.from),o=r.a.parse(e.to);return!!(t&&t.isValid()&&o&&o.isValid())}const l=e=>Object(a.formatDate)(e,i.a)},71:function(e,t,o){"use strict";o.r(t),o.d(t,"toastNotificationServiceProvider",(function(){return d})),o.d(t,"useToastNotificationService",(function(){return u})),o.d(t,"getToastNotificationService",(function(){return c}));var s=o(5),r=o(2),a=o(322);class MLRequestFailure extends Error{constructor(e,t){if(super(e.message),Object.setPrototypeOf(this,new.target.prototype),"string"!=typeof t&&void 0!==t)if("body"in t)this.stack=JSON.stringify(t.body,null,2);else try{this.stack=JSON.stringify(t,null,2)}catch(e){}}}var i=o(17),n=o(10);function d(e){return{displayDangerToast:function(t,o){e.addDanger(t,o)},displayWarningToast:function(t,o){e.addWarning(t,o)},displaySuccessToast:function(t,o){e.addSuccess(t,o)},displayErrorToast:function(t,o,r){const i=Object(a.b)(t);e.addError(new MLRequestFailure(i,t),{title:null!=o?o:s.i18n.translate("xpack.ml.toastNotificationService.errorTitle",{defaultMessage:"An error has occurred"}),...r?{toastLifeTimeMs:r}:{}})}}}function c(){return d(Object(i.f)())}function u(){const{toasts:e}=Object(n.i)();return Object(r.useMemo)((()=>d(e)),[])}},73:function(e,t,o){"use strict";o.r(t),o.d(t,"mlJobService",(function(){return j})),o.d(t,"mlJobServiceFactory",(function(){return m}));var s=o(4),r=o.n(s),a=o(8),i=o(39),n=o.n(i),d=o(415),c=o(248),u=o(40);var l=o(11),b=o(71);let f=[],g={};class job_service_JobService{constructor(e,t){r()(this,"loadJobsWrapper",(()=>this.loadJobs().then((function(e){return e})).catch((function(e){console.log("Error loading jobs in route resolve.",e),Promise.resolve([])})))),this.toastNotificationService=e,this.ml=t,this.tempJobCloningObjects={createdBy:void 0,datafeed:void 0,job:void 0,skipTimeRangeStep:!1,start:void 0,end:void 0,calendars:void 0,autoSetTimeRange:!1},this.jobs=[],this.basicJobs={},this.jobDescriptions={},this.detectorsByJob={},this.customUrlsByJob={}}getMl(){var e;return null!==(e=this.ml)&&void 0!==e?e:l.ml}getToastNotificationService(){var e;return null!==(e=this.toastNotificationService)&&void 0!==e?e:Object(b.getToastNotificationService)()}loadJobs(){return new Promise(((e,t)=>{function o(e){console.log("jobService error getting list of jobs:",e),this.getToastNotificationService().displayErrorToast(e),t({jobs:f,err:e})}f=[],g={},this.getMl().getJobs().then((t=>{f=t.jobs,this.getMl().getJobStats().then((t=>{for(let e=0;e<f.length;e++){const o=f[e];o.data_counts={},o.model_size_stats={},o.datafeed_config={};for(let e=0;e<t.jobs.length;e++){const s=t.jobs[e];o.job_id===s.job_id&&(o.state=s.state,o.data_counts=Object(a.cloneDeep)(s.data_counts),o.model_size_stats=Object(a.cloneDeep)(s.model_size_stats),s.node&&(o.node=Object(a.cloneDeep)(s.node)),s.open_time&&(o.open_time=s.open_time))}}this.loadDatafeeds().then((t=>{for(let e=0;e<f.length;e++)for(let o=0;o<t.datafeeds.length;o++)f[e].job_id===t.datafeeds[o].job_id&&(f[e].datafeed_config=t.datafeeds[o],g[f[e].job_id]=t.datafeeds[o].datafeed_id);!function(e,t){const o=[],s={},r={},i=Object(a.cloneDeep)(t);Object(a.each)(i,(t=>{const i=t.analysis_config,n=Object(u.a)(i.bucket_span),d={id:t.job_id,bucketSpanSeconds:n.asSeconds()};void 0!==t.description&&!1===/^\s*$/.test(t.description)?d.description=t.description:d.description=t.job_id,d.detectors=Object(a.get)(i,"detectors",[]),s[d.id]=d.detectors,void 0!==t.custom_settings&&void 0!==t.custom_settings.custom_urls&&(d.customUrls=[],Object(a.each)(t.custom_settings.custom_urls,(e=>{void 0!==e.url_name&&void 0!==e.url_value&&function(e){const t=function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.href}(e);return/^https?:\/\//.test(t)}(e.url_value)&&d.customUrls.push(e)})),d.customUrls.length>0&&(r[d.id]=d.customUrls)),e.jobDescriptions[d.id]=d.description,e.basicJobs[d.id]=d,o.push(d)})),e.detectorsByJob=s,e.customUrlsByJob=r}(this,f),this.jobs=f,e({jobs:this.jobs})}))})).catch((e=>{o(e)}))})).catch((e=>{o(e)}))}))}refreshJob(e){return new Promise(((t,o)=>{function s(e){console.log("JobService error getting list of jobs:",e),this.getToastNotificationService().displayErrorToast(e),o({jobs:f,err:e})}this.getMl().getJobs({jobId:e}).then((o=>{if(o.jobs&&o.jobs.length){const r=o.jobs[0];this.getMl().getJobStats({jobId:e}).then((o=>{for(let e=0;e<o.jobs.length;e++)if(r.job_id===o.jobs[e].job_id){const t=o.jobs[e];r.state=t.state,r.data_counts={},r.model_size_stats={},r.data_counts=Object(a.cloneDeep)(t.data_counts),r.model_size_stats=Object(a.cloneDeep)(t.model_size_stats),r.node&&(r.node=Object(a.cloneDeep)(t.node)),t.open_time&&(r.open_time=t.open_time)}for(let e=0;e<f.length;e++)f[e].job_id===r.job_id&&(f[e]=r);const s=this.getDatafeedId(e);this.loadDatafeeds(s).then((e=>{for(let t=0;t<f.length;t++)for(let o=0;o<e.datafeeds.length;o++)f[t].job_id===e.datafeeds[o].job_id&&(f[t].datafeed_config=e.datafeeds[o],g[f[t].job_id]=e.datafeeds[o].datafeed_id);this.jobs=f,t({jobs:this.jobs})}))})).catch((e=>{s(e)}))}})).catch((e=>{s(e)}))}))}loadDatafeeds(e){return new Promise(((t,o)=>{const s=void 0!==e?{datafeed_id:e}:void 0;function r(e){console.log("loadDatafeeds error getting list of datafeeds:",e),this.getToastNotificationService().displayErrorToast(e),o({jobs:f,err:e})}this.getMl().getDatafeeds(s).then((e=>{const o=e.datafeeds;this.getMl().getDatafeedStats().then((e=>{for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<e.datafeeds.length;t++)s.datafeed_id===e.datafeeds[t].datafeed_id&&(s.state=e.datafeeds[t].state)}t({datafeeds:o})})).catch((e=>{r(e)}))})).catch((e=>{r(e)}))}))}updateSingleJobDatafeedState(e){return new Promise(((t,o)=>{const s=this.getDatafeedId(e);this.getMl().getDatafeedStats({datafeedId:s}).then((e=>{const o=e.datafeeds;let s="UNKNOWN";o&&o.length&&(s=o[0].state),t(s)})).catch((e=>{o(e)}))}))}saveNewJob(e){function t(t){console.log("Response for job query:",t);const o=function(e,t){if(!e)return console.log("checkSaveResponse(): response is empty"),!1;if(e.job_id){if(e.job_id===t.job_id)return console.log("checkSaveResponse(): save successful"),!0}else if(e.errorCode)return console.log("checkSaveResponse(): save failed",e),!1}(t,e);return{success:o,job:e,resp:t}}return this.getMl().addJob({jobId:e.job_id,job:e}).then(t).catch(t)}cloneDatafeed(e){const t=Object(a.cloneDeep)(e);return t&&(delete t.datafeed_id,delete t.job_id),t}getJob(e){return Object(a.find)(f,(t=>t.job_id===e))}openJob(e){return this.getMl().openJob({jobId:e})}closeJob(e){return this.getMl().closeJob({jobId:e})}saveNewDatafeed(e,t){const o=`datafeed-${t}`;return e.job_id=t,this.getMl().addDatafeed({datafeedId:o,datafeedConfig:e})}startDatafeed(e,t,o,s){return new Promise(((t,r)=>{Object(a.isNumber)(s)&&s++,this.getMl().startDatafeed({datafeedId:e,start:o,end:s}).then((e=>{t(e)})).catch((e=>{console.log("jobService error starting datafeed:",e),r(e)}))}))}forceStartDatafeeds(e,t,o){return this.getMl().jobs.forceStartDatafeeds(e,t,o)}stopDatafeeds(e){return this.getMl().jobs.stopDatafeeds(e)}deleteJobs(e,t,o){return this.getMl().jobs.deleteJobs(e,t,o)}closeJobs(e){return this.getMl().jobs.closeJobs(e)}resetJobs(e,t){return this.getMl().jobs.resetJobs(e,t)}validateDetector(e){return new Promise(((t,o)=>{e?this.getMl().validateDetector({detector:e}).then((e=>{t(e)})).catch((e=>{o(e)})):o({})}))}getDatafeedId(e){let t=g[e];return void 0===t&&(t=`datafeed-${e}`),t}getJobGroups(){const e=[],t={};return this.jobs.forEach((e=>{Array.isArray(e.groups)&&e.groups.forEach((o=>{void 0===t[o]?t[o]=[e]:t[o].push(e)}))})),Object(a.each)(t,((t,o)=>{e.push({id:o,jobs:t})})),e}createResultsUrlForJobs(e,t,o){return function(e,t,o){let s,r,a="absolute";const i=e.map((e=>e.id));if(Object(d.e)(o)){s=o.from,r=o.to;const e=n()(o.from).isValid(),a=n()(o.to).isValid();if(!e&&!a)return h(i,s,r,t,"quick")}else if(o&&(a="invalid"),1===e.length)s=e[0].earliestTimestampMs,r=e[0].latestResultsTimestampMs;else{const t=e.filter((e=>void 0!==e.earliestTimestampMs));t.length>0&&(s=Math.min(...t.map((e=>e.earliestTimestampMs))),r=Math.max(...t.map((e=>e.latestResultsTimestampMs))))}return h(i,n()(s).format(c.a),n()(r).format(c.a),t,a)}(e,t,o)}createResultsUrl(e,t,o,s){return h(e,t,o,s)}async getJobAndGroupIds(){try{return await this.getMl().jobs.getAllJobAndGroupIds()}catch(e){return{jobIds:[],groupIds:[]}}}}function h(e,t,o,s,r="absolute"){const a=e.map((e=>`'${e}'`)).join(",");let i,d,c="";return void 0!==s&&(c+=s),"quick"===r?(i=t,d=o):(i=n()(t).toISOString(),d=n()(o).toISOString()),c+=`?_g=(ml:(jobIds:!(${a}))`,c+=`,refreshInterval:(display:Off,pause:!t,value:0),time:(from:'${i}'`,c+=`,to:'${d}'`,"invalid"===r&&(c+=",mode:invalid"),c+="))&_a=(query:(query_string:(analyze_wildcard:!t,query:'*')))",c}const j=new job_service_JobService,m=(e,t)=>new job_service_JobService(e,t)}}]);