/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[13],{157:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(2),s=i(328),o=i(246),a=i(226),r=i(6);const c=()=>{const{setIsFlyoutVisible:e,setFieldName:t,populatedFields:i}=Object(o.c)(),c=Object(n.useCallback)((()=>e(!1)),[e]),l=Object(n.useCallback)((i=>{"string"==typeof i.id&&(t(i.id),e(!0))}),[t,e]);return{renderOption:Object(n.useCallback)(((e,t)=>{const n=e.field;return e.isGroupLabelOption||!n?e.label:Object(r.jsx)(a.a,{isEmpty:i&&!i.has(n.id),field:n,label:e.label,onButtonClick:l})}),[l,null==i?void 0:i.size]),setIsFlyoutVisible:e,setFieldName:t,handleFieldStatsButtonClick:l,closeFlyout:c,optionCss:s.b,populatedFields:i}}},217:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var n=i(2);const s=Object(n.createContext)({isFlyoutVisible:!1,setIsFlyoutVisible:()=>{},toggleFlyoutVisible:()=>{},setFieldName:()=>{},setFieldValue:()=>{},timeRangeMs:void 0,populatedFields:void 0});function o(){return Object(n.useContext)(s)}},226:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var n=i(6),s=i(25),o=i(5),a=(i(2),i(120)),r=i.n(a),c=i(87),l=i.n(c);const u={iconType:"questionInCircle",color:"gray"},d={binary:{iconType:"tokenBinary"},boolean:{iconType:"tokenBoolean"},conflict:{iconType:"warning",color:"euiColorVis9",shape:"square"},date:{iconType:"tokenDate"},date_range:{iconType:"tokenDate"},dense_vector:{iconType:"tokenVectorDense"},geo_point:{iconType:"tokenGeo"},geo_shape:{iconType:"tokenGeo"},ip:{iconType:"tokenIP"},ip_range:{iconType:"tokenIP"},flattened:{iconType:"tokenFlattened"},match_only_text:{iconType:"tokenString"},murmur3:{iconType:"tokenSearchType"},number:{iconType:"tokenNumber"},number_range:{iconType:"tokenNumber"},rank_feature:{iconType:"tokenRankFeature"},rank_features:{iconType:"tokenRankFeatures"},histogram:{iconType:"tokenHistogram"},_source:{iconType:"editorCodeBlock",color:"gray"},point:{iconType:"tokenShape"},shape:{iconType:"tokenShape"},sparse_vector:{iconType:"tokenVectorSparse"},string:{iconType:"tokenString"},text:{iconType:"tokenString"},keyword:{iconType:"tokenKeyword"},gauge:{iconType:"tokenMetricGauge"},counter:{iconType:"tokenMetricCounter"},nested:{iconType:"tokenNested"},version:{iconType:"tokenTag"}};function p({type:e,label:t,size:i="s",scripted:o,className:a,...c}){const p=d[e]||u;return Object(n.jsx)(s.EuiToken,r()({},p,{className:l()("kbnFieldIcon",a),"aria-label":t||e,title:t||e,size:i,fill:o?"dark":void 0},c))}var b=i(10),m=i(131);function j(e){switch(e){case m.a.FLOAT:case m.a.HALF_FLOAT:case m.a.SCALED_FLOAT:case m.a.DOUBLE:case m.a.INTEGER:case m.a.LONG:case m.a.SHORT:case m.a.UNSIGNED_LONG:return"number";case m.a.DATE:case m.a.DATE_NANOS:return"date";default:return e}}const f=({field:e,label:t,onButtonClick:i,disabled:a,isEmpty:r=!1,hideTrigger:c=!1})=>{const l=Object(b.a)(),u=r?" "+o.i18n.translate("xpack.ml.newJob.wizard.fieldContextPopover.emptyFieldInSampleDocsMsg",{defaultMessage:"(no data found in 1000 sample records)"}):"";return Object(n.jsx)(s.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(n.jsx)(s.EuiFlexItem,{grow:!1},c?null:Object(n.jsx)(s.EuiToolTip,{content:o.i18n.translate("xpack.ml.newJob.wizard.fieldContextPopover.inspectFieldStatsTooltip",{defaultMessage:"Inspect field statistics"})+u},Object(n.jsx)(s.EuiButtonIcon,{"data-test-subj":`mlInspectFieldStatsButton-${e.id}`,disabled:!0===a,size:"xs",iconType:"inspect",css:Object(n.css)({color:r?l.euiTheme.euiColorDisabled:void 0},"",""),onClick:t=>{"click"===t.type&&t.currentTarget.focus(),t.preventDefault(),t.stopPropagation(),i&&i(e)},"aria-label":o.i18n.translate("xpack.ml.newJob.wizard.fieldContextPopover.inspectFieldStatsTooltipAriaLabel",{defaultMessage:"Inspect field statistics"})+u}))),Object(n.jsx)(s.EuiFlexItem,{grow:!1,css:Object(n.css)({paddingRight:l.euiTheme.euiSizeXS,paddingBottom:l.euiTheme.euiSizeXS},"","")},Object(n.jsx)(p,{color:r?l.euiTheme.euiColorDisabled:void 0,type:j(e.type),fill:"none"})),Object(n.jsx)(s.EuiText,{color:r?"subdued":void 0,size:"s","aria-label":t,title:t,className:"euiComboBoxOption__content",css:Object(n.css)({paddingBottom:l.euiTheme.euiSizeXS},"","")},t))}},246:function(e,t,i){"use strict";i(329),i(400);var n=i(313);i.d(t,"b",(function(){return n.a}));var s=i(217);i.d(t,"c",(function(){return s.b})),i(226);var o=i(157);i.d(t,"d",(function(){return o.a}));var a=i(328);i.d(t,"a",(function(){return a.a}))},313:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var n=i(2),s=i(229),o=i(203),a=i(7),r=i(37),c=i(8);const l={bool:{must:[{match_all:{}}]}};var u=i(10),d=i(329),p=i(217),b=i(4),m=i.n(b);class populated_fields_cache_manager_PopulatedFieldsCacheManager{constructor(e=6e4){m()(this,"_resultsCache",new Map),m()(this,"_lastUpdatedTimestamps",new Map),this._expirationDurationMs=e}clearOldCacheIfNeeded(){this._resultsCache.size>10&&(this._resultsCache.clear(),this._lastUpdatedTimestamps.clear())}clearExpiredCache(e){const t=this._lastUpdatedTimestamps.get(e),i=Date.now();void 0!==t&&t-i>this._expirationDurationMs&&this._resultsCache.delete(e)}get(e){return this._resultsCache.get(e)}set(e,t){this.clearExpiredCache(e),this.clearOldCacheIfNeeded(),this._resultsCache.set(e,Date.now()),this._resultsCache.set(e,t)}}var j=i(6);const f=({dataView:e,fieldStatsServices:t,timeRangeMs:i,dslQuery:b,disablePopulatedFields:m=!1,children:f})=>{const{services:{data:{search:y}}}=Object(u.d)(),[O,g]=Object(n.useState)(!1),[h,x]=Object(n.useState)(),[F,T]=Object(n.useState)(),S=Object(n.useCallback)((()=>g(!O)),[O]),[k]=Object(n.useState)(new populated_fields_cache_manager_PopulatedFieldsCacheManager),[_,C]=Object(n.useState)(),v=Object(n.useRef)(new AbortController);return Object(n.useEffect)((function(){var t;if(m)return;let n=!1;v.current&&(v.current.abort(),v.current=new AbortController);const u=(({runtimeFields:e,searchQuery:t,datetimeField:i,timeRange:n})=>{let s;n&&void 0!==i&&Object(r.a)(n,["from","to"])&&n.to>n.from&&(s={range:{[i]:{gte:n.from,lte:n.to,format:"epoch_millis"}}});const o=Object(c.cloneDeep)(!t||Object(r.a)(t,["match_all"])?Object(c.cloneDeep)(l):t);s&&Object(r.a)(o,["bool"])&&(Array.isArray(o.bool.filter)?o.bool.filter.push(s):o.bool.filter=[s]);const a={query:{function_score:{query:o,random_score:{}}}};return e&&(a.runtime_mappings=e),a})({searchQuery:b,runtimeFields:e.getRuntimeMappings(),datetimeField:null===(t=e.getTimeField())||void 0===t?void 0:t.name,timeRange:i}),d={index:e.getIndexPattern(),body:{fields:["*"],_source:!1,...u,size:500}},p=Object(o.a)(JSON.stringify(d)).toString();return k.get(p)||(async function(){try{const e=(await Object(a.lastValueFrom)(y.search({params:d},{abortSignal:v.current.signal}))).rawResponse.hits.hits.map((e=>{var t;return Object(s.l)(null!==(t=e.fields)&&void 0!==t?t:{})})),t=new Set(e.map(Object.keys).flat(1));k.set(p,t),n||C(t)}catch(e){"AbortError"!==e.name&&console.error(`An error occurred fetching sample documents to determine populated field stats.\n          \nQuery:\n${JSON.stringify(d)}\n          \nError:${e}`)}}(),()=>{n=!0,v.current.abort()})}),[JSON.stringify({dslQuery:b,dataViewId:e.id,timeRangeMs:i})]),Object(j.jsx)(p.a.Provider,{value:{isFlyoutVisible:O,setIsFlyoutVisible:g,toggleFlyoutVisible:S,setFieldName:x,fieldName:h,setFieldValue:T,fieldValue:F,timeRangeMs:i,populatedFields:_}},Object(j.jsx)(d.a,{dataView:e,fieldStatsServices:t,timeRangeMs:i,dslQuery:b}),f)}},328:function(e,t,i){"use strict";i.d(t,"b",(function(){return l})),i.d(t,"a",(function(){return u}));var n=i(120),s=i.n(n),o=i(2),a=i(25),r=i(6),c=i(157);const l={name:"1ypf5f3",styles:".euiComboBoxOption__enterBadge{display:none;}.euiFlexGroup{gap:0px;}.euiComboBoxOption__content{margin-left:2px;}"},u=({options:e,...t})=>{const{renderOption:i}=Object(c.a)(),n=Object(o.useMemo)((()=>Array.isArray(e)?e.map((e=>({...e,css:l}))):[]),[e]);return Object(r.jsx)(a.EuiComboBox,s()({},t,{options:n,renderOption:i,singleSelection:{asPlainText:!0}}))}},329:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i(2),s=i(15),o=i(25),a=i(6),r=i(217),c=i(400),l={name:"18ji2p4",styles:"width:300px"};const u=({dataView:e,fieldStatsServices:t,timeRangeMs:i,dslQuery:u})=>{const{setIsFlyoutVisible:d,isFlyoutVisible:p,fieldName:b}=Object(r.b)(),m=Object(n.useCallback)((()=>d(!1)),[]),j=Object(o.useGeneratedHtmlId)({prefix:"mlJobCreationWizardFieldStats"});return p?Object(a.jsx)(o.EuiFlyout,{type:"push",size:"xs",onClose:m,"aria-labelledby":j,"data-test-subj":"mlFieldStatsFlyout"},Object(a.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(a.jsx)(o.EuiTitle,{size:"m"},Object(a.jsx)("h3",{id:j},Object(a.jsx)(s.FormattedMessage,{id:"xpack.ml.newJob.wizard.fieldContextFlyoutTitle",defaultMessage:"Field statistics"})))),Object(a.jsx)(o.EuiFlyoutBody,{css:l},Object(a.jsx)("b",null,b),Object(a.jsx)(o.EuiSpacer,null),Object(a.jsx)(c.a,{dataView:e,fieldStatsServices:t,timeRangeMs:i,dslQuery:u})),Object(a.jsx)(o.EuiFlyoutFooter,null,Object(a.jsx)(o.EuiButton,{onClick:m},Object(a.jsx)(s.FormattedMessage,{id:"xpack.ml.newJob.wizard.fieldContextFlyoutCloseButton",defaultMessage:"Close"})))):null}},400:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var n=i(2),s=i.n(n),o=i(6);const a=()=>Object(o.jsx)(n.Fragment,null),r=s.a.lazy((()=>Promise.all([i.e(36),i.e(74)]).then(i.bind(null,867)))),c=e=>Object(o.jsx)(s.a.Suspense,{fallback:Object(o.jsx)(a,null)},Object(o.jsx)(r,e));var l=i(67),u=i(39),d=i.n(u),p=i(25),b=i(147),m=i(217);const j=Object(b.c)(),f=Object(p.euiPaletteColorBlind)()[0],y=({dataView:e,fieldStatsServices:t,timeRangeMs:i,dslQuery:s})=>{const{fieldName:a}=Object(m.b)(),r=Object(n.useMemo)((()=>{if(i)return{from:d()(i.from).toISOString(),to:d()(i.to).toISOString()};const e=d()();return{from:e.toISOString(),to:e.toISOString()}}),[i]),u=Object(n.useMemo)((()=>Object(l.a)(a)?e.getFieldByName(a):void 0),[a,e]);return r&&Object(l.a)(e)&&u?Object(o.jsx)(c,{key:u.name,services:t,dslQuery:null!=s?s:j,fromDate:r.from,toDate:r.to,dataViewOrDataViewId:e,field:u,"data-test-subj":`mlFieldStatsFlyoutContent ${u.name}`,color:f}):null}}}]);