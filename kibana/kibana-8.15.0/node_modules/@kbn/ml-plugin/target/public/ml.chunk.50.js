/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[50],{138:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);t.default=function(){var e=i.useRef(!1),t=i.useCallback((function(){return e.current}),[]);return i.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},160:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(26),s=n.n(i),l=n(7),a=n(2),o=n(517),r=n(417),d=n(153);const c=()=>{const e=Object(o.c)(),t=()=>{const{from:t,to:n}=e.getTime();return{start:t,end:n}},n=Object(a.useMemo)((()=>Object(l.merge)(r.a,e.getTimeUpdate$().pipe(Object(l.map)((()=>({lastRefresh:Date.now(),timeRange:t()})))),d.b.pipe(Object(l.map)((e=>({lastRefresh:e})))))),[]);return s()(n)}},167:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(116);const s=Object(i.a)((async()=>({default:(await n.e(96).then(n.bind(null,230))).JobSpacesSyncFlyout})))},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(2),s=n.n(i),l=n(25),a=n(15),o=n(10),r=n(167),d=n(70),c=n(6);const u=({mlSavedObjectType:e,onCloseFlyout:t,forceRefresh:n})=>{const{savedObjects:{syncCheck:u}}=Object(o.c)(),p=Object(i.useRef)(!1),[m,j]=Object(i.useState)(!1),[b,x]=Object(i.useState)(!1),[f,g,O]=Object(d.usePermissionCheck)(["canCreateJob","canCreateDataFrameAnalytics","canCreateTrainedModels"]),h=Object(i.useMemo)((()=>f||g||O),[g,f,O]),M=Object(i.useCallback)((async()=>{try{if(!1===p.current)return;const{result:t}=await u(e);!0===p.current&&j(b||t)}catch(e){console.log("Saved object synchronization check could not be performed.")}}),[b,j]);Object(i.useEffect)((function(){return p.current=!0,void 0!==n&&!0!==n||M(),()=>{p.current=!1}}),[n,p,M]);const v=Object(i.useCallback)((()=>{x(!1),void 0===n&&M(),"function"==typeof t&&t()}),[M,t,x]);return Object(i.useEffect)((function(){!1===m&&!0===p.current&&x(!1)}),[m,x]),!1===m?null:Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(l.EuiCallOut,{title:Object(c.jsx)(a.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.title",defaultMessage:"ML job and trained model synchronization required"}),color:"warning",iconType:"warning","data-test-subj":"mlJobSyncRequiredWarning"},Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(a.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.description",defaultMessage:"Some jobs or trained models are missing or have incomplete saved objects. "}),h?Object(c.jsx)(a.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.link",defaultMessage:" {link}",values:{link:Object(c.jsx)(l.EuiLink,{onClick:x.bind(null,!0)},Object(c.jsx)(a.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.linkToManagement.link",defaultMessage:"Synchronize your jobs and trained models."}))}}):Object(c.jsx)(a.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.noPermission",defaultMessage:"An Administrator can synchronize the jobs and trained models in Stack Management."}),b&&Object(c.jsx)(r.a,{onClose:v}))),Object(c.jsx)(l.EuiSpacer,{size:"m"}))}},182:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(25),s=n(15),l=n(2),a=n.n(l),o=n(6);const r=({jobsCount:e,action:t,message:n})=>Object(o.jsx)(a.a.Fragment,null,Object(o.jsx)(i.EuiSpacer,{size:"s"}),Object(o.jsx)(i.EuiCallOut,{color:"warning"},null!=n?n:Object(o.jsx)(s.FormattedMessage,{id:"xpack.ml.managedJobsWarningCallout",defaultMessage:"{jobsCount, plural, one {This job} other {At least one of these jobs}} is preconfigured by Elastic; {action} {jobsCount, plural, one {it} other {them}} might impact other parts of the product.",values:{jobsCount:e,action:t}})))},190:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return r})),n(2);var i=n(104),s=n(90),l=n(92),a=n(6);const{expandLiteralStrings:o}=l.XJson,r={TEXT:"text",JSON:"json",XJSON:i.XJsonLang.ID},d=({value:e,height:t="500px",width:n="100%",mode:l=r.JSON,readOnly:d=!1,onChange:c=(()=>{}),"data-test-subj":u,schema:p})=>{if(l===r.XJSON)try{e=o(e)}catch(e){console.error(e)}return Object(a.jsx)(s.CodeEditor,{languageId:l,options:{readOnly:d},value:e,width:n,height:t,onChange:c,"data-test-subj":u,editorDidMount:e=>{var t;const n=null===(t=e.getModel())||void 0===t?void 0:t.uri.toString();var s;p&&i.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,enableSchemaRequest:!1,schemaValidation:"error",schemas:[...null!==(s=i.monaco.languages.json.jsonDefaults.diagnosticsOptions.schemas)&&void 0!==s?s:[],{uri:n,fileMatch:[n],schema:p}]})}})}},227:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(6),s=(n(2),n(25));const l=({stat:e})=>{const{euiTheme:t}=Object(s.useEuiTheme)();return Object(i.jsx)("span",{css:Object(i.css)({marginRight:t.size.s},"","")},Object(i.jsx)("span",null,e.label),":"," ",Object(i.jsx)("strong",null,Object(i.jsx)("span",{"data-test-subj":`mlStatsBarStat ${e.label.toLowerCase()} value`},e.value)))},a=({stats:e,dataTestSub:t})=>{const{euiTheme:n}=Object(s.useEuiTheme)(),a=Object.keys(e).map((t=>e[t]));return Object(i.jsx)("div",{css:Object(i.css)({padding:n.size.m,backgroundColor:n.colors.lightestShade},"",""),"data-test-subj":t},a.filter((e=>e.show)).map((e=>Object(i.jsx)(l,{key:e.label,stat:e}))))}},245:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var i=n(2),s=n.n(i),l=n(15),a=n(5),o=n(25),r=n(172),d=n.n(r),c=n(10),u=n(71),p=n(182),m=n(6);const j=a.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.job",{defaultMessage:"Remove job from current space"}),b=a.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.model",{defaultMessage:"Remove model from current space"}),x=({canDeleteCallback:e,onCloseCallback:t,refreshJobsCallback:n,mlSavedObjectType:r,ids:x,setDidUntag:f,hasManagedJob:g})=>{const[O,h]=Object(i.useState)(),[M,v]=Object(i.useState)(),[y,E]=Object(i.useState)(!1),[T,I]=Object(i.useState)(!1),[F,k]=Object(i.useState)(!1),[S,C]=Object(i.useState)(),[_,w]=Object(i.useState)(!1),{savedObjects:{canDeleteMLSpaceAwareItems:L,removeItemFromCurrentSpace:D}}=Object(c.c)(),{displayErrorToast:P,displaySuccessToast:A}=Object(u.useToastNotificationService)();d()((()=>w(!0)),1e3),Object(i.useEffect)((()=>{k(!0),L(r,x).then((t=>{const n=function(e){const t=Object.keys(e),{canDelete:n,canRemoveFromSpace:i}=e[t[0]];let s=!0;return t.length>1&&(s=t.every((t=>e[t].canDelete===n&&e[t].canRemoveFromSpace===i))),{canDelete:n,canRemoveFromSpace:i,canTakeAnyAction:s}}(t),{canDelete:i,canRemoveFromSpace:d,canTakeAnyAction:c}=n;if(c&&i&&!d)return void e();C(n);const{buttonText:u,modalText:j}=function(e,t,n,i){const{canDelete:r,canRemoveFromSpace:d,canTakeAnyAction:c}=n;if(!1===c)return{buttonText:Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextNoAction",defaultMessage:"Close"}),modalText:Object(m.jsx)(o.EuiText,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction",defaultMessage:"{ids} have different space permissions. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.model",defaultMessage:"When you delete multiple models, they must have the same permissions. Deselect the models and try deleting each model individually."}):Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.job",defaultMessage:"When you delete multiple jobs, they must have the same permissions. Deselect the jobs and try deleting each job individually."}))};const u={buttonText:Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextClose",defaultMessage:"Close"}),modalText:Object(m.jsx)(o.EuiText,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose",defaultMessage:"{ids} cannot be deleted and cannot be removed from the current space. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.model",defaultMessage:"This model is assigned to the * space and you do not have access to all spaces."}):Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.job",defaultMessage:"This job is assigned to the * space and you do not have access to all spaces."}))};return r?{buttonText:"trained-model"===t?Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.model",defaultMessage:"Continue to delete {length, plural, one {# model} other {# models}}",values:{length:e.length}}):Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.job",defaultMessage:"Continue to delete {length, plural, one {# job} other {# jobs}}",values:{length:e.length}}),modalText:Object(m.jsx)(s.a.Fragment,null,i?Object(m.jsx)(s.a.Fragment,null,Object(m.jsx)(p.a,{jobsCount:e.length,action:a.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeOrDeleteAction",{defaultMessage:"removing or deleting"})}),Object(m.jsx)(o.EuiSpacer,{size:"s"})):null,Object(m.jsx)(o.EuiText,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanDelete",defaultMessage:"{ids} can be deleted.",values:{ids:e.join(", ")}})))}:d?{buttonText:Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanUnTagConfirm",defaultMessage:"Remove from current space"}),modalText:Object(m.jsx)(s.a.Fragment,null,i?Object(m.jsx)(s.a.Fragment,null,Object(m.jsx)(p.a,{jobsCount:e.length,action:a.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeAction",{defaultMessage:"removing"})}),Object(m.jsx)(o.EuiSpacer,{size:"s"})):null,Object(m.jsx)(o.EuiText,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanUnTag",defaultMessage:"{ids} cannot be deleted but can be removed from the current space.",values:{ids:e.join(", ")}})))}:u}(x,r,n,g);h(u),v(j),k(!1)})),"function"==typeof f&&f(!1)}),[g]);const N=async()=>{I(!0);const e=await D(r,x);I(!1),"function"==typeof f&&f(!0),Object.entries(e).forEach((([e,{success:t,error:n}])=>{if(!1===t){const t=a.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagErrorTitle",{defaultMessage:"Error updating {id}",values:{id:e}});P(n,t)}else{E(!0);const t=a.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagSuccessTitle",{defaultMessage:"Successfully updated {id}",values:{id:e}});A(t)}})),t(),"function"==typeof n&&n()};return!1===_?null:Object(m.jsx)(o.EuiModal,{onClose:t,"data-test-subj":"mlDeleteSpaceAwareItemCheckModalOverlay"},Object(m.jsx)(s.a.Fragment,null,Object(m.jsx)(o.EuiModalHeader,null,Object(m.jsx)(o.EuiModalHeaderTitle,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTitle",defaultMessage:"Checking space permissions"}))),!1===F?Object(m.jsx)(s.a.Fragment,null,Object(m.jsx)(o.EuiModalBody,null,M),Object(m.jsx)(o.EuiModalFooter,null,Object(m.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(m.jsx)(o.EuiFlexItem,{grow:!1},!y&&(null==S?void 0:S.canTakeAnyAction)&&(null==S?void 0:S.canRemoveFromSpace)&&(null==S?void 0:S.canDelete)&&Object(m.jsx)(o.EuiButtonEmpty,{isLoading:T,color:"primary",size:"s",onClick:N},"trained-model"===r?b:j)),Object(m.jsx)(o.EuiFlexItem,{grow:!1},Object(m.jsx)(o.EuiButton,{"data-test-subj":"mlDeleteSpaceAwareItemCheckModalOverlayCloseButton",size:"s",onClick:null==S||!S.canTakeAnyAction||null==S||!S.canRemoveFromSpace||null!=S&&S.canDelete?async()=>{null!=S&&S.canTakeAnyAction&&null!=S&&S.canDelete?e():t()}:N,fill:!0},O))))):Object(m.jsx)(o.EuiModalBody,null,Object(m.jsx)(o.EuiText,null,Object(m.jsx)(l.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalDesc",defaultMessage:"Checking to see whether the {jobCount, plural, one {job} other {jobs}} can be deleted.",values:{jobCount:x.length}})),Object(m.jsx)(o.EuiSpacer,{size:"s"}))))}},267:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i={id:"model_id",description:"description",createdAt:"create_time",type:"type",modelType:"model_type"}},277:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n(2);var i=n(25),s=n(5),l=n(6);const a=({compressed:e=!1})=>Object(l.jsx)(i.EuiBetaBadge,{label:s.i18n.translate("xpack.ml.navMenu.trainedModelsTabBetaLabel",{defaultMessage:"Technical preview"}),size:e?"s":"m",color:"hollow",tooltipContent:s.i18n.translate("xpack.ml.navMenu.trainedModelsTabBetaTooltipContent",{defaultMessage:"This functionality is in technical preview and may be changed or removed completely in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features."}),tooltipPosition:"right"})},292:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));const i=window;function s(e){return"string"==typeof e&&e===e.toLowerCase()&&/^[^\*\\/\?"<>|\s,#:]+$/.test(e)&&/^[^-_\+]+$/.test(e.charAt(0))&&"."!==e&&".."!==e&&function(e){return!(i.TextEncoder&&new i.TextEncoder("utf-8").encode(e).length>255)&&e.length<=255}(e)}},297:function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"c",(function(){return d})),n.d(t,"j",(function(){return c})),n.d(t,"i",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"f",(function(){return m})),n.d(t,"a",(function(){return j})),n.d(t,"e",(function(){return b})),n.d(t,"d",(function(){return x})),n.d(t,"h",(function(){return f}));var i=n(5);const s=".elser_model_2",l=".elser_model_2_linux-x86_64",a=".multilingual-e5-small",o=".multilingual-e5-small_linux-x86_64",r=".elser_model_1",d={STARTED:"started",STARTING:"starting",STOPPING:"stopping"},c={PYTORCH:"pytorch",TREE_ENSEMBLE:"tree_ensemble",LANG_IDENT:"lang_ident"},u={NER:"ner",QUESTION_ANSWERING:"question_answering",ZERO_SHOT_CLASSIFICATION:"zero_shot_classification",TEXT_CLASSIFICATION:"text_classification",TEXT_EMBEDDING:"text_embedding",FILL_MASK:"fill_mask",TEXT_EXPANSION:"text_expansion"},p=i.i18n.translate("xpack.ml.trainedModels.modelsList.builtInModelLabel",{defaultMessage:"built-in"}),m="elastic",j="prepackaged",b="elastic",x=Object.freeze({[r]:{modelName:"elser",hidden:!0,version:1,config:{input:{field_names:["text_field"]}},description:i.i18n.translate("xpack.ml.trainedModels.modelsList.elserDescription",{defaultMessage:"Elastic Learned Sparse EncodeR v1 (Tech Preview)"}),type:["elastic","pytorch","text_expansion"]},[s]:{modelName:"elser",version:2,default:!0,config:{input:{field_names:["text_field"]}},description:i.i18n.translate("xpack.ml.trainedModels.modelsList.elserV2Description",{defaultMessage:"Elastic Learned Sparse EncodeR v2"}),type:["elastic","pytorch","text_expansion"]},[l]:{modelName:"elser",version:2,os:"Linux",arch:"amd64",config:{input:{field_names:["text_field"]}},description:i.i18n.translate("xpack.ml.trainedModels.modelsList.elserV2x86Description",{defaultMessage:"Elastic Learned Sparse EncodeR v2, optimized for linux-x86_64"}),type:["elastic","pytorch","text_expansion"]},[a]:{modelName:"e5",version:1,default:!0,config:{input:{field_names:["text_field"]}},description:i.i18n.translate("xpack.ml.trainedModels.modelsList.e5v1Description",{defaultMessage:"E5 (EmbEddings from bidirEctional Encoder rEpresentations)"}),license:"MIT",licenseUrl:"https://huggingface.co/elastic/multilingual-e5-small",type:["pytorch","text_embedding"]},[o]:{modelName:"e5",version:1,os:"Linux",arch:"amd64",config:{input:{field_names:["text_field"]}},description:i.i18n.translate("xpack.ml.trainedModels.modelsList.e5v1x86Description",{defaultMessage:"E5 (EmbEddings from bidirEctional Encoder rEpresentations), optimized for linux-x86_64"}),license:"MIT",licenseUrl:"https://huggingface.co/elastic/multilingual-e5-small_linux-x86_64",type:["pytorch","text_embedding"]}}),f={...d,DOWNLOADING:"downloading",DOWNLOADED:"downloaded",NOT_DOWNLOADED:"notDownloaded"}},577:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(8),s=n(37);function l(e){if(void 0!==(null==e?void 0:e.min)&&void 0!==e.max&&e.min>e.max)throw new Error("Invalid validator conditions");return Object(i.memoize)((t=>{const n={};return void 0!==(null==e?void 0:e.min)&&t<e.min&&(n.min=!0),void 0!==(null==e?void 0:e.max)&&t>e.max&&(n.max=!0),null!=e&&e.integerOnly&&!Number.isInteger(t)&&(n.integerOnly=!0),Object(s.a)(n)?n:null}))}},585:function(e,t,n){"use strict";function i(e,t=2){if(void 0===e)return"";if(e%1==0)return e;if(Math.abs(e)<Math.pow(10,-t))return Number.parseFloat(String(e)).toExponential(2);const n=Math.pow(10,t);return Math.round(e*n)/n}n.d(t,"a",(function(){return i}))},858:function(e,t,n){"use strict";n.r(t),n.d(t,"getDefaultModelsListState",(function(){return fn})),n.d(t,"ModelsList",(function(){return gn}));var i=n(2),s=n.n(i),l=n(25),a=n(8),o=n(5),r=n(15),d=n(29),c=n(37),u=n(68),p=n(517),m=n(297),j=n(67),b=n(189),x=n(116),f=n(138),g=n.n(f),O=n(179),h=n(277),M=n(204),v=n(46),y=n(155),E=n(6);const T=({model:e,onConfirm:t,onCancel:n})=>{const[a,d]=Object(i.useState)({}),u=Object(i.useMemo)((()=>e.deployment_ids.filter((t=>!e.inference_apis||!e.inference_apis.some((e=>e.inference_id===t))))),[e]),p=Object(i.useMemo)((()=>u.map((e=>({id:e,label:e})))),[u]),m=Object(i.useCallback)((e=>{d((t=>({...t,[e]:!t[e]})))}),[]),b=Object(i.useMemo)((()=>u.length>1?Object.keys(a).filter((e=>a[e])):u),[u,a]),x=Object(i.useMemo)((()=>Object(c.a)(e.pipelines)?Object.entries(e.pipelines).reduce(((e,[t,n])=>{var i;return(null!==(i=null==n?void 0:n.processors)&&void 0!==i?i:[]).map((e=>{var t;return null==e||null===(t=e.inference)||void 0===t?void 0:t.model_id})).filter(j.a).forEach((n=>{e[n]?e[n].push(t):e[n]=[t]})),e}),{}):{}),[e.pipelines]),f=Object(i.useMemo)((()=>1===u.length&&Object(c.a)(e.pipelines)?Object.keys(e.pipelines):[...new Set(Object.entries(x).filter((([e])=>b.includes(e))).flatMap((([,e])=>e)))].sort()),[u.length,e.pipelines,x,b]),g=Object(i.useMemo)((()=>{var t;return(null!==(t=e.inference_apis)&&void 0!==t?t:[]).map((e=>e.inference_id))}),[e]);return Object(E.jsx)(l.EuiConfirmModal,{title:o.i18n.translate("xpack.ml.trainedModels.modelsList.forceStopDialog.title",{defaultMessage:"Stop {deploymentCount, plural, one {deployment} other {deployments}} of model {modelId}?",values:{modelId:e.model_id,deploymentCount:u.length}}),onCancel:n,onConfirm:t.bind(null,b),cancelButtonText:o.i18n.translate("xpack.ml.trainedModels.modelsList.forceStopDialog.cancelText",{defaultMessage:"Cancel"}),confirmButtonText:o.i18n.translate("xpack.ml.trainedModels.modelsList.forceStopDialog.confirmText",{defaultMessage:"Stop"}),buttonColor:"danger",confirmButtonDisabled:u.length>1&&0===b.length},u.length>1?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCheckboxGroup,{legend:{display:"visible",children:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.selectDeploymentsLegend",defaultMessage:"Select deployments to stop"})},options:p,idToSelectedMap:a,onChange:m}),Object(E.jsx)(l.EuiSpacer,{size:"m"})):null,f.length>0?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.pipelinesWarning",defaultMessage:"You won't be able to use these ingest pipelines until you restart the model:"}),color:"warning",iconType:"warning"},Object(E.jsx)("div",null,Object(E.jsx)("ul",null,f.map((e=>Object(E.jsx)("li",{key:e},e))))))):null,e.hasInferenceServices&&0===g.length?Object(E.jsx)(l.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.hasInferenceServicesWarning",defaultMessage:"The model is used by the _inference API"}),color:"warning",iconType:"warning"}):null,g.length>0?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.forceStopDialog.inferenceServicesWarning",defaultMessage:"The following {inferenceServicesCount, plural, one {deployment is} other {deployments are}} used by the _inference API and can not be stopped:",values:{inferenceServicesCount:g.length}}),color:"warning",iconType:"warning"},Object(E.jsx)("div",null,Object(E.jsx)("ul",null,g.map((e=>Object(E.jsx)("li",{key:e},e))))))):null)};var I=n(71),F=n(577),k=n(18),S=n(32),C=n(122);const _=({config:e,onConfigChange:t,errors:n,isUpdate:s,deploymentsParams:a})=>{var d,c,u;const{total_ml_processors:p,max_single_ml_node_processors:m}=Object(k.d)(),j=e.numOfAllocations,b=e.threadsPerAllocations,x=Object(i.useMemo)((()=>e.deploymentId),[]),f=Object(i.useMemo)((()=>new Array(5).fill(null).map(((e,t)=>Math.pow(2,t))).filter(m?e=>e<=m:e=>!0).map((e=>{const t=e.toString();return{id:t,label:t,value:e,"data-test-subj":`mlModelsStartDeploymentModalThreadsPerAllocation_${t}`}}))),[m]),g="low"===e.priority;return Object(E.jsx)(l.EuiForm,{component:"form",id:"startDeploymentForm"},Object(E.jsx)(l.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(E.jsx)("h3",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.deploymentIdLabel",defaultMessage:"Deployment ID"})),description:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.deploymentIdHelp",defaultMessage:"Specify unique identifier for the model deployment."})},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.deploymentIdLabel",defaultMessage:"Deployment ID"}),hasChildLabel:!1,isInvalid:!!n.deploymentId,error:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.deploymentIdError",defaultMessage:"Deployment with this ID already exists."})},s?Object(E.jsx)(l.EuiSelect,{fullWidth:!0,options:Object.keys(a).map((e=>({text:e,value:e}))),value:e.deploymentId,onChange:n=>{const i=n.target.value;t({...e,deploymentId:i,numOfAllocations:a[i].numOfAllocations})},"data-test-subj":"mlModelsStartDeploymentModalDeploymentSelectId"}):Object(E.jsx)(l.EuiFieldText,{placeholder:x,isInvalid:!!n.deploymentId,value:null!==(d=e.deploymentId)&&void 0!==d?d:"",onChange:n=>{t({...e,deploymentId:n.target.value})},"data-test-subj":"mlModelsStartDeploymentModalDeploymentId"}))),void 0!==e.priority?Object(E.jsx)(l.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(E.jsx)("h3",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityLabel",defaultMessage:"Priority"})),description:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityHelp",defaultMessage:"Select low priority for demonstrations where each model will be very lightly used."})},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.priorityLabel",defaultMessage:"Priority"}),hasChildLabel:!1},Object(E.jsx)(l.EuiButtonGroup,{legend:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.priorityLegend",{defaultMessage:"Priority selector"}),name:"priority",isFullWidth:!0,idSelected:e.priority,onChange:n=>{t({...e,priority:n})},options:[{id:"low",value:"low",label:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.lowPriorityLabel",{defaultMessage:"low"}),"data-test-subj":"mlModelsStartDeploymentModalLowPriority"},{id:"normal",value:"normal",label:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.normalPriorityLabel",{defaultMessage:"normal"}),"data-test-subj":"mlModelsStartDeploymentModalNormalPriority"}],"data-test-subj":"mlModelsStartDeploymentModalPriority"}))):null,Object(E.jsx)(l.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(E.jsx)("h3",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsLabel",defaultMessage:"Number of allocations"})),description:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsHelp",defaultMessage:"Increase to improve document ingest throughput."})},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsLabel",defaultMessage:"Number of allocations"}),hasChildLabel:!1,isDisabled:g,isInvalid:!!n.numOfAllocations,error:null!=n&&null!==(c=n.numOfAllocations)&&void 0!==c&&c.min?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsMinError",defaultMessage:"At least one allocation is required."}):null!=n&&null!==(u=n.numOfAllocations)&&void 0!==u&&u.max?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.numbersOfAllocationsMaxError",defaultMessage:"Cannot exceed {max} - the total number of ML processors.",values:{max:p}}):null},Object(E.jsx)(l.EuiFieldNumber,{disabled:g,isInvalid:!!n.numOfAllocations,fullWidth:!0,min:1,max:p,step:1,name:"numOfAllocations",value:g?1:j,onChange:n=>{t({...e,numOfAllocations:Number(n.target.value)})},"data-test-subj":"mlModelsStartDeploymentModalNumOfAllocations"}))),void 0!==b?Object(E.jsx)(l.EuiDescribedFormGroup,{titleSize:"xxs",title:Object(E.jsx)("h3",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLabel",defaultMessage:"Threads per allocation"})),description:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationHelp",defaultMessage:"Increase to improve inference latency."})},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLabel",defaultMessage:"Threads per allocation"}),hasChildLabel:!1,isDisabled:g},Object(E.jsx)(l.EuiButtonGroup,{isDisabled:g,legend:o.i18n.translate("xpack.ml.trainedModels.modelsList.startDeployment.threadsPerAllocationLegend",{defaultMessage:"Threads per allocation selector"}),name:"threadsPerAllocation",isFullWidth:!0,idSelected:g?"1":f.find((e=>e.value===b)).id,onChange:n=>{const i=f.find((e=>e.id===n)).value;t({...e,threadsPerAllocations:i})},options:f,"data-test-subj":"mlModelsStartDeploymentModalThreadsPerAllocation"}))):null)};var w={name:"zdrr8d",styles:"align-self:center;margin-right:auto"};const L=({model:e,onConfigChange:t,onClose:n,startModelDeploymentDocUrl:a,initialParams:o,modelAndDeploymentIds:d})=>{var c,u;const{showNodeInfo:p}=Object(C.d)(),m=!!o,{total_ml_processors:j}=Object(k.d)(),[b,x]=Object(i.useState)(null!=o?o:{numOfAllocations:1,threadsPerAllocations:1,priority:Object(k.f)()?"low":"normal",deploymentId:e.model_id}),f=Object(i.useMemo)((()=>{if(m)return()=>null;const t=[...null!=d?d:[]];return t.splice(null==t?void 0:t.indexOf(e.model_id),1),Object(S.b)([...e.deployment_ids,...t,...e.deployment_ids.includes(e.model_id)?[""]:[]])}),[d,e.deployment_ids,e.model_id,m]),g=Object(S.a)(Object(S.f)(),Object(F.a)({min:1,max:j,integerOnly:!0}))(b.numOfAllocations),O=f(null!==(c=b.deploymentId)&&void 0!==c?c:""),h={...g?{numOfAllocations:g}:{},...O?{deploymentId:O}:{}};return Object(E.jsx)(l.EuiModal,{onClose:n,initialFocus:"[name=numOfAllocations]",maxWidth:!1,"data-test-subj":"mlModelsStartDeploymentModal"},Object(E.jsx)(l.EuiModalHeader,null,Object(E.jsx)(l.EuiModalHeaderTitle,{size:"s"},m?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.updateDeployment.modalTitle",defaultMessage:"Update {modelId} deployment",values:{modelId:e.model_id}}):Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.modalTitle",defaultMessage:"Start {modelId} deployment",values:{modelId:e.model_id}}))),Object(E.jsx)(l.EuiModalBody,null,p?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{size:"s",title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.maxNumOfProcessorsWarning",defaultMessage:"The product of the number of allocations and threads per allocation should be less than the total number of processors on your ML nodes."}),iconType:"iInCircle",color:"primary"}),Object(E.jsx)(l.EuiSpacer,{size:"m"})):null,Object(E.jsx)(_,{config:b,onConfigChange:x,errors:h,isUpdate:m,deploymentsParams:null===(u=e.stats)||void 0===u?void 0:u.deployment_stats.reduce(((e,t)=>(e[t.deployment_id]={numOfAllocations:t.number_of_allocations},e)),{})}),Object(E.jsx)(l.EuiSpacer,{size:"m"})),Object(E.jsx)(l.EuiModalFooter,null,Object(E.jsx)(l.EuiLink,{href:a,external:!0,target:"_blank",css:w},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.docLinkTitle",defaultMessage:"Learn more"})),Object(E.jsx)(l.EuiButtonEmpty,{onClick:n},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.cancelButton",defaultMessage:"Cancel"})),Object(E.jsx)(l.EuiButton,{type:"submit",form:"startDeploymentForm",onClick:t.bind(null,b),fill:!0,disabled:Object.keys(h).length>0,"data-test-subj":"mlModelsStartDeploymentModalStartButton"},m?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.updateButton",defaultMessage:"Update"}):Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.startButton",defaultMessage:"Start"}))))};var D=n(10),P=n(1);const A=Object(i.createContext)(void 0);function N(){const e=Object(i.useContext)(A);if(void 0===e)throw new Error("TestTrainedModelsContext has not been initialized.");return e}var R=n(4),z=n.n(R),B=n(7),$=n(131);const V=({taskLabel:e,info:t})=>0===t.length?null:Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{title:e},t.map((e=>Object(E.jsx)(l.EuiText,{size:"s"},e)))),Object(E.jsx)(l.EuiSpacer,null)),G="text_field";let U=function(e){return e[e.STOPPED=0]="STOPPED",e[e.RUNNING=1]="RUNNING",e[e.FINISHED=2]="FINISHED",e[e.FINISHED_WITH_ERRORS=3]="FINISHED_WITH_ERRORS",e}({}),W=function(e){return e[e.TEXT=0]="TEXT",e[e.INDEX=1]="INDEX",e}({});class inference_base_InferenceBase{constructor(e,t,n,i){var s,l;z()(this,"modelInputField",void 0),z()(this,"_deploymentId",null),z()(this,"inputText$",new B.BehaviorSubject([])),z()(this,"inputField$",new B.BehaviorSubject("")),z()(this,"inferenceResult$",new B.BehaviorSubject(null)),z()(this,"inferenceError$",new B.BehaviorSubject(null)),z()(this,"runningState$",new B.BehaviorSubject(U.STOPPED)),z()(this,"isValid$",new B.BehaviorSubject(!1)),z()(this,"pipeline$",new B.BehaviorSubject({})),z()(this,"supportedFieldTypes",[$.a.TEXT]),z()(this,"selectedDataViewId",void 0),z()(this,"info",[]),z()(this,"switchToCreationMode",void 0),z()(this,"subscriptions$",new B.Subscription),this.trainedModelsApi=e,this.model=t,this.inputType=n,this.deploymentId=i,this.modelInputField=null!==(s=null===(l=t.input)||void 0===l?void 0:l.field_names[0])&&void 0!==s?s:G,this.inputField$.next(this.modelInputField)}setSwitchtoCreationMode(e){this.switchToCreationMode=e}destroy(){this.subscriptions$.unsubscribe(),this.pipeline$.unsubscribe()}initialize(e,t){this.initializeValidators(e),this.initializePipeline(t)}initializeValidators(e){const t=[this.inputText$.pipe(Object(B.map)((e=>e.some((e=>""!==e))))),...e||[]];this.subscriptions$.add(Object(B.combineLatest)(t).pipe(Object(B.map)((e=>e.every((e=>!!e))))).subscribe(this.isValid$))}initializePipeline(e){const t=[this.inputField$.asObservable(),...e||[]];this.subscriptions$.add(Object(B.combineLatest)(t).subscribe((()=>{this.pipeline$.next(this.generatePipeline())})))}setStopped(){this.inferenceError$.next(null),this.runningState$.next(U.STOPPED)}setRunning(){this.inferenceError$.next(null),this.runningState$.next(U.RUNNING)}setFinished(){this.runningState$.next(U.FINISHED)}setFinishedWithErrors(e){this.inferenceError$.next(e),this.runningState$.next(U.FINISHED_WITH_ERRORS)}getInfoComponent(){return e=this.inferenceTypeLabel,t=this.info,Object(E.jsx)(V,{taskLabel:e,info:t});var e,t}getInputType(){return this.inputType}reset(){this.inputText$.next([]),this.inferenceResult$.next(null),this.inferenceError$.next(null),this.runningState$.next(U.STOPPED)}setSelectedDataViewId(e){this.selectedDataViewId=e}getSelectedDataViewId(){return this.selectedDataViewId}setInputField(e){this.inputField$.next(void 0===e?this.modelInputField:e)}getInputField(){return this.inputField$.getValue()}getInputField$(){return this.inputField$.asObservable()}setInputText(e){this.inputText$.next(e)}getInputText$(){return this.inputText$.asObservable()}getInputText(){return this.inputText$.getValue()}getInferenceResult$(){return this.inferenceResult$.asObservable()}getInferenceResult(){return this.inferenceResult$.getValue()}getInferenceError$(){return this.inferenceError$.asObservable()}getInferenceError(){return this.inferenceError$.getValue()}getRunningState$(){return this.runningState$.asObservable()}getRunningState(){return this.runningState$.getValue()}getIsValid$(){return this.isValid$.asObservable()}getIsValid(){return this.isValid$.getValue()}async infer(){return this.inputType===W.TEXT?this.inferText():this.inferIndex()}generatePipeline(){return{processors:this.getProcessors()}}getPipeline$(){return this.pipeline$.asObservable()}getPipeline(){return this.pipeline$.getValue()}getSupportedFieldTypes(){return this.supportedFieldTypes}getBasicProcessors(e){var t;return[{inference:{model_id:null!==(t=this.deploymentId)&&void 0!==t?t:this.model.model_id,target_field:this.inferenceType,field_map:{[this.inputField$.getValue()]:this.modelInputField},...e&&Object.keys(e).length?{inference_config:this.getInferenceConfig(e)}:{}}}]}getInferenceConfig(e){return{[this.inferenceType]:{...e}}}async runInfer(e,t){try{this.setRunning();const n=this.inputText$.getValue()[0],i=e(),s=t(await this.trainedModelsApi.inferTrainedModel(this.model.model_id,this.deploymentId,{docs:this.getInferDocs(),...i?{inference_config:i}:{}},"30s"),n);return this.inferenceResult$.next([s]),this.setFinished(),[s]}catch(e){throw this.setFinishedWithErrors(e),e}}async runPipelineSimulate(e){try{this.setRunning();const{docs:t}=await this.trainedModelsApi.trainedModelPipelineSimulate(this.getPipeline(),this.getPipelineDocs()),n=t.map((t=>e(this.getDocFromResponse(t))));return this.inferenceResult$.next(n),this.setFinished(),n}catch(e){throw this.setFinishedWithErrors(e),e}}getInferDocs(){return[{[this.inputField$.getValue()]:this.inputText$.getValue()[0]}]}getPipelineDocs(){return this.inputText$.getValue().map((e=>({_source:{[this.inputField$.getValue()]:e}})))}getDefaultInferenceConfig(){return this.model.inference_config[this.inferenceType]}getNumTopClassesConfig(e=5){var t;const n=this.getDefaultInferenceConfig();return n&&"num_top_classes"in n&&null!==(t=null==n?void 0:n.num_top_classes)&&void 0!==t&&t?{}:{num_top_classes:e}}getDocFromResponse({doc:e,error:t}){if(void 0===e){if(t)throw this.setFinishedWithErrors(t),Error(t.reason);throw Error(o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.pipelineSimulate.unknownError",{defaultMessage:"Error simulating ingest pipeline"}))}return e}}var H=n(26),q=n.n(H);const J=({placeholder:e,inferrer:t})=>{const[n,s]=Object(i.useState)("");Object(i.useEffect)((()=>{t.setInputText([n])}),[n,t]);const a=q()(t.getRunningState$(),t.getRunningState());return Object(E.jsx)(l.EuiFormRow,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.generalTextInput.inputTitle",{defaultMessage:"Input text"}),fullWidth:!0},Object(E.jsx)(l.EuiTextArea,{placeholder:null!=e?e:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.generalTextInput.inputText",{defaultMessage:"Input text"}),value:n,disabled:a===U.RUNNING,fullWidth:!0,onChange:e=>{s(e.target.value)},"data-test-subj":"mlTestModelInputText"}))},X=(e,t)=>Object(E.jsx)(J,{placeholder:t,inferrer:e}),Q="2px",K={PER:{label:"Person",icon:"user",color:"euiColorVis5_behindText",borderColor:"euiColorVis5"},LOC:{label:"Location",icon:"visMapCoordinate",color:"euiColorVis1_behindText",borderColor:"euiColorVis1"},ORG:{label:"Organization",icon:"home",color:"euiColorVis0_behindText",borderColor:"euiColorVis0"},MISC:{label:"Miscellaneous",icon:"questionInCircle",color:"euiColorVis7_behindText",borderColor:"euiColorVis7"}},Y=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?e.getInputType()===W.INDEX?Object(E.jsx)(s.a.Fragment,null,t.map((e=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(Z,{result:e}),Object(E.jsx)(l.EuiHorizontalRule,null))))):Object(E.jsx)(Z,{result:t[0]}):null},Z=({result:e})=>{const{euiTheme:t}=Object(D.a)(),n=[];return e.response.forEach((({value:e,entity:i})=>{if(null===i){const t=e.split(/(\n)/).map((e=>"\n"===e?Object(E.jsx)("br",null):Object(E.jsx)("span",null,e)));n.push(...t)}else n.push(Object(E.jsx)(l.EuiToolTip,{position:"top",content:Object(E.jsx)("div",null,Object(E.jsx)("div",null,Object(E.jsx)(l.EuiIcon,{size:"m",type:te(i.class_name),style:{marginRight:Q,verticalAlign:"text-top"}}),e),Object(E.jsx)(l.EuiHorizontalRule,{margin:"none"}),Object(E.jsx)("div",{style:{fontSize:t.euiFontSizeXS,marginTop:Q}},Object(E.jsx)("div",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.ner.output.typeTitle",defaultMessage:"Type"}),": ",ne(i.class_name)),Object(E.jsx)("div",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.ner.output.probabilityTitle",defaultMessage:"Probability"}),": ",Number(i.class_probability).toPrecision(3))))},Object(E.jsx)(ee,{entity:i},e)))})),Object(E.jsx)("div",{style:{lineHeight:"24px"}},n)},ee=({entity:e,children:t})=>{const{euiTheme:n}=Object(D.a)();return Object(E.jsx)(l.EuiBadge,{color:ie(n,e.class_name),style:{marginRight:Q,marginTop:`-${Q}`,border:`1px solid ${ie(n,e.class_name,!0)}`,fontSize:n.euiFontSizeXS,padding:"0px 6px",pointerEvents:"none"}},Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"none"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiIcon,{size:"s",type:te(e.class_name),style:{marginRight:Q,marginTop:Q}})),Object(E.jsx)(l.EuiFlexItem,null,t)))};function te(e){var t;const n=K[e];return null!==(t=null==n?void 0:n.icon)&&void 0!==t?t:"questionInCircle"}function ne(e){var t;const n=K[e];return null!==(t=null==n?void 0:n.label)&&void 0!==t?t:e}function ie(e,t,n=!1){var i;const s=K[t];let l=null!==(i=null==s?void 0:s.color)&&void 0!==i?i:"euiColorVis5_behindText";var a;return n&&(l=null!==(a=null==s?void 0:s.borderColor)&&void 0!==a?a:"euiColorVis5"),e[l]}class ner_inference_NerInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.NER),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.label",{defaultMessage:"Named entity recognition"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.info1",{defaultMessage:"Test how well the model identifies named entities in your input text."})]),this.initialize()}async inferText(){return this.runInfer((()=>{}),((e,t)=>({response:se(e),rawResponse:e,inputText:t})))}async inferIndex(){return this.runPipelineSimulate((e=>({response:se({inference_results:[e._source[this.inferenceType]]}),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors()}getInputComponent(){if(this.inputType===W.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.ner.inputText",{defaultMessage:"Enter a phrase to test"});return X(this,e)}return null}getOutputComponent(){return Object(E.jsx)(Y,{inferrer:this})}}function se(e){const[{predicted_value:t,entities:n}]=e.inference_results,i=/(\[.*?\])\((.*?)&(.*?)\)/;if(void 0===t||void 0===n)return[];const s=t.split(/(\[.*?\]\(.*?&.*?\))/);let l=0;return s.map((e=>{const t=e.match(i);if(t){const e=t[3],i=n[l];return e!==i.entity&&e.replaceAll("+"," ")!==i.entity&&console.error("mismatch entity",i),l++,{value:i.entity,entity:i}}return{value:e,entity:null}}))}const le=({inferrer:e})=>{const t=q()(e.getQuestionText$(),e.getQuestionText()),n=q()(e.getRunningState$(),e.getRunningState());return Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswering.questionInput",{defaultMessage:"Question"})},Object(E.jsx)(l.EuiFieldText,{value:t,disabled:n===U.RUNNING,fullWidth:!0,onChange:t=>{e.setQuestionText(t.target.value)}}))},ae=200,oe=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(s.a.Fragment,null,function(e,t){const n=t.slice(0,e.startOffset),i=t.slice(e.endOffset,t.length),s=n.length>ae?`...${n.slice(n.length-ae,n.length)}`:n,l=i.length>ae?`${i.slice(0,ae)}...`:i;return Object(E.jsx)("div",{style:{lineHeight:"24px"}},s,Object(E.jsx)(re,null,e.value),l)}(e[0],t)),Object(E.jsx)(l.EuiHorizontalRule,null))))):null},re=({children:e})=>{const{euiTheme:t}=Object(D.a)();return Object(E.jsx)(l.EuiBadge,{color:t.euiColorVis5_behindText,style:{marginRight:"2px",marginTop:"-2px",border:`1px solid ${t.euiColorVis5}`,fontSize:t.euiFontSizeXS,padding:"0px 6px",pointerEvents:"none"}},e)};class question_answering_inference_QuestionAnsweringInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.QUESTION_ANSWERING),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.label",{defaultMessage:"Question answering"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.info1",{defaultMessage:"Provide a question and test how well the model extracts an answer from your input text."})]),z()(this,"questionText$",new B.BehaviorSubject("")),this.initialize([this.questionText$.pipe(Object(B.map)((e=>""!==e)))],[this.questionText$])}async inferText(){return this.runInfer((()=>{const e=this.questionText$.value;return this.getInferenceConfig({...this.getNumTopClassesConfig(),question:e})}),((e,t)=>de(e,t)))}async inferIndex(){return this.runPipelineSimulate((e=>de({inference_results:[e._source[this.inferenceType]]},e._source[this.getInputField()])))}getProcessors(){const e=this.questionText$.value;return this.getBasicProcessors({...this.getNumTopClassesConfig(),question:e})}setQuestionText(e){this.questionText$.next(e)}getQuestionText$(){return this.questionText$.asObservable()}getQuestionText(){return this.questionText$.getValue()}getInputComponent(){return e=this,t=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.questionAnswer.inputText",{defaultMessage:"Enter unstructured text phrases related to the answers you're seeking"}),Object(E.jsx)(s.a.Fragment,null,e.getInputType()===W.TEXT?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(J,{placeholder:t,inferrer:e}),Object(E.jsx)(l.EuiSpacer,null)):null,Object(E.jsx)(le,{inferrer:e}));var e,t}getOutputComponent(){return Object(E.jsx)(oe,{inferrer:this})}}function de(e,t){const{inference_results:[n]}=e;let i=[{value:n.predicted_value,predictionProbability:n.prediction_probability,startOffset:n.start_offset,endOffset:n.end_offset}];return void 0!==n.top_classes&&(i=n.top_classes.map((e=>({value:e.answer,predictionProbability:e.score,startOffset:e.start_offset,endOffset:e.end_offset})))),{response:i,rawResponse:e,inputText:t}}const ce=3;function ue(e,t,n){const{inference_results:[i]}=e;return{response:pe(i,t),rawResponse:e,inputText:n}}function pe(e,t){var n,i,s;const l=null!==(n=null===(i=t.inference_config)||void 0===i||null===(s=i.text_classification)||void 0===s?void 0:s.classification_labels)&&void 0!==n?n:[];let a=[{value:e.predicted_value,predictionProbability:e.prediction_probability}];return void 0!==e.top_classes?a=e.top_classes.map((e=>({value:e.class_name,predictionProbability:e.class_probability}))):2===l.length&&(a=l.map((t=>({value:t,predictionProbability:e.predicted_value===t?e.prediction_probability:1-e.prediction_probability})))),a.map((({value:e,predictionProbability:t})=>({value:e,predictionProbability:Number(t.toPrecision(ce))}))).sort(((e,t)=>e.predictionProbability-t.predictionProbability)).reverse()}const me=e=>Object(E.jsx)(je,{inferrer:e}),je=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(be,{response:e,inputText:t}),Object(E.jsx)(l.EuiHorizontalRule,null))))):null},be=({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,void 0!==t?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiTitle,{size:"xxs"},Object(E.jsx)("span",null,t)),Object(E.jsx)(l.EuiSpacer,null)):null,e.map((({value:e,predictionProbability:t})=>Object(E.jsx)(i.Fragment,{key:e},Object(E.jsx)(l.EuiProgress,{value:100*t,max:100,size:"m"}),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{"data-test-subj":"mlTestModelLangIdentInputValue"},e),Object(E.jsx)(l.EuiFlexItem,{"data-test-subj":"mlTestModelLangIdentInputProbability",grow:!1},t)),Object(E.jsx)(l.EuiSpacer,null)))));class text_classification_inference_TextClassificationInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.TEXT_CLASSIFICATION),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.label",{defaultMessage:"Text classification"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.info1",{defaultMessage:"Test how well the model classifies your input text."})]),this.initialize()}async inferText(){return this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ue(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:pe(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}getInputComponent(){if(this.inputType===W.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.inputText",{defaultMessage:"Enter a phrase to test"});return X(this,e)}return null}getOutputComponent(){return me(this)}}const xe=({inferrer:e})=>{const t=q()(e.getRunningState$(),e.getRunningState()),n=q()(e.getLabelsText$(),e.getLabelsText()),i=q()(e.getMultiLabel$(),e.getMultiLabel());return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.classNamesInput",{defaultMessage:"Class labels"}),helpText:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.classNamesHelpText",{defaultMessage:"Separate the labels with commas"})},Object(E.jsx)(l.EuiFieldText,{value:n,disabled:t===U.RUNNING,fullWidth:!0,onChange:t=>e.setLabelsText(t.target.value)})),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,helpText:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.multiLabelHelpText",{defaultMessage:"Enable the input text to match more than one label."})},Object(E.jsx)(l.EuiSwitch,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textClassification.multiLabelSwitch",{defaultMessage:"Multi label"}),checked:i,onChange:t=>e.setMultiLabel(t.target.checked)})))};class zero_shot_classification_inference_ZeroShotClassificationInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.ZERO_SHOT_CLASSIFICATION),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.label",{defaultMessage:"Zero shot classification"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.info1",{defaultMessage:"Provide a set of labels and test how well the model classifies your input text."})]),z()(this,"labelsText$",new B.BehaviorSubject("")),z()(this,"multiLabel$",new B.BehaviorSubject(!1)),this.initialize([this.labelsText$.pipe(Object(B.map)((e=>""!==e)))],[this.labelsText$,this.multiLabel$])}async inferText(){return this.runInfer((()=>{const e=this.labelsText$.getValue(),t=this.multiLabel$.getValue(),n=null==e?void 0:e.split(",").map((e=>e.trim()));return this.getInferenceConfig({labels:n,multi_label:t})}),((e,t)=>ue(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:pe(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getInputLabels(){const e=this.labelsText$.getValue();return null==e?void 0:e.split(",").map((e=>e.trim()))}getProcessors(){const e=this.getInputLabels(),t=this.multiLabel$.getValue();return this.getBasicProcessors({labels:e,multi_label:t})}setLabelsText(e){this.labelsText$.next(e)}getLabelsText$(){return this.labelsText$.asObservable()}getLabelsText(){return this.labelsText$.getValue()}setMultiLabel(e){this.multiLabel$.next(e)}getMultiLabel$(){return this.multiLabel$.asObservable()}getMultiLabel(){return this.multiLabel$.getValue()}getInputComponent(){return e=this,t=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.zeroShotClassification.inputText",{defaultMessage:"Enter a phrase to test"}),Object(E.jsx)(s.a.Fragment,null,e.getInputType()===W.TEXT?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(J,{placeholder:t,inferrer:e}),Object(E.jsx)(l.EuiSpacer,null)):null,Object(E.jsx)(xe,{inferrer:e}));var e,t}getOutputComponent(){return me(this)}}const fe=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,t.map((t=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(be,{response:t.response,inputText:e.predictedValue(t)}),Object(E.jsx)(l.EuiHorizontalRule,null))))):null};class fill_mask_inference_FillMaskInference extends inference_base_InferenceBase{constructor(e,t,n,i){var s,l;super(e,t,n,i),z()(this,"inferenceType",m.i.FILL_MASK),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.label",{defaultMessage:"Fill mask"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.info1",{defaultMessage:"Test how well the model predicts a missing word in a phrase."})]),z()(this,"maskToken","[MASK]");const a=null===(s=t.inference_config)||void 0===s||null===(l=s[this.inferenceType])||void 0===l?void 0:l.mask_token;a&&(this.maskToken=a),this.initialize([this.inputText$.pipe(Object(B.map)((e=>e.every((e=>e.includes(this.maskToken))))))])}async inferText(){return this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ue(e,this.model,t)))}async inferIndex(){return this.runPipelineSimulate((e=>({response:pe(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}predictedValue(e){var t;const{response:n,inputText:i}=e;return null!==(t=n[0])&&void 0!==t&&t.value?i.replace(this.maskToken,n[0].value):i}getInputComponent(){if(this.inputType===W.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.fillMask.inputText",{defaultMessage:"Enter a phrase to test. Use {maskToken} as a placeholder for the missing words.",values:{maskToken:this.maskToken}});return X(this,e)}return null}getOutputComponent(){return Object(E.jsx)(fe,{inferrer:this})}}const ge={af:"Afrikaans",hr:"Croatian",pa:"Punjabi",am:"Amharic",ht:"Haitian",pl:"Polish",ar:"Arabic",hu:"Hungarian",ps:"Pashto",az:"Azerbaijani",hy:"Armenian",pt:"Portuguese",be:"Belarusian",id:"Indonesian",ro:"Romanian",bg:"Bulgarian",ig:"Igbo",ru:"Russian","bg-Latn":"Bulgarian",is:"Icelandic","ru-Latn":"Russian",bn:"Bengali",it:"Italian",sd:"Sindhi",bs:"Bosnian",iw:"Hebrew",si:"Sinhala",ca:"Catalan",ja:"Japanese",sk:"Slovak",ceb:"Cebuano","ja-Latn":"Japanese",sl:"Slovenian",co:"Corsican",jv:"Javanese",sm:"Samoan",cs:"Czech",ka:"Georgian",sn:"Shona",cy:"Welsh",kk:"Kazakh",so:"Somali",da:"Danish",km:"Central Khmer",sq:"Albanian",de:"German",kn:"Kannada",sr:"Serbian",el:"Greek,modern",ko:"Korean",st:"Southern Sotho","el-Latn":"Greek,modern",ku:"Kurdish",su:"Sundanese",en:"English",ky:"Kirghiz",sv:"Swedish",eo:"Esperanto",la:"Latin",sw:"Swahili",es:"Spanish,Castilian",lb:"Luxembourgish",ta:"Tamil",et:"Estonian",lo:"Lao",te:"Telugu",eu:"Basque",lt:"Lithuanian",tg:"Tajik",fa:"Persian",lv:"Latvian",th:"Thai",fi:"Finnish",mg:"Malagasy",tr:"Turkish",fil:"Filipino",mi:"Maori",uk:"Ukrainian",fr:"French",mk:"Macedonian",ur:"Urdu",fy:"Western Frisian",ml:"Malayalam",uz:"Uzbek",ga:"Irish",mn:"Mongolian",vi:"Vietnamese",gd:"Gaelic",mr:"Marathi",xh:"Xhosa",gl:"Galician",ms:"Malay",yi:"Yiddish",gu:"Gujarati",mt:"Maltese",yo:"Yoruba",ha:"Hausa",my:"Burmese",zh:"Chinese",haw:"Hawaiian",ne:"Nepali","zh-Latn":"Chinese",hi:"Hindi",nl:"Dutch,Flemish",zu:"Zulu","hi-Latn":"Hindi",no:"Norwegian",hmn:"Hmong",ny:"Chichewa",zxx:"unknown"},Oe=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(he,{response:e,inputText:t}),Object(E.jsx)(l.EuiHorizontalRule,null))))):null},he=({response:e,inputText:t})=>{const n=e[0].value,i=null!==(a=ge[n])&&void 0!==a?a:"unknown";var a;const r="unknown"!==i?o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.output.title",{defaultMessage:"This looks like {lang}",values:{lang:i}}):o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.output.titleUnknown",{defaultMessage:"Language code unknown: {langCode}",values:{langCode:n}});return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiText,{size:"s","data-test-subj":"mlTestModelLangIdentInputText"},t),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(l.EuiTitle,{size:"xxs"},Object(E.jsx)("h4",{"data-test-subj":"mlTestModelLangIdentTitle"},r)),Object(E.jsx)(l.EuiSpacer,null),Object(E.jsx)(be,{response:e}))};class lang_ident_inference_LangIdentInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType","classification"),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.label",{defaultMessage:"Language identification"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.info1",{defaultMessage:"Test how well the model identifies the language of your text. The model is more accurate with longer text."})]),this.initialize()}async inferText(){try{return await this.runInfer((()=>this.getInferenceConfig(this.getNumTopClassesConfig())),((e,t)=>ue(e,this.model,t)))}catch(e){throw this.setFinishedWithErrors(e),e}}async inferIndex(){try{return await this.runPipelineSimulate((e=>({response:pe(e._source[this.inferenceType],this.model),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}catch(e){throw this.setFinishedWithErrors(e),e}}getProcessors(){return this.getBasicProcessors(this.getNumTopClassesConfig())}getInputComponent(){if(this.inputType===W.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.langIdent.inputText",{defaultMessage:"Enter a phrase to test"});return X(this,e)}return null}getOutputComponent(){return Object(E.jsx)(Oe,{inferrer:this})}}const Me=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,t.map((({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(ve,{value:e.predictedValue.toString(),inputText:t}),Object(E.jsx)(l.EuiHorizontalRule,null))))):null},ve=({value:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiText,{size:"s"},t),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(l.EuiTextArea,{value:e,fullWidth:!0,style:{height:300}}),Object(E.jsx)(l.EuiCopy,{textToCopy:e},(e=>Object(E.jsx)(l.EuiButton,{size:"s",onClick:e},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.textEmbedding.copyButton",defaultMessage:"Copy to clipboard"})))));class text_embedding_inference_TextEmbeddingInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.TEXT_EMBEDDING),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.label",{defaultMessage:"Text embedding"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.info1",{defaultMessage:"Test how well the model generates embeddings for your text."})]),this.initialize()}async inferText(){return this.runInfer((()=>{}),((e,t)=>function(e,t){return{response:{predictedValue:e.inference_results[0].predicted_value},rawResponse:e,inputText:t}}(e,t)))}async inferIndex(){return this.runPipelineSimulate((e=>{const t=e._source[this.getInputField()];return function(e,t){const n=e.predicted_value;return{response:{predictedValue:n},rawResponse:{inference_results:[{predicted_value:n}]},inputText:t}}(e._source[this.inferenceType],t)}))}getProcessors(){return this.getBasicProcessors()}getInputComponent(){if(this.inputType===W.TEXT){const e=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textEmbedding.inputText",{defaultMessage:"Enter a phrase to test"});return X(this,e)}return null}getOutputComponent(){return Object(E.jsx)(Me,{inferrer:this})}}var ye=n(322);const Ee=({errorText:e})=>null===e?null:Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{title:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.inferenceError",{defaultMessage:"An error occurred"}),color:"danger",iconType:"cross"},Object(E.jsx)("p",null,e))),Te=({text:e})=>{const t=e.split(/\r\n|\r|\n/).length+1,n=t>4&&t<=10?t:4;return Object(E.jsx)(l.EuiSkeletonText,{"data-test-subj":"mlTestModelLoadingContent",lines:n})};var Ie=n(190);const Fe=({inferrer:e})=>{var t;const n=q()(e.getInferenceError$(),e.getInferenceError()),i=q()(e.getRunningState$(),e.getRunningState()),l=q()(e.getInferenceResult$(),e.getInferenceResult());if(i===U.FINISHED_WITH_ERRORS&&!n||i===U.FINISHED&&!l)return null;const a=[];if(l)for(const{rawResponse:e}of l)a.push(e);const o=i===U.FINISHED_WITH_ERRORS?JSON.stringify(null!==(t=null==n?void 0:n.body)&&void 0!==t?t:n,null,2):JSON.stringify(e.getInputType()===W.TEXT?a[0]:a,null,2);return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(Ie.a,{"data-test-subj":"mlTestModelRawOutput",value:null!=o?o:"",readOnly:!0}))},ke=({testButtonDisabled:e,createPipelineButtonDisabled:t,inferrer:n,showCreatePipelineButton:i})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButton,{disabled:e,fullWidth:!1,"data-test-subj":"mlTestModelTestButton",type:"submit"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.runButton",defaultMessage:"Test"}))),i?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{disabled:t,"data-test-subj":"mlTestModelCreatePipelineButton",onClick:()=>{n.switchToCreationMode&&n.switchToCreationMode()}},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.createPipelineButton",defaultMessage:"Create pipeline"}))):null);var Se=function(e){return e[e.TEXT=0]="TEXT",e[e.RAW=1]="RAW",e}(Se||{});const Ce=({inferrer:e})=>{const[t,n]=Object(i.useState)(Se.TEXT),[a,o]=Object(i.useState)(null),d=q()(e.getIsValid$(),e.getIsValid()),c=q()(e.getRunningState$(),e.getRunningState()),u=Object(i.useMemo)((()=>e.getInputComponent()),[e]),p=Object(i.useMemo)((()=>e.getOutputComponent()),[e]),m=Object(i.useMemo)((()=>e.getInfoComponent()),[e]),j=Object(i.useCallback)((async t=>{t.preventDefault(),o(null);try{await e.infer()}catch(e){o(Object(ye.a)(e))}}),[e]);return Object(E.jsx)(l.EuiForm,{component:"form",onSubmit:j},Object(E.jsx)(s.a.Fragment,null,m),Object(E.jsx)(s.a.Fragment,null,u),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)("div",null,Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(ke,{testButtonDisabled:c===U.RUNNING||!1===d,createPipelineButtonDisabled:c===U.RUNNING||!1===d,inferrer:e}))),c!==U.STOPPED?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiTabs,{size:"s"},Object(E.jsx)(l.EuiTab,{isSelected:t===Se.TEXT,onClick:n.bind(null,Se.TEXT)},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.markupTab",defaultMessage:"Output"})),Object(E.jsx)(l.EuiTab,{isSelected:t===Se.RAW,onClick:n.bind(null,Se.RAW)},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.rawOutput",defaultMessage:"Raw output"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),t===Se.TEXT?Object(E.jsx)(s.a.Fragment,null,c===U.RUNNING?Object(E.jsx)(Te,{text:""}):null,null!==a||c===U.FINISHED_WITH_ERRORS?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(Ee,{errorText:a}),Object(E.jsx)(l.EuiSpacer,null)):null,c===U.FINISHED?Object(E.jsx)("div",{"data-test-subj":"mlTestModelOutput"},p):null):Object(E.jsx)(Fe,{inferrer:e})):null)};var _e=n(403);const we=({inferrer:e,data:t,disableIndexSelection:n})=>{var a;const{dataViewListItems:d,fieldNames:c,selectedDataViewId:u,setSelectedDataViewId:p,selectedField:m,setSelectedField:j,setDataViewListItems:b}=t,x=q()(e.getRunningState$(),e.getRunningState()),f=q()(e.getPipeline$(),e.getPipeline()),g=Object(i.useMemo)((()=>e.getInputComponent()),[e]);return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",alignItems:"flexEnd"},Object(E.jsx)(l.EuiFlexItem,{grow:!0},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.dataViewTitle",defaultMessage:"Data view"}),fullWidth:!0},n?Object(E.jsx)(l.EuiText,{grow:!1},Object(E.jsx)(l.EuiCode,null,null===(a=d.find((e=>e.value===u)))||void 0===a?void 0:a.text)):Object(E.jsx)(l.EuiSelect,{options:d,value:u,onChange:t=>{e.setSelectedDataViewId(t.target.value),p(t.target.value)},hasNoInitialSelection:!0,disabled:x===U.RUNNING,fullWidth:!0}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(_e.a,{allowAdHocDataView:!0,onDataViewCreated:e=>{b((t=>[...t,{text:e.getIndexPattern(),value:e.id}].sort(((e,t)=>e.text.localeCompare(t.text))))),p(e.id)}}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiFormRow,{label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.indexInput.fieldInput",{defaultMessage:"Field"}),fullWidth:!0},Object(E.jsx)(l.EuiSelect,{options:c,value:m,onChange:e=>{j(e.target.value)},hasNoInitialSelection:!0,disabled:x===U.RUNNING,fullWidth:!0})),Object(E.jsx)(s.a.Fragment,null,g),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiAccordion,{id:"simpleAccordionId",buttonContent:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.indexInput.viewPipeline",{defaultMessage:"View pipeline"})},Object(E.jsx)(l.EuiCodeBlock,{language:"json",fontSize:"s",paddingSize:"s",lineNumbers:!0,isCopyable:!0,overflowHeight:300},JSON.stringify(f,null,2))))},Le=({inferrer:e})=>{const{currentContext:{defaultSelectedDataViewId:t,createPipelineFlyoutOpen:n}}=N(),a=function({inferrer:e,defaultSelectedDataViewId:t}){const{services:{data:{dataViews:n,search:{search:s}}}}=Object(D.d)(),[l,a]=Object(i.useState)([]),[o,r]=Object(i.useState)(t),[d,u]=Object(i.useState)(null),[p,m]=Object(i.useState)([]),j=q()(e.getInputField$(),e.getInputField()),b=Object(i.useCallback)((t=>e.setInputField(t)),[e]);Object(i.useEffect)((function(){!async function(){const t=await n.getIdsWithTitle(),i=e.getSupportedFieldTypes(),s=t.map((async({id:e})=>(await n.get(e)).fields.getAll().some((e=>i.some((t=>{var n;return null===(n=e.esTypes)||void 0===n?void 0:n.includes(t)})))))),l=await Promise.all(s),o=t.filter(((e,t)=>l[t]));a(o.sort(((e,t)=>e.title.localeCompare(t.title))).map((({id:e,title:t})=>({text:t,value:e}))))}()}),[n,e]),Object(i.useEffect)((function(){e.reset(),m([]),void 0!==o&&n.get(o).then((e=>u(e)))}),[o,n,e]);const x=Object(i.useCallback)((()=>{e.setInputText([]),void 0!==j&&null!==d&&Object(B.firstValueFrom)(s({params:{index:d.getIndexPattern(),body:{fields:[j],query:{function_score:{functions:[{random_score:{}}]}}}}})).then((t=>{const n=t.rawResponse.hits.hits.filter((({fields:e})=>Object(c.a)(e,[j]))).map((({fields:e})=>e[j][0]));e.setInputText(n)}))}),[e,d,s,j]);return Object(i.useEffect)((function(){if(null!==d){const t=d.fields.filter((({displayName:e,esTypes:t})=>t&&t.includes("text")&&!["_id","_index"].includes(e))).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((({displayName:e})=>({value:e,text:e})));m(t);const n=e.getInputField(),i=n&&t.find((e=>e.value===n))?n:t[0].value;e.setInputField(i)}}),[d,e]),Object(i.useEffect)((function(){x()}),[j]),{fieldNames:p,dataViewListItems:l,reloadExamples:function(){e.reset(),x()},selectedDataViewId:o,setSelectedDataViewId:r,selectedField:j,setSelectedField:b,setDataViewListItems:a}}({inferrer:e,defaultSelectedDataViewId:t}),{reloadExamples:o,selectedField:d}=a,[u,p]=Object(i.useState)(null),m=q()(e.getRunningState$(),e.getRunningState()),j=q()(e.getInputText$(),e.getInputText()),b=q()(e.getIsValid$(),e.getIsValid()),x=Object(i.useMemo)((()=>e.getOutputComponent()),[e]),f=Object(i.useMemo)((()=>e.getInfoComponent()),[e]),g=Object(i.useCallback)((async t=>{t.preventDefault(),p(null);try{await e.infer()}catch(e){p(Object(ye.a)(e))}}),[e]);return Object(E.jsx)(l.EuiForm,{component:"form",onSubmit:g},Object(E.jsx)(s.a.Fragment,null,f),Object(E.jsx)(we,{inferrer:e,data:a,disableIndexSelection:void 0!==t}),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(ke,{testButtonDisabled:m===U.RUNNING||!1===b,createPipelineButtonDisabled:m===U.RUNNING||!1===b,showCreatePipelineButton:!n,inferrer:e}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},m===U.RUNNING?Object(E.jsx)(l.EuiLoadingSpinner,{size:"xl"}):null),Object(E.jsx)(l.EuiFlexItem,null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{onClick:o,disabled:m===U.RUNNING||void 0===d},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.inferenceInputForm.reloadButton",defaultMessage:"Reload examples"})))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),null!==u||m===U.FINISHED_WITH_ERRORS?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(Ee,{errorText:u}),Object(E.jsx)(l.EuiSpacer,null)):null,m!==U.FINISHED?j.map((e=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiText,{size:"s"},e),Object(E.jsx)(l.EuiHorizontalRule,null)))):null,m===U.FINISHED?Object(E.jsx)(s.a.Fragment,null,x):null)},De=({inferrer:e,inputType:t})=>t===W.TEXT?Object(E.jsx)(Ce,{inferrer:e}):Object(E.jsx)(Le,{inferrer:e});var Pe=n(585);const Ae=({inferrer:e})=>{const t=q()(e.getInferenceResult$(),e.getInferenceResult());return t?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{color:"primary"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.textExpansion.output.info",defaultMessage:"The numbers below represent relevance scores for documents randomly selected from the index concerning the supplied query. Evaluating model recall is simpler when using a query related to the documents."})),Object(E.jsx)(l.EuiSpacer,{size:"m"}),t.sort(((e,t)=>t.response.score-e.response.score)).map((({response:e,inputText:t})=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(Ne,{response:e}),Object(E.jsx)(l.EuiHorizontalRule,null))))):null},Ne=({response:e})=>{const t=Re(e);return Object(E.jsx)(s.a.Fragment,null,void 0!==e.text?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiStat,{title:Object(Pe.a)(e.score,3),textAlign:"left",titleColor:t.color,description:Object(E.jsx)(l.EuiTextColor,{color:t.color},Object(E.jsx)("span",null,null!==t.icon?Object(E.jsx)(l.EuiIcon,{type:t.icon,color:t.color}):null,t.text))}),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)("span",{css:Object(E.css)({color:t.textColor},"","")},e.text),Object(E.jsx)(l.EuiSpacer,{size:"s"})):null)},Re=e=>{const{euiTheme:{euiColorMediumShade:t,euiTextSubduedColor:n,euiTextColor:i}}=Object(D.a)();return e.score>=5?{color:"success",textColor:i,icon:"check",text:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.output.goodMatch",{defaultMessage:"Good match"})}:e.score>0?{color:n,textColor:i,text:null,icon:null}:{color:t,textColor:t,text:null,icon:null}},ze=({inferrer:e})=>{const t=q()(e.getQueryText$(),e.getQueryText()),n=q()(e.getRunningState$(),e.getRunningState());return Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.queryInput",{defaultMessage:"Search query"})},Object(E.jsx)(l.EuiFieldText,{value:t,disabled:n===U.RUNNING,fullWidth:!0,onChange:t=>{e.setQueryText(t.target.value)}}))};class text_expansion_inference_TextExpansionInference extends inference_base_InferenceBase{constructor(e,t,n,i){super(e,t,n,i),z()(this,"inferenceType",m.i.TEXT_EXPANSION),z()(this,"inferenceTypeLabel",o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.label",{defaultMessage:"Text expansion"})),z()(this,"info",[o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.info",{defaultMessage:"Expand your search to include relevant terms in the results that are not present in the query."})]),z()(this,"queryText$",new B.BehaviorSubject("")),z()(this,"queryResults",{}),this.initialize([this.queryText$.pipe(Object(B.map)((e=>""!==e)))],[this.queryText$])}async inferText(){return this.runInfer((()=>{}),((e,t)=>({response:Be(e,"",this.queryResults),rawResponse:e,inputText:t})))}async inferIndex(){var e,t;const{docs:n}=await this.trainedModelsApi.trainedModelPipelineSimulate(this.getPipeline(),[{_source:{text_field:this.getQueryText()}}]);if(0===n.length)throw new Error(o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.noDocsError",{defaultMessage:"No docs loaded"}));return this.queryResults=null!==(e=null===(t=n[0].doc)||void 0===t?void 0:t._source[this.inferenceType].predicted_value)&&void 0!==e?e:{},this.runPipelineSimulate((e=>({response:Be({inference_results:[e._source[this.inferenceType]]},e._source[this.getInputField()],this.queryResults),rawResponse:e._source[this.inferenceType],inputText:e._source[this.getInputField()]})))}getProcessors(){return this.getBasicProcessors()}setQueryText(e){this.queryText$.next(e)}getQueryText$(){return this.queryText$.asObservable()}getQueryText(){return this.queryText$.getValue()}getInputComponent(){return e=this,t=o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.inputText",{defaultMessage:"Enter a phrase to test"}),Object(E.jsx)(s.a.Fragment,null,e.getInputType()===W.TEXT?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(J,{placeholder:t,inferrer:e}),Object(E.jsx)(l.EuiSpacer,null)):null,Object(E.jsx)(ze,{inferrer:e}));var e,t}getOutputComponent(){return Object(E.jsx)(Ae,{inferrer:this})}}function Be(e,t,n){const[{predicted_value:i}]=e.inference_results;if(void 0===i)throw new Error(o.i18n.translate("xpack.ml.trainedModels.testModelsFlyout.textExpansion.noPredictionError",{defaultMessage:"No results found"}));const s=Object.entries(i).map((([e,t])=>({token:e,value:t})));let l=0;const a=s.map((({token:e,value:t})=>{var i;const s=t*(null!==(i=n[e])&&void 0!==i?i:0);return l+=s,{token:e,value:s}}));return{text:t,score:l,originalTokenWeights:s,adjustedTokenWeights:a}}const $e="inputField",Ve={[m.i.QUESTION_ANSWERING]:["question"],[m.i.ZERO_SHOT_CLASSIFICATION]:["labels","multi_label"]};function Ge(e){return Object(c.a)(e,[m.i.QUESTION_ANSWERING])||Object(c.a)(e,[m.i.ZERO_SHOT_CLASSIFICATION])}function Ue(e,t){var n;const i={[$e]:""};return null===(n=t.processors)||void 0===n||n.forEach((t=>{const{inference:n}=t;if(n){if(i.inferenceObj=n,n.field_map){i.fieldMap=n.field_map;for(const[e,t]of Object.entries(n.field_map))t===G&&(i[$e]=e);""===i[$e]&&(i[$e]=Object.keys(n.field_map)[0])}var s;i.inferenceConfig=n.inference_config,Ge(i.inferenceConfig)&&"string"==typeof(l=e)&&Object.keys(Ve).includes(l)&&(null===(s=Ve[e])||void 0===s||s.forEach((t=>{const n=i.inferenceConfig&&i.inferenceConfig[e];i[t]=n&&n.hasOwnProperty(t)?n[t]:void 0})))}var l})),i}const We=({model:e,inputType:t,deploymentId:n,handlePipelineConfigUpdate:s,externalPipelineConfig:l,setCurrentContext:o})=>{const{trainedModels:r}=Object(D.c)(),d=Object(i.useMemo)((()=>{var i;const d=Object.keys(null!==(i=e.inference_config)&&void 0!==i?i:{})[0];let u;const p=l?Ue(d,l):null;if(e.model_type===m.j.PYTORCH)switch(d){case m.i.NER:u=new ner_inference_NerInference(r,e,t,n);break;case m.i.TEXT_CLASSIFICATION:u=new text_classification_inference_TextClassificationInference(r,e,t,n);break;case m.i.ZERO_SHOT_CLASSIFICATION:if(u=new zero_shot_classification_inference_ZeroShotClassificationInference(r,e,t,n),p){const{labels:e,multi_label:t}=p;e&&void 0!==t&&(u.setLabelsText(Array.isArray(e)?e.join(","):e),u.setMultiLabel(Boolean(t)))}break;case m.i.TEXT_EMBEDDING:u=new text_embedding_inference_TextEmbeddingInference(r,e,t,n);break;case m.i.FILL_MASK:u=new fill_mask_inference_FillMaskInference(r,e,t,n);break;case m.i.QUESTION_ANSWERING:u=new question_answering_inference_QuestionAnsweringInference(r,e,t,n),null!=p&&p.question&&u.setQuestionText(p.question);break;case m.i.TEXT_EXPANSION:u=new text_expansion_inference_TextExpansionInference(r,e,t,n)}else e.model_type===m.j.LANG_IDENT&&(u=new lang_ident_inference_LangIdentInference(r,e,t,n));var j;return u&&(p&&u.setInputField(p.inputField),void 0===l?u.setSwitchtoCreationMode((()=>{u&&o&&o({pipelineConfig:u.getPipeline(),defaultSelectedDataViewId:u.getSelectedDataViewId(),createPipelineFlyoutOpen:!0})})):null===(j=u)||void 0===j||j.getPipeline$().subscribe((e=>{if(s&&e&&l){const{fieldMap:n,inferenceConfig:i,labels:o,multi_label:r,question:u}=Ue(d,e),p=Object(a.cloneDeep)(l),{inferenceObj:j,inferenceConfig:b}=Ue(d,p);if(j)if(j.field_map=n,void 0===b)j.inference_config=i;else if(t=j,Object(c.a)(t)&&t.hasOwnProperty("inference_config")&&(Object(c.a)(t.inference_config,[m.i.QUESTION_ANSWERING])||Object(c.a)(t.inference_config,[m.i.ZERO_SHOT_CLASSIFICATION]))&&Ge(j.inference_config))if(d===m.i.ZERO_SHOT_CLASSIFICATION&&o&&void 0!==r){const e=j.inference_config[m.i.ZERO_SHOT_CLASSIFICATION];e&&(e.multi_label=r,e.labels=o)}else if(d===m.i.QUESTION_ANSWERING&&void 0!==u){const e=j.inference_config[m.i.QUESTION_ANSWERING];e&&(e.question=u)}s({initialPipelineConfig:p})}var t}))),u}),[t,e,r,n,o]);return Object(i.useEffect)((()=>()=>{null==d||d.destroy()}),[d,e.model_id]),void 0!==d?Object(E.jsx)(De,{inferrer:d,inputType:t}):null},He=({model:e,handlePipelineConfigUpdate:t,externalPipelineConfig:n})=>{const[a,o]=Object(i.useState)(e.deployment_ids[0]),d=Object(l.useEuiPaddingSize)("m"),[c,u]=Object(i.useState)(W.TEXT),{currentContext:{createPipelineFlyoutOpen:p},setCurrentContext:j}=N(),b=Object(i.useMemo)((()=>{var t;return(null!==(t=e.type)&&void 0!==t?t:[]).includes(m.i.TEXT_EXPANSION)||p?W.INDEX:void 0}),[e,p]);return Object(E.jsx)(s.a.Fragment,null," ",e.deployment_ids.length>1?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.deploymentIdLabel",defaultMessage:"Deployment ID"})},Object(E.jsx)(l.EuiSelect,{fullWidth:!0,options:e.deployment_ids.map((e=>({text:e,value:e}))),value:a,onChange:e=>{o(e.target.value)}})),Object(E.jsx)(l.EuiSpacer,{size:"l"})):null,void 0===b?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiTabs,{size:"m",css:Object(E.css)({marginTop:`-${d}`},"","")},Object(E.jsx)(l.EuiTab,{isSelected:c===W.TEXT,onClick:()=>u(W.TEXT)},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.textTab",defaultMessage:"Test using text"})),Object(E.jsx)(l.EuiTab,{isSelected:c===W.INDEX,onClick:()=>u(W.INDEX)},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.indexTab",defaultMessage:"Test using existing index"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"})):null,Object(E.jsx)(We,{model:e,inputType:null!=b?b:c,deploymentId:null!=a?a:e.model_id,handlePipelineConfigUpdate:t,externalPipelineConfig:n,setCurrentContext:j}))},qe=({model:e,onClose:t})=>Object(E.jsx)(l.EuiFlyout,{maxWidth:600,onClose:t,"data-test-subj":"mlTestModelsFlyout"},Object(E.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},Object(E.jsx)(l.EuiTitle,{size:"m"},Object(E.jsx)("h2",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testModelsFlyout.headerLabel",defaultMessage:"Test trained model"}))),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(l.EuiTitle,{size:"xs"},Object(E.jsx)("h4",null,e.model_id))),Object(E.jsx)(l.EuiFlyoutBody,null,Object(E.jsx)(He,{model:e}))),Je={DETAILS:"Details",CONFIGURE_PROCESSOR:"Configure processor",ON_FAILURE:"Failure handling",TEST:"Test",CREATE:"create"},Xe=o.i18n.translate("xpack.ml.trainedModels.actions.cancelButtonLabel",{defaultMessage:"Cancel"}),Qe=o.i18n.translate("xpack.ml.trainedModels.actions.clearButtonLabel",{defaultMessage:"Clear"}),Ke=o.i18n.translate("xpack.ml.trainedModels.actions.closeButtonLabel",{defaultMessage:"Close"}),Ye=o.i18n.translate("xpack.ml.trainedModels.actions.backButtonLabel",{defaultMessage:"Back"}),Ze=o.i18n.translate("xpack.ml.trainedModels.actions.continueButtonLabel",{defaultMessage:"Continue"}),et=o.i18n.translate("xpack.ml.trainedModels.actions.create.advancedDetails.editButtonText",{defaultMessage:"Edit"}),tt=o.i18n.translate("xpack.ml.trainedModels.actions.create.advancedDetails.createFieldMapText",{defaultMessage:"Create field map"}),nt=o.i18n.translate("xpack.ml.trainedModels.actions.create.advancedDetails.cancelEditButtonText",{defaultMessage:"Cancel"}),it=Object.values(Je),st="complete",lt="incomplete",at=Object(i.memo)((({step:e,setStep:t,isDetailsStepValid:n,isConfigureProcessorStepValid:i,hasProcessorStep:s,pipelineCreated:a})=>{const r=it.findIndex((t=>t===e)),d=[{onClick:()=>{a||t(Je.DETAILS)},status:n?st:lt,title:o.i18n.translate("xpack.ml.inferencePipeline.content.indices.transforms.addInferencePipelineModal.steps.details.title",{defaultMessage:"Details"})},{onClick:()=>{n&&!a&&t(Je.ON_FAILURE)},status:r>2?st:lt,title:o.i18n.translate("xpack.ml.inferencePipeline.content.indices.transforms.addInferencePipelineModal.steps.handleFailures.title",{defaultMessage:"Handle failures"})},{onClick:()=>{i&&n&&!a&&t(Je.TEST)},status:r>3?st:lt,title:o.i18n.translate("xpack.ml.trainedModels.content.indices.transforms.addInferencePipelineModal.steps.test.title",{defaultMessage:"Test (Optional)"})},{onClick:()=>{i&&!a&&t(Je.CREATE)},status:n&&i?lt:"disabled",title:o.i18n.translate("xpack.ml.inferencePipeline.content.indices.transforms.addInferencePipelineModal.steps.create.title",{defaultMessage:"Create"})}];let c,u,p,m,j;switch(!0===s&&d.splice(1,0,{onClick:()=>{n&&!a&&t(Je.CONFIGURE_PROCESSOR)},status:n&&i&&r>1?st:lt,title:o.i18n.translate("xpack.ml.inferencePipeline.content.indices.transforms.addInferencePipelineModal.steps.configureProcessor.title",{defaultMessage:"Configure processor"})}),s?[c,u,p,m,j]=[0,1,2,3,4,5]:[c,p,m,j]=[0,1,2,3,4],e){case Je.DETAILS:d[c].status="current";break;case Je.CONFIGURE_PROCESSOR:void 0!==u&&(d[u].status="current");break;case Je.ON_FAILURE:d[p].status="current";break;case Je.TEST:d[m].status="current";break;case Je.CREATE:d[j].status="current"}return Object(E.jsx)(l.EuiStepsHorizontal,{steps:d,size:"s"})})),ot=({isDetailsStepValid:e,isConfigureProcessorStepValid:t,creatingPipeline:n,pipelineCreated:s,onClose:a,onCreate:r,step:d,setStep:c,hasProcessorStep:u})=>{const{nextStep:p,previousStep:m,isContinueButtonEnabled:j}=Object(i.useMemo)((()=>function(e,t,n,i){let s,l,a=!1;switch(e){case Je.DETAILS:s=i?Je.CONFIGURE_PROCESSOR:Je.ON_FAILURE,a=t;break;case Je.CONFIGURE_PROCESSOR:s=Je.ON_FAILURE,l=Je.DETAILS,a=n;break;case Je.ON_FAILURE:s=Je.TEST,l=i?Je.CONFIGURE_PROCESSOR:Je.DETAILS,a=n;break;case Je.TEST:s=Je.CREATE,l=Je.ON_FAILURE,a=!0;break;case Je.CREATE:l=Je.TEST,a=!0}return{nextStep:s,previousStep:l,isContinueButtonEnabled:a}}(d,e,t,u)),[e,t,d,u]);return Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{onClick:a,"data-test-subj":"mlTrainedModelsInferencePipelineCloseButton"},s?Ke:Xe)),Object(E.jsx)(l.EuiFlexItem,null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},void 0!==m&&!1===s?Object(E.jsx)(l.EuiButtonEmpty,{flush:"both",iconType:"arrowLeft",onClick:()=>c(m)},Ye):null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},void 0!==p?Object(E.jsx)(l.EuiButton,{"data-test-subj":"mlTrainedModelsInferencePipelineContinueButton",iconType:"arrowRight",iconSide:"right",onClick:()=>c(p),disabled:!j,fill:!0},Ze):Object(E.jsx)(l.EuiButton,{"data-test-subj":"mlTrainedModelsInferencePipelineCreateButton",color:"success",disabled:!j||n||s,fill:!0,onClick:r,isLoading:n},o.i18n.translate("xpack.ml.trainedModels.content.indices.addInferencePipelineModal.footer.create",{defaultMessage:"Create pipeline"}))))};var rt=n(292),dt=n(82),ct=n(11);function ut(e=1e3){return new Promise((t=>{setTimeout(t,e)}))}async function pt(e){let t,n;try{t=await ct.ml.checkIndicesExists({indices:[e]})}catch(e){n=Object(ye.a)(e)}return{resp:t,errorMessage:n}}const mt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.destIndexEmpty",{defaultMessage:"Enter a valid destination index"}),jt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.destIndexExists",{defaultMessage:"An index with this name already exists."}),bt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.destIndexInvalid",{defaultMessage:'Index name cannot be empty. It must be lowercase. It cannot start with -, _, +. It cannot include \\\\, /, *, ?, ", <, >, |, space character, comma, #, :'}),xt=({pipelineName:e,sourceIndex:t})=>{var n;const[s,d]=Object(i.useState)(t?[{label:t}]:[]),[c,u]=Object(i.useState)([]),[p,m]=Object(i.useState)(""),[j,b]=Object(i.useState)(!1),[x,f]=Object(i.useState)(mt),[g,O]=Object(i.useState)(),[h,M]=Object(i.useState)(),[v,y]=Object(i.useState)(!1),[T,F]=Object(i.useState)(!1),[k,S]=Object(i.useState)(),{services:{application:{capabilities:C},share:_,data:w,mlServices:{mlApiServices:{getIndices:L,reindexWithPipeline:P,hasPrivileges:A}},docLinks:{links:N}}}=Object(D.d)(),{displayErrorToast:R}=Object(I.useToastNotificationService)(),z=Object(i.useMemo)((()=>!0===C.savedObjectsManagement.edit||!0===C.indexPatterns.save),[C]),B=Object(i.useMemo)((()=>Object(l.htmlIdGenerator)()()),[]),$=Object(i.useMemo)((()=>_.url.locators.get("DISCOVER_APP_LOCATOR")),[_.url.locators]),V=Object(i.useMemo)((()=>{var e;return void 0!==(null===(e=C.discover)||void 0===e?void 0:e.show)&&void 0!==$}),[null===(n=C.discover)||void 0===n?void 0:n.show,$]),G=Object(i.useCallback)((async e=>{if(void 0!==$)return await $.getRedirectUrl({indexPatternId:e,timeRange:w.query.timefilter.timefilter.getTime(),filters:w.query.filterManager.getFilters()})}),[$,w]),U=Object(a.debounce)((async()=>{const e=await pt(p);void 0!==e.errorMessage?R(e.errorMessage,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.errorCheckingIndexExists",{defaultMessage:"An error occurred getting the existing index names"})):e.resp&&b(e.resp[p].exists)}),400);Object(i.useEffect)((function(){void 0!==A&&s.length&&async function(){try{const e=await A({index:[{names:[s[0].label],privileges:["read"]},{names:[p],privileges:["write"]}]});F(void 0===e.hasPrivileges||!0===e.hasPrivileges.has_all_requested)}catch(e){const t=Object(ye.a)(e),n=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.indexPrivilegeErrorMessage",{defaultMessage:"User does not have required permissions to reindex {index}. {error}",values:{error:t,index:s[0].label}});S(n)}}()}),[A,t,p,s]),Object(i.useEffect)((function(){void 0!==p&&""!==p&&U()}),[p,U]),Object(i.useEffect)((function(){!async function(){const e=(await L()).map((e=>({label:e.name})));u(e)}()}),[L]),Object(i.useEffect)((function(){void 0!==g&&!0===v&&async function(){const e=await(async(e,t,n,i)=>{const s={success:!1,message:""},l=e,a=await async function(e){let t=15,n=await pt(e),i=n.resp&&n.resp[e]&&n.resp[e].exists;for(;t>1&&!i;)t--,await ut(1e3),n=await pt(e),i=n.resp&&n.resp[e]&&n.resp[e].exists;return i?{success:!0,indexExists:!0}:{success:!1,indexExists:!1,...void 0!==n.errorMessage?{errorMessage:n.errorMessage}:{}}}(e);if(!0===(null==a?void 0:a.success)){if(!0===(null==a?void 0:a.indexExists))try{const e=await t.createAndSave({title:l,...n?{timeFieldName:n}:{}},!1,!0);s.success=!0,s.message=o.i18n.translate("xpack.ml.dataframe.analytics.create.createDataViewSuccessMessage",{defaultMessage:"Kibana data view {dataViewName} created.",values:{dataViewName:l}}),s.dataViewId=e.id}catch(e){e instanceof dt.DuplicateDataViewError?(s.error=o.i18n.translate("xpack.ml.dataframe.analytics.create.duplicateDataViewErrorMessageError",{defaultMessage:"The data view {dataViewName} already exists.",values:{dataViewName:l}}),s.message=o.i18n.translate("xpack.ml.dataframe.analytics.create.duplicateDataViewErrorMessage",{defaultMessage:"An error occurred creating the Kibana data view:"})):(s.error=Object(ye.a)(e),s.message=o.i18n.translate("xpack.ml.dataframe.analytics.create.createDataViewErrorMessage",{defaultMessage:"An error occurred creating the Kibana data view:"}))}}else null!=a&&a.errorMessage?(s.error=o.i18n.translate("xpack.ml.dataframe.analytics.create.errorCheckingDestinationIndexDataFrameAnalyticsJob",{defaultMessage:"{errorMessage}",values:{errorMessage:a.errorMessage}}),s.message=o.i18n.translate("xpack.ml.dataframe.analytics.create.errorOccurredCheckingDestinationIndexDataFrameAnalyticsJob",{defaultMessage:"An error occurred checking destination index exists."})):(s.error=o.i18n.translate("xpack.ml.dataframe.analytics.create.destinationIndexNotCreatedForDataFrameAnalyticsJob",{defaultMessage:"Destination index has not yet been created."}),s.message=o.i18n.translate("xpack.ml.dataframe.analytics.create.unableToCreateDataViewForDataFrameAnalyticsJob",{defaultMessage:"Unable to create data view."}));return void 0!==i&&i({error:s.error,message:s.message}),s})(p,w.dataViews);if(!0===(null==e?void 0:e.success)&&null!=e&&e.dataViewId&&V){const t=await G(e.dataViewId);M(t)}}()}),[g,p,null==w?void 0:w.dataViews,G,V,v]);const W=Object(E.jsx)(l.EuiButton,{onClick:async()=>{try{const t=s[0].label,n=await P(e,t,p);O(n.task)}catch(e){R(e,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexErrorMessage",{defaultMessage:"An error occurred reindexing"}))}},disabled:0===s.length||void 0!==x&&s.length>0||!T||j,size:"s"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexLabel",defaultMessage:"Reindex"}));return Object(E.jsx)(l.EuiPanel,{hasShadow:!1,hasBorder:!1},void 0===g?Object(E.jsx)(l.EuiFlexGroup,{direction:"column"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiText,null,Object(E.jsx)("h4",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexingTitle",defaultMessage:"Reindex with pipeline"}))),Object(E.jsx)(l.EuiText,{size:"xs",color:"GrayText"},Object(E.jsx)(l.EuiLink,{href:N.upgradeAssistant.reindexWithPipeline,target:"_blank",external:!0},"Learn more."))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiIconTip,{content:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexingTooltip",defaultMessage:"Reindex data from the source index to a destination index using the new pipeline, which adds inference results to each document."}),position:"right"})))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.selectIndexLabel",defaultMessage:"Select index to reindex"})},Object(E.jsx)(l.EuiComboBox,{singleSelection:{asPlainText:!0},options:c,selectedOptions:s,onChange:e=>{d(e)}}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFormRow,{label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.destinationIndexLabel",defaultMessage:"Destination index name"}),isInvalid:void 0!==x||j,error:x||j?null!=x?x:jt:void 0},Object(E.jsx)(l.EuiFieldText,{value:p,onChange:e=>{m(e.target.value),""===e.target.value?f(mt):Object(rt.a)(e.target.value)?f(void 0):f(bt)},"aria-label":o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.destIndexFieldAriaLabel",{defaultMessage:"Enter the name of the destination index"})}))),z?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiCheckbox,{id:B,label:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.createDataViewLabel",{defaultMessage:"Create data view"}),checked:v,onChange:e=>y(e.target.checked)})):null,Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)("div",null,k?Object(E.jsx)(l.EuiToolTip,{position:"top",content:k},W):W))):Object(E.jsx)(l.EuiCallOut,{"data-test-subj":"mlTrainedModelsInferenceReviewAndCreateStepSuccessCallout",title:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexStartedMessage",{defaultMessage:"Reindexing of {sourceIndex} to {destinationIndex} has started.",values:{sourceIndex:s[0].label,destinationIndex:p}}),color:"success",iconType:"check"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexingTaskIdMessage",defaultMessage:"Reindexing task id {taskId} can be used to monitor the progress via the {tasksApi}.",values:{taskId:g,tasksApi:Object(E.jsx)(l.EuiLink,{href:`${N.apis.tasks}`,target:"_blank",external:!0},"task management API")}}),void 0!==h?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.reindexedlinkToDiscover",defaultMessage:" View {destIndexInDiscover} in Discover.",values:{destIndexInDiscover:Object(E.jsx)(l.EuiLink,{href:`${h}`,target:"_blank",external:!0},p)}}):null)))},ft=({highlightTargetField:e=!1,inferencePipeline:t,modelType:n,pipelineName:a,pipelineCreated:d,pipelineError:c,sourceIndex:u})=>{var p,m;const{services:{application:j,docLinks:{links:b}}}=Object(D.d)(),[x,f]=Object(i.useState)("closed"),g="regression"===n?b.ingest.inferenceRegression:b.ingest.inferenceClassification,O=Object(i.useMemo)((()=>Object(l.htmlIdGenerator)()()),[]),h=Object(i.useMemo)((()=>function(e){const{processors:t}=e;let n="";var i,s;return null!=t&&t.length&&(n=Object.keys(null!==(i=null===(s=t[0].inference)||void 0===s?void 0:s.field_map)&&void 0!==i?i:{})[0]),n}(t)),[t]),M=Object(i.useMemo)((()=>Object(E.jsx)(l.EuiCodeBlock,{language:"json",isCopyable:!0,overflowHeight:"400px","data-test-subj":"mlTrainedModelsInferenceReviewAndCreateStepConfigBlock"},JSON.stringify(null!=t?t:{},null,2))),[t]);return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"s","data-test-subj":"mlTrainedModelsInferenceReviewAndCreateStep"},Object(E.jsx)(l.EuiFlexItem,{grow:2},!1===d?Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.title",{defaultMessage:"Review the pipeline configuration for ''{pipelineName}''",values:{pipelineName:a}}))):null,Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiSpacer,{size:"s"}),!0===d&&void 0===c?Object(E.jsx)(l.EuiCallOut,{"data-test-subj":"mlTrainedModelsInferenceReviewAndCreateStepSuccessCallout",title:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.create.successMessage",{defaultMessage:"''{pipelineName}'' has been created successfully.",values:{pipelineName:a}}),color:"success",iconType:"check"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.create.reIndexingMessage",defaultMessage:"You can use this pipeline to infer against new data or infer against existing data by {reindexLink} with the pipeline.",values:{reindexLink:Object(E.jsx)(l.EuiLink,{onClick:()=>f("open")},"reindexing")}}),null!==(p=j.capabilities.management)&&void 0!==p&&null!==(m=p.ingest)&&void 0!==m&&m.ingest_pipelines?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.create.ingestPipelinesManagementMessage",defaultMessage:" Navigate to {pipelineManagementLink} to view and manage pipelines.",values:{pipelineManagementLink:Object(E.jsx)(l.EuiLink,{onClick:async()=>{await j.navigateToApp("management",{path:`/ingest/ingest_pipelines/?pipeline=${a}`,openInNewTab:!0})},target:"_blank",external:!0},"Ingest Pipelines")}}):null)):null,void 0!==c?Object(E.jsx)(l.EuiCallOut,{title:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.create.failureMessage",{defaultMessage:"Unable to create ''{pipelineName}''.",values:{pipelineName:a}}),color:"danger",iconType:"error"},Object(E.jsx)("p",null,c),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.create.docLinkInErrorMessage",defaultMessage:"Learn more about {ingestPipelineConfigLink} and {inferencePipelineConfigLink} configuration.",values:{ingestPipelineConfigLink:Object(E.jsx)(l.EuiLink,{href:b.ingest.pipelines,external:!0,target:"_blank"},"ingest pipeline"),inferencePipelineConfigLink:Object(E.jsx)(l.EuiLink,{href:n?g:b.ingest.inference,external:!0,target:"_blank"},"inference processor")}}))):null)),e?Object(E.jsx)(l.EuiFlexItem,{grow:2},Object(E.jsx)(l.EuiText,null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.targetFieldDescription",defaultMessage:"The field {field} will be targeted by the model for evaluation.",values:{field:Object(E.jsx)(l.EuiTextColor,{color:"accent"},h)}}))):null,Object(E.jsx)(l.EuiFlexItem,{grow:!0},d?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiAccordion,{id:O,buttonContent:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.nextStepsLabel",defaultMessage:"Next steps"}),forceState:x,onToggle:e=>{f(e?"open":"closed")}},Object(E.jsx)(xt,{pipelineName:a,sourceIndex:u}))):null),Object(E.jsx)(l.EuiFlexItem,{grow:!0},d?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiAccordion,{id:O,buttonContent:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.review.viewConfig",defaultMessage:"View configuration"})},M)):[M])))};var gt=n(90);const Ot=({onClick:e,disabled:t})=>Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:e,disabled:t,"data-test-subj":"mlTrainedModelsInferencePipelineFlyoutSaveChangesButton"},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.saveChangesButton",{defaultMessage:"Save changes"})),ht=e=>{var t,n;const i=null===(t=e.metadata)||void 0===t||null===(n=t.analytics_config)||void 0===n?void 0:n.analysis;return void 0!==i?Object(M.a)(i):void 0},Mt=e=>{var t;const n=ht(e);let i;return void 0!==n&&(i=e.inference_config?`ml.inference.${e.inference_config[n].results_field}`:void 0),{condition:void 0,creatingPipeline:!1,error:!1,fieldMap:void 0,ignoreFailure:!1,inferenceConfig:e.inference_config,modelId:e.model_id,onFailure:[{set:{description:"Index document to 'failed-<index>'",field:"_index",value:"failed-{{{ _index }}}"}},{set:{field:"event.timestamp",value:"{{{ _ingest.timestamp }}}"}},{set:{field:"event.failure.message",value:"{{{ _ingest.on_failure_message }}}"}},{set:{field:"event.failure.processor_type",value:"{{{ _ingest.on_failure_processor_type }}}"}},{set:{field:"event.failure.processor_tag",value:"{{{ _ingest.on_failure_processor_tag }}}"}},{set:{field:"event.failure.pipeline",value:"{{{ _ingest.on_failure_pipeline }}}"}}],pipelineDescription:`Uses the pre-trained data frame analytics model ${e.model_id} to infer against the data that is being ingested in the pipeline`,pipelineName:`ml-inference-${e.model_id}`,pipelineCreated:!1,tag:void 0,takeActionOnFailure:!0,targetField:null!==(t=i)&&void 0!==t?t:""}};var vt=n(180),yt={name:"1gfe5of",styles:"height:350px"};const Et=Object(i.memo)((({handleAdvancedConfigUpdate:e,ignoreFailure:t,onFailure:n,takeActionOnFailure:a})=>{const{services:{docLinks:{links:d}}}=Object(D.d)(),[c,u]=Object(i.useState)(!1),[p,m]=Object(i.useState)(!1),[j,b]=Object(i.useState)(JSON.stringify(n,null,2));return Object(E.jsx)(l.EuiFlexGroup,{direction:"column","data-test-subj":"mlTrainedModelsInferenceOnFailureStep"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.onFailureTitle",{defaultMessage:"Ingesting problematic documents"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.handleFailuresExplanation",defaultMessage:"If the model fails to produce a prediction, the document will be ingested without the prediction."})),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.handleFailuresDescription",defaultMessage:"By default, pipeline processing stops on failure. To run the pipeline's remaining processors despite the failure, {ignoreFailure} is set to true. {inferenceDocsLink}.",values:{ignoreFailure:Object(E.jsx)(l.EuiCode,null,"ignore_failure"),inferenceDocsLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:d.ingest.pipelineFailure},"Learn more.")}})),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.onFailureDescription",defaultMessage:"The {onFailure} configuration shown will be used as a default. It is used to specify a list of processors to run immediately after the inference processor failure and provides information on why the failure occurred. {onFailureDocsLink}",values:{onFailure:Object(E.jsx)(l.EuiCode,null,"on_failure"),onFailureDocsLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:d.ingest.pipelineFailure},"Learn more.")}})))),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(l.EuiFlexGroup,{direction:"column"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFormRow,{fullWidth:!0},Object(E.jsx)(l.EuiSwitch,{"data-test-subj":"mlTrainedModelsInferenceIgnoreFailureSwitch",label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.ignoreFailureLabel",defaultMessage:"Ignore failure and run the pipeline's remaining processors"}),checked:t,onChange:t=>{const n=t.target.checked;e({ignoreFailure:n,...!0===n?{takeActionOnFailure:!1,onFailure:void 0}:{}})}}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},!1===t?Object(E.jsx)(l.EuiFormRow,null,Object(E.jsx)(l.EuiSwitch,{"data-test-subj":"mlTrainedModelsInferenceTakeActionOnFailureSwitch",label:Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.noActionOnFailureLabel",defaultMessage:"Take action on failure"})),checked:a,onChange:t=>{return n=t.target.checked,e({takeActionOnFailure:n,onFailure:!1===n?void 0:[{set:{description:"Index document to 'failed-<index>'",field:"_index",value:"failed-{{{ _index }}}"}},{set:{field:"event.timestamp",value:"{{{ _ingest.timestamp }}}"}},{set:{field:"event.failure.message",value:"{{{ _ingest.on_failure_message }}}"}},{set:{field:"event.failure.processor_type",value:"{{{ _ingest.on_failure_processor_type }}}"}},{set:{field:"event.failure.processor_tag",value:"{{{ _ingest.on_failure_processor_tag }}}"}},{set:{field:"event.failure.pipeline",value:"{{{ _ingest.on_failure_pipeline }}}"}}]}),void(!1===n&&(u(!1),m(!0)));var n}})):null))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},!0===a&&!1===t?Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:Object(E.jsx)(l.EuiText,{size:"s"},Object(E.jsx)("strong",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.onFailureHeadingLabel",{defaultMessage:"Actions to take on failure"}))),labelAppend:Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs",justifyContent:"flexEnd"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{iconType:"pencil",size:"xs",onClick:()=>{u(!c)}},c?nt:et)),Object(E.jsx)(l.EuiFlexItem,{grow:!1},c?Object(E.jsx)(Ot,{onClick:()=>{e({onFailure:JSON.parse(j)}),u(!1)},disabled:!1===p}):null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},c?Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>{b(JSON.stringify([{set:{description:"Index document to 'failed-<index>'",field:"_index",value:"failed-{{{ _index }}}"}},{set:{field:"event.timestamp",value:"{{{ _ingest.timestamp }}}"}},{set:{field:"event.failure.message",value:"{{{ _ingest.on_failure_message }}}"}},{set:{field:"event.failure.processor_type",value:"{{{ _ingest.on_failure_processor_type }}}"}},{set:{field:"event.failure.processor_tag",value:"{{{ _ingest.on_failure_processor_tag }}}"}},{set:{field:"event.failure.pipeline",value:"{{{ _ingest.on_failure_pipeline }}}"}}],null,2)),m(!0)}},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.resetOnFailureButton",{defaultMessage:"Reset"})):null)),helpText:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.onFailureHelpText",defaultMessage:"In case of failure, this configuration stores the document, provides the timestamp at which ingest failed, and the context for the failure."})},Object(E.jsx)(s.a.Fragment,null,c?null:Object(E.jsx)(l.EuiCodeBlock,{"data-test-subj":"mlTrainedModelsInferenceOnFailureCodeBlock",isCopyable:!0,overflowHeight:350,css:yt},JSON.stringify(n,null,2)),c?Object(E.jsx)(gt.CodeEditor,{"data-test-subj":"mlTrainedModelsInferenceOnFailureEditor",height:300,languageId:"json",options:{automaticLayout:!0,lineNumbers:"off",tabSize:2},value:j,onChange:e=>{b(e);const t=Object(vt.c)(e);m(t)}}):null)):null))))))})),Tt=({modelId:e})=>{const{services:{docLinks:{links:t}}}=Object(D.d)();return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.title",{defaultMessage:"Create a pipeline"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.description",defaultMessage:"Build a {pipeline} to use the trained model - {modelId} - for inference.",values:{modelId:Object(E.jsx)(l.EuiCode,null,e),pipeline:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:t.ingest.pipelines},"pipeline")}})),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.descriptionUsePipelines",defaultMessage:"Use {pipelineSimulateLink} or {reindexLink} to pass data into this pipeline. Predictions are stored in the Target field.",values:{reindexLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:t.upgradeAssistant.reindexWithPipeline},"_reindex API"),pipelineSimulateLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:t.apis.simulatePipeline},"pipeline/_simulate")}}))))},It=({pipelineName:e,pipelineNameError:t,pipelineDescription:n,handlePipelineConfigUpdate:i})=>{const a=(e,t)=>{i({[t]:e})};return Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.nameLabel",{defaultMessage:"Name"}),helpText:!t&&Object(E.jsx)(l.EuiText,{size:"xs"},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.name.helpText",{defaultMessage:"Pipeline names are unique within a deployment and can only contain letters, numbers, underscores, and hyphens."})),error:t,isInvalid:void 0!==t},Object(E.jsx)(l.EuiFieldText,{"data-test-subj":"mlTrainedModelsInferencePipelineNameInput",fullWidth:!0,placeholder:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.namePlaceholder",{defaultMessage:"Enter a unique name for this pipeline"}),value:e,onChange:e=>a(e.target.value,"pipelineName")})),Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.descriptionLabel",{defaultMessage:"Description"}),helpText:Object(E.jsx)(l.EuiText,{size:"xs"},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.description.helpText",{defaultMessage:"A description of the pipeline."}))},Object(E.jsx)(l.EuiTextArea,{compressed:!0,fullWidth:!0,"data-test-subj":"mlTrainedModelsInferencePipelineDescriptionInput",placeholder:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.descriptionPlaceholder",{defaultMessage:"Add a pipeline description."}),value:n,onChange:e=>a(e.target.value,"pipelineDescription")})))},Ft=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.invalidPipelineName",{defaultMessage:"Name must only contain letters, numbers, underscores, and hyphens."}),kt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.emptyValueError",{defaultMessage:"Field is required."}),St=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.noEmptyInferenceConfigObjectError",{defaultMessage:"Inference configuration cannot be an empty object."}),Ct=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.pipelineNameExistsError",{defaultMessage:"Name already used by another pipeline."}),_t=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.emptyValueError",{defaultMessage:"Field map must include fields expected by the model."}),wt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.incorrectModelTypeError",{defaultMessage:"Inference configuration inference type must match model type."}),Lt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.processorRequiredError",{defaultMessage:"At least one processor is required to create the pipeline."}),Dt=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.inferenceProcessorRequiredError",{defaultMessage:"An inference processor specifying 'model_id' is required."}),Pt=/^[\w\-]+$/,At=(e,t)=>{const n={};var i;return 0===e.trim().length||""===e?n.pipelineName=kt:(i=e).length>0&&Pt.test(i)||(n.pipelineName=Ft),void 0!==t.find((t=>t===e))&&(n.pipelineName=Ct),n},Nt=(e,t)=>{const n=Object.keys(null!=e?e:{});let i;return e&&0===Object.keys(e).length?(i=St,i):t&&e&&n.length>0?(t===n[0]||(i=wt),i):i},Rt=Object(i.memo)((({handlePipelineConfigUpdate:e,modelId:t,pipelineName:n,pipelineNameError:s,pipelineDescription:a,initialPipelineConfig:r,setHasUnsavedChanges:d,taskType:c})=>{const[u,p]=Object(i.useState)(!0),[m,j]=Object(i.useState)(),{currentContext:{pipelineConfig:b}}=N(),[x,f]=Object(i.useState)(JSON.stringify(null!=r?r:{},null,2)),[g,O]=Object(i.useState)(!1);return Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(Tt,{modelId:t})),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(l.EuiPanel,{hasBorder:!1,hasShadow:!1},Object(E.jsx)(l.EuiForm,{component:"form"},Object(E.jsx)(It,{pipelineName:n,pipelineDescription:a,pipelineNameError:s,handlePipelineConfigUpdate:e}),Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,labelAppend:Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigEditButton",iconType:"pencil",size:"xs",onClick:()=>{const e=!g;!1===e&&(j(void 0),p(!0),d(!1)),O(e)}},g?nt:et)),Object(E.jsx)(l.EuiFlexItem,{grow:!1},g?Object(E.jsx)(Ot,{onClick:()=>{const t=((e,t)=>{const{processors:n}=e;let i;(!Array.isArray(n)||Array.isArray(n)&&n.length<1)&&(i=Lt);const s=null==n?void 0:n.find((e=>e.inference&&e.inference.model_id));if(void 0===s)i=Dt;else{var l;const e=null===(l=s.inference)||void 0===l?void 0:l.inference_config;t&&e&&(i=Nt(e,t))}return i})(JSON.parse(x),c);void 0===t?(e({initialPipelineConfig:JSON.parse(x)}),d(!1),O(!1),j(void 0)):(d(!0),p(!1),j(t))},disabled:!1===u}):null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},g?Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>{f(JSON.stringify(b,null,2)),p(!0),j(void 0)}},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.resetInferenceConfigButton",{defaultMessage:"Reset"})):null)),error:m,isInvalid:void 0!==m,"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigEditor"},g?Object(E.jsx)(gt.CodeEditor,{height:300,languageId:"json",options:{automaticLayout:!0,lineNumbers:"off",tabSize:2},value:x,onChange:e=>{f(e);const t=Object(vt.c)(e);p(t)}}):Object(E.jsx)(l.EuiCodeBlock,{isCopyable:!0,"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigBlock"},x))))))})),zt=({model:e,handlePipelineConfigUpdate:t,externalPipelineConfig:n})=>{const{services:{docLinks:{links:i}}}=Object(D.d)();return Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.testTrainedModelTitle",{defaultMessage:"Try it out"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.testTrainedModelExplanation",defaultMessage:"Test the model to ensure it's working properly."})),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.testTrainedModelDescription",defaultMessage:"Test the model against new data by either providing input text or using a field of an existing index. Alternatively, you can use the infer trained model API. {inferTrainedModelApiLink}.",values:{inferTrainedModelApiLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:i.apis.inferTrainedModel},"Learn more.")}})))),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(He,{model:e,handlePipelineConfigUpdate:t,externalPipelineConfig:n})))};function Bt(e){var t;const{ignoreFailure:n,modelId:i,onFailure:s,pipelineDescription:l,initialPipelineConfig:a}=e,o=null!=a&&a.processors&&null!==(t=a.processors)&&void 0!==t&&t.length?null==a?void 0:a.processors[0]:{};return{description:l,processors:[{inference:{...null!=o&&o.inference?{...o.inference,ignore_failure:n,...s&&Object.keys(s).length>0?{on_failure:s}:{on_failure:void 0}}:{},model_id:i}}]}}const $t=()=>{const[e,t]=Object(i.useState)([]),{notifications:{toasts:n}}=Object(D.d)(),{trainedModels:{getAllIngestPipelines:s}}=Object(D.c)();return Object(i.useEffect)((()=>{!async function(){let e=[];try{const n=await s();e=Object.keys(n),t(e)}catch(e){n.danger({title:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.fetchIngestPipelinesError",{defaultMessage:"Unable to fetch ingest pipelines."}),body:e.message,toastLifeTimeMs:5e3})}}()}),[s,n]),e},Vt=({onClose:e,model:t})=>{const{currentContext:{pipelineConfig:n}}=N(),s=Object(i.useMemo)((()=>((e,t)=>({creatingPipeline:!1,error:!1,ignoreFailure:!1,modelId:e.model_id,onFailure:[{set:{description:"Index document to 'failed-<index>'",field:"_index",value:"failed-{{{ _index }}}"}},{set:{field:"event.timestamp",value:"{{{ _ingest.timestamp }}}"}},{set:{field:"event.failure.message",value:"{{{ _ingest.on_failure_message }}}"}},{set:{field:"event.failure.processor_type",value:"{{{ _ingest.on_failure_processor_type }}}"}},{set:{field:"event.failure.processor_tag",value:"{{{ _ingest.on_failure_processor_tag }}}"}},{set:{field:"event.failure.pipeline",value:"{{{ _ingest.on_failure_pipeline }}}"}}],pipelineDescription:`Uses the pre-trained model ${e.model_id} to infer against the data that is being ingested in the pipeline`,pipelineName:`ml-inference-${e.model_id}`,pipelineCreated:!1,initialPipelineConfig:t,takeActionOnFailure:!0}))(t,n)),[t.model_id,n]),[a,r]=Object(i.useState)(s),[d,c]=Object(i.useState)(Je.DETAILS),[u,p]=Object(i.useState)(!1),m=Object(i.useMemo)((()=>{var e;return Object.keys(null!==(e=t.inference_config)&&void 0!==e?e:{})[0]}),[t.model_id]),{trainedModels:{createInferencePipeline:j}}=Object(D.c)(),b=$t(),x=e=>{const t={...a,...e};r(t)},f=e=>{c(e)},{pipelineName:g}=Object(i.useMemo)((()=>At(a.pipelineName,b)),[b,a.pipelineName]);return Object(E.jsx)(l.EuiFlyout,{onClose:e.bind(null,!0),size:"l","data-test-subj":"mlTrainedModelsFromTestInferencePipelineFlyout"},Object(E.jsx)(l.EuiFlyoutHeader,null,Object(E.jsx)(l.EuiTitle,{size:"m"},Object(E.jsx)("h3",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.createInferencePipeline.title",{defaultMessage:"Create inference pipeline"})))),Object(E.jsx)(l.EuiFlyoutBody,null,Object(E.jsx)(at,{step:d,setStep:f,isDetailsStepValid:void 0===g,isConfigureProcessorStepValid:!1===u,hasProcessorStep:!1,pipelineCreated:a.pipelineCreated}),Object(E.jsx)(l.EuiSpacer,{size:"m"}),d===Je.DETAILS&&Object(E.jsx)(Rt,{handlePipelineConfigUpdate:x,pipelineName:a.pipelineName,pipelineNameError:g,pipelineDescription:a.pipelineDescription,modelId:t.model_id,taskType:m,initialPipelineConfig:a.initialPipelineConfig,setHasUnsavedChanges:p}),d===Je.ON_FAILURE&&Object(E.jsx)(Et,{ignoreFailure:a.ignoreFailure,takeActionOnFailure:a.takeActionOnFailure,handleAdvancedConfigUpdate:x,onFailure:a.onFailure}),d===Je.TEST&&Object(E.jsx)(zt,{model:t,handlePipelineConfigUpdate:x,externalPipelineConfig:Bt(a)}),d===Je.CREATE&&Object(E.jsx)(ft,{highlightTargetField:!0,inferencePipeline:Bt(a),pipelineName:a.pipelineName,pipelineCreated:a.pipelineCreated,pipelineError:a.pipelineError})),Object(E.jsx)(l.EuiFlyoutFooter,{className:"mlTrainedModelsInferencePipelineFlyoutFooter"},Object(E.jsx)(ot,{onClose:e,onCreate:async()=>{r({...a,creatingPipeline:!0});try{const e=Bt(a);await j(a.pipelineName,e),r({...a,pipelineCreated:!0,creatingPipeline:!1,pipelineError:void 0})}catch(t){var e;console.error(t);const n=Object(ye.b)(t);r({...a,creatingPipeline:!1,pipelineError:null!==(e=n.message)&&void 0!==e?e:t.message})}},step:d,setStep:f,isDetailsStepValid:void 0===g,isConfigureProcessorStepValid:!1===u,pipelineCreated:a.pipelineCreated,creatingPipeline:a.creatingPipeline,hasProcessorStep:!1})))},Gt=({model:e,onClose:t})=>{const[n,s]=Object(i.useState)({pipelineConfig:void 0,createPipelineFlyoutOpen:!1});return Object(E.jsx)(A.Provider,{value:{currentContext:n,setCurrentContext:s}},!1===n.createPipelineFlyoutOpen?Object(E.jsx)(qe,{model:e,onClose:t}):Object(E.jsx)(Vt,{model:e,onClose:t}))},Ut=Object.values(m.i);function Wt(e){var t,n,i;return void 0!==(null===(t=e.metadata)||void 0===t?void 0:t.analytics_config)||void 0!==(null===(n=e.inference_config)||void 0===n?void 0:n.regression)||void 0!==(null===(i=e.inference_config)||void 0===i?void 0:i.classification)}function Ht(e,t=!1){var n,i,s;return!(e.model_type!==m.j.PYTORCH||!Ut.includes(Object.keys(null!==(n=e.inference_config)&&void 0!==n?n:{})[0])||!(!1===t||null!==(i=e.stats)&&void 0!==i&&null!==(s=i.deployment_stats)&&void 0!==s&&s.some((e=>e.state===m.c.STARTED))))||e.model_type===m.j.LANG_IDENT||Wt(e)}var qt=n(70);var Jt=n(267),Xt=n(227),Qt=n(245);const Kt=({models:e,onClose:t})=>{const n=Object(v.b)(),{displayErrorToast:a,displaySuccessToast:d}=Object(I.useToastNotificationService)(),[u,p]=Object(i.useState)(!1),[m,j]=Object(i.useState)(!1),b=e.map((e=>e.model_id)),x=e.filter((e=>Object(c.a)(e.pipelines))),f=e.filter((e=>e.hasInferenceServices)),g=f.flatMap((e=>{var t;return(null!==(t=e.inference_apis)&&void 0!==t?t:[]).map((e=>e.inference_id))})),O=x.reduce(((e,t)=>e+Object.keys(t.pipelines).length),0),h=Object(i.useCallback)((async()=>{try{await Promise.all(b.map((e=>n.deleteTrainedModel(e,{with_pipelines:m,force:O>0})))),d(o.i18n.translate("xpack.ml.trainedModels.modelsList.successfullyDeletedMessage",{defaultMessage:"{modelsCount, plural, one {Model {modelIds}} other {# models}} {modelsCount, plural, one {has} other {have}} been successfully deleted",values:{modelsCount:b.length,modelIds:b.join(", ")}}))}catch(e){a(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchDeletionErrorMessage",{defaultMessage:"{modelsCount, plural, one {Model} other {Models}} deletion failed",values:{modelsCount:b.length}}))}t(!0)}),[b,n,m,O]);return u?Object(E.jsx)(l.EuiModal,{onClose:t.bind(null,!1),initialFocus:"[name=cancelModelDeletion]","data-test-subj":"mlModelsDeleteModal"},Object(E.jsx)(l.EuiModalHeader,null,Object(E.jsx)(l.EuiModalHeaderTitle,null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.header",defaultMessage:"Delete {modelsCount, plural, one {{modelId}} other {# models}}?",values:{modelId:b[0],modelsCount:b.length}}))),Object(E.jsx)(l.EuiModalBody,null,x.length>0?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.pipelinesWarningHeader",defaultMessage:"{modelsCount, plural, one {{modelId} has} other {# models have}} associated pipelines.",values:{modelsCount:x.length,modelId:x[0].model_id}}),color:"warning",iconType:"warning"},Object(E.jsx)("div",null,Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.warningMessage",defaultMessage:"Deleting the trained model and its associated {pipelinesCount, plural, one {pipeline} other {pipelines}} will permanently remove these resources. Any process configured to send data to the {pipelinesCount, plural, one {pipeline} other {pipelines}} will no longer be able to do so once you delete the {pipelinesCount, plural, one {pipeline} other {pipelines}}. Deleting only the trained model will cause failures in the {pipelinesCount, plural, one {pipeline} other {pipelines}} that {pipelinesCount, plural, one {depends} other {depend}} on the model.",values:{pipelinesCount:O}})),Object(E.jsx)(l.EuiCheckbox,{id:"delete-model-pipelines",label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.approvePipelinesDeletionLabel",defaultMessage:"Delete {pipelinesCount, plural, one {pipeline} other {pipelines}}",values:{pipelinesCount:O}}),checked:m,onChange:j.bind(null,(e=>!e)),"data-test-subj":"mlModelsDeleteModalDeletePipelinesCheckbox"})),Object(E.jsx)("ul",null,x.flatMap((e=>Object.keys(e.pipelines).map((e=>Object(E.jsx)("li",{key:e},e))))))),Object(E.jsx)(l.EuiSpacer,{size:"m"})):null,f.length>0?Object(E.jsx)(l.EuiCallOut,{title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.inferenceAPIWarningHeader",defaultMessage:"{modelsCount, plural, one {{modelId} has} other {# models have}} associated inference services.",values:{modelsCount:f.length,modelId:f[0].model_id}}),color:"warning",iconType:"warning"},Object(E.jsx)("ul",null,g.map((e=>Object(E.jsx)("li",{key:e},e)))),Object(E.jsx)("div",null,Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.warningInferenceMessage",defaultMessage:"Deleting the trained model will cause failures in the inference {inferenceAPIsCount, plural, one {service} other {services}} that {inferenceAPIsCount, plural, one {depends} other {depend}} on the model.",values:{inferenceAPIsCount:g.length}})))):null),Object(E.jsx)(l.EuiModalFooter,null,Object(E.jsx)(l.EuiButtonEmpty,{onClick:t.bind(null,!1),name:"cancelModelDeletion"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(E.jsx)(l.EuiButton,{onClick:h.bind(null),fill:!0,color:"danger","data-test-subj":"mlModelsDeleteModalConfirmButton"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModal.deleteButtonLabel",defaultMessage:"Delete"})))):Object(E.jsx)(Qt.a,{ids:b,mlSavedObjectType:"trained-model",canDeleteCallback:p.bind(null,!0),onCloseCallback:t.bind(null,!0),refreshJobsCallback:()=>{},hasManagedJob:!1})};var Yt=n(251),Zt=n(45),en=n(160),tn=n(169),nn=n(33);function sn(e){const{condition:t,fieldMap:n,ignoreFailure:i,inferenceConfig:s,modelId:l,onFailure:a,pipelineDescription:o,tag:r,targetField:d}=e;return{description:o,processors:[{inference:{model_id:l,ignore_failure:i,...d&&""!==d?{target_field:d}:{},...n&&Object.keys(n).length>0?{field_map:n}:{},...s&&Object.keys(s).length>0?{inference_config:s}:{},...t&&""!==t?{if:t}:{},...r&&""!==r?{tag:r}:{},...a&&Object.keys(a).length>0?{on_failure:a}:{}}}]}}const ln="stand_alone",an="step",on=o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.sourceIndexMissing",{defaultMessage:"The source index used to train the model is missing. Enter text for documents to test the pipeline."}),rn=Object(i.memo)((({state:e,sourceIndex:t,mode:n})=>{const[a,d]=Object(i.useState)(),[c,u]=Object(i.useState)(),[p,m]=Object(i.useState)(),[j,b]=Object(i.useState)(""),[x,f]=Object(i.useState)(""),[g,O]=Object(i.useState)(!0),[h,M]=Object(i.useState)(!0),{esSearch:v,trainedModels:{trainedModelPipelineSimulate:y}}=Object(D.c)(),{notifications:{toasts:T},services:{docLinks:{links:I}}}=Object(D.d)(),F=Object(l.useIsWithinMaxBreakpoint)("s"),k=Object(i.useMemo)((()=>Object(l.htmlIdGenerator)()()),[]),S=Object(i.useMemo)((()=>sn(e)),[e]),C=Object(i.useMemo)((()=>{const e={pipeline:S,docs:[]};return Object(vt.c)(j)&&(e.docs=JSON.parse(j)),e}),[S,j]),_=e=>{b(e);const t=Object(vt.c)(e);O(t)},w=Object(i.useCallback)((async e=>{let t,n=[];try{t=await v(e),t&&t.hits.total.value>0&&(n=t.hits.hits)}catch(e){console.error(e)}b(JSON.stringify(n,null,2)),d(void 0),f(JSON.stringify(n,null,2)),O(!0)}),[v]),{getSampleDoc:L,getRandomSampleDoc:P}=Object(i.useMemo)((()=>({getSampleDoc:async()=>{w({index:t,body:{size:1}})},getRandomSampleDoc:async()=>{w({index:t,body:{size:1,query:{function_score:{query:{match_all:{}},random_score:{}}}}})}})),[w,t]);return Object(i.useEffect)((function(){t&&async function(){const e=await pt(t);!1===(e.resp&&e.resp[t]&&e.resp[t].exists)&&m(on)}()}),[t,p]),Object(i.useEffect)((function(){t&&void 0===p&&L()}),[t,L,p]),Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"xs","data-test-subj":"mlTrainedModelsInferenceTestStep"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.title",{defaultMessage:"Test the pipeline results"})))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,n===an?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)("strong",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.optionalCallout",{defaultMessage:"This is an optional step."}))," "):null,Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.description",defaultMessage:"Run a simulation of the pipeline to confirm it produces the anticipated results. {simulatePipelineDocsLink}",values:{simulatePipelineDocsLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:I.apis.simulatePipeline},"Learn more.")}}),Object(E.jsx)("br",null)),e.targetField&&Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.targetFieldHint",defaultMessage:"Check for the target field {targetField} for the prediction in the Result tab.",values:{targetField:Object(E.jsx)(l.EuiCode,null,e.targetField)}}),Object(E.jsx)("br",null)),j&&void 0===p?Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.sourceIndexDocText",defaultMessage:"The provided sample document is taken from the source index used to train the model."}):null))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),p&&h?Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiCallOut,{onDismiss:()=>{M(!1)},size:"s",title:p,iconType:"warning"}),Object(E.jsx)(l.EuiSpacer,{size:"s"})):null,n===ln?Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiAccordion,{id:k,buttonContent:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.viewRequest",defaultMessage:"View request body"})},Object(E.jsx)(l.EuiCodeBlock,{language:"json",isCopyable:!0,overflowHeight:"400px","data-test-subj":"mlTrainedModelsInferenceTestStepConfigBlock"},JSON.stringify(C,null,2)))):null),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiPanel,{hasBorder:!1,hasShadow:!1},Object(E.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"xs"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)("div",null,Object(E.jsx)(l.EuiButton,{onClick:async()=>{try{const e=await y(S,JSON.parse(j));d(e)}catch(e){console.error(e);const t=Object(ye.b)(e);u(e),T.danger({title:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.errorSimulatingPipeline",{defaultMessage:"Unable to simulate pipeline."}),body:t.message,toastLifeTimeMs:5e3})}},disabled:""===j||!g},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.runButton",{defaultMessage:"Simulate pipeline"})))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>{d(void 0),u(void 0)},disabled:void 0===a},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.clearResultsButton",{defaultMessage:"Clear results"}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>b(x),disabled:""===j||j===x},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.resetSampleDocsButton",{defaultMessage:"Reset"}))),Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:P,disabled:""===j},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.reloadSampleDocsButton",{defaultMessage:"Reload"})))),Object(E.jsx)(l.EuiSpacer,{size:"m"})),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiText,null,Object(E.jsx)("h5",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.subtitle.documents",{defaultMessage:"Raw document"})))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiText,null,Object(E.jsx)("h5",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.test.subtitle.result",{defaultMessage:"Result"})))))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiResizableContainer,{direction:F?"vertical":"horizontal",css:Object(E.css)("min-height:calc(",nn.euiThemeVars.euiSizeXL," * 10);","")},((e,t)=>Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(e,{grow:!0,hasBorder:!0,initialSize:50,paddingSize:"xs"},Object(E.jsx)(gt.CodeEditor,{"data-test-subj":"mlTrainedModelsInferenceTestDocsEditor",languageId:"json",options:{automaticLayout:!0,lineNumbers:"off",tabSize:2},value:j,onChange:_})),Object(E.jsx)(e,{grow:!1,hasBorder:!0,initialSize:50,paddingSize:"xs"},Object(E.jsx)(l.EuiCodeBlock,{language:"json",isCopyable:!0,"data-test-subj":"mlTrainedModelsInferenceTestResult"},c?JSON.stringify(c,null,2):a?JSON.stringify(a,null,2):"{}")))))),Object(E.jsx)(l.EuiSpacer,null))))})),dn=({model:e,onClose:t})=>{const n=Object(i.useMemo)((()=>{var t,n,i;return Array.isArray(null===(t=e.metadata)||void 0===t?void 0:t.analytics_config.source.index)?null===(n=e.metadata)||void 0===n?void 0:n.analytics_config.source.index.join():null===(i=e.metadata)||void 0===i?void 0:i.analytics_config.source.index}),[null==e?void 0:e.model_id]),s=Object(i.useMemo)((()=>Mt(e)),[null==e?void 0:e.model_id]);return Object(E.jsx)(l.EuiFlyout,{size:"l",onClose:t,"data-test-subj":"mlTestModelsFlyout"},Object(E.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},Object(E.jsx)(l.EuiTitle,{size:"m"},Object(E.jsx)("h2",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.testDfaModelsFlyout.headerLabel",defaultMessage:"Test trained model"}))),Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(l.EuiTitle,{size:"xs"},Object(E.jsx)("h4",null,e.model_id))),Object(E.jsx)(l.EuiFlyoutBody,null,Object(E.jsx)(rn,{state:s,sourceIndex:n,mode:ln})))},cn=Object(i.memo)((({handlePipelineConfigUpdate:e,modelId:t,pipelineName:n,pipelineNameError:i,pipelineDescription:s,targetField:a,targetFieldError:d})=>Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(Tt,{modelId:t})),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(l.EuiPanel,{hasBorder:!1,hasShadow:!1},Object(E.jsx)(l.EuiForm,{component:"form"},Object(E.jsx)(It,{pipelineName:n,pipelineDescription:s,pipelineNameError:i,handlePipelineConfigUpdate:e}),Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.targetFieldLabel",{defaultMessage:"Target field (optional)"}),helpText:!d&&Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.configure.targetFieldHelpText",defaultMessage:"Field used to contain inference processor results. Defaults to {targetField}.",values:{targetField:Object(E.jsx)(l.EuiCode,null,"ml.inference.<processor_tag>")}}),error:d,isInvalid:void 0!==d},Object(E.jsx)(l.EuiFieldText,{fullWidth:!0,"data-test-subj":"mlTrainedModelsInferencePipelineTargetFieldInput",value:a,onChange:t=>{return n=t.target.value,i="targetField",void e({[i]:n});var n,i}})))))))),un=Object(i.memo)((({handleAdvancedConfigUpdate:e,condition:t,tag:n})=>{var s,a;const[d,c]=Object(i.useState)(t||n?{condition:t,tag:n}:void 0),{services:{docLinks:{links:u}}}=Object(D.d)(),p=e=>{c({...d,...e})},m=Object(i.useMemo)((()=>Object(l.htmlIdGenerator)()()),[]),j=Object(i.useMemo)((()=>(null==d?void 0:d.tag)!==n||(null==d?void 0:d.condition)!==t),[d,n,t]);return Object(E.jsx)(l.EuiAccordion,{"data-test-subj":"mlTrainedModelsInferenceAdvancedSettingsAccordion",id:m,buttonContent:Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs"},Object(E.jsx)(l.EuiFlexItem,{grow:!1,"data-test-subj":"mlTrainedModelsInferenceAdvancedSettingsAccordionButton"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.additionalSettingsLabel",defaultMessage:"Additional settings"})),Object(E.jsx)(l.EuiFlexItem,{grow:!1},j?Object(E.jsx)(Ot,{onClick:()=>{e({...d})},disabled:void 0===d}):null))},Object(E.jsx)(l.EuiPanel,{color:"subdued"},Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.conditionLabel",defaultMessage:"Condition (optional)"}),helpText:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.conditionHelpText",defaultMessage:"This condition must be written as a {painlessDocs} script. If provided, this inference processor only runs when condition is true.",values:{painlessDocs:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:u.scriptedFields.painlessWalkthrough},"Painless")}})},Object(E.jsx)(l.EuiTextArea,{"data-test-subj":"mlTrainedModelsInferenceAdvancedSettingsConditionTextArea","aria-label":o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.conditionAriaLabel",{defaultMessage:"Optional condition for running the processor"}),value:null!==(s=null==d?void 0:d.condition)&&void 0!==s?s:"",onChange:e=>p({condition:e.target.value})}))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,{direction:"column"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,label:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.TagLabel",defaultMessage:"Tag (optional)"}),helpText:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.tagHelpText",defaultMessage:"Identifier for the processor. Useful for debugging and metrics."})},Object(E.jsx)(l.EuiFieldText,{"data-test-subj":"mlTrainedModelsInferenceAdvancedSettingsTagInput",value:null!==(a=null==d?void 0:d.tag)&&void 0!==a?a:"",onChange:e=>p({tag:e.target.value}),"aria-label":o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.tagAriaLabel",{defaultMessage:"Optional tag identifier for the processor"})}))))))))})),pn=Object(i.memo)((({condition:e,fieldMap:t,handleAdvancedConfigUpdate:n,inferenceConfig:a,modelInputFields:d,modelInferenceConfig:c,modelType:u,setHasUnsavedChanges:p,tag:m})=>{const{services:{docLinks:{links:j}}}=Object(D.d)(),[b,x]=Object(i.useState)(!1),[f,g]=Object(i.useState)(!1),[O,h]=Object(i.useState)(!1),[M,v]=Object(i.useState)(JSON.stringify(a,null,2)),[y,T]=Object(i.useState)(),[I,F]=Object(i.useState)(),[k,S]=Object(i.useState)(t?JSON.stringify(t,null,2):JSON.stringify({field_map:{incoming_field:"field_the_model_expects"}},null,2)),[C,_]=Object(i.useState)(!0),[w,L]=Object(i.useState)(!0);return Object(E.jsx)(l.EuiFlexGroup,{direction:"column","data-test-subj":"mlTrainedModelsInferencePipelineProcessorConfigStep"},Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.inferenceConfigurationTitle",{defaultMessage:"Inference configuration"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.description",defaultMessage:"The inference type and its options. Unless otherwise specified, the default configuration options are used. {inferenceDocsLink}.",values:{inferenceDocsLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:j.ingest.inference},"Learn more.")}})))),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,labelAppend:Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigEditButton",iconType:"pencil",size:"xs",onClick:()=>{0==!f&&(T(void 0),_(!0)),g(!f)}},f?nt:et)),Object(E.jsx)(l.EuiFlexItem,{grow:!1},f?Object(E.jsx)(Ot,{onClick:()=>{const e=Nt(JSON.parse(M),u);void 0===e?(n({inferenceConfig:JSON.parse(M)}),p(!1),g(!1),T(void 0)):(p(!0),_(!1),T(e))},disabled:!1===C}):null),Object(E.jsx)(l.EuiFlexItem,{grow:!1},f?Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>{v(JSON.stringify(c,null,2)),_(!0),T(void 0)}},o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.resetInferenceConfigButton",{defaultMessage:"Reset"})):null)),error:y,isInvalid:void 0!==y||void 0!==y,"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigEditor"},f?Object(E.jsx)(gt.CodeEditor,{height:300,languageId:"json",options:{automaticLayout:!0,lineNumbers:"off",tabSize:2},value:M,onChange:e=>{v(e);const t=Object(vt.c)(e);_(t)}}):Object(E.jsx)(l.EuiCodeBlock,{isCopyable:!0,"data-test-subj":"mlTrainedModelsInferencePipelineInferenceConfigBlock"},JSON.stringify(a,null,2)))))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiFlexGroup,null,Object(E.jsx)(l.EuiFlexItem,{grow:3},Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h4",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.fieldMapTitle",{defaultMessage:"Fields"}))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.fieldMapDescriptionTwo",defaultMessage:"The model expects certain input fields. {fieldsList}",values:{fieldsList:Object(E.jsx)(l.EuiPopover,{button:Object(E.jsx)(l.EuiLink,{onClick:()=>x(!b)},"You can review them here."),isOpen:b,closePopover:()=>x(!1),anchorPosition:"downLeft"},Object(E.jsx)(l.EuiCodeBlock,{isCopyable:!0},JSON.stringify(d,null,2)))}})),Object(E.jsx)("p",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.steps.advanced.fieldMapExtendedDescription",defaultMessage:"If the fields for the incoming data differ, a {fieldMap} must be created to map the input document field name to the name of the field that the model expects. It must be in JSON format. {inferenceDocsLink}",values:{fieldMap:Object(E.jsx)(l.EuiCode,null,"field_map"),inferenceDocsLink:Object(E.jsx)(l.EuiLink,{external:!0,target:"_blank",href:j.ingest.inference},"Learn more.")}})))),Object(E.jsx)(l.EuiFlexItem,{grow:7},Object(E.jsx)(l.EuiFormRow,{fullWidth:!0,labelAppend:Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs",justifyContent:"flexStart"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{"data-test-subj":"mlTrainedModelsInferencePipelineFieldMapEditButton",iconType:"pencil",size:"xs",onClick:()=>{const e=!O;!1===e&&(F(void 0),L(!0),p(!1)),h(e)}},O?nt:void 0!==t?et:tt)),O?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(Ot,{onClick:()=>{var e;const t=((e,t)=>{var n;let i;const s=Object.values(null!==(n=null==t?void 0:t.field_map)&&void 0!==n?n:{});if(t&&s.length>0){if(s.some((t=>e.includes(t))))return i;i=_t}return i})(null!==(e=d.field_names)&&void 0!==e?e:[],JSON.parse(k));void 0===t?(n({fieldMap:JSON.parse(k)}),p(!1),h(!1),F(void 0)):(p(!0),L(!1),F(t))},disabled:!1===w})):null,O?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButtonEmpty,{size:"xs",onClick:()=>{S("{}"),L(!0),F(void 0)}},Qe)):null),error:I,isInvalid:void 0!==I,"data-test-subj":"mlTrainedModelsInferencePipelineFieldMapEdit"},Object(E.jsx)(s.a.Fragment,null,O?null:Object(E.jsx)(l.EuiCodeBlock,{isCopyable:!0,overflowHeight:350,"data-test-subj":"mlTrainedModelsInferencePipelineFieldMapBlock"},JSON.stringify(null!=t?t:{},null,2)),O?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiSpacer,{size:"s"}),Object(E.jsx)(gt.CodeEditor,{height:300,languageId:"json",options:{automaticLayout:!0,lineNumbers:"off",tabSize:2},value:k,onChange:e=>{S(e);const t=Object(vt.c)(e);L(t)}})):null))))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(un,{handleAdvancedConfigUpdate:n,condition:e,tag:m})))})),mn=({onClose:e,model:t})=>{var n;const s=Object(i.useMemo)((()=>Mt(t)),[t.model_id]),[a,r]=Object(i.useState)(s),[d,c]=Object(i.useState)(Je.DETAILS),[u,p]=Object(i.useState)(!1),{trainedModels:{createInferencePipeline:m}}=Object(D.c)(),j=ht(t),b=$t(),x=e=>{r({...a,...e})},{pipelineName:f,targetField:g}=Object(i.useMemo)((()=>At(a.pipelineName,b)),[b,a.pipelineName]),O=Object(i.useMemo)((()=>{var e,n,i;return Array.isArray(null===(e=t.metadata)||void 0===e?void 0:e.analytics_config.source.index)?null===(n=t.metadata)||void 0===n?void 0:n.analytics_config.source.index.join():null===(i=t.metadata)||void 0===i?void 0:i.analytics_config.source.index}),[null==t?void 0:t.model_id]);return Object(E.jsx)(l.EuiFlyout,{onClose:e,size:"l","data-test-subj":"mlTrainedModelsInferencePipelineFlyout"},Object(E.jsx)(l.EuiFlyoutHeader,null,Object(E.jsx)(l.EuiTitle,{size:"m"},Object(E.jsx)("h3",null,o.i18n.translate("xpack.ml.trainedModels.content.indices.pipelines.addInferencePipelineModal.title",{defaultMessage:"Deploy analytics model"})))),Object(E.jsx)(l.EuiFlyoutBody,null,Object(E.jsx)(at,{step:d,setStep:c,isDetailsStepValid:void 0===f&&void 0===g,isConfigureProcessorStepValid:!1===u,hasProcessorStep:!0,pipelineCreated:a.pipelineCreated}),Object(E.jsx)(l.EuiSpacer,{size:"m"}),d===Je.DETAILS&&Object(E.jsx)(cn,{handlePipelineConfigUpdate:x,pipelineName:a.pipelineName,pipelineNameError:f,pipelineDescription:a.pipelineDescription,modelId:t.model_id,targetField:a.targetField,targetFieldError:g}),d===Je.CONFIGURE_PROCESSOR&&t&&Object(E.jsx)(pn,{condition:a.condition,fieldMap:a.fieldMap,handleAdvancedConfigUpdate:x,inferenceConfig:a.inferenceConfig,modelInferenceConfig:t.inference_config,modelInputFields:null!==(n=t.input)&&void 0!==n?n:[],modelType:j,setHasUnsavedChanges:p,tag:a.tag}),d===Je.ON_FAILURE&&Object(E.jsx)(Et,{ignoreFailure:a.ignoreFailure,takeActionOnFailure:a.takeActionOnFailure,handleAdvancedConfigUpdate:x,onFailure:a.onFailure}),d===Je.TEST&&Object(E.jsx)(rn,{sourceIndex:O,state:a,mode:an}),d===Je.CREATE&&Object(E.jsx)(ft,{inferencePipeline:sn(a),modelType:j,pipelineName:a.pipelineName,pipelineCreated:a.pipelineCreated,pipelineError:a.pipelineError,sourceIndex:O})),Object(E.jsx)(l.EuiFlyoutFooter,{className:"mlTrainedModelsInferencePipelineFlyoutFooter"},Object(E.jsx)(ot,{onClose:e,onCreate:async()=>{r({...a,creatingPipeline:!0});try{await m(a.pipelineName,sn(a)),r({...a,pipelineCreated:!0,creatingPipeline:!1,pipelineError:void 0})}catch(t){var e;console.error(t);const n=Object(ye.b)(t);r({...a,creatingPipeline:!1,pipelineError:null!==(e=n.message)&&void 0!==e?e:t.message})}},step:d,setStep:c,isDetailsStepValid:void 0===f&&void 0===g,isConfigureProcessorStepValid:!1===u,pipelineCreated:a.pipelineCreated,creatingPipeline:a.creatingPipeline,hasProcessorStep:!0})))},jn=Object(x.a)((async()=>({default:(await n.e(22).then(n.bind(null,812))).ExpandedRow}))),bn=Object(x.a)((async()=>({default:(await n.e(102).then(n.bind(null,894))).AddModelFlyout}))),xn=o.i18n.translate("xpack.ml.trainedModels.modelsList.modelIdHeader",{defaultMessage:"ID"}),fn=()=>({pageIndex:0,pageSize:10,sortField:xn,sortDirection:"asc"}),gn=({pageState:e,updatePageState:t})=>{var n;const x=g()(),{services:{application:{capabilities:f},docLinks:F}}=Object(D.d)(),k=F.links.ml.nlpElser,{isNLPEnabled:S}=Object(C.d)(),[_,w]=Object(b.b)(O.c,!1);Object(p.c)({timeRangeSelector:!1,autoRefreshSelector:!0});const A=Object(Zt.b)(d.FIELD_FORMAT_IDS.DATE),[N,R]=Object(u.c)(P.b.TRAINED_MODELS_MANAGE,fn()),[z,B]=e&&t?[e,t]:[N,R],$=Object(en.a)(),V=null!==(n=z.queryText)&&void 0!==n?n:"",G=f.ml.canDeleteTrainedModels,U=Object(v.b)(),{displayErrorToast:W,displaySuccessToast:H}=Object(I.useToastNotificationService)(),[q,J]=Object(i.useState)(!1),[X,Q]=Object(i.useState)(!1),[K,Y]=Object(i.useState)([]),[Z,ee]=Object(i.useState)([]),[te,ne]=Object(i.useState)([]),[ie,se]=Object(i.useState)(),[le,ae]=Object(i.useState)({}),[oe,re]=Object(i.useState)(null),[de,ce]=Object(i.useState)(null),[ue,pe]=Object(i.useState)(!1),me=Object(i.useCallback)((e=>e.tags.includes(m.a)),[]),je=Object(i.useCallback)((e=>e.tags.includes(m.e)),[]),be=Object(i.useMemo)((()=>K.filter((e=>!e.putModelConfig))),[K]),xe=Object(i.useCallback)((async e=>{try{var t;return!(null===(t=(await U.getTrainedModels(e,{include:"definition_status"}))[0])||void 0===t||!t.fully_defined)}catch(e){W(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.downloadStatusCheckErrorMessage",{defaultMessage:"Failed to check download status"}))}return!1}),[U,W]),fe=Object(i.useCallback)((async()=>{Q(!0);try{const e=await U.getTrainedModels(void 0,{with_pipelines:!0,with_indices:!0}),t=[],n=[];for(const i of e){const e={...i,..."object"==typeof i.inference_config?{type:[i.model_type,...Object.keys(i.inference_config),...me(i)?[m.b]:[],...je(i)?[m.f]:[]]}:{}};t.push(e),le[i.model_id]&&n.push(e)}await Oe(t);let i=t;if(S){const e=new Map(i.map((e=>[e.model_id,e]))),t=(await U.getTrainedModelDownloads()).filter((({model_id:t,hidden:n,recommended:i})=>(i&&e.has(t)&&(e.get(t).recommended=!0),!e.has(t)&&!n))).map((e=>{var t;return{model_id:e.model_id,type:e.type,tags:null!==(t=e.type)&&void 0!==t&&t.includes(m.e)?[m.e]:[],putModelConfig:e.config,description:e.description,state:m.h.NOT_DOWNLOADED,recommended:!!e.recommended,modelName:e.modelName,os:e.os,arch:e.arch,softwareLicense:e.license,licenseUrl:e.licenseUrl}}));i=[...i,...t]}Y(i),n.length>0&&(await Oe(n),ae(n.reduce(((e,t)=>(e[t.model_id]=Object(E.jsx)(jn,{item:t}),e)),{})))}catch(e){W(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchFailedErrorMessage",{defaultMessage:"Error loading trained models"}))}J(!0),Q(!1),await Me()}),[le,S]);Object(i.useEffect)((function(){$&&fe()}),[$]);const ge=Object(i.useMemo)((()=>({total:{show:!0,value:be.length,label:o.i18n.translate("xpack.ml.trainedModels.modelsList.totalAmountLabel",{defaultMessage:"Total trained models"})}})),[be]),Oe=Object(i.useCallback)((async e=>{try{if(e){const{trained_model_stats:t}=await U.getTrainedModelStats(),n=Object(a.groupBy)(t,"model_id");e.forEach((e=>{var t;const i=n[e.model_id];e.stats={...null!==(t=e.stats)&&void 0!==t?t:{},...i[0],deployment_stats:i.map((e=>e.deployment_stats)).filter(j.a)},e.deployment_ids=i.map((e=>{var t;return null===(t=e.deployment_stats)||void 0===t?void 0:t.deployment_id})).filter(j.a),e.state=(e=>{var t,n,i,s,l,a,o,r;if(null!==(t=e.stats)&&void 0!==t&&null!==(n=t.deployment_stats)&&void 0!==n&&n.length)return null!==(i=e.stats)&&void 0!==i&&null!==(s=i.deployment_stats)&&void 0!==s&&s.some((e=>e.state===m.c.STARTED))?m.h.STARTED:null!==(l=e.stats)&&void 0!==l&&null!==(a=l.deployment_stats)&&void 0!==a&&a.some((e=>e.state===m.c.STARTING))?m.h.STARTING:null!==(o=e.stats)&&void 0!==o&&null!==(r=o.deployment_stats)&&void 0!==r&&r.every((e=>e.state===m.c.STOPPING))?m.h.STOPPING:void 0})(e),e.stateDescription=e.stats.deployment_stats.reduce(((e,t)=>{var n;return e||(null!==(n=t.reason)&&void 0!==n?n:"")}),"")}));const i=e.filter((e=>m.d.hasOwnProperty(e.model_id)));if(i.length>0)for(const e of i){if(Object.values(m.c).includes(e.state))continue;const t=await xe(e.model_id);e.state=t?m.h.DOWNLOADED:m.h.DOWNLOADING}}return!0}catch(e){return W(e,o.i18n.translate("xpack.ml.trainedModels.modelsList.fetchModelStatsErrorMessage",{defaultMessage:"Error loading trained models statistics"})),!1}}),[]),he=Object(i.useRef)(!1),Me=Object(i.useCallback)((async(e=new Set)=>{if(!he.current||0!==e.size)try{he.current=!0;const t=await U.getModelsDownloadStatus();x()&&Y((n=>n.map((n=>{const i={...n};return t[n.model_id]?i.downloadState=t[n.model_id]:e.has(n.model_id)&&(delete i.downloadState,i.state=m.h.DOWNLOADED),i}))));const n=Array.from(e).filter((e=>!t[e]));if(n.length>0&&H(o.i18n.translate("xpack.ml.trainedModels.modelsList.downloadCompleteSuccess",{defaultMessage:'"{modelIds}" {modelIdsLength, plural, one {has} other {have}} been downloaded successfully.',values:{modelIds:n.join(", "),modelIdsLength:n.length}})),Object.keys(t).forEach((n=>{t[n]&&e.add(n)})),n.forEach((t=>{e.delete(t)})),Object(a.isEmpty)(t))return void(he.current=!1);await new Promise((e=>setTimeout(e,3e3))),await Me(e)}catch(e){he.current=!1}}),[U,H,x]),ve=Object(i.useMemo)((()=>[...be.reduce(((e,t)=>{const n=t.inference_config&&Object.keys(t.inference_config)[0];return n&&e.add(n),e.add(t.model_type),e}),new Set)].sort(((e,t)=>e.localeCompare(t))).map((e=>({value:e,name:e})))),[be]),ye=Object(i.useMemo)((()=>[...new Set([...be.flatMap((e=>e.deployment_ids)),...be.map((e=>e.model_id))])]),[be]),Ee=Object(i.useCallback)((async e=>{try{Q(!0),await U.installElasticTrainedModelConfig(e),H(o.i18n.translate("xpack.ml.trainedModels.modelsList.downloadSuccess",{defaultMessage:'"{modelId}" model download has been started successfully.',values:{modelId:e}})),await fe()}catch(t){W(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.downloadFailed",{defaultMessage:'Failed to download "{modelId}"',values:{modelId:e}})),Q(!0)}}),[W,H,fe,U]),Te=function({onDfaTestAction:e,onTestAction:t,onModelsDeleteRequest:n,onModelDeployRequest:a,onLoading:r,isLoading:d,fetchModels:u,modelAndDeploymentIds:p,onModelDownloadRequest:j}){const{services:{application:{navigateToUrl:b},overlays:x,docLinks:f,mlServices:{mlApiServices:g},...O}}=Object(D.d)(),[h,F,k,S]=Object(qt.usePermissionCheck)(["canCreateTrainedModels","canStartStopTrainedModels","canTestTrainedModels","canDeleteTrainedModels"]),[C,_]=Object(i.useState)(!1),w=f.links.ml.startTrainedModelsDeployment,A=Object(D.h)(),{displayErrorToast:N,displaySuccessToast:R}=Object(I.useToastNotificationService)(),z=Object(D.g)(),B=Object(v.b)();Object(i.useEffect)((()=>{let e=!0;return g.hasPrivileges({cluster:["manage_ingest_pipelines"]}).then((t=>{var n;e&&_(void 0===t.hasPrivileges||!0===(null===(n=t.hasPrivileges.cluster)||void 0===n?void 0:n.manage_ingest_pipelines))})),()=>{e=!1}}),[g]);const $=Object(i.useMemo)((()=>((e,t)=>async n=>new Promise((async(i,s)=>{try{const l=e.openModal(Object(y.a)(Object(E.jsx)(T,{model:n,onCancel:()=>{l.close(),s()},onConfirm:e=>{l.close(),i(e)}}),t))}catch(e){s()}})))(x,O)),[x,O]),V=Object(i.useMemo)((()=>((e,t,n)=>(i,s,l)=>new Promise((async a=>{try{const o=e.openModal(Object(y.a)(Object(E.jsx)(L,{startModelDeploymentDocUrl:n,initialParams:s,modelAndDeploymentIds:l,model:i,onConfigChange:e=>{o.close();const t={...e};"low"===t.priority&&(t.numOfAllocations=1,t.threadsPerAllocations=1),a(t)},onClose:()=>{o.close(),a()}}),t))}catch(e){a()}})))(x,O,w)),[x,O,w]),G=Object(i.useCallback)((e=>e.tags.includes(m.a)),[]);return Object(i.useMemo)((()=>[{name:o.i18n.translate("xpack.ml.trainedModels.modelsList.viewTrainingDataNameActionLabel",{defaultMessage:"View training data"}),description:o.i18n.translate("xpack.ml.trainedModels.modelsList.viewTrainingDataActionLabel",{defaultMessage:"Training data can be viewed when data frame analytics job exists."}),icon:"visTable",type:"icon",available:e=>{var t,n;return!(null===(t=e.metadata)||void 0===t||null===(n=t.analytics_config)||void 0===n||!n.id)},enabled:e=>!0===e.origin_job_exists,onClick:async e=>{var t,n,i,s;if(void 0===(null===(t=e.metadata)||void 0===t?void 0:t.analytics_config))return;const l=Object(M.a)(null===(n=e.metadata)||void 0===n?void 0:n.analytics_config.analysis),a=await z.getUrl({page:P.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:null===(i=e.metadata)||void 0===i?void 0:i.analytics_config.id,analysisType:l,..."classification"===l||"regression"===l?{queryText:`${null===(s=e.metadata)||void 0===s?void 0:s.analytics_config.dest.results_field}.is_training : true`}:{}}});await b(a)}},{name:o.i18n.translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),description:o.i18n.translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),icon:"graphApp",type:"icon",isPrimary:!0,available:e=>{var t,n;return!(null===(t=e.metadata)||void 0===t||null===(n=t.analytics_config)||void 0===n||!n.id)},onClick:async e=>{const t=await z.getUrl({page:P.b.DATA_FRAME_ANALYTICS_MAP,pageState:{modelId:e.model_id}});await A(t,!1)}},{name:o.i18n.translate("xpack.ml.inference.modelsList.startModelDeploymentActionLabel",{defaultMessage:"Deploy"}),description:o.i18n.translate("xpack.ml.inference.modelsList.startModelDeploymentActionDescription",{defaultMessage:"Start deployment"}),"data-test-subj":"mlModelsTableRowStartDeploymentAction",icon:"play",type:"icon",isPrimary:!0,enabled:e=>F&&!d&&e.state!==m.h.DOWNLOADING,available:e=>e.model_type===m.j.PYTORCH,onClick:async e=>{const t=await V(e,void 0,p);if(t)try{r(!0),await B.startModelAllocation(e.model_id,{number_of_allocations:t.numOfAllocations,threads_per_allocation:t.threadsPerAllocations,priority:t.priority,deployment_id:t.deploymentId?t.deploymentId:e.model_id}),R(o.i18n.translate("xpack.ml.trainedModels.modelsList.startSuccess",{defaultMessage:'Deployment for "{modelId}" has been started successfully.',values:{modelId:e.model_id}})),await u()}catch(t){N(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.startFailed",{defaultMessage:'Failed to start "{modelId}"',values:{modelId:e.model_id}})),r(!1)}}},{name:o.i18n.translate("xpack.ml.inference.modelsList.updateModelDeploymentActionLabel",{defaultMessage:"Update deployment"}),description:o.i18n.translate("xpack.ml.inference.modelsList.updateModelDeploymentActionLabel",{defaultMessage:"Update deployment"}),"data-test-subj":"mlModelsTableRowUpdateDeploymentAction",icon:"documentEdit",type:"icon",isPrimary:!1,available:e=>{var t,n;return e.model_type===m.j.PYTORCH&&F&&!d&&!(null===(t=e.stats)||void 0===t||null===(n=t.deployment_stats)||void 0===n||!n.some((e=>e.state===m.c.STARTED)))},onClick:async e=>{const t=e.deployment_ids[0],n=await V(e,{deploymentId:t,numOfAllocations:e.stats.deployment_stats.find((e=>e.deployment_id===t)).number_of_allocations});if(n)try{r(!0),await B.updateModelDeployment(e.model_id,n.deploymentId,{number_of_allocations:n.numOfAllocations}),R(o.i18n.translate("xpack.ml.trainedModels.modelsList.updateSuccess",{defaultMessage:'Deployment for "{modelId}" has been updated successfully.',values:{modelId:e.model_id}})),await u()}catch(t){N(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.updateFailed",{defaultMessage:'Failed to update "{modelId}"',values:{modelId:e.model_id}})),r(!1)}}},{name:o.i18n.translate("xpack.ml.inference.modelsList.stopModelDeploymentActionLabel",{defaultMessage:"Stop deployment"}),description:o.i18n.translate("xpack.ml.inference.modelsList.stopModelDeploymentActionLabel",{defaultMessage:"Stop deployment"}),"data-test-subj":"mlModelsTableRowStopDeploymentAction",icon:"stop",type:"icon",isPrimary:!1,available:e=>e.model_type===m.j.PYTORCH&&F&&(e.state===m.h.STARTED||e.state===m.h.STARTING)&&(!Array.isArray(e.inference_apis)||e.deployment_ids.some((t=>Array.isArray(e.inference_apis)&&!e.inference_apis.some((e=>e.inference_id===t))))),enabled:e=>!d,onClick:async e=>{const t=Object(c.a)(e.pipelines),n=e.deployment_ids.length>1;let i=e.deployment_ids;if(t||n)try{i=await $(e)}catch(e){return}try{r(!0);const n=await B.stopModelAllocation(e.model_id,i,{force:t});R(o.i18n.translate("xpack.ml.trainedModels.modelsList.stopSuccess",{defaultMessage:'{numberOfDeployments, plural, one {Deployment} other {Deployments}}  for "{modelId}" has been stopped successfully.',values:{modelId:e.model_id,numberOfDeployments:i.length}})),Object.values(n).some((e=>void 0!==e.error))&&Object.entries(n).forEach((([e,t])=>{void 0!==t.error&&N(t.error,o.i18n.translate("xpack.ml.trainedModels.modelsList.stopDeploymentWarning",{defaultMessage:'Failed to stop "{deploymentId}"',values:{deploymentId:e}}))}))}catch(t){N(t,o.i18n.translate("xpack.ml.trainedModels.modelsList.stopFailed",{defaultMessage:'Failed to stop "{modelId}"',values:{modelId:e.model_id}})),r(!1)}await u()}},{name:o.i18n.translate("xpack.ml.inference.modelsList.downloadModelActionLabel",{defaultMessage:"Download"}),description:o.i18n.translate("xpack.ml.inference.modelsList.downloadModelActionLabel",{defaultMessage:"Download"}),"data-test-subj":"mlModelsTableRowDownloadModelAction",icon:"download",type:"icon",isPrimary:!0,available:e=>h&&e.tags.includes(m.e)&&e.state===m.h.NOT_DOWNLOADED,enabled:e=>!d,onClick:async e=>{j(e.model_id)}},{name:e=>{const t=e.state===m.h.STARTED;return Object(E.jsx)(l.EuiToolTip,{position:"left",content:t?o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteDisabledWithDeploymentsTooltip",{defaultMessage:"Model has started deployments"}):null},Object(E.jsx)(s.a.Fragment,null,o.i18n.translate("xpack.ml.trainedModels.modelsList.deployModelActionLabel",{defaultMessage:"Deploy model"})))},description:o.i18n.translate("xpack.ml.trainedModels.modelsList.deployModelActionLabel",{defaultMessage:"Deploy model"}),"data-test-subj":"mlModelsTableRowDeployAction",icon:"continuityAbove",type:"icon",isPrimary:!1,onClick:e=>{a(e)},available:e=>Wt(e)&&!G(e)&&!e.putModelConfig&&C,enabled:e=>F&&e.state!==m.h.STARTED},{name:e=>Object(E.jsx)(s.a.Fragment,null,o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"})),description:e=>{const t=e.deployment_ids.length>0,{hasInferenceServices:n}=e;return n?o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteDisabledWithInferenceServicesTooltip",{defaultMessage:"Model is used by the _inference API"}):t?o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteDisabledWithDeploymentsTooltip",{defaultMessage:"Model has started deployments"}):o.i18n.translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"})},"data-test-subj":"mlModelsTableRowDeleteAction",icon:"trash",type:"icon",color:"danger",isPrimary:!1,onClick:e=>{n([e])},available:e=>{var t;const n=0===Object.keys(null!==(t=e.pipelines)&&void 0!==t?t:{}).length;return S&&!G(e)&&!e.putModelConfig&&(n||C)},enabled:e=>e.state!==m.h.STARTED},{name:o.i18n.translate("xpack.ml.inference.modelsList.testModelActionLabel",{defaultMessage:"Test model"}),description:o.i18n.translate("xpack.ml.inference.modelsList.testModelActionLabel",{defaultMessage:"Test model"}),"data-test-subj":"mlModelsTableRowTestAction",icon:"inputOutput",type:"icon",isPrimary:!0,available:Ht,onClick:n=>{Wt(n)&&!G(n)?e(n):t(n)},enabled:e=>k&&Ht(e,!0)&&!d},{name:o.i18n.translate("xpack.ml.inference.modelsList.analyzeDataDriftLabel",{defaultMessage:"Analyze data drift"}),description:o.i18n.translate("xpack.ml.inference.modelsList.analyzeDataDriftLabel",{defaultMessage:"Analyze data drift"}),"data-test-subj":"mlModelsAnalyzeDataDriftAction",icon:"visTagCloud",type:"icon",isPrimary:!0,available:e=>{var t;return void 0!==(null==e||null===(t=e.metadata)||void 0===t?void 0:t.analytics_config)||Array.isArray(e.indices)&&e.indices.length>0},onClick:async e=>{var t,n,i,s;let l=null==e||null===(t=e.indices)||void 0===t?void 0:t.map((e=>Object.keys(e))).flat();var a;void 0!==(null==e||null===(n=e.metadata)||void 0===n||null===(i=n.analytics_config)||void 0===i||null===(s=i.dest)||void 0===s?void 0:s.index)&&(l=[null===(a=e.metadata.analytics_config.dest)||void 0===a?void 0:a.index]);const o=await z.getUrl({page:P.b.DATA_DRIFT_CUSTOM,pageState:l?{comparison:l.join(",")}:{}});await A(o,!1)}}]),[h,S,C,F,k,N,R,u,$,V,G,d,p,A,b,e,r,a,n,t,B,z,j])}({isLoading:X,fetchModels:fe,onTestAction:re,onDfaTestAction:ce,onModelsDeleteRequest:ne,onModelDeployRequest:se,onLoading:Q,modelAndDeploymentIds:ye,onModelDownloadRequest:Ee}),Ie=async e=>{const t={...le};t[e.model_id]?delete t[e.model_id]:(await Oe([e]),t[e.model_id]=Object(E.jsx)(jn,{item:e})),ae(t)},Fe=[{align:"left",width:"32px",isExpander:!0,render:e=>e.stats?Object(E.jsx)(l.EuiButtonIcon,{onClick:Ie.bind(null,e),"aria-label":le[e.model_id]?o.i18n.translate("xpack.ml.trainedModels.modelsList.collapseRow",{defaultMessage:"Collapse"}):o.i18n.translate("xpack.ml.trainedModels.modelsList.expandRow",{defaultMessage:"Expand"}),iconType:le[e.model_id]?"arrowDown":"arrowRight"}):null,"data-test-subj":"mlModelsTableRowDetailsToggle"},{name:xn,width:"15%",sortable:({model_id:e})=>e,truncateText:!1,textOnly:!1,"data-test-subj":"mlModelsTableColumnId",render:({description:e,model_id:t})=>{const n=null==e?void 0:e.includes("(Tech Preview)");return Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",wrap:!0},Object(E.jsx)(l.EuiFlexItem,{grow:!1},t),n?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(h.a,{compressed:!0})):null)}},{name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelDescriptionHeader",{defaultMessage:"Description"}),truncateText:!1,"data-test-subj":"mlModelsTableColumnDescription",render:({description:e,recommended:t})=>{if(!e)return null;const n=e.replace("(Tech Preview)","");return t?Object(E.jsx)(l.EuiToolTip,{content:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.recommendedDownloadContent",defaultMessage:"Recommended model version for your cluster's hardware configuration"})},Object(E.jsx)(s.a.Fragment,null,n," ",Object(E.jsx)("b",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.recommendedDownloadLabel",defaultMessage:"(Recommended)"})))):n}},{width:"15%",field:Jt.a.type,name:o.i18n.translate("xpack.ml.trainedModels.modelsList.typeHeader",{defaultMessage:"Type"}),sortable:!0,truncateText:!0,align:"left",render:e=>Object(E.jsx)(l.EuiFlexGroup,{gutterSize:"xs",wrap:!0},e.map((e=>Object(E.jsx)(l.EuiFlexItem,{key:e,grow:!1},Object(E.jsx)(l.EuiBadge,{color:"hollow","data-test-subj":"mlModelType"},e))))),"data-test-subj":"mlModelsTableColumnType"},{width:"10%",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.stateHeader",{defaultMessage:"State"}),align:"left",truncateText:!1,render:({state:e,downloadState:t})=>{const n=(e=>{switch(e){case m.h.DOWNLOADED:return{color:"subdued",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.downloadedName",{defaultMessage:"Ready to deploy"})};case m.h.DOWNLOADING:return{color:"primary",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.downloadingName",{defaultMessage:"Downloading..."})};case m.h.STARTED:return{color:"success",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.startedName",{defaultMessage:"Deployed"})};case m.h.STARTING:return{color:"success",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.startingName",{defaultMessage:"Starting deployment..."})};case m.h.STOPPING:return{color:"accent",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.stoppingName",{defaultMessage:"Stopping deployment..."})};case m.h.NOT_DOWNLOADED:return{color:"#d4dae5",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.modelState.notDownloadedName",{defaultMessage:"Not downloaded"})};default:return null}})(e);if(!n)return null;const i=e===m.h.DOWNLOADING&&t,a=Object(E.jsx)(l.EuiHealth,{textSize:"xs",color:n.color},n.name);return Object(E.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"none"},i?Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiProgress,{label:a,valueText:Object(E.jsx)(s.a.Fragment,null,(t.downloaded_parts/t.total_parts*100).toFixed(0)+"%"),value:null==t?void 0:t.downloaded_parts,max:null==t?void 0:t.total_parts,size:"xs",color:n.color})):Object(E.jsx)(l.EuiFlexItem,null,a))},"data-test-subj":"mlModelsTableColumnDeploymentState"},{width:"20%",field:Jt.a.createdAt,name:o.i18n.translate("xpack.ml.trainedModels.modelsList.createdAtHeader",{defaultMessage:"Created at"}),dataType:"date",render:e=>A(e),sortable:!0,"data-test-subj":"mlModelsTableColumnCreatedAt"},{width:"15%",name:o.i18n.translate("xpack.ml.trainedModels.modelsList.actionsHeader",{defaultMessage:"Actions"}),actions:Te,"data-test-subj":"mlModelsTableColumnActions"}],ke=ve&&ve.length>0?[{type:"field_value_selection",field:"type",name:o.i18n.translate("xpack.ml.dataframe.analyticsList.typeFilter",{defaultMessage:"Type"}),multiSelect:"or",options:ve}]:[],Se=Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiTitle,{size:"s"},Object(E.jsx)("h5",null,Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.selectedModelsMessage",defaultMessage:"{modelsCount, plural, one{# model} other {# models}} selected",values:{modelsCount:Z.length}})))),Object(E.jsx)(l.EuiFlexItem,null,Object(E.jsx)(l.EuiButton,{color:"danger",onClick:ne.bind(null,Z),"data-test-subj":"mlTrainedModelsDeleteSelectedModelsButton"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.deleteModelsButtonLabel",defaultMessage:"Delete"}))))),Ce=G?{selectableMessage:(e,t)=>e?o.i18n.translate("xpack.ml.trainedModels.modelsList.selectableMessage",{defaultMessage:"Select a model"}):Object(c.a)(t.pipelines)?o.i18n.translate("xpack.ml.trainedModels.modelsList.disableSelectableMessage",{defaultMessage:"Model has associated pipelines"}):me(t)?o.i18n.translate("xpack.ml.trainedModels.modelsList.builtInModelMessage",{defaultMessage:"Built-in model"}):"",selectable:e=>!(Object(c.a)(e.pipelines)||me(e)||je(e)&&!e.state),onSelectionChange:e=>{ee(e)}}:void 0,{onTableChange:_e,pagination:we,sorting:Le}=Object(Yt.a)(K.length,z,B),De={query:V,onChange:e=>null===e.error&&(B({queryText:e.queryText,pageIndex:0}),!0),box:{incremental:!0},...ve&&ve.length>0?{filters:ke}:{},...Z.length>0?{toolsLeft:Se}:{}},Pe=!_&&K.findIndex((e=>e.model_id===m.g))>=0;return q?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(tn.a,{onCloseFlyout:fe,forceRefresh:X}),Object(E.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},ge?Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(Xt.a,{stats:ge,dataTestSub:"mlInferenceModelsStatsBar"})):null,Object(E.jsx)(l.EuiFlexItem,{grow:!1},Object(E.jsx)(l.EuiButton,{fill:!0,iconType:"plusInCircle",color:"primary",onClick:pe.bind(null,!0),"data-test-subj":"mlModelsAddTrainedModelButton"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.addModelButtonLabel",defaultMessage:"Add trained model"})))),Object(E.jsx)(l.EuiSpacer,{size:"m"}),Object(E.jsx)("div",{"data-test-subj":"mlModelsTableContainer"},Object(E.jsx)(l.EuiInMemoryTable,{responsiveBreakpoint:"xl",allowNeutralSort:!1,columns:Fe,itemIdToExpandedRowMap:le,items:K,itemId:Jt.a.id,loading:X,search:De,selection:Ce,rowProps:e=>({"data-test-subj":`mlModelsTableRow row-${e.model_id}`}),pagination:we,onTableChange:_e,sorting:Le,"data-test-subj":X?"mlModelsTable loading":"mlModelsTable loaded",childrenBetween:Pe?Object(E.jsx)(s.a.Fragment,null,Object(E.jsx)(l.EuiCallOut,{size:"s",title:Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.newElserModelTitle",defaultMessage:"New ELSER model now available"}),onDismiss:w.bind(null,!0)},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.newElserModelDescription",defaultMessage:"A new version of ELSER that shows faster performance and improved relevance is now available. {docLink} for information on how to start using it.",values:{docLink:Object(E.jsx)(l.EuiLink,{href:k,external:!0,target:"_blank"},Object(E.jsx)(r.FormattedMessage,{id:"xpack.ml.trainedModels.modelsList.startDeployment.viewElserDocLink",defaultMessage:"View documentation"}))}})),Object(E.jsx)(l.EuiSpacer,{size:"m"})):null})),te.length>0&&Object(E.jsx)(Kt,{onClose:e=>{ne([]),e&&fe()},models:te}),null===oe?null:Object(E.jsx)(Gt,{model:oe,onClose:e=>{re(null),e&&fe()}}),null===de?null:Object(E.jsx)(dn,{model:de,onClose:ce.bind(null,null)}),void 0!==ie?Object(E.jsx)(mn,{onClose:se.bind(null,void 0),model:ie}):null,ue?Object(E.jsx)(bn,{modelDownloads:K.filter((e=>e.state===m.h.NOT_DOWNLOADED)),onClose:pe.bind(null,!1),onSubmit:e=>{Ee(e),pe(!1)}}):null):null}}}]);