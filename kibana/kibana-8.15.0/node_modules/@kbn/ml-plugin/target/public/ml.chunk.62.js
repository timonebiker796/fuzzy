/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[62,33,66],{106:function(e,n,t){"use strict";t.r(n),t.d(n,"timeSeriesSearchServiceFactory",(function(){return s})),t.d(n,"useTimeSeriesSearchService",(function(){return _}));var i=t(2),a=t(8),r=t(7),l=t(80),o=t(830),u=t(520),c=t(123);function d(e,n,t){const i=e.analysis_config,r=i.detectors[n],l={jobId:e.job_id,detectorIndex:n,metricFunction:r.function===o.b.LAT_LONG?o.b.LAT_LONG:Object(c.s)(r.function),timeField:e.data_description.time_field,interval:e.analysis_config.bucket_span,datafeedConfig:e.datafeed_config,summaryCountFieldName:e.analysis_config.summary_count_field_name};r.function===o.b.METRIC&&void 0!==t&&(l.metricFunction=t),void 0!==r.field_name&&(l.metricFieldName=r.field_name);const d=i.summary_count_field_name;if(l.metricFunction===o.a.COUNT&&void 0!==d&&d!==u.a&&d!==u.d){let n;const t=Object(a.get)(e.datafeed_config,"aggregations")||Object(a.get)(e.datafeed_config,"aggs");void 0!==t&&Object.values(t).length>0&&(n=Object(a.get)(Object.values(t)[0],["aggregations",d,o.a.CARDINALITY,"field"])||Object(a.get)(Object.values(t)[0],["aggs",d,o.a.CARDINALITY,"field"])),r.function!==o.b.NON_ZERO_COUNT&&r.function!==o.b.LOW_NON_ZERO_COUNT&&r.function!==o.b.HIGH_NON_ZERO_COUNT&&r.function!==o.b.COUNT&&r.function!==o.b.HIGH_COUNT&&r.function!==o.b.LOW_COUNT||void 0===n?(l.metricFunction=o.a.SUM,l.metricFieldName=d):(l.metricFunction=o.a.CARDINALITY,l.metricFieldName=void 0)}return l}var f=t(10);function s(e,n){return{getMetricData:function(n,t,i,l,o,u,f){if(Object(c.n)(n,t)&&Object(c.o)(n,t,i)){const r=[],c=n.analysis_config.detectors[t];if(void 0!==c.partition_field_name){const e=Object(a.find)(i,{fieldName:c.partition_field_name});void 0!==e&&r.push({fieldName:"partition_field_name",fieldValue:e.fieldName},{fieldName:"partition_field_value",fieldValue:e.fieldValue})}if(void 0!==c.over_field_name){const e=Object(a.find)(i,{fieldName:c.over_field_name});void 0!==e&&r.push({fieldName:"over_field_name",fieldValue:e.fieldName},{fieldName:"over_field_value",fieldValue:e.fieldValue})}if(void 0!==c.by_field_name){const e=Object(a.find)(i,{fieldName:c.by_field_name});void 0!==e&&r.push({fieldName:"by_field_name",fieldValue:e.fieldName},{fieldName:"by_field_value",fieldValue:e.fieldValue})}return e.getModelPlotOutput(n.job_id,t,r,l,o,u)}{const c={success:!0,results:{}},s=d(n,t);return e.getMetricData(s.datafeedConfig.indices.join(","),i,s.datafeedConfig.query,null!=f?f:s.metricFunction,s.metricFieldName,s.summaryCountFieldName,s.timeField,l,o,u,null==s?void 0:s.datafeedConfig).pipe(Object(r.map)((e=>(Object(a.each)(e.results,((e,n)=>{c.results[n]={actual:e}})),c))))}},getChartDetails:function(e,t,i,r,l,o){return new Promise(((u,c)=>{const f={success:!0,results:{functionLabel:"",entityData:{entities:[]}}},s=d(e,t,o);let _=s.metricFunction;void 0!==s.metricFieldName&&(_+=` ${s.metricFieldName}`),f.results.functionLabel=_;const m=Object(a.filter)(i,(e=>null===e.fieldValue));if(0===m.length)f.results.entityData.count=1,f.results.entityData.entities=i,u(f);else{const e=m.map((e=>e.fieldName));n.getCardinalityOfFields({index:s.datafeedConfig.indices.join(","),fieldNames:e,query:s.datafeedConfig.query,timeFieldName:s.timeField,earliestMs:r,latestMs:l}).then((e=>{Object(a.each)(m,(n=>{f.results.entityData.entities.push({fieldName:n.fieldName,cardinality:Object(a.get)(e,n.fieldName,0)})})),u(f)})).catch((e=>{c(e)}))}}))}}}function _(){const{services:{mlServices:{mlApiServices:e}}}=Object(f.d)(),n=Object(l.mlResultsServiceProvider)(e);return Object(i.useMemo)((()=>s(n,e)),[e,n])}},132:function(e,n,t){"use strict";t.d(n,"c",(function(){return a})),t.d(n,"d",(function(){return r})),t.d(n,"h",(function(){return l})),t.d(n,"b",(function(){return o})),t.d(n,"e",(function(){return u})),t.d(n,"f",(function(){return c})),t.d(n,"j",(function(){return d})),t.d(n,"g",(function(){return f})),t.d(n,"a",(function(){return s})),t.d(n,"i",(function(){return _}));var i=t(5);const a={CLEAR_EXPLORER_DATA:"clearExplorerData",CLEAR_INFLUENCER_FILTER_SETTINGS:"clearInfluencerFilterSettings",CLEAR_JOBS:"clearJobs",JOB_SELECTION_CHANGE:"jobSelectionChange",SET_CHARTS_DATA_LOADING:"setChartsDataLoading",SET_EXPLORER_DATA:"setExplorerData"},r={ADD:"+",REMOVE:"-"},l={OVERALL:"overall",VIEW_BY:"viewBy"},o={EVENT_DISTRIBUTION:"event_distribution",POPULATION_DISTRIBUTION:"population_distribution",SINGLE_METRIC:"single_metric",GEO_MAP:"geo_map"},u=10,c=10,d=i.i18n.translate("xpack.ml.explorer.jobIdLabel",{defaultMessage:"job ID"}),f=i.i18n.translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"}),s=1e3,_=10},140:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));let i=function(e){return e[e.CRITICAL=75]="CRITICAL",e[e.MAJOR=50]="MAJOR",e[e.MINOR=25]="MINOR",e[e.WARNING=3]="WARNING",e[e.LOW=0]="LOW",e}({})},173:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var i=t(5),a=t(174);const r={critical:{id:a.a.CRITICAL,label:i.i18n.translate("xpack.ml.anomalyUtils.severity.criticalLabel",{defaultMessage:"critical"})},major:{id:a.a.MAJOR,label:i.i18n.translate("xpack.ml.anomalyUtils.severity.majorLabel",{defaultMessage:"major"})},minor:{id:a.a.MINOR,label:i.i18n.translate("xpack.ml.anomalyUtils.severity.minorLabel",{defaultMessage:"minor"})},warning:{id:a.a.WARNING,label:i.i18n.translate("xpack.ml.anomalyUtils.severity.warningLabel",{defaultMessage:"warning"})},unknown:{id:a.a.UNKNOWN,label:i.i18n.translate("xpack.ml.anomalyUtils.severity.unknownLabel",{defaultMessage:"unknown"})},low:{id:a.a.LOW,label:i.i18n.translate("xpack.ml.anomalyUtils.severityWithLow.lowLabel",{defaultMessage:"low"})}}},174:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));let i=function(e){return e.CRITICAL="critical",e.MAJOR="major",e.MINOR="minor",e.WARNING="warning",e.LOW="low",e.UNKNOWN="unknown",e}({})},181:function(e,n,t){"use strict";t.d(n,"a",(function(){return i})),t.d(n,"d",(function(){return a})),t.d(n,"b",(function(){return r})),t.d(n,"e",(function(){return l})),t.d(n,"c",(function(){return o}));let i=function(e){return e.SKIP_MODEL_UPDATE="skip_model_update",e.SKIP_RESULT="skip_result",e}({}),a=function(e){return e.EXCLUDE="exclude",e.INCLUDE="include",e}({}),r=function(e){return e.ACTUAL="actual",e.DIFF_FROM_TYPICAL="diff_from_typical",e.TYPICAL="typical",e}({}),l=function(e){return e.LESS_THAN="lt",e.LESS_THAN_OR_EQUAL="lte",e.GREATER_THAN="gt",e.GREATER_THAN_OR_EQUAL="gte",e}({});const o=["freq_rare","lat_long","metric","rare"]},252:function(e,n,t){"use strict";t.d(n,"a",(function(){return o})),t.d(n,"f",(function(){return d})),t.d(n,"e",(function(){return f})),t.d(n,"g",(function(){return s})),t.d(n,"c",(function(){return _})),t.d(n,"d",(function(){return m})),t.d(n,"i",(function(){return N})),t.d(n,"j",(function(){return O})),t.d(n,"h",(function(){return v})),t.d(n,"b",(function(){return b}));var i=t(140),a=t(173),r=t(181);let l=function(e){return e.BY="by",e.OVER="over",e.PARTITON="partition",e}({});const o={ADD:"+",REMOVE:"-"},u=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"],c=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"];function d(e){return"mlcategory"===e.entityName}function f(e){return e>=i.a.CRITICAL?a.a.critical:e>=i.a.MAJOR?a.a.major:e>=i.a.MINOR?a.a.minor:e>=i.a.WARNING?a.a.warning:e>=i.a.LOW?a.a.low:a.a.unknown}function s(e){if(void 0===e.anomaly_score_explanation)return!1;const n=e.anomaly_score_explanation.single_bucket_impact,t=e.anomaly_score_explanation.multi_bucket_impact;return void 0!==t&&0!==t&&!(void 0!==n&&n>t)&&((void 0===n||0===n)&&t>0||void 0!==n&&t>n&&(t-n)*t/n*1.7>=2)}function _(e){return e<2?1:e<4?2:e<7?3:e<12?4:5}function m(e){const n=[];return void 0!==e.partition_field_name&&n.push({fieldName:e.partition_field_name,fieldValue:e.partition_field_value,fieldType:l.PARTITON}),void 0!==e.over_field_name&&n.push({fieldName:e.over_field_name,fieldValue:e.over_field_value,fieldType:l.OVER}),void 0!==e.by_field_name&&void 0===e.over_field_name&&n.push({fieldName:e.by_field_name,fieldValue:e.by_field_value,fieldType:l.BY}),n}function N(e){return u.indexOf(e)>-1}function O(e){return c.indexOf(e)>-1}function v(e){return-1===r.c.indexOf(e.function)||void 0!==function(e){return void 0!==e.by_field_name&&void 0!==e.by_field_value?e.by_field_name:void 0!==e.over_field_name?e.over_field_name:void 0!==e.partition_field_name?e.partition_field_name:void 0}(e)}const b={toES(e){let n=e;return"mean"===n?n="avg":"distinct_count"===n?n="cardinality":"median"===n&&(n="percentiles"),n},toML(e){let n=e;return"avg"===n?n="mean":"cardinality"===n?n="distinct_count":"percentiles"===n&&(n="median"),n}}}}]);