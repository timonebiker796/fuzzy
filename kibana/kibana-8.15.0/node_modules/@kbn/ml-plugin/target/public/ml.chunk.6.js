/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[6],{184:function(t,e,s){"use strict";s.d(e,"e",(function(){return d})),s.d(e,"f",(function(){return h})),s.d(e,"a",(function(){return m})),s.d(e,"d",(function(){return b})),s.d(e,"b",(function(){return v})),s.d(e,"c",(function(){return x}));var a=s(8),i=s(39),o=s.n(i),r=s(31),n=s.n(r),l=s(40),u=s(135);const c="auto";function d(t,e,s){const a=t.url_value,i={...e};return a.includes("$earliest$")&&void 0!==s&&(i.earliest=s.from),a.includes("$latest$")&&void 0!==s&&(i.latest=s.to),m(t,i)}function h(t,e,s,a){const i=t.url_value,r=s[a],n="time_range"in t&&t.time_range?Object(l.a)(t.time_range):null,u={...s};if(i.includes("$earliest$")){const t=o()(r);null!==n?t.subtract(n):t.subtract(e,"s"),u.earliest=t.toISOString()}if(i.includes("$latest$")){const t=o()(r).add(e,"s");null!==n?t.add(n):t.add(e,"s"),u.latest=t.toISOString()}return m(t,u)}function m(t,e){return!0===p(t)?function(t,e){const s=t.url_value,i=s.includes("language:lucene"),o=i?u.c:f,r=Object(a.flow)(encodeURIComponent),l=t=>{const s=Object(a.flow)(i?t=>t:o,r);return t.replace(/\$([^?&$\'"]+)\$(\/)?/g,((t,i,o="")=>{let r=Object(a.get)(e,i);return r=Array.isArray(r)?r[0]:r,void 0===r?"":s(r)+o}))};return Object(a.flow)(decodeURIComponent,(t=>t.replace("$earliest$",e.earliest).replace("$latest$",e.latest)),(t=>{const s=Object(a.flow)(o,r),i=j(e,s),u=t.match(/(.+)(\(.*\blanguage:(?:lucene|kuery)\b.*?\))(.+)/);if(null!==u&&void 0!==u[2]){const[,t,e,s]=u,a=e.indexOf("language:kuery")>-1,o=n.a.decode(e);if(g(o)&&o.hasOwnProperty("query")){const[e,r]=[t,s].map(l),u=i(e,o.query,r,a);return`${e}${n.a.encode({...o,query:u})}${r}`}}return t.replace(/(.+&kuery=)(.*?)[^!](&.+)/,((e,s,a,o)=>{const[r,n]=[s,o].map(l);return`${r}${i(r,a,n,t.indexOf("language:kuery")>-1)}${n}`}))}),l)(s)}(t,e):Object(u.g)(t.url_value,e,!1)}function b(t,e,s){if(!1===/^(?:[a-z]+:)?\/\//i.test(e.url_value))"/"!==t.charAt(0)&&(t=`${s}${p(e)?"/app/":"/"}${t}`),window.open(t,"_blank");else{const e=window.open(t,"_blank","noopener,noreferrer");null!=e&&(e.opener=null)}}function p(t){const e=t.url_value;return e.startsWith("discover#/")||e.startsWith("dashboards#/")||e.startsWith("apm#/")||e.startsWith("metrics/")||e.startsWith("security/")||e.startsWith("siem#/")}function f(t){return String(t).replace(/\"/g,'\\"')}const g=t=>null!==t&&"object"==typeof t,j=(t,e)=>(s,i,o,r)=>{let n=2e3-s.length-o.length;const l=i.split(/\sand\s/i).map((t=>(t=>{let e="";for(let s=0;s<t.length;s++)if("$"===t[s]){let a=s;for(let e=a;e>-1;e--)if(":"===t[e]){a=e;break}e=t.slice(0,a).trim();let i=t.slice(a,t.length);const o=i.indexOf("$"),r=i.lastIndexOf("$");if(i=i.slice(o,r+1),i===`$${e}$`)break}return e})(String(t).replace(/\\/g,"")))),c=[];t:for(let s=0;s<l.length;s++){const i=l[s],o=r?`"${l[s]}"`:Object(u.c)(i);let d=Object(a.get)(t,i)||null;if(null===d)continue;d=Array.isArray(d)?d:[d];let h="";for(let t=0;t<d.length;t++){const s=`${t>0?" OR ":""}${o}:"${e(d[t])}"`;if(n<s.length){h.length>0&&c.push(t>0?`(${h})`:h);break t}h+=s,n-=h.length}h.length>0&&c.push(d.length>1?`(${h})`:h)}return c.join(" AND ")};function v(t,e){let s=void 0!==t&&t.trim().length>0;return!0===s&&void 0!==e&&(s=!e.map((t=>t.url_name)).includes(t)),s}function x(t){return void 0===t||0===t.length||t===c||null!==Object(l.a)(t)}},293:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var a=s(2),i=s(93),o=s(10);function r(){const{services:{dashboard:t}}=Object(o.d)();return Object(a.useMemo)((()=>{return e=t,{async fetchDashboards(t){const s=await e.findDashboardsService();return(await s.search({search:t?`${t}*`:"",size:1e3})).hits},async getDashboardEditUrl(t){var s;return await(null===(s=e.locator)||void 0===s?void 0:s.getUrl({dashboardId:t,viewMode:i.ViewMode.EDIT,useHash:!1}))}};var e}),[t])}},312:function(t,e,s){"use strict";s.d(e,"a",(function(){return custom_urls_CustomUrls}));var a=s(4),i=s.n(a),o=s(2),r=s.n(o),n=s(25),l=s(15),u=s(5),c=s(21),d=s(37);function h(t){return Object(d.a)(t,["dest","analysis","id"])&&"string"==typeof t.id}var m=s(71),b=s(68),p=s(10),f=s(184),g=s(39),j=s.n(g),v=s(8),x=s(31),O=s.n(x),y=s(578),E=s.n(y),U=s(3),I=s(110),w=s(75),C=s(218),S=s(67),_=s(159);const F="KIBANA_DASHBOARD",T="KIBANA_DISCOVER",R="OTHER",k={AUTO:"auto",INTERVAL:"interval"};var L=s(123),A=s(40),M=s(135),$=s(11);function N(t){return Object(d.a)(t)&&"string"==typeof t.job_id&&void 0!==t.analysis_config}function D(t,e,s,a){var i,o;const r={queryFieldNames:[]};let n=R;void 0!==e&&e.length>0?(n=F,r.dashboardId=e[0].id):void 0!==s&&s.length>0&&(n=T);let l,u,c,d,m={};var b,p;if(N(t)&&void 0!==s&&s.length>0&&void 0!==t.datafeed_config&&void 0!==t.datafeed_config.indices&&t.datafeed_config.indices.length>0)l=t.datafeed_config.indices.join(),m=null!==(b=null===(p=t.datafeed_config)||void 0===p?void 0:p.query)&&void 0!==b?b:{},d=t.job_id;else if((h(t)||a)&&void 0!==s&&s.length>0){var f,g;const e=t,s=Array.isArray(e.source.index)?e.source.index.join():e.source.index;l=a?s:e.dest.index,u=s,m=null!==(f=null===(g=e.source)||void 0===g?void 0:g.query)&&void 0!==f?f:{},d=e.id}const j=null===(i=s.find((t=>t.title===l)))||void 0===i?void 0:i.id;var v;return void 0===j&&void 0!==u&&(c=null===(v=s.find((t=>t.title===u)))||void 0===v?void 0:v.id),r.discoverIndexPatternId=null!==(o=null!=j?j:c)&&void 0!==o?o:"",r.filters=null===j?[]:Object(L.i)(m,j,d),{label:"",type:n,timeRange:{type:k.AUTO,interval:""},kibanaSettings:r,otherUrlSettings:{urlValue:""}}}function q(t){return t.type!==k.INTERVAL||null!==Object(A.a)(t.interval)}function J(t,e){if(e.type===F)return async function(t,e,s){var a,i,o,r;const{dashboardId:n,queryFieldNames:l}=null!==(a=e.kibanaSettings)&&void 0!==a?a:{};if(!t)throw Error(`Missing dashboard service (got ${t})`);if(!Object(S.a)(n))throw Error(`DashboardId is invalid (got ${n})`);const u=await t.findDashboardsService(),c=await u.findByIds([n]);if(!c||0===c.length||"error"===c[0].status)throw Error(`Unable to find dashboard with id ${n} (got ${c})`);const d=c[0];let h,m=null==e||null===(i=e.kibanaSettings)||void 0===i?void 0:i.filters;const b=d.attributes.kibanaSavedObjectMeta.searchSourceJSON;if(void 0!==b){const t=JSON.parse(b);Array.isArray(t.filter)&&t.filter.length>0&&(m=t.filter),h=t.query}const p=V(null!=l?l:[]);void 0!==p&&(h=p);const{from:f,to:g}=P(e),j=await(null===(o=t.locator)||void 0===o?void 0:o.getLocation({dashboardId:n,timeRange:{from:f,to:g,mode:"absolute"},filters:m,query:h,useHash:!1})),v=null==j?void 0:j.state,x=Object(U.setStateToKbnUrl)("_a",Object(I.cleanEmptyKeys)({query:v.query,filters:null===(r=v.filters)||void 0===r?void 0:r.filter((t=>!Object(w.isFilterPinned)(t))),savedQuery:v.savedQuery}),{useHash:!1,storeInHashQuery:!0},null==j?void 0:j.path),O={url_name:e.label,url_value:decodeURIComponent(`dashboards${E.a.parse(x).hash}`),time_range:k.AUTO};return e.timeRange.type===k.INTERVAL&&(O.time_range=e.timeRange.interval),e.customTimeRange&&(O.is_custom_time_range=!0),O}(t,e);if(e.type===T)return Promise.resolve(function(t){var e;const{discoverIndexPatternId:s,queryFieldNames:a,filters:i}=null!==(e=t.kibanaSettings)&&void 0!==e?e:{},{from:o,to:r}=P(t),n=O.a.encode({time:{from:o,to:r,mode:"absolute"}}),l={index:s,filters:i},u=V(null!=a?a:[]);void 0!==u&&(l.query=u);const c=`discover#/?_g=${n}&_a=${O.a.encode(l)}`,d={url_name:t.label,url_value:c,time_range:k.AUTO};return t.timeRange.type===k.INTERVAL&&(d.time_range=t.timeRange.interval),t.customTimeRange&&(d.is_custom_time_range=!0),d}(e));{var s,a;const t={url_name:e.label,url_value:null!==(s=null===(a=e.otherUrlSettings)||void 0===a?void 0:a.urlValue)&&void 0!==s?s:"",...e.customTimeRange?{is_custom_time_range:!0}:{}};return Promise.resolve(t)}}function P(t){var e,s;let a,i;return t.customTimeRange&&t.customTimeRange.start&&t.customTimeRange.end&&(a=t.customTimeRange.start.toISOString(),i=t.customTimeRange.end.toISOString()),{from:null!==(e=a)&&void 0!==e?e:"$earliest$",to:null!==(s=i)&&void 0!==s?s:"$latest$"}}function V(t){let e;if(void 0!==t&&t.length>0){let s="";t.forEach(((t,e)=>{e>0&&(s+=" and "),s+=`${Object(M.c)(t)}:"$${t}$"`})),e={language:"kuery",query:s}}return e}function z(t,e,s,a,i){return h(t)||i?async function(t,e,s,a,i){const o=Array.isArray(t.source.index)?t.source.index.join():t.source.index;let r,n,l=e.url_value;try{const d={index:i?o:t.dest.index,body:{size:1}};var u,c;if(n=await $.ml.esSearch(d),n&&n.hits.total.value>0?r=n.hits.hits[0]._source:(n=await $.ml.esSearch({index:Array.isArray(t.source.index)?t.source.index.join(","):t.source.index,body:{size:1}}),r=null===(u=n)||void 0===u||null===(c=u.hits)||void 0===c?void 0:c.hits[0]._source),r){const t=void 0!==e.time_range?Object(A.a)(e.time_range):null;if(null!==t&&null!==s){const a=r[s],i=e.url_value;if(i.includes("$earliest$")){const e=j()(a);e.subtract(t),r.earliest=e.toISOString()}if(i.includes("$latest$")){const e=j()(a);e.add(t),r.latest=e.toISOString()}l=Object(M.g)(e.url_value,r,!0)}else l=Object(f.e)(e,r,a)}return l}catch(t){}return l}(t,e,s,a,i):async function(t,e){const s=Object(A.a)(t.analysis_config.bucket_span),a=null!==s?s.asSeconds():0;let i=e.url_value;const o={query:{bool:{must:[{term:{job_id:t.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};let r;try{r=await $.ml.results.anomalySearch({body:o},[t.job_id])}catch(t){}if(r&&r.hits.total.value>0){const t=r.hits.hits[0]._source;return i=Object(f.f)(e,a,t,"timestamp"),i}{let s=Object(v.cloneDeep)(t),{datafeed_config:o}=s;try{var n,l;const[{jobs:e},{datafeeds:a}]=await Promise.all([$.ml.getJobs({jobId:t.job_id}),$.ml.getDatafeeds({datafeedId:null!==(n=null===(l=t.datafeed_config)||void 0===l?void 0:l.datafeed_id)&&void 0!==n?n:""})]);o=a[0],s=e[0]}catch(t){}if(void 0===s||void 0===o)return i;void 0!==o.authorization&&delete o.authorization,o&&void 0!==s.datafeed_config&&delete s.datafeed_config;const r=await $.ml.jobs.datafeedPreview(void 0,s,o),u=t.data_description.time_field,c=r[0];return void 0!==c&&(i=Object(f.f)(e,a,c,u)),i}}(t,e)}var B=s(6);const W=({job:t,customUrls:e,onChange:s,dataViewListItems:a,isPartialDFAJob:i})=>{const{services:{http:c,data:{dataViews:d}}}=Object(p.d)(),{displayErrorToast:g}=Object(m.useToastNotificationService)(),[j,v]=Object(o.useState)(null),x=e.map(((o,m)=>{const p=o.url_name,x=[...e];x.splice(m,1);const O=!Object(f.b)(p,x),y=O?[u.i18n.translate("xpack.ml.customUrlEditorList.labelIsNotUniqueErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[],E=o.time_range,U=!0===o.is_custom_time_range,I=!function(t){return void 0===t||0===t.length||t===k.AUTO||null!==Object(A.a)(t)}(E),w=I?[u.i18n.translate("xpack.ml.customUrlEditorList.invalidTimeRangeFormatErrorMessage",{defaultMessage:"Invalid format"})]:[];return Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiFlexGroup,{key:`url_${m}`,"data-test-subj":`mlJobEditCustomUrlItem_${m}`},Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlEditorList.labelLabel",defaultMessage:"Label"}),isInvalid:O,error:y,"data-test-subj":"mlJobEditCustomUrlItemLabel"},Object(B.jsx)(n.EuiFieldText,{value:p,isInvalid:O,onChange:t=>((t,a)=>{a<e.length&&(e[a]={...e[a],url_name:t.target.value},s([...e]))})(t,m),"data-test-subj":`mlJobEditCustomUrlLabelInput_${m}`}))),Object(B.jsx)(n.EuiFlexItem,null,Object(B.jsx)(n.EuiFormRow,{fullWidth:!0,label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlEditorList.urlLabel",defaultMessage:"URL"})},m===j?Object(B.jsx)(n.EuiTextArea,{inputRef:t=>{t&&t.focus()},fullWidth:!0,value:o.url_value,onChange:t=>((t,a)=>{a<e.length&&(e[a]={...e[a],url_value:t.target.value},s([...e]))})(t,m),onBlur:()=>{v(null)},"data-test-subj":`mlJobEditCustomUrlTextarea_${m}`}):Object(B.jsx)(n.EuiFieldText,{fullWidth:!0,value:o.url_value,readOnly:!0,onFocus:()=>v(m),"data-test-subj":`mlJobEditCustomUrlInput_${m}`}))),!1===U?Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlEditorList.timeRangeLabel",defaultMessage:"Time range"}),error:w,isInvalid:I},Object(B.jsx)(n.EuiFieldText,{value:o.time_range||"",isInvalid:I,placeholder:k.AUTO,onChange:t=>((t,a)=>{if(a<e.length){e[a]={...e[a]};const i=t.target.value;void 0!==i&&i.length>0?e[a].time_range=i:delete e[a].time_range,s([...e])}})(t,m)}))):null,Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiFormRow,{hasEmptyLabelSpace:!0},Object(B.jsx)(n.EuiToolTip,{content:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlEditorList.testCustomUrlTooltip",defaultMessage:"Test custom URL"})},Object(B.jsx)(n.EuiButtonIcon,{size:"s",color:"primary",onClick:()=>(async s=>{const o=e[s];let r=null;if(s<e.length&&(h(t)||i)&&void 0!==o.time_range&&o.time_range!==k.AUTO){const e=t;let s;if(o.url_value.includes("dashboards")){var n;const t=Array.isArray(e.source.index)?e.source.index.join():e.source.index,o=i?t:e.dest.index,r=t;var l;s=null==a||null===(n=a.find((t=>t.title===o)))||void 0===n?void 0:n.id,s||(s=null==a||null===(l=a.find((t=>t.title===r)))||void 0===l?void 0:l.id)}else{var m;s=null===(m=Object(b.b)(o.url_value)._a)||void 0===m?void 0:m.index}if(s){var p;const t=await d.get(s);r=null!==(p=null==t?void 0:t.timeFieldName)&&void 0!==p?p:null}}if(s<e.length)try{const e=await z(t,o,r,void 0,i);Object(f.d)(e,o,c.basePath.get())}catch(t){g(t,u.i18n.translate("xpack.ml.customUrlEditorList.obtainingUrlToTestConfigurationErrorMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))}})(m),iconType:"popout","aria-label":u.i18n.translate("xpack.ml.customUrlEditorList.testCustomUrlAriaLabel",{defaultMessage:"Test custom URL"}),"data-test-subj":"mlJobEditTestCustomUrlButton"})))),Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiFormRow,{hasEmptyLabelSpace:!0},Object(B.jsx)(n.EuiToolTip,{content:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlEditorList.deleteCustomUrlTooltip",defaultMessage:"Delete custom URL"})},Object(B.jsx)(n.EuiButtonIcon,{size:"s",color:"danger",onClick:()=>(t=>{t<e.length&&(e.splice(t,1),s([...e]))})(m),iconType:"trash","aria-label":u.i18n.translate("xpack.ml.customUrlEditorList.deleteCustomUrlAriaLabel",{defaultMessage:"Delete custom URL"}),"data-test-subj":`mlJobEditDeleteCustomUrlButton_${m}`}))))),Object(B.jsx)(n.EuiSpacer,{size:"m"}))}));return Object(B.jsx)("div",{"data-test-subj":"mlJobEditCustomUrlsList"},x)},H=({onCustomTimeRangeChange:t,customTimeRange:e,disabled:s})=>{const[a,i]=Object(o.useState)(!1),{services:{data:{query:{timefilter:{timefilter:c}}}}}=Object(p.d)(),d=Object(o.useMemo)((()=>null!=e?e:{start:j()(c.getAbsoluteTime().from),end:j()(c.getAbsoluteTime().to)}),[e,c]),{start:h,end:m}=d;return Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSwitch,{disabled:s,label:u.i18n.translate("xpack.ml.customUrlsEditor.addCustomTimeRangeSwitchLabel",{defaultMessage:"Add custom time range"}),checked:a,onChange:e=>{return s=e.target.checked,t(!1===s?void 0:d),void i(s);var s}}),a?Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSpacer,{size:"s"}),Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.customTimeRangeLabel",defaultMessage:"Custom time range"})},Object(B.jsx)(n.EuiDatePickerRange,{"data-test-subj":"mlCustomUrlsDateRange",isInvalid:h>m,startDateControl:Object(B.jsx)(n.EuiDatePicker,{selected:h,onChange:e=>{t({...d,start:e})},startDate:h,endDate:m,"aria-label":u.i18n.translate("xpack.ml.customUrlsEditor.customTimeRangeStartDate",{defaultMessage:"Start date"}),showTimeSelect:!0}),endDateControl:Object(B.jsx)(n.EuiDatePicker,{selected:m,onChange:e=>{t({...d,end:e})},startDate:h,endDate:m,"aria-label":u.i18n.translate("xpack.ml.customUrlsEditor.customTimeRangeEndDate",{defaultMessage:"End date"}),showTimeSelect:!0})}))):null)};const K=({setAddIntervalTimerange:t,addIntervalTimerange:e,disabled:s})=>Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSpacer,{size:"xs"}),Object(B.jsx)(n.EuiSwitch,{"data-test-subj":"mlJobCustomUrlIntervalTimeRangeSwitch",disabled:s,showLabel:!0,label:u.i18n.translate("xpack.ml.customUrlsEditor.addIntervalTimeRangeSwitchLabel",{defaultMessage:"Add interval time range"}),checked:e,onChange:e=>t(e.target.checked)})),G=({customUrl:t,setEditCustomUrl:e,savedCustomUrls:s,dashboards:a,dataViewListItems:i,showCustomTimeRangeSelector:c,job:d,isPartialDFAJob:m})=>{var b;const[g,j]=Object(o.useState)([]),[v,x]=Object(o.useState)(!1),[O,y]=Object(o.useState)(!1),{services:{data:{dataViews:E}}}=Object(p.d)(),U=Object(o.useRef)(!0);if(Object(o.useEffect)((()=>{void 0!==d&&async function(){var e;let s;const a=null==t||null===(e=t.kibanaSettings)||void 0===e?void 0:e.discoverIndexPatternId;try{s=await E.get(null!=a?a:"")}catch(t){s=void 0}s&&s.timeFieldName&&x(!0);const i=await function(t,e,s,a){return N(e)&&t?function(t){const e=t.analysis_config.influencers,s=t.analysis_config.detectors,a=[];return void 0!==e&&a.push(...e),s.forEach(((e,s)=>{Object(L.k)(t,s).forEach((t=>{-1===a.indexOf(t)&&a.push(t)}))})),a}(e):!h(e)&&!a&&t||void 0===s?[]:function(t,e){var s;const a=null!==(s=e.fields.getAll().sort(((t,e)=>t.name.localeCompare(e.name))))&&void 0!==s?s:[];let i=t=>_.a.some((e=>{var s;return null===(s=t.esTypes)||void 0===s?void 0:s.includes(e)}));if(h(t)){const e=t.dest.results_field;i=t=>_.a.some((e=>{var s;return null===(s=t.esTypes)||void 0===s?void 0:s.includes(e)}))&&!t.name.startsWith(null!=e?e:C.d)}return a.filter(i).map((t=>t.name))}(e,s)}(U.current,d,s,m);j(i),U.current&&(U.current=!1)}()}),[E,d,null==t||null===(b=t.kibanaSettings)||void 0===b?void 0:b.discoverIndexPatternId,m]),Object(o.useEffect)((()=>{!1===O&&e({...t,timeRange:{type:k.AUTO,interval:""}})}),[O,e]),void 0===t)return null;const{label:I,type:w,timeRange:S,kibanaSettings:A,otherUrlSettings:M}=t,$=a.map((t=>({value:t.id,text:t.attributes.title}))),D=i.map((({id:t,title:e})=>({value:t,text:e}))),J=g.map((t=>({label:t})));let P=[];void 0!==A&&void 0!==A.queryFieldNames&&(P=A.queryFieldNames.map((t=>({label:t}))));const V=Object.values(k).map((t=>({value:t,text:t}))),z=!Object(f.b)(I,s),W=z?[u.i18n.translate("xpack.ml.customUrlsEditor.invalidLabelErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[],G=!q(S),Q=G?[u.i18n.translate("xpack.ml.customUrlsList.invalidIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format"})]:[];return Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiTitle,{size:"xs"},Object(B.jsx)("h4",null,Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.createNewCustomUrlTitle",defaultMessage:"Create new custom URL"}))),Object(B.jsx)(n.EuiSpacer,{size:"m"}),Object(B.jsx)(n.EuiForm,{className:"ml-edit-url-form","data-test-subj":"mlJobCustomUrlForm"},Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.labelLabel",defaultMessage:"Label"}),error:W,isInvalid:z,display:"rowCompressed"},Object(B.jsx)(n.EuiFieldText,{name:"label",value:I,onChange:s=>{e({...t,label:s.target.value})},isInvalid:z,compressed:!0,"data-test-subj":"mlJobCustomUrlLabelInput"})),Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.linkToLabel",defaultMessage:"Link to"}),display:"rowCompressed"},Object(B.jsx)(n.EuiRadioGroup,{options:[{id:F,label:u.i18n.translate("xpack.ml.customUrlEditor.kibanaDashboardLabel",{defaultMessage:"Kibana dashboard"})},{id:T,label:u.i18n.translate("xpack.ml.customUrlEditor.discoverLabel",{defaultMessage:"Discover"})},{id:R,label:u.i18n.translate("xpack.ml.customUrlEditor.otherLabel",{defaultMessage:"Other"})}],idSelected:w,onChange:s=>{e({...t,type:s})},className:"url-link-to-radio","data-test-subj":"mlJobCustomUrlLinkToTypeInput"})),w===F&&Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.dashboardNameLabel",defaultMessage:"Dashboard name"}),display:"rowCompressed"},Object(B.jsx)(n.EuiSelect,{options:$,value:null==A?void 0:A.dashboardId,onChange:s=>{const a=t.kibanaSettings;e({...t,kibanaSettings:{...a,dashboardId:s.target.value}})},"data-test-subj":"mlJobCustomUrlDashboardNameInput",compressed:!0})),w===T&&Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.dataViewLabel",defaultMessage:"Data view"}),display:"rowCompressed"},Object(B.jsx)(n.EuiSelect,{options:D,value:null==A?void 0:A.discoverIndexPatternId,onChange:s=>{const a=t.kibanaSettings;e({...t,kibanaSettings:{...a,discoverIndexPatternId:s.target.value,queryFieldNames:[]}})},"data-test-subj":"mlJobCustomUrlDiscoverIndexPatternInput",compressed:!0})),(w===F||w===T)&&J.length>0&&Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.queryEntitiesLabel",defaultMessage:"Query entities"})},Object(B.jsx)(n.EuiComboBox,{placeholder:u.i18n.translate("xpack.ml.customUrlsEditor.selectEntitiesPlaceholder",{defaultMessage:"Select entities"}),options:J,selectedOptions:P,onChange:s=>{const a=s.map((t=>t.label)),i=t.kibanaSettings;e({...t,kibanaSettings:{...i,queryFieldNames:a}})},isClearable:!0,"data-test-subj":"mlJobCustomUrlQueryEntitiesInput"})),(w===F||w===T)&&v&&Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSpacer,{size:"m"}),Object(B.jsx)(n.EuiFlexGroup,null,Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(n.EuiFlexGroup,{gutterSize:"none",alignItems:"center"},Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.timeRangeLabel",defaultMessage:"Time range"})),c?Object(B.jsx)(n.EuiFlexItem,{grow:!1},Object(B.jsx)(n.EuiIconTip,{content:u.i18n.translate("xpack.ml.customUrlsEditor.timeRangeTooltip",{defaultMessage:"If not set, time range defaults to global settings."}),position:"top",type:"iInCircle"})):null),className:"url-time-range",display:"rowCompressed"},c?Object(B.jsx)(K,{disabled:void 0!==(null==t?void 0:t.customTimeRange),setAddIntervalTimerange:y,addIntervalTimerange:O}):Object(B.jsx)(n.EuiSelect,{options:V,value:S.type,onChange:s=>{const a=t.timeRange;e({...t,timeRange:{...a,type:s.target.value}})},"data-test-subj":"mlJobCustomUrlTimeRangeInput",compressed:!0}))),Object(B.jsx)(n.EuiFlexItem,null,c&&O||!c&&S.type===k.INTERVAL?Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.intervalLabel",defaultMessage:"Interval"}),className:"url-time-range",error:Q,isInvalid:G,display:"rowCompressed"},Object(B.jsx)(n.EuiFieldText,{value:S.interval,onChange:s=>{e({...t,timeRange:{type:k.INTERVAL,interval:s.target.value},customTimeRange:void 0})},isInvalid:G,"data-test-subj":"mlJobCustomUrlTimeRangeIntervalInput",compressed:!0})):null)),(w===F||w===T)&&c&&v?Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSpacer,null),Object(B.jsx)(H,{disabled:O,onCustomTimeRangeChange:s=>{e({...t,customTimeRange:s,timeRange:{type:k.AUTO,interval:""}})},customTimeRange:null==t?void 0:t.customTimeRange})):null),w===R&&Object(B.jsx)(n.EuiFormRow,{label:Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.customUrlsEditor.urlLabel",defaultMessage:"URL"}),display:"rowCompressed",fullWidth:!0},Object(B.jsx)(n.EuiTextArea,{fullWidth:!0,rows:2,value:null==M?void 0:M.urlValue,onChange:s=>{e({...t,otherUrlSettings:{urlValue:s.target.value}})},"data-test-subj":"mlJobCustomUrlOtherTypeUrlInput",compressed:!0}))))};var Q=s(77);class custom_urls_CustomUrls extends o.Component{constructor(t){super(t),i()(this,"toastNotificationService",void 0),i()(this,"editNewCustomUrl",(()=>{this.setState((t=>{const{dashboards:e,dataViewListItems:s}=t;return{editorOpen:!0,editorSettings:D(this.props.job,e,s,this.props.isPartialDFAJob)}}))})),i()(this,"setEditCustomUrl",(t=>{this.setState({editorSettings:t})})),i()(this,"addNewCustomUrl",(()=>{const{dashboard:t}=this.context.services;J(t,this.state.editorSettings).then((t=>{const e=[...this.state.customUrls,t];this.props.setCustomUrls(e),this.setState({editorOpen:!1})})).catch((t=>{this.toastNotificationService.displayErrorToast(t,u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.addNewUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the new custom URL from the supplied settings"}))}))})),i()(this,"onTestButtonClick",(()=>{var t,e,s;const{http:{basePath:a},data:{dataViews:i},dashboard:o}=this.context.services,r=null===(t=this.state)||void 0===t||null===(e=t.editorSettings)||void 0===e||null===(s=e.kibanaSettings)||void 0===s?void 0:s.discoverIndexPatternId,n=this.props.job;i.get(null!=r?r:"").catch((t=>{console.error("Error obtaining data view:",t)})).then((t=>{var e;const s=null!==(e=null==t?void 0:t.timeFieldName)&&void 0!==e?e:null;J(o,this.state.editorSettings).then((t=>{z(n,t,s,this.props.currentTimeFilter,this.props.isPartialDFAJob).then((e=>{Object(f.d)(e,t,a.get())})).catch((t=>{this.toastNotificationService.displayErrorToast(t,u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.getTestUrlErrorNotificationMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))}))}))})).catch((t=>{this.toastNotificationService.displayErrorToast(t,u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.buildUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the custom URL for testing from the supplied settings"}))}))})),i()(this,"closeEditor",(()=>{this.setState({editorOpen:!1})})),this.state={customUrls:[],dashboards:[],dataViewListItems:[],editorOpen:!1,supportedFilterFields:[]}}static getDerivedStateFromProps(t){return{job:t.job,customUrls:t.jobCustomUrls}}componentDidMount(){const{toasts:t}=this.context.services.notifications;this.toastNotificationService=Object(m.toastNotificationServiceProvider)(t);const{dashboardService:e}=this.props,s=Object(Q.indexServiceFactory)(this.context.services.data.dataViews);e.fetchDashboards().then((t=>{this.setState({dashboards:t})})).catch((t=>{this.toastNotificationService.displayErrorToast(t,u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadSavedDashboardsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved Kibana dashboards"}))})),s.loadDataViewListItems().then((t=>{this.setState({dataViewListItems:t})})).catch((t=>{this.toastNotificationService.displayErrorToast(t,u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadDataViewsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved data views"}))}))}renderEditor(){var t;const{customUrls:e,editorOpen:s,editorSettings:a,dashboards:i,dataViewListItems:o}=this.state,r=null!==(t=this.props.editMode)&&void 0!==t?t:"inline",c=Object(B.jsx)(G,{showCustomTimeRangeSelector:h(this.props.job)||!0===this.props.isPartialDFAJob,customUrl:a,setEditCustomUrl:this.setEditCustomUrl,savedCustomUrls:e,dashboards:i,dataViewListItems:o,job:this.props.job,isPartialDFAJob:this.props.isPartialDFAJob}),d=!s||void 0===a||function(t,e){let s=Object(f.b)(t.label,e);return!0===s&&(s=q(t.timeRange)),s}(a,e),m=Object(B.jsx)(n.EuiButton,{onClick:this.addNewCustomUrl,isDisabled:!d,"data-test-subj":"mlJobAddCustomUrl"},Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addButtonLabel",defaultMessage:"Add"})),b=Object(B.jsx)(n.EuiButtonEmpty,{iconType:"popout",iconSide:"right",onClick:this.onTestButtonClick,isDisabled:!d},Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.testButtonLabel",defaultMessage:"Test"}));return"inline"===r?Object(B.jsx)(n.EuiPanel,{className:"edit-custom-url-panel"},Object(B.jsx)(n.EuiButtonIcon,{color:"text",onClick:this.closeEditor,iconType:"cross","aria-label":u.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrls.closeEditorAriaLabel",{defaultMessage:"Close custom URL editor"})}),c,Object(B.jsx)(n.EuiSpacer,{size:"m"}),Object(B.jsx)(n.EuiFlexGroup,null,Object(B.jsx)(n.EuiFlexItem,{grow:!1},m),Object(B.jsx)(n.EuiFlexItem,{grow:!1},b))):Object(B.jsx)(n.EuiModal,{onClose:this.closeEditor,initialFocus:"[name=label]",style:{width:500},"data-test-subj":"mlJobNewCustomUrlFormModal"},Object(B.jsx)(n.EuiModalHeader,null,Object(B.jsx)(n.EuiModalHeaderTitle,null,Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"}))),Object(B.jsx)(n.EuiModalBody,null,c),Object(B.jsx)(n.EuiModalFooter,null,b,m))}render(){const{customUrls:t,editorOpen:e}=this.state,{editMode:s="inline"}=this.props;return Object(B.jsx)(r.a.Fragment,null,Object(B.jsx)(n.EuiSpacer,{size:"m"}),(!e||"modal"===s)&&Object(B.jsx)(n.EuiButton,{size:"s",onClick:this.editNewCustomUrl,"data-test-subj":"mlJobOpenCustomUrlFormButton"},Object(B.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"})),e&&this.renderEditor(),Object(B.jsx)(n.EuiSpacer,{size:"l"}),Object(B.jsx)(W,{job:this.props.job,customUrls:t,onChange:this.props.setCustomUrls,dataViewListItems:this.state.dataViewListItems,isPartialDFAJob:this.props.isPartialDFAJob}))}}i()(custom_urls_CustomUrls,"contextType",c.context)},578:function(t,e,s){"use strict";var a=s(579),i=s(580);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=v,e.resolve=function(t,e){return v(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?v(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=v(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(u),d=["%","/","?",";","#"].concat(c),h=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,b=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},j=s(581);function v(t,e,s){if(t&&i.isObject(t)&&t instanceof o)return t;var a=new o;return a.parse(t,e,s),a}o.prototype.parse=function(t,e,s){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),n=-1!==o&&o<t.indexOf("#")?"?":"#",u=t.split(n);u[0]=u[0].replace(/\\/g,"/");var v=t=u.join(n);if(v=v.trim(),!s&&1===t.split("#").length){var x=l.exec(v);if(x)return this.path=v,this.href=v,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?j.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var O=r.exec(v);if(O){var y=(O=O[0]).toLowerCase();this.protocol=y,v=v.substr(O.length)}if(s||O||v.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===v.substr(0,2);!E||O&&f[O]||(v=v.substr(2),this.slashes=!0)}if(!f[O]&&(E||O&&!g[O])){for(var U,I,w=-1,C=0;C<h.length;C++)-1!==(S=v.indexOf(h[C]))&&(-1===w||S<w)&&(w=S);for(-1!==(I=-1===w?v.lastIndexOf("@"):v.lastIndexOf("@",w))&&(U=v.slice(0,I),v=v.slice(I+1),this.auth=decodeURIComponent(U)),w=-1,C=0;C<d.length;C++){var S;-1!==(S=v.indexOf(d[C]))&&(-1===w||S<w)&&(w=S)}-1===w&&(w=v.length),this.host=v.slice(0,w),v=v.slice(w),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var F=this.hostname.split(/\./),T=(C=0,F.length);C<T;C++){var R=F[C];if(R&&!R.match(m)){for(var k="",L=0,A=R.length;L<A;L++)R.charCodeAt(L)>127?k+="x":k+=R[L];if(!k.match(m)){var M=F.slice(0,C),$=F.slice(C+1),N=R.match(b);N&&(M.push(N[1]),$.unshift(N[2])),$.length&&(v="/"+$.join(".")+v),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=a.toASCII(this.hostname));var D=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+D,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!p[y])for(C=0,T=c.length;C<T;C++){var J=c[C];if(-1!==v.indexOf(J)){var P=encodeURIComponent(J);P===J&&(P=escape(J)),v=v.split(J).join(P)}}var V=v.indexOf("#");-1!==V&&(this.hash=v.substr(V),v=v.slice(0,V));var z=v.indexOf("?");if(-1!==z?(this.search=v.substr(z),this.query=v.substr(z+1),e&&(this.query=j.parse(this.query)),v=v.slice(0,z)):e&&(this.search="",this.query={}),v&&(this.pathname=v),g[y]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){D=this.pathname||"";var B=this.search||"";this.path=D+B}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",s=this.pathname||"",a=this.hash||"",o=!1,r="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(r=j.stringify(this.query));var n=this.search||r&&"?"+r||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==o?(o="//"+(o||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):o||(o=""),a&&"#"!==a.charAt(0)&&(a="#"+a),n&&"?"!==n.charAt(0)&&(n="?"+n),e+o+(s=s.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(n=n.replace("#","%23"))+a},o.prototype.resolve=function(t){return this.resolveObject(v(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var s=new o,a=Object.keys(this),r=0;r<a.length;r++){var n=a[r];s[n]=this[n]}if(s.hash=t.hash,""===t.href)return s.href=s.format(),s;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(s[c]=t[c])}return g[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(t.protocol&&t.protocol!==s.protocol){if(!g[t.protocol]){for(var d=Object.keys(t),h=0;h<d.length;h++){var m=d[h];s[m]=t[m]}return s.href=s.format(),s}if(s.protocol=t.protocol,t.host||f[t.protocol])s.pathname=t.pathname;else{for(var b=(t.pathname||"").split("/");b.length&&!(t.host=b.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==b[0]&&b.unshift(""),b.length<2&&b.unshift(""),s.pathname=b.join("/")}if(s.search=t.search,s.query=t.query,s.host=t.host||"",s.auth=t.auth,s.hostname=t.hostname||t.host,s.port=t.port,s.pathname||s.search){var p=s.pathname||"",j=s.search||"";s.path=p+j}return s.slashes=s.slashes||t.slashes,s.href=s.format(),s}var v=s.pathname&&"/"===s.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),O=x||v||s.host&&t.pathname,y=O,E=s.pathname&&s.pathname.split("/")||[],U=(b=t.pathname&&t.pathname.split("/")||[],s.protocol&&!g[s.protocol]);if(U&&(s.hostname="",s.port=null,s.host&&(""===E[0]?E[0]=s.host:E.unshift(s.host)),s.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===b[0]?b[0]=t.host:b.unshift(t.host)),t.host=null),O=O&&(""===b[0]||""===E[0])),x)s.host=t.host||""===t.host?t.host:s.host,s.hostname=t.hostname||""===t.hostname?t.hostname:s.hostname,s.search=t.search,s.query=t.query,E=b;else if(b.length)E||(E=[]),E.pop(),E=E.concat(b),s.search=t.search,s.query=t.query;else if(!i.isNullOrUndefined(t.search))return U&&(s.hostname=s.host=E.shift(),(_=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=_.shift(),s.host=s.hostname=_.shift())),s.search=t.search,s.query=t.query,i.isNull(s.pathname)&&i.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s;if(!E.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var I=E.slice(-1)[0],w=(s.host||t.host||E.length>1)&&("."===I||".."===I)||""===I,C=0,S=E.length;S>=0;S--)"."===(I=E[S])?E.splice(S,1):".."===I?(E.splice(S,1),C++):C&&(E.splice(S,1),C--);if(!O&&!y)for(;C--;C)E.unshift("..");!O||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),w&&"/"!==E.join("/").substr(-1)&&E.push("");var _,F=""===E[0]||E[0]&&"/"===E[0].charAt(0);return U&&(s.hostname=s.host=F?"":E.length?E.shift():"",(_=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=_.shift(),s.host=s.hostname=_.shift())),(O=O||s.host&&E.length)&&!F&&E.unshift(""),E.length?s.pathname=E.join("/"):(s.pathname=null,s.path=null),i.isNull(s.pathname)&&i.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=t.auth||s.auth,s.slashes=s.slashes||t.slashes,s.href=s.format(),s},o.prototype.parseHost=function(){var t=this.host,e=n.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},579:function(t,e,s){t.exports=s(57)(3089)},580:function(t,e,s){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},581:function(t,e,s){"use strict";e.decode=e.parse=s(582),e.encode=e.stringify=s(583)},582:function(t,e,s){"use strict";function a(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,s,o){e=e||"&",s=s||"=";var r={};if("string"!=typeof t||0===t.length)return r;var n=/\+/g;t=t.split(e);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var u=t.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var d,h,m,b,p=t[c].replace(n,"%20"),f=p.indexOf(s);f>=0?(d=p.substr(0,f),h=p.substr(f+1)):(d=p,h=""),m=decodeURIComponent(d),b=decodeURIComponent(h),a(r,m)?i(r[m])?r[m].push(b):r[m]=[r[m],b]:r[m]=b}return r};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},583:function(t,e,s){"use strict";var a=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,s,n){return e=e||"&",s=s||"=",null===t&&(t=void 0),"object"==typeof t?o(r(t),(function(r){var n=encodeURIComponent(a(r))+s;return i(t[r])?o(t[r],(function(t){return n+encodeURIComponent(a(t))})).join(e):n+encodeURIComponent(a(t[r]))})).join(e):n?encodeURIComponent(a(n))+s+encodeURIComponent(a(t)):""};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var s=[],a=0;a<t.length;a++)s.push(e(t[a],a));return s}var r=Object.keys||function(t){var e=[];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.push(s);return e}}}]);