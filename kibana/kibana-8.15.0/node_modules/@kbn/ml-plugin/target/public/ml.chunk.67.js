/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[67],{160:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(26),s=a.n(n),i=a(7),l=a(2),o=a(517),c=a(417),r=a(153);const d=()=>{const e=Object(o.c)(),t=()=>{const{from:t,to:a}=e.getTime();return{start:t,end:a}},a=Object(l.useMemo)((()=>Object(i.merge)(c.a,e.getTimeUpdate$().pipe(Object(i.map)((()=>({lastRefresh:Date.now(),timeRange:t()})))),r.b.pipe(Object(i.map)((e=>({lastRefresh:e})))))),[]);return s()(a)}},163:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(2),s=a.n(n),i=a(25),l=a(15),o=a(70),c=a(6);const r=()=>!0===Object(o.useUpgradeCheck)()?Object(c.jsx)(s.a.Fragment,null,Object(c.jsx)(i.EuiCallOut,{title:Object(c.jsx)(l.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningTitle",defaultMessage:"Index migration in progress"}),color:"warning",iconType:"warning"},Object(c.jsx)("p",null,Object(c.jsx)(l.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescription",defaultMessage:"Indices related to Machine Learning are currently being upgraded."}),Object(c.jsx)("br",null),Object(c.jsx)(l.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescriptionExtra",defaultMessage:"Some actions will not be available during this time."}))),Object(c.jsx)(i.EuiSpacer,{size:"m"})):null},167:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(116);const s=Object(n.a)((async()=>({default:(await a.e(96).then(a.bind(null,230))).JobSpacesSyncFlyout})))},169:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(2),s=a.n(n),i=a(25),l=a(15),o=a(10),c=a(167),r=a(70),d=a(6);const u=({mlSavedObjectType:e,onCloseFlyout:t,forceRefresh:a})=>{const{savedObjects:{syncCheck:u}}=Object(o.c)(),b=Object(n.useRef)(!1),[m,j]=Object(n.useState)(!1),[g,f]=Object(n.useState)(!1),[p,O,x]=Object(r.usePermissionCheck)(["canCreateJob","canCreateDataFrameAnalytics","canCreateTrainedModels"]),y=Object(n.useMemo)((()=>p||O||x),[O,p,x]),v=Object(n.useCallback)((async()=>{try{if(!1===b.current)return;const{result:t}=await u(e);!0===b.current&&j(g||t)}catch(e){console.log("Saved object synchronization check could not be performed.")}}),[g,j]);Object(n.useEffect)((function(){return b.current=!0,void 0!==a&&!0!==a||v(),()=>{b.current=!1}}),[a,b,v]);const h=Object(n.useCallback)((()=>{f(!1),void 0===a&&v(),"function"==typeof t&&t()}),[v,t,f]);return Object(n.useEffect)((function(){!1===m&&!0===b.current&&f(!1)}),[m,f]),!1===m?null:Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)(i.EuiCallOut,{title:Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.title",defaultMessage:"ML job and trained model synchronization required"}),color:"warning",iconType:"warning","data-test-subj":"mlJobSyncRequiredWarning"},Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.description",defaultMessage:"Some jobs or trained models are missing or have incomplete saved objects. "}),y?Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.link",defaultMessage:" {link}",values:{link:Object(d.jsx)(i.EuiLink,{onClick:f.bind(null,!0)},Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.linkToManagement.link",defaultMessage:"Synchronize your jobs and trained models."}))}}):Object(d.jsx)(l.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.noPermission",defaultMessage:"An Administrator can synchronize the jobs and trained models in Stack Management."}),g&&Object(d.jsx)(c.a,{onClose:h}))),Object(d.jsx)(i.EuiSpacer,{size:"m"}))}},209:function(e,t,a){"use strict";var n=a(163);a.d(t,"a",(function(){return n.a}))},878:function(e,t,a){"use strict";a.r(t),a.d(t,"NotificationsPage",(function(){return R}));var n=a(2),s=a.n(n),i=a(15),l=a(517),o=a(39),c=a.n(o),r=a(5),d=a(25),u=a(29),b=a(172),m=a.n(b),j=a(249),g=a.n(j),f=a(68),p=a(8),O=a(10),x=a(71),y=a(122),v=a(6);const h={anomaly_detector:!0,data_frame_analytics:!0,trained_models:!0},M=({entityTypes:e=h,multiSelect:t=!0,selectedOptions:a,onSelectionChange:s,handleDuplicates:i=!1})=>{const{isADEnabled:l,isDFAEnabled:o,isNLPEnabled:c}=Object(y.d)(),{jobs:u,trainedModels:b,dataFrameAnalytics:m}=Object(O.c)(),{displayErrorToast:j}=Object(x.useToastNotificationService)(),f=Object(d.euiPaletteColorBlindBehindText)(),[M,S]=Object(n.useState)(!0),[k,F]=Object(n.useState)([]),_=Object(n.useCallback)((async()=>{try{const t=[];if(l&&null!=e&&e.anomaly_detector){const{jobIds:e}=await u.getAllJobAndGroupIds();t.push({label:r.i18n.translate("xpack.ml.mlEntitySelector.adOptionsLabel",{defaultMessage:"Anomaly detection jobs"}),isGroupLabelOption:!0,color:f[0],options:e.map((e=>({label:e,value:e,id:`anomaly_detector:${e}`,key:`anomaly_detector:${e}`,color:f[0],"data-test-subj":"mlAdJobOption"})))})}if(o&&null!=e&&e.data_frame_analytics){const e=await m.getDataFrameAnalytics();e.count>0&&t.push({label:r.i18n.translate("xpack.ml.mlEntitySelector.dfaOptionsLabel",{defaultMessage:"Data frame analytics"}),isGroupLabelOption:!0,options:e.data_frame_analytics.map((({id:e})=>({label:e,value:e,id:`data_frame_analytics:${e}`,key:`data_frame_analytics:${e}`,color:f[2],"data-test-subj":"mlDfaJobOption"})))})}if((o||c)&&null!=e&&e.trained_models){const e=await b.getTrainedModels();e.length>0&&t.push({label:r.i18n.translate("xpack.ml.mlEntitySelector.trainedModelsLabel",{defaultMessage:"Trained models"}),isGroupLabelOption:!0,options:e.map((({model_id:e})=>({label:e,value:e,id:`trained_models:${e}`,key:`trained_models:${e}`,color:f[3],"data-test-subj":"mlTrainedModelOption"})))})}F(t)}catch(e){j(e,r.i18n.translate("xpack.ml.mlEntitySelector.fetchError",{defaultMessage:"Failed to fetch ML entities"}))}S(!1)}),[u,b,m,e,f,j,l,o,c]);g()((function(){_()}));const E=Object(n.useMemo)((()=>(null!=a?a:[]).flatMap((e=>{const t=k.flatMap((e=>e.options)).filter((t=>t.value===e.id));return t.length>0?t:[{value:e.id,label:e.id,key:`unknown:${e.id}`,"data-test-subj":`mlUnknownOption ${e.id}`}]}))),[k,a]),T=Object(n.useCallback)((e=>{if(!s)return;let t=e;if(i){const a=Object(p.countBy)(E,"value"),n=Object(p.countBy)(e,"value");t=t.filter((({value:e})=>!(a[e]>1&&n[e]<a[e])))}s(t.map((e=>{const[t]=e.key.split(":");return{id:e.value,type:t}})))}),[s,E,i]);return Object(v.jsx)(d.EuiComboBox,{autoFocus:!0,isLoading:M,singleSelection:!t,selectedOptions:E,options:k,onChange:T,fullWidth:!0,"data-test-subj":"mlEntitySelector_"+(M?"loading":"loaded"),isInvalid:!1})};var S={name:"18ji2p4",styles:"width:300px"};const k=s.a.memo((({query:e,onChange:t})=>{const[a,s]=Object(n.useState)(!1),l=e.hasOrFieldClause("job_id")||e.hasSimpleFieldClause("job_id"),o=e.getOrFieldClause("job_id"),c=e.getSimpleFieldClause("job_id"),r=s.bind(null,!1),u=Object(n.useMemo)((()=>{let e=[];return o&&Array.isArray(o.value)&&(e=o.value.map((e=>({id:e})))),c&&c.value&&e.push({id:c.value}),e}),[o,c]),b=Object(n.useCallback)((a=>{let n=e.removeOrFieldClauses("job_id");n=n.removeSimpleFieldClauses("job_id"),a.length>0&&(n=Object(p.uniqBy)(a,"id").reduce(((e,t)=>e.addOrFieldValue("job_id",t.id,!0,"eq")),n)),t(n)}),[t,e]),m=Object(v.jsx)(d.EuiFilterButton,{iconType:"arrowDown",iconSide:"right",onClick:s.bind(null,(e=>!e)),hasActiveFilters:l,numActiveFilters:l?u.length:void 0,grow:!0},Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.entityFilter",defaultMessage:"Entity"}));return Object(v.jsx)(d.EuiPopover,{button:m,isOpen:a,closePopover:r,panelPaddingSize:"none",anchorPosition:"downCenter"},Object(v.jsx)(d.EuiPanel,{paddingSize:"s",css:S},Object(v.jsx)(M,{selectedOptions:u,onSelectionChange:b,handleDuplicates:!0})))}));var F=a(396);const _="error",E="info",T="warning";var C=a(169),w=a(45),L=a(160),A=a(251),D=a(1);const I={[_]:"danger",[T]:"warning",[E]:"default"},N=()=>{const{services:{mlServices:{mlApiServices:e}}}=Object(O.d)(),{isADEnabled:t,isDFAEnabled:a,isNLPEnabled:o}=Object(y.d)(),{displayErrorToast:b}=Object(x.useToastNotificationService)(),{lastCheckedAt:j,setLastCheckedAt:p,notificationsCounts:h,latestRequestedAt:M}=Object(F.b)(),S=Object(l.c)(),N=Object(l.b)();g()((function(){null!==M&&S.setTime({from:c()(M).toISOString(),to:"now"})}));const[z,P]=Object(n.useState)(!0),[B,W]=Object(n.useState)([]),[R,q]=Object(n.useState)(0),[$,J]=Object(n.useState)(""),Q=Object(w.b)(u.FIELD_FORMAT_IDS.DATE),[G,U]=Object(f.c)(D.b.NOTIFICATIONS,{pageIndex:0,pageSize:25,sortField:"timestamp",sortDirection:"desc"}),{onTableChange:H,pagination:V,sorting:K}=Object(A.a)(R,G,U),X=Object(L.a)(),Y=G.queryText,Z=Object(n.useMemo)((()=>{try{return J(""),d.EuiSearchBar.Query.parse(null!=Y?Y:"")}catch(e){J(e.message)}}),[Y,J]),ee=Object(n.useCallback)((async()=>{if(!Z)return;const t=d.EuiSearchBar.Query.toESQueryString(Z);try{P(!0);const a=await e.notifications.findMessages({sortField:K.sort.field,sortDirection:K.sort.direction,earliest:N.from,latest:N.to,queryString:t});W(a.results),q(a.total)}catch(e){b(e,r.i18n.translate("xpack.ml.notifications.fetchFailedError",{defaultMessage:"Error loading list of notifications"}))}P(!1)}),[K,Z,e.notifications,b,N]);Object(n.useEffect)((function(){const e=V.pageIndex*V.pageSize,t=B.slice(e,e+V.pageSize),a=Math.max(...t.map((e=>e.timestamp)),null!=j?j:0);a!==j&&0!==a&&p(a)}),[j,p,B,V.pageIndex,V.pageSize]),m()((function(){ee()}),500,[K,Z,X]);const te=Object(n.useMemo)((()=>[{id:"timestamp",field:"timestamp",name:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.timeLabel",defaultMessage:"Time"}),sortable:!0,truncateText:!1,"data-test-subj":"mlNotificationTime",width:"250px",render:e=>Q(e)},{field:"level",name:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.levelLabel",defaultMessage:"Level"}),sortable:!0,truncateText:!1,"data-test-subj":"mlNotificationLevel",render:e=>Object(v.jsx)(d.EuiBadge,{color:I[e]},e),width:"100px"},{field:"job_type",name:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.typeLabel",defaultMessage:"Type"}),sortable:!0,truncateText:!1,"data-test-subj":"mlNotificationType",render:e=>Object(v.jsx)(d.EuiBadge,{color:"hollow"},e),width:"200px"},{field:"job_id",name:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.entityLabel",defaultMessage:"Entity ID"}),sortable:!0,truncateText:!1,"data-test-subj":"mlNotificationEntity",width:"200px"},{field:"message",name:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.messageLabel",defaultMessage:"Message"}),sortable:!1,truncateText:!1,"data-test-subj":"mlNotificationMessage"}]),[Q]),ae=Object(n.useMemo)((()=>{const e=[];return!0===t&&e.push({value:"anomaly_detector",name:r.i18n.translate("xpack.ml.notifications.filters.type.anomalyDetector",{defaultMessage:"Anomaly Detection"})}),!0===a&&e.push({value:"data_frame_analytics",name:r.i18n.translate("xpack.ml.notifications.filters.type.dfa",{defaultMessage:"Data Frame Analytics"})}),!0!==o&&!0!==a||e.push({value:"inference",name:r.i18n.translate("xpack.ml.notifications.filters.type.inference",{defaultMessage:"Inference"})}),e.push({value:"system",name:r.i18n.translate("xpack.ml.notifications.filters.type.system",{defaultMessage:"System"})}),[{type:"field_value_selection",field:"level",name:r.i18n.translate("xpack.ml.notifications.filters.level.name",{defaultMessage:"Level"}),multiSelect:"or",options:[{value:_,name:r.i18n.translate("xpack.ml.notifications.filters.level.error",{defaultMessage:"Error"}),field:"level"},{value:T,name:r.i18n.translate("xpack.ml.notifications.filters.level.warning",{defaultMessage:"Warning"}),field:"level"},{value:E,name:r.i18n.translate("xpack.ml.notifications.filters.level.info",{defaultMessage:"Info"}),field:"level"}]},{type:"field_value_selection",field:"job_type",name:r.i18n.translate("xpack.ml.notifications.filters.level.type",{defaultMessage:"Type"}),multiSelect:"or",options:e},{type:"custom_component",component:k}]}),[t,a,o]),ne=Object.values(h).reduce(((e,t)=>e+t)),se=Object(n.useMemo)((()=>{const e=V.pageIndex*V.pageSize,t=e+V.pageSize;return B.slice(e,t)}),[B,V]);return Object(v.jsx)(s.a.Fragment,null,Object(v.jsx)(C.a,{onCloseFlyout:ee,forceRefresh:z}),ne&&!z?Object(v.jsx)(s.a.Fragment,null,Object(v.jsx)(d.EuiCallOut,{size:"s",title:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.newNotificationsMessage",defaultMessage:"There {newNotificationsCount, plural, one {is # notification} other {are # notifications}} since {sinceDate}. Refresh the page to view updates.",values:{sinceDate:Q(M),newNotificationsCount:ne}}),iconType:"bell"}),Object(v.jsx)(d.EuiSpacer,{size:"m"})):null,Object(v.jsx)(d.EuiSearchBar,{query:Z,box:{placeholder:r.i18n.translate("xpack.ml.notifications.searchPlaceholder",{defaultMessage:"Search for notifications. Example: job_type:anomaly_detector -level:(info) Datafeed"}),incremental:!1,schema:{strict:!0,fields:{level:{type:"string",name:"level",searchable:!1,aggregatable:!0},job_type:{type:"string",name:"job_type",searchable:!1,aggregatable:!0},job_id:{type:"string",name:"job_id",searchable:!1,aggregatable:!0},message:{type:"string",name:"message",searchable:!0,aggregatable:!1}}},"data-test-subj":"mlNotificationsSearchBarInput"},filters:ae,onChange:e=>{U({queryText:e.queryText})},"data-test-subj":"mlNotificationsSearchBar"}),Object(v.jsx)(d.EuiSpacer,{size:"m"}),$?Object(v.jsx)(s.a.Fragment,null,Object(v.jsx)(d.EuiCallOut,{size:"s",title:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.invalidQueryError",defaultMessage:"Query is not valid: "}),color:"danger",iconType:"warning"},Object(v.jsx)("p",null,$)),Object(v.jsx)(d.EuiSpacer,{size:"m"})):null,Object(v.jsx)(d.EuiBasicTable,{columns:te,rowHeader:"timestamp",items:se,itemId:"id",loading:z,rowProps:e=>({"data-test-subj":`mlNotificationsTableRow row-${e.id}`}),pagination:V,onChange:H,sorting:K,"data-test-subj":z?"mlNotificationsTable loading":"mlNotificationsTable loaded",noItemsMessage:Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.noItemsFoundMessage",defaultMessage:"No notifications found"})}))};var z=a(134),P=a(51),B=a(209),W=a(142);const R=()=>{const{services:{docLinks:e}}=Object(O.d)(),t=e.links.ml.guide;return Object(l.c)({timeRangeSelector:!0,autoRefreshSelector:!0}),Object(v.jsx)("div",null,Object(v.jsx)(z.a,null,Object(v.jsx)(i.FormattedMessage,{id:"xpack.ml.notifications.notificationsLabel",defaultMessage:"Notifications"})),Object(v.jsx)(P.b,null),Object(v.jsx)(B.a,null),Object(v.jsx)(N,null),Object(v.jsx)(W.a,{docLink:t}))};t.default=R}}]);