/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[69],{237:function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));const a="_all"},808:function(e,t,o){var a,n=n||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,o=function(){return e.URL||e.webkitURL||e},a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in a,s=e.webkitRequestFileSystem,r=e.requestFileSystem||s||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},i="application/octet-stream",c=0,u=function(t){var a=function(){"string"==typeof t?o().revokeObjectURL(t):t.remove()};e.chrome?a():setTimeout(a,500)},d=function(e,t,o){for(var a=(t=[].concat(t)).length;a--;){var n=e["on"+t[a]];if("function"==typeof n)try{n.call(e,o||e)}catch(e){l(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},b=function(t,l,b){b||(t=p(t));var j,x,m,f=this,g=t.type,O=!1,y=function(){d(f,"writestart progress write writeend".split(" "))},E=function(){!O&&j||(j=o().createObjectURL(t)),x?x.location.href=j:null==e.open(j,"_blank")&&"undefined"!=typeof safari&&(e.location.href=j),f.readyState=f.DONE,y(),u(j)},h=function(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}},F={create:!0,exclusive:!1};if(f.readyState=f.INIT,l||(l="download"),n)return j=o().createObjectURL(t),a.href=j,a.download=l,void setTimeout((function(){var e,t;e=a,t=new MouseEvent("click"),e.dispatchEvent(t),y(),u(j),f.readyState=f.DONE}));e.chrome&&g&&g!==i&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,i),O=!0),s&&"download"!==l&&(l+=".download"),(g===i||s)&&(x=e),r?(c+=t.size,r(e.TEMPORARY,c,h((function(e){e.root.getDirectory("saved",F,h((function(e){var o=function(){e.getFile(l,F,h((function(e){e.createWriter(h((function(o){o.onwriteend=function(t){x.location.href=e.toURL(),f.readyState=f.DONE,d(f,"writeend",t),u(e)},o.onerror=function(){var e=o.error;e.code!==e.ABORT_ERR&&E()},"writestart progress write abort".split(" ").forEach((function(e){o["on"+e]=f["on"+e]})),o.write(t),f.abort=function(){o.abort(),f.readyState=f.DONE},f.readyState=f.WRITING})),E)})),E)};e.getFile(l,{create:!1},h((function(e){e.remove(),o()})),h((function(e){e.code===e.NOT_FOUND_ERR?o():E()})))})),E)})),E)):E()},j=b.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,o){return o||(e=p(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(j.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},j.readyState=j.INIT=0,j.WRITING=1,j.DONE=2,j.error=j.onwritestart=j.onprogress=j.onwrite=j.onabort=j.onerror=j.onwriteend=null,function(e,t,o){return new b(e,t,o)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */e.exports?e.exports.saveAs=n:null!==o(809)&&null!=o(810)&&(void 0===(a=function(){return n}.apply(t,[]))||(e.exports=a))},809:function(e,t,o){e.exports=o(57)(1784)},810:function(e,t){(function(t){e.exports=t}).call(this,{})},815:function(e,t,o){"use strict";o.r(t),o.d(t,"ExportJobsFlyoutContent",(function(){return O}));var a=o(25),n=o(2),s=o.n(n),r=o(15),l=o(5),i=o(6);const c=({jobs:e})=>{const[t,o,n]=function(e){return e.reduce(((e,t)=>{const o=t.calendarIds.length>0,a=t.filterIds.length>0;return(o||a)&&(e[0].push(t),o&&e[1].push(t),a&&e[2].push(t)),e}),[[],[],[]])}(e),c=o.length>0,b=n.length>0;return!1===c&&!1===b?null:Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiCallOut,{title:p(t,o.length,n.length),color:"warning"},Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarDependencies",defaultMessage:"When you export jobs, calendars and filter lists are not included. You must create the filter lists before you import jobs; otherwise, the import fails. If you want the new jobs to continue to ignore scheduled events, you must create the calendars."}),Object(i.jsx)(a.EuiSpacer,null),c&&Object(i.jsx)(a.EuiAccordion,{id:"advancedOptions",paddingSize:"s","aria-label":l.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingCalendarsAria",{defaultMessage:"Jobs using calendars"}),buttonContent:Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingCalendarsButton",defaultMessage:"Jobs using calendars"})},Object(i.jsx)(u,{jobs:o})),b&&Object(i.jsx)(a.EuiAccordion,{id:"advancedOptions",paddingSize:"s","aria-label":l.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingFiltersAria",{defaultMessage:"Jobs using filter lists"}),buttonContent:Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingFiltersButton",defaultMessage:"Jobs using filter lists"})},Object(i.jsx)(d,{jobs:n}))),Object(i.jsx)(a.EuiSpacer,{size:"m"}))},u=({jobs:e})=>Object(i.jsx)(s.a.Fragment,null,e.length>0&&Object(i.jsx)(s.a.Fragment,null,e.map((({jobId:e,calendarIds:t})=>Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiText,{size:"s"},Object(i.jsx)("h5",null,e),t.length>0&&Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarList",defaultMessage:"{num, plural, one {calendar} other {calendars}}: {calendars}",values:{num:t.length,calendars:t.join(", ")}})),Object(i.jsx)(a.EuiSpacer,{size:"s"})))))),d=({jobs:e})=>Object(i.jsx)(s.a.Fragment,null,e.length>0&&Object(i.jsx)(s.a.Fragment,null,e.map((({jobId:e,filterIds:t})=>Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiText,{size:"s"},Object(i.jsx)("h5",null,e),t.length>0&&Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterList",defaultMessage:"Filter {num, plural, one {list} other {lists}}: {filters}",values:{num:t.length,filters:t.join(", ")}})),Object(i.jsx)(a.EuiSpacer,{size:"s"}))))));function p(e,t,o){return t>0&&0===o?l.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarOnlyTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} {calendarCount, plural, one {a calendar} other {calendars}}",values:{jobCount:e.length,calendarCount:t}}):0===t&&o>0?l.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterOnlyTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} {filterCount, plural, one {a filter list} other {filter lists}}",values:{jobCount:e.length,filterCount:o}}):l.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterAndCalendarTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} filter lists and calendars",values:{jobCount:e.length}})}var b=o(10),j=o(808),x=o(237);class jobs_export_service_JobsExportService{constructor(e){this._mlApiServices=e}async exportAnomalyDetectionJobs(e){const t=await Promise.all(e.map((e=>this._mlApiServices.jobs.jobForCloning(e,!0))));this._export(t,"anomaly-detector")}async exportDataframeAnalyticsJobs(e){const{data_frame_analytics:t}=await this._mlApiServices.dataFrameAnalytics.getDataFrameAnalytics(e.join(","),!0);this._export(t,"data-frame-analytics")}_export(e,t){const o=1===e.length?e[0]:e,a=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),n=this._createFileName(t);Object(j.saveAs)(a,n)}_createFileName(e){return("anomaly-detector"===e?"anomaly_detection":"data_frame_analytics")+"_jobs.json"}async getJobDependencies(e){const t=await this._mlApiServices.calendars(),o=e.reduce(((e,t)=>(Array.isArray(t.groups)&&t.groups.forEach((o=>{void 0===e[o]&&(e[o]=[]),e[o].push(t.job_id)})),e)),{}),a=t.reduce(((t,a)=>(a.job_ids.forEach((n=>{n===x.a?e.forEach((e=>{void 0===t[e.job_id]&&(t[e.job_id]=[]),t[e.job_id].push(a.calendar_id)})):void 0!==o[n]?o[n].forEach((e=>{void 0===t[e]&&(t[e]=[]),t[e].push(a.calendar_id)})):(void 0===t[n]&&(t[n]=[]),t[n].push(a.calendar_id))})),t)),{}),n=e.reduce(((e,t)=>(void 0===e[t.job_id]&&(e[t.job_id]=[]),t.analysis_config.detectors.forEach((o=>{void 0!==o.custom_rules&&o.custom_rules.forEach((o=>{void 0!==o.scope&&Object.values(o.scope).forEach((o=>{e[t.job_id].push(o.filter_id)}))}))})),e)),{});return e.map((e=>{var t,o;const s=e.job_id;return{jobId:s,calendarIds:null!==(t=[...new Set(a[s])])&&void 0!==t?t:[],filterIds:null!==(o=[...new Set(n[s])])&&void 0!==o?o:[]}}))}}var m=o(71);const f=()=>Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiSpacer,{size:"l"}),Object(i.jsx)(a.EuiFlexGroup,{justifyContent:"spaceAround"},Object(i.jsx)(a.EuiFlexItem,{grow:!1},Object(i.jsx)(a.EuiLoadingSpinner,{size:"l"})))),g=({onCancel:e,onConfirm:t})=>Object(i.jsx)(a.EuiConfirmModal,{title:l.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.title",{defaultMessage:"Change tabs?"}),onCancel:e,onConfirm:t,cancelButtonText:l.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:l.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.confirmButton",{defaultMessage:"Confirm"}),defaultFocusedButton:"confirm"},Object(i.jsx)("p",null,Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.switchTabsConfirm.text",defaultMessage:"Changing tabs will clear currently selected jobs"}))),O=({currentTab:e,isADEnabled:t,isDFAEnabled:o,onClose:u})=>{const{services:{notifications:{toasts:d},mlServices:{mlUsageCollection:p,mlApiServices:j}}}=Object(b.d)(),{getJobs:x,dataFrameAnalytics:{getDataFrameAnalytics:O}}=j,y=Object(n.useMemo)((()=>new jobs_export_service_JobsExportService(j)),[j]),[E,h]=Object(n.useState)([]),[F,v]=Object(n.useState)([]),[C,S]=Object(n.useState)([]),[w,M]=Object(n.useState)(e),{displayErrorToast:_,displaySuccessToast:k}=Object(n.useMemo)((()=>Object(m.toastNotificationServiceProvider)(d)),[d]),[J,A]=Object(n.useState)([]),[D,T]=Object(n.useState)(!0),[B,I]=Object(n.useState)(!0),[z,N]=Object(n.useState)(!1),[R,W]=Object(n.useState)(!1),[U,L]=Object(n.useState)(e),[G,q]=Object(n.useState)([]);function P(e,t){S(e?[...C,t]:C.filter((e=>e!==t)))}function Y(e){W(!1),S([]),M(e)}function H(){const e="anomaly-detector"===w?E:F;C.length===e.length?S([]):S([...e])}const K=Object(n.useCallback)((e=>{if(e!==w)return C.length>0?(L(e),void W(!0)):void Y(e)}),[C,w]);return Object(n.useEffect)((()=>{q(J.filter((({jobId:e})=>C.includes(e))))}),[J,C]),Object(n.useEffect)((function(){T(!0),I(!0),N(!1),W(!1),h([]),S([]),M(e),t&&x().then((({jobs:e})=>{T(!1),h(e.map((e=>e.job_id))),y.getJobDependencies(e).then((e=>{A(e),T(!1)})).catch((e=>{const t=l.i18n.translate("xpack.ml.importExport.exportFlyout.calendarsError",{defaultMessage:"Could not load calendars"});_(e,t)}))})).catch((e=>{const t=l.i18n.translate("xpack.ml.importExport.exportFlyout.adJobsError",{defaultMessage:"Could not load anomaly detection jobs"});_(e,t)})),o&&O().then((({data_frame_analytics:e})=>{I(!1),v(e.map((e=>e.id)))})).catch((e=>{const t=l.i18n.translate("xpack.ml.importExport.exportFlyout.dfaJobsError",{defaultMessage:"Could not load data frame analytics jobs"});_(e,t)}))}),[e,_,O,x,t,o,y]),Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiFlyout,{onClose:u,hideCloseButton:!0,size:"s","data-test-subj":"mlJobMgmtExportJobsFlyout"},Object(i.jsx)(a.EuiFlyoutHeader,{hasBorder:!0},Object(i.jsx)(a.EuiTitle,{size:"m"},Object(i.jsx)("h2",null,Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.flyoutHeader",defaultMessage:"Export jobs"})))),Object(i.jsx)(a.EuiFlyoutBody,null,Object(i.jsx)(c,{jobs:G}),Object(i.jsx)(a.EuiTabs,{size:"s"},!0===t?Object(i.jsx)(a.EuiTab,{isSelected:"anomaly-detector"===w,onClick:()=>K("anomaly-detector"),disabled:z,"data-test-subj":"mlJobMgmtExportJobsADTab"},Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adTab",defaultMessage:"Anomaly detection"})):null,!0===o?Object(i.jsx)(a.EuiTab,{isSelected:"data-frame-analytics"===w,onClick:()=>K("data-frame-analytics"),disabled:z,"data-test-subj":"mlJobMgmtExportJobsDFATab"},Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaTab",defaultMessage:"Analytics"})):null),Object(i.jsx)(a.EuiSpacer,{size:"s"}),Object(i.jsx)(s.a.Fragment,null,!0===t&&"anomaly-detector"===w&&Object(i.jsx)(s.a.Fragment,null,!0===D?Object(i.jsx)(f,null):Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiButtonEmpty,{size:"xs",onClick:H,"data-test-subj":"mlJobMgmtExportJobsSelectAllButton"},C.length===E.length?Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adDeselectAllButton",defaultMessage:"Deselect all"}):Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adSelectAllButton",defaultMessage:"Select all"})),Object(i.jsx)(a.EuiSpacer,{size:"xs"}),Object(i.jsx)("div",{"data-test-subj":"mlJobMgmtExportJobsADJobList"},E.map((e=>Object(i.jsx)("div",{key:e},Object(i.jsx)(a.EuiCheckbox,{id:e,label:e,checked:C.includes(e),onChange:t=>P(t.target.checked,e)}),Object(i.jsx)(a.EuiSpacer,{size:"s"}))))))),!0===o&&"data-frame-analytics"===w&&Object(i.jsx)(s.a.Fragment,null,!0===B?Object(i.jsx)(f,null):Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(a.EuiButtonEmpty,{size:"xs",onClick:H,"data-test-subj":"mlJobMgmtExportJobsSelectAllButton"},C.length===F.length?Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaDeselectAllButton",defaultMessage:"Deselect all"}):Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaSelectAllButton",defaultMessage:"Select all"})),Object(i.jsx)(a.EuiSpacer,{size:"xs"}),Object(i.jsx)("div",{"data-test-subj":"mlJobMgmtExportJobsDFAJobList"},F.map((e=>Object(i.jsx)("div",{key:e},Object(i.jsx)(a.EuiCheckbox,{id:e,label:e,checked:C.includes(e),onChange:t=>P(t.target.checked,e)}),Object(i.jsx)(a.EuiSpacer,{size:"s"}))))))))),Object(i.jsx)(a.EuiFlyoutFooter,null,Object(i.jsx)(a.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(i.jsx)(a.EuiFlexItem,{grow:!1},Object(i.jsx)(a.EuiButtonEmpty,{iconType:"cross",onClick:u.bind(null),flush:"left"},Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.closeButton",defaultMessage:"Close"}))),Object(i.jsx)(a.EuiFlexItem,{grow:!1},Object(i.jsx)(a.EuiButton,{disabled:0===C.length||!0===z,onClick:async function(){N(!0);const e=l.i18n.translate("xpack.ml.importExport.exportFlyout.exportDownloading",{defaultMessage:"Your file is downloading in the background"});k(e);try{"anomaly-detector"===w?await y.exportAnomalyDetectionJobs(C):await y.exportDataframeAnalyticsJobs(C),p.count("anomaly-detector"===w?"exported_anomaly_detector_jobs":"exported_data_frame_analytics_jobs",C.length),N(!1),u()}catch(e){const t=l.i18n.translate("xpack.ml.importExport.exportFlyout.exportError",{defaultMessage:"Could not export selected jobs"});_(e,t),N(!1)}},fill:!0,"data-test-subj":"mlJobMgmtExportExportButton"},Object(i.jsx)(r.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportButton",defaultMessage:"Export"})))))),!0===R?Object(i.jsx)(g,{onCancel:W.bind(null,!1),onConfirm:()=>Y(U)}):null)}}}]);