/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[61,23],{138:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(2);t.default=function(){var e=n.useRef(!1),t=n.useCallback((function(){return e.current}),[]);return n.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},155:function(e,t,l){"use strict";l.d(t,"a",(function(){return r}));var n=l(2),a=l(79),o=l.n(a),i=l(143),s=l(6);const r=(e,t)=>l=>(o.a.render(Object(s.jsx)(i.a,t,e),l),()=>o.a.unmountComponentAtNode(l));l(4),l(5),n.Component},168:function(e,t,l){"use strict";l.d(t,"a",(function(){return b}));var n=l(2),a=l(5),o=l(15),i=l(25),s=l(138),r=l.n(s),u=l(10),c=l(13),d=l(6);const b=({jobsAndGroupIds:e,onChange:t,adJobsApiService:l,errors:s,multiSelect:b=!1,label:j,allowSelectAll:p=!1,createJobUrl:f,options:m})=>{const{services:{notifications:{toasts:v},application:{navigateToUrl:O}}}=Object(u.d)(),x=r()(),[g,w]=Object(n.useState)([]),y=Object(n.useMemo)((()=>new Set),[]),h=Object(n.useMemo)((()=>new Set),[]),E=Object(n.useMemo)((()=>(null!=e?e:[]).map((e=>({label:e})))),[e]),S=Object(n.useCallback)((async()=>{try{const{jobIds:e,groupIds:t}=await l.getAllJobAndGroupIds();if(e.forEach((e=>{y.add(e)})),t.forEach((e=>{h.add(e)})),!x())return;w([...p?[{label:a.i18n.translate("xpack.ml.jobSelector.selectAllGroupLabel",{defaultMessage:"Select all"}),options:[{label:a.i18n.translate("xpack.ml.jobSelector.selectAllOptionLabel",{defaultMessage:"*"}),value:c.e}]}]:[],{label:a.i18n.translate("xpack.ml.jobSelector.jobOptionsLabel",{defaultMessage:"Jobs"}),options:[...f?[{label:a.i18n.translate("xpack.ml.jobSelector.createNewLabel",{defaultMessage:"--- Create new ---"}),value:"createNew"}]:[],...e.map((e=>({label:e})))]},...b?[{label:a.i18n.translate("xpack.ml.jobSelector.groupOptionsLabel",{defaultMessage:"Groups"}),options:t.map((e=>({label:e})))}]:[]])}catch(e){v.addError(e,{title:a.i18n.translate("xpack.ml.jobSelector.fetchJobErrorTitle",{defaultMessage:"Failed to load anomaly detection jobs"})})}}),[l,p,f,h,x,y,b,v]),C=Object(n.useCallback)((async e=>{if(e.some((e=>e.value===c.e)))return void t({jobIds:[c.e]});if(f&&e.some((e=>"createNew"===e.value)))return void await O(f);const l=[],n=[];e.forEach((({label:e})=>{y.has(e)?l.push(e):h.has(e)?n.push(e):null!=m&&m.some((t=>{var l;return null===(l=t.options)||void 0===l?void 0:l.some((t=>t.label===e))}))&&l.push(e)})),t({...l.length>0?{jobIds:l}:{},...n.length>0?{groupIds:n}:{}})}),[y,h,m,f]);return Object(n.useEffect)((()=>{m||S()}),[f]),Object(d.jsx)(i.EuiFormRow,{"data-test-subj":"mlAnomalyJobSelectionControls",fullWidth:!0,label:null!=j?j:Object(d.jsx)(o.FormattedMessage,{id:"xpack.ml.jobSelector.formControlLabel",defaultMessage:"Select job"}),isInvalid:!(null==s||!s.length),error:s},Object(d.jsx)(i.EuiComboBox,{singleSelection:!b,selectedOptions:E,options:null!=m?m:g,onChange:C,fullWidth:!0,"data-test-subj":"mlAnomalyAlertJobSelection",isInvalid:!(null==s||!s.length)}))}},222:function(e,t,l){"use strict";l.r(t),l.d(t,"apiCanAddNewPanel",(function(){return n})),l.d(t,"apiHasRuntimeChildState",(function(){return o})),l.d(t,"apiHasSerializedChildState",(function(){return a})),l.d(t,"apiHasSaveNotification",(function(){return i})),l.d(t,"apiCanDuplicatePanels",(function(){return s})),l.d(t,"apiCanExpandPanels",(function(){return r})),l.d(t,"apiIsPresentationContainer",(function(){return d})),l.d(t,"getContainerParentFromAPI",(function(){return b})),l.d(t,"listenForCompatibleApi",(function(){return j})),l.d(t,"combineCompatibleChildrenApis",(function(){return p})),l.d(t,"apiHasSerializableState",(function(){return f})),l.d(t,"tracksOverlays",(function(){return m})),l.d(t,"canTrackContentfulRender",(function(){return v}));const n=e=>"function"==typeof(null==e?void 0:e.addNewPanel),a=e=>Boolean(e&&e.getSerializedStateForChild),o=e=>Boolean(e&&e.getRuntimeStateForChild),i=e=>Boolean(e&&e.saveNotification$),s=e=>Boolean(void 0!==(null==e?void 0:e.duplicatePanel)),r=e=>Boolean(void 0!==(null==e?void 0:e.expandPanel));var u=l(136),c=l(7);const d=e=>Boolean(n(e)&&"function"==typeof(null==e?void 0:e.removePanel)&&"function"==typeof(null==e?void 0:e.replacePanel)&&"function"==typeof(null==e?void 0:e.addNewPanel)&&(null==e?void 0:e.children$)),b=e=>{const t=Object(u.b)(e)?e.parentApi:null;if(t)return d(t)?t:void 0},j=(e,t,l)=>{if(!e||!d(e))return()=>{};let n,a;const o=e.children$.subscribe((o=>{var i,s;null===(i=n)||void 0===i||i();const r=(()=>{for(const e of Object.keys(o)){const l=o[e];if(t(l))return l}if(t(e))return e})(),c=Object(u.d)(r)?r.uuid:null;c!==a&&(a=c,n=null!==(s=l(r))&&void 0!==s?s:void 0)}));return()=>{var e;o.unsubscribe(),null===(e=n)||void 0===e||e()}},p=(e,t,l,n,a)=>e&&d(e)?e.children$.pipe(Object(c.switchMap)((e=>{const o=[];for(const n of Object.values(e))l(n)&&Object(c.isObservable)(n[t])&&o.push(n[t]);return 0===o.length?Object(c.of)(n):Object(c.combineLatest)(o).pipe(Object(c.map)(a||(e=>e.flat().filter((e=>Boolean(e))))))}))):Object(c.of)(),f=e=>Boolean(null==e?void 0:e.serializeState),m=e=>Boolean(e&&e.openOverlay&&e.clearOverlays),v=e=>null!==e&&"object"==typeof e&&"trackContentfulRender"in e},225:function(e,t,l){"use strict";l.d(t,"a",(function(){return a}));var n=l(5);const a=e=>{if(0===e.length)return[n.i18n.translate("xpack.ml.swimlaneEmbeddable.setupModal.jobSelectionRequiredError",{defaultMessage:"Job selection is required"})]}},269:function(e,t,l){"use strict";l.d(t,"a",(function(){return a}));var n=l(5);const a=e=>n.i18n.translate("xpack.ml.swimlaneEmbeddable.title",{defaultMessage:"ML anomaly swim lane for {jobIds}",values:{jobIds:e.join(", ")}})},816:function(e,t,l){"use strict";l.r(t),l.d(t,"resolveAnomalySwimlaneUserInput",(function(){return E}));var n=l(21),a=l(222),o=l(155),i=l(2),s=l.n(i),r=l(12),u=l(52),c=l(25),d=l(15),b=l(5),j=l(138),p=l.n(j),f=l(10),m=l(1),v=l(123),O=l(168),x=l(132),g=l(269),w=l(225),y=l(6);const h=({onCreate:e,onCancel:t,initialInput:l,adJobsApiService:n})=>{var a,o,r;const u=p()(),j=Object(i.useRef)(!(null==l||!l.title)),[h,E]=Object(i.useState)(null!==(a=null==l?void 0:l.jobIds)&&void 0!==a?a:[]),[S,C]=Object(i.useState)([x.j]);Object(i.useEffect)((function(){h.length>0&&async function(){const e=await n.jobs(h);u()&&C([...Object(v.h)(e),x.j])}()}),[n,u,h]);const[M,F]=Object(i.useState)(null!==(o=null==l?void 0:l.title)&&void 0!==o?o:""),[I,k]=Object(i.useState)(null!==(r=null==l?void 0:l.swimlaneType)&&void 0!==r?r:x.h.OVERALL),[A,B]=Object(i.useState)(null==l?void 0:l.viewBy);Object(i.useEffect)((function(){j.current||F(Object(g.a)(h))}),[null==l?void 0:l.title,h]);const L=[{id:x.h.OVERALL,label:b.i18n.translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"})},{id:x.h.VIEW_BY,label:b.i18n.translate("xpack.ml.explorer.viewByLabel",{defaultMessage:"View by"})}],P=["",...S].map((e=>({value:e,text:e}))),T=M.length>0,R=Object(w.a)(h),J=T&&!R&&(I===x.h.OVERALL||I===x.h.VIEW_BY&&!!A),_={jobIds:h,panelTitle:M,swimlaneType:I,...A?{viewBy:A}:{}},N=Object(f.f)({page:m.b.ANOMALY_DETECTION_CREATE_JOB});return Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(c.EuiFlyoutHeader,null,Object(y.jsx)(c.EuiTitle,null,Object(y.jsx)("h2",null,Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.title",defaultMessage:"Anomaly swim lane configuration"})))),Object(y.jsx)(c.EuiFlyoutBody,null,Object(y.jsx)(c.EuiForm,null,Object(y.jsx)(O.a,{createJobUrl:N,multiSelect:!0,jobsAndGroupIds:h,adJobsApiService:n,onChange:e=>{var t,l;E([...null!==(t=null==e?void 0:e.jobIds)&&void 0!==t?t:[],...null!==(l=null==e?void 0:e.groupIds)&&void 0!==l?l:[]])},errors:R}),Object(y.jsx)(c.EuiFormRow,{label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.panelTitleLabel",defaultMessage:"Panel title"}),isInvalid:!T,fullWidth:!0},Object(y.jsx)(c.EuiFieldText,{id:"panelTitle",name:"panelTitle",value:M,onChange:e=>{j.current=!0,F(e.target.value)},isInvalid:!T,fullWidth:!0})),Object(y.jsx)(c.EuiFormRow,{label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",defaultMessage:"Swim lane type"}),fullWidth:!0},Object(y.jsx)(c.EuiButtonGroup,{id:"selectSwimlaneType",name:"selectSwimlaneType",color:"primary",isFullWidth:!0,legend:b.i18n.translate("xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",{defaultMessage:"Swim lane type"}),options:L,idSelected:I,onChange:e=>k(e)})),I===x.h.VIEW_BY&&Object(y.jsx)(s.a.Fragment,null,Object(y.jsx)(c.EuiFormRow,{label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.explorer.viewByLabel",defaultMessage:"View by"}),fullWidth:!0},Object(y.jsx)(c.EuiSelect,{fullWidth:!0,id:"selectViewBy",name:"selectViewBy",options:P,value:A,onChange:e=>B(e.target.value)}))))),Object(y.jsx)(c.EuiFlyoutFooter,null,Object(y.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(y.jsx)(c.EuiFlexItem,{grow:!1},Object(y.jsx)(c.EuiButtonEmpty,{onClick:t},Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(y.jsx)(c.EuiFlexItem,{grow:!1},Object(y.jsx)(c.EuiButton,{isDisabled:!J,onClick:e.bind(null,_),fill:!0},Object(y.jsx)(d.FormattedMessage,{id:"xpack.ml.swimlaneEmbeddable.setupModal.confirmButtonLabel",defaultMessage:"Confirm"}))))))};async function E(e,t,l,i){const{http:s,overlays:c,...d}=e,b=Object(a.tracksOverlays)(t)?t:void 0;return new Promise((async(j,p)=>{try{const f=Object(u.jobsApiProvider)(new r.a(s)),m=c.openFlyout(Object(o.a)(Object(y.jsx)(n.KibanaContextProvider,{services:{...e}},Object(y.jsx)(h,{adJobsApiService:f,initialInput:i,onCreate:e=>{j(e),m.close(),null==b||b.clearOverlays()},onCancel:()=>{p(),m.close(),null==b||b.clearOverlays()}})),d),{type:"push",ownFocus:!0,size:"s",onClose:()=>{p(),m.close(),null==b||b.clearOverlays()}});Object(a.tracksOverlays)(t)&&t.openOverlay(m,{focusedPanelId:l})}catch(e){p(e)}}))}}}]);