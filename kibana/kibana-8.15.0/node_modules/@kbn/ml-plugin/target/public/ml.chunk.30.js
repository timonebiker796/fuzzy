/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[30,23,37,38,80],{138:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2);t.default=function(){var e=i.useRef(!1),t=i.useCallback((function(){return e.current}),[]);return i.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},155:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i=a(2),n=a(79),s=a.n(n),r=a(143),l=a(6);const o=(e,t)=>a=>(s.a.render(Object(l.jsx)(r.a,t,e),a),()=>s.a.unmountComponentAtNode(a));a(4),a(5),i.Component},156:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return n}));let i=null;function n(e){return i=e,i}function s(){return null!==i&&i.hasLicenseExpired()}function r(){return null!==i&&i.isFullLicense()}},168:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var i=a(2),n=a(5),s=a(15),r=a(25),l=a(138),o=a.n(l),c=a(10),u=a(13),d=a(6);const b=({jobsAndGroupIds:e,onChange:t,adJobsApiService:a,errors:l,multiSelect:b=!1,label:p,allowSelectAll:m=!1,createJobUrl:f,options:v})=>{const{services:{notifications:{toasts:j},application:{navigateToUrl:h}}}=Object(c.d)(),g=o()(),[O,C]=Object(i.useState)([]),x=Object(i.useMemo)((()=>new Set),[]),S=Object(i.useMemo)((()=>new Set),[]),y=Object(i.useMemo)((()=>(null!=e?e:[]).map((e=>({label:e})))),[e]),I=Object(i.useCallback)((async()=>{try{const{jobIds:e,groupIds:t}=await a.getAllJobAndGroupIds();if(e.forEach((e=>{x.add(e)})),t.forEach((e=>{S.add(e)})),!g())return;C([...m?[{label:n.i18n.translate("xpack.ml.jobSelector.selectAllGroupLabel",{defaultMessage:"Select all"}),options:[{label:n.i18n.translate("xpack.ml.jobSelector.selectAllOptionLabel",{defaultMessage:"*"}),value:u.e}]}]:[],{label:n.i18n.translate("xpack.ml.jobSelector.jobOptionsLabel",{defaultMessage:"Jobs"}),options:[...f?[{label:n.i18n.translate("xpack.ml.jobSelector.createNewLabel",{defaultMessage:"--- Create new ---"}),value:"createNew"}]:[],...e.map((e=>({label:e})))]},...b?[{label:n.i18n.translate("xpack.ml.jobSelector.groupOptionsLabel",{defaultMessage:"Groups"}),options:t.map((e=>({label:e})))}]:[]])}catch(e){j.addError(e,{title:n.i18n.translate("xpack.ml.jobSelector.fetchJobErrorTitle",{defaultMessage:"Failed to load anomaly detection jobs"})})}}),[a,m,f,S,g,x,b,j]),P=Object(i.useCallback)((async e=>{if(e.some((e=>e.value===u.e)))return void t({jobIds:[u.e]});if(f&&e.some((e=>"createNew"===e.value)))return void await h(f);const a=[],i=[];e.forEach((({label:e})=>{x.has(e)?a.push(e):S.has(e)?i.push(e):null!=v&&v.some((t=>{var a;return null===(a=t.options)||void 0===a?void 0:a.some((t=>t.label===e))}))&&a.push(e)})),t({...a.length>0?{jobIds:a}:{},...i.length>0?{groupIds:i}:{}})}),[x,S,v,f]);return Object(i.useEffect)((()=>{v||I()}),[f]),Object(d.jsx)(r.EuiFormRow,{"data-test-subj":"mlAnomalyJobSelectionControls",fullWidth:!0,label:null!=p?p:Object(d.jsx)(s.FormattedMessage,{id:"xpack.ml.jobSelector.formControlLabel",defaultMessage:"Select job"}),isInvalid:!(null==l||!l.length),error:l},Object(d.jsx)(r.EuiComboBox,{singleSelection:!b,selectedOptions:y,options:null!=v?v:O,onChange:P,fullWidth:!0,"data-test-subj":"mlAnomalyAlertJobSelection",isInvalid:!(null==l||!l.length)}))}},222:function(e,t,a){"use strict";a.r(t),a.d(t,"apiCanAddNewPanel",(function(){return i})),a.d(t,"apiHasRuntimeChildState",(function(){return s})),a.d(t,"apiHasSerializedChildState",(function(){return n})),a.d(t,"apiHasSaveNotification",(function(){return r})),a.d(t,"apiCanDuplicatePanels",(function(){return l})),a.d(t,"apiCanExpandPanels",(function(){return o})),a.d(t,"apiIsPresentationContainer",(function(){return d})),a.d(t,"getContainerParentFromAPI",(function(){return b})),a.d(t,"listenForCompatibleApi",(function(){return p})),a.d(t,"combineCompatibleChildrenApis",(function(){return m})),a.d(t,"apiHasSerializableState",(function(){return f})),a.d(t,"tracksOverlays",(function(){return v})),a.d(t,"canTrackContentfulRender",(function(){return j}));const i=e=>"function"==typeof(null==e?void 0:e.addNewPanel),n=e=>Boolean(e&&e.getSerializedStateForChild),s=e=>Boolean(e&&e.getRuntimeStateForChild),r=e=>Boolean(e&&e.saveNotification$),l=e=>Boolean(void 0!==(null==e?void 0:e.duplicatePanel)),o=e=>Boolean(void 0!==(null==e?void 0:e.expandPanel));var c=a(136),u=a(7);const d=e=>Boolean(i(e)&&"function"==typeof(null==e?void 0:e.removePanel)&&"function"==typeof(null==e?void 0:e.replacePanel)&&"function"==typeof(null==e?void 0:e.addNewPanel)&&(null==e?void 0:e.children$)),b=e=>{const t=Object(c.b)(e)?e.parentApi:null;if(t)return d(t)?t:void 0},p=(e,t,a)=>{if(!e||!d(e))return()=>{};let i,n;const s=e.children$.subscribe((s=>{var r,l;null===(r=i)||void 0===r||r();const o=(()=>{for(const e of Object.keys(s)){const a=s[e];if(t(a))return a}if(t(e))return e})(),u=Object(c.d)(o)?o.uuid:null;u!==n&&(n=u,i=null!==(l=a(o))&&void 0!==l?l:void 0)}));return()=>{var e;s.unsubscribe(),null===(e=i)||void 0===e||e()}},m=(e,t,a,i,n)=>e&&d(e)?e.children$.pipe(Object(u.switchMap)((e=>{const s=[];for(const i of Object.values(e))a(i)&&Object(u.isObservable)(i[t])&&s.push(i[t]);return 0===s.length?Object(u.of)(i):Object(u.combineLatest)(s).pipe(Object(u.map)(n||(e=>e.flat().filter((e=>Boolean(e))))))}))):Object(u.of)(),f=e=>Boolean(null==e?void 0:e.serializeState),v=e=>Boolean(e&&e.openOverlay&&e.clearOverlays),j=e=>null!==e&&"object"==typeof e&&"trackContentfulRender"in e},225:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a(5);const n=e=>{if(0===e.length)return[i.i18n.translate("xpack.ml.swimlaneEmbeddable.setupModal.jobSelectionRequiredError",{defaultMessage:"Job selection is required"})]}},228:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var i=a(35),n=a(70),s=a(85),r=a(12),l=a(11),o=a(103),c=a(0);function u(e){if(void 0===e){const e=(e,t)=>{};return{click:e,count:e}}return{click:(t,a)=>e.reportUiCounter(c.g,o.METRIC_TYPE.CLICK,t,a),count:(t,a)=>e.reportUiCounter(c.g,o.METRIC_TYPE.COUNT,t,a)}}var d=a(77);function b(e,t,a){const o=new r.a(e),c=Object(l.mlApiServicesProvider)(o),b=Object(d.indexServiceFactory)(t);return{httpService:o,mlApiServices:c,mlFieldFormatService:Object(s.fieldFormatServiceFactory)(c,b),mlUsageCollection:u(a),mlCapabilities:new n.MlCapabilitiesService(c),mlLicense:new i.a}}},310:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a(5);const n=e=>i.i18n.translate("xpack.ml.anomalyChartsEmbeddable.title",{defaultMessage:"ML anomaly charts for {jobIds}",values:{jobIds:e.join(", ")}})},378:function(e,t,a){"use strict";a.d(t,"b",(function(){return m})),a.d(t,"a",(function(){return f}));var i=a(2),n=a.n(i),s=a(25),r=a(15),l=a(48),o=a(168),c=a(1),u=a(310),d=a(10),b=a(225),p=a(6);const m=50,f=({initialInput:e,onCreate:t,onCancel:a,adJobsApiService:f})=>{var v,j,h;const g=Object(i.useRef)(!(null==e||!e.title)),[O,C]=Object(i.useState)(null!==(v=null==e?void 0:e.title)&&void 0!==v?v:""),[x,S]=Object(i.useState)(null!==(j=null==e?void 0:e.maxSeriesToPlot)&&void 0!==j?j:l.b),y=(null==O?void 0:O.length)>0,I=x>=1&&x<=m,P=Object(d.f)({page:c.b.ANOMALY_DETECTION_CREATE_JOB}),[F,w]=Object(i.useState)(null!==(h=null==e?void 0:e.jobIds)&&void 0!==h?h:[]),M=Object(b.a)(F),E=y&&I&&void 0===M;return Object(i.useEffect)((function(){g.current||C(Object(u.a)(F))}),[null==e?void 0:e.title,F]),Object(p.jsx)(n.a.Fragment,null,Object(p.jsx)(s.EuiFlyoutHeader,null,Object(p.jsx)(s.EuiTitle,null,Object(p.jsx)("h2",null,Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupModal.title",defaultMessage:"Anomaly explorer charts configuration"})))),Object(p.jsx)(s.EuiFlyoutBody,null,Object(p.jsx)(o.a,{createJobUrl:P,multiSelect:!0,jobsAndGroupIds:F,adJobsApiService:f,onChange:e=>{var t,a;w([...null!==(t=null==e?void 0:e.jobIds)&&void 0!==t?t:[],...null!==(a=null==e?void 0:e.groupIds)&&void 0!==a?a:[]])},errors:M}),Object(p.jsx)(s.EuiSpacer,{size:"s"}),Object(p.jsx)(s.EuiForm,null,Object(p.jsx)(s.EuiFormRow,{label:Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.panelTitleLabel",defaultMessage:"Panel title"}),isInvalid:!y},Object(p.jsx)(s.EuiFieldText,{"data-test-subj":"panelTitleInput",id:"panelTitle",name:"panelTitle",value:O,onChange:e=>{g.current=!0,C(e.target.value)},isInvalid:!y})),Object(p.jsx)(s.EuiFormRow,{isInvalid:!I,error:I?void 0:Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.maxSeriesToPlotError",defaultMessage:"Maximum number of series to plot must be between 1 and 50."}),label:Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.maxSeriesToPlotLabel",defaultMessage:"Maximum number of series to plot"})},Object(p.jsx)(s.EuiFieldNumber,{"data-test-subj":"mlAnomalyChartsInitializerMaxSeries",id:"selectMaxSeriesToPlot",name:"selectMaxSeriesToPlot",value:x,onChange:e=>S(parseInt(e.target.value,10)),min:1,max:m})))),Object(p.jsx)(s.EuiFlyoutFooter,null,Object(p.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(p.jsx)(s.EuiButtonEmpty,{onClick:a,"data-test-subj":"mlAnomalyChartsInitializerCancelButton"},Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(p.jsx)(s.EuiButton,{"data-test-subj":"mlAnomalyChartsInitializerConfirmButton",isDisabled:!E,onClick:t.bind(null,{title:O,maxSeriesToPlot:x,jobIds:F}),fill:!0},Object(p.jsx)(r.FormattedMessage,{id:"xpack.ml.anomalyChartsEmbeddable.setupFlyout.confirmButtonLabel",defaultMessage:"Confirm"})))))}},70:function(e,t,a){"use strict";a.r(t),a.d(t,"MlCapabilitiesService",(function(){return check_capabilities_MlCapabilitiesService})),a.d(t,"usePermissionCheck",(function(){return j})),a.d(t,"useUpgradeCheck",(function(){return h})),a.d(t,"checkGetManagementMlJobsResolver",(function(){return g})),a.d(t,"checkCreateJobsCapabilitiesResolver",(function(){return O})),a.d(t,"checkPermission",(function(){return C})),a.d(t,"createPermissionFailureMessage",(function(){return x}));var i=a(4),n=a.n(i),s=a(5),r=a(7),l=a(8),o=a(26),c=a.n(o),u=a(2),d=a(10),b=a(156),p=a(50),m=a(11);let f=Object(p.a)();const v=3e5;class check_capabilities_MlCapabilitiesService{constructor(e){n()(this,"_isLoading$",new r.BehaviorSubject(!0)),n()(this,"_updateRequested$",new r.BehaviorSubject(Date.now())),n()(this,"_capabilities$",new r.BehaviorSubject(null)),n()(this,"_capabilitiesObs$",this._capabilities$.asObservable()),n()(this,"_isPlatinumOrTrialLicense$",new r.BehaviorSubject(null)),n()(this,"_mlFeatureEnabledInSpace$",new r.BehaviorSubject(null)),n()(this,"_isUpgradeInProgress$",new r.BehaviorSubject(null)),n()(this,"capabilities$",this._capabilities$.pipe(Object(r.distinctUntilChanged)(l.isEqual))),n()(this,"_subscription",void 0),this.mlApiServices=e,this.init()}init(){this._subscription=Object(r.combineLatest)([this._updateRequested$,Object(r.timer)(0,v)]).pipe(Object(r.tap)((()=>{this._isLoading$.next(!0)})),Object(r.switchMap)((()=>Object(r.from)(this.mlApiServices.checkMlCapabilities()))),Object(r.retry)({delay:v})).subscribe((e=>{this._capabilities$.next(e.capabilities),this._isPlatinumOrTrialLicense$.next(e.isPlatinumOrTrialLicense),this._mlFeatureEnabledInSpace$.next(e.mlFeatureEnabledInSpace),this._isUpgradeInProgress$.next(e.upgradeInProgress),this._isLoading$.next(!1),f=e.capabilities}))}getCapabilities(){return this._capabilities$.getValue()}isPlatinumOrTrialLicense(){return this._isPlatinumOrTrialLicense$.getValue()}mlFeatureEnabledInSpace(){return this._mlFeatureEnabledInSpace$.getValue()}isUpgradeInProgress$(){return this._isUpgradeInProgress$}isUpgradeInProgress(){return this._isUpgradeInProgress$.getValue()}getCapabilities$(){return this._capabilitiesObs$}refreshCapabilities(){this._updateRequested$.next(Date.now())}destroy(){this._subscription&&this._subscription.unsubscribe()}}function j(e){const{services:{mlServices:{mlCapabilities:t}}}=Object(d.d)(),a=Object(u.useRef)(e),i=c()(t.capabilities$,t.getCapabilities());return Object(u.useMemo)((()=>Array.isArray(a.current)?a.current.map((e=>i[e])):i[a.current]),[i])}function h(){const{services:{mlServices:{mlCapabilities:e}}}=Object(d.d)(),t=c()(e.isUpgradeInProgress$(),e.isUpgradeInProgress());return null!=t&&t}function g({mlCapabilities:e}){return new Promise((async(t,a)=>{try{const i=await Object(r.firstValueFrom)(e.getCapabilities$().pipe(Object(r.filter)((e=>!!e))));return null===i?a():(f=i,!0===(i.isADEnabled&&i.canCreateJob||i.isDFAEnabled&&i.canCreateDataFrameAnalytics||i.isNLPEnabled&&i.canCreateTrainedModels)?t():a({capabilities:i,isPlatinumOrTrialLicense:e.isPlatinumOrTrialLicense(),mlFeatureEnabledInSpace:e.mlFeatureEnabledInSpace(),isUpgradeInProgress:e.isUpgradeInProgress()}))}catch(e){a(e)}}))}function O(e){return new Promise(((t,a)=>{m.ml.checkMlCapabilities().then((async({capabilities:i,isPlatinumOrTrialLicense:n})=>(f=i,f.canCreateJob||!1===n?t(f):(await e(),a())))).catch((async t=>(await e(),a())))}))}function C(e){const t=Object(b.a)();return!0===f[e]&&!0!==t}function x(e){let t="";return Object(b.a)()?t=s.i18n.translate("xpack.ml.privilege.licenseHasExpiredTooltip",{defaultMessage:"Your license has expired."}):"canCreateJob"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.createMLJobsTooltip",{defaultMessage:"You do not have permission to create Machine Learning jobs."}):"canStartStopDatafeed"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.startOrStopDatafeedsTooltip",{defaultMessage:"You do not have permission to start or stop datafeeds."}):"canUpdateJob"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.editJobsTooltip",{defaultMessage:"You do not have permission to edit jobs."}):"canDeleteJob"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.deleteJobsTooltip",{defaultMessage:"You do not have permission to delete jobs."}):"canCreateCalendar"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.createCalendarsTooltip",{defaultMessage:"You do not have permission to create calendars."}):"canDeleteCalendar"===e?t=s.i18n.translate("xpack.ml.privilege.noPermission.deleteCalendarsTooltip",{defaultMessage:"You do not have permission to delete calendars."}):"canForecastJob"===e&&(t=s.i18n.translate("xpack.ml.privilege.noPermission.runForecastsTooltip",{defaultMessage:"You do not have permission to run forecasts."})),s.i18n.translate("xpack.ml.privilege.pleaseContactAdministratorTooltip",{defaultMessage:"{message} Please contact your administrator.",values:{message:t}})}},77:function(e,t,a){"use strict";a.r(t),a.d(t,"indexServiceFactory",(function(){return n})),a.d(t,"useMlIndexUtils",(function(){return s}));var i=a(10);function n(e){return{getDataViewIdFromName:async function(t,a){var i;const n=(await e.find(t)).find((e=>e.getIndexPattern()===t));var s;return n?null!==(i=n.id)&&void 0!==i?i:n.getIndexPattern():void 0!==a&&null!==(s=(await e.create({id:void 0,name:t,title:t,timeFieldName:a.data_description.time_field})).id)&&void 0!==s?s:null},getDataViewById:function(t){return t?e.get(t):e.create({})},loadDataViewListItems:async function(){return(await e.getIdsWithTitle()).sort(((e,t)=>e.title.localeCompare(t.title)))}}}const s=()=>n(Object(i.d)().services.data.dataViews)},777:function(e,t,a){"use strict";a.r(t),a.d(t,"resolveEmbeddableAnomalyChartsUserInput",(function(){return d})),a(2);var i=a(155),n=a(222),s=a(21),r=a(12),l=a(378),o=a(52),c=a(228),u=a(6);async function d(e,t,a,d,b){const{http:p,overlays:m,...f}=e,v=Object(o.jobsApiProvider)(new r.a(p)),j=Object(c.a)(p,t.data.dataViews),h=Object(n.tracksOverlays)(a)?a:void 0;return new Promise((async(r,o)=>{try{const c=m.openFlyout(Object(i.a)(Object(u.jsx)(s.KibanaContextProvider,{services:{...e,...t,mlServices:j}},Object(u.jsx)(l.a,{initialInput:b,onCreate:({jobIds:e,title:t,maxSeriesToPlot:a})=>{r({jobIds:e,title:t,maxSeriesToPlot:a}),c.close(),null==h||h.clearOverlays()},onCancel:()=>{o(),c.close(),null==h||h.clearOverlays()},adJobsApiService:v})),f),{type:"push",ownFocus:!0,size:"s",onClose:()=>{o(),c.close(),null==h||h.clearOverlays()},"data-test-subj":"mlAnomalyChartsEmbeddableInitializer"});Object(n.tracksOverlays)(a)&&a.openOverlay(c,{focusedPanelId:d})}catch(e){o(e)}}))}},85:function(e,t,a){"use strict";a.r(t),a.d(t,"fieldFormatServiceFactory",(function(){return l}));var i=a(4),n=a.n(i),s=a(123),r=a(73);class field_format_service_FieldFormatService{constructor(e,t){n()(this,"indexPatternIdsByJob",{}),n()(this,"formatsByJob",{}),this.mlApiServices=e,this.mlIndexUtils=t}async populateFormats(e){(await Promise.all(e.map((async e=>{let t;if(this.mlApiServices){const{jobs:a}=await this.mlApiServices.getJobs({jobId:e});t=a[0]}else t=r.mlJobService.getJob(e);return{jobId:e,dataViewId:await this.mlIndexUtils.getDataViewIdFromName(t.datafeed_config.indices.join(","))}})))).forEach((({jobId:e,dataViewId:t})=>{null!==t&&(this.indexPatternIdsByJob[e]=t)}));const t=e.map((e=>Promise.all([this.getFormatsForJob(e)])));try{return(await Promise.all(t)).forEach(((t,a)=>{this.formatsByJob[e[a]]=t[0]})),this.formatsByJob}catch(e){return console.log("Error populating field formats:",e),{formats:{},error:e}}}getFieldFormat(e,t){if(this.formatsByJob.hasOwnProperty(e))return this.formatsByJob[e][t]}async getFormatsForJob(e){let t;if(this.mlApiServices){const{jobs:a}=await this.mlApiServices.getJobs({jobId:e});t=a[0]}else t=r.mlJobService.getJob(e);const a=t.analysis_config.detectors||[],i=[],n=this.indexPatternIdsByJob[e];if(void 0!==n){const e=await this.mlIndexUtils.getDataViewById(n),t=e.fields;a.forEach((a=>{const n=Object(s.s)(a.function);if(void 0!==a.field_name&&"cardinality"!==n){const n=t.getByName(a.field_name);void 0!==n&&(i[a.detector_index]=e.getFormatterForField(n))}}))}return i}}function l(e,t){return new field_format_service_FieldFormatService(e,t)}}}]);