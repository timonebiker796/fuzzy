/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[74],{295:function(e,t,a){"use strict";function s(e,t){return t?o(e):e.aggregatable&&n(e,t)||(!e.aggregatable||"geo_point"===e.type||"geo_shape"===e.type)&&l(e,t)}function n(e,t){return!t&&!("document"===e.type||e.type.includes("range")||"geo_point"===e.type||"geo_shape"===e.type||"murmur3"===e.type||"attachment"===e.type)}function r(e,t){return!t&&"counter"===e.timeSeriesMetric}function l(e,t){return t?"string"===e.type&&!i(e)||["geo_point","geo_shape"].includes(e.type):"_score"!==e.name&&["string","text","keyword","version","ip","number","geo_point","geo_shape"].includes(e.type)}function i(e){var t;if("_id"===e.name)return!1;const a=null===(t=e.esTypes)||void 0===t?void 0:t[0];return Boolean("string"===e.type&&a&&["keyword","version"].includes(a))||["keyword","version","ip","number","boolean"].includes(e.type)}function o(e){return i(e)||l(e,!0)}a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return l})),a.d(t,"f",(function(){return i})),a.d(t,"e",(function(){return o}))},296:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return n})),a.d(t,"e",(function(){return r})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return i}));const s=5e3,n=10,r=100,l=10,i=1e4},867:function(e,t,a){"use strict";a.r(t);var s=a(2),n=a.n(s),r=a(39),l=a.n(r);function i(e){return e.isDefault("dateFormat:tz")?l.a.tz.guess()||l()().format("Z"):e.get("dateFormat:tz","Browser")}var o=a(131);var u=a(75),c=a(47),d=a.n(c),m=a(25),f=a(15),b=a(76),p=a(5),j=a(295),g=a(7),y=a(113);function O(e,t){const{ast:a}=Object(y.getAstAndSyntaxErrors)(e),s=a.find((({name:e})=>["from","metrics"].includes(e)));if(!s)return e;let n=-1;const r=a.find((({name:e},t)=>(n=t,"sort"===e)));if(!r||r&&1!==n){const a=e.substring(s.location.min,s.location.max+1);return e.replace(a,`${a} \n| LIMIT ${t}`)}const l=e.substring(s.location.min,r.location.max+1);return e.replace(l,`${l} \n| LIMIT ${t}`)}function v(e,t){return`${e}\n${t}`}var x=a(296),F=a(893);async function h(e,t=x.b){const{searchHandler:a,field:s,esqlBaseQuery:n}=e,r=S(s.name),l=S(`${s.name}_terms`),i=v(n,`| WHERE ${r} IS NOT NULL\n    | STATS ${l} = count(${r}) BY ${r}\n    | SORT ${l} DESC\n    | LIMIT ${t}`),o=await a({query:i}),u=null==o?void 0:o.values;if(null==u||!u.length)return{};const c=null==u?void 0:u.reduce(((e,t)=>e+t[0]),0);return{totalDocuments:c,sampledDocuments:c,sampledValues:c,topValues:{buckets:u.map((e=>({count:e[0],key:e[1]})))}}}function S(e){return`\`${e}\``}const T=async({services:e,dataView:t,field:a,fromDate:s,toDate:n,baseQuery:r,abortController:l})=>{const{data:i}=e;try{if(null==t||!t.id||null==a||!a.type)return{};const e=async({query:e})=>{const a=function({timeFieldName:e,fromDate:t,toDate:a}){return e?{range:{[e]:{gte:t,lte:a,format:"strict_date_optional_time"}}}:null}({timeFieldName:t.timeFieldName,fromDate:s,toDate:n}),r=await async function({esqlQuery:e,search:t,signal:a,filter:s,dropNullColumns:n}){const r=await Object(g.lastValueFrom)(t({params:{...s?{filter:s}:{},query:e,...n?{dropNullColumns:!0}:{}}},{abortSignal:a,strategy:"esql_async"}));return{response:r.rawResponse,params:r.requestParams}}({esqlQuery:e,filter:a,search:i.search.search,signal:null==l?void 0:l.signal});return r.response};if(!("esql"in r))throw new Error("query must be of type AggregateQuery");return await async function(e){const{field:t}=e;return Object(j.e)(t)?"boolean"===t.type?await h(e,3):Object(j.f)(t)?await h(e):Object(j.b)(t,!0)?await async function(e){const{searchHandler:t,field:a,esqlBaseQuery:s}=e,n=S(a.name),r=v(s,`| WHERE ${n} IS NOT NULL\n    | KEEP ${n}\n    | LIMIT ${x.e}`),l=await t({query:r}),i=((null==l?void 0:l.values)||[]).map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(null==i||!i.length)return{};const o=null==i?void 0:i.length,u=Object(F.a)({values:i,field:a,count:x.a,isTextBased:!0});return{totalDocuments:o,sampledDocuments:u.sampledDocuments,sampledValues:u.sampledValues,topValues:{buckets:u.buckets,areExamples:!0}}}(e):{}:{}}({searchHandler:e,field:a,esqlBaseQuery:O(r.esql,x.c)})}catch(e){throw new Error("Could not provide field stats",{cause:e})}};var D=a(584),E=a(6);const L=({areExamples:e,buckets:t,dataView:a,field:r,sampledValuesCount:l,color:i=V(),"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c})=>{if(null==t||!t.length)return null;const d=a.getFormatterForField(r),f=_(M(t),l),b=t.some((e=>!Number.isInteger(e.count/l)));return Object(E.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(E.jsx)("div",{"data-test-subj":`${o}-topValues`},t.map(((e,t)=>{const a=e.key,n=d.convert(a);return Object(E.jsx)(s.Fragment,{key:String(a)},t>0&&Object(E.jsx)(m.EuiSpacer,{size:"s"}),Object(E.jsx)(D.default,{field:r,fieldValue:a,formattedFieldValue:n,formattedPercentage:w(e.count,l,b),progressValue:k(e.count,l),count:e.count,color:i,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))})),f>0&&Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(m.EuiSpacer,{size:"s"}),Object(E.jsx)(D.default,{type:"other",field:r,fieldValue:void 0,formattedPercentage:w(f,l,b),progressValue:k(f,l),count:f,color:i,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))))},V=()=>Object(m.euiPaletteColorBlind)()[1],w=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",k=(e,t)=>t>0?e/t:0,M=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,_=(e,t)=>t&&e?t-e:0,A=({message:e})=>Object(E.jsx)(m.EuiText,{size:"s"},e),I=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!B(a))return null;const n=e.getFormatterForField(t),r=[{key:"min",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:n.convert(a.minValue,"text")},{key:"max",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:n.convert(a.maxValue,"text")}],l=[{field:"label",name:"",align:m.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(E.jsx)("strong",null,e),align:m.RIGHT_ALIGNMENT}],i=p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(E.jsx)(m.EuiBasicTable,{compressed:!0,items:r,columns:l,tableCaption:i,"data-test-subj":`${s}-numberSummary`,responsiveBreakpoint:!1,css:Object(E.css)("& .euiTableHeaderCell{",Object(m.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function B(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}class error_boundary_ErrorBoundary extends n.a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?null:this.props.children}}const C=({services:e,query:t,dslQuery:r,filters:l,fromDate:c,toDate:g,dataViewOrDataViewId:y,field:O,color:v=V(),"data-test-subj":x="fieldStats",overrideMissingContent:F,overrideFooter:h,onAddFilter:S,overrideFieldTopValueBar:D,onStateChange:w})=>{const{fieldFormats:k,uiSettings:C,charts:N,dataViews:$,data:R}=e,[q,z]=Object(s.useState)({isLoading:!1}),[P,G]=Object(s.useState)(null),Q=Object(s.useRef)(null),H=Object(s.useRef)(!1),U=!!t&&Object(u.isOfAggregateQueryType)(t),W=Object(s.useCallback)((e=>{H.current||z(e)}),[z,H]);Object(s.useEffect)((function(){w&&w(q)}),[w,q]);const K=Object(s.useCallback)((e=>{H.current||G(e)}),[G,H]);Object(s.useEffect)((()=>{!async function(){var e;if(!H.current)try{var s;const n="string"==typeof y?await $.get(y):y;if(K(n),q.isLoading)return;W((e=>({...e,isLoading:!0}))),null===(s=Q.current)||void 0===s||s.abort(),Q.current=new AbortController;const i=U?await T({services:{data:R},dataView:n,field:O,fromDate:c,toDate:g,baseQuery:t,abortController:Q.current}):await(async e=>{const{loadFieldStats:t}=await a.e(90).then(a.bind(null,888));return await t(e)})({services:{data:R},dataView:n,field:O,fromDate:c,toDate:g,dslQuery:null!=r?r:Object(u.buildEsQuery)(n,null!=t?t:[],null!=l?l:[],(e=C,{allowLeadingWildcards:e.get("query:allowLeadingWildcards"),queryStringOptions:e.get("query:queryString:options"),ignoreFilterIfFieldNotInIndex:e.get("courier:ignoreFilterIfFieldNotInIndex"),dateFormatTZ:e.get("dateFormat:tz")})),abortController:Q.current});Q.current=null,W((e=>({...e,isLoading:!1,totalDocuments:i.totalDocuments,sampledDocuments:i.sampledDocuments,sampledValues:i.sampledValues,histogram:i.histogram,topValues:i.topValues,numberSummary:i.numberSummary})))}catch(e){W((e=>({...e,isLoading:!1})))}}()}),[y,O,r,t,l,c,g,e]),Object(s.useEffect)((()=>()=>{var e;H.current=!0,null===(e=Q.current)||void 0===e||e.abort()}),[]);const Z=N.theme.useChartsBaseTheme(),Y=Object(s.useMemo)((()=>v?{barSeriesStyle:{rect:{fill:v}}}:{}),[v]),{isLoading:J,histogram:X,topValues:ee,numberSummary:te,sampledValues:ae,sampledDocuments:se,totalDocuments:ne}=q;let re=!!q.histogram;const le=d.a.parse(c),ie=d.a.parse(g),oe=M(null==ee?void 0:ee.buckets),ue=_(oe,ae);oe&&X&&X.buckets.length&&ee&&ee.buckets.length&&(re=ue/oe>.9);const[ce,de]=Object(s.useState)(re);if(J)return Object(E.jsx)(m.EuiLoadingSpinner,{"data-test-subj":`${x}-statsLoading`});if(!P)return null;const me=P.getFormatterForField(O);let fe=Object(E.jsx)(n.a.Fragment,null);function be(t){const a=function(e,t,a,s){const r="unifiedFieldStats-statsFooter-docsCount",{fieldFormats:l}=t,{totalDocuments:i,sampledValues:u,sampledDocuments:c,topValues:d}=e;if(!i)return Object(E.jsx)(n.a.Fragment,null);let b;return b=a?null!=d&&d.areExamples?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":r},l.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleValuesLabel",defaultMessage:"Calculated from {sampledValuesFormatted} sample {sampledValues, plural, one {value} other {values}}.",values:{sampledValues:u,sampledValuesFormatted:Object(E.jsx)("strong",{"data-test-subj":r},l.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(u))}}):c&&c<i?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":r},l.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:i,totalDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":r},l.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(i))}}),Object(E.jsx)(m.EuiText,{color:"subdued",size:"xs","data-test-subj":`${s}-statsFooter`},b)}(q,e,U,x);return Object(E.jsx)(n.a.Fragment,null,fe?Object(E.jsx)("div",{"data-test-subj":`${x}-title`},fe):Object(E.jsx)(n.a.Fragment,null),Object(E.jsx)(m.EuiSpacer,{size:"s"}),t,h?null==h?void 0:h({element:a,totalDocuments:ne,sampledDocuments:se}):Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(m.EuiSpacer,{size:"m"}),a))}if(!Object(j.d)(O,U)){const e=Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return F?F({reason:"unsupported",element:e}):e}if(Object(j.c)(O,U)&&B(te))return fe=Object(E.jsx)(m.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),be(Object(E.jsx)(I,{dataView:P,field:O,numberSummary:te,"data-test-subj":x}));if(!(X&&0!==X.buckets.length||ee&&0!==ee.buckets.length)){const e=se&&ne&&se<ne?Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:se,sampledDocumentsFormatted:k.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(se)}})}):Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return F?F({reason:"no-data",element:e}):e}if(X&&X.buckets.length&&ee&&ee.buckets.length?fe=Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(m.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:p.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${x}-buttonGroup-topValuesButton`},{label:p.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${x}-buttonGroup-distributionButton`}],onChange:e=>{de("histogram"===e)},idSelected:ce?"histogram":"topValues"}),Object(E.jsx)(m.EuiSpacer,{size:"xs"})):"date"===O.type?fe=Object(E.jsx)(m.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):ee&&ee.buckets.length&&(fe=Object(E.jsx)(m.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,ee.areExamples?p.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),X&&X.buckets.length){const e=p.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===O.type)return be(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(E.jsx)("div",{"data-test-subj":`${x}-histogram`},Object(E.jsx)(b.Chart,{size:{height:200,width:268}},Object(E.jsx)(b.Tooltip,{type:b.TooltipType.None}),Object(E.jsx)(b.Settings,{locale:p.i18n.getLocale(),theme:Y,baseTheme:Z,xDomain:le&&ie?{min:le.valueOf(),max:ie.valueOf(),minInterval:Math.round((ie.valueOf()-le.valueOf())/10)}:void 0}),Object(E.jsx)(b.Axis,{id:"key",position:b.Position.Bottom,tickFormat:le&&ie?Object(b.niceTimeFormatter)([le.valueOf(),ie.valueOf()]):void 0,showOverlappingTicks:!0}),Object(E.jsx)(b.HistogramBarSeries,{data:X.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:b.ScaleType.Time,yScaleType:b.ScaleType.Linear,timeZone:i(C)})))));if(ce||!ee||!ee.buckets.length)return be(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(E.jsx)(b.Chart,{"data-test-subj":`${x}-histogram`,size:{height:200,width:"100%"}},Object(E.jsx)(b.Tooltip,{type:b.TooltipType.None}),Object(E.jsx)(b.Settings,{locale:p.i18n.getLocale(),rotation:90,theme:Y,baseTheme:Z}),Object(E.jsx)(b.Axis,{id:"key",position:b.Position.Left,showOverlappingTicks:!0,tickFormat:e=>me.convert(e)}),Object(E.jsx)(b.HistogramBarSeries,{data:X.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:b.ScaleType.Linear,yScaleType:b.ScaleType.Linear}))))}return ee&&ee.buckets.length?be(Object(E.jsx)(L,{areExamples:ee.areExamples,buckets:ee.buckets,dataView:P,field:O,sampledValuesCount:ae,color:v,"data-test-subj":x,onAddFilter:S,overrideFieldTopValueBar:D})):null};t.default=e=>Object(E.jsx)(error_boundary_ErrorBoundary,null,Object(E.jsx)(C,e))},893:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return u}));var s=a(8);const n=["_type","_source"];function r(e,t,a,n,l){for(const i in t){if(!t.hasOwnProperty(i))continue;const o=t[i],u=a+i,c=null==n?void 0:n.fields.getByName(u);if(!1===(null==l?void 0:l.shallow)){const t="nested"===(null==c?void 0:c.type);if(Array.isArray(o)&&!t){for(let t=0;t<o.length;t++){const a=o[t];Object(s.isPlainObject)(a)&&r(e,a,u+".",n,l)}continue}}else if(void 0!==e[u])continue;const d=c&&"conflict"!==c.type,m=!Object(s.isPlainObject)(o);d||m?e[u]?Array.isArray(e[u])?e[u].push(o):e[u]=[e[u],o]:e[u]=o:r(e,o,u+".",n,l)}}var l=a(295),i=a(296);function o(e,t){if(e=Object(s.defaults)(e,{count:i.a}),!Object(l.b)(e.field,e.isTextBased))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=e.values,{groups:n,sampledValues:r}=function(e,t){const a={};let n=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let r,l=0;const i={};r=Array.isArray(e)?e:null==e?[]:[e],r.forEach((e=>{const s=t?t.convert(e):e;i[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:l++},i[s]=!0,n++)}))})),{groups:a,sampledValues:n}}(a,t);return{buckets:Object(s.sortBy)(n,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:r,sampledDocuments:e.values.length}}function u(e,t,a){return null!=t&&t.name?Object(s.map)(e,(function(e){return function(e,t,a){const s={};if(r(s,e.fields||{},"",t,a),!1!==(null==a?void 0:a.source)&&e._source)r(s,e._source,"",t,a);else if(null!=a&&a.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!e.ignored_field_values.hasOwnProperty(t))continue;const a=e.ignored_field_values[t];s[t]?Array.isArray(s[t])?s[t]=[...s[t],...a]:s[t]=[s[t],...a]:s[t]=a}if(null!=t&&t.metaFields)for(let a=0;a<(null==t?void 0:t.metaFields.length);a++){const r=null==t?void 0:t.metaFields[a];n.includes(r)||"_"!==r.charAt(0)||(s[r]=e[r])}return function(e,t){function a(e,a){var s,n;const r=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(e)),l=null==t||null===(n=t.metaFields)||void 0===n?void 0:n.includes(String(a));return r&&l?String(e).localeCompare(String(a)):r?1:l?-1:String(e).localeCompare(String(a))}return new Proxy(e,{ownKeys:e=>Reflect.ownKeys(e).sort(a)})}(s,t)}(e,a,{includeIgnoredValues:!0})[t.name]})):[]}}}]);