/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[12],{150:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i(33),a=i(203);const o=[s.euiDarkVars.euiColorVis0,s.euiDarkVars.euiColorVis1,s.euiDarkVars.euiColorVis2,s.euiDarkVars.euiColorVis3,s.euiDarkVars.euiColorVis4,s.euiDarkVars.euiColorVis5,s.euiDarkVars.euiColorVis6,s.euiDarkVars.euiColorVis7,s.euiDarkVars.euiColorVis8,s.euiDarkVars.euiColorVis9,s.euiDarkVars.euiColorDarkShade,s.euiDarkVars.euiColorPrimary],r={};function n(e){if(void 0===r[e]){const t=Object(a.a)(e),i=o[t%o.length];return r[e]=i,i}return r[e]}},151:function(e,t,i){"use strict";i.d(t,"g",(function(){return R})),i.d(t,"d",(function(){return M})),i.d(t,"e",(function(){return P})),i.d(t,"a",(function(){return z})),i.d(t,"b",(function(){return L})),i.d(t,"f",(function(){return k})),i.d(t,"c",(function(){return w})),i.d(t,"h",(function(){return V}));var s=i(4),a=i.n(s),o=i(7),r=i(8),n=i(131),l=i(586),_=i(830),d=i(37),c=i(166),h=i(159),u=i(154),g=i(73),f=i(11),p=i(30);const m=250;class job_runner_JobRunner{constructor(e){a()(this,"_jobId",void 0),a()(this,"_datafeedId",void 0),a()(this,"_start",0),a()(this,"_end",0),a()(this,"_datafeedState",p.a.STOPPED),a()(this,"_refreshInterval",m),a()(this,"_progress$",void 0),a()(this,"_percentageComplete",0),a()(this,"_stopRefreshPoll",void 0),a()(this,"_subscribers",void 0),a()(this,"_datafeedStartTime",0),a()(this,"_performRefreshRateAdjustment",!1),a()(this,"_jobAssignedToNode",!1),a()(this,"_jobAssignedToNode$",void 0),this._jobId=e.jobId,this._datafeedId=e.datafeedId,this._start=e.start,this._end=e.end,this._percentageComplete=0,this._stopRefreshPoll=e.stopAllRefreshPolls,this._progress$=new o.BehaviorSubject(this._percentageComplete),this._jobAssignedToNode$=new o.BehaviorSubject(this._jobAssignedToNode),this._subscribers=e.subscribers}get datafeedState(){return this._datafeedState}set refreshInterval(e){this._refreshInterval=e}resetInterval(){this._refreshInterval=m}async openJob(){try{const{node:e}=await g.mlJobService.openJob(this._jobId);this._jobAssignedToNode=void 0!==e&&e.length>0,this._jobAssignedToNode$.next(this._jobAssignedToNode)}catch(e){throw e}}async _startDatafeed(e,t,i){try{this._datafeedStartTime=Date.now();const s=!0===i?this._subscribers.map((e=>this._progress$.subscribe(e))):[];await this.openJob();const{started:a}=await g.mlJobService.startDatafeed(this._datafeedId,this._jobId,e,t);this._datafeedState=p.a.STARTED,this._percentageComplete=0;const o=async()=>{const{isRunning:e,progress:t,isJobClosed:i}=await this.getProgress(),a=100!==t||!0!==e&&!1!==i?t:t-1;this._adjustRefreshInterval(a),this._percentageComplete=a,this._progress$.next(this._percentageComplete),!0!==e&&!1!==i||!1!==this._stopRefreshPoll.stop?(this._progress$.next(100),s.forEach((e=>e.unsubscribe()))):setTimeout((async()=>{!1===this._stopRefreshPoll.stop&&await o()}),this._refreshInterval)},r=async()=>{this._jobAssignedToNode=await this._isJobAssigned(),this._jobAssignedToNode$.next(this._jobAssignedToNode),!0===this._jobAssignedToNode?await o():setTimeout((async()=>{!1===this._stopRefreshPoll.stop&&await r()}),2e3)};return!0===i&&(!0===this._jobAssignedToNode?await o():await r()),a}catch(e){throw e}}_adjustRefreshInterval(e){if(!1===this._performRefreshRateAdjustment){if(!(Date.now()-this._datafeedStartTime>2e3))return;this._performRefreshRateAdjustment=!0}const t=e-this._percentageComplete;0!==t&&(this._refreshInterval=Math.floor(this._refreshInterval*(2/t)),this._refreshInterval<m&&(this._refreshInterval=m))}async _isJobAssigned(){const{jobs:e}=await f.ml.getJobStats({jobId:this._jobId});return e.length>0&&void 0!==e[0].node}async startDatafeed(){return await this._startDatafeed(this._start,this._end,!0)}async startDatafeedInRealTime(e){const t=e?this._end:this._start;return await this._startDatafeed(t,void 0,!1)}async getProgress(){return await f.ml.jobs.getLookBackProgress(this._jobId,this._start,this._end)}subscribeToProgress(e){this._progress$.subscribe(e)}async isRunning(){const{isRunning:e}=await this.getProgress();return e}isJobAssignedToNode(){return this._jobAssignedToNode}subscribeToJobAssignment(e){return this._jobAssignedToNode$.subscribe(e)}}var b=i(125),v=i(133);function j(e,t){if(!Object(d.a)(t,["runtime_mappings"])||!Object(d.a)(t.runtime_mappings))return{runtime_mappings:{},discarded_mappings:{}};const i=function(e,t){var i;const s=new Set;e.analysis_config.detectors.forEach((e=>{void 0!==e.field_name&&s.add(e.field_name),void 0!==e.by_field_name&&s.add(e.by_field_name),void 0!==e.over_field_name&&s.add(e.over_field_name),void 0!==e.partition_field_name&&s.add(e.partition_field_name)})),void 0!==e.analysis_config.categorization_field_name&&s.add(e.analysis_config.categorization_field_name),void 0!==e.analysis_config.summary_count_field_name&&s.add(e.analysis_config.summary_count_field_name),void 0!==e.analysis_config.influencers&&e.analysis_config.influencers.forEach((e=>s.add(e)));const a=null!==(i=t.aggregations)&&void 0!==i?i:t.aggs;void 0!==a&&y(a).forEach((e=>s.add(e)));const o=t.query;return void 0!==o&&F(o).forEach((e=>s.add(e))),[...s]}(e,t),{runtimeMappings:s,discardedMappings:a}=(o=t.runtime_mappings,{runtimeMappings:(r=i).reduce(((e,t)=>(void 0!==o[t]&&(e[t]=o[t]),e)),{}),discardedMappings:Object.keys(o).reduce(((e,t)=>(!1===r.includes(t)&&void 0!==o[t]&&(e[t]=o[t]),e)),{})});var o,r;return{runtime_mappings:s,discarded_mappings:a}}function y(e){const t=[];return Object.entries(e).forEach((([e,i])=>{Object(d.a)(i)?t.push(...y(i)):"string"==typeof i&&"field"===e&&t.push(i)})),t}function F(e){const t=[];return Object.entries(e).forEach((([e,i])=>{Object(d.a)(i)?(t.push(e),t.push(...F(i))):"string"==typeof i?t.push(i):t.push(e)})),t}var O=i(40),D=i(435),C=i(333),I=i(422);class job_creator_JobCreator{constructor(e,t,i){a()(this,"_type",b.f.SINGLE_METRIC),a()(this,"_indexPattern",void 0),a()(this,"_savedSearch",void 0),a()(this,"_indexPatternTitle",""),a()(this,"_indexPatternDisplayName",""),a()(this,"_job_config",void 0),a()(this,"_calendars",void 0),a()(this,"_datafeed_config",void 0),a()(this,"_detectors",void 0),a()(this,"_influencers",void 0),a()(this,"_bucketSpanMs",0),a()(this,"_useDedicatedIndex",!1),a()(this,"_start",0),a()(this,"_end",0),a()(this,"_subscribers",[]),a()(this,"_aggs",[]),a()(this,"_fields",[]),a()(this,"_scriptFields",[]),a()(this,"_runtimeFields",[]),a()(this,"_runtimeMappings",null),a()(this,"_filterRuntimeMappingsOnSave",!0),a()(this,"_aggregationFields",[]),a()(this,"_sparseData",!1),a()(this,"_stopAllRefreshPolls",{stop:!1}),a()(this,"_wizardInitialized$",new o.BehaviorSubject(!1)),a()(this,"wizardInitialized$",this._wizardInitialized$.asObservable()),this._indexPattern=e,this._savedSearch=t;const s=this._indexPattern.title,r=this._indexPattern.getName();this._indexPatternDisplayName=r===s?r:`${r} (${s})`,this._indexPatternTitle=s,this._job_config=Object(u.c)(),this._calendars=[],this._datafeed_config=Object(u.b)(this._indexPatternTitle),this._detectors=this._job_config.analysis_config.detectors,this._influencers=this._job_config.analysis_config.influencers,"string"==typeof e.timeFieldName&&(this._job_config.data_description.time_field=e.timeFieldName),this._extractRuntimeMappings(),this._datafeed_config.query=i}get type(){return this._type}get savedSearch(){return this._savedSearch}get dataView(){return this._indexPattern}get dataViewId(){return this._indexPattern.id}get indexPatternTitle(){return this._indexPatternTitle}get indexPatternDisplayName(){return this._indexPatternDisplayName}_addDetector(e,t,i){this._detectors.push(e),this._aggs.push(t),this._fields.push(i),this._updateSparseDataDetectors()}_editDetector(e,t,i,s){void 0!==this._detectors[s]&&(this._detectors[s]=e,this._aggs[s]=t,this._fields[s]=i,this._updateSparseDataDetectors())}_removeDetector(e){this._detectors.splice(e,1),this._aggs.splice(e,1),this._fields.splice(e,1)}removeAllDetectors(){this._detectors.length=0,this._aggs.length=0,this._fields.length=0}get savedSearchQuery(){return this._savedSearch?Object(c.c)(this._savedSearch):null}get detectors(){return this._detectors}get aggregationsInDetectors(){return this._aggs}getAggregation(e){const t=this._aggs[e];return void 0!==t?t:null}get aggregations(){return this._aggs}getField(e){const t=this._fields[e];return void 0!==t?t:null}get fields(){return this._fields}set bucketSpan(e){this._job_config.analysis_config.bucket_span=e,this._setBucketSpanMs(e)}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_setBucketSpanMs(e){const t=Object(O.a)(e,!0);this._bucketSpanMs=null===t?0:t.asMilliseconds()}get bucketSpanMs(){return this._bucketSpanMs}addInfluencer(e){!1===this._influencers.includes(e)&&this._influencers.push(e)}removeInfluencer(e){const t=this._influencers.indexOf(e);-1!==t&&this._influencers.splice(t,1)}removeAllInfluencers(){this._influencers.length=0}get influencers(){return this._influencers}set jobId(e){this._job_config.job_id=e,this._datafeed_config.job_id=e,this._datafeed_config.datafeed_id=`datafeed-${e}`,this._useDedicatedIndex&&(this._job_config.results_index_name=e)}get jobId(){return this._job_config.job_id}get datafeedId(){return this._datafeed_config.datafeed_id}set description(e){this._job_config.description=e}get description(){var e;return null!==(e=this._job_config.description)&&void 0!==e?e:""}get groups(){var e;return null!==(e=this._job_config.groups)&&void 0!==e?e:[]}set groups(e){this._job_config.groups=e}get calendars(){return this._calendars}set calendars(e){this._calendars=e}_initModelPlotConfig(){void 0===this._job_config.model_plot_config&&(this._job_config.model_plot_config={enabled:!1}),void 0!==this._job_config.model_plot_config&&void 0===this._job_config.model_plot_config.enabled&&(this._job_config.model_plot_config.enabled=!1),void 0!==this._job_config.model_plot_config&&void 0===this._job_config.model_plot_config.annotations_enabled&&(this._job_config.model_plot_config.annotations_enabled=!1)}set modelPlot(e){this._initModelPlotConfig(),this._job_config.model_plot_config.enabled=e}get modelPlot(){return void 0!==this._job_config.model_plot_config&&!0===this._job_config.model_plot_config.enabled}set modelChangeAnnotations(e){this._initModelPlotConfig(),this._job_config.model_plot_config.annotations_enabled=e}get modelChangeAnnotations(){var e;return!0===(null===(e=this._job_config.model_plot_config)||void 0===e?void 0:e.annotations_enabled)}set useDedicatedIndex(e){this._useDedicatedIndex=e,e?void 0===this._job_config.results_index_name&&(this._job_config.results_index_name=this._job_config.job_id):delete this._job_config.results_index_name}get useDedicatedIndex(){return this._useDedicatedIndex}set modelMemoryLimit(e){null!==e?(void 0===this._job_config.analysis_limits&&(this._job_config.analysis_limits={}),this._job_config.analysis_limits.model_memory_limit=e):void 0!==this._job_config.analysis_limits&&(delete this._job_config.analysis_limits.model_memory_limit,!1===Object(d.a)(this._job_config.analysis_limits)&&delete this._job_config.analysis_limits)}get modelMemoryLimit(){return this._job_config.analysis_limits&&void 0!==this._job_config.analysis_limits.model_memory_limit?this._job_config.analysis_limits.model_memory_limit:null}set summaryCountFieldName(e){null!==e?this._job_config.analysis_config.summary_count_field_name=e:delete this._job_config.analysis_config.summary_count_field_name}get summaryCountFieldName(){return this._job_config.analysis_config.summary_count_field_name||null}set categorizationFieldName(e){null!==e?this._job_config.analysis_config.categorization_field_name=e:delete this._job_config.analysis_config.categorization_field_name}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}addCategorizationFilter(e){void 0===this._job_config.analysis_config.categorization_filters&&(this._job_config.analysis_config.categorization_filters=[]);const t=this._job_config.analysis_config.categorization_filters;!1===t.includes(e)&&t.push(e)}removeCategorizationFilter(e){const t=this._job_config.analysis_config.categorization_filters;if(void 0!==t){const i=t.indexOf(e);-1!==i&&t.splice(i,1),0===t.length&&this.removeCategorizationFilters()}}removeCategorizationFilters(){delete this._job_config.analysis_config.categorization_filters}get categorizationFilters(){return this._job_config.analysis_config.categorization_filters||null}get timeFieldName(){return this._job_config.data_description.time_field}set timeFieldName(e){this._job_config.data_description.time_field=e}get sparseData(){return this._sparseData}set sparseData(e){this._sparseData=e,this._updateSparseDataDetectors()}_updateSparseDataDetectors(){this._detectors.forEach(((e,t)=>{if(void 0!==this._aggs[t])switch(this._aggs[t].id){case _.b.COUNT:e.function=this._sparseData?_.b.NON_ZERO_COUNT:_.b.COUNT;break;case _.b.HIGH_COUNT:e.function=this._sparseData?_.b.HIGH_NON_ZERO_COUNT:_.b.HIGH_COUNT;break;case _.b.LOW_COUNT:e.function=this._sparseData?_.b.LOW_NON_ZERO_COUNT:_.b.LOW_COUNT;break;case _.b.SUM:e.function=this._sparseData?_.b.NON_NULL_SUM:_.b.SUM;break;case _.b.HIGH_SUM:e.function=this._sparseData?_.b.HIGH_NON_NULL_SUM:_.b.HIGH_SUM;break;case _.b.LOW_SUM:e.function=this._sparseData?_.b.LOW_NON_NULL_SUM:_.b.LOW_SUM}}))}async _updateCalendars(){if(0!==this._calendars.length)for(const e of this._calendars)await D.a.assignNewJobId(e,this.jobId)}setTimeRange(e,t){this._start=e,this._end=t}get start(){return this._start}get end(){return this._end}get query(){return this._datafeed_config.query}set query(e){this._datafeed_config.query=e}get queryDelay(){return this._datafeed_config.query_delay||null}set queryDelay(e){null!==e?this._datafeed_config.query_delay=e:delete this._datafeed_config.query_delay}get frequency(){return this._datafeed_config.frequency||null}set frequency(e){null!==e?this._datafeed_config.frequency=e:delete this._datafeed_config.frequency}get scrollSize(){return this._datafeed_config.scroll_size||null}set scrollSize(e){null!==e?this._datafeed_config.scroll_size=e:delete this._datafeed_config.scroll_size}get indices(){return this._datafeed_config.indices}set indices(e){this._datafeed_config.indices=e}get ignoreUnavailable(){var e;return!(null===(e=this._datafeed_config.indices_options)||void 0===e||!e.ignore_unavailable)}set ignoreUnavailable(e){!0===e?(void 0===this._datafeed_config.indices_options&&(this._datafeed_config.indices_options={}),this._datafeed_config.indices_options.ignore_unavailable=!0):void 0!==this._datafeed_config.indices_options&&(delete this._datafeed_config.indices_options.ignore_unavailable,0===Object.keys(this._datafeed_config.indices_options).length&&delete this._datafeed_config.indices_options)}get scriptFields(){return this._scriptFields}get runtimeMappings(){return this._runtimeMappings}get runtimeFields(){return this._runtimeFields}get aggregationFields(){return this._aggregationFields}get additionalFields(){return[...this._scriptFields,...this._runtimeFields,...this._aggregationFields]}get subscribers(){return this._subscribers}async createAndStartJob(){try{return await this.createJob(),await this.createDatafeed(),await this.startDatafeed()}catch(e){throw e}}async createJob(){try{const{success:e,resp:t}=await g.mlJobService.saveNewJob(this._job_config);if(await this._updateCalendars(),!0===e)return t;throw t}catch(e){throw e}}async createDatafeed(){try{const e=this._getDatafeedWithFilteredRuntimeMappings();return await g.mlJobService.saveNewDatafeed(e,this._job_config.job_id)}catch(e){throw e}}async startDatafeed(){const e=new job_runner_JobRunner(this);return await e.startDatafeed(),e}_getDatafeedWithFilteredRuntimeMappings(){if(!1===this._filterRuntimeMappingsOnSave)return this._datafeed_config;const{runtime_mappings:e}=j(this._job_config,this._datafeed_config);return{...this._datafeed_config,runtime_mappings:Object.keys(e).length>0?e:void 0}}subscribeToProgress(e){this._subscribers.push(e)}get jobConfig(){return this._job_config}get datafeedConfig(){return this._datafeed_config}get stopAllRefreshPolls(){return this._stopAllRefreshPolls}forceStopRefreshPolls(){this._stopAllRefreshPolls.stop=!0}_setCustomSetting(e,t){null===t?void 0!==this._job_config.custom_settings&&void 0!==this._job_config.custom_settings[e]&&(delete this._job_config.custom_settings[e],0===Object.keys(this._job_config.custom_settings).length&&delete this._job_config.custom_settings):void 0===this._job_config.custom_settings?this._job_config.custom_settings={[e]:t}:this._job_config.custom_settings[e]=t}_getCustomSetting(e){return void 0!==this._job_config.custom_settings&&void 0!==this._job_config.custom_settings[e]?this._job_config.custom_settings[e]:null}set createdBy(e){this._setCustomSetting("created_by",e)}get createdBy(){return this._getCustomSetting("created_by")}set customUrls(e){this._setCustomSetting("custom_urls",e)}get customUrls(){return this._getCustomSetting("custom_urls")}get formattedJobJson(){return JSON.stringify(this._job_config,null,2)}get formattedDatafeedJson(){return JSON.stringify(this._datafeed_config,null,2)}set filterRuntimeMappingsOnSave(e){this._filterRuntimeMappingsOnSave=e}get filterRuntimeMappingsOnSave(){return this._filterRuntimeMappingsOnSave}_initPerPartitionCategorization(){var e,t;void 0===this._job_config.analysis_config.per_partition_categorization&&(this._job_config.analysis_config.per_partition_categorization={}),void 0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)&&(this._job_config.analysis_config.per_partition_categorization.enabled=!1),void 0===(null===(t=this._job_config.analysis_config.per_partition_categorization)||void 0===t?void 0:t.stop_on_warn)&&(this._job_config.analysis_config.per_partition_categorization.stop_on_warn=!1)}get perPartitionCategorization(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)}set perPartitionCategorization(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.enabled=e}get perPartitionStopOnWarn(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.stop_on_warn)}set perPartitionStopOnWarn(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.stop_on_warn=e}_extractRuntimeMappings(){const e=this._indexPattern.toSpec().runtimeFieldMap;void 0!==e&&(void 0===this._datafeed_config.runtime_mappings&&(this._datafeed_config.runtime_mappings={}),Object.entries(e).forEach((([e,t])=>{this._datafeed_config.runtime_mappings[e]=t}))),this._populateRuntimeFields()}_populateRuntimeFields(){var e;if(this._runtimeFields=[],this._runtimeMappings=null!==(e=this._datafeed_config.runtime_mappings)&&void 0!==e?e:null,null!==this._runtimeMappings){const e=Object.entries(this._runtimeMappings).map((([e,t])=>({id:e,name:e,type:Array.isArray(t)?t[0].type:t.type,aggregatable:!0,counter:!1,aggs:[],runtimeField:t}))),t=Object(r.cloneDeep)([..._.d,..._.e]);this._runtimeFields=Object(h.b)(e,t,{}).fields}}_populateScriptFields(){this._scriptFields=[],void 0!==this._datafeed_config.script_fields&&(this._scriptFields=Object.keys(this._datafeed_config.script_fields).map((e=>({id:e,name:e,type:n.a.KEYWORD,aggregatable:!0,counter:!1}))))}async autoSetTimeRange(e=!0){const{start:t,end:i}=await f.ml.getTimeFieldRange({index:this._indexPatternTitle,timeFieldName:this.timeFieldName,query:e?Object(l.a)(this.query):this.query,runtimeMappings:this.datafeedConfig.runtime_mappings,indicesOptions:this.datafeedConfig.indices_options});this.setTimeRange(t,i)}_overrideConfigs(e,t){this._job_config=e,this._datafeed_config=t,this._detectors=this._job_config.analysis_config.detectors,this._influencers=this._job_config.analysis_config.influencers,void 0===this._job_config.groups&&(this._job_config.groups=[]),void 0!==this._job_config.analysis_config.influencers&&this._job_config.analysis_config.influencers.forEach((e=>this.addInfluencer(e))),void 0!==this._job_config.results_index_name&&this._job_config.results_index_name!==b.h&&(this.useDedicatedIndex=!0),this._populateScriptFields(),this._populateRuntimeFields(),this._aggregationFields=[];const i=Object(C.b)(this._datafeed_config);if(void 0!==i){const e=Object(I.a)(i);if(void 0!==e&&void 0!==i[e]){const t=i[e];Object(v.c)(t,this._aggregationFields)}}}}var T=i(520);class single_metric_job_creator_SingleMetricJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_type",b.f.SINGLE_METRIC),this.createdBy=b.a.SINGLE_METRIC,this._wizardInitialized$.next(!0)}setDetector(e,t){const i=Object(u.a)(e,t);0===this._detectors.length?this._addDetector(i,e,t):this._editDetector(i,e,t,0),this._createDatafeedAggregations()}set bucketSpan(e){this._job_config.analysis_config.bucket_span=e,this._setBucketSpanMs(e),this._createDatafeedAggregations()}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_createDatafeedAggregations(){if(this._detectors.length&&"string"==typeof this._job_config.analysis_config.bucket_span&&this._aggs.length>0){var e;if(delete this._job_config.analysis_config.summary_count_field_name,delete this._datafeed_config.aggregations,(null===(e=this._fields[0])||void 0===e?void 0:e.name)===T.a)return;const t=this._aggs[0].dslName,i=this._job_config.data_description.time_field,s=Object(O.a)(this._job_config.analysis_config.bucket_span,!0);if(null===s)return;const a=1e3*s.asSeconds();let o=null;switch(t){case _.a.COUNT:this._job_config.analysis_config.summary_count_field_name=T.a,this._datafeed_config.aggregations={buckets:{date_histogram:{field:i,fixed_interval:`${a}ms`},aggregations:{[i]:{max:{field:i}}}}};break;case _.a.AVG:case _.a.SUM:case _.a.MIN:case _.a.MAX:if(o=this._fields[0],null!==o){const e=o.name;this._job_config.analysis_config.summary_count_field_name=T.a,this._datafeed_config.aggregations={buckets:{date_histogram:{field:i,fixed_interval:.1*a+"ms"},aggregations:{[e]:{[t]:{field:e}},[i]:{max:{field:i}}}}}}break;case _.a.CARDINALITY:if(o=this._fields[0],null!==o){const e=o.name;this._job_config.analysis_config.summary_count_field_name=`dc_${e}`,this._datafeed_config.aggregations={buckets:{date_histogram:{field:i,fixed_interval:`${a}ms`},aggregations:{[i]:{max:{field:i}},[this._job_config.analysis_config.summary_count_field_name]:{[t]:{field:e}}}}};const s=this._detectors[0];s.function=_.b.NON_ZERO_COUNT,s.detector_description=`${t} (${e})`,delete s.field_name}}}}get aggFieldPair(){return 0===this._aggs.length?null:{agg:this._aggs[0],field:this._fields[0]}}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.SINGLE_METRIC,this._sparseData=Object(v.k)(e,t);const i=Object(v.j)(e,t,this.additionalFields,!1);this.removeAllDetectors();const s=i[0];i.length&&null!==s.agg&&null!==s.field&&this.setDetector(s.agg,s.field)}}class multi_metric_job_creator_MultiMetricJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_splitField",null),a()(this,"_type",b.f.MULTI_METRIC),this.createdBy=b.a.MULTI_METRIC,this._wizardInitialized$.next(!0)}setSplitField(e){if(this._splitField=e,null===this._splitField)this.removeSplitField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].partition_field_name=this._splitField.id}removeSplitField(){this._detectors.forEach((e=>{delete e.partition_field_name}))}get splitField(){return this._splitField}addDetector(e,t){const i=this._createDetector(e,t);this._addDetector(i,e,t)}editDetector(e,t,i){const s=this._createDetector(e,t);this._editDetector(s,e,t,i)}_createDetector(e,t){const i=Object(u.a)(e,t);return null!==this._splitField&&(i.partition_field_name=this._splitField.id),i}removeDetector(e){this._removeDetector(e)}get aggFieldPairs(){return this.detectors.map(((e,t)=>({field:this._fields[t],agg:this._aggs[t]})))}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.MULTI_METRIC,this._sparseData=Object(v.k)(e,t);const i=Object(v.j)(e,t,this.additionalFields,!1);void 0!==t.aggregations&&(delete t.aggregations,delete e.analysis_config.summary_count_field_name),this.removeAllDetectors(),i.forEach(((e,t)=>{const s=i[t];null!==s.agg&&null!==s.field&&this.addDetector(s.agg,s.field)})),i.length&&null!==i[0].partitionField&&this.setSplitField(i[0].partitionField)}}class population_job_creator_PopulationJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_populatonField",null),a()(this,"_byFields",[]),a()(this,"_type",b.f.POPULATION),this.createdBy=b.a.POPULATION,this._wizardInitialized$.next(!0)}setByField(e,t){null===e?this.removeByField(t):void 0!==this._detectors[t]&&(this._byFields[t]=e,this._detectors[t].by_field_name=e.id)}removeByField(e){void 0!==this._detectors[e]&&(this._byFields[e]=null,delete this._detectors[e].by_field_name)}getByField(e){return void 0===this._byFields[e]?null:this._byFields[e]}setPopulationField(e){if(this._populatonField=e,null===this._populatonField)this.removePopulationField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].over_field_name=this._populatonField.id}removePopulationField(){this._detectors.forEach((e=>{delete e.over_field_name}))}get populationField(){return this._populatonField}addDetector(e,t){const i=this._createDetector(e,t);this._addDetector(i,e,t),this._byFields.push(null)}editDetector(e,t,i){const s=this._createDetector(e,t),a=this._byFields[i];null!=a&&(s.by_field_name=a.id),this._editDetector(s,e,t,i)}_createDetector(e,t){const i=Object(u.a)(e,t);return null!==this._populatonField&&(i.over_field_name=this._populatonField.id),i}removeDetector(e){this._removeDetector(e),this._byFields.splice(e,1)}get aggFieldPairs(){return this.detectors.map(((e,t)=>({field:this._fields[t],agg:this._aggs[t],by:{field:this._byFields[t],value:null}})))}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.POPULATION;const i=Object(v.j)(e,t,this.additionalFields,!1);this.removeAllDetectors(),i.length&&null!==i[0].overField&&this.setPopulationField(i[0].overField),i.forEach(((e,t)=>{const s=i[t];null!==s.agg&&null!==s.field&&(this.addDetector(s.agg,s.field),null!==s.byField&&this.setByField(s.byField,t))}))}}var S=i(180);class advanced_job_creator_AdvancedJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_type",b.f.ADVANCED),a()(this,"_richDetectors",[]),a()(this,"_queryString",void 0),this.createdBy=b.a.ADVANCED,this._queryString=JSON.stringify(this._datafeed_config.query),this._wizardInitialized$.next(!0)}addDetector(e,t,i,s,a,o,r,n){const{detector:l,richDetector:_}=this._createDetector(e,t,i,s,a,o,r,null,n);this._addDetector(l,e,t),this._richDetectors.push(_)}editDetector(e,t,i,s,a,o,r,n,l){const _=void 0!==this._detectors[n]&&this._detectors[n].custom_rules||null,{detector:d,richDetector:c}=this._createDetector(e,t,i,s,a,o,r,_,l);this._editDetector(d,e,t,n),void 0!==this._richDetectors[n]&&(this._richDetectors[n]=c)}_createDetector(e,t,i,s,a,o,r,n,l){const _=Object(u.a)(e,t);return null!==i&&(_.by_field_name=i.id),null!==s&&(_.over_field_name=s.id),null!==a&&(_.partition_field_name=a.id),null!==o&&(_.exclude_frequent=o),null!==r&&(_.detector_description=r),null!==n&&(_.custom_rules=n),null!==l&&(_.use_null=l),{detector:_,richDetector:{agg:e,field:t,byField:i,overField:s,partitionField:a,excludeFrequent:o,description:r,customRules:n,useNull:l}}}removeDetector(e){this._removeDetector(e),this._richDetectors.splice(e,1)}get richDetectors(){return this._richDetectors}get queryString(){return this._queryString}set queryString(e){this._queryString=e}get isValidQueryString(){return Object(S.c)(this._queryString)}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.ADVANCED;const i=Object(v.j)(e,t,this.additionalFields,!0),s=this._detectors.map((e=>e.custom_rules));this.removeAllDetectors(),this._richDetectors.length=0,i.forEach(((e,t)=>{const s=i[t];null!==s.agg&&null!==s.field&&this.addDetector(s.agg,s.field,s.byField,s.overField,s.partitionField,s.excludeFrequent,s.description,s.useNull)})),s.forEach(((e,t)=>{void 0!==e&&(this._detectors[t].custom_rules=e)}))}}var A=i(519),N=i(835),E=i(497),x=i(18);class categorization_job_creator_CategorizationJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_type",b.f.CATEGORIZATION),a()(this,"_createCountDetector",(()=>{})),a()(this,"_createHighCountDetector",(()=>{})),a()(this,"_createRareDetector",(()=>{})),a()(this,"_examplesLoader",void 0),a()(this,"_categoryFieldExamples",[]),a()(this,"_validationChecks",[]),a()(this,"_overallValidStatus",N.a.INVALID),a()(this,"_detectorType",_.b.COUNT),a()(this,"_categorizationAnalyzer",{}),a()(this,"_defaultCategorizationAnalyzer",void 0),a()(this,"_partitionFieldName",null),a()(this,"_ccsVersionFailure",!1),this.createdBy=b.a.CATEGORIZATION,this._examplesLoader=new E.a(this,e,i);const{anomaly_detectors:s}=Object(x.c)();this._defaultCategorizationAnalyzer=s.categorization_analyzer||{}}setDefaultDetectorProperties(e,t,i,s){if(null===e||null===t||null===i||null===s)throw Error("event_rate field or count or rare aggregations missing");this._createCountDetector=()=>{this._createDetector(e,s)},this._createHighCountDetector=()=>{this._createDetector(t,s)},this._createRareDetector=()=>{this._createDetector(i,s)}}_createDetector(e,t){const i=Object(u.a)(e,t);i.by_field_name=A.c.id,this.perPartitionCategorization&&null!==this.categorizationPerPartitionField&&(i.partition_field_name=this.categorizationPerPartitionField),this._addDetector(i,e,A.c)}setDetectorType(e){this._detectorType=e,this.removeAllDetectors(),e===_.b.COUNT?(this._createCountDetector(),this.bucketSpan=b.b):e===_.b.HIGH_COUNT?(this._createHighCountDetector(),this.bucketSpan=b.b):(this._createRareDetector(),this.bucketSpan=b.e,this.modelPlot=!1)}set categorizationFieldName(e){null!==e?(this._job_config.analysis_config.categorization_field_name=e,this.setDetectorType(this._detectorType),this.addInfluencer(A.c.id)):(delete this._job_config.analysis_config.categorization_field_name,this._categoryFieldExamples=[],this._validationChecks=[],this._overallValidStatus=N.a.INVALID)}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}async loadCategorizationFieldExamples(){const{examples:e,sampleSize:t,overallValidStatus:i,validationChecks:s}=await this._examplesLoader.loadExamples(),a=null!=e?e:[];return this._categoryFieldExamples=a,this._validationChecks=s,this._overallValidStatus=i,this._ccsVersionFailure=this._checkCcsFailure(a,i,s),!0===this._ccsVersionFailure&&(this._overallValidStatus=N.a.VALID),this._wizardInitialized$.next(!0),{examples:a,sampleSize:t,overallValidStatus:i,validationChecks:s,ccsVersionFailure:this._ccsVersionFailure}}_checkCcsFailure(e,t,i){var s;return 0===e.length&&t===N.a.INVALID&&(null===(s=i[0])||void 0===s?void 0:s.id)===N.c.NO_EXAMPLES&&Object(c.d)(this.indexPatternTitle)}get categoryFieldExamples(){return this._categoryFieldExamples}get validationChecks(){return this._validationChecks}get overallValidStatus(){return this._overallValidStatus}get selectedDetectorType(){return this._detectorType}set categorizationAnalyzer(e){this._categorizationAnalyzer=e,Object(r.isEqual)(this._categorizationAnalyzer,this._defaultCategorizationAnalyzer)?delete this._job_config.analysis_config.categorization_analyzer:this._job_config.analysis_config.categorization_analyzer=e}get categorizationAnalyzer(){return this._categorizationAnalyzer}get categorizationPerPartitionField(){return this._partitionFieldName}set categorizationPerPartitionField(e){null===e?(this._detectors.forEach((e=>{delete e.partition_field_name})),null!==this._partitionFieldName&&this.removeInfluencer(this._partitionFieldName),this._partitionFieldName=null):this._partitionFieldName!==e&&(null!==this._partitionFieldName&&this.removeInfluencer(this._partitionFieldName),this.addInfluencer(e),this._partitionFieldName=e,this._detectors.forEach((t=>{t.partition_field_name=e})))}get perPartitionCategorization(){var e;return!0===(null===(e=this._job_config.analysis_config.per_partition_categorization)||void 0===e?void 0:e.enabled)}set perPartitionCategorization(e){this._initPerPartitionCategorization(),this._job_config.analysis_config.per_partition_categorization.enabled=e,!1===e&&(this.categorizationPerPartitionField=null)}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.CATEGORIZATION;const i=Object(v.j)(e,t,this.additionalFields,!1)[0];if(void 0!==i&&null!==i.agg&&null!==i.field){let t;t=i.agg.id===_.b.COUNT?_.b.COUNT:i.agg.id===_.b.HIGH_COUNT?_.b.HIGH_COUNT:_.b.RARE;const s=e.analysis_config.bucket_span;this.setDetectorType(t),null!==i.partitionField&&(this.categorizationPerPartitionField=i.partitionField.id),this.bucketSpan=s}}}class rare_job_creator_RareJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_rareField",null),a()(this,"_populationField",null),a()(this,"_splitField",null),a()(this,"_type",b.f.RARE),a()(this,"_rareInPopulation",!1),a()(this,"_frequentlyRare",!1),a()(this,"_rareAgg",void 0),a()(this,"_freqRareAgg",void 0),this.createdBy=b.a.RARE,this._wizardInitialized$.next(!0),this._rareAgg={},this._freqRareAgg={}}setDefaultDetectorProperties(e,t){if(null===e||null===t)throw Error("rare or freq_rare aggregations missing");this._rareAgg=e,this._freqRareAgg=t}setRareField(e){if(this._rareField=e,null===e)return this.removePopulationField(),this.removeSplitField(),this._removeDetector(0),this._detectors.length=0,void(this._fields.length=0);const t=this._frequentlyRare?this._freqRareAgg:this._rareAgg,i={function:t.id};0===this._detectors.length?this._addDetector(i,t,e):this._editDetector(i,t,e,0),this._detectors[0].by_field_name=e.id}get rareField(){return this._rareField}get rareInPopulation(){return this._rareInPopulation}set rareInPopulation(e){this._rareInPopulation=e,!1===e&&this.removePopulationField()}get frequentlyRare(){return this._frequentlyRare}set frequentlyRare(e){if(this._frequentlyRare=e,this._detectors.length){const t=e?this._freqRareAgg:this._rareAgg;this._detectors[0].function=t.id,this._aggs[0]=t}}setPopulationField(e){if(this._populationField=e,null===this._populationField)this.removePopulationField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].over_field_name=this._populationField.id}removePopulationField(){this._populationField=null,this._detectors.forEach((e=>{delete e.over_field_name}))}get populationField(){return this._populationField}setSplitField(e){if(this._splitField=e,null===this._splitField)this.removeSplitField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].partition_field_name=this._splitField.id}removeSplitField(){this._detectors.forEach((e=>{delete e.partition_field_name}))}get splitField(){return this._splitField}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.RARE,this._sparseData=Object(v.k)(e,t);const i=Object(v.j)(e,t,this.additionalFields,!1);var s;this.removeSplitField(),this.removePopulationField(),this.removeAllDetectors(),i.length&&(this.setRareField(i[0].byField),this.frequentlyRare=(null===(s=i[0].agg)||void 0===s?void 0:s.id)===_.b.FREQ_RARE,null!==i[0].overField&&(this.setPopulationField(i[0].overField),this.rareInPopulation=!0),null!==i[0].partitionField&&this.setSplitField(i[0].partitionField))}}class geo_job_creator_GeoJobCreator extends job_creator_JobCreator{constructor(e,t,i){super(e,t,i),a()(this,"_geoField",null),a()(this,"_geoAgg",null),a()(this,"_splitField",null),a()(this,"_type",b.f.GEO),this.createdBy=b.a.GEO,this._wizardInitialized$.next(!0)}setDefaultDetectorProperties(e){if(null===e)throw Error("lat_long aggregations missing");this._geoAgg=e}get geoField(){return this._geoField}get geoAgg(){return this._geoAgg}setGeoField(e){if(this._geoField=e,null===e)return this.removeSplitField(),this._removeDetector(0),this._detectors.length=0,void(this._fields.length=0);const t=this._geoAgg;this.removeAllDetectors();const i=this._createDetector(t,e);this._addDetector(i,t,e)}setSplitField(e){if(this._splitField=e,null===this._splitField)this.removeSplitField();else for(let e=0;e<this._detectors.length;e++)this._detectors[e].partition_field_name=this._splitField.id}removeSplitField(){this._detectors.forEach((e=>{delete e.partition_field_name}))}get splitField(){return this._splitField}_createDetector(e,t){const i=Object(u.a)(e,t);return null!==this._splitField&&(i.partition_field_name=this._splitField.id),i}get aggFieldPairs(){return this.detectors.map(((e,t)=>({field:this._fields[t],agg:this._aggs[t]})))}cloneFromExistingJob(e,t){this._overrideConfigs(e,t),this.createdBy=b.a.GEO,this._sparseData=Object(v.k)(e,t);const i=Object(v.j)(e,t,this.additionalFields,!1);this.removeSplitField(),this.removeAllDetectors(),this.removeAllDetectors(),i.length&&(this.setGeoField(i[0].field),null!==i[0].partitionField&&this.setSplitField(i[0].partitionField))}}function R(e){return e.type===b.f.SINGLE_METRIC}function M(e){return e.type===b.f.MULTI_METRIC}function P(e){return e.type===b.f.POPULATION}function z(e){return e.type===b.f.ADVANCED}function L(e){return e.type===b.f.CATEGORIZATION}function k(e){return e.type===b.f.RARE}function w(e){return e.type===b.f.GEO}const V=e=>(t,i,s)=>{let a;switch(e){case b.f.SINGLE_METRIC:a=single_metric_job_creator_SingleMetricJobCreator;break;case b.f.MULTI_METRIC:a=multi_metric_job_creator_MultiMetricJobCreator;break;case b.f.POPULATION:a=population_job_creator_PopulationJobCreator;break;case b.f.ADVANCED:a=advanced_job_creator_AdvancedJobCreator;break;case b.f.CATEGORIZATION:a=categorization_job_creator_CategorizationJobCreator;break;case b.f.RARE:a=rare_job_creator_RareJobCreator;break;case b.f.GEO:a=geo_job_creator_GeoJobCreator;break;default:a=single_metric_job_creator_SingleMetricJobCreator}return new a(t,i,s)}},200:function(e,t,i){"use strict";i.d(t,"d",(function(){return l})),i.d(t,"a",(function(){return _})),i.d(t,"c",(function(){return d})),i.d(t,"b",(function(){return c}));var s=i(10),a=i(151),o=i(82),r=i(318),n=i(17);function l(){const{euiTheme:e}=Object(s.a)();return{LINE_COLOR:e.euiColorPrimary,MODEL_COLOR:e.euiColorPrimary,EVENT_RATE_COLOR:e.euiColorPrimary,EVENT_RATE_COLOR_WITH_ANOMALIES:e.euiColorLightShade}}const _={width:"100%",height:"300px",cols:1,intervalMs:0},d={line:{strokeWidth:2,visible:!0,opacity:1},border:{visible:!1,strokeWidth:0},point:{visible:!1,radius:2,strokeWidth:4,opacity:.5},area:{opacity:.25,visible:!1}};function c(e,t){const i={..._,intervalMs:t.getInterval().asMilliseconds()};if(Object(a.e)(e)){const e=function(){const e=Object(n.g)();return new r.a({[o.UI_SETTINGS.HISTOGRAM_MAX_BARS]:e.get(o.UI_SETTINGS.HISTOGRAM_MAX_BARS),[o.UI_SETTINGS.HISTOGRAM_BAR_TARGET]:e.get(o.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:e.get("dateFormat"),"dateFormat:scaled":e.get("dateFormat:scaled")})}();e.setInterval("auto"),e.setBounds(t.getBounds()),i.intervalMs=e.getInterval().asMilliseconds()}return i.intervalMs<e.bucketSpanMs&&(i.intervalMs=e.bucketSpanMs),(Object(a.d)(e)||Object(a.e)(e))&&(e.aggFieldPairs.length>2&&Object(a.d)(e)?(i.cols=3,i.height="150px",i.intervalMs=3*i.intervalMs):e.aggFieldPairs.length>1&&(i.cols=2,i.height="200px",i.intervalMs=2*i.intervalMs)),i}},203:function(e,t,i){"use strict";function s(e){let t=0,i=0;if(0===e.length)return t;for(let s=0;s<e.length;s++)i=e.charCodeAt(s),t=(t<<5)-t+i,t|=0;return t<0?-2*t:t}i.d(t,"a",(function(){return s}))},278:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i(2),a=i(25),o=i(6);const r=({hasData:e,loading:t=!1,height:i,children:r})=>{const n=!0===t?!0===e?.3:0:1;return Object(o.jsx)(s.Fragment,null,Object(o.jsx)("div",{style:{height:"100%",opacity:n,transition:"opacity 0.2s"}},t&&!e?null:r),!0===t&&Object(o.jsx)(a.EuiFlexGroup,{justifyContent:"spaceAround",alignItems:"center",style:void 0!==i?{height:i,marginTop:`-${i}`}:{}},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiLoadingSpinner,{size:"xl"}))))}},326:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var s=i(2),a=i.n(s),o=i(76),r=i(6),n=i(5),l=i(436),_=i(200),d=i(278),c=i(438),h=i(25),u=i(415),g=i(10);const f=({overlayKey:e,start:t,end:i,color:s,showMarker:n=!0})=>{const{euiTheme:l}=Object(g.a)();return Object(r.jsx)(a.a.Fragment,null,Object(r.jsx)(o.RectAnnotation,{id:`rect_annotation_${e}`,zIndex:1,hideTooltips:!0,dataValues:[{coordinates:{x0:t,x1:i}}],style:{fill:s,strokeWidth:0}}),Object(r.jsx)(o.LineAnnotation,{id:"annotation_1",domainType:o.AnnotationDomainType.XDomain,dataValues:[{dataValue:t}],style:{line:{strokeWidth:1,opacity:0}},markerPosition:o.Position.Bottom,hideTooltips:!0,marker:n?Object(r.jsx)(h.EuiIcon,{type:"arrowUp"}):void 0,markerBody:n?Object(r.jsx)("div",{style:{fontWeight:"normal",color:l.euiTextColor}},Object(u.d)(t)):void 0}))};var p={name:"ozz2hs",styles:".echContainer{overflow:visible;}"};const m=({eventRateChartData:e,anomalyData:t,height:i,width:s,showAxis:a,loading:h=!1,fadeChart:u,overlayRanges:g,onBrushEnd:m})=>{const{EVENT_RATE_COLOR_WITH_ANOMALIES:b,EVENT_RATE_COLOR:v}=Object(_.d)(),j=u?b:v,y=p;return Object(r.jsx)("div",{style:{width:s,height:i},"data-test-subj":"mlEventRateChart "+(e.length?"withData":"empty")},Object(r.jsx)(d.a,{height:i,hasData:e.length>0,loading:h},Object(r.jsx)(o.Chart,{css:void 0!==g?y:void 0},!0===a&&Object(r.jsx)(l.a,null),Object(r.jsx)(o.Tooltip,{type:o.TooltipType.None}),Object(r.jsx)(o.Settings,{onBrushEnd:m,theme:{scales:{histogramPadding:.2}},baseTheme:o.LEGACY_LIGHT_THEME,locale:n.i18n.getLocale()}),g&&g.map(((e,t)=>Object(r.jsx)(f,{key:t,overlayKey:t,start:e.start,end:e.end,color:e.color,showMarker:e.showMarker}))),Object(r.jsx)(c.a,{anomalyData:t}),Object(r.jsx)(o.HistogramBarSeries,{id:"event_rate",xScaleType:o.ScaleType.Time,yScaleType:o.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:e,color:j}))))}},435:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i(5),a=i(11);const o=new class CalendarService{async assignNewJobId(e,t){const{calendar_id:i}=e;try{await a.ml.updateCalendar({...e,calendarId:i,job_ids:[...e.job_ids,t]})}catch(e){throw new Error(s.i18n.translate("xpack.ml.calendarService.assignNewJobIdErrorMessage",{defaultMessage:"Unable to assign {jobId} to {calendarId}",values:{calendarId:i,jobId:t}}))}}async fetchCalendarsByIds(e){try{const t=await a.ml.calendars({calendarIds:e});return Array.isArray(t)?t:[t]}catch(t){throw new Error(s.i18n.translate("xpack.ml.calendarService.fetchCalendarsByIdsErrorMessage",{defaultMessage:"Unable to fetch calendars: {calendarIds}",values:{calendarIds:e.join(", ")}}))}}}},436:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var s=i(2),a=i(76),o=i(437),r=i(6);const n=Object(a.timeFormatter)(Object(a.niceTimeFormatByDay)(3));function l(e){return(Math.round(100*e)/100).toString()}const _=({chartData:e})=>{const t=Object(o.b)(e);return Object(r.jsx)(s.Fragment,null,Object(r.jsx)(a.Axis,{id:"bottom",position:a.Position.Bottom,showOverlappingTicks:!0,tickFormat:n}),Object(r.jsx)(a.Axis,{id:"left",position:a.Position.Left,tickFormat:l,domain:t}))}},437:function(e,t,i){"use strict";function s(e){const t=!1;if(void 0===e)return{fit:t,min:NaN,max:NaN};if(0===e.length)return{min:0,max:0,fit:t};let i=Number.MIN_VALUE,s=Number.MAX_VALUE;e.forEach((e=>{i=Math.max(e.value,i),s=Math.min(e.value,s)}));const a=.1*(i-s);return i+=a,s-=a,{min:s,max:i,fit:t}}function a(e){return 0===e.length?{min:0,max:0}:{min:e[0].time,max:e[e.length-1].time}}i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return a}))},438:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var s=i(2),a=i(76),o=i(335),r=i(140),n=i(6);function l(e){return{line:{stroke:Object(o.a)(e),strokeWidth:3,opacity:1}}}const _=({anomalyData:e})=>{const t=function(e){const t={critical:[],major:[],minor:[],warning:[],unknown:[],low:[]};return e.forEach((e=>{0!==e.value&&t[e.severity].push({dataValue:e.time})})),t}(void 0===e?[]:e);return Object(n.jsx)(s.Fragment,null,Object(n.jsx)(a.LineAnnotation,{id:"low",domainType:a.AnnotationDomainType.XDomain,dataValues:t.low,style:l(r.a.LOW),hideTooltips:!0}),Object(n.jsx)(a.LineAnnotation,{id:"warning",domainType:a.AnnotationDomainType.XDomain,dataValues:t.warning,style:l(r.a.WARNING),hideTooltips:!0}),Object(n.jsx)(a.LineAnnotation,{id:"minor",domainType:a.AnnotationDomainType.XDomain,dataValues:t.minor,style:l(r.a.MINOR),hideTooltips:!0}),Object(n.jsx)(a.LineAnnotation,{id:"major",domainType:a.AnnotationDomainType.XDomain,dataValues:t.major,style:l(r.a.MAJOR),hideTooltips:!0}),Object(n.jsx)(a.LineAnnotation,{id:"critical",domainType:a.AnnotationDomainType.XDomain,dataValues:t.critical,style:l(r.a.CRITICAL),hideTooltips:!0}))}},497:function(e,t,i){"use strict";i.d(t,"b",(function(){return results_loader_ResultsLoader})),i.d(t,"a",(function(){return categorization_examples_loader_CategorizationExamplesLoader}));var s=i(4),a=i.n(s),o=i(7),r=i(830),n=i(834),l=i(40),_=i(125),d=i(80),c=i(151),h=i(8),u=i(135),g=i(11);const f={time:0,actual:0,modelUpper:0,modelLower:0};class results_loader_ResultsLoader{constructor(e,t,i){a()(this,"_results$",void 0),a()(this,"_resultsSearchRunning",!1),a()(this,"_jobCreator",void 0),a()(this,"_chartInterval",void 0),a()(this,"_lastModelTimeStamp",0),a()(this,"_lastResultsTimeout",null),a()(this,"_chartLoader",void 0),a()(this,"_results",{progress:0,model:[],anomalies:[]}),a()(this,"_detectorSplitFieldFilters",null),a()(this,"_splitFieldFiltersLoaded",!1),a()(this,"progressSubscriber",(async e=>{!1===this._resultsSearchRunning&&(e-this._results.progress>5||100===e)&&(!1===this._splitFieldFiltersLoaded&&(this._splitFieldFiltersLoaded=!0,await this._populateDetectorSplitFieldFilters()),this._updateData(e,!1),100===e&&(clearTimeout(this._lastResultsTimeout),this._lastResultsTimeout=setTimeout((()=>{this._updateData(e,!0)}),500)))})),this._jobCreator=e,this._chartInterval=t,this._results$=new o.BehaviorSubject(this._results),this._chartLoader=i,e.subscribeToProgress(this.progressSubscriber)}async _updateData(e,t){this._resultsSearchRunning=!0,!0===t&&this._clearResults(),this._results.progress=e;const i=this._jobCreator.type===_.f.SINGLE_METRIC?()=>this._loadJobAnomalyData(0):()=>this._loadDetectorsAnomalyData(),[s,a]=await Promise.all([this._loadModelData(0),i()]);this._results.model=s,this._results.anomalies=a,this._resultsSearchRunning=!1,this._results$.next(this._results)}get results$(){return this._results$}subscribeToResults(e){return this._results$.subscribe(e)}get progress(){return this._results.progress}_clearResults(){this._results.model={},this._results.anomalies={},this._results.progress=0,this._lastModelTimeStamp=0}async _loadModelData(e){if(!1===this._jobCreator.modelPlot)return[];const t=this._jobCreator.getAggregation(e);if(null===t)return{[e]:[f]};const i=await Object(o.lastValueFrom)(d.mlResultsService.getModelPlotOutput(this._jobCreator.jobId,e,[],this._lastModelTimeStamp,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),t.mlModelPlotAgg));return this._createModel(i,e)}_createModel({results:e},t){void 0===this._results.model[t]&&(this._results.model[t]=[]);const i=this._jobCreator.aggregations[t].dslName,s=i===r.a.COUNT||i===r.a.CARDINALITY?this._calculateModelScale():1,a=Object.entries(e).map((([e,{actual:t,modelLower:i,modelUpper:a}])=>({time:+e,actual:t,modelUpper:(null===a?0:a)*s,modelLower:(null===i?0:i)*s})));if(a.length>10){this._lastModelTimeStamp=a[a.length-5].time;for(let e=0;e<5;e++)this._results.model[t].pop()}return{[t]:this._results.model[t].concat(a)}}async _loadJobAnomalyData(e){const t=(await d.mlResultsService.getScoresByBucket([this._jobCreator.jobId],this._jobCreator.start,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),1)).results[this._jobCreator.jobId];if(void 0===t)return[];const i={};return i[0]=Object.entries(t).map((([e,t])=>({time:+e,value:t,severity:Object(n.a)(t)}))),i}async _loadDetectorsAnomalyData(){const e=await(t=this._jobCreator.jobId,i=this._jobCreator.start,s=this._jobCreator.end,a=this._chartInterval.getInterval().asMilliseconds(),o=this._detectorSplitFieldFilters,new Promise(((e,r)=>{const n={success:!0,results:{},totalResults:0};let l="job_id: "+t;o&&void 0!==o.value&&(l+=` AND ${Object(u.c)(o.name)}:`,l+=`"${String(o.value).replace(/\\/g,"\\\\")}"`),g.ml.results.anomalySearch({body:{size:0,query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:i,lte:s,format:"epoch_millis"}}},{query_string:{query:l}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",fixed_interval:`${a}ms`,min_doc_count:1,extended_bounds:{min:i,max:s}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}},[t]).then((t=>{Object(h.get)(t,["aggregations","detector_index","buckets"],[]).forEach((e=>{const t=[],i=+e.key,s=Object(h.get)(e,["byTime","buckets"],[]);for(let e=0;e<s.length;e++){const i=s[e],a=i.key;t.push({time:a,value:Object(h.get)(i,["recordScore","value"])})}n.results[i]=t})),e(n)})).catch((e=>{r(e)}))})));var t,i,s,a,o;const r={};return Object.entries(e.results).forEach((([e,t])=>{r[+e]=t.map((e=>({...e,severity:Object(n.a)(e.value)})))})),r}async _populateDetectorSplitFieldFilters(){if(Object(c.d)(this._jobCreator)&&null!==this._jobCreator.splitField){const e=await this._chartLoader.loadFieldExampleValues(this._jobCreator.splitField,this._jobCreator.runtimeMappings,this._jobCreator.datafeedConfig.indices_options);e.length>0&&(this._detectorSplitFieldFilters={name:this._jobCreator.splitField.name,value:e[0]})}else this._detectorSplitFieldFilters=null}_calculateModelScale(){const e=Object(l.a)(this._jobCreator.bucketSpan),t=null!==e?e.asMilliseconds():0;return this._chartInterval.getInterval().asMilliseconds()/t}}var p=i(835);class categorization_examples_loader_CategorizationExamplesLoader{constructor(e,t,i){a()(this,"_jobCreator",void 0),a()(this,"_indexPatternTitle",""),a()(this,"_timeFieldName",""),a()(this,"_query",{}),this._jobCreator=e,this._indexPatternTitle=t.title,this._query=i,"string"==typeof t.timeFieldName&&(this._timeFieldName=t.timeFieldName)}async loadExamples(){var e;const t=this._jobCreator.categorizationAnalyzer,i=this._jobCreator.categorizationFieldName;return null===i?{examples:[],sampleSize:0,overallValidStatus:p.a.INVALID,validationChecks:[]}:await g.ml.jobs.categorizationFieldExamples(this._indexPatternTitle,this._query,_.g,i,this._timeFieldName,this._jobCreator.start,this._jobCreator.end,t,null!==(e=this._jobCreator.runtimeMappings)&&void 0!==e?e:void 0,this._jobCreator.datafeedConfig.indices_options)}}},586:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i(8),a=i(37);const o=e=>{const t={term:{_tier:{value:"data_frozen"}}};if(!e)return{bool:{must_not:[t]}};const i=Object(s.cloneDeep)(e);return delete i.match_all,Object(a.a)(i.bool)?Array.isArray(i.bool.must_not)?i.bool.must_not.push(t):(Object(a.a)(i.bool.must_not)&&(i.bool.must_not=[i.bool.must_not,t]),void 0===i.bool.must_not&&(i.bool.must_not=[t])):i.bool={must_not:[t]},i}},834:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var s=i(174);function a(e){return e>=75?s.a.CRITICAL:e>=50?s.a.MAJOR:e>=25?s.a.MINOR:e>=3?s.a.WARNING:e>=0?s.a.LOW:s.a.UNKNOWN}},835:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return r}));var s=i(5);let a=function(e){return e.VALID="valid",e.PARTIALLY_VALID="partially_valid",e.INVALID="invalid",e}({}),o=function(e){return e[e.NO_EXAMPLES=0]="NO_EXAMPLES",e[e.FAILED_TO_TOKENIZE=1]="FAILED_TO_TOKENIZE",e[e.TOO_MANY_TOKENS=2]="TOO_MANY_TOKENS",e[e.TOKEN_COUNT=3]="TOKEN_COUNT",e[e.MEDIAN_LINE_LENGTH=4]="MEDIAN_LINE_LENGTH",e[e.NULL_VALUES=5]="NULL_VALUES",e[e.INSUFFICIENT_PRIVILEGES=6]="INSUFFICIENT_PRIVILEGES",e}({});const r={[o.NO_EXAMPLES]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNoDataFound",{defaultMessage:"Examples were successfully loaded."}),[o.FAILED_TO_TOKENIZE]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validFailureToGetTokens",{defaultMessage:"The loaded examples were tokenized successfully."}),[o.TOKEN_COUNT]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTokenLength",{defaultMessage:"More than {tokenCount} tokens per example were found in over {percentage}% of the loaded examples.",values:{percentage:Math.floor(75),tokenCount:3}}),[o.MEDIAN_LINE_LENGTH]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validMedianLineLength",{defaultMessage:"The median line length of the loaded examples was less than {medianCharCount} characters.",values:{medianCharCount:400}}),[o.NULL_VALUES]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNullValues",{defaultMessage:"Less than {percentage}% of the loaded examples were null.",values:{percentage:Math.floor(25)}}),[o.TOO_MANY_TOKENS]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTooManyTokens",{defaultMessage:"Less than 10000 tokens were found in total in the loaded examples."}),[o.INSUFFICIENT_PRIVILEGES]:s.i18n.translate("xpack.ml.models.jobService.categorization.messages.validUserPrivileges",{defaultMessage:"The user has sufficient privileges to perform the checks."})}}}]);