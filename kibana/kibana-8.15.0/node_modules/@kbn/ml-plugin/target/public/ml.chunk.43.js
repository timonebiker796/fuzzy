/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[43,93],{163:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var a=s(2),o=s.n(a),i=s(25),n=s(15),l=s(70),r=s(6);const c=()=>!0===Object(l.useUpgradeCheck)()?Object(r.jsx)(o.a.Fragment,null,Object(r.jsx)(i.EuiCallOut,{title:Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningTitle",defaultMessage:"Index migration in progress"}),color:"warning",iconType:"warning"},Object(r.jsx)("p",null,Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescription",defaultMessage:"Indices related to Machine Learning are currently being upgraded."}),Object(r.jsx)("br",null),Object(r.jsx)(n.FormattedMessage,{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescriptionExtra",defaultMessage:"Some actions will not be available during this time."}))),Object(r.jsx)(i.EuiSpacer,{size:"m"})):null},167:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(116);const o=Object(a.a)((async()=>({default:(await s.e(96).then(s.bind(null,230))).JobSpacesSyncFlyout})))},169:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var a=s(2),o=s.n(a),i=s(25),n=s(15),l=s(10),r=s(167),c=s(70),d=s(6);const u=({mlSavedObjectType:e,onCloseFlyout:t,forceRefresh:s})=>{const{savedObjects:{syncCheck:u}}=Object(l.c)(),b=Object(a.useRef)(!1),[j,m]=Object(a.useState)(!1),[p,h]=Object(a.useState)(!1),[g,f,x]=Object(c.usePermissionCheck)(["canCreateJob","canCreateDataFrameAnalytics","canCreateTrainedModels"]),O=Object(a.useMemo)((()=>g||f||x),[f,g,x]),M=Object(a.useCallback)((async()=>{try{if(!1===b.current)return;const{result:t}=await u(e);!0===b.current&&m(p||t)}catch(e){console.log("Saved object synchronization check could not be performed.")}}),[p,m]);Object(a.useEffect)((function(){return b.current=!0,void 0!==s&&!0!==s||M(),()=>{b.current=!1}}),[s,b,M]);const y=Object(a.useCallback)((()=>{h(!1),void 0===s&&M(),"function"==typeof t&&t()}),[M,t,h]);return Object(a.useEffect)((function(){!1===j&&!0===b.current&&h(!1)}),[j,h]),!1===j?null:Object(d.jsx)(o.a.Fragment,null,Object(d.jsx)(i.EuiCallOut,{title:Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.title",defaultMessage:"ML job and trained model synchronization required"}),color:"warning",iconType:"warning","data-test-subj":"mlJobSyncRequiredWarning"},Object(d.jsx)(o.a.Fragment,null,Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.description",defaultMessage:"Some jobs or trained models are missing or have incomplete saved objects. "}),O?Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.link",defaultMessage:" {link}",values:{link:Object(d.jsx)(i.EuiLink,{onClick:h.bind(null,!0)},Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.linkToManagement.link",defaultMessage:"Synchronize your jobs and trained models."}))}}):Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsList.missingSavedObjectWarning.noPermission",defaultMessage:"An Administrator can synchronize the jobs and trained models in Stack Management."}),p&&Object(d.jsx)(r.a,{onClose:y}))),Object(d.jsx)(i.EuiSpacer,{size:"m"}))}},182:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(25),o=s(15),i=s(2),n=s.n(i),l=s(6);const r=({jobsCount:e,action:t,message:s})=>Object(l.jsx)(n.a.Fragment,null,Object(l.jsx)(a.EuiSpacer,{size:"s"}),Object(l.jsx)(a.EuiCallOut,{color:"warning"},null!=s?s:Object(l.jsx)(o.FormattedMessage,{id:"xpack.ml.managedJobsWarningCallout",defaultMessage:"{jobsCount, plural, one {This job} other {At least one of these jobs}} is preconfigured by Elastic; {action} {jobsCount, plural, one {it} other {them}} might impact other parts of the product.",values:{jobsCount:e,action:t}})))},188:function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return u}));var a=s(2),o=s.n(a),i=s(25),n=s(15),l=s(28),r=s(122),c=s(6);const d=({jobCount:e})=>{const{showNodeInfo:t}=Object(r.d)();return!1===t||!1===Object(l.b)()||0===e?null:Object(c.jsx)(o.a.Fragment,null,Object(c.jsx)(i.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"{jobCount, plural, one {# job} other {# jobs}} will start after autoscaling has increased ML capacity. This may take several minutes.",values:{jobCount:e}}))),Object(c.jsx)(i.EuiSpacer,{size:"m"}))},u=()=>{const{showNodeInfo:e}=Object(r.d)();return!1===Object(l.b)()?null:e?Object(c.jsx)(o.a.Fragment,null,Object(c.jsx)(i.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},Object(c.jsx)("div",null,Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.newJobAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There are currently no nodes that can run the job, therefore it will remain in OPENING state until autoscaling increases ML capacity. This may take several minutes."}))),Object(c.jsx)(i.EuiSpacer,{size:"m"})):Object(c.jsx)(o.a.Fragment,null,Object(c.jsx)(i.EuiCallOut,{title:Object(c.jsx)(n.FormattedMessage,{id:"xpack.ml.jobsAwaitingNodeWarning.serverless.title",defaultMessage:"Machine learning is starting..."}),color:"primary",iconType:"iInCircle"}),Object(c.jsx)(i.EuiSpacer,{size:"m"}))};s(44)},190:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return r})),s(2);var a=s(104),o=s(90),i=s(92),n=s(6);const{expandLiteralStrings:l}=i.XJson,r={TEXT:"text",JSON:"json",XJSON:a.XJsonLang.ID},c=({value:e,height:t="500px",width:s="100%",mode:i=r.JSON,readOnly:c=!1,onChange:d=(()=>{}),"data-test-subj":u,schema:b})=>{if(i===r.XJSON)try{e=l(e)}catch(e){console.error(e)}return Object(n.jsx)(o.CodeEditor,{languageId:i,options:{readOnly:c},value:e,width:s,height:t,onChange:d,"data-test-subj":u,editorDidMount:e=>{var t;const s=null===(t=e.getModel())||void 0===t?void 0:t.uri.toString();var o;b&&a.monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,enableSchemaRequest:!1,schemaValidation:"error",schemas:[...null!==(o=a.monaco.languages.json.jsonDefaults.diagnosticsOptions.schemas)&&void 0!==o?o:[],{uri:s,fileMatch:[s],schema:b}]})}})}},197:function(e,t,s){"use strict";s.d(t,"d",(function(){return a})),s.d(t,"c",(function(){return o})),s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return n}));let a=function(e){return e.ANNOTATION="annotation",e.COMMENT="comment",e}({});const o=1e3,i="user",n="delayed_data"},198:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return l}));var a=s(5),o=s(42),i=s(18);function n(e,t,s,n){const r=Object(i.d)();if(e.contains("job_id_empty"))t.jobId.valid=!1;else if(e.contains("job_id_invalid")){t.jobId.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.jobId.message=e}else if(e.contains("job_id_invalid_max_length"))t.jobId.valid=!1,t.jobId.message=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:o.b}});else if(e.contains("job_id_already_exists")){t.jobId.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});t.jobId.message=e}if(e.contains("job_group_id_invalid")){t.groupIds.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"});t.groupIds.message=e}else if(e.contains("job_group_id_invalid_max_length"))t.groupIds.valid=!1,t.groupIds.message=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:o.b}});else if(e.contains("job_group_id_already_exists")){t.groupIds.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});t.groupIds.message=e}if(e.contains("model_memory_limit_units_invalid")){t.modelMemoryLimit.valid=!1;const e=`${o.a.slice(0,o.a.length-1).join(", ")} or ${[...o.a].pop()}`,s=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:e}});t.modelMemoryLimit.message=s}if(e.contains("model_memory_limit_invalid")){t.modelMemoryLimit.valid=!1;const e=(r.max_model_memory_limit||"").toUpperCase(),s=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:e}});t.modelMemoryLimit.message=s}if(e.contains("detectors_duplicates")){t.duplicateDetectors.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});t.duplicateDetectors.message=e}if(e.contains("categorizer_detector_missing_per_partition_field")){t.categorizerMissingPerPartition.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});t.categorizerMissingPerPartition.message=e}if(e.contains("categorizer_varying_per_partition_fields")){t.categorizerVaryingPerPartitionField.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});t.categorizerVaryingPerPartitionField.message=e}if(e.contains("bucket_span_empty")){t.bucketSpan.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});t.bucketSpan.message=e}else e.contains("bucket_span_invalid")&&(t.bucketSpan.valid=!1,t.bucketSpan.message=l(s.analysis_config.bucket_span));if(e.contains("query_empty")){t.query.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});t.query.message=e}else if(e.contains("query_invalid")){t.query.valid=!1;const e=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});t.query.message=e}e.contains("query_delay_invalid")&&(t.queryDelay.valid=!1,t.queryDelay.message=l(n.query_delay)),e.contains("frequency_invalid")&&(t.frequency.valid=!1,t.frequency.message=l(n.frequency)),e.contains("missing_summary_count_field_name")&&(t.summaryCountField.valid=!1,t.summaryCountField.message=a.i18n.translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."}))}function l(e){return a.i18n.translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:e,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},209:function(e,t,s){"use strict";var a=s(163);s.d(t,"a",(function(){return a.a}))},227:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(6),o=(s(2),s(25));const i=({stat:e})=>{const{euiTheme:t}=Object(o.useEuiTheme)();return Object(a.jsx)("span",{css:Object(a.css)({marginRight:t.size.s},"","")},Object(a.jsx)("span",null,e.label),":"," ",Object(a.jsx)("strong",null,Object(a.jsx)("span",{"data-test-subj":`mlStatsBarStat ${e.label.toLowerCase()} value`},e.value)))},n=({stats:e,dataTestSub:t})=>{const{euiTheme:s}=Object(o.useEuiTheme)(),n=Object.keys(e).map((t=>e[t]));return Object(a.jsx)("div",{css:Object(a.css)({padding:s.size.m,backgroundColor:s.colors.lightestShade},"",""),"data-test-subj":t},n.filter((e=>e.show)).map((e=>Object(a.jsx)(i,{key:e.label,stat:e}))))}},235:function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return r}));var a=s(2),o=s(8),i=s(7),n=s(10);function l(e){return{getForecastsSummary:function(t,s,a,o){return new Promise(((i,n)=>{const l={success:!0,forecasts:[]},r=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:t.job_id}},{range:{timestamp:{gte:a,format:"epoch_millis"}}}];s&&r.push(s),e.results.anomalySearch({size:o,body:{query:{bool:{filter:r}},sort:[{forecast_create_timestamp:{order:"desc"}}]}},[t.job_id]).then((e=>{e.hits.total.value>0&&(l.forecasts=e.hits.hits.map((e=>e._source))),i(l)})).catch((e=>{n(e)}))}))},getForecastDateRange:function(t,s){return new Promise(((a,i)=>{const n={success:!0,earliest:null,latest:null},l=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:t.job_id}},{term:{forecast_id:s}}];e.results.anomalySearch({size:0,body:{query:{bool:{filter:l}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}},[t.job_id]).then((e=>{n.earliest=Object(o.get)(e,"aggregations.earliest.value",null),n.latest=Object(o.get)(e,"aggregations.latest.value",null),null===n.earliest||null===n.latest?i(e):a(n)})).catch((e=>{i(e)}))}))},getForecastData:function(t,s,a,n,l,r,c,d){const u=[],b=t.analysis_config.detectors[s];if(void 0!==b.partition_field_name){const e=Object(o.find)(n,{fieldName:b.partition_field_name});void 0!==e&&u.push({fieldName:"partition_field_name",fieldValue:e.fieldName},{fieldName:"partition_field_value",fieldValue:e.fieldValue})}if(void 0!==b.over_field_name){const e=Object(o.find)(n,{fieldName:b.over_field_name});void 0!==e&&u.push({fieldName:"over_field_name",fieldValue:e.fieldName},{fieldName:"over_field_value",fieldValue:e.fieldValue})}if(void 0!==b.by_field_name){const e=Object(o.find)(n,{fieldName:b.by_field_name});void 0!==e&&u.push({fieldName:"by_field_name",fieldValue:e.fieldName},{fieldName:"by_field_value",fieldValue:e.fieldValue})}const j={success:!0,results:{}},m=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:t.job_id}},{term:{forecast_id:a}},{term:{detector_index:s}},{range:{timestamp:{gte:l,lte:r,format:"epoch_millis"}}}];Object(o.each)(u,(e=>{m.push({term:{[e.fieldName]:e.fieldValue}})}));const p=void 0===d?{avg:"avg",max:"max",min:"min"}:{avg:d.avg,max:d.max,min:d.min};return e.results.anomalySearch$({size:0,body:{query:{bool:{filter:m}},aggs:{times:{date_histogram:{field:"timestamp",fixed_interval:`${c}ms`,min_doc_count:1},aggs:{prediction:{[p.avg]:{field:"forecast_prediction"}},forecastUpper:{[p.max]:{field:"forecast_upper"}},forecastLower:{[p.min]:{field:"forecast_lower"}}}}}}},[t.job_id]).pipe(Object(i.map)((e=>{const t=Object(o.get)(e,["aggregations","times","buckets"],[]);return Object(o.each)(t,(e=>{const t=e.key;j.results[t]={prediction:Object(o.get)(e,["prediction","value"]),forecastUpper:Object(o.get)(e,["forecastUpper","value"]),forecastLower:Object(o.get)(e,["forecastLower","value"])}})),j})))},runForecast:function(t,s){return console.log("ML forecast service run forecast with duration:",s),new Promise(((a,o)=>{e.forecast({jobId:t,duration:s}).then((e=>{a(e)})).catch((e=>{o(e)}))}))},getForecastRequestStats:function(t,s){return new Promise(((a,o)=>{const i={success:!0,stats:{}},n=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:!0}},{term:{job_id:t.job_id}},{term:{forecast_id:s}}];e.results.anomalySearch({size:1,body:{query:{bool:{filter:n}}}},[t.job_id]).then((e=>{e.hits.total.value>0&&(i.stats=e.hits.hits[0]._source),a(i)})).catch((e=>{o(e)}))}))}}}function r(){const{services:{mlServices:{mlApiServices:e}}}=Object(n.d)();return Object(a.useMemo)((()=>l(e)),[e])}},243:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s(2);var a=s(25),o=s(150),i=s(6);const n=({name:e})=>Object(i.jsx)(a.EuiBadge,{key:`${e}-id`,"data-test-subj":"mlJobGroup",color:Object(o.a)(e)},e)},245:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var a=s(2),o=s.n(a),i=s(15),n=s(5),l=s(25),r=s(172),c=s.n(r),d=s(10),u=s(71),b=s(182),j=s(6);const m=n.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.job",{defaultMessage:"Remove job from current space"}),p=n.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.shouldUnTagLabel.model",{defaultMessage:"Remove model from current space"}),h=({canDeleteCallback:e,onCloseCallback:t,refreshJobsCallback:s,mlSavedObjectType:r,ids:h,setDidUntag:g,hasManagedJob:f})=>{const[x,O]=Object(a.useState)(),[M,y]=Object(a.useState)(),[S,C]=Object(a.useState)(!1),[v,_]=Object(a.useState)(!1),[k,F]=Object(a.useState)(!1),[D,w]=Object(a.useState)(),[E,J]=Object(a.useState)(!1),{savedObjects:{canDeleteMLSpaceAwareItems:L,removeItemFromCurrentSpace:T}}=Object(d.c)(),{displayErrorToast:I,displaySuccessToast:A}=Object(u.useToastNotificationService)();c()((()=>J(!0)),1e3),Object(a.useEffect)((()=>{F(!0),L(r,h).then((t=>{const s=function(e){const t=Object.keys(e),{canDelete:s,canRemoveFromSpace:a}=e[t[0]];let o=!0;return t.length>1&&(o=t.every((t=>e[t].canDelete===s&&e[t].canRemoveFromSpace===a))),{canDelete:s,canRemoveFromSpace:a,canTakeAnyAction:o}}(t),{canDelete:a,canRemoveFromSpace:c,canTakeAnyAction:d}=s;if(d&&a&&!c)return void e();w(s);const{buttonText:u,modalText:m}=function(e,t,s,a){const{canDelete:r,canRemoveFromSpace:c,canTakeAnyAction:d}=s;if(!1===d)return{buttonText:Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextNoAction",defaultMessage:"Close"}),modalText:Object(j.jsx)(l.EuiText,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction",defaultMessage:"{ids} have different space permissions. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.model",defaultMessage:"When you delete multiple models, they must have the same permissions. Deselect the models and try deleting each model individually."}):Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextNoAction.job",defaultMessage:"When you delete multiple jobs, they must have the same permissions. Deselect the jobs and try deleting each job individually."}))};const u={buttonText:Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextClose",defaultMessage:"Close"}),modalText:Object(j.jsx)(l.EuiText,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose",defaultMessage:"{ids} cannot be deleted and cannot be removed from the current space. ",values:{ids:e.join(", ")}}),"trained-model"===t?Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.model",defaultMessage:"This model is assigned to the * space and you do not have access to all spaces."}):Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextClose.job",defaultMessage:"This job is assigned to the * space and you do not have access to all spaces."}))};return r?{buttonText:"trained-model"===t?Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.model",defaultMessage:"Continue to delete {length, plural, one {# model} other {# models}}",values:{length:e.length}}):Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanDelete.job",defaultMessage:"Continue to delete {length, plural, one {# job} other {# jobs}}",values:{length:e.length}}),modalText:Object(j.jsx)(o.a.Fragment,null,a?Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)(b.a,{jobsCount:e.length,action:n.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeOrDeleteAction",{defaultMessage:"removing or deleting"})}),Object(j.jsx)(l.EuiSpacer,{size:"s"})):null,Object(j.jsx)(l.EuiText,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanDelete",defaultMessage:"{ids} can be deleted.",values:{ids:e.join(", ")}})))}:c?{buttonText:Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.buttonTextCanUnTagConfirm",defaultMessage:"Remove from current space"}),modalText:Object(j.jsx)(o.a.Fragment,null,a?Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)(b.a,{jobsCount:e.length,action:n.i18n.translate("xpack.ml.jobsList.deleteJobCheckModal.removeAction",{defaultMessage:"removing"})}),Object(j.jsx)(l.EuiSpacer,{size:"s"})):null,Object(j.jsx)(l.EuiText,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTextCanUnTag",defaultMessage:"{ids} cannot be deleted but can be removed from the current space.",values:{ids:e.join(", ")}})))}:u}(h,r,s,f);O(u),y(m),F(!1)})),"function"==typeof g&&g(!1)}),[f]);const R=async()=>{_(!0);const e=await T(r,h);_(!1),"function"==typeof g&&g(!0),Object.entries(e).forEach((([e,{success:t,error:s}])=>{if(!1===t){const t=n.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagErrorTitle",{defaultMessage:"Error updating {id}",values:{id:e}});I(s,t)}else{C(!0);const t=n.i18n.translate("xpack.ml.deleteSpaceAwareItemCheckModal.unTagSuccessTitle",{defaultMessage:"Successfully updated {id}",values:{id:e}});A(t)}})),t(),"function"==typeof s&&s()};return!1===E?null:Object(j.jsx)(l.EuiModal,{onClose:t,"data-test-subj":"mlDeleteSpaceAwareItemCheckModalOverlay"},Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)(l.EuiModalHeader,null,Object(j.jsx)(l.EuiModalHeaderTitle,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalTitle",defaultMessage:"Checking space permissions"}))),!1===k?Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)(l.EuiModalBody,null,M),Object(j.jsx)(l.EuiModalFooter,null,Object(j.jsx)(l.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(j.jsx)(l.EuiFlexItem,{grow:!1},!S&&(null==D?void 0:D.canTakeAnyAction)&&(null==D?void 0:D.canRemoveFromSpace)&&(null==D?void 0:D.canDelete)&&Object(j.jsx)(l.EuiButtonEmpty,{isLoading:v,color:"primary",size:"s",onClick:R},"trained-model"===r?p:m)),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiButton,{"data-test-subj":"mlDeleteSpaceAwareItemCheckModalOverlayCloseButton",size:"s",onClick:null==D||!D.canTakeAnyAction||null==D||!D.canRemoveFromSpace||null!=D&&D.canDelete?async()=>{null!=D&&D.canTakeAnyAction&&null!=D&&D.canDelete?e():t()}:R,fill:!0},x))))):Object(j.jsx)(l.EuiModalBody,null,Object(j.jsx)(l.EuiText,null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.deleteSpaceAwareItemCheckModal.modalDesc",defaultMessage:"Checking to see whether the {jobCount, plural, one {job} other {jobs}} can be deleted.",values:{jobCount:h.length}})),Object(j.jsx)(l.EuiSpacer,{size:"s"}))))}},260:function(e,t,s){e.exports=s.p+"7a4082435b3e1246960afd2e97c6c091.png"},262:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(7);const o={rowMouseenter$:new a.Subject,rowMouseleave$:new a.Subject}},275:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return b}));var a=s(120),o=s.n(a),i=(s(2),s(293)),n=s(10),l=s(312),r=s(6);const c=e=>{const{services:{data:{query:{timefilter:{timefilter:t}}}}}=Object(n.d)(),s=Object(i.a)();return Object(r.jsx)(l.a,o()({},e,{currentTimeFilter:t.getTime(),dashboardService:s}))};var d=s(37),u=s(184);function b(e){return void 0===e||0===e.length||!e.some(((t,s)=>{const a=t.url_name,o=[...e];o.splice(s,1);let i=Object(u.b)(a,o);if(!0===i&&(n=t,Object(d.a)(n,["url_name","url_value","time_range"])&&"string"==typeof n.time_range)){const e=t.time_range;i=Object(u.c)(e)}var n;return!i}))}},276:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var a=s(2),o=s.n(a),i=s(15),n=s(25),l=s(260),r=s.n(l),c=s(1),d=s(10),u=s(70),b=s(28),j=s(6);const m=()=>{const e=!Object(u.usePermissionCheck)("canCreateJob")||!Object(b.c)(),{services:{docLinks:t}}=Object(d.d)(),s=Object(d.g)(),a=Object(d.h)();return Object(j.jsx)(n.EuiEmptyPrompt,{layout:"horizontal",hasBorder:!1,hasShadow:!1,icon:Object(j.jsx)(n.EuiImage,{size:"fullWidth",src:r.a,alt:"anomaly_detection"}),title:Object(j.jsx)("h2",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.createFirstJobMessage",defaultMessage:"Start detecting anomalies"})),body:Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)("p",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.emptyPromptText",defaultMessage:"Anomaly detection enables you to find unusual behavior in time series data. Start automatically spotting the anomalies hiding in your data and resolve issues faster."}))),actions:[Object(j.jsx)(n.EuiButton,{color:"primary",onClick:async()=>{if(!s)return;const e=await s.getUrl({page:c.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX});await a(e,!0)},isDisabled:e,"data-test-subj":"mlCreateNewJobButton"},Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.createJobButtonText",defaultMessage:"Create anomaly detection job"})),Object(j.jsx)(n.EuiLink,{href:t.links.ml.anomalyDetection,target:"_blank",external:!0},Object(j.jsx)(i.FormattedMessage,{id:"xpack.ml.common.readDocumentationLink",defaultMessage:"Read documentation"}))],"data-test-subj":"mlAnomalyDetectionEmptyState"})}},298:function(e,t,s){"use strict";s.d(t,"c",(function(){return d})),s.d(t,"b",(function(){return u})),s.d(t,"a",(function(){return b}));var a=s(2),o=s.n(a),i=s(25),n=s(10),l=s(13),r=s(0),c=s(6);const d=({initialAlert:e,jobIds:t,onCloseFlyout:s,onSave:i})=>{const{services:{triggersActionsUi:d}}=Object(n.d)(),u=Object(a.useMemo)((()=>{if(!d)return;const a={onClose:()=>{s()},onSave:async()=>{i&&i()}};var o;return e?d.getEditRuleFlyout({...a,initialRule:{...e,ruleTypeId:null!==(o=e.ruleTypeId)&&void 0!==o?o:e.alertTypeId}}):d.getAddRuleFlyout({...a,consumer:r.g,canChangeTrigger:!1,ruleTypeId:l.g.ANOMALY_DETECTION,metadata:{},initialValues:{params:{jobSelection:{jobIds:t}}}})}),[d,null==e?void 0:e.id,t]);return Object(c.jsx)(o.a.Fragment,null,u)},u=({setShowFunction:e,unsetShowFunction:t,onSave:s})=>{const[o,i]=Object(a.useState)(!1),[n,l]=Object(a.useState)(),r=Object(a.useCallback)((e=>{l(e),i(!0)}),[]);return Object(a.useEffect)((()=>(e(r),()=>{t()})),[]),o&&n?Object(c.jsx)(d,{jobIds:n,onCloseFlyout:()=>i(!1),onSave:()=>{i(!1),s()}}):null},b=({initialAlert:e,onSave:t})=>{const[s,n]=Object(a.useState)(!1);return Object(c.jsx)(o.a.Fragment,null,Object(c.jsx)(i.EuiButtonEmpty,{size:"xs",onClick:n.bind(null,!s)},e.name),s?Object(c.jsx)(d,{initialAlert:e,onCloseFlyout:n.bind(null,!1),onSave:()=>{n(!1),t()}}):null)}},315:function(e,t,s){"use strict";s.r(t),s.d(t,"AnnotationFlyoutUI",(function(){return annotation_flyout_AnnotationFlyoutUI})),s.d(t,"AnnotationFlyout",(function(){return k}));var a=s(120),o=s.n(a),i=s(4),n=s.n(i),l=s(2),r=s.n(l),c=s(26),d=s.n(c),u=s(8),b=s(25),j=s(5),m=s(15),p=s(349),h=s(197),g=s(153),f=s(415),x=s(6);const O=({annotation:e,detectorDescription:t})=>{const s=[{title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.jobIdTitle",{defaultMessage:"Job ID"}),description:e.job_id},{title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.startTitle",{defaultMessage:"Start"}),description:Object(f.c)(e.timestamp)}];var a,o,i,n,l;return void 0!==e.end_timestamp&&s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.endTitle",{defaultMessage:"End"}),description:Object(f.c)(e.end_timestamp)}),void 0!==e.create_time&&void 0!==e.modified_time&&(s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdTitle",{defaultMessage:"Created"}),description:Object(f.c)(e.create_time)}),s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdByTitle",{defaultMessage:"Created by"}),description:null!==(a=e.create_username)&&void 0!==a?a:""}),s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.lastModifiedTitle",{defaultMessage:"Last modified"}),description:Object(f.c)(e.modified_time)}),s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.modifiedByTitle",{defaultMessage:"Modified by"}),description:null!==(o=e.modified_username)&&void 0!==o?o:""})),void 0!==t&&s.push({title:j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.detectorTitle",{defaultMessage:"Detector"}),description:t}),void 0!==e.partition_field_name&&s.push({title:e.partition_field_name,description:null!==(i=e.partition_field_value)&&void 0!==i?i:""}),void 0!==e.over_field_name&&s.push({title:e.over_field_name,description:null!==(n=e.over_field_value)&&void 0!==n?n:""}),void 0!==e.by_field_name&&s.push({title:e.by_field_name,description:null!==(l=e.by_field_value)&&void 0!==l?l:""}),Object(x.jsx)(b.EuiDescriptionList,{"data-test-subj":"mlAnnotationDescriptionList",className:"ml-annotation-description-list",type:"column",columnWidths:[3,7],listItems:s})},M=({cancelAction:e,deleteAction:t,isVisible:s})=>Object(x.jsx)(l.Fragment,null,!0===s&&Object(x.jsx)(b.EuiConfirmModal,{title:j.i18n.translate("xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteAnnotationTitle",{defaultMessage:"Delete this annotation?"}),onCancel:e,onConfirm:t,cancelButtonText:j.i18n.translate("xpack.ml.timeSeriesExplorer.deleteAnnotationModal.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:j.i18n.translate("xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteButtonLabel",{defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:b.EUI_MODAL_CONFIRM_BUTTON,className:"eui-textBreakWord","data-test-subj":"mlAnnotationFlyoutConfirmDeleteModal"}));var y=s(11),S=s(17);function C(e){return`${e}_name`}function v(e){return`${e}_value`}var _=s(170);class annotation_flyout_AnnotationFlyoutUI extends l.Component{constructor(...e){super(...e),n()(this,"deletionInProgress",!1),n()(this,"state",{isDeleteModalVisible:!1,applyAnnotationToSeries:!0,annotationState:null}),n()(this,"annotationSub",null),n()(this,"annotationTextChangeHandler",(e=>{if(null===this.state.annotationState)return;const{annotationUpdatesService:t}=this.props;t.setValue({...this.state.annotationState,annotation:e.target.value})})),n()(this,"cancelEditingHandler",(()=>{const{annotationUpdatesService:e}=this.props;e.setValue(null)})),n()(this,"deleteConfirmHandler",(()=>{this.setState({isDeleteModalVisible:!0})})),n()(this,"deleteHandler",(async()=>{if(this.deletionInProgress)return;const{annotationState:e}=this.state,t=Object(S.f)();if(null===e||void 0===e._id)return;this.deletionInProgress=!0;try{await y.ml.annotations.deleteAnnotation(e._id),t.addSuccess(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.deletedAnnotationNotificationMessage",{defaultMessage:"Deleted annotation for job with ID {jobId}.",values:{jobId:e.job_id}}))}catch(s){t.addDanger(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithDeletingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred deleting the annotation for job with ID {jobId}: {error}",values:{jobId:e.job_id,error:JSON.stringify(s)}}))}this.closeDeleteModal(),this.deletionInProgress=!1;const{annotationUpdatesService:s}=this.props;s.setValue(null),Object(g.c)()})),n()(this,"closeDeleteModal",(()=>{this.setState({isDeleteModalVisible:!1})})),n()(this,"validateAnnotationText",(()=>{const{annotationState:e}=this.state,t=[];if(null===e)return t;0===e.annotation.trim().length&&t.push(j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.noAnnotationTextError",{defaultMessage:"Enter annotation text"}));const s=e.annotation.length;if(s>h.c){const e=s-h.c;t.push(j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.maxLengthError",{defaultMessage:"{charsOver, number} {charsOver, plural, one {character} other {characters}} above maximum length of {maxChars}",values:{maxChars:h.c,charsOver:e}}))}return t})),n()(this,"saveOrUpdateAnnotation",(()=>{var e,t;const{annotationState:s}=this.state,{chartDetails:a,detectorIndex:o,annotationUpdatesService:i}=this.props;if(null===s)return;const n=Object(u.cloneDeep)(s);this.state.applyAnnotationToSeries&&null!=a&&null!==(e=a.entityData)&&void 0!==e&&e.entities&&(a.entityData.entities.forEach((e=>{const{fieldName:t,fieldValue:s}=e,a=e.fieldType;n[C(a)]=t,n[v(a)]=s})),n.detector_index=o),this.state.applyAnnotationToSeries||(delete n.detector_index,p.c.forEach((e=>{delete n[C(e)],delete n[v(e)]}))),n.event=null!==(t=n.event)&&void 0!==t?t:h.b,i.setValue(null),y.ml.annotations.indexAnnotation(n).then((()=>{Object(g.c)();const e=Object(S.f)();void 0===n._id?e.addSuccess(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.addedAnnotationNotificationMessage",{defaultMessage:"Added an annotation for job with ID {jobId}.",values:{jobId:n.job_id}})):e.addSuccess(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.updatedAnnotationNotificationMessage",{defaultMessage:"Updated annotation for job with ID {jobId}.",values:{jobId:n.job_id}}))})).catch((e=>{const t=Object(S.f)();void 0===n._id?t.addDanger(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithCreatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred creating the annotation for job with ID {jobId}: {error}",values:{jobId:n.job_id,error:JSON.stringify(e)}})):t.addDanger(j.i18n.translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithUpdatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred updating the annotation for job with ID {jobId}: {error}",values:{jobId:n.job_id,error:JSON.stringify(e)}}))}))}))}componentDidMount(){const{annotationUpdatesService:e}=this.props;this.annotationSub=e.update$().subscribe((e=>{this.setState({annotationState:e})}))}componentWillUnmount(){this.annotationSub.unsubscribe()}render(){const{detectors:e,detectorIndex:t}=this.props,{annotationState:s,isDeleteModalVisible:a}=this.state;if(!s)return null;const o=void 0!==s._id,i=this.validateAnnotationText(),n=i.length>0;let l=null;!1===n&&s.annotation.length>.95*h.c&&(l=j.i18n.translate("xpack.ml.timeSeriesExplorer.annotationFlyout.approachingMaxLengthWarning",{defaultMessage:"{charsRemaining, number} {charsRemaining, plural, one {character} other {characters}} remaining",values:{charsRemaining:h.c-s.annotation.length}}));const c=e?e.find((e=>e.index===t)):void 0,d=c&&"detector_description"in c?c.detector_description:"";return Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)(b.EuiFlyoutBody,null,Object(x.jsx)(O,{annotation:s,detectorDescription:d}),Object(x.jsx)(b.EuiSpacer,{size:"m"}),Object(x.jsx)(b.EuiFormRow,{label:Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.annotationTextLabel",defaultMessage:"Annotation text"}),fullWidth:!0,helpText:l,isInvalid:n,error:i},Object(x.jsx)(b.EuiTextArea,{fullWidth:!0,isInvalid:n,onChange:this.annotationTextChangeHandler,placeholder:"...",value:s.annotation,"data-test-subj":"mlAnnotationsFlyoutTextInput"})),Object(x.jsx)(b.EuiFormRow,null,Object(x.jsx)(b.EuiCheckbox,{id:"xpack.ml.annotationFlyout.applyToPartition",label:Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.annotationFlyout.applyToPartitionTextLabel",defaultMessage:"Apply annotation to this series"}),checked:this.state.applyAnnotationToSeries,onChange:()=>this.setState({applyAnnotationToSeries:!this.state.applyAnnotationToSeries}),"data-test-subj":"mlAnnotationsFlyoutApplyToSeriesButton"}))),Object(x.jsx)(b.EuiFlyoutFooter,null,Object(x.jsx)(b.EuiFlexGroup,null,Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{onClick:this.cancelEditingHandler,flush:"left","data-test-subj":"mlAnnotationsFlyoutCancelButton"},Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1,style:{marginLeft:"auto"}},o&&Object(x.jsx)(b.EuiButtonEmpty,{color:"danger",onClick:this.deleteConfirmHandler,"data-test-subj":"mlAnnotationsFlyoutDeleteButton"},Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.deleteButtonLabel",defaultMessage:"Delete"}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButton,{fill:!0,isDisabled:!0===n,onClick:this.saveOrUpdateAnnotation,"data-test-subj":"annotationFlyoutUpdateOrCreateButton"},o?Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.updateButtonLabel",defaultMessage:"Update"}):Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.createButtonLabel",defaultMessage:"Create"}))))),Object(x.jsx)(M,{cancelAction:this.closeDeleteModal,deleteAction:this.deleteHandler,isVisible:a}))}}const k=e=>{const t=Object(l.useContext)(_.a),s=d()(t.isAnnotationInitialized$()),a=Object(l.useCallback)((()=>{t.setValue(null)}),[]);if(null==s)return null;const i=void 0!==s._id;return Object(x.jsx)(b.EuiFlyout,{onClose:a,size:"m","aria-labelledby":"Add annotation","data-test-subj":"mlAnnotationFlyout",className:"mlAnnotationFlyout"},Object(x.jsx)(b.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(b.EuiTitle,{size:"s","data-test-subj":"mlAnnotationFlyoutTitle"},Object(x.jsx)("h2",{id:"mlAnnotationFlyoutTitle"},i?Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.editAnnotationTitle",defaultMessage:"Edit annotation"}):Object(x.jsx)(m.FormattedMessage,{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.addAnnotationTitle",defaultMessage:"Add annotation"})))),Object(x.jsx)(annotation_flyout_AnnotationFlyoutUI,o()({},e,{annotationUpdatesService:t})))}},349:function(e,t,s){"use strict";s.d(t,"d",(function(){return i})),s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return l})),s.d(t,"b",(function(){return r}));var a=s(140),o=s(175);const i=[{stop:a.a.LOW,color:o.a.WARNING},{stop:a.a.MINOR,color:o.a.MINOR},{stop:a.a.MAJOR,color:o.a.MAJOR},{stop:a.a.CRITICAL,color:o.a.CRITICAL}],n={BUCKET:"bucket",RECORD:"record",INFLUENCER:"influencer"},l=["partition_field","over_field","by_field"],r="job_id"},350:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var a=s(2),o=s(25),i=s(10),n=s(1),l=s(243),r=s(6);function c(e){return void 0!==e.groupId}var d={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const u=e=>{const t=Object(i.g)(),[s,u]=Object(a.useState)("");return Object(a.useEffect)((()=>{let s=!1;return(async()=>{const a={};if(c(e)?a.groupIds=[e.groupId]:a.jobId=e.id,t){const e=await t.getUrl({page:n.b.ANOMALY_DETECTION_JOBS_MANAGE,pageState:a});s||u(e)}})(),()=>{s=!0}}),[e,t]),c(e)?Object(r.jsx)(o.EuiLink,{key:e.groupId,href:s},Object(r.jsx)(l.a,{name:e.groupId})):Object(r.jsx)(o.EuiLink,{key:e.id,href:s,css:d,title:e.id},e.id)}},585:function(e,t,s){"use strict";function a(e,t=2){if(void 0===e)return"";if(e%1==0)return e;if(Math.abs(e)<Math.pow(10,-t))return Number.parseFloat(String(e)).toExponential(2);const s=Math.pow(10,t);return Math.round(e*s)/s}s.d(t,"a",(function(){return a}))},587:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(588);case"v8light":return s(590)}},588:function(e,t,s){var a=s(126),o=s(589);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},589:function(e,t,s){(t=s(127)(!1)).push([e.i,".time-range-selector .time-range-section-title{font-weight:700;margin-bottom:8px}.time-range-selector .time-range-section{border-right:1px solid #343741;flex:50%;padding:0 8px}.time-range-selector .tab-stack{list-style:none;margin-bottom:0;padding-left:0}.time-range-selector .tab-stack>li{display:block;float:none;margin-bottom:4px;position:relative}.time-range-selector .tab-stack>li>a{border-radius:4px;display:block;padding:8px 16px;position:relative}.time-range-selector .tab-stack>li>a:hover{background-color:#25262e}.time-range-selector .tab-stack>li .body{display:none}.time-range-selector .tab-stack>li.active>a{background-color:#36a2ef;color:#1d1e24}.time-range-selector .tab-stack>li.active .body{display:block}.time-range-selector .tab-stack>li.has-body.active>a{border-radius:6px 6px 0 0}.time-range-selector .tab-stack>li.has-body.active .react-datepicker{border-radius:0 0 6px 6px;border-top:none}.time-range-selector .time-range-section:last-child{border-right:none}",""]),e.exports=t},590:function(e,t,s){var a=s(126),o=s(591);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},591:function(e,t,s){(t=s(127)(!1)).push([e.i,".time-range-selector .time-range-section-title{font-weight:700;margin-bottom:8px}.time-range-selector .time-range-section{border-right:1px solid #d3dae6;flex:50%;padding:0 8px}.time-range-selector .tab-stack{list-style:none;margin-bottom:0;padding-left:0}.time-range-selector .tab-stack>li{display:block;float:none;margin-bottom:4px;position:relative}.time-range-selector .tab-stack>li>a{border-radius:4px;display:block;padding:8px 16px;position:relative}.time-range-selector .tab-stack>li>a:hover{background-color:#f5f7fa}.time-range-selector .tab-stack>li .body{display:none}.time-range-selector .tab-stack>li.active>a{background-color:#07c;color:#fff}.time-range-selector .tab-stack>li.active .body{display:block}.time-range-selector .tab-stack>li.has-body.active>a{border-radius:6px 6px 0 0}.time-range-selector .tab-stack>li.has-body.active .react-datepicker{border-radius:0 0 6px 6px;border-top:none}.time-range-selector .time-range-section:last-child{border-right:none}",""]),e.exports=t},860:function(e,t,s){"use strict";s.r(t),s.d(t,"JobsPage",(function(){return mt}));var a=s(2),o=s.n(a),i=s(15),n=s(68),l=s(4),r=s.n(l),c=s(25),d=s(11),u=s(196),b=s(8),j=s(39),m=s.n(j),p=s(248),h=s(135),g=s(325),f=s(70),x=s(23),O=s(434),M=s(5),y=s(37);const S=e=>Object(y.a)(e,["customSettings"])&&!0===e.customSettings.managed||Object(y.a)(e,["custom_settings"])&&!0===e.custom_settings.managed;function C(e,t,s,a,o,i,n,l,r){const c=Object(f.checkPermission)("canCreateJob")&&Object(x.e)(),d=Object(f.checkPermission)("canUpdateJob"),b=Object(f.checkPermission)("canDeleteJob"),j=Object(f.checkPermission)("canGetDatafeeds"),m=Object(f.checkPermission)("canUpdateDatafeed"),p=Object(f.checkPermission)("canStartStopDatafeed")&&Object(x.e)(),h=Object(f.checkPermission)("canCloseJob")&&Object(x.e)(),g=Object(f.checkPermission)("canResetJob")&&Object(x.e)(),y=Object(f.checkPermission)("canCreateMlAlerts");return[{name:M.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedLabel",{defaultMessage:"Start datafeed"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.startDatafeedDescription",{defaultMessage:"Start datafeed"}),icon:"play",enabled:e=>!1===v(e)&&p,available:e=>Object(u.i)([e]),onClick:e=>{o([e]),_()},"data-test-subj":"mlActionButtonStartDatafeed"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedLabel",{defaultMessage:"Stop datafeed"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.stopDatafeedDescription",{defaultMessage:"Stop datafeed"}),icon:"stop",enabled:e=>!1===v(e)&&p,available:e=>Object(u.j)([e]),onClick:e=>{S(e)?n([e]):Object(u.m)([e],l),_(!0)},"data-test-subj":"mlActionButtonStopDatafeed"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert rule"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert rule"}),icon:"bell",enabled:e=>!1===v(e),available:()=>y,onClick:e=>{r([e.id]),_(!0)},"data-test-subj":"mlActionButtonCreateAlert"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.closeJobLabel",{defaultMessage:"Close job"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.closeJobDescription",{defaultMessage:"Close job"}),icon:"cross",enabled:e=>!1===v(e)&&h,available:e=>Object(u.g)([e]),onClick:e=>{S(e)?i([e]):Object(u.c)([e],l),_(!0)},"data-test-subj":"mlActionButtonCloseJob"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.resetJobLabel",{defaultMessage:"Reset job"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.resetJobDescription",{defaultMessage:"Reset job"}),icon:"refresh",enabled:e=>function(e){return void 0===e.blocked||e.blocked.reason===O.a.RESET}(e)&&g,available:e=>Object(u.h)([e]),onClick:e=>{a([e]),_(!0)},"data-test-subj":"mlActionButtonResetJob"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobLabel",{defaultMessage:"Clone job"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.cloneJobDescription",{defaultMessage:"Clone job"}),icon:"copy",enabled:e=>!1===v(e)&&c,onClick:e=>{Object(u.b)(e.id),_(!0)},"data-test-subj":"mlActionButtonCloneJob"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.viewDatafeedCountsLabel",{defaultMessage:"View datafeed counts"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.viewDatafeedCountsDescription",{defaultMessage:"View datafeed counts"}),icon:"visAreaStacked",enabled:()=>j,available:()=>j,onClick:e=>{t(e),_()},"data-test-subj":"mlActionButtonViewDatafeedChart"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.editJobLabel",{defaultMessage:"Edit job"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.editJobDescription",{defaultMessage:"Edit job"}),icon:"pencil",enabled:e=>!1===v(e)&&d&&m,onClick:t=>{e(t),_()},"data-test-subj":"mlActionButtonEditJob"},{name:M.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobLabel",{defaultMessage:"Delete job"}),description:M.i18n.translate("xpack.ml.jobsList.managementActions.deleteJobDescription",{defaultMessage:"Delete job"}),icon:"trash",color:"danger",enabled:()=>b,onClick:e=>{s([e]),_()},"data-test-subj":"mlActionButtonDeleteJob"}]}function v(e){return void 0!==e.blocked}function _(e=!1){e?document.querySelector(".euiTable").click():window.setTimeout((()=>{const e=document.querySelector(".euiModalBody");e?e.click():document.querySelector(".euiTable").click()}),500)}var k=s(418),F=s(6);function D({jobs:e}){const t=M.i18n.translate("xpack.ml.jobsList.resultActions.openJobsInSingleMetricViewerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Single Metric Viewer",values:{jobsCount:e.length,jobId:e[0].id}}),s=M.i18n.translate("xpack.ml.jobsList.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Anomaly Explorer",values:{jobsCount:e.length,jobId:e[0].id}}),o=e.length<2,i=1===e.length&&e[0].isSingleMetricViewerJob,n=1===e.length&&e[0].isNotSingleMetricViewerJobMessage,l=void 0!==n?M.i18n.translate("xpack.ml.jobsList.resultActions.singleMetricDisabledMessageText",{defaultMessage:"Disabled because {reason}.",values:{reason:n}}):void 0,r=1===e.length&&void 0!==e[0].blocked,{createLinkWithUserDefaults:d}=Object(k.a)(),u=Object(a.useMemo)((()=>d("timeseriesexplorer",e)),[e]),b=Object(a.useMemo)((()=>d("explorer",e)),[e]);return Object(F.jsx)(c.EuiFlexGroup,{gutterSize:"xs",justifyContent:"flexEnd",alignItems:"center",wrap:!1,direction:"row",responsive:!1},o&&Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiToolTip,{position:"bottom",content:null!=l?l:t},Object(F.jsx)(c.EuiButtonIcon,{href:u,iconType:"visLine","aria-label":t,isDisabled:!1===i||!0===r,"data-test-subj":"mlOpenJobsInSingleMetricViewerButton"}))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiToolTip,{position:"bottom",content:s},Object(F.jsx)(c.EuiButtonIcon,{href:b,iconType:"visTable","aria-label":s,isDisabled:!0===r,"data-test-subj":"mlOpenJobsInAnomalyExplorerButton"}))))}var w=s(243);function E({job:e}){return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)("div",{className:"job-description"},e.description,"  ",e.groups.map((e=>Object(F.jsx)(w.a,{key:e,name:e})))))}var J=s(350);const L=[10,25,50];var T={name:"1d9rzlc",styles:".euiTableRow-isExpandedRow .euiTableCellContent{animation:none;}"};class jobs_list_JobsList extends a.Component{constructor(e){super(e),r()(this,"onTableChange",(({page:e={},sort:t={}})=>{const{index:s,size:a}=e,{field:o,direction:i}=t;this.props.onJobsViewStateUpdate({pageIndex:s,pageSize:a,sortField:o,sortDirection:i})})),r()(this,"toggleRow",(e=>{this.props.toggleRow(e.id)})),this.state={jobsSummaryList:e.jobsSummaryList,itemIdToExpandedRowMap:{}}}static getDerivedStateFromProps(e){return{itemIdToExpandedRowMap:e.itemIdToExpandedRowMap,jobsSummaryList:e.jobsSummaryList}}getJobIdLink(e){return!1===this.props.isMlEnabledInSpace?e:Object(F.jsx)(J.a,{key:e,id:e})}getPageOfJobs(e,t,s,a){let o=this.state.jobsSummaryList;o=Object(b.sortBy)(this.state.jobsSummaryList,(e=>e[s])),o="asc"===a?o:o.reverse();const i=o.length;let n=e*t;return n>=i&&0!==i&&(n=Math.floor((i-1)/t)*t,setTimeout((()=>{this.props.onJobsViewStateUpdate({pageIndex:n/t})}),0)),{pageOfItems:o.slice(n,n+t),totalItemCount:i}}render(){const{loading:e}=this.props,t={selectable:e=>void 0===e.blocked,selectableMessage:(e,t)=>!1===e?M.i18n.translate("xpack.ml.jobsList.cannotSelectRowForJobMessage",{defaultMessage:"Cannot select job ID {jobId}",values:{jobId:t.id}}):M.i18n.translate("xpack.ml.jobsList.selectRowForJobMessage",{defaultMessage:"Select the row for job ID {jobId}",values:{jobId:t.id}}),onSelectionChange:this.props.selectJobChange},s=[{name:Object(F.jsx)(c.EuiScreenReaderOnly,null,Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each job"}))),"data-test-subj":"mlJobListColumnExpand",render:e=>Object(F.jsx)(c.EuiButtonIcon,{onClick:()=>this.toggleRow(e),iconType:this.state.itemIdToExpandedRowMap[e.id]?"arrowDown":"arrowRight","aria-label":this.state.itemIdToExpandedRowMap[e.id]?M.i18n.translate("xpack.ml.jobsList.collapseJobDetailsAriaLabel",{defaultMessage:"Hide details for {itemId}",values:{itemId:e.id}}):M.i18n.translate("xpack.ml.jobsList.expandJobDetailsAriaLabel",{defaultMessage:"Show details for {itemId}",values:{itemId:e.id}}),"data-row-id":e.id,"data-test-subj":"mlJobListRowDetailsToggle"}),width:"3%"},{field:"id","data-test-subj":"mlJobListColumnId",name:M.i18n.translate("xpack.ml.jobsList.idLabel",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,width:"15%",scope:"row",render:(e,t)=>S(t)?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)("span",null,e,"  ",Object(F.jsx)(c.EuiToolTip,{content:M.i18n.translate("xpack.ml.jobsList.managedBadgeTooltip",{defaultMessage:"This job is preconfigured and managed by Elastic; other parts of the product might have might have dependencies on its behavior."})},Object(F.jsx)(c.EuiBadge,{color:"hollow","data-test-subj":"mlJobListRowManagedLabel",size:"xs"},M.i18n.translate("xpack.ml.jobsList.managedBadgeLabel",{defaultMessage:"Managed"}))))):e},{field:"auditMessage","data-test-subj":"mlJobListColumnIcons",name:Object(F.jsx)(c.EuiScreenReaderOnly,null,Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.auditMessageColumn.screenReaderDescription",defaultMessage:"This column displays icons when there are errors or warnings for the job in the past 24 hours"}))),render:e=>Object(F.jsx)(g.a,{message:e,showTooltip:!0})},{field:"alertingRules","data-test-subj":"mlJobListColumnAlertingRuleIndicator",name:Object(F.jsx)(c.EuiScreenReaderOnly,null,Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.alertingRules.screenReaderDescription",defaultMessage:"This column displays icons when there are alert rules associated with a job"}))),width:"30px",render:e=>Array.isArray(e)?Object(F.jsx)(c.EuiToolTip,{position:"bottom",content:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.alertingRules.tooltipContent",defaultMessage:"Job has {rulesCount} associated alert {rulesCount, plural, one { rule} other { rules}}",values:{rulesCount:e.length}})},Object(F.jsx)(c.EuiIcon,{type:"bell"})):Object(F.jsx)("span",null)},{name:M.i18n.translate("xpack.ml.jobsList.descriptionLabel",{defaultMessage:"Description"}),sortable:!0,field:"description","data-test-subj":"mlJobListColumnDescription",render:(e,t)=>Object(F.jsx)(E,{job:t}),textOnly:!0,width:"20%"},{field:"processed_record_count","data-test-subj":"mlJobListColumnRecordCount",name:M.i18n.translate("xpack.ml.jobsList.processedRecordsLabel",{defaultMessage:"Processed records"}),sortable:!0,truncateText:!1,dataType:"number",render:e=>Object(h.i)(e),width:"10%"},{field:"memory_status","data-test-subj":"mlJobListColumnMemoryStatus",name:M.i18n.translate("xpack.ml.jobsList.memoryStatusLabel",{defaultMessage:"Memory status"}),sortable:!0,truncateText:!1,width:"5%"},{field:"jobState","data-test-subj":"mlJobListColumnJobState",name:M.i18n.translate("xpack.ml.jobsList.jobStateLabel",{defaultMessage:"Job state"}),sortable:!0,truncateText:!1,width:"8%"},{field:"datafeedState","data-test-subj":"mlJobListColumnDatafeedState",name:M.i18n.translate("xpack.ml.jobsList.datafeedStateLabel",{defaultMessage:"Datafeed state"}),sortable:!0,truncateText:!1,width:"8%"},{name:M.i18n.translate("xpack.ml.jobsList.latestTimestampLabel",{defaultMessage:"Latest timestamp"}),truncateText:!1,field:"latestTimestampSortValue","data-test-subj":"mlJobListColumnLatestTimestamp",sortable:!0,render:(e,t)=>void 0===t.latestTimestampMs?"":m()(t.latestTimestampMs).format(p.a),textOnly:!0,width:"15%"},{name:Object(F.jsx)(c.EuiScreenReaderOnly,null,Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobActionsColumn.screenReaderDescription",defaultMessage:"This column contains extra actions in a menu that can be performed on each job"}))),render:e=>Object(F.jsx)(D,{jobs:[e]}),width:"64px"},{name:M.i18n.translate("xpack.ml.jobsList.actionsLabel",{defaultMessage:"Actions"}),actions:C(this.props.showEditJobFlyout,this.props.showDatafeedChartFlyout,this.props.showDeleteJobModal,this.props.showResetJobModal,this.props.showStartDatafeedModal,this.props.showCloseJobsConfirmModal,this.props.showStopDatafeedsConfirmModal,this.props.refreshJobs,this.props.showCreateAlertFlyout),width:"5%"}],{pageIndex:a,pageSize:n,sortField:l,sortDirection:r}=this.props.jobsViewState,{pageOfItems:d,totalItemCount:u}=this.getPageOfJobs(a,n,l,r),b={pageIndex:a,pageSize:n,totalItemCount:u,pageSizeOptions:L},j={sort:{field:l,direction:r}},f=this.props.selectedJobsCount?"jobs-selected":"";return Object(F.jsx)(c.EuiBasicTable,{"data-test-subj":e?"mlJobListTable loading":"mlJobListTable loaded",loading:!0===e,noItemsMessage:e?M.i18n.translate("xpack.ml.jobsList.loadingJobsLabel",{defaultMessage:"Loading jobs…"}):M.i18n.translate("xpack.ml.jobsList.noJobsFoundLabel",{defaultMessage:"No jobs found"}),itemId:"id",className:`jobs-list-table ${f}`,items:d,columns:s,pagination:b,onChange:this.onTableChange,selection:t,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,sorting:j,rowProps:e=>({"data-test-subj":`mlJobListRow row-${e.id}`}),css:T})}}jobs_list_JobsList.defaultProps={isMlEnabledInSpace:!0,loading:!1};var I=s(101),A=s.n(I),R=s(585),N=s(415);function B(e){if(!e)return["",""];const[t,s]=e;switch(t){case"finished_time":case"create_time":case"log_time":case"timestamp":case"earliest_record_timestamp":case"latest_record_timestamp":case"last_data_time":case"latest_empty_bucket_timestamp":case"latest_sparse_bucket_timestamp":case"latest_bucket_timestamp":return[t,Object(N.d)(s)];case"established_model_memory":case"input_bytes":case"model_bytes":case"model_bytes_exceeded":case"model_bytes_memory_limit":case"peak_model_bytes":return[t,(a=s,A()(a).format("0.0 b"))];case"processed_record_count":case"processed_field_count":case"input_field_count":case"invalid_date_count":case"missing_field_count":case"out_of_order_timestamp_count":case"empty_bucket_count":case"sparse_bucket_count":case"bucket_count":case"input_record_count":case"total_by_field_count":case"total_over_field_count":case"total_partition_field_count":case"bucket_allocation_failures_count":case"search_count":return[t,Object(h.i)(s)];case"average_search_time_per_bucket_ms":case"exponential_average_search_time_per_hour_ms":case"total_bucket_processing_time_ms":case"minimum_bucket_processing_time_ms":case"maximum_bucket_processing_time_ms":case"average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_per_hour_ms":return[t,"number"==typeof s?Object(R.a)(s,3).toLocaleString():s];case"managed":return[t,s.toString()];default:return[t,s]}var a}function z(e,t,s){return Object.keys(e).filter((a=>s||"object"!=typeof e[a]||t&&Array.isArray(e[a]))).map((t=>{let s=e[t];return Array.isArray(s)?s=s.join(", "):"object"==typeof e[t]&&(s=JSON.stringify(s)),[t,s]}))}var P=s(298),V=s(190);function G({job:e}){const t=JSON.stringify(e,null,2);return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)(V.a,{value:t,readOnly:!0,mode:V.b.XJSON}))}var U=s(122),q=s(123),W=s(10);const H=({job:e})=>{const{jobs:{datafeedPreview:t}}=Object(W.c)(),{showNodeInfo:s}=Object(U.d)(),i=Object(f.usePermissionCheck)("canPreviewDatafeed"),[n,l]=Object(a.useState)(!1),[r,d]=Object(a.useState)("");return Object(a.useEffect)((()=>{l(!0),t(e.datafeed_config.datafeed_id).then((e=>{Array.isArray(e)?0===e.length?d(null):d(JSON.stringify(e.slice(0,q.a),null,2)):d(""),l(!1)}))}),[t,e]),!1===i?Object(F.jsx)(Q,null):n?Object(F.jsx)(c.EuiLoadingSpinner,{size:"xl"}):Object(F.jsx)(o.a.Fragment,null,null===r?Object(F.jsx)($,{showFrozenTierText:!0===s}):Object(F.jsx)(V.a,{value:r,readOnly:!0}))},Q=()=>Object(F.jsx)(c.EuiCallOut,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.noPermissionToViewDatafeedPreviewTitle",defaultMessage:"You do not have permission to view the datafeed preview"}),color:"warning",iconType:"warning"},Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.pleaseContactYourAdministratorLabel",defaultMessage:"Please contact your administrator"}))),$=({showFrozenTierText:e})=>Object(F.jsx)(c.EuiCallOut,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.noResults.title",defaultMessage:"No results"}),color:"warning",iconType:"warning"},e?Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.noResults.text",defaultMessage:"Note: Datafeed preview does not return results from frozen tiers."})):null);var Y=s(404),K=s(395),X=s(315),Z=s(317);const ee=({snapshot:e,job:t,closeFlyout:s})=>{const{toasts:n}=Object(W.i)(),[l,r]=Object(a.useState)(e.description),[u,b]=Object(a.useState)(e.retain),[j,m]=Object(a.useState)(!1),[p,h]=Object(a.useState)(e.snapshot_id===t.model_snapshot_id);Object(a.useEffect)((()=>{h(e.snapshot_id===t.model_snapshot_id)}),[e]);const g=Object(a.useCallback)((async()=>{try{await d.ml.updateModelSnapshot(e.job_id,e.snapshot_id,{description:l,retain:u}),x()}catch(e){n.addError(new Error(e.body.message),{title:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.saveErrorTitle",{defaultMessage:"Model snapshot update failed"})})}}),[u,l,e]),f=Object(a.useCallback)((async()=>{try{await d.ml.deleteModelSnapshot(e.job_id,e.snapshot_id),y(),x()}catch(e){n.addError(new Error(e.body.message),{title:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteErrorTitle",{defaultMessage:"Model snapshot deletion failed"})})}}),[e]);function x(){s(!0)}function O(){s(!1)}function y(){m(!1)}return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiFlyout,{onClose:O,hideCloseButton:!0,size:"m"},Object(F.jsx)(c.EuiFlyoutBody,null,Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)(c.EuiTitle,{size:"s"},Object(F.jsx)("h5",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.title",defaultMessage:"Edit snapshot {ssId}",values:{ssId:e.snapshot_id}}))),p&&Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"m"}),Object(F.jsx)(c.EuiCallOut,{size:"s",title:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.calloutTitle",{defaultMessage:"Current snapshot"})},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.calloutText",defaultMessage:"This is the current snapshot being used by job {jobId} and so cannot be deleted.",values:{jobId:t.job_id}}))),Object(F.jsx)(c.EuiSpacer,{size:"l"}),Object(F.jsx)(c.EuiFormRow,{label:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.descriptionTitle",{defaultMessage:"Description"}),fullWidth:!0},Object(F.jsx)(c.EuiTextArea,{fullWidth:!0,value:l,onChange:e=>r(e.target.value)})),Object(F.jsx)(c.EuiSpacer,{size:"m"}),Object(F.jsx)(c.EuiFormRow,{fullWidth:!0},Object(F.jsx)(c.EuiSwitch,{label:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.retainSwitchLabel",{defaultMessage:"Retain snapshot during automatic snapshot cleanup process"}),checked:u,onChange:e=>b(e.target.checked)})))),Object(F.jsx)(c.EuiFlyoutFooter,null,Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButtonEmpty,{iconType:"cross",onClick:O,flush:"left"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),Object(F.jsx)(c.EuiFlexItem,{grow:!0}),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButtonEmpty,{onClick:function(){m(!0)},color:"danger",disabled:!0===p},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.useDefaultButton",defaultMessage:"Delete"}))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButton,{onClick:g,fill:!0},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.editModelSnapshotFlyout.saveButton",defaultMessage:"Save"})))))),j&&Object(F.jsx)(c.EuiConfirmModal,{title:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteTitle",{defaultMessage:"Delete snapshot?"}),onCancel:y,onConfirm:f,cancelButtonText:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:M.i18n.translate("xpack.ml.editModelSnapshotFlyout.deleteButton",{defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:"confirm"}))};var te=s(30);const se=({combinedJobState:e,hideCloseJobModalVisible:t,forceCloseJob:s})=>Object(F.jsx)(c.EuiConfirmModal,{title:e===ae.OPEN_AND_RUNNING?M.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.title",{defaultMessage:"Stop datafeed and close job?"}):M.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.title",{defaultMessage:"Close job?"}),onCancel:t,onConfirm:s,cancelButtonText:M.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:e===ae.OPEN_AND_RUNNING?M.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.button",{defaultMessage:"Stop and close"}):M.i18n.translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.button",{defaultMessage:"Close"}),defaultFocusedButton:"confirm"},Object(F.jsx)("p",null,e===ae.OPEN_AND_RUNNING&&Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpenAndRunning",defaultMessage:"Job is currently open and running."}),e===ae.OPEN_AND_STOPPED&&Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpen",defaultMessage:"Job is currently open."}),Object(F.jsx)("br",null),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.content",defaultMessage:"Snapshot revert can only happen on jobs which are closed."})));let ae=function(e){return e[e.OPEN_AND_RUNNING=0]="OPEN_AND_RUNNING",e[e.OPEN_AND_STOPPED=1]="OPEN_AND_STOPPED",e[e.CLOSED=2]="CLOSED",e[e.UNKNOWN=3]="UNKNOWN",e}({});const oe=({job:e,refreshJobList:t})=>{const[s,i]=Object(f.usePermissionCheck)(["canCreateJob","canStartStopDatafeed"]),[n,l]=Object(a.useState)([]),[r,u]=Object(a.useState)(!1),[b,j]=Object(a.useState)(null),[m,p]=Object(a.useState)(null),[h,g]=Object(a.useState)(null),[x,O]=Object(a.useState)(null),y=Object(a.useMemo)((()=>void 0===e.blocked),[e]),S=Object(a.useRef)(!0);async function C(){if(!1===S.current)return;const{model_snapshots:t}=await d.ml.getModelSnapshots(e.job_id);l(t),u(!0)}Object(a.useEffect)((()=>(C(),()=>{S.current=!1})),[]);const v=Object(a.useCallback)((async t=>{const s=await ie(e.job_id);s!==ae.UNKNOWN?(O(s),s===ae.CLOSED?p(t):g(t)):console.error(`Error retrieving state for job ${e.job_id}`)}),[e]);function _(){O(null),g(null)}const k=Object(a.useCallback)((async()=>{await d.ml.jobs.forceStopAndCloseJob(e.job_id),null!==h&&await ie(e.job_id)===ae.CLOSED&&p(h),_()}),[e,h]),D=Object(a.useCallback)((e=>{j(null),e&&C()}),[]),w=Object(a.useCallback)((()=>{p(null)}),[]),E=Object(a.useCallback)((()=>{C(),setTimeout(t,500)}),[]),J=[{field:"snapshot_id",name:M.i18n.translate("xpack.ml.modelSnapshotTable.id",{defaultMessage:"ID"}),sortable:!0},{field:"description",name:M.i18n.translate("xpack.ml.modelSnapshotTable.description",{defaultMessage:"Description"}),sortable:!0},{field:"timestamp",name:M.i18n.translate("xpack.ml.modelSnapshotTable.time",{defaultMessage:"Date created"}),dataType:"date",render:N.d,sortable:!0},{field:"latest_record_time_stamp",name:M.i18n.translate("xpack.ml.modelSnapshotTable.latestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:N.d,sortable:!0},{field:"retain",name:M.i18n.translate("xpack.ml.modelSnapshotTable.retain",{defaultMessage:"Retain"}),width:"100px",sortable:!0},{field:"",width:"100px",name:M.i18n.translate("xpack.ml.modelSnapshotTable.actions",{defaultMessage:"Actions"}),actions:[{name:M.i18n.translate("xpack.ml.modelSnapshotTable.actions.revert.name",{defaultMessage:"Revert"}),description:M.i18n.translate("xpack.ml.modelSnapshotTable.actions.revert.description",{defaultMessage:"Revert to this snapshot"}),enabled:()=>y&&s&&i,type:"icon",icon:"crosshairs",onClick:v,"data-test-subj":"mlADModelSnapShotRevertButton"},{name:M.i18n.translate("xpack.ml.modelSnapshotTable.actions.edit.name",{defaultMessage:"Edit"}),description:M.i18n.translate("xpack.ml.modelSnapshotTable.actions.edit.description",{defaultMessage:"Edit this snapshot"}),enabled:()=>y&&s,type:"icon",icon:"pencil",onClick:j,"data-test-subj":"mlADModelSnapShotsEditButton"}]}];return!1===r?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceAround"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiLoadingSpinner,{size:"l"})))):Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiInMemoryTable,{className:"eui-textBreakWord",compressed:!0,items:n,columns:J,pagination:{pageSizeOptions:[5,10,25]},sorting:{sort:{field:"timestamp",direction:"asc"}}}),null!==b&&Object(F.jsx)(ee,{snapshot:b,job:e,closeFlyout:D}),null!==m&&Object(F.jsx)(Z.a,{snapshot:m,snapshots:n,job:e,closeFlyout:w,refresh:E}),null!==h&&null!==x&&Object(F.jsx)(se,{combinedJobState:x,hideCloseJobModalVisible:_,forceCloseJob:k}))};async function ie(e){const t=await d.ml.jobs.jobs([e]);return 1!==t.length?ae.UNKNOWN:t[0].state!==te.c.CLOSED?t[0].datafeed_config.state!==te.a.STOPPED?ae.OPEN_AND_RUNNING:ae.OPEN_AND_STOPPED:ae.CLOSED}var ne=s(21),le=s(236),re=s(235),ce=s(1);class forecasts_table_ForecastsTable extends a.Component{constructor(e){super(e),this.state={isLoading:0!==e.job.data_counts.processed_record_count,forecasts:[]},this.mlForecastService}componentDidMount(){this.mlForecastService=Object(re.a)(this.context.services.mlServices.mlApiServices);const e=this.props.job.data_counts;e.processed_record_count>0&&this.mlForecastService.getForecastsSummary(this.props.job,null,e.earliest_record_timestamp,500).then((e=>{this.setState({isLoading:!1,forecasts:e.forecasts})})).catch((e=>{console.log("Error loading list of forecasts for jobs list:",e),this.setState({isLoading:!1,errorMessage:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.loadingErrorMessage",{defaultMessage:"Error loading the list of forecasts run on this job"}),forecasts:[]})}))}async openSingleMetricView(e){const{services:{application:{navigateToUrl:t},share:s}}=this.context,a=this.props.job.data_counts,o=a.earliest_record_timestamp,i=Object(q.j)(a.latest_record_timestamp,a.latest_bucket_timestamp),n=new Date(a.earliest_record_timestamp).toISOString(),l=void 0!==e?new Date(e.forecast_end_timestamp).toISOString():new Date(i).toISOString();let r={};if(void 0!==e){const t=e.forecast_end_timestamp-e.forecast_start_timestamp,s=Math.max(e.forecast_start_timestamp-t,o);r={forecastId:e.forecast_id,zoom:{from:new Date(s).toISOString(),to:new Date(e.forecast_end_timestamp).toISOString()}}}const c=s.url.locators.get(ce.a),d=await c.getUrl({page:ce.b.SINGLE_METRIC_VIEWER,pageState:{timeRange:{from:n,to:l,mode:"absolute"},refreshInterval:{display:"Off",pause:!0,value:0},jobIds:[this.props.job.job_id],query:{query_string:{analyze_wildcard:!0,query:"*"}},...r}},{absolute:!0});Object(le.a)("timeseriesexplorer",this.props.job.job_id,d),await t(d)}render(){if(!0===this.state.isLoading)return Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceAround"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return Object(F.jsx)(c.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"});const e=this.state.forecasts;if(0===e.length)return Object(F.jsx)(c.EuiCallOut,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsTitle",defaultMessage:"No forecasts have been run for this job"}),iconType:"iInCircle",role:"alert"},Object(q.r)(this.props.job)&&Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription",defaultMessage:"To run a forecast, open the {singleMetricViewerLink}",values:{singleMetricViewerLink:Object(F.jsx)(c.EuiLink,{onClick:()=>this.openSingleMetricView()},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription.linkText",defaultMessage:"Single Metric Viewer"}))}})));const t=[{field:"forecast_create_timestamp",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.createdLabel",{defaultMessage:"Created"}),dataType:"date",render:N.d,textOnly:!0,sortable:!0,scope:"row"},{field:"forecast_start_timestamp",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.fromLabel",{defaultMessage:"From"}),dataType:"date",render:N.d,textOnly:!0,sortable:!0},{field:"forecast_end_timestamp",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.toLabel",{defaultMessage:"To"}),dataType:"date",render:N.d,textOnly:!0,sortable:!0},{field:"forecast_status",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.statusLabel",{defaultMessage:"Status"}),sortable:!0},{field:"forecast_memory_bytes",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.memorySizeLabel",{defaultMessage:"Memory size"}),render:e=>Object(c.formatNumber)(e,"0b"),sortable:!0},{field:"processing_time_ms",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.processingTimeLabel",{defaultMessage:"Processing time"}),render:e=>M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.msTimeUnitLabel",{defaultMessage:"{ms} ms",values:{ms:e}}),sortable:!0},{field:"forecast_expiry_timestamp",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.expiresLabel",{defaultMessage:"Expires"}),render:N.d,textOnly:!0,sortable:!0},{field:"forecast_messages",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.messagesLabel",{defaultMessage:"Messages"}),sortable:!1,render:e=>Object(F.jsx)("div",null,e.map(((e,t)=>Object(F.jsx)("p",{key:t},e)))),textOnly:!0},{name:M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewLabel",{defaultMessage:"View"}),width:"60px",render:e=>{const t=M.i18n.translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewAriaLabel",{defaultMessage:"View forecast created at {createdDate}",values:{createdDate:Object(N.d)(e.forecast_create_timestamp)}});return Object(F.jsx)(c.EuiButtonIcon,{onClick:()=>this.openSingleMetricView(e),isDisabled:void 0!==this.props.job.blocked||e.forecast_status!==te.b.FINISHED,iconType:"visLine","aria-label":t,"data-test-subj":"mlJobListForecastTabOpenSingleMetricViewButton"})}}];return Object(F.jsx)(c.EuiInMemoryTable,{"data-test-subj":"mlJobListForecastTable",compressed:!0,items:e,columns:t,pagination:{pageSizeOptions:[5,10,25]},sorting:!0})}}r()(forecasts_table_ForecastsTable,"contextType",ne.context);const de=({item:e})=>{const{euiTheme:t}=Object(c.useEuiTheme)(),s=t.size.m;return Object(F.jsx)(c.EuiTableRow,null,""!==e[0]&&Object(F.jsx)(c.EuiTableRowCell,null,Object(F.jsx)("span",{css:Object(F.css)({fontSize:s,fontWeight:"bold"},"","")},e[0])),Object(F.jsx)(c.EuiTableRowCell,null,Object(F.jsx)("span",{css:Object(F.css)({fontSize:s},"","")},e[1])))},ue=({section:e})=>{const{euiTheme:t}=Object(c.useEuiTheme)();if(0===e.items.length)return Object(F.jsx)("div",null);const s=Object(F.css)({overflow:"auto",padding:`${t.size.xs} ${t.size.m}`,backgroundColor:t.colors.lightestShade,border:`1px solid ${t.colors.lightShade}`,borderRadius:t.border.radius.medium,margin:`${t.size.s} 0`,".euiTable":{backgroundColor:"transparent"},".euiTableRow:hover":{backgroundColor:"inherit"},".euiTableRow:first-child":{".euiTableRowCell":{borderTop:0}},".euiTableRow:last-child":{".euiTableRowCell":{borderBottom:0}}},"","");return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiTitle,{size:"xs"},Object(F.jsx)("h4",null,e.title))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},e.titleAction))),Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)("div",{css:s,"data-test-subj":`mlJobRowDetailsSection-${e.id}`},Object(F.jsx)(c.EuiTable,{compressed:!0},Object(F.jsx)(c.EuiTableBody,null,e.items.map(((e,t)=>Object(F.jsx)(de,{item:e,key:t})))))))))},be=({sections:e,...t})=>Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)("div",{"data-test-subj":t["data-test-subj"]},Object(F.jsx)(c.EuiFlexGroup,null,Object(F.jsx)(c.EuiFlexItem,null,e.filter((e=>"left"===e.position)).map(((e,t)=>Object(F.jsx)(ue,{section:e,key:t})))),Object(F.jsx)(c.EuiFlexItem,null,e.filter((e=>"right"===e.position)).map(((e,t)=>Object(F.jsx)(ue,{section:e,key:t})))))));var je=s(439);class job_details_JobDetailsUI extends a.Component{constructor(e){super(e),this.state={datafeedChartFlyoutVisible:!1,modelSnapshot:null,revertSnapshotFlyoutVisible:!1},this.props.addYourself&&this.props.addYourself(e.jobId,(e=>this.updateJob(e)))}componentWillUnmount(){this.props.removeYourself(this.props.jobId)}updateJob(e){this.setState({job:e})}render(){var e;const t=null!==(e=this.state.job)&&void 0!==e?e:this.props.job,{services:{http:{basePath:s}}}=this.props.kibana;if(void 0===t)return Object(F.jsx)("div",{className:"job-loading-spinner","data-test-subj":"mlJobDetails loading"},Object(F.jsx)(c.EuiLoadingSpinner,{size:"l"}));{const{refreshJobList:e,showClearButton:n}=this.props,{general:l,customUrl:r,node:d,calendars:u,detectors:b,influencers:j,analysisConfig:m,analysisLimits:p,dataDescription:g,customSettings:f,jobTags:x,datafeed:O,counts:y,modelSizeStats:S,jobTimingStats:C,datafeedTimingStats:v,alertRules:_}=function(e,t,s){var a,o;if(0===Object.keys(e).length)return{};const i={id:"general",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.generalTitle",{defaultMessage:"General"}),position:"left",items:z(e,!0).map(B)},{job_tags:n,custom_urls:l,...r}=null!==(a=e.custom_settings)&&void 0!==a?a:{},d={id:"customUrl",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.customUrlsTitle",{defaultMessage:"Custom URLs"}),position:"right",items:l?l.map((e=>[e.url_name,e.url_value,e.time_range])):[]},u={id:"analysisConfig",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.customSettingsTitle",{defaultMessage:"Custom settings"}),position:"right",items:r?z(r,!0,!0).map(B):[]},b={id:"analysisConfig",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.jobTagsTitle",{defaultMessage:"Job tags"}),position:"right",items:n?z(n):[]},j={id:"node",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.nodeTitle",{defaultMessage:"Node"}),position:"right",items:[]};e.node&&j.items.push(["name",e.node.name]);const m={id:"calendars",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.calendarsTitle",{defaultMessage:"Calendars"}),position:"right",items:[]};if(e.calendars){m.items=e.calendars.map((e=>["",Object(F.jsx)(c.EuiLink,{href:t.prepend(`/app/ml/settings/calendars_list/edit_calendar/${e}?_g=()`),"data-test-subj":`mlJobDetailsCalendar-${e}`},e)]));const s=i.items.findIndex((e=>"calendars"===e[0]));s>=0&&i.items.splice(s,1)}const p={id:"alertRules",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.alertRulesTitle",{defaultMessage:"Alert rules"}),position:"right",items:(null!==(o=e.alerting_rules)&&void 0!==o?o:[]).map((e=>["",Object(F.jsx)(P.a,{initialAlert:e,onSave:s})]))};if(e.alerting_rules){const e=i.items.findIndex((e=>"alerting_rules"===e[0]));e>=0&&i.items.splice(e,1)}const g={id:"detectors",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.detectorsTitle",{defaultMessage:"Detectors"}),position:"left",items:[]};e.analysis_config&&e.analysis_config.detectors&&g.items.push(...e.analysis_config.detectors.map((e=>{const t=Object(h.b)(e);return[t,t!==e.detector_description?e.detector_description:""]})));const f={id:"influencers",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.influencersTitle",{defaultMessage:"Influencers"}),position:"left",items:e.analysis_config.influencers.map((e=>["",e]))},x={id:"analysisConfig",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.analysisConfigTitle",{defaultMessage:"Analysis config"}),position:"left",items:z(e.analysis_config)},O={id:"analysisLimits",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.analysisLimitsTitle",{defaultMessage:"Analysis limits"}),position:"left",items:z(e.analysis_limits)},y={id:"dataDescription",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.dataDescriptionTitle",{defaultMessage:"Data description"}),position:"right",items:z(e.data_description)},S={id:"datafeed",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.datafeedTitle",{defaultMessage:"Datafeed"}),position:"left",items:z(e.datafeed_config||{},!0,!0)};if(e.node&&S.items.push(["node",JSON.stringify(e.node)]),e.datafeed_config&&e.datafeed_config.timing_stats){const e=S.items.findIndex((e=>"timing_stats"===e[0]));e>=0&&S.items.splice(e,1)}return{general:i,customUrl:d,node:j,calendars:m,detectors:g,influencers:f,analysisConfig:x,analysisLimits:O,dataDescription:y,customSettings:u,jobTags:b,datafeed:S,counts:{id:"counts",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.countsTitle",{defaultMessage:"Counts"}),position:"left",items:z(e.data_counts).map(B)},modelSizeStats:{id:"modelSizeStats",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.modelSizeStatsTitle",{defaultMessage:"Model size stats"}),position:"right",items:z(e.model_size_stats).map(B)},jobTimingStats:{id:"jobTimingStats",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.jobTimingStatsTitle",{defaultMessage:"Job timing stats"}),position:"left",items:z(e.timing_stats).map(B)},datafeedTimingStats:{id:"datafeedTimingStats",title:M.i18n.translate("xpack.ml.jobsList.jobDetails.datafeedTimingStatsTitle",{defaultMessage:"Timing stats"}),position:"right",items:e.datafeed_config&&e.datafeed_config.timing_stats?z(e.datafeed_config.timing_stats).filter((e=>"total_search_time_ms"!==e[0])).map(B):[]},alertRules:p}}(t,s,e);void 0===t.blocked&&(O.titleAction=Object(F.jsx)(c.EuiButtonEmpty,{onClick:()=>this.setState({datafeedChartFlyoutVisible:!0}),iconType:"visAreaStacked",size:"s"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobDetails.tabs.datafeed.viewCountsButtonText",defaultMessage:"View datafeed counts"})));const k=[{id:"job-settings","data-test-subj":"mlJobListTab-job-settings",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobSettingsLabel",{defaultMessage:"Job settings"}),content:Object(F.jsx)(be,{"data-test-subj":"mlJobDetails-job-settings",sections:[l,f,r,x,d,u,_]}),time:t.open_time},{id:"job-config","data-test-subj":"mlJobListTab-job-config",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobConfigLabel",{defaultMessage:"Job config"}),content:Object(F.jsx)(be,{"data-test-subj":"mlJobDetails-job-config",sections:[b,j,m,p,g]})},{id:"datafeed","data-test-subj":"mlJobListTab-datafeed",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.datafeedLabel",{defaultMessage:"Datafeed"}),content:Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(be,{"data-test-subj":"mlJobDetails-datafeed",sections:[O,v]}),this.props.jobId&&this.state.datafeedChartFlyoutVisible?Object(F.jsx)(K.a,{onClose:()=>{this.setState({datafeedChartFlyoutVisible:!1})},onModelSnapshotAnnotationClick:e=>{this.setState({modelSnapshot:e,revertSnapshotFlyoutVisible:!0,datafeedChartFlyoutVisible:!1})},end:t.data_counts.latest_bucket_timestamp,jobId:this.props.jobId}):null,!0===this.state.revertSnapshotFlyoutVisible&&null!==this.state.modelSnapshot?Object(F.jsx)(Z.a,{snapshot:this.state.modelSnapshot,snapshots:[this.state.modelSnapshot],job:t,closeFlyout:()=>{this.setState({revertSnapshotFlyoutVisible:!1})},refresh:e}):null)},{id:"counts","data-test-subj":"mlJobListTab-counts",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.countsLabel",{defaultMessage:"Counts"}),content:Object(F.jsx)(be,{"data-test-subj":"mlJobDetails-counts",sections:[y,S,C]})},{id:"json","data-test-subj":"mlJobListTab-json",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jsonLabel",{defaultMessage:"JSON"}),content:Object(F.jsx)(G,{job:t})},{id:"job-messages","data-test-subj":"mlJobListTab-job-messages",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.jobMessagesLabel",{defaultMessage:"Job messages"}),content:Object(F.jsx)(je.a,{jobId:t.job_id,refreshJobList:e,showClearButton:n})}];return O.items.length&&k.push({id:"datafeed-preview",disabled:void 0!==t.blocked,"data-test-subj":"mlJobListTab-datafeed-preview",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.datafeedPreviewLabel",{defaultMessage:"Datafeed preview"}),content:Object(F.jsx)(H,{job:t})},{id:"forecasts",disabled:void 0!==t.blocked,"data-test-subj":"mlJobListTab-forecasts",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.forecastsLabel",{defaultMessage:"Forecasts"}),content:Object(F.jsx)(forecasts_table_ForecastsTable,{job:t})}),k.push({id:"annotations",disabled:void 0!==t.blocked,"data-test-subj":"mlJobListTab-annotations",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.annotationsLabel",{defaultMessage:"Annotations"}),content:Object(F.jsx)(a.Fragment,null,Object(F.jsx)(Y.a,{jobs:[t],refreshJobList:e}),Object(F.jsx)(X.AnnotationFlyout,null))}),k.push({id:"modelSnapshots",disabled:void 0!==t.blocked,"data-test-subj":"mlJobListTab-modelSnapshots",name:M.i18n.translate("xpack.ml.jobsList.jobDetails.tabs.modelSnapshotsLabel",{defaultMessage:"Model snapshots"}),content:Object(F.jsx)(a.Fragment,null,Object(F.jsx)(oe,{job:t,refreshJobList:e}))}),Object(F.jsx)("div",{className:"tab-contents","data-test-subj":`mlJobListRowDetails details-${t.job_id}`},Object(F.jsx)(c.EuiTabbedContent,{tabs:k,initialSelectedTab:k[0],onTabClick:()=>{}}))}}}const me=Object(ne.withKibana)(job_details_JobDetailsUI),pe=({queryText:e,setFilters:t})=>{const[s,o]=Object(a.useState)(null),{services:{mlServices:{mlApiServices:n}}}=Object(W.d)(),l=Object(a.useCallback)((async()=>{try{return(await n.jobs.groups()).map((e=>({value:e.id,view:Object(F.jsx)("div",{className:"group-item"},Object(F.jsx)(w.a,{name:e.id})," ",Object(F.jsx)("span",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.jobFilterBar.jobGroupTitle",defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:e.jobIds.length}})))})))}catch(e){return[]}}),[]),r=Object(a.useMemo)((()=>c.EuiSearchBar.Query.parse(null!=e?e:"")),[e]);Object(a.useEffect)((()=>{void 0!==e&&t(r)}),[e]);const d=Object(a.useMemo)((()=>[{type:"field_value_toggle_group",field:"job_state",items:[{value:"opened",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.openedLabel",{defaultMessage:"Opened"})},{value:"closed",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.closedLabel",{defaultMessage:"Closed"})},{value:"failed",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.failedLabel",{defaultMessage:"Failed"})}]},{type:"field_value_toggle_group",field:"datafeed_state",items:[{value:"started",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.startedLabel",{defaultMessage:"Started"})},{value:"stopped",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.stoppedLabel",{defaultMessage:"Stopped"})}]},{type:"field_value_selection",field:"groups",name:M.i18n.translate("xpack.ml.jobsList.jobFilterBar.groupLabel",{defaultMessage:"Group"}),multiSelect:"or",cache:1e4,options:()=>l()}]),[]),u=Object(a.useMemo)((()=>null===s?"":M.i18n.translate("xpack.ml.jobsList.jobFilterBar.invalidSearchErrorMessage",{defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:s.message}})),[s]);return Object(F.jsx)(c.EuiFlexGroup,{direction:"column"},Object(F.jsx)(c.EuiFlexItem,{"data-test-subj":"mlJobListSearchBar",grow:!1},Object(F.jsx)(c.EuiSearchBar,{box:{incremental:!0},query:r,filters:d,onChange:({query:e,error:s})=>{s?o(s):(t(e),o(null))}}),Object(F.jsx)(c.EuiFormRow,{fullWidth:!0,isInvalid:null!==s,error:u,style:{maxHeight:0}},Object(F.jsx)(a.Fragment,null))))};var he=s(150);class tabs_job_details_JobDetails extends a.Component{constructor(e){super(e),r()(this,"onDescriptionChange",(e=>{this.setJobDetails({jobDescription:e.target.value})})),r()(this,"onMmlChange",(e=>{this.setJobDetails({jobModelMemoryLimit:e.target.value})})),r()(this,"onModelSnapshotRetentionDaysChange",(e=>{const t=Math.floor(+e.target.value);this.setJobDetails({jobModelSnapshotRetentionDays:t,...this.state.dailyModelSnapshotRetentionAfterDays>t?{jobDailyModelSnapshotRetentionAfterDays:t}:{}})})),r()(this,"onDailyModelSnapshotRetentionAfterDaysChange",(e=>{const t=Math.floor(+e.target.value);t<=this.state.modelSnapshotRetentionDays&&this.setJobDetails({jobDailyModelSnapshotRetentionAfterDays:t})})),r()(this,"onGroupsChange",(e=>{this.setJobDetails({jobGroups:e.map((e=>e.label))})})),r()(this,"onCreateGroup",((e,t)=>{const s=e.trim().toLowerCase();if(!s)return;const a={label:e},o=this.state.groups;-1===t.findIndex((e=>e.label.trim().toLowerCase()===s))&&o.push(a);const i=this.state.selectedGroups.concat(a);this.setState({groups:o},(()=>this.onGroupsChange(i)))})),this.state={description:"",groups:[],selectedGroups:[],mml:"",mmlValidationError:"",groupsValidationError:"",modelSnapshotRetentionDays:1,dailyModelSnapshotRetentionAfterDays:1},this.setJobDetails=e.setJobDetails}componentDidMount(){d.ml.jobs.groups().then((e=>{const t=e.map((e=>({label:e.id,color:Object(he.a)(e.id)})));this.setState({groups:t})})).catch((e=>{console.error("Could not load groups",e)}))}static getDerivedStateFromProps(e){const t=void 0!==e.jobGroups?e.jobGroups.map((e=>({label:e,color:Object(he.a)(e)}))):[],{datafeedRunning:s,jobClosed:a}=e;let o=null;return a||(o=Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitJobOpenLabelHelp",defaultMessage:"Model memory limit cannot be edited while the job is open."})),s&&(o=Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabelHelp",defaultMessage:"Model memory limit cannot be edited while the datafeed is running."})),{description:e.jobDescription,selectedGroups:t,mml:e.jobModelMemoryLimit,mmlHelpText:o,mmlValidationError:e.jobModelMemoryLimitValidationError,groupsValidationError:e.jobGroupsValidationError,modelSnapshotRetentionDays:e.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:e.jobDailyModelSnapshotRetentionAfterDays}}render(){const{description:e,selectedGroups:t,mml:s,groups:a,mmlValidationError:n,groupsValidationError:l,modelSnapshotRetentionDays:r,dailyModelSnapshotRetentionAfterDays:d,mmlHelpText:u}=this.state,{datafeedRunning:b,jobClosed:j}=this.props;return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"m"}),Object(F.jsx)(c.EuiForm,null,Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobDescriptionLabel",defaultMessage:"Job description"})},Object(F.jsx)(c.EuiFieldText,{value:e,onChange:this.onDescriptionChange})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsLabel",defaultMessage:"Job groups"}),isInvalid:""!==l,error:l},Object(F.jsx)(c.EuiComboBox,{placeholder:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsPlaceholder",{defaultMessage:"Select or create groups"}),options:a,selectedOptions:t,onChange:this.onGroupsChange,onCreateOption:this.onCreateGroup,isClearable:!0,isInvalid:""!==l,error:l})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabel",defaultMessage:"Model memory limit"}),helpText:u,isInvalid:""!==n,error:n},Object(F.jsx)(c.EuiFieldText,{value:s,onChange:this.onMmlChange,isInvalid:""!==n,error:n,disabled:b||!j})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelSnapshotRetentionDaysLabel",defaultMessage:"Model snapshot retention days"})},Object(F.jsx)(c.EuiFieldNumber,{min:0,value:r,onChange:this.onModelSnapshotRetentionDaysChange})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.dailyModelSnapshotRetentionAfterDaysLabel",defaultMessage:"Daily model snapshot retention after days"})},Object(F.jsx)(c.EuiFieldNumber,{min:0,max:r,value:d,onChange:this.onDailyModelSnapshotRetentionAfterDaysChange}))))}}var ge=s(73);class detectors_Detectors extends a.Component{constructor(e){super(e),r()(this,"onDescriptionChange",((e,t)=>{const s=this.state.detectorDescriptions;s[t]=e.target.value,this.setDetectorDescriptions({jobDetectorDescriptions:s})})),this.detectors=ge.mlJobService.getJobGroups().map((e=>({label:e.id}))),this.state={detectors:[],detectorDescriptions:[]},this.setDetectorDescriptions=e.setDetectorDescriptions}static getDerivedStateFromProps(e){return{detectors:e.jobDetectors,detectorDescriptions:e.jobDetectorDescriptions}}render(){const{detectors:e,detectorDescriptions:t}=this.state;return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"m"}),Object(F.jsx)(c.EuiTitle,{size:"xs"},Object(F.jsx)("h4",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.detectors.title",defaultMessage:"Edit detector descriptions"}))),Object(F.jsx)(c.EuiSpacer,{size:"m"}),Object(F.jsx)(c.EuiForm,null,t.map(((t,s)=>Object(F.jsx)(c.EuiFormRow,{label:Object(h.b)(e[s]),key:s},Object(F.jsx)(c.EuiFieldText,{value:t,onChange:e=>this.onDescriptionChange(e,s)}))))))}}var fe=s(18),xe=s(40);function Oe(e,t){const s=void 0!==e?Object(xe.a)(e).asSeconds():"";return{queryDelay:"60s",frequency:Object(q.f)(s)+"s",scrollSize:t.datafeeds.scroll_size}}class datafeed_Datafeed extends a.Component{constructor(e){super(e),r()(this,"onQueryChange",(e=>{this.setDatafeed({datafeedQuery:e})})),r()(this,"onQueryDelayChange",(e=>{this.setDatafeed({datafeedQueryDelay:e.target.value})})),r()(this,"onFrequencyChange",(e=>{this.setDatafeed({datafeedFrequency:e.target.value})})),r()(this,"onScrollSizeChange",(e=>{this.setDatafeed({datafeedScrollSize:+e.target.value})})),this.state={query:"",queryDelay:"",frequency:"",scrollSize:"",defaults:{queryDelay:"",frequency:"",scrollSize:0},jobDefaults:Object(fe.c)()},this.setDatafeed=e.setDatafeed}static getDerivedStateFromProps(e,t){return{query:e.datafeedQuery,queryDelay:e.datafeedQueryDelay,frequency:e.datafeedFrequency,scrollSize:e.datafeedScrollSize,defaults:Oe(e.jobBucketSpan,t.jobDefaults)}}render(){const{query:e,queryDelay:t,frequency:s,scrollSize:a,defaults:n}=this.state,{datafeedRunning:l}=this.props;return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"m"}),l&&Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiCallOut,{color:"warning"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.readOnlyCalloutText",defaultMessage:"Datafeed settings cannot be edited while the datafeed is running. Please stop the job if you wish to edit these settings."})),Object(F.jsx)(c.EuiSpacer,{size:"l"})),Object(F.jsx)(c.EuiForm,null,Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryLabel",defaultMessage:"Query"}),style:{maxWidth:"inherit"}},Object(F.jsx)(V.a,{mode:V.b.XJSON,value:e,onChange:this.onQueryChange,height:"200px",readOnly:l})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryDelayLabel",defaultMessage:"Query delay"})},Object(F.jsx)(c.EuiFieldText,{value:t,placeholder:n.queryDelay,onChange:this.onQueryDelayChange,disabled:l})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.frequencyLabel",defaultMessage:"Frequency"})},Object(F.jsx)(c.EuiFieldText,{value:s,placeholder:n.frequency,onChange:this.onFrequencyChange,disabled:l})),Object(F.jsx)(c.EuiFormRow,{label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.datafeed.scrollSizeLabel",defaultMessage:"Scroll size"})},Object(F.jsx)(c.EuiFieldNumber,{value:a,placeholder:n.scrollSize,onChange:this.onScrollSizeChange,disabled:l}))))}}function Me(e,t){const s=t.description;return t.description!==e.description?{description:s}:{}}function ye(e,t){const s=t.groups;return void 0!==t.groups?0===Object(b.difference)(e.groups,s).length+Object(b.difference)(s,e.groups).length?{}:{groups:s}:{}}function Se(e,t){const s=Object(fe.d)(),a={};if(void 0!==e.analysis_limits.model_memory_limit){let{mml:o}=t;""===o&&(o=s.max_model_memory_limit),o!==e.analysis_limits.model_memory_limit&&(a.analysis_limits={model_memory_limit:o,...void 0!==e.analysis_limits.categorization_examples_limit?{categorization_examples_limit:e.analysis_limits.categorization_examples_limit}:{}})}return a}function Ce(e,t){const s=t.modelSnapshotRetentionDays;return s!==e.model_snapshot_retention_days?{model_snapshot_retention_days:s}:{}}function ve(e,t){const s=t.dailyModelSnapshotRetentionAfterDays;return s!==e.daily_model_snapshot_retention_after_days?{daily_model_snapshot_retention_after_days:s}:{}}function _e(e,t){const s=[],a=t.detectorDescriptions.map(((e,t)=>({detector_index:t,description:e})));return e.analysis_config.detectors.forEach((e=>{a[e.detector_index].description!==e.detector_description&&s.push(a[e.detector_index])})),s.length?{detectors:s}:{}}function ke(e,t){const s={};return t&&t.customUrls&&(s.custom_settings=e.custom_settings||{},s.custom_settings.custom_urls=t.customUrls),s}function Fe(e,t){const s={};if(void 0!==e.datafeed_config){const a=JSON.stringify(e.datafeed_config.query),o=JSON.parse(t.datafeedQuery);a!==JSON.stringify(o)&&(s.query=o),e.datafeed_config.query_delay!==t.datafeedQueryDelay&&(s.query_delay=t.datafeedQueryDelay),e.datafeed_config.frequency!==t.datafeedFrequency&&""!==t.datafeedFrequency&&(s.frequency=t.datafeedFrequency),e.datafeed_config.scroll_size!==t.datafeedScrollSize&&(s.scroll_size=t.datafeedScrollSize)}return s}var De=s(198);function we(e){const t={groups:e},s=Object(q.x)(t),{valid:a}=s,o={valid:a,message:""};return Object(De.b)(s,{groupIds:o}),o}var Ee=s(71),Je=s(92),Le=s(275),Te=s(182);const{collapseLiteralStrings:Ie}=Je.XJson;class edit_job_flyout_EditJobFlyoutUI extends a.Component{constructor(e){super(e),r()(this,"_initialJobFormState",null),r()(this,"closeFlyout",((e=!1)=>{!this.containsUnsavedChanges()||e?(this.setState({isConfirmationModalVisible:!1}),this.setState({isFlyoutVisible:!1})):this.setState({isConfirmationModalVisible:!0})})),r()(this,"showFlyout",(e=>{const t=e.hasDatafeed;Object(u.k)(e.id).then((e=>{this.extractJob(e,t),this.setState({job:e,isFlyoutVisible:!0})})).catch((e=>{console.error(e)}))})),r()(this,"setJobDetails",(e=>{let{jobModelMemoryLimitValidationError:t,jobGroupsValidationError:s}=this.state;void 0!==e.jobModelMemoryLimit&&(t=function(e){const t=Object(fe.d)(),s={analysis_limits:{model_memory_limit:e}};let a=Object(q.z)(e),{valid:o}=a;o&&(a=Object(q.y)(s,t),o=a.valid);const i={valid:o,message:""};return Object(De.b)(a,{modelMemoryLimit:i}),i}(e.jobModelMemoryLimit).message),void 0!==e.jobGroups&&(s=we(e.jobGroups).message,""===s&&d.ml.jobs.jobsExist(e.jobGroups,!0).then((e=>{!1==(!1===Object.values(e).some((e=>!0===e.exists&&!1===e.isGroup)))&&this.setState({jobGroupsValidationError:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.groupsAndJobsHasSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."}),isValidJobDetails:!1})})));const a=""===t&&""===s;this.setState({...e,jobModelMemoryLimitValidationError:t,jobGroupsValidationError:s,isValidJobDetails:a})})),r()(this,"setDetectorDescriptions",(e=>{this.setState({...e})})),r()(this,"setDatafeed",(e=>{this.setState({...e})})),r()(this,"setCustomUrls",(e=>{const t=Object(Le.b)(e);this.setState({jobCustomUrls:e,isValidJobCustomUrls:t})})),r()(this,"save",(()=>{const e={description:this.state.jobDescription,groups:this.state.jobGroups,mml:this.state.jobModelMemoryLimit,modelSnapshotRetentionDays:this.state.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:this.state.jobDailyModelSnapshotRetentionAfterDays,detectorDescriptions:this.state.jobDetectorDescriptions,datafeedQuery:Ie(this.state.datafeedQuery),datafeedQueryDelay:this.state.datafeedQueryDelay,datafeedFrequency:this.state.datafeedFrequency,datafeedScrollSize:this.state.datafeedScrollSize,customUrls:this.state.jobCustomUrls},{toasts:t}=this.props.kibana.services.notifications,s=Object(Ee.toastNotificationServiceProvider)(t);(function(e,t,s){return new Promise(((s,a)=>{const o={...Me(e,t),...ye(e,t),...Se(e,t),...Ce(e,t),...ve(e,t),..._e(e,t),...ke(e,t)},i={...Fe(e,t)};void 0!==o.custom_settings&&(o.custom_settings=function(e,t){let s={};return void 0!==e.custom_settings&&(s={...e.custom_settings},void 0===e.custom_settings.created_by||void 0===e.detectors&&!Object.keys(t).length||Object(q.t)(s)),s}(o,i));const n=()=>{(function(e,t){return new Promise(((s,a)=>{if(Object.keys(e).length){const o=t.datafeed_config.datafeed_id;d.ml.updateDatafeed({datafeedId:o,datafeedConfig:e}).then((()=>{s()})).catch((e=>{a(e)}))}else s()}))})(i,e).then((()=>{s()})).catch((e=>{a(e)}))};Object.keys(o).length?d.ml.updateJob({jobId:e.job_id,job:o}).then((()=>{n()})).catch((e=>{a(e)})):n()}))})(this.state.job,e).then((()=>{t.addSuccess(M.i18n.translate("xpack.ml.jobsList.editJobFlyout.changesSavedNotificationMessage",{defaultMessage:"Changes to {jobId} saved",values:{jobId:this.state.job.job_id}})),this.refreshJobs(),this.closeFlyout(!0)})).catch((e=>{console.error(e),s.displayErrorToast(e,M.i18n.translate("xpack.ml.jobsList.editJobFlyout.changesNotSavedNotificationMessage",{defaultMessage:"Could not save changes to {jobId}",values:{jobId:this.state.job.job_id}}))}))})),this.state={job:{},hasDatafeed:!1,datafeedRunning:!1,isFlyoutVisible:!1,isConfirmationModalVisible:!1,jobDescription:"",jobGroups:[],jobModelMemoryLimit:"",jobModelSnapshotRetentionDays:10,jobDailyModelSnapshotRetentionAfterDays:10,jobDetectors:[],jobDetectorDescriptions:[],jobCustomUrls:[],datafeedQuery:"",datafeedQueryDelay:"",datafeedFrequency:"",datafeedScrollSize:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",isValidJobDetails:!0,isValidJobCustomUrls:!0},this.refreshJobs=this.props.refreshJobs}componentDidMount(){"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}containsUnsavedChanges(){return!Object(b.isEqual)(this._initialJobFormState,Object(b.pick)(this.state,["jobDescription","jobGroups","jobModelMemoryLimit","jobModelSnapshotRetentionDays","jobDailyModelSnapshotRetentionAfterDays","jobCustomUrls","jobDetectors","jobDetectorDescriptions","jobBucketSpan","datafeedQuery","datafeedQueryDelay","datafeedFrequency","datafeedScrollSize"]))}extractInitialJobFormState(e,t){const s=e.analysis_limits&&e.analysis_limits.model_memory_limit?e.analysis_limits.model_memory_limit:"",a=void 0!==e.model_snapshot_retention_days?e.model_snapshot_retention_days:10,o=void 0!==e.daily_model_snapshot_retention_after_days?e.daily_model_snapshot_retention_after_days:a,i=e.analysis_config&&e.analysis_config.detectors?[...e.analysis_config.detectors]:[],n=e.analysis_config?e.analysis_config.bucket_span:"",l={...e.datafeed_config},r=void 0!==l.frequency?l.frequency:"",c=e.custom_settings&&e.custom_settings.custom_urls?[...e.custom_settings.custom_urls]:[];this._initialJobFormState=Object.freeze({jobDescription:e.description,jobGroups:void 0!==e.groups?e.groups:[],jobModelMemoryLimit:s,jobModelSnapshotRetentionDays:a,jobDailyModelSnapshotRetentionAfterDays:o,jobDetectors:i,jobDetectorDescriptions:i.map((e=>e.detector_description)),jobBucketSpan:n,jobCustomUrls:c,datafeedQuery:t?JSON.stringify(l.query,null,2):"",datafeedQueryDelay:t?l.query_delay:"",datafeedFrequency:t?r:"",datafeedScrollSize:t?+l.scroll_size:null})}extractJob(e,t){this.extractInitialJobFormState(e,t);const s=t&&e.datafeed_config.state!==te.a.STOPPED,a=e.state===te.c.CLOSED;this.setState({job:e,hasDatafeed:t,datafeedRunning:s,jobClosed:a,jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",...Object(b.cloneDeep)(this._initialJobFormState)})}render(){let e,t;if(this.state.isFlyoutVisible){const{job:t,jobDescription:s,jobGroups:a,jobModelMemoryLimit:n,jobModelSnapshotRetentionDays:l,jobDailyModelSnapshotRetentionAfterDays:r,jobDetectors:d,jobDetectorDescriptions:u,jobBucketSpan:b,jobCustomUrls:j,datafeedQuery:m,datafeedQueryDelay:p,datafeedFrequency:h,datafeedScrollSize:g,jobGroupsValidationError:f,jobModelMemoryLimitValidationError:x,isValidJobDetails:O,isValidJobCustomUrls:y,datafeedRunning:C,jobClosed:v}=this.state,_=[{id:"job-details","data-test-subj":"mlEditJobFlyout-jobDetails",name:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.jobDetailsTitle",{defaultMessage:"Job details"}),content:Object(F.jsx)(tabs_job_details_JobDetails,{jobClosed:v,datafeedRunning:C,jobDescription:s,jobGroups:a,jobModelMemoryLimit:n,jobModelSnapshotRetentionDays:l,jobDailyModelSnapshotRetentionAfterDays:r,setJobDetails:this.setJobDetails,jobGroupsValidationError:f,jobModelMemoryLimitValidationError:x})},{id:"detectors","data-test-subj":"mlEditJobFlyout-detectors",name:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.detectorsTitle",{defaultMessage:"Detectors"}),content:Object(F.jsx)(detectors_Detectors,{jobDetectors:d,jobDetectorDescriptions:u,setDetectorDescriptions:this.setDetectorDescriptions})},{id:"datafeed","data-test-subj":"mlEditJobFlyout-datafeed",name:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.datafeedTitle",{defaultMessage:"Datafeed"}),content:Object(F.jsx)(datafeed_Datafeed,{datafeedQuery:m,datafeedQueryDelay:p,datafeedFrequency:h,datafeedScrollSize:g,jobBucketSpan:b,setDatafeed:this.setDatafeed,datafeedRunning:C})},{id:"custom-urls","data-test-subj":"mlEditJobFlyout-customUrls",name:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.customUrlsTitle",{defaultMessage:"Custom URLs"}),content:Object(F.jsx)(Le.a,{job:t,jobCustomUrls:j,setCustomUrls:this.setCustomUrls})}];e=Object(F.jsx)(c.EuiFlyout,{onClose:()=>{this.closeFlyout()},size:"m","data-test-subj":"mlJobEditFlyout"},Object(F.jsx)(c.EuiFlyoutHeader,null,Object(F.jsx)(c.EuiTitle,null,Object(F.jsx)("h2",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.pageTitle",defaultMessage:"Edit {jobId}",values:{jobId:t.job_id}}))),S(t)?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)(Te.a,{jobsCount:1,action:M.i18n.translate("xpack.ml.jobsList.editJobModal.editManagedJobDescription",{defaultMessage:"editing"})})):null),Object(F.jsx)(c.EuiFlyoutBody,null,Object(F.jsx)(c.EuiTabbedContent,{tabs:_,initialSelectedTab:_[0],onTabClick:()=>{}})),Object(F.jsx)(c.EuiFlyoutFooter,null,Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButtonEmpty,{iconType:"cross",onClick:()=>{this.closeFlyout()},flush:"left","data-test-subj":"mlEditJobFlyoutCloseButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.closeButtonLabel",defaultMessage:"Close"}))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButton,{onClick:this.save,fill:!0,isDisabled:!1===O||!1===y,"data-test-subj":"mlEditJobFlyoutSaveButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return this.state.isConfirmationModalVisible&&(t=Object(F.jsx)(c.EuiConfirmModal,{title:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogTitle",{defaultMessage:"Save changes before leaving?"}),onCancel:()=>this.closeFlyout(!0),onConfirm:()=>this.save(),cancelButtonText:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.leaveAnywayButtonLabel",{defaultMessage:"Leave anyway"}),confirmButtonText:M.i18n.translate("xpack.ml.jobsList.editJobFlyout.saveChangesButtonLabel",{defaultMessage:"Save changes"}),defaultFocusedButton:"confirm"},Object(F.jsx)("p",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogMessage",defaultMessage:"If you don't save, your changes will be lost."})))),Object(F.jsx)("div",null,e,t)}}const Ae=Object(ne.withKibana)(edit_job_flyout_EditJobFlyoutUI);var Re=s(250),Ne=s(245);const Be=({setShowFunction:e,unsetShowFunction:t,refreshJobs:s})=>{const[n,l]=Object(a.useState)(!1),[r,d]=Object(a.useState)(!1),[b,j]=Object(a.useState)([]),[m,p]=Object(a.useState)(!1),[h,g]=Object(a.useState)(!1),[f,x]=Object(a.useState)(!1);Object(a.useEffect)((()=>("function"==typeof e&&e(O),()=>{"function"==typeof t&&t()})),[]);const O=Object(a.useCallback)((e=>{j(e),d(!0),l(!1),g(!1)}),[]),{jobIds:y,hasManagedJob:C,hasAlertingRules:v}=Object(a.useMemo)((()=>({jobIds:b.map((({id:e})=>e)),hasManagedJob:b.some((e=>S(e))),hasAlertingRules:b.some((e=>Array.isArray(e.alertingRules)&&e.alertingRules.length>0))})),[b]),_=Object(a.useCallback)((()=>{d(!1),p(!1)}),[]),k=Object(a.useCallback)((()=>{l(!0),Object(u.d)(y.map((e=>({id:e}))),h,f),setTimeout((()=>{_(),s()}),Re.a)}),[y,h,f,_,s]);return!1===r||0===y.length?null:m?Object(F.jsx)(c.EuiModal,{"data-test-subj":"mlDeleteJobConfirmModal",onClose:_},Object(F.jsx)(c.EuiModalHeader,null,Object(F.jsx)(c.EuiModalHeaderTitle,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteJobsTitle",defaultMessage:"Delete {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:y.length,jobId:y[0]}}))),Object(F.jsx)(c.EuiModalBody,null,Object(F.jsx)("p",null,!0===n?Object(F.jsx)("div",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deletingJobsStatusLabel",defaultMessage:"Deleting jobs"}),Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)("div",{style:{textAlign:"center"}},Object(F.jsx)(c.EuiLoadingSpinner,{size:"l"}))):Object(F.jsx)(o.a.Fragment,null,C?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(Te.a,{jobsCount:y.length,action:M.i18n.translate("xpack.ml.jobsList.deleteJobModal.deleteAction",{defaultMessage:"deleting"})}),Object(F.jsx)(c.EuiSpacer,null)):null,Object(F.jsx)(c.EuiText,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteMultipleJobsDescription",defaultMessage:"Deleting {jobsCount, plural, one {a job} other {multiple jobs}} can be time consuming. {jobsCount, plural, one {It} other {They}} will be deleted in the background and may not disappear from the jobs list instantly.",values:{jobsCount:y.length}}),Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiSwitch,{label:M.i18n.translate("xpack.ml.jobsList.deleteJobModal.deleteUserAnnotations",{defaultMessage:"Delete annotations"}),checked:h,onChange:e=>g(e.target.checked),"data-test-subj":"mlDeleteJobConfirmModalDeleteAnnotationsSwitch"}),v?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)(c.EuiSwitch,{label:M.i18n.translate("xpack.ml.jobsList.resetJobModal.deleteAlertingRules",{defaultMessage:"Delete alerting rules"}),checked:f,onChange:e=>x(e.target.checked)})):null)))),Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiModalFooter,null,Object(F.jsx)(c.EuiButtonEmpty,{onClick:_,disabled:n},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(F.jsx)(c.EuiButton,{onClick:k,fill:!0,disabled:n,color:"danger","data-test-subj":"mlDeleteJobConfirmModalButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.deleteJobModal.deleteButtonLabel",defaultMessage:"Delete"}))))):Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(Ne.a,{ids:y,mlSavedObjectType:"anomaly-detector",canDeleteCallback:()=>{p(!0)},onCloseCallback:_,refreshJobsCallback:s,hasManagedJob:C}))},ze=({jobs:e})=>{const t=Object(a.useMemo)((()=>e.filter((e=>e.jobState!==te.c.CLOSED)).length),[e]);return 0===t?null:Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiCallOut,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.title",defaultMessage:"{openJobsCount, plural, one {# job is} other {# jobs are}} not closed",values:{openJobsCount:t}}),color:"warning"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.description1",defaultMessage:"{openJobsCount, plural, one {This job} other {These jobs}} must be closed before {openJobsCount, plural, one {it} other {they}} can be reset. ",values:{openJobsCount:t}}),Object(F.jsx)("br",null),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.openJobsWarningCallout.description2",defaultMessage:"{openJobsCount, plural, one {This job} other {These jobs}} will not be reset when clicking the Reset button below.",values:{openJobsCount:t}})),Object(F.jsx)(c.EuiSpacer,{size:"m"}))},Pe=({setShowFunction:e,unsetShowFunction:t,refreshJobs:s})=>{const[n,l]=Object(a.useState)(!1),[r,d]=Object(a.useState)(!1),[b,j]=Object(a.useState)([]),[m,p]=Object(a.useState)([]),[h,g]=Object(a.useState)(!1),[f,x]=Object(a.useState)(!1);Object(a.useEffect)((()=>("function"==typeof e&&e(O),()=>{"function"==typeof t&&t()})),[]);const O=Object(a.useCallback)((e=>{j(e.map((({id:e})=>e))),p(e),g(e.some((e=>S(e)))),d(!0),l(!1),x(!1)}),[]),y=Object(a.useCallback)((()=>{d(!1)}),[]),C=Object(a.useCallback)((async()=>{l(!0),await Object(u.l)(b,f),y(),setTimeout((()=>{s()}),Re.f)}),[y,f,b,s]);return!1===r||0===b.length?null:Object(F.jsx)(c.EuiModal,{"data-test-subj":"mlResetJobConfirmModal",onClose:y},Object(F.jsx)(c.EuiModalHeader,null,Object(F.jsx)(c.EuiModalHeaderTitle,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetJobsTitle",defaultMessage:"Reset {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:b.length,jobId:b[0]}}))),Object(F.jsx)(c.EuiModalBody,null,Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(ze,{jobs:m}),!0===h?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(Te.a,{jobsCount:b.length,action:M.i18n.translate("xpack.ml.jobsList.startDatafeedsModal.resetManagedDatafeedsDescription",{defaultMessage:"resetting"})}),Object(F.jsx)(c.EuiSpacer,null)):null,Object(F.jsx)(c.EuiText,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetMultipleJobsDescription",defaultMessage:"Resetting {jobsCount, plural, one {a job} other {multiple jobs}} can be time consuming. {jobsCount, plural, one {It} other {They}} will be reset in the background and may not be updated in the jobs list instantly.",values:{jobsCount:b.length}}),Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiSwitch,{label:M.i18n.translate("xpack.ml.jobsList.resetJobModal.deleteUserAnnotations",{defaultMessage:"Delete annotations"}),checked:f,onChange:e=>x(e.target.checked)})))),Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiModalFooter,null,Object(F.jsx)(c.EuiButtonEmpty,{onClick:y,disabled:n},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(F.jsx)(c.EuiButton,{onClick:C,fill:!0,disabled:n,color:"danger","data-test-subj":"mlResetJobConfirmModalButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.resetJobModal.resetButtonLabel",defaultMessage:"Reset"})))))};s(587);class time_range_selector_TimeRangeSelector extends a.Component{constructor(e){super(e),r()(this,"setStartTab",(e=>{switch(this.setState({startTab:e}),e){case 0:this.setStartTime(void 0);break;case 1:this.setStartTime(this.now);break;case 2:this.setStartTime(this.twoWeeksAgo)}})),r()(this,"setEndTab",(e=>{switch(this.setState({endTab:e}),e){case 0:this.setEndTime(void 0);break;case 1:this.setEndTime(this.now)}})),r()(this,"setStartTime",(e=>{this.props.setStartTime(e)})),r()(this,"setEndTime",(e=>{this.props.setEndTime(e)})),this.state={startTab:0,endTab:1},this.latestTimestamp=this.props.startTime,this.now=this.props.now,this.twoWeeksAgo=m()(this.now).subtract(2,"weeks").startOf("day")}getTabItems(){const e={start:m.a.isMoment(this.props.startTime)?this.props.startTime:this.latestTimestamp,end:m.a.isMoment(this.props.endTime)?this.props.endTime:this.now},t=this.latestTimestamp.format(p.a),s=!0==this.latestTimestamp.valueOf()>0?[Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromStartTimeLabel",defaultMessage:"Continue from {formattedLatestStartTime}",values:{formattedLatestStartTime:t}}),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromNowLabel",defaultMessage:"Continue from now"}),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.continueFromSpecifiedTimeLabel",defaultMessage:"Continue from specified time"})]:[Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startAtBeginningOfDataLabel",defaultMessage:"Start at beginning of data"}),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startFromNowLabel",defaultMessage:"Start from now"}),Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyStartTimeLabel",defaultMessage:"Specify start time"})];return{startItems:[{index:0,label:s[0]},{index:1,label:s[1]},{index:2,label:s[2],body:Object(F.jsx)(Ge,{date:e.start,onChange:this.setStartTime,maxDate:e.end,setIsValid:this.props.setTimeRangeValid,tab:this.state.startTab})}],endItems:[{index:0,label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.noEndTimeLabel",defaultMessage:"No end time (Real-time search)"})},{index:1,label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.specifyEndTimeLabel",defaultMessage:"Specify end time"}),body:Object(F.jsx)(Ge,{date:e.end,onChange:this.setEndTime,minDate:e.start,setIsValid:this.props.setTimeRangeValid,tab:this.state.endTab})}]}}render(){const{startItems:e,endItems:t}=this.getTabItems();return Object(F.jsx)("div",{className:"time-range-selector"},!0===this.props.hasManagedJob&&0!==this.state.endTab?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(Te.a,{jobsCount:this.props.jobsCount,message:M.i18n.translate("xpack.ml.jobsList.startDatafeedsModal.startManagedDatafeedsDescription",{defaultMessage:"{jobsCount, plural, one {This job} other {At least one of these jobs}} is preconfigured by Elastic; starting {jobsCount, plural, one {it} other {them}} with a specific end time might impact other parts of the product.",values:{jobsCount:this.props.jobsCount}})}),Object(F.jsx)(c.EuiSpacer,null)):null,Object(F.jsx)(c.EuiFlexGroup,{gutterSize:"s"},Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)(Ve,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchStartTimeTitle",defaultMessage:"Search start time"}),items:e,switchState:this.state.startTab,switchFunc:this.setStartTab})),Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)(Ve,{title:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.searchEndTimeTitle",defaultMessage:"Search end time"}),items:t,switchState:this.state.endTab,switchFunc:this.setEndTab}))))}}function Ve({title:e,items:t,switchState:s,switchFunc:a}){return Object(F.jsx)("div",{className:"time-range-section"},Object(F.jsx)("div",{className:"time-range-section-title"},e),Object(F.jsx)("ul",{className:"tab-stack"},t.map(((e,t)=>{let o="";return s===e.index&&(o+="active "),void 0!==e.body&&(o+="has-body "),Object(F.jsx)("li",{key:t,className:o},Object(F.jsx)("a",{onClick:()=>a(e.index),onKeyUp:()=>{}},e.label),void 0!==e.body&&Object(F.jsx)("div",{className:"body"},e.body))}))))}const Ge=({date:e,onChange:t,minDate:s,setIsValid:i,tab:n})=>{const[l,r]=Object(a.useState)(e.format(p.a)),[d,u]=Object(a.useState)(n);return Object(a.useEffect)((()=>{d!==n&&(r(e.format(p.a)),u(n))}),[n]),Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiFieldText,{value:l,onChange:function(e){const s=e.target.value;r(s);const a=m()(s);a.isValid()?(i(!0),t(a)):i(!1)},placeholder:p.a,"aria-label":M.i18n.translate('xpack.ml.jobsList.startDatafeedModal.enterDateText"',{defaultMessage:"Enter date"})}),Object(F.jsx)(c.EuiDatePicker,{selected:e,onChange:function(e){r(e.format(p.a)),i(!0),t(e)},minDate:s,inline:!0,showTimeSelect:!0}))};class start_datafeed_modal_StartDatafeedModal extends a.Component{constructor(e){super(e),r()(this,"setStartTime",(e=>{this.setState({startTime:e})})),r()(this,"setEndTime",(e=>{this.setState({endTime:e})})),r()(this,"setCreateAlert",(e=>{this.setState({createAlert:e.target.checked})})),r()(this,"closeModal",(()=>{this.setState({isModalVisible:!1})})),r()(this,"setTimeRangeValid",(e=>{this.setState({timeRangeValid:e})})),r()(this,"showModal",((e,t)=>{const s=m()(),a=s,o=function(e){const t=e.map((e=>e.earliestStartTimestampMs||0));return m()(Math.min(...t))}(e),i=e.length>0;this.setState({jobs:e,isModalVisible:!0,startTime:void 0,endTime:a,initialSpecifiedStartTime:o,showCreateAlertFlyout:t,allowCreateAlert:i,createAlert:!1,now:s,hasManagedJob:e.some((e=>S(e)))})})),r()(this,"save",(()=>{const{jobs:e}=this.state,t=m.a.isMoment(this.state.startTime)?this.state.startTime.valueOf():this.state.startTime,s=m.a.isMoment(this.state.endTime)?this.state.endTime.valueOf():this.state.endTime;Object(u.f)(e,t,s,(()=>{this.state.createAlert&&e.length>0&&this.getShowCreateAlertFlyoutFunction()(e.map((e=>e.id))),this.refreshJobs()})),this.closeModal()}));const t=m()();this.state={jobs:this.props.jobs,isModalVisible:!1,startTime:t,endTime:t,createAlert:!1,allowCreateAlert:!1,initialSpecifiedStartTime:t,now:t,timeRangeValid:!0,hasManagedJob:!1},this.initialSpecifiedStartTime=t,this.refreshJobs=this.props.refreshJobs,this.getShowCreateAlertFlyoutFunction=this.props.getShowCreateAlertFlyoutFunction}componentDidMount(){"function"==typeof this.props.setShowFunction&&this.props.setShowFunction(this.showModal)}componentWillUnmount(){"function"==typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}render(){const{jobs:e,initialSpecifiedStartTime:t,startTime:s,endTime:a,createAlert:o,now:n,timeRangeValid:l}=this.state,r=void 0!==e?e.filter((e=>e.hasDatafeed)):[],d=!1===l||void 0!==s&&s===a;let u;return this.state.isModalVisible&&(u=Object(F.jsx)(c.EuiModal,{onClose:this.closeModal,style:{minWidth:"850px"},maxWidth:!1,"data-test-subj":"mlStartDatafeedModal"},Object(F.jsx)(c.EuiModalHeader,null,Object(F.jsx)(c.EuiModalHeaderTitle,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startJobsTitle",defaultMessage:"Start {jobsCount, plural, one {{jobId}} other {# jobs}}",values:{jobsCount:r.length,jobId:r[0].id}}))),Object(F.jsx)(c.EuiModalBody,null,Object(F.jsx)(time_range_selector_TimeRangeSelector,{startTime:void 0===s?t:s,endTime:a,setStartTime:this.setStartTime,setEndTime:this.setEndTime,now:n,setTimeRangeValid:this.setTimeRangeValid,hasManagedJob:this.state.hasManagedJob,jobsCount:r.length}),void 0===this.state.endTime&&Object(F.jsx)("div",{className:"create-watch"},Object(F.jsx)(c.EuiHorizontalRule,null),Object(F.jsx)(c.EuiCheckbox,{id:"createAlert",label:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.createAlertDescription",defaultMessage:"Create alert rule after datafeed has started"}),checked:o,onChange:this.setCreateAlert}))),Object(F.jsx)(c.EuiModalFooter,null,Object(F.jsx)(c.EuiButtonEmpty,{onClick:this.closeModal,"data-test-subj":"mlStartDatafeedModalCancelButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(F.jsx)(c.EuiButton,{onClick:this.save,isDisabled:d,fill:!0,"data-test-subj":"mlStartDatafeedModalStartButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedModal.startButtonLabel",defaultMessage:"Start"}))))),Object(F.jsx)("div",null,u)}}class actions_menu_MultiJobActionsMenuUI extends a.Component{constructor(e){super(e),r()(this,"onButtonClick",(()=>{this.setState((e=>({isOpen:!e.isOpen})))})),r()(this,"closePopover",(()=>{this.setState({isOpen:!1})})),this.state={isOpen:!1},this.canDeleteJob=Object(f.checkPermission)("canDeleteJob"),this.canStartStopDatafeed=Object(f.checkPermission)("canStartStopDatafeed")&&Object(x.e)(),this.canCloseJob=Object(f.checkPermission)("canCloseJob")&&Object(x.e)(),this.canResetJob=Object(f.checkPermission)("canResetJob")&&Object(x.e)(),this.canCreateMlAlerts=Object(f.checkPermission)("canCreateMlAlerts")}render(){const e=this.props.jobs.some((e=>void 0!==e.blocked)),t=Object(F.jsx)(c.EuiButtonIcon,{size:"s",onClick:this.onButtonClick,iconType:"gear","aria-label":M.i18n.translate("xpack.ml.jobsList.multiJobActionsMenu.managementActionsAriaLabel",{defaultMessage:"Management actions"}),color:"text",disabled:e||!1===this.canDeleteJob&&!1===this.canStartStopDatafeed,"data-test-subj":"mlADJobListMultiSelectManagementActionsButton"}),s=[Object(F.jsx)(c.EuiContextMenuItem,{key:"delete",icon:"trash",disabled:!1===this.canDeleteJob,onClick:()=>{this.props.showDeleteJobModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectDeleteJobActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.deleteJobsLabel",defaultMessage:"Delete {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))];return Object(u.g)(this.props.jobs)&&s.push(Object(F.jsx)(c.EuiContextMenuItem,{key:"close job",icon:"cross",disabled:!1===this.canCloseJob,onClick:()=>{this.props.jobs.some((e=>S(e)))?this.props.showCloseJobsConfirmModal(this.props.jobs):Object(u.c)(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCloseJobActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.closeJobsLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))),Object(u.h)(this.props.jobs)&&s.push(Object(F.jsx)(c.EuiContextMenuItem,{key:"reset job",icon:"refresh",disabled:!1===this.canCloseJob,onClick:()=>{this.props.showResetJobModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectResetJobActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.resetJobsLabel",defaultMessage:"Reset {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))),Object(u.j)(this.props.jobs)&&s.push(Object(F.jsx)(c.EuiContextMenuItem,{key:"stop datafeed",icon:"stop",disabled:!1===this.canStartStopDatafeed,onClick:()=>{this.props.jobs.some((e=>S(e)))?this.props.showStopDatafeedsConfirmModal(this.props.jobs):Object(u.m)(this.props.jobs,this.props.refreshJobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStopDatafeedActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.stopDatafeedsLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}}))),Object(u.i)(this.props.jobs)&&s.push(Object(F.jsx)(c.EuiContextMenuItem,{key:"start datafeed",icon:"play",disabled:!1===this.canStartStopDatafeed,onClick:()=>{this.props.showStartDatafeedModal(this.props.jobs),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStartDatafeedActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.startDatafeedsLabel",defaultMessage:"Start {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}}))),this.canCreateMlAlerts&&1===this.props.jobs.length&&s.push(Object(F.jsx)(c.EuiContextMenuItem,{key:"create alert",icon:"bell",disabled:!1,onClick:()=>{this.props.showCreateAlertFlyout(this.props.jobs.map((({id:e})=>e))),this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCreateAlertActionButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.createAlertsLabel",defaultMessage:"Create alert rule"}))),Object(F.jsx)(c.EuiPopover,{button:t,isOpen:this.state.isOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downCenter"},Object(F.jsx)(c.EuiContextMenuPanel,{items:s.reverse()}))}}const Ue=actions_menu_MultiJobActionsMenuUI;function qe({group:e,selectedGroups:t}){return void 0!==t[e.id]?t[e.id].partial?Object(F.jsx)("div",{className:"check selected"},Object(F.jsx)("span",null,"—")):Object(F.jsx)("div",{className:"check selected"},Object(F.jsx)(c.EuiIcon,{type:"check"})):Object(F.jsx)("div",{className:"check"})}class group_list_GroupList extends a.Component{constructor(e){super(e),r()(this,"selectGroup",(e=>{this.props.selectGroup(e)})),r()(this,"moveUp",((e,t)=>{e.preventDefault(),t<0||t>0&&this.selectItems[t-1].focus()})),r()(this,"moveDown",((e,t)=>{e.preventDefault(),t<this.selectItems.length-1&&this.selectItems[t+1].focus()})),r()(this,"handleKeyDown",((e,t,s)=>{switch(e.key){case c.keys.ENTER:case c.keys.SPACE:this.selectGroup(t);break;case c.keys.ARROW_DOWN:this.moveDown(e,s);break;case c.keys.ARROW_UP:this.moveUp(e,s)}})),r()(this,"setRef",((e,t)=>{this.selectItems[t]=e})),this.state={groups:[]},this.selectItems=[]}render(){const{selectedGroups:e,groups:t}=this.props;return Object(F.jsx)(c.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.map(((t,s)=>Object(F.jsx)("div",{tabIndex:"0",onKeyDown:e=>this.handleKeyDown(e,t,s),key:t.id,className:"group-item",onClick:()=>this.selectGroup(t),ref:e=>this.setRef(e,s)},Object(F.jsx)(c.EuiFlexGroup,null,Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(w.a,{name:t.id})),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(qe,{group:t,selectedGroups:e})))))))}}class new_group_input_NewGroupInput extends a.Component{constructor(e){super(e),r()(this,"changeTempNewGroup",(e=>{const t=e.target.value;let s="";s=""===t?"":this.props.allJobIds.includes(t)?M.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.groupsAndJobsCanNotUseSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."}):we([t]).message,this.setState({tempNewGroupName:t,groupsValidationError:s})})),r()(this,"newGroupKeyPress",(e=>{e.key===c.keys.ENTER&&""===this.state.groupsValidationError&&""!==this.state.tempNewGroupName&&this.addNewGroup()})),r()(this,"addNewGroup",(()=>{this.props.addNewGroup(this.state.tempNewGroupName),this.setState({tempNewGroupName:""})})),this.state={tempNewGroupName:"",groupsValidationError:""}}render(){const{tempNewGroupName:e,groupsValidationError:t}=this.state;return Object(F.jsx)("div",null,Object(F.jsx)(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)(c.EuiFormRow,{display:"rowCompressed",isInvalid:""!==t,error:t,className:"new-group-input"},Object(F.jsx)(c.EuiFieldText,{compressed:!0,placeholder:M.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.addNewGroupPlaceholder",{defaultMessage:"Add new group"}),value:e,onChange:this.changeTempNewGroup,onKeyDown:this.newGroupKeyPress,isInvalid:""!==t,error:t}))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiFormRow,{className:"new-group-input"},Object(F.jsx)(c.EuiButtonIcon,{onClick:this.addNewGroup,iconType:"plusInCircle","aria-label":M.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.addButtonAriaLabel",{defaultMessage:"Add"}),disabled:""===e||""!==t})))))}}function We(e,t){const s=e.map((e=>e.id)),a={};return e.forEach((e=>{e.groups.forEach((e=>{void 0===a[e]&&(a[e]=0),a[e]++}))})),t.reduce(((e,t)=>(t.jobIds.some((e=>s.includes(e)))&&(e[t.id]={partial:a[t.id]!==s.length}),e)),{})}class group_selector_GroupSelector extends a.Component{constructor(e){super(e),r()(this,"togglePopover",(()=>{this.state.isPopoverOpen?this.closePopover():d.ml.jobs.groups().then((e=>{const t=We(this.props.jobs,e);this.setState({isPopoverOpen:!0,edited:!1,selectedGroups:t,groups:e})})).catch((e=>{console.error(e)}))})),r()(this,"closePopover",(()=>{this.setState({edited:!1,isPopoverOpen:!1})})),r()(this,"selectGroup",(e=>{const t=Object(b.cloneDeep)(this.state.selectedGroups);void 0===t[e.id]?t[e.id]={partial:!1}:!0===t[e.id].partial?t[e.id].partial=!1:delete t[e.id],this.setState({selectedGroups:t,edited:!0})})),r()(this,"applyChanges",(()=>{const{selectedGroups:e}=this.state,{jobs:t}=this.props,s=t.map((e=>({id:e.id,oldGroups:e.groups,newGroups:[]})));for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];s.forEach((e=>{(!1===a.partial||!0===a.partial&&e.oldGroups.includes(t))&&e.newGroups.push(t)}))}const a=s.map((e=>({jobId:e.id,groups:e.newGroups})));d.ml.jobs.updateGroups(a).then((e=>{let t=!0;for(const s in e)e.hasOwnProperty(s)&&!1===e[s].success&&(Object(Ee.getToastNotificationService)().displayErrorToast(e[s].error),t=!1);t?(this.refreshJobs(),this.closePopover()):console.error(e)})).catch((e=>{Object(Ee.getToastNotificationService)().displayErrorToast(e),console.error(e)}))})),r()(this,"addNewGroup",(e=>{const t={id:e,calendarIds:[],jobIds:[]},s=this.state.groups;!1===s.some((e=>e.id===t.id))&&s.push(t),this.setState({groups:s})})),this.state={isPopoverOpen:!1,groups:[],selectedGroups:{},edited:!1},this.refreshJobs=this.props.refreshJobs,this.canUpdateJob=Object(f.checkPermission)("canUpdateJob")}static getDerivedStateFromProps(e,t){return!1===t.edited?{selectedGroups:We(e.jobs,t.groups)}:{}}render(){const{groups:e,selectedGroups:t,edited:s}=this.state,a=Object(F.jsx)(c.EuiToolTip,{position:"bottom",content:Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonTooltip",defaultMessage:"Edit job groups"})},Object(F.jsx)(c.EuiButtonIcon,{iconType:"indexEdit","aria-label":M.i18n.translate("xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonAriaLabel",{defaultMessage:"Edit job groups"}),onClick:()=>this.togglePopover(),disabled:!1===this.canUpdateJob,"data-test-subj":"mlADJobListMultiSelectEditJobGroupsButton"}));return Object(F.jsx)(c.EuiPopover,{id:"trapFocus",ownFocus:!0,button:a,isOpen:this.state.isPopoverOpen,closePopover:()=>this.closePopover()},Object(F.jsx)("div",null,Object(F.jsx)(c.EuiPopoverTitle,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyGroupsToJobTitle",defaultMessage:"Apply groups to {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}})),Object(F.jsx)(group_list_GroupList,{groups:e,selectedGroups:t,selectGroup:this.selectGroup}),Object(F.jsx)(c.EuiHorizontalRule,{margin:"xs"}),Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)(new_group_input_NewGroupInput,{addNewGroup:this.addNewGroup,allJobIds:this.props.allJobIds}),Object(F.jsx)(c.EuiHorizontalRule,{margin:"m"}),Object(F.jsx)("div",null,Object(F.jsx)(c.EuiFlexGroup,null,Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiButton,{size:"s",onClick:this.applyChanges,isDisabled:!1===s},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyButtonLabel",defaultMessage:"Apply"})))))))}}const He={name:"1tntaqb",styles:"height:20px;width:1px;display:inline-block;vertical-align:middle;margin:0 5px"};class multi_job_actions_MultiJobActions extends a.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.selectedJobs.length>0;return Object(F.jsx)("div",{"data-test-subj":"mlADJobListMultiSelectActionsArea "+(e?"active":"inactive")},e?Object(F.jsx)(c.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",wrap:!1,direction:"row",responsive:!1},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(c.EuiTitle,{size:"s"},Object(F.jsx)("h3",null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.multiJobsActions.jobsSelectedLabel",defaultMessage:"{selectedJobsCount, plural, one {# job} other {# jobs}}   selected",values:{selectedJobsCount:this.props.selectedJobs.length}})))),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)("div",{css:He})),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(D,{jobs:this.props.selectedJobs})),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(group_selector_GroupSelector,{jobs:this.props.selectedJobs,allJobIds:this.props.allJobIds,refreshJobs:this.props.refreshJobs})),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(Ue,{jobs:this.props.selectedJobs,showCloseJobsConfirmModal:this.props.showCloseJobsConfirmModal,showStartDatafeedModal:this.props.showStartDatafeedModal,showDeleteJobModal:this.props.showDeleteJobModal,showResetJobModal:this.props.showResetJobModal,showStopDatafeedsConfirmModal:this.props.showStopDatafeedsConfirmModal,refreshJobs:this.props.refreshJobs,showCreateAlertFlyout:this.props.showCreateAlertFlyout}))):null)}}var Qe=s(34);function $e(){const e=Object(f.usePermissionCheck)("canCreateJob")&&Object(x.e)(),t=Object(Qe.a)(ce.b.ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX);return Object(F.jsx)(c.EuiButton,{"data-test-subj":"mlCreateNewJobButton",onClick:t,size:"s",disabled:!1===e,fill:!0,iconType:"plusInCircle"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.createNewJobButtonLabel",defaultMessage:"Create job"}))}var Ye=s(227);const Ke=({jobsSummaryList:e,showNodeInfo:t})=>{const s=function(e,t){const s={...t?{activeNodes:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:!0}}:{},total:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:!0},open:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:!0},closed:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:!0},failed:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:!1},activeDatafeeds:{label:M.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:!0}};if(void 0===e)return s;const a={};let o=0;return e.forEach((e=>{e.jobState===te.c.OPENED?s.open.value++:e.jobState===te.c.CLOSED?s.closed.value++:e.jobState===te.c.FAILED&&o++,e.hasDatafeed&&e.datafeedState===te.a.STARTED&&s.activeDatafeeds.value++,void 0!==e.nodeName&&(a[e.nodeName]={})})),s.total.value=e.length,o?(s.failed.value=o,s.failed.show=!0):s.failed.show=!1,t&&(s.activeNodes.value=Object.keys(a).length),s}(e,t);return Object(F.jsx)(Ye.a,{stats:s,dataTestSub:"mlJobStatsBar"})};var Xe=s(51),Ze=s(188),et=s(169),tt=s(209);const st=({setShowFunction:e,unsetShowFunction:t,refreshJobs:s})=>{const[n,l]=Object(a.useState)(!1),[r,d]=Object(a.useState)(!0),[b,j]=Object(a.useState)([]),m=Object(a.useMemo)((()=>b.map((({id:e})=>e))),[b]);Object(a.useEffect)((()=>("function"==typeof e&&e(p),()=>{"function"==typeof t&&t()})),[]);const p=Object(a.useCallback)((e=>{j(e),e.some((e=>S(e)))&&(l(!0),d(!0))}),[]),h=Object(a.useCallback)((()=>{l(!1),d(!1)}),[]);if(!1===n)return null;if(r){const e=Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsModal.stopDatafeedsTitle",defaultMessage:"Stop datafeed for {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:m.length,jobId:m[0]}});return Object(F.jsx)(c.EuiModal,{"data-test-subj":"mlStopDatafeedsConfirmModal",onClose:h},Object(F.jsx)(c.EuiModalHeader,null,Object(F.jsx)(c.EuiModalHeaderTitle,null,e)),Object(F.jsx)(c.EuiModalBody,null,Object(F.jsx)(Te.a,{jobsCount:m.length,action:M.i18n.translate("xpack.ml.jobsList.stopDatafeedsModal.stopManagedDatafeedsDescription",{defaultMessage:"stopping"})})),Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiModalFooter,null,Object(F.jsx)(c.EuiButtonEmpty,{onClick:h},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsConfirmModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(F.jsx)(c.EuiButton,{onClick:()=>{Object(u.m)(b,s),h()},fill:!0,color:"danger","data-test-subj":"mlStopDatafeedsConfirmModalButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.stopDatafeedsConfirmModal.stopButtonLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:m.length}})))))}return Object(F.jsx)(o.a.Fragment,null)},at=({setShowFunction:e,unsetShowFunction:t,refreshJobs:s})=>{const[n,l]=Object(a.useState)(!1),[r,d]=Object(a.useState)(!0),[b,j]=Object(a.useState)([]),m=Object(a.useMemo)((()=>b.map((({id:e})=>e))),[b]);Object(a.useEffect)((()=>("function"==typeof e&&e(p),()=>{"function"==typeof t&&t()})),[]);const p=Object(a.useCallback)((e=>{j(e),e.some((e=>S(e)))&&(l(!0),d(!0))}),[]),h=Object(a.useCallback)((()=>{l(!1),d(!1)}),[]);if(!1===n)return null;if(r){const e=Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsModal.closeDatafeedsTitle",defaultMessage:"Close {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:m.length,jobId:m[0]}});return Object(F.jsx)(c.EuiModal,{"data-test-subj":"mlCloseJobsConfirmModal",onClose:h},Object(F.jsx)(c.EuiModalHeader,null,Object(F.jsx)(c.EuiModalHeaderTitle,null,e)),Object(F.jsx)(c.EuiModalBody,null,Object(F.jsx)(Te.a,{jobsCount:m.length,action:M.i18n.translate("xpack.ml.jobsList.closeJobsModal.closeManagedDatafeedsDescription",{defaultMessage:"closing"})})),Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiSpacer,null),Object(F.jsx)(c.EuiModalFooter,null,Object(F.jsx)(c.EuiButtonEmpty,{onClick:h},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsConfirmModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(F.jsx)(c.EuiButton,{onClick:()=>{Object(u.c)(b,s),h()},fill:!0,color:"danger","data-test-subj":"mlCloseJobsConfirmModalButton"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.startDatafeedsConfirmModal.closeButtonLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:m.length}})))))}return Object(F.jsx)(o.a.Fragment,null)};var ot=s(276);let it=null;var nt={name:"hz1qxh",styles:"align-items:center;min-height:60px"};class jobs_list_view_JobsListView extends a.Component{constructor(e){super(e),r()(this,"toggleRow",(e=>{if(this.state.itemIdToExpandedRowMap[e]){const t={...this.state.itemIdToExpandedRowMap};delete t[e],this.setState({itemIdToExpandedRowMap:t})}else{const t=this.state.jobsSummaryList.filter((t=>t.id===e)),s=t.length>0&&void 0!==t[0].auditMessage;let a={...this.state.itemIdToExpandedRowMap};void 0!==this.state.fullJobsList[e]?a[e]=Object(F.jsx)(me,{jobId:e,job:this.state.fullJobsList[e],addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:s}):a[e]=Object(F.jsx)(me,{jobId:e,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:s}),this.setState({itemIdToExpandedRowMap:a},(()=>{Object(u.k)(e).then((t=>{const o={...this.state.fullJobsList};!1===this.props.showNodeInfo&&(t=Object(q.u)(t)),o[e]=t,this.setState({fullJobsList:o},(()=>{a={...this.state.itemIdToExpandedRowMap},void 0!==a[e]&&(a[e]=Object(F.jsx)(me,{jobId:e,job:t,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,refreshJobList:this.onRefreshClick,showClearButton:s})),this.setState({itemIdToExpandedRowMap:a},(()=>{this.updateFunctions[e](t)}))}))})).catch((e=>{console.error(e)}))}))}})),r()(this,"addUpdateFunction",((e,t)=>{this.updateFunctions[e]=t})),r()(this,"removeUpdateFunction",(e=>{delete this.updateFunctions[e]})),r()(this,"setShowEditJobFlyoutFunction",(e=>{this.showEditJobFlyout=e})),r()(this,"unsetShowEditJobFlyoutFunction",(()=>{this.showEditJobFlyout=()=>{}})),r()(this,"setShowDatafeedChartFlyoutFunction",(e=>{this.showDatafeedChartFlyout=e})),r()(this,"unsetShowDatafeedChartFlyoutFunction",(()=>{this.showDatafeedChartFlyout=()=>{}})),r()(this,"setShowStopDatafeedsConfirmModalFunction",(e=>{this.showStopDatafeedsConfirmModal=e})),r()(this,"unsetShowStopDatafeedsConfirmModalFunction",(()=>{this.showStopDatafeedsConfirmModal=()=>{}})),r()(this,"setShowCloseJobsConfirmModalFunction",(e=>{this.showCloseJobsConfirmModal=e})),r()(this,"unsetShowCloseJobsConfirmModalFunction",(()=>{this.showCloseJobsConfirmModal=()=>{}})),r()(this,"setShowDeleteJobModalFunction",(e=>{this.showDeleteJobModal=e})),r()(this,"unsetShowDeleteJobModalFunction",(()=>{this.showDeleteJobModal=()=>{}})),r()(this,"setShowResetJobModalFunction",(e=>{this.showResetJobModal=e})),r()(this,"unsetShowResetJobModalFunction",(()=>{this.showResetJobModal=()=>{}})),r()(this,"setShowStartDatafeedModalFunction",(e=>{this.showStartDatafeedModal=e})),r()(this,"unsetShowStartDatafeedModalFunction",(()=>{this.showStartDatafeedModal=()=>{}})),r()(this,"setShowCreateAlertFlyoutFunction",(e=>{this.showCreateAlertFlyout=e})),r()(this,"unsetShowCreateAlertFlyoutFunction",(()=>{this.showCreateAlertFlyout=()=>{}})),r()(this,"getShowCreateAlertFlyoutFunction",(()=>this.showCreateAlertFlyout)),r()(this,"selectJobChange",(e=>{this.setState({selectedJobs:e})})),r()(this,"setFilters",(async e=>{if(null===e)return void this.setState({filteredJobsSummaryList:this.state.jobsSummaryList,filterClauses:[]},(()=>{this.refreshSelectedJobs()}));this.props.onJobsViewStateUpdate({queryText:null==e?void 0:e.text},!1===this._isFiltersSet);const t=e&&e.ast&&e.ast.clauses||[];if(0===t.length)return void this.setState({filteredJobsSummaryList:this.state.jobsSummaryList,filterClauses:t},(()=>{this.refreshSelectedJobs()}));const s=Object(u.e)(this.state.jobsSummaryList,t);this.setState({filteredJobsSummaryList:s,filterClauses:t},(()=>{this.refreshSelectedJobs()})),this._isFiltersSet=!0})),r()(this,"onRefreshClick",(()=>{this.setState({isRefreshing:!0}),this.refreshJobSummaryList()})),r()(this,"isDoneRefreshing",(()=>{this.setState({isRefreshing:!1})})),this.state={isRefreshing:!1,loading:null,jobsSummaryList:[],filteredJobsSummaryList:[],fullJobsList:{},selectedJobs:[],itemIdToExpandedRowMap:{},filterClauses:[],blockingJobIds:[],blockingJobsFirstFoundMs:null,jobsAwaitingNodeCount:0},this.updateFunctions={},this.showEditJobFlyout=()=>{},this.showDatafeedChartFlyout=()=>{},this.showStopDatafeedsConfirmModal=()=>{},this.showCloseJobsConfirmModal=()=>{},this.showDeleteJobModal=()=>{},this.showResetJobModal=()=>{},this.showStartDatafeedModal=()=>{},this.showCreateAlertFlyout=()=>{},this._isMounted=!1,this._isFiltersSet=!1}componentDidMount(){this._isMounted=!0,this.refreshJobSummaryList(),this.openAutoStartDatafeedModal()}componentDidUpdate(e){e.lastRefresh!==this.props.lastRefresh&&(this.setState({isRefreshing:!0}),this.refreshJobSummaryList())}componentWillUnmount(){it=null,this._isMounted=!1}openAutoStartDatafeedModal(){const e=Object(u.a)();void 0!==e&&this.showStartDatafeedModal([e])}refreshSelectedJobs(){var e;const t=this.state.selectedJobs.map((e=>e.id)),s=(null!==(e=this.state.filteredJobsSummaryList)&&void 0!==e?e:[]).map((e=>e.id)),a=this.state.jobsSummaryList.filter((e=>t.find((t=>t===e.id)))).filter((e=>s.find((t=>t===e.id))));this.setState({selectedJobs:a})}async refreshJobSummaryList(){if(!1===this._isMounted)return;null===this.state.loading&&this.setState({loading:!0});const e=Object.keys(this.state.itemIdToExpandedRowMap);try{let t=0;const s=await d.ml.jobs.jobsSummary(e),a={},o=s.map((e=>(void 0!==e.fullJob&&(!1===this.props.showNodeInfo&&(e.fullJob=Object(q.u)(e.fullJob)),a[e.id]=e.fullJob,delete e.fullJob),e.latestTimestampSortValue=e.latestTimestampMs||0,!0===e.awaitingNodeAssignment&&t++,e))),i=Object(u.e)(o,this.state.filterClauses);this.setState({jobsSummaryList:o,filteredJobsSummaryList:i,fullJobsList:a,loading:!1,jobsAwaitingNodeCount:t},(()=>{this.refreshSelectedJobs()})),Object.keys(this.updateFunctions).forEach((e=>{this.updateFunctions[e](a[e])})),this.isDoneRefreshing(),o.some((e=>void 0!==e.blocked))?(this.checkBlockingJobTasks(!0),null===this.state.blockingJobsFirstFoundMs&&this.setState({blockingJobsFirstFoundMs:Date.now()})):this.setState({blockingJobsFirstFoundMs:null})}catch(e){console.error(e),this.setState({loading:!1})}}async checkBlockingJobTasks(e=!1){if(!1===this._isMounted||null!==it)return;const{jobs:t}=await d.ml.jobs.blockingJobTasks(),s=t.map((e=>Object.keys(e)[0])).sort(),a=s.join()!==this.state.blockingJobIds.join();this.setState({blockingJobIds:s}),(a||e)&&this.refreshJobSummaryList(),(null!==this.state.blockingJobsFirstFoundMs||s.length>0)&&(it=setTimeout((()=>{it=null,this.checkBlockingJobTasks()}),this.getBlockedJobsRefreshInterval()))}getBlockedJobsRefreshInterval(){return Date.now()-this.state.blockingJobsFirstFoundMs>Re.c?Re.b:Re.a}renderJobsListComponents(){const{isRefreshing:e,loading:t,jobsSummaryList:s,jobsAwaitingNodeCount:a}=this.state,i=s.map((e=>e.id)),n=!t&&0===i.length;return Object(F.jsx)("div",{"data-test-subj":"ml-jobs-list"},Object(F.jsx)(Xe.b,null),Object(F.jsx)(Ze.a,{jobCount:a}),Object(F.jsx)(et.a,{onCloseFlyout:this.onRefreshClick,forceRefresh:t||e}),Object(F.jsx)(tt.a,null),Object(F.jsx)(o.a.Fragment,null,n?Object(F.jsx)(ot.a,null):null,i.length>0?Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(c.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(Ke,{jobsSummaryList:s,showNodeInfo:this.props.showNodeInfo})),Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)($e,null))),Object(F.jsx)(c.EuiSpacer,{size:"s"}),Object(F.jsx)("div",null,Object(F.jsx)(c.EuiFlexGroup,{css:nt,gutterSize:"none"},Object(F.jsx)(c.EuiFlexItem,{grow:!1},Object(F.jsx)(multi_job_actions_MultiJobActions,{selectedJobs:this.state.selectedJobs,allJobIds:i,showCloseJobsConfirmModal:this.showCloseJobsConfirmModal,showStartDatafeedModal:this.showStartDatafeedModal,showDeleteJobModal:this.showDeleteJobModal,showResetJobModal:this.showResetJobModal,showCreateAlertFlyout:this.showCreateAlertFlyout,showStopDatafeedsConfirmModal:this.showStopDatafeedsConfirmModal,refreshJobs:()=>this.refreshJobSummaryList()})),Object(F.jsx)(c.EuiFlexItem,null,Object(F.jsx)(pe,{setFilters:this.setFilters,queryText:this.props.jobsViewState.queryText}))),Object(F.jsx)(jobs_list_JobsList,{jobsSummaryList:this.state.filteredJobsSummaryList,fullJobsList:this.state.fullJobsList,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,showEditJobFlyout:this.showEditJobFlyout,showDatafeedChartFlyout:this.showDatafeedChartFlyout,showDeleteJobModal:this.showDeleteJobModal,showResetJobModal:this.showResetJobModal,showCloseJobsConfirmModal:this.showCloseJobsConfirmModal,showStartDatafeedModal:this.showStartDatafeedModal,showStopDatafeedsConfirmModal:this.showStopDatafeedsConfirmModal,refreshJobs:()=>this.refreshJobSummaryList(),jobsViewState:this.props.jobsViewState,onJobsViewStateUpdate:this.props.onJobsViewStateUpdate,selectedJobsCount:this.state.selectedJobs.length,showCreateAlertFlyout:this.showCreateAlertFlyout,loading:t}))):null,Object(F.jsx)(Ae,{setShowFunction:this.setShowEditJobFlyoutFunction,unsetShowFunction:this.unsetShowEditJobFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList(),allJobIds:i}),Object(F.jsx)(K.b,{setShowFunction:this.setShowDatafeedChartFlyoutFunction,unsetShowFunction:this.unsetShowDatafeedChartFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(F.jsx)(st,{setShowFunction:this.setShowStopDatafeedsConfirmModalFunction,unsetShowFunction:this.unsetShowStopDatafeedsConfirmModalFunction,refreshJobs:()=>this.refreshJobSummaryList(),allJobIds:i}),Object(F.jsx)(at,{setShowFunction:this.setShowCloseJobsConfirmModalFunction,unsetShowFunction:this.unsetShowCloseJobsConfirmModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(F.jsx)(Be,{setShowFunction:this.setShowDeleteJobModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(F.jsx)(Pe,{setShowFunction:this.setShowResetJobModalFunction,unsetShowFunction:this.unsetShowResetJobModalFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(F.jsx)(start_datafeed_modal_StartDatafeedModal,{setShowFunction:this.setShowStartDatafeedModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,getShowCreateAlertFlyoutFunction:this.getShowCreateAlertFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList()}),Object(F.jsx)(P.b,{setShowFunction:this.setShowCreateAlertFlyoutFunction,unsetShowFunction:this.unsetShowCreateAlertFlyoutFunction,onSave:this.onRefreshClick})))}render(){return Object(F.jsx)("div",null,this.renderJobsListComponents())}}var lt=s(142),rt=s(134),ct=s(330),dt=s(155),ut=s(416);const bt=({children:e})=>{const{services:t}=Object(W.d)(),{setHeaderActionMenu:s}=Object(a.useContext)(ut.b),o=Object(a.useMemo)((()=>Object(ct.c)()),[]);return Object(a.useEffect)((()=>{if(s)return s((e=>Object(dt.a)(Object(F.jsx)(ne.KibanaContextProvider,{services:t},Object(F.jsx)(ct.b,{node:o})),t)(e))),()=>{o.unmount(),s(void 0)}}),[o,s,t]),Object(F.jsx)(ct.a,{node:o},e)},jt=()=>{const e=Object(W.h)(),t=Object(W.g)();return Object(F.jsx)(c.EuiButtonEmpty,{onClick:async()=>{if(!t)return;const s=await t.getUrl({page:ce.b.SETTINGS});e(s)},iconType:"gear"},Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.navMenu.settingsTabLinkText",defaultMessage:"Settings"}))},mt=({isMlEnabledInSpace:e,lastRefresh:t})=>{const[s,a]=Object(n.c)(ce.b.ANOMALY_DETECTION_JOBS_MANAGE,{pageIndex:0,pageSize:10,sortField:"id",sortDirection:"asc"}),{services:{docLinks:l}}=Object(W.d)(),{showNodeInfo:r}=Object(U.d)(),c=l.links.ml.anomalyDetection;return Object(F.jsx)(o.a.Fragment,null,Object(F.jsx)(rt.a,null,Object(F.jsx)(i.FormattedMessage,{id:"xpack.ml.jobsList.title",defaultMessage:"Anomaly Detection Jobs"})),Object(F.jsx)(bt,null,Object(F.jsx)(jt,null)),Object(F.jsx)(jobs_list_view_JobsListView,{isMlEnabledInSpace:e,lastRefresh:t,jobsViewState:s,onJobsViewStateUpdate:a,showNodeInfo:r}),Object(F.jsx)(lt.a,{docLink:c}))}}}]);