/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[80],{156:function(e,i,t){"use strict";t.d(i,"a",(function(){return n})),t.d(i,"b",(function(){return r})),t.d(i,"c",(function(){return s}));let a=null;function s(e){return a=e,a}function n(){return null!==a&&a.hasLicenseExpired()}function r(){return null!==a&&a.isFullLicense()}},70:function(e,i,t){"use strict";t.r(i),t.d(i,"MlCapabilitiesService",(function(){return check_capabilities_MlCapabilitiesService})),t.d(i,"usePermissionCheck",(function(){return f})),t.d(i,"useUpgradeCheck",(function(){return v})),t.d(i,"checkGetManagementMlJobsResolver",(function(){return _})),t.d(i,"checkCreateJobsCapabilitiesResolver",(function(){return P})),t.d(i,"checkPermission",(function(){return C})),t.d(i,"createPermissionFailureMessage",(function(){return $}));var a=t(4),s=t.n(a),n=t(5),r=t(7),l=t(8),c=t(26),o=t.n(c),u=t(2),p=t(10),d=t(156),b=t(50),m=t(11);let h=Object(b.a)();const g=3e5;class check_capabilities_MlCapabilitiesService{constructor(e){s()(this,"_isLoading$",new r.BehaviorSubject(!0)),s()(this,"_updateRequested$",new r.BehaviorSubject(Date.now())),s()(this,"_capabilities$",new r.BehaviorSubject(null)),s()(this,"_capabilitiesObs$",this._capabilities$.asObservable()),s()(this,"_isPlatinumOrTrialLicense$",new r.BehaviorSubject(null)),s()(this,"_mlFeatureEnabledInSpace$",new r.BehaviorSubject(null)),s()(this,"_isUpgradeInProgress$",new r.BehaviorSubject(null)),s()(this,"capabilities$",this._capabilities$.pipe(Object(r.distinctUntilChanged)(l.isEqual))),s()(this,"_subscription",void 0),this.mlApiServices=e,this.init()}init(){this._subscription=Object(r.combineLatest)([this._updateRequested$,Object(r.timer)(0,g)]).pipe(Object(r.tap)((()=>{this._isLoading$.next(!0)})),Object(r.switchMap)((()=>Object(r.from)(this.mlApiServices.checkMlCapabilities()))),Object(r.retry)({delay:g})).subscribe((e=>{this._capabilities$.next(e.capabilities),this._isPlatinumOrTrialLicense$.next(e.isPlatinumOrTrialLicense),this._mlFeatureEnabledInSpace$.next(e.mlFeatureEnabledInSpace),this._isUpgradeInProgress$.next(e.upgradeInProgress),this._isLoading$.next(!1),h=e.capabilities}))}getCapabilities(){return this._capabilities$.getValue()}isPlatinumOrTrialLicense(){return this._isPlatinumOrTrialLicense$.getValue()}mlFeatureEnabledInSpace(){return this._mlFeatureEnabledInSpace$.getValue()}isUpgradeInProgress$(){return this._isUpgradeInProgress$}isUpgradeInProgress(){return this._isUpgradeInProgress$.getValue()}getCapabilities$(){return this._capabilitiesObs$}refreshCapabilities(){this._updateRequested$.next(Date.now())}destroy(){this._subscription&&this._subscription.unsubscribe()}}function f(e){const{services:{mlServices:{mlCapabilities:i}}}=Object(p.d)(),t=Object(u.useRef)(e),a=o()(i.capabilities$,i.getCapabilities());return Object(u.useMemo)((()=>Array.isArray(t.current)?t.current.map((e=>a[e])):a[t.current]),[a])}function v(){const{services:{mlServices:{mlCapabilities:e}}}=Object(p.d)(),i=o()(e.isUpgradeInProgress$(),e.isUpgradeInProgress());return null!=i&&i}function _({mlCapabilities:e}){return new Promise((async(i,t)=>{try{const a=await Object(r.firstValueFrom)(e.getCapabilities$().pipe(Object(r.filter)((e=>!!e))));return null===a?t():(h=a,!0===(a.isADEnabled&&a.canCreateJob||a.isDFAEnabled&&a.canCreateDataFrameAnalytics||a.isNLPEnabled&&a.canCreateTrainedModels)?i():t({capabilities:a,isPlatinumOrTrialLicense:e.isPlatinumOrTrialLicense(),mlFeatureEnabledInSpace:e.mlFeatureEnabledInSpace(),isUpgradeInProgress:e.isUpgradeInProgress()}))}catch(e){t(e)}}))}function P(e){return new Promise(((i,t)=>{m.ml.checkMlCapabilities().then((async({capabilities:a,isPlatinumOrTrialLicense:s})=>(h=a,h.canCreateJob||!1===s?i(h):(await e(),t())))).catch((async i=>(await e(),t())))}))}function C(e){const i=Object(d.a)();return!0===h[e]&&!0!==i}function $(e){let i="";return Object(d.a)()?i=n.i18n.translate("xpack.ml.privilege.licenseHasExpiredTooltip",{defaultMessage:"Your license has expired."}):"canCreateJob"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.createMLJobsTooltip",{defaultMessage:"You do not have permission to create Machine Learning jobs."}):"canStartStopDatafeed"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.startOrStopDatafeedsTooltip",{defaultMessage:"You do not have permission to start or stop datafeeds."}):"canUpdateJob"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.editJobsTooltip",{defaultMessage:"You do not have permission to edit jobs."}):"canDeleteJob"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.deleteJobsTooltip",{defaultMessage:"You do not have permission to delete jobs."}):"canCreateCalendar"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.createCalendarsTooltip",{defaultMessage:"You do not have permission to create calendars."}):"canDeleteCalendar"===e?i=n.i18n.translate("xpack.ml.privilege.noPermission.deleteCalendarsTooltip",{defaultMessage:"You do not have permission to delete calendars."}):"canForecastJob"===e&&(i=n.i18n.translate("xpack.ml.privilege.noPermission.runForecastsTooltip",{defaultMessage:"You do not have permission to run forecasts."})),n.i18n.translate("xpack.ml.privilege.pleaseContactAdministratorTooltip",{defaultMessage:"{message} Please contact your administrator.",values:{message:i}})}}}]);