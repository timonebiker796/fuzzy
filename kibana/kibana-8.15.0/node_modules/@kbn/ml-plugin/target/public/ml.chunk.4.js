/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[4],{146:function(e,t,a){"use strict";a.d(t,"d",(function(){return l})),a.d(t,"e",(function(){return u})),a.d(t,"i",(function(){return d})),a.d(t,"h",(function(){return f})),a.d(t,"g",(function(){return m})),a.d(t,"b",(function(){return b})),a.d(t,"l",(function(){return p})),a.d(t,"m",(function(){return y})),a.d(t,"a",(function(){return O})),a.d(t,"f",(function(){return g})),a.d(t,"c",(function(){return v})),a.d(t,"k",(function(){return x})),a.d(t,"j",(function(){return A}));var n=a(2),i=a(7),r=a(8),s=a(322),o=a(218),c=a(11);const l=1e3,u={match_all:{}},d=e=>{if(void 0===e)return!1;const t=Object.keys(e);return 1===t.length&&"bool"===t[0]},f=e=>{var t,a;const n=Object.keys(e);return 1===n.length&&n[0]===o.b.REGRESSION&&void 0!==(null==e||null===(t=e.regression)||void 0===t?void 0:t.mse)&&void 0!==(null==e||null===(a=e.regression)||void 0===a?void 0:a.r_squared)},m=e=>{var t,a;const n=Object.keys(e);return 1===n.length&&n[0]===o.b.CLASSIFICATION&&(void 0!==(null==e||null===(t=e.classification)||void 0===t?void 0:t.multiclass_confusion_matrix)||void 0!==(null==e||null===(a=e.classification)||void 0===a?void 0:a.auc_roc))};let b=function(e){return e.ERROR="error",e.IDLE="idle",e.LOADING="loading",e.REFRESH="refresh",e}({});const p=new i.BehaviorSubject(b.IDLE),y=(e={})=>(Object(n.useEffect)((()=>{const t=p.pipe(Object(i.distinctUntilChanged)()),a=[];return"function"==typeof e.onRefresh&&a.push(t.pipe(Object(i.filter)((e=>e===b.REFRESH))).subscribe((()=>{"function"==typeof e.onRefresh&&e.onRefresh()}))),"function"==typeof e.isLoading&&a.push(t.subscribe((t=>"function"==typeof e.isLoading&&e.isLoading(t===b.LOADING)))),()=>{a.map((e=>e.unsubscribe()))}}),[e.onRefresh]),{refresh:()=>{p.next(b.REFRESH),p.next(b.LOADING)}}),h=3,O="--";function g(e){const t={mse:O,msle:O,huber:O,r_squared:O};if(null!=e&&e.regression)for(const n in e.regression)if(e.regression.hasOwnProperty(n)){var a;let i=null===(a=e.regression[n])||void 0===a?void 0:a.value;i&&Number.isFinite(i)&&(i=Number(i.toPrecision(h))),t[n]=i}return t}function j({resultsField:e,isTraining:t,searchQuery:a,ignoreDefaultQuery:n}){let i;const s={term:{[`${e}.is_training`]:{value:t}}},o=Object(r.cloneDeep)(a);return d(o)?(void 0===o.bool.must&&(o.bool.must=[]),void 0!==t&&o.bool.must.push(s),i=o):(e=>{if(void 0===e)return!1;const t=Object.keys(e);return 1===t.length&&"query_string"===t[0]})(o)?(i={bool:{must:[o]}},void 0!==t&&i.bool.must.push(s)):i={bool:{must:void 0!==t?[s]:[]}},i}let v=function(e){return e.MSE="mse",e.MSLE="msle",e.R_SQUARED="rSquared",e.HUBER="huber",e}({});const x=async({isTraining:e,index:t,dependentVariable:a,resultsField:n,predictionFieldName:i,searchQuery:r,ignoreDefaultQuery:l,jobType:u,requiresKeyword:d,rocCurveClassName:f,includeMulticlassConfusionMatrix:m=!0})=>{const b={success:!1,eval:null,error:null};let p=`${n}.${i||`${a}_prediction`}`;u===o.b.CLASSIFICATION&&!0===d&&(p=`${p}.keyword`);const y={classification:{accuracy:{},recall:{},...m?{multiclass_confusion_matrix:{}}:{},...void 0!==f?{auc_roc:{include_curve:!0,class_name:f}}:{}},regression:{r_squared:{},mse:{},msle:{},huber:{}}},h={index:t,query:j({resultsField:n,isTraining:e,searchQuery:r,ignoreDefaultQuery:l}),evaluation:{[u]:{actual_field:a,predicted_field:p,...u===o.b.CLASSIFICATION?{top_classes_field:`${n}.top_classes`}:{},metrics:y[u]}}};try{const e=await c.ml.dataFrameAnalytics.evaluateDataFrameAnalytics(h);return b.success=!0,b.eval=e,b}catch(e){return b.error=Object(s.a)(e),b}},A=async({ignoreDefaultQuery:e=!0,isTraining:t,searchQuery:a,resultsField:n,destIndex:i})=>{const r=j({resultsField:n,isTraining:t,ignoreDefaultQuery:e,searchQuery:a});try{const e={track_total_hits:!0,query:r},t=await c.ml.esSearch({index:i,size:0,body:e}),a=t.hits.total&&t.hits.total.value;return{docsCount:a,success:void 0!==a}}catch(e){return{docsCount:null,success:!1}}}},148:function(e,t,a){"use strict";a.d(t,"k",(function(){return n.l})),a.d(t,"m",(function(){return n.m})),a.d(t,"a",(function(){return n.b})),a.d(t,"h",(function(){return n.f})),a.d(t,"j",(function(){return n.k})),a.d(t,"i",(function(){return n.j})),a.d(t,"b",(function(){return n.d})),a.d(t,"c",(function(){return n.e})),a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return u.a})),a.d(t,"g",(function(){return d.a})),a.d(t,"l",(function(){return J})),a.d(t,"n",(function(){return ee}));var n=a(146),i=a(322),r=a(229),s=a(11),o=a(215);const c=async(e,t,a,n)=>{if(void 0!==e){const{pagination:c,setErrorMessage:l,setRowCountInfo:u,setStatus:d,setTableItems:f,sortingColumns:m}=t;l(""),d(r.b.LOADING);try{const t=m.map((e=>{const{id:t}=e;return e.id=o.a.isKeywordAndTextType(t)?`${t}.keyword`:t,e})).reduce(((e,t)=>(e[t.id]={order:t.direction},e)),{}),{pageIndex:i,pageSize:l}=c,b=await s.ml.esSearch({index:e.dest.index,body:{fields:["*"],_source:!1,query:a,from:i*l,size:l,...Object.keys(t).length>0?{sort:t}:{}}});n.didCancel||(u({rowCount:"number"==typeof b.hits.total?b.hits.total:b.hits.total.value,rowCountRelation:"number"==typeof b.hits.total?"eq":b.hits.total.relation}),f(b.hits.hits.map((t=>{var a;return Object(r.l)(null!==(a=t.fields)&&void 0!==a?a:{},(t=>t.startsWith(`${e.dest.results_field}.feature_importance`)||t.startsWith(`${e.dest.results_field}.feature_influence`)))}))),d(r.b.LOADED))}catch(e){l(Object(i.a)(e)),d(r.b.ERROR)}}},l=(e,t)=>{if(void 0!==e){const{selectedFields:a,docFields:n}=o.a.getDefaultFields(e,t),i={},r=[];return n.forEach((e=>{i[e.id]=e.type,r.push(e.id)})),{defaultSelectedFields:a.map((e=>e.id)),fieldTypes:i,tableFields:r}}return{defaultSelectedFields:[],fieldTypes:{},tableFields:[]}};var u=a(291),d=a(351),f=a(2),m=a.n(f),b=a(25),p=a(218),y=a(15),h=a(831),O=a(145),g=a.n(O),j=a(5);const v="feature_name",x="importance",A=1e-5,S=j.i18n.translate("xpack.ml.dataframe.analytics.decisionPathFeatureOtherTitle",{defaultMessage:"other"}),I=e=>Array.isArray(e)&&e.length>0&&3===e[0].length,_=e=>null==e?"":"boolean"==typeof e?e?"True":"False":"true"===e?"True":"false"===e?"False":"number"==typeof e?e.toString():e,D=({baseline:e,featureImportance:t,predictedValue:a,predictedProbability:n})=>({decisionPathData:Object(f.useMemo)((()=>{if(void 0!==e)return Object(h.c)(e)?T({baseline:e.baseline,featureImportance:t,predictedValue:a}):Object(h.a)(e)?F({baselines:e.classes,featureImportance:t,currentClass:a,predictedProbability:n}):void 0}),[e,t,a])}),T=({baseline:e,featureImportance:t,predictedValue:a})=>{const n=t.map((e=>({...e,absImportance:Math.abs(e[x])})));if(e&&void 0!==a&&Number.isFinite(a)){const t=a-n.reduce(((e,t)=>e+t.importance),0)-e;n.push({[v]:j.i18n.translate("xpack.ml.dataframe.analytics.decisionPathFeatureBaselineTitle",{defaultMessage:"baseline"}),[x]:e,absImportance:-1}),Math.abs(t)>A&&n.push({[v]:S,[x]:t,absImportance:0})}const i=n.filter((e=>void 0!==e)),r=i.sort(((e,t)=>t.absImportance-e.absImportance)).map((e=>[e[v],e[x],NaN]));let s=0;for(let e=i.length-1;e>=0;e--)s+=r[e][1],r[e][2]=s;return r},E=({predictedProbability:e,decisionPlotData:t})=>{if(e&&t.length>0){const a=e-t[0][2];Math.abs(a)>A&&(t.forEach((e=>e[2]=e[2]+a)),t.push([S,a,t[t.length-1][2]-a]))}return t},F=({baselines:e,featureImportance:t,currentClass:a,predictedProbability:n})=>{if(void 0===a||!(Array.isArray(e)&&e.length>=2))return[];const i=t.map((e=>{const t=Array.isArray(e.classes)?e.classes.find((e=>_(e.class_name)===_(a))):e;if(t&&"number"==typeof t[x])return{[v]:e[v],[x]:t[x],absImportance:Math.abs(t[x])}})),r=e.find((e=>_(e.class_name)===_(a))),s=null!=r&&r.baseline?null==r?void 0:r.baseline:0,o=i.filter((e=>void 0!==e)).sort(((e,t)=>t.absImportance-e.absImportance)).map((e=>[e[v],e[x],NaN]));return 2===e.length?(({decisionPlotData:e,startingBaseline:t,predictedProbability:a})=>{const n=e;let i=t;for(let e=n.length-1;e>=0;e--){i+=n[e][1];const t=Math.exp(i)/(Math.exp(i)+1);n[e][2]=t}return E({predictedProbability:a,decisionPlotData:n})})({startingBaseline:s,decisionPlotData:o,predictedProbability:n}):(({baselines:e,decisionPlotData:t,startingBaseline:a,featureImportance:n,predictedProbability:i})=>{const r=(({baselines:e,featureImportance:t})=>{let a=0;for(let n=0;n<e.length;n++){let i=0;for(let a=0;a<t.length;a++){const r=t[a],s=Array.isArray(r.classes)?r.classes.find((t=>_(t.class_name)===_(e[n].class_name))):r;s&&void 0!==s.importance&&"number"==typeof s[x]&&(i+=s.importance)}a+=Math.exp(e[n].baseline+i)}return a})({baselines:e,featureImportance:n}),s=a;let o=0;for(let e=t.length-1;e>=0;e--){o+=t[e][1];const a=Math.exp(s+o);t[e][2]=a/r}return E({predictedProbability:i,decisionPlotData:t})})({baselines:e,decisionPlotData:o,startingBaseline:s,featureImportance:t,predictedProbability:n})};var N=a(76),w=a(33),P=a(194),M=a(6);const{euiColorFullShade:k,euiColorMediumShade:R}=w.euiLightVars,C={line:{strokeWidth:1,stroke:k,opacity:.75}},L={axes:{axisLine:{stroke:R},tickLabel:{fontSize:10,fill:R},tickLine:{stroke:R},gridLine:{horizontal:{dash:[1,2]},vertical:{strokeWidth:0}}}},G=Object(M.jsx)(b.EuiIcon,{type:"dot",size:"m"}),V=({decisionPathData:e,predictionFieldName:t,minDomain:a,maxDomain:n,baseline:i})=>{const r=Object(f.useMemo)((()=>i&&Object(h.c)(i)?[{dataValue:i.baseline,header:Object(P.a)(i.baseline,"").toString(),details:j.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.decisionPathBaselineText",{defaultMessage:"baseline (average of predictions for all data points in the training data set)"})}]:void 0),[i]),s=r?j.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.decisionPathLinePredictionTitle",{defaultMessage:"Prediction"}):j.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.decisionPathLinePredictionProbabilityTitle",{defaultMessage:"Prediction probability"}),o=Object(f.useCallback)((e=>Object(P.a)(e,"").toString()),[]);return Object(M.jsx)("div",{"data-test-subj":"mlDFADecisionPathChart"},Object(M.jsx)(N.Chart,{size:{height:125+10*e.length}},Object(M.jsx)(N.Settings,{theme:L,baseTheme:N.LEGACY_LIGHT_THEME,rotation:90,locale:j.i18n.getLocale()}),r&&Object(M.jsx)(N.LineAnnotation,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathBaseline",domainType:N.AnnotationDomainType.YDomain,dataValues:r,style:C,marker:G}),Object(M.jsx)(N.Axis,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathXAxis",tickFormat:o,title:j.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.decisionPathXAxisTitle",{defaultMessage:"{xAxisLabel} for ''{predictionFieldName}''",values:{predictionFieldName:t,xAxisLabel:s}}),gridLine:{visible:!1},position:N.Position.Top,showOverlappingTicks:!0,domain:a&&n?{min:a,max:n}:void 0}),Object(M.jsx)(N.Axis,{gridLine:{visible:!0},id:"left",position:N.Position.Left}),Object(M.jsx)(N.LineSeries,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathLine",name:s,xScaleType:N.ScaleType.Ordinal,yScaleType:N.ScaleType.Linear,xAccessor:0,yAccessors:[2],data:e})))},$=()=>Object(M.jsx)(b.EuiCallOut,{color:"warning"},Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.regressionDecisionPathDataMissingCallout",defaultMessage:"No decision path data available."})),H=({baseline:e,featureImportance:t,predictedValue:a,predictionFieldName:n})=>{const{decisionPathData:i}=D({baseline:e,featureImportance:t,predictedValue:a}),r=Object(f.useMemo)((()=>{let t,a;if(i&&I(i)){const[n,r]=g.a.extent(i,(e=>e[2]));t=r,a=n;const s=.1*Math.abs(t-a);t=("number"==typeof e?Math.max(t,e):t)+s,a=("number"==typeof e?Math.min(a,e):a)-s}return{maxDomain:t,minDomain:a}}),[i,e]);return i?Object(M.jsx)(m.a.Fragment,null,void 0===e&&Object(M.jsx)(b.EuiCallOut,{size:"s",heading:"p",title:Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.missingBaselineCallout",defaultMessage:"Unable to calculate baseline value, which might result in a shifted decision path."}),color:"warning",iconType:"warning"}),Object(M.jsx)(V,{decisionPathData:i,predictionFieldName:n,minDomain:r.minDomain,maxDomain:r.maxDomain,baseline:e})):Object(M.jsx)($,null)},B=({featureImportance:e})=>Object(M.jsx)(b.EuiCodeBlock,{isCopyable:!0},JSON.stringify(e)),U=({featureImportance:e,predictedValue:t,topClasses:a,predictionFieldName:n,predictedProbability:i,baseline:r})=>{const[s,o]=Object(f.useState)(Array.isArray(a)&&a.length>0?_(a[0].class_name):""),c=a.find((e=>_(e.class_name)===_(s))),l=c?c.class_probability:void 0,{decisionPathData:u}=D({baseline:r,featureImportance:e,predictedValue:s,predictedProbability:l}),d=Object(f.useMemo)((()=>{const e=_(t);return Array.isArray(a)?a.map((t=>{const a=_(t.class_name);return{value:a,inputDisplay:a===e?Object(M.jsx)(b.EuiHealth,{color:"success",style:{lineHeight:"inherit"}},a):a}})):void 0}),[a,t]),p=Object(f.useMemo)((()=>{let e,t;if(u&&I(u)){const[a,n]=g.a.extent(u,(e=>e[2])),i=.1*Math.abs(n-a);e=n+i,t=a-i}return{maxDomain:e,minDomain:t}}),[u]);return u?Object(M.jsx)(m.a.Fragment,null,Object(M.jsx)(b.EuiSpacer,{size:"xs"}),Object(M.jsx)(b.EuiTitle,{size:"xxxs"},Object(M.jsx)("span",null,j.i18n.translate("xpack.ml.dataframe.analytics.explorationResults.classificationDecisionPathClassNameTitle",{defaultMessage:"Class name"}))),void 0!==d&&Object(M.jsx)(b.EuiSuperSelect,{"data-test-subj":"mlDFADecisionPathClassNameSelect",compressed:!0,options:d,valueOfSelected:s,onChange:o}),Object(M.jsx)(V,{decisionPathData:u,predictionFieldName:n,minDomain:p.minDomain,maxDomain:p.maxDomain})):Object(M.jsx)($,null)};var z=a(10),Q=function(e){return e.CHART="decision_path_chart",e.JSON="decision_path_json",e}(Q||{});const q=({baseline:e,featureImportance:t,predictedValue:a,topClasses:n,analysisType:i,predictionFieldName:r,predictedProbability:s})=>{const[o,c]=Object(f.useState)(Q.CHART),{services:{docLinks:l}}=Object(z.d)(),u=l.links.ml.featureImportance;if(t.length<2)return Object(M.jsx)("div",{"data-test-subj":"mlDFADecisionPathJSONViewer"},Object(M.jsx)(B,{featureImportance:t}));const d=[{id:Q.CHART,name:Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathPlotTab",defaultMessage:"Decision plot"})},{id:Q.JSON,name:Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathJSONTab",defaultMessage:"JSON"})}];return Object(M.jsx)("div",{"data-test-subj":"mlDFADecisionPathPopover"},Object(M.jsx)("div",{style:{display:"flex",width:300}},Object(M.jsx)(b.EuiTabs,{size:"s"},d.map((e=>Object(M.jsx)(b.EuiTab,{"data-test-subj":`mlDFADecisionPathPopoverTab-${e.id}`,isSelected:e.id===o,onClick:()=>c(e.id),key:e.id},e.name))))),o===Q.CHART&&Object(M.jsx)(m.a.Fragment,null,Object(M.jsx)(b.EuiText,{size:"xs",color:"subdued",style:{paddingTop:5}},Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.decisionPathPlotHelpText",defaultMessage:"SHAP decision plots use {linkedFeatureImportanceValues} to show how models arrive at the predicted value for ''{predictionFieldName}''.",values:{predictionFieldName:r,linkedFeatureImportanceValues:Object(M.jsx)(b.EuiLink,{href:u,target:"_blank"},Object(M.jsx)(y.FormattedMessage,{id:"xpack.ml.dataframe.analytics.explorationResults.linkedFeatureImportanceValues",defaultMessage:"feature importance values"}))}})),i===p.b.CLASSIFICATION&&Object(h.a)(e)&&Object(M.jsx)(U,{featureImportance:t,topClasses:n,predictedValue:_(a),predictedProbability:s,predictionFieldName:r,baseline:e}),i===p.b.REGRESSION&&Object(h.c)(e)&&void 0!==a&&Object(M.jsx)(H,{featureImportance:t,baseline:e,predictedValue:"string"==typeof a?parseFloat(a):a,predictionFieldName:r})),o===Q.JSON&&Object(M.jsx)(B,{featureImportance:t}))},J=({analysisType:e,baseline:t,data:a,pagination:n,predictionFieldName:i,resultsField:s})=>o=>{const{schema:c,rowIndex:l,cellContentsElement:u,DefaultCellPopover:d}=o;if(e===p.b.REGRESSION||e===p.b.CLASSIFICATION||e===p.b.OUTLIER_DETECTION){if("featureImportance"===c){const o=a[l-n.pageIndex*n.pageSize];if(!o)return Object(M.jsx)("div",null);const c=null!=s?s:p.d;let u,d,f=[];void 0!==i&&o&&void 0!==o[`${c}.${i}`]&&(u=o[`${c}.${i}`],f=Object(r.m)(o,c),d=o[`${c}.prediction_probability`]);const m=f.reduce(((e,t)=>"boolean"==typeof t.class_name||e),!1),b=Object(r.j)(o,c,m);return Object(M.jsx)("div",{"data-test-subj":"mlDFAFeatureImportancePopover"},Object(M.jsx)(q,{analysisType:e,predictedValue:u,predictedProbability:d,baseline:t,featureImportance:b,topClasses:f,predictionFieldName:i?i.replace("_prediction",""):void 0}))}return"featureInfluence"===c?Object(M.jsx)(b.EuiCodeBlock,{isCopyable:!0},u.textContent):Object(M.jsx)(d,o)}return Object(M.jsx)(d,o)};var Y=a(204),W=a(77),K=a(259),X=a(46),Z=a(71);const ee=e=>{const{services:{data:{dataViews:t}}}=Object(z.d)(),{getDataViewIdFromName:a}=Object(W.useMlIndexUtils)(),n=Object(X.b)(),[r,c]=Object(f.useState)(void 0),[l,d]=Object(f.useState)(void 0),[m,b]=Object(f.useState)(!1),[p,y]=Object(f.useState)(!1),[h,O]=Object(f.useState)(!1),[g,v]=Object(f.useState)(void 0),[x,A]=Object(f.useState)(void 0),[S,I]=Object(f.useState)(void 0),[_,D]=Object(f.useState)(void 0),[T,E]=Object(f.useState)(void 0);return Object(f.useEffect)((()=>{!async function(){O(!1);try{const p=await s.ml.dataFrameAnalytics.getDataFrameAnalytics(e),h=await s.ml.dataFrameAnalytics.getDataFrameAnalyticsStats(e),g=Object(K.b)(h)?h.data_frame_analytics[0]:void 0;if(void 0!==g&&g.state&&D(g.state),Array.isArray(p.data_frame_analytics)&&p.data_frame_analytics.length>0){const s=p.data_frame_analytics[0];if(Object(Y.g)(s.analysis)||Object(Y.i)(s.analysis))try{var r;const t=(await n.getTrainedModels(`${e}*`,{include:"total_feature_importance"})).find((t=>{var a,n;return(null===(a=t.metadata)||void 0===a||null===(n=a.analytics_config)||void 0===n?void 0:n.id)===e}));var l;!0===Array.isArray(null==t||null===(r=t.metadata)||void 0===r?void 0:r.total_feature_importance)&&E(null==t||null===(l=t.metadata)||void 0===l?void 0:l.total_feature_importance)}catch(e){Object(Z.getToastNotificationService)().displayErrorToast(e)}try{var f;const e=Object(u.a)(s),n=null!==(f=await a(e))&&void 0!==f?f:e;let i;try{i=await t.get(n),await t.refreshFields(i)}catch(e){i=void 0}if(void 0===i){var m;y(!0);const e=s.source.index[0],n=null!==(m=await a(e))&&void 0!==m?m:e;try{i=await t.get(n)}catch(e){i=void 0}}void 0!==i?(await o.a.initializeFromDataVIew(i),v(p.data_frame_analytics[0]),c(i),b(!0),O(!1)):d(j.i18n.translate("xpack.ml.dataframe.analytics.results.dataViewMissingErrorMessage",{defaultMessage:"To view this page, a Kibana data view is necessary for either the destination or source index of this analytics job."}))}catch(e){A(Object(i.a)(e)),O(!1)}}}catch(e){I(Object(i.a)(e)),O(!1)}}()}),[]),{dataView:r,dataViewErrorMessage:l,isInitialized:m,isLoadingJobConfig:h,jobCapsServiceErrorMessage:x,jobConfig:g,jobConfigErrorMessage:S,jobStatus:_,needsDestDataView:p,totalFeatureImportance:T}}},164:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"e",(function(){return r})),a.d(t,"f",(function(){return s})),a.d(t,"h",(function(){return o})),a.d(t,"g",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return u})),a.d(t,"d",(function(){return d})),a(25);var n=a(218);let i=function(e){return e.BATCH="batch",e.CONTINUOUS="continuous",e}({});function r(e){return e===n.c.FAILED}function s(e){return e===n.c.ANALYZING||e===n.c.REINDEXING||e===n.c.STARTED||e===n.c.STARTING}function o(e){return e===n.c.STOPPED}function c(e){return"object"==typeof e&&null!==e&&{}.hasOwnProperty.call(e,"state")&&Object.values(n.c).includes(e.state)&&{}.hasOwnProperty.call(e,"progress")&&Array.isArray(e.progress)}function l(e){let t=0,a=0;for(const n of e.progress)if(t++,a=n.progress_percent,n.progress_percent<100)break;return{currentPhase:t,progress:a,totalPhases:e.progress.length}}const u={configDestIndex:"config.dest.index",configSourceIndex:"config.source.index",configCreateTime:"config.create_time",description:"config.description",id:"id",memoryStatus:"stats.memory_usage.status"};function d(e){const t=function(e){if(c(e))return Math.round(e.progress.reduce(((e,t)=>e+t.progress_percent),0)/e.progress.length)}(e);return e.state===n.c.STOPPED&&100===t}},194:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return o}));var n=a(39),i=a.n(n);const r=3;function s(e,t,a,n){return Array.isArray(e)?1===e.length?o(e[0],t,a,n):`[${e.map((e=>o(e,t,void 0,n)))}]`:o(e,t,a,n)}function o(e,t,a,n){if(null==e)return"";if("time_of_week"===t){const t=void 0!==n&&void 0!==n.timestamp?new Date(n.timestamp):new Date,a=i()(t).unix()%i.a.duration(1,"week").asSeconds(),r=i.a.duration(a,"seconds"),s=i.a.utc(t).subtract(r).startOf("day").add(e,"s");return i()(s.valueOf()).format("ddd HH:mm")}if("time_of_day"===t){const t=void 0!==n&&void 0!==n.timestamp?new Date(n.timestamp):new Date,a=i.a.utc(t).startOf("day").add(e,"s");return i()(a.valueOf()).format("HH:mm")}if(void 0!==a)return a.convert(e,"text");{const t=Math.abs(e);if(t>=1e4||t===Math.floor(t))return void 0!==a?a.convert(e,"text"):Number(e.toFixed(0));if(t>=10)return Number(e.toFixed(1));{let t;return t=e>0?Math.pow(10,r-Math.floor(Math.log(e)/Math.LN10)-1):Math.pow(10,r-Math.floor(Math.log(-1*e)/Math.LN10)-1),Math.round(e*t)/t}}}},229:function(e,t,a){"use strict";a.d(t,"c",(function(){return b})),a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return y})),a.d(t,"e",(function(){return h})),a.d(t,"f",(function(){return O})),a.d(t,"k",(function(){return g})),a.d(t,"i",(function(){return j})),a.d(t,"d",(function(){return v})),a.d(t,"g",(function(){return x})),a.d(t,"h",(function(){return A})),a.d(t,"j",(function(){return I})),a.d(t,"m",(function(){return _})),a.d(t,"o",(function(){return D})),a.d(t,"n",(function(){return T})),a.d(t,"l",(function(){return E}));var n=a(83),i=a.n(n),r=a(2),s=a(5),o=a(131),c=a(69);let l=function(e){return e.HISTOGRAM="histogram",e.COUNTER="counter",e.GAUGE="gauge",e.SUMMARY="summary",e}({});var u=a(415),d=a(414),f=a(218),m=a(322);a(37);const b=10,p=1e4;let y=function(e){return e[e.UNUSED=0]="UNUSED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.ERROR=3]="ERROR",e}({});const h={border:"all",fontSize:"s",cellPadding:"s",stripes:!1,rowHover:"none",header:"shade"},O={showColumnSelector:!0,showDisplaySelector:!1,showSortSelector:!0,showFullScreenSelector:!1},g=e=>{const t=e.fields.map((e=>e.name));return t.filter((a=>{if(e.metaFields.includes(a))return!1;const n=a.split(".");return"keyword"!==n.pop()||!t.includes(n.join("."))}))},j=(e,t)=>Object.keys(e).map((a=>{let n;const i=e[a];switch(void 0!==i&&(d.a.has(i)||d.c.has(i))&&(n="numeric"),i){case"date":n="datetime";break;case"nested":case"geo_point":n="json";break;case"boolean":n="boolean";break;case"text":n=v}return a===`${t}.${f.j}`&&(n="numeric"),a.includes(`${t}.${f.k}`)&&(n="json"),a.includes(`${t}.${f.e}`)&&(n="featureImportance"),a===`${t}.${f.f}`&&(n="featureInfluence"),{id:a,schema:n,isSortable:!0}})),v="non-aggregatable",x=e=>{let t;switch(e){case o.a.GEO_POINT:case o.a.GEO_SHAPE:t="json";break;case o.a.BOOLEAN:t="boolean";break;case o.a.DATE:case o.a.DATE_NANOS:t="datetime";break;case o.a.BYTE:case o.a.DOUBLE:case o.a.FLOAT:case o.a.HALF_FLOAT:case o.a.INTEGER:case o.a.LONG:case o.a.SCALED_FLOAT:case o.a.SHORT:case"number":t="numeric";case o.a.KEYWORD:case o.a.VERSION:case o.a.TEXT:}return t},A=e=>{var t;let a;if(e){switch(e.type){case o.b.BOOLEAN:a="boolean";break;case o.b.DATE:a="datetime";break;case o.b.GEO_POINT:case o.b.GEO_SHAPE:a="json";break;case o.b.NUMBER:a="numeric";break;case o.b.NESTED:a="json"}return void 0===a&&!1===e.aggregatable||(e=>(null==e?void 0:e.timeSeriesMetric)===l.COUNTER)(e)||"numeric"===a&&null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>e===o.a.AGGREGATE_METRIC_DOUBLE))?v:a}},S=(e,t)=>t?"true"===e:e,I=(e,t,a=!1)=>{const n=e[`${t}.feature_importance`];return void 0===n?[]:n.map((e=>({feature_name:Array.isArray(e.feature_name)?e.feature_name[0]:e.feature_name,classes:Array.isArray(e.classes)?e.classes.map((e=>{const t=E(e);return{importance:t.importance,class_name:S(t.class_name,a)}})):e.classes,importance:Array.isArray(e.importance)?e.importance[0]:e.importance})))},_=(e,t)=>{const a=e[`${t}.top_classes`];return void 0===a?[]:a.map((e=>E(e)))},D=(e,t,a,n,s)=>Object(r.useMemo)((()=>({rowIndex:r,columnId:l,setCellProps:d})=>{const m=r-t.pageIndex*t.pageSize,b=a[m];if(void 0===b)return null;if(void 0===e)return null;const p=e.fields.getByName(l);let y;void 0!==p&&(y=e.getFormatterForField(p));const h=function(e){if(a.hasOwnProperty(m)){const t=a[m];return t.hasOwnProperty(e)?t[e]:e===`${n}.feature_importance`?I(b,null!=n?n:f.d):e===`${n}.top_classes`?_(b,null!=n?n:f.d):Object(c.a)(a[m],e,null)}return null}(l);return"function"==typeof s&&s(l,h,b,d),"object"==typeof h&&null!==h?JSON.stringify(h):null==h?null:void 0!==y?y.convert(h,"text"):"string"==typeof h||null===h?h:(null==p?void 0:p.type)===o.b.DATE?Object(u.c)(1e3*i()(h).unix()):"boolean"==typeof h?h?"true":"false":h}),[null==e?void 0:e.fields,t.pageIndex,t.pageSize,a]),T=(e,t)=>{t.addDanger(s.i18n.translate("xpack.ml.dataGrid.columnChart.ErrorMessageToast",{defaultMessage:"An error occurred fetching the histogram charts data: {error}",values:{error:Object(m.a)(e)}}))},E=(e,t)=>{const a={...e};for(const e of Object.keys(a))void 0===t?Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]):!1===t(e)&&Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]);return a}},259:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return u}));var n=a(5),i=a(218),r=a(204),s=a(11),o=a(148),c=a(164);const l=e=>({}.hasOwnProperty.call(e,"count")&&{}.hasOwnProperty.call(e,"data_frame_analytics")&&Array.isArray(e.data_frame_analytics));const u=(e,t,a,u,d,f)=>{let m=0;const b=async(p=!1)=>{if(!0===p||!1===f){if(o.k.next(o.a.LOADING),m++,m>1)return;try{const f=await s.ml.dataFrameAnalytics.getDataFrameAnalytics(),m=await s.ml.dataFrameAnalytics.getDataFrameAnalyticsStats(),b=l(m)?function(e){const t=e.data_frame_analytics.reduce(((e,{state:t})=>(Object(c.e)(t)?e.failed.value=++e.failed.value:Object(c.f)(t)?e.started.value=++e.started.value:Object(c.h)(t)&&(e.stopped.value=++e.stopped.value),e)),{total:{label:n.i18n.translate("xpack.ml.overview.statsBar.totalAnalyticsLabel",{defaultMessage:"Total"}),value:0,show:!0},started:{label:n.i18n.translate("xpack.ml.overview.statsBar.runningAnalyticsLabel",{defaultMessage:"Running"}),value:0,show:!0},stopped:{label:n.i18n.translate("xpack.ml.overview.statsBar.stoppedAnalyticsLabel",{defaultMessage:"Stopped"}),value:0,show:!0},failed:{label:n.i18n.translate("xpack.ml.overview.statsBar.failedAnalyticsLabel",{defaultMessage:"Failed"}),value:0,show:!1}});return t.failed.show=t.failed.value>0,t.total.value=e.count,0===t.total.value&&(t.started.show=!1,t.stopped.show=!1),t}(m):void 0;let p=0;const y=f.data_frame_analytics.reduce(((e,t)=>{const a=l(m)?m.data_frame_analytics.find((e=>t.id===e.id)):void 0;return Object(c.g)(a)?(a.state===i.c.STARTING&&void 0===a.node&&p++,e.push({checkpointing:{},config:t,id:t.id,job_type:Object(r.a)(t.analysis),mode:c.a.BATCH,state:a.state,stats:a}),e):e}),[]);e(y),t(b),a(void 0),u(!0),d(p),o.k.next(o.a.IDLE)}catch(n){o.k.next(o.a.ERROR),o.k.next(o.a.IDLE),e([]),t(void 0),a(n),u(!0)}if(m--,m>0)return m=0,void b(!0)}};return b}},291:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=e=>{var t;return null!==(t=null==e?void 0:e.dest.index)&&void 0!==t?t:""}},351:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(218),i=a(352);const r=e=>{switch(e){case n.b.CLASSIFICATION:return i.a.NOMINAL;case n.b.REGRESSION:return i.a.QUANTITATIVE;default:return}}},352:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={NOMINAL:"nominal",QUANTITATIVE:"quantitative"}},831:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return o}));var n=a(37);function i(e){return Object(n.a)(e,["classes"])&&Array.isArray(e.classes)}function r(e){return Object(n.a)(e,["importance"])}function s(e){return Object(n.a)(e,["classes"])&&Array.isArray(e.classes)}function o(e){return Object(n.a)(e,["baseline"])}}}]);