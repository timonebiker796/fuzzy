(window.unifiedSearch_bundle_jsonpfunction=window.unifiedSearch_bundle_jsonpfunction||[]).push([[2],{65:function(e,t,i){"use strict";var s=i(69);i.d(t,"c",(function(){return s.d}));var r=i(66);i.d(t,"g",(function(){return r.d})),i.d(t,"a",(function(){return r.c}));var a=i(68);i.d(t,"b",(function(){return a.a})),i.d(t,"e",(function(){return a.c})),i.d(t,"d",(function(){return a.b})),i.d(t,"f",(function(){return a.d}))},70:function(e,t,i){"use strict";i.d(t,"g",(function(){return s.b})),i.d(t,"i",(function(){return s.e})),i.d(t,"h",(function(){return s.d})),i.d(t,"j",(function(){return s.f})),i.d(t,"k",(function(){return s.g})),i.d(t,"f",(function(){return s.a})),i.d(t,"b",(function(){return r.a})),i.d(t,"d",(function(){return x})),i.d(t,"c",(function(){return v})),i.d(t,"e",(function(){return C.a})),i.d(t,"l",(function(){return C.c})),i.d(t,"a",(function(){return E.a})),i.d(t,"m",(function(){return M}));var s=i(65),r=i(74),a=i(2),l=i.n(a),n=i(0),o=i.n(n),u=i(23),c=i(14),d=i(7),h=i(22);class phrase_suggestor_PhraseSuggestorUI extends o.a.Component{constructor(...e){super(...e),l()(this,"services",this.props.kibana.services),l()(this,"abortController",void 0),l()(this,"state",{suggestions:[],isLoading:!1}),l()(this,"onSearchChange",(e=>{this.setState({isLoading:!0}),this.updateSuggestions(`${e}`)})),l()(this,"updateSuggestions",Object(d.debounce)((async(e="")=>{var t;this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const{indexPattern:i,field:s,timeRangeForSuggestionsOverride:r,filtersForSuggestions:a}=this.props;if(!s||!this.isSuggestingValues())return;this.setState({isLoading:!0});const l=await this.services.unifiedSearch.autocomplete.getValueSuggestions({indexPattern:i,field:s,query:e,signal:this.abortController.signal,useTimeRange:r,boolFilter:Object(h.buildQueryFromFilters)(a,void 0).filter,method:null!=a&&a.length?"terms_agg":void 0,querySuggestionKey:null===(t=this.props.suggestionsAbstraction)||void 0===t?void 0:t.type});this.setState({suggestions:l,isLoading:!1})}),500))}componentDidMount(){this.updateSuggestions()}componentWillUnmount(){this.abortController&&this.abortController.abort()}isSuggestingValues(){var e;const t=this.services.uiSettings.get(c.UI_SETTINGS.FILTERS_EDITOR_SUGGEST_VALUES),{field:i}=this.props,s=null==i||null===(e=i.esTypes)||void 0===e?void 0:e.includes("version");return t&&i&&i.aggregatable&&"string"===i.type&&!s}}Object(u.withKibana)(phrase_suggestor_PhraseSuggestorUI);var p=i(48),f=i(6),b=i(92),g=i(67),m=i(69),j=i(1);function O(e){return Object(r.a)(e)}const x=Object(p.injectI18n)(Object(f.withEuiTheme)(Object(u.withKibana)(class phrases_values_input_PhrasesValuesInputUI extends phrase_suggestor_PhraseSuggestorUI{render(){const{suggestions:e,isLoading:t}=this.state,{values:i,intl:s,onChange:r,fullWidth:a,onParamsUpdate:l,compressed:n,disabled:o}=this.props,u=i?Object(d.uniq)([...i,...e]):e,c=Object(b.a)(u);return Object(j.jsx)(O,{async:!0,isLoading:t,fullWidth:a,compressed:n,placeholder:s.formatMessage({id:"unifiedSearch.filter.filterEditor.valuesSelectPlaceholder",defaultMessage:"Select values"}),"aria-label":s.formatMessage({id:"unifiedSearch.filter.filterEditor.valuesSelectPlaceholder",defaultMessage:"Select values"}),delimiter:",",isCaseSensitive:!0,options:u,getLabel:e=>e,selectedOptions:i||[],onSearchChange:this.onSearchChange,onCreateOption:e=>{l(e.trim())},className:(h=this.props.theme,Object(g.css)(".euiComboBox__inputWrap{",Object(f.euiScrollBarStyles)(h)," overflow:auto;max-height:100px;}","")),onChange:r,isClearable:!1,"data-test-subj":"filterParamsComboBox phrasesParamsComboxBox",isDisabled:o,truncationProps:m.a,inputPopoverProps:{panelMinWidth:c,anchorPosition:"downRight"}});var h}})));var S=i(76);function F(e){return Object(r.a)(e)}const v=Object(p.injectI18n)(Object(u.withKibana)(class phrase_value_input_PhraseValueInputUI extends phrase_suggestor_PhraseSuggestorUI{constructor(...e){super(...e),l()(this,"inputRef",null)}render(){return Object(j.jsx)(o.a.Fragment,null,this.isSuggestingValues()?this.renderWithSuggestions():Object(j.jsx)(S.a,{disabled:this.props.disabled,compressed:this.props.compressed,fullWidth:this.props.fullWidth,placeholder:this.props.intl.formatMessage({id:"unifiedSearch.filter.filterEditor.valueInputPlaceholder",defaultMessage:"Enter a value"}),onBlur:this.props.onBlur,value:this.props.value,onChange:this.props.onChange,field:this.props.field,isInvalid:this.props.invalid}))}renderWithSuggestions(){const{suggestions:e,isLoading:t}=this.state,{value:i,intl:s,onChange:r,fullWidth:a}=this.props,l=String(i),n=i?Object(d.uniq)([l,...e]):e,o=Object(b.a)(n);return Object(j.jsx)(F,{async:!0,isLoading:t,inputRef:e=>{this.inputRef=e},isDisabled:this.props.disabled,fullWidth:a,compressed:this.props.compressed,placeholder:s.formatMessage({id:"unifiedSearch.filter.filterEditor.valueSelectPlaceholder",defaultMessage:"Select a value"}),"aria-label":s.formatMessage({id:"unifiedSearch.filter.filterEditor.valueSelectPlaceholder",defaultMessage:"Select a value"}),options:n,getLabel:e=>e,selectedOptions:i?[l]:[],onChange:([e=""])=>{r(e)},onSearchChange:this.onSearchChange,onCreateOption:r,isClearable:!1,"data-test-subj":"filterParamsComboBox phraseParamsComboxBox",singleSelection:m.b,truncationProps:m.a,inputPopoverProps:{panelMinWidth:o,anchorPosition:"downRight"}})}}));var C=i(73),E=i(80),y=i(3),L=i.n(y),D=i(4);const w=Object(n.memo)((function(e){return Object(j.jsx)(f.EuiConfirmModal,L()({"data-test-subj":"close-filter-editor-confirm-modal",title:D.i18n.translate("unifiedSearch.filter.closeEditorConfirmModal.title",{defaultMessage:"Unsaved changes"}),cancelButtonText:D.i18n.translate("unifiedSearch.filter.closeEditorConfirmModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:D.i18n.translate("unifiedSearch.filter.closeEditorConfirmModal.confirmButton",{defaultMessage:"Discard changes"}),buttonColor:"danger",defaultFocusedButton:"confirm"},e),Object(j.jsx)("p",null,D.i18n.translate("unifiedSearch.filter.closeEditorConfirmModal.warningLabel",{defaultMessage:"If you leave now, your unsaved filters will be lost."})))})),P=e=>"queryDsl"in e&&"customLabel"in e,I=(e,t)=>e.queryDsl!==t.queryDsl||e.customLabel!==t.customLabel;function M(e){return function(t){const[i,s]=Object(n.useState)(),[r,a]=Object(n.useState)(!1),[l,u]=Object(n.useState)(),[c,d]=Object(n.useState)(),p=Object(n.useCallback)((()=>{a(!1)}),[a]),f=Object(n.useCallback)((()=>{a(!1),null==i||i.map((e=>e()))}),[i,a]),b=Object(n.useCallback)((e=>{l&&c&&(P(l)&&I(c.queryDslFilter,l)||!P(l)&&!Object(h.compareFilters)(c.filter,l,{index:!0,alias:!0}))?(a(!0),s(e)):null==e||e.map((e=>e()))}),[c,l,a,s]);return Object(j.jsx)(o.a.Fragment,null,Object(j.jsx)(e,L()({},t,{onCloseFilterPopover:b,onLocalFilterCreate:d,onLocalFilterUpdate:u})),r&&Object(j.jsx)(w,{onCancel:p,onConfirm:f}))}}},74:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i(3),r=i.n(s),a=i(6),l=(i(0),i(67));const n=e=>Object(l.css)(".euiComboBoxPlaceholder{padding-right:calc(",e.size.xs,");}","");var o=i(1);function u(e){const{options:t,selectedOptions:i,getLabel:s,onChange:l,...u}=e,{euiTheme:c}=Object(a.useEuiTheme)(),d=t.map(s),h=d.map((e=>({label:e}))),p=i.filter((e=>-1!==t.indexOf(e))).map((e=>h[t.indexOf(e)]));return Object(o.jsx)(a.EuiComboBox,r()({options:h,className:n(c),selectedOptions:p,onChange:e=>{const i=e.map((({label:e})=>t[d.indexOf(e)]));l(i)},sortMatchesBy:"startsWith"},u))}},80:function(e,t,i){"use strict";i.d(t,"a",(function(){return E}));var s=i(2),r=i.n(s),a=i(6),l=i(48),n=i(22),o=i(7),u=i(0),c=i.n(u),d=i(4),h=i(57),p=i(26),f=i(58),b=i(67),g=i(74),m=i(68),j=i(32),O=i(54),x=i(69);const S=Object(b.css)({name:"1qpkor7",styles:".euiFormRow__fieldWrapper{line-height:1.5;}"}),F=Object(b.css)({name:"1rv48pq",styles:"& .euiFormLabel[for]{cursor:default;}"});var v=i(1);var C={name:"1yc9uo8",styles:"overflow-wrap:break-word"};class filter_editor_FilterEditorComponent extends u.Component{constructor(e){var t;super(e),r()(this,"toggleCustomEditor",(()=>{const e=!this.state.isCustomEditorOpen;if(this.setState({isCustomEditorOpen:e}),this.props.onLocalFilterUpdate){const{customLabel:t,queryDsl:i,localFilter:s}=this.state;e?this.props.onLocalFilterUpdate({queryDsl:i,customLabel:t}):this.props.onLocalFilterUpdate(s)}})),r()(this,"isQueryDslValid",(e=>{try{const t=JSON.parse(e);return Object.keys(t).length>0}catch{return!1}})),r()(this,"onIndexPatternChange",(([e])=>{this.setState({selectedDataView:e,localFilter:Object(n.buildEmptyFilter)(!1,e.id)})})),r()(this,"onCustomLabelChange",(e=>{const t=e.target.value;if(this.setState({customLabel:t}),this.props.onLocalFilterUpdate)if(this.state.isCustomEditorOpen){const{queryDsl:e}=this.state;this.props.onLocalFilterUpdate({queryDsl:e,customLabel:t})}else{const e={...this.state.localFilter,meta:{...this.state.localFilter.meta,alias:t||null}};this.props.onLocalFilterUpdate(e)}})),r()(this,"onQueryDslChange",(e=>{if(this.setState({queryDsl:e}),this.props.onLocalFilterUpdate){const{customLabel:t}=this.state;this.props.onLocalFilterUpdate({queryDsl:e,customLabel:t})}})),r()(this,"getFilterFromQueryDsl",(e=>{const{customLabel:t}=this.state,{$state:i,meta:{index:s,disabled:r=!1,negate:a=!1}}=this.props.filter;if(!i||!i.store)return;const l=s||this.state.indexPatterns[0].id;try{const s=JSON.parse(e);return Object(n.buildCustomFilter)(l,s,r,a,t||null,i.store)}catch{return null}})),r()(this,"onLocalFilterChange",(e=>{var t,i;const{selectedDataView:s,customLabel:r}=this.state,a=r||null,{$state:l,meta:{disabled:o=!1}}=this.props.filter;if(!l||!l.store||!s)return;let u;if(1===e.length){const t=e[0];u={...t,$state:{store:l.store},meta:{...t.meta,disabled:o,alias:a}}}else u=Object(n.buildCombinedFilter)(n.BooleanRelation.AND,e,s,o,!1,a,l.store);this.setState({localFilter:u}),null===(t=(i=this.props).onLocalFilterUpdate)||void 0===t||t.call(i,u)})),r()(this,"onSubmit",(()=>{const{isCustomEditorOpen:e,queryDsl:t,customLabel:i}=this.state,{$state:s}=this.props.filter;if(s&&s.store)if(e){var r,a;const e=(null===(r=this.props.filter)||void 0===r?void 0:r.meta.type)===n.FILTERS.CUSTOM||t!==this.parseFilterToQueryDsl(this.props.filter,this.state.indexPatterns)?this.getFilterFromQueryDsl(t):{...this.props.filter,meta:{...null!==(a=this.props.filter.meta)&&void 0!==a?a:{},alias:i||null}};if(!e)return;this.props.onSubmit(e)}else{const e={...this.state.localFilter,meta:{...this.state.localFilter.meta,alias:i||null}};this.props.onSubmit(e)}}));const i=Object(p.getIndexPatternFromFilter)(e.filter,e.indexPatterns);this.state={indexPatterns:e.indexPatterns,selectedDataView:i,customLabel:e.filter.meta.alias||"",queryDsl:this.parseFilterToQueryDsl(e.filter,e.indexPatterns),isCustomEditorOpen:this.isUnknownFilterType()||!(null===(t=this.props.filter)||void 0===t||!t.meta.isMultiIndex),localFilter:i?Object(o.merge)({},e.filter):Object(n.buildEmptyFilter)(!1),isLoadingDataView:!Boolean(i)}}componentDidMount(){var e,t,i,s;const{localFilter:r,queryDsl:a,customLabel:l,selectedDataView:n}=this.state;if(null===(e=(t=this.props).onLocalFilterCreate)||void 0===e||e.call(t,{filter:r,queryDslFilter:{queryDsl:a,customLabel:l}}),null===(i=(s=this.props).onLocalFilterUpdate)||void 0===i||i.call(s,r),!n){const e=this.props.filter.meta.index;e&&this.props.dataViews?this.loadDataView(e,this.props.dataViews):this.setState({isLoadingDataView:!1})}}async loadDataView(e,t){try{const i=await t.get(e,!1);this.setState({selectedDataView:i,isLoadingDataView:!1,indexPatterns:[i,...this.props.indexPatterns],localFilter:Object(o.merge)({},this.props.filter),queryDsl:this.parseFilterToQueryDsl(this.props.filter,this.state.indexPatterns)})}catch(e){this.setState({isLoadingDataView:!1})}}parseFilterToQueryDsl(e,t){const i=Object(n.filterToQueryDsl)(e,t);return JSON.stringify(i,null,2)}render(){var e;const t=null!==(e=this.props.filter)&&void 0!==e&&e.meta.isMultiIndex?null:Object(v.jsx)(a.EuiFlexItem,{grow:!1},Object(v.jsx)(a.EuiButtonEmpty,{size:"xs","data-test-subj":"editQueryDSL",onClick:this.toggleCustomEditor},this.state.isCustomEditorOpen?Object(v.jsx)(l.FormattedMessage,{id:"unifiedSearch.filter.filterEditor.editFilterValuesButtonLabel",defaultMessage:"Edit filter values"}):Object(v.jsx)(l.FormattedMessage,{id:"unifiedSearch.filter.filterEditor.editQueryDslButtonLabel",defaultMessage:"Edit as Query DSL"})));return Object(v.jsx)("div",null,Object(v.jsx)(a.EuiPopoverTitle,{paddingSize:"s"},Object(v.jsx)(a.EuiFlexGroup,{alignItems:"baseline",responsive:!1},Object(v.jsx)(a.EuiFlexItem,null,"add"===this.props.mode?d.i18n.translate("unifiedSearch.filter.filterEditor.addFilterPopupTitle",{defaultMessage:"Add filter"}):d.i18n.translate("unifiedSearch.filter.filterEditor.editFilterPopupTitle",{defaultMessage:"Edit filter"})),Object(v.jsx)(a.EuiFlexItem,{grow:!1,className:"filterEditor__hiddenItem"}),t)),this.state.isLoadingDataView?Object(v.jsx)("div",{className:"globalFilterItem__editorForm"},Object(v.jsx)(a.EuiLoadingSpinner,null)):Object(v.jsx)(a.EuiForm,null,Object(v.jsx)("div",{className:"globalFilterItem__editorForm"},this.renderIndexPatternInput(),this.state.isCustomEditorOpen?this.renderCustomEditor():this.renderFiltersBuilderEditor(),Object(v.jsx)(a.EuiSpacer,{size:"l"}),Object(v.jsx)(a.EuiFormRow,{label:d.i18n.translate("unifiedSearch.filter.filterEditor.createCustomLabelInputLabel",{defaultMessage:"Custom label (optional)"}),fullWidth:!0},Object(v.jsx)(a.EuiFieldText,{value:`${this.state.customLabel}`,onChange:this.onCustomLabelChange,placeholder:d.i18n.translate("unifiedSearch.filter.filterEditor.customLabelPlaceholder",{defaultMessage:"Add a custom label here"}),fullWidth:!0}))),Object(v.jsx)(a.EuiPopoverFooter,{paddingSize:"s"},Object(v.jsx)(a.EuiFlexGroup,{direction:"rowReverse",alignItems:"center",style:{isolation:"isolate"},responsive:!1},Object(v.jsx)(a.EuiFlexItem,{grow:!1},Object(v.jsx)(a.EuiButton,{fill:!0,onClick:this.onSubmit,isDisabled:!this.isFilterValid(),"data-test-subj":"saveFilter"},"add"===this.props.mode?d.i18n.translate("unifiedSearch.filter.filterEditor.addButtonLabel",{defaultMessage:"Add filter"}):d.i18n.translate("unifiedSearch.filter.filterEditor.updateButtonLabel",{defaultMessage:"Update filter"}))),Object(v.jsx)(a.EuiFlexItem,{grow:!1},Object(v.jsx)(a.EuiButtonEmpty,{flush:"right",onClick:this.props.onCancel,"data-test-subj":"cancelSaveFilter"},Object(v.jsx)(l.FormattedMessage,{id:"unifiedSearch.filter.filterEditor.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(v.jsx)(a.EuiFlexItem,null)))))}renderIndexPatternInput(){var e;if(null!==(e=this.props.filter)&&void 0!==e&&e.meta.isMultiIndex)return null;if(this.state.indexPatterns.length<=1&&this.state.indexPatterns.find((e=>e===this.getIndexPatternFromFilter())))return null;const{selectedDataView:t}=this.state;return Object(v.jsx)(c.a.Fragment,null,Object(v.jsx)(a.EuiFormRow,{fullWidth:!0,label:d.i18n.translate("unifiedSearch.filter.filterEditor.dateViewSelectLabel",{defaultMessage:"Data view"})},Object(v.jsx)(g.a,{fullWidth:!0,placeholder:d.i18n.translate("unifiedSearch.filter.filterBar.indexPatternSelectPlaceholder",{defaultMessage:"Select a data view"}),options:this.state.indexPatterns,selectedOptions:t?[t]:[],getLabel:e=>null==e?void 0:e.getName(),onChange:this.onIndexPatternChange,isClearable:!1,"data-test-subj":"filterIndexPatternsSelect",singleSelection:x.b,truncationProps:x.a})),Object(v.jsx)(a.EuiSpacer,{size:"s"}))}hasCombinedFilterCustomType(e){return e.some((e=>"custom"===e.meta.type))}renderFiltersBuilderEditor(){const{selectedDataView:e,localFilter:t}=this.state,i=Object(x.c)([t]),s=e&&(i.length>1&&!this.hasCombinedFilterCustomType(i)||1===i.length&&Object(m.e)(e,Object(m.a)(i[0],e),Object(m.c)(i[0]),Object(n.getFilterParams)(i[0])));return Object(v.jsx)(c.a.Fragment,null,Object(v.jsx)("div",{role:"region","aria-label":"",className:Object(b.cx)((r=this.props.theme.euiTheme,Object(b.css)("max-height:",r.size.base," * 10;","")),"eui-yScroll")},Object(v.jsx)(a.EuiToolTip,{position:"top",content:e?"":d.i18n.translate("unifiedSearch.filter.filterEditor.chooseDataViewFirstToolTip",{defaultMessage:"You need to select a data view first"}),display:"block"},Object(v.jsx)(j.a,{filters:[t],timeRangeForSuggestionsOverride:this.props.timeRangeForSuggestionsOverride,filtersForSuggestions:this.props.filtersForSuggestions,dataView:e,onChange:this.onLocalFilterChange,disabled:!e,suggestionsAbstraction:this.props.suggestionsAbstraction,filtersCount:this.props.filtersCount}))),s?Object(v.jsx)(a.EuiFormRow,{fullWidth:!0,hasEmptyLabelSpace:!0,className:Object(b.cx)(S,F),label:Object(v.jsx)("strong",null,Object(v.jsx)(l.FormattedMessage,{id:"unifiedSearch.filter.filterBar.preview",defaultMessage:"{icon} Preview",values:{icon:Object(v.jsx)(a.EuiIcon,{type:"inspect",size:"s"})}}))},Object(v.jsx)(a.EuiText,{size:"xs","data-test-subj":"filter-preview",css:C},Object(v.jsx)(O.FilterBadgeGroup,{filters:[t],dataViews:this.state.indexPatterns,booleanRelation:n.BooleanRelation.AND,shouldShowBrackets:!1}))):null);var r}renderCustomEditor(){var e;let t="";return this.props.docLinks&&(t=Object(v.jsx)(a.EuiLink,{href:this.props.docLinks.links.query.queryDsl,target:"_blank"},d.i18n.translate("unifiedSearch.filter.filterEditor.queryDslDocsLinkLabel",{defaultMessage:"Learn about Query DSL syntax"}))),(null===(e=this.props.filter)||void 0===e?void 0:e.meta.type)===n.FILTERS.SPATIAL_FILTER&&(t=Object(v.jsx)(a.EuiTextColor,{color:"warning"},d.i18n.translate("unifiedSearch.filter.filterEditor.spatialFilterQueryDslHelpText",{defaultMessage:"Editing Elasticsearch Query DSL prevents filter geometry from displaying in map."}))),Object(v.jsx)(a.EuiFormRow,{fullWidth:!0,label:d.i18n.translate("unifiedSearch.filter.filterEditor.queryDslLabel",{defaultMessage:"Elasticsearch Query DSL"}),helpText:t},Object(v.jsx)(f.CodeEditor,{languageId:h.XJsonLang.ID,width:"100%",height:"250px",value:this.state.queryDsl,onChange:this.onQueryDslChange,"data-test-subj":"customEditorInput","aria-label":d.i18n.translate("unifiedSearch.filter.filterEditor.queryDslAriaLabel",{defaultMessage:"Elasticsearch Query DSL editor"})}))}isUnknownFilterType(){const{type:e}=this.props.filter.meta;if(Object(n.isCombinedFilter)(this.props.filter)){const{params:e}=this.props.filter.meta;return e&&this.hasCombinedFilterCustomType(e)}return!!e&&!["phrase","phrases","range","exists","combined"].includes(e)}getIndexPatternFromFilter(){return Object(p.getIndexPatternFromFilter)(this.props.filter,this.state.indexPatterns)}isFilterValid(){const{isCustomEditorOpen:e,queryDsl:t,selectedDataView:i,localFilter:s}=this.state;return e?this.isQueryDslValid(t):!!i&&Object(x.c)([s]).every((e=>Object(m.e)(i,Object(m.a)(e,i),Object(m.c)(e),Object(n.getFilterParams)(e))))}}const E=Object(a.withEuiTheme)(filter_editor_FilterEditorComponent)},92:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));const s={maxWidth:550,avCharWidth:7,paddingsWidth:116},r=(e,t)=>e.reduce(((e,i)=>{const s=t.find((e=>i[e]));if(!s)return e;const r=i[s].length;return e>r?e:r}),0),a=e=>e.reduce(((e,t)=>e>t.length?e:t.length),0);function l(e,t,i){return function(e,t){const{maxWidth:i,avCharWidth:r,paddingsWidth:a,minWidth:l}={...s,...t},n=a+e*r;return l&&n<l?l:Math.min(n,i)}(t?r(e,t):a(e),i)}}}]);