/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.cloudFullStory_bundle_jsonpfunction=window.cloudFullStory_bundle_jsonpfunction||[]).push([[1],{9:function(t,e,s){"use strict";s.r(e),s.d(e,"FullStoryShipper",(function(){return fullstory_shipper_FullStoryShipper}));var i=s(0),n=s.n(i),o=s(6),r=s(7),l=s(8),c=s(1),u=s.n(c);const a=["uid","displayName","email","acctId","website","pageName"];function d(t){return Object.fromEntries(Object.entries(t).map((([t,e])=>Array.isArray(e)?[t,e.filter((t=>void 0!==t))]:[t,e])).filter((([,t])=>void 0!==t&&(!Array.isArray(t)||t.length>0))).map((([t,e])=>{if(a.includes(t))return[t,e];if(function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&!p(t)}(e))return[t,d(e)];const s=function(t){const e=Array.isArray(t),s=e?t[0]:t;let i;switch(typeof s){case"string":i=u()(s,u.a.ISO_8601,!0).isValid()?"date":"str";break;case"number":i=Number.isInteger(s)?"int":"real";break;case"boolean":i="bool";break;case"object":if(p(s)){i="date";break}default:throw new Error("Unsupported type: "+typeof s)}return e?`${i}s`:i}(e);return[s?`${t}_${s}`:t,e]})))}function p(t){return t instanceof Date}function f(t){const[e,s,i]=t.split(".");return{version_str:t,version_major_int:parseInt(e,10),version_minor_int:parseInt(s,10),version_patch_int:parseInt(i,10)}}const h=["pageName","page","entityId","applicationId","version","buildSha","cloudId","deploymentId","projectId","cluster_name","cluster_uuid","cluster_version","labels.serverless","license_id","license_status","license_type","session_id","preferred_languages"];class fullstory_shipper_FullStoryShipper{constructor(t,e){n()(this,"fullStoryApi",void 0),n()(this,"lastUserId",void 0),n()(this,"eventTypesAllowlist",void 0),n()(this,"pageContext$",new o.Subject),n()(this,"userContext$",new o.Subject),n()(this,"subscriptions",new o.Subscription),this.initContext=e;const{eventTypesAllowlist:s,pageVarsDebounceTimeMs:i=500,...c}=t;this.fullStoryApi=function({scriptUrl:t="https://edge.fullstory.com/s/fs.js",fullStoryOrgId:e,host:s="fullstory.com",namespace:i="FS",debug:n=!1}){var o,r,l,c,u,a,d,p;window._fs_debug=n,window._fs_host=s,window._fs_script=t,window._fs_org=e,window._fs_namespace=i,o=window,r=document,l=window._fs_namespace,c="script",u="user",l in o?o.console&&o.console.log&&o.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].'):((d=o[l]=function(t,e,s){d.q?d.q.push([t,e,s]):d._api(t,e,s)}).q=[],(a=r.createElement(c)).async=1,a.crossOrigin="anonymous",a.src=_fs_script,(p=r.getElementsByTagName(c)[0]).parentNode.insertBefore(a,p),d.identify=function(t,e,s){d(u,{uid:t},s),e&&d(u,e,s)},d.setUserVars=function(t,e){d(u,t,e)},d.event=function(t,e,s){d("event",{n:t,p:e},s)},d.anonymize=function(){d.identify(!1)},d.shutdown=function(){d("rec",!1)},d.restart=function(){d("rec",!0)},d.log=function(t,e){d("log",[t,e])},d.consent=function(t){d("consent",!arguments.length||t)},d.identifyAccount=function(t,e){a="account",(e=e||{}).acctId=t,d(a,e)},d.clearUserCookie=function(){},d.setVars=function(t,e){d("setVars",[t,e])},d._w={},p="XMLHttpRequest",d._w[p]=o[p],p="fetch",d._w[p]=o[p],o[p]&&(o[p]=function(){return d._w[p].apply(this,arguments)}),d._v="1.3.0");const f=window[i];if(!f)throw new Error("FullStory snippet failed to load. Check browser logs for more information.");return f}(c),this.eventTypesAllowlist=s,this.subscriptions.add(this.userContext$.pipe(Object(o.distinct)((({userId:t,isElasticCloudUser:e,cloudIsElasticStaffOwned:s,cloudTrialEndDate:i})=>[t,e,s,i].join("-")))).subscribe((t=>this.updateUserVars(t)))),this.subscriptions.add(this.pageContext$.pipe(Object(o.map)((t=>h.reduce(((e,s)=>(Object(r.has)(t,s)&&Object(l.set)(e,s,Object(r.get)(t,s)),e)),{}))),Object(o.filter)((t=>Object.keys(t).length>0)),Object(o.distinct)((t=>Object.keys(t).sort().map((e=>t[e])).join("-"))),Object(o.debounceTime)(i)).subscribe((t=>{this.initContext.logger.debug(`Calling FS.setVars with context ${JSON.stringify(t)}`),this.fullStoryApi.setVars("page",{...d(t),...t.version?f(t.version):{}})})))}extendContext(t){this.initContext.logger.debug(`Received context ${JSON.stringify(t)}`),this.userContext$.next(t),this.pageContext$.next(t)}optIn(t){this.initContext.logger.debug(`Setting FS to optIn ${t}`),this.fullStoryApi.consent(t),t?this.fullStoryApi.restart():this.fullStoryApi.shutdown()}reportEvents(t){this.initContext.logger.debug(`Reporting ${t.length} events to FS`),t.filter((t=>{var e,s;return null===(e=null===(s=this.eventTypesAllowlist)||void 0===s?void 0:s.includes(t.event_type))||void 0===e||e})).forEach((t=>{this.fullStoryApi.event(t.event_type,d(t.properties))}))}async flush(){}shutdown(){this.subscriptions.unsubscribe()}updateUserVars({userId:t,isElasticCloudUser:e,cloudIsElasticStaffOwned:s,cloudTrialEndDate:i}){if(t&&t!==this.lastUserId&&(this.initContext.logger.debug(`Calling FS.identify with userId ${t}`),this.fullStoryApi.identify(t),this.lastUserId=t),"boolean"==typeof e||"boolean"==typeof s||i){const t={isElasticCloudUser:e,cloudIsElasticStaffOwned:s,cloudTrialEndDate:i};this.initContext.logger.debug(`Calling FS.setUserVars with ${JSON.stringify(t)}`),this.fullStoryApi.setUserVars(d(t))}}}n()(fullstory_shipper_FullStoryShipper,"shipperName","FullStory")}}]);