/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.sessionView_bundle_jsonpfunction=window.sessionView_bundle_jsonpfunction||[]).push([[1],Array(20).concat([function(t,d,u){"use strict";u.r(d),u.d(d,"SessionView",(function(){return Kt})),u.d(d,"default",(function(){return Kt}));var f=u(16),p=u(2),v=u.n(p),g=u(4),b=u(13),S=u(31),C=u.n(S);let y={};const w=new WeakMap,x={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class ByteSize{constructor(t,d){d=Object.assign({units:"metric",precision:1,locale:void 0},y,d),w.set(this,d),Object.assign(x,d.customUnits);const u=t<0?"-":"";t=Math.abs(t);const f=x[d.units];if(!f)throw new Error(`Invalid units specified: ${d.units}`);{const p=f.find((d=>t>=d.from&&t<d.to));if(p){const f=new Intl.NumberFormat(d.locale,{style:"decimal",minimumFractionDigits:d.precision,maximumFractionDigits:d.precision}),v=0===p.from?u+t:u+f.format(t/p.from);this.value=v,this.unit=p.unit,this.long=p.long}else this.value=u+t,this.unit="",this.long=""}}toString(){const t=w.get(this);return t.toStringFn?t.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function O(t,d){return new ByteSize(t,d)}O.defaultOptions=function(t){y=t};var j=O,k=u(17),T=u(12),L=u(14),R=u.n(L);const A="-",D=t=>void 0===t||""===t||"number"==typeof t&&isNaN(t)?A:t;var M=u(1);const B=()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const{size:d,colors:u,border:f}=t;return{container:{margin:`${d.xs} ${d.base} ${d.base} ${d.xs}`,color:u.text,padding:`${d.s} 0`,borderStyle:"solid",borderColor:u.lightShade,borderWidth:f.width.thin,borderRadius:f.radius.medium,maxHeight:378,overflowY:"auto",backgroundColor:u.emptyShade}}}),[t])},P={open:"primary",acknowledged:"warning",closed:"default"},H=t=>P[t||"closed"];var F=u(18);const $=(...t)=>{const d=Object(g.useEuiTheme)(...t),u=Object(p.useMemo)((()=>{const t="DARK"===d.colorMode?F.euiDarkVars:F.euiLightVars,u={euiColorVis6_asText:Object(g.shade)(t.euiColorVis6,.335),buttonsBackgroundNormalDefaultPrimary:"#006DE4",terminalOutputBackground:"#1d1e23",terminalOutputMarkerAccent:F.euiLightVars.euiColorAccent,terminalOutputMarkerWarning:F.euiDarkVars.euiColorWarning,terminalOutputSliderBackground:F.euiLightVars.euiColorDarkestShade};return{...t,...u}}),[d.colorMode]);return{...d,euiVars:u}};var z=u(15);const N=()=>Object(z.useUiSetting)("dateFormat"),V=(t,d)=>{var u;const f=null==t?void 0:t.destination,p=null==t||null===(u=t.file)||void 0===u?void 0:u.path;return p&&"file"===d?D(p):null!=f&&f.address&&"network"===d?D(W(f)):""},W=t=>{const d=!(null==t||!t.address||null==t||!t.port),u=`${null==t?void 0:t.address}:${null==t?void 0:t.port}`;return`${d?u:null==t?void 0:t.address}`},U=T.i18n.translate("xpack.sessionView.processTooltip",{defaultMessage:"Process alert"}),K=T.i18n.translate("xpack.sessionView.networkTooltip",{defaultMessage:"Network alert"}),q=T.i18n.translate("xpack.sessionView.fileTooltip",{defaultMessage:"File alert"}),G=t=>{let d="";switch(t){case"file":d=q;break;case"network":d=K;break;default:d=U}return d};var Y=u(0);const J=({alert:t,isInvestigated:d,isSelected:u,onClick:f,selectAlert:v,onShowAlertDetails:S})=>{var C,y,w,x;const O=(({isInvestigated:t,isSelected:d})=>{const{euiTheme:u,euiVars:f}=$();return Object(p.useMemo)((()=>{const{size:p,colors:v,font:b,border:S}=u,{bgColor:C,hoverBgColor:y}=(()=>{let u="none",f=`${Object(g.transparentize)(v.primary,.04)}`;return t&&d?(u=`${Object(g.transparentize)(v.danger,.08)}`,f=`${Object(g.transparentize)(v.danger,.12)}`):t?(u=`${Object(g.transparentize)(v.danger,.04)}`,f=`${Object(g.transparentize)(v.danger,.12)}`):d&&(u=`${Object(g.transparentize)(v.primary,.08)}`,f=`${Object(g.transparentize)(v.primary,.12)}`),{bgColor:u,hoverBgColor:f}})();return{alert:{fontFamily:b.family,padding:`0 ${p.m}`,cursor:"pointer","&:not(:last-child)":{marginBottom:p.s},background:C,"&:hover":{background:y},"&& button":{flexShrink:0,marginRight:p.xs,"&:hover, &:focus, &:focus-within":{backgroundColor:Object(g.transparentize)(f.buttonsBackgroundNormalDefaultPrimary,.2)}},"&& .euiFlexItem":{marginTop:p.xxs,marginBottom:p.xxs}},alertStatus:{textTransform:"capitalize"},alertName:{color:v.title,"& .alertCategoryDetailText":{fontSize:p.m}},actionBadge:{textTransform:"capitalize"},processPanel:{marginLeft:"8px",border:`${S.width.thin} solid ${v.lightShade}`,fontFamily:b.familyCode,padding:`${p.xs} ${p.s}`},processAlertDisplayContainer:{display:"flex",alignItems:"center"}}}),[u,t,d,f])})({isInvestigated:d,isSelected:u}),{event:j}=t,{uuid:k,rule:T,workflow_status:L}=(null===(C=t.kibana)||void 0===C?void 0:C.alert)||{},R=null==j||null===(y=j.category)||void 0===y?void 0:y[0],A=Object(p.useMemo)((()=>R&&R in M.d?M.d[R]:M.d.process),[R]);Object(p.useEffect)((()=>{d&&k&&v(k)}),[d,k,v]);const B=Object(p.useCallback)((()=>{k&&S(k)}),[S,k]),P=Object(p.useCallback)((()=>{var d;null!==(d=t.kibana)&&void 0!==d&&d.alert&&f(t.kibana.alert)}),[null===(w=t.kibana)||void 0===w?void 0:w.alert,f]);if(!t.kibana||!T)return null;const{name:F}=T,z=null!=R?R:"process",N=V(t,R),W=G(z),U=Array.isArray(null==j?void 0:j.type)?null==j||null===(x=j.type)||void 0===x?void 0:x[0]:null==j?void 0:j.type;return Object(Y.jsx)("div",{key:k,css:O.alert,"data-id":k},Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",wrap:!0,onClick:P,"data-test-subj":`sessionView:sessionViewAlertDetail-${k}`},Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{iconType:"expand","aria-label":"expand","data-test-subj":`sessionView:sessionViewAlertDetailExpand-${k}`,onClick:B})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{position:"top",content:W},Object(Y.jsx)(g.EuiIcon,{type:A,color:"danger"}))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)("div",{css:O.processAlertDisplayContainer},Object(Y.jsx)(g.EuiText,{"data-test-subj":`sessionView:sessionViewAlertDetailRuleName-${k}-text`,css:O.alertName,size:"s"},D(F)),N&&Object(Y.jsx)(g.EuiPanel,{css:O.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(Y.jsx)(g.EuiText,{"data-test-subj":`sessionView:sessionViewAlertDetail-${k}-text`,css:O.alertName,size:"s"},Object(Y.jsx)("span",{className:"alertCategoryDetailText"},N))))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiBadge,{color:H(L),css:O.alertStatus},D(L))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiBadge,{css:O.actionBadge},null==j?void 0:j.action)),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},"denied"===U&&Object(Y.jsx)(g.EuiBadge,{css:O.actionBadge,color:"danger"},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.blockedBadge",defaultMessage:"Blocked"})))))},X={all:T.i18n.translate("xpack.sessionView.alertDetailsAllSelectedCategory",{defaultMessage:"View: all alerts"}),process:T.i18n.translate("xpack.sessionView.alertDetailsProcessSelectedCategory",{defaultMessage:"View: process alerts"}),network:T.i18n.translate("xpack.sessionView.alertDetailsNetworkSelectedCategory",{defaultMessage:"View: network alerts"}),file:T.i18n.translate("xpack.sessionView.alertDetailsFileSelectedCategory",{defaultMessage:"View: file alerts"})},Z={all:T.i18n.translate("xpack.sessionView.alertDetailsAllFilterItem",{defaultMessage:"View all alerts"}),process:T.i18n.translate("xpack.sessionView.alertDetailsProcessFilterItem",{defaultMessage:"View process alerts"}),network:T.i18n.translate("xpack.sessionView.alertDetailsNetworkFilterItem",{defaultMessage:"View network alerts"}),file:T.i18n.translate("xpack.sessionView.alertDetailsFileFilterItem",{defaultMessage:"View file alerts"})},Q=({totalAlertsCount:t,alertTypeCounts:d,filteredAlertsCount:u,onAlertEventCategorySelected:f})=>{const{filterStatus:v,popover:S}=Object(p.useMemo)((()=>({filterStatus:{paddingLeft:"16px","& .text":{fontWeight:600}},popover:{paddingRight:"16px","&  .filterMenu":{width:"180px"}}})),[]),[C,y]=Object(p.useState)("all"),[w,x]=Object(p.useState)(!1),O=()=>{x(!1)},j=Object(p.useCallback)((t=>{const[d,u]=t.target.textContent.split(" ");y(u),f(u),O()}),[f]),k=Object(p.useMemo)((()=>d.reduce(((t,{count:d})=>d>0?t+1:0),0)>1),[d]),T=Object(Y.jsx)(g.EuiButtonEmpty,{"data-test-subj":"sessionView:sessionViewAlertDetailsEmptyFilterButton",size:"s",iconType:"arrowDown",iconSide:"right",onClick:()=>{x(!w)}},X[C]),L=Object(p.useMemo)((()=>{const t=t=>t===C?"check":"empty",u=d.filter((({count:t})=>t>0)).map((({category:d})=>Object(Y.jsx)(g.EuiContextMenuItem,{"data-test-subj":`sessionView:sessionViewAlertDetailsFilterItem-${d}`,key:d,icon:t(d),onClick:j},Z[d])));return[Object(Y.jsx)(g.EuiContextMenuItem,{"data-test-subj":"sessionView:sessionViewAlertDetailsFilterItem-default",key:M.h,icon:t(M.h),onClick:j},Z.all),...u]}),[C,d,j]);return Object(Y.jsx)("div",{"data-test-subj":"sessionView:sessionViewAlertDetailsFilter"},Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center"},Object(Y.jsx)(g.EuiFlexItem,{css:v,style:{paddingLeft:"16px"}},Object(Y.jsx)(g.EuiText,{size:"s","data-test-subj":"sessionView:sessionViewAlertDetailsFilterStatus"},t===u&&Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.alertTotalCountStatusLabel",defaultMessage:"Showing {count} alerts",values:{count:Object(Y.jsx)("strong",null,t)}}),t!==u&&Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.alertFilteredCountStatusLabel",defaultMessage:" Showing {count} alerts",values:{count:Object(Y.jsx)("strong",null,u," of ",t)}}))),k&&Object(Y.jsx)(g.EuiFlexItem,{css:S,grow:!1,"data-test-subj":"sessionView:sessionViewAlertDetailsFilterSelectorContainer"},Object(Y.jsx)(g.EuiPopover,{button:T,isOpen:w,closePopover:O,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(Y.jsx)(g.EuiContextMenuPanel,{"data-test-subj":"sessionView:sessionViewAlertDetailsFilterSelectorContainerMenu",size:"s",className:"filterMenu",items:L})))),Object(Y.jsx)(g.EuiHorizontalRule,{margin:"xs"}))};function ee({alerts:t,investigatedAlertId:d,isProcessSelected:u=!1,alertTypeCounts:f,onAlertSelected:v,onShowAlertDetails:g}){const[b,S]=Object(p.useState)(null),[C,y]=Object(p.useState)(M.h),w=B();Object(p.useEffect)((()=>{const u=d&&t.find((t=>{var u,f;return(null===(u=t.kibana)||void 0===u||null===(f=u.alert)||void 0===f?void 0:f.uuid)===d}));var f;u&&S(null===(f=u.kibana)||void 0===f?void 0:f.alert)}),[d,t]);const x=Object(p.useRef)(null),O=Object(p.useCallback)((t=>{if(null==x||!x.current)return;const d=x.current.querySelector(`[data-id="${t}"]`);if(d){const t=x.current.scrollTop,u=t+x.current.clientHeight,f=d.offsetTop,p=f+d.clientHeight;f>=t&&p<=u||d.scrollIntoView({block:"nearest"})}}),[]),j=Object(p.useCallback)((t=>{v(M.v),S(t)}),[v]),k=Object(p.useCallback)((t=>{y(t)}),[]),T=Object(p.useMemo)((()=>null==t?void 0:t.filter((t=>{var d,u;const f=null===(d=t.event)||void 0===d||null===(u=d.category)||void 0===u?void 0:u[0];return C===M.h||f===C}))),[C,t]);return 0===t.length?null:Object(Y.jsx)("div",{ref:x,css:w.container,"data-test-subj":"sessionView:sessionViewAlertDetails"},Object(Y.jsx)(Q,{totalAlertsCount:t.length,alertTypeCounts:f,filteredAlertsCount:T.length,onAlertEventCategorySelected:k}),T.map(((t,f)=>{var p,v;const S=(null===(p=t.kibana)||void 0===p||null===(v=p.alert)||void 0===v?void 0:v.uuid)||null;return Object(Y.jsx)(J,{key:`${S}-${f}`,alert:t,isInvestigated:d===S,isSelected:u&&(null==b?void 0:b.uuid)===S,onClick:j,selectAlert:O,onShowAlertDetails:g})})))}const te=()=>{const{euiTheme:t,euiVars:d}=$();return Object(p.useMemo)((()=>{const{border:u,colors:f,size:p,font:v}=t,b={lineHeight:"18px",height:"20px",fontSize:p.m,fontFamily:v.family,fontWeight:v.weight.medium,borderRadius:u.radius.small,marginLeft:p.xs,marginRight:p.xs,minWidth:0,padding:`${p.s} ${p.xxs}`,color:d.euiColorVis6_asText,background:Object(g.transparentize)(d.euiColorVis6,.04),border:`${u.width.thin} solid ${Object(g.transparentize)(d.euiColorVis6,.48)}`,"&& > span":{padding:`0px ${p.xxs}`,svg:{transition:`transform ${t.animation.extraFast}`}},"&&:hover, &&:focus":{background:Object(g.transparentize)(d.euiColorVis6,.12),textDecoration:"none"},"&.isExpanded > span svg:not(.alertIcon)":{transform:"rotate(180deg)"},"&.isExpanded":{color:f.ghost,background:d.euiColorVis6,"&:hover, &:focus":{background:d.euiColorVis6}}};return{buttonArrow:{marginLeft:p.xs},button:b,alertButton:{...b,color:d.euiColorDanger,background:Object(g.transparentize)(d.euiColorDanger,.04),border:`${u.width.thin} solid ${Object(g.transparentize)(d.euiColorDanger,.48)}`,"&&:hover, &&:focus":{background:Object(g.transparentize)(d.euiColorDanger,.12),textDecoration:"none"},"&.isExpanded":{color:f.ghost,background:d.euiColorDanger,"&:hover, &:focus":{background:`${d.euiColorDanger}`}},"& .euiButton__text":{display:"flex",alignItems:"center"," .alertIcon":{marginLeft:"4px"}}},outputButton:{...b,color:d.euiColorVis1,background:Object(g.transparentize)(d.euiColorVis1,.04),border:`${u.width.thin} solid ${Object(g.transparentize)(d.euiColorVis1,.48)}`,"&&:hover, &&:focus":{background:Object(g.transparentize)(d.euiColorVis1,.12),textDecoration:"none"},"&.isExpanded":{color:f.ghost,background:d.euiColorVis1,"&:hover, &:focus":{background:`${d.euiColorVis1}`}}},userChangedButton:{...b,cursor:"default",color:d.euiColorGhost,background:d.euiColorVis3,border:`${u.width.thin} solid ${Object(g.transparentize)(d.euiColorVis3,.48)}`,"&&:hover, &&:focus":{color:d.euiColorGhost,background:d.euiColorVis3,textDecoration:"none",transform:"none",animation:"none"}},buttonSize:{padding:`0px ${t.size.xs}`}}}),[t,d])},ie=T.i18n.translate("xpack.sessionView.childProcesses",{defaultMessage:"Child processes"}),se=T.i18n.translate("xpack.sessionView.alerts",{defaultMessage:"Alerts"}),re=T.i18n.translate("xpack.sessionView.alert",{defaultMessage:"Alert"}),ne=T.i18n.translate("xpack.sessionView.output",{defaultMessage:"Output"}),oe=({onToggle:t,isExpanded:d})=>{const{button:u,buttonArrow:f}=te();return Object(Y.jsx)(g.EuiButton,{className:d?"isExpanded":"",key:"child-processes-button",css:u,onClick:t,"data-test-subj":"sessionView:processTreeNodeChildProcessesButton","aria-label":ie},ie,Object(Y.jsx)(g.EuiIcon,{css:f,size:"s",type:"arrowDown"}))},ae=({isExpanded:t,alertTypeCounts:d,onToggle:u,alertsCount:f})=>{const{alertButton:v,buttonArrow:b}=te(),S=Object(p.useMemo)((()=>{var t;return null==d||null===(t=d.filter((t=>t.count>0)))||void 0===t?void 0:t.map((({category:t},d)=>M.d[t]))}),[d]);return Object(Y.jsx)(g.EuiButton,{className:t?"isExpanded":"",key:"alert-button",css:v,onClick:u,"data-test-subj":"processTreeNodeAlertButton","aria-label":se},f>1?se:re,f>1&&(f>99?" (99+)":` (${f})`),null==S?void 0:S.map((t=>Object(Y.jsx)(g.EuiIcon,{className:"alertIcon",key:t,size:"s",type:t}))),Object(Y.jsx)(g.EuiIcon,{css:b,size:"s",type:"arrowDown"}))},le=({onClick:t})=>{const{outputButton:d,buttonArrow:u}=te();return Object(Y.jsx)(g.EuiButton,{key:"output-button",css:d,onClick:t,"data-test-subj":"processTreeNodeOutpuButton","aria-label":ne},ne,Object(Y.jsx)(g.EuiIcon,{css:u,size:"s",type:"arrowRight"}))};var ce=u(5),he=u.n(ce);const de={},ue=({children:t,role:d="document",highlightIndices:u,highlightStyle:f,...p})=>Object(Y.jsx)(v.a.Fragment,null,t.split("").map((function(t,d){const g=null==u?void 0:u.includes(d);return Object(Y.jsx)("span",he()({"aria-hidden":"true",css:g?f:de,key:d},g?{"data-test-subj":"sessionView:splitTextIsHighlighted"}:{},p)," "===t?Object(Y.jsx)(v.a.Fragment,null," "):t)}))),_e={width:"6px",display:"inline-block"},fe=()=>Object(Y.jsx)("span",{css:_e}," "),pe={"&&":{display:"inline",fontSize:0,lineHeight:0}},ve=({children:t,match:d,text:u,highlightStyle:f})=>{let p=0;return Object(Y.jsx)("span",{css:pe,"aria-label":u,role:"document"},d?v.a.Children.map(t,(t=>{const u=t.props.children.length,g=d.map((t=>t-p));return p+=u,v.a.cloneElement(t,{highlightIndices:g,highlightStyle:f})})):t)},ge=T.i18n.translate("xpack.sessionView.execUserChange",{defaultMessage:"Exec user change"}),me=T.i18n.translate("xpack.sessionView.collapseAll",{defaultMessage:"Collapse all"});function be({process:t,isSessionLeader:d=!1,depth:u=0,onProcessSelected:f,jumpToEntityId:S,investigatedAlertId:C,selectedProcess:y,showTimestamp:w,verboseMode:x,searchResults:O,scrollerRef:j,onChangeJumpToEventVisibility:k,onShowAlertDetails:R,onJumpToOutput:A,loadPreviousButton:B,loadNextButton:P,handleCollapseProcessTree:H,trackEvent:F}){var z,V,W;const[U,K]=Object(p.useState)(d||t.autoExpand),[q,G]=Object(p.useState)(!1),{searchMatched:J}=t,X=N();Object(p.useEffect)((()=>{K(t.autoExpand)}),[t.autoExpand]),Object(p.useEffect)((()=>{!U&&y&&y.isDescendantOf(t)&&K(!0)}),[y,t,U]);const Z=t.getAlerts(),Q=!!Z.length,ie=t.hasOutput(),se=Object(p.useMemo)((()=>!(!Q||!Z.find((t=>{var d,u;return C&&C===(null===(d=t.kibana)||void 0===d||null===(u=d.alert)||void 0===u?void 0:u.uuid)})))),[Q,Z,C]),re=(null==y?void 0:y.id)===t.id,ne=(({depth:t,hasAlerts:d,hasInvestigatedAlert:u,isSelected:f,isSessionLeader:v})=>{const{euiTheme:b,euiVars:S}=$();return Object(p.useMemo)((()=>{const{colors:p,border:C,size:y,font:w}=b,x="21px",O="13px",j=`calc(${y.l} + ${y.xxs})`,k=y.s,T={color:p.text,fontFamily:w.familyCode},L={position:"relative",color:p.ghost,marginLeft:y.base,paddingLeft:y.s,borderLeft:C.editable},R={color:S.euiColorDarkShade},{bgColor:A,borderColor:D,hoverColor:M,searchResColor:B}=(()=>{let t="none",v=Object(g.transparentize)(p.primary,.04),b="transparent",S=Object(g.transparentize)(p.warning,.32);return d&&(b=p.danger),f&&(S=p.warning,t=Object(g.transparentize)(p.primary,.08),v=Object(g.transparentize)(p.primary,.12)),u&&(t=Object(g.transparentize)(p.danger,.04),v=Object(g.transparentize)(p.danger,.12),f&&(t=Object(g.transparentize)(p.danger,.08))),{bgColor:t,borderColor:b,hoverColor:v,searchResColor:S}})(),P={fontSize:0,lineHeight:0},H={...P,display:"block",cursor:"pointer",position:"relative","&:hover:before":{backgroundColor:M},"&:before":{position:"absolute",height:"100%",pointerEvents:"none",content:"''",marginLeft:`calc(-${t} * ${j} - ${k})`,borderLeft:`3px solid ${D}`,backgroundColor:A,width:`calc(100% + ${t} * ${j} + ${k})`},".euiToolTipAnchor":{verticalAlign:"middle"}},F={marginLeft:y.s,span:{fontSize:O,lineHeight:x,verticalAlign:"middle"}},$={...P,"span, b":{fontSize:O,lineHeight:x,display:"inline-block",verticalAlign:"middle"},paddingLeft:k};return v&&(H.position="sticky",H.top="-"+y.base,H.zIndex=1,H.borderTop=`${y.base} solid transparent`,H.backgroundColor=S.euiColorLightestShade,H.borderBottom=C.editable),{darkText:T,searchHighlight:{color:p.fullShade,borderRadius:"0px",backgroundColor:B},children:L,processNode:H,wrapper:{paddingLeft:y.s,position:"relative",verticalAlign:"middle",color:S.euiTextSubduedColor,wordBreak:"break-all",padding:`${y.xs} 0px`,button:{marginLeft:"6px",marginRight:y.xxs}},workingDir:{color:p.successText,fontFamily:w.familyCode,fontWeight:w.weight.regular},timeStamp:{float:"right",fontFamily:w.familyCode,fontSize:y.m,fontWeight:w.weight.regular,paddingRight:y.base,paddingLeft:y.xxl,position:"relative",lineHeight:x,marginTop:"1px"},alertDetails:{padding:y.s,border:C.editable,borderRadius:C.radius.medium},icon:R,textSection:F,sessionLeader:$,jumpToTop:{float:"right"}}}),[t,b,d,u,f,S,v])})({depth:u,hasAlerts:Q,hasInvestigatedAlert:se,isSelected:re,isSessionLeader:d}),ce=te(),he=function({viewPortEl:t,visibleCallback:d,shouldAddListener:u=!1,offset:f=0,debounceTimeout:v=M.g}){const g=Object(p.useRef)(null),b=Object(p.useMemo)((()=>Object(L.debounce)((()=>{if(!g.current||!t)return;const{height:u,y:p}=g.current.getBoundingClientRect(),{y:v}=t.getBoundingClientRect(),b=v+t.clientHeight,S=p+u;d(S+f>=v&&p-f<=b,S+f<v)}),v)),[v,f,t,d]);return Object(p.useEffect)((()=>(u&&(null==t||t.addEventListener("scroll",b)),()=>{u&&(null==t||t.removeEventListener("scroll",b))})),[b,t,u]),g}({viewPortEl:j.current,visibleCallback:Object(p.useCallback)(((t,d)=>{k(t,d)}),[k]),shouldAddListener:se}),de=Object(p.useMemo)((()=>Object(L.chain)(Z).groupBy((t=>{var d;const u=null===(d=t.event)||void 0===d?void 0:d.category;return Array.isArray(u)?null==u?void 0:u[0]:u})).map(((t,d)=>({category:d,count:t.length}))).value()),[Z]);Object(p.useEffect)((()=>{var d;t.id===(null==y?void 0:y.id)&&null!==(d=he.current)&&void 0!==d&&d.scrollIntoView&&he.current.scrollIntoView({behavior:"smooth",block:"nearest"})}),[y,t,he]),Object(p.useEffect)((()=>{se&&G(!0)}),[se]);const _e=Object(p.useCallback)((()=>{const t=!U;K(t),F(t?"children_opened":"children_closed")}),[U,F]),pe=Object(p.useCallback)((()=>{const t=!q;G(t),F(t?"alerts_opened":"alerts_closed")}),[q,F]),Se=Object(p.useCallback)((u=>{u.stopPropagation();const p=window.getSelection();p&&"Range"===p.type||(null==f||f(t),d&&j.current&&(j.current.scrollTop=0),F("process_selected"))}),[d,f,t,j,F]),Ce=t.getDetails(),ye=t.hasExec(),we=Object(p.useCallback)((()=>{var t;const d=null===(t=Ce.process)||void 0===t?void 0:t.entity_id;d&&A(d),F("output_clicked")}),[A,null===(z=Ce.process)||void 0===z?void 0:z.entity_id,F]),xe=Object(p.useMemo)((()=>t.parent?ye?"console":"branch":"unlink"),[ye,t.parent]),Ee=Object(p.useMemo)((()=>t.parent?ye?T.i18n.translate("xpack.sessionView.processNode.tooltipExec",{defaultMessage:"Process exec'd"}):T.i18n.translate("xpack.sessionView.processNode.tooltipFork",{defaultMessage:"Process forked (no exec)"}):T.i18n.translate("xpack.sessionView.processNode.tooltipOrphan",{defaultMessage:"Process missing parent (orphan)"})),[ye,t.parent]),Oe=t.getChildren(x),je=null==Ce||null===(V=Ce.process)||void 0===V?void 0:V.user,ke=Object(p.useMemo)((()=>null!=je&&je.name?je.name:"0"===(null==je?void 0:je.id)?"root":null!=je&&je.id?`uid: ${null==je?void 0:je.id}`:"-"),[null==je?void 0:je.id,null==je?void 0:je.name]);if(null==Ce||!Ce.process)return null;const Te=t.id,{args:Le,name:Re,tty:Ae,parent:De,working_directory:Me,start:Be}=Ce.process,Ie=d||U&&(null==Oe?void 0:Oe.length)>0,Pe=u+1,He=!d&&!(null==je||!je.id)&&je.id!==(null==De||null===(W=De.user)||void 0===W?void 0:W.id),Fe=Ae?"desktop":"gear",$e=ye?"sessionView:processTreeNodeExecIcon":"sessionView:processTreeNodeForkIcon",ze=Object(g.formatDate)(Be,X),Ne=`${null!=Me?Me:""} ${null==Le?void 0:Le.join(" ")}`;return Object(Y.jsx)("div",null,Object(Y.jsx)("div",{"data-id":Te,key:Te+J,css:ne.processNode,"data-test-subj":"sessionView:processTreeNode",ref:he},Object(Y.jsx)("div",{"data-test-subj":"sessionView:processTreeNodeRow",css:ne.wrapper,onClick:Se},d?Object(Y.jsx)("span",{css:ne.sessionLeader},Object(Y.jsx)(g.EuiIcon,{type:Fe,css:ne.icon}),Object(Y.jsx)(fe,null),Object(Y.jsx)("b",{css:ne.darkText},D(Re||(null==Le?void 0:Le[0]))),Object(Y.jsx)(fe,null),Object(Y.jsx)("span",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.startedBy",defaultMessage:"started by"})),Object(Y.jsx)(fe,null),Object(Y.jsx)(g.EuiIcon,{type:"user"}),Object(Y.jsx)(fe,null),Object(Y.jsx)("b",{css:ne.darkText},ke),Object(Y.jsx)(fe,null),Object(Y.jsx)("span",{css:ne.jumpToTop},Object(Y.jsx)(g.EuiToolTip,{title:me},Object(Y.jsx)(g.EuiButtonIcon,{size:"xs",iconType:"fold",onClick:H})))):Object(Y.jsx)(v.a.Fragment,null,w&&Object(Y.jsx)("span",{"data-test-subj":"sessionView:processTreeNodeTimestamp",css:ne.timeStamp},ze),Object(Y.jsx)(g.EuiToolTip,{position:"top",content:Ee},Object(Y.jsx)(g.EuiIcon,{"data-test-subj":$e,type:xe,css:ne.icon})),Object(Y.jsx)("span",{css:ne.textSection},Object(Y.jsx)(ve,{text:Ne,match:t.searchMatched,highlightStyle:ne.searchHighlight},Object(Y.jsx)(ue,{css:ne.workingDir},D(Me)+" "),Object(Y.jsx)(ue,{css:ne.darkText},`${D(null==Le?void 0:Le[0])}`),Object(Y.jsx)(ue,null,Le&&Le.length>1?" "+(null==Le?void 0:Le.slice(1).join(" ")):"")))),He&&Object(Y.jsx)(g.EuiButton,{"data-test-subj":"sessionView:processTreeNodeRootEscalationFlag",css:ce.userChangedButton,"aria-label":ge},ge," (",ke,")"),!d&&Oe.length>0&&Object(Y.jsx)(oe,{isExpanded:U,onToggle:_e}),Q&&Object(Y.jsx)(ae,{onToggle:pe,alertTypeCounts:de,isExpanded:q,alertsCount:Z.length}),ie&&Object(Y.jsx)(le,{onClick:we}))),q&&Object(Y.jsx)(ee,{alerts:Z,alertTypeCounts:de,investigatedAlertId:C,isProcessSelected:re,onAlertSelected:Se,onShowAlertDetails:R}),Ie&&Object(Y.jsx)("div",{css:ne.children},B,Oe.map((t=>Object(Y.jsx)(be,{key:t.id,process:t,depth:Pe,onProcessSelected:f,onJumpToOutput:A,jumpToEntityId:S,investigatedAlertId:C,selectedProcess:y,showTimestamp:w,verboseMode:x,searchResults:O,scrollerRef:j,onChangeJumpToEventVisibility:k,onShowAlertDetails:R,trackEvent:F}))),P))}const Se=({isDisplayedAbove:t=!1,onClick:d})=>{const u=(({isDisplayedAbove:t})=>{const{euiTheme:d,euiVars:u}=$();return Object(p.useMemo)((()=>{const{size:f,font:p}=d,v={color:F.euiLightVars.euiColorEmptyShade,backgroundColor:F.euiLightVars.euiColorPrimaryText},g={position:"absolute",height:f.xxxxl,width:"100%",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},b={position:"sticky",pointerEvents:"auto",cursor:"pointer",fontWeight:p.weight.regular};return t?(g.top=0,g.background=`linear-gradient(180deg, ${u.euiColorLightestShade} 0%, transparent 100%)`):(g.bottom=0,g.background=`linear-gradient(360deg, ${u.euiColorLightestShade} 0%, transparent 100%)`),{container:g,jumpBackBadge:b,buttonStyle:v}}),[t,d,u])})({isDisplayedAbove:t});return Object(Y.jsx)("div",{css:u.container},Object(Y.jsx)(g.EuiBadge,{style:u.buttonStyle,css:u.jumpBackBadge,iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:d,onClickAriaLabel:"Back to investigated alert","data-test-subj":"sessionView:backToInvestigatedAlert"},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.backToInvestigatedAlert",defaultMessage:"Back to investigated alert"})))};var Ce=u(21),ye=u.n(Ce),we=u(22),xe=u.n(we);const Ee=(t,d)=>{var u,f,p,v;const g=(null===(u=t.getDetails())||void 0===u||null===(f=u.process)||void 0===f?void 0:f.start)||0,b=(null===(p=d.getDetails())||void 0===p||null===(v=p.process)||void 0===v?void 0:v.start)||0;return g<b?-1:g>b?1:0};function Oe(t,d){const u=(null==d?void 0:d.entity_id)||Object(f.v4)(),p=new hooks_ProcessImpl(u);if(t&&d){var v;const f={...t,process:{...t.process,...d},user:d.user,group:d.group,event:{...t.event,id:`fake-${u}`}};var g;(null===(v=t.process)||void 0===v?void 0:v.parent)===d&&(null===(g=f.process)||void 0===g||delete g.parent),p.addEvent(f)}return p}const je=(t,d)=>t.split("").reduce(((t,u,f)=>(d.find((t=>void 0!==t.index&&f>=t.index&&f<t.index+t[0].length))&&(t=[...t,f]),t)),[]),ke=(t,d)=>{for(const u of Object.keys(t)){const f=t[u];if(f.isUserEntered()||d===f.id||f.hasAlerts()){let{parent:t}=f;const d=new Set;for(;t&&!d.has(t.id);)d.add(t.id),t.autoExpand=!0,t=t.parent}}return t},Te=t=>{t.autoExpand&&t.children&&t.children.forEach((t=>{t.autoExpand=!1,Te(t)}))};class hooks_ProcessImpl{constructor(t){ye()(this,"id",void 0),ye()(this,"events",void 0),ye()(this,"alerts",void 0),ye()(this,"children",void 0),ye()(this,"parent",void 0),ye()(this,"autoExpand",void 0),ye()(this,"searchMatched",void 0),ye()(this,"orphans",void 0),ye()(this,"getChildrenMemo",xe()(((t,d,u)=>0===t.length&&0===d.length?[]:(d.length&&(t=[...t,...d]),u||(t=t.filter((t=>!(0===t.events.length||!t.autoExpand&&!t.hasAlerts()&&t.isVerbose())))),Object(L.sortedUniqBy)(t.sort(Ee),(t=>t.id)))))),ye()(this,"findEventByAction",xe()(((t,d)=>t.find((({event:t})=>{var u;return null==t||null===(u=t.action)||void 0===u?void 0:u.includes(d)}))))),ye()(this,"findEventByKind",xe()(((t,d)=>t.find((({event:t})=>(null==t?void 0:t.kind)===d))))),ye()(this,"filterEventsByAction",xe()(((t,d)=>t.filter((({event:t})=>{var u;return null==t||null===(u=t.action)||void 0===u?void 0:u.includes(d)}))))),ye()(this,"filterEventsByKind",xe()(((t,d)=>t.filter((({event:t})=>(null==t?void 0:t.kind)===d))))),ye()(this,"getDetailsMemo",xe()((t=>{var d;const u=t.filter((t=>{var d;const u=null==t||null===(d=t.event)||void 0===d?void 0:d.action;return(null==u?void 0:u.includes("fork"))||(null==u?void 0:u.includes("exec"))||(null==u?void 0:u.includes("end"))}));return 0===u.length&&t.length>0?t[t.length-1]:null!==(d=u[u.length-1])&&void 0!==d?d:{}}))),this.id=t,this.events=[],this.alerts=[],this.children=[],this.orphans=[],this.autoExpand=!1,this.searchMatched=null}addEvent(t){this.events.find((d=>{var u,f;return(null===(u=d.event)||void 0===u?void 0:u.id)===(null===(f=t.event)||void 0===f?void 0:f.id)}))||(this.events=this.events.concat(t))}addAlert(t){this.alerts.find((d=>{var u,f;return(null===(u=d.event)||void 0===u?void 0:u.id)===(null===(f=t.event)||void 0===f?void 0:f.id)}))||(this.alerts=this.alerts.concat(t))}addChild(t){this.children=this.children.concat(t)}clearSearch(){this.searchMatched=null}getChildren(t){return this.getChildrenMemo(this.children,this.orphans,t)}isVerbose(){var t;const{group_leader:d,session_leader:u,entry_leader:f}=null!==(t=this.getDetails().process)&&void 0!==t?t:{};return!(this.id===(null==f?void 0:f.entity_id)||d&&u&&d.pid!==u.pid)}hasOutput(){return!!this.findEventByAction(this.events,"text_output")}hasAlerts(){return!!this.alerts.length}hasAlert(t){return!!t&&!!this.alerts.find((d=>{var u,f;return(null===(u=d.kibana)||void 0===u||null===(f=u.alert)||void 0===f?void 0:f.uuid)===t}))}getAlerts(){return this.alerts}updateAlertsStatus(t){this.alerts=((t,d)=>t.map((t=>{var u,f,p,v,g;return t.kibana?{...t,kibana:{...t.kibana,alert:{...t.kibana.alert,workflow_status:null!==(u=null===(f=d[null!==(p=null===(v=t.kibana.alert)||void 0===v?void 0:v.uuid)&&void 0!==p?p:""])||void 0===f?void 0:f.status)&&void 0!==u?u:null===(g=t.kibana.alert)||void 0===g?void 0:g.workflow_status}}}:t})))(this.alerts,t)}hasExec(){return!!this.findEventByAction(this.events,"exec")}hasExited(){return!!this.findEventByAction(this.events,"end")}getDetails(){return this.getDetailsMemo(this.events)}getOutput(){return""}getEndTime(){const t=this.findEventByAction(this.events,"end");return(null==t?void 0:t["@timestamp"])||""}isUserEntered(){var t;const d=this.getDetails();if(!d)return!1;const{pid:u,tty:f,parent:p,session_leader:v,group_leader:g}=null!==(t=d.process)&&void 0!==t?t:{},b=p&&v&&p.pid===v.pid,S=g&&u===g.pid;return!!(f&&b&&S)}isDescendantOf(t){let d=this.parent;for(;d;){if(d===t)return!0;d=d.parent}return!1}}const Le=({sessionEntityId:t,data:d,searchQuery:u,updatedAlertsStatus:f,verboseMode:v,jumpToEntityId:g})=>{var b,S;const C=null===(b=d[0])||void 0===b||null===(S=b.events)||void 0===S?void 0:S[0],y=Object(p.useMemo)((()=>{var t;const d=null==C||null===(t=C.process)||void 0===t?void 0:t.entry_leader;return Oe(C,d)}),[C]),w={[t]:y},[x,O]=Object(p.useState)(w),[j,k]=Object(p.useState)([]),[T,R]=Object(p.useState)([]),[A,D]=Object(p.useState)([]);return Object(p.useEffect)((()=>{let u=x,f=A;const p=[];d.forEach(((d,v)=>{if(!j.find((t=>{var u,f;return t.cursor===d.cursor&&(null===(u=t.events)||void 0===u?void 0:u.length)===(null===(f=d.events)||void 0===f?void 0:f.length)}))){const g=v<j.length,b=((t,d,u,f,p=!1)=>{if(!d||0===d.length)return[t,u];const v=((t,d)=>(d.forEach((d=>{var u,f,p;const{entity_id:v}=null!==(u=d.process)&&void 0!==u?u:{};if(!v)return;let g=t[v];g||(g=new hooks_ProcessImpl(v),t[v]=g),null!==(f=d.kibana)&&void 0!==f&&f.alert?g.addAlert(d):"event"===(null===(p=d.event)||void 0===p?void 0:p.kind)&&g.addEvent(d)})),t))(t,d),g=((t,d,u,f,p=!1)=>{p&&(d=d.slice().reverse()),d.forEach((d=>{var p,v;const{entity_id:g,parent:b}=null!==(p=d.process)&&void 0!==p?p:{},S=t[null!=g?g:""];let C=t[null!==(v=null==b?void 0:b.entity_id)&&void 0!==v?v:""];if(g&&b&&!S.parent&&g!==f){if(!C){var y;const f=null==d||null===(y=d.process)||void 0===y?void 0:y.parent;null!=f&&f.entity_id&&!t[f.entity_id]?(C=Oe(d,f),t[C.id]=C,u.includes(C)||u.push(C)):u.includes(S)||u.push(S)}C&&(S.parent=C,C.addChild(S))}}));const v=[];return null==u||u.forEach((d=>{var u,f;const p=null===(u=d.getDetails().process)||void 0===u||null===(f=u.parent)||void 0===f?void 0:f.entity_id;if(p){const u=t[p];if(u)return d.parent=u,void u.addChild(d)}v.push(d)})),v})(v,d,u,f,p);return[ke(v),g]})(u,d.events,A,t,g);u=b[0],f=b[1],p.push(d)}})),p.length>0&&(O({...u}),k([...j,...p]),D(f),ke(u,g))}),[d,x,A,j,t,g]),Object(p.useEffect)((()=>{R(((t,d,u)=>{const f=[];for(const g of Object.keys(t)){const b=t[g];if(d){var p,v;const t=b.getDetails(),g=null==t||null===(p=t.process)||void 0===p?void 0:p.entry_leader;if((null==g?void 0:g.entity_id)===b.id||!u&&b.isVerbose())continue;const S=b.getDetails(),{working_directory:C,args:y}=null!==(v=S.process)&&void 0!==v?v:{},w=`${null!=C?C:""} ${null==y?void 0:y.join(" ")}`,x=[...w.matchAll(new RegExp(Object(L.escapeRegExp)(d),"gi"))];b.searchMatched=x.length>0?je(w,x):null,b.searchMatched&&f.push(b)}else b.clearSearch()}return f.sort(Ee)})(x,u,v))}),[u,x,v]),x[t].orphans=A,Object.keys(f).forEach((t=>{const d=x[f[t].processEntityId];d&&d.updateAlertsStatus(f)})),{sessionLeader:x[t],processMap:x,searchResults:T}},Re=({onClick:t,text:d,isFetching:u,eventsRemaining:f,forward:v})=>{const S=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const{border:d}=t;return{wrapper:{display:"flex",alignItems:"center"},dottedLine:{flex:1,borderTop:`${d.width.thick} dotted ${d.color}`}}}),[t])})();return Object(Y.jsx)("div",{css:S.wrapper},Object(Y.jsx)(g.EuiButtonEmpty,{size:"xs",iconType:v?"arrowDown":"arrowUp",onClick:t,isLoading:u},d,f>0&&Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.processTreeLoadMoreButton",defaultMessage:" ({count} left)",values:{count:f}})),Object(Y.jsx)("span",{css:S.dottedLine}))};const Ae=T.i18n.translate("xpack.sessionView.processTree.loadMore",{defaultMessage:"Show {pageSize} next events",values:{pageSize:M.x}}),De=T.i18n.translate("xpack.sessionView.processTree.loadPrevious",{defaultMessage:"Show {pageSize} previous events",values:{pageSize:M.x}}),Me=({sessionEntityId:t,data:d,jumpToEntityId:u,investigatedAlertId:f,isFetching:b,hasNextPage:S,hasPreviousPage:C,fetchNextPage:y,fetchPreviousPage:w,searchQuery:x,selectedProcess:O,onProcessSelected:j,setSearchResults:k,updatedAlertsStatus:T,onShowAlertDetails:L,onJumpToOutput:A,trackEvent:D,showTimestamp:B=!0,verboseMode:P=!1})=>{const[H,F]=Object(p.useState)(!0),[z,N]=Object(p.useState)(!1),V=(()=>{const{euiTheme:t,euiVars:d}=$();return Object(p.useMemo)((()=>{const{colors:u,font:f,size:p}=t,v=u.primary;return{sessionViewProcessTree:{position:"relative",fontFamily:f.familyCode,overflow:"auto",height:"100%",backgroundColor:d.euiColorLightestShade},selectionArea:{position:"absolute",display:"none",marginLeft:"-50%",width:"150%",height:"100%",backgroundColor:v,pointerEvents:"none",opacity:.1,transform:`translateY(-${p.xs})`},defaultSelected:Object(g.transparentize)(u.primary,.008),alertSelected:Object(g.transparentize)(u.danger,.008)}}),[t,d])})(),{sessionLeader:W,processMap:U,searchResults:K}=Le({sessionEntityId:t,data:d,searchQuery:x,updatedAlertsStatus:T,verboseMode:P,jumpToEntityId:u}),[q,G]=Object(p.useState)(0),J=Object(p.useMemo)((()=>{var t;return((null==d||null===(t=d[0])||void 0===t?void 0:t.total)||0)-d.reduce(((t,d)=>{var u;return t+((null==d||null===(u=d.events)||void 0===u?void 0:u.length)||0)}),0)}),[d]),X=Object(p.useRef)(null),Z=Object(p.useCallback)(((t,d)=>{t!==H&&F(t),t||d===z||N(d)}),[H,z]),Q=Object(p.useCallback)((()=>{j(null),F(!0)}),[j]),ee=Object(p.useCallback)((()=>{Te(W),X.current&&(X.current.scrollTop=0),G(Math.random()),D("collapse_tree")}),[W,D]);return Object(p.useEffect)((()=>{k&&k(K)}),[K,k]),function({div:t,handler:d}){Object(p.useEffect)((()=>{if(t){const u=R.a.debounce((()=>{const u=function(t){return t?t.scrollTop:document.documentElement.scrollTop||document.body.scrollTop}(t),f=u+t.offsetHeight>t.scrollHeight-20;d(u,f)}),M.g);return t.onscroll=u,()=>{u.cancel(),t.onscroll=null}}}),[t,d])}({div:X.current,handler:(t,d)=>{!b&&d&&y()}}),Object(p.useEffect)((()=>{if(u){const t=U[u],d=!(null==t||!t.getDetails());!O&&d&&j(t)}else O||j(W)}),[u,U,j,O,W]),Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)("div",{ref:X,css:V.sessionViewProcessTree,"data-test-subj":"sessionView:sessionViewProcessTree",key:q},W&&Object(Y.jsx)(be,{isSessionLeader:!0,process:W,onProcessSelected:j,onJumpToOutput:A,jumpToEntityId:u,investigatedAlertId:f,selectedProcess:O,scrollerRef:X,onChangeJumpToEventVisibility:Z,onShowAlertDetails:L,showTimestamp:B,verboseMode:P,searchResults:K,handleCollapseProcessTree:ee,trackEvent:D,loadPreviousButton:C?Object(Y.jsx)(Re,{text:De,onClick:w,isFetching:b,eventsRemaining:J,forward:!1}):null,loadNextButton:S?Object(Y.jsx)(Re,{text:Ae,onClick:y,isFetching:b,eventsRemaining:J,forward:!0}):null})),!H&&Object(Y.jsx)(Se,{onClick:Q,isDisplayedAbove:z}))},Be=({listItems:t})=>{const d=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>({descriptionList:{padding:`${t.size.base} ${t.size.s} `,alignItems:"flex-start",rowGap:0},tabListTitle:{display:"flex"},tabListDescription:{display:"flex"}})),[t])})();return Object(Y.jsx)(g.EuiDescriptionList,{type:"column",columnWidths:[2,3],listItems:t,css:d.descriptionList,titleProps:{style:d.tabListTitle},descriptionProps:{style:d.tabListDescription},"data-test-subj":"sessionView:detail-panel-description-list"})},Ie=({id:t,listItems:d,title:u,tooltipContent:f,extraActionTitle:v,onExtraActionClick:b,children:S,initialIsOpen:C=!1})=>{const y=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const d={padding:t.size.base};return{accordion:{borderTop:t.border.thin,"&:last-child":{borderBottom:t.border.thin},dl:{paddingTop:"0px"},"&:only-child":{border:t.border.thin,borderRadius:t.border.radius.medium}},accordionButton:{padding:t.size.base,fontWeight:t.font.weight.bold},tabSection:d}}),[t])})();return Object(Y.jsx)(g.EuiAccordion,{id:t,arrowDisplay:"right",initialIsOpen:C,buttonContent:Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,css:y.accordionButton},Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)("span",null,u)),f&&Object(Y.jsx)(g.EuiFlexItem,{grow:!1,"data-test-subj":"sessionView:detail-panel-accordion-tooltip"},Object(Y.jsx)(g.EuiIconTip,{content:f}))),css:y.accordion,"data-test-subj":"sessionView:detail-panel-accordion"},Object(Y.jsx)(Be,{listItems:d}),S)},Pe=({children:t,copy:d,display:u="grid"})=>{const[f,v]=Object(p.useState)(!1),b=(({display:t})=>{const{euiTheme:d}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const u={display:t,alignContent:"center",padding:`${d.size.xs} ${d.size.s} `,width:"100%",fontWeight:"inherit",height:"max-content",minHeight:d.size.l,letterSpacing:"0px",textAlign:"left","& .euiToolTipAnchor":{width:`calc(100% - ${d.size.xl})`,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};return{item:u,copiableItem:{...u,position:"relative",borderRadius:d.border.radius.medium,"&:hover":{background:Object(g.transparentize)(d.colors.primary,.1)},height:"fit-content"}}}),[t,d])})({display:u}),S={size:"s",css:d?b.copiableItem:b.item};return d&&(S.onMouseEnter=()=>v(!0),S.onMouseLeave=()=>v(!1)),Object(Y.jsx)(g.EuiText,he()({},S,{"data-test-subj":"sessionView:detail-panel-list-item"}),t,f&&d)},He=({children:t,textToCopy:d,tooltipContent:u,display:f="inlineBlock"})=>{const b=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>({copyButton:{position:"absolute",right:t.size.s,top:0,bottom:0,margin:"auto"}})),[t])})(),S={copy:Object(Y.jsx)(g.EuiCopy,{textToCopy:d,display:f},(t=>Object(Y.jsx)(g.EuiButtonIcon,{css:b.copyButton,onClick:t,display:"base",iconType:"copyClipboard",size:"xs","aria-label":T.i18n.translate("xpack.sessionView.detailPanelCopy.copyButton",{defaultMessage:"Copy"})})))};return"block"===f&&(S.display=f),Object(Y.jsx)(Pe,S,Object(Y.jsx)(g.EuiToolTip,{position:"top",content:u},Object(Y.jsx)(v.a.Fragment,null,t)))};var Fe=u(6);const $e={id:A,name:A,start:A,end:A,exitCode:A,userId:A,userName:A,groupId:A,groupName:A,workingDirectory:A,interactive:A,args:A,pid:A,entryMetaType:A,entryMetaSourceIp:A,executable:[[A]]},ze=t=>{try{return t.map((t=>{const[d,u]=t;if(!d||!u||2!==t.length)throw new Error;return`${d} ${u}`})).join(", ")}catch(t){return""}},Ne=t=>t&&t.length&&t.map?`[${t.map((t=>`'${t}'`)).join(", ")}]`:A,Ve=t=>{var d,u,f,p,v,g,b,S,C,y,w,x,O,j,k,T,L,R,A,D,M,B,P;return{...t,id:null!==(d=null==t?void 0:t.entity_id)&&void 0!==d?d:$e.id,name:null!==(u=null==t?void 0:t.name)&&void 0!==u?u:$e.name,start:null!==(f=null==t?void 0:t.start)&&void 0!==f?f:$e.start,end:null!==(p=null==t?void 0:t.end)&&void 0!==p?p:$e.end,exitCode:null!==(v=null==t||null===(g=t.exit_code)||void 0===g?void 0:g.toString())&&void 0!==v?v:$e.exitCode,interactive:null!=t&&t.interactive?"True":"False",userId:null!==(b=null==t||null===(S=t.user)||void 0===S?void 0:S.id)&&void 0!==b?b:$e.userId,userName:null!==(C=null==t||null===(y=t.user)||void 0===y?void 0:y.name)&&void 0!==C?C:$e.userName,groupId:null!==(w=null==t||null===(x=t.group)||void 0===x?void 0:x.id)&&void 0!==w?w:$e.groupId,groupName:null!==(O=null==t||null===(j=t.group)||void 0===j?void 0:j.name)&&void 0!==O?O:$e.groupName,workingDirectory:null!==(k=null==t?void 0:t.working_directory)&&void 0!==k?k:$e.workingDirectory,args:null!==(T=Ne(null==t?void 0:t.args))&&void 0!==T?T:$e.args,pid:null!==(L=null==t||null===(R=t.pid)||void 0===R?void 0:R.toString())&&void 0!==L?L:$e.pid,executable:null!=t&&t.executable?[[null==t?void 0:t.executable]]:$e.executable,entryMetaType:null!==(A=null==t||null===(D=t.entry_meta)||void 0===D?void 0:D.type)&&void 0!==A?A:$e.entryMetaType,entryMetaSourceIp:null!==(M=null==t||null===(B=t.entry_meta)||void 0===B||null===(P=B.source)||void 0===P?void 0:P.ip)&&void 0!==M?M:$e.entryMetaSourceIp}},We=()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>({descriptionSemibold:{fontWeight:t.font.weight.medium},executableAction:{fontWeight:t.font.weight.semiBold,paddingLeft:t.size.xs},ellipsis:{overflow:"hidden",textOverflow:"ellipsis"}})),[t])},Ue=[{id:"processEntryLeader",title:"Entry Leader",tooltipContent:T.i18n.translate("xpack.sessionView.detailPanel.entryLeaderTooltip",{defaultMessage:"Session leader process associated with initial terminal or remote access via SSH, SSM and other remote access protocols. Entry sessions are also used to represent a service directly started by the init process. In many cases this is the same as the session_leader."})},{id:"processSessionLeader",title:"Session Leader",tooltipContent:T.i18n.translate("xpack.sessionView.detailPanel.sessionLeaderTooltip",{defaultMessage:"Often the same as entry_leader. When it differs, this represents a session started within another session. Some tools like tmux and screen will start a new session to obtain a new tty and/or separate their lifecycle from the entry session."})},{id:"processGroupLeader",title:"Group Leader",tooltipContent:T.i18n.translate("xpack.sessionView.detailPanel.processGroupLeaderTooltip",{defaultMessage:"The process group leader to the current process."})},{id:"processParent",title:"Parent",tooltipContent:T.i18n.translate("xpack.sessionView.detailPanel.processParentTooltip",{defaultMessage:"The direct parent to the current process."})}],Ke="process",qe=[`${Ke}.entry_leader`,`${Ke}.session_leader`,`${Ke}.group_leader`,`${Ke}.parent`],Ge=({selectedProcess:t,index:d})=>{const u=We(),f=Object(p.useMemo)((()=>((t,d)=>{var u,f,p,v,g,b,S,C,y,w,x,O,j,k,T,L,R,A,M,B,P;const H={id:$e.id,start:$e.start,end:$e.end,exitCode:$e.exitCode,interactive:$e.interactive,userId:$e.userId,userName:$e.userName,groupName:$e.groupName,args:$e.args,pid:$e.pid,executable:$e.executable,workingDirectory:$e.workingDirectory,entryLeader:$e,sessionLeader:$e,groupLeader:$e,parent:$e};if(!t)return H;const F=t.getDetails();H.id=`${D(t.id)}`,H.start=`${D(null===(u=F.process)||void 0===u?void 0:u.start)}`,H.end=`${D(t.getEndTime())}`,H.exitCode=`${D(null===(f=F.process)||void 0===f?void 0:f.exit_code)}`,H.interactive=null!==(p=F.process)&&void 0!==p&&p.interactive?"True":"False",H.userId=`${D(null===(v=F.process)||void 0===v||null===(g=v.user)||void 0===g?void 0:g.id)}`,H.userName=`${D(null===(b=F.process)||void 0===b||null===(S=b.user)||void 0===S?void 0:S.name)}`,H.groupId=`${D(null===(C=F.process)||void 0===C||null===(y=C.group)||void 0===y?void 0:y.id)}`,H.groupName=`${D(null===(w=F.process)||void 0===w||null===(x=w.group)||void 0===x?void 0:x.name)}`,H.pid=`${D(null===(O=F.process)||void 0===O?void 0:O.pid)}`,H.workingDirectory=`${D(null===(j=F.process)||void 0===j?void 0:j.working_directory)}`,null!==(k=F.process)&&void 0!==k&&k.args&&(H.args=Ne(F.process.args));const $=(null===(T=F.process)||void 0===T||null===(L=T.previous)||void 0===L?void 0:L.map((t=>(null==t?void 0:t.executable)||"")))||[];return null!==(R=F.process)&&void 0!==R&&R.executable&&$.push(F.process.executable),H.executable=$.map(((t,u)=>{const f=d===Fe.b?"executed":"exec";return[t,`(${0===u?"fork":f})`]})),H.entryLeader=Ve(null==F||null===(A=F.process)||void 0===A?void 0:A.entry_leader),H.sessionLeader=Ve(null==F||null===(M=F.process)||void 0===M?void 0:M.session_leader),H.groupLeader=Ve(null==F||null===(B=F.process)||void 0===B?void 0:B.group_leader),H.parent=Ve(null==F||null===(P=F.process)||void 0===P?void 0:P.parent),H})(t,d)),[t,d]),b=Object(p.useCallback)((t=>t.map(((t,d)=>{const[f,p]=t;return Object(Y.jsx)("div",{key:`executable-${d}`,css:u.ellipsis},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},f),p&&Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.executableAction},p))}))),[u.descriptionSemibold,u.ellipsis,u.executableAction]),S=[f.entryLeader,f.sessionLeader,f.groupLeader,f.parent].map(((t,d)=>{const{id:f,start:p,end:v,exitCode:S,entryMetaType:C,interactive:y,workingDirectory:w,args:x,executable:O,pid:j,userId:k,userName:T,groupId:L,groupName:R,entryMetaSourceIp:A}=t,M=ze(O),B=[{title:Object(Y.jsx)(Pe,null,"entity_id"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.entity_id: "${f}"`,tooltipContent:f},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},f))},{title:Object(Y.jsx)(Pe,null,"args"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.args: "${x}"`,tooltipContent:x},x)},{title:Object(Y.jsx)(Pe,null,"executable"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.executable: "${M}"`,tooltipContent:M},b(O))},{title:Object(Y.jsx)(Pe,null,"interactive"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.interactive: "${y}"`,tooltipContent:y},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},y))},{title:Object(Y.jsx)(Pe,null,"working_directory"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.working_directory: "${w}"`,tooltipContent:w},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},w))},{title:Object(Y.jsx)(Pe,null,"pid"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.pid: "${j}"`,tooltipContent:j},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},j))},{title:Object(Y.jsx)(Pe,null,"start"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.start: "${p}"`,tooltipContent:p},p)},{title:Object(Y.jsx)(Pe,null,"end"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.end: "${v}"`,tooltipContent:v},v)},{title:Object(Y.jsx)(Pe,null,"exit_code"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.exit_code: "${S}"`,tooltipContent:S},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},S))},{title:Object(Y.jsx)(Pe,null,"user.id"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.user.id: "${k}"`,tooltipContent:k},k)},{title:Object(Y.jsx)(Pe,null,"user.name"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.user.name: "${T}"`,tooltipContent:T},T)},{title:Object(Y.jsx)(Pe,null,"group.id"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.group.id: "${L}"`,tooltipContent:L},L)},{title:Object(Y.jsx)(Pe,null,"group.name"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.group.name: "${R}"`,tooltipContent:R},R)}];return 0===d&&B.push({title:Object(Y.jsx)(Pe,null,"entry_meta.type"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.entry_meta.type: "${C}"`,tooltipContent:C},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},C))},{title:Object(Y.jsx)(Pe,null,"entry_meta.source.ip"),description:Object(Y.jsx)(He,{textToCopy:`${qe[d]}.entry_meta.source.ip: "${A}"`,tooltipContent:A},D(A))}),{...Ue[d],name:t.name,listItems:B}})),{id:C,start:y,end:w,executable:x,exitCode:O,pid:j,workingDirectory:k,interactive:T,userId:L,userName:R,groupId:A,groupName:M,args:B}=f,P=ze(x);return Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(Be,{listItems:[{title:Object(Y.jsx)(Pe,null,"entity_id"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.entity_id: "${C}"`,tooltipContent:C},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},C))},{title:Object(Y.jsx)(Pe,null,"args"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.args: "${B}"`,tooltipContent:B},B)},{title:Object(Y.jsx)(Pe,null,"executable"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.executable: "${P}"`,tooltipContent:P,display:"block"},b(x))},{title:Object(Y.jsx)(Pe,null,"interactive"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.interactive: "${T}"`,tooltipContent:T},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},T))},{title:Object(Y.jsx)(Pe,null,"working_directory"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.working_directory: "${k}"`,tooltipContent:k},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},k))},{title:Object(Y.jsx)(Pe,null,"pid"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.pid: "${j}"`,tooltipContent:j},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},j))},{title:Object(Y.jsx)(Pe,null,"start"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.start: "${y}"`,tooltipContent:y},y)},{title:Object(Y.jsx)(Pe,null,"end"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.end: "${w}"`,tooltipContent:w},w)},{title:Object(Y.jsx)(Pe,null,"exit_code"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.exit_code: "${O}"`,tooltipContent:O},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:u.descriptionSemibold},O))},{title:Object(Y.jsx)(Pe,null,"user.id"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.user.id: "${L}"`,tooltipContent:L},L)},{title:Object(Y.jsx)(Pe,null,"user.name"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.user.name: "${R}"`,tooltipContent:R},R)},{title:Object(Y.jsx)(Pe,null,"group.id"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.group.id: "${A}"`,tooltipContent:A},A)},{title:Object(Y.jsx)(Pe,null,"group.name"),description:Object(Y.jsx)(He,{textToCopy:`${Ke}.group.name: "${M}"`,tooltipContent:M},M)}]}),S.map((t=>Object(Y.jsx)(Ie,{key:t.id,id:t.id,title:t.title,tooltipContent:t.tooltipContent,listItems:t.listItems,extraActionTitle:t.name}))))},Ye=({processHost:t,processContainer:d,processOrchestrator:u,processCloud:f})=>{const b=We(),S=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>({metadataHostOS:{margin:`${t.size.m} ${t.size.base} ${t.size.base} ${t.size.base}`,paddingBottom:t.size.base}})),[t])})(),C=Object(p.useMemo)((()=>(t=>{var d,u,f,p,v,g,b,S,C,y,w,x;const O={architecture:A,hostname:A,id:A,ip:A,mac:A,name:A,os:{family:A,full:A,kernel:A,name:A,platform:A,version:A}};return t?(O.hostname=D(t.hostname).toString(),O.id=D(t.id).toString(),O.ip=null!==(d=null===(u=t.ip)||void 0===u||null===(f=u.map)||void 0===f?void 0:f.call(u,(t=>D(t))).join(", "))&&void 0!==d?d:A,O.mac=null!==(p=null===(v=t.mac)||void 0===v||null===(g=v.map)||void 0===g?void 0:g.call(v,(t=>D(t))).join(", "))&&void 0!==p?p:A,O.name=D(t.name).toString(),O.architecture=D(t.architecture).toString(),O.os.family=D(null===(b=t.os)||void 0===b?void 0:b.family).toString(),O.os.full=D(null===(S=t.os)||void 0===S?void 0:S.full).toString(),O.os.kernel=D(null===(C=t.os)||void 0===C?void 0:C.kernel).toString(),O.os.name=D(null===(y=t.os)||void 0===y?void 0:y.name).toString(),O.os.platform=D(null===(w=t.os)||void 0===w?void 0:w.platform).toString(),O.os.version=D(null===(x=t.os)||void 0===x?void 0:x.version).toString(),O):O})(t)),[t]),y=Object(p.useMemo)((()=>(t=>{var d,u,f,p;const v={id:A,name:A,image:{name:A,tag:A,hash:{all:A}}};return t?(v.id=D(t.id).toString(),v.name=D(t.name).toString(),v.image.name=D(null==t||null===(d=t.image)||void 0===d?void 0:d.name).toString(),v.image.tag=D(null==t||null===(u=t.image)||void 0===u?void 0:u.tag).toString(),v.image.hash.all=D(null==t||null===(f=t.image)||void 0===f||null===(p=f.hash)||void 0===p?void 0:p.all).toString(),v):v})(d)),[d]),w=Object(p.useMemo)((()=>(t=>{var d,u,f,p,v,g,b;const S={resource:{name:A,type:A,ip:A,parent:{type:A}},namespace:A,cluster:{name:A,id:A}};return t?(S.resource.name=D(null==t||null===(d=t.resource)||void 0===d?void 0:d.name).toString(),S.resource.type=D(null==t||null===(u=t.resource)||void 0===u?void 0:u.type).toString(),S.resource.ip=D(null==t||null===(f=t.resource)||void 0===f?void 0:f.ip).toString(),S.namespace=D(null==t?void 0:t.namespace).toString(),S.cluster.name=D(null==t||null===(p=t.cluster)||void 0===p?void 0:p.name).toString(),S.cluster.id=D(null==t||null===(v=t.cluster)||void 0===v?void 0:v.id).toString(),S.resource.parent.type=D(null==t||null===(g=t.resource)||void 0===g||null===(b=g.parent)||void 0===b?void 0:b.type).toString(),S):S})(u)),[u]),x=Object(p.useMemo)((()=>(t=>{var d,u,f,p;const v={instance:{name:A},account:{id:A},project:{id:A,name:A},provider:A,region:A};return t?(v.instance.name=D(null==t||null===(d=t.instance)||void 0===d?void 0:d.name).toString(),v.account.id=D(null==t||null===(u=t.account)||void 0===u?void 0:u.id).toString(),v.project.id=D(null==t||null===(f=t.project)||void 0===f?void 0:f.id).toString(),v.project.name=D(null==t||null===(p=t.project)||void 0===p?void 0:p.name).toString(),v.provider=D(null==t?void 0:t.provider).toString(),v.region=D(null==t?void 0:t.region).toString(),v):v})(f)),[f]);return Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(Ie,{id:"metadataHost",title:T.i18n.translate("xpack.sessionView.metadataDetailsTab.metadataHost",{defaultMessage:"Host"}),initialIsOpen:!0,listItems:[{title:Object(Y.jsx)(Pe,null,"id"),description:Object(Y.jsx)(He,{textToCopy:`host.id: "${C.id}"`,tooltipContent:C.id},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.id))},{title:Object(Y.jsx)(Pe,null,"hostname"),description:Object(Y.jsx)(He,{textToCopy:`host.hostname: "${C.hostname}"`,tooltipContent:C.hostname},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.hostname))},{title:Object(Y.jsx)(Pe,null,"ip"),description:Object(Y.jsx)(He,{textToCopy:`host.ip: "${C.ip}"`,tooltipContent:C.ip},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.ip))},{title:Object(Y.jsx)(Pe,null,"mac"),description:Object(Y.jsx)(He,{textToCopy:`host.mac: "${C.mac}"`,tooltipContent:C.mac},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.mac))},{title:Object(Y.jsx)(Pe,null,"name"),description:Object(Y.jsx)(He,{textToCopy:`host.name: "${C.name}"`,tooltipContent:C.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.name))}]},Object(Y.jsx)(g.EuiPanel,{hasShadow:!1,color:"plain",hasBorder:!1,borderRadius:"m",paddingSize:"none",css:S.metadataHostOS},Object(Y.jsx)(Ie,{id:"hostOS",title:T.i18n.translate("xpack.sessionView.metadataDetailsTab.host",{defaultMessage:"OS"}),listItems:[{title:Object(Y.jsx)(Pe,null,"architecture"),description:Object(Y.jsx)(He,{textToCopy:`host.architecture: "${C.architecture}"`,tooltipContent:C.architecture},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.architecture))},{title:Object(Y.jsx)(Pe,null,"os.family"),description:Object(Y.jsx)(He,{textToCopy:`host.os.family: "${C.os.family}"`,tooltipContent:C.os.family},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.family))},{title:Object(Y.jsx)(Pe,null,"os.full"),description:Object(Y.jsx)(He,{textToCopy:`host.os.full: "${C.os.full}"`,tooltipContent:C.os.full},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.full))},{title:Object(Y.jsx)(Pe,null,"os.kernel"),description:Object(Y.jsx)(He,{textToCopy:`host.os.kernel: "${C.os.kernel}"`,tooltipContent:C.os.kernel},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.kernel))},{title:Object(Y.jsx)(Pe,null,"os.name"),description:Object(Y.jsx)(He,{textToCopy:`host.os.name: "${C.os.name}"`,tooltipContent:C.os.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.name))},{title:Object(Y.jsx)(Pe,null,"os.platform"),description:Object(Y.jsx)(He,{textToCopy:`host.os.platform: "${C.os.platform}"`,tooltipContent:C.os.platform},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.platform))},{title:Object(Y.jsx)(Pe,null,"os.version"),description:Object(Y.jsx)(He,{textToCopy:`host.os.version: "${C.os.version}"`,tooltipContent:C.os.version},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},C.os.version))}]}))),f&&Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(Ie,{id:"metadataCloud",title:T.i18n.translate("xpack.sessionView.metadataDetailsTab.cloud",{defaultMessage:"Cloud"}),listItems:[{title:Object(Y.jsx)(Pe,null,"instance.name"),description:Object(Y.jsx)(He,{textToCopy:`cloud.provider: "${x.instance.name}"`,tooltipContent:x.instance.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.instance.name))},{title:Object(Y.jsx)(Pe,null,"provider"),description:Object(Y.jsx)(He,{textToCopy:`cloud.provider: "${x.provider}"`,tooltipContent:x.provider},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.provider))},{title:Object(Y.jsx)(Pe,null,"region"),description:Object(Y.jsx)(He,{textToCopy:`cloud.region: "${x.region}"`,tooltipContent:x.region},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.region))},{title:Object(Y.jsx)(Pe,null,"account.id"),description:Object(Y.jsx)(He,{textToCopy:`cloud.account.id: "${x.account.id}"`,tooltipContent:x.account.id},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.account.id))},{title:Object(Y.jsx)(Pe,null,"project.id"),description:Object(Y.jsx)(He,{textToCopy:`cloud.project.id: "${x.project.id}"`,tooltipContent:x.project.id},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.project.id))},{title:Object(Y.jsx)(Pe,null,"project.name"),description:Object(Y.jsx)(He,{textToCopy:`cloud.project.name: "${x.project.name}"`,tooltipContent:x.project.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},x.project.name))}]})),d&&Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(Ie,{id:"metadataContainer",title:T.i18n.translate("xpack.sessionView.metadataDetailsTab.container",{defaultMessage:"Container"}),listItems:[{title:Object(Y.jsx)(Pe,null,"id"),description:Object(Y.jsx)(He,{textToCopy:`container.id: "${y.id}"`,tooltipContent:y.id},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},y.id))},{title:Object(Y.jsx)(Pe,null,"name"),description:Object(Y.jsx)(He,{textToCopy:`container.name: "${y.name}"`,tooltipContent:y.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},y.name))},{title:Object(Y.jsx)(Pe,null,"image.name"),description:Object(Y.jsx)(He,{textToCopy:`container.image.name: "${y.image.name}"`,tooltipContent:y.image.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},y.image.name))},{title:Object(Y.jsx)(Pe,null,"image.tag"),description:Object(Y.jsx)(He,{textToCopy:`container.image.tag: "${y.image.tag}"`,tooltipContent:y.image.tag},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},y.image.tag))},{title:Object(Y.jsx)(Pe,null,"image.hash.all"),description:Object(Y.jsx)(He,{textToCopy:`container.image.hash.all: "${y.image.hash.all}"`,tooltipContent:y.image.hash.all},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},y.image.hash.all))}]})),u&&Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(Ie,{id:"metadataOrchestrator",title:T.i18n.translate("xpack.sessionView.metadataDetailsTab.orchestrator",{defaultMessage:"Orchestrator"}),listItems:[{title:Object(Y.jsx)(Pe,null,"resource.ip"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.resource.ip: "${w.resource.ip}"`,tooltipContent:w.resource.ip},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.resource.ip))},{title:Object(Y.jsx)(Pe,null,"resource.name"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.resource.name: "${w.resource.name}"`,tooltipContent:w.resource.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.resource.name))},{title:Object(Y.jsx)(Pe,null,"resource.type"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.resource.type: "${w.resource.type}"`,tooltipContent:w.resource.type},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.resource.type))},{title:Object(Y.jsx)(Pe,null,"resource.parent.type"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.resource.parent.type: "${w.resource.parent.type}"`,tooltipContent:w.resource.parent.type},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.resource.parent.type))},{title:Object(Y.jsx)(Pe,null,"namespace"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.namespace: "${w.namespace}"`,tooltipContent:w.namespace},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.namespace))},{title:Object(Y.jsx)(Pe,null,"cluster.id"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.cluster.id: "${w.cluster.id}"`,tooltipContent:w.cluster.id},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.cluster.id))},{title:Object(Y.jsx)(Pe,null,"cluster.name"),description:Object(Y.jsx)(He,{textToCopy:`orchestrator.cluster.name: "${w.cluster.name}"`,tooltipContent:w.cluster.name},Object(Y.jsx)(g.EuiTextColor,{color:"subdued",css:b.descriptionSemibold},w.cluster.name))}]})))},Je=(t=!1,d=!1)=>{const{euiTheme:u}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const{colors:f,font:p,size:v,border:b}=u,S=Object(g.transparentize)(f.danger,.2),C=Object(g.transparentize)(f.danger,.08),y=b.width.thin,w=v.m;let x=f.text,O=f.lightShade;d&&(x=f.primaryText,O=S);const j=Object(Y.css)("border:",y," solid ",O,";padding:",w,";border-radius:",b.radius.medium,";margin:0 ",w," ",w," ",w,";background-color:",f.emptyShade,";& .euiAccordion__buttonContent{width:100%;}& .euiAccordion__button{min-width:0;width:calc(100% - ",v.l,");}& .euiAccordion__childWrapper{overflow:visible;}","");return{alertItem:j,alertGroupItem:Object(Y.css)(j," & .euiAccordion__childWrapper{overflow:hidden;}",""),alertTitleContainer:{display:t?"none":"initial",color:x,fontWeight:p.weight.semiBold},alertTitle:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},alertIcon:{marginRight:v.s},alertAccordionButton:{width:`calc(100% - ${v.l})`,minWidth:0},alertCountArrowPad:{marginRight:v.xs},processPanel:{border:`${y} solid ${f.lightShade}`,fontFamily:p.familyCode,marginTop:t?v.s:v.m,padding:`${v.xs} ${v.s}`},investigatedLabel:{position:"relative",zIndex:1,bottom:`-${w}`,left:`-${w}`,width:`calc(100% + ${w} * 2)`,borderTop:`${y} solid ${S}`,borderBottomLeftRadius:b.radius.medium,borderBottomRightRadius:b.radius.medium,backgroundColor:C,textAlign:"center"},minimalContextMenu:{float:"right"},firstAlertPad:{"&:first-child":{paddingTop:v.base}},minimalHR:{marginBottom:0}}}),[u,d,t])},Xe=({event:t,onShowAlertDetails:d,onJumpToEvent:u})=>{var f,v,S;const[C,y]=Object(p.useState)(!1),w=Object(p.useCallback)((()=>{y(!1)}),[]),x=Object(p.useCallback)((()=>{y(!C)}),[C]),O=Object(p.useCallback)((()=>{u(t),y(!1)}),[t,u]),j=Object(p.useCallback)((()=>{var u,f;null!==(u=t.kibana)&&void 0!==u&&null!==(f=u.alert)&&void 0!==f&&f.uuid&&(d(t.kibana.alert.uuid),y(!1))}),[t,d]);if(!t.kibana)return null;const k=null!==(f=null===(v=t.kibana)||void 0===v||null===(S=v.alert)||void 0===S?void 0:S.uuid)&&void 0!==f?f:"",L=[Object(Y.jsx)(g.EuiContextMenuItem,{key:"details","data-test-subj":"sessionView:detailPanelAlertActionShowDetails",onClick:j},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.showDetailsAction",defaultMessage:"View alert details"})),Object(Y.jsx)(g.EuiContextMenuItem,{key:"jumpTo","data-test-subj":"sessionView:detailPanelAlertActionJumpToProcess",onClick:O},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.jumpToAlert",defaultMessage:"Jump to alerted process"}))];return Object(Y.jsx)(g.EuiPopover,{id:k,button:Object(Y.jsx)(g.EuiButtonIcon,{display:"empty",size:"s",iconType:"boxesHorizontal","aria-label":T.i18n.translate("xpack.sessionView.detailPanelAlertListItem.moreButton",{defaultMessage:"More"}),"data-test-subj":"sessionView:detailPanelAlertActionsBtn",onClick:x}),isOpen:C,closePopover:w,panelPaddingSize:"none",anchorPosition:"leftCenter"},Object(Y.jsx)(g.EuiContextMenuPanel,{size:"s",items:L}))},Ze="sessionView:detailPanelAlertListItem",Qe="sessionView:detailPanelAlertListItemArgs",et=({event:t,onJumpToEvent:d,onShowAlertDetails:u,isInvestigated:f,minimal:p})=>{var v,S,C,y;const w=Je(p,f),x=N();if(!t.kibana)return null;const O=Object(g.formatDate)(t["@timestamp"],x),j=null===(v=t.kibana)||void 0===v||null===(S=v.alert)||void 0===S?void 0:S.rule,k=(null==j?void 0:j.uuid)||"",T=(null==j?void 0:j.name)||"",{args:L,name:R}=null!==(C=t.process)&&void 0!==C?C:{},{event:A}=t,B=f?void 0:"open",P=Array.isArray(null==A?void 0:A.category)?null==A||null===(y=A.category)||void 0===y?void 0:y[0]:null==A?void 0:A.category,H=null!=P?P:"process",F="process"!==P?`${D(R)} ${V(t,P)}`:D(null==L?void 0:L.join(" ")),$=G(H);return p?Object(Y.jsx)("div",{"data-test-subj":Ze,css:w.firstAlertPad},Object(Y.jsx)(g.EuiSpacer,{size:"xs"}),Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center"},Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)(g.EuiText,{color:"subdued",size:"s"},D(O))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(Xe,{css:w.minimalContextMenu,event:t,onJumpToEvent:d,onShowAlertDetails:u}))),Object(Y.jsx)(g.EuiPanel,{css:w.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(Y.jsx)(g.EuiText,{"data-test-subj":Qe,size:"xs"},F)),Object(Y.jsx)(g.EuiHorizontalRule,{css:w.minimalHR,margin:"m",size:"full"})):Object(Y.jsx)(g.EuiAccordion,{id:k,"data-test-subj":Ze,arrowDisplay:f?"right":"none",buttonContent:Object(Y.jsx)(g.EuiText,{css:w.alertTitleContainer,size:"s"},Object(Y.jsx)("p",{css:w.alertTitle},Object(Y.jsx)(g.EuiToolTip,{position:"top",content:$},Object(Y.jsx)(g.EuiIcon,{color:"danger",type:M.d[H],css:w.alertIcon})),D(T))),initialIsOpen:!0,forceState:B,css:w.alertItem,extraAction:Object(Y.jsx)(Xe,{event:t,onJumpToEvent:d,onShowAlertDetails:u})},Object(Y.jsx)(g.EuiSpacer,{size:"xs"}),Object(Y.jsx)(g.EuiText,{"data-test-subj":"sessionView:detailPanelAlertListItemTimestamp",color:"subdued",size:"s"},D(O)),Object(Y.jsx)(g.EuiPanel,{css:w.processPanel,color:"subdued",hasBorder:!0,hasShadow:!1,borderRadius:"m"},Object(Y.jsx)(g.EuiText,{"data-test-subj":Qe,size:"xs"},F)),f&&Object(Y.jsx)("div",{css:w.investigatedLabel},Object(Y.jsx)(g.EuiText,{size:"xs",color:"danger"},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertListItem.investigatedLabel",defaultMessage:"Investigated alert"}))))},tt=({alerts:t,onJumpToEvent:d,onShowAlertDetails:u})=>{var f,p,v,b;const S=Je(),C=t.length.toLocaleString();if(!t[0].kibana)return null;const{rule:y}=null!==(f=null===(p=t[0])||void 0===p||null===(v=p.kibana)||void 0===v?void 0:v.alert)&&void 0!==f?f:{};return Object(Y.jsx)(g.EuiAccordion,{id:null!==(b=null==y?void 0:y.uuid)&&void 0!==b?b:"","data-test-subj":"sessionView:detailPanelAlertGroupItem",arrowDisplay:"right",initialIsOpen:!1,buttonContent:Object(Y.jsx)(g.EuiText,{"data-test-subj":"sessionView:detailPanelAlertGroupTitle",css:S.alertTitleContainer,size:"s"},Object(Y.jsx)("p",{css:S.alertTitle},Object(Y.jsx)(g.EuiIcon,{color:"danger",type:"warning",css:S.alertIcon}),D(null==y?void 0:y.name))),css:S.alertGroupItem,extraAction:Object(Y.jsx)(g.EuiNotificationBadge,{"data-test-subj":"sessionView:detailPanelAlertGroupCount",className:"eui-alignCenter",size:"m",css:S.alertCountArrowPad},C)},t.map((t=>{var f,p;const v="minimal_"+(null===(f=t.kibana)||void 0===f||null===(p=f.alert)||void 0===p?void 0:p.uuid);return Object(Y.jsx)(et,{key:v,minimal:!0,event:t,onJumpToEvent:d,onShowAlertDetails:u})})))},it="listView",st=({alerts:t,isFetchingAlerts:d,hasNextPageAlerts:u,fetchNextPageAlerts:f,onJumpToEvent:v,onShowAlertDetails:S,investigatedAlertId:C})=>{const y=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const{colors:d,size:u}=t;return{container:{position:"relative"},stickyItem:{position:"sticky",top:0,zIndex:1,backgroundColor:d.emptyShade},viewMode:{margin:u.base},loadMoreBtn:{margin:u.m,width:`calc(100% - ${u.m} * 2)`}}}),[t])})(),[w,x]=Object(p.useState)(it),O=[{id:it,label:T.i18n.translate("xpack.sessionView.alertDetailsTab.listView",{defaultMessage:"List view"})},{id:"groupView",label:T.i18n.translate("xpack.sessionView.alertDetailsTab.groupView",{defaultMessage:"Group view"})}],j=Object(p.useMemo)((()=>C&&t.find((t=>{var d,u;return(null===(d=t.kibana)||void 0===d||null===(u=d.alert)||void 0===u?void 0:u.uuid)===C}))),[C,t]),k=Object(p.useMemo)((()=>Object(L.groupBy)(t,(t=>{var d,u,f;return null===(d=t.kibana)||void 0===d||null===(u=d.alert)||void 0===u||null===(f=u.rule)||void 0===f?void 0:f.uuid}))),[t]);return 0===t.length?Object(Y.jsx)(g.EuiEmptyPrompt,{"data-test-subj":"sessionView:detailPanelAlertsEmptyState",title:Object(Y.jsx)("h2",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertsEmptyTitle",defaultMessage:"No alerts"})),body:Object(Y.jsx)("p",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.detailPanelAlertsEmptyMsg",defaultMessage:"No alerts were created for this session."}))}):Object(Y.jsx)("div",{css:y.container},Object(Y.jsx)(g.EuiButtonGroup,{"data-test-subj":"sessionView:detailPanelAlertsViewMode",css:y.viewMode,legend:T.i18n.translate("xpack.sessionView.alertDetailsTab.toggleViewMode",{defaultMessage:"Toggle view mode"}),options:O,idSelected:w,onChange:x,buttonSize:"compressed",isFullWidth:!0}),j&&Object(Y.jsx)("div",{css:y.stickyItem,"data-test-subj":"sessionView:detailPanelInvestigatedAlert"},Object(Y.jsx)(et,{event:j,onJumpToEvent:v,onShowAlertDetails:S,isInvestigated:!0}),Object(Y.jsx)(g.EuiHorizontalRule,{margin:"m",size:"full"})),w===it?t.map((t=>{var d,u;const f=null===(d=t.kibana)||void 0===d||null===(u=d.alert)||void 0===u?void 0:u.uuid;if(f&&t!==j)return Object(Y.jsx)(et,{key:f,event:t,onJumpToEvent:v,onShowAlertDetails:S})})):Object.keys(k).map((t=>{var d,u,f;const p=k[t],g=null===(d=p[0].kibana)||void 0===d||null===(u=d.alert)||void 0===u||null===(f=u.rule)||void 0===f?void 0:f.uuid;if(g)return Object(Y.jsx)(tt,{key:g,alerts:p,onJumpToEvent:v,onShowAlertDetails:S})})),u&&Object(Y.jsx)(g.EuiButton,{color:"primary",isLoading:d,onClick:f,css:y.loadMoreBtn,"data-test-subj":"alerts-details-load-more"},Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.alertsLoadMoreButton",defaultMessage:"Load more alerts"})))},rt=({index:t,alerts:d,alertsCount:u,isFetchingAlerts:f,hasNextPageAlerts:v,fetchNextPageAlerts:b,selectedProcess:S,investigatedAlertId:C,onJumpToEvent:y,onShowAlertDetails:w})=>{const[x,O]=Object(p.useState)("process"),j=Object(p.useMemo)((()=>u>=M.c?M.c+"+":u+""),[u]),k=Object(p.useMemo)((()=>{var u,p,x,O;const k=!(null==d||!d.length);return[{id:"process",name:T.i18n.translate("xpack.sessionView.detailsPanel.process",{defaultMessage:"Process"}),content:Object(Y.jsx)(Ge,{index:t,selectedProcess:S})},{id:"metadata",name:T.i18n.translate("xpack.sessionView.detailsPanel.metadata",{defaultMessage:"Metadata"}),content:Object(Y.jsx)(Ye,{processHost:null==S||null===(u=S.getDetails())||void 0===u?void 0:u.host,processContainer:null==S||null===(p=S.getDetails())||void 0===p?void 0:p.container,processOrchestrator:null==S||null===(x=S.getDetails())||void 0===x?void 0:x.orchestrator,processCloud:null==S||null===(O=S.getDetails())||void 0===O?void 0:O.cloud})},{id:"alerts",name:T.i18n.translate("xpack.sessionView.detailsPanel.alerts",{defaultMessage:"Alerts"}),append:k&&Object(Y.jsx)(g.EuiNotificationBadge,{className:"eui-alignCenter",size:"m"},j),content:d&&Object(Y.jsx)(st,{alerts:d,isFetchingAlerts:f,hasNextPageAlerts:v,fetchNextPageAlerts:b,onJumpToEvent:y,onShowAlertDetails:w,investigatedAlertId:C})}]}),[d,j,b,v,f,S,y,w,C,t]),L=Object(p.useCallback)((t=>{O(t)}),[]),R=Object(p.useMemo)((()=>((t,d)=>{const u=t.find((t=>t.id===d));return u?u.content:null})(k,x)),[k,x]),A=(()=>{const{euiTheme:t}=Object(g.useEuiTheme)();return Object(p.useMemo)((()=>{const{border:d}=t;return{detailsPanel:{borderLeft:d.thin,height:"100%"}}}),[t])})();return Object(Y.jsx)("div",{css:A.detailsPanel},Object(Y.jsx)(g.EuiTabs,{size:"l",expand:!0},k.map(((t,d)=>Object(Y.jsx)(g.EuiTab,{key:`${t}-${d}`,onClick:()=>L(t.id),isSelected:t.id===x,disabled:t.disabled,prepend:t.prepend,append:t.append},t.name)))),R)},nt={placeholder:T.i18n.translate("xpack.sessionView.searchBar.searchBarKeyPlaceholder",{defaultMessage:"Find..."})},ot=T.i18n.translate("xpack.sessionView.searchBar.searchBarNoResults",{defaultMessage:"No results"}),at=({searchQuery:t,setSearchQuery:d,totalMatches:u,onPrevious:f,onNext:v,trackEvent:b})=>{const S=!!t&&0!==u,C=!!t&&0===u,y=(({hasSearchResults:t})=>{const{euiTheme:d,euiVars:u}=$();return Object(p.useMemo)((()=>{const f={position:"absolute",top:d.size.s,right:d.size.xxl,'button[data-test-subj="pagination-button-last"]':{display:"none"},'button[data-test-subj="pagination-button-first"]':{display:"none"}},p={position:"absolute",color:d.colors.subduedText,top:d.size.m,right:d.size.xxl};return{pagination:f,searchBar:{position:"relative",backgroundColor:u.euiFormBackgroundColor,input:{paddingRight:t?"200px":d.size.xxl}},noResults:p}}),[d,u,t])})({hasSearchResults:S}),[w,x]=Object(p.useState)(0),O=Object(p.useCallback)((({query:t})=>{x(0),d(t?t.text:""),b&&b("search_performed")}),[d,b]),j=Object(p.useCallback)((t=>{x(t);const d=t>w;d?v(t):f(t),b&&b(d?"search_next":"search_previous")}),[v,f,w,b]);return Object(Y.jsx)("div",{"data-test-subj":"sessionView:searchBar",css:y.searchBar},Object(Y.jsx)(g.EuiSearchBar,{query:t,onChange:O,box:nt}),C&&Object(Y.jsx)("span",{css:y.noResults},ot),S&&Object(Y.jsx)(g.EuiPagination,{"data-test-subj":"sessionView:searchPagination",css:y.pagination,pageCount:u,activePage:w,onPageClick:j,compressed:!0}))},lt="Timestamp",ct="Verbose mode",ht=T.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewVerboseTipTitle",{defaultMessage:"Some results may be hidden"}),dt=T.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewVerboseTipContent",{defaultMessage:"For a complete set of results, turn on Verbose mode."}),ut=({onChange:t,displayOptions:d,showVerboseSearchTooltip:u})=>{const[f,v]=Object(p.useState)(!1),S=Object(p.useMemo)((()=>({selectable:{width:240}})),[]),C=Object(p.useRef)(null);Object(p.useEffect)((()=>{C.current&&setTimeout((()=>{C.current&&(C.current.onFocus(),setTimeout((()=>{C.current&&C.current.onBlur()}),5e3))}),3e3)}),[u]);const y=Object(p.useMemo)((()=>[{label:T.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsTimestamp",{defaultMessage:"Timestamp"}),key:lt,checked:null!=d&&d.timestamp?"on":void 0},{label:T.i18n.translate("xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsVerbosemode",{defaultMessage:"Verbose mode"}),key:ct,checked:null!=d&&d.verboseMode?"on":void 0,append:Object(Y.jsx)(g.EuiIconTip,{content:Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.sessionViewToggle.sessionViewToggleOptionsVerboseModeTooltips",defaultMessage:"Verbose mode displays all processes created in a session, including shell startup, shell completion, and forks caused by built-in commands"})})}]),[d]),w=Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{iconType:"eye",display:d.verboseMode||d.timestamp?"fill":"empty",onClick:()=>{v(!f)},size:"m","aria-label":"Session view display option","data-test-subj":"sessionView:sessionViewOptionButton"})),x=Object(Y.jsx)(g.EuiPopover,{button:w,isOpen:f,closePopover:()=>{v(!1)}},Object(Y.jsx)(g.EuiSelectable,{options:y,onChange:u=>{const f=u.reduce(((t,d)=>(d.key===lt?t.timestamp="on"===d.checked:d.key===ct&&(t.verboseMode="on"===d.checked),t)),{...d});t(f)}},(t=>Object(Y.jsx)("div",{css:S.selectable},Object(Y.jsx)(g.EuiPopoverTitle,null,Object(Y.jsx)(b.FormattedMessage,{defaultMessage:"Display options",id:"xpack.sessionView.sessionViewToggle.sessionViewToggleTitle"})),t))));return!f&&u?Object(Y.jsx)(g.EuiToolTip,{ref:C,position:"bottom",title:ht,content:dt},x):x};var _t=u(30),ft=u.n(_t),pt=u(23),vt=u.n(pt);const gt=/^(\r\n|\r|\n|\n\r)/,mt=({lines:t,seekToLine:d,xTermSearchFn:u,setIsPlaying:f,searchQuery:v,setSearchQuery:g})=>{const[b,S]=Object(p.useState)(null),C=Object(p.useCallback)((p=>{if(p){f(!1);const u=t.indexOf(p.line);d(u)}const g=setTimeout((()=>u(v,(null==p?void 0:p.index)||0)),100);return()=>{clearTimeout(g)}}),[f,t,d,u,v]),y=Object(p.useMemo)((()=>{const d=[];if(v&&t.reduce(((t,d)=>{if(d.value){const u=d.value.match(/^\x1b\[\d+;(\d+)(H|d)/),f=new RegExp(v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),p=vt()(d.value).replace(gt,"").matchAll(f);if(p)for(const f of p){let p=0;u&&(p=parseInt(u[1],10)-3),t.push({line:d,match:f[0],index:p+(f.index||0)})}}return t}),d),d.length>0){const t=d[0];S(t),C(t)}else S(null),u("",0);return d}),[v,t,C,u]),w=Object(p.useCallback)((t=>{f(!1),g(t),S(null)}),[f,g]),x=Object(p.useCallback)((t=>{const d=y[t];d&&b!==d&&(S(d),C(d))}),[C,b,y]);return Object(Y.jsx)(at,{searchQuery:v,setSearchQuery:w,totalMatches:y.length,onNext:x,onPrevious:x})},bt=T.i18n.translate("xpack.sessionView.zoomIn",{defaultMessage:"Zoom in"}),St=T.i18n.translate("xpack.sessionView.zoomFit",{defaultMessage:"Fit screen"}),Ct=T.i18n.translate("xpack.sessionView.zoomOut",{defaultMessage:"Zoom out"}),yt={display:"empty",size:"s",color:"text"},wt=({tty:t,containerHeight:d,fontSize:u,isFullscreen:f,onFontSizeChanged:v})=>{const b=(()=>{const{euiTheme:t}=$();return Object(p.useMemo)((()=>{const{size:d,colors:u,border:f}=t;return{ratio:{fontSize:d.m,color:u.ghost},separator:{background:u.lightShade,height:d.xl,width:f.width.thin}}}),[t])})(),[S,C]=Object(p.useState)(!1),y=Object(p.useCallback)((()=>{C(!1),v(Math.max(2,u-1))}),[u,v]),w=Object(p.useCallback)((()=>{C(!1),v(Math.min(20,u+1))}),[u,v]);Object(p.useEffect)((()=>{if(S&&null!=t&&t.rows&&d){const f=1.3*M.j,p=t.rows*f,g=Math.floor(M.j*(d/p));g!==u&&v(g)}}),[f,d,S,u,v,null==t?void 0:t.rows]);const x=Object(p.useCallback)((()=>{const t=!S;C(t),t||v(M.j)}),[S,C,v]);return Object(Y.jsx)(g.EuiFlexGroup,{"data-test-subj":"sessionView:TTYTextSizer",alignItems:"center",gutterSize:"s",direction:"row"},Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)("div",{css:b.separator})),Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)(g.EuiToolTip,{content:St},Object(Y.jsx)(g.EuiButtonIcon,{"data-test-subj":"sessionView:TTYZoomFit","aria-label":St,display:S?"fill":"empty",iconType:S?"expand":"minimize",onClick:x,size:"s",color:"text"}))),Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)("div",{css:b.separator})),Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)(g.EuiToolTip,{content:Ct},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYZoomOut","aria-label":Ct,iconType:"minusInCircle",onClick:y},yt)))),Object(Y.jsx)(g.EuiFlexItem,{component:"span",css:b.ratio},`${Math.round(u/M.j*100)}%`),Object(Y.jsx)(g.EuiFlexItem,null,Object(Y.jsx)(g.EuiToolTip,{content:bt},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYZoomIn","aria-label":bt,iconType:"plusInCircle",onClick:w},yt)))))};var xt={name:"1r5gb7q",styles:"display:inline-block"},Et=u(25),Ot=(u(26),u(3));class xterm_search_SearchAddon{constructor(){ye()(this,"_terminal",void 0),ye()(this,"_linesCache",void 0),ye()(this,"_linesCacheTimeoutId",0),ye()(this,"_cursorMoveListener",void 0),ye()(this,"_resizeListener",void 0)}activate(t){this._terminal=t}dispose(){}findNext(t,d){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||0===t.length)return this._terminal.clearSelection(),!1;let u,f=0,p=0;if(this._terminal.hasSelection()){const t=!!d&&d.incremental;u=this._terminal.getSelectionPosition(),p=t?u.start.y:u.end.y,f=t?u.start.x:u.end.x}null!=d&&d.lastLineOnly&&(p=this._terminal.buffer.active.cursorY,f=(null==d?void 0:d.startCol)||0),this._initLinesCache();const v={startRow:p,startCol:f};let g=this._findInLine(t,v,d);if(!g)for(let u=p+1;u<this._terminal.buffer.active.baseY+this._terminal.rows&&(v.startRow=u,v.startCol=0,g=this._findInLine(t,v,d),!g);u++);if(!g&&0!==p)for(let u=0;u<p&&(v.startRow=u,v.startCol=0,g=this._findInLine(t,v,d),!g);u++);return!g&&u&&(v.startRow=u.start.y,v.startCol=0,g=this._findInLine(t,v,d)),this._selectResult(g)}findPrevious(t,d){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||0===t.length)return this._terminal.clearSelection(),!1;const u=!0;let f,p=this._terminal.buffer.active.baseY+this._terminal.rows,v=this._terminal.cols;const g=!!d&&d.incremental;let b;this._terminal.hasSelection()?(b=this._terminal.getSelectionPosition(),p=b.start.y,v=b.start.x):null!=d&&d.lastLineOnly&&(p=this._terminal.buffer.active.cursorY-1,v=this._terminal.cols),this._initLinesCache();const S={startRow:p,startCol:v};if(g?(f=this._findInLine(t,S,d,!1),f&&f.row===p&&f.col===v||(b&&(S.startRow=b.end.y,S.startCol=b.end.x),f=this._findInLine(t,S,d,!0))):f=this._findInLine(t,S,d,u),!f){S.startCol=Math.max(S.startCol,this._terminal.cols);for(let v=p-1;v>=0&&(S.startRow=v,f=this._findInLine(t,S,d,u),!f);v--);}if(!f&&p!==this._terminal.buffer.active.baseY+this._terminal.rows)for(let v=this._terminal.buffer.active.baseY+this._terminal.rows;v>=p&&(S.startRow=v,f=this._findInLine(t,S,d,u),!f);v--);return!(f||!b)||this._selectResult(f)}_initLinesCache(){const t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._cursorMoveListener=t.onCursorMove((()=>this._destroyLinesCache())),this._resizeListener=t.onResize((()=>this._destroyLinesCache()))),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout((()=>this._destroyLinesCache()),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_findInLine(t,d,u={},f=!1){var p;const v=this._terminal,g=d.startRow,b=d.startCol,S=v.buffer.active.getLine(g);if(null!=S&&S.isWrapped)return f?void(d.startCol+=v.cols):(d.startRow--,d.startCol+=v.cols,this._findInLine(t,d,u));let C=null===(p=this._linesCache)||void 0===p?void 0:p[g];C||(C=this._translateBufferLineToStringWithWrap(g,!0),this._linesCache&&(this._linesCache[g]=C));const[y,w]=C,x=this._bufferColsToStringOffset(g,b),O=u.caseSensitive?t:t.toLowerCase(),j=u.caseSensitive?y:y.toLowerCase();let k=-1;if(u.regex){const d=RegExp(O,"g");let u;if(f)for(;u=d.exec(j.slice(0,x));)k=d.lastIndex-u[0].length,t=u[0],d.lastIndex-=t.length-1;else u=d.exec(j.slice(x)),u&&u[0].length>0&&(k=x+(d.lastIndex-u[0].length),t=u[0])}else f?x-O.length>=0&&(k=j.lastIndexOf(O,x-O.length)):k=j.indexOf(O,x);if(k>=0){let d=0;for(;d<w.length-1&&k>=w[d+1];)d++;let u=d;for(;u<w.length-1&&k+t.length>=w[u+1];)u++;const f=k-w[d],p=k+t.length-w[u],b=this._stringLengthToBufferSize(g+d,f);return{term:t,col:b,row:g+d,size:this._stringLengthToBufferSize(g+u,p)-b+v.cols*(u-d)}}}_stringLengthToBufferSize(t,d){const u=this._terminal.buffer.active.getLine(t);if(!u)return 0;for(let t=0;t<d;t++){const f=u.getCell(t);if(!f)break;const p=f.getChars();p.length>1&&(d-=p.length-1);const v=u.getCell(t+1);v&&0===v.getWidth()&&d++}return d}_bufferColsToStringOffset(t,d){const u=this._terminal;let f=t,p=0,v=u.buffer.active.getLine(f);for(;d>0&&v;){for(let t=0;t<d&&t<u.cols;t++){const d=v.getCell(t);if(!d)break;d.getWidth()&&(p+=d.getChars().length)}if(f++,v=u.buffer.active.getLine(f),v&&!v.isWrapped)break;d-=u.cols}return p}_translateBufferLineToStringWithWrap(t,d){const u=this._terminal,f=[],p=[0];let v=u.buffer.active.getLine(t);for(;v;){const b=u.buffer.active.getLine(t+1),S=!!b&&b.isWrapped;let C=v.translateToString(!S&&d);if(S&&b){var g;const t=v.getCell(v.length-1);t&&0===t.getCode()&&1===t.getWidth()&&2===(null===(g=b.getCell(0))||void 0===g?void 0:g.getWidth())&&(C=C.slice(0,-1))}if(f.push(C),!S)break;p.push(p[p.length-1]+C.length),t++,v=b}return[f.join(""),p]}_selectResult(t){const d=this._terminal;if(!t)return d.clearSelection(),!1;if(d.select(t.col,t.row,t.size),t.row>=d.buffer.active.viewportY+d.rows||t.row<d.buffer.active.viewportY){let u=t.row-d.buffer.active.viewportY;u-=Math.floor(d.rows/2),d.scrollLines(u)}return!0}}const jt=T.i18n.translate("xpack.sessionView.processDataLimitExceededStart",{defaultMessage:"Data limit reached for"}),kt=T.i18n.translate("xpack.sessionView.processDataLimitExceededEnd",{defaultMessage:'See "max_kilobytes_per_process" in advanced policy configuration.'}),Tt=T.i18n.translate("xpack.sessionView.viewPoliciesLink",{defaultMessage:"VIEW POLICIES"}),Lt=T.i18n.translate("xpack.sessionView.ttyStart",{defaultMessage:"Start"}),Rt=T.i18n.translate("xpack.sessionView.ttyPrevious",{defaultMessage:"Prev"}),At=T.i18n.translate("xpack.sessionView.ttyPlay",{defaultMessage:"Play"}),Dt=T.i18n.translate("xpack.sessionView.ttyPause",{defaultMessage:"Pause"}),Mt=T.i18n.translate("xpack.sessionView.ttyNext",{defaultMessage:"Next"}),Bt=T.i18n.translate("xpack.sessionView.ttyEnd",{defaultMessage:"End"}),It=T.i18n.translate("xpack.sessionView.ttyViewInSession",{defaultMessage:"View in session"}),Pt=({title:t,titleId:d,...u})=>Object(Y.jsx)("svg",he()({xmlns:"http://www.w3.org/2000/svg",width:9,height:30,viewBox:"0 0 9 30","aria-labelledby":d},u),t?Object(Y.jsx)("title",{id:d},t):null,Object(Y.jsx)("path",{d:"M1.122-.001A.5.5 0 0 0 .75.834L4 4.444V29.5a.5.5 0 1 0 1 0V4.443L8.248.833A.5.5 0 0 0 7.877 0H1.122Z"}));let Ht=function(t){return t.ProcessChanged="process_changed",t.ProcessDataLimitReached="data_limited",t}({});const Ft=({processStartMarkers:t,linesLength:d,currentLine:u,onChange:f,onSeekLine:b})=>{const S=(t=>{const{euiTheme:d,euiVars:u}=$();return Object(p.useMemo)((()=>{const{border:f}=d,p=(t,d)=>t===Ht.ProcessDataLimitReached?u.terminalOutputMarkerWarning:d?u.terminalOutputMarkerAccent:u.euiColorVis1,v={cursor:"pointer",marginTop:-20,width:9,height:30,marginLeft:-4.5},g={...v,border:"none",boxShadow:"none",backgroundColor:"transparent",borderRadius:0,opacity:0,appearance:"none"};return{marker:(t,d)=>({fontSize:0,overflow:"hidden",padding:0,width:3,height:12,backgroundColor:p(t,d),border:`${f.width.thick} solid ${u.terminalOutputBackground}`,borderRadius:f.radius.small,boxSizing:"content-box",marginLeft:"-3.5px",transition:"left .5s ease-in-out"}),markerWrapper:{position:"absolute",top:0,lineHeight:0},markersOverlay:{top:5,zIndex:2,position:"absolute",width:"100%"},range:{height:25,"&:focus:not(:focus-visible)::-webkit-slider-thumb":{boxShadow:"none",backgroundColor:"transparent"},"input[type='range']::-webkit-slider-thumb":g,"input[type='range']::-moz-range-thumb":g,".euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText,width:t+"%!important",borderBottomRightRadius:0,borderTopRightRadius:0},".euiRangeSlider:focus ~ .euiRangeHighlight .euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText},".euiRangeSlider:focus:not(:focus-visible) ~ .euiRangeHighlight .euiRangeHighlight__progress":{backgroundColor:u.euiColorVis0_behindText},".euiRangeTrack::after":{background:u.terminalOutputSliderBackground}},playHead:d=>({...v,position:"absolute",left:t+"%",top:16,fill:d===Ht.ProcessDataLimitReached?u.terminalOutputMarkerWarning:u.terminalOutputMarkerAccent})}}),[d,u.euiColorVis0_behindText,u.euiColorVis1,u.terminalOutputBackground,u.terminalOutputMarkerAccent,u.terminalOutputMarkerWarning,u.terminalOutputSliderBackground,t])})(Object(p.useMemo)((()=>u/(d-1)*100),[u,d])),C=Object(p.useMemo)((()=>t.length<1?[]:t.map((({event:t,line:d,maxBytesExceeded:u})=>{var f;return{type:u?Ht.ProcessDataLimitReached:Ht.ProcessChanged,line:d,name:null===(f=t.process)||void 0===f?void 0:f.name}}))),[t]),y=C.length,w=Object(p.useMemo)((()=>{if(!y)return;const t=u>=C[y-1].line?y-1:C.findIndex((t=>t.line>u))-1;return C[Math.max(0,t)].type}),[u,C,y]);return y?Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(g.EuiRange,{value:u,min:0,max:Math.max(0,d-1),onChange:f,fullWidth:!0,showRange:!0,css:S.range}),Object(Y.jsx)(Pt,{css:S.playHead(w)}),Object(Y.jsx)("div",{css:S.markersOverlay},C.map((({line:t,type:f,name:p},v)=>{const w=u>=t&&(v===y-1||u<C[v+1].line),x={left:t/(d-1)*100+"%",zIndex:w?3:2};return Object(Y.jsx)("div",{key:v,style:x,css:S.markerWrapper},Object(Y.jsx)(g.EuiToolTip,{title:p},Object(Y.jsx)("button",{type:"button",value:t,tabIndex:-1,title:f,css:S.marker(f,w),onClick:()=>b(t),"aria-label":p},p)))})))):null},$t=({currentProcessEvent:t,processStartMarkers:d,isPlaying:u,currentLine:f,linesLength:v,onSeekLine:b,onTogglePlayback:S,onClose:C,onJumpToEvent:y,textSizer:w})=>{const x=(()=>{const{euiTheme:t,euiVars:d}=$();return Object(p.useMemo)((()=>{const{size:u,border:f}=t;return{controlsPanel:{paddingTop:u.s,paddingBottom:u.s,borderBottomLeftRadius:f.radius.medium,borderBottomRightRadius:f.radius.medium,backgroundColor:d.terminalOutputBackground},controlButton:{width:u.l}}}),[t,d.terminalOutputBackground])})(),O={display:"empty",size:"s",color:"text",css:x.controlButton},j=Object(p.useCallback)((t=>{const d=parseInt(t.currentTarget.value||"0",10);b(d)}),[b]),k=Object(p.useCallback)((()=>{b(0)}),[b]),T=Object(p.useCallback)((()=>{b(v-1)}),[v,b]),R=Object(p.useCallback)((()=>{const t=f>d[d.length-1].line?d.length:Object(L.findIndex)(d,(t=>t.line>=f)),u=d[t-1];b((null==u?void 0:u.line)||0)}),[d,b,f]),A=Object(p.useCallback)((()=>{const t=Object(L.findIndex)(d,(t=>t.line>f)),u=d[t];b((null==u?void 0:u.line)||v-1)}),[d,b,v,f]),D=Object(p.useCallback)((()=>{t&&(y(t),C())}),[t,C,y]);return Object(Y.jsx)(g.EuiPanel,{css:x.controlsPanel,"data-test-subj":"sessionView:TTYPlayerControls",hasShadow:!1,borderRadius:"none"},Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s",direction:"row"},Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{content:Lt},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYPlayerControlsStart",iconType:"arrowStart","aria-label":Lt,onClick:k},O)))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{content:Rt},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYPlayerControlsPrevious",iconType:"arrowLeft","aria-label":Rt,onClick:R},O)))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{content:u?Dt:At},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYPlayerControlsPlay",iconType:u?"pause":"playFilled","aria-label":u?Dt:At,onClick:S},O)))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{content:Mt},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYPlayerControlsNext",iconType:"arrowRight","aria-label":Mt,onClick:A},O)))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{content:Bt},Object(Y.jsx)(g.EuiButtonIcon,he()({"data-test-subj":"sessionView:TTYPlayerControlsEnd",iconType:"arrowEnd","aria-label":Bt,onClick:T},O)))),Object(Y.jsx)(g.EuiFlexItem,{style:{position:"relative"}},Object(Y.jsx)(Ft,{processStartMarkers:d,linesLength:v,currentLine:f,onChange:j,onSeekLine:b})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonEmpty,{iconSide:"right",size:"s",onClick:D,iconType:"arrowRight","aria-label":It,color:"text"},It)),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},w)))},zt=T.i18n.translate("xpack.sessionView.refreshSession",{defaultMessage:"Refresh session"}),Nt=T.i18n.translate("xpack.sessionView.toggleTTYPlayer",{defaultMessage:"Toggle TTY player"}),Vt=T.i18n.translate("xpack.sessionView.detailPanel",{defaultMessage:"Detail panel"}),Wt=({index:t,sessionEntityId:d,sessionStartTime:u,show:f,onClose:v,isFullscreen:b,onJumpToEvent:S,autoSeekToEntityId:C,canReadPolicyManagement:y,trackEvent:w})=>{var x,O,j;const k=Object(p.useRef)(null),{ref:T,height:R=1}=ft()({}),{data:A,fetchNextPage:D,hasNextPage:B,isFetching:P,refetch:H}=((t,d,u)=>{const{http:f}=Object(z.useKibana)().services,v=Object(p.useMemo)((()=>[M.B,d]),[d]);return Object(Ot.useInfiniteQuery)(v,(async({pageParam:p={}})=>{var v,g;const{cursor:b}=p,S=await f.get(M.t,{version:M.f,query:{index:t,sessionEntityId:d,sessionStartTime:u,cursor:b}});return{events:null!==(v=null===(g=S.events)||void 0===g?void 0:g.map((t=>t._source)))&&void 0!==v?v:[],cursor:b,total:S.total}}),{getNextPageParam:t=>{if(t.events.length>=M.s)return{cursor:t.events[t.events.length-1]["@timestamp"]}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})})(t,d,u),{lines:F,processStartMarkers:N}=(t=>{const[d,u]=Object(p.useState)(0),[f,v]=Object(p.useState)([]),[g,b]=Object(p.useState)([]);return Object(p.useMemo)((()=>{if(!t)return{lines:f,processStartMarkers:g};const p=t.reduce(((t,d)=>t.concat(d.events||[])),[]).slice(d),S=[];let C=[];p.forEach(((t,d)=>{var u;const{process:p}=t;if(void 0!==(null==p||null===(u=p.io)||void 0===u?void 0:u.text)&&void 0!==p.entity_id){var v,g,b,y,w;if(((null===(v=C[C.length-1])||void 0===v||null===(g=v.event)||void 0===g||null===(b=g.process)||void 0===b?void 0:b.entity_id)||(null===(y=f[f.length-1])||void 0===y||null===(w=y.event.process)||void 0===w?void 0:w.entity_id))!==p.entity_id){const d={line:f.length+C.length,event:t};S.push(d)}if(p.io.max_bytes_per_process_exceeded){const t=S.find((t=>{var d;return(null===(d=t.event.process)||void 0===d?void 0:d.entity_id)===p.entity_id}));t&&(t.maxBytesExceeded=!0)}const d=p.io.text.split(M.F),u=[d[0]];for(let t=1;t<d.length-1;t+=2)u.push(d[t]+d[t+1]);const x=u.map((d=>({event:t,value:d})));C=C.concat(x)}}));const y=f.concat(C),w=g.concat(S);C.length>0&&v(y),S.length>0&&b(w);const x=d+p.length;return x>d&&u(x),{lines:y,processStartMarkers:w}}),[d,t,f,g])})(null==A?void 0:A.pages),[V,W]=Object(p.useState)(M.j),[U,K]=Object(p.useState)(!1),[q,G]=Object(p.useState)(""),[J,X]=Object(p.useState)(""),{getUrlForApp:Z}=Object(z.useKibana)().services.application,Q=Object(p.useMemo)((()=>y?Z(M.D,{path:M.w}):""),[y,Z]),{search:ee,currentLine:te,seekToLine:ie}=(({ref:t,isPlaying:d,setIsPlaying:u,lines:f,fontSize:v,hasNextPage:g,fetchNextPage:b,isFetching:S,policiesUrl:C})=>{var y,w,x,O;const{euiTheme:j}=$(),{font:k,colors:T}=j,[L,R]=Object(p.useState)(0),[A]=Object(p.useState)(M.k),D=null==f||null===(y=f[L])||void 0===y||null===(w=y.event.process)||void 0===w?void 0:w.tty,B=null==f||null===(x=f[L])||void 0===x||null===(O=x.event.process)||void 0===O?void 0:O.name,[P,H]=Object(p.useMemo)((()=>{const t=new Et.Terminal({theme:{selectionBackground:T.warning,selectionForeground:T.ink,yellow:T.warning},fontFamily:k.familyCode,fontSize:M.j,scrollback:0,convertEol:!0,rows:M.l,cols:M.i,allowProposedApi:!0,allowTransparency:!0}),d=new xterm_search_SearchAddon;return t.loadAddon(d),[t,d]}),[k,T]);Object(p.useEffect)((()=>{t.current&&!P.element&&P.open(t.current);const d=t=>{var d,u;null!=t&&null!==(d=t.target)&&void 0!==d&&null!==(u=d.offsetParent)&&void 0!==u&&u.classList.contains("xterm-screen")&&t.stopImmediatePropagation()};return window.addEventListener("wheel",d,!0),()=>{window.removeEventListener("wheel",d,!0),P.dispose()}}),[P,t]);const F=Object(p.useCallback)(((t,d)=>{if(0===f.length)return;let u;if(d){u=f.slice(Math.max(0,t-M.E),t+1);try{P.reset(),P.clear()}catch(t){}}else u=f.slice(t,t+1);u.forEach(((u,p)=>{var v,g;void 0!==(null==u?void 0:u.value)&&P.write(u.value);const b=f[t+p+1],S=null===(v=u.event.process)||void 0===v||null===(g=v.io)||void 0===g?void 0:g.max_bytes_per_process_exceeded;if(!d&&(!b||b.event!==u.event)&&S){const t=((t,d,u)=>{if(null!=t&&t.columns){const f="-".repeat(t.columns),p=`  ⚠  ${jt} [1m${u}.[22m ${kt}`;return`\n[33m${f}\n${p}${d?`[${Math.min(p.length+2,t.columns-Tt.length-4)}G[1m]8;;${d}\\[ ${Tt} ]]8;;\\[22m`:""}\n${f}[0m\n\n`}})(D,C,B);t&&P.write(t)}}))}),[f,C,B,P,D]);Object(p.useEffect)((()=>{const t=P.options.fontSize!==v,d=D&&(P.rows!==(null==D?void 0:D.rows)||P.cols!==(null==D?void 0:D.columns));t&&(P.options.fontSize=v),null!=D&&D.rows&&null!=D&&D.columns&&d&&P.resize(D.columns,D.rows),(t||d)&&F(L,!0),!S&&g&&b&&L>=f.length-100&&b()}),[L,v,P,F,D,g,b,f.length,S]),Object(p.useEffect)((()=>{if(d){const t=setTimeout((()=>{if(g||L!==f.length-1){const t=Math.min(f.length-1,L+1);F(t,!1),R(t)}else u(!1)}),A);return()=>{clearTimeout(t)}}}),[f,L,d,A,F,g,b,u]);const z=Object(p.useCallback)((t=>{R(t),F(t,!0)}),[F]),N=Object(p.useCallback)(((t,d)=>{H.findNext(t,{caseSensitive:!1,lastLineOnly:!0,startCol:d})}),[H]);return{terminal:P,currentLine:L,seekToLine:z,search:N}})({ref:k,isPlaying:U,setIsPlaying:K,lines:F,fontSize:V,hasNextPage:B,fetchNextPage:D,isFetching:P,policiesUrl:Q}),se=null===(x=F[Math.min(F.length-1,te)])||void 0===x?void 0:x.event,re=null==se||null===(O=se.process)||void 0===O?void 0:O.tty;Object(p.useEffect)((()=>{f&&H({refetchPage:(t,d,u)=>u.length-1===d})}),[H,f]),Object(p.useEffect)((()=>{var t;if(C&&J!==C&&(null==se||null===(t=se.process)||void 0===t?void 0:t.entity_id)!==C){const t=N.find((t=>{var d;return(null===(d=t.event.process)||void 0===d?void 0:d.entity_id)===C}));t?(ie(t.line),X(C)):ie(F.length-1)}}),[C,J,null==se||null===(j=se.process)||void 0===j?void 0:j.entity_id,F.length,N,ie]);const ne=(null==re?void 0:re.rows)&&(null==re?void 0:re.rows)>1&&(null==re?void 0:re.rows)<1e3;re&&!ne&&(re.rows=M.l,re.columns=M.i);const oe=((t,d)=>{const{euiTheme:u,euiVars:f}=$();return Object(p.useMemo)((()=>{const{size:p,font:v,colors:b,border:S}=u,C={position:"absolute",top:0,opacity:d?1:0,transition:"opacity .2s",pointerEvents:d?"auto":"none",width:"100%",height:"100%",overflow:"hidden",zIndex:10,".euiRangeTick,.euiRangeLevel":{transition:"left 500ms"}},y={visibility:d?"visible":"hidden",backgroundColor:`${f.euiFormBackgroundDisabledColor}`,padding:`${p.m} ${p.base}`},w=Object(g.transparentize)(b.ghost,.6),x={minHeight:"100%",".xterm":xt,".xterm-screen":Object(Y.css)("overflow-y:visible;border:",S.width.thin," dotted ",w,";border-top:0;border-left:0;box-sizing:content-box;","")};return null!=t&&t.rows&&(x[".xterm-screen:after"]=Object(Y.css)("position:absolute;right:",p.s,";top:",p.s,";content:'",null==t?void 0:t.columns,"x",null==t?void 0:t.rows,"';color:",w,";font-family:",v.familyCode,";font-size:",p.m,";")),{container:C,header:y,terminal:x,scrollPane:{position:"relative",transform:`translateY(${d?0:"100%"})`,transition:"transform .2s ease-in-out",width:"100%",height:"calc(100% - 112px)",overflow:"auto",backgroundColor:b.ink}}}),[u,d,f.euiFormBackgroundDisabledColor,null==t?void 0:t.rows,null==t?void 0:t.columns])})(re,f),ae=Object(p.useCallback)((()=>{q&&G("")}),[q]),le=Object(p.useMemo)((()=>Object(L.throttle)((t=>{ae(),ie(t)}),100)),[ae,ie]),ce=Object(p.useCallback)((()=>{te>=F.length-1&&ie(0),K(!U),w(U?"tty_playback_started":"tty_playback_stopped")}),[te,U,F.length,ie,w]);return Object(p.useEffect)((()=>{U&&ae()}),[ae,U]),Object(Y.jsx)("div",{css:oe.container},Object(Y.jsx)(g.EuiPanel,{hasShadow:!1,borderRadius:"none",hasBorder:!1,css:oe.header},Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(Y.jsx)(g.EuiFlexItem,{"data-test-subj":"sessionView:TTYSearch"},Object(Y.jsx)(mt,{lines:F,seekToLine:ie,xTermSearchFn:ee,setIsPlaying:K,searchQuery:q,setSearchQuery:G})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{isSelected:!0,display:"fill",isLoading:P,iconType:"apmTrace",onClick:v,size:"m","aria-label":Nt,"data-test-subj":"sessionView:TTYPlayerClose"})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{iconType:"refresh",display:"empty",size:"m",disabled:!0,"aria-label":"disabled"})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{iconType:"eye",disabled:!0,size:"m","aria-label":"disabled"})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButton,{iconType:"list",disabled:!0},Vt)))),Object(Y.jsx)("div",{ref:T,className:"eui-scrollBar",css:oe.scrollPane},Object(Y.jsx)("div",{ref:k,"data-test-subj":"sessionView:TTYPlayer",css:oe.terminal})),Object(Y.jsx)(g.EuiThemeProvider,{colorMode:"dark"},Object(Y.jsx)($t,{currentProcessEvent:se,processStartMarkers:N,isPlaying:U,currentLine:te,linesLength:F.length,onSeekLine:le,onTogglePlayback:ce,onClose:v,onJumpToEvent:S,textSizer:Object(Y.jsx)(wt,{tty:re,containerHeight:R,fontSize:V,onFontSizeChanged:W,isFullscreen:b})})))},Ut=t=>!!t&&[M.q,M.o,M.p,M.n].includes(t),Kt=({index:t,sessionEntityId:d,sessionStartTime:u,height:S,isFullScreen:y=!1,jumpToEntityId:w,jumpToCursor:x,investigatedAlertId:O,loadAlertDetails:T,canReadPolicyManagement:L,trackEvent:R})=>{var A,D;w===d&&(w=void 0,x=void 0),Object(p.useEffect)((()=>{const d={[Fe.d]:Fe.c,[Fe.f]:Fe.e,[Fe.b]:Fe.a};R(`loaded_from_${d[t]||"unknown"}_${O?"alert":"log"}`)}),[t,O,R]);const[B,P]=Object(p.useState)(!1),[H,F]=Object(p.useState)(!1),[N,V]=Object(p.useState)(null),[W,U]=Object(p.useState)(""),[K,q]=Object(p.useState)(null),[G,J]=C()(M.u,{timestamp:!0,verboseMode:!1}),[X,Z]=Object(p.useState)([]),[Q,ee]=Object(p.useState)({}),[te,ie]=Object(p.useState)(x),[se,re]=Object(p.useState)(w),[ne,oe]=Object(p.useState)(""),ae=Object(p.useMemo)((()=>`session-view-uuid-${Object(f.v4)()}`),[]),le=(({height:t=500,isFullScreen:d})=>{const{euiTheme:u,euiVars:f}=$();return Object(p.useMemo)((()=>{const{border:p,size:v}=u,g={height:d?"calc(100vh - 118px)":t+"px"},b={...g,position:"relative"},S={...g,borderRightWidth:"0px"},C={position:"relative",border:p.thin,borderRadius:p.radius.medium,"> .sessionViewerToolbar":{backgroundColor:`${f.euiFormBackgroundDisabledColor}`,padding:`${v.m} ${v.base}`}};return{processTree:b,detailPanel:S,nonGrowGroup:{display:"flex",flexGrow:0,alignItems:"stretch"},resizeHandle:{zIndex:2},fakeDisabled:{color:f.euiButtonColorDisabledText},sessionViewerComponent:C}}),[u,d,t,f])})({height:S,isFullScreen:y}),ce=Object(p.useRef)((()=>{})),he=Object(p.useMemo)((()=>!(null!=G&&G.verboseMode||!W||0!==(null==K?void 0:K.length))),[null==G?void 0:G.verboseMode,K,W]),de=Object(p.useCallback)((t=>{V(t)}),[]),ue=Object(p.useCallback)((t=>{if(t.process){const{entity_id:f}=t.process;if(f!==d){var u;const d=null===(u=t.kibana)||void 0===u?void 0:u.alert,p=d?null==d?void 0:d.original_time:t["@timestamp"];p&&(re(f),ie(p))}V(null)}}),[d]),_e=Object(p.useCallback)((t=>{oe(t),P(!0)}),[]),{data:fe,error:pe,fetchNextPage:ve,hasNextPage:ge,isFetching:me,fetchPreviousPage:be,hasPreviousPage:Se,refetch:Ce}=((t,d,u,f)=>{const{http:v}=Object(z.useKibana)().services,[g,b]=Object(p.useState)(""),S=Object(p.useMemo)((()=>[M.C,t,d,f]),[t,d,f]),C=Object(Ot.useInfiniteQuery)(S,(async({pageParam:p={}})=>{var g,b;let{cursor:S}=p;const{forward:C}=p;!S&&f&&(S=f);const y=await v.get(M.y,{version:M.f,query:{index:t,sessionEntityId:d,sessionStartTime:u,cursor:S,forward:C}});return{events:null!==(g=null===(b=y.events)||void 0===b?void 0:b.map((t=>t._source)))&&void 0!==g?g:[],cursor:S,total:y.total}}),{getNextPageParam:(t,d)=>{if(1===d.length&&f||t.events.length>=M.x){var u;const d=t.events.filter((t=>{var d;const u=null===(d=t.event)||void 0===d?void 0:d.action;return Ut(u)})),f=null==d||null===(u=d[d.length-1])||void 0===u?void 0:u["@timestamp"];if(f)return{cursor:f,forward:!0}}},getPreviousPageParam:(t,d)=>{const u=t.events.filter((t=>{var d;const u=null===(d=t.event)||void 0===d?void 0:d.action;return Ut(u)})),p=d.length>1&&u.length<M.x;var v;if(f&&!p)return{cursor:(null===(v=u[0])||void 0===v?void 0:v["@timestamp"])||f,forward:!1}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1});return Object(p.useEffect)((()=>{var t;f&&1===(null===(t=C.data)||void 0===t?void 0:t.pages.length)&&f!==g&&(C.fetchPreviousPage({cancelRefetch:!0}),b(f))}),[f,C,g]),C})(t,d,u,te),{data:ye,fetchNextPage:we,isFetching:xe,hasNextPage:Ee,error:Oe,refetch:je}=((t,d,u)=>{const{http:f}=Object(z.useKibana)().services,p=[M.z,t,u];return Object(Ot.useInfiniteQuery)(p,(async({pageParam:p={}})=>{var v,g;const{cursor:b}=p,S=await f.get(M.b,{version:M.f,query:{sessionEntityId:t,sessionStartTime:d,investigatedAlertId:u,cursor:b}});return{events:null!==(v=null===(g=S.events)||void 0===g?void 0:g.map((t=>t._source)))&&void 0!==v?v:[],cursor:b,total:S.total}}),{getNextPageParam:t=>{if(t.events.length>=M.a)return{cursor:t.events[t.events.length-1]["@timestamp"]}},refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})})(d,u,O),{data:ke,refetch:Te}=((t,d,u)=>{const{http:f}=Object(z.useKibana)().services,p=[M.A,t,d];return Object(Ot.useQuery)(p,(async()=>f.get(M.r,{version:M.f,query:{index:t,sessionEntityId:d,sessionStartTime:u}})),{refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,cacheTime:0})})(t,d,u),Le=!(null==ke||!ke.total),Re=Object(p.useMemo)((()=>{const{unit:t,value:d}=j((null==ke?void 0:ke.total)||0);return{unit:t,value:d}}),[null==ke?void 0:ke.total]),Ae=Object(p.useCallback)((()=>{Le?(P(!B),R("tty_loaded")):R("disabled_tty_clicked")}),[Le,B,R]),De=Object(p.useCallback)((()=>{Ce({refetchPage:(t,d,u)=>u.length-1===d}),je({refetchPage:(t,d,u)=>u.length-1===d}),Te(),R("refresh_clicked")}),[Ce,je,Te,R]),Be=Object(p.useMemo)((()=>{let t=[];return ye&&ye.pages.forEach((d=>{t=t.concat(d.events)})),t}),[ye]),Ie=Object(p.useMemo)((()=>{var t;return(null==ye||null===(t=ye.pages)||void 0===t?void 0:t[0].total)||0}),[ye]),Pe=pe||Oe,He=fe&&(null===(A=fe.pages)||void 0===A?void 0:A.length)>(x?1:0),$e=me&&!He,ze=He&&fe.pages[0].events.length>0,{data:Ne}=((t,d)=>{const{http:u}=Object(z.useKibana)().services,f=[M.z,d];return Object(Ot.useQuery)(f,(async()=>{var f,p,v,g,b,S,C,y,w;if(!d)return t;const x=null!==(f=null===(p=(await u.get(M.e,{version:M.f,query:{alertUuid:d}})).events)||void 0===p?void 0:p.map((t=>t._source)))&&void 0!==f?f:[];return{...t,[d]:{status:null!==(v=null===(g=x[0])||void 0===g||null===(b=g.kibana)||void 0===b||null===(S=b.alert)||void 0===S?void 0:S.workflow_status)&&void 0!==v?v:"",processEntityId:null!==(C=null===(y=x[0])||void 0===y||null===(w=y.process)||void 0===w?void 0:w.entity_id)&&void 0!==C?C:""}}}),{refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,cacheTime:0})})(Q,null!==(D=X[0])&&void 0!==D?D:"");Object(p.useEffect)((()=>{Ne&&(ee({...Ne}),X.shift())}),[Ne,X]);const Ve=Object(p.useCallback)((t=>{if(K){const d=K[t];d&&de(d)}}),[de,K]);Object(p.useEffect)((()=>{Ve(0)}),[Ve,K]);const We=Object(p.useCallback)((t=>{Z([t])}),[]),Ue=Object(p.useCallback)((()=>{const t=!H;ce.current(),F(t),R(t?"details_opened":"details_closed")}),[H,R]),Ke=Object(p.useCallback)((t=>{T&&(T(t,(()=>We(t))),R("alert_details_loaded"))}),[T,R,We]),qe=Object(p.useCallback)((t=>{J(t),t.verboseMode!==(null==G?void 0:G.verboseMode)&&(t.verboseMode?R("verbose_mode_enabled"):R("verbose_mode_disabled")),t.timestamp!==(null==G?void 0:G.timestamp)&&(t.timestamp?R("timestamp_enabled"):R("timestamp_disabled"))}),[null==G?void 0:G.timestamp,null==G?void 0:G.verboseMode,J,R]);return $e?Object(Y.jsx)(k.SectionLoading,null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.loadingProcessTree",defaultMessage:"Loading session…"})):ze?Object(Y.jsx)("div",{css:le.sessionViewerComponent},Object(Y.jsx)(g.EuiPanel,{hasShadow:!1,borderRadius:"none",className:"sessionViewerToolbar"},Object(Y.jsx)(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(Y.jsx)(g.EuiFlexItem,{"data-test-subj":"sessionView:sessionViewProcessEventsSearch"},Object(Y.jsx)(at,{searchQuery:W,totalMatches:(null==K?void 0:K.length)||0,setSearchQuery:U,onPrevious:Ve,onNext:Ve,trackEvent:R})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiToolTip,{title:Object(Y.jsx)(v.a.Fragment,null,Re.value," ",Re.unit,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.ttyToggleTip",defaultMessage:" of TTY output"}))},Object(Y.jsx)(g.EuiButtonIcon,{isSelected:B,display:B?"fill":"empty",iconType:"apmTrace",onClick:Ae,size:"m","aria-label":Nt,"data-test-subj":"sessionView:TTYPlayerToggle",css:!Le&&le.fakeDisabled}))),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButtonIcon,{iconType:"refresh",display:"empty",onClick:De,size:"m","aria-label":zt,"data-test-subj":"sessionView:sessionViewRefreshButton",isLoading:me})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(ut,{displayOptions:G,onChange:qe,showVerboseSearchTooltip:he})),Object(Y.jsx)(g.EuiFlexItem,{grow:!1},Object(Y.jsx)(g.EuiButton,{onClick:Ue,iconType:"list","data-test-subj":"sessionView:sessionViewDetailPanelToggle",fill:!H},Vt)))),Object(Y.jsx)(g.EuiHorizontalRule,{margin:"none"}),Object(Y.jsx)(g.EuiResizableContainer,null,((u,f,{togglePanel:p})=>(ce.current=()=>{null==p||p(ae,{direction:"left"})},Object(Y.jsx)(v.a.Fragment,null,Object(Y.jsx)(u,{initialSize:100,minSize:"60%",paddingSize:"none"},Pe&&Object(Y.jsx)(g.EuiEmptyPrompt,{iconType:"warning",color:"danger",title:Object(Y.jsx)("h2",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.errorHeading",defaultMessage:"Error loading Session View"})),body:Object(Y.jsx)("p",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.errorMessage",defaultMessage:"There was an error loading the Session View."}))}),ze&&Object(Y.jsx)("div",{css:le.processTree},Object(Y.jsx)(Me,{key:d+te,sessionEntityId:d,data:fe.pages,searchQuery:W,selectedProcess:N,onProcessSelected:de,onJumpToOutput:_e,jumpToEntityId:se,investigatedAlertId:O,isFetching:me,hasPreviousPage:Se,hasNextPage:ge,fetchNextPage:ve,fetchPreviousPage:be,setSearchResults:q,updatedAlertsStatus:Q,onShowAlertDetails:Ke,showTimestamp:null==G?void 0:G.timestamp,verboseMode:null==G?void 0:G.verboseMode,trackEvent:R}))),Object(Y.jsx)(f,{css:le.resizeHandle}),Object(Y.jsx)(u,{id:ae,initialSize:30,minSize:"320px",paddingSize:"none",css:le.detailPanel},Object(Y.jsx)(rt,{index:t,alerts:Be,alertsCount:Ie,isFetchingAlerts:xe,hasNextPageAlerts:Ee,fetchNextPageAlerts:we,investigatedAlertId:O,selectedProcess:N,onJumpToEvent:ue,onShowAlertDetails:Ke})))))),Object(Y.jsx)(Wt,{index:t,show:B,sessionEntityId:d,sessionStartTime:u,onClose:Ae,isFullscreen:y,onJumpToEvent:ue,autoSeekToEntityId:ne,canReadPolicyManagement:L,trackEvent:R})):Object(Y.jsx)(g.EuiEmptyPrompt,{"data-test-subj":"sessionView:sessionViewProcessEventsEmpty",title:Object(Y.jsx)("h2",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.emptyDataTitle",defaultMessage:"No data to render"})),body:Object(Y.jsx)("p",null,Object(Y.jsx)(b.FormattedMessage,{id:"xpack.sessionView.emptyDataMessage",defaultMessage:"No process events found for this query."}))})}},function(t,d,u){t.exports=u(8)(2)},function(t,d,u){"use strict";var f=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function p(t,d){if(t.length!==d.length)return!1;for(var u=0;u<t.length;u++)if(!((p=t[u])===(v=d[u])||f(p)&&f(v)))return!1;var p,v;return!0}t.exports=function(t,d){void 0===d&&(d=p);var u=null;function f(){for(var f=[],p=0;p<arguments.length;p++)f[p]=arguments[p];if(u&&u.lastThis===this&&d(f,u.lastArgs))return u.lastResult;var v=t.apply(this,f);return u={lastResult:v,lastArgs:f,lastThis:this},v}return f.clear=function(){u=null},f}},function(t,d,u){"use strict";const f=u(24);t.exports=t=>"string"==typeof t?t.replace(f(),""):t},function(t,d,u){"use strict";t.exports=({onlyFirst:t=!1}={})=>{const d=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(d,t?void 0:"g")}},function(t,d,u){self,t.exports=(()=>{"use strict";var t={4567:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.AccessibilityManager=void 0;const f=u(9042),p=u(6114),v=u(9924),g=u(3656),b=u(844),S=u(5596),C=u(9631);class l extends b.Disposable{constructor(t,d){super(),this._terminal=t,this._renderService=d,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityTreeRoot=document.createElement("div"),this._accessibilityTreeRoot.classList.add("xterm-accessibility"),this._accessibilityTreeRoot.tabIndex=0,this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let t=0;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);if(this._topBoundaryFocusListener=t=>this._handleBoundaryFocus(t,0),this._bottomBoundaryFocusListener=t=>this._handleBoundaryFocus(t,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityTreeRoot.appendChild(this._rowContainer),this._renderRowsDebouncer=new v.TimeBasedDebouncer(this._renderRows.bind(this)),this._refreshRows(),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityTreeRoot.appendChild(this._liveRegion),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityTreeRoot),this.register(this._renderRowsDebouncer),this.register(this._terminal.onResize((t=>this._handleResize(t.rows)))),this.register(this._terminal.onRender((t=>this._refreshRows(t.start,t.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((t=>this._handleChar(t)))),this.register(this._terminal.onLineFeed((()=>this._handleChar("\n")))),this.register(this._terminal.onA11yTab((t=>this._handleTab(t)))),this.register(this._terminal.onKey((t=>this._handleKey(t.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this._screenDprMonitor=new S.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener((()=>this._refreshRowsDimensions())),this.register((0,g.addDisposableDomListener)(window,"resize",(()=>this._refreshRowsDimensions()))),this.register((0,b.toDisposable)((()=>{(0,C.removeElementFromParent)(this._accessibilityTreeRoot),this._rowElements.length=0})))}_handleBoundaryFocus(t,d){const u=t.target,f=this._rowElements[0===d?1:this._rowElements.length-2];if(u.getAttribute("aria-posinset")===(0===d?"1":`${this._terminal.buffer.lines.length}`))return;if(t.relatedTarget!==f)return;let p,v;if(0===d?(p=u,v=this._rowElements.pop(),this._rowContainer.removeChild(v)):(p=this._rowElements.shift(),v=u,this._rowContainer.removeChild(p)),p.removeEventListener("focus",this._topBoundaryFocusListener),v.removeEventListener("focus",this._bottomBoundaryFocusListener),0===d){const t=this._createAccessibilityTreeNode();this._rowElements.unshift(t),this._rowContainer.insertAdjacentElement("afterbegin",t)}else{const t=this._createAccessibilityTreeNode();this._rowElements.push(t),this._rowContainer.appendChild(t)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===d?-1:1),this._rowElements[0===d?1:this._rowElements.length-2].focus(),t.preventDefault(),t.stopImmediatePropagation()}_handleResize(t){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const t=document.createElement("div");return t.setAttribute("role","listitem"),t.tabIndex=-1,this._refreshRowDimensions(t),t}_handleTab(t){for(let d=0;d<t;d++)this._handleChar(" ")}_handleChar(t){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==t&&(this._charsToAnnounce+=t):this._charsToAnnounce+=t,"\n"===t&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=f.tooMuchOutput)),p.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout((()=>{this._accessibilityTreeRoot.appendChild(this._liveRegion)}),0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,p.isMac&&(0,C.removeElementFromParent)(this._liveRegion)}_handleKey(t){this._clearLiveRegion(),/\p{Control}/u.test(t)||this._charsToConsume.push(t)}_refreshRows(t,d){this._renderRowsDebouncer.refresh(t,d,this._terminal.rows)}_renderRows(t,d){const u=this._terminal.buffer,f=u.lines.length.toString();for(let p=t;p<=d;p++){const t=u.translateBufferLineToString(u.ydisp+p,!0),d=(u.ydisp+p+1).toString(),v=this._rowElements[p];v&&(0===t.length?v.innerText=" ":v.textContent=t,v.setAttribute("aria-posinset",d),v.setAttribute("aria-setsize",f))}this._announceCharacters()}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityTreeRoot.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let t=0;t<this._terminal.rows;t++)this._refreshRowDimensions(this._rowElements[t])}}_refreshRowDimensions(t){t.style.height=`${this._renderService.dimensions.css.cell.height}px`}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}}d.AccessibilityManager=l},3614:(t,d)=>{function u(t){return t.replace(/\r?\n/g,"\r")}function f(t,d){return d?"[200~"+t+"[201~":t}function p(t,d,p){t=f(t=u(t),p.decPrivateModes.bracketedPasteMode),p.triggerDataEvent(t,!0),d.value=""}function v(t,d,u){const f=u.getBoundingClientRect(),p=t.clientX-f.left-10,v=t.clientY-f.top-10;d.style.width="20px",d.style.height="20px",d.style.left=`${p}px`,d.style.top=`${v}px`,d.style.zIndex="1000",d.focus()}Object.defineProperty(d,"__esModule",{value:!0}),d.rightClickHandler=d.moveTextAreaUnderMouseCursor=d.paste=d.handlePasteEvent=d.copyHandler=d.bracketTextForPaste=d.prepareTextForTerminal=void 0,d.prepareTextForTerminal=u,d.bracketTextForPaste=f,d.copyHandler=function(t,d){t.clipboardData&&t.clipboardData.setData("text/plain",d.selectionText),t.preventDefault()},d.handlePasteEvent=function(t,d,u){t.stopPropagation(),t.clipboardData&&p(t.clipboardData.getData("text/plain"),d,u)},d.paste=p,d.moveTextAreaUnderMouseCursor=v,d.rightClickHandler=function(t,d,u,f,p){v(t,d,u),p&&f.rightClickSelect(t),d.value=f.selectionText,d.select()}},7239:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ColorContrastCache=void 0;const f=u(1505);d.ColorContrastCache=class{constructor(){this._color=new f.TwoKeyMap,this._css=new f.TwoKeyMap}setCss(t,d,u){this._css.set(t,d,u)}getCss(t,d){return this._css.get(t,d)}setColor(t,d,u){this._color.set(t,d,u)}getColor(t,d){return this._color.get(t,d)}clear(){this._color.clear(),this._css.clear()}}},9631:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.removeElementFromParent=void 0,d.removeElementFromParent=function(...t){var d;for(const u of t)null===(d=null==u?void 0:u.parentElement)||void 0===d||d.removeChild(u)}},3656:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.addDisposableDomListener=void 0,d.addDisposableDomListener=function(t,d,u,f){t.addEventListener(d,u,f);let p=!1;return{dispose:()=>{p||(p=!0,t.removeEventListener(d,u,f))}}}},6465:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.Linkifier2=void 0;const v=u(2585),g=u(8460),b=u(844),S=u(3656);let C=class extends b.Disposable{constructor(t){super(),this._bufferService=t,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._activeLine=-1,this._onShowLinkUnderline=this.register(new g.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new g.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,b.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,b.toDisposable)((()=>{this._lastMouseEvent=void 0})))}get currentLink(){return this._currentLink}registerLinkProvider(t){return this._linkProviders.push(t),{dispose:()=>{const d=this._linkProviders.indexOf(t);-1!==d&&this._linkProviders.splice(d,1)}}}attachToDom(t,d,u){this._element=t,this._mouseService=d,this._renderService=u,this.register((0,S.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,S.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,S.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,S.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(t){if(this._lastMouseEvent=t,!this._element||!this._mouseService)return;const d=this._positionFromMouseEvent(t,this._element,this._mouseService);if(!d)return;this._isMouseOut=!1;const u=t.composedPath();for(let t=0;t<u.length;t++){const d=u[t];if(d.classList.contains("xterm"))break;if(d.classList.contains("xterm-hover"))return}this._lastBufferCell&&d.x===this._lastBufferCell.x&&d.y===this._lastBufferCell.y||(this._handleHover(d),this._lastBufferCell=d)}_handleHover(t){if(this._activeLine!==t.y)return this._clearCurrentLink(),void this._askForLink(t,!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,t)||(this._clearCurrentLink(),this._askForLink(t,!0))}_askForLink(t,d){var u,f;this._activeProviderReplies&&d||(null===(u=this._activeProviderReplies)||void 0===u||u.forEach((t=>{null==t||t.forEach((t=>{t.link.dispose&&t.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=t.y);let p=!1;for(const[u,v]of this._linkProviders.entries())d?(null===(f=this._activeProviderReplies)||void 0===f?void 0:f.get(u))&&(p=this._checkLinkProviderResult(u,t,p)):v.provideLinks(t.y,(d=>{var f,v;if(this._isMouseOut)return;const g=null==d?void 0:d.map((t=>({link:t})));null===(f=this._activeProviderReplies)||void 0===f||f.set(u,g),p=this._checkLinkProviderResult(u,t,p),(null===(v=this._activeProviderReplies)||void 0===v?void 0:v.size)===this._linkProviders.length&&this._removeIntersectingLinks(t.y,this._activeProviderReplies)}))}_removeIntersectingLinks(t,d){const u=new Set;for(let f=0;f<d.size;f++){const p=d.get(f);if(p)for(let d=0;d<p.length;d++){const f=p[d],v=f.link.range.start.y<t?0:f.link.range.start.x,g=f.link.range.end.y>t?this._bufferService.cols:f.link.range.end.x;for(let t=v;t<=g;t++){if(u.has(t)){p.splice(d--,1);break}u.add(t)}}}}_checkLinkProviderResult(t,d,u){var f;if(!this._activeProviderReplies)return u;const p=this._activeProviderReplies.get(t);let v=!1;for(let d=0;d<t;d++)this._activeProviderReplies.has(d)&&!this._activeProviderReplies.get(d)||(v=!0);if(!v&&p){const t=p.find((t=>this._linkAtPosition(t.link,d)));t&&(u=!0,this._handleNewLink(t))}if(this._activeProviderReplies.size===this._linkProviders.length&&!u)for(let t=0;t<this._activeProviderReplies.size;t++){const p=null===(f=this._activeProviderReplies.get(t))||void 0===f?void 0:f.find((t=>this._linkAtPosition(t.link,d)));if(p){u=!0,this._handleNewLink(p);break}}return u}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(t){if(!this._element||!this._mouseService||!this._currentLink)return;const d=this._positionFromMouseEvent(t,this._element,this._mouseService);d&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,d)&&this._currentLink.link.activate(t,this._currentLink.link.text)}_clearCurrentLink(t,d){this._element&&this._currentLink&&this._lastMouseEvent&&(!t||!d||this._currentLink.link.range.start.y>=t&&this._currentLink.link.range.end.y<=d)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,b.disposeArray)(this._linkCacheDisposables))}_handleNewLink(t){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const d=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);d&&this._linkAtPosition(t.link,d)&&(this._currentLink=t,this._currentLink.state={decorations:{underline:void 0===t.link.decorations||t.link.decorations.underline,pointerCursor:void 0===t.link.decorations||t.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,t.link,this._lastMouseEvent),t.link.decorations={},Object.defineProperties(t.link.decorations,{pointerCursor:{get:()=>{var t,d;return null===(d=null===(t=this._currentLink)||void 0===t?void 0:t.state)||void 0===d?void 0:d.decorations.pointerCursor},set:t=>{var d,u;(null===(d=this._currentLink)||void 0===d?void 0:d.state)&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&(null===(u=this._element)||void 0===u||u.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,d;return null===(d=null===(t=this._currentLink)||void 0===t?void 0:t.state)||void 0===d?void 0:d.decorations.underline},set:d=>{var u,f,p;(null===(u=this._currentLink)||void 0===u?void 0:u.state)&&(null===(p=null===(f=this._currentLink)||void 0===f?void 0:f.state)||void 0===p?void 0:p.decorations.underline)!==d&&(this._currentLink.state.decorations.underline=d,this._currentLink.state.isHovered&&this._fireUnderlineEvent(t.link,d))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((t=>{const d=0===t.start?0:t.start+1+this._bufferService.buffer.ydisp,u=this._currentLink?this._lastMouseEvent:void 0;if(this._clearCurrentLink(d,t.end+1+this._bufferService.buffer.ydisp),u&&this._element){const t=this._positionFromMouseEvent(u,this._element,this._mouseService);t&&this._askForLink(t,!1)}}))))}_linkHover(t,d,u){var f;(null===(f=this._currentLink)||void 0===f?void 0:f.state)&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!0),this._currentLink.state.decorations.pointerCursor&&t.classList.add("xterm-cursor-pointer")),d.hover&&d.hover(u,d.text)}_fireUnderlineEvent(t,d){const u=t.range,f=this._bufferService.buffer.ydisp,p=this._createLinkUnderlineEvent(u.start.x-1,u.start.y-f-1,u.end.x,u.end.y-f-1,void 0);(d?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(p)}_linkLeave(t,d,u){var f;(null===(f=this._currentLink)||void 0===f?void 0:f.state)&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!1),this._currentLink.state.decorations.pointerCursor&&t.classList.remove("xterm-cursor-pointer")),d.leave&&d.leave(u,d.text)}_linkAtPosition(t,d){const u=t.range.start.y*this._bufferService.cols+t.range.start.x,f=t.range.end.y*this._bufferService.cols+t.range.end.x,p=d.y*this._bufferService.cols+d.x;return u<=p&&p<=f}_positionFromMouseEvent(t,d,u){const f=u.getCoords(t,d,this._bufferService.cols,this._bufferService.rows);if(f)return{x:f[0],y:f[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(t,d,u,f,p){return{x1:t,y1:d,x2:u,y2:f,cols:this._bufferService.cols,fg:p}}};C=f([p(0,v.IBufferService)],C),d.Linkifier2=C},9042:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.tooMuchOutput=d.promptLabel=void 0,d.promptLabel="Terminal input",d.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.OscLinkProvider=void 0;const v=u(511),g=u(2585);let b=class{constructor(t,d,u){this._bufferService=t,this._optionsService=d,this._oscLinkService=u}provideLinks(t,d){var u;const f=this._bufferService.buffer.lines.get(t-1);if(!f)return void d(void 0);const p=[],g=this._optionsService.rawOptions.linkHandler,b=new v.CellData,C=f.getTrimmedLength();let y=-1,w=-1,x=!1;for(let d=0;d<C;d++)if(-1!==w||f.hasContent(d)){if(f.loadCell(d,b),b.hasExtendedAttrs()&&b.extended.urlId){if(-1===w){w=d,y=b.extended.urlId;continue}x=b.extended.urlId!==y}else-1!==w&&(x=!0);if(x||-1!==w&&d===C-1){const f=null===(u=this._oscLinkService.getLinkData(y))||void 0===u?void 0:u.uri;if(f){const u={start:{x:w+1,y:t},end:{x:d+(x||d!==C-1?0:1),y:t}};let v=!1;if(!(null==g?void 0:g.allowNonHttpProtocols))try{const t=new URL(f);["http:","https:"].includes(t.protocol)||(v=!0)}catch(t){v=!0}v||p.push({text:f,range:u,activate:(t,d)=>g?g.activate(t,d,u):S(0,d),hover:(t,d)=>{var f;return null===(f=null==g?void 0:g.hover)||void 0===f?void 0:f.call(g,t,d,u)},leave:(t,d)=>{var f;return null===(f=null==g?void 0:g.leave)||void 0===f?void 0:f.call(g,t,d,u)}})}x=!1,b.hasExtendedAttrs()&&b.extended.urlId?(w=d,y=b.extended.urlId):(w=-1,y=-1)}}d(p)}};function S(t,d){if(confirm(`Do you want to navigate to ${d}?\n\nWARNING: This link could potentially be dangerous`)){const u=window.open();if(u){try{u.opener=null}catch(t){}u.location.href=d}else console.warn("Opening link blocked as opener could not be cleared")}}b=f([p(0,g.IBufferService),p(1,g.IOptionsService),p(2,g.IOscLinkService)],b),d.OscLinkProvider=b},6193:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.RenderDebouncer=void 0,d.RenderDebouncer=class{constructor(t,d){this._parentWindow=t,this._renderCallback=d,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(t){return this._refreshCallbacks.push(t),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(t,d,u){this._rowCount=u,t=void 0!==t?t:0,d=void 0!==d?d:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,t):t,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,d):d,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();const t=Math.max(this._rowStart,0),d=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,d),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const t of this._refreshCallbacks)t(0);this._refreshCallbacks=[]}}},5596:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ScreenDprMonitor=void 0;const f=u(844);class r extends f.Disposable{constructor(t){super(),this._parentWindow=t,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,f.toDisposable)((()=>{this.clearListener()})))}setListener(t){this._listener&&this.clearListener(),this._listener=t,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var t;this._outerListener&&(null===(t=this._resolutionMediaMatchList)||void 0===t||t.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}d.ScreenDprMonitor=r},3236:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.Terminal=void 0;const f=u(2950),p=u(1680),v=u(3614),g=u(2584),b=u(5435),S=u(9312),C=u(6114),y=u(3656),w=u(9042),x=u(4567),O=u(1296),j=u(7399),k=u(8460),T=u(8437),L=u(3230),R=u(4725),A=u(428),D=u(8934),M=u(6465),B=u(5114),P=u(8969),H=u(8055),F=u(4269),$=u(5941),z=u(3107),N=u(5744),V=u(9074),W=u(2585),U=u(3730),K=u(844),q=u(6731),G="undefined"!=typeof window?window.document:null;class I extends P.CoreTerminal{constructor(t={}){super(t),this.browser=C,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._onCursorMove=this.register(new k.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new k.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new k.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new k.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new k.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new k.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new k.EventEmitter),this._onBlur=this.register(new k.EventEmitter),this._onA11yCharEmitter=this.register(new k.EventEmitter),this._onA11yTabEmitter=this.register(new k.EventEmitter),this._onWillOpen=this.register(new k.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(M.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(U.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(V.DecorationService),this._instantiationService.setService(W.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows(((t,d)=>this.refresh(t,d)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport((t=>this._reportWindowsOptions(t)))),this.register(this._inputHandler.onColor((t=>this._handleColorEvent(t)))),this.register((0,k.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,k.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,k.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize((t=>this._afterResize(t.cols,t.rows)))),this.register((0,K.toDisposable)((()=>{var t,d;this._customKeyEventHandler=void 0,null===(d=null===(t=this.element)||void 0===t?void 0:t.parentNode)||void 0===d||d.removeChild(this.element)})))}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(t){if(this._themeService)for(const d of t){let t,u="";switch(d.index){case 256:t="foreground",u="10";break;case 257:t="background",u="11";break;case 258:t="cursor",u="12";break;default:t="ansi",u="4;"+d.index}switch(d.type){case 0:const f=H.color.toColorRGB("ansi"===t?this._themeService.colors.ansi[d.index]:this._themeService.colors[t]);this.coreService.triggerDataEvent(`${g.C0.ESC}]${u};${(0,$.toRgbString)(f)}${g.C1_ESCAPED.ST}`);break;case 1:if("ansi"===t)this._themeService.modifyColors((t=>t.ansi[d.index]=H.rgba.toColor(...d.color)));else{const u=t;this._themeService.modifyColors((t=>t[u]=H.rgba.toColor(...d.color)))}break;case 2:this._themeService.restoreColor(d.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(t){var d;t?!this._accessibilityManager&&this._renderService&&(this._accessibilityManager=new x.AccessibilityManager(this,this._renderService)):(null===(d=this._accessibilityManager)||void 0===d||d.dispose(),this._accessibilityManager=void 0)}_handleTextAreaFocus(t){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(g.C0.ESC+"[I"),this.updateCursorStyle(t),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var t;return null===(t=this.textarea)||void 0===t?void 0:t.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(g.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const t=this.buffer.ybase+this.buffer.y,d=this.buffer.lines.get(t);if(!d)return;const u=Math.min(this.buffer.x,this.cols-1),f=this._renderService.dimensions.css.cell.height,p=d.getWidth(u),v=this._renderService.dimensions.css.cell.width*p,g=this.buffer.y*this._renderService.dimensions.css.cell.height,b=u*this._renderService.dimensions.css.cell.width;this.textarea.style.left=b+"px",this.textarea.style.top=g+"px",this.textarea.style.width=v+"px",this.textarea.style.height=f+"px",this.textarea.style.lineHeight=f+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,y.addDisposableDomListener)(this.element,"copy",(t=>{this.hasSelection()&&(0,v.copyHandler)(t,this._selectionService)})));const t=t=>(0,v.handlePasteEvent)(t,this.textarea,this.coreService);this.register((0,y.addDisposableDomListener)(this.textarea,"paste",t)),this.register((0,y.addDisposableDomListener)(this.element,"paste",t)),C.isFirefox?this.register((0,y.addDisposableDomListener)(this.element,"mousedown",(t=>{2===t.button&&(0,v.rightClickHandler)(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,y.addDisposableDomListener)(this.element,"contextmenu",(t=>{(0,v.rightClickHandler)(t,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),C.isLinux&&this.register((0,y.addDisposableDomListener)(this.element,"auxclick",(t=>{1===t.button&&(0,v.moveTextAreaUnderMouseCursor)(t,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,y.addDisposableDomListener)(this.textarea,"keyup",(t=>this._keyUp(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"keydown",(t=>this._keyDown(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"keypress",(t=>this._keyPress(t)),!0)),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionupdate",(t=>this._compositionHelper.compositionupdate(t)))),this.register((0,y.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,y.addDisposableDomListener)(this.textarea,"input",(t=>this._inputEvent(t)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(t){var d;if(!t)throw new Error("Terminal requires a parent element.");t.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=t.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),t.appendChild(this.element);const u=G.createDocumentFragment();this._viewportElement=G.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),u.appendChild(this._viewportElement),this._viewportScrollArea=G.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=G.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=G.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),u.appendChild(this.screenElement),this.textarea=G.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",w.promptLabel),C.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(B.CoreBrowserService,this.textarea,null!==(d=this._document.defaultView)&&void 0!==d?d:window),this._instantiationService.setService(R.ICoreBrowserService,this._coreBrowserService),this.register((0,y.addDisposableDomListener)(this.textarea,"focus",(t=>this._handleTextAreaFocus(t)))),this.register((0,y.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(A.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(R.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(q.ThemeService),this._instantiationService.setService(R.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(F.CharacterJoinerService),this._instantiationService.setService(R.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(L.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(R.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((t=>this._onRender.fire(t)))),this.onResize((t=>this._renderService.resize(t.cols,t.rows))),this._compositionView=G.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(f.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(u);try{this._onWillOpen.fire(this.element)}catch(t){}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(D.MouseService),this._instantiationService.setService(R.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(p.Viewport,(t=>this.scrollLines(t,!0,1)),this._viewportElement,this._viewportScrollArea),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(S.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(R.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((t=>this.scrollLines(t.amount,t.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((t=>this._renderService.handleSelectionChanged(t.start,t.end,t.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((t=>{this.textarea.value=t,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((t=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,y.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(z.BufferDecorationRenderer,this.screenElement)),this.register((0,y.addDisposableDomListener)(this.element,"mousedown",(t=>this._selectionService.handleMouseDown(t)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new x.AccessibilityManager(this,this._renderService)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(t=>this._handleScreenReaderModeOptionChange(t)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(N.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(t=>{!this._overviewRulerRenderer&&t&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(N.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(O.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const t=this,d=this.element;function u(d){const u=t._mouseService.getMouseReportCoords(d,t.screenElement);if(!u)return!1;let f,p;switch(d.overrideType||d.type){case"mousemove":p=32,void 0===d.buttons?(f=3,void 0!==d.button&&(f=d.button<3?d.button:3)):f=1&d.buttons?0:4&d.buttons?1:2&d.buttons?2:3;break;case"mouseup":p=0,f=d.button<3?d.button:3;break;case"mousedown":p=1,f=d.button<3?d.button:3;break;case"wheel":if(0===t.viewport.getLinesScrolled(d))return!1;p=d.deltaY<0?0:1,f=4;break;default:return!1}return!(void 0===p||void 0===f||f>4)&&t.coreMouseService.triggerMouseEvent({col:u.col,row:u.row,x:u.x,y:u.y,button:f,action:p,ctrl:d.ctrlKey,alt:d.altKey,shift:d.shiftKey})}const f={mouseup:null,wheel:null,mousedrag:null,mousemove:null},p={mouseup:t=>(u(t),t.buttons||(this._document.removeEventListener("mouseup",f.mouseup),f.mousedrag&&this._document.removeEventListener("mousemove",f.mousedrag)),this.cancel(t)),wheel:t=>(u(t),this.cancel(t,!0)),mousedrag:t=>{t.buttons&&u(t)},mousemove:t=>{t.buttons||u(t)}};this.register(this.coreMouseService.onProtocolChange((t=>{t?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(t)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&t?f.mousemove||(d.addEventListener("mousemove",p.mousemove),f.mousemove=p.mousemove):(d.removeEventListener("mousemove",f.mousemove),f.mousemove=null),16&t?f.wheel||(d.addEventListener("wheel",p.wheel,{passive:!1}),f.wheel=p.wheel):(d.removeEventListener("wheel",f.wheel),f.wheel=null),2&t?f.mouseup||(f.mouseup=p.mouseup):(this._document.removeEventListener("mouseup",f.mouseup),f.mouseup=null),4&t?f.mousedrag||(f.mousedrag=p.mousedrag):(this._document.removeEventListener("mousemove",f.mousedrag),f.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,y.addDisposableDomListener)(d,"mousedown",(t=>{if(t.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(t))return u(t),f.mouseup&&this._document.addEventListener("mouseup",f.mouseup),f.mousedrag&&this._document.addEventListener("mousemove",f.mousedrag),this.cancel(t)}))),this.register((0,y.addDisposableDomListener)(d,"wheel",(t=>{if(!f.wheel){if(!this.buffer.hasScrollback){const d=this.viewport.getLinesScrolled(t);if(0===d)return;const u=g.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(t.deltaY<0?"A":"B");let f="";for(let t=0;t<Math.abs(d);t++)f+=u;return this.coreService.triggerDataEvent(f,!0),this.cancel(t,!0)}return this.viewport.handleWheel(t)?this.cancel(t):void 0}}),{passive:!1})),this.register((0,y.addDisposableDomListener)(d,"touchstart",(t=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(t),this.cancel(t)}),{passive:!0})),this.register((0,y.addDisposableDomListener)(d,"touchmove",(t=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(t)?void 0:this.cancel(t)}),{passive:!1}))}refresh(t,d){var u;null===(u=this._renderService)||void 0===u||u.refreshRows(t,d)}updateCursorStyle(t){var d;(null===(d=this._selectionService)||void 0===d?void 0:d.shouldColumnSelect(t))?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(t,d,u=0){super.scrollLines(t,d,u),this.refresh(0,this.rows-1)}paste(t){(0,v.paste)(t,this.textarea,this.coreService)}attachCustomKeyEventHandler(t){this._customKeyEventHandler=t}registerLinkProvider(t){return this.linkifier2.registerLinkProvider(t)}registerCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const d=this._characterJoinerService.register(t);return this.refresh(0,this.rows-1),d}deregisterCharacterJoiner(t){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(t)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}addMarker(t){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+t)}registerDecoration(t){return this._decorationService.registerDecoration(t)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(t,d,u){this._selectionService.setSelection(t,d,u)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var t;null===(t=this._selectionService)||void 0===t||t.clearSelection()}selectAll(){var t;null===(t=this._selectionService)||void 0===t||t.selectAll()}selectLines(t,d){var u;null===(u=this._selectionService)||void 0===u||u.selectLines(t,d)}_keyDown(t){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;const d=this.browser.isMac&&this.options.macOptionIsMeta&&t.altKey;if(!d&&!this._compositionHelper.keydown(t))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this._bufferService.scrollToBottom(),!1;d||"Dead"!==t.key&&"AltGraph"!==t.key||(this._unprocessedDeadKey=!0);const u=(0,j.evaluateKeyboardEvent)(t,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(t),3===u.type||2===u.type){const d=this.rows-1;return this.scrollLines(2===u.type?-d:d),this.cancel(t,!0)}return 1===u.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,t)||(u.cancel&&this.cancel(t,!0),!u.key||!!(t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&1===t.key.length&&t.key.charCodeAt(0)>=65&&t.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(u.key!==g.C0.ETX&&u.key!==g.C0.CR||(this.textarea.value=""),this._onKey.fire({key:u.key,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(u.key,!0),!this.optionsService.rawOptions.screenReaderMode||t.altKey||t.ctrlKey?this.cancel(t,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(t,d){const u=t.isMac&&!this.options.macOptionIsMeta&&d.altKey&&!d.ctrlKey&&!d.metaKey||t.isWindows&&d.altKey&&d.ctrlKey&&!d.metaKey||t.isWindows&&d.getModifierState("AltGraph");return"keypress"===d.type?u:u&&(!d.keyCode||d.keyCode>47)}_keyUp(t){this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(t)||(function(t){return 16===t.keyCode||17===t.keyCode||18===t.keyCode}(t)||this.focus(),this.updateCursorStyle(t),this._keyPressHandled=!1)}_keyPress(t){let d;if(this._keyPressHandled=!1,this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;if(this.cancel(t),t.charCode)d=t.charCode;else if(null===t.which||void 0===t.which)d=t.keyCode;else{if(0===t.which||0===t.charCode)return!1;d=t.which}return!(!d||(t.altKey||t.ctrlKey||t.metaKey)&&!this._isThirdLevelShift(this.browser,t)||(d=String.fromCharCode(d),this._onKey.fire({key:d,domEvent:t}),this._showCursor(),this.coreService.triggerDataEvent(d,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(t){if(t.data&&"insertText"===t.inputType&&(!t.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const d=t.data;return this.coreService.triggerDataEvent(d,!0),this.cancel(t),!0}return!1}resize(t,d){t!==this.cols||d!==this.rows?super.resize(t,d):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(t,d){var u,f;null===(u=this._charSizeService)||void 0===u||u.measure(),null===(f=this.viewport)||void 0===f||f.syncScrollArea(!0)}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let t=1;t<this.rows;t++)this.buffer.lines.push(this.buffer.getBlankLine(T.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire({position:this.buffer.ydisp,source:0})}}reset(){var t,d;this.options.rows=this.rows,this.options.cols=this.cols;const u=this._customKeyEventHandler;this._setup(),super.reset(),null===(t=this._selectionService)||void 0===t||t.reset(),this._decorationService.reset(),this._customKeyEventHandler=u,this.refresh(0,this.rows-1),null===(d=this.viewport)||void 0===d||d.syncScrollArea()}clearTextureAtlas(){var t;null===(t=this._renderService)||void 0===t||t.clearTextureAtlas()}_reportFocus(){var t;(null===(t=this.element)||void 0===t?void 0:t.classList.contains("focus"))?this.coreService.triggerDataEvent(g.C0.ESC+"[I"):this.coreService.triggerDataEvent(g.C0.ESC+"[O")}_reportWindowsOptions(t){if(this._renderService)switch(t){case b.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const t=this._renderService.dimensions.css.canvas.width.toFixed(0),d=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${g.C0.ESC}[4;${d};${t}t`);break;case b.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const u=this._renderService.dimensions.css.cell.width.toFixed(0),f=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${g.C0.ESC}[6;${f};${u}t`)}}cancel(t,d){if(this.options.cancelEvents||d)return t.preventDefault(),t.stopPropagation(),!1}}d.Terminal=I},9924:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.TimeBasedDebouncer=void 0,d.TimeBasedDebouncer=class{constructor(t,d=1e3){this._renderCallback=t,this._debounceThresholdMS=d,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(t,d,u){this._rowCount=u,t=void 0!==t?t:0,d=void 0!==d?d:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,t):t,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,d):d;const f=Date.now();if(f-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=f,this._innerRefresh();else if(!this._additionalRefreshRequested){const t=f-this._lastRefreshMs,d=this._debounceThresholdMS-t;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),d)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;const t=Math.max(this._rowStart,0),d=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(t,d)}}},1680:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.Viewport=void 0;const v=u(844),g=u(3656),b=u(4725),S=u(2585);let C=class extends v.Disposable{constructor(t,d,u,f,p,v,b,S,C){super(),this._scrollLines=t,this._viewportElement=d,this._scrollArea=u,this._bufferService=f,this._optionsService=p,this._charSizeService=v,this._renderService=b,this._coreBrowserService=S,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,g.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((t=>this._activeBuffer=t.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((t=>this._renderDimensions=t))),this._handleThemeChange(C.colors),this.register(C.onChangeColors((t=>this._handleThemeChange(t)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()),0)}_handleThemeChange(t){this._viewportElement.style.backgroundColor=t.background.css}_refresh(t){if(t)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const t=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==t&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=t),this._refreshAnimationFrame=null}syncScrollArea(t=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(t);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(t)}_handleScroll(t){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._scrollLines(0);const d=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(d)}_smoothScroll(){if(this._isDisposed||-1===this._smoothScrollState.origin||-1===this._smoothScrollState.target)return;const t=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(t*(this._smoothScrollState.target-this._smoothScrollState.origin)),t<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(t,d){const u=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(d<0&&0!==this._viewportElement.scrollTop||d>0&&u<this._lastRecordedBufferHeight)||(t.cancelable&&t.preventDefault(),!1)}handleWheel(t){const d=this._getPixelsScrolled(t);return 0!==d&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,-1===this._smoothScrollState.target?this._smoothScrollState.target=this._viewportElement.scrollTop+d:this._smoothScrollState.target+=d,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=d,this._bubbleScroll(t,d))}_getPixelsScrolled(t){if(0===t.deltaY||t.shiftKey)return 0;let d=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_LINE?d*=this._currentRowHeight:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._currentRowHeight*this._bufferService.rows),d}getLinesScrolled(t){if(0===t.deltaY||t.shiftKey)return 0;let d=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(d/=this._currentRowHeight+0,this._wheelPartialScroll+=d,d=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._bufferService.rows),d}_applyScrollModifier(t,d){const u=this._optionsService.rawOptions.fastScrollModifier;return"alt"===u&&d.altKey||"ctrl"===u&&d.ctrlKey||"shift"===u&&d.shiftKey?t*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:t*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(t){this._lastTouchY=t.touches[0].pageY}handleTouchMove(t){const d=this._lastTouchY-t.touches[0].pageY;return this._lastTouchY=t.touches[0].pageY,0!==d&&(this._viewportElement.scrollTop+=d,this._bubbleScroll(t,d))}};C=f([p(3,S.IBufferService),p(4,S.IOptionsService),p(5,b.ICharSizeService),p(6,b.IRenderService),p(7,b.ICoreBrowserService),p(8,b.IThemeService)],C),d.Viewport=C},3107:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.BufferDecorationRenderer=void 0;const v=u(3656),g=u(4725),b=u(844),S=u(2585);let C=class extends b.Disposable{constructor(t,d,u,f){super(),this._screenElement=t,this._bufferService=d,this._decorationService=u,this._renderService=f,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register((0,v.addDisposableDomListener)(window,"resize",(()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((t=>this._removeDecoration(t)))),this.register((0,b.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(const t of this._decorationService.decorations)this._renderDecoration(t);this._dimensionsChanged=!1}_renderDecoration(t){this._refreshStyle(t),this._dimensionsChanged&&this._refreshXPosition(t)}_createElement(t){var d;const u=document.createElement("div");u.classList.add("xterm-decoration"),u.style.width=`${Math.round((t.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,u.style.height=(t.options.height||1)*this._renderService.dimensions.css.cell.height+"px",u.style.top=(t.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",u.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const f=null!==(d=t.options.x)&&void 0!==d?d:0;return f&&f>this._bufferService.cols&&(u.style.display="none"),this._refreshXPosition(t,u),u}_refreshStyle(t){const d=t.marker.line-this._bufferService.buffers.active.ydisp;if(d<0||d>=this._bufferService.rows)t.element&&(t.element.style.display="none",t.onRenderEmitter.fire(t.element));else{let u=this._decorationElements.get(t);u||(u=this._createElement(t),t.element=u,this._decorationElements.set(t,u),this._container.appendChild(u)),u.style.top=d*this._renderService.dimensions.css.cell.height+"px",u.style.display=this._altBufferIsActive?"none":"block",t.onRenderEmitter.fire(u)}}_refreshXPosition(t,d=t.element){var u;if(!d)return;const f=null!==(u=t.options.x)&&void 0!==u?u:0;"right"===(t.options.anchor||"left")?d.style.right=f?f*this._renderService.dimensions.css.cell.width+"px":"":d.style.left=f?f*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(t){var d;null===(d=this._decorationElements.get(t))||void 0===d||d.remove(),this._decorationElements.delete(t),t.dispose()}};C=f([p(1,S.IBufferService),p(2,S.IDecorationService),p(3,g.IRenderService)],C),d.BufferDecorationRenderer=C},5871:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ColorZoneStore=void 0,d.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(t){if(t.options.overviewRulerOptions){for(const d of this._zones)if(d.color===t.options.overviewRulerOptions.color&&d.position===t.options.overviewRulerOptions.position){if(this._lineIntersectsZone(d,t.marker.line))return;if(this._lineAdjacentToZone(d,t.marker.line,t.options.overviewRulerOptions.position))return void this._addLineToZone(d,t.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=t.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=t.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=t.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=t.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:t.options.overviewRulerOptions.color,position:t.options.overviewRulerOptions.position,startBufferLine:t.marker.line,endBufferLine:t.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(t){this._linePadding=t}_lineIntersectsZone(t,d){return d>=t.startBufferLine&&d<=t.endBufferLine}_lineAdjacentToZone(t,d,u){return d>=t.startBufferLine-this._linePadding[u||"full"]&&d<=t.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(t,d){t.startBufferLine=Math.min(t.startBufferLine,d),t.endBufferLine=Math.max(t.endBufferLine,d)}}},5744:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.OverviewRulerRenderer=void 0;const v=u(5871),g=u(3656),b=u(4725),S=u(844),C=u(2585),y={full:0,left:0,center:0,right:0},w={full:0,left:0,center:0,right:0},x={full:0,left:0,center:0,right:0};let O=class extends S.Disposable{constructor(t,d,u,f,p,g,b){var C;super(),this._viewportElement=t,this._screenElement=d,this._bufferService=u,this._decorationService=f,this._renderService=p,this._optionsService=g,this._coreBrowseService=b,this._colorZoneStore=new v.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),null===(C=this._viewportElement.parentElement)||void 0===C||C.insertBefore(this._canvas,this._viewportElement);const y=this._canvas.getContext("2d");if(!y)throw new Error("Ctx cannot be null");this._ctx=y,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,S.toDisposable)((()=>{var t;null===(t=this._canvas)||void 0===t||t.remove()})))}get _width(){return this._optionsService.options.overviewRulerWidth||0}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register((0,g.addDisposableDomListener)(this._coreBrowseService.window,"resize",(()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){const t=Math.floor(this._canvas.width/3),d=Math.ceil(this._canvas.width/3);w.full=this._canvas.width,w.left=t,w.center=d,w.right=t,this._refreshDrawHeightConstants(),x.full=0,x.left=0,x.center=w.left,x.right=w.left+w.center}_refreshDrawHeightConstants(){y.full=Math.round(2*this._coreBrowseService.dpr);const t=this._canvas.height/this._bufferService.buffer.lines.length,d=Math.round(Math.max(Math.min(t,12),6)*this._coreBrowseService.dpr);y.left=d,y.center=d,y.right=d}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*y.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const t of this._decorationService.decorations)this._colorZoneStore.addDecoration(t);this._ctx.lineWidth=1;const t=this._colorZoneStore.zones;for(const d of t)"full"!==d.position&&this._renderColorZone(d);for(const d of t)"full"===d.position&&this._renderColorZone(d);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(t){this._ctx.fillStyle=t.color,this._ctx.fillRect(x[t.position||"full"],Math.round((this._canvas.height-1)*(t.startBufferLine/this._bufferService.buffers.active.lines.length)-y[t.position||"full"]/2),w[t.position||"full"],Math.round((this._canvas.height-1)*((t.endBufferLine-t.startBufferLine)/this._bufferService.buffers.active.lines.length)+y[t.position||"full"]))}_queueRefresh(t,d){this._shouldUpdateDimensions=t||this._shouldUpdateDimensions,this._shouldUpdateAnchor=d||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};O=f([p(2,C.IBufferService),p(3,C.IDecorationService),p(4,b.IRenderService),p(5,C.IOptionsService),p(6,b.ICoreBrowserService)],O),d.OverviewRulerRenderer=O},2950:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.CompositionHelper=void 0;const v=u(4725),g=u(2585),b=u(2584);let S=class{constructor(t,d,u,f,p,v){this._textarea=t,this._compositionView=d,this._bufferService=u,this._optionsService=f,this._coreService=p,this._renderService=v,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(t){this._compositionView.textContent=t.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(t){if(this._isComposing||this._isSendingComposition){if(229===t.keyCode)return!1;if(16===t.keyCode||17===t.keyCode||18===t.keyCode)return!1;this._finalizeComposition(!1)}return 229!==t.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(t){if(this._compositionView.classList.remove("active"),this._isComposing=!1,t){const t={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let d;this._isSendingComposition=!1,t.start+=this._dataAlreadySent.length,d=this._isComposing?this._textarea.value.substring(t.start,t.end):this._textarea.value.substring(t.start),d.length>0&&this._coreService.triggerDataEvent(d,!0)}}),0)}else{this._isSendingComposition=!1;const t=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(t,!0)}}_handleAnyTextareaChanges(){const t=this._textarea.value;setTimeout((()=>{if(!this._isComposing){const d=this._textarea.value,u=d.replace(t,"");this._dataAlreadySent=u,d.length>t.length?this._coreService.triggerDataEvent(u,!0):d.length<t.length?this._coreService.triggerDataEvent(`${b.C0.DEL}`,!0):d.length===t.length&&d!==t&&this._coreService.triggerDataEvent(d,!0)}}),0)}updateCompositionElements(t){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const t=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),d=this._renderService.dimensions.css.cell.height,u=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,f=t*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=f+"px",this._compositionView.style.top=u+"px",this._compositionView.style.height=d+"px",this._compositionView.style.lineHeight=d+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const p=this._compositionView.getBoundingClientRect();this._textarea.style.left=f+"px",this._textarea.style.top=u+"px",this._textarea.style.width=Math.max(p.width,1)+"px",this._textarea.style.height=Math.max(p.height,1)+"px",this._textarea.style.lineHeight=p.height+"px"}t||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};S=f([p(2,g.IBufferService),p(3,g.IOptionsService),p(4,g.ICoreService),p(5,v.IRenderService)],S),d.CompositionHelper=S},9806:(t,d)=>{function u(t,d,u){const f=u.getBoundingClientRect(),p=t.getComputedStyle(u),v=parseInt(p.getPropertyValue("padding-left")),g=parseInt(p.getPropertyValue("padding-top"));return[d.clientX-f.left-v,d.clientY-f.top-g]}Object.defineProperty(d,"__esModule",{value:!0}),d.getCoords=d.getCoordsRelativeToElement=void 0,d.getCoordsRelativeToElement=u,d.getCoords=function(t,d,f,p,v,g,b,S,C){if(!g)return;const y=u(t,d,f);return y?(y[0]=Math.ceil((y[0]+(C?b/2:0))/b),y[1]=Math.ceil(y[1]/S),y[0]=Math.min(Math.max(y[0],1),p+(C?1:0)),y[1]=Math.min(Math.max(y[1],1),v),y):void 0}},9504:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.moveToCellSequence=void 0;const f=u(2584);function p(t,d,u,f){const p=t-v(t,u),b=d-v(d,u),y=Math.abs(p-b)-function(t,d,u){let f=0;const p=t-v(t,u),b=d-v(d,u);for(let v=0;v<Math.abs(p-b);v++){const b="A"===g(t,d)?-1:1,S=u.buffer.lines.get(p+b*v);(null==S?void 0:S.isWrapped)&&f++}return f}(t,d,u);return C(y,S(g(t,d),f))}function v(t,d){let u=0,f=d.buffer.lines.get(t),p=null==f?void 0:f.isWrapped;for(;p&&t>=0&&t<d.rows;)u++,f=d.buffer.lines.get(--t),p=null==f?void 0:f.isWrapped;return u}function g(t,d){return t>d?"A":"B"}function b(t,d,u,f,p,v){let g=t,b=d,S="";for(;g!==u||b!==f;)g+=p?1:-1,p&&g>v.cols-1?(S+=v.buffer.translateBufferLineToString(b,!1,t,g),g=0,t=0,b++):!p&&g<0&&(S+=v.buffer.translateBufferLineToString(b,!1,0,t+1),g=v.cols-1,t=g,b--);return S+v.buffer.translateBufferLineToString(b,!1,t,g)}function S(t,d){const u=d?"O":"[";return f.C0.ESC+u+t}function C(t,d){t=Math.floor(t);let u="";for(let f=0;f<t;f++)u+=d;return u}d.moveToCellSequence=function(t,d,u,f){const g=u.buffer.x,y=u.buffer.y;if(!u.buffer.hasScrollback)return function(t,d,u,f,g,y){return 0===p(d,f,g,y).length?"":C(b(t,d,t,d-v(d,g),!1,g).length,S("D",y))}(g,y,0,d,u,f)+p(y,d,u,f)+function(t,d,u,f,g,y){let w;w=p(d,f,g,y).length>0?f-v(f,g):d;const x=f,O=function(t,d,u,f,g,b){let S;return S=p(u,f,g,b).length>0?f-v(f,g):d,t<u&&S<=f||t>=u&&S<f?"C":"D"}(t,d,u,f,g,y);return C(b(t,w,u,x,"C"===O,g).length,S(O,y))}(g,y,t,d,u,f);let w;if(y===d)return w=g>t?"D":"C",C(Math.abs(g-t),S(w,f));w=y>d?"D":"C";const x=Math.abs(y-d);return C(function(t,d){return d.cols-t}(y>d?t:g,u)+(x-1)*u.cols+1+((y>d?g:t)-1),S(w,f))}},1296:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.DomRenderer=void 0;const v=u(9631),g=u(3787),b=u(2223),S=u(6171),C=u(4725),y=u(8055),w=u(8460),x=u(844),O=u(2585),j="xterm-dom-renderer-owner-",k="xterm-focus";let T=1,L=class extends x.Disposable{constructor(t,d,u,f,p,b,C,y,O,k){super(),this._element=t,this._screenElement=d,this._viewportElement=u,this._linkifier2=f,this._charSizeService=b,this._optionsService=C,this._bufferService=y,this._coreBrowserService=O,this._terminalClass=T++,this._rowElements=[],this._cellToRowElements=[],this.onRequestRedraw=this.register(new w.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add("xterm-rows"),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add("xterm-selection"),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,S.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(k.onChangeColors((t=>this._injectCss(t)))),this._injectCss(k.colors),this._rowFactory=p.createInstance(g.DomRendererRowFactory,document),this._element.classList.add(j+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((t=>this._handleLinkHover(t)))),this.register(this._linkifier2.onHideLinkUnderline((t=>this._handleLinkLeave(t)))),this.register((0,x.toDisposable)((()=>{this._element.classList.remove(j+this._terminalClass),(0,v.removeElementFromParent)(this._rowContainer,this._selectionContainer,this._themeStyleElement,this._dimensionsStyleElement)})))}_updateDimensions(){const t=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*t,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*t),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/t),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/t),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const t of this._rowElements)t.style.width=`${this.dimensions.css.canvas.width}px`,t.style.height=`${this.dimensions.css.cell.height}px`,t.style.lineHeight=`${this.dimensions.css.cell.height}px`,t.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const d=`${this._terminalSelector} .xterm-rows span { display: inline-block; height: 100%; vertical-align: top; width: ${this.dimensions.css.cell.width}px}`;this._dimensionsStyleElement.textContent=d,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(t){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let d=`${this._terminalSelector} .xterm-rows { color: ${t.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px;}`;d+=`${this._terminalSelector} span:not(.${g.BOLD_CLASS}) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.${g.BOLD_CLASS} { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.${g.ITALIC_CLASS} { font-style: italic;}`,d+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  box-shadow: none; }}",d+="@keyframes blink_block_"+this._terminalClass+" { 0% {"+`  background-color: ${t.cursor.css};`+`  color: ${t.cursorAccent.css}; } 50% {`+`  background-color: ${t.cursorAccent.css};`+`  color: ${t.cursor.css}; }}`,d+=`${this._terminalSelector} .xterm-rows:not(.xterm-focus) .${g.CURSOR_CLASS}.${g.CURSOR_STYLE_BLOCK_CLASS} { outline: 1px solid ${t.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .xterm-rows.xterm-focus .${g.CURSOR_CLASS}.${g.CURSOR_BLINK_CLASS}:not(.${g.CURSOR_STYLE_BLOCK_CLASS}) { animation: blink_box_shadow_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${g.CURSOR_CLASS}.${g.CURSOR_BLINK_CLASS}.${g.CURSOR_STYLE_BLOCK_CLASS} { animation: blink_block_`+this._terminalClass+" 1s step-end infinite;}"+`${this._terminalSelector} .xterm-rows.xterm-focus .${g.CURSOR_CLASS}.${g.CURSOR_STYLE_BLOCK_CLASS} {`+` background-color: ${t.cursor.css};`+` color: ${t.cursorAccent.css};}`+`${this._terminalSelector} .xterm-rows .${g.CURSOR_CLASS}.${g.CURSOR_STYLE_BAR_CLASS} {`+` box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${t.cursor.css} inset;}`+`${this._terminalSelector} .xterm-rows .${g.CURSOR_CLASS}.${g.CURSOR_STYLE_UNDERLINE_CLASS} {`+` box-shadow: 0 -1px 0 ${t.cursor.css} inset;}`,d+=`${this._terminalSelector} .xterm-selection { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .xterm-selection div { position: absolute; background-color: ${t.selectionBackgroundOpaque.css};}${this._terminalSelector} .xterm-selection div { position: absolute; background-color: ${t.selectionInactiveBackgroundOpaque.css};}`;for(const[u,f]of t.ansi.entries())d+=`${this._terminalSelector} .xterm-fg-${u} { color: ${f.css}; }${this._terminalSelector} .xterm-bg-${u} { background-color: ${f.css}; }`;d+=`${this._terminalSelector} .xterm-fg-${b.INVERTED_DEFAULT_COLOR} { color: ${y.color.opaque(t.background).css}; }${this._terminalSelector} .xterm-bg-${b.INVERTED_DEFAULT_COLOR} { background-color: ${t.foreground.css}; }`,this._themeStyleElement.textContent=d}handleDevicePixelRatioChange(){this._updateDimensions()}_refreshRowElements(t,d){for(let t=this._rowElements.length;t<=d;t++){const t=document.createElement("div");this._rowContainer.appendChild(t),this._rowElements.push(t)}for(;this._rowElements.length>d;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(t,d){this._refreshRowElements(t,d),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions()}handleBlur(){this._rowContainer.classList.remove(k)}handleFocus(){this._rowContainer.classList.add(k)}handleSelectionChanged(t,d,u){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(this._rowFactory.handleSelectionChanged(t,d,u),this.renderRows(0,this._bufferService.rows-1),!t||!d)return;const f=t[1]-this._bufferService.buffer.ydisp,p=d[1]-this._bufferService.buffer.ydisp,v=Math.max(f,0),g=Math.min(p,this._bufferService.rows-1);if(v>=this._bufferService.rows||g<0)return;const b=document.createDocumentFragment();if(u){const u=t[0]>d[0];b.appendChild(this._createSelectionElement(v,u?d[0]:t[0],u?t[0]:d[0],g-v+1))}else{const u=f===v?t[0]:0,S=v===p?d[0]:this._bufferService.cols;b.appendChild(this._createSelectionElement(v,u,S));const C=g-v-1;if(b.appendChild(this._createSelectionElement(v+1,0,this._bufferService.cols,C)),v!==g){const t=p===g?d[0]:this._bufferService.cols;b.appendChild(this._createSelectionElement(g,0,t))}}this._selectionContainer.appendChild(b)}_createSelectionElement(t,d,u,f=1){const p=document.createElement("div");return p.style.height=f*this.dimensions.css.cell.height+"px",p.style.top=t*this.dimensions.css.cell.height+"px",p.style.left=d*this.dimensions.css.cell.width+"px",p.style.width=this.dimensions.css.cell.width*(u-d)+"px",p}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions()}clear(){for(const t of this._rowElements)t.replaceChildren()}renderRows(t,d){const u=this._bufferService.buffer.ybase+this._bufferService.buffer.y,f=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),p=this._optionsService.rawOptions.cursorBlink;for(let v=t;v<=d;v++){const t=this._rowElements[v],d=v+this._bufferService.buffer.ydisp,g=this._bufferService.buffer.lines.get(d),b=this._optionsService.rawOptions.cursorStyle;this._cellToRowElements[v]&&this._cellToRowElements[v].length===this._bufferService.cols||(this._cellToRowElements[v]=new Int16Array(this._bufferService.cols)),t.replaceChildren(this._rowFactory.createRow(g,d,d===u,b,f,p,this.dimensions.css.cell.width,this._bufferService.cols,this._cellToRowElements[v]))}}get _terminalSelector(){return`.${j}${this._terminalClass}`}_handleLinkHover(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!0)}_handleLinkLeave(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!1)}_setCellUnderline(t,d,u,f,p,v){if(t=this._cellToRowElements[u][t],d=this._cellToRowElements[f][d],-1!==t&&-1!==d)for(;t!==d||u!==f;){const d=this._rowElements[u];if(!d)return;const f=d.children[t];f&&(f.style.textDecoration=v?"underline":"none"),++t>=p&&(t=0,u++)}}};L=f([p(4,O.IInstantiationService),p(5,C.ICharSizeService),p(6,O.IOptionsService),p(7,O.IBufferService),p(8,C.ICoreBrowserService),p(9,C.IThemeService)],L),d.DomRenderer=L},3787:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.DomRendererRowFactory=d.CURSOR_STYLE_UNDERLINE_CLASS=d.CURSOR_STYLE_BAR_CLASS=d.CURSOR_STYLE_BLOCK_CLASS=d.CURSOR_BLINK_CLASS=d.CURSOR_CLASS=d.STRIKETHROUGH_CLASS=d.UNDERLINE_CLASS=d.ITALIC_CLASS=d.DIM_CLASS=d.BOLD_CLASS=void 0;const v=u(2223),g=u(643),b=u(511),S=u(2585),C=u(8055),y=u(4725),w=u(4269),x=u(6171),O=u(3734);d.BOLD_CLASS="xterm-bold",d.DIM_CLASS="xterm-dim",d.ITALIC_CLASS="xterm-italic",d.UNDERLINE_CLASS="xterm-underline",d.STRIKETHROUGH_CLASS="xterm-strikethrough",d.CURSOR_CLASS="xterm-cursor",d.CURSOR_BLINK_CLASS="xterm-cursor-blink",d.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",d.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",d.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";let j=class{constructor(t,d,u,f,p,v,g){this._document=t,this._characterJoinerService=d,this._optionsService=u,this._coreBrowserService=f,this._coreService=p,this._decorationService=v,this._themeService=g,this._workCell=new b.CellData,this._columnSelectMode=!1}handleSelectionChanged(t,d,u){this._selectionStart=t,this._selectionEnd=d,this._columnSelectMode=u}createRow(t,u,f,p,b,S,y,x,j){const T=this._document.createDocumentFragment(),L=this._characterJoinerService.getJoinedCharacters(u);let R=0;for(let d=Math.min(t.length,x)-1;d>=0;d--)if(t.loadCell(d,this._workCell).getCode()!==g.NULL_CELL_CODE||f&&d===b){R=d+1;break}const A=this._themeService.colors;let D=-1,M=0;for(;M<R;M++){t.loadCell(M,this._workCell);let x=this._workCell.getWidth();if(0===x){j[M]=D;continue}let R=!1,B=M,P=this._workCell;if(L.length>0&&M===L[0][0]){R=!0;const d=L.shift();P=new w.JoinedCellData(this._workCell,t.translateToString(!0,d[0],d[1]),d[1]-d[0]),B=d[1]-1,x=P.getWidth()}const H=this._document.createElement("span");if(x>1&&(H.style.width=y*x+"px"),R&&(H.style.display="inline",b>=M&&b<=B&&(b=M)),!this._coreService.isCursorHidden&&f&&M===b)switch(H.classList.add(d.CURSOR_CLASS),S&&H.classList.add(d.CURSOR_BLINK_CLASS),p){case"bar":H.classList.add(d.CURSOR_STYLE_BAR_CLASS);break;case"underline":H.classList.add(d.CURSOR_STYLE_UNDERLINE_CLASS);break;default:H.classList.add(d.CURSOR_STYLE_BLOCK_CLASS)}if(P.isBold()&&H.classList.add(d.BOLD_CLASS),P.isItalic()&&H.classList.add(d.ITALIC_CLASS),P.isDim()&&H.classList.add(d.DIM_CLASS),P.isInvisible()?H.textContent=g.WHITESPACE_CELL_CHAR:H.textContent=P.getChars()||g.WHITESPACE_CELL_CHAR,P.isUnderline()&&(H.classList.add(`${d.UNDERLINE_CLASS}-${P.extended.underlineStyle}`)," "===H.textContent&&(H.textContent=" "),!P.isUnderlineColorDefault()))if(P.isUnderlineColorRGB())H.style.textDecorationColor=`rgb(${O.AttributeData.toColorRGB(P.getUnderlineColor()).join(",")})`;else{let t=P.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&P.isBold()&&t<8&&(t+=8),H.style.textDecorationColor=A.ansi[t].css}P.isStrikethrough()&&H.classList.add(d.STRIKETHROUGH_CLASS);let F=P.getFgColor(),$=P.getFgColorMode(),z=P.getBgColor(),N=P.getBgColorMode();const V=!!P.isInverse();if(V){const t=F;F=z,z=t;const d=$;$=N,N=d}let W,U,K=!1;this._decorationService.forEachDecorationAtCell(M,u,void 0,(t=>{"top"!==t.options.layer&&K||(t.backgroundColorRGB&&(N=50331648,z=t.backgroundColorRGB.rgba>>8&16777215,W=t.backgroundColorRGB),t.foregroundColorRGB&&($=50331648,F=t.foregroundColorRGB.rgba>>8&16777215,U=t.foregroundColorRGB),K="top"===t.options.layer)}));const q=this._isCellInSelection(M,u);let G;switch(K||A.selectionForeground&&q&&($=50331648,F=A.selectionForeground.rgba>>8&16777215,U=A.selectionForeground),q&&(W=this._coreBrowserService.isFocused?A.selectionBackgroundOpaque:A.selectionInactiveBackgroundOpaque,K=!0),K&&H.classList.add("xterm-decoration-top"),N){case 16777216:case 33554432:G=A.ansi[z],H.classList.add(`xterm-bg-${z}`);break;case 50331648:G=C.rgba.toColor(z>>16,z>>8&255,255&z),this._addStyle(H,`background-color:#${k((z>>>0).toString(16),"0",6)}`);break;default:V?(G=A.foreground,H.classList.add(`xterm-bg-${v.INVERTED_DEFAULT_COLOR}`)):G=A.background}switch(W||P.isDim()&&(W=C.color.multiplyOpacity(G,.5)),$){case 16777216:case 33554432:P.isBold()&&F<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(F+=8),this._applyMinimumContrast(H,G,A.ansi[F],P,W,void 0)||H.classList.add(`xterm-fg-${F}`);break;case 50331648:const t=C.rgba.toColor(F>>16&255,F>>8&255,255&F);this._applyMinimumContrast(H,G,t,P,W,U)||this._addStyle(H,`color:#${k(F.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(H,G,A.foreground,P,W,void 0)||V&&H.classList.add(`xterm-fg-${v.INVERTED_DEFAULT_COLOR}`)}T.appendChild(H),j[M]=++D,M=B}return M<x-1&&j.subarray(M).fill(++D),T}_applyMinimumContrast(t,d,u,f,p,v){if(1===this._optionsService.rawOptions.minimumContrastRatio||(0,x.excludeFromContrastRatioDemands)(f.getCode()))return!1;let g;return p||v||(g=this._themeService.colors.contrastCache.getColor(d.rgba,u.rgba)),void 0===g&&(g=C.color.ensureContrastRatio(p||d,v||u,this._optionsService.rawOptions.minimumContrastRatio),this._themeService.colors.contrastCache.setColor((p||d).rgba,(v||u).rgba,null!=g?g:null)),!!g&&(this._addStyle(t,`color:${g.css}`),!0)}_addStyle(t,d){t.setAttribute("style",`${t.getAttribute("style")||""}${d};`)}_isCellInSelection(t,d){const u=this._selectionStart,f=this._selectionEnd;return!(!u||!f)&&(this._columnSelectMode?u[0]<=f[0]?t>=u[0]&&d>=u[1]&&t<f[0]&&d<=f[1]:t<u[0]&&d>=u[1]&&t>=f[0]&&d<=f[1]:d>u[1]&&d<f[1]||u[1]===f[1]&&d===u[1]&&t>=u[0]&&t<f[0]||u[1]<f[1]&&d===f[1]&&t<f[0]||u[1]<f[1]&&d===u[1]&&t>=u[0])}};function k(t,d,u){for(;t.length<u;)t=d+t;return t}j=f([p(1,y.ICharacterJoinerService),p(2,S.IOptionsService),p(3,y.ICoreBrowserService),p(4,S.ICoreService),p(5,S.IDecorationService),p(6,y.IThemeService)],j),d.DomRendererRowFactory=j},2223:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.TEXT_BASELINE=d.DIM_OPACITY=d.INVERTED_DEFAULT_COLOR=void 0;const f=u(6114);d.INVERTED_DEFAULT_COLOR=257,d.DIM_OPACITY=.5,d.TEXT_BASELINE=f.isFirefox||f.isLegacyEdge?"bottom":"ideographic"},6171:(t,d)=>{function u(t){return 57508<=t&&t<=57558}Object.defineProperty(d,"__esModule",{value:!0}),d.createRenderDimensions=d.excludeFromContrastRatioDemands=d.isRestrictedPowerlineGlyph=d.isPowerlineGlyph=d.throwIfFalsy=void 0,d.throwIfFalsy=function(t){if(!t)throw new Error("value must not be falsy");return t},d.isPowerlineGlyph=u,d.isRestrictedPowerlineGlyph=function(t){return 57520<=t&&t<=57527},d.excludeFromContrastRatioDemands=function(t){return u(t)||function(t){return 9472<=t&&t<=9631}(t)},d.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.SelectionModel=void 0,d.SelectionModel=class{constructor(t){this._bufferService=t,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?t%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)-1]:[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[t,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[Math.max(t,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const t=this.selectionStart,d=this.selectionEnd;return!(!t||!d)&&(t[1]>d[1]||t[1]===d[1]&&t[0]>d[0])}handleTrim(t){return this.selectionStart&&(this.selectionStart[1]-=t),this.selectionEnd&&(this.selectionEnd[1]-=t),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.CharSizeService=void 0;const v=u(2585),g=u(8460),b=u(844);let S=class extends b.Disposable{constructor(t,d,u){super(),this._optionsService=u,this.width=0,this.height=0,this._onCharSizeChange=this.register(new g.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new c(t,d,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}get hasValidSize(){return this.width>0&&this.height>0}measure(){const t=this._measureStrategy.measure();t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._onCharSizeChange.fire())}};S=f([p(2,v.IOptionsService)],S),d.CharSizeService=S;class c{constructor(t,d,u){this._document=t,this._parentElement=d,this._optionsService=u,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const t=this._measureElement.getBoundingClientRect();return 0!==t.width&&0!==t.height&&(this._result.width=t.width,this._result.height=Math.ceil(t.height)),this._result}}},4269:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.CharacterJoinerService=d.JoinedCellData=void 0;const v=u(3734),g=u(643),b=u(511),S=u(2585);class c extends v.AttributeData{constructor(t,d,u){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=d,this._width=u}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}d.JoinedCellData=c;let C=class e{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new b.CellData}register(t){const d={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(d),d.id}deregister(t){for(let d=0;d<this._characterJoiners.length;d++)if(this._characterJoiners[d].id===t)return this._characterJoiners.splice(d,1),!0;return!1}getJoinedCharacters(t){if(0===this._characterJoiners.length)return[];const d=this._bufferService.buffer.lines.get(t);if(!d||0===d.length)return[];const u=[],f=d.translateToString(!0);let p=0,v=0,b=0,S=d.getFg(0),C=d.getBg(0);for(let t=0;t<d.getTrimmedLength();t++)if(d.loadCell(t,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==S||this._workCell.bg!==C){if(t-p>1){const t=this._getJoinedRanges(f,b,v,d,p);for(let d=0;d<t.length;d++)u.push(t[d])}p=t,b=v,S=this._workCell.fg,C=this._workCell.bg}v+=this._workCell.getChars().length||g.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-p>1){const t=this._getJoinedRanges(f,b,v,d,p);for(let d=0;d<t.length;d++)u.push(t[d])}return u}_getJoinedRanges(t,d,u,f,p){const v=t.substring(d,u);let g=[];try{g=this._characterJoiners[0].handler(v)}catch(t){console.error(t)}for(let t=1;t<this._characterJoiners.length;t++)try{const d=this._characterJoiners[t].handler(v);for(let t=0;t<d.length;t++)e._mergeRanges(g,d[t])}catch(t){console.error(t)}return this._stringRangesToCellRanges(g,f,p),g}_stringRangesToCellRanges(t,d,u){let f=0,p=!1,v=0,b=t[f];if(b){for(let S=u;S<this._bufferService.cols;S++){const u=d.getWidth(S),C=d.getString(S).length||g.WHITESPACE_CELL_CHAR.length;if(0!==u){if(!p&&b[0]<=v&&(b[0]=S,p=!0),b[1]<=v){if(b[1]=S,b=t[++f],!b)break;b[0]<=v?(b[0]=S,p=!0):p=!1}v+=C}}b&&(b[1]=this._bufferService.cols)}}static _mergeRanges(t,d){let u=!1;for(let f=0;f<t.length;f++){const p=t[f];if(u){if(d[1]<=p[0])return t[f-1][1]=d[1],t;if(d[1]<=p[1])return t[f-1][1]=Math.max(d[1],p[1]),t.splice(f,1),t;t.splice(f,1),f--}else{if(d[1]<=p[0])return t.splice(f,0,d),t;if(d[1]<=p[1])return p[0]=Math.min(d[0],p[0]),t;d[0]<p[1]&&(p[0]=Math.min(d[0],p[0]),u=!0)}}return u?t[t.length-1][1]=d[1]:t.push(d),t}};C=f([p(0,S.IBufferService)],C),d.CharacterJoinerService=C},5114:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.CoreBrowserService=void 0,d.CoreBrowserService=class{constructor(t,d){this._textarea=t,this.window=d,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}},8934:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.MouseService=void 0;const v=u(4725),g=u(9806);let b=class{constructor(t,d){this._renderService=t,this._charSizeService=d}getCoords(t,d,u,f,p){return(0,g.getCoords)(window,t,d,u,f,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,p)}getMouseReportCoords(t,d){const u=(0,g.getCoordsRelativeToElement)(window,t,d);if(!(!this._charSizeService.hasValidSize||u[0]<0||u[1]<0||u[0]>=this._renderService.dimensions.css.canvas.width||u[1]>=this._renderService.dimensions.css.canvas.height))return{col:Math.floor(u[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(u[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(u[0]),y:Math.floor(u[1])}}};b=f([p(0,v.IRenderService),p(1,v.ICharSizeService)],b),d.MouseService=b},3230:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.RenderService=void 0;const v=u(6193),g=u(8460),b=u(844),S=u(5596),C=u(3656),y=u(2585),w=u(4725),x=u(7226);let O=class extends b.Disposable{constructor(t,d,u,f,p,b,y,w){if(super(),this._rowCount=t,this._charSizeService=f,this._pausedResizeTask=new x.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this.register({dispose:()=>{var t;return null===(t=this._renderer)||void 0===t?void 0:t.dispose()}}),this._renderDebouncer=new v.RenderDebouncer(y.window,((t,d)=>this._renderRows(t,d))),this.register(this._renderDebouncer),this._screenDprMonitor=new S.ScreenDprMonitor(y.window),this._screenDprMonitor.setListener((()=>this.handleDevicePixelRatioChange())),this.register(this._screenDprMonitor),this.register(b.onResize((()=>this._fullRefresh()))),this.register(b.buffers.onBufferActivate((()=>{var t;return null===(t=this._renderer)||void 0===t?void 0:t.clear()}))),this.register(u.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(p.onDecorationRegistered((()=>this._fullRefresh()))),this.register(p.onDecorationRemoved((()=>this._fullRefresh()))),this.register(u.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],(()=>{this.clear(),this.handleResize(b.cols,b.rows),this._fullRefresh()}))),this.register(u.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(b.buffer.y,b.buffer.y,!0)))),this.register((0,C.addDisposableDomListener)(y.window,"resize",(()=>this.handleDevicePixelRatioChange()))),this.register(w.onChangeColors((()=>this._fullRefresh()))),"IntersectionObserver"in y.window){const t=new y.window.IntersectionObserver((t=>this._handleIntersectionChange(t[t.length-1])),{threshold:0});t.observe(d),this.register({dispose:()=>t.disconnect()})}}get dimensions(){return this._renderer.dimensions}_handleIntersectionChange(t){this._isPaused=void 0===t.isIntersecting?0===t.intersectionRatio:!t.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(t,d,u=!1){this._isPaused?this._needsFullRefresh=!0:(u||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(t,d,this._rowCount))}_renderRows(t,d){this._renderer&&(this._renderer.renderRows(t,d),this._needsSelectionRefresh&&(this._renderer.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:t,end:d}),this._onRender.fire({start:t,end:d}),this._isNextRenderRedrawOnly=!0)}resize(t,d){this._rowCount=d,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer&&(this._renderer.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions))}hasRenderer(){return!!this._renderer}setRenderer(t){var d;null===(d=this._renderer)||void 0===d||d.dispose(),this._renderer=t,this._renderer.onRequestRedraw((t=>this.refreshRows(t.start,t.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(t){return this._renderDebouncer.addRefreshCallback(t)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var t,d;this._renderer&&(null===(d=(t=this._renderer).clearTextureAtlas)||void 0===d||d.call(t),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer&&(this._renderer.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(t,d){this._renderer&&(this._isPaused?this._pausedResizeTask.set((()=>this._renderer.handleResize(t,d))):this._renderer.handleResize(t,d),this._fullRefresh())}handleCharSizeChanged(){var t;null===(t=this._renderer)||void 0===t||t.handleCharSizeChanged()}handleBlur(){var t;null===(t=this._renderer)||void 0===t||t.handleBlur()}handleFocus(){var t;null===(t=this._renderer)||void 0===t||t.handleFocus()}handleSelectionChanged(t,d,u){var f;this._selectionState.start=t,this._selectionState.end=d,this._selectionState.columnSelectMode=u,null===(f=this._renderer)||void 0===f||f.handleSelectionChanged(t,d,u)}handleCursorMove(){var t;null===(t=this._renderer)||void 0===t||t.handleCursorMove()}clear(){var t;null===(t=this._renderer)||void 0===t||t.clear()}};O=f([p(2,y.IOptionsService),p(3,w.ICharSizeService),p(4,y.IDecorationService),p(5,y.IBufferService),p(6,w.ICoreBrowserService),p(7,w.IThemeService)],O),d.RenderService=O},9312:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.SelectionService=void 0;const v=u(6114),g=u(456),b=u(511),S=u(8460),C=u(4725),y=u(2585),w=u(9806),x=u(9504),O=u(844),j=u(4841),k=String.fromCharCode(160),T=new RegExp(k,"g");let L=class extends O.Disposable{constructor(t,d,u,f,p,v,C,y,w){super(),this._element=t,this._screenElement=d,this._linkifier=u,this._bufferService=f,this._coreService=p,this._mouseService=v,this._optionsService=C,this._renderService=y,this._coreBrowserService=w,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new b.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new S.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new S.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new S.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new S.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=t=>this._handleMouseMove(t),this._mouseUpListener=t=>this._handleMouseUp(t),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((t=>this._handleTrim(t))),this.register(this._bufferService.buffers.onBufferActivate((t=>this._handleBufferActivate(t)))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,O.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const t=this._model.finalSelectionStart,d=this._model.finalSelectionEnd;return!(!t||!d||t[0]===d[0]&&t[1]===d[1])}get selectionText(){const t=this._model.finalSelectionStart,d=this._model.finalSelectionEnd;if(!t||!d)return"";const u=this._bufferService.buffer,f=[];if(3===this._activeSelectionMode){if(t[0]===d[0])return"";const p=t[0]<d[0]?t[0]:d[0],v=t[0]<d[0]?d[0]:t[0];for(let g=t[1];g<=d[1];g++){const t=u.translateBufferLineToString(g,!0,p,v);f.push(t)}}else{const p=t[1]===d[1]?d[0]:void 0;f.push(u.translateBufferLineToString(t[1],!0,t[0],p));for(let p=t[1]+1;p<=d[1]-1;p++){const t=u.lines.get(p),d=u.translateBufferLineToString(p,!0);(null==t?void 0:t.isWrapped)?f[f.length-1]+=d:f.push(d)}if(t[1]!==d[1]){const t=u.lines.get(d[1]),p=u.translateBufferLineToString(d[1],!0,0,d[0]);t&&t.isWrapped?f[f.length-1]+=p:f.push(p)}}return f.map((t=>t.replace(T," "))).join(v.isWindows?"\r\n":"\n")}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(t){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),v.isLinux&&t&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(t){const d=this._getMouseBufferCoords(t),u=this._model.finalSelectionStart,f=this._model.finalSelectionEnd;return!!(u&&f&&d)&&this._areCoordsInSelection(d,u,f)}isCellInSelection(t,d){const u=this._model.finalSelectionStart,f=this._model.finalSelectionEnd;return!(!u||!f)&&this._areCoordsInSelection([t,d],u,f)}_areCoordsInSelection(t,d,u){return t[1]>d[1]&&t[1]<u[1]||d[1]===u[1]&&t[1]===d[1]&&t[0]>=d[0]&&t[0]<u[0]||d[1]<u[1]&&t[1]===u[1]&&t[0]<u[0]||d[1]<u[1]&&t[1]===d[1]&&t[0]>=d[0]}_selectWordAtCursor(t,d){var u,f;const p=null===(f=null===(u=this._linkifier.currentLink)||void 0===u?void 0:u.link)||void 0===f?void 0:f.range;if(p)return this._model.selectionStart=[p.start.x-1,p.start.y-1],this._model.selectionStartLength=(0,j.getRangeLength)(p,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const v=this._getMouseBufferCoords(t);return!!v&&(this._selectWordAt(v,d),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(t,d){this._model.clearSelection(),t=Math.max(t,0),d=Math.min(d,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,t],this._model.selectionEnd=[this._bufferService.cols,d],this.refresh(),this._onSelectionChange.fire()}_handleTrim(t){this._model.handleTrim(t)&&this.refresh()}_getMouseBufferCoords(t){const d=this._mouseService.getCoords(t,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(d)return d[0]--,d[1]--,d[1]+=this._bufferService.buffer.ydisp,d}_getMouseEventScrollAmount(t){let d=(0,w.getCoordsRelativeToElement)(this._coreBrowserService.window,t,this._screenElement)[1];const u=this._renderService.dimensions.css.canvas.height;return d>=0&&d<=u?0:(d>u&&(d-=u),d=Math.min(Math.max(d,-50),50),d/=50,d/Math.abs(d)+Math.round(14*d))}shouldForceSelection(t){return v.isMac?t.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:t.shiftKey}handleMouseDown(t){if(this._mouseDownTimeStamp=t.timeStamp,(2!==t.button||!this.hasSelection)&&0===t.button){if(!this._enabled){if(!this.shouldForceSelection(t))return;t.stopPropagation()}t.preventDefault(),this._dragScrollAmount=0,this._enabled&&t.shiftKey?this._handleIncrementalClick(t):1===t.detail?this._handleSingleClick(t):2===t.detail?this._handleDoubleClick(t):3===t.detail&&this._handleTripleClick(t),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(t){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(t))}_handleSingleClick(t){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(t)?3:0,this._model.selectionStart=this._getMouseBufferCoords(t),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const d=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);d&&d.length!==this._model.selectionStart[0]&&0===d.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(t){this._selectWordAtCursor(t,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(t){const d=this._getMouseBufferCoords(t);d&&(this._activeSelectionMode=2,this._selectLineAt(d[1]))}shouldColumnSelect(t){return t.altKey&&!(v.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(t){if(t.stopImmediatePropagation(),!this._model.selectionStart)return;const d=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(t),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(t),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const u=this._bufferService.buffer;if(this._model.selectionEnd[1]<u.lines.length){const t=u.lines.get(this._model.selectionEnd[1]);t&&0===t.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}d&&d[0]===this._model.selectionEnd[0]&&d[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const t=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(t.ydisp+this._bufferService.rows,t.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=t.ydisp),this.refresh()}}_handleMouseUp(t){const d=t.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&d<500&&t.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const d=this._mouseService.getCoords(t,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(d&&void 0!==d[0]&&void 0!==d[1]){const t=(0,x.moveToCellSequence)(d[0]-1,d[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(t,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const t=this._model.finalSelectionStart,d=this._model.finalSelectionEnd,u=!(!t||!d||t[0]===d[0]&&t[1]===d[1]);u?t&&d&&(this._oldSelectionStart&&this._oldSelectionEnd&&t[0]===this._oldSelectionStart[0]&&t[1]===this._oldSelectionStart[1]&&d[0]===this._oldSelectionEnd[0]&&d[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(t,d,u)):this._oldHasSelection&&this._fireOnSelectionChange(t,d,u)}_fireOnSelectionChange(t,d,u){this._oldSelectionStart=t,this._oldSelectionEnd=d,this._oldHasSelection=u,this._onSelectionChange.fire()}_handleBufferActivate(t){this.clearSelection(),this._trimListener.dispose(),this._trimListener=t.activeBuffer.lines.onTrim((t=>this._handleTrim(t)))}_convertViewportColToCharacterIndex(t,d){let u=d;for(let f=0;d>=f;f++){const p=t.loadCell(f,this._workCell).getChars().length;0===this._workCell.getWidth()?u--:p>1&&d!==f&&(u+=p-1)}return u}setSelection(t,d,u){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[t,d],this._model.selectionStartLength=u,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(t){this._isClickInSelection(t)||(this._selectWordAtCursor(t,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(t,d,u=!0,f=!0){if(t[0]>=this._bufferService.cols)return;const p=this._bufferService.buffer,v=p.lines.get(t[1]);if(!v)return;const g=p.translateBufferLineToString(t[1],!1);let b=this._convertViewportColToCharacterIndex(v,t[0]),S=b;const C=t[0]-b;let y=0,w=0,x=0,O=0;if(" "===g.charAt(b)){for(;b>0&&" "===g.charAt(b-1);)b--;for(;S<g.length&&" "===g.charAt(S+1);)S++}else{let d=t[0],u=t[0];0===v.getWidth(d)&&(y++,d--),2===v.getWidth(u)&&(w++,u++);const f=v.getString(u).length;for(f>1&&(O+=f-1,S+=f-1);d>0&&b>0&&!this._isCharWordSeparator(v.loadCell(d-1,this._workCell));){v.loadCell(d-1,this._workCell);const t=this._workCell.getChars().length;0===this._workCell.getWidth()?(y++,d--):t>1&&(x+=t-1,b-=t-1),b--,d--}for(;u<v.length&&S+1<g.length&&!this._isCharWordSeparator(v.loadCell(u+1,this._workCell));){v.loadCell(u+1,this._workCell);const t=this._workCell.getChars().length;2===this._workCell.getWidth()?(w++,u++):t>1&&(O+=t-1,S+=t-1),S++,u++}}S++;let j=b+C-y+x,k=Math.min(this._bufferService.cols,S-b+y+w-x-O);if(d||""!==g.slice(b,S).trim()){if(u&&0===j&&32!==v.getCodePoint(0)){const d=p.lines.get(t[1]-1);if(d&&v.isWrapped&&32!==d.getCodePoint(this._bufferService.cols-1)){const d=this._getWordAt([this._bufferService.cols-1,t[1]-1],!1,!0,!1);if(d){const t=this._bufferService.cols-d.start;j-=t,k+=t}}}if(f&&j+k===this._bufferService.cols&&32!==v.getCodePoint(this._bufferService.cols-1)){const d=p.lines.get(t[1]+1);if((null==d?void 0:d.isWrapped)&&32!==d.getCodePoint(0)){const d=this._getWordAt([0,t[1]+1],!1,!1,!0);d&&(k+=d.length)}}return{start:j,length:k}}}_selectWordAt(t,d){const u=this._getWordAt(t,d);if(u){for(;u.start<0;)u.start+=this._bufferService.cols,t[1]--;this._model.selectionStart=[u.start,t[1]],this._model.selectionStartLength=u.length}}_selectToWordAt(t){const d=this._getWordAt(t,!0);if(d){let u=t[1];for(;d.start<0;)d.start+=this._bufferService.cols,u--;if(!this._model.areSelectionValuesReversed())for(;d.start+d.length>this._bufferService.cols;)d.length-=this._bufferService.cols,u++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?d.start:d.start+d.length,u]}}_isCharWordSeparator(t){return 0!==t.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(t.getChars())>=0}_selectLineAt(t){const d=this._bufferService.buffer.getWrappedRangeForLine(t),u={start:{x:0,y:d.first},end:{x:this._bufferService.cols-1,y:d.last}};this._model.selectionStart=[0,d.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,j.getRangeLength)(u,this._bufferService.cols)}};L=f([p(3,y.IBufferService),p(4,y.ICoreService),p(5,C.IMouseService),p(6,y.IOptionsService),p(7,C.IRenderService),p(8,C.ICoreBrowserService)],L),d.SelectionService=L},4725:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.IThemeService=d.ICharacterJoinerService=d.ISelectionService=d.IRenderService=d.IMouseService=d.ICoreBrowserService=d.ICharSizeService=void 0;const f=u(8343);d.ICharSizeService=(0,f.createDecorator)("CharSizeService"),d.ICoreBrowserService=(0,f.createDecorator)("CoreBrowserService"),d.IMouseService=(0,f.createDecorator)("MouseService"),d.IRenderService=(0,f.createDecorator)("RenderService"),d.ISelectionService=(0,f.createDecorator)("SelectionService"),d.ICharacterJoinerService=(0,f.createDecorator)("CharacterJoinerService"),d.IThemeService=(0,f.createDecorator)("ThemeService")},6731:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.ThemeService=d.DEFAULT_ANSI_COLORS=void 0;const v=u(7239),g=u(8055),b=u(8460),S=u(844),C=u(2585),y=g.css.toColor("#ffffff"),w=g.css.toColor("#000000"),x=g.css.toColor("#ffffff"),O=g.css.toColor("#000000"),j={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};d.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const t=[g.css.toColor("#2e3436"),g.css.toColor("#cc0000"),g.css.toColor("#4e9a06"),g.css.toColor("#c4a000"),g.css.toColor("#3465a4"),g.css.toColor("#75507b"),g.css.toColor("#06989a"),g.css.toColor("#d3d7cf"),g.css.toColor("#555753"),g.css.toColor("#ef2929"),g.css.toColor("#8ae234"),g.css.toColor("#fce94f"),g.css.toColor("#729fcf"),g.css.toColor("#ad7fa8"),g.css.toColor("#34e2e2"),g.css.toColor("#eeeeec")],d=[0,95,135,175,215,255];for(let u=0;u<216;u++){const f=d[u/36%6|0],p=d[u/6%6|0],v=d[u%6];t.push({css:g.channels.toCss(f,p,v),rgba:g.channels.toRgba(f,p,v)})}for(let d=0;d<24;d++){const u=8+10*d;t.push({css:g.channels.toCss(u,u,u),rgba:g.channels.toRgba(u,u,u)})}return t})());let k=class extends S.Disposable{constructor(t){super(),this._optionsService=t,this._onChangeColors=this.register(new b.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._contrastCache=new v.ColorContrastCache,this._colors={foreground:y,background:w,cursor:x,cursorAccent:O,selectionForeground:void 0,selectionBackgroundTransparent:j,selectionBackgroundOpaque:g.color.blend(w,j),selectionInactiveBackgroundTransparent:j,selectionInactiveBackgroundOpaque:g.color.blend(w,j),ansi:d.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}get colors(){return this._colors}_setTheme(t={}){const u=this._colors;if(u.foreground=T(t.foreground,y),u.background=T(t.background,w),u.cursor=T(t.cursor,x),u.cursorAccent=T(t.cursorAccent,O),u.selectionBackgroundTransparent=T(t.selectionBackground,j),u.selectionBackgroundOpaque=g.color.blend(u.background,u.selectionBackgroundTransparent),u.selectionInactiveBackgroundTransparent=T(t.selectionInactiveBackground,u.selectionBackgroundTransparent),u.selectionInactiveBackgroundOpaque=g.color.blend(u.background,u.selectionInactiveBackgroundTransparent),u.selectionForeground=t.selectionForeground?T(t.selectionForeground,g.NULL_COLOR):void 0,u.selectionForeground===g.NULL_COLOR&&(u.selectionForeground=void 0),g.color.isOpaque(u.selectionBackgroundTransparent)){const t=.3;u.selectionBackgroundTransparent=g.color.opacity(u.selectionBackgroundTransparent,t)}if(g.color.isOpaque(u.selectionInactiveBackgroundTransparent)){const t=.3;u.selectionInactiveBackgroundTransparent=g.color.opacity(u.selectionInactiveBackgroundTransparent,t)}if(u.ansi=d.DEFAULT_ANSI_COLORS.slice(),u.ansi[0]=T(t.black,d.DEFAULT_ANSI_COLORS[0]),u.ansi[1]=T(t.red,d.DEFAULT_ANSI_COLORS[1]),u.ansi[2]=T(t.green,d.DEFAULT_ANSI_COLORS[2]),u.ansi[3]=T(t.yellow,d.DEFAULT_ANSI_COLORS[3]),u.ansi[4]=T(t.blue,d.DEFAULT_ANSI_COLORS[4]),u.ansi[5]=T(t.magenta,d.DEFAULT_ANSI_COLORS[5]),u.ansi[6]=T(t.cyan,d.DEFAULT_ANSI_COLORS[6]),u.ansi[7]=T(t.white,d.DEFAULT_ANSI_COLORS[7]),u.ansi[8]=T(t.brightBlack,d.DEFAULT_ANSI_COLORS[8]),u.ansi[9]=T(t.brightRed,d.DEFAULT_ANSI_COLORS[9]),u.ansi[10]=T(t.brightGreen,d.DEFAULT_ANSI_COLORS[10]),u.ansi[11]=T(t.brightYellow,d.DEFAULT_ANSI_COLORS[11]),u.ansi[12]=T(t.brightBlue,d.DEFAULT_ANSI_COLORS[12]),u.ansi[13]=T(t.brightMagenta,d.DEFAULT_ANSI_COLORS[13]),u.ansi[14]=T(t.brightCyan,d.DEFAULT_ANSI_COLORS[14]),u.ansi[15]=T(t.brightWhite,d.DEFAULT_ANSI_COLORS[15]),t.extendedAnsi){const f=Math.min(u.ansi.length-16,t.extendedAnsi.length);for(let p=0;p<f;p++)u.ansi[p+16]=T(t.extendedAnsi[p],d.DEFAULT_ANSI_COLORS[p+16])}this._contrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(t){this._restoreColor(t),this._onChangeColors.fire(this.colors)}_restoreColor(t){if(void 0!==t)switch(t){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[t]=this._restoreColors.ansi[t]}else for(let t=0;t<this._restoreColors.ansi.length;++t)this._colors.ansi[t]=this._restoreColors.ansi[t]}modifyColors(t){t(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function T(t,d){if(void 0!==t)try{return g.css.toColor(t)}catch(t){}return d}k=f([p(0,C.IOptionsService)],k),d.ThemeService=k},6349:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.CircularList=void 0;const f=u(8460),p=u(844);class n extends p.Disposable{constructor(t){super(),this._maxLength=t,this.onDeleteEmitter=this.register(new f.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new f.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new f.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(t){if(this._maxLength===t)return;const d=new Array(t);for(let u=0;u<Math.min(t,this.length);u++)d[u]=this._array[this._getCyclicIndex(u)];this._array=d,this._maxLength=t,this._startIndex=0}get length(){return this._length}set length(t){if(t>this._length)for(let d=this._length;d<t;d++)this._array[d]=void 0;this._length=t}get(t){return this._array[this._getCyclicIndex(t)]}set(t,d){this._array[this._getCyclicIndex(t)]=d}push(t){this._array[this._getCyclicIndex(this._length)]=t,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(t,d,...u){if(d){for(let u=t;u<this._length-d;u++)this._array[this._getCyclicIndex(u)]=this._array[this._getCyclicIndex(u+d)];this._length-=d,this.onDeleteEmitter.fire({index:t,amount:d})}for(let d=this._length-1;d>=t;d--)this._array[this._getCyclicIndex(d+u.length)]=this._array[this._getCyclicIndex(d)];for(let d=0;d<u.length;d++)this._array[this._getCyclicIndex(t+d)]=u[d];if(u.length&&this.onInsertEmitter.fire({index:t,amount:u.length}),this._length+u.length>this._maxLength){const t=this._length+u.length-this._maxLength;this._startIndex+=t,this._length=this._maxLength,this.onTrimEmitter.fire(t)}else this._length+=u.length}trimStart(t){t>this._length&&(t=this._length),this._startIndex+=t,this._length-=t,this.onTrimEmitter.fire(t)}shiftElements(t,d,u){if(!(d<=0)){if(t<0||t>=this._length)throw new Error("start argument out of range");if(t+u<0)throw new Error("Cannot shift elements in list beyond index 0");if(u>0){for(let f=d-1;f>=0;f--)this.set(t+f+u,this.get(t+f));const f=t+d+u-this._length;if(f>0)for(this._length+=f;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let f=0;f<d;f++)this.set(t+f+u,this.get(t+f))}}_getCyclicIndex(t){return(this._startIndex+t)%this._maxLength}}d.CircularList=n},1439:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.clone=void 0,d.clone=function t(d,u=5){if("object"!=typeof d)return d;const f=Array.isArray(d)?[]:{};for(const p in d)f[p]=u<=1?d[p]:d[p]&&t(d[p],u-1);return f}},8055:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.contrastRatio=d.toPaddedHex=d.rgba=d.rgb=d.css=d.color=d.channels=d.NULL_COLOR=void 0;const f=u(6114);let p=0,v=0,g=0,b=0;var S,C,y;function w(t){const d=t.toString(16);return d.length<2?"0"+d:d}function x(t,d){return t<d?(d+.05)/(t+.05):(t+.05)/(d+.05)}d.NULL_COLOR={css:"#00000000",rgba:0},function(t){t.toCss=function(t,d,u,f){return void 0!==f?`#${w(t)}${w(d)}${w(u)}${w(f)}`:`#${w(t)}${w(d)}${w(u)}`},t.toRgba=function(t,d,u,f=255){return(t<<24|d<<16|u<<8|f)>>>0}}(S=d.channels||(d.channels={})),function(t){function d(t,d){return b=Math.round(255*d),[p,v,g]=y.toChannels(t.rgba),{css:S.toCss(p,v,g,b),rgba:S.toRgba(p,v,g,b)}}t.blend=function(t,d){if(b=(255&d.rgba)/255,1===b)return{css:d.css,rgba:d.rgba};const u=d.rgba>>24&255,f=d.rgba>>16&255,C=d.rgba>>8&255,y=t.rgba>>24&255,w=t.rgba>>16&255,x=t.rgba>>8&255;return p=y+Math.round((u-y)*b),v=w+Math.round((f-w)*b),g=x+Math.round((C-x)*b),{css:S.toCss(p,v,g),rgba:S.toRgba(p,v,g)}},t.isOpaque=function(t){return!(255&~t.rgba)},t.ensureContrastRatio=function(t,d,u){const f=y.ensureContrastRatio(t.rgba,d.rgba,u);if(f)return y.toColor(f>>24&255,f>>16&255,f>>8&255)},t.opaque=function(t){const d=(255|t.rgba)>>>0;return[p,v,g]=y.toChannels(d),{css:S.toCss(p,v,g),rgba:d}},t.opacity=d,t.multiplyOpacity=function(t,u){return b=255&t.rgba,d(t,b*u/255)},t.toColorRGB=function(t){return[t.rgba>>24&255,t.rgba>>16&255,t.rgba>>8&255]}}(d.color||(d.color={})),function(t){let d,u;if(!f.isNode){const t=document.createElement("canvas");t.width=1,t.height=1;const f=t.getContext("2d",{willReadFrequently:!0});f&&(d=f,d.globalCompositeOperation="copy",u=d.createLinearGradient(0,0,1,1))}t.toColor=function(t){if(t.match(/#[\da-f]{3,8}/i))switch(t.length){case 4:return p=parseInt(t.slice(1,2).repeat(2),16),v=parseInt(t.slice(2,3).repeat(2),16),g=parseInt(t.slice(3,4).repeat(2),16),y.toColor(p,v,g);case 5:return p=parseInt(t.slice(1,2).repeat(2),16),v=parseInt(t.slice(2,3).repeat(2),16),g=parseInt(t.slice(3,4).repeat(2),16),b=parseInt(t.slice(4,5).repeat(2),16),y.toColor(p,v,g,b);case 7:return{css:t,rgba:(parseInt(t.slice(1),16)<<8|255)>>>0};case 9:return{css:t,rgba:parseInt(t.slice(1),16)>>>0}}const f=t.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(f)return p=parseInt(f[1]),v=parseInt(f[2]),g=parseInt(f[3]),b=Math.round(255*(void 0===f[5]?1:parseFloat(f[5]))),y.toColor(p,v,g,b);if(!d||!u)throw new Error("css.toColor: Unsupported css format");if(d.fillStyle=u,d.fillStyle=t,"string"!=typeof d.fillStyle)throw new Error("css.toColor: Unsupported css format");if(d.fillRect(0,0,1,1),[p,v,g,b]=d.getImageData(0,0,1,1).data,255!==b)throw new Error("css.toColor: Unsupported css format");return{rgba:S.toRgba(p,v,g,b),css:t}}}(d.css||(d.css={})),function(t){function d(t,d,u){const f=t/255,p=d/255,v=u/255;return.2126*(f<=.03928?f/12.92:Math.pow((f+.055)/1.055,2.4))+.7152*(p<=.03928?p/12.92:Math.pow((p+.055)/1.055,2.4))+.0722*(v<=.03928?v/12.92:Math.pow((v+.055)/1.055,2.4))}t.relativeLuminance=function(t){return d(t>>16&255,t>>8&255,255&t)},t.relativeLuminance2=d}(C=d.rgb||(d.rgb={})),function(t){function d(t,d,u){const f=t>>24&255,p=t>>16&255,v=t>>8&255;let g=d>>24&255,b=d>>16&255,S=d>>8&255,y=x(C.relativeLuminance2(g,b,S),C.relativeLuminance2(f,p,v));for(;y<u&&(g>0||b>0||S>0);)g-=Math.max(0,Math.ceil(.1*g)),b-=Math.max(0,Math.ceil(.1*b)),S-=Math.max(0,Math.ceil(.1*S)),y=x(C.relativeLuminance2(g,b,S),C.relativeLuminance2(f,p,v));return(g<<24|b<<16|S<<8|255)>>>0}function u(t,d,u){const f=t>>24&255,p=t>>16&255,v=t>>8&255;let g=d>>24&255,b=d>>16&255,S=d>>8&255,y=x(C.relativeLuminance2(g,b,S),C.relativeLuminance2(f,p,v));for(;y<u&&(g<255||b<255||S<255);)g=Math.min(255,g+Math.ceil(.1*(255-g))),b=Math.min(255,b+Math.ceil(.1*(255-b))),S=Math.min(255,S+Math.ceil(.1*(255-S))),y=x(C.relativeLuminance2(g,b,S),C.relativeLuminance2(f,p,v));return(g<<24|b<<16|S<<8|255)>>>0}t.ensureContrastRatio=function(t,f,p){const v=C.relativeLuminance(t>>8),g=C.relativeLuminance(f>>8);if(x(v,g)<p){if(g<v){const g=d(t,f,p),b=x(v,C.relativeLuminance(g>>8));if(b<p){const d=u(t,f,p);return b>x(v,C.relativeLuminance(d>>8))?g:d}return g}const b=u(t,f,p),S=x(v,C.relativeLuminance(b>>8));if(S<p){const u=d(t,f,p);return S>x(v,C.relativeLuminance(u>>8))?b:u}return b}},t.reduceLuminance=d,t.increaseLuminance=u,t.toChannels=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},t.toColor=function(t,d,u,f){return{css:S.toCss(t,d,u,f),rgba:S.toRgba(t,d,u,f)}}}(y=d.rgba||(d.rgba={})),d.toPaddedHex=w,d.contrastRatio=x},8969:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.CoreTerminal=void 0;const f=u(844),p=u(2585),v=u(4348),g=u(7866),b=u(744),S=u(7302),C=u(6975),y=u(8460),w=u(1753),x=u(1480),O=u(7994),j=u(9282),k=u(5435),T=u(5981),L=u(2660);let R=!1;class m extends f.Disposable{constructor(t){super(),this._onBinary=this.register(new y.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new y.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new y.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new y.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new y.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new y.EventEmitter),this._instantiationService=new v.InstantiationService,this.optionsService=this.register(new S.OptionsService(t)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(b.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(g.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(C.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(w.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(x.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(O.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(L.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new k.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,y.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,y.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,y.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,y.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onSpecificOptionChange("windowsMode",(t=>this._handleWindowsModeOptionChange(t)))),this.register(this._bufferService.onScroll((t=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((t=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new T.WriteBuffer(((t,d)=>this._inputHandler.parse(t,d)))),this.register((0,y.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed)),this.register((0,f.toDisposable)((()=>{var t;null===(t=this._windowsMode)||void 0===t||t.dispose(),this._windowsMode=void 0})))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new y.EventEmitter),this._onScroll.event((t=>{var d;null===(d=this._onScrollApi)||void 0===d||d.fire(t.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(t){for(const d in t)this.optionsService.options[d]=t[d]}write(t,d){this._writeBuffer.write(t,d)}writeSync(t,d){this._logService.logLevel<=p.LogLevelEnum.WARN&&!R&&(this._logService.warn("writeSync is unreliable and will be removed soon."),R=!0),this._writeBuffer.writeSync(t,d)}resize(t,d){isNaN(t)||isNaN(d)||(t=Math.max(t,b.MINIMUM_COLS),d=Math.max(d,b.MINIMUM_ROWS),this._bufferService.resize(t,d))}scroll(t,d=!1){this._bufferService.scroll(t,d)}scrollLines(t,d,u){this._bufferService.scrollLines(t,d,u)}scrollPages(t){this._bufferService.scrollPages(t)}scrollToTop(){this._bufferService.scrollToTop()}scrollToBottom(){this._bufferService.scrollToBottom()}scrollToLine(t){this._bufferService.scrollToLine(t)}registerEscHandler(t,d){return this._inputHandler.registerEscHandler(t,d)}registerDcsHandler(t,d){return this._inputHandler.registerDcsHandler(t,d)}registerCsiHandler(t,d){return this._inputHandler.registerCsiHandler(t,d)}registerOscHandler(t,d){return this._inputHandler.registerOscHandler(t,d)}_setup(){this.optionsService.rawOptions.windowsMode&&this._enableWindowsMode()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsModeOptionChange(t){var d;t?this._enableWindowsMode():(null===(d=this._windowsMode)||void 0===d||d.dispose(),this._windowsMode=void 0)}_enableWindowsMode(){if(!this._windowsMode){const t=[];t.push(this.onLineFeed(j.updateWindowsModeWrappedState.bind(null,this._bufferService))),t.push(this.registerCsiHandler({final:"H"},(()=>((0,j.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsMode={dispose:()=>{for(const d of t)d.dispose()}}}}}d.CoreTerminal=m},8460:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.forwardEvent=d.EventEmitter=void 0,d.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=t=>(this._listeners.push(t),{dispose:()=>{if(!this._disposed)for(let d=0;d<this._listeners.length;d++)if(this._listeners[d]===t)return void this._listeners.splice(d,1)}})),this._event}fire(t,d){const u=[];for(let t=0;t<this._listeners.length;t++)u.push(this._listeners[t]);for(let f=0;f<u.length;f++)u[f].call(void 0,t,d)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},d.forwardEvent=function(t,d){return t((t=>d.fire(t)))}},5435:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.InputHandler=d.WindowsOptionsReportType=void 0;const v=u(2584),g=u(7116),b=u(2015),S=u(844),C=u(482),y=u(8437),w=u(8460),x=u(643),O=u(511),j=u(3734),k=u(2585),T=u(6242),L=u(6351),R=u(5941),A={"(":0,")":1,"*":2,"+":3,"-":1,".":2},D=131072;function M(t,d){if(t>24)return d.setWinLines||!1;switch(t){case 1:return!!d.restoreWin;case 2:return!!d.minimizeWin;case 3:return!!d.setWinPosition;case 4:return!!d.setWinSizePixels;case 5:return!!d.raiseWin;case 6:return!!d.lowerWin;case 7:return!!d.refreshWin;case 8:return!!d.setWinSizeChars;case 9:return!!d.maximizeWin;case 10:return!!d.fullscreenWin;case 11:return!!d.getWinState;case 13:return!!d.getWinPosition;case 14:return!!d.getWinSizePixels;case 15:return!!d.getScreenSizePixels;case 16:return!!d.getCellSizePixels;case 18:return!!d.getWinSizeChars;case 19:return!!d.getScreenSizeChars;case 20:return!!d.getIconTitle;case 21:return!!d.getWinTitle;case 22:return!!d.pushTitle;case 23:return!!d.popTitle;case 24:return!!d.setWinLines}return!1}var B;!function(t){t[t.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",t[t.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"}(B=d.WindowsOptionsReportType||(d.WindowsOptionsReportType={}));let P=0;class E extends S.Disposable{constructor(t,d,u,f,p,S,x,j,k=new b.EscapeSequenceParser){super(),this._bufferService=t,this._charsetService=d,this._coreService=u,this._logService=f,this._optionsService=p,this._oscLinkService=S,this._coreMouseService=x,this._unicodeService=j,this._parser=k,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new C.StringToUtf32,this._utf8Decoder=new C.Utf8ToUtf32,this._workCell=new O.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=y.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=y.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new w.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new w.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new w.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new w.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new w.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new w.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new w.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new w.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new w.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new w.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new w.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new w.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new w.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new H(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((t=>this._activeBuffer=t.activeBuffer))),this._parser.setCsiHandlerFallback(((t,d)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(t),params:d.toArray()})})),this._parser.setEscHandlerFallback((t=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(t)})})),this._parser.setExecuteHandlerFallback((t=>{this._logService.debug("Unknown EXECUTE code: ",{code:t})})),this._parser.setOscHandlerFallback(((t,d,u)=>{this._logService.debug("Unknown OSC code: ",{identifier:t,action:d,data:u})})),this._parser.setDcsHandlerFallback(((t,d,u)=>{"HOOK"===d&&(u=u.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(t),action:d,payload:u})})),this._parser.setPrintHandler(((t,d,u)=>this.print(t,d,u))),this._parser.registerCsiHandler({final:"@"},(t=>this.insertChars(t))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(t=>this.scrollLeft(t))),this._parser.registerCsiHandler({final:"A"},(t=>this.cursorUp(t))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(t=>this.scrollRight(t))),this._parser.registerCsiHandler({final:"B"},(t=>this.cursorDown(t))),this._parser.registerCsiHandler({final:"C"},(t=>this.cursorForward(t))),this._parser.registerCsiHandler({final:"D"},(t=>this.cursorBackward(t))),this._parser.registerCsiHandler({final:"E"},(t=>this.cursorNextLine(t))),this._parser.registerCsiHandler({final:"F"},(t=>this.cursorPrecedingLine(t))),this._parser.registerCsiHandler({final:"G"},(t=>this.cursorCharAbsolute(t))),this._parser.registerCsiHandler({final:"H"},(t=>this.cursorPosition(t))),this._parser.registerCsiHandler({final:"I"},(t=>this.cursorForwardTab(t))),this._parser.registerCsiHandler({final:"J"},(t=>this.eraseInDisplay(t,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(t=>this.eraseInDisplay(t,!0))),this._parser.registerCsiHandler({final:"K"},(t=>this.eraseInLine(t,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(t=>this.eraseInLine(t,!0))),this._parser.registerCsiHandler({final:"L"},(t=>this.insertLines(t))),this._parser.registerCsiHandler({final:"M"},(t=>this.deleteLines(t))),this._parser.registerCsiHandler({final:"P"},(t=>this.deleteChars(t))),this._parser.registerCsiHandler({final:"S"},(t=>this.scrollUp(t))),this._parser.registerCsiHandler({final:"T"},(t=>this.scrollDown(t))),this._parser.registerCsiHandler({final:"X"},(t=>this.eraseChars(t))),this._parser.registerCsiHandler({final:"Z"},(t=>this.cursorBackwardTab(t))),this._parser.registerCsiHandler({final:"`"},(t=>this.charPosAbsolute(t))),this._parser.registerCsiHandler({final:"a"},(t=>this.hPositionRelative(t))),this._parser.registerCsiHandler({final:"b"},(t=>this.repeatPrecedingCharacter(t))),this._parser.registerCsiHandler({final:"c"},(t=>this.sendDeviceAttributesPrimary(t))),this._parser.registerCsiHandler({prefix:">",final:"c"},(t=>this.sendDeviceAttributesSecondary(t))),this._parser.registerCsiHandler({final:"d"},(t=>this.linePosAbsolute(t))),this._parser.registerCsiHandler({final:"e"},(t=>this.vPositionRelative(t))),this._parser.registerCsiHandler({final:"f"},(t=>this.hVPosition(t))),this._parser.registerCsiHandler({final:"g"},(t=>this.tabClear(t))),this._parser.registerCsiHandler({final:"h"},(t=>this.setMode(t))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(t=>this.setModePrivate(t))),this._parser.registerCsiHandler({final:"l"},(t=>this.resetMode(t))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(t=>this.resetModePrivate(t))),this._parser.registerCsiHandler({final:"m"},(t=>this.charAttributes(t))),this._parser.registerCsiHandler({final:"n"},(t=>this.deviceStatus(t))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(t=>this.deviceStatusPrivate(t))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(t=>this.softReset(t))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(t=>this.setCursorStyle(t))),this._parser.registerCsiHandler({final:"r"},(t=>this.setScrollRegion(t))),this._parser.registerCsiHandler({final:"s"},(t=>this.saveCursor(t))),this._parser.registerCsiHandler({final:"t"},(t=>this.windowOptions(t))),this._parser.registerCsiHandler({final:"u"},(t=>this.restoreCursor(t))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(t=>this.insertColumns(t))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(t=>this.deleteColumns(t))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(t=>this.selectProtected(t))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(t=>this.requestMode(t,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(t=>this.requestMode(t,!1))),this._parser.setExecuteHandler(v.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(v.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(v.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(v.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(v.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(v.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(v.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(v.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(v.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(v.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(v.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(v.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new T.OscHandler((t=>(this.setTitle(t),this.setIconName(t),!0)))),this._parser.registerOscHandler(1,new T.OscHandler((t=>this.setIconName(t)))),this._parser.registerOscHandler(2,new T.OscHandler((t=>this.setTitle(t)))),this._parser.registerOscHandler(4,new T.OscHandler((t=>this.setOrReportIndexedColor(t)))),this._parser.registerOscHandler(8,new T.OscHandler((t=>this.setHyperlink(t)))),this._parser.registerOscHandler(10,new T.OscHandler((t=>this.setOrReportFgColor(t)))),this._parser.registerOscHandler(11,new T.OscHandler((t=>this.setOrReportBgColor(t)))),this._parser.registerOscHandler(12,new T.OscHandler((t=>this.setOrReportCursorColor(t)))),this._parser.registerOscHandler(104,new T.OscHandler((t=>this.restoreIndexedColor(t)))),this._parser.registerOscHandler(110,new T.OscHandler((t=>this.restoreFgColor(t)))),this._parser.registerOscHandler(111,new T.OscHandler((t=>this.restoreBgColor(t)))),this._parser.registerOscHandler(112,new T.OscHandler((t=>this.restoreCursorColor(t)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset()));for(const t in g.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:t},(()=>this.selectCharset("("+t))),this._parser.registerEscHandler({intermediates:")",final:t},(()=>this.selectCharset(")"+t))),this._parser.registerEscHandler({intermediates:"*",final:t},(()=>this.selectCharset("*"+t))),this._parser.registerEscHandler({intermediates:"+",final:t},(()=>this.selectCharset("+"+t))),this._parser.registerEscHandler({intermediates:"-",final:t},(()=>this.selectCharset("-"+t))),this._parser.registerEscHandler({intermediates:".",final:t},(()=>this.selectCharset("."+t))),this._parser.registerEscHandler({intermediates:"/",final:t},(()=>this.selectCharset("/"+t)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler((t=>(this._logService.error("Parsing error: ",t),t))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new L.DcsHandler(((t,d)=>this.requestStatusString(t,d))))}getAttrData(){return this._curAttrData}_preserveStack(t,d,u,f){this._parseStack.paused=!0,this._parseStack.cursorStartX=t,this._parseStack.cursorStartY=d,this._parseStack.decodedLength=u,this._parseStack.position=f}_logSlowResolvingAsync(t){this._logService.logLevel<=k.LogLevelEnum.WARN&&Promise.race([t,new Promise(((t,d)=>setTimeout((()=>d("#SLOW_TIMEOUT")),5e3)))]).catch((t=>{if("#SLOW_TIMEOUT"!==t)throw t;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(t,d){let u,f=this._activeBuffer.x,p=this._activeBuffer.y,v=0;const g=this._parseStack.paused;if(g){if(u=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,d))return this._logSlowResolvingAsync(u),u;f=this._parseStack.cursorStartX,p=this._parseStack.cursorStartY,this._parseStack.paused=!1,t.length>D&&(v=this._parseStack.position+D)}if(this._logService.logLevel<=k.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+("string"==typeof t?` "${t}"`:` "${Array.prototype.map.call(t,(t=>String.fromCharCode(t))).join("")}"`),"string"==typeof t?t.split("").map((t=>t.charCodeAt(0))):t),this._parseBuffer.length<t.length&&this._parseBuffer.length<D&&(this._parseBuffer=new Uint32Array(Math.min(t.length,D))),g||this._dirtyRowTracker.clearRange(),t.length>D)for(let d=v;d<t.length;d+=D){const v=d+D<t.length?d+D:t.length,g="string"==typeof t?this._stringDecoder.decode(t.substring(d,v),this._parseBuffer):this._utf8Decoder.decode(t.subarray(d,v),this._parseBuffer);if(u=this._parser.parse(this._parseBuffer,g))return this._preserveStack(f,p,g,d),this._logSlowResolvingAsync(u),u}else if(!g){const d="string"==typeof t?this._stringDecoder.decode(t,this._parseBuffer):this._utf8Decoder.decode(t,this._parseBuffer);if(u=this._parser.parse(this._parseBuffer,d))return this._preserveStack(f,p,d,0),this._logSlowResolvingAsync(u),u}this._activeBuffer.x===f&&this._activeBuffer.y===p||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(t,d,u){let f,p;const v=this._charsetService.charset,g=this._optionsService.rawOptions.screenReaderMode,b=this._bufferService.cols,S=this._coreService.decPrivateModes.wraparound,y=this._coreService.modes.insertMode,w=this._curAttrData;let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&u-d>0&&2===O.getWidth(this._activeBuffer.x-1)&&O.setCellFromCodePoint(this._activeBuffer.x-1,0,1,w.fg,w.bg,w.extended);for(let j=d;j<u;++j){if(f=t[j],p=this._unicodeService.wcwidth(f),f<127&&v){const t=v[String.fromCharCode(f)];t&&(f=t.charCodeAt(0))}if(g&&this._onA11yChar.fire((0,C.stringFromCodePoint)(f)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),p||!this._activeBuffer.x){if(this._activeBuffer.x+p-1>=b)if(S){for(;this._activeBuffer.x<b;)O.setCellFromCodePoint(this._activeBuffer.x++,0,1,w.fg,w.bg,w.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),O=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=b-1,2===p)continue;if(y&&(O.insertCells(this._activeBuffer.x,p,this._activeBuffer.getNullCell(w),w),2===O.getWidth(b-1)&&O.setCellFromCodePoint(b-1,x.NULL_CELL_CODE,x.NULL_CELL_WIDTH,w.fg,w.bg,w.extended)),O.setCellFromCodePoint(this._activeBuffer.x++,f,p,w.fg,w.bg,w.extended),p>0)for(;--p;)O.setCellFromCodePoint(this._activeBuffer.x++,0,0,w.fg,w.bg,w.extended)}else O.getWidth(this._activeBuffer.x-1)?O.addCodepointToCell(this._activeBuffer.x-1,f):O.addCodepointToCell(this._activeBuffer.x-2,f)}u-d>0&&(O.loadCell(this._activeBuffer.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<b&&u-d>0&&0===O.getWidth(this._activeBuffer.x)&&!O.hasContent(this._activeBuffer.x)&&O.setCellFromCodePoint(this._activeBuffer.x,0,1,w.fg,w.bg,w.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(t,d){return"t"!==t.final||t.prefix||t.intermediates?this._parser.registerCsiHandler(t,d):this._parser.registerCsiHandler(t,(t=>!M(t.params[0],this._optionsService.rawOptions.windowOptions)||d(t)))}registerDcsHandler(t,d){return this._parser.registerDcsHandler(t,new L.DcsHandler(d))}registerEscHandler(t,d){return this._parser.registerEscHandler(t,d)}registerOscHandler(t,d){return this._parser.registerOscHandler(t,new T.OscHandler(d))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var t;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(null===(t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))||void 0===t?void 0:t.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const t=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);t.hasWidth(this._activeBuffer.x)&&!t.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const t=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-t),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(t=this._bufferService.cols-1){this._activeBuffer.x=Math.min(t,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(t,d){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=t,this._activeBuffer.y=this._activeBuffer.scrollTop+d):(this._activeBuffer.x=t,this._activeBuffer.y=d),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(t,d){this._restrictCursor(),this._setCursor(this._activeBuffer.x+t,this._activeBuffer.y+d)}cursorUp(t){const d=this._activeBuffer.y-this._activeBuffer.scrollTop;return d>=0?this._moveCursor(0,-Math.min(d,t.params[0]||1)):this._moveCursor(0,-(t.params[0]||1)),!0}cursorDown(t){const d=this._activeBuffer.scrollBottom-this._activeBuffer.y;return d>=0?this._moveCursor(0,Math.min(d,t.params[0]||1)):this._moveCursor(0,t.params[0]||1),!0}cursorForward(t){return this._moveCursor(t.params[0]||1,0),!0}cursorBackward(t){return this._moveCursor(-(t.params[0]||1),0),!0}cursorNextLine(t){return this.cursorDown(t),this._activeBuffer.x=0,!0}cursorPrecedingLine(t){return this.cursorUp(t),this._activeBuffer.x=0,!0}cursorCharAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(t){return this._setCursor(t.length>=2?(t.params[1]||1)-1:0,(t.params[0]||1)-1),!0}charPosAbsolute(t){return this._setCursor((t.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(t){return this._moveCursor(t.params[0]||1,0),!0}linePosAbsolute(t){return this._setCursor(this._activeBuffer.x,(t.params[0]||1)-1),!0}vPositionRelative(t){return this._moveCursor(0,t.params[0]||1),!0}hVPosition(t){return this.cursorPosition(t),!0}tabClear(t){const d=t.params[0];return 0===d?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===d&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let d=t.params[0]||1;for(;d--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(t){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let d=t.params[0]||1;for(;d--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(t){const d=t.params[0];return 1===d&&(this._curAttrData.bg|=536870912),2!==d&&0!==d||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(t,d,u,f=!1,p=!1){const v=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);v.replaceCells(d,u,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),p),f&&(v.isWrapped=!1)}_resetBufferLine(t,d=!1){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),d),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+t),u.isWrapped=!1}eraseInDisplay(t,d=!1){let u;switch(this._restrictCursor(this._bufferService.cols),t.params[0]){case 0:for(u=this._activeBuffer.y,this._dirtyRowTracker.markDirty(u),this._eraseInBufferLine(u++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,d);u<this._bufferService.rows;u++)this._resetBufferLine(u,d);this._dirtyRowTracker.markDirty(u);break;case 1:for(u=this._activeBuffer.y,this._dirtyRowTracker.markDirty(u),this._eraseInBufferLine(u,0,this._activeBuffer.x+1,!0,d),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(u+1).isWrapped=!1);u--;)this._resetBufferLine(u,d);this._dirtyRowTracker.markDirty(0);break;case 2:for(u=this._bufferService.rows,this._dirtyRowTracker.markDirty(u-1);u--;)this._resetBufferLine(u,d);this._dirtyRowTracker.markDirty(0);break;case 3:const t=this._activeBuffer.lines.length-this._bufferService.rows;t>0&&(this._activeBuffer.lines.trimStart(t),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-t,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-t,0),this._onScroll.fire(0))}return!0}eraseInLine(t,d=!1){switch(this._restrictCursor(this._bufferService.cols),t.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,d);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,d);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,d)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(t){this._restrictCursor();let d=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const u=this._activeBuffer.ybase+this._activeBuffer.y,f=this._bufferService.rows-1-this._activeBuffer.scrollBottom,p=this._bufferService.rows-1+this._activeBuffer.ybase-f+1;for(;d--;)this._activeBuffer.lines.splice(p-1,1),this._activeBuffer.lines.splice(u,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(t){this._restrictCursor();let d=t.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const u=this._activeBuffer.ybase+this._activeBuffer.y;let f;for(f=this._bufferService.rows-1-this._activeBuffer.scrollBottom,f=this._bufferService.rows-1+this._activeBuffer.ybase-f;d--;)this._activeBuffer.lines.splice(u,1),this._activeBuffer.lines.splice(f,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(t){this._restrictCursor();const d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return d&&(d.insertCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(t){this._restrictCursor();const d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return d&&(d.deleteCells(this._activeBuffer.x,t.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(t){let d=t.params[0]||1;for(;d--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(t){let d=t.params[0]||1;for(;d--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(y.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const d=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.deleteCells(0,d,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const d=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.insertCells(0,d,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const d=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.insertCells(this._activeBuffer.x,d,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(t){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const d=t.params[0]||1;for(let t=this._activeBuffer.scrollTop;t<=this._activeBuffer.scrollBottom;++t){const u=this._activeBuffer.lines.get(this._activeBuffer.ybase+t);u.deleteCells(this._activeBuffer.x,d,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),u.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(t){this._restrictCursor();const d=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return d&&(d.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(t.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(t){if(!this._parser.precedingCodepoint)return!0;const d=t.params[0]||1,u=new Uint32Array(d);for(let t=0;t<d;++t)u[t]=this._parser.precedingCodepoint;return this.print(u,0,u.length),!0}sendDeviceAttributesPrimary(t){return t.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(v.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(v.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(t){return t.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(v.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(v.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(t.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(v.C0.ESC+"[>83;40003;0c")),!0}_is(t){return 0===(this._optionsService.rawOptions.termName+"").indexOf(t)}setMode(t){for(let d=0;d<t.length;d++)switch(t.params[d]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(t){for(let d=0;d<t.length;d++)switch(t.params[d]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,g.DEFAULT_CHARSET),this._charsetService.setgCharset(1,g.DEFAULT_CHARSET),this._charsetService.setgCharset(2,g.DEFAULT_CHARSET),this._charsetService.setgCharset(3,g.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(t){for(let d=0;d<t.length;d++)switch(t.params[d]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(t){for(let d=0;d<t.length;d++)switch(t.params[d]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===t.params[d]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(t,d){const u=this._coreService.decPrivateModes,{activeProtocol:f,activeEncoding:p}=this._coreMouseService,g=this._coreService,{buffers:b,cols:S}=this._bufferService,{active:C,alt:y}=b,w=this._optionsService.rawOptions,x=t=>t?1:2,O=t.params[0];return j=O,k=d?2===O?3:4===O?x(g.modes.insertMode):12===O?4:20===O?x(w.convertEol):0:1===O?x(u.applicationCursorKeys):3===O?w.windowOptions.setWinLines?80===S?2:132===S?1:0:0:6===O?x(u.origin):7===O?x(u.wraparound):8===O?3:9===O?x("X10"===f):12===O?x(w.cursorBlink):25===O?x(!g.isCursorHidden):45===O?x(u.reverseWraparound):66===O?x(u.applicationKeypad):1e3===O?x("VT200"===f):1002===O?x("DRAG"===f):1003===O?x("ANY"===f):1004===O?x(u.sendFocus):1005===O?4:1006===O?x("SGR"===p):1015===O?4:1016===O?x("SGR_PIXELS"===p):1048===O?1:47===O||1047===O||1049===O?x(C===y):2004===O?x(u.bracketedPasteMode):0,g.triggerDataEvent(`${v.C0.ESC}[${d?"":"?"}${j};${k}$y`),!0;var j,k}_updateAttrColor(t,d,u,f,p){return 2===d?(t|=50331648,t&=-16777216,t|=j.AttributeData.fromColorRGB([u,f,p])):5===d&&(t&=-50331904,t|=33554432|255&u),t}_extractColor(t,d,u){const f=[0,0,-1,0,0,0];let p=0,v=0;do{if(f[v+p]=t.params[d+v],t.hasSubParams(d+v)){const u=t.getSubParams(d+v);let g=0;do{5===f[1]&&(p=1),f[v+g+1+p]=u[g]}while(++g<u.length&&g+v+1+p<f.length);break}if(5===f[1]&&v+p>=2||2===f[1]&&v+p>=5)break;f[1]&&(p=1)}while(++v+d<t.length&&v+p<f.length);for(let t=2;t<f.length;++t)-1===f[t]&&(f[t]=0);switch(f[0]){case 38:u.fg=this._updateAttrColor(u.fg,f[1],f[3],f[4],f[5]);break;case 48:u.bg=this._updateAttrColor(u.bg,f[1],f[3],f[4],f[5]);break;case 58:u.extended=u.extended.clone(),u.extended.underlineColor=this._updateAttrColor(u.extended.underlineColor,f[1],f[3],f[4],f[5])}return v}_processUnderline(t,d){d.extended=d.extended.clone(),(!~t||t>5)&&(t=1),d.extended.underlineStyle=t,d.fg|=268435456,0===t&&(d.fg&=-268435457),d.updateExtended()}_processSGR0(t){t.fg=y.DEFAULT_ATTR_DATA.fg,t.bg=y.DEFAULT_ATTR_DATA.bg,t.extended=t.extended.clone(),t.extended.underlineStyle=0,t.extended.underlineColor&=-67108864,t.updateExtended()}charAttributes(t){if(1===t.length&&0===t.params[0])return this._processSGR0(this._curAttrData),!0;const d=t.length;let u;const f=this._curAttrData;for(let p=0;p<d;p++)u=t.params[p],u>=30&&u<=37?(f.fg&=-50331904,f.fg|=16777216|u-30):u>=40&&u<=47?(f.bg&=-50331904,f.bg|=16777216|u-40):u>=90&&u<=97?(f.fg&=-50331904,f.fg|=16777224|u-90):u>=100&&u<=107?(f.bg&=-50331904,f.bg|=16777224|u-100):0===u?this._processSGR0(f):1===u?f.fg|=134217728:3===u?f.bg|=67108864:4===u?(f.fg|=268435456,this._processUnderline(t.hasSubParams(p)?t.getSubParams(p)[0]:1,f)):5===u?f.fg|=536870912:7===u?f.fg|=67108864:8===u?f.fg|=1073741824:9===u?f.fg|=2147483648:2===u?f.bg|=134217728:21===u?this._processUnderline(2,f):22===u?(f.fg&=-134217729,f.bg&=-134217729):23===u?f.bg&=-67108865:24===u?(f.fg&=-268435457,this._processUnderline(0,f)):25===u?f.fg&=-536870913:27===u?f.fg&=-67108865:28===u?f.fg&=-1073741825:29===u?f.fg&=2147483647:39===u?(f.fg&=-67108864,f.fg|=16777215&y.DEFAULT_ATTR_DATA.fg):49===u?(f.bg&=-67108864,f.bg|=16777215&y.DEFAULT_ATTR_DATA.bg):38===u||48===u||58===u?p+=this._extractColor(t,p,f):59===u?(f.extended=f.extended.clone(),f.extended.underlineColor=-1,f.updateExtended()):100===u?(f.fg&=-67108864,f.fg|=16777215&y.DEFAULT_ATTR_DATA.fg,f.bg&=-67108864,f.bg|=16777215&y.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",u);return!0}deviceStatus(t){switch(t.params[0]){case 5:this._coreService.triggerDataEvent(`${v.C0.ESC}[0n`);break;case 6:const t=this._activeBuffer.y+1,d=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${v.C0.ESC}[${t};${d}R`)}return!0}deviceStatusPrivate(t){if(6===t.params[0]){const t=this._activeBuffer.y+1,d=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${v.C0.ESC}[?${t};${d}R`)}return!0}softReset(t){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=y.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(t){const d=t.params[0]||1;switch(d){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const u=d%2==1;return this._optionsService.options.cursorBlink=u,!0}setScrollRegion(t){const d=t.params[0]||1;let u;return(t.length<2||(u=t.params[1])>this._bufferService.rows||0===u)&&(u=this._bufferService.rows),u>d&&(this._activeBuffer.scrollTop=d-1,this._activeBuffer.scrollBottom=u-1,this._setCursor(0,0)),!0}windowOptions(t){if(!M(t.params[0],this._optionsService.rawOptions.windowOptions))return!0;const d=t.length>1?t.params[1]:0;switch(t.params[0]){case 14:2!==d&&this._onRequestWindowsOptionsReport.fire(B.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(B.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${v.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:0!==d&&2!==d||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),0!==d&&1!==d||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:0!==d&&2!==d||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),0!==d&&1!==d||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(t){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(t){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(t){return this._windowTitle=t,this._onTitleChange.fire(t),!0}setIconName(t){return this._iconName=t,!0}setOrReportIndexedColor(t){const d=[],u=t.split(";");for(;u.length>1;){const t=u.shift(),f=u.shift();if(/^\d+$/.exec(t)){const u=parseInt(t);if(0<=u&&u<256)if("?"===f)d.push({type:0,index:u});else{const t=(0,R.parseColor)(f);t&&d.push({type:1,index:u,color:t})}}}return d.length&&this._onColor.fire(d),!0}setHyperlink(t){const d=t.split(";");return!(d.length<2)&&(d[1]?this._createHyperlink(d[0],d[1]):!d[0]&&this._finishHyperlink())}_createHyperlink(t,d){this._getCurrentLinkId()&&this._finishHyperlink();const u=t.split(":");let f;const p=u.findIndex((t=>t.startsWith("id=")));return-1!==p&&(f=u[p].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:f,uri:d}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(t,d){const u=t.split(";");for(let t=0;t<u.length&&!(d>=this._specialColors.length);++t,++d)if("?"===u[t])this._onColor.fire([{type:0,index:this._specialColors[d]}]);else{const f=(0,R.parseColor)(u[t]);f&&this._onColor.fire([{type:1,index:this._specialColors[d],color:f}])}return!0}setOrReportFgColor(t){return this._setOrReportSpecialColor(t,0)}setOrReportBgColor(t){return this._setOrReportSpecialColor(t,1)}setOrReportCursorColor(t){return this._setOrReportSpecialColor(t,2)}restoreIndexedColor(t){if(!t)return this._onColor.fire([{type:2}]),!0;const d=[],u=t.split(";");for(let t=0;t<u.length;++t)if(/^\d+$/.exec(u[t])){const f=parseInt(u[t]);0<=f&&f<256&&d.push({type:2,index:f})}return d.length&&this._onColor.fire(d),!0}restoreFgColor(t){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(t){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(t){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,g.DEFAULT_CHARSET),!0}selectCharset(t){return 2!==t.length?(this.selectDefaultCharset(),!0):("/"===t[0]||this._charsetService.setgCharset(A[t[0]],g.CHARSETS[t[1]]||g.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const t=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,t,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=y.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=y.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(t){return this._charsetService.setgLevel(t),!0}screenAlignmentPattern(){const t=new O.CellData;t.content=1<<22|"E".charCodeAt(0),t.fg=this._curAttrData.fg,t.bg=this._curAttrData.bg,this._setCursor(0,0);for(let d=0;d<this._bufferService.rows;++d){const u=this._activeBuffer.ybase+this._activeBuffer.y+d,f=this._activeBuffer.lines.get(u);f&&(f.fill(t),f.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(t,d){const u=this._bufferService.buffer,f=this._optionsService.rawOptions;return(t=>(this._coreService.triggerDataEvent(`${v.C0.ESC}${t}${v.C0.ESC}\\`),!0))('"q'===t?`P1$r${this._curAttrData.isProtected()?1:0}"q`:'"p'===t?'P1$r61;1"p':"r"===t?`P1$r${u.scrollTop+1};${u.scrollBottom+1}r`:"m"===t?"P1$r0m":" q"===t?`P1$r${{block:2,underline:4,bar:6}[f.cursorStyle]-(f.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(t,d){this._dirtyRowTracker.markRangeDirty(t,d)}}d.InputHandler=E;let H=class{constructor(t){this._bufferService=t,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(t){t<this.start?this.start=t:t>this.end&&(this.end=t)}markRangeDirty(t,d){t>d&&(P=t,t=d,d=P),t<this.start&&(this.start=t),d>this.end&&(this.end=d)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};H=f([p(0,k.IBufferService)],H)},844:(t,d)=>{function u(t){for(const d of t)d.dispose();t.length=0}Object.defineProperty(d,"__esModule",{value:!0}),d.getDisposeArrayDisposable=d.disposeArray=d.toDisposable=d.Disposable=void 0,d.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const t of this._disposables)t.dispose();this._disposables.length=0}register(t){return this._disposables.push(t),t}unregister(t){const d=this._disposables.indexOf(t);-1!==d&&this._disposables.splice(d,1)}},d.toDisposable=function(t){return{dispose:t}},d.disposeArray=u,d.getDisposeArrayDisposable=function(t){return{dispose:()=>u(t)}}},1505:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.FourKeyMap=d.TwoKeyMap=void 0;class i{constructor(){this._data={}}set(t,d,u){this._data[t]||(this._data[t]={}),this._data[t][d]=u}get(t,d){return this._data[t]?this._data[t][d]:void 0}clear(){this._data={}}}d.TwoKeyMap=i,d.FourKeyMap=class{constructor(){this._data=new i}set(t,d,u,f,p){this._data.get(t,d)||this._data.set(t,d,new i),this._data.get(t,d).set(u,f,p)}get(t,d,u,f){var p;return null===(p=this._data.get(t,d))||void 0===p?void 0:p.get(u,f)}clear(){this._data.clear()}}},6114:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.isChromeOS=d.isLinux=d.isWindows=d.isIphone=d.isIpad=d.isMac=d.getSafariVersion=d.isSafari=d.isLegacyEdge=d.isFirefox=d.isNode=void 0,d.isNode="undefined"==typeof navigator;const u=d.isNode?"node":navigator.userAgent,f=d.isNode?"node":navigator.platform;d.isFirefox=u.includes("Firefox"),d.isLegacyEdge=u.includes("Edge"),d.isSafari=/^((?!chrome|android).)*safari/i.test(u),d.getSafariVersion=function(){if(!d.isSafari)return 0;const t=u.match(/Version\/(\d+)/);return null===t||t.length<2?0:parseInt(t[1])},d.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(f),d.isIpad="iPad"===f,d.isIphone="iPhone"===f,d.isWindows=["Windows","Win16","Win32","WinCE"].includes(f),d.isLinux=f.indexOf("Linux")>=0,d.isChromeOS=/\bCrOS\b/.test(u)},6106:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.SortedList=void 0;let u=0;d.SortedList=class{constructor(t){this._getKey=t,this._array=[]}clear(){this._array.length=0}insert(t){0!==this._array.length?(u=this._search(this._getKey(t),0,this._array.length-1),this._array.splice(u,0,t)):this._array.push(t)}delete(t){if(0===this._array.length)return!1;const d=this._getKey(t);if(void 0===d)return!1;if(u=this._search(d,0,this._array.length-1),-1===u)return!1;if(this._getKey(this._array[u])!==d)return!1;do{if(this._array[u]===t)return this._array.splice(u,1),!0}while(++u<this._array.length&&this._getKey(this._array[u])===d);return!1}*getKeyIterator(t){if(0!==this._array.length&&(u=this._search(t,0,this._array.length-1),!(u<0||u>=this._array.length)&&this._getKey(this._array[u])===t))do{yield this._array[u]}while(++u<this._array.length&&this._getKey(this._array[u])===t)}forEachByKey(t,d){if(0!==this._array.length&&(u=this._search(t,0,this._array.length-1),!(u<0||u>=this._array.length)&&this._getKey(this._array[u])===t))do{d(this._array[u])}while(++u<this._array.length&&this._getKey(this._array[u])===t)}values(){return this._array.values()}_search(t,d,u){if(u<d)return d;let f=Math.floor((d+u)/2);const p=this._getKey(this._array[f]);if(p>t)return this._search(t,d,f-1);if(p<t)return this._search(t,f+1,u);for(;f>0&&this._getKey(this._array[f-1])===t;)f--;return f}}},7226:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.DebouncedIdleTask=d.IdleTaskQueue=d.PriorityTaskQueue=void 0;const f=u(6114);class r{constructor(){this._tasks=[],this._i=0}enqueue(t){this._tasks.push(t),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(t){this._idleCallback=void 0;let d=0,u=0,f=t.timeRemaining(),p=0;for(;this._i<this._tasks.length;){if(d=Date.now(),this._tasks[this._i]()||this._i++,d=Math.max(1,Date.now()-d),u=Math.max(d,u),p=t.timeRemaining(),1.5*u>p)return f-d<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(f-d))}ms`),void this._start();f=p}this.clear()}}class n extends r{_requestCallback(t){return setTimeout((()=>t(this._createDeadline(16))))}_cancelCallback(t){clearTimeout(t)}_createDeadline(t){const d=Date.now()+t;return{timeRemaining:()=>Math.max(0,d-Date.now())}}}d.PriorityTaskQueue=n,d.IdleTaskQueue=!f.isNode&&"requestIdleCallback"in window?class extends r{_requestCallback(t){return requestIdleCallback(t)}_cancelCallback(t){cancelIdleCallback(t)}}:n,d.DebouncedIdleTask=class{constructor(){this._queue=new d.IdleTaskQueue}set(t){this._queue.clear(),this._queue.enqueue(t)}flush(){this._queue.flush()}}},9282:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.updateWindowsModeWrappedState=void 0;const f=u(643);d.updateWindowsModeWrappedState=function(t){const d=t.buffer.lines.get(t.buffer.ybase+t.buffer.y-1),u=null==d?void 0:d.get(t.cols-1),p=t.buffer.lines.get(t.buffer.ybase+t.buffer.y);p&&u&&(p.isWrapped=u[f.CHAR_DATA_CODE_INDEX]!==f.NULL_CELL_CODE&&u[f.CHAR_DATA_CODE_INDEX]!==f.WHITESPACE_CELL_CODE)}},3734:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ExtendedAttrs=d.AttributeData=void 0;class i{constructor(){this.fg=0,this.bg=0,this.extended=new s}static toColorRGB(t){return[t>>>16&255,t>>>8&255,255&t]}static fromColorRGB(t){return(255&t[0])<<16|(255&t[1])<<8|255&t[2]}clone(){const t=new i;return t.fg=this.fg,t.bg=this.bg,t.extended=this.extended.clone(),t}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return!(50331648&~this.fg)}isBgRGB(){return!(50331648&~this.bg)}isFgPalette(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)}isBgPalette(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)}isFgDefault(){return!(50331648&this.fg)}isBgDefault(){return!(50331648&this.bg)}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&~this.extended.underlineColor):this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?!(50331648&this.extended.underlineColor):this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}d.AttributeData=i;class s{constructor(t=0,d=0){this._ext=0,this._urlId=0,this._ext=t,this._urlId=d}get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(t){this._ext=t}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(t){this._ext&=-469762049,this._ext|=t<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(t){this._ext&=-67108864,this._ext|=67108863&t}get urlId(){return this._urlId}set urlId(t){this._urlId=t}clone(){return new s(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}}d.ExtendedAttrs=s},9092:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferStringIterator=d.Buffer=d.MAX_BUFFER_SIZE=void 0;const f=u(6349),p=u(8437),v=u(511),g=u(643),b=u(4634),S=u(4863),C=u(7116),y=u(3734),w=u(7226);d.MAX_BUFFER_SIZE=4294967295,d.Buffer=class{constructor(t,d,u){this._hasScrollback=t,this._optionsService=d,this._bufferService=u,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=p.DEFAULT_ATTR_DATA.clone(),this.savedCharset=C.DEFAULT_CHARSET,this.markers=[],this._nullCell=v.CellData.fromCharData([0,g.NULL_CELL_CHAR,g.NULL_CELL_WIDTH,g.NULL_CELL_CODE]),this._whitespaceCell=v.CellData.fromCharData([0,g.WHITESPACE_CELL_CHAR,g.WHITESPACE_CELL_WIDTH,g.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new w.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new f.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new y.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new y.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,d){return new p.BufferLine(this._bufferService.cols,this.getNullCell(t),d)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;const u=t+this._optionsService.rawOptions.scrollback;return u>d.MAX_BUFFER_SIZE?d.MAX_BUFFER_SIZE:u}fillViewportRows(t){if(0===this.lines.length){void 0===t&&(t=p.DEFAULT_ATTR_DATA);let d=this._rows;for(;d--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new f.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,d){const u=this.getNullCell(p.DEFAULT_ATTR_DATA);let f=0;const v=this._getCorrectBufferLength(d);if(v>this.lines.maxLength&&(this.lines.maxLength=v),this.lines.length>0){if(this._cols<t)for(let d=0;d<this.lines.length;d++)f+=+this.lines.get(d).resize(t,u);let g=0;if(this._rows<d)for(let f=this._rows;f<d;f++)this.lines.length<d+this.ybase&&(this._optionsService.rawOptions.windowsMode?this.lines.push(new p.BufferLine(t,u)):this.ybase>0&&this.lines.length<=this.ybase+this.y+g+1?(this.ybase--,g++,this.ydisp>0&&this.ydisp--):this.lines.push(new p.BufferLine(t,u)));else for(let t=this._rows;t>d;t--)this.lines.length>d+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(v<this.lines.maxLength){const t=this.lines.length-v;t>0&&(this.lines.trimStart(t),this.ybase=Math.max(this.ybase-t,0),this.ydisp=Math.max(this.ydisp-t,0),this.savedY=Math.max(this.savedY-t,0)),this.lines.maxLength=v}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,d-1),g&&(this.y+=g),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=d-1,this._isReflowEnabled&&(this._reflow(t,d),this._cols>t))for(let d=0;d<this.lines.length;d++)f+=+this.lines.get(d).resize(t,u);this._cols=t,this._rows=d,this._memoryCleanupQueue.clear(),f>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let d=0;for(;this._memoryCleanupPosition<this.lines.length;)if(d+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),d>100)return!0;return t}get _isReflowEnabled(){return this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,d){this._cols!==t&&(t>this._cols?this._reflowLarger(t,d):this._reflowSmaller(t,d))}_reflowLarger(t,d){const u=(0,b.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(p.DEFAULT_ATTR_DATA));if(u.length>0){const f=(0,b.reflowLargerCreateNewLayout)(this.lines,u);(0,b.reflowLargerApplyNewLayout)(this.lines,f.layout),this._reflowLargerAdjustViewport(t,d,f.countRemoved)}}_reflowLargerAdjustViewport(t,d,u){const f=this.getNullCell(p.DEFAULT_ATTR_DATA);let v=u;for(;v-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<d&&this.lines.push(new p.BufferLine(t,f))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-u,0)}_reflowSmaller(t,d){const u=this.getNullCell(p.DEFAULT_ATTR_DATA),f=[];let v=0;for(let g=this.lines.length-1;g>=0;g--){let S=this.lines.get(g);if(!S||!S.isWrapped&&S.getTrimmedLength()<=t)continue;const C=[S];for(;S.isWrapped&&g>0;)S=this.lines.get(--g),C.unshift(S);const y=this.ybase+this.y;if(y>=g&&y<g+C.length)continue;const w=C[C.length-1].getTrimmedLength(),x=(0,b.reflowSmallerGetNewLineLengths)(C,this._cols,t),O=x.length-C.length;let j;j=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+O):Math.max(0,this.lines.length-this.lines.maxLength+O);const k=[];for(let t=0;t<O;t++){const t=this.getBlankLine(p.DEFAULT_ATTR_DATA,!0);k.push(t)}k.length>0&&(f.push({start:g+C.length+v,newLines:k}),v+=k.length),C.push(...k);let T=x.length-1,L=x[T];0===L&&(T--,L=x[T]);let R=C.length-O-1,A=w;for(;R>=0;){const t=Math.min(A,L);if(void 0===C[T])break;if(C[T].copyCellsFrom(C[R],A-t,L-t,t,!0),L-=t,0===L&&(T--,L=x[T]),A-=t,0===A){R--;const t=Math.max(R,0);A=(0,b.getWrappedLineTrimmedLength)(C,t,this._cols)}}for(let d=0;d<C.length;d++)x[d]<t&&C[d].setCell(x[d],u);let D=O-j;for(;D-- >0;)0===this.ybase?this.y<d-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+v)-d&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+O,this.ybase+d-1)}if(f.length>0){const t=[],d=[];for(let t=0;t<this.lines.length;t++)d.push(this.lines.get(t));const u=this.lines.length;let p=u-1,g=0,b=f[g];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+v);let S=0;for(let C=Math.min(this.lines.maxLength-1,u+v-1);C>=0;C--)if(b&&b.start>p+S){for(let t=b.newLines.length-1;t>=0;t--)this.lines.set(C--,b.newLines[t]);C++,t.push({index:p+1,amount:b.newLines.length}),S+=b.newLines.length,b=f[++g]}else this.lines.set(C,d[p--]);let C=0;for(let d=t.length-1;d>=0;d--)t[d].index+=C,this.lines.onInsertEmitter.fire(t[d]),C+=t[d].amount;const y=Math.max(0,u+v-this.lines.maxLength);y>0&&this.lines.onTrimEmitter.fire(y)}}stringIndexToBufferIndex(t,d,u=!1){for(;d;){const f=this.lines.get(t);if(!f)return[-1,-1];const p=u?f.getTrimmedLength():f.length;for(let u=0;u<p;++u)if(f.get(u)[g.CHAR_DATA_WIDTH_INDEX]&&(d-=f.get(u)[g.CHAR_DATA_CHAR_INDEX].length||1),d<0)return[t,u];t++}return[t,0]}translateBufferLineToString(t,d,u=0,f){const p=this.lines.get(t);return p?p.translateToString(d,u,f):""}getWrappedRangeForLine(t){let d=t,u=t;for(;d>0&&this.lines.get(d).isWrapped;)d--;for(;u+1<this.lines.length&&this.lines.get(u+1).isWrapped;)u++;return{first:d,last:u}}setupTabStops(t){for(null!=t?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(null==t&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(null==t&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let d=0;d<this.markers.length;d++)this.markers[d].line===t&&(this.markers[d].dispose(),this.markers.splice(d--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){const d=new S.Marker(t);return this.markers.push(d),d.register(this.lines.onTrim((t=>{d.line-=t,d.line<0&&d.dispose()}))),d.register(this.lines.onInsert((t=>{d.line>=t.index&&(d.line+=t.amount)}))),d.register(this.lines.onDelete((t=>{d.line>=t.index&&d.line<t.index+t.amount&&d.dispose(),d.line>t.index&&(d.line-=t.amount)}))),d.register(d.onDispose((()=>this._removeMarker(d)))),d}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}iterator(t,d,u,f,p){return new _(this,t,d,u,f,p)}};class _{constructor(t,d,u=0,f=t.lines.length,p=0,v=0){this._buffer=t,this._trimRight=d,this._startIndex=u,this._endIndex=f,this._startOverscan=p,this._endOverscan=v,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}hasNext(){return this._current<this._endIndex}next(){const t=this._buffer.getWrappedRangeForLine(this._current);t.first<this._startIndex-this._startOverscan&&(t.first=this._startIndex-this._startOverscan),t.last>this._endIndex+this._endOverscan&&(t.last=this._endIndex+this._endOverscan),t.first=Math.max(t.first,0),t.last=Math.min(t.last,this._buffer.lines.length);let d="";for(let u=t.first;u<=t.last;++u)d+=this._buffer.translateBufferLineToString(u,this._trimRight);return this._current=t.last+1,{range:t,content:d}}}d.BufferStringIterator=_},8437:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferLine=d.DEFAULT_ATTR_DATA=void 0;const f=u(482),p=u(643),v=u(511),g=u(3734);d.DEFAULT_ATTR_DATA=Object.freeze(new g.AttributeData);let b=0;class h{constructor(t,d,u=!1){this.isWrapped=u,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*t);const f=d||v.CellData.fromCharData([0,p.NULL_CELL_CHAR,p.NULL_CELL_WIDTH,p.NULL_CELL_CODE]);for(let d=0;d<t;++d)this.setCell(d,f);this.length=t}get(t){const d=this._data[3*t+0],u=2097151&d;return[this._data[3*t+1],2097152&d?this._combined[t]:u?(0,f.stringFromCodePoint)(u):"",d>>22,2097152&d?this._combined[t].charCodeAt(this._combined[t].length-1):u]}set(t,d){this._data[3*t+1]=d[p.CHAR_DATA_ATTR_INDEX],d[p.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[t]=d[1],this._data[3*t+0]=2097152|t|d[p.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*t+0]=d[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|d[p.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(t){return this._data[3*t+0]>>22}hasWidth(t){return 12582912&this._data[3*t+0]}getFg(t){return this._data[3*t+1]}getBg(t){return this._data[3*t+2]}hasContent(t){return 4194303&this._data[3*t+0]}getCodePoint(t){const d=this._data[3*t+0];return 2097152&d?this._combined[t].charCodeAt(this._combined[t].length-1):2097151&d}isCombined(t){return 2097152&this._data[3*t+0]}getString(t){const d=this._data[3*t+0];return 2097152&d?this._combined[t]:2097151&d?(0,f.stringFromCodePoint)(2097151&d):""}isProtected(t){return 536870912&this._data[3*t+2]}loadCell(t,d){return b=3*t,d.content=this._data[b+0],d.fg=this._data[b+1],d.bg=this._data[b+2],2097152&d.content&&(d.combinedData=this._combined[t]),268435456&d.bg&&(d.extended=this._extendedAttrs[t]),d}setCell(t,d){2097152&d.content&&(this._combined[t]=d.combinedData),268435456&d.bg&&(this._extendedAttrs[t]=d.extended),this._data[3*t+0]=d.content,this._data[3*t+1]=d.fg,this._data[3*t+2]=d.bg}setCellFromCodePoint(t,d,u,f,p,v){268435456&p&&(this._extendedAttrs[t]=v),this._data[3*t+0]=d|u<<22,this._data[3*t+1]=f,this._data[3*t+2]=p}addCodepointToCell(t,d){let u=this._data[3*t+0];2097152&u?this._combined[t]+=(0,f.stringFromCodePoint)(d):(2097151&u?(this._combined[t]=(0,f.stringFromCodePoint)(2097151&u)+(0,f.stringFromCodePoint)(d),u&=-2097152,u|=2097152):u=d|1<<22,this._data[3*t+0]=u)}insertCells(t,d,u,f){if((t%=this.length)&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs),d<this.length-t){const f=new v.CellData;for(let u=this.length-t-d-1;u>=0;--u)this.setCell(t+d+u,this.loadCell(t+u,f));for(let f=0;f<d;++f)this.setCell(t+f,u)}else for(let d=t;d<this.length;++d)this.setCell(d,u);2===this.getWidth(this.length-1)&&this.setCellFromCodePoint(this.length-1,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs)}deleteCells(t,d,u,f){if(t%=this.length,d<this.length-t){const f=new v.CellData;for(let u=0;u<this.length-t-d;++u)this.setCell(t+u,this.loadCell(t+d+u,f));for(let t=this.length-d;t<this.length;++t)this.setCell(t,u)}else for(let d=t;d<this.length;++d)this.setCell(d,u);t&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs),0!==this.getWidth(t)||this.hasContent(t)||this.setCellFromCodePoint(t,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs)}replaceCells(t,d,u,f,p=!1){if(p)for(t&&2===this.getWidth(t-1)&&!this.isProtected(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs),d<this.length&&2===this.getWidth(d-1)&&!this.isProtected(d)&&this.setCellFromCodePoint(d,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs);t<d&&t<this.length;)this.isProtected(t)||this.setCell(t,u),t++;else for(t&&2===this.getWidth(t-1)&&this.setCellFromCodePoint(t-1,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs),d<this.length&&2===this.getWidth(d-1)&&this.setCellFromCodePoint(d,0,1,(null==f?void 0:f.fg)||0,(null==f?void 0:f.bg)||0,(null==f?void 0:f.extended)||new g.ExtendedAttrs);t<d&&t<this.length;)this.setCell(t++,u)}resize(t,d){if(t===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const u=3*t;if(t>this.length){if(this._data.buffer.byteLength>=4*u)this._data=new Uint32Array(this._data.buffer,0,u);else{const t=new Uint32Array(u);t.set(this._data),this._data=t}for(let u=this.length;u<t;++u)this.setCell(u,d)}else{this._data=this._data.subarray(0,u);const d=Object.keys(this._combined);for(let u=0;u<d.length;u++){const f=parseInt(d[u],10);f>=t&&delete this._combined[f]}const f=Object.keys(this._extendedAttrs);for(let d=0;d<f.length;d++){const u=parseInt(f[d],10);u>=t&&delete this._extendedAttrs[u]}}return this.length=t,4*u*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const t=new Uint32Array(this._data.length);return t.set(this._data),this._data=t,1}return 0}fill(t,d=!1){if(d)for(let d=0;d<this.length;++d)this.isProtected(d)||this.setCell(d,t);else{this._combined={},this._extendedAttrs={};for(let d=0;d<this.length;++d)this.setCell(d,t)}}copyFrom(t){this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={};for(const d in t._combined)this._combined[d]=t._combined[d];this._extendedAttrs={};for(const d in t._extendedAttrs)this._extendedAttrs[d]=t._extendedAttrs[d];this.isWrapped=t.isWrapped}clone(){const t=new h(0);t._data=new Uint32Array(this._data),t.length=this.length;for(const d in this._combined)t._combined[d]=this._combined[d];for(const d in this._extendedAttrs)t._extendedAttrs[d]=this._extendedAttrs[d];return t.isWrapped=this.isWrapped,t}getTrimmedLength(){for(let t=this.length-1;t>=0;--t)if(4194303&this._data[3*t+0])return t+(this._data[3*t+0]>>22);return 0}copyCellsFrom(t,d,u,f,p){const v=t._data;if(p)for(let p=f-1;p>=0;p--){for(let t=0;t<3;t++)this._data[3*(u+p)+t]=v[3*(d+p)+t];268435456&v[3*(d+p)+2]&&(this._extendedAttrs[u+p]=t._extendedAttrs[d+p])}else for(let p=0;p<f;p++){for(let t=0;t<3;t++)this._data[3*(u+p)+t]=v[3*(d+p)+t];268435456&v[3*(d+p)+2]&&(this._extendedAttrs[u+p]=t._extendedAttrs[d+p])}const g=Object.keys(t._combined);for(let f=0;f<g.length;f++){const p=parseInt(g[f],10);p>=d&&(this._combined[p-d+u]=t._combined[p])}}translateToString(t=!1,d=0,u=this.length){t&&(u=Math.min(u,this.getTrimmedLength()));let v="";for(;d<u;){const t=this._data[3*d+0],u=2097151&t;v+=2097152&t?this._combined[d]:u?(0,f.stringFromCodePoint)(u):p.WHITESPACE_CELL_CHAR,d+=t>>22||1}return v}}d.BufferLine=h},4841:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.getRangeLength=void 0,d.getRangeLength=function(t,d){if(t.start.y>t.end.y)throw new Error(`Buffer range end (${t.end.x}, ${t.end.y}) cannot be before start (${t.start.x}, ${t.start.y})`);return d*(t.end.y-t.start.y)+(t.end.x-t.start.x+1)}},4634:(t,d)=>{function u(t,d,u){if(d===t.length-1)return t[d].getTrimmedLength();const f=!t[d].hasContent(u-1)&&1===t[d].getWidth(u-1),p=2===t[d+1].getWidth(0);return f&&p?u-1:u}Object.defineProperty(d,"__esModule",{value:!0}),d.getWrappedLineTrimmedLength=d.reflowSmallerGetNewLineLengths=d.reflowLargerApplyNewLayout=d.reflowLargerCreateNewLayout=d.reflowLargerGetLinesToRemove=void 0,d.reflowLargerGetLinesToRemove=function(t,d,f,p,v){const g=[];for(let b=0;b<t.length-1;b++){let S=b,C=t.get(++S);if(!C.isWrapped)continue;const y=[t.get(b)];for(;S<t.length&&C.isWrapped;)y.push(C),C=t.get(++S);if(p>=b&&p<S){b+=y.length-1;continue}let w=0,x=u(y,w,d),O=1,j=0;for(;O<y.length;){const t=u(y,O,d),p=t-j,g=f-x,b=Math.min(p,g);y[w].copyCellsFrom(y[O],j,x,b,!1),x+=b,x===f&&(w++,x=0),j+=b,j===t&&(O++,j=0),0===x&&0!==w&&2===y[w-1].getWidth(f-1)&&(y[w].copyCellsFrom(y[w-1],f-1,x++,1,!1),y[w-1].setCell(f-1,v))}y[w].replaceCells(x,f,v);let k=0;for(let t=y.length-1;t>0&&(t>w||0===y[t].getTrimmedLength());t--)k++;k>0&&(g.push(b+y.length-k),g.push(k)),b+=y.length-1}return g},d.reflowLargerCreateNewLayout=function(t,d){const u=[];let f=0,p=d[f],v=0;for(let g=0;g<t.length;g++)if(p===g){const u=d[++f];t.onDeleteEmitter.fire({index:g-v,amount:u}),g+=u-1,v+=u,p=d[++f]}else u.push(g);return{layout:u,countRemoved:v}},d.reflowLargerApplyNewLayout=function(t,d){const u=[];for(let f=0;f<d.length;f++)u.push(t.get(d[f]));for(let d=0;d<u.length;d++)t.set(d,u[d]);t.length=d.length},d.reflowSmallerGetNewLineLengths=function(t,d,f){const p=[],v=t.map(((f,p)=>u(t,p,d))).reduce(((t,d)=>t+d));let g=0,b=0,S=0;for(;S<v;){if(v-S<f){p.push(v-S);break}g+=f;const C=u(t,b,d);g>C&&(g-=C,b++);const y=2===t[b].getWidth(g-1);y&&g--;const w=y?f-1:f;p.push(w),S+=w}return p},d.getWrappedLineTrimmedLength=u},5295:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferSet=void 0;const f=u(9092),p=u(8460),v=u(844);class o extends v.Disposable{constructor(t,d){super(),this._optionsService=t,this._bufferService=d,this._onBufferActivate=this.register(new p.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new f.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new f.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(t){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(t),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(t,d){this._normal.resize(t,d),this._alt.resize(t,d),this.setupTabStops(t)}setupTabStops(t){this._normal.setupTabStops(t),this._alt.setupTabStops(t)}}d.BufferSet=o},511:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.CellData=void 0;const f=u(482),p=u(643),v=u(3734);class o extends v.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new v.ExtendedAttrs,this.combinedData=""}static fromCharData(t){const d=new o;return d.setFromCharData(t),d}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,f.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(t){this.fg=t[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let d=!1;if(t[p.CHAR_DATA_CHAR_INDEX].length>2)d=!0;else if(2===t[p.CHAR_DATA_CHAR_INDEX].length){const u=t[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=u&&u<=56319){const f=t[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=f&&f<=57343?this.content=1024*(u-55296)+f-56320+65536|t[p.CHAR_DATA_WIDTH_INDEX]<<22:d=!0}else d=!0}else this.content=t[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[p.CHAR_DATA_WIDTH_INDEX]<<22;d&&(this.combinedData=t[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|t[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}d.CellData=o},643:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.WHITESPACE_CELL_CODE=d.WHITESPACE_CELL_WIDTH=d.WHITESPACE_CELL_CHAR=d.NULL_CELL_CODE=d.NULL_CELL_WIDTH=d.NULL_CELL_CHAR=d.CHAR_DATA_CODE_INDEX=d.CHAR_DATA_WIDTH_INDEX=d.CHAR_DATA_CHAR_INDEX=d.CHAR_DATA_ATTR_INDEX=d.DEFAULT_EXT=d.DEFAULT_ATTR=d.DEFAULT_COLOR=void 0,d.DEFAULT_COLOR=0,d.DEFAULT_ATTR=256|d.DEFAULT_COLOR<<9,d.DEFAULT_EXT=0,d.CHAR_DATA_ATTR_INDEX=0,d.CHAR_DATA_CHAR_INDEX=1,d.CHAR_DATA_WIDTH_INDEX=2,d.CHAR_DATA_CODE_INDEX=3,d.NULL_CELL_CHAR="",d.NULL_CELL_WIDTH=1,d.NULL_CELL_CODE=0,d.WHITESPACE_CELL_CHAR=" ",d.WHITESPACE_CELL_WIDTH=1,d.WHITESPACE_CELL_CODE=32},4863:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.Marker=void 0;const f=u(8460),p=u(844);class n{constructor(t){this.line=t,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new f.EventEmitter),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(t){return this._disposables.push(t),t}}d.Marker=n,n._nextId=1},7116:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.DEFAULT_CHARSET=d.CHARSETS=void 0,d.CHARSETS={},d.DEFAULT_CHARSET=d.CHARSETS.B,d.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},d.CHARSETS.A={"#":"£"},d.CHARSETS.B=void 0,d.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},d.CHARSETS.C=d.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},d.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},d.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},d.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},d.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},d.CHARSETS.E=d.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},d.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},d.CHARSETS.H=d.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},d.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(t,d)=>{var u,f;Object.defineProperty(d,"__esModule",{value:!0}),d.C1_ESCAPED=d.C1=d.C0=void 0,function(t){t.NUL="\0",t.SOH="",t.STX="",t.ETX="",t.EOT="",t.ENQ="",t.ACK="",t.BEL="",t.BS="\b",t.HT="\t",t.LF="\n",t.VT="\v",t.FF="\f",t.CR="\r",t.SO="",t.SI="",t.DLE="",t.DC1="",t.DC2="",t.DC3="",t.DC4="",t.NAK="",t.SYN="",t.ETB="",t.CAN="",t.EM="",t.SUB="",t.ESC="",t.FS="",t.GS="",t.RS="",t.US="",t.SP=" ",t.DEL=""}(u=d.C0||(d.C0={})),(f=d.C1||(d.C1={})).PAD="",f.HOP="",f.BPH="",f.NBH="",f.IND="",f.NEL="",f.SSA="",f.ESA="",f.HTS="",f.HTJ="",f.VTS="",f.PLD="",f.PLU="",f.RI="",f.SS2="",f.SS3="",f.DCS="",f.PU1="",f.PU2="",f.STS="",f.CCH="",f.MW="",f.SPA="",f.EPA="",f.SOS="",f.SGCI="",f.SCI="",f.CSI="",f.ST="",f.OSC="",f.PM="",f.APC="",(d.C1_ESCAPED||(d.C1_ESCAPED={})).ST=`${u.ESC}\\`},7399:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.evaluateKeyboardEvent=void 0;const f=u(2584),p={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};d.evaluateKeyboardEvent=function(t,d,u,v){const g={type:0,cancel:!1,key:void 0},b=(t.shiftKey?1:0)|(t.altKey?2:0)|(t.ctrlKey?4:0)|(t.metaKey?8:0);switch(t.keyCode){case 0:"UIKeyInputUpArrow"===t.key?g.key=d?f.C0.ESC+"OA":f.C0.ESC+"[A":"UIKeyInputLeftArrow"===t.key?g.key=d?f.C0.ESC+"OD":f.C0.ESC+"[D":"UIKeyInputRightArrow"===t.key?g.key=d?f.C0.ESC+"OC":f.C0.ESC+"[C":"UIKeyInputDownArrow"===t.key&&(g.key=d?f.C0.ESC+"OB":f.C0.ESC+"[B");break;case 8:if(t.altKey){g.key=f.C0.ESC+f.C0.DEL;break}g.key=f.C0.DEL;break;case 9:if(t.shiftKey){g.key=f.C0.ESC+"[Z";break}g.key=f.C0.HT,g.cancel=!0;break;case 13:g.key=t.altKey?f.C0.ESC+f.C0.CR:f.C0.CR,g.cancel=!0;break;case 27:g.key=f.C0.ESC,t.altKey&&(g.key=f.C0.ESC+f.C0.ESC),g.cancel=!0;break;case 37:if(t.metaKey)break;b?(g.key=f.C0.ESC+"[1;"+(b+1)+"D",g.key===f.C0.ESC+"[1;3D"&&(g.key=f.C0.ESC+(u?"b":"[1;5D"))):g.key=d?f.C0.ESC+"OD":f.C0.ESC+"[D";break;case 39:if(t.metaKey)break;b?(g.key=f.C0.ESC+"[1;"+(b+1)+"C",g.key===f.C0.ESC+"[1;3C"&&(g.key=f.C0.ESC+(u?"f":"[1;5C"))):g.key=d?f.C0.ESC+"OC":f.C0.ESC+"[C";break;case 38:if(t.metaKey)break;b?(g.key=f.C0.ESC+"[1;"+(b+1)+"A",u||g.key!==f.C0.ESC+"[1;3A"||(g.key=f.C0.ESC+"[1;5A")):g.key=d?f.C0.ESC+"OA":f.C0.ESC+"[A";break;case 40:if(t.metaKey)break;b?(g.key=f.C0.ESC+"[1;"+(b+1)+"B",u||g.key!==f.C0.ESC+"[1;3B"||(g.key=f.C0.ESC+"[1;5B")):g.key=d?f.C0.ESC+"OB":f.C0.ESC+"[B";break;case 45:t.shiftKey||t.ctrlKey||(g.key=f.C0.ESC+"[2~");break;case 46:g.key=b?f.C0.ESC+"[3;"+(b+1)+"~":f.C0.ESC+"[3~";break;case 36:g.key=b?f.C0.ESC+"[1;"+(b+1)+"H":d?f.C0.ESC+"OH":f.C0.ESC+"[H";break;case 35:g.key=b?f.C0.ESC+"[1;"+(b+1)+"F":d?f.C0.ESC+"OF":f.C0.ESC+"[F";break;case 33:t.shiftKey?g.type=2:t.ctrlKey?g.key=f.C0.ESC+"[5;"+(b+1)+"~":g.key=f.C0.ESC+"[5~";break;case 34:t.shiftKey?g.type=3:t.ctrlKey?g.key=f.C0.ESC+"[6;"+(b+1)+"~":g.key=f.C0.ESC+"[6~";break;case 112:g.key=b?f.C0.ESC+"[1;"+(b+1)+"P":f.C0.ESC+"OP";break;case 113:g.key=b?f.C0.ESC+"[1;"+(b+1)+"Q":f.C0.ESC+"OQ";break;case 114:g.key=b?f.C0.ESC+"[1;"+(b+1)+"R":f.C0.ESC+"OR";break;case 115:g.key=b?f.C0.ESC+"[1;"+(b+1)+"S":f.C0.ESC+"OS";break;case 116:g.key=b?f.C0.ESC+"[15;"+(b+1)+"~":f.C0.ESC+"[15~";break;case 117:g.key=b?f.C0.ESC+"[17;"+(b+1)+"~":f.C0.ESC+"[17~";break;case 118:g.key=b?f.C0.ESC+"[18;"+(b+1)+"~":f.C0.ESC+"[18~";break;case 119:g.key=b?f.C0.ESC+"[19;"+(b+1)+"~":f.C0.ESC+"[19~";break;case 120:g.key=b?f.C0.ESC+"[20;"+(b+1)+"~":f.C0.ESC+"[20~";break;case 121:g.key=b?f.C0.ESC+"[21;"+(b+1)+"~":f.C0.ESC+"[21~";break;case 122:g.key=b?f.C0.ESC+"[23;"+(b+1)+"~":f.C0.ESC+"[23~";break;case 123:g.key=b?f.C0.ESC+"[24;"+(b+1)+"~":f.C0.ESC+"[24~";break;default:if(!t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)if(u&&!v||!t.altKey||t.metaKey)!u||t.altKey||t.ctrlKey||t.shiftKey||!t.metaKey?t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.keyCode>=48&&1===t.key.length?g.key=t.key:t.key&&t.ctrlKey&&("_"===t.key&&(g.key=f.C0.US),"@"===t.key&&(g.key=f.C0.NUL)):65===t.keyCode&&(g.type=1);else{const d=p[t.keyCode],u=null==d?void 0:d[t.shiftKey?1:0];if(u)g.key=f.C0.ESC+u;else if(t.keyCode>=65&&t.keyCode<=90){const d=t.ctrlKey?t.keyCode-64:t.keyCode+32;let u=String.fromCharCode(d);t.shiftKey&&(u=u.toUpperCase()),g.key=f.C0.ESC+u}else if(32===t.keyCode)g.key=f.C0.ESC+(t.ctrlKey?f.C0.NUL:" ");else if("Dead"===t.key&&t.code.startsWith("Key")){let d=t.code.slice(3,4);t.shiftKey||(d=d.toLowerCase()),g.key=f.C0.ESC+d,g.cancel=!0}}else t.keyCode>=65&&t.keyCode<=90?g.key=String.fromCharCode(t.keyCode-64):32===t.keyCode?g.key=f.C0.NUL:t.keyCode>=51&&t.keyCode<=55?g.key=String.fromCharCode(t.keyCode-51+27):56===t.keyCode?g.key=f.C0.DEL:219===t.keyCode?g.key=f.C0.ESC:220===t.keyCode?g.key=f.C0.FS:221===t.keyCode&&(g.key=f.C0.GS)}return g}},482:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.Utf8ToUtf32=d.StringToUtf32=d.utf32ToString=d.stringFromCodePoint=void 0,d.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},d.utf32ToString=function(t,d=0,u=t.length){let f="";for(let p=d;p<u;++p){let d=t[p];d>65535?(d-=65536,f+=String.fromCharCode(55296+(d>>10))+String.fromCharCode(d%1024+56320)):f+=String.fromCharCode(d)}return f},d.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(t,d){const u=t.length;if(!u)return 0;let f=0,p=0;if(this._interim){const u=t.charCodeAt(p++);56320<=u&&u<=57343?d[f++]=1024*(this._interim-55296)+u-56320+65536:(d[f++]=this._interim,d[f++]=u),this._interim=0}for(let v=p;v<u;++v){const p=t.charCodeAt(v);if(55296<=p&&p<=56319){if(++v>=u)return this._interim=p,f;const g=t.charCodeAt(v);56320<=g&&g<=57343?d[f++]=1024*(p-55296)+g-56320+65536:(d[f++]=p,d[f++]=g)}else 65279!==p&&(d[f++]=p)}return f}},d.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(t,d){const u=t.length;if(!u)return 0;let f,p,v,g,b=0,S=0,C=0;if(this.interim[0]){let f=!1,p=this.interim[0];p&=192==(224&p)?31:224==(240&p)?15:7;let v,g=0;for(;(v=63&this.interim[++g])&&g<4;)p<<=6,p|=v;const S=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,y=S-g;for(;C<y;){if(C>=u)return 0;if(v=t[C++],128!=(192&v)){C--,f=!0;break}this.interim[g++]=v,p<<=6,p|=63&v}f||(2===S?p<128?C--:d[b++]=p:3===S?p<2048||p>=55296&&p<=57343||65279===p||(d[b++]=p):p<65536||p>1114111||(d[b++]=p)),this.interim.fill(0)}const y=u-4;let w=C;for(;w<u;){for(;!(!(w<y)||128&(f=t[w])||128&(p=t[w+1])||128&(v=t[w+2])||128&(g=t[w+3]));)d[b++]=f,d[b++]=p,d[b++]=v,d[b++]=g,w+=4;if(f=t[w++],f<128)d[b++]=f;else if(192==(224&f)){if(w>=u)return this.interim[0]=f,b;if(p=t[w++],128!=(192&p)){w--;continue}if(S=(31&f)<<6|63&p,S<128){w--;continue}d[b++]=S}else if(224==(240&f)){if(w>=u)return this.interim[0]=f,b;if(p=t[w++],128!=(192&p)){w--;continue}if(w>=u)return this.interim[0]=f,this.interim[1]=p,b;if(v=t[w++],128!=(192&v)){w--;continue}if(S=(15&f)<<12|(63&p)<<6|63&v,S<2048||S>=55296&&S<=57343||65279===S)continue;d[b++]=S}else if(240==(248&f)){if(w>=u)return this.interim[0]=f,b;if(p=t[w++],128!=(192&p)){w--;continue}if(w>=u)return this.interim[0]=f,this.interim[1]=p,b;if(v=t[w++],128!=(192&v)){w--;continue}if(w>=u)return this.interim[0]=f,this.interim[1]=p,this.interim[2]=v,b;if(g=t[w++],128!=(192&g)){w--;continue}if(S=(7&f)<<18|(63&p)<<12|(63&v)<<6|63&g,S<65536||S>1114111)continue;d[b++]=S}}return b}}},225:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.UnicodeV6=void 0;const u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],f=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let p;d.UnicodeV6=class{constructor(){if(this.version="6",!p){p=new Uint8Array(65536),p.fill(1),p[0]=0,p.fill(0,1,32),p.fill(0,127,160),p.fill(2,4352,4448),p[9001]=2,p[9002]=2,p.fill(2,11904,42192),p[12351]=1,p.fill(2,44032,55204),p.fill(2,63744,64256),p.fill(2,65040,65050),p.fill(2,65072,65136),p.fill(2,65280,65377),p.fill(2,65504,65511);for(let t=0;t<u.length;++t)p.fill(0,u[t][0],u[t][1]+1)}}wcwidth(t){return t<32?0:t<127?1:t<65536?p[t]:function(t,d){let u,f=0,p=d.length-1;if(t<d[0][0]||t>d[p][1])return!1;for(;p>=f;)if(u=f+p>>1,t>d[u][1])f=u+1;else{if(!(t<d[u][0]))return!0;p=u-1}return!1}(t,f)?0:t>=131072&&t<=196605||t>=196608&&t<=262141?2:1}}},5981:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.WriteBuffer=void 0;const f=u(8460),p=u(844);class n extends p.Disposable{constructor(t){super(),this._action=t,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new f.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(t,d){if(void 0!==d&&this._syncCalls>d)return void(this._syncCalls=0);if(this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let u;for(this._isSyncWriting=!0;u=this._writeBuffer.shift();){this._action(u);const t=this._callbacks.shift();t&&t()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(t,d){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(d),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(d)}_innerWrite(t=0,d=!0){const u=t||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const t=this._writeBuffer[this._bufferOffset],f=this._action(t,d);if(f){const t=t=>Date.now()-u>=12?setTimeout((()=>this._innerWrite(0,t))):this._innerWrite(u,t);return void f.catch((t=>(queueMicrotask((()=>{throw t})),Promise.resolve(!1)))).then(t)}const p=this._callbacks[this._bufferOffset];if(p&&p(),this._bufferOffset++,this._pendingData-=t.length,Date.now()-u>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}d.WriteBuffer=n},5941:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.toRgbString=d.parseColor=void 0;const u=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,f=/^[\da-f]+$/;function p(t,d){const u=t.toString(16),f=u.length<2?"0"+u:u;switch(d){case 4:return u[0];case 8:return f;case 12:return(f+f).slice(0,3);default:return f+f}}d.parseColor=function(t){if(!t)return;let d=t.toLowerCase();if(0===d.indexOf("rgb:")){d=d.slice(4);const t=u.exec(d);if(t){const d=t[1]?15:t[4]?255:t[7]?4095:65535;return[Math.round(parseInt(t[1]||t[4]||t[7]||t[10],16)/d*255),Math.round(parseInt(t[2]||t[5]||t[8]||t[11],16)/d*255),Math.round(parseInt(t[3]||t[6]||t[9]||t[12],16)/d*255)]}}else if(0===d.indexOf("#")&&(d=d.slice(1),f.exec(d)&&[3,6,9,12].includes(d.length))){const t=d.length/3,u=[0,0,0];for(let f=0;f<3;++f){const p=parseInt(d.slice(t*f,t*f+t),16);u[f]=1===t?p<<4:2===t?p:3===t?p>>4:p>>8}return u}},d.toRgbString=function(t,d=16){const[u,f,v]=t;return`rgb:${p(u,d)}/${p(f,d)}/${p(v,d)}`}},5770:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.PAYLOAD_LIMIT=void 0,d.PAYLOAD_LIMIT=1e7},6351:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.DcsHandler=d.DcsParser=void 0;const f=u(482),p=u(8742),v=u(5770),g=[];d.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=g,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=g}registerHandler(t,d){void 0===this._handlers[t]&&(this._handlers[t]=[]);const u=this._handlers[t];return u.push(d),{dispose:()=>{const t=u.indexOf(d);-1!==t&&u.splice(t,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}reset(){if(this._active.length)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].unhook(!1);this._stack.paused=!1,this._active=g,this._ident=0}hook(t,d){if(this.reset(),this._ident=t,this._active=this._handlers[t]||g,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].hook(d);else this._handlerFb(this._ident,"HOOK",d)}put(t,d,u){if(this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].put(t,d,u);else this._handlerFb(this._ident,"PUT",(0,f.utf32ToString)(t,d,u))}unhook(t,d=!0){if(this._active.length){let u=!1,f=this._active.length-1,p=!1;if(this._stack.paused&&(f=this._stack.loopPosition-1,u=d,p=this._stack.fallThrough,this._stack.paused=!1),!p&&!1===u){for(;f>=0&&(u=this._active[f].unhook(t),!0!==u);f--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!1,u;f--}for(;f>=0;f--)if(u=this._active[f].unhook(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!0,u}else this._handlerFb(this._ident,"UNHOOK",t);this._active=g,this._ident=0}};const b=new p.Params;b.addParam(0),d.DcsHandler=class{constructor(t){this._handler=t,this._data="",this._params=b,this._hitLimit=!1}hook(t){this._params=t.length>1||t.params[0]?t.clone():b,this._data="",this._hitLimit=!1}put(t,d,u){this._hitLimit||(this._data+=(0,f.utf32ToString)(t,d,u),this._data.length>v.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(t){let d=!1;if(this._hitLimit)d=!1;else if(t&&(d=this._handler(this._data,this._params),d instanceof Promise))return d.then((t=>(this._params=b,this._data="",this._hitLimit=!1,t)));return this._params=b,this._data="",this._hitLimit=!1,d}}},2015:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.EscapeSequenceParser=d.VT500_TRANSITION_TABLE=d.TransitionTable=void 0;const f=u(844),p=u(8742),v=u(6242),g=u(6351);class a{constructor(t){this.table=new Uint8Array(t)}setDefault(t,d){this.table.fill(t<<4|d)}add(t,d,u,f){this.table[d<<8|t]=u<<4|f}addMany(t,d,u,f){for(let p=0;p<t.length;p++)this.table[d<<8|t[p]]=u<<4|f}}d.TransitionTable=a;const b=160;d.VT500_TRANSITION_TABLE=function(){const t=new a(4095),d=Array.apply(null,Array(256)).map(((t,d)=>d)),u=(t,u)=>d.slice(t,u),f=u(32,127),p=u(0,24);p.push(25),p.push.apply(p,u(28,32));const v=u(0,14);let g;for(g in t.setDefault(1,0),t.addMany(f,0,2,0),v)t.addMany([24,26,153,154],g,3,0),t.addMany(u(128,144),g,3,0),t.addMany(u(144,152),g,3,0),t.add(156,g,0,0),t.add(27,g,11,1),t.add(157,g,4,8),t.addMany([152,158,159],g,0,7),t.add(155,g,11,3),t.add(144,g,11,9);return t.addMany(p,0,3,0),t.addMany(p,1,3,1),t.add(127,1,0,1),t.addMany(p,8,0,8),t.addMany(p,3,3,3),t.add(127,3,0,3),t.addMany(p,4,3,4),t.add(127,4,0,4),t.addMany(p,6,3,6),t.addMany(p,5,3,5),t.add(127,5,0,5),t.addMany(p,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(f,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(u(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(f,7,0,7),t.addMany(p,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(u(64,127),3,7,0),t.addMany(u(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(u(48,60),4,8,4),t.addMany(u(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(u(32,64),6,0,6),t.add(127,6,0,6),t.addMany(u(64,127),6,0,0),t.addMany(u(32,48),3,9,5),t.addMany(u(32,48),5,9,5),t.addMany(u(48,64),5,0,6),t.addMany(u(64,127),5,7,0),t.addMany(u(32,48),4,9,5),t.addMany(u(32,48),1,9,2),t.addMany(u(32,48),2,9,2),t.addMany(u(48,127),2,10,0),t.addMany(u(48,80),1,10,0),t.addMany(u(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(u(96,127),1,10,0),t.add(80,1,11,9),t.addMany(p,9,0,9),t.add(127,9,0,9),t.addMany(u(28,32),9,0,9),t.addMany(u(32,48),9,9,12),t.addMany(u(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(p,11,0,11),t.addMany(u(32,128),11,0,11),t.addMany(u(28,32),11,0,11),t.addMany(p,10,0,10),t.add(127,10,0,10),t.addMany(u(28,32),10,0,10),t.addMany(u(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(u(32,48),10,9,12),t.addMany(p,12,0,12),t.add(127,12,0,12),t.addMany(u(28,32),12,0,12),t.addMany(u(32,48),12,9,12),t.addMany(u(48,64),12,0,11),t.addMany(u(64,127),12,12,13),t.addMany(u(64,127),10,12,13),t.addMany(u(64,127),9,12,13),t.addMany(p,13,13,13),t.addMany(f,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(b,0,2,0),t.add(b,8,5,8),t.add(b,6,0,6),t.add(b,11,0,11),t.add(b,13,13,13),t}();class c extends f.Disposable{constructor(t=d.VT500_TRANSITION_TABLE){super(),this._transitions=t,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,d,u)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,d)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,f.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new v.OscParser),this._dcsParser=this.register(new g.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(t,d=[64,126]){let u=0;if(t.prefix){if(t.prefix.length>1)throw new Error("only one byte as prefix supported");if(u=t.prefix.charCodeAt(0),u&&60>u||u>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(t.intermediates){if(t.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let d=0;d<t.intermediates.length;++d){const f=t.intermediates.charCodeAt(d);if(32>f||f>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");u<<=8,u|=f}}if(1!==t.final.length)throw new Error("final must be a single byte");const f=t.final.charCodeAt(0);if(d[0]>f||f>d[1])throw new Error(`final must be in range ${d[0]} .. ${d[1]}`);return u<<=8,u|=f,u}identToString(t){const d=[];for(;t;)d.push(String.fromCharCode(255&t)),t>>=8;return d.reverse().join("")}setPrintHandler(t){this._printHandler=t}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(t,d){const u=this._identifier(t,[48,126]);void 0===this._escHandlers[u]&&(this._escHandlers[u]=[]);const f=this._escHandlers[u];return f.push(d),{dispose:()=>{const t=f.indexOf(d);-1!==t&&f.splice(t,1)}}}clearEscHandler(t){this._escHandlers[this._identifier(t,[48,126])]&&delete this._escHandlers[this._identifier(t,[48,126])]}setEscHandlerFallback(t){this._escHandlerFb=t}setExecuteHandler(t,d){this._executeHandlers[t.charCodeAt(0)]=d}clearExecuteHandler(t){this._executeHandlers[t.charCodeAt(0)]&&delete this._executeHandlers[t.charCodeAt(0)]}setExecuteHandlerFallback(t){this._executeHandlerFb=t}registerCsiHandler(t,d){const u=this._identifier(t);void 0===this._csiHandlers[u]&&(this._csiHandlers[u]=[]);const f=this._csiHandlers[u];return f.push(d),{dispose:()=>{const t=f.indexOf(d);-1!==t&&f.splice(t,1)}}}clearCsiHandler(t){this._csiHandlers[this._identifier(t)]&&delete this._csiHandlers[this._identifier(t)]}setCsiHandlerFallback(t){this._csiHandlerFb=t}registerDcsHandler(t,d){return this._dcsParser.registerHandler(this._identifier(t),d)}clearDcsHandler(t){this._dcsParser.clearHandler(this._identifier(t))}setDcsHandlerFallback(t){this._dcsParser.setHandlerFallback(t)}registerOscHandler(t,d){return this._oscParser.registerHandler(t,d)}clearOscHandler(t){this._oscParser.clearHandler(t)}setOscHandlerFallback(t){this._oscParser.setHandlerFallback(t)}setErrorHandler(t){this._errorHandler=t}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(t,d,u,f,p){this._parseStack.state=t,this._parseStack.handlers=d,this._parseStack.handlerPos=u,this._parseStack.transition=f,this._parseStack.chunkPos=p}parse(t,d,u){let f,p=0,v=0,g=0;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,g=this._parseStack.chunkPos+1;else{if(void 0===u||1===this._parseStack.state)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const d=this._parseStack.handlers;let v=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===u&&v>-1)for(;v>=0&&(f=d[v](this._params),!0!==f);v--)if(f instanceof Promise)return this._parseStack.handlerPos=v,f;this._parseStack.handlers=[];break;case 4:if(!1===u&&v>-1)for(;v>=0&&(f=d[v](),!0!==f);v--)if(f instanceof Promise)return this._parseStack.handlerPos=v,f;this._parseStack.handlers=[];break;case 6:if(p=t[this._parseStack.chunkPos],f=this._dcsParser.unhook(24!==p&&26!==p,u),f)return f;27===p&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(p=t[this._parseStack.chunkPos],f=this._oscParser.end(24!==p&&26!==p,u),f)return f;27===p&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,g=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let u=g;u<d;++u){switch(p=t[u],v=this._transitions.table[this.currentState<<8|(p<160?p:b)],v>>4){case 2:for(let f=u+1;;++f){if(f>=d||(p=t[f])<32||p>126&&p<b){this._printHandler(t,u,f),u=f-1;break}if(++f>=d||(p=t[f])<32||p>126&&p<b){this._printHandler(t,u,f),u=f-1;break}if(++f>=d||(p=t[f])<32||p>126&&p<b){this._printHandler(t,u,f),u=f-1;break}if(++f>=d||(p=t[f])<32||p>126&&p<b){this._printHandler(t,u,f),u=f-1;break}}break;case 3:this._executeHandlers[p]?this._executeHandlers[p]():this._executeHandlerFb(p),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:u,code:p,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const g=this._csiHandlers[this._collect<<8|p];let S=g?g.length-1:-1;for(;S>=0&&(f=g[S](this._params),!0!==f);S--)if(f instanceof Promise)return this._preserveStack(3,g,S,v,u),f;S<0&&this._csiHandlerFb(this._collect<<8|p,this._params),this.precedingCodepoint=0;break;case 8:do{switch(p){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(p-48)}}while(++u<d&&(p=t[u])>47&&p<60);u--;break;case 9:this._collect<<=8,this._collect|=p;break;case 10:const C=this._escHandlers[this._collect<<8|p];let y=C?C.length-1:-1;for(;y>=0&&(f=C[y](),!0!==f);y--)if(f instanceof Promise)return this._preserveStack(4,C,y,v,u),f;y<0&&this._escHandlerFb(this._collect<<8|p),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|p,this._params);break;case 13:for(let f=u+1;;++f)if(f>=d||24===(p=t[f])||26===p||27===p||p>127&&p<b){this._dcsParser.put(t,u,f),u=f-1;break}break;case 14:if(f=this._dcsParser.unhook(24!==p&&26!==p),f)return this._preserveStack(6,[],0,v,u),f;27===p&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let f=u+1;;f++)if(f>=d||(p=t[f])<32||p>127&&p<b){this._oscParser.put(t,u,f),u=f-1;break}break;case 6:if(f=this._oscParser.end(24!==p&&26!==p),f)return this._preserveStack(5,[],0,v,u),f;27===p&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&v}}}d.EscapeSequenceParser=c},6242:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.OscHandler=d.OscParser=void 0;const f=u(5770),p=u(482),v=[];d.OscParser=class{constructor(){this._state=0,this._active=v,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(t,d){void 0===this._handlers[t]&&(this._handlers[t]=[]);const u=this._handlers[t];return u.push(d),{dispose:()=>{const t=u.indexOf(d);-1!==t&&u.splice(t,1)}}}clearHandler(t){this._handlers[t]&&delete this._handlers[t]}setHandlerFallback(t){this._handlerFb=t}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=v}reset(){if(2===this._state)for(let t=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;t>=0;--t)this._active[t].end(!1);this._stack.paused=!1,this._active=v,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||v,this._active.length)for(let t=this._active.length-1;t>=0;t--)this._active[t].start();else this._handlerFb(this._id,"START")}_put(t,d,u){if(this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].put(t,d,u);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(t,d,u))}start(){this.reset(),this._state=1}put(t,d,u){if(3!==this._state){if(1===this._state)for(;d<u;){const u=t[d++];if(59===u){this._state=2,this._start();break}if(u<48||57<u)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+u-48}2===this._state&&u-d>0&&this._put(t,d,u)}}end(t,d=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let u=!1,f=this._active.length-1,p=!1;if(this._stack.paused&&(f=this._stack.loopPosition-1,u=d,p=this._stack.fallThrough,this._stack.paused=!1),!p&&!1===u){for(;f>=0&&(u=this._active[f].end(t),!0!==u);f--)if(u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!1,u;f--}for(;f>=0;f--)if(u=this._active[f].end(!1),u instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!0,u}else this._handlerFb(this._id,"END",t);this._active=v,this._id=-1,this._state=0}}},d.OscHandler=class{constructor(t){this._handler=t,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(t,d,u){this._hitLimit||(this._data+=(0,p.utf32ToString)(t,d,u),this._data.length>f.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(t){let d=!1;if(this._hitLimit)d=!1;else if(t&&(d=this._handler(this._data),d instanceof Promise))return d.then((t=>(this._data="",this._hitLimit=!1,t)));return this._data="",this._hitLimit=!1,d}}},8742:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.Params=void 0;const u=2147483647;class s{constructor(t=32,d=32){if(this.maxLength=t,this.maxSubParamsLength=d,d>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(d),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(t){const d=new s;if(!t.length)return d;for(let u=Array.isArray(t[0])?1:0;u<t.length;++u){const f=t[u];if(Array.isArray(f))for(let t=0;t<f.length;++t)d.addSubParam(f[t]);else d.addParam(f)}return d}clone(){const t=new s(this.maxLength,this.maxSubParamsLength);return t.params.set(this.params),t.length=this.length,t._subParams.set(this._subParams),t._subParamsLength=this._subParamsLength,t._subParamsIdx.set(this._subParamsIdx),t._rejectDigits=this._rejectDigits,t._rejectSubDigits=this._rejectSubDigits,t._digitIsSub=this._digitIsSub,t}toArray(){const t=[];for(let d=0;d<this.length;++d){t.push(this.params[d]);const u=this._subParamsIdx[d]>>8,f=255&this._subParamsIdx[d];f-u>0&&t.push(Array.prototype.slice.call(this._subParams,u,f))}return t}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(t){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>u?u:t}}addSubParam(t){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>u?u:t,this._subParamsIdx[this.length-1]++}}hasSubParams(t){return(255&this._subParamsIdx[t])-(this._subParamsIdx[t]>>8)>0}getSubParams(t){const d=this._subParamsIdx[t]>>8,u=255&this._subParamsIdx[t];return u-d>0?this._subParams.subarray(d,u):null}getSubParamsAll(){const t={};for(let d=0;d<this.length;++d){const u=this._subParamsIdx[d]>>8,f=255&this._subParamsIdx[d];f-u>0&&(t[d]=this._subParams.slice(u,f))}return t}addDigit(t){let d;if(this._rejectDigits||!(d=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const f=this._digitIsSub?this._subParams:this.params,p=f[d-1];f[d-1]=~p?Math.min(10*p+t,u):t}}d.Params=s},5741:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.AddonManager=void 0,d.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let t=this._addons.length-1;t>=0;t--)this._addons[t].instance.dispose()}loadAddon(t,d){const u={instance:d,dispose:d.dispose,isDisposed:!1};this._addons.push(u),d.dispose=()=>this._wrappedAddonDispose(u),d.activate(t)}_wrappedAddonDispose(t){if(t.isDisposed)return;let d=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===t){d=u;break}if(-1===d)throw new Error("Could not dispose an addon that has not been loaded");t.isDisposed=!0,t.dispose.apply(t.instance),this._addons.splice(d,1)}}},8771:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferApiView=void 0;const f=u(3785),p=u(511);d.BufferApiView=class{constructor(t,d){this._buffer=t,this.type=d}init(t){return this._buffer=t,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(t){const d=this._buffer.lines.get(t);if(d)return new f.BufferLineApiView(d)}getNullCell(){return new p.CellData}}},3785:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferLineApiView=void 0;const f=u(511);d.BufferLineApiView=class{constructor(t){this._line=t}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(t,d){if(!(t<0||t>=this._line.length))return d?(this._line.loadCell(t,d),d):this._line.loadCell(t,new f.CellData)}translateToString(t,d,u){return this._line.translateToString(t,d,u)}}},8285:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.BufferNamespaceApi=void 0;const f=u(8771),p=u(8460);d.BufferNamespaceApi=class{constructor(t){this._core=t,this._onBufferChange=new p.EventEmitter,this.onBufferChange=this._onBufferChange.event,this._normal=new f.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new f.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}},7975:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.ParserApi=void 0,d.ParserApi=class{constructor(t){this._core=t}registerCsiHandler(t,d){return this._core.registerCsiHandler(t,(t=>d(t.toArray())))}addCsiHandler(t,d){return this.registerCsiHandler(t,d)}registerDcsHandler(t,d){return this._core.registerDcsHandler(t,((t,u)=>d(t,u.toArray())))}addDcsHandler(t,d){return this.registerDcsHandler(t,d)}registerEscHandler(t,d){return this._core.registerEscHandler(t,d)}addEscHandler(t,d){return this.registerEscHandler(t,d)}registerOscHandler(t,d){return this._core.registerOscHandler(t,d)}addOscHandler(t,d){return this.registerOscHandler(t,d)}}},7090:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.UnicodeApi=void 0,d.UnicodeApi=class{constructor(t){this._core=t}register(t){this._core.unicodeService.register(t)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(t){this._core.unicodeService.activeVersion=t}}},744:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.BufferService=d.MINIMUM_ROWS=d.MINIMUM_COLS=void 0;const v=u(2585),g=u(5295),b=u(8460),S=u(844);d.MINIMUM_COLS=2,d.MINIMUM_ROWS=1;let C=class extends S.Disposable{constructor(t){super(),this.isUserScrolling=!1,this._onResize=this.register(new b.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new b.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(t.rawOptions.cols||0,d.MINIMUM_COLS),this.rows=Math.max(t.rawOptions.rows||0,d.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(t,this))}get buffer(){return this.buffers.active}resize(t,d){this.cols=t,this.rows=d,this.buffers.resize(t,d),this._onResize.fire({cols:t,rows:d})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(t,d=!1){const u=this.buffer;let f;f=this._cachedBlankLine,f&&f.length===this.cols&&f.getFg(0)===t.fg&&f.getBg(0)===t.bg||(f=u.getBlankLine(t,d),this._cachedBlankLine=f),f.isWrapped=d;const p=u.ybase+u.scrollTop,v=u.ybase+u.scrollBottom;if(0===u.scrollTop){const t=u.lines.isFull;v===u.lines.length-1?t?u.lines.recycle().copyFrom(f):u.lines.push(f.clone()):u.lines.splice(v+1,0,f.clone()),t?this.isUserScrolling&&(u.ydisp=Math.max(u.ydisp-1,0)):(u.ybase++,this.isUserScrolling||u.ydisp++)}else{const t=v-p+1;u.lines.shiftElements(p+1,t-1,-1),u.lines.set(v,f.clone())}this.isUserScrolling||(u.ydisp=u.ybase),this._onScroll.fire(u.ydisp)}scrollLines(t,d,u){const f=this.buffer;if(t<0){if(0===f.ydisp)return;this.isUserScrolling=!0}else t+f.ydisp>=f.ybase&&(this.isUserScrolling=!1);const p=f.ydisp;f.ydisp=Math.max(Math.min(f.ydisp+t,f.ybase),0),p!==f.ydisp&&(d||this._onScroll.fire(f.ydisp))}scrollPages(t){this.scrollLines(t*(this.rows-1))}scrollToTop(){this.scrollLines(-this.buffer.ydisp)}scrollToBottom(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)}scrollToLine(t){const d=t-this.buffer.ydisp;0!==d&&this.scrollLines(d)}};C=f([p(0,v.IOptionsService)],C),d.BufferService=C},7994:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.CharsetService=void 0,d.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(t){this.glevel=t,this.charset=this._charsets[t]}setgCharset(t,d){this._charsets[t]=d,this.glevel===t&&(this.charset=d)}}},1753:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.CoreMouseService=void 0;const v=u(2585),g=u(8460),b=u(844),S={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:t=>4!==t.button&&1===t.action&&(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)},VT200:{events:19,restrict:t=>32!==t.action},DRAG:{events:23,restrict:t=>32!==t.action||3!==t.button},ANY:{events:31,restrict:t=>!0}};function C(t,d){let u=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return 4===t.button?(u|=64,u|=t.action):(u|=3&t.button,4&t.button&&(u|=64),8&t.button&&(u|=128),32===t.action?u|=32:0!==t.action||d||(u|=3)),u}const y=String.fromCharCode,w={DEFAULT:t=>{const d=[C(t,!1)+32,t.col+32,t.row+32];return d[0]>255||d[1]>255||d[2]>255?"":`[M${y(d[0])}${y(d[1])}${y(d[2])}`},SGR:t=>{const d=0===t.action&&4!==t.button?"m":"M";return`[<${C(t,!0)};${t.col};${t.row}${d}`},SGR_PIXELS:t=>{const d=0===t.action&&4!==t.button?"m":"M";return`[<${C(t,!0)};${t.x};${t.y}${d}`}};let x=class extends b.Disposable{constructor(t,d){super(),this._bufferService=t,this._coreService=d,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new g.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const t of Object.keys(S))this.addProtocol(t,S[t]);for(const t of Object.keys(w))this.addEncoding(t,w[t]);this.reset()}addProtocol(t,d){this._protocols[t]=d}addEncoding(t,d){this._encodings[t]=d}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(t){if(!this._protocols[t])throw new Error(`unknown protocol "${t}"`);this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(t){if(!this._encodings[t])throw new Error(`unknown encoding "${t}"`);this._activeEncoding=t}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows)return!1;if(4===t.button&&32===t.action)return!1;if(3===t.button&&32!==t.action)return!1;if(4!==t.button&&(2===t.action||3===t.action))return!1;if(t.col++,t.row++,32===t.action&&this._lastEvent&&this._equalEvents(this._lastEvent,t,"SGR_PIXELS"===this._activeEncoding))return!1;if(!this._protocols[this._activeProtocol].restrict(t))return!1;const d=this._encodings[this._activeEncoding](t);return d&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(d):this._coreService.triggerDataEvent(d,!0)),this._lastEvent=t,!0}explainEvents(t){return{down:!!(1&t),up:!!(2&t),drag:!!(4&t),move:!!(8&t),wheel:!!(16&t)}}_equalEvents(t,d,u){if(u){if(t.x!==d.x)return!1;if(t.y!==d.y)return!1}else{if(t.col!==d.col)return!1;if(t.row!==d.row)return!1}return t.button===d.button&&t.action===d.action&&t.ctrl===d.ctrl&&t.alt===d.alt&&t.shift===d.shift}};x=f([p(0,v.IBufferService),p(1,v.ICoreService)],x),d.CoreMouseService=x},6975:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.CoreService=void 0;const v=u(2585),g=u(8460),b=u(1439),S=u(844),C=Object.freeze({insertMode:!1}),y=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let w=class extends S.Disposable{constructor(t,d,u){super(),this._bufferService=t,this._logService=d,this._optionsService=u,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new g.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new g.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new g.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new g.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,b.clone)(C),this.decPrivateModes=(0,b.clone)(y)}reset(){this.modes=(0,b.clone)(C),this.decPrivateModes=(0,b.clone)(y)}triggerDataEvent(t,d=!1){if(this._optionsService.rawOptions.disableStdin)return;const u=this._bufferService.buffer;d&&this._optionsService.rawOptions.scrollOnUserInput&&u.ybase!==u.ydisp&&this._onRequestScrollToBottom.fire(),d&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,(()=>t.split("").map((t=>t.charCodeAt(0))))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,(()=>t.split("").map((t=>t.charCodeAt(0))))),this._onBinary.fire(t))}};w=f([p(0,v.IBufferService),p(1,v.ILogService),p(2,v.IOptionsService)],w),d.CoreService=w},9074:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.DecorationService=void 0;const f=u(8055),p=u(8460),v=u(844),g=u(6106);let b=0,S=0;class c extends v.Disposable{constructor(){super(),this._decorations=new g.SortedList((t=>null==t?void 0:t.marker.line)),this._onDecorationRegistered=this.register(new p.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new p.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,v.toDisposable)((()=>{for(const t of this._decorations.values())this._onDecorationRemoved.fire(t);this.reset()})))}get decorations(){return this._decorations.values()}registerDecoration(t){if(t.marker.isDisposed)return;const d=new l(t);if(d){const t=d.marker.onDispose((()=>d.dispose()));d.onDispose((()=>{d&&(this._decorations.delete(d)&&this._onDecorationRemoved.fire(d),t.dispose())})),this._decorations.insert(d),this._onDecorationRegistered.fire(d)}return d}reset(){for(const t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,d,u){var f,p,v;let g=0,b=0;for(const S of this._decorations.getKeyIterator(d))g=null!==(f=S.options.x)&&void 0!==f?f:0,b=g+(null!==(p=S.options.width)&&void 0!==p?p:1),t>=g&&t<b&&(!u||(null!==(v=S.options.layer)&&void 0!==v?v:"bottom")===u)&&(yield S)}forEachDecorationAtCell(t,d,u,f){this._decorations.forEachByKey(d,(d=>{var p,v,g;b=null!==(p=d.options.x)&&void 0!==p?p:0,S=b+(null!==(v=d.options.width)&&void 0!==v?v:1),t>=b&&t<S&&(!u||(null!==(g=d.options.layer)&&void 0!==g?g:"bottom")===u)&&f(d)}))}dispose(){for(const t of this._decorations.values())this._onDecorationRemoved.fire(t);this.reset()}}d.DecorationService=c;class l extends v.Disposable{constructor(t){super(),this.options=t,this.isDisposed=!1,this.onRenderEmitter=this.register(new p.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new p.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=f.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=f.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.InstantiationService=d.ServiceCollection=void 0;const f=u(2585),p=u(8343);class n{constructor(...t){this._entries=new Map;for(const[d,u]of t)this.set(d,u)}set(t,d){const u=this._entries.get(t);return this._entries.set(t,d),u}forEach(t){for(const[d,u]of this._entries.entries())t(d,u)}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}}d.ServiceCollection=n,d.InstantiationService=class{constructor(){this._services=new n,this._services.set(f.IInstantiationService,this)}setService(t,d){this._services.set(t,d)}getService(t){return this._services.get(t)}createInstance(t,...d){const u=(0,p.getServiceDependencies)(t).sort(((t,d)=>t.index-d.index)),f=[];for(const d of u){const u=this._services.get(d.id);if(!u)throw new Error(`[createInstance] ${t.name} depends on UNKNOWN service ${d.id}.`);f.push(u)}const v=u.length>0?u[0].index:d.length;if(d.length!==v)throw new Error(`[createInstance] First service dependency of ${t.name} at position ${v+1} conflicts with ${d.length} static arguments`);return new t(...[...d,...f])}}},7866:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.LogService=void 0;const v=u(844),g=u(2585),b={debug:g.LogLevelEnum.DEBUG,info:g.LogLevelEnum.INFO,warn:g.LogLevelEnum.WARN,error:g.LogLevelEnum.ERROR,off:g.LogLevelEnum.OFF};let S=class extends v.Disposable{constructor(t){super(),this._optionsService=t,this.logLevel=g.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel())))}_updateLogLevel(){this.logLevel=b[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(t){for(let d=0;d<t.length;d++)"function"==typeof t[d]&&(t[d]=t[d]())}_log(t,d,u){this._evalLazyOptionalParams(u),t.call(console,"xterm.js: "+d,...u)}debug(t,...d){this.logLevel<=g.LogLevelEnum.DEBUG&&this._log(console.log,t,d)}info(t,...d){this.logLevel<=g.LogLevelEnum.INFO&&this._log(console.info,t,d)}warn(t,...d){this.logLevel<=g.LogLevelEnum.WARN&&this._log(console.warn,t,d)}error(t,...d){this.logLevel<=g.LogLevelEnum.ERROR&&this._log(console.error,t,d)}};S=f([p(0,g.IOptionsService)],S),d.LogService=S},7302:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.OptionsService=d.DEFAULT_OPTIONS=void 0;const f=u(8460),p=u(6114),v=u(844);d.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:p.isMac,windowOptions:{},windowsMode:!1,wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const g=["normal","bold","100","200","300","400","500","600","700","800","900"];class a extends v.Disposable{constructor(t){super(),this._onOptionChange=this.register(new f.EventEmitter),this.onOptionChange=this._onOptionChange.event;const u=Object.assign({},d.DEFAULT_OPTIONS);for(const d in t)if(d in u)try{const f=t[d];u[d]=this._sanitizeAndValidateOption(d,f)}catch(t){console.error(t)}this.rawOptions=u,this.options=Object.assign({},u),this._setupOptions()}onSpecificOptionChange(t,d){return this.onOptionChange((u=>{u===t&&d(this.rawOptions[t])}))}onMultipleOptionChange(t,d){return this.onOptionChange((u=>{-1!==t.indexOf(u)&&d()}))}_setupOptions(){const t=t=>{if(!(t in d.DEFAULT_OPTIONS))throw new Error(`No option with key "${t}"`);return this.rawOptions[t]},u=(t,u)=>{if(!(t in d.DEFAULT_OPTIONS))throw new Error(`No option with key "${t}"`);u=this._sanitizeAndValidateOption(t,u),this.rawOptions[t]!==u&&(this.rawOptions[t]=u,this._onOptionChange.fire(t))};for(const d in this.rawOptions){const f={get:t.bind(this,d),set:u.bind(this,d)};Object.defineProperty(this.options,d,f)}}_sanitizeAndValidateOption(t,u){switch(t){case"cursorStyle":if(u||(u=d.DEFAULT_OPTIONS[t]),!function(t){return"block"===t||"underline"===t||"bar"===t}(u))throw new Error(`"${u}" is not a valid value for ${t}`);break;case"wordSeparator":u||(u=d.DEFAULT_OPTIONS[t]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof u&&1<=u&&u<=1e3)break;u=g.includes(u)?u:d.DEFAULT_OPTIONS[t];break;case"cursorWidth":u=Math.floor(u);case"lineHeight":case"tabStopWidth":if(u<1)throw new Error(`${t} cannot be less than 1, value: ${u}`);break;case"minimumContrastRatio":u=Math.max(1,Math.min(21,Math.round(10*u)/10));break;case"scrollback":if((u=Math.min(u,4294967295))<0)throw new Error(`${t} cannot be less than 0, value: ${u}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(u<=0)throw new Error(`${t} cannot be less than or equal to 0, value: ${u}`);case"rows":case"cols":if(!u&&0!==u)throw new Error(`${t} must be numeric, value: ${u}`)}return u}}d.OptionsService=a},2660:function(t,d,u){var f=this&&this.__decorate||function(t,d,u,f){var p,v=arguments.length,g=v<3?d:null===f?f=Object.getOwnPropertyDescriptor(d,u):f;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(t,d,u,f);else for(var b=t.length-1;b>=0;b--)(p=t[b])&&(g=(v<3?p(g):v>3?p(d,u,g):p(d,u))||g);return v>3&&g&&Object.defineProperty(d,u,g),g},p=this&&this.__param||function(t,d){return function(u,f){d(u,f,t)}};Object.defineProperty(d,"__esModule",{value:!0}),d.OscLinkService=void 0;const v=u(2585);let g=class{constructor(t){this._bufferService=t,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(t){const d=this._bufferService.buffer;if(void 0===t.id){const u=d.addMarker(d.ybase+d.y),f={data:t,id:this._nextId++,lines:[u]};return u.onDispose((()=>this._removeMarkerFromLink(f,u))),this._dataByLinkId.set(f.id,f),f.id}const u=t,f=this._getEntryIdKey(u),p=this._entriesWithId.get(f);if(p)return this.addLineToLink(p.id,d.ybase+d.y),p.id;const v=d.addMarker(d.ybase+d.y),g={id:this._nextId++,key:this._getEntryIdKey(u),data:u,lines:[v]};return v.onDispose((()=>this._removeMarkerFromLink(g,v))),this._entriesWithId.set(g.key,g),this._dataByLinkId.set(g.id,g),g.id}addLineToLink(t,d){const u=this._dataByLinkId.get(t);if(u&&u.lines.every((t=>t.line!==d))){const t=this._bufferService.buffer.addMarker(d);u.lines.push(t),t.onDispose((()=>this._removeMarkerFromLink(u,t)))}}getLinkData(t){var d;return null===(d=this._dataByLinkId.get(t))||void 0===d?void 0:d.data}_getEntryIdKey(t){return`${t.id};;${t.uri}`}_removeMarkerFromLink(t,d){const u=t.lines.indexOf(d);-1!==u&&(t.lines.splice(u,1),0===t.lines.length&&(void 0!==t.data.id&&this._entriesWithId.delete(t.key),this._dataByLinkId.delete(t.id)))}};g=f([p(0,v.IBufferService)],g),d.OscLinkService=g},8343:(t,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.createDecorator=d.getServiceDependencies=d.serviceRegistry=void 0,d.serviceRegistry=new Map,d.getServiceDependencies=function(t){return t.di$dependencies||[]},d.createDecorator=function(t){if(d.serviceRegistry.has(t))return d.serviceRegistry.get(t);const u=function(t,d,f){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(t,d,u){d.di$target===d?d.di$dependencies.push({id:t,index:u}):(d.di$dependencies=[{id:t,index:u}],d.di$target=d)}(u,t,f)};return u.toString=()=>t,d.serviceRegistry.set(t,u),u}},2585:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.IDecorationService=d.IUnicodeService=d.IOscLinkService=d.IOptionsService=d.ILogService=d.LogLevelEnum=d.IInstantiationService=d.ICharsetService=d.ICoreService=d.ICoreMouseService=d.IBufferService=void 0;const f=u(8343);var p;d.IBufferService=(0,f.createDecorator)("BufferService"),d.ICoreMouseService=(0,f.createDecorator)("CoreMouseService"),d.ICoreService=(0,f.createDecorator)("CoreService"),d.ICharsetService=(0,f.createDecorator)("CharsetService"),d.IInstantiationService=(0,f.createDecorator)("InstantiationService"),(p=d.LogLevelEnum||(d.LogLevelEnum={}))[p.DEBUG=0]="DEBUG",p[p.INFO=1]="INFO",p[p.WARN=2]="WARN",p[p.ERROR=3]="ERROR",p[p.OFF=4]="OFF",d.ILogService=(0,f.createDecorator)("LogService"),d.IOptionsService=(0,f.createDecorator)("OptionsService"),d.IOscLinkService=(0,f.createDecorator)("OscLinkService"),d.IUnicodeService=(0,f.createDecorator)("UnicodeService"),d.IDecorationService=(0,f.createDecorator)("DecorationService")},1480:(t,d,u)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.UnicodeService=void 0;const f=u(8460),p=u(225);d.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new f.EventEmitter,this.onChange=this._onChange.event;const t=new p.UnicodeV6;this.register(t),this._active=t.version,this._activeProvider=t}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(t){if(!this._providers[t])throw new Error(`unknown Unicode version "${t}"`);this._active=t,this._activeProvider=this._providers[t],this._onChange.fire(t)}register(t){this._providers[t.version]=t}wcwidth(t){return this._activeProvider.wcwidth(t)}getStringCellWidth(t){let d=0;const u=t.length;for(let f=0;f<u;++f){let p=t.charCodeAt(f);if(55296<=p&&p<=56319){if(++f>=u)return d+this.wcwidth(p);const v=t.charCodeAt(f);56320<=v&&v<=57343?p=1024*(p-55296)+v-56320+65536:d+=this.wcwidth(v)}d+=this.wcwidth(p)}return d}}}},d={};function u(f){var p=d[f];if(void 0!==p)return p.exports;var v=d[f]={exports:{}};return t[f].call(v.exports,v,v.exports,u),v.exports}var f={};return(()=>{var t=f;Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;const d=u(3236),p=u(9042),v=u(7975),g=u(7090),b=u(5741),S=u(8285),C=["cols","rows"];t.Terminal=class{constructor(t){this._core=new d.Terminal(t),this._addonManager=new b.AddonManager,this._publicOptions=Object.assign({},this._core.options);const u=t=>this._core.options[t],f=(t,d)=>{this._checkReadonlyOptions(t),this._core.options[t]=d};for(const t in this._core.options){const d={get:u.bind(this,t),set:f.bind(this,t)};Object.defineProperty(this._publicOptions,t,d)}}_checkReadonlyOptions(t){if(C.includes(t))throw new Error(`Option "${t}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new v.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=new S.BufferNamespaceApi(this._core)),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const t=this._core.coreService.decPrivateModes;let d="none";switch(this._core.coreMouseService.activeProtocol){case"X10":d="x10";break;case"VT200":d="vt200";break;case"DRAG":d="drag";break;case"ANY":d="any"}return{applicationCursorKeysMode:t.applicationCursorKeys,applicationKeypadMode:t.applicationKeypad,bracketedPasteMode:t.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:d,originMode:t.origin,reverseWraparoundMode:t.reverseWraparound,sendFocusMode:t.sendFocus,wraparoundMode:t.wraparound}}get options(){return this._publicOptions}set options(t){for(const d in t)this._publicOptions[d]=t[d]}blur(){this._core.blur()}focus(){this._core.focus()}resize(t,d){this._verifyIntegers(t,d),this._core.resize(t,d)}open(t){this._core.open(t)}attachCustomKeyEventHandler(t){this._core.attachCustomKeyEventHandler(t)}registerLinkProvider(t){return this._core.registerLinkProvider(t)}registerCharacterJoiner(t){return this._checkProposedApi(),this._core.registerCharacterJoiner(t)}deregisterCharacterJoiner(t){this._checkProposedApi(),this._core.deregisterCharacterJoiner(t)}registerMarker(t=0){return this._verifyIntegers(t),this._core.addMarker(t)}registerDecoration(t){var d,u,f;return this._checkProposedApi(),this._verifyPositiveIntegers(null!==(d=t.x)&&void 0!==d?d:0,null!==(u=t.width)&&void 0!==u?u:0,null!==(f=t.height)&&void 0!==f?f:0),this._core.registerDecoration(t)}hasSelection(){return this._core.hasSelection()}select(t,d,u){this._verifyIntegers(t,d,u),this._core.select(t,d,u)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(t,d){this._verifyIntegers(t,d),this._core.selectLines(t,d)}dispose(){this._addonManager.dispose(),this._core.dispose()}scrollLines(t){this._verifyIntegers(t),this._core.scrollLines(t)}scrollPages(t){this._verifyIntegers(t),this._core.scrollPages(t)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(t){this._verifyIntegers(t),this._core.scrollToLine(t)}clear(){this._core.clear()}write(t,d){this._core.write(t,d)}writeln(t,d){this._core.write(t),this._core.write("\r\n",d)}paste(t){this._core.paste(t)}refresh(t,d){this._verifyIntegers(t,d),this._core.refresh(t,d)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(t){return this._addonManager.loadAddon(this,t)}static get strings(){return p}_verifyIntegers(...t){for(const d of t)if(d===1/0||isNaN(d)||d%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...t){for(const d of t)if(d&&(d===1/0||isNaN(d)||d%1!=0||d<0))throw new Error("This API only accepts positive integers")}}})(),f})()},function(t,d,u){var f=u(27),p=u(28);"string"==typeof(p=p.__esModule?p.default:p)&&(p=[[t.i,p,""]]);f(p,{insert:"head",singleton:!1}),t.exports=p.locals||{}},function(t,d,u){"use strict";var f,p=function(){var t={};return function(d){if(void 0===t[d]){var u=document.querySelector(d);if(window.HTMLIFrameElement&&u instanceof window.HTMLIFrameElement)try{u=u.contentDocument.head}catch(t){u=null}t[d]=u}return t[d]}}(),v=[];function g(t){for(var d=-1,u=0;u<v.length;u++)if(v[u].identifier===t){d=u;break}return d}function b(t,d){for(var u={},f=[],p=0;p<t.length;p++){var b=t[p],S=d.base?b[0]+d.base:b[0],C=u[S]||0,y="".concat(S," ").concat(C);u[S]=C+1;var w=g(y),x={css:b[1],media:b[2],sourceMap:b[3]};-1!==w?(v[w].references++,v[w].updater(x)):v.push({identifier:y,updater:k(x,d),references:1}),f.push(y)}return f}function S(t){var d=document.createElement("style"),f=t.attributes||{};if(void 0===f.nonce){var v=u.nc;v&&(f.nonce=v)}if(Object.keys(f).forEach((function(t){d.setAttribute(t,f[t])})),"function"==typeof t.insert)t.insert(d);else{var g=p(t.insert||"head");if(!g)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");g.appendChild(d)}return d}var C,y=(C=[],function(t,d){return C[t]=d,C.filter(Boolean).join("\n")});function w(t,d,u,f){var p=u?"":f.media?"@media ".concat(f.media," {").concat(f.css,"}"):f.css;if(t.styleSheet)t.styleSheet.cssText=y(d,p);else{var v=document.createTextNode(p),g=t.childNodes;g[d]&&t.removeChild(g[d]),g.length?t.insertBefore(v,g[d]):t.appendChild(v)}}function x(t,d,u){var f=u.css,p=u.media,v=u.sourceMap;if(p?t.setAttribute("media",p):t.removeAttribute("media"),v&&"undefined"!=typeof btoa&&(f+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(v))))," */")),t.styleSheet)t.styleSheet.cssText=f;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(f))}}var O=null,j=0;function k(t,d){var u,f,p;if(d.singleton){var v=j++;u=O||(O=S(d)),f=w.bind(null,u,v,!1),p=w.bind(null,u,v,!0)}else u=S(d),f=x.bind(null,u,d),p=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(u)};return f(t),function(d){if(d){if(d.css===t.css&&d.media===t.media&&d.sourceMap===t.sourceMap)return;f(t=d)}else p()}}t.exports=function(t,d){(d=d||{}).singleton||"boolean"==typeof d.singleton||(d.singleton=(void 0===f&&(f=Boolean(window&&document&&document.all&&!window.atob)),f));var u=b(t=t||[],d);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var f=0;f<u.length;f++){var p=g(u[f]);v[p].references--}for(var S=b(t,d),C=0;C<u.length;C++){var y=g(u[C]);0===v[y].references&&(v[y].updater(),v.splice(y,1))}u=S}}}},function(t,d,u){(d=u(29)(!1)).push([t.i,'/**\n * Copyright (c) 2014 The xterm.js authors. All rights reserved.\n * Copyright (c) 2012-2013, Christopher Jeffrey (MIT License)\n * https://github.com/chjj/term.js\n * @license MIT\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n * Originally forked from (with the author\'s permission):\n *   Fabrice Bellard\'s javascript vt100 for jslinux:\n *   http://bellard.org/jslinux/\n *   Copyright (c) 2011 Fabrice Bellard\n *   The original design remains. The terminal itself\n *   has been extended to include xterm CSI codes, among\n *   other features.\n */\n\n/**\n *  Default styles for xterm.js\n */.xterm{cursor:text;position:relative;user-select:none;-ms-user-select:none;-webkit-user-select:none}.xterm.focus,.xterm:focus{outline:none}.xterm .xterm-helpers{position:absolute;top:0;\n    /**\n     * The z-index of the helpers must be higher than the canvases in order for\n     * IMEs to appear on top.\n     */z-index:5}.xterm .xterm-helper-textarea{border:0;height:0;left:-9999em;margin:0;opacity:0;overflow:hidden;padding:0;\n    /* Move textarea out of the screen to the far left, so that the cursor is not visible */position:absolute;resize:none;top:0;\n    /** Prevent wrapping so the IME appears against the textarea at the correct position */white-space:nowrap;width:0;z-index:-5}.xterm .composition-view{\n    /* TODO: Composition position got messed up somewhere */background:#000;color:#fff;display:none;position:absolute;white-space:nowrap;z-index:1}.xterm .composition-view.active{display:block}.xterm .xterm-viewport{\n    /* On OS X this is required in order for the scroll bar to appear fully opaque */background-color:#000;bottom:0;cursor:default;left:0;overflow-y:scroll;position:absolute;right:0;top:0}.xterm .xterm-screen{position:relative}.xterm .xterm-screen canvas{left:0;position:absolute;top:0}.xterm .xterm-scroll-area{visibility:hidden}.xterm-char-measure-element{display:inline-block;left:-9999em;line-height:normal;position:absolute;top:0;visibility:hidden}.xterm.enable-mouse-events{\n    /* When mouse events are enabled (eg. tmux), revert to the standard pointer cursor */cursor:default}.xterm .xterm-cursor-pointer,.xterm.xterm-cursor-pointer{cursor:pointer}.xterm.column-select.focus{\n    /* Column selection mode */cursor:crosshair}.xterm .xterm-accessibility,.xterm .xterm-message{bottom:0;color:#0000;left:0;position:absolute;top:0;z-index:10}.xterm .live-region{height:1px;left:-9999px;overflow:hidden;position:absolute;width:1px}.xterm-dim{opacity:.5}.xterm-underline-1{text-decoration:underline}.xterm-underline-2{-webkit-text-decoration:double underline;text-decoration:double underline}.xterm-underline-3{-webkit-text-decoration:wavy underline;text-decoration:wavy underline}.xterm-underline-4{-webkit-text-decoration:dotted underline;text-decoration:dotted underline}.xterm-underline-5{-webkit-text-decoration:dashed underline;text-decoration:dashed underline}.xterm-strikethrough{text-decoration:line-through}.xterm-screen .xterm-decoration-container .xterm-decoration{position:absolute;z-index:6}.xterm-decoration-overview-ruler{pointer-events:none;position:absolute;right:0;top:0;z-index:7}.xterm-decoration-top{position:relative;z-index:2}',""]),t.exports=d},function(t,d,u){"use strict";t.exports=function(t){var d=[];return d.toString=function(){return this.map((function(d){var u=function(t,d){var u,f,p,v=t[1]||"",g=t[3];if(!g)return v;if(d&&"function"==typeof btoa){var b=(u=g,f=btoa(unescape(encodeURIComponent(JSON.stringify(u)))),p="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(f),"/*# ".concat(p," */")),S=g.sources.map((function(t){return"/*# sourceURL=".concat(g.sourceRoot||"").concat(t," */")}));return[v].concat(S).concat([b]).join("\n")}return[v].join("\n")}(d,t);return d[2]?"@media ".concat(d[2]," {").concat(u,"}"):u})).join("")},d.i=function(t,u,f){"string"==typeof t&&(t=[[null,t,""]]);var p={};if(f)for(var v=0;v<this.length;v++){var g=this[v][0];null!=g&&(p[g]=!0)}for(var b=0;b<t.length;b++){var S=[].concat(t[b]);f&&p[S[0]]||(u&&(S[2]?S[2]="".concat(u," and ").concat(S[2]):S[2]=u),d.push(S))}},d}},function(t,d,u){"use strict";var f=u(2);function p(t,d,u){return t[d]?t[d][0]?t[d][0][u]:t[d][u]:"contentBoxSize"===d?t.contentRect["inlineSize"===u?"width":"height"]:void 0}t.exports=function(t){void 0===t&&(t={});var d=t.onResize,u=f.useRef(void 0);u.current=d;var v=t.round||Math.round,g=f.useRef(),b=f.useState({width:void 0,height:void 0}),S=b[0],C=b[1],y=f.useRef(!1);f.useEffect((function(){return y.current=!1,function(){y.current=!0}}),[]);var w=f.useRef({width:void 0,height:void 0}),x=function(t,d){var u=f.useRef(null),p=f.useRef(null);p.current=d;var v=f.useRef(null);f.useEffect((function(){g()}));var g=f.useCallback((function(){var d=v.current,f=p.current,g=d||(f?f instanceof Element?f:f.current:null);u.current&&u.current.element===g&&u.current.subscriber===t||(u.current&&u.current.cleanup&&u.current.cleanup(),u.current={element:g,subscriber:t,cleanup:g?t(g):void 0})}),[t]);return f.useEffect((function(){return function(){u.current&&u.current.cleanup&&(u.current.cleanup(),u.current=null)}}),[]),f.useCallback((function(t){v.current=t,g()}),[g])}(f.useCallback((function(d){return g.current&&g.current.box===t.box&&g.current.round===v||(g.current={box:t.box,round:v,instance:new ResizeObserver((function(d){var f=d[0],g="border-box"===t.box?"borderBoxSize":"device-pixel-content-box"===t.box?"devicePixelContentBoxSize":"contentBoxSize",b=p(f,g,"inlineSize"),S=p(f,g,"blockSize"),x=b?v(b):void 0,O=S?v(S):void 0;if(w.current.width!==x||w.current.height!==O){var j={width:x,height:O};w.current.width=x,w.current.height=O,u.current?u.current(j):y.current||C(j)}}))}),g.current.instance.observe(d,{box:t.box}),function(){g.current&&g.current.instance.unobserve(d)}}),[t.box,v]),t.ref);return f.useMemo((function(){return{ref:x,width:S.width,height:S.height}}),[x,S.width,S.height])}},function(t,d,u){"use strict";Object.defineProperty(d,"__esModule",{value:!0});var f=u(2),p=u(32),v=function(){};d.default=function(t,d,u){if(!p.isClient)return[d,v,v];if(!t)throw new Error("useLocalStorage key may not be falsy");var g=u?u.raw?function(t){return t}:u.deserializer:JSON.parse,b=f.useState((function(){try{var f=u?u.raw?String:u.serializer:JSON.stringify,p=localStorage.getItem(t);return null!==p?g(p):(d&&localStorage.setItem(t,f(d)),d)}catch(t){return d}})),S=b[0],C=b[1],y=f.useCallback((function(d){try{var f="function"==typeof d?d(S):d;if(void 0===f)return;var p;p=u?u.raw?"string"==typeof f?f:JSON.stringify(f):u.serializer?u.serializer(f):JSON.stringify(f):JSON.stringify(f),localStorage.setItem(t,p),C(g(p))}catch(t){}}),[t,C]),w=f.useCallback((function(){try{localStorage.removeItem(t),C(void 0)}catch(t){}}),[t,C]);return[S,y,w]}},function(t,d,u){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.isDeepEqual=d.off=d.on=d.isClient=void 0;var f=u(19).__importDefault(u(33));d.isClient="object"==typeof window,d.on=function(t){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];return t.addEventListener.apply(t,d)},d.off=function(t){for(var d=[],u=1;u<arguments.length;u++)d[u-1]=arguments[u];return t.removeEventListener.apply(t,d)},d.isDeepEqual=f.default},function(t,d,u){"use strict";t.exports=function t(d,u){if(d===u)return!0;if(d&&u&&"object"==typeof d&&"object"==typeof u){if(d.constructor!==u.constructor)return!1;var f,p,v;if(Array.isArray(d)){if((f=d.length)!=u.length)return!1;for(p=f;0!=p--;)if(!t(d[p],u[p]))return!1;return!0}if(d.constructor===RegExp)return d.source===u.source&&d.flags===u.flags;if(d.valueOf!==Object.prototype.valueOf)return d.valueOf()===u.valueOf();if(d.toString!==Object.prototype.toString)return d.toString()===u.toString();if((f=(v=Object.keys(d)).length)!==Object.keys(u).length)return!1;for(p=f;0!=p--;)if(!Object.prototype.hasOwnProperty.call(u,v[p]))return!1;for(p=f;0!=p--;){var g=v[p];if(!("_owner"===g&&d.$$typeof||t(d[g],u[g])))return!1}return!0}return d!=d&&u!=u}}])]);