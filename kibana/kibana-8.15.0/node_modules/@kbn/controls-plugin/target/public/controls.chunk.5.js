(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[5],{100:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(101);case"v8light":return i(103)}},101:function(e,t,i){var n=i(58),s=i(102);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);n(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},102:function(e,t,i){(t=i(59)(!1)).push([e.i,".timeSlider__popoverOverride{max-inline-size:100%!important;width:100%}.timeSlider-playToggle:enabled{background-color:#36a2ef!important}.timeSlider__anchor{border-radius:0 5px 5px 0;box-shadow:none;height:100%;overflow:hidden;width:100%}.timeSlider__anchor .euiText{background-color:#0000!important}.timeSlider__anchor .euiText:hover{text-decoration:underline}.timeSlider__anchor .euiText:not(.euiFormControlLayoutDelimited__delimiter){cursor:pointer!important}.timeSlider__anchor .timeSlider__anchorText{font-weight:500}.timeSlider__anchor .timeSlider__anchorText--default{color:#535966}.timeSlider__anchor .timeSlider__anchorText--invalid{color:#535966;text-decoration:line-through}",""]),e.exports=t},103:function(e,t,i){var n=i(58),s=i(104);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.i,s,""]]);n(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},104:function(e,t,i){(t=i(59)(!1)).push([e.i,".timeSlider__popoverOverride{max-inline-size:100%!important;width:100%}.timeSlider-playToggle:enabled{background-color:#07c!important}.timeSlider__anchor{border-radius:0 5px 5px 0;box-shadow:none;height:100%;overflow:hidden;width:100%}.timeSlider__anchor .euiText{background-color:#0000!important}.timeSlider__anchor .euiText:hover{text-decoration:underline}.timeSlider__anchor .euiText:not(.euiFormControlLayoutDelimited__delimiter){cursor:pointer!important}.timeSlider__anchor .timeSlider__anchorText{font-weight:500}.timeSlider__anchor .timeSlider__anchorText--default{color:#98a2b3}.timeSlider__anchor .timeSlider__anchorText--invalid{color:#98a2b3;text-decoration:line-through}",""]),e.exports=t},107:function(e,t,i){"use strict";i.r(t),i.d(t,"TimeSliderControlContext",(function(){return $})),i.d(t,"useTimeSlider",(function(){return W})),i.d(t,"TimeSliderControlEmbeddable",(function(){return time_slider_embeddable_TimeSliderControlEmbeddable}));var n=i(1),s=i.n(n),a=i(2),o=i.n(a),r=i(55),l=i.n(r),c=i(4),u=i.n(c),d=i(47),m=i.n(d),h=i(31),g=i(24),p=i(0),S=i(61),v=i(41),T=i(19),f=i(6),b=i(35);function O(e){const t=l.a.tz.guess();return void 0===e||"Browser"===e?t:e}function x(e,t,i){const n=function(e,t,i=20){const n=t-e;let s=Object(b.calcAutoIntervalNear)(20,n).asMilliseconds();const a=n/s;return a>20?s*=Math.ceil(a/20):a<10&&(s/=2),s}(e,t),s=function(e){return e>=l.a.duration(1,"y").asMilliseconds()?"YYYY":e>=l.a.duration(30,"d").asMilliseconds()?"MMM YYYY":e>=l.a.duration(1,"d").asMilliseconds()?"MMM D":e>=l.a.duration(6,"h").asMilliseconds()?"Do HH":e>=l.a.duration(1,"h").asMilliseconds()||e>=l.a.duration(1,"m").asMilliseconds()?"HH:mm":e>=l.a.duration(1,"s").asMilliseconds()?"mm:ss":"ss.SSS"}(n);let a=Math.ceil(e/n)*n;const o=[];for(;a<=t;)o.push({value:a,label:l.a.tz(a,O(i)).format(s)}),a+=n;return o}function R(e){if(e.length<2)return{stepSize:1,format:"MMM D, YYYY @ HH:mm:ss.SSS"};const t=e[1].value-e[0].value;return t>=l.a.duration(2,"y").asMilliseconds()?{stepSize:l.a.duration(1,"y").asMilliseconds(),format:"YYYY"}:t>=l.a.duration(2,"d").asMilliseconds()?{stepSize:l.a.duration(1,"d").asMilliseconds(),format:"MMM D, YYYY"}:t>=l.a.duration(2,"h").asMilliseconds()?{stepSize:l.a.duration(1,"h").asMilliseconds(),format:"MMM D, YYYY @ HH:mm"}:t>=l.a.duration(2,"m").asMilliseconds()?{stepSize:l.a.duration(1,"m").asMilliseconds(),format:"MMM D, YYYY @ HH:mm"}:t>=l.a.duration(2,"s").asMilliseconds()?{stepSize:l.a.duration(1,"s").asMilliseconds(),format:"MMM D, YYYY @ HH:mm:ss"}:{stepSize:1,format:"MMM D, YYYY @ HH:mm:ss.SSS"}}function C(e,t){const i=e%t;return 0===i?e:e-i}function _(e,t){const i=e%t;return 0===i?e:e+(t-i)}function j(e){const t=e.componentState.stepSize,i=e.componentState.timeRangeBounds;return[C(i[0],t),_(i[1],t)]}function M(e){return"boolean"==typeof e.explicitInput.isAnchored&&e.explicitInput.isAnchored}var P=i(3);function A(e){return Object(P.jsx)("button",{className:"timeSlider__anchor eui-textTruncate",color:"text",onClick:e.onClick,"data-test-subj":"timeSlider-popoverToggleButton"},Object(P.jsx)(f.EuiText,{className:"timeSlider__anchorText eui-textTruncate",size:"s"},Object(P.jsx)("span",null,e.formatDate(e.from)),"  →  ",Object(P.jsx)("span",null,e.formatDate(e.to))))}const w=()=>p.i18n.translate("controls.timeSlider.settings.pinStart",{defaultMessage:"Pin start"}),y=()=>p.i18n.translate("controls.timeSlider.settings.unpinStart",{defaultMessage:"Unpin start"}),E=e=>e?p.i18n.translate("controls.timeSlider.playLabel",{defaultMessage:"Play"}):p.i18n.translate("controls.timeSlider.pauseLabel",{defaultMessage:"Pause"}),Y=()=>p.i18n.translate("controls.timeSlider.previousLabel",{defaultMessage:"Previous time window"}),k=()=>p.i18n.translate("controls.timeSlider.nextLabel",{defaultMessage:"Next time window"}),z=()=>p.i18n.translate("controls.timeSlider.playButtonTooltip.disabled",{defaultMessage:'"Apply selections automatically" is disabled in Control Settings.'});function I(e){return Object(P.jsx)(f.EuiRange,{fullWidth:!0,value:e.value[1],onChange:function(t){const i=parseInt(t.currentTarget.value,10);isNaN(i)||e.onChange([e.timeRangeMin,i])},showRange:!0,showTicks:!0,min:e.timeRangeMin,max:e.timeRangeMax,step:e.stepSize,ticks:e.ticks})}function D(e){return Object(P.jsx)(f.EuiDualRange,{fullWidth:!0,value:e.value,onChange:function(t){e.onChange(t)},showTicks:!0,min:e.timeRangeMin,max:e.timeRangeMax,step:e.stepSize,ticks:e.ticks,isDraggable:!0})}function B(e){const t=e.ticks.length<=12?e.ticks:e.ticks.map(((e,t)=>({value:e.value,label:t%2==0?e.label:Object(P.jsx)("span",null," ")}))),i=W(),n=i.select(M),s=n?Object(P.jsx)(I,{value:e.value,onChange:e.onChange,stepSize:e.stepSize,ticks:t,timeRangeMin:e.timeRangeMin,timeRangeMax:e.timeRangeMax}):Object(P.jsx)(D,{value:e.value,onChange:e.onChange,stepSize:e.stepSize,ticks:t,timeRangeMin:e.timeRangeMin,timeRangeMax:e.timeRangeMax}),a=n?y():w();return Object(P.jsx)(f.EuiFlexGroup,{className:"rangeSlider__actions",gutterSize:"none","data-test-subj":"timeSlider-popoverContents",responsive:!1},Object(P.jsx)(f.EuiFlexItem,{grow:!1},Object(P.jsx)(f.EuiToolTip,{content:a},Object(P.jsx)(f.EuiButtonIcon,{iconType:n?"pinFilled":"pin",onClick:()=>{const t=!n;t&&e.onChange([e.timeRangeMin,e.value[1]]),i.dispatch.setIsAnchored({isAnchored:t})},"aria-label":a,"data-test-subj":"timeSlider__anchorStartToggleButton"}))),Object(P.jsx)(f.EuiFlexItem,null,s))}i(100);const L=e=>{const t=W(),i=t.select((e=>e.componentState.stepSize)),n=t.select((e=>e.componentState.ticks)),s=t.select(j),a=s[0],o=s[1],r=t.select((e=>e.componentState.value)),l=t.select((e=>e.componentState.isOpen)),c=r?r[0]:a,u=r?r[1]:o;return Object(P.jsx)(f.EuiInputPopover,{className:"timeSlider__popoverOverride",panelClassName:"timeSlider__panelOverride",input:Object(P.jsx)(A,{onClick:()=>{t.dispatch.setIsOpen({isOpen:!l})},formatDate:e.formatDate,from:c,to:u}),isOpen:l,closePopover:()=>t.dispatch.setIsOpen({isOpen:!1}),panelPaddingSize:"s"},Object(P.jsx)(B,{value:[c,u],onChange:e.onChange,stepSize:i,ticks:n,timeRangeMin:a,timeRangeMax:o}))};var N=i(57),F=i(68);const H=e=>{const t=W(),i=Object(F.useControlGroupContainer)(),n=i.select((e=>e.explicitInput.showApplySelections)),s=i.select((e=>e.explicitInput.viewMode)),[a,o]=Object(c.useState)(!0),[r,l]=Object(c.useState)(void 0),[d,m]=Object(c.useState)(void 0),g=Object(c.useCallback)((()=>{if(e.onNext(),e.waitForControlOutputConsumersToLoad$){const t=e.waitForControlOutputConsumersToLoad$.pipe(Object(h.first)()).subscribe((()=>{const e=window.setTimeout((()=>{g()}),1750);l(e)}));m(t)}}),[e]),p=Object(c.useCallback)((()=>{t.dispatch.setIsOpen({isOpen:!0}),o(!1),g()}),[t.dispatch,g]),S=Object(c.useCallback)((()=>{t.dispatch.setIsOpen({isOpen:!0}),o(!0),d&&(d.unsubscribe(),m(void 0)),r&&(clearTimeout(r),l(void 0))}),[t.dispatch,d,r]),v=Object(c.useMemo)((()=>{const e=Object(P.jsx)(f.EuiButtonIcon,{className:"timeSlider-playToggle",onClick:a?p:S,disabled:n,iconType:a?"playFilled":"pause",size:"s",display:"fill","aria-label":E(a)});return Object(P.jsx)(u.a.Fragment,null,n?Object(P.jsx)(f.EuiToolTip,{content:z()},e):e)}),[a,p,S,n]);return Object(P.jsx)("div",null,Object(P.jsx)(f.EuiButtonIcon,{onClick:()=>{S(),e.onPrevious()},iconType:"framePrevious",color:"text","aria-label":Y(),"data-test-subj":"timeSlider-previousTimeWindow"}),void 0===e.waitForControlOutputConsumersToLoad$||n&&s===N.ViewMode.VIEW?null:v,Object(P.jsx)(f.EuiButtonIcon,{onClick:()=>{S(),e.onNext()},iconType:"frameNext",color:"text","aria-label":k(),"data-test-subj":"timeSlider-nextTimeWindow"}))},V={publishValue:(e,t)=>{e.output.timeslice=t.payload.value},setTimeRangeBounds:(e,t)=>{e.componentState.format=t.payload.format,e.componentState.stepSize=t.payload.stepSize,e.componentState.ticks=t.payload.ticks,e.componentState.timeRangeBounds=t.payload.timeRangeBounds},setValueAsPercentageOfTimeRange:(e,t)=>{e.explicitInput.timesliceStartAsPercentageOfTimeRange=t.payload.timesliceStartAsPercentageOfTimeRange,e.explicitInput.timesliceEndAsPercentageOfTimeRange=t.payload.timesliceEndAsPercentageOfTimeRange},setValue:(e,t)=>{e.componentState.value=t.payload.value},setRange:(e,t)=>{e.componentState.range=t.payload.range},setIsAnchored:(e,t)=>{e.explicitInput.isAnchored=t.payload.isAnchored},setIsOpen:(e,t)=>{e.componentState.isOpen=t.payload.isOpen}},$=Object(c.createContext)(null),W=()=>{const e=Object(c.useContext)($);if(null==e)throw new Error("useTimeSlider must be used inside TimeSliderControlContext.");return e};class time_slider_embeddable_TimeSliderControlEmbeddable extends g.Embeddable{constructor(e,t,i,n){super(t,i,n),s()(this,"type",v.TIME_SLIDER_CONTROL),s()(this,"deferEmbeddedLoad",!0),s()(this,"inputSubscription",void 0),s()(this,"node",void 0),s()(this,"select",void 0),s()(this,"getState",void 0),s()(this,"dispatch",void 0),s()(this,"onStateChange",void 0),s()(this,"cleanupStateTools",void 0),s()(this,"getTimezone",void 0),s()(this,"timefilter",void 0),s()(this,"prevTimeRange",void 0),s()(this,"prevTimesliceAsPercentage",void 0),s()(this,"waitForControlOutputConsumersToLoad$",void 0),s()(this,"destroy",(()=>{super.destroy(),this.cleanupStateTools(),this.inputSubscription&&this.inputSubscription.unsubscribe()})),s()(this,"selectionsToFilters",(async e=>{const{timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i}=e;if(void 0===t||void 0===i)return{timeslice:void 0};const{componentState:{stepSize:n,timeRangeBounds:s}}=this.getState(),a=s[1]-s[0],o=s[0]+t*a,r=s[0]+i*a;return{timeslice:[C(o,n),_(r,n)]}})),s()(this,"debouncedPublishChange",o.a.debounce((e=>{this.dispatch.publishValue({value:e})}),500)),s()(this,"onTimesliceChange",(e=>{const{timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i}=this.getTimeSliceAsPercentageOfTimeRange(e);this.dispatch.setValueAsPercentageOfTimeRange({timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i}),this.dispatch.setValue({value:e}),this.debouncedPublishChange(e)})),s()(this,"onRangeChange",(e=>{const t=this.getState().componentState.timeRangeBounds,i=t[1]-t[0];this.dispatch.setRange({range:void 0!==e&&e<i?e:void 0})})),s()(this,"onNext",(()=>{const{value:e,range:t,ticks:i}=this.getState().componentState,n=M(this.getState()),s=i[1].value-i[0].value,a=j(this.getState());if(n){if(void 0===e||e[1]>=a[1])return void this.onTimesliceChange([a[0],i[0].value]);const t=i.find((t=>t.value>e[1]));return void this.onTimesliceChange([a[0],t?t.value:a[1]])}if(void 0===e||e[1]>=a[1]){const e=a[0];if(void 0===t||t===s){const t=i[0].value,n=i[1].value,a=t===e?n:t;this.onTimesliceChange([e,a]),this.onRangeChange(s)}else{const i=e+t;this.onTimesliceChange([e,Math.min(i,a[1])])}return}const o=e[1],r=o+(void 0===t?s:t);this.onTimesliceChange([o,Math.min(r,a[1])])})),s()(this,"onPrevious",(()=>{const{value:e,range:t,ticks:i}=this.getState().componentState,n=M(this.getState()),s=i[1].value-i[0].value,a=j(this.getState());if(n){const t=e?[...i].reverse().find((t=>t.value<e[1])):i[i.length-1];return void this.onTimesliceChange([a[0],t?t.value:a[1]])}if(void 0===e||e[0]<=a[0]){const e=a[1];if(void 0===t||t===s){const t=i[i.length-1].value,n=i[i.length-2].value,a=t===e?n:t;this.onTimesliceChange([a,e]),this.onRangeChange(s)}else{const i=e-t;this.onTimesliceChange([Math.max(i,a[0]),e])}return}const o=e[0],r=o-(void 0===t?s:t);this.onTimesliceChange([Math.max(r,a[0]),o])})),s()(this,"formatDate",(e=>l.a.tz(e,O(this.getTimezone())).locale(p.i18n.getLocale()).format(this.getState().componentState.format))),s()(this,"render",(e=>{this.node&&m.a.unmountComponentAtNode(this.node),this.node=e,m.a.render(Object(P.jsx)(S.a,T.a.getServices().core,Object(P.jsx)($.Provider,{value:this},Object(P.jsx)(L,{formatDate:this.formatDate,onChange:e=>{this.onTimesliceChange(e);const t=e?e[1]-e[0]:void 0;this.onRangeChange(t)}}))),e)}));const{data:{timefilter:a},settings:{getDefaultTimeRange:r,getTimezone:c}}=T.a.getServices();this.getTimezone=c,this.timefilter=a;const u=this.timeRangeToBounds(t.timeRange?t.timeRange:r()),d=x(u[0],u[1],this.getTimezone()),g=e.createReduxEmbeddableTools({embeddable:this,reducers:V,initialComponentState:{isOpen:!1,...R(d),ticks:d,timeRangeBounds:u}});this.select=g.select,this.getState=g.getState,this.dispatch=g.dispatch,this.onStateChange=g.onStateChange,this.cleanupStateTools=g.cleanup,this.inputSubscription=this.getInput$().subscribe((()=>this.onInputChange())),this.waitForControlOutputConsumersToLoad$=n&&"anyControlOutputConsumerLoading$"in n?n.anyControlOutputConsumerLoading$.pipe(Object(h.debounceTime)(300),Object(h.first)((e=>!e)),Object(h.map)((()=>{}))):void 0,this.prevTimesliceAsPercentage={timesliceStartAsPercentageOfTimeRange:this.getInput().timesliceStartAsPercentageOfTimeRange,timesliceEndAsPercentageOfTimeRange:this.getInput().timesliceEndAsPercentageOfTimeRange},this.syncWithTimeRange()}onInputChange(){var e;const t=this.getInput(),{timesliceStartAsPercentageOfTimeRange:i,timesliceEndAsPercentageOfTimeRange:n}=null!==(e=this.prevTimesliceAsPercentage)&&void 0!==e?e:{};if(i!==t.timesliceStartAsPercentageOfTimeRange||n!==t.timesliceEndAsPercentageOfTimeRange)t.timesliceStartAsPercentageOfTimeRange||t.timesliceEndAsPercentageOfTimeRange?this.syncWithTimeRange():(this.dispatch.publishValue({value:void 0}),this.dispatch.setValue({value:void 0}));else if(t.timeRange&&!o.a.isEqual(t.timeRange,this.prevTimeRange)){const e=this.timeRangeToBounds(t.timeRange),i=x(e[0],e[1],this.getTimezone());this.dispatch.setTimeRangeBounds({...R(i),ticks:i,timeRangeBounds:e}),this.syncWithTimeRange()}}syncWithTimeRange(){this.prevTimeRange=this.getInput().timeRange;const{explicitInput:e}=this.getState(),{timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i}=e;void 0!==t&&void 0!==i&&this.selectionsToFilters(e).then((({timeslice:e})=>{this.dispatch.publishValue({value:e}),this.dispatch.setValue({value:e}),e&&this.onRangeChange(e[1]-e[0])}))}timeRangeToBounds(e){const t=this.timefilter.calculateBounds(e);return void 0===t.min||void 0===t.max?[Date.now()-9e5,Date.now()]:[t.min.valueOf(),t.max.valueOf()]}reload(){}getTimeSliceAsPercentageOfTimeRange(e){let t,i;if(e){const n=this.getState().componentState.timeRangeBounds,s=n[1]-n[0];t=(e[0]-n[0])/s,i=(e[1]-n[0])/s}return this.prevTimesliceAsPercentage={timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i},{timesliceStartAsPercentageOfTimeRange:t,timesliceEndAsPercentageOfTimeRange:i}}clearSelections(){this.onTimesliceChange()}renderPrepend(){return Object(P.jsx)($.Provider,{value:this},Object(P.jsx)(H,{onNext:this.onNext,onPrevious:this.onPrevious,waitForControlOutputConsumersToLoad$:this.waitForControlOutputConsumersToLoad$}))}isChained(){return!1}}}}]);