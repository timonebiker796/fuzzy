/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.threatIntelligence_bundle_jsonpfunction=window.threatIntelligence_bundle_jsonpfunction||[]).push([[2],{74:function(e,t,a){e.exports=a.p+"4675c2990a45ad8bac7a3b6199bb939e.svg"},75:function(e,t){e.exports=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},76:function(e,t,a){e.exports=a.p+"08153df199173c3869bc5930d76c1e36.svg"},77:function(e,t,a){"use strict";a.r(t),a.d(t,"APP_ID",(function(){return ct})),a.d(t,"IndicatorsPageWrapper",(function(){return dt}));var i=a(1),s=a.n(i),n=a(22),o=a(38),r=a(46),c=a(5),l=a(7);const u=l.i18n.translate("xpack.threatIntelligence.blocklist.flyoutTitle",{defaultMessage:"Add blocklist"});var d=a(14),b=a(0);const j=({indicatorFileHash:e})=>{const{setBlockListIndicatorValue:t}=Object(o.a)(),{blockList:a}=Object(d.a)(),i=a.getFlyoutComponent(),s=a.exceptionListApiClient,r=a.getFormComponent(),{isLoading:l,data:j}=function(){const{http:e}=Object(c.b)().services;return Object(n.useQuery)(["policies"],(()=>e.get("/api/fleet/package_policies",{query:{withAgentCount:!0,kuery:"ingest-package-policies.package.name: endpoint"}})),{select:e=>e.items})}(),g={apiClient:s,labels:{flyoutCreateTitle:u},item:{description:"",entries:[{field:"file.hash.*",operator:"included",type:"match_any",value:[e]}],list_id:"endpoint_blocklists",name:"",namespace_type:"agnostic",os_types:["windows"],tags:["policy:all"],type:"simple"},policies:j||[],policiesIsLoading:l,FormComponent:r,onClose:()=>t("")};return Object(b.jsx)(i,g)};var g=a(2),p=a(3),x=a(4);const m="tiBarchartTimelineButton",O="tiBarchartFilterInButton",h="tiBarchartFilterOutButton",f="tiBarchartCopyToClipboardButton",y=l.i18n.translate("xpack.threatIntelligence.indicator.fieldSelector.label",{defaultMessage:"Stack by"}),I=l.i18n.translate("xpack.threatIntelligence.indicator.barChart.popover",{defaultMessage:"More actions"}),C=x.b.Feed,v={asPlainText:!0},E=Object(i.memo)((({indexPattern:e,valueChange:t,defaultStackByValue:a=C})=>{const s=e.fields.find((e=>e.name===a)),[n,o]=Object(i.useState)([{label:a,value:null==s?void 0:s.type}]),r=Object(i.useMemo)((()=>e?e.fields.map((e=>({label:e.name,value:e.type}))):[]),[e]),c=Object(i.useCallback)((e=>{e&&e.length>0&&t(e[0]),o(e)}),[t]);return Object(b.jsx)(g.EuiComboBox,{css:{maxWidth:"400px",width:"400px"},"data-test-subj":"tiIndicatorFieldSelectorDropdown",prepend:y,singleSelection:v,onChange:c,options:r,selectedOptions:n,isClearable:!1})}));var F=a(24),S=a(23),T=a.n(S),P=a(39),w=a(35),k=a(36),M=a(37);const B=({data:e,field:t})=>{const[a,s]=Object(i.useState)(!1),n="date"===t.value?T()(e).toISOString():e,o=[Object(b.jsx)(w.d,{key:O,data:n,field:t.label,"data-test-subj":O}),Object(b.jsx)(k.d,{key:h,data:n,field:t.label,"data-test-subj":h}),Object(b.jsx)(M.d,{key:m,data:n,field:t.label,"data-test-subj":m}),Object(b.jsx)(P.c,{key:f,value:n,"data-test-subj":f})];return Object(b.jsx)(g.EuiPopover,{"data-test-subj":"tiBarchartPopoverButton",button:Object(b.jsx)(g.EuiToolTip,{content:I},Object(b.jsx)(g.EuiButtonIcon,{"aria-label":I,iconType:"boxesHorizontal",iconSize:"s",size:"xs",onClick:()=>s((e=>!e)),style:{height:"100%"}})),isOpen:a,closePopover:()=>s(!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(b.jsx)(g.EuiContextMenuPanel,{size:"s",items:o}))};var z=a(43);const L="tiIndicator",A=({indicators:e,dateRange:t,field:a,height:i="200px"})=>Object(b.jsx)(g.EuiThemeProvider,null,Object(b.jsx)(F.Chart,{size:{width:"100%",height:i}},Object(b.jsx)(F.Settings,{baseTheme:F.LEGACY_LIGHT_THEME,showLegend:!0,legendPosition:F.Position.Right,legendSize:200,legendAction:({label:e})=>Object(b.jsx)(B,{field:a,data:e}),locale:l.i18n.getLocale()}),Object(b.jsx)(F.Axis,{id:`${L}TimeAxis`,position:F.Position.Bottom,labelFormat:Object(z.a)(t)}),Object(b.jsx)(F.Axis,{id:`${L}IndicatorAxis`,position:F.Position.Left}),Object(b.jsx)(F.BarSeries,{id:`${L}BarChart`,name:"Indicators",xScaleType:F.ScaleType.Time,yScaleType:F.ScaleType.Linear,xAccessor:"x",yAccessors:["y"],stackAccessors:["x"],splitSeriesAccessors:["g"],data:e}))),R=x.b.Feed,_=Object(i.memo)((({timeRange:e,indexPattern:t,isLoading:a,isFetching:i,series:s,dateRange:n,field:o,onFieldChange:r})=>a?Object(b.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiPanel,{hasShadow:!1,hasBorder:!1,paddingSize:"xl"},Object(b.jsx)(g.EuiLoadingSpinner,{"data-test-subj":"tiBarchartWrapper-loading",size:"xl"})))):Object(b.jsx)("div",{style:{position:"relative"}},Object(b.jsx)(g.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(g.EuiTitle,{size:"s"},Object(b.jsx)("h2",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.indicator.barchartSection.title",defaultMessage:"Trend"})))),Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(E,{indexPattern:t,defaultStackByValue:R,valueChange:r}))),i&&Object(b.jsx)(g.EuiProgress,{"data-test-subj":"tiBarchartWrapper-updating",size:"xs",color:"accent",position:"absolute"}),e&&Object(b.jsx)("div",{"data-test-subj":"tiBarchartWrapper"},Object(b.jsx)(A,{indicators:s,dateRange:n,field:o})))));var q=a(8);const Q="tiIndicatorsTable",D=`${Q}-updating`,G=({rowIndex:e,columnId:t,Component:a,indicators:i,pagination:n})=>{const o=i[e%n.pageSize],{key:r,value:c}=Object(q.b)(o,t);return Object(q.a)(r,c)?Object(b.jsx)(s.a.Fragment,null,Object(b.jsx)(w.c,{data:o,field:r,Component:a,"data-test-subj":"tiIndicatorsTableCellFilterInButton"}),Object(b.jsx)(k.c,{data:o,field:r,Component:a,"data-test-subj":"tiIndicatorsTableCellFilterOutButton"}),Object(b.jsx)(M.c,{data:o,field:r,Component:a,"data-test-subj":"tiIndicatorsTableCellTimelineButton"})):null};var V=a(27),H=a(9),N=a(45);const U=Object(i.createContext)(void 0);var K=a(64),W=a(58),Y=a(60),$=a(61);const Z=l.i18n.translate("xpack.threatIntelligence.indicator.table.moreActions",{defaultMessage:"More actions"}),J=l.i18n.translate("xpack.threatIntelligence.indicator.table.viewDetailsButton",{defaultMessage:"View details"}),X=({indicator:e})=>{const[t,a]=Object(i.useState)(!1),s=Object(g.useGeneratedHtmlId)({prefix:"smallContextMenuPopover"}),n=()=>{a(!1)},o=[Object(b.jsx)(Y.a,{indicator:e,onClick:n,"data-test-subj":"tiIndicatorTableAddToExistingCaseContextMenu"}),Object(b.jsx)(W.a,{indicator:e,onClick:n,"data-test-subj":"tiIndicatorTableAddToNewCaseContextMenu"}),Object(b.jsx)(K.a,{data:Object($.a)(e),onClick:n,"data-test-subj":"tiIndicatorsTableAddToBlockListContextMenu"})],r=Object(b.jsx)(g.EuiToolTip,{content:Z},Object(b.jsx)(g.EuiButtonIcon,{"aria-label":Z,iconType:"boxesHorizontal",iconSize:"s",size:"xs",onClick:()=>a((e=>!e)),style:{height:"100%"},"data-test-subj":"tiIndicatorTableMoreActionsButton"}));return Object(b.jsx)(g.EuiPopover,{id:s,button:r,isOpen:t,closePopover:n,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(b.jsx)(g.EuiContextMenuPanel,{size:"s",items:o}))};var ee=a(65);const te=({indicator:e,onOpen:t,isOpen:a})=>Object(b.jsx)(g.EuiToolTip,{content:J},Object(b.jsx)(g.EuiButtonIcon,{"data-test-subj":"tiToggleIndicatorFlyoutButton",color:a?"text":"primary",iconType:a?"minimize":"expand",isSelected:a,iconSize:"s","aria-label":J,onClick:()=>t(e)})),ae=({indicator:e})=>{const t=(()=>{const e=Object(i.useContext)(U);if(!e)throw new Error("IndicatorTableContext has to be defined");return e})(),{setExpanded:a,expanded:s}=t;return Object(b.jsx)(g.EuiFlexGroup,{justifyContent:"center",gutterSize:"none"},Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(te,{indicator:e,onOpen:a,isOpen:Boolean(s&&s._id===e._id)})),Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(ee.a,{data:e,"data-test-subj":"tiIndicatorTableInvestigateInTimelineButtonIcon"})),Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(X,{indicator:e})))};var ie=a(74),se=a.n(ie);const ne={tall:490,short:250},oe={maxWidth:500},re=({height:e="tall"})=>Object(b.jsx)(g.EuiPanel,{color:"subdued","data-test-subj":"tiIndicatorsTableEmptyState"},Object(b.jsx)(g.EuiFlexGroup,{style:{height:ne[e]},alignItems:"center",justifyContent:"center"},Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiPanel,{hasBorder:!0,style:oe},Object(b.jsx)(g.EuiFlexGroup,null,Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(g.EuiText,{size:"s"},Object(b.jsx)(g.EuiTitle,null,Object(b.jsx)("h3",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.empty.title",defaultMessage:"No results match your search criteria"}))),Object(b.jsx)("p",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.empty.description",defaultMessage:"Try searching over a longer period of time or modifying your search"})))),Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiImage,{size:"200",alt:"",src:se.a})))))));var ce=a(63),le=a(30);const ue=Object(i.createContext)(void 0),de=({children:e})=>{const t=Object(i.useMemo)((()=>({requests:new le.RequestAdapter})),[]);return Object(b.jsx)(ue.Provider,{value:t},e)},be=l.i18n.translate("xpack.threatIntelligence.inspectorFlyoutTitle",{defaultMessage:"Indicators search requests"}),je=()=>{const{services:{inspector:e}}=Object(c.b)(),t=Object(i.useContext)(ue);if(!t)throw new Error("Inspector Context is not available");const[a,s]=Object(i.useState)(void 0),n=Object(i.useCallback)((()=>{const a=e.open(t,{title:be});s(a)}),[t,e]);return Object(i.useEffect)((()=>()=>{a&&a.close()}),[a]),{onOpenInspector:n,inspectorAdapters:t}},ge=({browserFields:e,columnIds:t,onResetColumns:a,onToggleColumn:i})=>{const{triggersActionsUi:s}=Object(c.b)().services;return s.getFieldBrowser({browserFields:e,columnIds:t,onResetColumns:a,onToggleColumn:i,options:{preselectedCategoryIds:["threat","base","event","agent"]}})};var pe=a(49),xe=a(52),me=a(31);const Oe=e=>{switch(e){case me.KBN_FIELD_TYPES.IP:case me.KBN_FIELD_TYPES.GEO_SHAPE:case me.KBN_FIELD_TYPES.NUMBER:return"numeric";case me.KBN_FIELD_TYPES.BOOLEAN:return"boolean";case me.KBN_FIELD_TYPES.STRING:return"string";case me.KBN_FIELD_TYPES.DATE:return"datetime";default:return}},he={border:"horizontal",header:"underline",cellPadding:"m",fontSize:"s"},fe=({indicators:e,indicatorCount:t,onChangePage:a,onChangeItemsPerPage:n,pagination:o,isLoading:r,isFetching:c,browserFields:l,columnSettings:{columns:u,columnVisibility:d,handleResetColumns:j,handleToggleColumn:m,sorting:O}})=>{const[h,f]=Object(i.useState)(),y=Object(xe.a)(),I=Object(i.useMemo)((()=>{return e=o.pageIndex*o.pageSize,({rowIndex:t,columnId:a,setCellProps:s})=>{const n=Object(i.useContext)(U);if(!n)throw new Error("this can only be used inside indicators table");const o=Object(H.useDarkMode)(),{indicators:r,expanded:c}=n,l=r[t-e];if(Object(i.useEffect)((()=>{c&&l&&c._id===l._id?s({style:{backgroundColor:o?V.euiDarkVars.euiColorHighlight:V.euiLightVars.euiColorHighlight}}):s({style:void 0})}),[o,c,l,s]),!l)return null;const u="Actions"===a?Object(b.jsx)(ae,{indicator:l}):Object(b.jsx)(N.a,{indicator:l,field:a});return Object(b.jsx)("div",{css:{overflow:"hidden","text-overflow":"ellipsis","overflow-wrap":"initial","word-wrap":"initial","word-break":"initial"}},u)};var e}),[o.pageIndex,o.pageSize]),C=Object(i.useMemo)((()=>((e,t)=>a=>{const{rowIndex:i,columnId:n}=a,o=e[i%t.pageSize],{key:r,value:c}=Object(q.b)(o,n);return Object(q.a)(r,c)?Object(b.jsx)(s.a.Fragment,null,Object(b.jsx)(g.EuiPopoverTitle,{paddingSize:"m",css:{"max-width":"240px","word-break":"break-word"}},c),Object(b.jsx)(g.EuiFlexGroup,{gutterSize:"none"},Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(w.a,{data:o,field:r,"data-test-subj":"tiIndicatorsTableCellPopoverTimelineButton"})),Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(k.a,{data:o,field:r,"data-test-subj":"tiIndicatorsTableCellPopoverFilterInButton"}))),Object(b.jsx)(g.EuiFlexGroup,{gutterSize:"none"},Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(M.a,{data:o,field:r,"data-test-subj":"tiIndicatorsTableCellPopoverFilterOutButton"}))),Object(b.jsx)(g.EuiFlexGroup,{gutterSize:"none"},Object(b.jsx)(g.EuiFlexItem,null,Object(b.jsx)(P.a,{value:c})))):null})(e,o)),[e,o]),v=Object(i.useMemo)((()=>({expanded:h,setExpanded:f,indicators:e})),[h,e]),E=o.pageIndex*o.pageSize,F=E+o.pageSize,S=Object(i.useMemo)((()=>[{id:"Actions",width:84,headerCellRender:()=>Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.indicator.table.actionColumnLabel",defaultMessage:"Actions"}),rowCellRender:I}]),[I]),T=Object(i.useMemo)((()=>u.map((t=>{var a;return{...t,isSortable:t.id!==x.b.Id&&(null===(a=l[t.id])||void 0===a?void 0:a.aggregatable),schema:Oe(y[t.id]),cellActions:[({rowIndex:t,columnId:a,Component:i})=>Object(b.jsx)(G,{rowIndex:t,columnId:a,Component:i,indicators:e,pagination:o})]}}))),[l,u,y,e,o]),B=(({browserFields:e,start:t,end:a,indicatorCount:n,columns:o,onResetColumns:r,onToggleColumn:c})=>{const{onOpenInspector:l}=je();return Object(i.useMemo)((()=>({showDisplaySelector:!1,showFullScreenSelector:!0,additionalControls:{left:{prepend:Object(b.jsx)(g.EuiText,{style:{display:"inline"},size:"xs"},n&&a?Object(b.jsx)(s.a.Fragment,null,"Showing ",t+1,"-",a>n?n:a," of"," ",n," indicators"):Object(b.jsx)(s.a.Fragment,null,"-")),append:Object(b.jsx)(ge,{browserFields:e,columnIds:o.map((({id:e})=>e)),onResetColumns:r,onToggleColumn:c})},right:Object(b.jsx)(g.EuiButtonIcon,{"aria-label":pe.b,iconType:"inspect",title:pe.b,"data-test-subj":"tiIndicatorsGridInspect",onClick:l})}})),[n,a,t,e,o,r,c,l])})({browserFields:l,start:E,end:F,indicatorCount:t,columns:u,onResetColumns:j,onToggleColumn:m}),z=Object(i.useMemo)((()=>h?Object(b.jsx)(ce.a,{indicator:h,closeFlyout:()=>f(void 0)}):null),[h]),L=Object(i.useMemo)((()=>r?Object(b.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiPanel,{hasShadow:!1,hasBorder:!1,paddingSize:"xl"},Object(b.jsx)(g.EuiLoadingSpinner,{size:"xl"})))):t?Object(b.jsx)(s.a.Fragment,null,c&&Object(b.jsx)(g.EuiProgress,{"data-test-subj":D,size:"xs",color:"accent",position:"absolute"}),Object(b.jsx)(g.EuiSpacer,{size:"xs"}),Object(b.jsx)(g.EuiDataGrid,{"aria-labelledby":"indicators-table",leadingControlColumns:S,rowCount:t,renderCellValue:I,renderCellPopover:C,toolbarVisibility:B,pagination:{...o,onChangeItemsPerPage:n,onChangePage:a},gridStyle:he,"data-test-subj":Q,sorting:O,columnVisibility:d,columns:T,rowHeightsOptions:{lineHeight:"30px"}})):Object(b.jsx)(re,null)),[r,t,c,S,I,C,B,o,n,a,O,d,T]);return Object(b.jsx)(U.Provider,{value:v},Object(b.jsx)("div",{style:{position:"relative"}},z,L))};var ye=a(34),Ie=a(12),Ce=a(44),ve=a(32),Ee=a(6);const Fe=x.b.TimeStamp,Se=({filters:e,filterQuery:t,timeRange:a})=>({query:Object(ve.buildEsQuery)(void 0,[{query:Ee.d,language:"kuery"},{query:t.query,language:"kuery"}],[...e,{query:{range:{[Fe]:{gte:null==a?void 0:a.from,lte:null==a?void 0:a.to}}},meta:{}}])}),Te=x.b.TimeStamp;var Pe=a(55);const we=x.b.Feed,ke="indicatorsBarchart",Me=[10,25,50],Be=Me[1],ze="indicatorsTable",Le=({children:e})=>{const t=Object(d.a)().getPageWrapper();return Object(b.jsx)(t,null,e)},Ae=({children:e,pageTitle:t,border:a=!0,subHeader:i})=>Object(b.jsx)(Le,null,Object(b.jsx)(g.EuiPageHeader,{alignItems:"center",bottomBorder:a},Object(b.jsx)(g.EuiPageHeaderSection,null,t&&Object(b.jsx)(g.EuiText,null,Object(b.jsx)("h2",{"data-test-subj":"tiDefaultPageLayoutTitle"},t)),i?Object(b.jsx)(s.a.Fragment,null,Object(b.jsx)(g.EuiSpacer,{size:"m"}),i):null)),Object(b.jsx)(g.EuiSpacer,{size:"l"}),e);var Re=a(40);const _e=({children:e})=>{const t=Object(d.a)().getFiltersGlobalComponent();return Object(b.jsx)(t,null,e)};var qe=a(53),Qe=a(75),De=a.n(Qe),Ge=a(62);const Ve=[x.b.TimeStamp,x.b.Name,x.b.Type,x.b.Feed,x.b.FirstSeen,x.b.LastSeen].map((e=>({id:e,displayAsText:Object(Ge.b)(e)}))),He=Ve.map((e=>e.id)),Ne="indicatorsTable",Ue=({children:e})=>{const t=Object(d.a)(),{services:{data:{query:{filterManager:a}}}}=Object(c.b)(),s=t.useFilters(),n=t.useQuery(),o=t.useGlobalTime(),r=Object(i.useMemo)((()=>({timeRange:o,filters:s,filterQuery:n,filterManager:a})),[s,n,o,a]);return Object(b.jsx)(Re.a.Provider,{value:r},e)},Ke=l.i18n.translate("xpack.threatIntelligence.updateStatus.updating",{defaultMessage:"Updating..."}),We=l.i18n.translate("xpack.threatIntelligence.updateStatus.updated",{defaultMessage:"Updated"}),Ye=({isUpdating:e,updatedAt:t})=>Object(b.jsx)(g.EuiFlexGroup,null,Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiText,{size:"xs",color:"subdued","data-test-subj":"updateStatus"},e?Ke:Object(b.jsx)(s.a.Fragment,null,We," ",Object(b.jsx)(p.FormattedRelative,{value:new Date(t)}))))),$e=({queries:e,sourcererDataView:t})=>{const{SiemSearchBar:a,registerQuery:s,deregisterQuery:n}=Object(d.a)();return Object(i.useEffect)((()=>(e.forEach(s),()=>e.forEach(n))),[e,n,s]),Object(b.jsx)(a,{id:"global",sourcererDataView:t})},Ze=({children:e})=>Object(b.jsx)(Ue,null,Object(b.jsx)(qe.b,null,Object(b.jsx)(de,null,Object(b.jsx)(r.b,null,e)))),Je=()=>{const{blockListIndicatorValue:e}=Object(o.a)(),{browserFields:t,indexPattern:a,sourcererDataView:s}=Object(ye.a)(),r=(()=>{const{services:{storage:e}}=Object(c.b)(),[t,a]=Object(i.useState)([]),s=Object(i.useMemo)((()=>({columns:t,onSort:a})),[t]),[n,o]=Object(i.useState)([]),[r,l]=Object(i.useState)([]);Object(i.useEffect)((()=>{const{visibleColumns:t=[],columns:i=[],sortingState:s=[]}=e.get(Ne)||{visibleColumns:He,columns:Ve,sortingState:[]};l(t),o(i),a(s)}),[e]),Object(i.useEffect)((()=>{e.set(Ne,{visibleColumns:r,columns:n,sortingState:t})}),[n,t,e,r]);const u=Object(i.useCallback)((e=>{o((t=>{const a=({id:t})=>t===e,i=De()(a);return Boolean(t.find(a))?t.filter(i):[...t,{id:e,displayAsText:e}]})),l((t=>{const a=t=>t===e,i=De()(a);return Boolean(t.find(a))?t.filter(i):[...t,e]}))}),[]),d=Object(i.useCallback)((()=>{o(Ve),l(He)}),[]),b=Object(i.useMemo)((()=>({visibleColumns:r,setVisibleColumns:l})),[r]);return{handleResetColumns:d,handleToggleColumn:u,columns:n,columnVisibility:b,sorting:s}})(),{timeRange:l,filters:u,filterQuery:d}=(()=>{const e=Object(i.useContext)(Re.a);if(!e)throw new Error("Filters can only be used inside IndicatorFiltersContext");return e})(),{indicatorCount:g,indicators:p,onChangeItemsPerPage:x,onChangePage:m,pagination:O,isLoading:h,isFetching:f,dataUpdatedAt:y,query:I}=(({filters:e,filterQuery:t,sorting:a,timeRange:s})=>{const{services:{data:{search:o}}}=Object(c.b)(),{selectedPatterns:r}=Object(ye.a)(),{inspectorAdapters:l}=je(),u=Object(i.useCallback)((e=>j((t=>({...t,pageSize:e,pageIndex:0})))),[]),d=Object(i.useCallback)((e=>j((t=>({...t,pageIndex:e})))),[]),[b,j]=Object(i.useState)({pageIndex:0,pageSize:Be,pageSizeOptions:Me});Object(i.useEffect)((()=>{d(0)}),[e,t,s,a,d]);const g=Object(i.useMemo)((()=>(({searchService:e,inspectorAdapter:t})=>async({pagination:a,selectedPatterns:i,timeRange:s,filterQuery:n,filters:o,sorting:r},c)=>{const l=Se({timeRange:s,filters:o,filterQuery:n}),u={size:a.pageSize,from:a.pageIndex,fields:[{field:"*",include_unmapped:!0}],sort:r.map((({id:e,direction:t})=>({[e]:t}))),...l},{hits:{hits:d,total:b}}=await Object(Ce.a)(e,{params:{index:i,body:u},factoryQueryType:Ie.c.IndicatorGrid},{inspectorAdapter:t,requestName:"Indicators table",signal:c});return{indicators:d,total:b}})({searchService:o,inspectorAdapter:l.requests})),[l,o]),{isLoading:p,isFetching:x,data:m,refetch:O,dataUpdatedAt:h}=Object(n.useQuery)([ze,{timeRange:s,filterQuery:t,filters:e,selectedPatterns:r,sorting:a,pagination:b}],(({signal:e,queryKey:[t,a]})=>g(a,e)),{keepPreviousData:!0}),f=Object(i.useMemo)((()=>({refetch:O,id:ze,loading:p})),[p,O]);return{indicators:(null==m?void 0:m.indicators)||[],indicatorCount:(null==m?void 0:m.total)||0,pagination:b,onChangePage:d,onChangeItemsPerPage:u,isLoading:p,isFetching:x,dataUpdatedAt:h,query:f}})({filters:u,filterQuery:d,timeRange:l,sorting:r.sorting.columns}),{dateRange:C,series:v,selectedField:E,onFieldChange:F,isLoading:S,isFetching:P,query:w}=(({timeRange:e,filters:t,filterQuery:a})=>{const{services:{data:{search:s,query:o}}}=Object(c.b)(),r=Object(Pe.b)(),l=Object(Pe.a)(),{selectedPatterns:u}=Object(ye.a)(),{inspectorAdapters:d}=je(),[b,j]=Object(i.useState)({label:we,value:"string"}),g=Object(i.useMemo)((()=>(({inspectorAdapter:e,searchService:t,queryService:a,userTimeZone:i,userFormat:s})=>async({selectedPatterns:n,timeRange:o,field:r,filterQuery:c,filters:l},u)=>{const d=a.timefilter.timefilter.calculateBounds(o),b=d.min.toDate().getTime(),j=d.max.toDate().getTime(),g=Se({timeRange:o,filters:l,filterQuery:c}),p={fields:[Te,r.label],size:0,...g},{aggregations:{[Ie.a]:x}}=await Object(Ce.a)(t,{params:{index:n,body:p},factoryQueryType:Ie.c.Barchart,dateRange:{from:b,to:j},field:r.label},{signal:u,inspectorAdapter:e,requestName:"Indicators barchart"}),m=((e,t,a,i)=>e.reduce(((e,s)=>e.concat(s.events.buckets.map((e=>({x:e.key_as_string,y:e.doc_count,g:"date"===i.value?Object(z.b)(T()(s.key),t,a):s.key}))))),[]))(null==x?void 0:x.buckets,i,s,r);return m})({queryService:o,searchService:s,inspectorAdapter:d.requests,userTimeZone:r,userFormat:l})),[d.requests,o,s,l,r]),{data:p,isLoading:x,isFetching:m,refetch:O}=Object(n.useQuery)([ke,{filters:t,field:b,filterQuery:a,selectedPatterns:u,timeRange:e}],(({signal:e,queryKey:[t,a]})=>g(a,e)),{keepPreviousData:!0}),h=Object(i.useMemo)((()=>o.timefilter.timefilter.calculateBounds(e)),[o.timefilter.timefilter,e]),f=Object(i.useMemo)((()=>({refetch:O,id:ke,loading:x})),[x,O]);return{dateRange:h,series:p||[],onFieldChange:j,selectedField:b,isLoading:x,isFetching:m,query:f}})({timeRange:l,filters:u,filterQuery:d});return Object(b.jsx)(qe.b,null,Object(b.jsx)(Ae,{pageTitle:"Indicators",subHeader:Object(b.jsx)(Ye,{isUpdating:f,updatedAt:y})},Object(b.jsx)(_e,null,Object(b.jsx)($e,{queries:[w,I],sourcererDataView:s})),Object(b.jsx)(_,{dateRange:C,series:v,timeRange:l,indexPattern:a,field:E,onFieldChange:F,isFetching:P,isLoading:S}),Object(b.jsx)(fe,{browserFields:t,indexPattern:a,columnSettings:r,pagination:O,indicatorCount:g,indicators:p,isLoading:h,isFetching:f,onChangeItemsPerPage:x,onChangePage:m}),e&&Object(b.jsx)(j,{indicatorFileHash:e})))},Xe=()=>Object(b.jsx)(Ze,null,Object(b.jsx)(Je,null)),et=["integrations"],tt=l.i18n.translate("xpack.threatIntelligence.common.emptyPage.imgAlt",{defaultMessage:"Enable Threat Intelligence Integrations"});var at=a(76),it=a.n(at),st=a(15);const nt=()=>{const e=`${Object(c.b)().services.http.basePath.get()}/app/integrations/browse/threat_intel`,t=Object(c.b)().services.docLinks.links.securitySolution.threatIntelInt;return Object(b.jsx)(st.a,{isEmptyState:!0,emptyPageBody:Object(b.jsx)(g.EuiEmptyPrompt,{icon:Object(b.jsx)(g.EuiImage,{size:"fullWidth",alt:tt,src:it.a}),title:Object(b.jsx)("h3",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.title",defaultMessage:"Get started with Elastic Threat Intelligence"})),titleSize:"s",layout:"horizontal",color:"transparent",body:Object(b.jsx)(s.a.Fragment,null,Object(b.jsx)("p",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.body1",defaultMessage:"Elastic Threat Intelligence makes it easy to analyze and investigate potential security threats by aggregating data from multiple sources in one place."})),Object(b.jsx)("p",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.body2",defaultMessage:"You’ll be able to view data from all activated threat intelligence feeds and take action from this page."})),Object(b.jsx)("p",null,Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.body3",defaultMessage:"To get started with Elastic Threat Intelligence, enable one or more Threat Intelligence Integrations from the Integrations page or ingest data using filebeat. For more information, view the {docsLink}.",values:{docsLink:Object(b.jsx)(g.EuiLink,{href:t,target:"_blank","data-test-subj":"tiEmptyPageDocsLink"},Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.docsLinkText",defaultMessage:"Security app documentation"}))}}))),actions:Object(b.jsx)(g.EuiButton,{"data-test-subj":"tiEmptyPageIntegrationsPageLink",href:e,color:"primary",iconType:"plusInCircle",fill:!0},Object(b.jsx)(p.FormattedMessage,{id:"xpack.threatIntelligence.common.emptyPage.buttonText",defaultMessage:"Add Integrations"})),"data-test-subj":"tiEmptyPage"})})};var ot=a(26);const rt=Object(i.memo)((({children:e})=>{const{isLoading:t,count:a}=(()=>{const{services:{data:{search:e}}}=Object(c.b)(),[t,a]=Object(i.useState)(0),[s,n]=Object(i.useState)(!0),{selectedPatterns:o,loading:r}=Object(ye.a)();return Object(i.useEffect)((()=>{const t={params:{index:o,body:{size:0,query:{bool:{must:[{term:{"event.category":{value:"threat"}}},{term:{"event.type":{value:"indicator"}}}]}}}}};e.search(t).subscribe({next:e=>{if(!Object(ot.isRunningResponse)(e)){const t=e.rawResponse.hits.total||0;a(t),n(!1)}}})}),[e,o]),{count:t,isLoading:s||r}})(),{isLoading:o,data:r}=(({enabled:e})=>{const t=Object(i.useRef)(),{http:a}=Object(c.b)().services,s=Object(i.useCallback)((e=>a.get("/api/fleet/epm/packages",{version:"2023-10-31",signal:e.signal})),[a]),o=Object(n.useQuery)(et,s,{select:e=>e?e.items.filter((e=>"installed"===e.status&&null!=e.categories.find((e=>"threat_intel"===e))&&"ti_util"!==e.id)):[],enabled:e}),r=Object(n.useQueryClient)();return Object(i.useEffect)((()=>(t.current=setTimeout((()=>{r.cancelQueries(et)}),2e3),()=>{t.current&&clearTimeout(t.current)})),[r]),o})({enabled:!t});return o||t?Object(b.jsx)(st.a,{isEmptyState:!0,emptyPageBody:Object(b.jsx)(g.EuiPageTemplate.EmptyPrompt,{color:"transparent"},Object(b.jsx)(g.EuiLoadingLogo,{"data-test-subj":"tiIndicatorsLoadingLogo",logo:"logoSecurity",size:"xl"}))}):a>0||(r||[]).length>0?Object(b.jsx)(s.a.Fragment,null,e):Object(b.jsx)(nt,null)})),ct="securitySolution",lt=new n.QueryClient,ut=[ct],dt=()=>{const{cases:e}=Object(c.b)().services,t=Object(i.useMemo)((()=>e.ui.getCasesContext()),[e.ui]),a=Object(i.useMemo)((()=>e.helpers.canUseCases()),[e.helpers]);return Object(b.jsx)(t,{owner:ut,permissions:a},Object(b.jsx)(n.QueryClientProvider,{client:lt},Object(b.jsx)(rt,null,Object(b.jsx)(st.a,null,Object(b.jsx)(Xe,null)))))};t.default=Object(i.memo)(dt)}}]);