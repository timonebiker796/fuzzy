/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[8],{706:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a(54),n=a(1),i=l.__importDefault(a(88)),s=a(201),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=n.useState(null),t=e[0],a=e[1],l=n.useState(r),s=l[0],o=l[1],c=n.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,l=t.y,n=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:l,width:n,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},707:function(e,t,a){e.exports=a(41)(1963)},712:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return zs})),a.d(t,"renderApp",(function(){return Hs})),a.d(t,"teardownFleet",(function(){return Us}));var l=a(1),n=a.n(l),i=a(35),s=a.n(i),r=a(22),o=a(266),c=a(17),u=a(20),d=a.n(u),g=a(6),m=a(709),p=a(655),E=a(73),f=a(12),b=a(4),y=a(32),h=a.n(y),k=a(7),v=a(102),x=a(259),F=a(61),M=a(114),S=a(103),I=a(116),T=a(117),O=a(16),w=a(132),j=a(5),C=a(140),A=a(144),P=a(58),L=a.n(P),_=a(269),D=a(59),B=a(30);const R=L()(g.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-1pwanx7-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),z=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(c.sc)(),s=Object(c.yb)().fleet.allAgentPolicies,[r,o]=Object(l.useState)(Object(B.b)()),[u,m]=Object(l.useState)(!1),[p,E]=Object(l.useState)(!0),y=Object(A.h)(r),[h,k]=Object(l.useState)(!1),v=n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle","data-test-subj":"createAgentPolicyFlyoutTitle"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,{size:"s"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),x=n.a.createElement(g.EuiFlyoutBody,null,n.a.createElement(A.d,{agentPolicy:r,updateAgentPolicy:e=>{o({...r,...e})},withSysMonitoring:p,updateSysMonitoring:e=>E(e),validation:y,updateAdvancedSettingsHasErrors:k})),{showDevtoolsRequest:F}=D.b.get(),M=Object(l.useMemo)((()=>Object(_.a)(r,p)),[r,p]),S=n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"none"},F?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(T.h,{isDisabled:u||Object.keys(y).length>0||h,description:b.i18n.translate("xpack.fleet.createAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request creates a new agent policy."}),request:M})):null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,isLoading:u,isDisabled:!s||u||Object.keys(y).length>0||h,onClick:async()=>{m(!0);try{const{data:t,error:a}=await(async()=>await Object(c.k)(r,{withSysMonitoring:p}))();m(!1),t?(i.toasts.addSuccess(b.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy ''{name}'' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:b.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){m(!1),i.toasts.addDanger(b.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}},"data-test-subj":"createAgentPolicyFlyoutBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))))));return n.a.createElement(R,d()({onClose:()=>e()},a,{maxWidth:O.q}),v,x,S)},N=()=>{var e,t;Object(c.zb)("policies_list");const{getPath:a}=Object(c.jc)(),i=Object(c.yb)().fleet.allAgentPolicies,{agents:{enabled:s}}=Object(c.Cb)(),{urlParams:o,toUrlParams:u}=Object(c.vc)(),[d,m]=Object(l.useState)(Array.isArray(o.kuery)?o.kuery[o.kuery.length-1]:null!==(e=o.kuery)&&void 0!==e?e:""),{pagination:p,pageSizeOptions:E,setPagination:y}=Object(c.mc)(),{sorting:h,setSorting:k}=Object(c.rc)({field:"updated_at",direction:"desc"}),v=Object(r.useHistory)(),x="create"in o,F=Object(l.useCallback)((e=>{if(e!==x)if(e)v.push(`${a("policies_list")}?${u({...o,create:null})}`);else{const{create:e,...t}=o;v.push(`${a("policies_list")}?${u(t)}`)}}),[a,v,x,u,o]),{isLoading:M,data:S,refetch:I}=Object(c.Nb)({page:p.currentPage,perPage:p.pageSize,sortField:null==h?void 0:h.field,sortOrder:null==h?void 0:h.direction,kuery:d,full:!0}),w=Object(l.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:b.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"35%",render:(e,t)=>n.a.createElement(C.e,{policy:t,withDescription:!0})},{field:"updated_at",sortable:!0,name:b.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>n.a.createElement(f.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:b.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Unprivileged / Privileged"}),dataType:"number",render:(e,t)=>n.a.createElement(g.EuiFlexGroup,{direction:"row",gutterSize:"xs",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.unprivilegedAgentsTooltip",defaultMessage:"Unprivileged agents"})},n.a.createElement(A.g,{count:t.unprivileged_agents||0,agentPolicyId:t.id,showAgentText:!1,privilegeMode:"unprivileged"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},"/"),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.privilegedAgentsTooltip",defaultMessage:"Privileged agents"})},n.a.createElement(A.g,{count:e-(t.unprivileged_agents||0),agentPolicyId:t.id,showAgentText:!1,privilegeMode:"privileged"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("span",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.totalAgentsTooltipWrapper",defaultMessage:"({message})",values:{message:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.totalAgentsTooltip",defaultMessage:"Total agents"})},n.a.createElement(A.g,{count:e,agentPolicyId:t.id,showAgentText:!1}))}}))),Object(j.N)(t.package_policies||[]).length>0&&(t.unprivileged_agents||0)>0&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{type:"warning",color:"warning",content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.containsUnprivilegedAgentsWarning",defaultMessage:"This agent policy contains integrations that require Elastic Agents to have root privileges. Some enrolled agents are running in unprivileged mode."})})))},{field:"package_policies",name:b.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{field:"actions",name:b.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>n.a.createElement(A.a,{agentPolicy:e,onCopySuccess:()=>I()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,I]),P=Object(l.useMemo)((()=>n.a.createElement(g.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>F(!0),"data-test-subj":"createAgentPolicyButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,F]),L=Object(l.useMemo)((()=>n.a.createElement(g.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>F(!0),"data-test-subj":"emptyPromptCreateAgentPolicyButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,F]),_=Object(l.useMemo)((()=>n.a.createElement(g.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:L})),[L]);return n.a.createElement(n.a.Fragment,null,x?n.a.createElement(z,{onClose:()=>{F(!1),I()}}):null,n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},n.a.createElement(g.EuiFlexItem,{grow:4},n.a.createElement(T.u,{value:d,indexPattern:O.m,fieldPrefix:O.e,onChange:e=>{y({...p,currentPage:1}),m(e)},dataTestSubj:"agentPolicyList.queryInput"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>I()},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},P)),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiBasicTable,{loading:M,noItemsMessage:M?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):d.trim()||0!==(null!==(t=null==S?void 0:S.total)&&void 0!==t?t:0)?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:n.a.createElement(g.EuiLink,{onClick:()=>m("")},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):_,items:S?S.items:[],itemId:"id",columns:w,pagination:{pageIndex:p.currentPage-1,pageSize:p.pageSize,totalItemCount:S?S.total:0,pageSizeOptions:E},sorting:{sort:h},onChange:e=>{const t={...p,currentPage:e.page.index+1,pageSize:e.page.size};y(t),k(e.sort)}}))};var H=a(19),U=a(9);const q=(e,t)=>e.localeCompare(t),G=e=>({name:e,value:e}),W=({packagePolicies:e,agentPolicy:t,...a})=>{var i,s;const{application:r}=Object(c.sc)(),o=Object(c.yb)(),u=o.integrations.writeIntegrationPolicies,m=o.fleet.readAgentPolicies,p=o.integrations.readIntegrationPolicies,{isPackagePolicyUpgradable:E}=Object(c.fc)(),{getHref:y}=Object(c.jc)(),{canUseMultipleAgentPolicies:h}=Object(c.kc)(),k=Object(c.nc)(),v=!(null!==(i=k.data)&&void 0!==i&&i.success)&&"MISSING_SECURITY"===(null===(s=k.data)||void 0===s?void 0:s.error),[x,F]=Object(l.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,l,n,i,s,r;e.namespace&&t.add(e.namespace);const o=E(e);return{...e,packageName:null!==(a=null===(l=e.package)||void 0===l?void 0:l.name)&&void 0!==a?a:"",packageTitle:null!==(n=null===(i=e.package)||void 0===i?void 0:i.title)&&void 0!==n?n:"",packageVersion:null!==(s=null===(r=e.package)||void 0===r?void 0:r.version)&&void 0!==s?s:"",hasUpgrade:o}})),[...t].sort(q).map(G)]}),[e,E]),M=Object(l.useCallback)((e=>e.policy_ids.length||0),[]),S=Object(l.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:b.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableName",grow:!1},n.a.createElement(g.EuiLink,d()({title:e},p?{href:y("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),n.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?n.a.createElement("span",null," ",n.a.createElement(g.EuiToolTip,{content:a.description},n.a.createElement(g.EuiIcon,{type:"help"}))):null)),h&&m&&p&&M(a)>1&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.sharedTooltip",defaultMessage:"This integration is shared by {numberShared} agent policies",values:{numberShared:M(a)}})},n.a.createElement(g.EuiText,{"data-test-subj":"PackagePoliciesTableSharedLabel",color:"subdued",size:"xs",className:"eui-textNoWrap"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentPolicyList.agentsColumn.sharedText",defaultMessage:"Shared"})," ",n.a.createElement(g.EuiIcon,{type:"iInCircle"})))))},{field:"packageTitle",sortable:!0,name:b.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableLink",grow:!1},n.a.createElement(g.EuiLink,{href:a.package&&y("integration_details_overview",{pkgkey:Object(D.p)(a.package)})},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(T.r,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),n.a.createElement(g.EuiFlexItem,{grow:!1},e),a.package&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:b.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},n.a.createElement(g.EuiIcon,{type:"warning",color:"warning"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{"data-test-subj":"PackagePoliciesTableUpgradeButton",size:"s",minWidth:"0",isDisabled:!u,href:`${y("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:b.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?n.a.createElement(g.EuiBadge,{color:"hollow"},e):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiBadge,{color:"default"},t.namespace),n.a.createElement(g.EuiIconTip,{content:"Namespace defined in parent agent policy",position:"right",type:"iInCircle",color:"subdued"}))},{name:b.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>u?n.a.createElement(T.s,{agentPolicies:[t],from:"fleet-policy-list",packagePolicy:e,upgradePackagePolicyHref:`${y("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`}):n.a.createElement(n.a.Fragment,null)}]}]),[p,y,t,h,m,u,M]);return n.a.createElement(g.EuiInMemoryTable,d()({itemId:"id",items:x,columns:S,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[n.a.createElement(T.j,{key:"addPackagePolicyButton",fill:!0,isDisabled:!u,iconType:"plusInCircle",onClick:()=>{r.navigateToApp(H.INTEGRATIONS_PLUGIN_ID,{path:U.C.integrations_all({})[1],state:{forAgentPolicyId:t.id}})},"data-test-subj":"addPackagePolicyButton",tooltip:u?void 0:{content:v?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonSecurityRequiredTooltip",defaultMessage:"To add Elastic Agent Integrations, you must have security enabled and have the All privilege for Fleet. Contact your administrator."}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonPrivilegesRequiredTooltip",defaultMessage:"Elastic Agent Integrations require the All privilege for Fleet and All privilege for Integrations. Contact your administrator."})}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:F,multiSelect:"or",operator:"exact"}]}}))},K=Object(l.memo)((({policyId:e})=>{const{application:t}=Object(c.sc)(),a=Object(c.yb)(),l=a.integrations.writeIntegrationPolicies&&a.fleet.allAgentPolicies;return n.a.createElement(g.EuiEmptyPrompt,{iconType:"plusInCircle",title:n.a.createElement("h3",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:n.a.createElement(g.EuiButton,{iconType:"plusInCircle",isDisabled:!l,fill:!0,onClick:()=>t.navigateToApp(O.o,{path:O.v.integrations_all({})[1],state:{forAgentPolicyId:e}}),"data-test-subj":"addPackagePolicyButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),V=Object(l.memo)((({agentPolicy:e})=>(Object(c.zb)("policy_details",{policyName:e.name}),e.package_policies&&0!==e.package_policies.length?n.a.createElement(W,{agentPolicy:e,packagePolicies:e.package_policies}):n.a.createElement(K,{policyId:e.id}))));var $=a(13);const Q=e=>Object($.pick)(e,["name","description","namespace","monitoring_enabled","unenroll_timeout","inactivity_timeout","data_output_id","monitoring_output_id","download_source_id","fleet_server_host_id","agent_features","is_protected","advanced_settings","global_data_tags"]),Y=L.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1lbh22t-0"})(["max-width:1200px;margin-right:auto;margin-left:auto;"]),X=Object(l.memo)((({agentPolicy:e})=>{Object(c.zb)("policy_details",{policyName:e.name});const{notifications:t}=Object(c.sc)(),{agents:{enabled:a}}=Object(c.Cb)(),i=Object(c.yb)().fleet.allAgentPolicies,s=Object(c.wb)(),[r,o]=Object(l.useState)({...e}),[u,d]=Object(l.useState)(!1),[m,p]=Object(l.useState)(!1),[E,y]=Object(l.useState)(0),[h,k]=Object(l.useState)(!0),v=Object(A.h)(r),[x,F]=Object(l.useState)(!1),M=async()=>{d(!0);try{const{data:e,error:a}=await Object(c.tb)(r.id,Q(r));e?(t.toasts.addSuccess(b.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated ''{name}'' settings",values:{name:r.name}})),s(),p(!1)):t.toasts.addDanger(a?a.message:b.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(b.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}d(!1)},{showDevtoolsRequest:S}=D.b.get(),I=Object(l.useMemo)((()=>Object(_.c)(r.id,Q(r))),[r]);return n.a.createElement(Y,null,E?n.a.createElement(A.f,{agentCount:E,agentPolicies:[r],onConfirm:()=>{y(0),M()},onCancel:()=>{y(0),d(!1)}}):null,n.a.createElement(A.d,{agentPolicy:r,updateAgentPolicy:e=>{o({...r,...e}),p(!0)},withSysMonitoring:h,updateSysMonitoring:e=>k(e),validation:v,isEditing:!0,updateAdvancedSettingsHasErrors:F}),m?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiBottomBar,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{color:"text",onClick:()=>{o({...e}),p(!1)}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),S?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(T.h,{isDisabled:u||Object.keys(v).length>0||x,btnProps:{color:"text"},description:b.i18n.translate("xpack.fleet.editAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request updates an agent policy."}),request:I})):null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{onClick:async()=>{if(a){d(!0);const{data:e}=await Object(c.x)({policyId:r.id});null!=e&&e.results.total?y(e.results.total):await M()}else await M()},isLoading:u,isDisabled:!i||u||Object.keys(v).length>0||x,iconType:"save",color:"primary",fill:!0},u?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),J=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:l}=Object(c.jc)();return n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiButtonEmpty,{iconType:"arrowLeft",href:l("policies_list"),flush:"left",size:"xs"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),n.a.createElement(g.EuiFlexItem,null,e?n.a.createElement(T.p,null):n.a.createElement(g.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiTitle,null,n.a.createElement("h1",null,a&&a.name||n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy ''{id}''",values:{id:t}})))),(null==a?void 0:a.is_managed)&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{title:"Hosted agent policy",content:b.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)};var Z=a(0);const ee=L.a.div.withConfig({displayName:"Divider",componentId:"sc-zpeocb-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),te=({isLoading:e,agentPolicy:t,addAgent:a,onCancelEnrollment:i,isAddAgentHelpPopoverOpen:s,setIsAddAgentHelpPopoverOpen:o})=>{var u;const d=Object(c.yb)(),{getPath:m}=Object(c.jc)(),p=Object(r.useHistory)(),E=Object(l.useMemo)((()=>{var e;return null==t||null===(e=t.package_policies)||void 0===e?void 0:e.some((e=>{var t;return(null===(t=e.package)||void 0===t?void 0:t.name)===Z.ab}))}),[t]);if(!t)return null;const y=n.a.createElement(g.EuiLink,{onClick:a,"data-test-subj":"addAgentLink"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.addFleetServerButton",defaultMessage:"Add Fleet Server"})),h=n.a.createElement(g.EuiLink,{onClick:a,"data-test-subj":"addAgentLink"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},e||!t?null:[{label:b.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(u=t.revision)&&void 0!==u?u:0},{isDivider:!0},{label:b.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:n.a.createElement(g.EuiI18nNumber,{value:t.package_policies&&t.package_policies.length||0})},{isDivider:!0},...d.fleet.readAgents?[{label:b.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:!t.agents&&E&&d.fleet.addFleetServers?n.a.createElement(T.a,{button:y,isOpen:s,offset:15,closePopover:()=>{o(!1)}}):t.agents||E||!d.fleet.addAgents?n.a.createElement(g.EuiFlexGroup,{direction:"row",gutterSize:"xs",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.summary.usedByUnprivilegedTooltip",defaultMessage:"{count, plural, one {# unprivileged agent} other {# unprivileged agents}}",values:{count:t.unprivileged_agents||0}})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.summary.usedByPrivilegedTooltip",defaultMessage:"{count, plural, one {# privileged agent} other {# privileged agents}}",values:{count:(t.agents||0)-(t.unprivileged_agents||0)}})))},n.a.createElement(A.g,{count:t.agents||0,agentPolicyId:t.id,showAgentText:!0}))),Object(j.N)(t.package_policies||[]).length>0&&(t.unprivileged_agents||0)>0&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{type:"warning",color:"warning",content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.summary.containsUnprivilegedAgentsWarning",defaultMessage:"This agent policy contains integrations that require Elastic Agents to have root privileges. Some enrolled agents are running in unprivileged mode."})}))):n.a.createElement(T.a,{button:h,isOpen:s,offset:15,closePopover:()=>{o(!1)}})},{isDivider:!0}]:[],{label:b.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:t&&n.a.createElement(f.FormattedDate,{value:null==t?void 0:t.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:t&&n.a.createElement(A.a,{agentPolicy:t,fullButton:!0,onCopySuccess:e=>{p.push(m("policy_details",{policyId:e.id}))},onCancelEnrollment:i})}].map(((e,t)=>{var a;return n.a.createElement(g.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?n.a.createElement(ee,null):e.label?n.a.createElement(g.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},n.a.createElement(g.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),n.a.createElement(g.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},ae=()=>{const{params:{policyId:e,tabId:t=""}}=Object(r.useRouteMatch)(),{getHref:a}=Object(c.jc)(),i=Object(c.Wb)(e),s=i.data?i.data.item:null,{isLoading:o,error:u,sendRequest:d}=i,m=new URLSearchParams(Object(r.useLocation)().search),p="true"===m.get("openEnrollmentFlyout"),E="true"===m.get("showAddAgentHelp"),[y]=Object(l.useState)(!1),[h,k]=Object(l.useState)(p),[v,x]=Object(l.useState)(E),{application:{navigateToApp:F}}=Object(c.sc)(),M=Object(c.ec)(),{isReady:S}=Object(c.Kb)(),I=Object(l.useMemo)((()=>{if(M&&M.onDoneNavigateTo&&S){const[e,t]=M.onDoneNavigateTo;return()=>F(e,t)}}),[S,F,M]),O=Object(l.useCallback)((()=>{x(!1),k(!0)}),[]),j=Object(l.useMemo)((()=>[{id:"integrations",name:b.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:a("policy_details",{policyId:e,tabId:"integrations"}),isSelected:""===t||"integrations"===t},{id:"settings",name:b.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:a("policy_details",{policyId:e,tabId:"settings"}),isSelected:"settings"===t}]),[a,e,t]),C=Object(l.useMemo)((()=>y?n.a.createElement(r.Redirect,{to:"/"}):o?n.a.createElement(T.p,null):u?n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:u}):s?n.a.createElement(n.a.Fragment,null,h&&n.a.createElement(g.EuiPortal,null,n.a.createElement(T.c,{agentPolicy:s,onClose:I||(()=>k(!1))})),n.a.createElement(le,{agentPolicy:s})):n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:b.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy ''{id}'' not found",values:{id:e}})})),[y,o,u,s,h,I,e]),A=n.a.createElement(J,{agentPolicy:s,policyId:e,isLoading:o}),P=n.a.createElement(te,{agentPolicy:s,onCancelEnrollment:I,isLoading:o,isAddAgentHelpPopoverOpen:v,setIsAddAgentHelpPopoverOpen:x,addAgent:O});return n.a.createElement(c.a.Provider,{value:{refresh:d}},n.a.createElement(w.d,{leftColumn:A,rightColumn:P,tabs:j},C))},le=({agentPolicy:e})=>(Object(c.zb)("policy_details",{policyName:e.name}),n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.policy_details_settings,render:()=>n.a.createElement(X,{agentPolicy:e})}),n.a.createElement(o.b,{path:O.k.policy_details,render:()=>n.a.createElement(V,{agentPolicy:e})})));var ne=a(268);const ie=Object(l.memo)((()=>{const{params:{packagePolicyId:e,policyId:t}}=Object(r.useRouteMatch)(),{search:a}=Object(r.useLocation)(),l=new URLSearchParams(a).get("from");let i;return l&&"fleet-policy-list"===l?i="upgrade-from-fleet-policy-list":l&&"integrations-policy-list"===l&&(i="upgrade-from-integrations-policy-list"),n.a.createElement(ne.a,{packagePolicyId:e,policyId:t,from:i,forceUpgrade:!0})})),se=()=>(Object(c.zb)("policies"),n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.edit_integration},n.a.createElement(ne.b,null)),n.a.createElement(o.b,{path:O.k.upgrade_package_policy},n.a.createElement(ie,null)),n.a.createElement(o.b,{path:O.k.policy_details},n.a.createElement(ae,null)),n.a.createElement(o.b,{path:O.k.policies_list},n.a.createElement(w.a,{section:"agent_policies"},n.a.createElement(N,null)))));var re=a(72);const oe=Object(l.memo)((({datastream:e})=>{const{dashboards:t}=e,a=Object(c.Db)(),l=n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),i=n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),s=b.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"}),r=b.i18n.translate("xpack.fleet.dataStreamList.viewInApmActionText",{defaultMessage:"View in APM"}),{isSuccessful:o,href:u}=Object(re.a)(e);if(o&&u){const e=[{id:0,items:[{icon:"apmApp",href:u,name:r}]}];return n.a.createElement(T.g,{panels:e})}if(!t||0===t.length){const e=[{id:0,items:[{icon:"dashboardApp",disabled:!0,name:l}]}];return n.a.createElement(T.g,{panels:e})}if(1===t.length){var d;const e=[{id:0,items:[{icon:"dashboardApp",href:null==a?void 0:a.getRedirectUrl({dashboardId:null===(d=t[0])||void 0===d?void 0:d.id}||""),name:l}]}];return n.a.createElement(T.g,{panels:e})}const g=[{id:0,items:[{icon:"dashboardApp",panel:1,name:i}]},{id:1,title:s,items:t.map((e=>({icon:"dashboardApp",href:null==a?void 0:a.getRedirectUrl({dashboardId:null==e?void 0:e.id}||""),name:e.title})))}];return n.a.createElement(T.g,{panels:g})})),ce=()=>{Object(c.zb)("data_streams");const{pagination:e,pageSizeOptions:t}=Object(c.mc)(),{isLoading:a,data:i,resendRequest:s}=Object(c.Pb)(),r=Object(l.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:b.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:b.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:b.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?n.a.createElement(g.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:b.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(T.r,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),n.a.createElement(g.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:b.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedDate,{value:e,year:"numeric",month:"short",day:"numeric"}),n.a.createElement(n.a.Fragment,null," @ "),n.a.createElement(f.FormattedTime,{value:e,hour:"numeric",minute:"numeric",second:"numeric"}))},{field:"size_in_bytes",sortable:!0,name:b.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:(e,t)=>n.a.createElement(n.a.Fragment,null,t.size_in_bytes_formatted)},{name:b.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>n.a.createElement(oe,{datastream:e})}]}]),[]),o=Object(l.useMemo)((()=>n.a.createElement(g.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),u={dataset:[],type:[],namespace:[],package:[]};if(i&&i.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};i.data_streams.forEach((t=>{const{dataset:a,type:l,namespace:n,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(l)||e.type.push(l),e.namespace.includes(n)||e.namespace.push(n),e.package.includes(i)||e.package.push(i)}));for(const t in e)u[t]&&(u[t]=e[t].sort().map((e=>({value:e,name:e}))))}return n.a.createElement(g.EuiInMemoryTable,{loading:a,tableLayout:"auto",message:a?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):i&&!i.data_streams.length?o:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:i?i.data_streams:[],itemId:"index",columns:r,pagination:{initialPageSize:e.pageSize,pageSizeOptions:t},sorting:!0,search:{toolsRight:[n.a.createElement(g.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>s()},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:b.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:b.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:u.dataset},{type:"field_value_selection",field:"type",name:b.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:u.type},{type:"field_value_selection",field:"namespace",name:b.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:u.namespace},{type:"field_value_selection",field:"package",name:b.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:u.package}]}})},ue=()=>n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.data_streams},n.a.createElement(w.a,{section:"data_streams"},n.a.createElement(ce,null))));var de=a(141),ge=a(28);const me=({onClose:e,agents:t,agentCount:a})=>{const{notifications:i}=Object(c.sc)(),[s,o]=Object(l.useState)(!1),u=Array.isArray(t)&&1===t.length,{getPath:d}=Object(c.jc)(),m=Object(r.useHistory)(),[p,E]=Object(l.useState)(!1);return n.a.createElement(g.EuiConfirmModal,{"data-test-subj":"requestDiagnosticsModal",title:u?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.singleTitle",defaultMessage:"Request diagnostics"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.multipleTitle",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),onCancel:e,onConfirm:async function(){try{o(!0);const a=p?[ge.d.CPU]:[],{error:l}=u?await Object(c.gb)(t[0].id,{additional_metrics:a}):await Object(c.Y)({agents:"string"==typeof t?t:t.map((e=>e.id)),additional_metrics:a});if(l)throw l;o(!1);const n=b.i18n.translate("xpack.fleet.requestDiagnostics.successSingleNotificationTitle",{defaultMessage:"Request diagnostics submitted"});if(i.toasts.addSuccess(n),u){const e=d("agent_details_diagnostics",{agentId:t[0].id});m.push(e)}e()}catch(e){o(!1),i.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.requestDiagnostics.fatalErrorNotificationTitle",{defaultMessage:"Error requesting diagnostics {count, plural, one {agent} other {agents}}",values:{count:a}})})}},cancelButtonText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:s,confirmButtonText:u?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmSingleButtonLabel",defaultMessage:"Request diagnostics"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmMultipleButtonLabel",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),buttonColor:"primary"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.description",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs. By default, files are periodically deleted via an ILM policy."})),n.a.createElement("p",null,n.a.createElement(g.EuiCheckbox,{id:"cpuMetricsCheckbox","data-test-subj":"cpuMetricsCheckbox",label:"Collect additional CPU metrics",checked:p,onChange:()=>E(!p)})))};function pe(e){return e.length>20?`${e.substring(0,20)}...`:e}function Ee(e){return e.replace(/[^a-zA-Z0-9 \-_]/g,"").slice(0,20)}const fe=L.a.div.withConfig({displayName:"Wrapped",componentId:"sc-rnfjm9-0"})(["display:flex;.wrappedText{white-space:pre-wrap;}"]),be=({tags:e,color:t,size:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(fe,null,n.a.createElement(g.EuiToolTip,{anchorClassName:"wrappedText",content:n.a.createElement("span",{"data-test-subj":"agentTagsTooltip"},e.join(", "))},n.a.createElement(g.EuiText,{size:a,color:t},n.a.createElement("span",{"data-test-subj":"agentTags"},Object($.take)(e,3).map(pe).join(", "),e.length>3?` + ${e.length-3} more`:"")))));function ye(e,t){return void 0!==(null==e?void 0:e.cpu_avg)?n.a.createElement(g.EuiToolTip,{content:`${(100*e.cpu_avg).toFixed(4)} %`},n.a.createElement(n.a.Fragment,null,(100*e.cpu_avg).toFixed(2)," %")):n.a.createElement(de.l,{agentPolicy:t})}function he(e,t){return null!=e&&e.memory_size_byte_avg?function(e,t=0){if(0===e)return"0 Bytes";const a=t<0?0:t,l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][l]}(e.memory_size_byte_avg):n.a.createElement(de.l,{agentPolicy:t})}var ke=a(55),ve=a.n(ke);function xe(e){const t=Date.parse(e||"")-Date.now();return t<0?"":t<9e5?" The upgrade will start in less than 15 minutes.":t<18e5?" The upgrade will start in less than 30 minutes.":t<36e5?" The upgrade will start in less than 1 hour.":` The upgrade will start in less than ${Math.ceil(t/36e5)} hours.`}function Fe(e){if(!e||void 0===e.download_percent&&void 0===e.download_rate)return"";let t="";return void 0!==e.download_percent&&(t=`${e.download_percent}%`),void 0!==e.download_rate&&(t+=` at ${Me(e.download_rate)}`),` (${t.trim()})`}const Me=e=>{let t=0;const a=[" Bps"," kBps"," MBps"," GBps"];for(;t<a.length-1&&!(e<1024);t++)e/=1024;return e.toFixed(1)+a[t]},Se=e=>{if(!e)return"";const t=new Date(e).toISOString(),a=Date.parse(e)-Date.now(),l=ve.a.utc(ve.a.duration(a,"milliseconds").asMilliseconds()).format("HH:mm");return a>0?`Retrying until: ${t} (${l} remaining)`:""},Ie=({isAgentUpgradable:e,agent:t,latestAgentVersion:a})=>{const i=Object(l.useMemo)((()=>t.upgrade_started_at&&!t.upgraded_at),[t.upgrade_started_at,t.upgraded_at]),s=Object(l.useMemo)((()=>function(e){var t,a,l;switch(null==e?void 0:e.state){case"UPG_REQUESTED":return{Badge:n.a.createElement(g.EuiBadge,{color:"accent",iconType:"calendar"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRequested",defaultMessage:"Upgrade requested"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRequested",defaultMessage:"The agent has requested an upgrade."})};case"UPG_SCHEDULED":return{Badge:n.a.createElement(g.EuiBadge,{color:"accent",iconType:"clock"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeScheduled",defaultMessage:"Upgrade scheduled"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeScheduled",defaultMessage:"The agent has been instructed to upgrade.{upgradeStartDelay}",values:{upgradeStartDelay:xe(null===(t=e.metadata)||void 0===t?void 0:t.scheduled_at)}})};case"UPG_DOWNLOADING":var i,s;return null!=e&&null!==(a=e.metadata)&&void 0!==a&&a.retry_error_msg?{Badge:n.a.createElement(g.EuiBadge,{color:"accent",iconType:"download"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeDownloading",defaultMessage:"Upgrade downloading"})),WarningTooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeDownloadingFailed",defaultMessage:"Upgrade failing: {retryMsg}. {retryUntil}",values:{retryMsg:null==e||null===(i=e.metadata)||void 0===i?void 0:i.retry_error_msg,retryUntil:Se(null==e||null===(s=e.metadata)||void 0===s?void 0:s.retry_until)}})}:{Badge:n.a.createElement(g.EuiBadge,{color:"accent",iconType:"download"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeDownloading",defaultMessage:"Upgrade downloading"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeDownloading",defaultMessage:"Downloading the new agent artifact version{downloadEstimate}.",values:{downloadEstimate:Fe(null==e?void 0:e.metadata)}})};case"UPG_EXTRACTING":return{Badge:n.a.createElement(g.EuiBadge,{color:"accent",iconType:"package"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeExtracting",defaultMessage:"Upgrade extracting"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeExtracting",defaultMessage:"The new agent artifact is extracting."})};case"UPG_REPLACING":return{Badge:n.a.createElement(g.EuiBadge,{color:"warning",iconType:"copy"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeReplacing",defaultMessage:"Upgrade replacing"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeReplacing",defaultMessage:"Replacing the agent artifact version."})};case"UPG_RESTARTING":return{Badge:n.a.createElement(g.EuiBadge,{color:"warning",iconType:"refresh"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRestarting",defaultMessage:"Upgrade restarting"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRestarting",defaultMessage:"The agent is restarting to apply the update."})};case"UPG_WATCHING":return{Badge:n.a.createElement(g.EuiBadge,{color:"warning",iconType:"inspect"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeMonitoring",defaultMessage:"Upgrade monitoring"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeMonitoring",defaultMessage:"Monitoring the new agent version for errors."})};case"UPG_ROLLBACK":return{Badge:n.a.createElement(g.EuiBadge,{color:"danger",iconType:"returnKey"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRolledBack",defaultMessage:"Upgrade rolled back"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRolledBack",defaultMessage:"Upgrade unsuccessful. Rolling back to previous version."})};case"UPG_FAILED":return{Badge:n.a.createElement(g.EuiBadge,{color:"danger",iconType:"error"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeFailed",defaultMessage:"Upgrade failed"})),TooltipText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeFailed",defaultMessage:"Upgrade failed: {errorMsg}.",values:{errorMsg:null==e||null===(l=e.metadata)||void 0===l?void 0:l.error_msg}})};default:return null}}(t.upgrade_details)),[t.upgrade_details]),r=Object(j.I)(t,a);return e&&Object(j.R)(t,a)?n.a.createElement(g.EuiBadge,{color:"hollow",iconType:"sortUp"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeAvailable",defaultMessage:"Upgrade available"})):t.upgrade_details&&s?n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},s.Badge),s.TooltipText&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{type:"iInCircle",content:s.TooltipText,color:"subdued"})),s.WarningTooltipText&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{type:"warning",content:s.WarningTooltipText,color:"warning"}))):i?n.a.createElement(g.EuiIconTip,{type:"iInCircle",content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeDetailsNotAvailable",defaultMessage:"Detailed upgrade status is available for Elastic Agents on version {minVersion} and higher.",values:{minVersion:"8.12"}}),color:"subdued"}):!e&&r?n.a.createElement(g.EuiIconTip,{type:"iInCircle",content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.notUpgradeable",defaultMessage:"Agent not upgradeable: {reason}",values:{reason:r}}),color:"subdued"}):null},Te=({hasFleetAddAgentsPrivileges:e,setEnrollmentFlyoutState:t})=>n.a.createElement(g.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:e?n.a.createElement(g.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>t({isOpen:!0})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null});function Oe(e){return"string"!=typeof e?"-":e}const we=e=>{const{agents:t,isLoading:a,agentPoliciesIndexedById:l,renderActions:i,sortField:s,sortOrder:r,onTableChange:o,onSelectionChange:u,selected:d,totalAgents:m=0,showUpgradeable:p,pagination:E,pageSizeOptions:y,isUsingFilter:h,setEnrollmentFlyoutState:k,clearFilters:v,isCurrentRequestIncremented:x}=e,F=Object(c.yb)(),{displayAgentMetrics:M}=D.b.get(),{getHref:S}=Object(c.jc)(),I=Object(c.xb)(),O=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=l[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},w=a&&x?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):h?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:n.a.createElement(g.EuiLink,{onClick:()=>v()},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):n.a.createElement(Te,{hasFleetAddAgentsPrivileges:F.fleet.addAgents,setEnrollmentFlyoutState:k}),j={sort:{field:s,direction:r}},C=[{field:"active",sortable:!1,width:"85px",name:b.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>n.a.createElement(de.a,{agent:t})},{field:"local_metadata.host.hostname",sortable:!0,name:b.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),width:"185px",render:(e,t)=>{var a;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"none",direction:"column"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiLink,{href:S("agent_details",{agentId:t.id})},Oe(e))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(be,{tags:null!==(a=t.tags)&&void 0!==a?a:[],color:"subdued",size:"xs"})))}},{field:"policy_id",sortable:!0,truncateText:!0,name:b.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),width:"185px",render:(e,t)=>{const a=l[e],i=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",style:{minWidth:0},alignItems:"center"},a&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(T.f,{direction:"column",policy:a,agent:t})),i&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},n.a.createElement(g.EuiIcon,{size:"m",type:"warning",color:"warning"})," ",n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Outdated policy"}))))}},...M?[{field:"metrics",sortable:!1,name:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.cpuTooltip",defaultMessage:"Average CPU usage in the last 5 minutes. This includes usage from the Agent and the component it supervises. Possible value ranges from 0 to (number of available CPU cores * 100)"})},n.a.createElement("span",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.cpuTitle",defaultMessage:"CPU"})," ",n.a.createElement(g.EuiIcon,{type:"iInCircle"}))),width:"75px",render:(e,t)=>ye(t.metrics,t.policy_id?l[t.policy_id]:void 0)},{field:"metrics",sortable:!1,name:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.memoryTooltip",defaultMessage:"Average memory usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.memoryTitle",defaultMessage:"Memory"})," ",n.a.createElement(g.EuiIcon,{type:"iInCircle"}))),width:"90px",render:(e,t)=>he(t.metrics,t.policy_id?l[t.policy_id]:void 0)}]:[],{field:"last_checkin",sortable:!0,name:b.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),width:"180px",render:(e,t)=>e?n.a.createElement(f.FormattedRelative,{value:e}):null},{field:"local_metadata.elastic.agent.version",sortable:!0,width:"180px",name:b.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"s",className:"eui-textNoWrap"},Oe(e))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ie,{isAgentUpgradable:!(!O(t)||!Object(D.j)(t)),agent:t,latestAgentVersion:I})))))},{name:b.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:i}],width:"100px"}];return n.a.createElement(g.EuiBasicTable,{className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:a,noItemsMessage:w,items:m?p?t.filter((e=>O(e)&&Object(D.j)(e))):t:[],itemId:"id",columns:C,pagination:{pageIndex:E.currentPage-1,pageSize:E.pageSize,totalItemCount:m,pageSizeOptions:y},selection:F.fleet.allAgents?{selected:d,onSelectionChange:u,selectable:O,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&l[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"}:void 0,onChange:o,sorting:j})},je=()=>{var e,t;const a=Object(c.Cb)();return n.a.createElement(g.EuiCallOut,{iconType:"warning",color:"warning",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentSoftLimitCallout.calloutTitle",defaultMessage:"Max number of online agents reached"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentSoftLimitCallout.calloutDescription",defaultMessage:"Fleet supports a maximum of {nbAgents} active agents. You need to unenroll some agents to ensure that all active agents are able to connect and new agents can be enrolled.",values:{nbAgents:n.a.createElement(f.FormattedNumber,{value:null!==(e=null===(t=a.internal)||void 0===t?void 0:t.activeAgentsSoftLimit)&&void 0!==e?e:25e3})}}))};var Ce=a(105);const Ae=Object(g.euiPaletteColorBlindBehindText)(),Pe={default:Ce.euiLightVars.euiColorLightShade,primary:Ae[1],success:Ae[0],accent:Ae[2],warning:Ae[5],danger:Ae[9],inactive:Ce.euiLightVars.euiColorDarkShade,lightest:Ce.euiLightVars.euiColorDisabled},Le=["healthy","unhealthy","updating","offline","inactive","unenrolled"];function _e(e){switch(e){case"healthy":return Pe.success;case"offline":return Pe.default;case"inactive":return Pe.inactive;case"unhealthy":return Pe.warning;case"updating":return Pe.primary;case"unenrolled":return Pe.lightest;default:throw new Error(`Unsupported Agent status ${e}`)}}const De=L()(g.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-1wvk6tr-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),Be=({agentStatus:e})=>{const t=Object(l.useMemo)((()=>Le.reduce(((t,a)=>{const l=t.length>0?t[t.length-1].stop:0;return t.push({stop:l+(e[a]||0),color:_e(a)}),t}),[])),[e]);return 0===t[t.length-1].stop?n.a.createElement(g.EuiSpacer,{size:"s"}):n.a.createElement(De,{"data-test-subj":"agentStatusBar",className:"ingest-agent-status-bar",size:"s",palette:t})},Re=L.a.div.withConfig({displayName:"Divider",componentId:"sc-1e6bwq9-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),ze=L()(g.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1e6bwq9-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),Ne=L()(g.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1e6bwq9-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),He=({totalAgents:e,selectableAgents:t,managedAgentsOnCurrentPage:a,selectionMode:l,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r})=>{const o="manual"===l&&s.length>0||"query"===l&&e>0,c="manual"===l&&s.length===t&&t<e-a;return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"xs",color:"subdued"},e>O.t?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:n.a.createElement(f.FormattedNumber,{value:O.t}),total:n.a.createElement(f.FormattedNumber,{value:e})}}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),o?n.a.createElement(n.a.Fragment,null,n.a.createElement(ze,{grow:!1},n.a.createElement(Re,null)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiText,{size:"xs",color:"subdued","data-test-subj":"selectedAgentCountLabel"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{selectionMode, select, manual { {count, plural, one {# agent} other {# agents}} } other {All agents} } selected",values:{selectionMode:l,count:s.length}}))),c?n.a.createElement(n.a.Fragment,null,n.a.createElement(ze,{grow:!1},n.a.createElement(Re,null)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ne,{size:"xs",flush:"left","data-test-subj":"selectedEverythingOnAllPagesButton",onClick:()=>i("query")},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"})))):null,n.a.createElement(ze,{grow:!1},n.a.createElement(Re,null)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ne,{size:"xs",flush:"left","data-test-subj":"clearAgentSelectionButton",onClick:()=>{i("manual"),r([])}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"})))):n.a.createElement(ze,{grow:!1})))},Ue=Object(l.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(l.useMemo)((()=>Le.filter((e=>!!t||"inactive"!==e&&"unenrolled"!==e))),[t]);return n.a.createElement(g.EuiFlexGroup,{gutterSize:"m"},a.map((t=>n.a.createElement(g.EuiFlexItem,{key:t,grow:!1},n.a.createElement(qe,{status:t,count:e[t]||0})))))})),qe=Object(l.memo)((({status:e,count:t})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiHealth,{color:_e(e)},n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return b.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return b.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return b.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unenrolled":return b.i18n.translate("xpack.fleet.agentStatus.unenrolledLabel",{defaultMessage:"Unenrolled"});case"unhealthy":return b.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return b.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Unsupported Agent status ${e}`)}}(e)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),Ge=({agentStatus:e,totalAgents:t,selectableAgents:a,managedAgentsOnCurrentPage:l,selectionMode:i,setSelectionMode:s,selectedAgents:r,setSelectedAgents:o,showInactive:c,clearFilters:u,isUsingFilter:d})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexStart",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(He,{totalAgents:t,selectableAgents:a,managedAgentsOnCurrentPage:l,selectionMode:i,setSelectionMode:s,selectedAgents:r,setSelectedAgents:o})),d?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiLink,{onClick:()=>u()},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.header.clearFiltersLinkText",defaultMessage:"Clear filters"}))):null),n.a.createElement(g.EuiFlexItem,{grow:!1},e&&n.a.createElement(Ue,{showInactive:c,agentStatus:e}))),n.a.createElement(g.EuiSpacer,{size:"s"}),e&&n.a.createElement(Be,{agentStatus:e}));var We=a(385);const Ke=()=>{const{notifications:e}=Object(c.sc)(),t=Object(l.useCallback)((async(t,a,l,n)=>{try{const n=await t();if(n.error)throw n.error;const i=!n.data.actionId,s=null!=l?l:b.i18n.translate("xpack.fleet.updateAgentTags.successNotificationTitle",{defaultMessage:"Tag(s) updated"});e.toasts.addSuccess(s),a(i)}catch(t){const a=null!=n?n:b.i18n.translate("xpack.fleet.updateAgentTags.errorNotificationTitle",{defaultMessage:"Tag(s) update failed"});e.toasts.addError(t,{title:a})}}),[e.toasts]);return{updateTags:Object(l.useCallback)((async(e,a,l,n,i)=>{await t((async()=>await Object(c.ib)(e,{tags:a})),l,n,i)}),[t]),bulkUpdateTags:Object(l.useCallback)((async(e,a,l,n,i,s)=>{await t((async()=>await Object(c.V)({agents:e,tagsToAdd:a,tagsToRemove:l,includeInactive:!0})),n,i,s)}),[t])}};var Ve=a(15);const $e="fleet.lastSeenInactiveAgentsCount";async function Qe(){var e,t;const a=await Object(c.A)({kuery:"status:online",perPage:0,showInactive:!1});if(a.error)throw new Error(a.error.message);return null!==(e=null===(t=a.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0}const Ye="fleet.missingEncryptionKeyCalloutHasBeenDismissed",Xe=({search:e,selectedAgentPolicies:t,selectedTags:a,selectedStatus:l,selectedAgentIds:n})=>{let i="";if(e&&(i=e.trim()),null!=t&&t.length&&(i&&(i=`(${i}) and`),i=`${i} ${O.b}.policy_id : (${t.map((e=>`"${e}"`)).join(" or ")})`),null!=a&&a.length&&(i&&(i=`(${i}) and`),i=`${i} ${O.b}.tags : (${a.map((e=>`"${e}"`)).join(" or ")})`),null!=n&&n.length&&(i&&(i=`(${i}) and`),i=`${i} ${O.b}.agent.id : (${n.map((e=>`"${e}"`)).join(" or ")})`),null!=l&&l.length){const e=l.map((e=>{switch(e){case"healthy":return D.a.buildKueryForOnlineAgents();case"unhealthy":return D.a.buildKueryForErrorAgents();case"offline":return D.a.buildKueryForOfflineAgents();case"updating":return D.a.buildKueryForUpdatingAgents();case"inactive":return D.a.buildKueryForInactiveAgents();case"unenrolled":return D.a.buildKueryForUnenrolledAgents()}})).filter((e=>void 0!==e)).join(" or ");i=i?`(${i}) and (${e})`:e}return i.trim()},Je=({tagName:e,isTagHovered:t,onTagsUpdated:a})=>{const[i,s]=Object(l.useState)(!1),[r,o]=Object(l.useState)(),[c,u]=Object(l.useState)(t),[d,m]=Object(l.useState)(e);Object(l.useEffect)((()=>{u(t||i)}),[t,i]),Object(l.useEffect)((()=>{m(e)}),[e]);const p=(e=!1)=>{s(!1),e?v():k(d)},E=Ke(),y=E.bulkUpdateTags,h='tags:"{name}"',k=t=>{if(t===e||!t)return;const l=h.replace("{name}",e);y(l,[t],[e],(l=>a([t],[e],l)),b.i18n.translate("xpack.fleet.renameAgentTags.successNotificationTitle",{defaultMessage:"Tag renamed"}),b.i18n.translate("xpack.fleet.renameAgentTags.errorNotificationTitle",{defaultMessage:"Tag rename failed"}))},v=()=>{const t=h.replace("{name}",e);E.bulkUpdateTags(t,[],[e],(t=>a([],[e],t)),b.i18n.translate("xpack.fleet.deleteAgentTags.successNotificationTitle",{defaultMessage:"Tag deleted"}),b.i18n.translate("xpack.fleet.deleteAgentTags.errorNotificationTitle",{defaultMessage:"Tag delete failed"}))};return n.a.createElement(n.a.Fragment,null,c&&n.a.createElement(g.EuiButtonIcon,{iconType:"boxesHorizontal","aria-label":b.i18n.translate("xpack.fleet.tagOptions.tagOptionsToggleButtonLabel",{defaultMessage:"Tag Options"}),color:"text",onClick:e=>{o(e.currentTarget),s(!i)}}),i&&n.a.createElement(g.EuiWrappingPopover,{isOpen:!0,button:r,closePopover:p,anchorPosition:"downCenter"},n.a.createElement(g.EuiFlexGroup,{direction:"column",alignItems:"flexStart",gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldText,{placeholder:b.i18n.translate("xpack.fleet.tagOptions.nameTextFieldPlaceholder",{defaultMessage:"Enter new name for tag"}),value:d,required:!0,onKeyDown:e=>{"Enter"===e.key&&p()},onChange:e=>{const t=e.currentTarget.value;m(Ee(t))}})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiButtonEmpty,{size:"s",color:"danger",onClick:()=>{p(!0)}},n.a.createElement(g.EuiIcon,{type:"trash"})," ",n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.tagOptions.deleteText",defaultMessage:"Delete tag"}))))))},Ze=L()(g.EuiHighlight).withConfig({displayName:"TruncatedEuiHighlight",componentId:"sc-492jbf-0"})(["width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),et=({agentId:e,agents:t,allTags:a,selectedTags:i,button:s,onTagsUpdated:r,onClosePopover:o})=>{const c=Object(l.useCallback)(((e,t)=>e.map((e=>({label:e,checked:t.includes(e)?"on":void 0,onFocusBadge:!1})))),[]),[u,d]=Object(l.useState)(c(a,i)),[m,p]=Object(l.useState)(void 0),[E,y]=Object(l.useState)(!0),[h,k]=Object(l.useState)({}),v=Ke();Object(l.useEffect)((()=>{d(c(a,i))}),[a,c,i]);const x=Object(l.useMemo)((()=>u.some((e=>e.label===m))),[u,m]),F=(e,t,l=!0,n=!1)=>{if(l)return r();const i=u.filter((e=>"on"===e.checked)).map((e=>e.label)),s=Object($.difference)(i,t).concat(e),o=Object($.uniq)(a.concat(s)),g=n?Object($.difference)(o,t):o;d(c(g,s))},M=async(a,l,n,s)=>{if(e){const t=Object($.difference)(i,l).concat(a);v.updateTags(e,t,(()=>r()),n,s)}else v.bulkUpdateTags(t,a,l,(e=>F(a,l,e)),n,s)},S=n.a.createElement(g.EuiButtonEmpty,{color:"text","data-test-subj":"createTagBtn",onClick:()=>{m&&M([m],[],b.i18n.translate("xpack.fleet.createAgentTags.successNotificationTitle",{defaultMessage:"Tag created"}),b.i18n.translate("xpack.fleet.createAgentTags.errorNotificationTitle",{defaultMessage:"Tag creation failed"}))}},n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIcon,{type:"plus"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.tagsAddRemove.createText",defaultMessage:'Create a new tag "{name}"',values:{name:m}}))));return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiWrappingPopover,{isOpen:E,button:s,closePopover:()=>{y(!1),o()},anchorPosition:"leftUp"},n.a.createElement(g.EuiSelectable,{onFocus:()=>{},"aria-label":b.i18n.translate("xpack.fleet.tagsAddRemove.selectableTagsLabel",{defaultMessage:"Add / remove tags"}),searchable:!0,searchProps:{"data-test-subj":"addRemoveTags",placeholder:b.i18n.translate("xpack.fleet.tagsAddRemove.findOrCreatePlaceholder",{defaultMessage:"Find or create tag..."}),onChange:e=>{p(Ee(e))},value:null!=m?m:""},options:u,renderOption:(e,t)=>n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",onMouseEnter:()=>k({...h,[e.label]:!0}),onMouseLeave:()=>k({...h,[e.label]:!1})},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(Ze,{search:t,onClick:()=>{const t="on"===e.checked?[]:[e.label],a="on"===e.checked?[e.label]:[];M(t,a)}},e.label)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Je,{tagName:e.label,isTagHovered:h[e.label],onTagsUpdated:(e,t,a)=>F(e,t,a,!0)})))},((e,t)=>n.a.createElement(l.Fragment,null,t,e))),x&&0!==u.length||""===m?null:S))},tt=({nAgentsInTable:e,totalManagedAgentIds:t,selectionMode:a,currentQuery:i,selectedAgents:s,agentsOnCurrentPage:r,refreshAgents:o,allTags:u,agentPolicies:d})=>{const m=Object(c.ic)().hasAtLeast(Z.mb),[p,E]=Object(l.useState)(!1),b=()=>E(!1),[y,h]=Object(l.useState)(!1),[k,v]=Object(l.useState)(!1),[x,F]=Object(l.useState)({isOpen:!1,isScheduled:!1,isUpdating:!1}),[M,S]=Object(l.useState)(!1),[I,T]=Object(l.useState)(!1),O=Object(l.useMemo)((()=>{if(t.length){const e=`${Z.c}.agent.id : (${t.map((e=>`"${e}"`)).join(" or ")})`;return`(${i}) AND NOT (${e})`}return i}),[i,t]),w="manual"===a?s:O,j="manual"===a?s.length:e-(null==t?void 0:t.length),[C,A]=Object(l.useState)(),{diagnosticFileUploadEnabled:P}=D.b.get(),L=[{id:0,items:[{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.addRemoveTags","data-test-subj":"agentBulkActionsAddRemoveTags",defaultMessage:"Add / remove tags"}),icon:n.a.createElement(g.EuiIcon,{type:"tag",size:"m"}),onClick:e=>{A(e.target.closest("button")),S(!M)}},{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy","data-test-subj":"agentBulkActionsReassign",defaultMessage:"Assign to new policy"}),icon:n.a.createElement(g.EuiIcon,{type:"pencil",size:"m"}),onClick:()=>{b(),h(!0)}},{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents","data-test-subj":"agentBulkActionsUpgrade",defaultMessage:"Upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:j}}),icon:n.a.createElement(g.EuiIcon,{type:"refresh",size:"m"}),onClick:()=>{b(),F({isOpen:!0,isScheduled:!1,isUpdating:!1})}},{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.scheduleUpgradeAgents","data-test-subj":"agentBulkActionsScheduleUpgrade",defaultMessage:"Schedule upgrade for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:j}}),icon:n.a.createElement(g.EuiIcon,{type:"timeRefresh",size:"m"}),disabled:!m,onClick:()=>{b(),F({isOpen:!0,isScheduled:!0,isUpdating:!1})}},{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.restartUpgradeAgents","data-test-subj":"agentBulkActionsRestartUpgrade",defaultMessage:"Restart upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:j}}),icon:n.a.createElement(g.EuiIcon,{type:"refresh",size:"m"}),onClick:()=>{b(),F({isOpen:!0,isScheduled:!1,isUpdating:!0})}},...P?[{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.requestDiagnostics","data-test-subj":"agentBulkActionsRequestDiagnostics",defaultMessage:"Request diagnostics for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:j}}),icon:n.a.createElement(g.EuiIcon,{type:"download",size:"m"}),onClick:()=>{b(),T(!0)}}]:[],{name:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents","data-test-subj":"agentBulkActionsUnenroll",defaultMessage:"Unenroll {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:j}}),icon:n.a.createElement(g.EuiIcon,{type:"trash",size:"m"}),onClick:()=>{b(),v(!0)}}]}],_=Object(l.useMemo)((()=>((e,t,a)=>{const l=e=>e.reduce(((e,t)=>{var l,n;return(e=>{const t=a.find((t=>t.id===e.policy_id));return!!t&&t.is_managed})(t)?e:e.length<1?null!==(n=t.tags)&&void 0!==n?n:[]:Object($.intersection)(null!==(l=t.tags)&&void 0!==l?l:[],e)}),[]);return Array.isArray(e)?l(t.length>0?t.filter((t=>e.find((e=>e.id===t.id)))):e):l(t)})(w,null!=r?r:[],d)),[w,r,d]);return n.a.createElement(n.a.Fragment,null,y&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.c,{agents:w,onClose:()=>{h(!1),o()}})),k&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.d,{agents:w,agentCount:j,onClose:()=>{v(!1),o({refreshTags:!0})}})),x.isOpen&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.e,{agents:w,agentCount:j,isScheduled:x.isScheduled,isUpdating:x.isUpdating,onClose:()=>{F({isOpen:!1,isScheduled:!1,isUpdating:!1}),o()}})),M&&n.a.createElement(et,{agents:Array.isArray(w)?w.map((e=>e.id)):w,allTags:null!=u?u:[],selectedTags:_,button:C,onTagsUpdated:()=>{o({refreshTags:!0})},onClosePopover:()=>{S(!1),b()}}),I&&n.a.createElement(g.EuiPortal,null,n.a.createElement(me,{agents:w,agentCount:j,onClose:()=>{T(!1)}})),n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiPopover,{id:"agentBulkActionsMenu",button:n.a.createElement(g.EuiButton,{fill:!0,iconType:"arrowDown",iconSide:"right",onClick:()=>E(!p),"data-test-subj":"agentBulkActionsButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentBulkActions.actions",defaultMessage:"Actions"})),isOpen:p,closePopover:b,panelPaddingSize:"none",anchorPosition:"downLeft"},n.a.createElement(g.EuiContextMenu,{initialPanelId:0,panels:L})))))},at=({onClickAgentActivity:e,showAgentActivityTour:t})=>{var a;const{storage:i,uiSettings:s}=Object(c.sc)(),[r,o]=Object(l.useState)(t),u=s.get("hideAnnouncements",!1)||!1===(null===(a=i.get(O.u.AGENT_ACTIVITY))||void 0===a?void 0:a.active);Object(l.useEffect)((()=>{o(t)}),[t,o]);const d=()=>{o({isOpen:!1}),i.set(O.u.AGENT_ACTIVITY,{active:!1})};return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTourStep,{content:n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourContent",defaultMessage:"Review in progress, completed, and scheduled agent action activity history here anytime."})),isStepOpen:!u&&r.isOpen,onFinish:d,minWidth:360,maxWidth:360,step:1,stepsTotal:1,title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourTitle",defaultMessage:"Agent activity history"}),anchorPosition:"upCenter",footerAction:n.a.createElement(g.EuiButtonEmpty,{onClick:d},"OK"),anchor:"#agentActivityButton"}),n.a.createElement(g.EuiButtonEmpty,{onClick:()=>{e(),o({isOpen:!1})},"data-test-subj":"agentActivityButton",iconType:"clock",id:"agentActivityButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.agentActivityButton",defaultMessage:"Agent activity"})))};var lt=a(217);const nt=[{status:"healthy",label:b.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:b.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:b.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:b.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:b.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})},{status:"unenrolled",label:b.i18n.translate("xpack.fleet.agentList.statusUnenrolledFilterText",{defaultMessage:"Unenrolled"})}],it=L()(g.EuiNotificationBadge).withConfig({displayName:"LeftpaddedNotificationBadge",componentId:"sc-94zpuo-0"})(["margin-left:10px;"]),st=({children:e,isOpen:t,setInactiveAgentsCalloutHasBeenDismissed:a})=>n.a.createElement(g.EuiTourStep,{content:n.a.createElement(g.EuiText,{size:"s"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.inactiveAgentsTourStepContent",defaultMessage:"Some agents have become inactive and have been hidden. Use status filters to show inactive or unenrolled agents."})),isStepOpen:t,minWidth:300,step:1,stepsTotal:0,title:"",onFinish:()=>{},anchorPosition:"upCenter",maxWidth:280,footerAction:n.a.createElement(g.EuiLink,{onClick:()=>{a(!0)}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addAgentHelpPopover.footActionButton",defaultMessage:"Got it"}))},e),rt=e=>{const{euiTheme:t}=Object(g.useEuiTheme)(),{selectedStatus:a,onSelectedStatusChange:i,disabled:s,totalInactiveAgents:r,isOpenByDefault:o=!1}=e,[c,u]=(()=>{const{storage:e}=Object(Ve.Xc)(),[t,a]=Object(l.useState)(0);return Object(l.useEffect)((()=>{const t=e.get($e);t&&a(parseInt(t,10))}),[e]),[t,t=>{e.set($e,t.toString()),a(t)}]})(),{isHidden:d,dismiss:m}=Object(lt.a)("INACTIVE_AGENTS"),p=Object(l.useMemo)((()=>{const e=r-c;return e<0?0:e}),[c,r]);Object(l.useMemo)((()=>{a.length&&a.includes("inactive")&&p&&u(r)}),[a,p,u,r]),Object(l.useMemo)((()=>{r>0&&c>r&&u(r)}),[c,r,u]);const[E,b]=Object(l.useState)(o),y=e=>{e&&p>0&&!d&&m(),b(e)},h=Object(l.useCallback)((()=>nt.map((({label:e,status:t})=>({label:e,checked:a.includes(t)?"on":void 0,key:t,append:"inactive"===t&&p>0?n.a.createElement(it,null,p):void 0})))),[a,p]),[k,v]=Object(l.useState)(h());Object(l.useEffect)((()=>{v(h())}),[h]);const x=Object(l.useCallback)((e=>{v(e),e.forEach(((e,t)=>{if(e.checked===k[t].checked);else{const t=e.key;"on"!==e.checked?i([...a.filter((e=>e!==t))]):i([...a,t])}}))}),[i,k,a]);return n.a.createElement(st,{isOpen:p>0&&!d,setInactiveAgentsCalloutHasBeenDismissed:m},n.a.createElement(g.EuiPopover,{ownFocus:!0,zIndex:Number(t.levels.header)-1,button:n.a.createElement(g.EuiFilterButton,{iconType:"arrowDown",onClick:()=>y(!E),isSelected:E,hasActiveFilters:a.length>0,numActiveFilters:a.length,numFilters:nt.length,disabled:s,"data-test-subj":"agentList.statusFilter"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:E,closePopover:()=>y(!1),panelPaddingSize:"none"},n.a.createElement(g.EuiSelectable,{options:k,onChange:x,"data-test-subj":"agentList.agentStatusFilterOptions",listProps:{paddingSize:"s",style:{minWidth:140}}},(e=>e))))},ot=()=>{const e=Object(c.Db)(),t=t=>(null==e?void 0:e.getRedirectUrl({dashboardId:t}))||"",{dashboardExists:a,loading:i}=(e=>{const[t,a]=n.a.useState(!1),[i,s]=n.a.useState(!0),{dashboard:r}=Object(c.sc)();return Object(l.useEffect)((()=>{(async()=>{try{const t=await r.findDashboardsService(),[l]=await t.findByIds([e]);s(!1),a("success"===(null==l?void 0:l.status))}catch(e){s(!1),a(!1)}})()}),[e,r]),{dashboardExists:t,loading:i}})(Z.t.ELASTIC_AGENT_OVERVIEW);return i||!a?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexStart"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{iconType:"dashboardApp",href:t(Z.t.ELASTIC_AGENT_OVERVIEW),"data-test-subj":"ingestOverviewLinkButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.ingestOverviewlinkButton",defaultMessage:"Ingest Overview Metrics"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{iconType:"dashboardApp",href:t(Z.t.ELASTIC_AGENT_AGENT_INFO),"data-test-subj":"agentInfoLinkButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.agentInfoLinkButton",defaultMessage:"Agent Info Metrics"})))))},ct=({selectedAgentPolicies:e,onSelectedAgentPoliciesChange:t,agentPolicies:a})=>{const{euiTheme:i}=Object(g.useEuiTheme)(),[s,r]=Object(l.useState)(!1),o=Object(l.useCallback)((()=>a.map((t=>({label:t.name,checked:e.includes(t.id)?"on":void 0,key:t.id,"data-test-subj":"agentList.agentPolicyFilterOption"})))),[a,e]),[c,u]=Object(l.useState)(o());return Object(l.useEffect)((()=>{u(o())}),[o]),n.a.createElement(g.EuiPopover,{ownFocus:!0,zIndex:Number(i.levels.header)-1,button:n.a.createElement(g.EuiFilterButton,{iconType:"arrowDown",onClick:()=>r(!s),isSelected:s,hasActiveFilters:e.length>0,numActiveFilters:e.length,numFilters:a.length,disabled:0===a.length,"data-test-subj":"agentList.policyFilter"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:s,closePopover:()=>r(!1),panelPaddingSize:"none"},n.a.createElement(g.EuiSelectable,{options:c,onChange:a=>{u(a),a.forEach(((a,l)=>{if(a.checked===c[l].checked)var n;else{const l=a.key;"on"!==a.checked?(n=l,t(e.filter((e=>e!==n)))):(a=>{t([...e,a])})(l)}}))},"data-test-subj":"agentList.agentPolicyFilterOptions",listProps:{paddingSize:"s",style:{minWidth:200}}},(e=>e)))},ut=({tags:e,selectedTags:t,onSelectedTagsChange:a})=>{const{euiTheme:i}=Object(g.useEuiTheme)(),[s,r]=Object(l.useState)(!1),o=Object(l.useCallback)((()=>e.map((e=>({label:e,checked:t.includes(e)?"on":void 0,key:e,"data-test-subj":"agentList.tagFilterOption"})))),[e,t]),[c,u]=Object(l.useState)(o());return Object(l.useEffect)((()=>{u(o())}),[o]),n.a.createElement(g.EuiPopover,{ownFocus:!0,zIndex:Number(i.levels.header)-1,button:n.a.createElement(g.EuiFilterButton,{iconType:"arrowDown",onClick:()=>r(!s),isSelected:s,hasActiveFilters:t.length>0,numActiveFilters:t.length,numFilters:e.length,disabled:0===e.length,"data-test-subj":"agentList.tagsFilter"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.tagsFilterText",defaultMessage:"Tags"})),isOpen:s,closePopover:()=>r(!1),panelPaddingSize:"none"},n.a.createElement(g.EuiSelectable,{options:c,onChange:e=>{e.forEach(((e,l)=>{if(e.checked!==c[l].checked){const l=e.key;return"on"!==e.checked?void(e=>{a(t.filter((t=>t!==e)))})(l):void(e=>{a([...t,e])})(l)}})),u(e)},"data-test-subj":"agentList.agentPolicyFilterOptions",listProps:{paddingSize:"s",style:{minWidth:140}}},(e=>e)),n.a.createElement(g.EuiHorizontalRule,{margin:"none"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center",justifyContent:"center",gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{iconType:"error",color:"danger","data-test-subj":"agentList.tagFilterClearAllBtn",onClick:()=>{a([])}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.tagsFilterClearAllBtnText",defaultMessage:"Clear all"})))))},dt=({recentErrors:e,onClick:t})=>0===e?null:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.agentActivityBadge.tooltip",defaultMessage:"{recentErrors, plural, one {There is # new agent activity error} other {There are # new agent activity errors}}. Click to view.",values:{recentErrors:e}})},n.a.createElement(g.EuiBadge,{color:"warning",onClick:t,onClickAriaLabel:"Open the Agent activity flyout",iconType:"warning",iconOnClick:t,iconOnClickAriaLabel:"Open the Agent activity flyout","data-test-subj":"agentActivityBadge"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.agentActivityBadge.label",defaultMessage:"Review errors"}))),gt=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:l,selectedAgentPolicies:i,onSelectedAgentPoliciesChange:s,selectedStatus:r,onSelectedStatusChange:o,showUpgradeable:u,onShowUpgradeableChange:d,tags:m,selectedTags:p,onSelectedTagsChange:E,nAgentsInTable:b,totalInactiveAgents:y,totalManagedAgentIds:h,selectionMode:k,currentQuery:v,selectedAgents:x,refreshAgents:F,onClickAddAgent:M,onClickAddFleetServer:S,agentsOnCurrentPage:I,onClickAgentActivity:w,showAgentActivityTour:j,latestAgentActionErrors:C})=>{const A=Object(c.yb)(),{isFirstTimeAgentUser:P,isLoading:L}=Object(We.a)(),{cloud:_}=Object(c.sc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{direction:"column"},n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,null,!L&&!P&&n.a.createElement(ot,null)),n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(dt,{recentErrors:C,onClick:w})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(at,{onClickAgentActivity:w,showAgentActivityTour:j})),!A.fleet.addFleetServers||null!=_&&_.isServerlessEnabled?null:n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton.tooltip",defaultMessage:"Fleet Server is a component of the Elastic Stack used to centrally manage Elastic Agents"})},n.a.createElement(g.EuiButton,{onClick:S,"data-test-subj":"addFleetServerButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton",defaultMessage:"Add Fleet Server"})))),A.fleet.addAgents?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addAgentButton.tooltip",defaultMessage:"Add Elastic Agents to your hosts to collect data and send it to the Elastic Stack"})},n.a.createElement(g.EuiButton,{fill:!0,onClick:M,"data-test-subj":"addAgentButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})))):null)),n.a.createElement(g.EuiFlexItem,{grow:4},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(g.EuiFlexItem,{grow:6},n.a.createElement(T.u,{value:t,fieldPrefix:O.b,indexPattern:O.a,onChange:(e,t)=>{a(e),t&&l(e)},dataTestSubj:"agentList.queryInput"})),n.a.createElement(g.EuiFlexItem,{grow:2},n.a.createElement(g.EuiFilterGroup,null,n.a.createElement(rt,{selectedStatus:r,onSelectedStatusChange:o,totalInactiveAgents:y,disabled:0===e.length}),n.a.createElement(ut,{tags:m,selectedTags:p,onSelectedTagsChange:E}),n.a.createElement(ct,{selectedAgentPolicies:i,onSelectedAgentPoliciesChange:s,agentPolicies:e}),n.a.createElement(g.EuiFilterButton,{hasActiveFilters:u,onClick:()=>{d(!u)},"data-test-subj":"agentList.showUpgradeable"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),A.fleet.allAgents&&"manual"===k&&x.length||A.fleet.allAgents&&"query"===k&&b>0?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(tt,{nAgentsInTable:b,totalManagedAgentIds:h,selectionMode:k,currentQuery:v,selectedAgents:x,agentsOnCurrentPage:I,refreshAgents:F,allTags:m,agentPolicies:e})):null))))};var mt=a(60),pt=a(44);const Et=({agent:e,agentPolicy:t,onReassignClick:a,onUnenrollClick:i,onGetUninstallCommandClick:s,onUpgradeClick:r,onAddRemoveTagsClick:o,onRequestDiagnosticsClick:u})=>{const{getHref:d}=Object(c.jc)(),m=Object(pt.a)(),p="unenrolling"===e.status,[E,b]=Object(l.useState)(!1),{diagnosticFileUploadEnabled:y,agentTamperProtectionEnabled:h}=D.b.get(),k=[n.a.createElement(g.EuiContextMenuItem,{icon:"inspect",href:d("agent_details",{agentId:e.id}),key:"viewAgent"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return m.fleet.allAgents&&!1===(null==t?void 0:t.is_managed)&&(k.push(n.a.createElement(g.EuiContextMenuItem,{icon:"tag",onClick:e=>{o(e.target.closest("button"))},disabled:!e.active,key:"addRemoveTags"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.addRemoveTagsActionText",defaultMessage:"Add / remove tags"})),n.a.createElement(g.EuiContextMenuItem,{icon:"pencil",onClick:()=>{a()},disabled:!e.active,key:"reassignPolicy"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),n.a.createElement(g.EuiContextMenuItem,{key:"agentUnenrollBtn",disabled:!e.active,icon:"trash",onClick:()=>{i()}},p?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),n.a.createElement(g.EuiContextMenuItem,{key:"agentUpgradeBtn",icon:"refresh",disabled:!Object(D.j)(e),onClick:()=>{r()},"data-test-subj":"upgradeBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),m.fleet.allAgents&&Object(mt.isStuckInUpdating)(e)&&k.push(n.a.createElement(g.EuiContextMenuItem,{key:"agentRestartUpgradeBtn",icon:"refresh",onClick:()=>{r()},"data-test-subj":"restartUpgradeBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.restartUpgradeOneButton",defaultMessage:"Restart upgrade"}))),m.fleet.allAgents&&h&&e.policy_id&&k.push(n.a.createElement(g.EuiContextMenuItem,{icon:"minusInCircle",onClick:()=>{s(),b(!1)},disabled:!e.active,key:"getUninstallCommand","data-test-subj":"uninstallAgentMenuItem"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.getUninstallCommand",defaultMessage:"Uninstall agent"})))),m.fleet.readAgents&&y&&k.push(n.a.createElement(g.EuiContextMenuItem,{key:"requestAgentDiagnosticsBtn",icon:"download","data-test-subj":"requestAgentDiagnosticsBtn",disabled:!Object(j.Q)(e),onClick:()=>{u()}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))),n.a.createElement(T.g,{isOpen:E,onChange:e=>b(e),items:k})},ft="#0077CC",bt={POLICY_REASSIGN:{inProgressText:"Reassigning",completedText:"assigned to a new policy",cancelledText:"assignment"},UPGRADE:{inProgressText:"Upgrading",completedText:"upgraded",cancelledText:"upgrade"},UNENROLL:{inProgressText:"Unenrolling",completedText:"unenrolled",cancelledText:"unenrollment"},FORCE_UNENROLL:{inProgressText:"Force unenrolling",completedText:"force unenrolled",cancelledText:"force unenrollment"},UPDATE_TAGS:{inProgressText:"Updating tags of",completedText:"updated tags",cancelledText:"update tags"},CANCEL:{inProgressText:"Cancelling",completedText:"cancelled",cancelledText:""},REQUEST_DIAGNOSTICS:{inProgressText:"Requesting diagnostics for",completedText:"requested diagnostics",cancelledText:"request diagnostics"},SETTINGS:{inProgressText:"Updating settings of",completedText:"updated settings",cancelledText:"update settings"},POLICY_CHANGE:{inProgressText:"Applying policy change on",completedText:"applied policy change",cancelledText:"policy change"},INPUT_ACTION:{inProgressText:"Input action in progress of",completedText:"input action completed",cancelledText:"input action"},ACTION:{inProgressText:"Actioning",completedText:"actioned",cancelledText:"action"}},yt=e=>{var t;return null!==(t=bt[null!=e?e:"ACTION"])&&void 0!==t?t:bt.ACTION},ht=e=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivity.inProgressTitle",defaultMessage:"{inProgressText} {nbAgents} {agents} {reassignText}{upgradeText}{failuresText}",values:{nbAgents:e.nbAgentsAck>=e.nbAgentsActioned?e.nbAgentsAck:0===e.nbAgentsAck?e.nbAgentsActioned:e.nbAgentsActioned-e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",inProgressText:yt(e.type).inProgressText,reassignText:"POLICY_REASSIGN"===e.type&&e.newPolicyId?`to ${e.newPolicyId}`:"",upgradeText:"UPGRADE"===e.type?`to version ${e.version}`:"",failuresText:e.nbAgentsFailed>0?`, has ${e.nbAgentsFailed} failure(s)`:""}}),kt=e=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.startedDescription",defaultMessage:"Started on {date}.",values:{date:vt(e)}}),vt=e=>e?n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})," ",n.a.createElement(f.FormattedTime,{value:e})):null,xt=({action:e,onClickViewAgents:t,agentPolicies:a})=>{const i=Object(l.useMemo)((()=>{var t;if("POLICY_CHANGE"!==e.type)return e.nbAgentsActionCreated>1e3;const l=e.actionId.split(":")[0];return 0===(null==a||null===(t=a.find((e=>e.id===l)))||void 0===t?void 0:t.agents)}),[e,a]);if("UPDATE_TAGS"===e.type)return null;const s=n.a.createElement(g.EuiButtonEmpty,{size:"m",onClick:()=>t(e),flush:"left","data-test-subj":"agentActivityFlyout.viewAgentsButton",disabled:i},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.viewAgentsButton",defaultMessage:"View Agents"}));return"POLICY_CHANGE"===e.type||i?"POLICY_CHANGE"===e.type?n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.viewAgentsButtonPolicyChangeTooltip",defaultMessage:"View agents currently assigned to this policy"})},s):n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.viewAgentsButtonDisabledMaxTooltip",defaultMessage:"The view agents feature is only available for action impacting less than {agentCount} agents",values:{agentCount:1e3}})},s):s},Ft=({action:e,abortUpgrade:t,onClickViewAgents:a})=>{const{docLinks:i}=Object(c.sc)(),[s,r]=Object(l.useState)(!1),o=Object(l.useCallback)((async()=>{try{r(!0),await t(e)}finally{r(!1)}}),[e,t]),u=Object(l.useMemo)((()=>{if(!e.startTime)return!1;const t=Date.now();return new Date(e.startTime).getTime()>t}),[e]),d=Object(l.useMemo)((()=>u||e.hasRolloutPeriod),[e,u]);return n.a.createElement(g.EuiPanel,{hasBorder:!0,borderRadius:"none"},n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},u?n.a.createElement(g.EuiIcon,{type:"clock"}):n.a.createElement(g.EuiLoadingSpinner,{size:"m"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{color:ft,"data-test-subj":"upgradeInProgressTitle"},u&&e.startTime?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduleTitle",defaultMessage:"{nbAgents} agents scheduled to upgrade to version {version}",values:{nbAgents:e.nbAgentsActioned-e.nbAgentsAck,version:e.version}}):ht(e))))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{direction:"column",alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{color:"subdued","data-test-subj":"upgradeInProgressDescription"},n.a.createElement("p",null,u&&e.startTime?n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduledDescription",defaultMessage:"Scheduled for "}),n.a.createElement("strong",null,vt(e.startTime)),". "):n.a.createElement(n.a.Fragment,null,kt(e.creationTime)," "),n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.upgradeDescription",defaultMessage:"{guideLink} about agent upgrades.",values:{guideLink:n.a.createElement(g.EuiLink,{href:i.links.fleet.upgradeElasticAgent,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.guideLink",defaultMessage:"Learn more"}))}})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(xt,{action:e,onClickViewAgents:a})),n.a.createElement(g.EuiFlexItem,{grow:!1},d?n.a.createElement(g.EuiButton,{size:"s",onClick:o,isLoading:s,"data-test-subj":"abortBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.abortUpgradeButtom",defaultMessage:"Cancel"})):null)))))},Mt="logs-elastic_agent-*,logs-elastic_agent.*-*",St="elastic_agent",It="elastic_agent.id",Tt={name:Z.u,type:"string",aggregatable:!0,searchable:!0},Ot="log.level",wt="now-1d",jt="now",Ct={start:wt,end:jt,logLevels:[],datasets:[St],query:""},At="datasets",Pt=({agentId:e,datasets:t,logLevels:a,userQuery:l})=>{const n=`${It}:${e}`,i=t.length?t.map((e=>`${Tt.name}:${e}`)).join(" or "):`${Tt.name}:${St} or ${Tt.name}:elastic_agent.*`,s=a.map((e=>`${Ot}:${e}`)).join(" or "),r=`${n} and (${i})`,o=s?`${r} and (${s})`:r;return l?`(${o}) and (${l})`:o};var Lt=a(111);const _t=e=>new Date(e).getTime(),Dt=({logStreamQuery:e,startTime:t,endTime:a})=>{const i=Object(c.Hb)(),{share:s}=Object(c.sc)(),{logsLocator:r}=Object(Lt.getLogsLocatorsFromUrlService)(s.url),o=Object(c.yb)(),u=Object(l.useMemo)((()=>{const l=ve()().toISOString(),n=ve()().subtract(1,"day").toISOString(),i=_t(n),s=_t(l);return r.getRedirectUrl({time:a||s,timeRange:{startTime:t||i,endTime:a||s},filter:e})}),[a,e,r,t]);return o.fleet.readAgents&&(r||i)?n.a.createElement(g.EuiButton,{href:u,iconType:"popout","data-test-subj":"viewInLogsBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})):null},Bt=L()(g.EuiText).withConfig({displayName:"TruncatedEuiText",componentId:"sc-1ioa7tn-0"})(["overflow:hidden;max-height:3rem;text-overflow:ellipsis;"]),Rt=({action:e})=>{var t;const a=Object(c.sc)(),l=[{field:"hostname",name:b.i18n.translate("xpack.fleet.agentList.viewErrors.hostnameColumnTitle",{defaultMessage:"Host Name"}),render:e=>n.a.createElement(g.EuiText,{size:"s","data-test-subj":"hostText"},e)},{field:"error",name:b.i18n.translate("xpack.fleet.agentList.viewErrors.errorColumnTitle",{defaultMessage:"Error Message"}),render:e=>n.a.createElement(g.EuiToolTip,{content:e},n.a.createElement(Bt,{size:"s",color:"red","data-test-subj":"errorText"},e))},{field:"agentId",name:b.i18n.translate("xpack.fleet.agentList.viewErrors.actionColumnTitle",{defaultMessage:"Action"}),render:t=>{var l;const i=(null!==(l=e.latestErrors)&&void 0!==l?l:[]).find((e=>e.agentId===t));return n.a.createElement(M.a,{coreStart:a},((e,t)=>{const a=ve()(t).subtract(5,"m").toISOString(),l=ve()(t).add(5,"m").toISOString(),i=_t(a),s=_t(l),r=Pt({agentId:e,datasets:["elastic_agent"],logLevels:["error"],userQuery:""});return n.a.createElement(Dt,{logStreamQuery:r,startTime:i,endTime:s})})(t,i.timestamp))}}];return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiAccordion,{id:e.actionId+"_errors",buttonContent:"Show errors"},n.a.createElement(g.EuiBasicTable,{items:null!==(t=e.latestErrors)&&void 0!==t?t:[],columns:l,tableLayout:"auto"})))},zt=({action:e,onClickViewAgents:t,agentPolicies:a})=>{const l="POLICY_CHANGE"===e.type&&0===e.nbAgentsActioned?n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivity.policyChangeCompletedTitle",defaultMessage:"Policy changed"})):n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivity.completedTitle",defaultMessage:"{nbAgents} {agents} {completedText}{offlineText}",values:{nbAgents:e.nbAgentsAck===e.nbAgentsActioned?e.nbAgentsAck:e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",completedText:yt(e.type).completedText,offlineText:"ROLLOUT_PASSED"===e.status&&e.nbAgentsActioned-e.nbAgentsAck>0?`, ${e.nbAgentsActioned-e.nbAgentsAck} agent(s) offline during the rollout period`:""}})),i=n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.completedDescription",defaultMessage:"Completed {date}",values:{date:"0001-01-01T00:00:00.000Z"===e.completionTime?null:vt(e.completionTime)}}),s=n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.failureDescription",defaultMessage:"A problem occurred during this operation."})," ",kt(e.creationTime))),r={IN_PROGRESS:{icon:n.a.createElement(g.EuiLoadingSpinner,{size:"m"}),title:n.a.createElement(g.EuiText,null,ht(e)),titleColor:ft,description:n.a.createElement(g.EuiText,{color:"subdued"},kt(e.creationTime))},ROLLOUT_PASSED:{icon:e.nbAgentsFailed>0?n.a.createElement(g.EuiIcon,{size:"m",type:"warning",color:"red"}):n.a.createElement(g.EuiIcon,{size:"m",type:"checkInCircleFilled",color:"green"}),title:l,titleColor:e.nbAgentsFailed>0?"red":"green",description:e.nbAgentsFailed>0?s:n.a.createElement(g.EuiText,{color:"subdued"},i)},COMPLETE:{icon:n.a.createElement(g.EuiIcon,{size:"m",type:"checkInCircleFilled",color:"green"}),title:l,titleColor:"green",description:"POLICY_REASSIGN"===e.type&&e.newPolicyId?n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.reassignCompletedDescription",defaultMessage:"Assigned to {policy}.",values:{policy:e.newPolicyId}})," ",i)):"POLICY_CHANGE"===e.type?n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement("b",null,e.policyId)," ",n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.policyChangedDescription",defaultMessage:"changed to revision {rev} at {date}.",values:{rev:e.revision,date:vt(e.creationTime)}}))):n.a.createElement(g.EuiText,{color:"subdued"},i)},FAILED:{icon:n.a.createElement(g.EuiIcon,{size:"m",type:"warning",color:"red"}),title:l,titleColor:"red",description:s},CANCELLED:{icon:n.a.createElement(g.EuiIcon,{size:"m",type:"warning",color:"grey"}),titleColor:"grey",title:n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledTitle",defaultMessage:"Agent {cancelledText} cancelled",values:{cancelledText:yt(e.type).cancelledText}})),description:n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledDescription",defaultMessage:"Cancelled on {date}",values:{date:vt(e.cancellationTime)}}))},EXPIRED:{icon:n.a.createElement(g.EuiIcon,{size:"m",type:"warning",color:"grey"}),titleColor:"grey",title:n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredTitle",defaultMessage:"Agent {expiredText} expired",values:{expiredText:yt(e.type).cancelledText}})),description:n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredDescription",defaultMessage:"Expired on {date}",values:{date:vt(e.expiration)}}))}};return n.a.createElement(g.EuiPanel,{hasBorder:!0,borderRadius:"none"},n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},r[e.status].icon),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{color:r[e.status].titleColor,"data-test-subj":"statusTitle"},r[e.status].title)))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{color:"subdued","data-test-subj":"statusDescription"},r[e.status].description)),n.a.createElement(g.EuiFlexItem,{grow:!1},"FAILED"===e.status&&e.latestErrors&&e.latestErrors.length>0?n.a.createElement(Rt,{action:e}):null)),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(xt,{action:e,onClickViewAgents:t,agentPolicies:a}))},Nt=({title:e,actions:t,abortUpgrade:a,onClickViewAgents:l,agentPolicies:i})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPanel,{color:"subdued",hasBorder:!0,borderRadius:"none"},n.a.createElement(g.EuiText,null,n.a.createElement("b",null,e))),t.map((e=>"UPGRADE"===e.type&&"IN_PROGRESS"===e.status?n.a.createElement(Ft,{action:e,abortUpgrade:a,key:e.actionId,onClickViewAgents:l}):n.a.createElement(zt,{action:e,key:e.actionId,onClickViewAgents:l,agentPolicies:i})))),Ht=e=>n.a.createElement(g.EuiDatePicker,{"data-test-subj":"agentActivityFlyout.goToDateButton",selected:e.selectedDate,onChange:e.onChangeSelectedDate,maxDate:ve()(),customInput:e.filledStyle?n.a.createElement(Ut,e):n.a.createElement(qt,e)}),Ut=Object(l.forwardRef)((({onClick:e,value:t},a)=>n.a.createElement(g.EuiButton,{fill:!0,onClick:e},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.emptyState.goToDateButton",defaultMessage:"Go to date"})))),qt=Object(l.forwardRef)((({onClick:e,value:t},a)=>n.a.createElement(g.EuiButtonEmpty,{size:"m",flush:"left",onClick:e},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.goToDateButton",defaultMessage:"Go to date"})))),Gt=()=>(new Date).toISOString().substring(0,10),Wt=L()(g.EuiFlyoutBody).withConfig({displayName:"FullHeightFlyoutBody",componentId:"sc-1p58nye-0"})([".euiFlyoutBody__overflowContent{height:100%;}"]),Kt=L()(g.EuiFlexGroup).withConfig({displayName:"ButtonsFlexGroup",componentId:"sc-1p58nye-1"})(["padding-left:24px;"]),Vt=L.a.div.withConfig({displayName:"ScrollAnchor",componentId:"sc-1p58nye-2"})(["height:0;margin:0;padding:0;"]),$t=({isFirstLoading:e,currentActions:t,abortUpgrade:a,onClickViewAgents:l,areActionsFullyLoaded:i,onClickShowMore:s,dateFilter:r,onChangeDateFilter:o,agentPolicies:c})=>{const u=n.a.useRef(null);if(n.a.useEffect((()=>{var e;null!==(e=u.current)&&void 0!==e&&e.scrollIntoView&&u.current.scrollIntoView()}),[r]),e)return n.a.createElement(Wt,null,n.a.createElement(g.EuiFlexGroup,{direction:"row",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(de.k,null))));if(0===t.length)return n.a.createElement(Wt,null,n.a.createElement(Vt,{ref:u}),n.a.createElement(g.EuiFlexGroup,{direction:"column",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiEmptyPrompt,{iconType:"clock",iconColor:"default",title:n.a.createElement("h2",null," ",n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityText",defaultMessage:"No activity to display"})),titleSize:"m",body:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityDescription",defaultMessage:"Activity feed will appear here as agents are reassigned, upgraded, or unenrolled."})})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ht,{selectedDate:r,onChangeSelectedDate:o,filledStyle:!0})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:()=>o(null)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.emptyState.showMoreButton",defaultMessage:"Clear selected date"})))));const d=t.filter((e=>"IN_PROGRESS"===e.status)),m=t.filter((e=>"IN_PROGRESS"!==e.status)),p=m.filter((e=>e.creationTime.startsWith(Gt()))),E=function(e){const t={};return e.filter((e=>!e.creationTime.startsWith(Gt()))).forEach((e=>{const a=e.creationTime.substring(0,10);t[a]||(t[a]=[]),t[a].push(e)})),t}(m);return n.a.createElement(Wt,null,n.a.createElement(Vt,{ref:u}),n.a.createElement(g.EuiFlexGroup,{direction:"column"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{direction:"column"},d.length>0?n.a.createElement(Nt,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.inProgressTitle",defaultMessage:"In progress"}),actions:d,abortUpgrade:a,onClickViewAgents:l,agentPolicies:c}):null,p.length>0?n.a.createElement(Nt,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.todayTitle",defaultMessage:"Today"}),actions:p,abortUpgrade:a,onClickViewAgents:l,agentPolicies:c}):null,Object.keys(E).map((e=>n.a.createElement(Nt,{key:e,title:n.a.createElement(f.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"}),actions:E[e],abortUpgrade:a,onClickViewAgents:l,agentPolicies:c}))))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(Kt,{direction:"row",gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{size:"m",onClick:s,disabled:i,flush:"left","data-test-subj":"agentActivityFlyout.showMoreButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.showMoreButton",defaultMessage:"Show more"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ht,{selectedDate:r,onChangeSelectedDate:o,filledStyle:!1})),r&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{size:"m",onClick:()=>o(null),flush:"left","data-test-subj":"agentActivityFlyout.clearSelectedDateButton"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.clearSelectedDateutton",defaultMessage:"Clear selected date"})))))))},Qt=L()(g.EuiFlyoutFooter).withConfig({displayName:"FlyoutFooterWPadding",componentId:"sc-7yfogs-0"})(["padding:16px 24px !important;"]),Yt=({onClose:e,onAbortSuccess:t,refreshAgentActivity:a,setSearch:i,setSelectedStatus:s,agentPolicies:r})=>{const{notifications:o}=Object(c.sc)(),{data:u}=Object(c.Mb)({perPage:O.t}),[d,m]=Object(l.useState)(20),[p,E]=Object(l.useState)(null),{currentActions:y,abortUpgrade:h,isFirstLoading:k,areActionsFullyLoaded:v}=function(e,t,a,n){const[i,s]=Object(l.useState)(!0),[r,o]=Object(l.useState)([]),[u,d]=Object(l.useState)(0),[g,m]=Object(l.useState)(!1),{notifications:p,overlays:E}=Object(c.sc)(),f=Object(l.useCallback)((async()=>{try{const e=await Object(c.v)({perPage:a,date:null==n?void 0:n.format()});if(s(!1),e.error)throw e.error;if(!e.data)throw new Error("No data");m(u<a),d(e.data.items.length),o(e.data.items)}catch(e){p.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.actionStatus.fetchRequestError",{defaultMessage:"An error happened while fetching action status"})})}}),[a,n,u,p.toasts]);return i&&f(),Object(l.useEffect)((()=>{t&&f()}),[f,t]),Object(l.useEffect)((()=>{f()}),[f,a]),{currentActions:r,abortUpgrade:Object(l.useCallback)((async t=>{try{if(!await E.openConfirm(b.i18n.translate("xpack.fleet.currentUpgrade.confirmDescription",{defaultMessage:"This action will cancel upgrade of {nbAgents, plural, one {# agent} other {# agents}}",values:{nbAgents:t.nbAgentsActioned-t.nbAgentsAck}}),{title:b.i18n.translate("xpack.fleet.currentUpgrade.confirmTitle",{defaultMessage:"Cancel upgrade?"})}))return;await Object(c.Z)(t.actionId),await Promise.all([f(),e()])}catch(e){p.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.currentUpgrade.abortRequestError",{defaultMessage:"An error happened while cancelling upgrade"})})}}),[f,p.toasts,E,e]),isFirstLoading:i,areActionsFullyLoaded:g}}(t,a,d,p),x=Object(l.useCallback)((e=>{var t;const a=null==u?void 0:u.items.find((t=>t.id===e));return null!==(t=null==a?void 0:a.name)&&void 0!==t?t:e}),[u]),F=Object(l.useMemo)((()=>y.map((e=>{var t,a;return{...e,newPolicyId:x(null!==(t=e.newPolicyId)&&void 0!==t?t:""),policyId:x(null!==(a=e.policyId)&&void 0!==a?a:"")}}))),[y,x]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlyout,{"data-test-subj":"agentActivityFlyout",onClose:()=>{a=!1,e()},paddingSize:"none",maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{"aria-labelledby":"FleetAgentActivityFlyoutTitle"},n.a.createElement(g.EuiPanel,{borderRadius:"none",hasShadow:!1,hasBorder:!0},n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiTitle,{size:"l"},n.a.createElement("h1",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.title",defaultMessage:"Agent activity"})))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.activityLogText",defaultMessage:"Activity log of Elastic Agent operations will appear here."}))))))),n.a.createElement($t,{isFirstLoading:k,currentActions:F,abortUpgrade:h,onClickViewAgents:async t=>{try{var a;const{data:l}=await Object(c.hb)({actionIds:[t.actionId]});if(null!=l&&null!==(a=l.items)&&void 0!==a&&a.length){const e=Xe({selectedAgentIds:l.items});i(e)}s(Le),e()}catch(e){o.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.agentActivityFlyout.error",{defaultMessage:"Error viewing selected agents"})})}},areActionsFullyLoaded:v,onClickShowMore:()=>{m(d+10)},dateFilter:p,onChangeDateFilter:e=>{var t;E(null!==(t=null==e?void 0:e.startOf("day"))&&void 0!==t?t:null),m(20)},agentPolicies:r}),n.a.createElement(Qt,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexStart"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:e},n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.closeBtn",defaultMessage:"Close"}))))))))},Xt=()=>{var e;const{cloud:t}=Object(c.sc)();Object(c.zb)("agent_list");const[a,i]=Object(l.useState)([]),[s,o]=Object(l.useState)("manual"),[u,d]=Object(l.useState)({isOpen:!1}),[m,p]=Object(l.useState)(!1),E=Object(c.Lb)(),[f,y]=Object(l.useState)(void 0),[h,v]=Object(l.useState)(void 0),[x,F]=Object(l.useState)(void 0),[M,S]=Object(l.useState)(void 0),[I,w]=Object(l.useState)(void 0),[C,A]=Object(l.useState)(),[P,L]=Object(l.useState)(!1),[_,B]=Object(l.useState)(void 0),[R,z]=Object(l.useState)({isOpen:!1}),{allTags:N,agentsOnCurrentPage:H,agentsStatus:U,isLoading:q,nAgentsInTable:G,totalInactiveAgents:W,totalManagedAgentIds:K,managedAgentsOnCurrentPage:V,showUpgradeable:Q,setShowUpgradeable:Y,search:X,setSearch:J,selectedAgentPolicies:Z,setSelectedAgentPolicies:ee,sortField:te,setSortField:ae,sortOrder:le,setSortOrder:ne,selectedStatus:ie,setSelectedStatus:se,selectedTags:re,setSelectedTags:oe,agentPolicies:ce,agentPoliciesRequest:ue,agentPoliciesIndexedById:ge,pagination:pe,pageSizeOptions:Ee,setPagination:fe,kuery:be,draftKuery:ye,setDraftKuery:he,fetchData:ke,currentRequestRef:ve,latestAgentActionErrors:xe,setLatestAgentActionErrors:Fe}=function(){const e=Object(c.yb)(),{displayAgentMetrics:t}=D.b.get(),{notifications:a}=Object(c.sc)(),n=Object(r.useHistory)(),{urlParams:i,toUrlParams:s}=Object(c.vc)(),o=i.kuery||"",u="true"===i.showInactive,[d,g]=Object(l.useState)(!1),[m,p]=Object(l.useState)(o),[E,f]=Object(l.useState)(o),{pagination:y,pageSizeOptions:h,setPagination:k}=Object(c.mc)(),[v,x]=Object(l.useState)("enrolled_at"),[F,M]=Object(l.useState)("desc"),S="local_metadata.elastic.agent.version",I="local_metadata.host.hostname",[T,w]=Object(l.useState)([]),[C,A]=Object(l.useState)(["healthy","unhealthy","updating","offline",...u?["inactive"]:[]]),[P,L]=Object(l.useState)([]),_=Object(l.useMemo)((()=>C.some((e=>"inactive"===e))||0===C.length),[C]),B=Object(l.useMemo)((()=>C.some((e=>"unenrolled"===e))||0===C.length),[C]),R=Object(l.useCallback)((e=>{f(e),(""!==e.trim()||i.kuery)&&i.kuery!==e&&n.replace({search:s({...i,kuery:""===e?void 0:e})})}),[i,n,s]);let z=Object(l.useMemo)((()=>Xe({search:E,selectedAgentPolicies:T,selectedTags:P,selectedStatus:C})),[E,T,C,P]);z=B&&z?`status:* AND (${z})`:B?"status:*":z;const[N,H]=Object(l.useState)([]),[U,q]=Object(l.useState)(),[G,W]=Object(l.useState)(),[K,V]=Object(l.useState)(!1),[Q,Y]=Object(l.useState)(0),[X,J]=Object(l.useState)(0),[Z,ee]=Object(l.useState)([]),[te,ae]=Object(l.useState)(0),[le,ne]=Object(l.useState)([]),ie=Object(l.useRef)(!1),se=Object(l.useRef)(0),re=Object(l.useCallback)((({refreshTags:e=!1}={})=>{!async function(){if(ie.current)return;se.current++;const l=se.current;ie.current=!0;try{var n,i,s;V(!0);const[a,g,m,p,E]=await Promise.all([Object(c.A)({page:y.currentPage,perPage:y.pageSize,kuery:z&&""!==z?z:void 0,sortField:(u=v,[S,I].includes(u)?`${u}.keyword`:u),sortOrder:F,showInactive:_,showUpgradeable:d,getStatusSummary:!0,withMetrics:t}),Object(c.x)({kuery:D.a.buildKueryForInactiveAgents()}),Object(c.w)({kuery:`${O.e}.is_managed:true`,perPage:O.t,full:!1}),Object(c.y)({kuery:z&&""!==z?z:void 0,showInactive:_}),Object(c.v)({latest:35e3,perPage:100})]);if(ie.current=!1,se.current!==l)return;if(a.error)throw a.error;if(!a.data)throw new Error("Invalid GET /agents response");if(!g.data)throw new Error("Invalid GET /agents_status response");if(m.error)throw new Error(m.error.message);if(p.error)throw p.error;if(!p.data)throw new Error("Invalid GET /agent/tags response");if(E.error)throw new Error("Invalid GET /agents/action_status response");const f=a.data.statusSummary;if(!f)throw new Error("Invalid GET /agents response - no status summary");q(Object(j.h)(f));const b=p.data.items;G&&!e&&Object($.isEqual)(b,G)||W(b),H(a.data.items),Y(a.data.total),J(g.data.results.inactive||0);const h=null!==(n=null===(i=m.data)||void 0===i?void 0:i.items)&&void 0!==n?n:[];if(0===h.length)ee([]),ae(0);else{var r,o;const e=h.map((e=>`policy_id:"${e.id}"`)).join(" or "),t=await Object(c.A)({kuery:`NOT (status:unenrolled) and ${e}`,perPage:O.t,showInactive:!0});if(t.error)throw new Error(t.error.message);const l=null!==(r=null===(o=t.data)||void 0===o?void 0:o.items)&&void 0!==r?r:[],n=null==l?void 0:l.map((e=>e.id));ee(n),ae(a.data.items.map((e=>e.id)).filter((e=>n.includes(e))).length)}const k=(null===(s=E.data)||void 0===s?void 0:s.items.filter((e=>{var t,a;return null!==(t=null===(a=e.latestErrors)||void 0===a?void 0:a.length)&&void 0!==t&&t})).map((e=>e.actionId)))||[],x=[...new Set([...le,...k])];Object($.isEqual)(le,x)||ne(x)}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}var u;V(!1)}()}),[y.currentPage,y.pageSize,z,v,F,_,d,t,G,le,a.toasts]);Object(l.useEffect)((()=>{re();const e=setInterval((()=>{re()}),3e4);return()=>clearInterval(e)}),[re]);const oe=Object(c.Mb)({page:1,perPage:O.t,full:e.fleet.readAgentPolicies}),ce=Object(l.useMemo)((()=>oe.data?oe.data.items:[]),[oe]),ue=Object(l.useMemo)((()=>ce.reduce(((e,t)=>(e[t.id]=t,e)),{})),[ce]);return{allTags:G,setAllTags:W,agentsOnCurrentPage:N,agentsStatus:U,isLoading:K,nAgentsInTable:Q,totalInactiveAgents:X,totalManagedAgentIds:Z,managedAgentsOnCurrentPage:te,showUpgradeable:d,setShowUpgradeable:g,search:E,setSearch:R,selectedAgentPolicies:T,setSelectedAgentPolicies:w,sortField:v,setSortField:x,sortOrder:F,setSortOrder:M,selectedStatus:C,setSelectedStatus:A,selectedTags:P,setSelectedTags:L,agentPolicies:ce,agentPoliciesRequest:oe,agentPoliciesIndexedById:ue,pagination:y,pageSizeOptions:h,setPagination:k,kuery:z,draftKuery:m,setDraftKuery:p,fetchData:re,currentRequestRef:se,latestAgentActionErrors:le,setLatestAgentActionErrors:ne}}(),Me=Object(l.useCallback)((e=>{J(e),fe({...pe,currentPage:1})}),[J,pe,fe]),Se=!!(X.trim()||Z.length||ie.length||re.length||Q),Ie=Object(l.useCallback)((()=>{he(""),J(""),ee([]),se([]),oe([]),Y(!1)}),[he,J,ee,se,oe,Y]),Te=Object(l.useMemo)((()=>ie.some((e=>"inactive"===e||"unenrolled"===e))),[ie]),Oe=Object(l.useCallback)((e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=ge[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))}),[ge]),Ce=Object(l.useMemo)((()=>{if(!h||!h.policy_id)return!1;const e=ge[h.policy_id];return!!e&&Object(D.q)(e)}),[h,ge]),[Ae,Pe]=(()=>{const{missingOptionalFeatures:e}=Object(c.Kb)(),{storage:t}=Object(c.sc)(),[a,n]=Object(l.useState)(!1);return Object(l.useEffect)((()=>{const e=t.get(Ye);e&&n(Boolean(e))}),[t]),[Object(l.useMemo)((()=>!(a||!e)&&e.includes("encrypted_saved_object_encryption_key_required")),[e,a]),Object(l.useCallback)((()=>{t.set(Ye,"true"),n(!0)}),[t])]})(),{isUnhealthy:Le}=function(){const e=Object(c.yb)(),{notifications:t}=Object(c.sc)(),[a,n]=Object(l.useState)(!0),[i,s]=Object(l.useState)(!1),r=Object(l.useCallback)((async()=>{try{var e;const t=await Object(c.E)();if(t.error)throw t.error;null!==(e=t.data)&&void 0!==e&&e.fleet_server.has_active||s(!0),n(!1)}catch(e){t.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.fleetServerUnhealthy.requestError",{defaultMessage:"An error happened while fetching fleet server status"})}),n(!1)}}),[t.toasts]);return Object(l.useEffect)((()=>{e.fleet.addAgents||e.fleet.addFleetServers?r():n(!1)}),[r,e.fleet.addAgents,e.fleet.addFleetServers]),{isLoading:a,isUnhealthy:i}}(),{isFleetServerStandalone:_e}=Object(c.Jb)(),De=Le&&!_e,{shouldDisplayAgentSoftLimit:Be}=function(){var e;const t=null===(e=Object(c.Cb)().internal)||void 0===e?void 0:e.activeAgentsSoftLimit,{data:a}=Object(k.useQuery)(["fetch-total-online-agents"],Qe,{enabled:void 0!==t});return{shouldDisplayAgentSoftLimit:!(!t||!a)&&a>t}}(),Re=Object(l.useCallback)((()=>{E.openFleetServerFlyout()}),[E]),ze=Object(l.useCallback)((()=>{p(!0),Fe([])}),[p,Fe]),Ne=({refreshTags:e=!1}={})=>{ke({refreshTags:e}),z({isOpen:!0})},He=1===(null==ve?void 0:ve.current);return n.a.createElement(n.a.Fragment,null,m?n.a.createElement(g.EuiPortal,null,n.a.createElement(Yt,{onAbortSuccess:ke,onClose:()=>p(!1),refreshAgentActivity:q,setSearch:J,setSelectedStatus:se,agentPolicies:ce})):null,u.isOpen?n.a.createElement(g.EuiPortal,null,n.a.createElement(T.c,{agentPolicy:ce.find((e=>e.id===u.selectedPolicyId)),onClose:()=>{d({isOpen:!1}),ke(),ue.resendRequest()}})):null,f&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.c,{agents:[f],onClose:()=>{y(void 0),Ne()}})),h&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.d,{agents:[h],agentCount:1,onClose:()=>{v(void 0),Ne({refreshTags:!0})},useForceUnenroll:"unenrolling"===h.status,hasFleetServer:Ce})),(null==x?void 0:x.policy_id)&&n.a.createElement(g.EuiPortal,null,n.a.createElement(T.w,{target:"agent",policyId:x.policy_id,onClose:()=>{F(void 0),Ne({refreshTags:!0})}})),M&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.e,{agents:[M],agentCount:1,onClose:()=>{S(void 0),Ne()},isUpdating:Boolean(M.upgrade_started_at&&!M.upgraded_at)})),_&&n.a.createElement(g.EuiPortal,null,n.a.createElement(me,{agents:[_],agentCount:1,onClose:()=>{B(void 0)}})),P&&n.a.createElement(et,{agentId:null==I?void 0:I.id,allTags:null!=N?N:[],selectedTags:null!==(e=null==I?void 0:I.tags)&&void 0!==e?e:[],button:C,onTagsUpdated:()=>{Ne()},onClosePopover:()=>{L(!1)}}),De&&n.a.createElement(n.a.Fragment,null,null!=t&&t.deploymentUrl?n.a.createElement(de.g,{deploymentUrl:t.deploymentUrl}):n.a.createElement(de.j,{onClickAddFleetServer:Re}),n.a.createElement(g.EuiSpacer,{size:"l"})),Ae&&n.a.createElement(n.a.Fragment,null,n.a.createElement(de.i,{onClickHandler:Pe}),n.a.createElement(g.EuiSpacer,{size:"l"})),Be&&n.a.createElement(n.a.Fragment,null,n.a.createElement(je,null),n.a.createElement(g.EuiSpacer,{size:"l"})),n.a.createElement(gt,{agentPolicies:ce,draftKuery:ye,onDraftKueryChange:he,onSubmitSearch:Me,selectedAgentPolicies:Z,onSelectedAgentPoliciesChange:e=>{"query"===s&&o("manual"),ee(e)},selectedStatus:ie,onSelectedStatusChange:e=>{"query"===s&&o("manual"),se(e)},showUpgradeable:Q,onShowUpgradeableChange:Y,tags:null!=N?N:[],selectedTags:re,onSelectedTagsChange:oe,nAgentsInTable:G,totalInactiveAgents:W,totalManagedAgentIds:K,selectionMode:s,currentQuery:be,selectedAgents:a,refreshAgents:Ne,onClickAddAgent:()=>d({isOpen:!0}),onClickAddFleetServer:Re,agentsOnCurrentPage:H,onClickAgentActivity:ze,showAgentActivityTour:R,latestAgentActionErrors:xe.length}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Ge,{showInactive:Te,totalAgents:G,agentStatus:U,selectableAgents:(null==H?void 0:H.filter(Oe).length)||0,managedAgentsOnCurrentPage:V,selectionMode:s,setSelectionMode:o,selectedAgents:a,setSelectedAgents:e=>{i(e),o("manual")},clearFilters:Ie,isUsingFilter:Se}),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(we,{agents:H,sortField:te,pageSizeOptions:Ee,sortOrder:le,isLoading:q,agentPoliciesIndexedById:ge,renderActions:e=>{const t="string"==typeof e.policy_id?ge[e.policy_id]:void 0;return(null==I?void 0:I.id)!==e.id||Object($.isEqual)(e.tags,I.tags)||w(e),n.a.createElement(Et,{agent:e,agentPolicy:t,onReassignClick:()=>y(e),onUnenrollClick:()=>v(e),onUpgradeClick:()=>S(e),onAddRemoveTagsClick:t=>{A(t),w(e),L(!P)},onGetUninstallCommandClick:()=>F(e),onRequestDiagnosticsClick:()=>B(e)})},onSelectionChange:e=>{if("query"===s&&e.length<a.length){if(!(a.length>0&&0===Object($.differenceBy)(a,H,"id").length))return i(H.filter((e=>Oe(e))));o("manual")}i(e)},selected:a,showUpgradeable:Q,onTableChange:({page:e,sort:t})=>{const a={...pe,currentPage:e.index+1,pageSize:e.size};fe(a),ae(t.field),ne(t.direction)},pagination:pe,totalAgents:Math.min(G,O.t),isUsingFilter:Se,setEnrollmentFlyoutState:d,clearFilters:Ie,isCurrentRequestIncremented:He}))};var Jt=a(263),Zt=a(270),ea=a(69),ta=a(706),aa=a.n(ta),la=a(104),na=a(43),ia=a.n(na),sa=a(21),ra=a.n(sa),oa=a(112);const ca=Object(l.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{unifiedSearch:a,data:i}=Object(c.sc)(),[s,r]=Object(l.useState)(!1),[o,u]=Object(l.useState)(!1),[d,m]=Object(l.useState)([St]),p=Object(l.useCallback)((()=>r((e=>!e))),[r]),E=Object(l.useCallback)((()=>r(!1)),[r]),f=Object(l.useCallback)((t=>t.map((t=>({label:t,checked:e.includes(t)?"on":void 0,key:t})))),[e]),[y,h]=Object(l.useState)(f(d));return Object(l.useEffect)((()=>{(async()=>{u(!0);try{const e=(await i.dataViews.getFieldsForWildcard({pattern:Mt})).reduce(((e,t)=>(e[t.name]=t,e)),{}),t=await i.dataViews.create({title:Mt,fields:e}),l=await a.autocomplete.getValueSuggestions({indexPattern:t,field:Tt,query:""});l.length>0&&(m(l.sort()),h(f(l.sort())))}catch(e){m([St]),h(f([St]))}u(!1)})()}),[i.dataViews,a.autocomplete,f]),n.a.createElement(g.EuiPopover,{button:n.a.createElement(g.EuiFilterButton,{"data-test-subj":"agentList.datasetFilterBtn",iconType:"arrowDown",onClick:p,isSelected:s,isLoading:o,numFilters:d.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},b.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:s,closePopover:E,panelPaddingSize:"none"},n.a.createElement(g.EuiSelectable,{options:y,onChange:e=>{h(e),e.forEach(((e,a)=>{e.checked===y[a].checked||t(e.label)}))},"data-test-subj":"agentList.datasetFilterOptions",isLoading:o,listProps:{paddingSize:"s",style:{minWidth:220}}},(e=>e)))})),ua=Object(l.memo)((({selectedLevels:e,onToggleLevel:t})=>{const[a,i]=Object(l.useState)(!1),s=Object(l.useCallback)((()=>i((e=>!e))),[]),r=Object(l.useCallback)((()=>i(!1)),[]),[o,c]=Object(l.useState)(Z.h.map((t=>({label:t,checked:e.includes(t)?"on":void 0,key:t}))));return n.a.createElement(g.EuiPopover,{button:n.a.createElement(g.EuiFilterButton,{"data-test-subj":"agentList.logLevelFilterBtn",iconType:"arrowDown",onClick:s,isSelected:a,numFilters:o.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},b.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:a,closePopover:r,panelPaddingSize:"none"},n.a.createElement(g.EuiSelectable,{options:o,onChange:e=>{c(e),e.forEach(((e,a)=>{e.checked===o[a].checked||t(e.label)}))},"data-test-subj":"agentList.logLevelFilterOptions",listProps:{paddingSize:"s"}},(e=>e)))})),da=[It,Tt.name,Ot],ga=Object(l.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i,unifiedSearch:{ui:{QueryStringInput:s}}}=Object(c.sc)(),[r,o]=Object(l.useState)();return Object(l.useEffect)((()=>{(async()=>{try{const e=(await i.dataViews.getFieldsForWildcard({pattern:Mt})||[]).filter((e=>!da.includes(e.name)));o(e)}catch(e){o(void 0)}})()}),[i.dataViews]),n.a.createElement(s,{iconType:"search",autoSubmit:!0,disableLanguageSwitcher:!0,indexPatterns:r?[{title:Mt,fields:r}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:b.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)},appName:b.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"})})})),ma=Object(l.memo)((({agent:e,agentPolicyLogLevel:t=Z.w})=>{var a,i,s,r,o,u,d;const m=Object(c.yb)(),{notifications:p}=Object(c.sc)(),[E,y]=Object(l.useState)(!1),[h,k]=Object(l.useState)(!1),v=ia()(null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.version,"8.15.0",!0),[x,F]=Object(l.useState)(null!==(r=null===(o=e.local_metadata)||void 0===o||null===(u=o.elastic)||void 0===u||null===(d=u.agent)||void 0===d?void 0:d.log_level)&&void 0!==r?r:Z.w),[M,S]=Object(l.useState)(x),I=Object(l.useCallback)((()=>{k(!0),async function(){try{const a=await Object(c.Q)(e.id,{action:{type:"SETTINGS",data:{log_level:null}}});if(a.error)throw a.error;F(t),S(t),p.toasts.addSuccess(b.i18n.translate("xpack.fleet.agentLogs.resetLogLevel.successText",{defaultMessage:"Reset agent logging level to policy"}))}catch(e){p.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.agentLogs.resetLogLevel.errorTitleText",{defaultMessage:"Error resetting agent logging level"})})}k(!1)}()}),[e.id,t,p]),T=Object(l.useCallback)((()=>{y(!0),async function(){try{const t=await Object(c.Q)(e.id,{action:{type:"SETTINGS",data:{log_level:M}}});if(t.error)throw t.error;F(M),p.toasts.addSuccess(b.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to ''{logLevel}''",values:{logLevel:M}}))}catch(e){p.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}y(!1)}()}),[p,M,e.id]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiSelect,{disabled:E||!m.fleet.allAgents,compressed:!0,id:"selectAgentLogLevel","data-test-subj":"selectAgentLogLevel",value:M,onChange:e=>{S(e.target.value)},options:Z.h.map((e=>({value:e,text:e})))})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{flush:"both",size:"xs",disabled:!m.fleet.allAgents,isLoading:E||h,iconType:"check",onClick:T,"data-test-subj":"applyLogLevelBtn"},E?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))),v&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{flush:"both",size:"xs",disabled:!m.fleet.allAgents,isLoading:E||h,iconType:"cross",onClick:I,"data-test-subj":"resetLogLevelBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.resetLogLevelLabelText",defaultMessage:"Reset to policy"})))))})),pa=L()(g.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-fcgfrk-0"})(["height:100%;"]),Ea=L()(g.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-fcgfrk-1"})(["max-width:312px;"]),fa={type:"log-view-reference",logViewId:"default"},ba=Object(ea.createStateContainerReactHelpers)(),ya=({agentPolicy:e})=>{const{getHref:t}=Object(c.jc)();return n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},e.is_managed?null:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:n.a.createElement(g.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},ha=Object(l.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,o,u;const{data:d,application:m}=Object(c.sc)(),{update:p}=ba.useTransitions(),E=Object(l.useCallback)((e=>{const{min:t,max:a}=d.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[d.query.timefilter.timefilter]),b=Object(l.useCallback)((e=>{E(e)&&p({start:e.from,end:e.to})}),[E,p]),[y,h]=Object(l.useState)(E({from:a.start,to:a.end})||E({from:wt,to:jt}));Object(l.useEffect)((()=>{const e=E({from:a.start,to:a.end});e?h(e):b({from:wt,to:jt})}),[a.start,a.end,E,b]);const k=Object(l.useCallback)((e=>{try{return Object(la.fromKueryExpression)(e),!0}catch(e){return!1}}),[]),[v,x]=Object(l.useState)(a.query),[F,S]=Object(l.useState)(k(a.query)),I=Object(l.useCallback)(((e,t)=>{x(e),k(e)?(S(!0),t&&p({query:e})):S(!1)}),[k,p]),T=Object(l.useMemo)((()=>Pt({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),O=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,w=Object(l.useMemo)((()=>{var e;if(!O)return!1;const t=null===(e=ra()(O))||void 0===e?void 0:e.version;return!!t&&ia()(t,"7.11.0")}),[O]),[j,{height:C}]=aa()(),A=Object(l.useMemo)((()=>Math.max(C,600)),[C]);return w?n.a.createElement(pa,{direction:"column",gutterSize:"m"},t&&!(null!==(o=t.monitoring_enabled)&&void 0!==o&&o.includes("logs"))&&n.a.createElement(ya,{agentPolicy:t}),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(ga,{query:v,onUpdateQuery:I,isQueryValid:F})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFilterGroup,null,n.a.createElement(ca,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],l=t.indexOf(e);l>=0?(t.splice(l,1),p({datasets:t})):p({datasets:[...a.datasets,e]})}}),n.a.createElement(ua,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],l=t.indexOf(e);l>=0?(t.splice(l,1),p({logLevels:t})):p({logLevels:[...a.logLevels,e]})}}))),n.a.createElement(Ea,{grow:!1},n.a.createElement(g.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{b({from:e,to:t})}})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(M.a,{coreStart:{application:m}},n.a.createElement(Dt,{logStreamQuery:T,startTime:_t(a.start),endTime:_t(a.end)}))))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiPanel,{paddingSize:"none",panelRef:j,grow:!1},n.a.createElement(oa.LogStream,{logView:fa,height:A,startTimestamp:y.start,endTimestamp:y.end,query:T}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(ma,{agent:e,agentPolicyLogLevel:null==t||null===(u=t.advanced_settings)||void 0===u?void 0:u.agent_logging_level}))):n.a.createElement(g.EuiCallOut,{size:"m",color:"warning",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:n.a.createElement(g.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),ka=Object(l.memo)((({agent:e,agentPolicy:t})=>{const a=Object(l.useMemo)((()=>Object(ea.createStateContainer)({...Ct,...Object(ea.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(l.useMemo)((()=>ba.connect((e=>({state:e||Ct})))(ha)),[]),[s,r]=Object(l.useState)(!1);return Object(l.useEffect)((()=>{const e=Object(ea.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:l}=Object(ea.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{l(),a.set(Ct)}}),[a]),n.a.createElement(ba.Provider,{value:a},s?n.a.createElement(i,{agent:e,agentPolicy:t}):null)})),va=Object(l.memo)((({agent:e,onClose:t})=>{var a,l;const i=JSON.stringify(e,null,2),s="string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(l=a.host)||void 0===l?void 0:l.hostname)?e.local_metadata.host.hostname:e.id,{docLinks:r}=Object(c.sc)();return n.a.createElement(g.EuiFlyout,{onClose:t,maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutTitle",defaultMessage:"''{name}'' agent details",values:{name:s}})))),n.a.createElement(g.EuiFlyoutBody,null,n.a.createElement(g.EuiText,null,n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutDescription",defaultMessage:"The JSON below is the raw agent data tracked by Fleet. This data can be useful for debugging or troubleshooting Elastic Agent. For more information, see the {doc}.",values:{doc:n.a.createElement(g.EuiLink,{href:r.links.fleet.troubleshooting},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutDocLink",defaultMessage:"troubleshooting documentation"}))}}))),n.a.createElement(g.EuiSpacer,null),n.a.createElement(g.EuiCodeBlock,{language:"json",isCopyable:!0},i)),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:t,flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsJsonFlyoutCloseButtonLabel",defaultMessage:"Close"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{iconType:"download",onClick:()=>{const e=document.createElement("a");e.href=`data:text/json;charset=utf-8,${encodeURIComponent(i)}`,e.download=`${s}-agent-details.json`,e.click()}},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsJsonDownloadButtonLabel",defaultMessage:"Download JSON"}))))))})),xa=Object(l.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(c.yb)(),r=s.fleet.allAgents,o=Object(Zt.b)(),[u,d]=Object(l.useState)(t),[m,p]=Object(l.useState)(!1),[E,b]=Object(l.useState)(!1),[y,h]=Object(l.useState)(!1),[k,v]=Object(l.useState)(!1),x="unenrolling"===e.status,F=Object(mt.isStuckInUpdating)(e),[M,S]=Object(l.useState)(!1),I=Object(l.useCallback)((e=>{S(e)}),[S]),O=i&&Object(D.q)(i),{diagnosticFileUploadEnabled:w}=D.b.get(),C=Object(l.useMemo)((()=>a||(()=>d(!1))),[a,d]),A=[...!r||null!=i&&i.is_managed?[]:[n.a.createElement(g.EuiContextMenuItem,{icon:"pencil",onClick:()=>{d(!0)},disabled:!e.active&&!i,key:"reassignPolicy"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),n.a.createElement(g.EuiContextMenuItem,{icon:"refresh",disabled:!Object(D.j)(e),onClick:()=>{b(!0)},key:"upgradeAgent","data-test-subj":"upgradeBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))],...r&&F?[n.a.createElement(g.EuiContextMenuItem,{icon:"refresh",onClick:()=>{b(!0)},key:"restartUpgradeAgent","data-test-subj":"restartUpgradeBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.restartUpgradeOneButton",defaultMessage:"Restart upgrade"}))]:[],n.a.createElement(g.EuiContextMenuItem,{icon:"inspect",onClick:()=>{S(!1),v(!k)},key:"agentDetailsJson","data-test-subj":"viewAgentDetailsJsonBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.viewAgentDetailsJsonText",defaultMessage:"View agent JSON"})),...s.fleet.readAgents&&w?[n.a.createElement(g.EuiContextMenuItem,{icon:"download",disabled:!Object(j.Q)(e),onClick:()=>{h(!0)},"data-test-subj":"requestAgentDiagnosticsBtn",key:"requestDiagnostics"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))]:[],...!r||null!=i&&i.is_managed?[]:[n.a.createElement(g.EuiContextMenuItem,{icon:"trash",disabled:!r||!e.active,onClick:()=>{p(!0)},key:"unenrollAgent"},x?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"}))]];return n.a.createElement(n.a.Fragment,null,u&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.c,{agents:[e],onClose:C})),m&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.d,{agents:[e],agentCount:1,onClose:()=>{p(!1),o()},useForceUnenroll:x,hasFleetServer:O})),E&&n.a.createElement(g.EuiPortal,null,n.a.createElement(de.e,{agents:[e],agentCount:1,onClose:()=>{b(!1),o()},isUpdating:F})),y&&n.a.createElement(g.EuiPortal,null,n.a.createElement(me,{agents:[e],agentCount:1,onClose:()=>{h(!1)}})),k&&n.a.createElement(g.EuiPortal,null,n.a.createElement(va,{agent:e,onClose:()=>v(!1)})),n.a.createElement(T.g,{isOpen:M,onChange:I,button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:A}))})),Fa=L()(g.EuiButton).withConfig({displayName:"EuiButtonCompressed",componentId:"sc-1y6vsns-0"})(["height:32px;"]),Ma=({agent:e,agentPolicy:t})=>{var a,l;const{isInstalled:i,link:s,isLoading:r}=function(e){const{isLoading:t,data:a}=Object(c.Zb)(Z.S),l="installed"===(null==a?void 0:a.item.status),n=Object(c.Db)();return{isLoading:t,isInstalled:l,link:null==n?void 0:n.getRedirectUrl({dashboardId:Z.t.ELASTIC_AGENT_AGENT_METRICS,query:{language:"kuery",query:`elastic_agent.id:${e.id}`}})}}(e),{getHref:o}=Object(c.jc)(),u=null!==(a=null==t||null===(l=t.monitoring_enabled)||void 0===l?void 0:l.length)&&void 0!==a&&a,m=i&&!r&&u?{href:s}:{disabled:!0},p=n.a.createElement(Fa,d()({},m,{isLoading:r,color:"primary",iconType:"dashboardApp"}),n.a.createElement(f.FormattedMessage,{"data-test-subj":"agentDetails.viewMoreMetricsButton",id:"xpack.fleet.agentDetails.viewDashboardButtonLabel",defaultMessage:"View more agent metrics"}));return r||u||!t?i?p:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoIntegrationTooltip",defaultMessage:"Agent dashboard not found, you need to install the elastic_agent integration."})},p):n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoLogsAndMetricsTooltip",defaultMessage:"Logs and metrics for agent are not enabled in the agent policy."})},n.a.createElement(Fa,{"data-test-subj":"agentDetails.enableLogsAndMetricsButton",isLoading:r,color:"primary",href:o("policy_details",{policyId:t.id,tabId:"settings"}),disabled:null==t?void 0:t.is_managed},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.enableLogsAndMetricsLabel",defaultMessage:"Enable logs and metrics"})))},Sa=L()(g.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1y4d0ny-0"})(["min-width:0px;"]),Ia=Object(l.memo)((({agent:e,agentPolicy:t})=>{var a,l,i,s,r,o,u,d,m,p,E,y,h,k,v,x,F;const M=Object(c.xb)(),{displayAgentMetrics:S}=D.b.get();return n.a.createElement(g.EuiPanel,null,n.a.createElement(g.EuiDescriptionList,{compressed:!0},n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},S&&n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(Sa,{grow:5},n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},[{title:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.cpuTooltip",defaultMessage:"Average CPU usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.cpuTitle",defaultMessage:"CPU"})," ",n.a.createElement(g.EuiIcon,{type:"iInCircle"}))),description:ye(e.metrics,t)},{title:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.memoryTooltip",defaultMessage:"Average memory usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.memoryTitle",defaultMessage:"Memory"})," ",n.a.createElement(g.EuiIcon,{type:"iInCircle"}))),description:he(e.metrics,t)}].map((({title:e,description:t})=>{const a="string"==typeof t&&t.length>20?t:"";return n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(Sa,{grow:8},n.a.createElement(g.EuiDescriptionListTitle,null,e)),n.a.createElement(Sa,{grow:4},n.a.createElement(g.EuiToolTip,{position:"top",content:a},n.a.createElement(g.EuiDescriptionListDescription,{className:"eui-textTruncate"},t))))})))),n.a.createElement(Sa,{grow:5},n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ma,{agent:e,agentPolicy:t}))))),[{title:b.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),description:n.a.createElement(de.a,{agent:e,fromDetails:!0})},{title:b.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),description:e.last_checkin?n.a.createElement(f.FormattedRelative,{value:new Date(e.last_checkin)}):"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.lastCheckinMessageLabel",{defaultMessage:"Last checkin message"}),description:e.last_checkin_message?e.last_checkin_message:"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:b.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?n.a.createElement(T.f,{policy:t,agent:e}):n.a.createElement(g.EuiSkeletonText,{lines:1})},{title:b.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(l=a.elastic)||void 0===l||null===(i=l.agent)||void 0===i?void 0:i.version)?n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},n.a.createElement(g.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(Ie,{isAgentUpgradable:!(!0===(null==t?void 0:t.is_managed)||!Object(D.j)(e)),agent:e,latestAgentVersion:M}))):"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(o=e.local_metadata)||void 0===o||null===(u=o.elastic)||void 0===u||null===(d=u.agent)||void 0===d?void 0:d.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.privilegeModeLabel",{defaultMessage:"Privilege mode"}),description:!0===e.local_metadata.elastic.agent.unprivileged?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.privilegeModeUnprivilegedText",defaultMessage:"Running as non-root"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.privilegeModePrivilegedText",defaultMessage:"Running as root"})},{title:b.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(m=e.local_metadata)||void 0===m||null===(p=m.elastic)||void 0===p||null===(E=p.agent)||void 0===E?void 0:E.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(y=e.local_metadata)||void 0===y||null===(h=y.os)||void 0===h?void 0:h.platform)?e.local_metadata.os.platform:"-"},{title:b.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(k=t.monitoring_enabled)&&void 0!==k&&k.includes("logs")?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"Enabled"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"Disabled"}):n.a.createElement(g.EuiSkeletonText,{lines:1})},{title:b.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(v=t.monitoring_enabled)&&void 0!==v&&v.includes("metrics")?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"Enabled"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"Disabled"}):n.a.createElement(g.EuiSkeletonText,{lines:1})},{title:b.i18n.translate("xpack.fleet.agentDetails.tagsLabel",{defaultMessage:"Tags"}),description:(null!==(x=e.tags)&&void 0!==x?x:[]).length>0?n.a.createElement(be,{tags:null!==(F=e.tags)&&void 0!==F?F:[]}):"-"}].map((({title:e,description:t})=>{const a="string"==typeof t&&t.length>20?t:"";return n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(Sa,{grow:3},n.a.createElement(g.EuiDescriptionListTitle,null,e)),n.a.createElement(Sa,{grow:7},n.a.createElement(g.EuiToolTip,{position:"top",content:a},n.a.createElement(g.EuiDescriptionListDescription,{className:"eui-textTruncate"},t))))})))))})),Ta=L()(g.EuiText).withConfig({displayName:"StyledEuiText",componentId:"sc-sfo0eu-0"})(["text-align:left;white-space:normal;"]),Oa=Object(l.memo)((({inputStatusFormatter:e})=>e.hasError?n.a.createElement(g.EuiCallOut,{title:e.getErrorTitleFromStatus(),color:"danger",iconType:"error","data-test-subj":"integrationInputErrorCallOut"},n.a.createElement(Ta,{size:"s","data-test-subj":"integrationInputErrorDescription"},e.description)):n.a.createElement(g.EuiText,{size:"s"},e.description)));function wa(e){return"logfile"===e?b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}var ja=a(10),Ca=a.n(ja);class input_status_utils_InputStatusFormatter{constructor(e,t){Ca()(this,"status",void 0),Ca()(this,"description",void 0),Ca()(this,"hasError",void 0),this.status=e,this.description=t||b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputStatusDefaultDescription",{defaultMessage:"Not available"}),this.hasError="FAILED"===e||"DEGRADED"===e}getErrorTitleFromStatus(){switch(this.status){case"FAILED":return b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputErrorTitle.failed",{defaultMessage:"Failed"});case"DEGRADED":return b.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputErrorTitle.degraded",{defaultMessage:"Degraded"});default:return}}}const Aa=(e,t)=>{const a=new RegExp(t.id);return e.map((e=>(null==e?void 0:e.units)||[])).flat().filter((e=>!!e&&e.id.match(a)))},Pa=L()(g.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-6q2goy-0"})(["font-size:",";"],(e=>e.theme.eui.euiFontSizeS)),La=L()(g.EuiTreeView).withConfig({displayName:"StyledEuiTreeView",componentId:"sc-6q2goy-1"})([".input-action-item-expanded{height:auto;padding-top:",";padding-bottom:",";.euiTreeView__nodeLabel{width:100%;}}.inputStatusHealth{padding-top:5px;}.euiTreeView__node--expanded{max-height:none !important;.policy-response-action-expanded + div{.euiTreeView__node{max-height:none !important;}}}.euiTreeView__node{max-height:none !important;.euiNotificationBadge{margin-right:5px;}.euiTreeView__nodeLabel{.euiText{font-size:",";}}}"],(({theme:e})=>e.eui.euiSizeS),(({theme:e})=>e.eui.euiSizeS),(({theme:e})=>e.eui.euiFontSize)),_a=Object(l.memo)((({agent:e,packagePolicy:t,"data-test-subj":a})=>{const{getHref:i}=Object(c.jc)(),s=Object(l.useMemo)((()=>t.inputs.reduce(((a,l)=>{if(!e.components)return new Map;if(l.enabled){var n;const i=null===(n=Aa(e.components,t))||void 0===n?void 0:n.find((e=>e.id.match(new RegExp(l.type))));a.set(l.type,i?new input_status_utils_InputStatusFormatter(i.status,i.message):new input_status_utils_InputStatusFormatter)}return a}),new Map)),[e.components,t]),r=e=>{const t=s.get(e);return void 0===(null==t?void 0:t.status)?n.a.createElement(g.EuiHealth,{color:"default","data-test-subj":"agentDetailsIntegrationsInputStatusHealthDefault",className:"inputStatusHealth"}):"HEALTHY"===t.status?n.a.createElement(g.EuiHealth,{color:"success","data-test-subj":"agentDetailsIntegrationsInputStatusHealthSuccess",className:"inputStatusHealth"}):n.a.createElement(g.EuiNotificationBadge,{"data-test-subj":"agentDetailsIntegrationsInputStatusAttentionHealth"},1)};return n.a.createElement(La,{items:(()=>{const a=Array.from(s.values()).reduce(((e,t)=>(t.hasError&&(e+=1),e)),0);return[{label:n.a.createElement(g.EuiText,{color:a?"danger":"default",size:"s","data-test-subj":"agentIntegrationsInputsTitle"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.inputsTypeLabel",defaultMessage:"Inputs"})),id:"agentIntegrationsInputs",icon:a?n.a.createElement(g.EuiNotificationBadge,{"data-test-subj":"agentIntegrationsInputsStatusHealth"},a):void 0,children:t.inputs.reduce(((t,a)=>{if(a.enabled){const o=s.get(a.type);return[...t,{label:n.a.createElement(g.EuiToolTip,{content:b.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},n.a.createElement(Pa,{href:i("agent_details",{agentId:e.id,tabId:"logs",logQuery:(l=a.type,"logfile"===l?`(${At}:!(elastic_agent.filebeat))`:l.match(/\/metrics$/)?`(${At}:!(elastic_agent.metricbeat))`:"osquery"===l?`(${At}:!(elastic_agent.osquerybeat))`:l.match(/^synthetics\//)?`(${At}:!(elastic_agent.heartbeat))`:"apm"===l?`(${At}:!(elastic_agent.apm_server))`:"endpoint"===l?`(${At}:!(elastic_agent.endpoint_security))`:"")}),"aria-label":b.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},wa(a.type))),id:a.type,icon:r(a.type),children:o?[{label:n.a.createElement(Oa,{inputStatusFormatter:o}),id:`input-status-${a.type}`,isExpanded:!0,className:"input-action-item-expanded"}]:[]}]}var l;return t}),[])}]})(),showExpansionArrows:!0,"aria-label":"inputsTreeView","aria-labelledby":"inputsTreeView"})})),Da=L()(g.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-f6nvxk-0"})([".euiAccordion__button{width:90%;}.euiAccordion__triggerWrapper{padding-left:",";}&.euiAccordion-isOpen{.euiAccordion__childWrapper{padding:",";padding-top:0px;}}.ingest-integration-title-button{padding:",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}.euiAccordion__buttonContent{width:100%;}"],(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeS)),Ba=({id:e,title:t,children:a,"data-test-subj":i})=>{const s=Object(l.useMemo)((()=>{if(i)return{"data-test-subj":`${i}-openCloseToggle`}}),[i]);return n.a.createElement(g.EuiPanel,{paddingSize:"none"},n.a.createElement(Da,{id:e,arrowDisplay:"left",buttonClassName:"ingest-integration-title-button",buttonContent:t,arrowProps:s,"data-test-subj":i},a))},Ra=Object(l.memo)((({agent:e,agentPolicy:t,packagePolicy:a,"data-test-subj":i})=>{var s,r,o,u;const{getHref:d}=Object(c.jc)(),m=Object(g.useEuiTheme)(),[p,E]=Object(l.useState)(!1),b=Object(c.uc)(null!==(s=null===(r=a.package)||void 0===r?void 0:r.name)&&void 0!==s?s:"","package-policy-response"),y=Object(l.useMemo)((()=>b&&n.a.createElement(T.k,null,n.a.createElement(b.Component,{agent:e,onShowNeedsAttentionBadge:E}))),[e,b]),h=Object(l.useMemo)((()=>e.components?Aa(e.components,a).filter((e=>"DEGRADED"===e.status||"FAILED"===e.status)):[]),[e.components,a]),k=p||!!h.length,v=Object(c.uc)(null!==(o=null===(u=a.package)||void 0===u?void 0:u.name)&&void 0!==o?o:"","package-generic-errors-list"),x=Object(l.useMemo)((()=>v&&n.a.createElement(T.k,null,n.a.createElement(v.Component,{packageErrors:h}))),[h,v]);return n.a.createElement(Ba,{id:a.id,"data-test-subj":i,title:n.a.createElement(g.EuiTitle,{size:"xs"},n.a.createElement("h3",null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},a.package?n.a.createElement(T.r,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):n.a.createElement(T.r,{size:"l",packageName:"default",version:"0"})),n.a.createElement(g.EuiFlexItem,{className:"eui-textTruncate"},n.a.createElement(g.EuiLink,{className:"eui-textTruncate","data-test-subj":"agentPolicyDetailsLink",href:d("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)),k&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiBadge,{color:m.euiTheme.colors.danger,iconType:"warning",iconSide:"left","data-test-subj":i?`${i}-needsAttention`:void 0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.needsAttention.label",defaultMessage:"Needs attention"}))))))},n.a.createElement(_a,{agent:e,packagePolicy:a}),y,x,n.a.createElement(g.EuiSpacer,null))})),za=Object(l.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map(((a,l)=>{var i,s;const r=(null!==(i=null===(s=a.package)||void 0===s?void 0:s.name)&&void 0!==i?i:"packagePolicy")+"-"+l;return n.a.createElement(g.EuiFlexItem,{grow:!1,key:a.id,"data-test-subj":r},n.a.createElement(Ra,{agent:e,agentPolicy:t,packagePolicy:a,"data-test-subj":`${r}-accordion`}))}))):null)),Na=L()(g.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1n7kbng-0"})(["min-width:0px;"]),Ha=Object(l.memo)((({agent:e,agentPolicy:t})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(Na,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(Ia,{agent:e,agentPolicy:t})),n.a.createElement(Na,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(za,{agent:e,agentPolicy:t})))))),Ua=({agent:e})=>{const t=Object(c.yb)(),{notifications:a}=Object(c.sc)(),{getAbsolutePath:i}=Object(c.jc)(),[s,r]=Object(l.useState)(!0),[o,u]=Object(l.useState)(!1),[d,m]=Object(l.useState)([]),[p,E]=Object(l.useState)([]),[y,h]=Object(l.useState)([]),[k,v]=Object(l.useState)(1e4),[x,F]=Object(l.useState)(!1),M=Object(l.useCallback)((async()=>{try{const t=await Object(c.z)(e.id),a=t.error;if(a)throw a;if(!t.data)throw new Error("No data");const l=t.data.items;E(l),r(!1),l.some((e=>"IN_PROGRESS"===e.status||"AWAITING_UPLOAD"===e.status))?v(3e3):v(1e4)}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.requestDiagnostics.errorLoadingUploadsNotificationTitle",{defaultMessage:"Error loading diagnostics uploads"})})}}),[e.id,a.toasts,v]);Object(l.useEffect)((()=>{M();const e=setInterval((async()=>{M()}),k);return()=>{e&&clearInterval(e)}}),[M,k]),Object(l.useEffect)((()=>{h(p),y.length>0&&p.filter((e=>{const t=y.find((t=>t.id===e.id));return"READY"===e.status&&(!t||"READY"!==(null==t?void 0:t.status))})).forEach((e=>{a.toasts.addSuccess({title:b.i18n.translate("xpack.fleet.requestDiagnostics.readyNotificationTitle",{defaultMessage:"Agent diagnostics {name} ready",values:{name:e.name}})},{toastLifeTimeMs:5e3})}))}),[y,p,a.toasts]),Object(l.useEffect)((()=>{m(o?p:p.filter((e=>"EXPIRED"!==e.status)))}),[p,o]);const S=[{field:"id",name:b.i18n.translate("xpack.fleet.requestDiagnostics.tableColumns.fileLabelText",{defaultMessage:"File"}),render:e=>{const t=p.find((t=>t.id===e));return"READY"===(null==t?void 0:t.status)?n.a.createElement(g.EuiLink,{href:i(null==t?void 0:t.filePath),download:!0,target:"_blank"},n.a.createElement(g.EuiIcon,{type:"download"}),"   ",null==t?void 0:t.name):"IN_PROGRESS"===(null==t?void 0:t.status)||"AWAITING_UPLOAD"===(null==t?void 0:t.status)?n.a.createElement(g.EuiLink,{color:"subdued",disabled:!0},n.a.createElement(g.EuiLoadingSpinner,null),"  ",n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.generatingText",defaultMessage:"Generating diagnostics file..."})):n.a.createElement(g.EuiLink,{color:"subdued",disabled:!0},n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",direction:"row",alignItems:"center"},null!=t&&t.error?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.errorGeneratingFileMessage",defaultMessage:"Error generating file: {reason}",values:{reason:t.error}})},n.a.createElement(g.EuiIcon,{type:"warning",color:"danger"}))):null!=t&&t.status?n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:t.status},n.a.createElement(g.EuiIcon,{type:"warning",color:"danger"}))):null,n.a.createElement(g.EuiFlexItem,null,null==t?void 0:t.name)))}},{field:"id",name:b.i18n.translate("xpack.fleet.requestDiagnostics.tableColumns.dateLabelText",{defaultMessage:"Date"}),dataType:"date",render:e=>{const t=p.find((t=>t.id===e));return n.a.createElement(g.EuiText,{size:"s",color:"READY"===(null==t?void 0:t.status)?"default":"subdued"},Object(g.formatDate)(null==t?void 0:t.createTime,"lll"))}},...t.fleet.allAgents?[{name:b.i18n.translate("xpack.fleet.requestDiagnostics.tableColumns.actionsLabelText",{defaultMessage:"Actions"}),width:"70px",actions:[{type:"icon",icon:"trash",color:"danger",name:b.i18n.translate("xpack.fleet.requestDiagnostics.tableColumns.deleteButtonText",{defaultMessage:"Delete"}),available:e=>"READY"===e.status,description:b.i18n.translate("xpack.fleet.requestDiagnostics.tableColumns.deleteButtonDesc",{defaultMessage:"Delete diagnostics file"}),onClick:e=>{var t;t=e.id,Object(c.n)(t).then((({data:e,error:t})=>{t||!1===(null==e?void 0:e.deleted)?a.toasts.addError(t||new Error("Request returned `deleted: false`"),{title:b.i18n.translate("xpack.fleet.requestDiagnostics.errorDeletingUploadNotificationTitle",{defaultMessage:"Error deleting diagnostics file"})}):a.toasts.addSuccess({title:b.i18n.translate("xpack.fleet.requestDiagnostics.successDeletingUploadNotificationTitle",{defaultMessage:"Diagnostics file deleted"})}),M()}))}}]}]:[]],I=n.a.createElement(g.EuiButton,{fill:!0,size:"s",onClick:()=>{F(!0)},disabled:!Object(j.Q)(e)||!t.fleet.readAgents},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}));return n.a.createElement(n.a.Fragment,null,x&&n.a.createElement(g.EuiPortal,null,n.a.createElement(me,{agents:[e],agentCount:1,onClose:()=>{F(!1),M()}})),n.a.createElement(g.EuiText,{size:"s"},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.calloutText",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs. By default, files are periodically deleted via an ILM policy."}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center",justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},Object(j.Q)(e)?I:n.a.createElement(g.EuiToolTip,{content:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.notSupportedTooltip",defaultMessage:"Requesting agent diagnostics is not supported for agents before version {version}.",values:{version:j.e}})},I)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiSwitch,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.showExpiredFilesLabel",defaultMessage:"Show expired file requests"}),checked:o,onChange:e=>u(e.target.checked)}))),n.a.createElement(g.EuiSpacer,{size:"m"}),s?n.a.createElement(g.EuiSkeletonText,{lines:3}):n.a.createElement(g.EuiBasicTable,{items:d,columns:S}))},qa=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:o}=Object(c.jc)(),{displayAgentMetrics:u}=D.b.get(),{isLoading:d,isInitialRequest:m,error:p,data:E,resendRequest:y}=Object(c.Vb)(i,{pollIntervalMs:5e3,query:{withMetrics:u}}),{isLoading:h,data:k,sendRequest:v}=Object(c.Wb)(null==E||null===(e=E.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:x}}=Object(c.sc)(),F=Object(c.ec)(),M="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),S=Object(l.useCallback)((()=>{F&&F.onDoneNavigateTo&&x(F.onDoneNavigateTo[0],F.onDoneNavigateTo[1])}),[F,x]),{diagnosticFileUploadEnabled:I}=D.b.get(),O=null==E||null===(t=E.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,j=Object(l.useMemo)((()=>n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiButtonEmpty,{iconType:"arrowLeft",href:o("agent_list"),flush:"left",size:"xs"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{className:"eui-textBreakWord"},n.a.createElement("h1",null,d&&m?n.a.createElement(T.p,null):"object"==typeof O&&"string"==typeof(null==O?void 0:O.hostname)?O.hostname:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent ''{id}''",values:{id:i}})))))),[O,i,o,m,d]),C=Object(l.useMemo)((()=>E&&E.item?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"s",direction:"row"},!h&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(xa,{agent:E.item,agentPolicy:null==k?void 0:k.item,assignFlyoutOpenByDefault:M,onCancelReassign:F&&F.onDoneNavigateTo?S:void 0})))):void 0),[k,E,o,h]),A=Object(l.useMemo)((()=>{const e=[{id:"details",name:b.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:o("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:b.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:o("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}];return I&&e.push({id:"diagnostics",name:b.i18n.translate("xpack.fleet.agentDetails.subTabs.diagnosticsTab",{defaultMessage:"Diagnostics"}),href:o("agent_details_diagnostics",{agentId:i,tabId:"diagnostics"}),isSelected:"diagnostics"===s}),e}),[o,i,s,I]);return n.a.createElement(Zt.a.Provider,{value:{refresh:()=>{y(),v()}}},n.a.createElement(w.d,{leftColumn:j,rightColumn:C,tabs:A},d&&m?n.a.createElement(T.p,null):p?n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:p}):E&&E.item?n.a.createElement(Ga,{agent:E.item,agentPolicy:null==k?void 0:k.item}):n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:b.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},Ga=({agent:e,agentPolicy:t})=>(Object(c.zb)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.agent_details_logs,render:()=>n.a.createElement(ka,{agent:e,agentPolicy:t})}),n.a.createElement(o.b,{path:O.k.agent_details_diagnostics,render:()=>n.a.createElement(Ua,{agent:e})}),n.a.createElement(o.b,{path:O.k.agent_details,render:()=>n.a.createElement(Ha,{agent:e,agentPolicy:t})}))),Wa=Object(r.withRouter)((({actionSection:e,title:t,children:a})=>n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceAround"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiPageSection,{color:"transparent"},n.a.createElement(g.EuiEmptyPrompt,{color:"plain",iconType:"logoBeats",title:n.a.createElement("h2",null,t),body:a,actions:e})))))),Ka=Object(f.injectI18n)((({intl:e})=>n.a.createElement(Wa,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains All permissions for this application."}))))),Va=()=>{var e;Object(c.zb)("agent_list");const{agents:t}=Object(c.Cb)(),a=Object(c.yb)(),l=Object(c.Kb)(),i=Object(c.Lb)();if(!t.enabled)return null;if(!l.missingRequirements&&l.isLoading)return n.a.createElement(T.p,null);if(l.error)return n.a.createElement(w.e,null,n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:l.error}));const s=1===(null==l||null===(e=l.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===l.missingRequirements[0],r=a.fleet.allAgents&&(l.forceDisplayInstructions||s);if(!s&&l.missingRequirements&&l.missingRequirements.length>0)return n.a.createElement(Jt.b,{missingRequirements:l.missingRequirements});if(!a.fleet.readAgents)return n.a.createElement(Ka,null);const u=r?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>i.openEnrollmentFlyout(),"data-test-subj":"addAgentBtnTop"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.agent_details},n.a.createElement(qa,null)),n.a.createElement(o.b,{path:O.k.agents},n.a.createElement(w.a,{section:"agents",rightColumn:u},r?n.a.createElement(Jt.a,{showEnrollmentRecommendation:!1}):n.a.createElement(Xt,null))))};var $a=a(378);const Qa="fleet-first-agent-policy",Ya=Object.freeze(Object(B.b)({id:Qa,name:b.i18n.translate("xpack.fleet.createPackagePolicy.firstAgentPolicyNameText",{defaultMessage:"My first agent policy"})})),Xa=Ve.m.bind(null,Ya);const Ja=e=>{const{discover:t}=Object(Ve.Xc)(),[a,n]=Object(l.useState)(null);return Object(l.useEffect)((()=>{(async()=>{if(t&&t.locator){const a=await t.locator.getUrl({indexPatternId:"logs-*",timeRange:{from:"now-1h",to:"now",mode:"relative"},filters:[{meta:{alias:"Recently enrolled agents",index:"logs-*"},query:{terms:{"agent.id":e}}}]});n(a)}})()}),[t,e]),a};var Za=a(149);const el=L()("h1").withConfig({displayName:"CentralTitle",componentId:"sc-ve6hfp-0"})(["text-align:center;"]),tl=({children:e})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiTitle,{size:"l"},n.a.createElement(el,null,e)),n.a.createElement(g.EuiSpacer,{size:"xl"})),al=L()(g.EuiText).withConfig({displayName:"SubtitleText",componentId:"sc-ve6hfp-1"})(["max-width:250px;margin:0 auto;text-align:center;"]),ll=L()(g.EuiStepNumber).withConfig({displayName:"CenteredEuiStepNumber",componentId:"sc-ve6hfp-2"})(["margin:0 auto;"]),nl=e=>n.a.createElement("div",{style:{margin:"0 auto"}},n.a.createElement(g.EuiImage,d()({role:"presentation"},e))),il=({children:e})=>{const t=Object(g.useIsWithinMaxBreakpoint)("s");return n.a.createElement(g.EuiFlexGroup,{direction:"column",gutterSize:t?"xs":"l",alignItems:"center",justifyContent:"center",wrap:!0},e)},sl=()=>{const{http:e}=Object(c.sc)(),t=e.basePath.prepend("/plugins/fleet/assets/");return n.a.createElement(g.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceEvenly",gutterSize:"none"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(il,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(ll,{status:"incomplete",number:1})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement("div",{style:{margin:"0 auto"}},n.a.createElement(nl,{alt:"",src:t+"1_install_agent.svg"}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{textAlign:"center",size:"xs"},n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStepTitle",defaultMessage:"Install Elastic Agent"}))),n.a.createElement(al,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStep",defaultMessage:"Install agents on the hosts that you want to connect to Elastic."}))))),n.a.createElement(g.EuiShowFor,{sizes:["s","xs"]},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiSpacer,{size:"xl"}))),n.a.createElement(g.EuiHideFor,{sizes:["s","xs"]},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(nl,{alt:"",src:t+"arrow_right_curve_over.svg"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(il,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(ll,{status:"incomplete",number:2})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(nl,{alt:"",src:t+"2_add_integration.svg"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{textAlign:"center",size:"xs"},n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStepTitle",defaultMessage:"Add the integration"}))),n.a.createElement(al,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStep",defaultMessage:"Make a few selections to finalize how Elastic receives your data."}))))),n.a.createElement(g.EuiShowFor,{sizes:["s","xs"]},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiSpacer,{size:"xl"}))),n.a.createElement(g.EuiHideFor,{sizes:["s","xs"]},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(nl,{alt:"",src:t+"arrow_right_curve_under.svg"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(il,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(ll,{status:"incomplete",number:3})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(nl,{alt:"",src:t+"3_confirm_data.svg"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{textAlign:"center",size:"xs"},n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStepTitle",defaultMessage:"Confirm incoming data"}))),n.a.createElement(al,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStep",defaultMessage:"Explore and analyze the incoming data."}))))))},rl=L()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-ve6hfp-3"})(["padding-bottom:100px;"]),ol=()=>{const{docLinks:e}=Object(c.sc)();return n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceAround"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiLink,{href:e.links.fleet.elasticAgent,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.learnMoreLink",defaultMessage:"Learn more about installing Elastic Agent"}))))},cl=({integrationInfo:e,packageInfo:t,isLoading:a,error:l,cancelUrl:i,cancelClickHandler:s,onNext:r})=>{if(l)return n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:l});const o=n.a.createElement(tl,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.pageTitle",defaultMessage:"Ready to add your first integration?"}));return n.a.createElement(w.d,{topContent:o},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"xxl"}),n.a.createElement(g.EuiSpacer,{size:"xxl"}),n.a.createElement(sl,null),n.a.createElement(g.EuiSpacer,{size:"xxl"}),n.a.createElement(g.EuiSpacer,{size:"xxl"}),n.a.createElement(rl,null,n.a.createElement(ol,null)),n.a.createElement(ml,{cancelUrl:i,cancelMessage:n.a.createElement("span",{"data-test-subj":"skipAgentInstallation"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.skipAddAgentButton",defaultMessage:"Add integration only (skip agent installation)"})),cancelClickHandler:s,isLoading:a,onNext:r,noAnimation:!0,actionMessage:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentButton",defaultMessage:"Install Elastic Agent"})}),t&&n.a.createElement(Za.a,{pkgTitle:(null==e?void 0:e.title)||t.title,pkgkey:Object(D.p)(t),integration:null==e?void 0:e.name})))},ul=L()(g.EuiBottomBar).withConfig({displayName:"CenteredRoundedBottomBar",componentId:"sc-113t0u1-0"})(["max-width:820px;margin:0 auto !important;border-radius:8px 8px 0px 0px;"]),dl=L()(ul).withConfig({displayName:"NoAnimationCenteredRoundedBottomBar",componentId:"sc-113t0u1-1"})(["animation-delay:-99s;#stop bottom bar flying in on step change"]),gl=L()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-113t0u1-2"})(["padding-bottom:100px;"]),ml=({isLoading:e,loadingMessage:t,onNext:a,cancelClickHandler:l,cancelUrl:i,actionMessage:s,cancelMessage:r,isDisabled:o=!1,noAnimation:c=!1})=>{const u=c?dl:ul;return n.a.createElement(u,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{color:"text",size:"s",href:i,onClick:l},r||n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.backButton",defaultMessage:"Go back"})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"primary",fill:!0,size:"m",isDisabled:o,isLoading:!o&&e,onClick:a},e?t||n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.loading",defaultMessage:"Loading..."}):s))))},pl=({onNext:e,cancelClickHandler:t,cancelUrl:a,noAnimation:l=!1})=>{const i=l?dl:ul;return n.a.createElement(i,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{color:"text",size:"s",href:a,onClick:t},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.backButton",defaultMessage:"Go back"})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"primary",fill:!0,size:"m",onClick:e},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.viewIncomingDataBtn",defaultMessage:"View incoming data"})))))},El=({pkgkey:e})=>{const t=e.includes(H.FLEET_KUBERNETES_PACKAGE),{getHref:a}=Object(Ve.Kc)(),{getAbsolutePath:l}=Object(Ve.Kc)();return n.a.createElement(ul,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{color:"text",size:"s",href:a("integrations_all")},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.addAnotherIntegration",defaultMessage:"Add another integration"})))),!t&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"success",fill:!0,size:"m",href:a("integration_details_assets",{pkgkey:e})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.viewDataAssetsButtonText'",defaultMessage:"View assets"}))),t&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"success",fill:!0,size:"m",href:l("/app/dashboards#/view/kubernetes-f4dc26db-1b53-4ea2-a78b-1bfab8ea267c")},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData. '",defaultMessage:"View Kubernetes metrics dashboards"})))))},fl=({troubleshootLink:e,agentIds:t,integration:a})=>{const l=Ja(t);return n.a.createElement(ul,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{color:"text",size:"s",href:e,iconType:"popout",target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLinkBottomBar",defaultMessage:"Troubleshooting guide"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"success",fill:!0,href:null!=l?l:""},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLogsLink",defaultMessage:"View incoming {integration} logs",values:{integration:null!=a?a:""}})))))},bl=e=>{const{packageInfo:t,integrationInfo:a,steps:l,currentStep:i,error:s}=e;if(s)return n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:s});const r=l[i].component,o=n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,{size:"l",className:"eui-textCenter"},n.a.createElement("h1",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.multiPageTitle",defaultMessage:"Set up {title} integration",values:{title:t.title}}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(kl,{currentStep:i,steps:l.map((e=>e.title))}),n.a.createElement(g.EuiSpacer,{size:"xl"}));return n.a.createElement(w.d,{topContent:o,restrictHeaderWidth:866,restrictWidth:866},n.a.createElement(r,e),t&&n.a.createElement(Za.a,{pkgTitle:(null==a?void 0:a.title)||t.title,pkgkey:Object(D.p)(t),integration:null==a?void 0:a.name}))},yl=L()(g.EuiStepsHorizontal).withConfig({displayName:"NumberlessHorizontalSteps",componentId:"sc-opcgc5-0"})([".euiStepNumber{color:transparent;width:16px;height:16px;outline-color:#07c;}.euiStepHorizontal::before{width:calc(50% - 8px);top:32px;}.euiStepHorizontal::after{width:calc(50% - 8px);top:32px;}.euiStepHorizontal{padding:25px 16px 16px;}.euiStepHorizontal[data-step-status='incomplete'] .euiStepHorizontal__title{color:#69707d;}"]),hl=(e,t,a)=>e===t?a?"complete":"current":e>t?"complete":"incomplete",kl=({steps:e,currentStep:t=0,currentStepComplete:a=!1})=>{const l=e.map(((e,l)=>({title:e,status:hl(t,l,a),onClick:()=>{}})));return n.a.createElement(yl,{steps:l})};var vl=a(220),xl=a(185),Fl=a(205);var Ml=L()(g.EuiCodeBlock).withConfig({displayName:"_StyledEuiCodeBlock",componentId:"sc-oz6m9j-1"})(["max-width:1100px;"]);const Sl=e=>{var t;const{cancelUrl:a,onNext:i,cancelClickHandler:s,setIsManaged:r,agentPolicy:o,enrollmentAPIKey:c,fleetServerHost:u,fleetProxy:d,enrolledAgentIds:m}=e,p=Object(Ve.Xc)(),{docLinks:E}=p,y=E.links.fleet.troubleshooting,h=Object(Ve.Hb)(),[k,v]=Object(l.useState)(!1),[x,F]=Object(l.useState)(!1);if(!c)return n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Enrollment API key not found"});const M="kubernetes"===e.packageInfo.name?"IS_KUBERNETES_MULTIPAGE":"IS_NOT_KUBERNETES",S=Object(Fl.a)({apiKey:c.api_key,fleetProxy:d,fleetServerHost:u,agentVersion:h||""}),I=[Object(xl.f)({installCommand:S,apiKeyData:{item:c},enrollToken:c.api_key,isK8s:M,selectedApiKeyId:c.id,isComplete:k||!!m.length,fullCopyButton:!0,fleetServerHost:u,onCopy:()=>v(!0),rootIntegrations:Object(j.N)(null!==(t=null==o?void 0:o.package_policies)&&void 0!==t?t:[])})];return"IS_KUBERNETES_MULTIPAGE"===M&&I.push((({isComplete:e,fullCopyButton:t,onCopy:a})=>{const[i,s]=Object(l.useState)(!1),r=L.a.pre.withConfig({displayName:"CommandCode",componentId:"sc-oz6m9j-0"})({overflow:"auto"});return{status:e?"complete":void 0,title:b.i18n.translate("xpack.fleet.agentEnrollment.stepKubernetesApplyManifest",{defaultMessage:"Run the apply command"}),children:n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.agentEnrollment.kubernetesCommandInstructions",defaultMessage:"From the directory where the manifest is downloaded, run the apply command."}),n.a.createElement(g.EuiSpacer,{size:"m"})),n.a.createElement(Ml,{onClick:()=>{a&&a()},fontSize:"m",isCopyable:!t,paddingSize:"m"},n.a.createElement(r,null,"kubectl apply -f elastic-agent-managed-kubernetes.yml")),n.a.createElement(g.EuiSpacer,{size:"s"}),t&&n.a.createElement(g.EuiCopy,{textToCopy:"kubectl apply -f elastic-agent-managed-kubernetes.yml"},(e=>n.a.createElement(g.EuiButton,{color:"primary",iconType:"copyClipboard",size:"m",onClick:()=>(e=>{e(),s(!0),a&&a()})(e)},i?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButtonClicked",defaultMessage:"Copied"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButton",defaultMessage:"Copy to clipboard"})))))}})({isComplete:x||!!m.length,fullCopyButton:!0,onCopy:()=>F(!0)})),I.push(Object(xl.a)({selectedPolicyId:null==o?void 0:o.id,troubleshootLink:y,agentCount:m.length,showLoading:!0,poll:k})),h?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addIntegration.installAgentStepTitle",defaultMessage:"These steps configure and enroll the Elastic Agent in Fleet to automatically deploy updates and centrally manage the agent. As an alternative to Fleet, advanced users can run agents in {standaloneLink}.",values:{standaloneLink:n.a.createElement(g.EuiLink,{onClick:()=>r(!1)},"standalone mode")}})),n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiSteps,{steps:I}),!!m.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement(gl,null),n.a.createElement(ml,{cancelUrl:a,cancelClickHandler:s,onNext:i,actionMessage:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationButton",defaultMessage:"Add the integration"})}))):n.a.createElement(g.EuiLoadingSpinner,null)};var Il=a(172);const Tl=e=>{var t;const{setIsManaged:a,agentPolicy:i,cancelUrl:s,onNext:r,cancelClickHandler:o}=e,c=Object(Ve.Ic)(),[u,d]=Object(l.useState)(!1),[m,p]=Object(l.useState)(!1),{yaml:E,onCreateApiKey:b,apiKey:y,downloadYaml:h}=Object(Il.c)(i);if(!i)return n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Agent policy not provided"});const k=Object(Fl.b)(c),v=[Object(xl.d)({selectedPolicyId:null==i?void 0:i.id,yaml:E,downloadYaml:h,apiKey:y,onCreateApiKey:b,isComplete:m,onCopy:()=>p(!0)}),Object(xl.g)({installCommand:k,isComplete:E&&u,fullCopyButton:!0,onCopy:()=>d(!0),rootIntegrations:Object(j.N)(null!==(t=null==i?void 0:i.package_policies)&&void 0!==t?t:[])})];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ll,{setIsManaged:a}),n.a.createElement(g.EuiSpacer,{size:"xl"}),n.a.createElement(g.EuiSteps,{steps:v}),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(gl,null),n.a.createElement(pl,{cancelUrl:s,onNext:r,cancelClickHandler:o})))};var Ol=a(138),wl=a(3),jl=a(157),Cl=a(246);const Al=({children:e})=>{const[t,a]=Object(l.useState)(!1);return n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"column"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},n.a.createElement(g.EuiFlexItem,null),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{size:"s",iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:()=>a(!t),flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.stepConfigure.advancedOptionsToggleLinkText",defaultMessage:"Advanced options"}))))),t&&n.a.createElement(g.EuiFlexItem,null,e)))},Pl=({error:e,title:t})=>n.a.createElement(T.i,{title:t||n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addIntegration.errorTitle",defaultMessage:"Error adding integration"}),error:e}),Ll=({setIsManaged:e})=>n.a.createElement(g.EuiCallOut,{title:"Setting up to run Elastic Agent in standalone mode",color:"primary",iconType:"iInCircle"},n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addIntegration.standaloneWarning",defaultMessage:"Setting up integrations by running Elastic Agent in standalone mode is advanced. When possible, we recommend using {link} instead. ",values:{link:n.a.createElement(g.EuiLink,{href:"#"},"Fleet-managed agents")}})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiButton,{onClick:()=>e(!0),color:"primary"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.addIntegration.switchToManagedButton",defaultMessage:"Enroll in Fleet instead (recommended)"})));var _l=a(24),Dl=a(707),Bl=a.n(Dl),Rl=a(297);const zl=({agentIds:e,troubleshootLink:t,packageInfo:a})=>{var l;const i=Ja(e);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,null,n.a.createElement("h3",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.title",defaultMessage:"Confirming data is taking longer than expected"}))),n.a.createElement(g.EuiText,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.body",defaultMessage:"If the system is not generating data, it may help to generate some to ensure data is being collected correctly. If you're having trouble, see our {troubleshootLink}, or you may check later by viewing {discoverLink}.",values:{troubleshootLink:n.a.createElement(g.EuiLink,{external:!0,href:t,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLink",defaultMessage:"troubleshooting guide"})),discoverLink:n.a.createElement(g.EuiLink,{external:!0,href:null!=i?i:"",target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLink",defaultMessage:"{integration} logs in Discover",values:{integration:null!==(l=null==a?void 0:a.title)&&void 0!==l?l:""}}))}})),n.a.createElement(gl,null),n.a.createElement(fl,{agentIds:e,troubleshootLink:t,integration:null==a?void 0:a.title}))},Nl=["agent.ephemeral_id","agent.id","elastic_agent.id","data_stream.namespace","@timestamp"],Hl=L()(g.EuiDescriptionList).withConfig({displayName:"CleanOverflowDescriptionList",componentId:"sc-6co0kl-0"})(["overflow:hidden;max-height:125px;word-break:break-all;white-space:pre-wrap;"]),Ul=L()("pre").withConfig({displayName:"CompressedPre",componentId:"sc-6co0kl-1"})(["&&&{background:none;padding:0 0;}"]),ql=({hit:e})=>{const t=Bl()(Object(_l.getFlattenedObject)(e._source),Nl),a=Object.entries(t).map((([e,t])=>({title:`${e}:`,description:JSON.stringify(t)})));return n.a.createElement("pre",null,n.a.createElement("code",null,n.a.createElement(Hl,{listItems:a,type:"inline",align:"left",compressed:!0})))},Gl=({hit:e})=>{const t=(null==e?void 0:e._source)||{},a=(null==t?void 0:t["@timestamp"])||"-";return n.a.createElement(g.EuiText,{size:"xs"},n.a.createElement(Ul,null,a?Object(g.formatDate)(a,"MMM D, YYYY @ HH:mm:ss.SSS"):"-"))},Wl=({dataPreview:e})=>{const t=e.slice(0,5);return n.a.createElement(n.a.Fragment,null,t.map((e=>n.a.createElement("div",{id:e._id},n.a.createElement(g.EuiFlexGroup,{gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,{style:{minWidth:"220px"}},n.a.createElement(Gl,{hit:e})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(ql,{hit:e}))),n.a.createElement(g.EuiHorizontalRule,{margin:"s"})))))},Kl=({agentIds:e,packageInfo:t,agentDataConfirmed:a,setAgentDataConfirmed:l,troubleshootLink:i})=>{const{incomingData:s,dataPreview:r,isLoading:o,hasReachedTimeout:c}=Object(Rl.b)(e,!0,5),{enrolledAgents:u,numAgentsWithData:d}=Object(Rl.a)(s,t),m=Object(Ve.Fc)(null==t?void 0:t.name),{guidedOnboarding:p}=Object(Ve.Xc)();var E;return!o&&u>0&&d>0&&(l(!0),m&&(null==p||null===(E=p.guidedOnboardingApi)||void 0===E||E.completeGuidedOnboardingForIntegration(null==t?void 0:t.name))),a?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiCallOut,{"data-test-subj":"IncomingDataConfirmedCallOut",title:b.i18n.translate("xpack.fleet.confirmIncomingDataWithPreview.title",{defaultMessage:"Incoming data received from {numAgentsWithData} enrolled { numAgentsWithData, plural, one {agent} other {agents}}.",values:{numAgentsWithData:d}}),color:"success",iconType:"check"}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,null,n.a.createElement("h3",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.previewTitle",defaultMessage:"Preview of incoming data:"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Wl,{dataPreview:r})):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement(g.EuiCallOut,{size:"m",color:"primary",iconType:g.EuiLoadingSpinner,title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.listening",defaultMessage:"Listening for incoming data from enrolled agents..."})}),n.a.createElement(g.EuiSpacer,{size:"m"}),c?n.a.createElement(zl,{agentIds:e,troubleshootLink:i,packageInfo:t}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.loading",defaultMessage:"It might take a few minutes for the data to get to Elasticsearch. If you're not seeing any, try generating some to verify. If you're having trouble connecting, check out the {link}.",values:{link:n.a.createElement(g.EuiLink,{target:"_blank",external:!0,href:i},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiSkeletonText,{lines:10}))},Vl=({troubleshootLink:e})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,null,n.a.createElement(g.EuiCallOut,{size:"m",color:"primary",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.title",defaultMessage:"Data preview is not available for standalone agents. "})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.description",defaultMessage:"You can check for agent data in the integration asset tab. If you're having trouble seeing data, check out the {link}.",values:{link:n.a.createElement(g.EuiLink,{target:"_blank",external:!0,href:e},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})))),$l={title:b.i18n.translate("xpack.fleet.createFirstPackagePolicy.installAgentStepTitle",{defaultMessage:"Install Elastic Agent"}),component:e=>{var t;const[a,i]=Object(l.useState)(e.isManaged),[s,r]=Object(l.useState)(!1),{enrolledAgentIds:o}=Object(vl.b)((null===(t=e.agentPolicy)||void 0===t?void 0:t.id)||"",{noLowerTimeLimit:!0,pollImmediately:!0}),c=()=>{e.setEnrolledAgentIds(o),e.onNext()},u={...e,onNext:c,enrolledAgentIds:o,setIsManaged:s?i:e.setIsManaged};if(a)return n.a.createElement(Sl,u);const d={...e,onNext:c,enrolledAgentIds:o,setIsManaged:e=>{e&&r(!0),i(e)}};return n.a.createElement(Tl,d)}},Ql={title:b.i18n.translate("xpack.fleet.createFirstPackagePolicy.addIntegrationStepTitle",{defaultMessage:"Add the integration"}),component:e=>{var t;const{onNext:a,onBack:i,isManaged:s,setIsManaged:r,packageInfo:o,integrationInfo:u,agentPolicy:d}=e,[m,p]=Object(l.useState)(),{notifications:E}=Object(c.sc)(),[y,h]=Object(l.useState)("VALID"),[k,v]=Object(l.useState)(),x=Object(I.o)(),[F,M]=Object(l.useState)({name:"",description:"",namespace:"",policy_id:"",policy_ids:[""],enabled:!0,inputs:[]}),S=Object(l.useCallback)((e=>{const t=Object(jl.d)({...F,...e},o,Ol.safeLoad);return v(t),console.debug("Package policy validation results",t),t}),[o,F]),O=Object(l.useCallback)((e=>{const t={...F,...e};M(t),console.debug("Package policy updated",t);const a=S(t),l=t.package,n=!!a&&Object(jl.f)(a);h(l&&!n?"VALID":"INVALID")}),[F,S]),w=Object(l.useCallback)((async({force:e=!1}={})=>{const t=!!k&&Object(jl.f)(k);if("VALID"===y&&t)return void h("INVALID");h("LOADING");const{error:l}=await(async({newPackagePolicy:e,force:t})=>{h("LOADING");const{policy:a,forceCreateNeeded:l}=await Object(Cl.a)(e),n=await Object(c.m)({...a,force:l||t});return h("SUBMITTED"),n})({newPackagePolicy:F,force:e});if(l){if(Object(wl.u)(l))return void(await x(o)?w({force:!0}):h("VALID"));E.toasts.addError(l,{title:"Error"}),h("VALID")}else a()}),[k,y,F,E.toasts,x,o,a]);Object(l.useEffect)((()=>{(async()=>{if(!d)return;const{packagePolicy:e,error:t}=await(async(e,t,a)=>{const{data:l,error:n}=await Object(c.L)({perPage:Z.Hb,page:1,kuery:`${U.w}.package.name:${t.name}`}),i={name:Object(j.E)(t.name,null==l?void 0:l.items),description:"",namespace:"",policy_id:e,policy_ids:[e],enabled:!0,inputs:[]};return{packagePolicy:Object(D.o)(t,e,i.namespace,i.name,i.description,a),error:n}})(d.id,o,null==u?void 0:u.name);t&&p(t),O(e)})()}),[]);const C=Object(c.uc)(null!==(t=o.name)&&void 0!==t?t:"","package-policy-create-multi-step"),A=Object(l.useMemo)((()=>C&&n.a.createElement(T.k,null,n.a.createElement(C.Component,null))),[C]),P=Object(l.useMemo)((()=>{if("endpoint"!==o.name)return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(Za.c,{packageInfo:o,showOnlyIntegration:null==u?void 0:u.name,packagePolicy:F,updatePackagePolicy:O,validationResults:k,submitAttempted:"INVALID"===y,noTopRule:!0}),k&&n.a.createElement(Al,null,n.a.createElement(Za.d,{packageInfo:o,packagePolicy:F,updatePackagePolicy:O,validationResults:k,submitAttempted:"INVALID"===y,noAdvancedToggle:!0})))}),[y,null==u?void 0:u.name,o,F,O,k]);return d?m?n.a.createElement(Pl,{error:m}):n.a.createElement(n.a.Fragment,null,s?null:n.a.createElement(Ll,{setIsManaged:r}),P,A,n.a.createElement(gl,null),n.a.createElement(ml,{cancelClickHandler:s?i:()=>r(!0),onNext:w,isLoading:"LOADING"===y,isDisabled:"INVALID"===y,loadingMessage:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.savingPackagePolicy",defaultMessage:"Saving policy..."}),actionMessage:s?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.confirmIncomingDataButton",defaultMessage:"Confirm incoming data"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.installAgentButton",defaultMessage:"Save and continue"})})):n.a.createElement(Pl,{error:b.i18n.translate("xpack.fleet.addIntegration.noAgentPolicy",{defaultMessage:"Error creating agent policy."})})}},Yl={title:b.i18n.translate("xpack.fleet.createFirstPackagePolicy.confirmDataStepTitle",{defaultMessage:"Confirm incoming data"}),component:e=>{const{enrolledAgentIds:t,packageInfo:a,isManaged:i}=e,s=Object(c.sc)(),[r,o]=Object(l.useState)(!1),{docLinks:u}=s,d=u.links.fleet.troubleshooting,g=n.a.createElement(n.a.Fragment,null,n.a.createElement(gl,null),n.a.createElement(El,{pkgkey:`${a.name}-${a.version}`}));return i?n.a.createElement(n.a.Fragment,null,n.a.createElement(Kl,{agentIds:t,packageInfo:a,agentDataConfirmed:r,setAgentDataConfirmed:o,troubleshootLink:d}),!!r&&g):n.a.createElement(n.a.Fragment,null,n.a.createElement(Vl,{troubleshootLink:d}),g)}},Xl=[$l,Ql,Yl],Jl=[Ql,$l,Yl],Zl=({queryParamsPolicyId:e,prerelease:t})=>{const{params:a}=Object(r.useRouteMatch)(),{pkgkey:i,policyId:s,integration:o}=a,{pkgName:u,pkgVersion:d}=Object(j.mb)(i),[g,m]=Object(l.useState)(!0),[p,E]=Object(l.useState)(0),[f,b]=Object(l.useState)(!0),{getHref:y}=Object(c.jc)(),[h,k]=Object(l.useState)([]),v=s||e,{data:x,error:F,isLoading:M}=Object(c.Zb)(u,d,{prerelease:t,full:!0}),{agentPolicy:S,enrollmentAPIKey:I,error:T,isLoading:O}=function(e){const[t,a]=Object(l.useState)({isLoading:!0});return Object(l.useEffect)((()=>{(async()=>{var t;const l=e||Qa,{data:n,error:i}=await(async e=>{var t;let a,l;try{a=await Object(Ve.M)(e),a.error&&(l=a.error)}catch(e){l=e}return l&&404!==l.statusCode?{error:l}:{data:null===(t=a)||void 0===t?void 0:t.data}})(l),s=null==n?void 0:n.item;if(e&&!s)return void a({isLoading:!1,error:new Error(`Agent policy ${l} not found`)});let r;if(i)return void a({isLoading:!1,error:i});if(!s){const{data:e,error:t}=await Xa();if(t)return void a({isLoading:!1,error:t});r=e.item}const o=s||r,{data:c,error:u}=await Object(Ve.J)({page:1,perPage:1,kuery:`policy_id:${l}`});if(u)return void a({isLoading:!1,error:u});if(!c||null===(t=c.items)||void 0===t||!t.length)return void a({isLoading:!1,error:new Error(`No enrollment API key found for policy ${l}`)});const d=c.items[0];a({isLoading:!1,created:!!r,agentPolicy:o,enrollmentAPIKey:d})})()}),[e]),t}(v),w=Object(l.useMemo)((()=>null==x?void 0:x.item),[x]),C=Object(l.useMemo)((()=>{var e;if(o)return null==w||null===(e=w.policy_templates)||void 0===e?void 0:e.find((e=>e.name===o))}),[null==w?void 0:w.policy_templates,o]),{fleetServerHost:A,fleetProxy:P,downloadSource:L,isLoadingInitialRequest:_}=Object(c.Ib)(S),D=y("add_integration_to_policy",{pkgkey:i,useMultiPageLayout:!1,...o?{integration:o}:{},...v?{agentPolicyId:v}:{}});if(g||!w)return n.a.createElement(cl,{isLoading:M||_||O,error:F||T,integrationInfo:C,packageInfo:w,cancelUrl:D,onNext:()=>{m(!1)}});const B=f?Xl:Jl;return n.a.createElement(bl,{fleetServerHost:A,fleetProxy:P,downloadSource:L,agentPolicy:S,enrollmentAPIKey:I,currentStep:p,steps:B,packageInfo:w,integrationInfo:C,cancelUrl:D,onNext:()=>{p!==B.length-1&&E(p+1)},onBack:()=>{0!==p&&E(p-1)},isManaged:f,setIsManaged:e=>{b(e),E(0)},setEnrolledAgentIds:k,enrolledAgentIds:h})},en=()=>{const{search:e}=Object(r.useLocation)(),{params:t}=Object(r.useRouteMatch)(),a=Object(l.useMemo)((()=>new URLSearchParams(e)),[e]),i=Object(l.useMemo)((()=>a.has("useMultiPageLayout")),[a]),s=Object(l.useMemo)((()=>{var e;return null!==(e=a.get("policyId"))&&void 0!==e?e:void 0}),[a]),[o,u]=n.a.useState(!1),{data:d}=Object(c.cc)();Object(l.useEffect)((()=>{const e=Boolean(null==d?void 0:d.item.prerelease_integrations_enabled);null!=d&&d.item&&u(e)}),[null==d?void 0:d.item]);const g={from:"policyId"in t||s?"policy":"package",queryParamsPolicyId:s,prerelease:o};return i?n.a.createElement(Zl,g):n.a.createElement($a.a,g)};a(8);const tn=({apiKeyId:e,length:t,sendGetAPIKey:a,tokenGetter:i})=>{const{euiTheme:s}=Object(g.useEuiTheme)(),{notifications:r}=Object(Ve.Xc)(),[o,c]=Object(l.useState)("HIDDEN"),[u,d]=Object(l.useState)(),m=Object(l.useMemo)((()=>"•".repeat(t)),[t]);return n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(an,{color:"subdued",size:"xs","data-test-subj":"apiKeyField",$_css:s.font.familyCode},"VISIBLE"===o?u:m)),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiToolTip,{content:"VISIBLE"===o?b.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):b.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},n.a.createElement(g.EuiButtonIcon,{"aria-label":"VISIBLE"===o?b.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):b.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===o)c("HIDDEN");else if("HIDDEN"===o)try{c("LOADING");const t=await a(e);if(t.error)throw t.error;d(i(t)),c("VISIBLE")}catch(e){r.toasts.addError(e,{title:"Error"}),c("HIDDEN")}},iconType:"VISIBLE"===o?"eyeClosed":"eye","data-test-subj":"showHideTokenButton"}))))};var an=L()(g.EuiText).withConfig({displayName:"_StyledEuiText",componentId:"sc-hm2aoi-0"})(["font-family:",";"],(e=>e.$_css)),ln=a(218);const nn=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:l}=e;return n.a.createElement(g.EuiConfirmModal,{title:b.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:b.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},n.a.createElement(g.EuiCallOut,{title:b.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are you sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:l.name}}),color:"danger"}))},sn=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(c.sc)(),[i,s]=Object(l.useState)("CONFIRM_HIDDEN");return n.a.createElement(n.a.Fragment,null,"CONFIRM_VISIBLE"===i&&n.a.createElement(nn,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(c.r)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),n.a.createElement(g.EuiToolTip,{content:b.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},n.a.createElement(g.EuiButtonIcon,{"data-test-subj":"enrollmentTokenTable.revokeBtn","aria-label":b.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},rn=()=>{var e,t,a;Object(c.zb)("enrollment_tokens");const[i,s]=Object(l.useState)(!1),[r,o]=Object(l.useState)(""),{pagination:u,setPagination:d,pageSizeOptions:m}=Object(c.mc)(),p=Object(c.Rb)({page:u.currentPage,perPage:u.pageSize,kuery:""!==r.trim()?r:void 0}),E=Object(c.Mb)({page:1,perPage:O.t}),y=E.data?E.data.items:[],h=y.reduce(((e,t)=>(e[t.id]=t,e)),{}),k=null!==(e=null==p||null===(t=p.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,v=(null==p||null===(a=p.data)||void 0===a?void 0:a.items.filter((e=>{if(!y.length||!e.policy_id)return!1;const t=h[e.policy_id];return!(null!=t&&t.is_managed)})))||[],x=v.length,F=[{field:"name",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>n.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>n.a.createElement(tn,{apiKeyId:e,sendGetAPIKey:c.G,tokenGetter:e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.item.api_key},length:60})},{field:"policy_id",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=h[e],a=t?t.name:e;return n.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?n.a.createElement(f.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>n.a.createElement(g.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:b.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=y.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&n.a.createElement(sn,{apiKey:t,refresh:()=>p.resendRequest()})}}],M=p.isLoading&&p.isInitialRequest||E.isLoading&&E.isInitialRequest;return n.a.createElement(w.a,{section:"enrollment_tokens"},i&&n.a.createElement(T.q,{agentPolicies:y,onClose:e=>{s(!1),p.resendRequest()}}),n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(ln.a,{value:r,indexPattern:O.g,fieldPrefix:O.j,onChange:e=>{d({...u,currentPage:1}),o(e)},dataTestSubj:"enrollmentKeysList.queryInput"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{"data-test-subj":"createEnrollmentTokenButton",fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiBasicTable,{"data-test-subj":"enrollmentTokenListTable",loading:M,noItemsMessage:M?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:k?v:[],itemId:"id",columns:F,pagination:{pageIndex:u.currentPage-1,pageSize:u.pageSize,totalItemCount:x,pageSizeOptions:m},onChange:({page:e})=>{const t={...u,currentPage:e.index+1,pageSize:e.size};d(t)}}))};var on=a(341),cn=a(340);const un=b.i18n.translate("xpack.fleet.uninstallTokenList.policyIdTitle",{defaultMessage:"Policy ID"}),dn=b.i18n.translate("xpack.fleet.uninstallTokenList.policyNameTitle",{defaultMessage:"Policy name"}),gn=b.i18n.translate("xpack.fleet.uninstallTokenList.createdAtTitle",{defaultMessage:"Created at"}),mn=b.i18n.translate("xpack.fleet.uninstallTokenList.tokenTitle",{defaultMessage:"Token"}),pn=b.i18n.translate("xpack.fleet.uninstallTokenList.actionsTitle",{defaultMessage:"Actions"}),En=b.i18n.translate("xpack.fleet.uninstallTokenList.viewUninstallCommandLabel",{defaultMessage:"View uninstall command"}),fn=b.i18n.translate("xpack.fleet.uninstallTokenList.searchByPolicyIdOrNamePlaceholder",{defaultMessage:"Search by policy ID or policy name"}),bn=b.i18n.translate("xpack.fleet.uninstallTokenList.searchByPolicyIdOrNameHint",{defaultMessage:"If an Agent policy is deleted, its policy name is also deleted. Use the policy ID to search for uninstall tokens related to deleted Agent policies."}),yn=({text:e,dataTestSubj:t})=>n.a.createElement(g.EuiText,{size:"s",className:"eui-textTruncate",title:e,"data-test-subj":t},e),hn=({onClick:e})=>n.a.createElement(g.EuiToolTip,{content:En},n.a.createElement(g.EuiButtonIcon,{"data-test-subj":"uninstallTokensViewCommandButton","aria-label":En,onClick:e,iconType:"inspect",color:"text"})),kn=({isLoading:e})=>e?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.loadingTokensMessage",defaultMessage:"Loading uninstall tokens..."}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.emptyMessage",defaultMessage:"No uninstall tokens found."}),vn=()=>{var e,t;Object(c.zb)("uninstall_tokens");const[a,i]=Object(l.useState)(""),[s,r]=Object(l.useState)(null),{pagination:o,setPagination:u,pageSizeOptions:d}=Object(c.mc)(),{isLoading:m,data:p}=Object(cn.c)({perPage:o.pageSize,page:o.currentPage,search:a}),E=null!==(e=null==p?void 0:p.items)&&void 0!==e?e:[],b=null!==(t=null==p?void 0:p.total)&&void 0!==t?t:0,y=Object(l.useMemo)((()=>[{field:"policy_name",name:dn,render:e=>null===e?n.a.createElement(on.a,null):n.a.createElement(yn,{text:e})},{field:"policy_id",name:un,render:e=>n.a.createElement(yn,{text:e,dataTestSubj:"uninstallTokensPolicyIdField"})},{field:"created_at",name:gn,width:"130px",render:e=>e?n.a.createElement(f.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"id",name:mn,width:"300px",render:e=>n.a.createElement(tn,{apiKeyId:e,sendGetAPIKey:cn.a,tokenGetter:e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.item.token},length:32})},{field:"actions",name:pn,align:"center",width:"70px",render:(e,{id:t})=>n.a.createElement(hn,{onClick:()=>r(t)})}]),[]),h=Object(l.useCallback)((({page:e})=>{u((t=>({...t,currentPage:e.index+1,pageSize:e.size})))}),[u]),k=Object(l.useCallback)((e=>{i(e),u((e=>({...e,currentPage:1})))}),[u]);return n.a.createElement(w.a,{section:"uninstall_tokens"},s&&n.a.createElement(T.w,{onClose:()=>r(null),target:"agent",uninstallTokenId:s}),n.a.createElement(g.EuiText,{color:"subdued",size:"s"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.pageDescription",defaultMessage:"An uninstall token allows you to use the uninstall command to remove Elastic Agent from a host."})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{direction:"row",alignItems:"center"},n.a.createElement(g.EuiFieldSearch,{onSearch:k,incremental:!0,fullWidth:!0,maxLength:50,placeholder:fn,"data-test-subj":"uninstallTokensPolicyIdSearchInput"}),n.a.createElement(g.EuiToolTip,{content:bn},n.a.createElement(g.EuiIcon,{type:"iInCircle"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiBasicTable,{"data-test-subj":"uninstallTokenListTable",items:E,columns:y,itemId:"id",loading:m,pagination:{pageIndex:o.currentPage-1,pageSize:o.pageSize,totalItemCount:b,pageSizeOptions:d},onChange:h,noItemsMessage:n.a.createElement(kn,{isLoading:m})}),n.a.createElement(g.EuiSpacer,{size:"xl"}))},xn=L()(g.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-1t6qzy1-0"})(["max-width:250px;"]),Fn=L()(g.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-1t6qzy1-1"})(["min-width:0px;"]),Mn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{const a=Object(c.yb)(),{getHref:i}=Object(c.jc)(),s=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(xn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{content:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.managedTooltip",{defaultMessage:"This Fleet server host is managed outside of Fleet. Please refer to your kibana config file for more info."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,field:"host_urls",render:e=>n.a.createElement(Fn,{direction:"column",gutterSize:"xs"},e.map((e=>n.a.createElement(g.EuiFlexItem,{key:e},n.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.hostUrlsColumnTitle",{defaultMessage:"Host URLs"})},{render:e=>e.is_default?n.a.createElement(g.EuiIcon,{type:"check","data-test-subj":"fleetServerHostTable.defaultIcon"}):null,width:"200px",name:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default&&!e.is_preconfigured&&a.fleet.allSettings;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},l&&n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"fleetServerHostsTable.delete.btn"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"pencil",href:i("settings_edit_fleet_server_hosts",{itemId:e.id}),title:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"fleetServerHostsTable.edit.btn"})))},name:b.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.actionsColumnTitle",{defaultMessage:"Actions"})}]),[i,t,a.fleet.allSettings]);return n.a.createElement(g.EuiBasicTable,{columns:s,items:e,"data-test-subj":"settingsFleetServerHostsTable"})},Sn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{const a=Object(c.yb)(),{docLinks:l}=Object(c.sc)(),{getHref:i}=Object(c.jc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h4",{"data-test-subj":"fleetServerHostHeader"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionTitle",defaultMessage:"Fleet server hosts"}))),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(g.EuiText,{color:"subdued",size:"m"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionSubtitle",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet will show the first provided URL for enrollment purposes. For more information, see the {guideLink} .",values:{guideLink:n.a.createElement(g.EuiLink,{href:l.links.fleet.guide,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetUserGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Mn,{fleetServerHosts:e,deleteFleetServerHost:t}),a.fleet.allSettings&&a.fleet.allAgents?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiButtonEmpty,{iconType:"plusInCircle",href:i("settings_create_fleet_server_hosts"),"data-test-subj":"settings.fleetServerHosts.addFleetServerHostBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostCreateButtonLabel",defaultMessage:"Add Fleet Server"}))):null,n.a.createElement(g.EuiSpacer,{size:"m"}))},In=({output:e,showBadge:t})=>{var a,i;const{notifications:s}=Object(c.sc)(),[r,o]=Object(l.useState)(),{data:u}=Object(k.useQuery)(["outputHealth",e.id],(()=>Object(c.J)(e.id)),{refetchInterval:1e4});Object(l.useEffect)((()=>{null!=u&&u.error&&s.toasts.addError(null==u?void 0:u.error,{title:b.i18n.translate("xpack.fleet.output.errorFetchingOutputHealth",{defaultMessage:"Error fetching output state"})}),o(null==u?void 0:u.data)}),[u,s.toasts]);const d={DEGRADED:n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger",iconType:"error","data-test-subj":"outputHealthDegradedCallout"},n.a.createElement("p",{className:"eui-textBreakWord"},b.i18n.translate("xpack.fleet.output.calloutText",{defaultMessage:'Unable to connect to "{name}" at {host}.',values:{name:e.name,host:null!==(a=null===(i=e.hosts)||void 0===i?void 0:i.join(","))&&void 0!==a?a:""}})),n.a.createElement("p",null,b.i18n.translate("xpack.fleet.output.calloutPromptText",{defaultMessage:"Please check the details are correct."}))),HEALTHY:n.a.createElement(g.EuiCallOut,{title:"Healthy",color:"success",iconType:"check","data-test-subj":"outputHealthHealthyCallout"},n.a.createElement("p",null,b.i18n.translate("xpack.fleet.output.successCalloutText",{defaultMessage:"Connection with remote output established."})))},m={DEGRADED:n.a.createElement(g.EuiBadge,{color:"danger","data-test-subj":"outputHealthDegradedBadge"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputHealth.degradedStatusText",defaultMessage:"Unhealthy"})),HEALTHY:n.a.createElement(g.EuiBadge,{color:"success","data-test-subj":"outputHealthHealthyBadge"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputHealth.healthyStatusText",defaultMessage:"Healthy"}))},p=new Date((null==r?void 0:r.timestamp)||0).getTime(),E=p?n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputHealth.timestampTooltipText",defaultMessage:"Last reported {timestamp}",values:{timestamp:n.a.createElement(f.FormattedRelative,{value:p})}})):null,y=(null==r?void 0:r.state)&&m[null==r?void 0:r.state]||null;return t?E&&null!=r&&r.state?n.a.createElement(g.EuiToolTip,{position:"top",content:E,"data-test-subj":"outputHealthBadgeTooltip"},n.a.createElement(n.a.Fragment,null,y," ")):y:(null==r?void 0:r.state)&&d[r.state]||null},Tn=n.a.memo((({output:e})=>{const t=Object(l.useMemo)((()=>{const t=[];return e.is_default&&t.push(n.a.createElement(On,{key:"default-output"})),e.is_default_monitoring&&t.push(n.a.createElement(wn,{key:"default-monitoring-output"})),t}),[e]);return n.a.createElement(g.EuiBadgeGroup,{gutterSize:"xs"},t.map(((e,t)=>e)))})),On=()=>n.a.createElement(g.EuiBadge,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultOutputBadgeTitle",defaultMessage:"Agent integrations"})),wn=()=>n.a.createElement(g.EuiBadge,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultMonitoringOutputBadgeTitle",defaultMessage:"Agent monitoring"})),jn=L()(g.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-uvxtm0-0"})(["max-width:250px;"]),Cn=L()(g.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-uvxtm0-1"})(["min-width:0px;"]),An=({outputs:e,deleteOutput:t})=>{const a=Object(c.yb)(),{getHref:i}=Object(c.jc)(),s=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(jn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{content:b.i18n.translate("xpack.fleet.settings.outputsTable.managedTooltip",{defaultMessage:"This output is managed outside of Fleet."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:b.i18n.translate("xpack.fleet.settings.outputsTable.nameColumnTitle",{defaultMessage:"Name"})},{width:"172px",render:e=>function(e){switch(e){case"elasticsearch":return b.i18n.translate("xpack.fleet.settings.outputsTable.elasticsearchTypeLabel",{defaultMessage:"Elasticsearch"});case"remote_elasticsearch":return b.i18n.translate("xpack.fleet.settings.outputsTable.remoteElasticsearchTypeLabel",{defaultMessage:"Remote Elasticsearch"});default:return e}}(e.type),name:b.i18n.translate("xpack.fleet.settings.outputsTable.typeColumnTitle",{defaultMessage:"Type"})},{truncateText:!0,render:e=>n.a.createElement(Cn,{direction:"column",gutterSize:"xs"},(e.hosts||[]).map((e=>n.a.createElement(g.EuiFlexItem,{key:e},n.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:b.i18n.translate("xpack.fleet.settings.outputsTable.hostColumnTitle",{defaultMessage:"Hosts"})},{render:e=>null!=e&&e.id&&"remote_elasticsearch"===e.type?n.a.createElement(In,{output:e,showBadge:!0}):null,name:b.i18n.translate("xpack.fleet.settings.outputsTable.statusColumnTitle",{defaultMessage:"Status"})},{render:e=>n.a.createElement(Tn,{output:e}),width:"200px",name:b.i18n.translate("xpack.fleet.settings.outputSection.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default&&!e.is_default_monitoring&&!e.is_preconfigured&&a.fleet.allSettings;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},l&&n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:b.i18n.translate("xpack.fleet.settings.outputSection.deleteButtonTitle",{defaultMessage:"Delete"})})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"pencil",href:i("settings_edit_outputs",{outputId:e.id}),title:b.i18n.translate("xpack.fleet.settings.outputSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editOutputBtn"})))},name:b.i18n.translate("xpack.fleet.settings.outputSection.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,i,a.fleet.allSettings]);return n.a.createElement(g.EuiBasicTable,{columns:s,items:e,"data-test-subj":"settingsOutputsTable"})},Pn=({outputs:e,deleteOutput:t})=>{const a=Object(c.yb)(),{getHref:l}=Object(c.jc)(),{docLinks:i}=Object(c.sc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.outputSectionTitle",defaultMessage:"Outputs"}))),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(g.EuiText,{color:"subdued",size:"m"},n.a.createElement(g.EuiLink,{href:i.links.fleet.settings,external:!0,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.outputSectionSubtitle",defaultMessage:"Specify where agents will send data."}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(An,{outputs:e,deleteOutput:t}),a.fleet.allSettings&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiButtonEmpty,{iconType:"plusInCircle",href:l("settings_create_outputs"),"data-test-subj":"addOutputBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.outputCreateButtonLabel",defaultMessage:"Add output"}))))},Ln=L()(g.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-xsf6c1-0"})(["max-width:250px;"]),_n=L()(g.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-xsf6c1-1"})(["min-width:0px;"]),Dn=({downloadSources:e,deleteDownloadSource:t,hasAllSettingsPrivileges:a})=>{const{getHref:i}=Object(c.jc)(),s=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Ln,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.name"},e.name))),width:"288px",name:b.i18n.translate("xpack.fleet.settings.downloadSourcesTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,render:e=>n.a.createElement(_n,{direction:"column",gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,{key:e.host},n.a.createElement("p",{title:e.host,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.host"},e.host))),name:b.i18n.translate("xpack.fleet.settings.downloadSourcesTable.hostColumnTitle",{defaultMessage:"Host"})},{render:e=>e.is_default?n.a.createElement(g.EuiIcon,{type:"check","data-test-subj":"editDownloadSourceTable.defaultIcon"}):null,width:"200px",name:b.i18n.translate("xpack.fleet.settings.downloadSourcesTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default&&a;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},l&&n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:b.i18n.translate("xpack.fleet.settings.downloadSourceSection.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"editDownloadSourceTable.delete.btn"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"pencil",href:i("settings_edit_download_sources",{downloadSourceId:e.id}),title:b.i18n.translate("xpack.fleet.settings.downloadSourceSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editDownloadSourceTable.edit.btn"})))},name:b.i18n.translate("xpack.fleet.settings.downloadSourceSection.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,i,a]);return n.a.createElement(g.EuiBasicTable,{columns:s,items:e,"data-test-subj":"AgentDownloadSourcesTable"})},Bn=({downloadSources:e,deleteDownloadSource:t})=>{const{getHref:a}=Object(c.jc)(),l=Object(c.yb)().fleet.allSettings;return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Title",defaultMessage:"Agent Binary Download"}))),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(g.EuiText,{color:"subdued",size:"m"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Subtitle",defaultMessage:"Specify where the agents will download their binary from. Checked default will apply to all policies unless overwritten."})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Dn,{downloadSources:e,deleteDownloadSource:t,hasAllSettingsPrivileges:l}),l&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_download_sources"),"data-test-subj":"addDownloadSourcesBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.CreateButtonLabel",defaultMessage:"Add agent binary source"}))))},Rn=L()(g.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-czjc9c-0"})(["max-width:250px;"]),zn=({proxies:e,deleteFleetProxy:t})=>{const a=Object(c.yb)(),{getHref:i}=Object(c.jc)(),s=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(g.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Rn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate","data-test-subj":"fleetProxiesTable.name"},e.name)),e.is_preconfigured&&n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiIconTip,{content:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.managedTooltip",{defaultMessage:"This proxy is managed outside of Fleet. Please refer to your kibana config file for more info."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,field:"url",name:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.urlColumnTitle",{defaultMessage:"Url"})},{width:"68px",render:e=>{const l=a.fleet.allSettings&&!e.is_preconfigured;return n.a.createElement(g.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(g.EuiFlexItem,{grow:!1},l&&n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"fleetProxiesTable.delete.btn"})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonIcon,{color:"text",iconType:"pencil",href:i("settings_edit_fleet_proxy",{itemId:e.id}),title:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"fleetProxiesTable.edit.btn"})))},name:b.i18n.translate("xpack.fleet.settings.fleetProxiesTable.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,i,a.fleet.allSettings]);return n.a.createElement(g.EuiBasicTable,{columns:s,items:e,"data-test-subj":"fleetProxiesTable"})},Nn=({proxies:e,deleteFleetProxy:t})=>{const a=Object(c.yb)(),{getHref:l}=Object(c.jc)(),{docLinks:i}=Object(c.sc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFlexGroup,{gutterSize:"xs"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.title",defaultMessage:"Proxies"}))))),n.a.createElement(g.EuiText,{color:"subdued",size:"m"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.subtitle",defaultMessage:"Specify any proxy URLs to be used in Fleet servers, Outputs or Agent binary download sources. For more information see our {docLink}.",values:{docLink:n.a.createElement(g.EuiLink,{target:"_blank",external:!0,href:i.links.fleet.proxiesSettings},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.link",defaultMessage:"docs"}))}})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(zn,{proxies:e,deleteFleetProxy:t}),a.fleet.allSettings&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiButtonEmpty,{iconType:"plusInCircle",href:l("settings_create_fleet_proxy"),"data-test-subj":"addProxyBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.CreateButtonLabel",defaultMessage:"Add proxy"}))))},Hn=({outputs:e,proxies:t,fleetServerHosts:a,deleteOutput:l,deleteFleetServerHost:i,downloadSources:s,deleteDownloadSource:r,deleteFleetProxy:o})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Sn,{fleetServerHosts:a,deleteFleetServerHost:i}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Pn,{outputs:e,deleteOutput:l}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Bn,{downloadSources:s,deleteDownloadSource:r}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Nn,{proxies:t,deleteFleetProxy:o}));var Un=a(148),qn=a(151);const Gn=({label:e,inputProps:t,placeholder:a,dataTestSubj:l})=>n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:e},t.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":l,fullWidth:!0},t.props,{placeholder:a}))),Wn=({label:e,inputProps:t,placeholder:a,dataTestSubj:l})=>n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:e},t.formRowProps),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5,"data-test-subj":l},t.props,{placeholder:a}))),Kn=()=>n.a.createElement(g.EuiCallOut,{iconType:"warning",color:"warning",size:"s",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.proxyWarning.warningTitle",defaultMessage:"Be aware that changing the proxy settings may cause Elastic Agents to lose connectivity. Please ensure that agents have reachability to the proxy in the context that it is being used for."})});var Vn=a(288);const $n=({onClose:e,fleetServerHost:t,defaultFleetServerHost:a,proxies:i})=>{const{docLinks:s,cloud:r}=Object(c.sc)(),o=Object(Vn.a)(t,e,a),{inputs:u}=o,m=Object(l.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]);return n.a.createElement(g.EuiFlyout,{onClose:e,maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,t?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.editTitle",defaultMessage:"Edit Fleet Server"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.addTitle",defaultMessage:"Add Fleet Server"}))),!t&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,{color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.serverlessInfoText",defaultMessage:"You may create another Fleet Server definition reachable via a proxy. In context of the serverless project, Fleet Service is managed by Elastic. Creation of a new one is therefore not permitted."}))))),n.a.createElement(g.EuiFlyoutBody,null,t&&n.a.createElement(g.EuiCallOut,{size:"m",color:"warning",iconType:"warning",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.warningCalloutTitle",defaultMessage:"Changing these settings can break your agent connections"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.warningCalloutDescription",defaultMessage:"Invalid settings can break the connection between Elastic Agent and Fleet Server. If this happens, you will need to re-enroll your agents."})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiForm,{onSubmit:o.submit},n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.nameInputLabel",defaultMessage:"Name"}),inputProps:u.nameInput,dataTestSubj:"fleetServerHostsFlyout.nameInput",placeholder:b.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.hostUrlLabel",defaultMessage:"URL"})},n.a.createElement(n.a.Fragment,null,!(null!=r&&r.isServerlessEnabled)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{color:"subdued",size:"relative"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.description",defaultMessage:"Specify multiple URLs to scale out your deployment and provide automatic failover. If multiple URLs exist, Fleet shows the first provided URL for enrollment purposes. Enrolled Elastic Agents will connect to the URLs in round robin order until they connect successfully. For more information, see the {link} .",values:{link:n.a.createElement(g.EuiLink,{href:s.links.fleet.settingsFleetServerHostSettings,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.userGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),n.a.createElement(g.EuiSpacer,{size:"m"})),n.a.createElement(qn.a,d()({},u.hostUrlsInput.props,{id:"fleet-server-inputs",placeholder:b.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.fleetServerHostsInputPlaceholder",{defaultMessage:"Specify host URL"}),isUrl:!0,helpText:(null==r?void 0:r.isServerlessEnabled)&&n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.serverlessHostUrlsHelpText",defaultMessage:"Custom host URLs are not allowed in serverless."})})))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.proxyIdLabel",defaultMessage:"Proxy"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiComboBox,d()({fullWidth:!0,"data-test-subj":"fleetServerHostsFlyout.proxyIdInput"},u.proxyIdInput.props,{onChange:e=>{var t,a;return u.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==u.proxyIdInput.value?m.filter((e=>e.value===u.proxyIdInput.value)):[],options:m,singleSelection:{asPlainText:!0},isDisabled:u.proxyIdInput.props.disabled,isClearable:!0,placeholder:b.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})})),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(Kn,null))),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},u.isDefaultInput.formRowProps),n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"fleetServerHostsFlyout.isDefaultSwitch"},u.isDefaultInput.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this Fleet server the default one."})}))))),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,isLoading:o.isLoading,isDisabled:o.isDisabled,onClick:o.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},Qn=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetProxy.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),Yn=({})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetProxy.confirmModalText",defaultMessage:"This action will change agent policies currently using that proxy. Are you sure you wish to continue?"});async function Xn(e){var t,a,l;let n=`${O.e}.data_output_id:"${e.id}" or ${O.e}.monitoring_output_id:"${e.id}"`;e.is_default&&(n+=` or (not ${O.e}.data_output_id:*)`);const i=await Object(c.w)({kuery:n,page:1,perPage:O.t});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(l=a.items)||void 0===l?void 0:l.length)&&void 0!==t?t:0;let r=0;if(s>0){var o,u,d;const e=await Object(c.A)({page:1,perPage:0,showInactive:!1,kuery:null===(o=i.data)||void 0===o?void 0:o.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const Jn=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),Zn=({output:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalText",defaultMessage:"This action will delete {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),ei=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),ti=({})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalText",defaultMessage:"This action will change agent policies currently enrolled in this Fleet Server, to instead enroll in your default Fleet server. Are you sure you wish to continue?"});async function ai(e){var t,a,l;let n=`${O.e}.download_source_id:"${e.id}"`;e.is_default&&(n+=` or (not ${O.e}.download_source_id:*)`);const i=await Object(c.w)({kuery:n,page:1,perPage:O.t});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(l=a.items)||void 0===l?void 0:l.length)&&void 0!==t?t:0;let r=0;if(s>0){var o,u,d;const e=await Object(c.A)({page:1,perPage:0,showInactive:!1,kuery:null===(o=i.data)||void 0===o?void 0:o.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const li=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalText","data-test-subj":"editDownloadSourcesConfirmModal.confirmModalText",defaultMessage:"This action will update {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});function ni(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function ii(e){try{if(!e)return[b.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.HostIsRequiredErrorMessage",{defaultMessage:"Host is required"})];const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){return[b.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.hostError",{defaultMessage:"Invalid URL"})]}}const si=({onClose:e,downloadSource:t,proxies:a})=>{Object(c.zb)("settings");const i=function(e,t){var a,i,s,r;const o=Object(c.yb)(),[u,d]=Object(l.useState)(!1),{notifications:g}=Object(c.sc)(),{confirm:m}=Object(Un.a)(),p=!o.fleet.allSettings,E=Object(c.dc)(null!==(a=null==t?void 0:t.name)&&void 0!==a?a:"",ni,p),y=Object(c.tc)(null!==(i=null==t?void 0:t.is_default)&&void 0!==i&&i,(null==t?void 0:t.is_default)||p),h=Object(c.dc)(null!==(s=null==t?void 0:t.host)&&void 0!==s?s:"",ii,p),k=Object(c.dc)(null!==(r=null==t?void 0:t.proxy_id)&&void 0!==r?r:"",(()=>{}),p),v={nameInput:E,hostInput:h,defaultDownloadSourceInput:y,proxyIdInput:k},x=Object.values(v).some((e=>e.hasChanged)),F=Object(l.useCallback)((()=>{const e=E.validate(),t=h.validate();return e&&t}),[E,h]),M=Object(l.useCallback)((async()=>{try{if(!F())return;d(!0);const a={name:E.value.trim(),host:h.value.trim(),is_default:y.value,proxy_id:k.value||null};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:l}=await ai(e);return t(n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),n.a.createElement(li,{agentCount:a,agentPolicyCount:l,downloadSource:e}))}(t,m))return void d(!1);const e=await Object(c.jb)(t.id,a);if(e.error)throw e.error}else{const e=await Object(c.ab)(a);if(e.error)throw e.error}e(),d(!1)}catch(e){d(!1),g.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.errorToastTitle",{defaultMessage:"Error while saving binary source"})})}}),[m,y.value,t,h.value,E.value,g.toasts,e,k.value,F]);return{inputs:v,submit:M,isLoading:u,isDisabled:u||t&&!x||p}}(e,t),s=i.inputs,{docLinks:r}=Object(c.sc)(),o=Object(l.useMemo)((()=>a.map((e=>({value:e.id,label:e.name})))),[a]);return n.a.createElement(g.EuiFlyout,{onClose:e,maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"FleetEditDownloadSourcesFlyoutTitle"},t?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.editTitle",defaultMessage:"Edit agent binary source","data-test-subj":"editDownloadSourcesFlyout.edit.title"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.createTitle",defaultMessage:"Add new agent binary source","data-test-subj":"editDownloadSourcesFlyout.add.title"})))),n.a.createElement(g.EuiFlyoutBody,null,n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.nameInputLabel",defaultMessage:"Name"})},s.nameInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"editDownloadSourcesFlyout.nameInput",fullWidth:!0},s.nameInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,helpText:n.a.createElement(f.FormattedMessage,{"data-test-subj":"editDownloadSourcesFlyout.hostHelpText",id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputDescription",defaultMessage:"Address that your agents will use to download their binary from. Specify the path to the directory containing the binary. {guideLink}",values:{guideLink:n.a.createElement(g.EuiLink,{href:r.links.fleet.settings,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostInputLabel",defaultMessage:"Host"})},s.hostInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"editDownloadSourcesFlyout.hostInput",fullWidth:!0},s.hostInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputPlaceholder",{defaultMessage:"Specify host"})}))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.proxyIdLabel",defaultMessage:"Proxy"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.proxyInputDescription",defaultMessage:"Proxy used for accessing the download source. Currently only the proxy URL is used, headers and certificates are not supported."})},n.a.createElement(g.EuiComboBox,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.proxyIdInput"},s.proxyIdInput.props,{onChange:e=>{var t,a;return s.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==s.proxyIdInput.value?o.filter((e=>e.value===s.proxyIdInput.value)):[],options:o,singleSelection:{asPlainText:!0},isDisabled:s.proxyIdInput.props.disabled,isClearable:!0,placeholder:b.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})}))),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(Kn,null),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},s.defaultDownloadSourceInput.formRowProps),n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"editDownloadSourcesFlyout.isDefaultSwitch"},s.defaultDownloadSourceInput.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.defaultSwitchLabel",defaultMessage:"Make this host the default for all agent policies."})}))))),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:e,flush:"left","data-test-subj":"editDownloadSourcesFlyout.cancelBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,isLoading:i.isLoading,isDisabled:i.isDisabled,onClick:i.submit,"data-test-subj":"editDownloadSourcesFlyout.submitBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},ri=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),oi=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalText",defaultMessage:"This action will delete {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),ci=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),ui=({})=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.confirmModalText",defaultMessage:"This action will update agent policies using that proxies. This action can not be undone. Are you sure you wish to continue?"});function di(e){return e&&""!==e?e.match(Z.Ab)?void 0:[b.i18n.translate("xpack.fleet.settings.fleetProxyFlyoutUrlError",{defaultMessage:"Invalid URL"})]:[b.i18n.translate("xpack.fleet.settings.fleetProxyFlyoutUrlRequired",{defaultMessage:"URL is required"})]}function gi(e){if(e&&""!==e){const t=Object(Ol.safeLoad)(e);if("object"!=typeof t||Object.values(t).some((e=>{const t=typeof e;return"string"!==t&&"number"!==t&&"boolean"!==t})))return[b.i18n.translate("xpack.fleet.settings.fleetProxy.proxyHeadersErrorMessage",{defaultMessage:"Proxy headers is not a valid key: value object."})]}}function mi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.fleetProxy.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}const pi=({onClose:e,fleetProxy:t})=>{const a=function(e,t){var a,i,s,r,o,u;const[d,g]=Object(l.useState)(!1),m=Object(c.yb)(),{notifications:p}=Object(c.sc)(),{confirm:E}=Object(Un.a)(),f=null!==(a=!m.fleet.allSettings||(null==e?void 0:e.is_preconfigured))&&void 0!==a&&a,y=Object(c.dc)(null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"",mi,f),h=Object(c.dc)(null!==(s=null==e?void 0:e.url)&&void 0!==s?s:"",di,f),k=Object(c.dc)(null!=e&&e.proxy_headers?Object(Ol.safeDump)(e.proxy_headers):"",gi,f),v=Object(c.dc)(null!==(r=null==e?void 0:e.certificate_authorities)&&void 0!==r?r:"",(()=>{}),f),x=Object(c.dc)(null!==(o=null==e?void 0:e.certificate)&&void 0!==o?o:"",(()=>{}),f),F=Object(c.dc)(null!==(u=null==e?void 0:e.certificate_key)&&void 0!==u?u:"",(()=>{}),f),M=Object(l.useMemo)((()=>({nameInput:y,urlInput:h,proxyHeadersInput:k,certificateAuthoritiesInput:v,certificateInput:x,certificateKeyInput:F})),[y,h,k,v,x,F]),S=Object(l.useCallback)((()=>Object(c.wc)(M)),[M]),I=Object(l.useCallback)((async()=>{try{if(!S())return;if(e&&!await E(n.a.createElement(ci,null),n.a.createElement(ui,null)))return;g(!0);const a={name:y.value,url:h.value,proxy_headers:""===k.value?void 0:Object(Ol.safeLoad)(k.value),certificate_authorities:v.value,certificate:x.value,certificate_key:F.value};if(e){const t=await Object(c.kb)(e.id,a);if(t.error)throw t.error}else{const e=await Object(c.bb)(a);if(e.error)throw e.error}p.toasts.addSuccess(b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.successToastTitle",{defaultMessage:"Fleet proxy saved"})),g(!1),await t()}catch(e){g(!1),p.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.errorToastTitle",{defaultMessage:"An error happened while saving Fleet Server host"})})}}),[e,y.value,h.value,k.value,v.value,x.value,F.value,S,p,E,t]),T=Object.values(M).some((e=>e.hasChanged));return{isLoading:d,isDisabled:d||!T||y.props.isInvalid||h.props.isInvalid,submit:I,inputs:M}}(t,e),{inputs:i}=a;return n.a.createElement(g.EuiFlyout,{onClose:e,maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",null,t?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.editTitle",defaultMessage:"Edit Proxy"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.addTitle",defaultMessage:"Add Proxy"})))),n.a.createElement(g.EuiFlyoutBody,null,n.a.createElement(Kn,null),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiForm,{onSubmit:a.submit},n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.nameInputLabel",defaultMessage:"Name"}),inputProps:i.nameInput,"data-test-subj":"fleetProxyFlyout.nameInput",placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}),n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.urlInputLabel",defaultMessage:"Proxy Url"}),dataTestSubj:"fleetProxyFlyout.urlInput",inputProps:i.urlInput,placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.urlInputPlaceholder",{defaultMessage:"Specify proxy url"})}),n.a.createElement(Wn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.proxyHeadersLabel",defaultMessage:"Proxy headers"}),dataTestSubj:"fleetProxyFlyout.proxyHeadersInput",inputProps:i.proxyHeadersInput,placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.proxyHeadersPlaceholder",{defaultMessage:"Specify proxy headers"})}),n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateAuthoritiesLabel",defaultMessage:"Certificate authorities"}),dataTestSubj:"fleetProxyFlyout.certificateAuthoritiesInput",inputProps:i.certificateAuthoritiesInput,placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificateAuthoritiesPlaceholder",{defaultMessage:"Specify certificate authorities"})}),n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateLabel",defaultMessage:"Certificate"}),dataTestSubj:"fleetProxyFlyout.certificateInput",inputProps:i.certificateInput,placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificatePlaceholder",{defaultMessage:"Specify certificate"})}),n.a.createElement(Gn,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateKeyLabel",defaultMessage:"Certificate key"}),dataTestSubj:"fleetProxyFlyout.certificateKeyInput",inputProps:i.certificateKeyInput,placeholder:b.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificateKeyPlaceholder",{defaultMessage:"Specify certificate key"})}))),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))};var Ei=a(66);const fi=({inputs:e})=>n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaTopicsPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaHeaders"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopcisTitle",defaultMessage:"Topics"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopicsDefaultTopicLabel",defaultMessage:"Default topic"})},e.kafkaDefaultTopicInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaDefaultTopicInput",fullWidth:!0},e.kafkaDefaultTopicInput.props))),n.a.createElement(g.EuiSpacer,{size:"m"})),bi=e=>{const{inputs:t}=e,{props:{onChange:a},value:i,formRowProps:{error:s}}=t.kafkaHeadersInput,[r,o]=Object(l.useState)(!1),c=Object(l.useCallback)(((e,t,l)=>{const n=i.map(((a,n)=>n===e?{...a,[t]:l}:a));a(n)}),[i,a]),u=Object(l.useCallback)((()=>{o(!0);const e=[...i,{key:"",value:""}];a(e)}),[i,a]),m=Object(l.useCallback)((e=>{const t=i.filter(((t,a)=>a!==e));a(t)}),[i,a]),p=1===i.length,E=1===i.length&&(""===i[0].key||""===i[0].value),y=e=>null!=e&&e.length?e.map(((e,t)=>n.a.createElement(g.EuiFormErrorText,{key:t},e))):null,h=Object(l.useMemo)((()=>(e,t)=>null==s?void 0:s.filter((a=>a.index===e&&("key"===t?a.hasKeyError:a.hasValueError))).map((e=>e.message))),[s]),k=Object(l.useMemo)((()=>s&&s.filter((e=>void 0===e.index)).map((({message:e})=>e))),[s]);return n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaHeadersPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaHeaders"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeadersTitle",defaultMessage:"Headers"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),i.map(((e,t)=>{var a,l;const i=h(t,"key"),s=h(t,"value");return n.a.createElement("div",{key:t},t>0&&n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart",gutterSize:"none",style:{gap:30}},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeaderKeyInputLabel",defaultMessage:"Key"}),error:y(i),isInvalid:(null!==(a=null==i?void 0:i.length)&&void 0!==a?a:0)>0},n.a.createElement(g.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersKeyInput${t}`,fullWidth:!0,value:e.key,onChange:e=>c(t,"key",e.target.value),autoFocus:r}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeaderValueInputLabel",defaultMessage:"Value"}),error:y(s),isInvalid:(null!==(l=null==s?void 0:s.length)&&void 0!==l?l:0)>0},n.a.createElement(g.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersValueInput${t}`,fullWidth:!0,value:e.value,onChange:e=>c(t,"value",e.target.value)}))),n.a.createElement(g.EuiFlexItem,{grow:!1,style:{marginTop:28}},n.a.createElement(g.EuiButtonIcon,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersDeleteButton${t}`,color:"text",onClick:()=>m(t),iconType:"cross",disabled:p,"aria-label":b.i18n.translate("xpack.fleet.kafkaHeadersInput.deleteButton",{defaultMessage:"Delete row"})}))))})),y(k),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiButtonEmpty,{"data-test-subj":"kafkaHeaders.multiRowInput.addRowButton",disabled:E,size:"xs",flush:"left",iconType:"plusInCircle",onClick:u},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.kafkaHeadersInput.addRow",defaultMessage:"Add header"})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaClientIdLabel",defaultMessage:"Client ID"})},t.kafkaClientIdInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaClientIdInput",fullWidth:!0},t.kafkaClientIdInput.props))))},yi=e=>{const{inputs:t}=e,a=Object(l.useMemo)((()=>Array.from({length:6},((e,t)=>10*(t+1))).map((e=>({text:e,label:`${e} seconds`})))),[]),i=e=>{switch(e){case Z.Pb.DoNotWait:return"No response";case Z.Pb.Replica:return"Wait for all replicas to commit";default:case Z.Pb.Commit:return"Wait for local commit"}},s=Object(l.useMemo)((()=>Object.keys(Z.Pb).map((e=>({text:Z.Pb[e],label:i(Z.Pb[e])})))),[]);return n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaBrokerSettingsPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaBrokerSettings"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerSettingsTitle",defaultMessage:"Broker settings"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerTimeoutInputLabel",defaultMessage:"Broker timeout"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerTimeoutInputHelpText",defaultMessage:"Define how long a Kafka server waits for data in the same cluster."})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerTimeoutInput"},t.kafkaBrokerTimeoutInput.props,{options:a}))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerReachabilityTimeoutInputLabel",defaultMessage:"Broker reachability timeout"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerReachabilityTimeoutInputHelpText",defaultMessage:"Define how long an Agent would wait for a response from Kafka broker."})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerReachabilityTimeoutInput"},t.kafkaBrokerReachabilityTimeoutInput.props,{options:a}))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerAckReliabilityInputLabel",defaultMessage:"ACK Reliability"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerAckReliabilityInputHelpText",defaultMessage:"Reliability level required from the broker."})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerAckReliabilityInputLabel"},t.kafkaBrokerAckReliabilityInput.props,{options:s}))))},hi=e=>{const{inputs:t}=e,a=Object(l.useMemo)((()=>Object.keys(Z.Rb).filter((e=>"None"!==e)).map((e=>({text:Z.Rb[e],label:Z.Rb[e]})))),[]),i=Object(l.useMemo)((()=>Array.from({length:9},((e,t)=>t+1)).map((e=>({text:e,label:e.toString()})))),[]);return n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaCompressionPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaCompression"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionTitle",defaultMessage:"Compression"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"settingsOutputsFlyout.kafkaCompressionSwitch"},t.kafkaCompressionInput.props,{onChange:e=>{e.target.checked||t.kafkaCompressionCodecInput.setValue(Z.Rb.None),t.kafkaCompressionInput.setValue(e.target.checked)},label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionSwitchLabel",defaultMessage:"Enable compression"})})),t.kafkaCompressionInput.value?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionCodecInputLabel",defaultMessage:"Codec"})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaCompressionCodecInput"},t.kafkaCompressionCodecInput.props,{options:a}))),t.kafkaCompressionCodecInput.value===Z.Rb.Gzip&&n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionLevelInputLabel",defaultMessage:"Level"})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0},t.kafkaCompressionLevelInput.props,{"data-test-subj":"settingsOutputsFlyout.kafkaCompressionLevelInput",options:i})))):null)},ki=[{id:Z.Tb.Random,label:"Random","data-test-subj":"kafkaPartitionRandomRadioButton"},{id:Z.Tb.RoundRobin,label:"Round robin","data-test-subj":"kafkaPartitionRoundRobinRadioButton"},{id:Z.Tb.Hash,label:"Hash","data-test-subj":"kafkaPartitionHashRadioButton"}],vi=e=>{const{inputs:t}=e;return n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaPartitionPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaPartitionTitle"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTitle",defaultMessage:"Partitioning"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitioningInputLabel",defaultMessage:"Partitioning strategy"})},n.a.createElement(g.EuiRadioGroup,d()({style:{flexDirection:"row",flexWrap:"wrap",columnGap:30},"data-test-subj":"settingsOutputsFlyout.kafkaPartitioningRadioInput",options:ki,compressed:!0},t.kafkaPartitionTypeInput.props))),(()=>{switch(t.kafkaPartitionTypeInput.value){case Z.Tb.Random:return n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeRandomInputLabel",defaultMessage:"Number of events"})},t.kafkaPartitionTypeRandomInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeRandomInput",fullWidth:!0},t.kafkaPartitionTypeRandomInput.props)));case Z.Tb.RoundRobin:return n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeRoundRobinInputLabel",defaultMessage:"Number of events"})},t.kafkaPartitionTypeRoundRobinInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeRoundRobinInput",fullWidth:!0},t.kafkaPartitionTypeRoundRobinInput.props)));case Z.Tb.Hash:default:return n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeHashInputLabel",defaultMessage:"List of fields"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeHashHelpTextLabel",defaultMessage:"Comma separated."})},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeHashInput",fullWidth:!0},t.kafkaPartitionTypeHashInput.props))))}})())},xi=({fullWidth:e,error:t,isInvalid:a,children:i,clear:s,title:r,initialValue:o,onToggleSecretStorage:c,cancelEdit:u,useSecretsStorage:d,isConvertedToSecret:m=!1,label:p,disabled:E})=>{const y=!!o,[h,k]=Object(l.useState)(m||!o),v=n.a.createElement(g.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1},E?n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputForm.secretValueHiddenAndDisabledMessage",defaultMessage:"The saved {varName} is hidden.",values:{varName:r}})):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputForm.secretValueHiddenMessage",defaultMessage:"The saved {varName} is hidden. You can only replace the {varName}.",values:{varName:r}})),n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiButtonEmpty,{onClick:()=>k(!0),color:"primary",iconType:"refresh",iconSide:"left",size:"xs"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.outputForm.editSecretValue",defaultMessage:"Replace {varName}",values:{varName:r}})))),x=n.a.createElement(g.EuiButtonEmpty,{onClick:()=>{k(!1),u&&u()},color:"primary",iconType:"refresh",iconSide:"left",size:"xs"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.editPackagePolicy.stepConfigure.fieldSecretValueSetCancelButton",defaultMessage:"Cancel {varName} change",values:{varName:r}})),F=n.a.createElement(n.a.Fragment,null,i,y&&!m&&n.a.createElement(g.EuiFlexGroup,{justifyContent:"flexEnd","data-test-subj":"secretCancelChangeBtn"},n.a.createElement(g.EuiFlexItem,{grow:!1},x))),M=n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiIcon,{type:"lock","data-test-subj":"lockIcon"})," ",r," ",n.a.createElement(g.EuiToolTip,{content:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputTooltip",{defaultMessage:"This value will be stored as a secret, meaning once saved the value cannot be viewed again"})},n.a.createElement(g.EuiIcon,{type:"questionInCircle"}))),S=Object(l.useMemo)((()=>E?null:m?n.a.createElement(g.EuiCallOut,{size:"s",color:"warning"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeySecretInputConvertedCalloutTitle",defaultMessage:"This field will be re-saved using secret storage from plain text storage. Secrets storage requires Fleet Server v8.12.0 and above. {revertLink}",values:{revertLink:n.a.createElement(g.EuiLink,{onClick:()=>c(!1),color:"primary"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.revertToPlaintextLink",defaultMessage:"Click to use plain text storage instead"}))}})):o?void 0:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeySecretInputCalloutTitle",defaultMessage:"This field uses secret storage and requires Fleet Server v8.12.0 and above. {revertLink}",values:{revertLink:n.a.createElement(g.EuiLink,{onClick:()=>c(!1),color:"primary"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.revertToPlaintextLink",defaultMessage:"Click to use plain text storage instead"}))}})),[E,o,m,c]),I=E?null:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.secretInputCalloutTitle",defaultMessage:"This field should be stored as a secret, currently it is set to be stored as plain text. {enableSecretLink}",values:{enableSecretLink:n.a.createElement(g.EuiLink,{onClick:()=>c(!0),color:"primary"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.revertToSecretStorageLink",defaultMessage:"Click to use secret storage instead"}))}}),T=h?F:v;return d?n.a.createElement(g.EuiFormRow,{fullWidth:e,label:M,error:t,isInvalid:a,helpText:S},T):n.a.createElement(g.EuiFormRow,{fullWidth:e,error:t,isInvalid:a,label:p,helpText:I},T)},Fi=[{id:Z.Ub.Plain,label:"Plain","data-test-subj":"kafkaSaslPlainRadioButton"},{id:Z.Ub.ScramSha256,label:"SCRAM-SHA-256","data-test-subj":"kafkaSaslScramSha256RadioButton"},{id:Z.Ub.ScramSha512,label:"SCRAM-SHA-512","data-test-subj":"kafkaSaslScramSha512RadioButton"}],Mi=[{id:Z.Qb.None,label:"None","data-test-subj":"kafkaAuthenticationNoneRadioButton"},{id:Z.Qb.Userpass,label:"Username / Password","data-test-subj":"kafkaAuthenticationUsernamePasswordRadioButton"},{id:Z.Qb.Ssl,label:"SSL","data-test-subj":"kafkaAuthenticationSSLRadioButton"}],Si=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,[s,r]=n.a.useState({kafkaAuthPassword:!1,kafkaSslKey:!1}),[o,c]=n.a.useState(!0);Object(l.useEffect)((()=>{o&&(c(!1),a&&(t.kafkaAuthPasswordInput.value&&!t.kafkaAuthPasswordSecretInput.value&&(t.kafkaAuthPasswordSecretInput.setValue(t.kafkaAuthPasswordInput.value),t.kafkaAuthPasswordInput.clear(),r({...s,kafkaAuthPassword:!0})),t.kafkaSslKeyInput.value&&!t.kafkaSslKeySecretInput.value&&(t.kafkaSslKeySecretInput.setValue(t.kafkaSslKeyInput.value),t.kafkaSslKeyInput.clear(),r({...s,kafkaSslKey:!0}))))}),[a,t.kafkaAuthPasswordInput,t.kafkaAuthPasswordSecretInput,t.kafkaSslKeyInput,t.kafkaSslKeySecretInput,o,c,s]);const u=e=>{e?(t.kafkaAuthPasswordInput.clear(),t.kafkaSslKeyInput.clear()):(t.kafkaAuthPasswordSecretInput.setValue(""),t.kafkaSslKeySecretInput.setValue("")),r({kafkaAuthPassword:!1,kafkaSslKey:!1}),i(e)},m=Object(l.useMemo)((()=>Object.keys(Z.Wb).map((e=>({text:Z.Wb[e],label:e})))),[]),p=Object(l.useMemo)((()=>Object.keys(Z.Sb).map((e=>({id:Z.Sb[e],label:e,"data-test-subj":`kafkaConnectionType${e}RadioButton`})))),[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaAuthenticationPanel"},n.a.createElement(g.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaAuthenticationTitle"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaAuthenticationTitle",defaultMessage:"Authentication"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0},n.a.createElement(g.EuiRadioGroup,d()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaAuthenticationRadioInput",options:Mi,compressed:!0},t.kafkaAuthMethodInput.props))),(()=>{switch(t.kafkaAuthMethodInput.value){case Z.Qb.None:return n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaConnectionTypeLabel",defaultMessage:"Connection"})},n.a.createElement(g.EuiRadioGroup,d()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaConnectionTypeRadioInput",options:p,compressed:!0},t.kafkaConnectionTypeInput.props)));case Z.Qb.Ssl:return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},t.kafkaSslCertificateInput.formRowProps),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5},t.kafkaSslCertificateInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),a?n.a.createElement(xi,d()({fullWidth:!0,title:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaPasswordSecretInputTitle",{defaultMessage:"Client SSL certificate key"})},t.kafkaSslKeySecretInput.formRowProps,{useSecretsStorage:a,isConvertedToSecret:s.kafkaSslKey,onToggleSecretStorage:u,cancelEdit:t.kafkaSslKeySecretInput.cancelEdit}),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5,"data-test-subj":"kafkaSslKeySecretInput"},t.kafkaSslKeySecretInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))):n.a.createElement(xi,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},t.kafkaSslKeyInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:u}),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5},t.kafkaSslKeyInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))));default:case Z.Qb.Userpass:return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaUsernameInputLabel",defaultMessage:"Username"})},t.kafkaAuthUsernameInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaUsernameInput",fullWidth:!0},t.kafkaAuthUsernameInput.props))),a?n.a.createElement(xi,d()({fullWidth:!0,title:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaPasswordInputtitle",{defaultMessage:"Password"})},t.kafkaAuthPasswordSecretInput.formRowProps,{useSecretsStorage:a,isConvertedToSecret:s.kafkaAuthPassword,onToggleSecretStorage:u,cancelEdit:t.kafkaAuthPasswordSecretInput.cancelEdit}),n.a.createElement(g.EuiFieldPassword,d()({type:"dual","data-test-subj":"settingsOutputsFlyout.kafkaPasswordSecretInput",fullWidth:!0},t.kafkaAuthPasswordSecretInput.props))):n.a.createElement(xi,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPasswordInputLabel",defaultMessage:"Password"})},t.kafkaAuthPasswordInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:u}),n.a.createElement(g.EuiFieldPassword,d()({type:"dual","data-test-subj":"settingsOutputsFlyout.kafkaPasswordInput",fullWidth:!0},t.kafkaAuthPasswordInput.props))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaSaslInputLabel",defaultMessage:"SASL Mechanism"})},n.a.createElement(g.EuiRadioGroup,d()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaSaslInput",options:Fi,compressed:!0},t.kafkaSaslMechanismInput.props))))}})()),t.kafkaConnectionTypeInput.value!==Z.Sb.Plaintext||t.kafkaAuthMethodInput.value!==Z.Qb.None?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(qn.a,d()({placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},t.kafkaSslCertificateAuthoritiesInput.props)),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaVerificationModeInputLabel",defaultMessage:"Verification mode"})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaVerificationModeInput"},t.kafkaVerificationModeInput.props,{options:m,placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaVerificationModeInputPlaceholder",{defaultMessage:"Specify verification mode"})})))):null)},Ii=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,{docLinks:s}=Object(Ve.Xc)(),r=Object(l.useMemo)((()=>Z.Vb.map((e=>({text:e,label:e})))),[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaVersionInputLabel",defaultMessage:"Kafka version"})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaVersionInput"},t.kafkaVersionInput.props,{options:r,placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaVersionInputPlaceholder",{defaultMessage:"Specify version"})}))),n.a.createElement(qn.a,d()({placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!0,helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHostsInputDescription",defaultMessage:"Specify the URLs that your agents will use to connect to Kafka. {guideLink}.",values:{guideLink:n.a.createElement(g.EuiLink,{href:s.links.fleet.kafkaSettings,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.kafkaUserGuideLink",defaultMessage:"Learn more"}))}}),label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaHostsInputLabel",{defaultMessage:"Hosts"})},t.kafkaHostsInput.props)),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(Si,{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(vi,{inputs:t}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(fi,{inputs:t}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(bi,{inputs:t}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(hi,{inputs:t}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(yi,{inputs:t}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaKeyInputLabel",defaultMessage:"Key (optional)"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaKeyInputHelpText",defaultMessage:"If configured, the event key can be extracted from the event using a format string."})},n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.kafkaKeyInput",fullWidth:!0},t.kafkaKeyInput.props))))};var Ti=a(100);const Oi=L.a.div.withConfig({displayName:"CodeEditorContainer",componentId:"sc-1u19e39-0"})(["min-height:0;position:relative;height:116px;"]),wi=L()(g.EuiTextColor).attrs((e=>({color:"subdued",size:"xs"}))).withConfig({displayName:"CodeEditorPlaceholder",componentId:"sc-1u19e39-1"})(["position:absolute;top:0;left:0;font-family:Menlo,Monaco,'Courier New',monospace;font-size:12px;line-height:21px;pointer-events:none;"]),ji={minimap:{enabled:!1},ariaLabel:b.i18n.translate("xpack.fleet.settings.yamlCodeEditor",{defaultMessage:"YAML Code Editor"}),scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,folding:!1,lineDecorationsWidth:0},Ci=e=>{const{placeholder:t,disabled:a,...l}=e;return a?n.a.createElement(g.EuiCodeBlock,{style:{height:"116px"},language:"yaml",isCopyable:!1,paddingSize:"s"},n.a.createElement("pre",null,l.value)):n.a.createElement(Oi,null,n.a.createElement(Ti.CodeEditor,d()({languageId:"yaml",width:"100%",height:"116px",options:ji},l)),(!l.value||""===l.value)&&n.a.createElement(wi,null,t))},Ai=e=>t=>{if("object"!=typeof t)return e(null!=t?t:"")};function Pi(e){const t=[],a={};if(e.forEach(((e,l)=>{if(!e)return void t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostFieldRequiredError",{defaultMessage:"Host is required"})});const n=e.split(":");if(2!==n.length||!n[0]||!n[1])return void t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostPortError",{defaultMessage:'Invalid format. Expected "host:port" without protocol.'}),index:l});const i=parseInt(n[1],10);(isNaN(i)||i<1||i>65535)&&t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaPortError",{defaultMessage:"Invalid port number. Expected a number between 1 and 65535"}),index:l});const s=a[e]||[];a[e]=[...s,l]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Li(e){const t=[],a={},l=b.i18n.translate("xpack.fleet.settings.outputForm.elasticUrlRequiredError",{defaultMessage:"URL is required"});if(e.forEach(((e,n)=>{try{if(e){const a=new URL(e);["http:","https:"].includes(a.protocol)||t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.invalidProtocolError",{defaultMessage:"Invalid protocol"}),index:n})}else t.push({message:l,index:n})}catch(e){t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.elasticHostError",{defaultMessage:"Invalid URL"}),index:n})}const i=a[e]||[];a[e]=[...i,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.elasticHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:l}),t.length)return t}function _i(e){const t=[],a={};if(e.forEach(((e,l)=>{try{if(e.match(/^http([s]){0,1}:\/\//))return void t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.logstashHostProtocolError",{defaultMessage:"Host address must begin with a domain name or IP address"}),index:l});if(new URL(`http://${e}`).host!==e.toLowerCase())throw new Error("Invalid host")}catch(a){0===e.length?t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"}),index:l}):t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.logstashHostError",{defaultMessage:"Invalid Host"}),index:l})}const n=a[e]||[];a[e]=[...n,l]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.logstashHostDuplicateError",{defaultMessage:"Duplicate Host"}),index:e})))})),0===e.length&&t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Di(e){try{return void Object(Ol.safeLoad)(e)}catch(e){return[b.i18n.translate("xpack.fleet.settings.outputForm.invalidYamlFormatErrorMessage",{defaultMessage:"Invalid YAML: {reason}",values:{reason:e.message}})]}}function Bi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function Ri(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.kafkaUsernameIsRequired",{defaultMessage:"Username is required"})]}function zi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.kafkaPasswordIsRequired",{defaultMessage:"Password is required"})]}const Ni=Ai(zi);function Hi(e){if(""!==e&&!e.match(/^[a-zA-Z0-9]+$/))return[b.i18n.translate("xpack.fleet.settings.outputForm.caTrusterdFingerprintInvalidErrorMessage",{defaultMessage:"CA trusted fingerprint should be valid HEX encoded SHA-256 of a CA certificate"})]}function Ui(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.serviceTokenRequiredErrorMessage",{defaultMessage:"Service token is required"})]}const qi=Ai(Ui);function Gi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.sslCertificateRequiredErrorMessage",{defaultMessage:"SSL certificate is required"})]}function Wi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.sslKeyRequiredErrorMessage",{defaultMessage:"SSL key is required"})]}const Ki=Ai(Wi);function Vi(e){if(!e||""===e)return[b.i18n.translate("xpack.fleet.settings.outputForm.kafkaDefaultTopicRequiredMessage",{defaultMessage:"Default topic is required"})]}function $i(e){return/^[A-Za-z0-9._-]+$/.test(e)?void 0:[b.i18n.translate("xpack.fleet.settings.outputForm.kafkaClientIdFormattingMessage",{defaultMessage:"Client ID is invalid. Only letters, numbers, dots, underscores, and dashes are allowed."})]}function Qi(e){return/^[0-9]+$/.test(e)?void 0:[b.i18n.translate("xpack.fleet.settings.outputForm.kafkaPartitioningGroupEventsFormattingMessage",{defaultMessage:"Number of events must be a number"})]}function Yi(e){const t=[],a=new Set;if(e.forEach(((e,l)=>{const{key:n,value:i}=e,s=!!n,r=!!i;s&&!r?t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersMissingKeyError",{defaultMessage:'Missing value for key "{key}"',values:{key:n}}),index:l,hasKeyError:!1,hasValueError:!0}):!s&&r?t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersMissingValueError",{defaultMessage:'Missing key for value "{value}"',values:{value:i}}),index:l,hasKeyError:!0,hasValueError:!1}):s&&r&&(a.has(n)?t.push({message:b.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersDuplicateKeyError",{defaultMessage:'Duplicate key "{key}"',values:{key:n}}),index:l,hasKeyError:!0,hasValueError:!1}):a.add(n))})),t.length)return t}const Xi=()=>n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),Ji=({output:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{"data-test-subj":"settings.outputModal",id:"xpack.fleet.settings.updateOutput.confirmModalText",defaultMessage:"This action will update {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),"logstash"===e.type?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiCallOut,{iconType:"warning",color:"warning",size:"m",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.warningTitle",defaultMessage:"Logstash output for agent integration is not supported for fleet server and synthetics."})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.warningMessage",defaultMessage:"Fleet server and synthetics policies will keep using the existing ES output."}))," "):null);const Zi=({enabled:e,inputs:t})=>{const{diskQueueEnabledInput:a,diskQueuePathInput:l,diskQueueMaxSizeInput:i,loadBalanceEnabledInput:s,diskQueueEncryptionEnabled:r,diskQueueCompressionEnabled:o,compressionLevelInput:c,memQueueEvents:u,queueFlushTimeout:m,maxBatchBytes:p}=t,{showExperimentalShipperOptions:E}=D.b.get();return e?n.a.createElement(g.EuiAccordion,{id:"advancedOutputOptions",arrowDisplay:"left",buttonContent:n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.advancedOptionsToggleLabel",defaultMessage:"Advanced options"})),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiBetaBadge,{label:"Experimental",color:"subdued"})))},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},p.formRowProps,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.maxBatchSizeDescriptionLabel",defaultMessage:"Maximum Batch Size"})}),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldNumber,d()({},p.props,{placeholder:"Batching Bytes",min:0}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.maxBatchSizeDescription",defaultMessage:"Data will be sent to the output when the agent has more events in the queue than this number."}))))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},m.formRowProps,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.queueFlushTimeoutLabel",defaultMessage:"Flush Timeout"})}),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldNumber,d()({},m.props,{placeholder:"Seconds",min:0}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.queueFlushTimeoutDescription",defaultMessage:"Upon expiry the output queue is flushed and data is written to the output."}))))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},u.formRowProps,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.memQueueEventsLabel",defaultMessage:"Memory Queue Size"})}),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldNumber,d()({},u.props,{placeholder:"Events",min:0}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.memQueueEventsSizeDescription",defaultMessage:"Maximum number of events that can be stored in the queue. Default is set to 4096. When this queue is full, new events are dropped."}))))),E&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiHorizontalRule,null),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},a.formRowProps),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"editOutputFlyout.diskQueueSwitch"},a.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueSwitchLabel",defaultMessage:"Disk Queue"})}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueSwitchDescription",defaultMessage:"Once enabled, events will be queued on disk if, for some reason, agent is not able to send them."}))))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},r.formRowProps),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"editOutputFlyout.diskQueueEncryption"},r.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueEncryptionLabel",defaultMessage:"Disk Queue Encryption"})}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueEncryptionDescription",defaultMessage:"Enable encryption of data written to the disk queue."}))))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueuePathLabel",defaultMessage:"Disk Queue Path"})},l.formRowProps),n.a.createElement(g.EuiFieldText,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.diskQueuePath"},l.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.diskQueuePathPlaceholder",{defaultMessage:"path_data/diskqueue"})}))),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},i.formRowProps,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueMaxSize",defaultMessage:"Maximum Disk Queue Size"})}),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFieldNumber,d()({},i.props,{placeholder:"Bytes",min:0}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueMaxSizeDescription",defaultMessage:"Limits the disk queue size for spooling of data. When data in the queue exceeds this limit, new events will be dropped."}))))),n.a.createElement(g.EuiHorizontalRule,null),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},s.formRowProps),n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"editOutputFlyout.loadBalancingSwitch"},s.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.loadBalancingSwitchLabel",defaultMessage:"Load Balancing"})}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.loadBalancingDescription",defaultMessage:"Once enabled, the agents will balance the load across all the hosts defined for this output. This will increase the number of connections opened by the agent."}))))),n.a.createElement(g.EuiHorizontalRule,null),n.a.createElement(g.EuiFormRow,{fullWidth:!0},n.a.createElement(g.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSwitch,d()({"data-test-subj":"editOutputFlyout.compressionSwitch"},o.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.compressionSwitchLabel",defaultMessage:"Compression"})}))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiSelect,d()({"data-test-subj":"editOutputFlyout.compressionLevelSelect",id:"selectCompressionLevel","aria-label":"Use aria labels when no actual label is in use"},c.props))),n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiText,{size:"s",color:"subdued"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.compressionSwitchDescription",defaultMessage:"Level 1 compression is the fastest, Level 9 however would provide the most compression."})))))))):null},es=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,[s,r]=n.a.useState({serviceToken:!1}),[o,c]=n.a.useState(!0);Object(l.useEffect)((()=>{o&&(c(!1),a&&t.serviceTokenInput.value&&!t.serviceTokenSecretInput.value&&(t.serviceTokenSecretInput.setValue(t.serviceTokenInput.value),t.serviceTokenInput.clear(),r({serviceToken:!0})))}),[a,t.serviceTokenInput,t.serviceTokenSecretInput,o,c,s]);const u=e=>{e?t.serviceTokenInput.clear():t.serviceTokenSecretInput.setValue(""),r({...s,serviceToken:!1}),i(e)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(qn.a,d()({"data-test-subj":"settingsOutputsFlyout.hostUrlInput",label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteEsHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteEsHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},t.elasticsearchUrlInput.props,{isUrl:!0})),n.a.createElement(g.EuiSpacer,{size:"m"}),a?n.a.createElement(xi,d()({fullWidth:!0,title:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.serviceTokenLabel",{defaultMessage:"Service token"})},t.serviceTokenSecretInput.formRowProps,{cancelEdit:t.serviceTokenSecretInput.cancelEdit,useSecretsStorage:a,isConvertedToSecret:s.serviceToken,onToggleSecretStorage:u}),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"serviceTokenSecretInput",fullWidth:!0},t.serviceTokenSecretInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteESHostPlaceholder",{defaultMessage:"Specify service token"})}))):n.a.createElement(xi,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.serviceTokenLabel",defaultMessage:"Service token"})},t.serviceTokenInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:u}),n.a.createElement(g.EuiFieldText,d()({fullWidth:!0,"data-test-subj":"serviceTokenSecretInput"},t.serviceTokenInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteESHostPlaceholder",{defaultMessage:"Specify service token"})}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCallOut,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.serviceTokenCalloutText",defaultMessage:"Generate a service token by running this API request in the Remote Kibana Console and copy the response value"}),"data-test-subj":"serviceTokenCallout"},n.a.createElement(g.EuiCodeBlock,{isCopyable:!0},'POST kbn:/api/fleet/service_tokens\n{\n  "remote": true\n}')),n.a.createElement(g.EuiSpacer,{size:"m"}))},ts=()=>{const{docLinks:e}=Object(c.sc)();return n.a.createElement(as,{iconType:"iInCircle",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.calloutTitle",defaultMessage:"Additional Logstash configuration required"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.description",defaultMessage:"Add an Elastic Agent pipeline configuration to Logstash to receive events from the Elastic Agent framework. {documentationLink}.",values:{documentationLink:n.a.createElement(g.EuiLink,{external:!0,href:e.links.logstash.inputElasticAgent},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.documentationLink",defaultMessage:"Learn more"}))}}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(ls,null)))},as=({children:e,...t})=>{const[a,i]=Object(l.useState)(!1);return n.a.createElement(g.EuiCallOut,t,n.a.createElement(g.EuiSpacer,{size:"s"}),a?n.a.createElement(g.EuiButton,{onClick:()=>i(!1)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.collapseInstructionsButtonLabel",defaultMessage:"Collapse steps"})):n.a.createElement(g.EuiButton,{onClick:()=>i(!0),fill:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.viewInstructionButtonLabel",defaultMessage:"View steps"})),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),e))},ls=()=>{const{docLinks:e}=Object(c.sc)(),t=function(){const[e,t]=Object(l.useState)(!1),[a,n]=Object(l.useState)(),{notifications:i}=Object(c.sc)(),s=Object(l.useCallback)((async()=>{try{var e;t(!0);const a=await Object(c.eb)();if(a.error)throw a.error;n(null===(e=a.data)||void 0===e?void 0:e.api_key)}catch(e){i.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.logstashInstructions.generateApiKeyError",{defaultMessage:"Impossible to generate an api key"})})}finally{t(!1)}}),[i.toasts]);return Object(l.useMemo)((()=>({isLoading:e,generateApiKey:s,apiKey:a})),[e,s,a])}(),a=Object(l.useMemo)((()=>{return[{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.apiKeyStepDescription",defaultMessage:"We recommend authorizing Logstash to output to Elasticsearch with minimal privileges for Elastic Agent."}),n.a.createElement(g.EuiSpacer,{size:"m"}),t.apiKey?n.a.createElement(g.EuiCodeBlock,{paddingSize:"m"},n.a.createElement("h5",null,"API Key"),t.apiKey,n.a.createElement("div",{className:"euiCodeBlock__controls"},n.a.createElement("div",{className:"euiCodeBlock__copyButton"},n.a.createElement(g.EuiCopy,{textToCopy:t.apiKey},(e=>n.a.createElement(g.EuiButtonIcon,{onClick:e,iconType:"copyClipboard",color:"text","aria-label":b.i18n.translate("xpack.fleet.settings.logstashInstructions.copyApiKeyButtonLabel",{defaultMessage:"Copy message"})})))))):n.a.createElement(g.EuiButton,{isLoading:t.isLoading,onClick:t.generateApiKey},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.generateApiKeyButtonLabel",defaultMessage:"Generate API key"})),n.a.createElement(g.EuiSpacer,{size:"m"}))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.editPipelineStepDescription",defaultMessage:"Next, open the {pipelineConfFile} file and insert the following content:",values:{pipelineConfFile:n.a.createElement(g.EuiCode,null,"elastic-agent-pipeline.conf")}}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},(a=t.apiKey,'input {\n  elastic_agent {\n    port => 5044\n    ssl => true\n    ssl_certificate_authorities => ["<ca_path>"]\n    ssl_certificate => "<server_cert_path>"\n    ssl_key => "<server_cert_key_in_pkcs8>"\n    ssl_verify_mode => "force_peer"\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => "<es_host>"\n    api_key => "<api_key>"\n    data_stream => true\n    ssl => true\n    # cacert => "<elasticsearch_ca_path>"\n  }\n}'.replace("<api_key>",a||"<api_key>"))))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.addPipelineStepDescription",defaultMessage:"In your Logstash configuration directory, open the {pipelineFile} file and add the following configuration. Replace the path to your file.",values:{pipelineFile:n.a.createElement(g.EuiCode,null,"pipelines.yml")}}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},'- pipeline.id: elastic-agent-pipeline\n  path.config: "/etc/path/to/elastic-agent-pipeline.conf"\n'))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.replaceStepDescription",defaultMessage:"Replace the parts between the brackets with your generated SSL certificate file paths. View {documentationLink} to generate the certificates.",values:{documentationLink:n.a.createElement(g.EuiLink,{external:!0,href:e.links.fleet.secureLogstash},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.ourDocumentationLink",defaultMessage:"our documentation"}))}}),n.a.createElement(g.EuiSpacer,{size:"m"}))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.saveAndRestartStepDescription",defaultMessage:"Save the pipeline and restart Logstash so the changes take effect."}),n.a.createElement(g.EuiSpacer,{size:"m"}))}];var a}),[t,e]);return n.a.createElement("ol",null,a.map(((e,t)=>n.a.createElement("li",{key:t},e.children))))},ns=()=>{const{docLinks:e}=Object(c.sc)();return n.a.createElement(g.EuiCallOut,{iconType:"warning",color:"warning",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutTitle",defaultMessage:"Additional setup required"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutDescription",defaultMessage:"You must configure an encryption key before configuring this output. {link}",values:{link:n.a.createElement(g.EuiLink,{href:e.links.kibana.secureSavedObject,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.link",defaultMessage:"Learn more"}))}}))},is=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i,hasEncryptedSavedObjectConfigured:s}=e,{docLinks:r}=Object(c.sc)(),[o,u]=n.a.useState(!0),[m,p]=n.a.useState({sslKey:!1});Object(l.useEffect)((()=>{o&&(u(!1),a&&t.sslKeyInput.value&&!t.sslKeySecretInput.value&&(t.sslKeySecretInput.setValue(t.sslKeyInput.value),t.sslKeyInput.clear(),p({...m,sslKey:!0})))}),[a,t.sslKeyInput,t.sslKeySecretInput,o,u,m]);const E=e=>{e?t.sslKeyInput.clear():t.sslKeySecretInput.setValue(""),p({sslKey:!1}),i(e)};return n.a.createElement(n.a.Fragment,null,!s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(ns,null)),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(ts,null),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(qn.a,d()({placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!1,helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.logstashHostsInputDescription",defaultMessage:"Specify the addresses that your agents will use to connect to Logstash. {guideLink}.",values:{guideLink:n.a.createElement(g.EuiLink,{href:r.links.fleet.logstashSettings,target:"_blank",external:!0},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputLabel",{defaultMessage:"Logstash hosts"})},t.logstashHostsInput.props)),n.a.createElement(qn.a,d()({placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},t.sslCertificateAuthoritiesInput.props)),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},t.sslCertificateInput.formRowProps),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5},t.sslCertificateInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),a?n.a.createElement(xi,d()({fullWidth:!0,title:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputTitle",{defaultMessage:"Client SSL certificate key"})},t.sslKeySecretInput.formRowProps,{useSecretsStorage:a,isConvertedToSecret:m.sslKey,onToggleSecretStorage:E,cancelEdit:t.sslKeySecretInput.cancelEdit}),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5},t.sslKeySecretInput.props,{"data-test-subj":"sslKeySecretInput",placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputPlaceholder",{defaultMessage:"Specify certificate key"})}))):n.a.createElement(xi,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},t.sslKeyInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:E}),n.a.createElement(g.EuiTextArea,d()({fullWidth:!0,rows:5},t.sslKeyInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))))},ss=e=>{const{inputs:t}=e,{cloud:a}=Object(c.sc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(qn.a,d()({"data-test-subj":"settingsOutputsFlyout.hostUrlInput",label:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},t.elasticsearchUrlInput.props,{isUrl:!0,helpText:(null==a?void 0:a.isServerlessEnabled)&&n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.serverlessHostUrlsHelpText",defaultMessage:"Custom host URLs are not allowed in serverless."})})),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputLabel",defaultMessage:"Elasticsearch CA trusted fingerprint (optional)"})},t.caTrustedFingerprintInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({fullWidth:!0},t.caTrustedFingerprintInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputPlaceholder",{defaultMessage:"Specify Elasticsearch CA trusted fingerprint"})}))))},rs=({defaultOuput:e,onClose:t,output:a,proxies:i})=>{Object(c.zb)("settings");const s=function(e,t,a){var i,s,r,o,u,d,g,m,p,E,f,y,h,k,v,x,F,M,S,I,T,O,w,j,C,A,P,L,_,B,R,z,N,H,U,q,G,W,K,V,$,Q,Y,X,J,ee,te,ae,le,ne,ie,se,re,oe,ce,ue,de,ge,me,pe,Ee,fe,be,ye,he,ke,ve,xe,Fe,Me,Se;const Ie=Object(c.Kb)(),Te=Object(c.yb)(),{showExperimentalShipperOptions:Oe}=D.b.get(),we=!(null!==(i=Ie.missingOptionalFeatures)&&void 0!==i&&i.includes("encrypted_saved_object_encryption_key_required")),[je,Ce]=Object(l.useState)(!1),{notifications:Ae,cloud:Pe}=Object(c.sc)(),{confirm:Le}=Object(Un.a)(),_e=null!==(s=null==t?void 0:t.is_preconfigured)&&void 0!==s&&s,De=null!==(r=null==t?void 0:t.allow_edit)&&void 0!==r?r:[];function Be(e){return!Te.fleet.allSettings||!!_e&&!De.includes(e)}const Re=Object(c.dc)(null!==(o=null==t?void 0:t.name)&&void 0!==o?o:"",Bi,Be("name")),ze=Object(c.dc)(null!==(u=null==t?void 0:t.type)&&void 0!==u?u:"elasticsearch",void 0,Be("type")),Ne=Object(c.dc)(null!==(d=null==t?void 0:t.config_yaml)&&void 0!==d?d:"",Di,Be("config_yaml")),He=Object(c.tc)(null!==(g=null==t?void 0:t.is_default)&&void 0!==g&&g,Be("is_default")||(null==t?void 0:t.is_default)),Ue=Object(c.tc)(null!==(m=null==t?void 0:t.is_default_monitoring)&&void 0!==m&&m,Be("is_default_monitoring")||(null==t?void 0:t.is_default_monitoring)),qe=Object(c.dc)(null!==(p=null==t?void 0:t.ca_trusted_fingerprint)&&void 0!==p?p:"",Hi,Be("ca_trusted_fingerprint")),Ge=null==Pe?void 0:Pe.isServerlessEnabled,We=!Ge||null!=t&&t.hosts?(null==t?void 0:t.hosts)||[]:(null==a?void 0:a.hosts)||[],Ke=Ge||Be("hosts"),Ve=Object(c.Bb)("esHostsComboxBox",We,Li,Ke),$e=Object(c.dc)(null!==(E=null==t?void 0:t.preset)&&void 0!==E?E:Object(Ei.b)(null!==(f=null==t?void 0:t.config_yaml)&&void 0!==f?f:"",Ol.safeLoad),(()=>{}),Be("preset")),Qe=Object(c.dc)(null!==(y=null==t?void 0:t.service_token)&&void 0!==y?y:"",Ui,Be("service_token")),Ye=Object(c.pc)(null!==(h=null==t||null===(k=t.secrets)||void 0===k?void 0:k.service_token)&&void 0!==h?h:"",qi,Be("service_token")),Xe=null!=t&&t.config_yaml?Object(Ol.safeLoad)(null==t?void 0:t.config_yaml):{},Je=!(null!=Xe&&Xe.shipper)||!1===(null==Xe||null===(v=Xe.shipper)||void 0===v?void 0:v.enabled),Ze=Object(c.tc)(null!==(x=null==t||null===(F=t.shipper)||void 0===F?void 0:F.disk_queue_enabled)&&void 0!==x&&x),et=Object(c.dc)(null!==(M=null==t||null===(S=t.shipper)||void 0===S?void 0:S.disk_queue_path)&&void 0!==M?M:"",void 0,null!==(I=!Ze.value)&&void 0!==I&&I),tt=Object(c.lc)(null!==(T=null==t||null===(O=t.shipper)||void 0===O?void 0:O.disk_queue_max_size)&&void 0!==T?T:4096,void 0,null!==(w=!Ze.value)&&void 0!==w&&w),at=Object(c.tc)(null!==(j=null==t||null===(C=t.shipper)||void 0===C?void 0:C.disk_queue_encryption_enabled)&&void 0!==j&&j,null!==(A=!Ze.value)&&void 0!==A&&A),lt=Object(c.tc)(null!==(P=null==t||null===(L=t.shipper)||void 0===L?void 0:L.disk_queue_enabled)&&void 0!==P&&P),nt=Object(c.tc)(null!==(_=null==t||null===(B=t.shipper)||void 0===B?void 0:B.disk_queue_compression_enabled)&&void 0!==_&&_),it=Array.from(Array(10).keys()).slice(1).map((e=>({value:`${e}`,text:`Level ${e}`}))),st=Object(c.qc)(it,null!==(R=`${null==t||null===(z=t.shipper)||void 0===z?void 0:z.compression_level}`)&&void 0!==R?R:it[0].value,null!==(N=!nt.value)&&void 0!==N&&N),rt=Object(c.lc)((null==t||null===(H=t.shipper)||void 0===H?void 0:H.mem_queue_events)||void 0),ot=Object(c.lc)((null==t||null===(U=t.shipper)||void 0===U?void 0:U.queue_flush_timeout)||void 0),ct=Object(c.lc)((null==t||null===(q=t.shipper)||void 0===q?void 0:q.max_batch_bytes)||void 0),ut=Be("ssl"),dt=Object(c.Bb)("logstashHostsComboxBox",null!==(G=null==t?void 0:t.hosts)&&void 0!==G?G:[],_i,Be("hosts")),gt=Object(c.Bb)("sslCertificateAuthoritiesComboxBox",null!==(W=null==t||null===(K=t.ssl)||void 0===K?void 0:K.certificate_authorities)&&void 0!==W?W:[],void 0,ut),mt=Object(c.dc)(null!==(V=null==t||null===($=t.ssl)||void 0===$?void 0:$.certificate)&&void 0!==V?V:"",Gi,ut),pt=Object(c.dc)(null!==(Q=null==t||null===(Y=t.ssl)||void 0===Y?void 0:Y.key)&&void 0!==Q?Q:"",Wi,ut),Et=Object(c.pc)(null==t||null===(X=t.secrets)||void 0===X||null===(J=X.ssl)||void 0===J?void 0:J.key,Ki,ut),ft=Object(c.dc)(null!==(ee=null==t?void 0:t.proxy_id)&&void 0!==ee?ee:"",(()=>{}),Be("proxy_id")),bt=t,yt=Object(c.dc)(null!==(te=null==bt?void 0:bt.version)&&void 0!==te?te:"1.0.0",void 0,Be("version")),ht=Object(c.Bb)("kafkaHostsComboBox",null!==(ae=null==t?void 0:t.hosts)&&void 0!==ae?ae:[],Pi,Be("hosts")),kt=Object(c.oc)(null!==(le=null==bt?void 0:bt.auth_type)&&void 0!==le?le:Z.Qb.None,Be("auth_type")),vt=Object(c.oc)(null!==(ne=null==bt?void 0:bt.connection_type)&&void 0!==ne?ne:Z.Sb.Plaintext,Be("connection_type")),xt=Object(c.dc)(null==bt?void 0:bt.username,kt.value===Z.Qb.Userpass?Ri:void 0,Be("username")),Ft=Object(c.dc)(null==bt?void 0:bt.password,kt.value===Z.Qb.Userpass?zi:void 0,Be("password")),Mt=Object(c.pc)(null==bt||null===(ie=bt.secrets)||void 0===ie?void 0:ie.password,kt.value===Z.Qb.Userpass?Ni:void 0,Be("password")),St=Object(c.Bb)("kafkaSslCertificateAuthoritiesComboBox",null!==(se=null==bt||null===(re=bt.ssl)||void 0===re?void 0:re.certificate_authorities)&&void 0!==se?se:[],void 0,ut),It=Object(c.dc)(null==bt||null===(oe=bt.ssl)||void 0===oe?void 0:oe.certificate,kt.value===Z.Qb.Ssl?Gi:void 0,ut),Tt=Object(c.dc)(null==bt||null===(ce=bt.ssl)||void 0===ce?void 0:ce.key,kt.value===Z.Qb.Ssl?Wi:void 0,ut),Ot=Object(c.pc)(null==bt||null===(ue=bt.secrets)||void 0===ue||null===(de=ue.ssl)||void 0===de?void 0:de.key,kt.value===Z.Qb.Ssl?Ki:void 0,ut),wt=Object(c.dc)(null!==(ge=null==bt||null===(me=bt.ssl)||void 0===me?void 0:me.verification_mode)&&void 0!==ge?ge:Z.Wb.Full,void 0,ut),jt=Object(c.oc)(null!==(pe=null==bt||null===(Ee=bt.sasl)||void 0===Ee?void 0:Ee.mechanism)&&void 0!==pe?pe:Z.Ub.Plain,Be("sasl")),Ct=Object(c.oc)(null!==(fe=null==bt?void 0:bt.partition)&&void 0!==fe?fe:Z.Tb.Random,Be("partition")),At=Object(c.dc)(null!=bt&&null!==(be=bt.random)&&void 0!==be&&be.group_events?`${bt.random.group_events}`:"1",Ct.value===Z.Tb.Random?Qi:void 0,Be("partition")),Pt=Object(c.dc)(null==bt||null===(ye=bt.hash)||void 0===ye?void 0:ye.hash,void 0,Be("partition")),Lt=Object(c.dc)(null!=bt&&null!==(he=bt.round_robin)&&void 0!==he&&he.group_events?`${bt.round_robin.group_events}`:"1",Ct.value===Z.Tb.RoundRobin?Qi:void 0,Be("partition")),_t=Object(c.dc)((Jt=null==bt?void 0:bt.topics)&&0!==Jt.length&&Jt[Jt.length-1].topic||"",Vi,Be("topics")),Dt=Object(c.gc)("kafkaHeadersComboBox",null!==(ke=null==bt?void 0:bt.headers)&&void 0!==ke?ke:[{key:"",value:""}],Yi,Be("headers")),Bt=Object(c.dc)(null!==(ve=null==bt?void 0:bt.client_id)&&void 0!==ve?ve:"Elastic",$i,Be("client_id")),Rt=Object(c.tc)(!(null==bt||!bt.compression||bt.compression===Z.Rb.None),Be("compression")),zt=Object(c.dc)(`${null!==(xe=null==bt?void 0:bt.compression_level)&&void 0!==xe?xe:4}`,void 0,Be("compression_level")),Nt=Object(c.dc)(null!=bt&&bt.compression&&bt.compression!==Z.Rb.None?bt.compression:Z.Rb.Gzip,void 0,Be("compression")),Ht=Object(c.dc)(`${null!==(Fe=null==bt?void 0:bt.timeout)&&void 0!==Fe?Fe:30}`,void 0,Be("broker_timeout")),Ut=Object(c.dc)(`${null!==(Me=null==bt?void 0:bt.broker_timeout)&&void 0!==Me?Me:30}`,void 0,Be("timeout")),qt=Object(c.dc)(`${null!==(Se=null==bt?void 0:bt.required_acks)&&void 0!==Se?Se:Z.Pb.Commit}`,void 0,Be("required_acks")),Gt=Object(c.dc)(null==bt?void 0:bt.key,void 0,Be("key")),Wt=ze.value===Z.Xb.Logstash,Kt=ze.value===Z.Xb.Kafka,Vt=ze.value===Z.Xb.RemoteElasticsearch,$t={nameInput:Re,typeInput:ze,elasticsearchUrlInput:Ve,diskQueueEnabledInput:Ze,diskQueuePathInput:et,diskQueueEncryptionEnabled:at,diskQueueMaxSizeInput:tt,diskQueueCompressionEnabled:nt,compressionLevelInput:st,logstashHostsInput:dt,presetInput:$e,additionalYamlConfigInput:Ne,defaultOutputInput:He,defaultMonitoringOutputInput:Ue,caTrustedFingerprintInput:qe,serviceTokenInput:Qe,serviceTokenSecretInput:Ye,sslCertificateInput:mt,sslKeyInput:pt,sslKeySecretInput:Et,sslCertificateAuthoritiesInput:gt,proxyIdInput:ft,loadBalanceEnabledInput:lt,memQueueEvents:rt,queueFlushTimeout:ot,maxBatchBytes:ct,kafkaVersionInput:yt,kafkaHostsInput:ht,kafkaVerificationModeInput:wt,kafkaAuthMethodInput:kt,kafkaConnectionTypeInput:vt,kafkaAuthUsernameInput:xt,kafkaAuthPasswordInput:Ft,kafkaAuthPasswordSecretInput:Mt,kafkaSaslMechanismInput:jt,kafkaPartitionTypeInput:Ct,kafkaPartitionTypeRandomInput:At,kafkaPartitionTypeHashInput:Pt,kafkaPartitionTypeRoundRobinInput:Lt,kafkaHeadersInput:Dt,kafkaClientIdInput:Bt,kafkaCompressionInput:Rt,kafkaCompressionLevelInput:zt,kafkaCompressionCodecInput:Nt,kafkaBrokerTimeoutInput:Ht,kafkaBrokerReachabilityTimeoutInput:Ut,kafkaBrokerAckReliabilityInput:qt,kafkaKeyInput:Gt,kafkaSslCertificateAuthoritiesInput:St,kafkaSslCertificateInput:It,kafkaSslKeyInput:Tt,kafkaSslKeySecretInput:Ot,kafkaDefaultTopicInput:_t},Qt=Object.values($t).some((e=>e.hasChanged)),Yt=Object(l.useCallback)((()=>{const e=Re.validate(),t=Ve.validate(),a=ht.validate(),l=xt.validate(),n=Ft.validate(),i=Mt.validate(),s=Bt.validate(),r=It.validate(),o=Tt.validate(),c=Ot.validate(),u=_t.validate(),d=Dt.validate(),g=dt.validate(),m=Ne.validate(),p=qe.validate(),E=Qe.validate(),f=Ye.validate(),b=mt.validate(),y=pt.validate(),h=Et.validate(),k=et.validate(),v=At.validate(),x=Lt.validate(),F=Tt.value?o:c,M=Ft.value?n:i;return Wt?g&&m&&e&&b&&(pt.value&&y||Et.value&&h):Kt?e&&a&&r&&F&&l&&M&&d&&u&&m&&s&&v&&x:Vt?t&&m&&e&&(Qe.value&&E||Ye.value&&f):t&&m&&e&&p&&k}),[Re,Ve,ht,xt,Ft,Mt,Bt,It,Tt,Ot,_t,Dt,dt,Ne,qe,Qe,Ye,mt,pt,Et,et,At,Lt,Wt,Kt,Vt]),Xt=Object(l.useCallback)((async()=>{try{if(!Yt())return;Ce(!0);let a={};Je||(a={shipper:{mem_queue_events:rt.value?Number(rt.value):null,queue_flush_timeout:ot.value?Number(ot.value):null,max_batch_bytes:ct.value?Number(ct.value):null}}),!Je&&Oe&&(a={...a,shipper:{disk_queue_enabled:Ze.value,disk_queue_path:Ze.value&&et.value?et.value:"",disk_queue_max_size:Ze.value&&tt.value?tt.value:null,disk_queue_encryption_enabled:Ze.value&&at.value,disk_queue_compression_enabled:nt.value,compression_level:nt.value?Number(st.value):null,loadbalance:lt.value}});const l=""!==ft.value?ft.value:null,i=(()=>{const e=e=>{if(void 0!==e){const t=parseInt(e,10);if(!isNaN(t))return t}};switch(ze.value){case Z.Xb.Kafka:const t=St.value.filter((e=>""!==e)).length,n=function(e){const t={};return!e.kafkaSslKeyInput.value&&e.kafkaSslKeySecretInput.value&&(t.ssl={key:e.kafkaSslKeySecretInput.value}),!e.kafkaAuthPasswordInput.value&&e.kafkaAuthPasswordSecretInput.value&&(t.password=e.kafkaAuthPasswordSecretInput.value),Object.keys(t).length?t:null}({kafkaSslKeyInput:Tt,kafkaSslKeySecretInput:Ot,kafkaAuthPasswordInput:Ft,kafkaAuthPasswordSecretInput:Mt});return{name:Re.value,type:Z.Xb.Kafka,hosts:ht.value,is_default:He.value,is_default_monitoring:Ue.value,config_yaml:Ne.value,...vt.value!==Z.Sb.Plaintext||kt.value!==Z.Qb.None?{ssl:{...t?{certificate_authorities:St.value.filter((e=>""!==e))}:{},...kt.value===Z.Qb.Ssl?{certificate:It.value,key:Tt.value}:{},verification_mode:wt.value}}:{},proxy_id:l,client_id:Bt.value||void 0,version:yt.value,...Gt.value?{key:Gt.value}:{},compression:Rt.value?Nt.value:Z.Rb.None,...Rt.value&&Nt.value===Z.Rb.Gzip?{compression_level:e(zt.value)}:{},auth_type:kt.value,...kt.value===Z.Qb.None?{connection_type:vt.value}:{},...kt.value===Z.Qb.Userpass&&xt.value?{username:xt.value}:{},...kt.value===Z.Qb.Userpass&&Ft.value?{password:Ft.value}:{},...kt.value===Z.Qb.Userpass&&jt.value?{sasl:{mechanism:jt.value}}:{},partition:Ct.value,...Ct.value===Z.Tb.Random&&At.value?{random:{group_events:e(At.value)}}:{},...Ct.value===Z.Tb.RoundRobin&&Lt.value?{round_robin:{group_events:e(Lt.value)}}:{},...Ct.value===Z.Tb.Hash&&Pt.value?{hash:{hash:Pt.value}}:{},topics:[{topic:_t.value}],headers:Dt.value,timeout:e(Ht.value),broker_timeout:e(Ut.value),required_acks:e(qt.value),...a,...n?{secrets:n}:{}};case Z.Xb.Logstash:return{name:Re.value,type:Z.Xb.Logstash,hosts:dt.value,is_default:He.value,is_default_monitoring:Ue.value,config_yaml:Ne.value,ssl:{certificate:mt.value,key:pt.value||void 0,certificate_authorities:gt.value.filter((e=>""!==e))},...!pt.value&&Et.value&&{secrets:{ssl:{key:Et.value}}},proxy_id:l,...a};case Z.Xb.RemoteElasticsearch:return{name:Re.value,type:Z.Xb.RemoteElasticsearch,hosts:Ve.value,is_default:He.value,is_default_monitoring:Ue.value,preset:$e.value,config_yaml:Ne.value,service_token:Qe.value||void 0,...!Qe.value&&Ye.value&&{secrets:{service_token:Ye.value}},proxy_id:l,...a};case Z.Xb.Elasticsearch:default:return{name:Re.value,type:Z.Xb.Elasticsearch,hosts:Ve.value,is_default:He.value,is_default_monitoring:Ue.value,preset:$e.value,config_yaml:Ne.value,ca_trusted_fingerprint:qe.value,proxy_id:l,...a}}})();if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:l}=await Xn(e);return t(n.a.createElement(Xi,null),n.a.createElement(Ji,{agentCount:a,agentPolicyCount:l,output:e}))}(t,Le))return void Ce(!1);const e=await Object(c.mb)(t.id,i);if(e.error)throw e.error}else{const e=await Object(c.fb)(i);if(e.error)throw e.error}e(),Ce(!1)}catch(e){Ce(!1),Ae.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.outputForm.errorToastTitle",{defaultMessage:"Error while saving output"})})}}),[Yt,Je,Oe,ft.value,t,e,rt.value,ot.value,ct.value,Ze.value,et.value,tt.value,at.value,nt.value,st.value,lt.value,ze.value,St.value,Tt,Ot,Ft,Mt,Re.value,ht.value,He.value,Ue.value,Ne.value,vt.value,kt.value,It.value,wt.value,Bt.value,yt.value,Gt.value,Rt.value,Nt.value,zt.value,xt.value,jt.value,Ct.value,At.value,Lt.value,Pt.value,_t.value,Dt.value,Ht.value,Ut.value,qt.value,dt.value,mt.value,pt.value,gt.value,Et.value,Ve.value,Qe.value,Ye.value,$e.value,qe.value,Le,Ae.toasts]);var Jt;return{inputs:$t,submit:Xt,isLoading:je,hasEncryptedSavedObjectConfigured:we,isShipperEnabled:!Je,isDisabled:je||t&&!Qt||Wt&&!we}}(t,a,e),r=s.inputs,{docLinks:o,cloud:u}=Object(c.sc)(),m=Object(c.Kb)(),[p,E]=Object(l.useState)("disabled");void 0!==m.isSecretsStorageEnabled&&"disabled"===p&&E(m.isSecretsStorageEnabled);const y=e=>{"disabled"!==p&&E(e)},h=!0===p,k=Object(l.useMemo)((()=>i.map((e=>({value:e.id,label:e.name})))),[i]),{kafkaOutput:v,remoteESOutput:x}=wl.b.get(),F=r.typeInput.value===Z.Xb.RemoteElasticsearch,M=r.typeInput.value===Z.Xb.Elasticsearch,S=!!r.typeInput.value&&Object(Ei.c)(r.typeInput.value),I=!(null!=u&&u.isServerlessEnabled),T=[{value:Z.Xb.Elasticsearch,text:"Elasticsearch"},...x&&I?[{value:Z.Xb.RemoteElasticsearch,text:"Remote Elasticsearch"}]:[],{value:Z.Xb.Logstash,text:"Logstash"},...v?[{value:Z.Xb.Kafka,text:"Kafka"}]:[]];return n.a.createElement(g.EuiFlyout,{onClose:t,maxWidth:O.q},n.a.createElement(g.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(g.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"FleetEditOutputFlyoutTitle"},a?n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.editTitle",defaultMessage:"Edit output"}):n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.createTitle",defaultMessage:"Add new output"})))),n.a.createElement(g.EuiFlyoutBody,null,(null==a?void 0:a.is_preconfigured)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiCallOut,{iconType:"lock",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutTitle",defaultMessage:"This output is managed outside of Fleet"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutDescription",defaultMessage:"Most actions related to this output are unavailable. Refer to your kibana config for more detail."})),n.a.createElement(g.EuiSpacer,{size:"m"})),n.a.createElement(g.EuiForm,null,n.a.createElement(g.EuiFormRow,d()({fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.nameInputLabel",defaultMessage:"Name"})},r.nameInput.formRowProps),n.a.createElement(g.EuiFieldText,d()({"data-test-subj":"settingsOutputsFlyout.nameInput",fullWidth:!0},r.nameInput.props,{placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(n.a.Fragment,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.typeInputLabel",defaultMessage:"Type"}))},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.typeInput"},r.typeInput.props,{options:T,placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.typeInputPlaceholder",{defaultMessage:"Specify type"})})),M||F?F?n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiText,{size:"s"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.remoteESTypeText",defaultMessage:"Enter your output hosts, service token for your remote cluster, and any advanced YAML configuration. Learn more about how to use these parameters in {doc}.",values:{doc:n.a.createElement(g.EuiLink,{href:o.links.fleet.remoteESOoutput,target:"_blank"},b.i18n.translate("xpack.fleet.settings.editOutputFlyout.docLabel",{defaultMessage:"our documentation"}))}}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(g.EuiCallOut,{"data-test-subj":`settingsOutputsFlyout.${r.typeInput.value}OutputTypeCallout`,title:(r.typeInput.value,Z.Xb.Elasticsearch,b.i18n.translate("xpack.fleet.settings.editOutputFlyout.esOutputTypeCallout",{defaultMessage:"This output type does not support connectivity to a remote Elasticsearch cluster, please use the Remote Elasticsearch type for that."})),iconType:"alert",color:"warning",size:"s",heading:"p"})):null)),(e=>{switch(e){case Z.Xb.Logstash:return n.a.createElement(is,{inputs:r,useSecretsStorage:h,onToggleSecretStorage:y,hasEncryptedSavedObjectConfigured:s.hasEncryptedSavedObjectConfigured});case Z.Xb.Kafka:return v?n.a.createElement(Ii,{inputs:r,useSecretsStorage:h,onToggleSecretStorage:y}):null;case Z.Xb.RemoteElasticsearch:return x?n.a.createElement(es,{inputs:r,useSecretsStorage:h,onToggleSecretStorage:y}):null;case Z.Xb.Elasticsearch:default:return n.a.createElement(ss,{inputs:r})}})(r.typeInput.value),F?null:n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.proxyIdLabel",defaultMessage:"Proxy"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiComboBox,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.proxyIdInput"},r.proxyIdInput.props,{onChange:e=>{var t,a;return r.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==r.proxyIdInput.value?k.filter((e=>e.value===r.proxyIdInput.value)):[],options:k,singleSelection:{asPlainText:!0},isDisabled:r.proxyIdInput.props.disabled,isClearable:!0,placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})})),n.a.createElement(g.EuiSpacer,{size:"xs"}),n.a.createElement(Kn,null))),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},r.defaultOutputInput.formRowProps),n.a.createElement(g.EuiSwitch,d()({},r.defaultOutputInput.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentIntegrations}.",values:{boldAgentIntegrations:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentIntegrationsBold",defaultMessage:"agent integrations"}))}})}))),n.a.createElement(g.EuiFormRow,d()({fullWidth:!0},r.defaultMonitoringOutputInput.formRowProps),n.a.createElement(g.EuiSwitch,d()({},r.defaultMonitoringOutputInput.props,{label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultMontoringOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentMonitoring}.",values:{boldAgentMonitoring:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentMonitoringBold",defaultMessage:"agent monitoring"}))}})}))),S&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(g.EuiFormRow,{fullWidth:!0,label:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningLabel",defaultMessage:"Performance tuning"}),helpText:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningHelpText",defaultMessage:"Performance tuning presets are curated output settings for common use cases. You can also select {custom} to specify your own settings in the Advanced YAML Configuration box below. For a detailed list of settings configured by each preset, see {link}.",values:{custom:n.a.createElement("strong",null,"Custom"),link:n.a.createElement(g.EuiLink,{href:o.links.fleet.performancePresets,external:!0,target:"_blank"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningHelpTextLink",defaultMessage:"our documentation"}))}})},n.a.createElement(g.EuiSelect,d()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.presetInput"},r.presetInput.props,{onChange:e=>r.presetInput.setValue(e.target.value),disabled:r.presetInput.props.disabled||Object(Ei.d)(r.additionalYamlConfigInput.value,Ol.safeLoad),options:[{value:"balanced",text:"Balanced"},{value:"custom",text:"Custom"},{value:"throughput",text:"Throughput"},{value:"scale",text:"Scale"},{value:"latency",text:"Latency"}]})))),S&&Object(Ei.d)(r.additionalYamlConfigInput.value,Ol.safeLoad)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiCallOut,{color:"warning",iconType:"alert",size:"s",title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningMustBeCustomWarning",defaultMessage:'Performance tuning preset must be "Custom" due to presence of reserved key in advanced YAML configuration'})},n.a.createElement(g.EuiAccordion,{id:"performanceTuningMustBeCustomWarningDetails",buttonContent:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningMustBeCustomWarningDetails",defaultMessage:"Show reserved keys"})},n.a.createElement("ul",null,Z.Bb.map((e=>n.a.createElement("li",{key:e},n.a.createElement(g.EuiCode,null,e)))))))),n.a.createElement(g.EuiSpacer,{size:"l"}),n.a.createElement(g.EuiFormRow,d()({label:n.a.createElement(g.EuiLink,{href:o.links.fleet.esSettings,external:!0,target:"_blank"},b.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputLabel",{defaultMessage:"Advanced YAML configuration"}))},r.additionalYamlConfigInput.formRowProps,{fullWidth:!0}),n.a.createElement(Ci,{value:r.additionalYamlConfigInput.value,onChange:e=>{Object(Ei.d)(e,Ol.safeLoad)&&r.presetInput.setValue("custom"),r.additionalYamlConfigInput.setValue(e)},disabled:r.additionalYamlConfigInput.props.disabled,placeholder:b.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputPlaceholder",{defaultMessage:"# YAML settings here will be added to the output section of each agent policy."})})),n.a.createElement(Zi,{enabled:s.isShipperEnabled,inputs:r})),null!=a&&a.id&&"remote_elasticsearch"===a.type?n.a.createElement(In,{output:a}):null),n.a.createElement(g.EuiFlyoutFooter,null,n.a.createElement(g.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButtonEmpty,{onClick:t,flush:"left"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{fill:!0,isLoading:s.isLoading,isDisabled:s.isDisabled,onClick:s.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},os=Object(Un.b)((()=>{var e,t,a,i,s,u,d,m,E;Object(c.zb)("settings");const f=Object(r.useHistory)(),y=Object(c.Lb)(),{outputs:h,fleetServerHosts:k,downloadSources:v,proxies:x}={outputs:Object(c.Yb)(),fleetServerHosts:Object(c.Ub)(),downloadSources:Object(c.Qb)(),proxies:Object(c.Tb)()},F=null===(e=h.data)||void 0===e?void 0:e.items.filter((e=>!e.is_internal)),M=null===(t=k.data)||void 0===t?void 0:t.items.filter((e=>!e.is_internal)),{deleteOutput:S}=function(e){const{confirm:t}=Object(Un.a)(),{notifications:a}=Object(c.sc)();return{deleteOutput:Object(l.useCallback)((async l=>{try{const{agentCount:a,agentPolicyCount:i}=await Xn(l);if(!await t(n.a.createElement(Jn,null),n.a.createElement(Zn,{output:l,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:b.i18n.translate("xpack.fleet.settings.deleteOutputs.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(c.s)(l.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.deleteOutputs.errorToastTitle",{defaultMessage:"Error deleting output"})})}}),[t,a.toasts,e])}}(h.resendRequest),{deleteDownloadSource:I}=function(e){const{confirm:t}=Object(Un.a)(),{notifications:a}=Object(c.sc)();return{deleteDownloadSource:Object(l.useCallback)((async l=>{try{const{agentCount:a,agentPolicyCount:i}=await ai(l);if(!await t(n.a.createElement(ri,null),n.a.createElement(oi,{"data-test-subj":"editDownloadSourcesDeleteModal.confirmModalText",downloadSource:l,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:b.i18n.translate("xpack.fleet.settings.deleteDownloadSource.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(c.o)(l.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.deleteDownloadSource.errorToastTitle",{defaultMessage:"Error deleting agent binary source."})})}}),[t,a.toasts,e])}}(v.resendRequest),{deleteFleetServerHost:j}=function(e){const{confirm:t}=Object(Un.a)(),{notifications:a}=Object(c.sc)();return{deleteFleetServerHost:Object(l.useCallback)((async l=>{try{if(!await t(n.a.createElement(ei,null),n.a.createElement(ti,null),{buttonColor:"danger",confirmButtonText:b.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.confirmButtonLabel",{defaultMessage:"Delete and deploy changes"})}))return;const a=await Object(c.q)(l.id);if(a.error)throw a.error;e()}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.errorToastTitle",{defaultMessage:"Error deleting Fleet Server hosts"})})}}),[t,a.toasts,e])}}(k.resendRequest),{deleteFleetProxy:C}=function(e){const{confirm:t}=Object(Un.a)(),{notifications:a}=Object(c.sc)();return{deleteFleetProxy:Object(l.useCallback)((async l=>{try{if(!await t(n.a.createElement(Qn,null),n.a.createElement(Yn,null),{buttonColor:"danger",confirmButtonText:b.i18n.translate("xpack.fleet.settings.deleteFleetProxy.confirmButtonLabel",{defaultMessage:"Delete and deploy changes"})}))return;const a=await Object(c.p)(l.id);if(a.error)throw a.error;e()}catch(e){a.toasts.addError(e,{title:b.i18n.translate("xpack.fleet.settings.deleteFleetProxy.errorToastTitle",{defaultMessage:"Error deleting proxy"})})}}),[t,a.toasts,e])}}(x.resendRequest),A=h.resendRequest,P=v.resendRequest,L=k.resendRequest,_=x.resendRequest,D=Object(l.useCallback)((()=>{y.closeFleetServerFlyout(),A(),P(),L(),_(),f.replace(O.v.settings()[1])}),[y,A,P,L,_,f]),{cloud:B}=Object(c.sc)();return h.isLoading&&h.isInitialRequest||!F||k.isLoading&&k.isInitialRequest||!M||v.isLoading&&v.isInitialRequest||null===(a=v.data)||void 0===a||!a.items||x.isLoading&&x.isInitialRequest||null===(i=x.data)||void 0===i||!i.items?n.a.createElement(w.a,{section:"settings"},n.a.createElement(T.p,null)):n.a.createElement(w.a,{section:"settings"},n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.settings_edit_fleet_server_hosts},(e=>{var t,a;const l=M.find((t=>e.match.params.itemId===t.id));return l?n.a.createElement(g.EuiPortal,null,n.a.createElement($n,{proxies:null!==(t=null===(a=x.data)||void 0===a?void 0:a.items)&&void 0!==t?t:[],onClose:D,fleetServerHost:l})):n.a.createElement(r.Redirect,{to:O.k.settings})})),n.a.createElement(o.b,{path:O.k.settings_create_fleet_server_hosts},n.a.createElement(g.EuiPortal,null,null!=B&&B.isServerlessEnabled?n.a.createElement($n,{proxies:null!==(s=null===(u=x.data)||void 0===u?void 0:u.items)&&void 0!==s?s:[],onClose:D,defaultFleetServerHost:null===(d=k.data)||void 0===d?void 0:d.items.find((e=>e.id===Z.Db))}):n.a.createElement(T.l,{onClose:D}))),n.a.createElement(o.b,{path:O.k.settings_create_outputs},n.a.createElement(g.EuiPortal,null,n.a.createElement(rs,{proxies:x.data.items,onClose:D,defaultOuput:null===(m=h.data)||void 0===m?void 0:m.items.find((e=>e.id===Z.Eb))}))),n.a.createElement(o.b,{path:O.k.settings_create_fleet_proxy},n.a.createElement(g.EuiPortal,null,n.a.createElement(pi,{onClose:D}))),n.a.createElement(o.b,{path:O.k.settings_edit_fleet_proxy},(e=>{var t;const a=null===(t=x.data)||void 0===t?void 0:t.items.find((t=>e.match.params.itemId===t.id));return a?n.a.createElement(g.EuiPortal,null,n.a.createElement(pi,{onClose:D,fleetProxy:a})):n.a.createElement(r.Redirect,{to:O.k.settings})})),n.a.createElement(o.b,{path:O.k.settings_edit_outputs},(e=>{var t,a,l;const i=F.find((t=>e.match.params.outputId===t.id));return i?n.a.createElement(g.EuiPortal,null,n.a.createElement(rs,{proxies:null!==(t=null===(a=x.data)||void 0===a?void 0:a.items)&&void 0!==t?t:[],onClose:D,output:i,defaultOuput:null===(l=h.data)||void 0===l?void 0:l.items.find((e=>e.id===Z.Eb))})):n.a.createElement(r.Redirect,{to:O.k.settings})})),n.a.createElement(o.b,{path:O.k.settings_create_download_sources},n.a.createElement(g.EuiPortal,null,n.a.createElement(si,{onClose:D,proxies:(null==x||null===(E=x.data)||void 0===E?void 0:E.items)||[]}))),n.a.createElement(o.b,{path:O.k.settings_edit_download_sources},(e=>{var t,a;const l=null===(t=v.data)||void 0===t?void 0:t.items.find((t=>e.match.params.downloadSourceId===t.id));return l?n.a.createElement(g.EuiPortal,null,n.a.createElement(si,{onClose:D,downloadSource:l,proxies:(null==x||null===(a=x.data)||void 0===a?void 0:a.items)||[]})):n.a.createElement(r.Redirect,{to:O.k.settings})}))),n.a.createElement(Hn,{deleteFleetProxy:C,proxies:x.data.items,outputs:F,fleetServerHosts:M,deleteOutput:S,deleteFleetServerHost:j,downloadSources:v.data.items,deleteDownloadSource:I}))})),cs=({value:e})=>n.a.createElement(Ti.CodeEditor,{isCopyable:!0,languageId:"",height:"600px",width:"100%",options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,lineDecorationsWidth:0,overviewRulerBorder:!1},value:e}),us=async()=>{const e=await Object(c.w)({full:!0,perPage:O.t,sortOrder:"asc"});if(e.error)throw new Error(e.error.message);return e},ds=()=>{var e,t;const{getHref:a}=Object(c.jc)(),[i,s]=Object(l.useState)(),{data:r,status:o}=Object(k.useQuery)(["debug-agent-policies"],us),u=null!==(e=null==r||null===(t=r.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[],d=u.map((e=>({label:`${e.name} - ${e.id}`,value:e.id}))),m=i?[d.find((e=>e.value===i))]:[],p=u.find((e=>e.id===i)),E=()=>{s(void 0),js.invalidateQueries(["debug-agent-policies"])};return"error"===o?n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.fetchError",defaultMessage:"Error fetching Agent Policies"})):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.description",defaultMessage:"Search for an Agent Policy using its name or {codeId} value. Use the code block below to diagnose any potential issues with the policy's configuration.",values:{codeId:n.a.createElement(g.EuiCode,null,"id")}}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(gs,{grow:!1},n.a.createElement(g.EuiComboBox,{"aria-label":b.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),placeholder:b.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),fullWidth:!0,options:d,singleSelection:{asPlainText:!0},selectedOptions:m,isLoading:"loading"===o,onChange:e=>{e.length?s(e[0].value):s(void 0)}})),i&&n.a.createElement(A.c,{hasFleetServer:Object(D.q)(p)},(e=>n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(g.EuiButton,{color:"danger",onClick:()=>e(i,E)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.policyForm.deletePolicyActionText",defaultMessage:"Delete policy"}))))))),i&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiLink,{target:"_blank",href:a("policy_details",{policyId:i})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(cs,{value:JSON.stringify(p,null,2)})))};var gs=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1uw5h1v-0"})(["min-width:600px;"]),ms=a(56);const ps=async()=>{var e;const t=await Object(c.M)({prerelease:!0});if(t.error)throw new Error(t.error.message);return null===(e=t.data)||void 0===e?void 0:e.items.filter((({status:e})=>"installed"===e))},Es=()=>{var e,t,a,i,s;const{http:r,notifications:o}=Object(c.sc)(),{getHref:u}=Object(c.jc)(),[d,m]=Object(l.useState)(),[p,E]=Object(l.useState)(!1),[y,h]=Object(l.useState)(!1),v=Object(k.useQuery)(["debug-integrations"],ps),x=Object(k.useMutation)((async e=>{const t=await Object(c.nb)(e.name,e.version,!0);if(t.error)throw o.toasts.addError(t.error,{title:b.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.error",{defaultMessage:"Error uninstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),h(!1),new Error(t.error.message);return o.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.success",{defaultMessage:"Successfully uninstalled {integrationTitle}",values:{integrationTitle:e.title}})),m(void 0),h(!1),js.invalidateQueries(["debug-integrations"]),t.data})),F=Object(k.useMutation)((async e=>{const t=await Object(c.nb)(e.name,e.version,!0);if(t.error)throw o.toasts.addError(t.error,{title:b.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),E(!1),new Error(t.error.message);const a=await Object(c.P)(e.name,e.version);if(a.error)throw o.toasts.addError(new Error(a.error.message),{title:b.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:a.error.message}),E(!1),new Error(a.error.message);return o.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.success",{defaultMessage:"Successfully reinstalled {integrationTitle}",values:{integrationTitle:e.title}})),m(void 0),E(!1),js.invalidateQueries(["debug-integrations"]),a.data}));if("error"===v.status)return n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.fetchError",defaultMessage:"Error fetching installed Integrations"}));const M=null!==(e=null===(t=v.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id,icon:Object(ms.a)(e,r.basePath)}))))&&void 0!==e?e:[],S=d?[M.find((e=>e.value===d))]:[],I=null===(a=v.data)||void 0===a?void 0:a.find((e=>e.id===d));return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.description",defaultMessage:"Use this tool to uninstall or reinstall installed integrations."})),n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallationDescription",defaultMessage:"Reinstalling an integration will uninstall and then immediately install it again. This can be useful in restoring broken or malformed integration installations when a user hasn't done much customization."}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(fs,{grow:!1},n.a.createElement(g.EuiComboBox,{"aria-label":b.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),placeholder:b.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),fullWidth:!0,options:M,singleSelection:{asPlainText:!0},selectedOptions:S,isDisabled:"loading"===v.status,prepend:S.length>0?n.a.createElement(g.EuiButtonEmpty,null,n.a.createElement(g.EuiIcon,{type:null!==(i=null===(s=S[0])||void 0===s?void 0:s.icon)&&void 0!==i?i:"fleetApp"})):void 0,renderOption:(e,t,a)=>n.a.createElement("span",{className:a},n.a.createElement(g.EuiIcon,{type:e.icon})," ",n.a.createElement(g.EuiHighlight,{search:t},e.label)),onChange:e=>{e.length?m(e[0].value):m(void 0)}})),I&&n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"primary",onClick:()=>E(!0)},"Reinstall")),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement(g.EuiButton,{color:"danger",onClick:()=>h(!0)},"Uninstall")),p&&n.a.createElement(g.EuiConfirmModal,{title:`Reinstall ${I.title}`,onCancel:()=>E(!1),onConfirm:()=>F.mutate(I),isLoading:F.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelReinstall",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmReinstall",{defaultMessage:"Reinstall"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallModal",defaultMessage:"Are you sure you want to reinstall {integrationTitle}?",values:{integrationTitle:I.title}})),y&&n.a.createElement(g.EuiConfirmModal,{title:`Uninstall ${I.title}`,onCancel:()=>h(!1),onConfirm:()=>x.mutate(I),isLoading:x.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelUninstall",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmUninstall",{defaultMessage:"Uninstall"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.uninstallModal",defaultMessage:"Are you sure you want to uninstall {integrationTitle}?",values:{integrationTitle:I.title}})))),I&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiLink,{target:"_blank",href:u("integration_details_overview",{pkgkey:Object(D.p)({name:I.name,version:I.version})})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.viewIntegrationLink",defaultMessage:"View integration settings in Integrations UI"}))))};var fs=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-xg6n36-0"})(["min-width:600px;"]);const bs=Object(l.forwardRef)((({name:e,setName:t,type:a,setNamesStatus:i},s)=>{const{data:r,refetch:o,status:u}=Object(k.useQuery)(["debug-saved-object-names",a],(()=>(async e=>{var t;const a=await Object(c.ob)({method:"post",path:j.l.getSavedObjectNamesPath(),body:{type:e},version:Z.o.internal.v1});if(a.error)throw new Error(a.error.message);return null===(t=a.data)||void 0===t?void 0:t.aggregations.names.buckets})(a)),{refetchOnWindowFocus:!1});null==i||i(u),Object(l.useImperativeHandle)(s,(()=>({refetchNames:o})));const d=(null!=r?r:[]).map((e=>({label:e.key,value:e.key}))),m=d.find((t=>t.value===e)),p=m?[m]:[];return n.a.createElement(g.EuiComboBox,{prepend:"Name","aria-label":b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),placeholder:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),fullWidth:!0,options:d,singleSelection:{asPlainText:!0},selectedOptions:p,isLoading:"loading"===u,onChange:e=>{e.length?t(e[0].value):t(void 0)}})})),ys=()=>{const e=[{value:`${Z.m}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.agentPolicyLabel",{defaultMessage:"Agent policy"})},{value:`${Z.vb}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packagePolicyLabel",{defaultMessage:"Integration policy"})},{value:`${Z.qb}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.outputLabel",{defaultMessage:"Output"})},{value:`${Z.sb}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packageLabel",{defaultMessage:"Packages"})},{value:`${Z.z}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.downloadSourceLabel",{defaultMessage:"Download Sources"})},{value:`${Z.Z}`,text:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.fleetServerHostLabel",{defaultMessage:"Fleet Server Hosts"})}],[t,a]=Object(l.useState)(e[0].value),[i,s]=Object(l.useState)(),[r,o]=Object(l.useState)(),u=Object(l.useRef)(),{data:d,status:m}=Object(k.useQuery)(["debug-saved-objects",t,i],(()=>(async(e,t)=>{var a;if(!e||!t)return;const l=await Object(c.ob)({method:"post",path:j.l.getSavedObjectsPath(),body:{type:e,name:t},version:Z.o.internal.v1});if(l.error)throw new Error(l.error.message);return null===(a=l.data)||void 0===a?void 0:a.saved_objects})(t,i)));return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.description",defaultMessage:"Search for Fleet-related saved objects by selecting a type and name. Use the code block below to diagnose any potential issues."}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(hs,{grow:!1},n.a.createElement(g.EuiFormRow,null,n.a.createElement(g.EuiSelect,{prepend:"Type",id:"soType",options:e,value:t,onChange:e=>(e=>{a(e.target.value),s(void 0),u.current.refetchNames()})(e),"aria-label":b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectTypeLabel",{defaultMessage:"Select saved object type"})}))),n.a.createElement(ks,{grow:!1},n.a.createElement(g.EuiFormRow,null,n.a.createElement(bs,{name:i,setName:s,type:t,setNamesStatus:o,ref:u})))),d&&("error"===m||"error"===r)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.fetchError",defaultMessage:"Error fetching Saved Objects"}))),(d||"loading"===m)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(cs,{value:JSON.stringify(d,null,2)})))};var hs=L()(g.EuiFlexItem)`
            min-width: 300px;
          `,ks=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem2",componentId:"sc-1ovx3fm-0"})(["min-width:400px;"]);const vs=async()=>{var e,t;const a=`${O.e}.is_preconfigured:true`,l=await Object(c.w)({kuery:a,perPage:O.t,full:!0});if(l.error)throw new Error(l.error.message);return null!==(e=null===(t=l.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},xs=()=>{var e,t,a,i;const{getHref:s}=Object(c.jc)(),{notifications:r}=Object(c.sc)(),[o,u]=Object(l.useState)(),[d,m]=Object(l.useState)(!1),[p,E]=Object(l.useState)(!1),y=Object(k.useQuery)(["debug-preconfigured-policies"],vs),h=null!==(e=null===(t=y.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],v=o?[h.find((({value:e})=>e===o))]:[],x=null===(a=y.data)||void 0===a?void 0:a.find((e=>e.id===o)),F=Object(k.useMutation)((async e=>{const t=await Object(c.rb)(e);if(t.error)throw r.toasts.addError(t.error,{title:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetError",{defaultMessage:"Error resetting policy"}),toastMessage:t.error.message}),new Error(t.error.message);return r.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetSuccess",{defaultMessage:"Successfully reset policy"})),js.invalidateQueries(["debug-preconfigured-policies"]),u(void 0),m(!1),t.data})),M=Object(k.useMutation)((async()=>{const e=await Object(c.qb)();if(e.error)throw r.toasts.addError(e.error,{title:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllError",{defaultMessage:"Error resetting policies"}),toastMessage:e.error.message}),new Error(e.error.message);return r.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllSuccess",{defaultMessage:"Successfully reset policies"})),js.invalidateQueries(["debug-preconfigured-policies"]),u(void 0),E(!1),e.data}));return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.description",defaultMessage:"This tool can be used to reset preconfigured policies that are managed via {codeKibanaYml}. This includes Fleet's default policies that may exist in cloud environments.",values:{codeKibanaYml:n.a.createElement(g.EuiCode,null,"kibana.yml")}})),n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetInstructions",defaultMessage:'You may reset a single preconfigured policy or use the "Reset all" button to reset all preconfigured policies at once.'}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(Fs,{grow:!1},n.a.createElement(g.EuiComboBox,{"aria-label":b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),placeholder:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),fullWidth:!0,options:h,singleSelection:{asPlainText:!0},selectedOptions:v,onChange:e=>{e.length?u(e[0].value):u(void 0)}})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(g.EuiButton,{color:"warning",isDisabled:!o,onClick:()=>m(!0)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetButton",defaultMessage:"Reset"})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(g.EuiButton,{color:"danger",isDisabled:!(null!==(i=y.data)&&void 0!==i&&i.length),onClick:()=>E(!0)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllButton",defaultMessage:"Reset all"}))))),d&&x&&o&&n.a.createElement(g.EuiConfirmModal,{title:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalTitle",{defaultMessage:"Reset {policyName}",values:{policyName:x.name}}),onCancel:()=>m(!1),onConfirm:()=>F.mutate(o),isLoading:F.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalConfirm",{defaultMessage:"Reset"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetModalBody",defaultMessage:"Are you sure you want to reset {policyName}?",values:{policyName:x.name}})),p&&n.a.createElement(g.EuiConfirmModal,{title:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalTitle",{defaultMessage:"Reset all preconfigured policies"}),onCancel:()=>E(!1),onConfirm:()=>M.mutate(),isLoading:M.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalConfirm",{defaultMessage:"Reset all"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllModalBody",defaultMessage:"Are you sure you want to reset all preconfigured policies?"})),o&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiLink,{target:"_blank",href:s("policy_details",{policyId:o})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(cs,{value:JSON.stringify(x,null,2)})))};var Fs=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-y0mpv-0"})(["min-width:400px;"]);const Ms=()=>{var e,t,a,i;const s=[{label:H.AGENTS_INDEX,value:H.AGENTS_INDEX},{label:H.AGENT_ACTIONS_INDEX,value:H.AGENT_ACTIONS_INDEX},{label:O.g,value:O.g}],[r,o]=Object(l.useState)(),{data:u,status:d}=Object(k.useQuery)(["debug-indices",r],(()=>(async e=>{if(e)return await Object(c.ob)({method:"post",path:j.l.getIndexPath(),body:{index:e},version:H.API_VERSIONS.internal.v1})})(r)),{retry:!1}),m=r?[s.find((e=>e.value===r))]:[];return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.description",defaultMessage:"Search for the contents of Fleet indices. Use the code block below to diagnose any potential issues. "}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(g.EuiFlexItem,null,n.a.createElement(g.EuiFormRow,null,n.a.createElement(g.EuiComboBox,{prepend:"Index","aria-label":b.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),placeholder:b.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),fullWidth:!0,options:s,singleSelection:{asPlainText:!0},selectedOptions:m,isLoading:"loading"===d,onChange:e=>{e.length?o(e[0].value):o(void 0)}})))),(null==u?void 0:u.error)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger"},null!==(e=null==u||null===(t=u.error)||void 0===t||null===(a=t.error)||void 0===a?void 0:a.reason)&&void 0!==e?e:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.fetchError",defaultMessage:"Error fetching index data"}))),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(cs,{value:JSON.stringify(null===(i=u.data)||void 0===i?void 0:i.hits,null,2)})))},Ss=async()=>{var e,t;const a=await Object(c.I)();if(a.error)throw new Error(a.error.message);return null!==(e=null===(t=a.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},Is=()=>{var e;const{notifications:t}=Object(c.sc)(),[a,i]=Object(l.useState)(),[s,r]=Object(l.useState)(!1),[o,u]=Object(l.useState)(!1),{data:d}=Object(k.useQuery)(["debug-orphaned-policies"],Ss),m=null!==(e=null==d?void 0:d.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],p=a?[m.find((({value:e})=>e===a))]:[],E=null==d?void 0:d.find((e=>e.id===a)),y=Object(k.useMutation)((async e=>{const a=await Object(c.t)({packagePolicyIds:[e],force:!0});if(a.error)throw t.toasts.addError(a.error,{title:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteError",{defaultMessage:"Error deleting policy"}),toastMessage:a.error.message}),new Error(a.error.message);return t.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteSuccess",{defaultMessage:"Successfully deleted orphaned policy"})),js.invalidateQueries(["debug-orphaned-policies"]),i(void 0),r(!1),a.data})),h=Object(k.useMutation)((async()=>{const e=await Object(c.t)({packagePolicyIds:null==d?void 0:d.map((e=>e.id)),force:!0});if(e.error)throw t.toasts.addError(e.error,{title:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllError",{defaultMessage:"Error deleting orphaned policies"}),toastMessage:e.error.message}),new Error(e.error.message);return t.toasts.addSuccess(b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllSuccess",{defaultMessage:"Successfully deleted all orphaned policies"})),js.invalidateQueries(["debug-orphaned-policies"]),i(void 0),u(!1),e.data}));return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.description",defaultMessage:'This tool can be used to delete "orphaned" integration policies that have been unlinked from their parent agent policy objects'})),n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteOptions",defaultMessage:'You may delete a single orphaned integration policy or use the "Delete all" button to delete all orphaned integration policies at once.'}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,null,n.a.createElement(Ts,{grow:!1},n.a.createElement(g.EuiComboBox,{"aria-label":b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),placeholder:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),fullWidth:!0,options:m,singleSelection:{asPlainText:!0},selectedOptions:p,onChange:e=>{e.length?i(e[0].value):i(void 0)}})),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(g.EuiButton,{color:"warning",isDisabled:!a,onClick:()=>r(!0)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteButton",defaultMessage:"Delete"})))),n.a.createElement(g.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(g.EuiButton,{color:"danger",isDisabled:!(null!=d&&d.length),onClick:()=>u(!0)},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllButton",defaultMessage:"Delete all"}))))),s&&E&&a&&n.a.createElement(g.EuiConfirmModal,{title:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalTitle",{defaultMessage:"Delete {policyName}",values:{policyName:E.name}}),onCancel:()=>r(!1),onConfirm:()=>y.mutate(a),isLoading:y.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDelete",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDelete",{defaultMessage:"Delete"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalBody",defaultMessage:"Are you sure you want to delete {policyName}?",values:{policyName:E.name}})),o&&n.a.createElement(g.EuiConfirmModal,{title:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalTitle",{defaultMessage:"Delete all orphaned integration policies"}),onCancel:()=>u(!1),onConfirm:()=>h.mutate(),isLoading:h.isLoading,cancelButtonText:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDeleteAll",{defaultMessage:"Cancel"}),confirmButtonText:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDeleteAll",{defaultMessage:"Delete all"})},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalBody",defaultMessage:"Are you sure you want to delete all orphaned integration policies?"})),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(cs,{value:JSON.stringify(E,null,2)})))};var Ts=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-tbjlhb-0"})(["min-width:400px;"]);const Os=()=>{var e;const[t,a]=Object(l.useState)(),{data:i}=Object(c.Ub)(),s=Object(l.useMemo)((()=>{var e;return null!==(e=null==i?void 0:i.items)&&void 0!==e?e:[]}),[null==i?void 0:i.items]);Object(l.useEffect)((()=>{const e=s.find((e=>!0===e.is_default));e&&a(e)}),[s]);const r=Object(l.useMemo)((()=>(null==t?void 0:t.id)||""),[null==t?void 0:t.id]),[o,u]=Object(l.useState)(),[d,m]=Object(l.useState)(),{data:p}=Object(k.useQuery)(["fleetServerHealth",r],(()=>Object(c.db)({id:r})),{refetchInterval:1e4,enabled:!!r});Object(l.useEffect)((()=>{u(null==p?void 0:p.data),null!=p&&p.error&&m(p.error)}),[p]);const E=Object(l.useMemo)((()=>[...s.map((e=>({inputDisplay:`${e.name} (${e.host_urls[0]})`,value:e.id})))]),[s]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.description",defaultMessage:"Select the host used to enroll Fleet Server. The connection is refreshed every {interval}s.",values:{interval:10}}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(ws,{grow:!1},n.a.createElement(g.EuiSuperSelect,{fullWidth:!0,"data-test-subj":"fleetDebug.fleetServerHostsSelect",prepend:n.a.createElement(g.EuiText,{size:"relative",color:""},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.fleetServerHostsLabel",defaultMessage:"Fleet Server Hosts"})),onChange:e=>{u(void 0),a(s.find((t=>t.id===e)))},valueOfSelected:null==t?void 0:t.id,options:E})),n.a.createElement(g.EuiFlexItem,{grow:!1},null!=o&&o.status&&r===(null==o?void 0:o.host_id)?n.a.createElement(g.EuiFlexGroup,{alignItems:"center"},n.a.createElement(g.EuiFlexItem,null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.status",defaultMessage:"Status:"})),n.a.createElement(g.EuiFlexItem,null,(e=>{if(!e)return null;let t;switch(e){case"HEALTHY":t="success";break;case"UNHEALTHY":t="warning";break;default:t="subdued"}return n.a.createElement(g.EuiHealth,{color:t},e)})(null==o?void 0:o.status))):null)),d&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCallOut,{title:"Error",color:"danger"},null!==(e=null==d?void 0:d.message)&&void 0!==e?e:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.fetchError",defaultMessage:"Message: {errorMessage}",values:{errorMessage:null==d?void 0:d.message}}))))};var ws=L()(g.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1ss3z0x-0"})(["min-width:600px;"]);const js=new k.QueryClient,Cs=[{title:b.i18n.translate("xpack.fleet.debug.HealthCheckStatus.title",{defaultMessage:"Health Check Status"}),id:"healthCheckStatus",component:n.a.createElement(Os,null)},{title:b.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.title",{defaultMessage:"Agent Policy Debugger"}),id:"agentPolicyDebugger",component:n.a.createElement(ds,null)},{title:b.i18n.translate("xpack.fleet.debug.integrationDebugger.title",{defaultMessage:"Integration Debugger"}),id:"integrationDebugger",component:n.a.createElement(Es,null)},{title:b.i18n.translate("xpack.fleet.debug.savedObjectDebugger.title",{defaultMessage:"Saved Object Debugger"}),id:"savedObjectDebugger",component:n.a.createElement(ys,null)},{title:b.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.title",{defaultMessage:"Fleet Index Debugger"}),id:"fleetIndexDebugger",component:n.a.createElement(Ms,null)},{title:b.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.title",{defaultMessage:"Preconfiguration Debugger"}),id:"preconfigurationDebugger",component:n.a.createElement(xs,null)},{title:b.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.title",{defaultMessage:"Orphaned Integration Policy Debugger"}),id:"orphanedIntegrationPolicyDebugger",component:n.a.createElement(Is,null)}],As=({isInitialized:e,setupError:t})=>{const{chrome:a}=Object(c.sc)(),{getHref:l}=Object(c.jc)();return a.docTitle.change(["Debug","Fleet"]),n.a.createElement(k.QueryClientProvider,{client:js},n.a.createElement(g.EuiPage,{paddingSize:"xl"},n.a.createElement(g.EuiPageBody,{panelled:!0},n.a.createElement(g.EuiPageSection,null,n.a.createElement(g.EuiPageHeader,{pageTitle:b.i18n.translate("xpack.fleet.debug.pageTitle",{defaultMessage:"Fleet Debugging Dashboard"}),iconType:"wrench"}),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiCallOut,{color:"danger",iconType:"warning",title:"Danger zone"},n.a.createElement(g.EuiText,{grow:!1},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.description",defaultMessage:"This page provides an interface for directly managing Fleet's underlying data and diagnosing issues. Be aware that these debugging tools can be {strongDestructive} in nature and can result in {strongLossOfData}. Please proceed with caution.",values:{strongDestructive:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.destructive",defaultMessage:"destructive"})),strongLossOfData:n.a.createElement("strong",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.lossOfData",defaultMessage:"loss of data"}))}}))),!e&&(null==t?void 0:t.message)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiSpacer,{size:"s"}),n.a.createElement(g.EuiCallOut,{color:"danger",iconType:"warning",title:"Setup error"},n.a.createElement(g.EuiText,{grow:!1},n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.initializationError.description",defaultMessage:"{message}. You can use this page to debug the error.",values:{message:null==t?void 0:t.message}}))))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiPageSection,null,Cs.map((({title:e,id:t,component:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(g.EuiAccordion,{id:t,initialIsOpen:!0,buttonContent:n.a.createElement(g.EuiTitle,{size:"l"},n.a.createElement("h2",null,e))},n.a.createElement(g.EuiSpacer,{size:"m"}),a),n.a.createElement(g.EuiHorizontalRule,null)))),n.a.createElement(g.EuiTitle,{size:"l"},n.a.createElement("h2",null,n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.debug.usefulLinks.title",defaultMessage:"Useful links"}))),n.a.createElement(g.EuiSpacer,{size:"m"}),n.a.createElement(g.EuiListGroup,{listItems:[{label:b.i18n.translate("xpack.fleet.debug.usefulLinks.viewAgents",{defaultMessage:"View Agents in Fleet UI"}),href:l("agent_list"),iconType:"agentApp",target:"_blank"},{label:b.i18n.translate("xpack.fleet.debug.usefulLinks.troubleshootingGuide",{defaultMessage:"Troubleshooting Guide"}),href:"https://www.elastic.co/guide/en/fleet/current/fleet-troubleshooting.html",iconType:"popout",target:"_blank"}]})))),n.a.createElement(v.ReactQueryDevtools,{initialIsOpen:!1}))},Ps=new k.QueryClient,Ls=Object(l.memo)((({children:e})=>{Object(c.zb)("base");const t=Object(c.sc)(),{notifications:a}=t,i=Object(c.yb)(),s=i.fleet.readEnrollmentTokens||i.fleet.readAgents||i.fleet.readAgentPolicies||i.fleet.readSettings,[o,u]=Object(l.useState)(!1),[d,g]=Object(l.useState)(),[m,p]=Object(l.useState)(!1),[E,y]=Object(l.useState)(null),h=!!Object(r.useRouteMatch)(O.k.add_integration_to_policy),k=!!Object(r.useRouteMatch)(O.k.debug);return Object(l.useEffect)((()=>{(async()=>{u(!1),g(void 0),p(!1),y(null);try{var e;u(!0);const i=await Object(c.N)();if(u(!1),null!==(e=i.data)&&void 0!==e&&e.success){try{var t,l;const e=await Object(c.sb)();e.error&&y(e.error),null!==(t=e.data)&&void 0!==t&&null!==(l=t.nonFatalErrors)&&void 0!==l&&l.length&&a.toasts.addError(e.data.nonFatalErrors[0],{title:b.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})}),s||g("MISSING_PRIVILEGES")}catch(e){y(e)}p(!0)}else{var n;g((null===(n=i.data)||void 0===n?void 0:n.error)||"REQUEST_ERROR")}}catch(e){g("REQUEST_ERROR")}})()}),[a.toasts,s]),o||d?n.a.createElement(w.b,{isAddIntegrationsPath:h},o?n.a.createElement(T.p,null):n.a.createElement(w.c,{error:d})):k?n.a.createElement(As,{setupError:E,isInitialized:m}):!m||E?n.a.createElement(w.b,{isAddIntegrationsPath:h},E?n.a.createElement(T.i,{title:n.a.createElement(f.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:E}):n.a.createElement(T.m,null)):n.a.createElement(n.a.Fragment,null,e)})),_s=Object(l.memo)((({children:e,startServices:t,config:a,history:l,kibanaVersion:i,extensions:s,routerHistory:r,fleetStatus:o})=>{const u=h()(t.theme.theme$),g=u&&u.darkMode;return n.a.createElement(E.a,d()({},t,{theme:t.theme,modify:{breakpoint:{xxl:1600}}}),n.a.createElement(M.a,{coreStart:{application:t.application}},n.a.createElement(F.KibanaContextProvider,{services:{...t}},n.a.createElement(c.b.Provider,{value:a},n.a.createElement(c.e.Provider,{value:i},n.a.createElement(S.EuiThemeProvider,{darkMode:g},n.a.createElement(k.QueryClientProvider,{client:Ps},n.a.createElement(v.ReactQueryDevtools,{initialIsOpen:!1}),n.a.createElement(c.f.Provider,{value:s},n.a.createElement(c.c,{defaultFleetStatus:o},n.a.createElement(m.a,{history:l},n.a.createElement(I.e,{startServices:t},n.a.createElement(c.d,null,e))))))))))))})),Ds=Object(l.memo)((({setHeaderActionMenu:e,isReadOnly:t})=>{const a=Object(c.sc)(),{euiTheme:l}=Object(g.useEuiTheme)(),i=n.a.useMemo((()=>x.css`
        color: ${l.colors.text};
      `),[l]),{TopNavMenu:s}=a.navigation.ui,r=[];return t&&r.push({label:b.i18n.translate("xpack.fleet.appNavigation.readOnlyBtn",{defaultMessage:"Read-only"}),disableButton:!0,className:i,iconType:"glasses",tooltip:b.i18n.translate("xpack.fleet.appNavigation.readOnlyTooltip",{defaultMessage:"You can view most Fleet settings, but your current privileges don't allow you to perform all actions."}),run:()=>{}}),r.push({label:b.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")}),n.a.createElement(s,{appName:b.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:r,setMenuMountPoint:e})})),Bs=({children:e,setHeaderActionMenu:t,isReadOnly:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Ds,{setHeaderActionMenu:t,isReadOnly:a}),e),Rs=Object(l.memo)((({setHeaderActionMenu:e})=>{var t;const a=Object(c.Lb)(),l=Object(c.Kb)(),{agentTamperProtectionEnabled:i}=D.b.get(),s=Object(c.yb)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(p.a,null,n.a.createElement(o.b,{path:O.k.agents,key:O.k.agents},s.fleet.readAgents?n.a.createElement(Bs,{setHeaderActionMenu:e,isReadOnly:!s.fleet.allAgents},n.a.createElement(Va,null)):n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(w.b,{isAddIntegrationsPath:!1},n.a.createElement(w.c,{error:"MISSING_PRIVILEGES",requiredFleetRole:"Agents Read"})))),n.a.createElement(o.b,{path:O.k.policies},s.fleet.readAgentPolicies?n.a.createElement(Bs,{setHeaderActionMenu:e,isReadOnly:!s.fleet.allAgentPolicies},n.a.createElement(se,null)):n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(w.b,{isAddIntegrationsPath:!1},n.a.createElement(w.c,{error:"MISSING_PRIVILEGES",requiredFleetRole:"Agent policies Read"})))),n.a.createElement(o.b,{path:O.k.enrollment_tokens},s.fleet.allAgents?n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(rn,null)):n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(w.b,{isAddIntegrationsPath:!1},n.a.createElement(w.c,{error:"MISSING_PRIVILEGES",requiredFleetRole:"Agents All"})))),i&&n.a.createElement(o.b,{path:O.k.uninstall_tokens},s.fleet.allAgents?n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(vn,null)):n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(w.b,{isAddIntegrationsPath:!1},n.a.createElement(w.c,{error:"MISSING_PRIVILEGES",requiredFleetRole:"Agents All"})))),n.a.createElement(o.b,{path:O.k.data_streams},n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(ue,null))),n.a.createElement(o.b,{path:O.k.settings},s.fleet.readSettings?n.a.createElement(Bs,{setHeaderActionMenu:e,isReadOnly:!s.fleet.allSettings},n.a.createElement(os,null)):n.a.createElement(w.b,{isAddIntegrationsPath:!1},n.a.createElement(Bs,{setHeaderActionMenu:e},n.a.createElement(w.c,{error:"MISSING_PRIVILEGES",requiredFleetRole:"Settings Read"})))),n.a.createElement(o.b,{path:O.k.add_integration_to_policy},n.a.createElement(en,null)),n.a.createElement(o.b,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0)){const e=s.fleet.readAgents?O.k.agents:s.fleet.readAgentPolicies?O.k.policies:O.k.settings;return n.a.createElement(r.Redirect,{to:e})}const t=e.hash.replace(/^#(\/fleet)?/,"");return n.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}})),a.isEnrollmentFlyoutOpen&&n.a.createElement(g.EuiPortal,null,n.a.createElement(T.c,{defaultMode:!l.isReady||null!==(t=l.missingRequirements)&&void 0!==t&&t.includes("fleet_server")?"standalone":"managed",isIntegrationFlow:!0,onClose:()=>a.closeEnrollmentFlyout()})),a.isFleetServerFlyoutOpen&&n.a.createElement(g.EuiPortal,null,n.a.createElement(T.l,{onClose:()=>a.closeFleetServerFlyout()})))})),zs=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?n.a.createElement(o.b,a):n.a.createElement(r.Redirect,{to:{pathname:t}}),Ns=({startServices:e,config:t,history:a,kibanaVersion:l,extensions:i,setHeaderActionMenu:s})=>n.a.createElement(_s,{startServices:e,config:t,history:a,kibanaVersion:l,extensions:i},n.a.createElement(Ls,null,n.a.createElement(Rs,{setHeaderActionMenu:s})));function Hs(e,{element:t,history:a,setHeaderActionMenu:l},i,r,o){return s.a.render(n.a.createElement(Ns,{startServices:e,config:i,history:a,kibanaVersion:r,extensions:o,setHeaderActionMenu:l}),t),()=>{s.a.unmountComponentAtNode(t)}}const Us=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),c.g.stop()}}}]);