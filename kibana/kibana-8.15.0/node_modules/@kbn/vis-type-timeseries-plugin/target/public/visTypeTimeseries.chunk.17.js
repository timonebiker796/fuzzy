(window.visTypeTimeseries_bundle_jsonpfunction=window.visTypeTimeseries_bundle_jsonpfunction||[]).push([[17],{212:function(e,o,t){"use strict";t.r(o),t.d(o,"convertToLens",(function(){return f}));var r=t(11),n=t(34),s=t(35),a=t(5),l=t(0),i=t(79);const c=(e,o,t)=>{var r;const n=t?Object(i.a)(null!==(r=t.color_rules)&&void 0!==r?r:[]):void 0;return{columnId:e,alignment:"left",colorMode:n?"text":"none",...n?{palette:n}:{},...o?{collapseFn:o}:{}}};var u=t(75),g=t(65),d=t(57),p=t(63);const v=()=>new Error("Invalid model"),f=async({params:e,uiState:o},t)=>{const i=[],f=Object(l.d)();try{var m,_;const l=e.series.filter((e=>!e.hidden)),b=l.length,h=null!==(m=null===(_=o.get("table"))||void 0===_?void 0:_.sort)&&void 0!==m?m:{},y=await Object(u.a)(e.index_pattern,e.time_field,!1,void 0,void 0,f);if(!y)throw v();const{indexPatternId:x,indexPattern:w}=y,j=Object(g.a)(void 0,{split_mode:"terms",terms_field:e.pivot_id,terms_size:e.pivot_rows?e.pivot_rows.toString():void 0},[],w,!1,e.pivot_label,!1);if(!j)throw v();const I={columnId:j[0].columnId,direction:h.order};i.push(c(j[0].columnId));let O=[];if(!e.series.every((o=>!((o.aggregate_by||e.series[0].aggregate_by)&&o.aggregate_by!==e.series[0].aggregate_by||(o.aggregate_function||e.series[0].aggregate_function)&&o.aggregate_function!==e.series[0].aggregate_function))))throw v();if(e.series[0].aggregate_by){if(!e.series[0].aggregate_function||!["sum","mean","min","max"].includes(e.series[0].aggregate_function))throw v();if(O=Object(g.a)(void 0,{split_mode:"terms",terms_field:e.series[0].aggregate_by},[],w,!1),null===O)throw v();i.push(c(O[0].columnId,"mean"===e.series[0].aggregate_function?"avg":e.series[0].aggregate_function))}const M=[];for(const[o,r]of e.series.entries()){if(r.hidden)continue;if(r.offset_time&&"invalid"===Object(n.parseTimeShift)(r.offset_time))throw v();if(!Object(d.i)(r.metrics,a.e.TABLE,r.time_range_mode))throw v();const o=Object(d.g)(e,r,t),s=Object(g.b)(r,w,b,{reducedTimeRange:o});if(!s)throw v();i.push(c(s[0].columnId,void 0,r)),h.column===r.id&&(I.columnId=s[0].columnId),M.push(...s)}if(!M.length||M.every((e=>"static_value"===e.operationType)))throw v();const T={ignoreGlobalFilters:Boolean(e.ignore_global_filter||l.some((({ignore_global_filter:e})=>e))),indexPatternId:x,layerId:Object(r.v4)(),columns:[...M,...j,...O],columnOrder:[]},S=Object.values((e=>{const o={};return Object.entries(e).forEach((([e,t])=>{const r=t.columns.map(p.t);o[e]={...t,columns:r}})),o})({0:T}));return{type:"lnsDatatable",layers:S,configuration:{columns:i,layerId:T.layerId,layerType:"data",sorting:I},indexPatternIds:Object(s.getIndexPatternIds)(S)}}catch(e){return null}}},79:function(e,o,t){"use strict";t.d(o,"a",(function(){return c}));var r=t(54),n=t.n(r),s=t(10);const a="lte",l=e=>{var o;return(e=>{var o;const t=e;return!!(null!==(o=t.background_color)&&void 0!==o?o:t.color)})(e)?null!==(o=e.background_color)&&void 0!==o?o:e.color:(e=>Boolean(e.gauge))(e)?e.gauge:e.text},i=e=>({name:"custom",params:{continuity:"all",maxSteps:5,name:"custom",progression:"fixed",rangeMax:1/0,rangeMin:-1/0,rangeType:"number",reverse:!1,...e},type:"palette"}),c=(e,o)=>{const t=e.filter((e=>(e=>{var o,t;const{background_color:r,color:n}=e,{gauge:s}=e,{text:a}=e;return Boolean(e.operator&&(null!==(o=null!==(t=null!=r?r:n)&&void 0!==t?t:s)&&void 0!==o?o:a)&&void 0!==e.value)})(e)));if(t.sort(((e,o)=>e.value-o.value)),!Object(s.uniqBy)(t,"operator").length)return;if(1===t.length)return t[0].operator===a?i((e=>{const o={color:n()(l(e)).hex(),stop:e.value};return{rangeMin:-1/0,rangeMax:e.value,colorStops:[o],stops:[o],steps:1,continuity:"below"}})(t[0])):"gte"===t[0].operator?i(((e,o)=>{const t={color:n()(l(e)).hex(),stop:e.value};return{colorStops:[...o?[{color:o,stop:-1/0}]:[],t],continuity:o?"all":"above",rangeMax:1/0,rangeMin:o?-1/0:t.stop,steps:2,stops:[...o?[{color:o,stop:t.stop}]:[],{color:t.color,stop:1/0}]}})(t[0],o)):void 0;const r=t.slice(0,-1),c=t[t.length-1],u=Object(s.uniqBy)(r,"operator");if(u.length>1||u[0].operator!==c.operator&&c.operator!==a)return;const[g]=u;if(g.operator!==a){if("lt"===g.operator){if(c.operator!==a)return;return i((e=>{const o=e[e.length-1],t=e.reduce(((e,o,t,r)=>{if(0===t)return[{color:n()(l(o)).hex(),stop:-1/0}];const s=l(o);return[...e,{color:n()(s).hex(),stop:r[t-1].value}]}),[]),r=t.reduce(((e,t,r,n)=>r===n.length-1?[...e,{color:t.color,stop:o.value}]:[...e,{color:t.color,stop:n[r+1].stop}]),[]);return{rangeMin:-1/0,rangeMax:o.value,colorStops:t,stops:r,steps:t.length+1,continuity:"below"}})(t))}return"gte"===g.operator?i(((e,o,t)=>{const r=e[e.length-1],s=l(r),i=t?[{stop:-1/0,color:t}]:[],c=e.reduce(((e,t,r,i)=>{const c=l(t);return r===i.length-1&&o===a?e:r===i.length-2&&o===a?[...e,{color:n()(s).hex(),stop:t.value}]:[...e,{color:n()(c).hex(),stop:t.value}]}),i),u=c.reduce(((e,t,n,s)=>n===s.length-1?[...e,{color:t.color,stop:o===a?r.value:t.stop+1}]:[...e,{color:t.color,stop:s[n+1].stop}]),[]),[g]=e;return{rangeMin:t?-1/0:g.value,rangeMax:o===a?r.value:1/0,colorStops:c,stops:u,steps:c.length,continuity:o===a?t?"below":"none":t?"all":"above"}})(t,c.operator,o)):void 0}}}}]);