/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[13],{107:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a(2),n=a(12),s=a(1),o=a.n(s),l=a(60),c=a(0);const r=o.a.memo((({value:e,onChange:t})=>{const a=Object.keys(l.h).map((e=>({id:e,label:e})));return Object(c.jsx)(i.EuiButtonGroup,{legend:n.i18n.translate("xpack.aiops.changePointDetection.selectFunctionLabel",{defaultMessage:"Function"}),options:a,idSelected:e,onChange:e=>t(e),isFullWidth:!0,buttonSize:"compressed"})}))},108:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(1),n=a.n(i),s=a(12),o=a(2),l=a(49),c=a(43),r=a(0);const u=n.a.memo((({value:e,onChange:t,inline:a=!0})=>{var u;const{fieldStats:d}=Object(c.b)(),{metricFieldOptions:p}=Object(l.d)(),{renderOption:b,closeFlyout:g}=null!==(u=null==d?void 0:d.useFieldStatsTrigger())&&void 0!==u?u:{},j=Object(i.useMemo)((()=>p.map((e=>({value:e.name,label:e.displayName,field:{id:e.name,type:e.type}})))),[p]),h=j.filter((t=>t.value===e)),m=Object(i.useCallback)((e=>{const a=e[0];void 0!==a&&t(a.value),g&&g()}),[t,g]),x=s.i18n.translate("xpack.aiops.changePointDetection.selectMetricFieldLabel",{defaultMessage:"Metric field"});return Object(r.jsx)(n.a.Fragment,null,Object(r.jsx)(o.EuiFormRow,{fullWidth:!0,label:a?void 0:x},Object(r.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:a?x:void 0,singleSelection:{asPlainText:!0},options:j,selectedOptions:h,onChange:m,isClearable:!1,"data-test-subj":"aiopsChangePointMetricField",renderOption:b})))}))},109:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(1),n=a.n(i),s=a(12),o=a(2),l=a(43),c=a(49),r=a(0);const u=n.a.memo((({value:e,onChange:t,inline:a=!0})=>{var n;const{fieldStats:u}=Object(l.b)(),{renderOption:d,closeFlyout:p}=null!==(n=null==u?void 0:u.useFieldStatsTrigger())&&void 0!==n?n:{},{splitFieldsOptions:b}=Object(c.d)(),g=Object(i.useMemo)((()=>[{value:void 0,label:s.i18n.translate("xpack.aiops.changePointDetection.notSelectedSplitFieldLabel",{defaultMessage:"--- Not selected ---"})},...b.map((e=>({value:e.name,label:e.displayName,...e.name?{field:{id:e.name,type:null==e?void 0:e.type}}:{}})))]),[b]),j=g.filter((t=>t.value===e)),h=Object(i.useCallback)((e=>{const a=e[0],i=null==a?void 0:a.value;t(i),p&&p()}),[t,p]),m=s.i18n.translate("xpack.aiops.changePointDetection.selectSpitFieldLabel",{defaultMessage:"Split field"});return Object(r.jsx)(o.EuiFormRow,{fullWidth:!0,label:a?void 0:m},Object(r.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:a?m:void 0,singleSelection:{asPlainText:!0},options:g,selectedOptions:j,onChange:h,isClearable:!0,"data-test-subj":"aiopsChangePointSplitField",renderOption:d}))}))},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a(1);var i=a(14),n=a(2),s=a(12),o=a(0);const l=[{id:"charts",label:Object(o.jsx)(i.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.viewTypeSelector.chartsLabel",defaultMessage:"Charts"}),iconType:"visLine"},{id:"table",label:Object(o.jsx)(i.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.viewTypeSelector.tableLabel",defaultMessage:"Table"}),iconType:"visTable"}],c=({value:e,onChange:t})=>Object(o.jsx)(n.EuiFormRow,{fullWidth:!0,label:s.i18n.translate("xpack.aiops.embeddableChangePointChart.viewTypeLabel",{defaultMessage:"View type"})},Object(o.jsx)(n.EuiButtonGroup,{isFullWidth:!0,legend:"This is a basic group",options:l,idSelected:e,onChange:t}))},125:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a(1);var i=a(14),n=a(2),s=a(12),o=a(13),l=a(167),c=a(92),r=a(0);const u=function(e){if(void 0!==(null==e?void 0:e.min)&&void 0!==e.max&&e.min>e.max)throw new Error("Invalid validator conditions");return Object(o.memoize)((t=>{const a={};return void 0!==(null==e?void 0:e.min)&&t<e.min&&(a.min=!0),void 0!==(null==e?void 0:e.max)&&t>e.max&&(a.max=!0),null!=e&&e.integerOnly&&!Number.isInteger(t)&&(a.integerOnly=!0),Object(l.a)(a)?a:null}))}({min:1,max:c.b,integerOnly:!0}),d=({value:e,onChange:t,onValidationChange:a,disabled:o,inline:l=!0})=>{const d=null!==u(e),p=s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotLabel",{defaultMessage:"Max series"});return Object(r.jsx)(n.EuiFormRow,{fullWidth:!0,isInvalid:d,error:Object(r.jsx)(i.FormattedMessage,{id:"xpack.aiops.changePointDetection.maxSeriesToPlotError",defaultMessage:"Max series value must be between {minValue} and {maxValue}",values:{minValue:1,maxValue:c.b}}),label:l?void 0:p},Object(r.jsx)(n.EuiFieldNumber,{"data-test-subj":"aiopsMaxSeriesControlFieldNumber",disabled:o,prepend:l?p:void 0,append:Object(r.jsx)(n.EuiToolTip,{content:s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotDescription",{defaultMessage:"The maximum number of change points to visualize."})},Object(r.jsx)(n.EuiIcon,{type:"questionInCircle"})),compressed:!0,fullWidth:!0,isInvalid:d,value:e,onChange:e=>{const i=Number(e.target.value);t(i),a&&a(u(i))},min:1,max:c.b}))}},169:function(e,t,a){"use strict";function i(e){let t=0,a=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)a=e.charCodeAt(i),t=(t<<5)-t+a,t|=0;return t<0?-2*t:t}a.d(t,"a",(function(){return i}))},270:function(e,t,a){"use strict";a.r(t);var i=a(1),n=a.n(i),s=a(3),o=a(13),l=a(4),c=a.n(l),r=a(51),u=a.n(r),d=a(2),p=a(25),b=a(71),g=a(76),j=a(64),h=a(0);const m=({theme:{theme$:e},euiTheme:t,children:a,...n})=>{const s=u()(e,j.a),o=Object(i.useMemo)((()=>Object(j.b)(s)),[s]);return Object(h.jsx)(d.EuiThemeProvider,c()({colorMode:o,theme:t},n),a)},x=({theme:e,children:t,...a})=>Object(p.useIsNestedEuiProvider)()?Object(h.jsx)(m,c()({theme:e},a),t):(Object(b.emitEuiProviderWarning)("KibanaThemeProvider requires a parent KibanaRenderContextProvider.  Check your React tree and ensure that they are wrapped in a KibanaRenderContextProvider."),Object(h.jsx)(g.a,{theme:e,globalStyles:!1},t));var O=a(61),f=a(277),v=a(20),C=a(127),y=a(100),P=a(16),S=a(54),w=a(45),T=a(43),F=a(58),E=a(118),M=a(12),k=a(14),D=a(157),I=a(171),A=a(39),R=a(168),B=a(57),z=a(125),L=a(169),V=a(40),N=a(134),_=a(60),W=a(107),q=a(108),G=a(109),H=a(49),K=a(137),U=a(73),Q=a.n(U),$=a(91),J=a(110);const Y={width:"350px"},X=Object(A.withSuspense)(A.LazySavedObjectSaveModalDashboard),Z=()=>{const{requestParams:{fieldConfigs:e},updateRequestParams:t,selectedChangePoints:a,setSelectedChangePoints:s}=Object(H.c)(),o=Object(i.useCallback)(((a,i)=>{e.splice(i,1,a),t({fieldConfigs:e})}),[t,e]),l=Object(i.useCallback)((()=>{const a=[...e];a.push(a[a.length-1]),t({fieldConfigs:a})}),[t,e]),c=Object(i.useCallback)((i=>{e.splice(i,1),t({fieldConfigs:e}),delete a[i],s({...a})}),[t,e,s,a]),r=Object(i.useCallback)(((e,t)=>{s({...a,[t]:e})}),[s,a]);return Object(h.jsx)(n.a.Fragment,null,e.map(((t,a)=>{const i=a;return Object(h.jsx)(n.a.Fragment,{key:i},Object(h.jsx)(ee,{panelIndex:a,"data-test-subj":`aiopsChangePointPanel_${a}`,fieldConfig:t,onChange:e=>o(e,a),onRemove:c.bind(null,a),removeDisabled:1===e.length,onSelectionChange:e=>{r(e,a)}}),Object(h.jsx)(d.EuiSpacer,{size:"s"}))})),Object(h.jsx)(d.EuiButton,{onClick:l,disabled:e.length>=_.f,"data-test-subj":"aiopsChangePointAddConfig"},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.addButtonLabel",defaultMessage:"Add"})))},ee=({panelIndex:e,fieldConfig:t,onChange:a,onRemove:n,removeDisabled:s,onSelectionChange:o,"data-test-subj":l})=>{var c,r,u,p;const{embeddable:b,application:{capabilities:g},cases:j}=Object(T.b)(),{dataView:m}=Object(w.c)(),{combinedQuery:x,requestParams:O,selectedChangePoints:f}=Object(H.c)(),v=function(e,t){const a=Q()(e),{splitFieldsOptions:n}=Object(H.d)(),[s,o]=Object(i.useState)(null),{dataView:l}=Object(w.c)(),c=Object(i.useMemo)((()=>{const a=n.find((t=>t.name===e));let i={};return null!=a&&a.isRuntimeField&&(i={runtime_mappings:{[a.name]:a.runtimeField}}),{params:{index:l.getIndexPattern(),size:0,body:{query:t,aggregations:{fieldCount:{cardinality:{field:e}}},...i}}}}),[e,l,t,n]),{runRequest:r,cancelRequest:u}=Object($.a)();return Object(i.useEffect)((function(){o(null),void 0!==e&&(u(),r(c).then((e=>{null!=e&&e.rawResponse.aggregations&&o(e.rawResponse.aggregations.fieldCount.value)})))}),[r,c,u,e]),a!==e?null:s}(t.splitField,x),[C,y]=Object(i.useState)(!0),[P,S]=Object(i.useState)(!1),[F,E]=Object(i.useState)(!0),D=null!==(c=null===(r=g.dashboard)||void 0===r?void 0:r.createNew)&&void 0!==c&&c,{create:A,update:N}=null!==(u=null==j||null===(p=j.helpers)||void 0===p?void 0:p.canUseCases())&&void 0!==u?u:{create:!1,update:!1},[_,W]=Object(i.useState)({applyTimeRange:!1,maxSeriesToPlot:6,viewType:B.c.CHARTS}),[q,G]=Object(i.useState)({viewType:B.c.CHARTS}),[U,Y]=Object(i.useState)(!1),{results:Z,isLoading:ee,progress:te}=Object(K.a)(t,O,x,v),ne=(e=>{const{cases:t}=Object(T.b)(),a=null==t?void 0:t.hooks.useCasesAddToExistingCaseModal();return Object(i.useCallback)((t=>{const i={...t,id:Object(L.a)(JSON.stringify(t)).toString()};if(!a)throw new Error("Cases modal is not available");a.open({getAttachments:()=>[{type:V.AttachmentType.persistableState,persistableStateAttachmentTypeId:e,persistableStateAttachmentState:JSON.parse(JSON.stringify(i))}]})}),[e])})(B.d),se=Object(i.useMemo)((()=>{var t;return(null!==(t=f[e])&&void 0!==t?t:[]).map((e=>{var t;return null===(t=e.group)||void 0===t?void 0:t.value}))}),[f,e]),oe=Object(R.a)(t.splitField)&&0===se.length,le=Object(I.b)(),ce=Object(i.useMemo)((()=>[{id:"panelActions",size:"s",items:[...D||N||A?[{name:se.length>0?M.i18n.translate("xpack.aiops.changePointDetection.attachSelectedChartsLabel",{defaultMessage:"Attach selected charts"}):M.i18n.translate("xpack.aiops.changePointDetection.attachChartsLabel",{defaultMessage:"Attach charts"}),icon:"plusInCircle",panel:"attachMainPanel","data-test-subj":"aiopsChangePointDetectionAttachButton"}]:[],{name:M.i18n.translate("xpack.aiops.changePointDetection.removeConfigLabel",{defaultMessage:"Remove configuration"}),icon:"trash",onClick:n,disabled:s}],"data=test-subj":"aiopsChangePointDetectionContextMenuPanel"},{id:"attachMainPanel",size:"s",initialFocusedItemIndex:0,title:se.length>0?M.i18n.translate("xpack.aiops.changePointDetection.attachSelectedChartsLabel",{defaultMessage:"Attach selected charts"}):M.i18n.translate("xpack.aiops.changePointDetection.attachChartsLabel",{defaultMessage:"Attach charts"}),items:[...D?[{name:M.i18n.translate("xpack.aiops.changePointDetection.attachToDashboardLabel",{defaultMessage:"To dashboard"}),panel:"attachToDashboardPanel","data-test-subj":"aiopsChangePointDetectionAttachToDashboardButton"}]:[],...N||A?[{name:M.i18n.translate("xpack.aiops.changePointDetection.attachToCaseLabel",{defaultMessage:"To case"}),disabled:oe,...oe?{toolTipProps:{position:"left"},toolTipContent:M.i18n.translate("xpack.aiops.changePointDetection.attachToCaseTooltipContent",{defaultMessage:"Select change points to attach"})}:{},"data-test-subj":"aiopsChangePointDetectionAttachToCaseButton",panel:"attachToCasePanel"}]:[]],"data-test-subj":"aiopsChangePointDetectionAttachChartPanel"},{id:"attachToDashboardPanel",title:M.i18n.translate("xpack.aiops.changePointDetection.attachToDashboardTitle",{defaultMessage:"Attach to dashboard"}),size:"s",content:Object(h.jsx)(d.EuiPanel,{paddingSize:"s"},Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(d.EuiForm,{"data-test-subj":"aiopsChangePointDetectionDashboardAttachmentForm"},Object(h.jsx)(J.a,{value:_.viewType,onChange:e=>{W((t=>({...t,viewType:e})))}}),Object(h.jsx)(d.EuiFormRow,{fullWidth:!0},Object(h.jsx)(d.EuiSwitch,{label:M.i18n.translate("xpack.aiops.changePointDetection.applyTimeRangeLabel",{defaultMessage:"Apply time range"}),checked:_.applyTimeRange,onChange:e=>W((t=>({...t,applyTimeRange:e.target.checked}))),compressed:!0,"data-test-subj":"aiopsChangePointDetectionAttachToDashboardApplyTimeRangeSwitch"})),Object(R.a)(t.splitField)&&0===se.length?Object(h.jsx)(z.a,{value:_.maxSeriesToPlot,onChange:e=>{W((t=>({...t,maxSeriesToPlot:e})))},onValidationChange:e=>{E(null===e)}}):null,Object(h.jsx)(d.EuiSpacer,{size:"m"}),Object(h.jsx)(d.EuiButton,{"data-test-subj":"aiopsChangePointDetectionSubmitDashboardAttachButton",fill:!0,type:"submit",fullWidth:!0,onClick:()=>{S(!1),Y(!0)},disabled:!F},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.submitDashboardAttachButtonLabel",defaultMessage:"Attach"}))))},{id:"attachToCasePanel",title:M.i18n.translate("xpack.aiops.changePointDetection.attachToCaseTitle",{defaultMessage:"Attach to case"}),size:"s",content:Object(h.jsx)(d.EuiPanel,{paddingSize:"s"},Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(d.EuiForm,{"data-test-subj":"aiopsChangePointDetectionCasedAttachmentForm"},Object(h.jsx)(J.a,{value:q.viewType,onChange:e=>{G((t=>({...t,viewType:e})))}}),Object(h.jsx)(d.EuiButton,{"data-test-subj":"aiopsChangePointDetectionSubmitCaseAttachButton",fill:!0,type:"submit",fullWidth:!0,onClick:()=>{S(!1),ne({timeRange:le,viewType:q.viewType,fn:t.fn,metricField:t.metricField,dataViewId:m.id,...t.splitField?{splitField:t.splitField,partitions:se}:{}})},disabled:!F},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.submitDashboardAttachButtonLabel",defaultMessage:"Attach"}))))}]),[A,D,N,q.viewType,oe,_.applyTimeRange,_.maxSeriesToPlot,_.viewType,m.id,t.fn,t.metricField,t.splitField,F,n,ne,s,se,le]),re=Object(i.useCallback)((({dashboardId:a,newTitle:i,newDescription:n})=>{var s;const o=b.getStateTransfer(),l={input:{title:i,description:n,viewType:_.viewType,dataViewId:m.id,metricField:t.metricField,splitField:t.splitField,fn:t.fn,..._.applyTimeRange?{timeRange:le}:{},maxSeriesToPlot:_.maxSeriesToPlot,...null!==(s=f[e])&&void 0!==s&&s.length?{partitions:se}:{}},type:B.d},c="new"===a?"#/create":`#/view/${a}`;o.navigateToWithEmbeddablePackage("dashboards",{state:l,path:c})}),[b,_.viewType,_.applyTimeRange,_.maxSeriesToPlot,m.id,t.metricField,t.splitField,t.fn,le,f,e,se]);return Object(h.jsx)(d.EuiPanel,{paddingSize:"s",hasBorder:!0,hasShadow:!1,"data-test-subj":l},Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiButtonIcon,{"data-test-subj":"aiopsChangePointDetectionExpandConfigButton",iconType:C?"arrowDown":"arrowRight",onClick:y.bind(null,(e=>!e)),"aria-label":M.i18n.translate("xpack.aiops.changePointDetection.expandConfigLabel",{defaultMessage:"Expand configuration"})})),Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(ae,{fieldConfig:t,onChange:a},Object(h.jsx)(d.EuiFlexItem,{css:Object(h.css)({visibility:null===te?"hidden":"visible"},"",""),grow:!0},Object(h.jsx)(d.EuiProgress,{label:Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.progressBarLabel",defaultMessage:"Fetching change points"}),value:null!=te?te:0,max:100,valueText:!0,size:"m"}),Object(h.jsx)(d.EuiSpacer,{size:"s"})))))),Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiPopover,{id:`panelContextMenu_${e}`,button:Object(h.jsx)(d.EuiButtonIcon,{"data-test-subj":"aiopsChangePointDetectionContextMenuButton","aria-label":M.i18n.translate("xpack.aiops.changePointDetection.configActionsLabel",{defaultMessage:"Context menu"}),iconType:"boxesHorizontal",color:"text",onClick:S.bind(null,!P)}),isOpen:P,closePopover:S.bind(null,!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(h.jsx)(d.EuiContextMenu,{panels:ce,initialPanelId:"panelActions"})))))),C?Object(h.jsx)(ie,{fieldConfig:t,isLoading:ee,annotations:Z,splitFieldCardinality:v,onSelectionChange:o}):null,U?Object(h.jsx)(X,{canSaveByReference:!1,objectType:M.i18n.translate("xpack.aiops.changePointDetection.objectTypeLabel",{defaultMessage:"Change point chart"}),documentInfo:{title:M.i18n.translate("xpack.aiops.changePointDetection.attachmentTitle",{defaultMessage:"Change point: {function}({metric}){splitBy}",values:{function:t.fn,metric:t.metricField,splitBy:t.splitField?M.i18n.translate("xpack.aiops.changePointDetection.splitByTitle",{defaultMessage:' split by "{splitField}"',values:{splitField:t.splitField}}):""}})},onClose:()=>{Y(!1)},onSave:re}):null)};var te={name:"833hqy",styles:"width:200px"};const ae=({fieldConfig:e,onChange:t,children:a})=>{const{splitFieldsOptions:n,combinedQuery:s}=Object(H.c)(),{dataView:o}=Object(w.c)(),{data:l,uiSettings:c,fieldFormats:r,charts:u,fieldStats:p}=Object(T.b)(),b=Object(I.c)();Object(I.b)();const g=b.getActiveBounds(),j=Object(i.useMemo)((()=>({uiSettings:c,dataViews:l.dataViews,data:l,fieldFormats:r,charts:u})),[c,l,r,u]),m=p.FieldStatsFlyoutProvider,x=Object(i.useCallback)(((a,i)=>{const n={...e,[a]:i};t(n)}),[t,e]);return Object(h.jsx)(m,{fieldStatsServices:j,dataView:o,dslQuery:s,timeRangeMs:g?{from:g.min.valueOf(),to:g.max.valueOf()}:void 0},Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center",responsive:!0,wrap:!0,gutterSize:"m"},Object(h.jsx)(d.EuiFlexItem,{grow:!1,css:te},Object(h.jsx)(W.a,{value:e.fn,onChange:e=>x("fn",e)})),Object(h.jsx)(d.EuiFlexItem,{grow:!1,css:Y},Object(h.jsx)(q.a,{value:e.metricField,onChange:e=>x("metricField",e)})),n.length>0?Object(h.jsx)(d.EuiFlexItem,{grow:!1,css:Y},Object(h.jsx)(G.a,{value:e.splitField,onChange:e=>x("splitField",e)})):null,a))},ie=({fieldConfig:e,splitFieldCardinality:t,isLoading:a,annotations:i,onSelectionChange:s})=>{const o=t&&t>_.g;return Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiSpacer,{size:"s"}),o?Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiCallOut,{title:M.i18n.translate("xpack.aiops.changePointDetection.cardinalityWarningTitle",{defaultMessage:"Analysis has been limited"}),color:"warning",iconType:"warning"},Object(h.jsx)("p",null,M.i18n.translate("xpack.aiops.changePointDetection.cardinalityWarningMessage",{defaultMessage:'The "{splitField}" field cardinality is {cardinality} which exceeds the limit of {cardinalityLimit}. Only the first {cardinalityLimit} partitions, sorted by document count, are analyzed.',values:{cardinality:t,cardinalityLimit:_.g,splitField:e.splitField}}))),Object(h.jsx)(d.EuiSpacer,{size:"m"})):null,Object(h.jsx)(N.a,{annotations:i,fieldConfig:e,isLoading:a,onSelectionChange:s}))},ne=[{value:_.b.DIP,description:M.i18n.translate("xpack.aiops.changePointDetection.dipDescription",{defaultMessage:"A significant dip occurs at this point."})},{value:_.b.SPIKE,description:M.i18n.translate("xpack.aiops.changePointDetection.spikeDescription",{defaultMessage:"A significant spike occurs at this point."})},{value:_.b.DISTRIBUTION_CHANGE,description:M.i18n.translate("xpack.aiops.changePointDetection.distributionChangeDescription",{defaultMessage:"The overall distribution of the values has changed significantly."})},{value:_.b.STEP_CHANGE,description:M.i18n.translate("xpack.aiops.changePointDetection.stepChangeDescription",{defaultMessage:"The change indicates a statistically significant step up or down in value distribution."})},{value:_.b.TREND_CHANGE,description:M.i18n.translate("xpack.aiops.changePointDetection.trendChangeDescription",{defaultMessage:"An overall trend change occurs at this point."})}],se=({value:e,onChange:t})=>{const a=Object(i.useMemo)((()=>[{value:void 0,description:""},...ne].map((e=>{var t;return{value:e.value,label:null!==(t=e.value)&&void 0!==t?t:M.i18n.translate("xpack.aiops.changePointDetection.selectAllChangePoints",{defaultMessage:"Select all"}),description:e.description}}))),[]),s=e?a.filter((t=>e.includes(t.value))):[a[0]],o=Object(i.useCallback)((e=>{0!==e.length&&void 0!==e[e.length-1].value?t(e.map((e=>e.value)).filter(R.a)):t(void 0)}),[t]),l=Object(i.useCallback)((e=>{const{label:t,description:a}=e;return a?Object(h.jsx)(d.EuiToolTip,{position:"left",content:a},Object(h.jsx)(d.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiIcon,{type:"iInCircle",color:"primary"})),Object(h.jsx)(d.EuiFlexItem,null,t))):Object(h.jsx)(n.a.Fragment,null,t)}),[]);return Object(h.jsx)(d.EuiFormRow,{label:M.i18n.translate("xpack.aiops.changePointDetection.changePointTypeLabel",{defaultMessage:"Change point type"}),display:"columnCompressed",fullWidth:!0},Object(h.jsx)(d.EuiComboBox,{options:a,selectedOptions:s,onChange:o,isClearable:!0,"data-test-subj":"aiopsChangePointTypeFilter",renderOption:l,compressed:!0}))};var oe=a(15),le=a(260);const ce=({query:e,filters:t,onQueryChange:a,onFiltersChange:s})=>{const{dataView:o}=Object(w.c)(),{unifiedSearch:{ui:{SearchBar:l}}}=Object(T.b)(),[c,r]=Object(i.useState)(),u=Object(i.useCallback)(((e,t)=>{if(e.query.language===le.a.KUERY)try{Object(oe.fromKueryExpression)(e.query.query),r(void 0),a(e.query)}catch(e){r(e.message)}}),[a]),p=Object(i.useCallback)((e=>{s(e)}),[s]),b=null!=e?e:{query:"",language:"kuery"};return Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(l,{showSubmitButton:!1,appName:"aiops",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:b,filters:null!=t?t:[],onQuerySubmit:u,indexPatterns:[o],placeholder:M.i18n.translate("xpack.aiops.searchPanel.queryBarPlaceholderText",{defaultMessage:'Search… (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,onFiltersUpdated:p}),c?Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(d.EuiTextColor,{color:"danger"},c)):null)};var re={name:"1mhs1aw",styles:"min-width:400px"};const ue=()=>{const[e,t]=Object(i.useState)(!1),{requestParams:a,updateRequestParams:n,resultFilters:s,updateFilters:o,resultQuery:l,metricFieldOptions:c,selectedChangePoints:r}=Object(H.c)(),{dataView:u}=Object(w.c)(),p=Object(i.useCallback)((e=>{n({query:e})}),[n]),b=Object(i.useCallback)((e=>{n({changePointType:e})}),[n]);if(0===c.length)return Object(h.jsx)(d.EuiCallOut,{title:M.i18n.translate("xpack.aiops.index.dataViewWithoutMetricNotificationTitle",{defaultMessage:'The data view "{dataViewTitle}" does not contain any metric fields.',values:{dataViewTitle:u.getName()}}),color:"danger",iconType:"warning"},Object(h.jsx)("p",null,M.i18n.translate("xpack.aiops.index.dataViewWithoutMetricNotificationDescription",{defaultMessage:"Change point detection can only be run on data views with a metric field."})));const g=Object.values(r).some((e=>e.length>0));return Object(h.jsx)("div",{"data-test-subj":"aiopsChangePointDetectionPage"},Object(h.jsx)(ce,{query:l,onQueryChange:p,filters:s,onFiltersChange:o}),Object(h.jsx)(d.EuiSpacer,{size:"m"}),Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiFlexGroup,{alignItems:"center"},Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiText,{size:"s"},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.aggregationIntervalTitle",defaultMessage:"Aggregation interval: "}),a.interval)),Object(h.jsx)(d.EuiFlexItem,{grow:!1},Object(h.jsx)(d.EuiToolTip,{position:"top",content:g?"":Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.viewSelectedChartsToltip",defaultMessage:"Select change points to view them in detail."})},Object(h.jsx)(d.EuiButtonEmpty,{onClick:()=>t(!e),size:"s",disabled:!g,"data-test-subj":"aiopsChangePointDetectionViewSelected"},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.viewSelectedButtonLabel",defaultMessage:"View selected"})))))),Object(h.jsx)(d.EuiFlexItem,{grow:!1,css:re},Object(h.jsx)(se,{value:a.changePointType,onChange:b}))),Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(Z,null),e?Object(h.jsx)(d.EuiFlyout,{ownFocus:!0,onClose:t.bind(null,!1),"aria-labelledby":"change_point_charts",size:"l","data-test-subj":"aiopsChangePointDetectionSelectedCharts"},Object(h.jsx)(d.EuiFlyoutHeader,{hasBorder:!0},Object(h.jsx)(d.EuiTitle,{size:"m"},Object(h.jsx)("h2",{id:"change_point_charts"},Object(h.jsx)(k.FormattedMessage,{id:"xpack.aiops.changePointDetection.selectedChangePointsHeader",defaultMessage:"Selected change points"})))),Object(h.jsx)(d.EuiFlyoutBody,null,Object(h.jsx)(D.b,{changePoints:r}))):null)};var de=a(81),pe=a(72),be=a(67);const ge=new v.Storage(window.localStorage);t.default=({dataView:e,savedSearch:t,appDependencies:a,showFrozenDataTierChoice:l=!0})=>{var c,r,u,p,b;const g={...Object(o.pick)(a,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:P.UI_SETTINGS,showFrozenDataTierChoice:l},j=Object(de.a)(e,"change_point_detection"),m=Object(i.useMemo)((()=>C.a.pipe(Object(s.map)((e=>e.lastRefresh)))),[]);if(null!==j)return Object(h.jsx)(n.a.Fragment,null,j);a.embeddingOrigin=S.c.AIOPS_DEFAULT_SOURCE;const v=null!==(c=null===(r=a.presentationUtil)||void 0===r?void 0:r.ContextProvider)&&void 0!==c?c:n.a.Fragment,M=null!==(u=null===(p=a.cases)||void 0===p?void 0:p.ui.getCasesContext())&&void 0!==u?u:n.a.Fragment,k=null===(b=a.cases)||void 0===b?void 0:b.helpers.canUseCases();return Object(h.jsx)(v,null,Object(h.jsx)(x,{theme:a.theme},Object(h.jsx)(M,{owner:[],permissions:k},Object(h.jsx)(T.a.Provider,{value:a},Object(h.jsx)(f.a,null,Object(h.jsx)(w.a.Provider,{value:{dataView:e,savedSearch:t}},Object(h.jsx)(O.a,{storage:ge,storageKeys:F.e},Object(h.jsx)(y.a,g,Object(h.jsx)(E.a,null),Object(h.jsx)(d.EuiSpacer,null),Object(h.jsx)(pe.a,{reload$:m},Object(h.jsx)(be.a,null,Object(h.jsx)(H.a,null,Object(h.jsx)(H.b,null,Object(h.jsx)(ue,null)))))))))))))}},58:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return o})),a.d(t,"e",(function(){return l}));const i="aiops.frozenDataTierPreference",n="aiops.randomSamplingModePreference",s="aiops.randomSamplingProbabilityPreference",o="aiops.patternAnalysisMinimumTimeRangePreference",l=[i,n,s,o]},61:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return u}));var i=a(1),n=a.n(i),s=a(13),o=a(168),l=a(0);const c=n.a.createContext({value:null,setValue(){throw new Error("MlStorageContext set method is not implemented")},removeValue(){throw new Error("MlStorageContext remove method is not implemented")}});function r({children:e,storage:t,storageKeys:a}){const n=Object(i.useMemo)((()=>a.reduce(((e,a)=>(e[a]=t.get(a),e)),{})),[t,a]),[r,u]=Object(i.useState)(n),d=Object(i.useCallback)(((e,a)=>{t.set(e,a),u((t=>({...t,[e]:a})))}),[t]),p=Object(i.useCallback)((e=>{t.remove(e),u((t=>Object(s.omit)(t,e)))}),[t]);Object(i.useEffect)((function(){const e=e=>{(function(e,t){return t.includes(e)})(e.key,a)&&(Object(o.a)(e.newValue)?u((t=>({...t,[e.key]:"string"==typeof e.newValue?JSON.parse(e.newValue):e.newValue}))):u((t=>Object(s.omit)(t,e.key))))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}),[a]);const b=Object(i.useMemo)((()=>({value:r,setValue:d,removeValue:p})),[r,d,p]);return Object(l.jsx)(c.Provider,{value:b},e)}function u(e,t){const{value:a,setValue:n,removeValue:s}=Object(i.useContext)(c);return[Object(i.useMemo)((()=>{var i;return null!==(i=null==a?void 0:a[e])&&void 0!==i?i:t}),[a,e,t]),Object(i.useCallback)((t=>{Object(o.a)(t)?n(e,t):s(e)}),[n,s,e])]}},73:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(1);t.default=function(e){var t=i.useRef();return i.useEffect((function(){t.current=e})),t.current}},81:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a(1);var i=a(2),n=a(12),s=a(0);function o(e,t){if(e.isTimeBased())return null;let a="";return"change_point_detection"===t?a=n.i18n.translate("xpack.aiops.changePointTimeSeriesWarning.description",{defaultMessage:"Change point detection only runs over time-based indices."}):"log_categorization"===t?a=n.i18n.translate("xpack.aiops.logCategorizationTimeSeriesWarning.description",{defaultMessage:"Log pattern analysis only runs over time-based indices."}):"log_rate_analysis"===t&&(a=n.i18n.translate("xpack.aiops.logRateAnalysisTimeSeriesWarning.description",{defaultMessage:"Log rate analysis only runs over time-based indices."})),Object(s.jsx)(i.EuiCallOut,{title:n.i18n.translate("xpack.aiops.dataViewNotBasedOnTimeSeriesWarning.title",{defaultMessage:'The data view "{dataViewTitle}" is not based on a time series.',values:{dataViewTitle:e.getName()}}),color:"danger",iconType:"warning"},Object(s.jsx)("p",null,a))}},92:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));const i=50,n=6}}]);