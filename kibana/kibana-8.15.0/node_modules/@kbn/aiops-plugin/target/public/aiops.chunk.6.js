/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[6],{134:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(2),a=n(15),r=n(12),s=n(14),o=n(90),l=n(1),c=n(43),u=n(45),d=n(49),p=n(135),b=n(136),g=n(0);function f(e,t,n){return{meta:{disabled:!1,negate:n,alias:null,index:e,key:`${t.group.name}_${t.group.value}`,field:t.group.name,params:{query:t.group.value},type:"phrase"},query:{match_phrase:{[t.group.name]:t.group.value}},$state:{store:a.FilterStateStore.APP_STATE}}}const m=[5,10,15],O=({isLoading:e,annotations:t,fieldConfig:n,onSelectionChange:a,onRenderComplete:b})=>{const{fieldFormats:O,data:{query:{filterManager:j}},embeddingOrigin:y}=Object(c.b)(),{dataView:T}=Object(u.c)(),v=Object(l.useRef)(0),{onTableChange:h,pagination:E,sorting:C}=Object(o.a)(null!=t?t:[],"p_value","asc",{pageIndex:0,pageSize:10,pageSizeOptions:m}),x=Object(l.useMemo)((()=>O.deserialize({id:"date"})),[O]);Object(l.useEffect)((()=>{v.current=0}),[E.pageIndex,E.pageSize,C.sort]);const F=Object(l.useCallback)((e=>{b&&(e||v.current++,v.current===E.pageSize&&b())}),[b,E.pageSize]),R=void 0!==n.splitField&&"cases"!==y,{bucketInterval:N}=Object(d.c)(),S=[{id:"timestamp",field:"timestamp","data-test-subj":"aiopsChangePointTimestamp",name:r.i18n.translate("xpack.aiops.changePointDetection.timeColumn",{defaultMessage:"Time"}),sortable:!0,truncateText:!1,width:"230px",render:e=>x.convert(e)},{id:"preview","data-test-subj":"aiopsChangePointPreview",name:r.i18n.translate("xpack.aiops.changePointDetection.previewColumn",{defaultMessage:"Preview"}),align:"center",width:"200px",height:"80px",truncateText:!1,valign:"middle",css:{".euiTableCellContent":{display:"block",padding:0}},render:e=>Object(g.jsx)(_,{annotation:e,fieldConfig:n,interval:N.expression,onRenderComplete:F.bind(null,!1)})},{id:"type","data-test-subj":"aiopsChangePointType",field:"type",name:r.i18n.translate("xpack.aiops.changePointDetection.typeColumn",{defaultMessage:"Type"}),sortable:!0,truncateText:!1,render:e=>Object(g.jsx)(i.EuiBadge,{color:"hollow"},e)},{id:"pValue","data-test-subj":"aiopsChangePointPValue",field:"p_value",name:Object(g.jsx)(i.EuiToolTip,{content:r.i18n.translate("xpack.aiops.changePointDetection.pValueTooltip",{defaultMessage:"Indicates how extreme the change is. Lower values indicate greater change."})},Object(g.jsx)("span",null,r.i18n.translate("xpack.aiops.changePointDetection.pValueLabel",{defaultMessage:"p-value"}),Object(g.jsx)(i.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),sortable:!0,truncateText:!1,render:e=>e.toPrecision(3)},...n.splitField?[{id:"groupName","data-test-subj":"aiopsChangePointGroupName",field:"group.name",name:r.i18n.translate("xpack.aiops.changePointDetection.fieldNameColumn",{defaultMessage:"Field name"}),truncateText:!1},{id:"groupValue","data-test-subj":"aiopsChangePointGroupValue",field:"group.value",name:r.i18n.translate("xpack.aiops.changePointDetection.fieldValueColumn",{defaultMessage:"Field value"}),truncateText:!1,sortable:!0},...R?[{name:r.i18n.translate("xpack.aiops.changePointDetection.actionsColumn",{defaultMessage:"Actions"}),actions:[{name:r.i18n.translate("xpack.aiops.changePointDetection.actions.filterForValueAction",{defaultMessage:"Filter for value"}),description:r.i18n.translate("xpack.aiops.changePointDetection.actions.filterForValueAction",{defaultMessage:"Filter for value"}),icon:"plusInCircle",color:"primary",type:"icon",onClick:e=>{j.addFilters(f(T.id,e,!1))},isPrimary:!0,"data-test-subj":"aiopsChangePointFilterForValue"},{name:r.i18n.translate("xpack.aiops.changePointDetection.actions.filterOutValueAction",{defaultMessage:"Filter out value"}),description:r.i18n.translate("xpack.aiops.changePointDetection.actions.filterOutValueAction",{defaultMessage:"Filter out value"}),icon:"minusInCircle",color:"primary",type:"icon",onClick:e=>{j.addFilters(f(T.id,e,!0))},isPrimary:!0,"data-test-subj":"aiopsChangePointFilterOutValue"}]}]:[]]:[]],I=Object(l.useMemo)((()=>{if(a)return{selectable:e=>!0,onSelectionChange:e=>{a(e.map((e=>({...e,...n}))))}}}),[n,a]);return Object(g.jsx)(i.EuiInMemoryTable,{itemId:"id",selection:I,loading:e,"data-test-subj":"aiopsChangePointResultsTable "+(e?"loading":"loaded"),items:t,columns:S,pagination:E.pageSizeOptions[0]>E.totalItemCount?void 0:E,sorting:C,onTableChange:h,rowProps:e=>({"data-test-subj":`aiopsChangePointResultsTableRow row-${e.id}`}),message:e?Object(g.jsx)(i.EuiEmptyPrompt,{iconType:"search",title:Object(g.jsx)("h2",null,Object(g.jsx)(s.FormattedMessage,{id:"xpack.aiops.changePointDetection.fetchingChangePointsTitle",defaultMessage:"Fetching change points..."}))}):Object(g.jsx)(p.a,null)})},_=({fieldConfig:e,annotation:t,onRenderComplete:n,onLoading:i})=>{const{lens:{EmbeddableComponent:a}}=Object(c.b)(),{bucketInterval:r}=Object(d.c)(),{filters:s,query:o,attributes:u,timeRange:p}=Object(b.a)({annotation:t,fieldConfig:e,previewMode:!0,bucketInterval:r.expression}),f=Object(l.useRef)(null),m=Object(l.useCallback)((e=>{e.target!==f.current&&n&&n()}),[n]);return Object(l.useEffect)((()=>{if(!f.current)throw new Error("Reference to the chart wrapper is not set");const e=f.current;return e.addEventListener("renderComplete",m),()=>{e.removeEventListener("renderComplete",m)}}),[m]),Object(g.jsx)("div",{"data-test-subj":"aiopChangePointPreviewChart",ref:f},Object(g.jsx)(a,{id:`mini_changePointChart_${t.group?t.group.value:t.label}`,style:{height:80},timeRange:p,noPadding:!0,query:o,filters:s,attributes:u,renderMode:"preview",executionContext:{type:"aiops_change_point_detection_chart",name:"Change point detection"},onLoad:i}))}},135:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n(1);var i=n(14),a=n(2),r=n(0);const s=e=>{var t;return null===(t=e.onRenderComplete)||void 0===t||t.call(e),Object(r.jsx)(a.EuiEmptyPrompt,{iconType:"search",title:Object(r.jsx)("h2",null,Object(r.jsx)(i.FormattedMessage,{id:"xpack.aiops.changePointDetection.noChangePointsFoundTitle",defaultMessage:"No change points found"})),body:Object(r.jsx)("p",null,Object(r.jsx)(i.FormattedMessage,{id:"xpack.aiops.changePointDetection.noChangePointsFoundMessage",defaultMessage:"Detect statistically significant change points such as dips, spikes, and distribution changes in a metric. Select a metric and set a time range to start detecting change points in your data."}))})}},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(15),a=n(1),r=n(67),s=n(60),o=n(45);const l=({annotation:e,fieldConfig:t,previewMode:n=!1,bucketInterval:l})=>{var c,u,d;const{dataView:p}=Object(o.c)(),{filters:b,query:g,searchBounds:f}=Object(r.b)(),m=Object(a.useMemo)((()=>[...b,...e.group?[{meta:{index:p.id,alias:null,negate:!1,disabled:!1,type:"phrase",key:e.group.name,params:{query:e.group.value}},query:{match_phrase:{[e.group.name]:e.group.value}},$state:{store:i.FilterStateStore.APP_STATE}}]:[]]),[p.id,e.group,b]),O=!n,_=Object(a.useMemo)((()=>{var n,i;return{title:null!==(n=null===(i=e.group)||void 0===i?void 0:i.value)&&void 0!==n?n:"",description:"",visualizationType:"lnsXY",type:"lens",references:[{type:"index-pattern",id:p.id,name:"indexpattern-datasource-layer-2d61a885-abb0-4d4e-a5f9-c488caec3c22"},{type:"index-pattern",id:p.id,name:"xy-visualization-layer-8d26ab67-b841-4877-9d02-55bf270f9caf"}],state:{visualization:{hideEndzones:!0,yLeftExtent:{mode:"dataBounds"},legend:{isVisible:!1},valueLabels:"hide",fittingFunction:"None",axisTitlesVisibilitySettings:{x:O,yLeft:O,yRight:O},tickLabelsVisibilitySettings:{x:O,yLeft:O,yRight:O},labelsOrientation:{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:{x:O,yLeft:O,yRight:O},preferredSeriesType:"line",layers:[{layerId:"2d61a885-abb0-4d4e-a5f9-c488caec3c22",accessors:["e9f26d17-fb36-4982-8539-03f1849cbed0"],position:"top",seriesType:"line",showGridlines:!1,layerType:"data",xAccessor:"877e6638-bfaa-43ec-afb9-2241dc8e1c86"},{layerId:"8d26ab67-b841-4877-9d02-55bf270f9caf",layerType:"annotations",annotations:[{type:"manual",icon:"triangle",textVisibility:O,label:e.label,key:{type:"point_in_time",timestamp:e.timestamp},id:"a8fb297c-8d96-4011-93c0-45af110d5302",isHidden:!1,color:"#F04E98",lineStyle:"solid",lineWidth:1,outside:!1}],ignoreGlobalFilters:!1}]},query:g,filters:m,datasourceStates:{formBased:{layers:{"2d61a885-abb0-4d4e-a5f9-c488caec3c22":{columns:{"877e6638-bfaa-43ec-afb9-2241dc8e1c86":{label:p.timeFieldName,dataType:"date",operationType:"date_histogram",sourceField:p.timeFieldName,isBucketed:!0,scale:"interval",params:{interval:l,includeEmptyRows:!0,dropPartials:!1}},"e9f26d17-fb36-4982-8539-03f1849cbed0":{label:`${t.fn}(${t.metricField})`,dataType:"number",operationType:s.h[t.fn],sourceField:t.metricField,isBucketed:!1,scale:"ratio",params:{emptyAsNull:!0}}},columnOrder:["877e6638-bfaa-43ec-afb9-2241dc8e1c86","e9f26d17-fb36-4982-8539-03f1849cbed0"],incompleteColumns:{}}}},textBased:{layers:{}}}}}}),[null===(c=e.group)||void 0===c?void 0:c.value,e.timestamp,e.label,p.id,p.timeFieldName,g,m,l,t.fn,t.metricField,O]);return{timeRange:{from:null===(u=f.min)||void 0===u?void 0:u.toISOString(),to:null===(d=f.max)||void 0===d?void 0:d.toISOString()},filters:m,query:g,attributes:_}}},137:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n(1),a=n(12),r=n(168),s=n(38),o=n(72),l=n(43),c=n(49),u=n(45),d=n(91),p=n(60);function b(e,t,n,b){const{notifications:{toasts:g},usageCollection:f,embeddingOrigin:m}=Object(l.b)(),{dataView:O}=Object(u.c)(),{splitFieldsOptions:_,metricFieldOptions:j}=Object(c.d)(),{refreshTimestamp:y}=Object(o.b)(),[T,v]=Object(i.useState)([]),[h,E]=Object(i.useState)(0),C=!Object(r.a)(e.splitField),x=Object(i.useMemo)((()=>Math.ceil(Math.min(null!=b?b:0,p.g)/p.c)),[b]),{runRequest:F,cancelRequest:R}=Object(d.a)(),N=Object(i.useCallback)((()=>{R(),v([])}),[R]),S=Object(i.useCallback)((async(i=1,o)=>{try{var l,c,u,d,b,y;if(!C&&!x)return void E(null);const a=j.find((t=>t.name===e.metricField)),g=_.find((t=>t.name===e.splitField)),T={...null!=a&&a.isRuntimeField?{[a.name]:a.runtimeField}:{},...null!=g&&g.isRuntimeField?{[g.name]:g.runtimeField}:{}},h=function({index:e,fn:t,metricField:n,splitField:i,timeInterval:a,timeField:s,afterKey:o},l,c){const u={over_time:{date_histogram:{field:s,fixed_interval:a},aggs:{function_value:{[t]:{field:n}}}},change_point_request:{change_point:{buckets_path:"over_time>function_value"}},...Object(r.a)(i)?{select:{bucket_selector:{buckets_path:{p_value:"change_point_request.p_value"},script:"params.p_value < 1"}},sort:{bucket_sort:{sort:[{"change_point_request.p_value":{order:"asc"}}]}}}:{}};return{index:e,size:0,body:{...l?{query:l}:{},...c?{runtime_mappings:c}:{},aggregations:i?{groupings:{composite:{size:p.c,...void 0!==o?{after:{splitFieldTerm:o}}:{},sources:[{splitFieldTerm:{terms:{field:i}}}]},aggregations:u}}:u}}}({index:O.getIndexPattern(),fn:e.fn,timeInterval:t.interval,metricField:e.metricField,timeField:O.timeFieldName,splitField:e.splitField,afterKey:o},n,T);null!=f&&f.reportUiCounter&&m&&f.reportUiCounter(m,s.METRIC_TYPE.COUNT,p.a.RUN);const R=await F({params:h});if(null!=f&&f.reportUiCounter&&m&&f.reportUiCounter(m,s.METRIC_TYPE.COUNT,p.a.SUCCESS),null===R)return void E(null);const N=!(Object(r.a)(null===(l=R.rawResponse.aggregations)||void 0===l||null===(c=l.groupings)||void 0===c||null===(u=c.after_key)||void 0===u?void 0:u.splitFieldTerm)&&i<x),I=C?[R.rawResponse.aggregations]:R.rawResponse.aggregations.groupings.buckets;E(N?null:Math.min(Math.round(i/x*100),100));let P=I.map((t=>{var n,i;const a=Object.keys(t.change_point_request.type)[0],r=null===(n=t.change_point_request.bucket)||void 0===n?void 0:n.key,s=t.change_point_request.type[a].p_value;return{...C?{}:{group:{name:e.splitField,value:t.key.splitFieldTerm}},type:a,p_value:s,timestamp:r,label:a,reason:t.change_point_request.type[a].reason,id:C?"single_metric":`${e.splitField}_${null===(i=t.key)||void 0===i?void 0:i.splitFieldTerm}`}})).filter((e=>!p.e.has(e.type)));Array.isArray(t.changePointType)&&(P=P.filter((e=>t.changePointType.includes(e.type)))),v((e=>(null!=e?e:[]).concat(P))),!N&&Object(r.a)(null===(d=R.rawResponse.aggregations)||void 0===d||null===(b=d.groupings)||void 0===b||null===(y=b.after_key)||void 0===y?void 0:y.splitFieldTerm)&&await S(i+1,R.rawResponse.aggregations.groupings.after_key.splitFieldTerm)}catch(e){null!=f&&f.reportUiCounter&&m&&f.reportUiCounter(m,s.METRIC_TYPE.COUNT,p.a.ERROR),g.addError(e,{title:a.i18n.translate("xpack.aiops.changePointDetection.fetchErrorTitle",{defaultMessage:"Failed to fetch change points"})})}}),[m,C,x,O,e.fn,e.metricField,e.splitField,t.interval,t.changePointType,n,j,_,F,g,f]);return Object(i.useEffect)((function(){if(E(0),N(),!e.splitField||null!==b)return S(),()=>{R()}}),[t.interval,t.changePointType,e.fn,e.metricField,e.splitField,n,b,S,N,R,y]),{results:T,isLoading:null!==h,reset:N,progress:h}}},157:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n(1),a=n.n(i),r=n(2),s=n(12),o=n(14),l=n(171),c=n(49),u=n(136),d=n(43),p=n(0);const b=a.a.memo((({annotation:e,fieldConfig:t,interval:n,onLoading:a,onRenderComplete:r})=>{const{lens:{EmbeddableComponent:s}}=Object(d.b)(),o=Object(i.useRef)(null),l=Object(i.useCallback)((e=>{e.target!==o.current&&r&&r()}),[r]);Object(i.useEffect)((()=>{if(!o.current)throw new Error("Reference to the chart wrapper is not set");const e=o.current;return e.addEventListener("renderComplete",l),()=>{e.removeEventListener("renderComplete",l)}}),[l]);const{filters:c,timeRange:b,query:g,attributes:f}=Object(u.a)({fieldConfig:t,annotation:e,bucketInterval:n});return Object(p.jsx)("div",{ref:o},Object(p.jsx)(s,{id:`changePointChart_${e.group?e.group.value:e.label}`,style:{height:350},timeRange:b,query:g,filters:c,attributes:f,renderMode:"view",executionContext:{type:"aiops_change_point_detection_chart",name:"Change point detection"},disableTriggers:!0,onLoad:a}))}));var g={name:"1d3w5wq",styles:"width:100%"};const f=({changePoints:e,interval:t,onRenderComplete:n})=>{const a=Object(i.useRef)(Object.fromEntries(e.map(((e,t)=>[t,!0])))),l=Object(i.useCallback)(((e,t)=>{n&&(a.current[e]=t,Object.values(a.current).every((e=>!e))&&n())}),[n]);return Object(p.jsx)(r.EuiFlexGrid,{columns:e.length>=2?2:1,responsive:!0,gutterSize:"m",css:g},e.map(((e,n)=>{var i,a;const c=`${n}_${null!==(i=null===(a=e.group)||void 0===a?void 0:a.value)&&void 0!==i?i:"single_metric"}_${e.fn}_${e.metricField}_${e.timestamp}_${e.p_value}`;return Object(p.jsx)(r.EuiFlexItem,{key:c},Object(p.jsx)(r.EuiPanel,{paddingSize:"s",hasBorder:!0,hasShadow:!1},Object(p.jsx)(r.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},e.group?Object(p.jsx)(r.EuiDescriptionList,{type:"inline",listItems:[{title:e.group.name,description:e.group.value}]}):null,e.reason?Object(p.jsx)(r.EuiToolTip,{position:"top",content:e.reason},Object(p.jsx)(r.EuiIcon,{tabIndex:0,color:"warning",type:"warning",title:s.i18n.translate("xpack.aiops.changePointDetection.notResultsWarning",{defaultMessage:"No change point agg results warning"})})):null),Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiText,{color:"subdued",size:"s"},e.fn,"(",e.metricField,")"))),Object(p.jsx)(r.EuiHorizontalRule,{margin:"xs"}),Object(p.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},void 0!==e.p_value?Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiDescriptionList,{type:"inline",listItems:[{title:Object(p.jsx)(o.FormattedMessage,{id:"xpack.aiops.changePointDetection.pValueLabel",defaultMessage:"p-value"}),description:e.p_value.toPrecision(3)}]})):null,Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiBadge,{color:"hollow"},e.type))),Object(p.jsx)(b,{fieldConfig:{splitField:e.splitField,fn:e.fn,metricField:e.metricField},annotation:e,interval:t,onLoading:e=>{e&&l(n,!0)},onRenderComplete:()=>{l(n,!1)}})))})))},m=({changePoints:e})=>{const t=Object(l.c)(),n=Object(i.useRef)(),{bucketInterval:s}=Object(c.c)();Object(i.useEffect)((function(){return n.current=t.getRefreshInterval(),t.setRefreshInterval({...n.current,pause:!0}),()=>{n.current&&t.setRefreshInterval(n.current)}}),[t]);const o=Object(i.useMemo)((()=>Object.values(e).flat()),[e]),[u,d]=Object(i.useState)(0),b=Object(i.useMemo)((()=>{const e=6*u;return o.slice(e,e+6)}),[o,u]),g=Object(i.useMemo)((()=>{var e;return{activePage:u,pageCount:Math.ceil((null!==(e=o.length)&&void 0!==e?e:0)/6),updatePagination:d}}),[u,o.length]);return Object(p.jsx)(a.a.Fragment,null,Object(p.jsx)(f,{changePoints:b,interval:s.expression}),g.pageCount>1?Object(p.jsx)(r.EuiFlexGroup,{justifyContent:"spaceAround"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiPagination,{pageCount:g.pageCount,activePage:g.activePage,onPageClick:g.updatePagination}))):null)}},168:function(e,t,n){"use strict";function i(e){return null!=e}n.d(t,"a",(function(){return i}))},45:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u}));var i=n(1),a=n(2),r=n(14),s=n(43),o=n(0);const l=Object(i.createContext)({get dataView(){throw new Error("DataSourceContext is not implemented")},savedSearch:null});function c(){return Object(i.useContext)(l)}const u=({dataViewId:e,savedSearchId:t,children:n,onChange:c})=>{const[u,d]=Object(i.useState)(),[p,b]=Object(i.useState)(),{data:{dataViews:g}}=Object(s.b)(),f=Object(i.useCallback)((async()=>{const t={savedSearch:null,dataView:null};e&&(t.dataView=await g.get(e));const{savedSearch:n,dataView:i}=t;return{dataView:i,savedSearch:n}}),[e,g]);return Object(i.useEffect)((()=>{f().then((e=>{b(void 0),d(e),c&&c({dataViews:[e.dataView]})})).catch((e=>{b(e)}))}),[f,c,e]),u&&null!=u&&u.dataView||p?p?Object(o.jsx)(a.EuiEmptyPrompt,{iconType:"error",color:"danger",title:Object(o.jsx)("h2",null,Object(o.jsx)(r.FormattedMessage,{id:"xpack.aiops.dataSourceContext.errorTitle",defaultMessage:"Unable to fetch data view or saved search"})),body:Object(o.jsx)("p",null,p.message)}):Object(o.jsx)(l.Provider,{value:u},n):null}},49:function(e,t,n){"use strict";n.d(t,"d",(function(){return O})),n.d(t,"b",(function(){return _})),n.d(t,"a",(function(){return j})),n.d(t,"c",(function(){return y}));var i=n(1),a=n(3),r=n(277),s=n(171),o=n(55),l=n(259),c=n(67),u=n(60),d=n(50),p=n(43),b=n(45),g=n(0);const f=Object(i.createContext)({splitFieldsOptions:[],metricFieldOptions:[],requestParams:{},timeBuckets:{},bucketInterval:{},updateRequestParams:()=>{},resultFilters:[],updateFilters:()=>{},resultQuery:{query:"",language:"kuery"},combinedQuery:{},selectedChangePoints:{},setSelectedChangePoints:()=>{}}),m=Object(i.createContext)({splitFieldsOptions:[],metricFieldOptions:[]}),O=()=>Object(i.useContext)(m),_=({children:e})=>{const{dataView:t}=Object(b.c)(),n={metricFieldOptions:Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,type:t})=>e&&"number"===t))),[t]),splitFieldsOptions:Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,esTypes:t,displayName:n})=>e&&t&&t.some((e=>[o.a.KEYWORD,o.a.IP].includes(e)))&&!["_id","_index"].includes(n)))),[t])};return Object(g.jsx)(m.Provider,{value:n},e)},j=({children:e})=>{const{dataView:t,savedSearch:n}=Object(b.c)(),{uiSettings:m,data:{query:{filterManager:O,queryString:_}}}=Object(p.b)(),j=Object(i.useMemo)((()=>Object(d.b)({dataView:t,uiSettings:m,savedSearch:n,filterManager:O})),[t,n,m,O]),y=Object(s.c)(),T=Object(l.a)(m),{searchBounds:v}=Object(c.b)(),[h,E]=Object(i.useState)([]),[C,x]=Object(i.useState)({}),[F,R]=Object(i.useState)();Object(i.useEffect)((function(){const e=y.getTimeUpdate$().pipe(Object(a.startWith)(y.getTime())).subscribe((()=>{const e=y.getActiveBounds();if(!e)throw new Error("Time bound not available");T.setInterval("auto"),T.setBounds(e),R(T.getInterval())}));return()=>{e.unsubscribe()}}),[]);const N=Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,type:t})=>e&&"number"===t))),[t]),S=Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,esTypes:t,displayName:n})=>e&&t&&t.some((e=>[o.a.KEYWORD,o.a.IP].includes(e)))&&!["_id","_index"].includes(n)))),[t]),[I,P]=Object(r.b)("changePoint"),A=Object(i.useMemo)((()=>{var e,t,n;return null!==(e=I.query)&&void 0!==e?e:{query:null!==(t=null==j?void 0:j.searchString)&&void 0!==t?t:"",language:null!==(n=null==j?void 0:j.queryLanguage)&&void 0!==n?n:"kuery"}}),[j,I.query]),w=Object(i.useMemo)((()=>{const e={...I};var t;return e.fieldConfigs||(e.fieldConfigs=[{fn:u.d,metricField:null===(t=N[0])||void 0===t?void 0:t.name}]),e.interval=null==F?void 0:F.expression,e}),[I,N,F]),M=Object(i.useCallback)((e=>{O.setFilters(e)}),[O]);Object(i.useEffect)((()=>{E(O.getFilters());const e=O.getUpdates$().subscribe((()=>{E(O.getFilters())}));return()=>{e.unsubscribe()}}),[]),Object(i.useEffect)((function(){const e=null==O?void 0:O.getGlobalFilters();return I.filters&&O.setFilters(I.filters),I.query&&_.setQuery(I.query),e&&(null==O||O.addFilters(e)),()=>{null==O||O.removeAll(),_.clearQuery()}}),[I.filters,I.query,O,_]);const k=Object(i.useMemo)((()=>{var e,n,i;const a=Object(d.a)(A,h,t,m);return Array.isArray(null===(e=a.bool)||void 0===e?void 0:e.filter)||(a.bool||(a.bool={}),a.bool.filter=[]),a.bool.filter.push({range:{[t.timeFieldName]:{from:null===(n=v.min)||void 0===n?void 0:n.valueOf(),to:null===(i=v.max)||void 0===i?void 0:i.valueOf()}}}),a}),[h,A,m,t,v]);if(!F)return null;const G={timeBuckets:T,requestParams:w,updateRequestParams:P,metricFieldOptions:N,splitFieldsOptions:S,bucketInterval:F,resultFilters:h,updateFilters:M,resultQuery:A,combinedQuery:k,selectedChangePoints:C,setSelectedChangePoints:x};return Object(g.jsx)(f.Provider,{value:G},e)};function y(){return Object(i.useContext)(f)}},51:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(23),a=n(1),r=i.__importDefault(n(78));t.default=function(e,t){var n=a.useState(t),i=n[0],s=n[1];return r.default((function(){var t=e.subscribe(s);return function(){return t.unsubscribe()}}),[e]),i}},54:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return s}));const i="aiops",a={LOG_RATE_ANALYSIS:"/internal/aiops/log_rate_analysis",CATEGORIZATION_FIELD_VALIDATION:"/internal/aiops/categorization_field_validation"},r={AIOPS_DEFAULT_SOURCE:"ml_aiops_labs",AIOPS_ANALYSIS_RUN_ORIGIN:"aiops-analysis-run-origin"},s="embeddable"},55:function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return r}));var i=n(59),a=n.n(i);let r=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),s=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class kbn_field_type_KbnFieldType{constructor(e={}){a()(this,"name",void 0),a()(this,"sortable",void 0),a()(this,"filterable",void 0),a()(this,"esTypes",void 0),this.name=e.name||s.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const o=new kbn_field_type_KbnFieldType({name:s.UNKNOWN}),l=[new kbn_field_type_KbnFieldType({name:s.STRING,sortable:!0,filterable:!0,esTypes:[r.STRING,r.TEXT,r.MATCH_ONLY_TEXT,r.KEYWORD,r.VERSION,r._TYPE,r._ID]}),new kbn_field_type_KbnFieldType({name:s.NUMBER,sortable:!0,filterable:!0,esTypes:[r.FLOAT,r.HALF_FLOAT,r.SCALED_FLOAT,r.DOUBLE,r.INTEGER,r.LONG,r.UNSIGNED_LONG,r.SHORT,r.BYTE,r.TOKEN_COUNT,r.AGGREGATE_METRIC_DOUBLE]}),new kbn_field_type_KbnFieldType({name:s.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[r.FLOAT_RANGE,r.DOUBLE_RANGE,r.INTEGER_RANGE,r.LONG_RANGE]}),new kbn_field_type_KbnFieldType({name:s.DATE,sortable:!0,filterable:!0,esTypes:[r.DATE,r.DATE_NANOS]}),new kbn_field_type_KbnFieldType({name:s.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[r.DATE_RANGE]}),new kbn_field_type_KbnFieldType({name:s.IP,sortable:!0,filterable:!0,esTypes:[r.IP]}),new kbn_field_type_KbnFieldType({name:s.IP_RANGE,sortable:!0,filterable:!0,esTypes:[r.IP_RANGE]}),new kbn_field_type_KbnFieldType({name:s.BOOLEAN,sortable:!0,filterable:!0,esTypes:[r.BOOLEAN]}),new kbn_field_type_KbnFieldType({name:s.OBJECT,esTypes:[r.OBJECT]}),new kbn_field_type_KbnFieldType({name:s.NESTED,esTypes:[r.NESTED]}),new kbn_field_type_KbnFieldType({name:s.GEO_POINT,esTypes:[r.GEO_POINT]}),new kbn_field_type_KbnFieldType({name:s.GEO_SHAPE,esTypes:[r.GEO_SHAPE]}),new kbn_field_type_KbnFieldType({name:s.ATTACHMENT,esTypes:[r.ATTACHMENT]}),new kbn_field_type_KbnFieldType({name:s.MURMUR3,esTypes:[r.MURMUR3]}),new kbn_field_type_KbnFieldType({name:s._SOURCE,esTypes:[r._SOURCE]}),new kbn_field_type_KbnFieldType({name:s.HISTOGRAM,filterable:!0,esTypes:[r.HISTOGRAM]}),new kbn_field_type_KbnFieldType({name:s.CONFLICT}),o],c=e=>{const t=l.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:s.UNKNOWN};function u(e){switch(e){case r._INDEX:return s.STRING;case"_version":return s.NUMBER;case"datetime":return s.DATE;default:return c(e)}}},57:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s}));const i="aiopsChangePointChart",a="aiopsChangePointChart",r="aiopsChangePointChartDataViewId",s={CHARTS:"charts",TABLE:"table"}},60:function(e,t,n){"use strict";n.d(t,"h",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"a",(function(){return u}));const i={avg:"average",max:"max",min:"min",sum:"sum"},a="avg",r=1e4,s=500,o={DIP:"dip",SPIKE:"spike",DISTRIBUTION_CHANGE:"distribution_change",STEP_CHANGE:"step_change",TREND_CHANGE:"trend_change",STATIONARY:"stationary",NON_STATIONARY:"non_stationary",INDETERMINABLE:"indeterminable"},l=new Set([o.STATIONARY,o.NON_STATIONARY,o.INDETERMINABLE]),c=6,u={RUN:"ran_aiops_change_point_detection",SUCCESS:"aiops_change_point_detection_success",ERROR:"aiops_change_point_detection_error"}},67:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p}));var i=n(1),a=n(171),r=n(259),s=n(243),o=n(43),l=n(72),c=n(0);const u=Object(i.createContext)({get filters(){throw new Error("FilterQueryContext is not initialized")},get query(){throw new Error("FilterQueryContext is not initialized")},get timeRange(){throw new Error("FilterQueryContext is not initialized")},get searchBounds(){throw new Error("FilterQueryContext is not initialized")},get interval(){throw new Error("FilterQueryContext is not initialized")}}),d=({children:e,timeRange:t})=>{const{data:{query:{filterManager:n,queryString:d,timefilter:p}},uiSettings:b}=Object(o.b)(),g=Object(r.a)(b),f=Object(l.b)(),[m,O]=Object(i.useState)(n.getFilters()),[_,j]=Object(i.useState)(d.getQuery()),y=Object(a.b)(!1);Object(i.useEffect)((()=>{const e=n.getUpdates$().subscribe((()=>{O(n.getFilters())}));return()=>{e.unsubscribe()}}),[n]),Object(i.useEffect)((()=>{const e=d.getUpdates$().subscribe((()=>{j(d.getQuery())}));return()=>{e.unsubscribe()}}),[d]);const T=Object(i.useMemo)((()=>null!=t?t:y),[y,t]),v=Object(i.useMemo)((()=>p.timefilter.calculateBounds(T)),[T,p,f.refreshTimestamp]),h=Object(i.useMemo)((()=>(g.setInterval("auto"),g.setBounds(v),g.getInterval())),[v,g]),E=Object(i.useMemo)((()=>Object(s.b)(v,h,!1)),[v,h]);return Object(c.jsx)(u.Provider,{value:{filters:m,query:_,timeRange:T,searchBounds:E,interval:h.expression}},e)},p=()=>Object(i.useContext)(u)},72:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var i=n(1),a=n.n(i),r=n(51),s=n.n(r),o=n(0);const l=a.a.createContext({refreshTimestamp:Date.now()}),c=({reload$:e,children:t})=>{const n=s()(e,Date.now());return Object(o.jsx)(l.Provider,{value:{refreshTimestamp:n}},t)},u=()=>Object(i.useContext)(l)},78:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;t.default=a},90:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(1);function a(e,t,n="asc",a){var r,s,o;const[l,c]=Object(i.useState)(null!==(r=null==a?void 0:a.pageIndex)&&void 0!==r?r:0),[u,d]=Object(i.useState)(null!==(s=null==a?void 0:a.pageSize)&&void 0!==s?s:10),[p,b]=Object(i.useState)(t),[g,f]=Object(i.useState)(n);return{onTableChange:({page:e={index:0,size:10},sort:t={field:p,direction:g}})=>{const{index:n,size:i}=e;c(n),d(i);const{field:a,direction:r}=t;b(a),f(r)},pagination:{pageIndex:l,pageSize:u,totalItemCount:(null!=e?e:[]).length,pageSizeOptions:null!==(o=null==a?void 0:a.pageSizeOptions)&&void 0!==o?o:[10,20,50],showPerPageOptions:!0},sorting:{sort:{field:p,direction:g}},setPageIndex:c}}},91:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(1),a=n(16),r=n(3),s=n(43);function o(){const{data:e}=Object(s.b)(),t=Object(i.useRef)(new AbortController),[n,o]=Object(i.useState)(!1);return{runRequest:Object(i.useCallback)((n=>new Promise(((i,s)=>{e.search.search(n,{abortSignal:t.current.signal}).pipe(Object(r.tap)((()=>{o(!0)}))).subscribe({next:e=>{Object(a.isRunningResponse)(e)||(o(!1),i(e))},error:e=>{if("AbortError"===e.name)return i(null);o(!1),s(e)}})}))),[e.search]),cancelRequest:Object(i.useCallback)((()=>{t.current.abort(),t.current=new AbortController}),[]),isLoading:n}}}}]);