!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=8)}([function(e,t,a){"use strict";a.r(t),a.d(t,"getSavedSearchUrl",(function(){return r})),a.d(t,"getSavedSearchFullPathUrl",(function(){return n})),a.d(t,"fromSavedSearchAttributes",(function(){return i})),a.d(t,"VIEW_MODE",(function(){return h})),a.d(t,"SavedSearchType",(function(){return s.d})),a.d(t,"LATEST_VERSION",(function(){return s.a})),a.d(t,"MIN_SAVED_SEARCH_SAMPLE_SIZE",(function(){return s.c})),a.d(t,"MAX_SAVED_SEARCH_SAMPLE_SIZE",(function(){return s.b})),a.d(t,"getKibanaContextFn",(function(){return g}));const r=e=>e?`#/view/${encodeURIComponent(e)}`:"#/",n=e=>`/app/discover${r(e)}`,i=(e,t,a,r,n)=>({id:e,searchSource:r,title:t.title,sort:t.sort,columns:t.columns,description:t.description,tags:a,grid:t.grid,hideChart:t.hideChart,viewMode:t.viewMode,hideAggregatedPreview:t.hideAggregatedPreview,rowHeight:t.rowHeight,headerRowHeight:t.headerRowHeight,isTextBasedQuery:t.isTextBasedQuery,usesAdHocDataView:t.usesAdHocDataView,timeRestore:t.timeRestore,timeRange:t.timeRange,refreshInterval:t.refreshInterval,rowsPerPage:t.rowsPerPage,sampleSize:t.sampleSize,breakdownField:t.breakdownField,visContext:t.visContext,managed:n});var s=a(2),c=a(4),o=a(1),d=a(6),l=a(7);const u=(e=[],t)=>Object(c.uniqBy)([...Array.isArray(e)?e:[e],...Array.isArray(t)?t:[t]],(e=>JSON.stringify(e.query))),g=e=>({name:"kibana_context",type:"kibana_context",inputTypes:["kibana_context","null"],help:o.i18n.translate("savedSearch.kibana_context.help",{defaultMessage:"Updates kibana global context"}),args:{q:{types:["kibana_query","null"],multi:!0,aliases:["query","_"],help:o.i18n.translate("savedSearch.kibana_context.q.help",{defaultMessage:"Specify Kibana free form text query"})},filters:{types:["kibana_filter","null"],multi:!0,help:o.i18n.translate("savedSearch.kibana_context.filters.help",{defaultMessage:"Specify Kibana generic filters"})},timeRange:{types:["timerange","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.timeRange.help",{defaultMessage:"Specify Kibana time range filter"})},savedSearchId:{types:["string","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.savedSearchId.help",{defaultMessage:"Specify saved search ID to be used for queries and filters"})}},extract(e){const t=[];if(e.savedSearchId.length&&"string"==typeof e.savedSearchId[0]){const a="kibana_context.savedSearchId";return t.push({name:a,type:"search",id:e.savedSearchId[0]}),{state:{...e,savedSearchId:[a]},references:t}}return{state:e,references:t}},inject(e,t){const a=t.find((e=>"kibana_context.savedSearchId"===e.name));return a&&(e.savedSearchId[0]=a.id),e},async fn(t,a,{getKibanaRequest:r}){var n,i;const{getSavedSearch:s}=await e(r),o=a.timeRange||(null==t?void 0:t.timeRange);let g=u(null==t?void 0:t.query,(null==a||null===(n=a.q)||void 0===n?void 0:n.filter(Boolean))||[]);const h=(null==a||null===(i=a.filters)||void 0===i?void 0:i.map(l.unboxExpressionValue))||[];let v=[...(null==t?void 0:t.filters)||[]];if(a.savedSearchId){const e=await s(a.savedSearchId),{query:t,filter:r}=e.searchSource.getFields();t&&(g=u(g,t)),r&&(v=[...v,...Array.isArray(r)?r:[r]])}const p=h.filter((e=>!v.some((t=>Object(c.isEqual)(Object(d.fromCombinedFilter)(t).query,e.query)))));return v=[...v,...p],{type:"kibana_context",query:g,filters:Object(d.uniqFilters)(v.filter((e=>{var t;return!(null!==(t=e.meta)&&void 0!==t&&t.disabled)}))),timeRange:o}}});let h=function(e){return e.DOCUMENT_LEVEL="documents",e.AGGREGATED_LEVEL="aggregated",e.PATTERN_LEVEL="patterns",e}({})},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,a){"use strict";a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return s}));const r="search",n=1,i=1,s=1e4},function(e,t,a){e.exports=a(10)(2)},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,a){a.r(t);var r=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t){e.exports=__kbnSharedDeps__.KbnEsQuery},function(e,t,a){a.r(t);var r=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t,a){a(9),__kbnBundles__.define("plugin/savedSearch/public",a,11),__kbnBundles__.define("plugin/savedSearch/common",a,0)},function(e,t,a){a.p=window.__kbnPublicPath__.savedSearch},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,a){"use strict";a.r(t),a.d(t,"getSavedSearchFullPathUrl",(function(){return n.getSavedSearchFullPathUrl})),a.d(t,"getSavedSearchUrl",(function(){return n.getSavedSearchUrl})),a.d(t,"VIEW_MODE",(function(){return n.VIEW_MODE})),a.d(t,"plugin",(function(){return m}));var r=a(1),n=a(0),i=a(3),s=a.n(i),c=a(5),o=a(4);const d=async(e,{spaces:t,getSavedSrch:a})=>{const i=await a(e);if(i.error)throw new Error(`Could not locate that search (id: ${e})`);var s;if("conflict"===i.meta.outcome)throw new Error(await(async e=>r.i18n.translate("savedSearch.legacyURLConflict.errorMessage",{defaultMessage:"This search has the same URL as a legacy alias. Disable the alias to resolve this error : {json}",values:{json:e}}))(JSON.stringify({targetType:n.SavedSearchType,sourceId:e,targetSpace:null===(s=await(null==t?void 0:t.getActiveSpace()))||void 0===s?void 0:s.id})));return i},l=async({savedSearchId:e,attributes:t,references:a,sharingSavedObjectProps:r,managed:i},{searchSourceCreate:s,savedObjectsTagging:o})=>{var d,l;const u=Object(c.parseSearchSourceJSON)(null!==(d=null===(l=t.kibanaSavedObjectMeta)||void 0===l?void 0:l.searchSourceJSON)&&void 0!==d?d:"{}"),g=Object(c.injectReferences)(u,a),h=((e,t,a,r,i,s,c)=>({...Object(n.fromSavedSearchAttributes)(e,t,a,i,c),sharingSavedObjectProps:s,references:r}))(e,t,o?o.ui.getTagIdsFromReferences(a):void 0,a,await s(g),r,Boolean(i));return h},u="search",g=async({title:e,isTitleDuplicateConfirmed:t,onTitleDuplicate:a,contentManagement:r})=>!(e&&!t&&a&&await(async(e,t)=>{if(e)return(await t.search({contentTypeId:u,query:{text:`"${e}"`},options:{searchFields:["title"],fields:["title"]}})).hits.some((t=>t.attributes.title.toLowerCase()===e.toLowerCase()))})(e,r))||(a(),Promise.reject(new Error(`Saved search title already exists: ${e}`))),h=async(e,t,a,r)=>(e?await r.update({contentTypeId:u,id:e,data:t,options:{references:a}}):await r.create({contentTypeId:u,data:t,options:{references:a}})).item.id;var v=a(2);const p=({spaces:e,savedObjectsTaggingOss:t,search:a,contentManagement:r})=>({spaces:e,savedObjectsTagging:null==t?void 0:t.getTaggingApi(),searchSourceCreate:a.searchSource.create,getSavedSrch:e=>r.get({contentTypeId:v.d,id:e})}),f=e=>({...e.attributes,references:e.references}),S=e=>{var t;const{references:a,...r}=e;return{references:a,attributes:{...r,description:null!==(t=r.description)&&void 0!==t?t:""}}};class saved_searches_service_SavedSearchesService{constructor(e){s()(this,"get",(e=>(async(e,t)=>{const a=await d(e,t);return await l({savedSearchId:e,attributes:a.item.attributes,references:a.item.references,sharingSavedObjectProps:a.meta,managed:a.item.managed},t)})(e,p(this.deps)))),s()(this,"getAll",(async()=>{const{contentManagement:e}=this.deps;return(await e.search({contentTypeId:n.SavedSearchType,query:{}})).hits})),s()(this,"getNew",(()=>(({searchSource:e})=>({searchSource:e.createEmpty(),managed:!1}))({searchSource:this.deps.search.searchSource}))),s()(this,"find",(async e=>{const{contentManagement:t}=this.deps;return(await t.search({contentTypeId:n.SavedSearchType,query:{text:e},options:{searchFields:["title"],fields:["title"]}})).hits})),s()(this,"save",((e,t={})=>{const{contentManagement:a,savedObjectsTaggingOss:r}=this.deps;return(async(e,t,a,r)=>{var n;const i=t.copyOnSave||!e.id;if(i)try{await g({title:e.title,isTitleDuplicateConfirmed:t.isTitleDuplicateConfirmed,onTitleDuplicate:t.onTitleDuplicate,contentManagement:a})}catch{return}const{searchSourceJSON:s,references:c}=e.searchSource.serialize(),d=r?r.ui.updateTagsReferences(c,null!==(n=e.tags)&&void 0!==n?n:[]):c;return h(i?void 0:e.id,((e,t)=>{var a,r,n,i,s,c,d,l;return{kibanaSavedObjectMeta:{searchSourceJSON:t},title:null!==(a=e.title)&&void 0!==a?a:"",sort:null!==(r=e.sort)&&void 0!==r?r:[],columns:null!==(n=e.columns)&&void 0!==n?n:[],description:null!==(i=e.description)&&void 0!==i?i:"",grid:null!==(s=e.grid)&&void 0!==s?s:{},hideChart:null!==(c=e.hideChart)&&void 0!==c&&c,viewMode:e.viewMode,hideAggregatedPreview:e.hideAggregatedPreview,rowHeight:e.rowHeight,headerRowHeight:e.headerRowHeight,isTextBasedQuery:null!==(d=e.isTextBasedQuery)&&void 0!==d&&d,usesAdHocDataView:e.usesAdHocDataView,timeRestore:null!==(l=e.timeRestore)&&void 0!==l&&l,timeRange:e.timeRange?Object(o.pick)(e.timeRange,["from","to"]):void 0,refreshInterval:e.refreshInterval,rowsPerPage:e.rowsPerPage,sampleSize:e.sampleSize,breakdownField:e.breakdownField,visContext:e.visContext}})(e,s),d,a)})(e,t,a,null==r?void 0:r.getTaggingApi())})),this.deps=e}}const b={name:"kibana_context",from:{null:()=>({type:"kibana_context"})},to:{null:()=>({type:"null"}),filter:e=>{const{filters:t=[]}=e;return{type:"filter",filterType:"filter",and:t.map(c.adaptToExpressionValueFilter)}}}};class plugin_SavedSearchPublicPlugin{setup({getStartServices:e},{contentManagement:t,expressions:a,embeddable:i}){return t.registry.register({id:n.SavedSearchType,version:{latest:n.LATEST_VERSION},name:r.i18n.translate("savedSearch.contentManagementType",{defaultMessage:"Saved search"})}),a.registerFunction(function({getStartServices:e}){return Object(n.getKibanaContextFn)((async()=>{const[,,{get:t}]=await e();return{getSavedSearch:t}}))}({getStartServices:e})),a.registerType(b),i.registerSavedObjectToPanelMethod(n.SavedSearchType,(e=>e.managed?{attributes:f(e)}:{savedObjectId:e.id})),{}}start(e,{data:{search:t},spaces:a,savedObjectsTaggingOss:r,contentManagement:{client:n},embeddable:i}){const s={search:t,spaces:a,savedObjectsTaggingOss:r,contentManagement:n,embeddable:i},c=new saved_searches_service_SavedSearchesService(s);return{get:e=>c.get(e),getAll:()=>c.getAll(),getNew:()=>c.getNew(),save:(e,t)=>c.save(e,t),byValue:{attributeService:(o=s,o.embeddable.getAttributeService("search",{saveMethod:async(e,t)=>{const{references:a,attributes:r}=S(e);return{id:await h(t,r,a,o.contentManagement)}},unwrapMethod:async e=>{const t=await d(e,p(o));return{attributes:f(t.item),metaInfo:{sharingSavedObjectProps:t.meta,managed:t.item.managed}}},checkForDuplicateTitle:e=>g({title:e.newTitle,isTitleDuplicateConfirmed:e.isTitleDuplicateConfirmed,onTitleDuplicate:e.onTitleDuplicate,contentManagement:o.contentManagement})})),toSavedSearch:async(e,t)=>(async(e,t,a)=>{var r;const{sharingSavedObjectProps:n,managed:i}=null!==(r=t.metaInfo)&&void 0!==r?r:{};return await l({...S(t.attributes),savedSearchId:e,sharingSavedObjectProps:n,managed:i},p(a))})(e,t,s)}};var o}}function m(){return new plugin_SavedSearchPublicPlugin}}]);