(window.discover_bundle_jsonpfunction=window.discover_bundle_jsonpfunction||[]).push([[8],{226:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(227);case"v8light":return s(229)}},227:function(e,t,s){var a=s(96),o=s(228);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},228:function(e,t,s){(t=s(97)(!1)).push([e.i,".dscDocsPage{height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)) - 54px)}.dscDocsContent{display:flex;flex-direction:column;height:100%}.dscDocsGrid{flex:1 1 100%;overflow:auto}.dscDocsGrid .unifiedDataTable__cell--highlight{background-color:#103148}",""]),e.exports=t},229:function(e,t,s){var a=s(96),o=s(230);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},230:function(e,t,s){(t=s(97)(!1)).push([e.i,".dscDocsPage{height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)) - 54px)}.dscDocsContent{display:flex;flex-direction:column;height:100%}.dscDocsGrid{flex:1 1 100%;overflow:auto}.dscDocsGrid .unifiedDataTable__cell--highlight{background-color:#e6f1fa}",""]),e.exports=t},250:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(251);case"v8light":return s(253)}},251:function(e,t,s){var a=s(96),o=s(252);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},252:function(e,t,s){(t=s(97)(!1)).push([e.i,".cxtSizePicker{text-align:center;width:80px}.cxtSizePicker::-webkit-inner-spin-button,.cxtSizePicker::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}",""]),e.exports=t},253:function(e,t,s){var a=s(96),o=s(254);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},254:function(e,t,s){(t=s(97)(!1)).push([e.i,".cxtSizePicker{text-align:center;width:80px}.cxtSizePicker::-webkit-inner-spin-button,.cxtSizePicker::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}",""]),e.exports=t},297:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(39),o=s(132),n=a.__importDefault(s(186));t.default=function(e,t){n.default(e,t,o.isDeepEqual)}},463:function(e,t,s){"use strict";s.r(t),s.d(t,"renderApp",(function(){return Ke}));var a=s(1),o=s.n(a),n=s(4),r=s(64),i=s.n(r),c=s(136),l=s(3);const d=(e,t)=>s=>(i.a.render(Object(l.jsx)(c.a,t,e),s),()=>i.a.unmountComponentAtNode(s));s(2),a.Component;var u=s(13),j=s.n(u),b=s(61),g=s(78);const p=({children:e,...t})=>Object(l.jsx)(b.Router,t,Object(l.jsx)(g.CompatRouter,null,e));var m=s(5);const O={services:{}},f=Object(a.createContext)(O);var x=s(297),h=s.n(x);const v=({children:e,component:t,render:s,...n})=>{const r=Object(a.useMemo)((()=>{if(t)return e=>Object(l.jsx)(o.a.Fragment,null,Object(l.jsx)(S,null),Object(l.jsx)(t,e))}),[t]);if(r)return Object(l.jsx)(b.Route,j()({},n,{component:r}));if(s||"function"==typeof e){const t="function"==typeof e?e:s;return Object(l.jsx)(b.Route,j()({},n,{render:e=>Object(l.jsx)(o.a.Fragment,null,Object(l.jsx)(S,null),t(e))}))}return Object(l.jsx)(b.Route,n,Object(l.jsx)(S,null),e)},S=()=>{const{executionContext:e}=Object(a.useContext)(f).services,t=Object(b.useRouteMatch)();return function(e,t){h()((()=>(null==e||e.set(t),()=>{null==e||e.clear()})),[t])}(e,{type:"application",page:t.path,id:Object.keys(t.params).length>0?JSON.stringify(t.params):void 0}),null},w=({legacySwitch:e=!0,children:t})=>{const s=Object(b.useRouteMatch)();return e?Object(l.jsx)(b.Switch,null,t):Object(l.jsx)(g.Routes,null,a.Children.map(t,(e=>{if(o.a.isValidElement(e)&&e.type===v){var a;const n=Object(m.replace)(null==e?void 0:e.props.path,s.url+"/",""),r="function"==typeof(null==e?void 0:e.props.children)?null==e?void 0:e.props.children:null==e?void 0:e.props.render;return Object(l.jsx)(g.Route,{path:n,element:Object(l.jsx)(o.a.Fragment,null,Object(l.jsx)(S,null),(null==e||null===(a=e.props)||void 0===a?void 0:a.component)&&Object(l.jsx)(e.props.component,null)||r&&r()||t)})}return e})))};var C=s(22),E=s(27),y=s(24),D=s.n(y),F=s(57),M=(s(226),s(58)),I=s.n(M),N=s(59),A=s(120),T=s(40),R=s(178),L=s(152);let k=function(e){return e.FAILED="failed",e.LOADED="loaded",e.LOADING="loading",e.UNINITIALIZED="uninitialized",e}({}),P=function(e){return e.UNKNOWN="unknown",e.INVALID_TIEBREAKER="invalid_tiebreaker",e}({});const V=()=>({anchor:{},predecessors:[],successors:[],anchorStatus:{value:k.UNINITIALIZED},predecessorsStatus:{value:k.UNINITIALIZED},successorsStatus:{value:k.UNINITIALIZED},anchorInterceptedWarnings:void 0,predecessorsInterceptedWarnings:void 0,successorsInterceptedWarnings:void 0});function _({status:e}){return e.value!==k.FAILED?null:Object(l.jsx)(C.EuiCallOut,{title:Object(l.jsx)(F.FormattedMessage,{id:"discover.context.failedToLoadAnchorDocumentDescription",defaultMessage:"Failed to load the anchor document"}),color:"danger",iconType:"warning","data-test-subj":"contextErrorMessageTitle"},Object(l.jsx)(C.EuiText,{"data-test-subj":"contextErrorMessageBody"},e.reason===P.UNKNOWN&&Object(l.jsx)(F.FormattedMessage,{id:"discover.context.reloadPageDescription.reloadOrVisitTextMessage",defaultMessage:"Please reload or go back to the document list to select a valid anchor document."})))}var W=s(10),z=s(7),U=s(167),B=s(109);const q="_a";function $(e,t){return!e&&!t||!(!e||!t)&&Object(W.compareFilters)(e,t,W.COMPARE_ALL_OPTIONS)}function H(e){return e&&Array.isArray(e.filters)?e.filters:[]}const G=({ariaLabelContent:e,markdownContent:t,children:s,className:o,onRender:n,openLinksInNewTab:r=!0,defaultValue:i="",placeholder:c="",height:d="full",readOnly:u=!1,enableTooltipSupport:b=!1,validateLinks:g=!1,enableSoftLineBreaks:p=!1,...m})=>{const[O,f]=Object(a.useState)(i);Object(a.useEffect)((()=>{null==n||n()}),[n]);const x=Array();b||x.push("tooltip"),g||x.push("linkValidator"),p&&x.push("lineBreaks");const{parsingPlugins:h,processingPlugins:v,uiPlugins:S}=Object(C.getDefaultEuiMarkdownPlugins)({exclude:x});var w;return v[1][1].components.a=e=>Object(l.jsx)(C.EuiLink,j()({},e,{target:"_blank"})),u?Object(l.jsx)(C.EuiMarkdownFormat,{textSize:"relative",color:"inherit",className:o,"aria-label":null!=e?e:"markdown component",parsingPluginList:h,processingPluginList:r?v:void 0,"data-test-subj":m["data-test-subj"],style:m.style},null!==(w=null!=s?s:t)&&void 0!==w?w:""):Object(l.jsx)(C.EuiMarkdownEditor,{className:o,"aria-label":null!=e?e:"markdown component",placeholder:c,value:O,onChange:f,height:d,uiPlugins:S,parsingPluginList:h,processingPluginList:r?v:void 0,"data-test-subj":m["data-test-subj"]})};var Q=s(0),K=s(69),Z=s(474);let J=function(e){return e.asc="asc",e.desc="desc",e}({});var X=s(74),Y=s.n(X);function ee(e,t){if(!e)return null;const s=Y()(e).toISOString();return s?""!==t?`${s.substring(0,s.length-4)}${t}Z`:s:null}async function te(e,t,s,a,o,n,r,i,c,l,d){var u;const j={format:"strict_date_optional_time"},[b,g]=o;b&&(j[a===N.SortDirection.asc?"gte":"lte"]=ee(b,i)),g&&(j[a===N.SortDirection.asc?"lte":"gte"]=ee(g,i));const p=new K.RequestAdapter,m=e.setField("size",r).setField("query",{query:{bool:{must:{constant_score:{filter:{range:{[t]:j}}}},must_not:{ids:{values:[c]}}}},language:"lucene"}).setField("searchAfter",n).setField("sort",s).setField("version",!0).fetch$({disableWarningToasts:!0,inspector:{adapter:p,title:l}}),{rawResponse:O}=await Object(Q.lastValueFrom)(m),f=e.getField("index"),x=null===(u=O.hits)||void 0===u?void 0:u.hits.map((e=>Object(Z.a)(e,f))),h=[];return d.data.search.showWarnings(p,(e=>(h.push(e),!0))),{rows:null!=x?x:[],interceptedWarnings:h}}function se(e,t,s){var a,o;if(t.length){var n,r;const s=t[e===oe.SUCCESSORS&&t.length?t.length-1:0].raw;return[null===(n=s.sort)||void 0===n?void 0:n[0],null===(r=s.sort)||void 0===r?void 0:r[1]]}return[null===(a=s.raw.sort)||void 0===a?void 0:a[0],null===(o=s.raw.sort)||void 0===o?void 0:o[1]]}var ae=s(114);let oe=function(e){return e.SUCCESSORS="successors",e.PREDECESSORS="predecessors",e}({});const ne=[0,1,7,30,365,1e4].map((e=>864e5*e));var re=s(14);const ie=(e,t,s)=>({[e]:{value:k.FAILED,error:s,reason:t}});var ce=s(135),le=s(449),de=s(162),ue=s(164),je=s(108);function be({docCount:e,type:t}){return t===oe.PREDECESSORS?Object(l.jsx)(C.EuiCallOut,{color:"primary","data-test-subj":"predecessorsWarningMsg",iconType:"iInCircle",title:0===e?Object(l.jsx)(F.FormattedMessage,{id:"discover.context.newerDocumentsWarningZero",defaultMessage:"No documents newer than the anchor could be found."}):Object(l.jsx)(F.FormattedMessage,{id:"discover.context.newerDocumentsWarning",defaultMessage:"Only {docCount} documents newer than the anchor could be found.",values:{docCount:e}}),size:"s"}):Object(l.jsx)(C.EuiCallOut,{color:"primary","data-test-subj":"successorsWarningMsg",iconType:"iInCircle",title:0===e?Object(l.jsx)(F.FormattedMessage,{id:"discover.context.olderDocumentsWarningZero",defaultMessage:"No documents older than the anchor could be found."}):Object(l.jsx)(F.FormattedMessage,{id:"discover.context.olderDocumentsWarning",defaultMessage:"Only {docCount} documents older than the anchor could be found.",values:{docCount:e}}),size:"s"})}s(250);const ge=1e4;function pe({defaultStepSize:e,docCount:t,docCountAvailable:s,isDisabled:o,isLoading:r,onChangeCount:i,type:c}){const d=!o&&!r&&s<t,u=c===oe.SUCCESSORS,[j,b]=Object(a.useState)(t),g=e>0||j!==t,p=e=>e>=0&&e<=ge;return Object(a.useEffect)((()=>{j!==t&&0===j&&b(t)}),[t,j]),Object(l.jsx)("form",{onSubmit:e=>{e.preventDefault(),j!==t&&p(j)&&i(c,j)}},u&&Object(l.jsx)(C.EuiSpacer,{size:"s"}),u&&d&&Object(l.jsx)(be,{docCount:s,type:c}),u&&d&&Object(l.jsx)(C.EuiSpacer,{size:"s"}),Object(l.jsx)(C.EuiFlexGroup,{direction:"row",gutterSize:"s",responsive:!1},Object(l.jsx)(C.EuiFlexItem,{grow:!1},Object(l.jsx)(C.EuiButtonEmpty,{"data-test-subj":`${c}LoadMoreButton`,isDisabled:o||!g,isLoading:r,onClick:()=>{const t=j+e;p(t)&&(b(t),i(c,t))},flush:"right"},Object(l.jsx)(F.FormattedMessage,{id:"discover.context.loadButtonLabel",defaultMessage:"Load"}))),Object(l.jsx)(C.EuiFlexItem,{grow:!1},Object(l.jsx)(C.EuiFormRow,{display:"center"},Object(l.jsx)(C.EuiFieldNumber,{"aria-label":u?n.i18n.translate("discover.context.olderDocumentsAriaLabel",{defaultMessage:"Number of older documents"}):n.i18n.translate("discover.context.newerDocumentsAriaLabel",{defaultMessage:"Number of newer documents"}),compressed:!0,className:"cxtSizePicker","data-test-subj":`${c}CountPicker`,disabled:o,min:0,max:ge,onChange:e=>{b(e.target.valueAsNumber)},onBlur:()=>{j!==t&&p(j)&&i(c,j)},type:"number",value:j>=0?j:""}))),Object(l.jsx)(C.EuiFlexItem,null,Object(l.jsx)(C.EuiFormRow,{display:"center"},u?Object(l.jsx)(F.FormattedMessage,{id:"discover.context.olderDocumentsDescription",defaultMessage:"older documents"}):Object(l.jsx)(F.FormattedMessage,{id:"discover.context.newerDocumentsDescription",defaultMessage:"newer documents"})))),!u&&d&&Object(l.jsx)(C.EuiSpacer,{size:"s"}),!u&&d&&Object(l.jsx)(be,{docCount:s,type:c}),Object(l.jsx)(C.EuiSpacer,{size:"s"}))}s(149);var me=s(209),Oe=s(163);const fe=o.a.memo(Oe.a),xe=e=>Object(l.jsx)(a.Fragment,null,Object(l.jsx)(me.a,{onClick:e.onSkipBottomButtonClick}),Object(l.jsx)("table",{className:"kbn-table table","data-test-subj":"docTable"},Object(l.jsx)("thead",null,e.renderHeader()),Object(l.jsx)("tbody",null,e.renderRows(e.rows))),Object(l.jsx)("span",{tabIndex:-1,id:"discoverBottomMarker"},"​")),he=e=>Object(l.jsx)(fe,j()({},e,{render:xe}));var ve=s(150),Se=s(176);const we=["openDetails"],Ce=o.a.memo(ue.a),Ee=o.a.memo(he),ye=o.a.memo(pe);function De({columns:e,onAddColumn:t,onRemoveColumn:s,onSetColumns:n,dataView:r,predecessorCount:i,successorCount:c,rows:d,predecessors:u,successors:j,anchorStatus:b,predecessorsStatus:g,successorsStatus:p,interceptedWarnings:m,useNewFieldsApi:O,isLegacy:f,setAppState:x,addFilter:h}){const{uiSettings:v,uiActions:S}=Object(re.a)(),w=Object(re.a)(),[E,y]=Object(a.useState)(),[D,M]=Object(a.useState)(),I=b===k.LOADING||b===k.UNINITIALIZED,A=g===k.LOADING||g===k.UNINITIALIZED,R=p===k.LOADING||p===k.UNINITIALIZED,L=Object(a.useMemo)((()=>!v.get(T.e,!1)&&!!r.timeFieldName),[v,r]),P=Object(a.useMemo)((()=>parseInt(v.get(T.b),10)),[v]),V=Object(a.useCallback)(((e,t)=>{const s=e===oe.SUCCESSORS?"successorCount":"predecessorCount";var a;x({[s]:(a=t,Math.max(Math.min(ge,a),0))})}),[x]),_=Object(a.useMemo)((()=>[[r.timeFieldName,N.SortDirection.desc]]),[r]),W=Object(a.useCallback)(((e,a,o)=>Object(l.jsx)(ve.a,{dataView:r,hit:e,hits:a,columns:o,onFilter:h,onRemoveColumn:s,onAddColumn:t,onClose:()=>M(void 0),setExpandedDoc:M})),[h,r,t,s]),z=Object(a.useCallback)((e=>{y((t=>Object(Se.a)(e,t)))}),[y]);return Object(l.jsx)(a.Fragment,null,Object(l.jsx)(Fe,null,Boolean(m.length)&&Object(l.jsx)(o.a.Fragment,null,Object(l.jsx)(le.a,{warnings:m}),Object(l.jsx)(C.EuiSpacer,{size:"s"})),Object(l.jsx)(ye,{type:oe.PREDECESSORS,defaultStepSize:P,docCount:i,docCountAvailable:u.length,onChangeCount:V,isLoading:A,isDisabled:I}),f&&I?Object(l.jsx)(C.EuiText,{textAlign:"center","data-test-subj":"contextApp_loadingIndicator"},Object(l.jsx)(F.FormattedMessage,{id:"discover.context.loadingDescription",defaultMessage:"Loading..."})):null),f&&d&&0!==d.length&&Object(l.jsx)(Ee,{columns:e,dataView:r,rows:d,isLoading:I,onFilter:h,onAddColumn:t,onRemoveColumn:s,sort:_,useNewFieldsApi:O,dataTestSubj:"contextDocTable"}),!f&&Object(l.jsx)("div",{className:"dscDocsGrid"},Object(l.jsx)(ce.a,{getTriggerCompatibleActions:S.getTriggerCompatibleActions},Object(l.jsx)(Ce,{ariaLabelledBy:"surDocumentsAriaLabel",columns:e,rows:d,dataView:r,expandedDoc:D,loadingState:I?de.a.loading:de.a.loaded,sampleSizeState:0,sort:_,isSortEnabled:!1,showTimeCol:L,useNewFieldsApi:O,isPaginationEnabled:!1,rowsPerPageState:Object(je.b)(w.uiSettings),controlColumnIds:we,setExpandedDoc:M,onFilter:h,onSetColumns:n,configRowHeight:w.uiSettings.get(T.k),showMultiFields:w.uiSettings.get(T.r),maxDocFieldsDisplayed:w.uiSettings.get(T.i),renderDocumentView:W,services:w,configHeaderRowHeight:3,settings:E,onResize:z}))),Object(l.jsx)(Fe,null,Object(l.jsx)(ye,{type:oe.SUCCESSORS,defaultStepSize:P,docCount:c,docCountAvailable:j.length,onChangeCount:V,isLoading:R,isDisabled:I})))}const Fe=({children:e})=>{const t=Object(C.useEuiPaddingSize)("s");return Object(l.jsx)("div",{css:Object(l.css)("padding:0 ",t,";","")},e)};var Me=s(126);const Ie=Object(a.memo)(De),Ne=({dataView:e,anchorId:t,referrer:s})=>{const o=Object(re.a)(),{analytics:r,locator:i,uiSettings:c,capabilities:u,dataViews:j,navigation:b,filterManager:g,core:p}=o,O=Object(a.useMemo)((()=>c.get(T.f)),[c]),f=Object(a.useMemo)((()=>!c.get(T.o)),[c]),{appState:x,globalState:h,stateContainer:v}=function({services:e,dataView:t}){const{uiSettings:s,history:o,core:n}=e,r=Object(a.useMemo)((()=>function({defaultSize:e,storeInSessionStorage:t=!1,history:s,toasts:a,uiSettings:o,data:n,dataView:r}){const i=Object(z.createKbnUrlStateStorage)({useHash:t,history:s,...a&&Object(z.withNotifyOnErrors)(a)}),c=function(e){const t={filters:[]};return"object"!=typeof e?t:{...t,...e}}(i.get("_g")),l=Object(z.createStateContainer)(c),d=function(e,t,s){const a={columns:["_source"],filters:[],predecessorCount:e,successorCount:e};return"object"!=typeof t?a:Object(B.a)({...a,...t},s)}(e,i.get(q),o),u=Object(z.createStateContainer)(d),j=()=>[...H(l.getState()),...H(u.getState())],{start:b,stop:g}=Object(z.syncStates)([{storageKey:"_g",stateContainer:{...l,set:e=>{e&&l.set(e)}},stateStorage:i},{storageKey:q,stateContainer:{...u,set:e=>{e&&u.set(e)}},stateStorage:i}]);let p=()=>{};return{globalState:l,appState:u,startSync:()=>{n.query.filterManager.setFilters(Object(U.a)(r,j()));const e=Object(N.connectToQueryState)(n.query,u,{filters:W.FilterStateStore.APP_STATE}),t=Object(N.connectToQueryState)(n.query,l,{filters:W.FilterStateStore.GLOBAL_STATE});p=()=>{e(),t()},b()},stopSync:()=>{p(),p=()=>{},g()},setAppState:e=>{const t=u.getState(),s={...t,...e};(function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const{filters:s=[],...a}=e,{filters:o=[],...n}=t;return Object(m.isEqual)(a,n)&&Object(W.compareFilters)(s,o,W.COMPARE_ALL_OPTIONS)})(t,s)||i.set(q,s,{replace:!0})},getFilters:j,setFilters:e=>{const t=e.getGlobalFilters();!$(t,H(l.getState()))&&l.set({filters:t});const s=e.getAppFilters();!$(s,H(u.getState()))&&u.set({...u.getState(),filters:s})},flushToUrl:e=>i.kbnUrlControls.flush(e)}}({defaultSize:parseInt(s.get(T.a),10),storeInSessionStorage:s.get("state:storeInSessionStorage"),history:o,toasts:n.notifications.toasts,uiSettings:s,data:e.data,dataView:t})),[s,o,n.notifications.toasts,e.data,t]),[i,c]=Object(a.useState)(r.appState.getState()),[l,d]=Object(a.useState)(r.globalState.getState());return Object(a.useEffect)((()=>(r.startSync(),()=>r.stopSync())),[r]),Object(a.useEffect)((()=>{const e=r.appState.subscribe((e=>{var t;const s={...e,filters:null!==(t=e.filters)&&void 0!==t?t:[]};c((e=>({...e,...s})))})),t=r.globalState.subscribe((e=>{var t;const s={...e,filters:null!==(t=e.filters)&&void 0!==t?t:[]};d((e=>({...e,...s})))}));return()=>{e(),t()}}),[r,c]),{appState:i,globalState:l,stateContainer:r}}({services:o,dataView:e}),S=Object(a.useRef)(),w=Object(a.useRef)({filters:[]}),{columns:y,onAddColumn:D,onRemoveColumn:M,onSetColumns:X}=Object(R.a)({capabilities:u,defaultOrder:c.get(T.s),dataView:e,dataViews:j,useNewFieldsApi:f,setAppState:v.setAppState,columns:x.columns,sort:x.sort});Object(a.useEffect)((()=>{Object(Me.a)({services:o,rootBreadcrumbPath:s,titleBreadcrumbText:n.i18n.translate("discover.context.breadcrumb",{defaultMessage:"Surrounding documents"})})}),[i,s,o]),Object(E.useExecutionContext)(p.executionContext,{type:"application",page:"context",id:e.id||""});const{fetchedState:Y,fetchContextRows:ee,fetchAllRows:ce,fetchSurroundingRows:le,resetFetchedState:de}=function({anchorId:e,dataView:t,appState:s,useNewFieldsApi:o}){const r=Object(re.a)(),{uiSettings:i,data:c,toastNotifications:u,filterManager:j}=r,b=Object(a.useMemo)((()=>c.search.searchSource.createEmpty()),[c.search.searchSource]),g=Object(a.useMemo)((()=>Object(ae.e)(t,i)),[i,t]),[p,m]=Object(a.useState)(V()),O=Object(a.useCallback)((e=>{m((t=>({...t,...e})))}),[]),f=Object(a.useCallback)((async()=>{const s=n.i18n.translate("discover.context.unableToLoadAnchorDocumentDescription",{defaultMessage:"Unable to load the anchor document"});if(!g)return O(ie("anchorStatus",P.INVALID_TIEBREAKER)),void u.addDanger({title:s,text:n.i18n.translate("discover.context.invalidTieBreakerFiledSetting",{defaultMessage:"Invalid tie breaker field setting"})});try{O({anchorStatus:{value:k.LOADING}});const s=Object(ae.d)({sortDir:N.SortDirection.desc,timeFieldName:t.timeFieldName,tieBreakerFieldName:g,isTimeNanosBased:t.isTimeNanosBased()}),a=await async function(e,t,s,a,o=!1,r){var i,c;!function(e,t,s,a,o){e.setParent(void 0).setField("index",o).setField("version",!0).setField("size",1).setField("query",{query:{constant_score:{filter:{ids:{values:[t]}}}},language:"lucene"}).setField("sort",s).setField("trackTotalHits",!1),a&&(e.removeField("fieldsFromSource"),e.setField("fields",[{field:"*",include_unmapped:!0}]))}(s,e,a,o,t);const l=new K.RequestAdapter,{rawResponse:d}=await Object(Q.lastValueFrom)(s.fetch$({disableWarningToasts:!0,inspector:{adapter:l,title:"anchor"}})),u=null===(i=d.hits)||void 0===i||null===(c=i.hits)||void 0===c?void 0:c[0];if(!u)throw new Error(n.i18n.translate("discover.context.failedToLoadAnchorDocumentErrorDescription",{defaultMessage:"Failed to load anchor document."}));const j=[];return r.data.search.showWarnings(l,(e=>(j.push(e),!0))),{anchorRow:Object(Z.a)(u,t,!0),interceptedWarnings:j}}(e,t,b,s,o,r);return O({anchor:a.anchorRow,anchorInterceptedWarnings:a.interceptedWarnings,anchorStatus:{value:k.LOADED}}),a.anchorRow}catch(e){O(ie("anchorStatus",P.UNKNOWN,e)),u.addDanger({title:s,text:d(Object(l.jsx)(G,{readOnly:!0},e.message),r)})}}),[r,g,O,u,t,e,b,o]),x=Object(a.useCallback)((async(e,a)=>{const i=j.getFilters(),b=e===oe.PREDECESSORS?s.predecessorCount:s.successorCount,m=a||p.anchor,f=`${e}Status`,x=`${e}InterceptedWarnings`,h=n.i18n.translate("discover.context.unableToLoadDocumentDescription",{defaultMessage:"Unable to load documents"});try{O({[f]:{value:k.LOADING}});const s=m.id?await async function(e,t,s,a,o,n,r,i,c,l){var d,u,j;if("object"!=typeof s||null===s||!s.raw._id||!n)return{rows:[],interceptedWarnings:void 0};const b=t.timeFieldName,g=i.search.searchSource.createEmpty();!function(e,t,s,a){a&&(e.removeField("fieldsFromSource"),e.setField("fields",[{field:"*",include_unmapped:!0}])),e.setParent(void 0).setField("index",t).setField("filter",s).setField("trackTotalHits",!1)}(g,t,r,Boolean(c));const p=e===oe.SUCCESSORS?o:o===J.asc?J.desc:J.asc,m=s.raw,O=t.isTimeNanosBased()?function(e=""){const t=e.split("."),s=2===t.length?t[1].replace("Z",""):"";return 9!==s.length?s.padEnd(9,"0"):s}(null===(d=m.fields)||void 0===d?void 0:d[b][0]):"",f=""!==O?(x=null===(u=m.fields)||void 0===u?void 0:u[b][0],new Date(x).getTime()):null===(j=m.sort)||void 0===j?void 0:j[0];var x;const h=function(e,t,s,a){const o=a===N.SortDirection.asc&&s===oe.SUCCESSORS||a===N.SortDirection.desc&&s===oe.PREDECESSORS?1:-1;return function*(e){let t=[];for(const s of e)t=[...t,s].slice(-2),2===t.length&&(yield t)}([...e.map((e=>t+e*o)),null])}(ne,f,e,o);let v=[],S=[];for(const o of h){const r=n-v.length;if(r<=0)break;const i=se(e,v,s),c=Object(ae.d)({timeFieldName:b,tieBreakerFieldName:a,sortDir:p,isTimeNanosBased:t.isTimeNanosBased()}),d=await te(g,b,c,p,o,i,r,O,s.raw._id,e,l);v=e===oe.SUCCESSORS?[...v,...d.rows]:[...d.rows.slice().reverse(),...v],d.interceptedWarnings&&(S=e===oe.SUCCESSORS?[...S,...d.interceptedWarnings]:[...d.interceptedWarnings.slice().reverse(),...S])}return{rows:v,interceptedWarnings:S}}(e,t,m,g,N.SortDirection.desc,b,i,c,o,r):{rows:[],interceptedWarnings:void 0};O({[e]:s.rows,[x]:s.interceptedWarnings,[f]:{value:k.LOADED}})}catch(e){O(ie(f,P.UNKNOWN,e)),u.addDanger({title:h,text:d(Object(l.jsx)(G,{readOnly:!0},e.message),r)})}}),[r,j,s,p.anchor,g,O,t,u,o,c]),h=Object(a.useCallback)((e=>Promise.allSettled([x(oe.PREDECESSORS,e),x(oe.SUCCESSORS,e)])),[x]),v=Object(a.useCallback)((async()=>{const e=await f();if(e)return await h(e)}),[f,h]),S=Object(a.useCallback)((()=>{m(V())}),[]);return{fetchedState:p,fetchAllRows:v,fetchContextRows:h,fetchSurroundingRows:x,resetFetchedState:S}}({anchorId:t,dataView:e,appState:x,useNewFieldsApi:f});Object(a.useEffect)((()=>{S.current&&(S.current=void 0,de())}),[t,de]),Object(a.useEffect)((()=>{(async()=>{const e=window.performance.now();let t="";if(S.current?S.current.predecessorCount!==x.predecessorCount?(t="predecessors",await le(oe.PREDECESSORS)):S.current.successorCount!==x.successorCount?(t="successors",await le(oe.SUCCESSORS)):$(S.current.filters,x.filters)&&$(w.current.filters,h.filters)||(t="context",await ee()):(t="all",await ce()),r&&t){const s=window.performance.now()-e;Object(A.a)(r,{eventName:"discoverSurroundingDocsFetch",duration:s,meta:{fetchType:t}})}})(),S.current=Object(m.cloneDeep)(x),w.current=Object(m.cloneDeep)(h)}),[r,x,h,t,ee,ce,le,Y.anchor.id]);const ue=Object(a.useMemo)((()=>[...Y.predecessors||[],...Y.anchor.id?[Y.anchor]:[],...Y.successors||[]]),[Y.predecessors,Y.anchor,Y.successors]),je=Object(a.useMemo)((()=>[...Y.predecessorsInterceptedWarnings||[],...Y.anchorInterceptedWarnings||[],...Y.successorsInterceptedWarnings||[]]),[Y.predecessorsInterceptedWarnings,Y.anchorInterceptedWarnings,Y.successorsInterceptedWarnings]),be=Object(a.useCallback)((async(t,s,a)=>{const o=Object(N.generateFilters)(g,t,s,a,e);if(g.addFilters(o),j){const s="string"==typeof t?t:t.name;await Object(L.a)(e,s,j,u)}}),[g,j,e,u]),ge=b.ui.AggregateQueryTopNavMenu,pe=Object(C.useEuiPaddingSize)("m");return Object(l.jsx)(a.Fragment,null,Y.anchorStatus.value===k.FAILED?Object(l.jsx)(_,{status:Y.anchorStatus}):Object(l.jsx)(a.Fragment,null,Object(l.jsx)("h1",{id:"contextAppTitle",className:"euiScreenReaderOnly","data-test-subj":"discoverContextAppTitle"},n.i18n.translate("discover.context.pageTitle",{defaultMessage:"Documents surrounding #{anchorId}",values:{anchorId:t}})),Object(l.jsx)(ge,{appName:"context",showSearchBar:!0,showQueryInput:!1,showFilterBar:!0,saveQueryMenuVisibility:"hidden",showDatePicker:!1,indexPatterns:[e],useDefaultBehaviors:!0}),Object(l.jsx)(C.EuiPage,{className:I()({dscDocsPage:!O})},Object(l.jsx)(C.EuiPageBody,{panelled:!0,paddingSize:"none",className:"dscDocsContent",panelProps:{role:"main"}},Object(l.jsx)(C.EuiText,{"data-test-subj":"contextDocumentSurroundingHeader",css:Object(l.css)("padding:",pe," ",pe," 0;","")},Object(l.jsx)("strong",null,Object(l.jsx)(F.FormattedMessage,{id:"discover.context.contextOfTitle",defaultMessage:"Documents surrounding #{anchorId}",values:{anchorId:t}}))),Object(l.jsx)(C.EuiSpacer,{size:"s"}),Object(l.jsx)(Ie,{dataView:e,useNewFieldsApi:f,isLegacy:O,columns:y,onAddColumn:D,onRemoveColumn:M,onSetColumns:X,predecessorCount:x.predecessorCount,successorCount:x.successorCount,setAppState:v.setAppState,addFilter:be,rows:ue,predecessors:Y.predecessors,successors:Y.successors,anchorStatus:Y.anchorStatus.value,predecessorsStatus:Y.predecessorsStatus.value,successorsStatus:Y.successorsStatus.value,interceptedWarnings:je})))))};var Ae=s(127);const Te=({index:e})=>{const{dataViews:t}=Object(re.a)(),[s,o]=Object(a.useState)(),[n,r]=Object(a.useState)();return Object(a.useEffect)((()=>{("object"==typeof e?t.create(e):t.get(e)).then(o).catch(r)}),[t,e]),{dataView:s,error:n}};function Re(){const e=Object(re.a)().getScopedHistory(),t=Object(a.useMemo)((()=>null==e?void 0:e.location.state),[null==e?void 0:e.location.state]);Object(a.useEffect)((()=>{const s=null==e?void 0:e.listen((s=>{const a=s.state;if((null==a||!a.referrer)&&t){const o={...s,state:{...a,...t}};e.replace(o)}}));return()=>null==s?void 0:s()}),[t,e]);const{dataViewId:s,id:o}=Object(b.useParams)(),n=decodeURIComponent(s),r=decodeURIComponent(o),{dataView:i,error:c}=Te({index:(null==t?void 0:t.dataViewSpec)||n});return c?Object(l.jsx)(C.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger",title:Object(l.jsx)(F.FormattedMessage,{id:"discover.contextViewRoute.errorTitle",defaultMessage:"An error occurred"}),body:Object(l.jsx)(F.FormattedMessage,{id:"discover.contextViewRoute.errorMessage",defaultMessage:"No matching data view for id {dataViewId}",values:{dataViewId:n}})}):i?Object(l.jsx)(Ne,{anchorId:r,dataView:i,referrer:null==t?void 0:t.referrer}):Object(l.jsx)(Ae.a,null)}let Le=function(e){return e[e.Loading=0]="Loading",e[e.NotFound=1]="NotFound",e[e.Found=2]="Found",e[e.Error=3]="Error",e[e.NotFoundDataView=4]="NotFoundDataView",e}({});var ke=s(71);function Pe(e){const{dataView:t}=e,[s,o]=Object(ke.useEsDocSearch)(e),r=Object(re.a)(),{locator:i,chrome:c,docLinks:d}=r,u=d.links.apis.indexExists;return Object(a.useEffect)((()=>{Object(Me.a)({services:r,titleBreadcrumbText:`${e.index}#${e.id}`,rootBreadcrumbPath:e.referrer})}),[c,e.referrer,e.index,e.id,t,i,r]),Object(l.jsx)(C.EuiPage,null,Object(l.jsx)("h1",{id:"singleDocTitle",className:"euiScreenReaderOnly","data-test-subj":"discoverSingleDocTitle"},n.i18n.translate("discover.doc.pageTitle",{defaultMessage:"Single document - #{id}",values:{id:e.id}})),Object(l.jsx)(C.EuiPageBody,{panelled:!0,paddingSize:"m",panelProps:{role:"main"}},s===Le.NotFoundDataView&&Object(l.jsx)(C.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-notFoundDataView",iconType:"warning",title:Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.failedToLocateDataView",defaultMessage:"No data view matches ID {dataViewId}.",values:{dataViewId:t.id}})}),s===Le.NotFound&&Object(l.jsx)(C.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-notFound",iconType:"warning",title:Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.failedToLocateDocumentDescription",defaultMessage:"Cannot find document"})},Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.couldNotFindDocumentsDescription",defaultMessage:"No documents match that ID."})),s===Le.Error&&Object(l.jsx)(C.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-error",iconType:"warning",title:Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.failedToExecuteQueryDescription",defaultMessage:"Cannot run search"})},Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.somethingWentWrongDescription",defaultMessage:"{indexName} is missing.",values:{indexName:e.index}})," ",Object(l.jsx)(C.EuiLink,{href:u,target:"_blank"},Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.somethingWentWrongDescriptionAddon",defaultMessage:"Please ensure the index exists."}))),s===Le.Loading&&Object(l.jsx)(C.EuiCallOut,{"data-test-subj":"doc-msg-loading"},Object(l.jsx)(C.EuiLoadingSpinner,{size:"m"})," ",Object(l.jsx)(F.FormattedMessage,{id:"discover.doc.loadingDescription",defaultMessage:"Loading…"})),s===Le.Found&&null!==o&&t&&Object(l.jsx)("div",{"data-test-subj":"doc-hit"},Object(l.jsx)(ke.UnifiedDocViewer,{hit:o,dataView:t,hideActionsColumn:!0}))))}var Ve=s(179);const _e=()=>{const{timefilter:e,core:t,getScopedHistory:s}=Object(re.a)(),{search:o}=Object(b.useLocation)(),{dataViewId:r,index:i}=Object(b.useParams)(),c=Object(a.useMemo)((()=>new URLSearchParams(o)),[o]).get("id"),d=Object(a.useMemo)((()=>{var e;return null===(e=s())||void 0===e?void 0:e.location.state}),[s]);Object(E.useExecutionContext)(t.executionContext,{type:"application",page:"single-doc",id:r}),Object(a.useEffect)((()=>{e.disableAutoRefreshSelector(),e.disableTimeRangeSelector()}),[e]);const{dataView:u,error:j}=Te({index:(null==d?void 0:d.dataViewSpec)||decodeURIComponent(r)});return j?Object(l.jsx)(C.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger",title:Object(l.jsx)(F.FormattedMessage,{id:"discover.singleDocRoute.errorTitle",defaultMessage:"An error occurred"}),body:Object(l.jsx)(F.FormattedMessage,{id:"discover.singleDocRoute.errorMessage",defaultMessage:"No matching data view for id {dataViewId}",values:{dataViewId:r}})}):u?c?Object(l.jsx)(Pe,{id:c,index:i,dataView:u,referrer:null==d?void 0:d.referrer}):Object(l.jsx)(Ve.a,{error:new Error(n.i18n.translate("discover.discoverError.missingIdParamError",{defaultMessage:"No document ID provided. Return to Discover to select another document."}))}):Object(l.jsx)(Ae.a,null)};var We=s(206);let ze;function Ue(){const e=Object(re.a)(),{urlForwarding:t,urlTracker:s,core:o,history:r}=e,i=r.location.pathname;return Object(a.useEffect)((()=>{const e=window.location.hash.substr(1);s.restorePreviousUrl(),t.navigateToLegacyKibanaUrl(e);const a=n.i18n.translate("discover.noMatchRoute.bannerTitleText",{defaultMessage:"Page not found"});ze=o.overlays.banners.replace(ze,d(Object(l.jsx)(C.EuiCallOut,{color:"warning",iconType:"iInCircle",title:a},Object(l.jsx)("p",{"data-test-subj":"invalidRouteMessage"},Object(l.jsx)(F.FormattedMessage,{id:"discover.noMatchRoute.bannerText",defaultMessage:"Discover application doesn't recognize this route: {route}",values:{route:r.location.state.referrer}}))),o)),setTimeout((()=>{ze&&o.overlays.banners.remove(ze)}),15e3)}),[o,r,t,s]),Object(l.jsx)(b.Redirect,{to:{pathname:"/",state:{referrer:i}}})}var Be=s(187),qe=s(224),$e=s(65);function He(){const{core:e,data:t,locator:s,toastNotifications:o,dataViews:r}=Object(re.a)(),{id:i}=Object(b.useParams)(),c=Object(b.useHistory)(),{search:u}=Object(b.useLocation)(),j=Object(a.useMemo)((()=>new URLSearchParams(u)),[u]),g=Object(a.useMemo)((()=>({from:j.get("from"),to:j.get("to")})),[j]),p=Object(a.useMemo)((()=>(e=>Boolean(e.from&&e.to))(g)),[g]);return Object(a.useEffect)((()=>{const{fetchAlert:a,fetchSearchSource:c,buildLocatorParams:u}=((e,t,s,a,o,r)=>({fetchAlert:async e=>{try{return await a.http.get(`/api/alerts/alert/${e}`)}catch(e){const t=n.i18n.translate("discover.viewAlert.alertRuleFetchErrorTitle",{defaultMessage:"Error fetching alert rule"});throw s.addDanger({title:t,text:d(Object(l.jsx)(G,{readOnly:!0},e.message),a)}),new Error(t)}},fetchSearchSource:async e=>{try{return{alert:e,searchSource:await o.search.searchSource.create(e.params.searchConfiguration)}}catch(e){const t=n.i18n.translate("discover.viewAlert.searchSourceErrorTitle",{defaultMessage:"Error fetching search source"});throw s.addDanger({title:t,text:d(Object(l.jsx)(G,{markdownContent:e.message,readOnly:!0}),a)}),new Error(t)}},buildLocatorParams:async({alert:a,searchSource:i})=>{var c;let l=i.getField("index"),d=i.getField("query")||o.query.queryString.getDefaultQuery();if(a.params&&"esqlQuery"in a.params&&a.params.esqlQuery&&"esql"in a.params.esqlQuery){d=a.params.esqlQuery;const e=Object(qe.a)(a.params.esqlQuery.esql);l=await r.create({title:e,timeFieldName:a.params.timeField})}const u=null===(c=l)||void 0===c?void 0:c.timeFieldName;if(!l||!u)throw(e=>{const t=n.i18n.translate("discover.viewAlert.dataViewErrorTitle",{defaultMessage:"Error fetching data view"}),a=n.i18n.translate("discover.viewAlert.dataViewErrorText",{defaultMessage:"Data view failure of the alert rule with id {alertId}.",values:{alertId:e}});s.addDanger({title:t,text:a})})(a.id),new Error("Data view fetch error");const j=e?{from:t.from,to:t.to}:((e,t,s)=>{const a=Object($e.getTime)(e,{from:`now-${t.params.timeWindowSize}${t.params.timeWindowUnit}`,to:"now"});return{from:null==a?void 0:a.query.range[s].gte,to:null==a?void 0:a.query.range[s].lte}})(l,a,u);return{query:d,dataViewSpec:l.toSpec(!1),timeRange:j,filters:i.getField("filter")}}}))(p,g,o,e,t,r);a(i).then(c).then(u).then((e=>{p&&Object(Be.a)(o),s.navigate(e)})).catch((()=>s.navigate({})))}),[e,t,r,c,i,s,p,g,o]),null}const Ge=({customizationContext$:e,services:t,history:s,...a})=>{const o=D()(e);return null==o?null:Object(l.jsx)(E.KibanaContextProvider,{services:t},Object(l.jsx)(C.EuiErrorBoundary,null,Object(l.jsx)(p,{history:s,"data-test-subj":"discover-react-router"},Object(l.jsx)(Qe,j()({customizationContext:o,services:t,history:s},a)))))},Qe=({customizationContext:e,services:t,history:s,...a})=>Object(l.jsx)(w,null,Object(l.jsx)(v,{path:"/context/:dataViewId/:id"},Object(l.jsx)(Re,null)),Object(l.jsx)(v,{path:"/doc/:dataView/:index/:type",render:e=>Object(l.jsx)(b.Redirect,{to:`/doc/${e.match.params.dataView}/${e.match.params.index}`})}),Object(l.jsx)(v,{path:"/doc/:dataViewId/:index"},Object(l.jsx)(_e,null)),Object(l.jsx)(v,{path:"/viewAlert/:id"},Object(l.jsx)(He,null)),Object(l.jsx)(v,{path:"/view/:id"},Object(l.jsx)(We.a,j()({customizationContext:e},a))),Object(l.jsx)(v,{path:"/",exact:!0},Object(l.jsx)(We.a,j()({customizationContext:e},a))),Object(l.jsx)(Ue,null)),Ke=({element:e,services:t,customizationContext$:s,experimentalFeatures:a})=>{const{history:o,capabilities:r,chrome:i,data:c,core:u}=t;r.discover.save||i.setBadge({text:n.i18n.translate("discover.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:n.i18n.translate("discover.badge.readOnly.tooltip",{defaultMessage:"Unable to save searches"}),iconType:"glasses"});const j=d(Object(l.jsx)(Ge,{services:t,customizationContext$:s,experimentalFeatures:a,history:o}),u)(e);return()=>{j(),c.search.session.clear()}}}}]);