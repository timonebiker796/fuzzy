!function(e){function t(t){for(var a,r,n=t[0],i=t[1],o=0,u=[];o<n.length;o++)r=n[o],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&u.push(s[r][0]),s[r]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);for(l&&l(t);u.length;)u.shift()()}var a={},s={0:0};function r(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.e=function(e){var t=[],a=s[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((function(t,r){a=s[e]=[t,r]}));t.push(a[2]=n);var i,o=document.createElement("script");o.charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.src=function(e){return r.p+"data.chunk."+e+".js"}(e);var l=new Error;i=function(t){o.onerror=o.onload=null,clearTimeout(u);var a=s[e];if(0!==a){if(a){var r=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+n+")",l.name="ChunkLoadError",l.type=r,l.request=n,a[1](l)}s[e]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:o})}),12e4);o.onerror=o.onload=i,document.head.appendChild(o)}return Promise.all(t)},r.m=e,r.c=a,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var n=window.data_bundle_jsonpfunction=window.data_bundle_jsonpfunction||[],i=n.push.bind(n);n.push=t,n=n.slice();for(var o=0;o<n.length;o++)t(n[o]);var l=i;r(r.s=87)}([function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,a){e.exports=a(68)(2)},function(e,t,a){"use strict";a.r(t),a.d(t,"DEFAULT_QUERY_LANGUAGE",(function(){return s.a})),a.d(t,"KIBANA_USER_QUERY_LANGUAGE_KEY",(function(){return s.b})),a.d(t,"KQL_TELEMETRY_ROUTE_LATEST_VERSION",(function(){return s.c})),a.d(t,"SAVED_QUERY_BASE_URL",(function(){return s.d})),a.d(t,"SCRIPT_LANGUAGES_ROUTE_LATEST_VERSION",(function(){return s.e})),a.d(t,"UI_SETTINGS",(function(){return s.f})),a.d(t,"DatatableUtilitiesService",(function(){return datatable_utilities_service_DatatableUtilitiesService})),a.d(t,"getEsQueryConfig",(function(){return n.a})),a.d(t,"KbnFieldType",(function(){return i.c})),a.d(t,"calculateBounds",(function(){return o.a})),a.d(t,"getAbsoluteTimeRange",(function(){return o.b})),a.d(t,"getRelativeTime",(function(){return o.c})),a.d(t,"getTime",(function(){return o.d})),a.d(t,"isQuery",(function(){return o.e})),a.d(t,"isTimeRange",(function(){return o.f})),a.d(t,"textBasedQueryStateToAstWithValidation",(function(){return o.g})),a.d(t,"textBasedQueryStateToExpressionAst",(function(){return o.h})),a.d(t,"AggConfig",(function(){return l.a})),a.d(t,"AggConfigs",(function(){return l.b})),a.d(t,"AggGroupNames",(function(){return l.d})),a.d(t,"AggGroupLabels",(function(){return l.c})),a.d(t,"AggType",(function(){return l.f})),a.d(t,"getAggTypes",(function(){return l.fd})),a.d(t,"getAggTypesFunctions",(function(){return l.gd})),a.d(t,"AggTypesRegistry",(function(){return l.g})),a.d(t,"aggsRequiredUiSettings",(function(){return l.Ec})),a.d(t,"AggsCommonService",(function(){return l.h})),a.d(t,"autoInterval",(function(){return l.Fc})),a.d(t,"isAutoInterval",(function(){return l.ue})),a.d(t,"intervalOptions",(function(){return l.ne})),a.d(t,"BucketAggType",(function(){return l.k})),a.d(t,"isBucketAggType",(function(){return l.ve})),a.d(t,"BUCKET_TYPES",(function(){return l.i})),a.d(t,"aggDateHistogramFnName",(function(){return l.kb})),a.d(t,"aggDateHistogram",(function(){return l.jb})),a.d(t,"isDateHistogramBucketAggConfig",(function(){return l.we})),a.d(t,"getDateHistogramBucketAgg",(function(){return l.rd})),a.d(t,"aggDateRangeFnName",(function(){return l.mb})),a.d(t,"aggDateRange",(function(){return l.lb})),a.d(t,"getDateRangeBucketAgg",(function(){return l.sd})),a.d(t,"aggFilterFnName",(function(){return l.sb})),a.d(t,"aggFilter",(function(){return l.rb})),a.d(t,"getFilterBucketAgg",(function(){return l.zd})),a.d(t,"aggFiltersFnName",(function(){return l.wb})),a.d(t,"aggFilters",(function(){return l.vb})),a.d(t,"getFiltersBucketAgg",(function(){return l.Bd})),a.d(t,"aggGeoTileFnName",(function(){return l.Cb})),a.d(t,"aggGeoTile",(function(){return l.Bb})),a.d(t,"getGeoTitleBucketAgg",(function(){return l.Ed})),a.d(t,"aggHistogramFnName",(function(){return l.Eb})),a.d(t,"aggHistogram",(function(){return l.Db})),a.d(t,"getHistogramBucketAgg",(function(){return l.Fd})),a.d(t,"aggIpPrefixFnName",(function(){return l.Gb})),a.d(t,"aggIpPrefix",(function(){return l.Fb})),a.d(t,"getIpPrefixBucketAgg",(function(){return l.Gd})),a.d(t,"aggIpRangeFnName",(function(){return l.Ib})),a.d(t,"aggIpRange",(function(){return l.Hb})),a.d(t,"IP_RANGE_TYPES",(function(){return l.u})),a.d(t,"getIpRangeBucketAgg",(function(){return l.Hd})),a.d(t,"CidrMask",(function(){return l.l})),a.d(t,"convertDateRangeToString",(function(){return l.Lc})),a.d(t,"convertIPRangeToString",(function(){return l.Mc})),a.d(t,"boundsDescendingRaw",(function(){return l.Gc})),a.d(t,"calcAutoIntervalNear",(function(){return l.Ic})),a.d(t,"calcAutoIntervalLessThan",(function(){return l.Hc})),a.d(t,"TimeBuckets",(function(){return l.R})),a.d(t,"isType",(function(){return l.Ee})),a.d(t,"isNumberType",(function(){return l.ze})),a.d(t,"isStringType",(function(){return l.De})),a.d(t,"isStringOrNumberType",(function(){return l.Ce})),a.d(t,"migrateIncludeExcludeFormat",(function(){return l.Me})),a.d(t,"aggRangeFnName",(function(){return l.Yb})),a.d(t,"aggRange",(function(){return l.Xb})),a.d(t,"getRangeBucketAgg",(function(){return l.Qd})),a.d(t,"aggSignificantTermsFnName",(function(){return l.ic})),a.d(t,"aggSignificantTerms",(function(){return l.hc})),a.d(t,"getSignificantTermsBucketAgg",(function(){return l.Yd})),a.d(t,"aggSignificantTextFnName",(function(){return l.kc})),a.d(t,"aggSignificantText",(function(){return l.jc})),a.d(t,"getSignificantTextBucketAgg",(function(){return l.Zd})),a.d(t,"aggTermsFnName",(function(){return l.uc})),a.d(t,"aggTerms",(function(){return l.tc})),a.d(t,"termsAggFilter",(function(){return l.of})),a.d(t,"getTermsBucketAgg",(function(){return l.ee})),a.d(t,"MultiFieldKey",(function(){return l.C})),a.d(t,"isMultiFieldKey",(function(){return l.ye})),a.d(t,"MULTI_FIELD_KEY_SEPARATOR",(function(){return l.A})),a.d(t,"aggMultiTermsFnName",(function(){return l.Sb})),a.d(t,"aggMultiTerms",(function(){return l.Rb})),a.d(t,"getMultiTermsBucketAgg",(function(){return l.Md})),a.d(t,"aggRareTermsFnName",(function(){return l.ac})),a.d(t,"aggRareTerms",(function(){return l.Zb})),a.d(t,"getRareTermsBucketAgg",(function(){return l.Rd})),a.d(t,"aggSamplerFnName",(function(){return l.ec})),a.d(t,"aggSampler",(function(){return l.dc})),a.d(t,"SAMPLER_AGG_NAME",(function(){return l.G})),a.d(t,"getSamplerBucketAgg",(function(){return l.Ud})),a.d(t,"aggDiversifiedSamplerFnName",(function(){return l.qb})),a.d(t,"aggDiversifiedSampler",(function(){return l.pb})),a.d(t,"DIVERSIFIED_SAMPLER_AGG_NAME",(function(){return l.m})),a.d(t,"getDiversifiedSamplerBucketAgg",(function(){return l.ud})),a.d(t,"getTimeSeriesBucketAgg",(function(){return l.fe})),a.d(t,"aggTimeSeriesFnName",(function(){return l.wc})),a.d(t,"aggTimeSeries",(function(){return l.vc})),a.d(t,"SHARD_DELAY_AGG_NAME",(function(){return l.J})),a.d(t,"aggAvgFnName",(function(){return l.U})),a.d(t,"aggAvg",(function(){return l.T})),a.d(t,"getAvgMetricAgg",(function(){return l.id})),a.d(t,"aggBucketAvgFnName",(function(){return l.W})),a.d(t,"aggBucketAvg",(function(){return l.V})),a.d(t,"getBucketAvgMetricAgg",(function(){return l.jd})),a.d(t,"aggBucketMaxFnName",(function(){return l.Y})),a.d(t,"aggBucketMax",(function(){return l.X})),a.d(t,"getBucketMaxMetricAgg",(function(){return l.kd})),a.d(t,"aggBucketMinFnName",(function(){return l.ab})),a.d(t,"aggBucketMin",(function(){return l.Z})),a.d(t,"getBucketMinMetricAgg",(function(){return l.ld})),a.d(t,"aggBucketSumFnName",(function(){return l.cb})),a.d(t,"aggBucketSum",(function(){return l.bb})),a.d(t,"getBucketSumMetricAgg",(function(){return l.md})),a.d(t,"aggFilteredMetricFnName",(function(){return l.ub})),a.d(t,"aggFilteredMetric",(function(){return l.tb})),a.d(t,"getFilteredMetricAgg",(function(){return l.Ad})),a.d(t,"aggCardinalityFnName",(function(){return l.eb})),a.d(t,"aggCardinality",(function(){return l.db})),a.d(t,"getCardinalityMetricAgg",(function(){return l.od})),a.d(t,"aggValueCountFnName",(function(){return l.Cc})),a.d(t,"aggValueCount",(function(){return l.Bc})),a.d(t,"getValueCountMetricAgg",(function(){return l.je})),a.d(t,"getCountMetricAgg",(function(){return l.pd})),a.d(t,"aggCountFnName",(function(){return l.gb})),a.d(t,"aggCount",(function(){return l.fb})),a.d(t,"aggCumulativeSumFnName",(function(){return l.ib})),a.d(t,"aggCumulativeSum",(function(){return l.hb})),a.d(t,"getCumulativeSumMetricAgg",(function(){return l.qd})),a.d(t,"aggDerivativeFnName",(function(){return l.ob})),a.d(t,"aggDerivative",(function(){return l.nb})),a.d(t,"getDerivativeMetricAgg",(function(){return l.td})),a.d(t,"aggGeoBoundsFnName",(function(){return l.yb})),a.d(t,"aggGeoBounds",(function(){return l.xb})),a.d(t,"getGeoBoundsMetricAgg",(function(){return l.Cd})),a.d(t,"aggGeoCentroidFnName",(function(){return l.Ab})),a.d(t,"aggGeoCentroid",(function(){return l.zb})),a.d(t,"getGeoCentroidMetricAgg",(function(){return l.Dd})),a.d(t,"parentPipelineType",(function(){return l.Qe})),a.d(t,"parentPipelineAggHelper",(function(){return l.Pe})),a.d(t,"siblingPipelineType",(function(){return l.jf})),a.d(t,"siblingPipelineAggHelper",(function(){return l.if})),a.d(t,"aggMaxFnName",(function(){return l.Kb})),a.d(t,"aggMax",(function(){return l.Jb})),a.d(t,"getMaxMetricAgg",(function(){return l.Id})),a.d(t,"aggMedianFnName",(function(){return l.Mb})),a.d(t,"aggMedian",(function(){return l.Lb})),a.d(t,"getMedianMetricAgg",(function(){return l.Jd})),a.d(t,"aggSinglePercentileFnName",(function(){return l.mc})),a.d(t,"aggSinglePercentile",(function(){return l.lc})),a.d(t,"getSinglePercentileMetricAgg",(function(){return l.ae})),a.d(t,"MetricAggType",(function(){return l.B})),a.d(t,"isMetricAggType",(function(){return l.xe})),a.d(t,"METRIC_TYPES",(function(){return l.z})),a.d(t,"aggMinFnName",(function(){return l.Ob})),a.d(t,"aggMin",(function(){return l.Nb})),a.d(t,"getMinMetricAgg",(function(){return l.Kd})),a.d(t,"aggMovingAvgFnName",(function(){return l.Qb})),a.d(t,"aggMovingAvg",(function(){return l.Pb})),a.d(t,"getMovingAvgMetricAgg",(function(){return l.Ld})),a.d(t,"aggPercentileRanksFnName",(function(){return l.Ub})),a.d(t,"aggPercentileRanks",(function(){return l.Tb})),a.d(t,"getPercentileRanksMetricAgg",(function(){return l.Nd})),a.d(t,"aggPercentilesFnName",(function(){return l.Wb})),a.d(t,"aggPercentiles",(function(){return l.Vb})),a.d(t,"getPercentilesMetricAgg",(function(){return l.Od})),a.d(t,"aggRateFnName",(function(){return l.cc})),a.d(t,"aggRate",(function(){return l.bc})),a.d(t,"getRateMetricAgg",(function(){return l.Sd})),a.d(t,"aggSinglePercentileRankFnName",(function(){return l.oc})),a.d(t,"aggSinglePercentileRank",(function(){return l.nc})),a.d(t,"getSinglePercentileRankMetricAgg",(function(){return l.be})),a.d(t,"aggSerialDiffFnName",(function(){return l.gc})),a.d(t,"aggSerialDiff",(function(){return l.fc})),a.d(t,"getSerialDiffMetricAgg",(function(){return l.Xd})),a.d(t,"aggStdDeviationFnName",(function(){return l.qc})),a.d(t,"aggStdDeviation",(function(){return l.pc})),a.d(t,"getStdDeviationMetricAgg",(function(){return l.ce})),a.d(t,"aggSumFnName",(function(){return l.sc})),a.d(t,"aggSum",(function(){return l.rc})),a.d(t,"getSumMetricAgg",(function(){return l.de})),a.d(t,"aggTopHitFnName",(function(){return l.yc})),a.d(t,"aggTopHit",(function(){return l.xc})),a.d(t,"getTopHitMetricAgg",(function(){return l.ge})),a.d(t,"getTopMetricsMetricAgg",(function(){return l.he})),a.d(t,"aggTopMetricsFnName",(function(){return l.Ac})),a.d(t,"aggTopMetrics",(function(){return l.zc})),a.d(t,"AggParamType",(function(){return l.e})),a.d(t,"BaseParamType",(function(){return l.j})),a.d(t,"FieldParamType",(function(){return l.t})),a.d(t,"JsonParamType",(function(){return l.y})),a.d(t,"OptionedParamType",(function(){return l.D})),a.d(t,"StringParamType",(function(){return l.Q})),a.d(t,"getCalculateAutoTimeExpression",(function(){return l.nd})),a.d(t,"dateHistogramInterval",(function(){return l.Oc})),a.d(t,"InvalidEsCalendarIntervalError",(function(){return l.v})),a.d(t,"InvalidEsIntervalFormatError",(function(){return l.w})),a.d(t,"isValidEsInterval",(function(){return l.Fe})),a.d(t,"isValidInterval",(function(){return l.Ge})),a.d(t,"splitStringInterval",(function(){return l.kf})),a.d(t,"parseInterval",(function(){return l.Te})),a.d(t,"parseEsInterval",(function(){return l.Se})),a.d(t,"toAbsoluteDates",(function(){return l.qf})),a.d(t,"getAggsFormats",(function(){return l.hd})),a.d(t,"IpAddress",(function(){return l.x})),a.d(t,"propFilter",(function(){return l.Ye})),a.d(t,"inferTimeZone",(function(){return l.le})),a.d(t,"parseTimeShift",(function(){return l.Ve})),a.d(t,"isAbsoluteTimeShift",(function(){return l.te})),a.d(t,"REASON_IDS",(function(){return l.E})),a.d(t,"parseAbsoluteTimeShift",(function(){return l.Re})),a.d(t,"validateAbsoluteTimeShift",(function(){return l.rf})),a.d(t,"cidrFunction",(function(){return l.Jc})),a.d(t,"cidrToAst",(function(){return l.Kc})),a.d(t,"dateRangeFunction",(function(){return l.Pc})),a.d(t,"dateRangeToAst",(function(){return l.Qc})),a.d(t,"extendedBoundsFunction",(function(){return l.Uc})),a.d(t,"extendedBoundsToAst",(function(){return l.Vc})),a.d(t,"geoBoundingBoxFunction",(function(){return l.bd})),a.d(t,"geoBoundingBoxToAst",(function(){return l.cd})),a.d(t,"geoPointFunction",(function(){return l.dd})),a.d(t,"geoPointToAst",(function(){return l.ed})),a.d(t,"ipPrefixFunction",(function(){return l.oe})),a.d(t,"ipPrefixToAst",(function(){return l.pe})),a.d(t,"ipRangeFunction",(function(){return l.qe})),a.d(t,"ipRangeToAst",(function(){return l.re})),a.d(t,"kibana",(function(){return l.He})),a.d(t,"kqlFunction",(function(){return l.Ke})),a.d(t,"luceneFunction",(function(){return l.Le})),a.d(t,"numericalRangeFunction",(function(){return l.Ne})),a.d(t,"numericalRangeToAst",(function(){return l.Oe})),a.d(t,"queryFilterFunction",(function(){return l.Ze})),a.d(t,"queryFilterToAst",(function(){return l.af})),a.d(t,"queryToAst",(function(){return l.bf})),a.d(t,"aggregateQueryToAst",(function(){return l.Dc})),a.d(t,"timerangeToAst",(function(){return l.pf})),a.d(t,"getEsaggsMeta",(function(){return l.wd})),a.d(t,"handleEsaggsRequest",(function(){return l.ke})),a.d(t,"functionWrapper",(function(){return l.ad})),a.d(t,"adaptToExpressionValueFilter",(function(){return l.S})),a.d(t,"rangeFunction",(function(){return l.ef})),a.d(t,"fieldFunction",(function(){return l.Xc})),a.d(t,"phraseFilterFunction",(function(){return l.We})),a.d(t,"existsFilterFunction",(function(){return l.Tc})),a.d(t,"rangeFilterFunction",(function(){return l.df})),a.d(t,"removeFilterFunction",(function(){return l.ff})),a.d(t,"selectFilterFunction",(function(){return l.hf})),a.d(t,"kibanaFilterFunction",(function(){return l.Ie})),a.d(t,"filtersToAst",(function(){return l.Yc})),a.d(t,"kibanaTimerangeFunction",(function(){return l.Je})),a.d(t,"esRawResponse",(function(){return l.Sc})),a.d(t,"eqlRawResponse",(function(){return l.Rc})),a.d(t,"getEsdslFn",(function(){return l.xd})),a.d(t,"getEqlFn",(function(){return l.vd})),a.d(t,"getEsqlFn",(function(){return l.yd})),a.d(t,"createSearchSource",(function(){return l.Nc})),a.d(t,"injectReferences",(function(){return l.me})),a.d(t,"extractReferences",(function(){return l.Wc})),a.d(t,"parseSearchSourceJSON",(function(){return l.Ue})),a.d(t,"getResponseInspectorStats",(function(){return l.Td})),a.d(t,"getSearchParams",(function(){return l.Vd})),a.d(t,"getSearchParamsFromRequest",(function(){return l.Wd})),a.d(t,"getPreference",(function(){return l.Pd})),a.d(t,"RequestFailure",(function(){return l.F})),a.d(t,"searchSourceRequiredUiSettings",(function(){return l.gf})),a.d(t,"SearchSource",(function(){return l.M})),a.d(t,"SearchSourceService",(function(){return l.N})),a.d(t,"SortDirection",(function(){return l.P})),a.d(t,"isSerializedSearchSource",(function(){return l.Be})),a.d(t,"queryToFields",(function(){return l.cf})),a.d(t,"tabifyDocs",(function(){return l.mf})),a.d(t,"flattenHit",(function(){return l.Zc})),a.d(t,"tabifyAggResponse",(function(){return l.lf})),a.d(t,"tabifyGetColumns",(function(){return l.nf})),a.d(t,"isAbortResponse",(function(){return l.se})),a.d(t,"isRunningResponse",(function(){return l.Ae})),a.d(t,"getUserTimeZone",(function(){return l.ie})),a.d(t,"SearchSessionStatus",(function(){return l.L})),a.d(t,"SearchStatus",(function(){return l.O})),a.d(t,"SEARCH_SESSION_TYPE",(function(){return l.I})),a.d(t,"SEARCH_SESSIONS_TABLE_ID",(function(){return l.H})),a.d(t,"pollSearch",(function(){return l.Xe})),a.d(t,"ES_SEARCH_STRATEGY",(function(){return l.s})),a.d(t,"EQL_SEARCH_STRATEGY",(function(){return l.o})),a.d(t,"ENHANCED_ES_SEARCH_STRATEGY",(function(){return l.n})),a.d(t,"SQL_SEARCH_STRATEGY",(function(){return l.K})),a.d(t,"ESQL_SEARCH_STRATEGY",(function(){return l.q})),a.d(t,"ESQL_ASYNC_SEARCH_STRATEGY",(function(){return l.p})),a.d(t,"ESQL_TABLE_TYPE",(function(){return l.r})),a.d(t,"KBN_FIELD_TYPES",(function(){return u.b})),a.d(t,"ES_FIELD_TYPES",(function(){return u.a})),a.d(t,"createEscapeValue",(function(){return b})),a.d(t,"tableHasFormulas",(function(){return m})),a.d(t,"datatableToCSV",(function(){return _})),a.d(t,"cellHasFormulas",(function(){return f})),a.d(t,"CSV_FORMULA_CHARS",(function(){return c})),a.d(t,"CSV_MIME_TYPE",(function(){return v})),a.d(t,"RUNTIME_FIELD_TYPES",(function(){return S.RUNTIME_FIELD_TYPES})),a.d(t,"DEFAULT_ASSETS_TO_IGNORE",(function(){return S.DEFAULT_ASSETS_TO_IGNORE})),a.d(t,"META_FIELDS",(function(){return S.META_FIELDS})),a.d(t,"DATA_VIEW_SAVED_OBJECT_TYPE",(function(){return S.DATA_VIEW_SAVED_OBJECT_TYPE})),a.d(t,"isFilterable",(function(){return S.isFilterable})),a.d(t,"fieldList",(function(){return S.fieldList})),a.d(t,"DataViewField",(function(){return S.DataViewField})),a.d(t,"DataViewType",(function(){return S.DataViewType})),a.d(t,"DataViewsService",(function(){return S.DataViewsService})),a.d(t,"DataView",(function(){return S.DataView})),a.d(t,"DuplicateDataViewError",(function(){return S.DuplicateDataViewError})),a.d(t,"DataViewSavedObjectConflictError",(function(){return S.DataViewSavedObjectConflictError})),a.d(t,"getIndexPatternLoadMeta",(function(){return S.getIndexPatternLoadMeta})),a.d(t,"isNestedField",(function(){return S.isNestedField})),a.d(t,"isMultiField",(function(){return S.isMultiField})),a.d(t,"getFieldSubtypeMulti",(function(){return S.getFieldSubtypeMulti})),a.d(t,"getFieldSubtypeNested",(function(){return S.getFieldSubtypeNested}));var s=a(19),r=a(12);class datatable_utilities_service_DatatableUtilitiesService{constructor(e,t,a){this.aggs=e,this.dataViews=t,this.fieldFormats=a,this.getAggConfig=this.getAggConfig.bind(this),this.getDataView=this.getDataView.bind(this),this.getField=this.getField.bind(this),this.isFilterable=this.isFilterable.bind(this)}clearField(e){delete e.meta.field}clearFieldFormat(e){delete e.meta.params}async getAggConfig(e){const t=await this.getDataView(e);if(!t)return;const{aggs:a}=await this.aggs.createAggConfigs(t,e.meta.sourceParams&&[e.meta.sourceParams]);return a[0]}getDateHistogramMeta(e,t={}){var a;if("esaggs"!==e.meta.source)return;if((null===(a=e.meta.sourceParams)||void 0===a?void 0:a.type)!==r.a.DATE_HISTOGRAM)return;const s=e.meta.sourceParams.params;let n;return s.used_interval&&"auto"!==s.used_interval&&(n=s.used_interval),{interval:n,timeZone:s.used_time_zone||t.timeZone,timeRange:e.meta.sourceParams.appliedTimeRange}}async getDataView(e){if(e.meta.index)return this.dataViews.get(e.meta.index)}async getField(e){if(!e.meta.field)return;const t=await this.getDataView(e);return t?t.getFieldByName(e.meta.field):void 0}getFieldFormat(e){return this.fieldFormats.deserialize(e.meta.params)}getInterval(e){var t;const a=null===(t=e.meta.sourceParams)||void 0===t?void 0:t.params;return null==a?void 0:a.interval}getNumberHistogramInterval(e){var t;if("esaggs"!==e.meta.source)return;if((null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type)!==r.a.HISTOGRAM)return;const a=e.meta.sourceParams.params;return a.used_interval&&"string"!=typeof a.used_interval?a.used_interval:void 0}getTotalCount(e){var t,a;return null===(t=e.meta)||void 0===t||null===(a=t.statistics)||void 0===a?void 0:a.totalCount}hasPrecisionError(e){var t;return null===(t=e.meta.sourceParams)||void 0===t?void 0:t.hasPrecisionError}isFilterable(e){var t;if("esaggs"!==e.meta.source)return!1;const a=this.aggs.types.get(null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type);return Boolean(a.createFilter)}setFieldFormat(e,t){e.meta.params=t.toJSON()}}var n=a(30),i=a(26),o=a(28),l=a(10),u=a(36);const c=["=","+","-","@"],d=/[^a-zA-Z0-9]/,g=/"/g,h=new Set([",",";","\t"," ","|"]);var p=a(1);const f=e=>c.some((t=>Object(p.startsWith)(e,t))),m=(e,t)=>e.some((({name:e})=>f(e)))||t.some((t=>e.some((({id:e})=>f(t[e])))));function b({separator:e,quoteValues:t,escapeFormulaValues:a}){return function(s){if(s&&"string"==typeof s){const e=a&&f(s)?"'"+s:s;if(t&&d.test(e))return`"${e.replace(g,'""')}"`}const r=null==s?"":s.toString();return t&&function(e,t){const a=t.trim();return e.includes(a)&&h.has(a)}(r,e)?`"${r}"`:r}}const y="\r\n",v="text/plain;charset=utf-8";function _({columns:e,rows:t},{csvSeparator:a,quoteValues:s,formatFactory:r,raw:n,escapeFormulaValues:i,columnsSorting:o}){const l=b({separator:a,quoteValues:s,escapeFormulaValues:i}),u=(o||e.map((e=>e.id))).reduce(((e,t,a)=>(e[t]=a,e)),{}),c=[],d=[],g={};for(const t of e){var h;const e=u[t.id];c[e]=l(t.name),d[e]=t.id,g[t.id]=r(null===(h=t.meta)||void 0===h?void 0:h.params)}return 0===c.length?"":[c,...t.map((e=>d.map((t=>l(n?e[t]:g[t].convert(e[t]))))))].map((e=>e.join(a))).join(y)+y}var S=a(13)},function(e,t){e.exports=__kbnSharedDeps__.KbnEsQuery},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,a){"use strict";a.d(t,"a",(function(){return s.a})),a.d(t,"b",(function(){return s.b})),a.d(t,"d",(function(){return s.d})),a.d(t,"c",(function(){return s.c})),a.d(t,"f",(function(){return s.f})),a.d(t,"fd",(function(){return s.vc})),a.d(t,"gd",(function(){return s.wc})),a.d(t,"g",(function(){return s.g})),a.d(t,"Ec",(function(){return s.nc})),a.d(t,"h",(function(){return s.h})),a.d(t,"Fc",(function(){return s.oc})),a.d(t,"ue",(function(){return s.ud})),a.d(t,"ne",(function(){return s.sd})),a.d(t,"k",(function(){return s.k})),a.d(t,"ve",(function(){return s.vd})),a.d(t,"i",(function(){return s.i})),a.d(t,"kb",(function(){return s.U})),a.d(t,"jb",(function(){return s.T})),a.d(t,"we",(function(){return s.wd})),a.d(t,"rd",(function(){return s.Hc})),a.d(t,"mb",(function(){return s.W})),a.d(t,"lb",(function(){return s.V})),a.d(t,"sd",(function(){return s.Ic})),a.d(t,"sb",(function(){return s.cb})),a.d(t,"rb",(function(){return s.bb})),a.d(t,"zd",(function(){return s.Lc})),a.d(t,"wb",(function(){return s.gb})),a.d(t,"vb",(function(){return s.fb})),a.d(t,"Bd",(function(){return s.Nc})),a.d(t,"Cb",(function(){return s.mb})),a.d(t,"Bb",(function(){return s.lb})),a.d(t,"Ed",(function(){return s.Qc})),a.d(t,"Eb",(function(){return s.ob})),a.d(t,"Db",(function(){return s.nb})),a.d(t,"Fd",(function(){return s.Rc})),a.d(t,"Gb",(function(){return s.qb})),a.d(t,"Fb",(function(){return s.pb})),a.d(t,"Gd",(function(){return s.Sc})),a.d(t,"Ib",(function(){return s.sb})),a.d(t,"Hb",(function(){return s.rb})),a.d(t,"u",(function(){return s.o})),a.d(t,"Hd",(function(){return s.Tc})),a.d(t,"l",(function(){return s.l})),a.d(t,"Lc",(function(){return s.sc})),a.d(t,"Mc",(function(){return s.tc})),a.d(t,"Gc",(function(){return s.pc})),a.d(t,"Ic",(function(){return s.rc})),a.d(t,"Hc",(function(){return s.qc})),a.d(t,"R",(function(){return s.C})),a.d(t,"Ee",(function(){return s.Cd})),a.d(t,"ze",(function(){return s.zd})),a.d(t,"De",(function(){return s.Bd})),a.d(t,"Ce",(function(){return s.Ad})),a.d(t,"Me",(function(){return s.Fd})),a.d(t,"Yb",(function(){return s.Ib})),a.d(t,"Xb",(function(){return s.Hb})),a.d(t,"Qd",(function(){return s.bd})),a.d(t,"ic",(function(){return s.Sb})),a.d(t,"hc",(function(){return s.Rb})),a.d(t,"Yd",(function(){return s.gd})),a.d(t,"kc",(function(){return s.Ub})),a.d(t,"jc",(function(){return s.Tb})),a.d(t,"Zd",(function(){return s.hd})),a.d(t,"uc",(function(){return s.ec})),a.d(t,"tc",(function(){return s.dc})),a.d(t,"of",(function(){return s.Qd})),a.d(t,"ee",(function(){return s.md})),a.d(t,"C",(function(){return s.w})),a.d(t,"ye",(function(){return s.yd})),a.d(t,"A",(function(){return s.u})),a.d(t,"Sb",(function(){return s.Cb})),a.d(t,"Rb",(function(){return s.Bb})),a.d(t,"Md",(function(){return s.Yc})),a.d(t,"ac",(function(){return s.Kb})),a.d(t,"Zb",(function(){return s.Jb})),a.d(t,"Rd",(function(){return s.cd})),a.d(t,"ec",(function(){return s.Ob})),a.d(t,"dc",(function(){return s.Nb})),a.d(t,"G",(function(){return s.z})),a.d(t,"Ud",(function(){return s.ed})),a.d(t,"qb",(function(){return s.ab})),a.d(t,"pb",(function(){return s.Z})),a.d(t,"m",(function(){return s.m})),a.d(t,"ud",(function(){return s.Kc})),a.d(t,"fe",(function(){return s.nd})),a.d(t,"wc",(function(){return s.gc})),a.d(t,"vc",(function(){return s.fc})),a.d(t,"J",(function(){return s.A})),a.d(t,"U",(function(){return s.E})),a.d(t,"T",(function(){return s.D})),a.d(t,"id",(function(){return s.yc})),a.d(t,"W",(function(){return s.G})),a.d(t,"V",(function(){return s.F})),a.d(t,"jd",(function(){return s.zc})),a.d(t,"Y",(function(){return s.I})),a.d(t,"X",(function(){return s.H})),a.d(t,"kd",(function(){return s.Ac})),a.d(t,"ab",(function(){return s.K})),a.d(t,"Z",(function(){return s.J})),a.d(t,"ld",(function(){return s.Bc})),a.d(t,"cb",(function(){return s.M})),a.d(t,"bb",(function(){return s.L})),a.d(t,"md",(function(){return s.Cc})),a.d(t,"ub",(function(){return s.eb})),a.d(t,"tb",(function(){return s.db})),a.d(t,"Ad",(function(){return s.Mc})),a.d(t,"eb",(function(){return s.O})),a.d(t,"db",(function(){return s.N})),a.d(t,"od",(function(){return s.Ec})),a.d(t,"Cc",(function(){return s.mc})),a.d(t,"Bc",(function(){return s.lc})),a.d(t,"je",(function(){return s.qd})),a.d(t,"pd",(function(){return s.Fc})),a.d(t,"gb",(function(){return s.Q})),a.d(t,"fb",(function(){return s.P})),a.d(t,"ib",(function(){return s.S})),a.d(t,"hb",(function(){return s.R})),a.d(t,"qd",(function(){return s.Gc})),a.d(t,"ob",(function(){return s.Y})),a.d(t,"nb",(function(){return s.X})),a.d(t,"td",(function(){return s.Jc})),a.d(t,"yb",(function(){return s.ib})),a.d(t,"xb",(function(){return s.hb})),a.d(t,"Cd",(function(){return s.Oc})),a.d(t,"Ab",(function(){return s.kb})),a.d(t,"zb",(function(){return s.jb})),a.d(t,"Dd",(function(){return s.Pc})),a.d(t,"Qe",(function(){return s.Hd})),a.d(t,"Pe",(function(){return s.Gd})),a.d(t,"jf",(function(){return s.Od})),a.d(t,"if",(function(){return s.Nd})),a.d(t,"Kb",(function(){return s.ub})),a.d(t,"Jb",(function(){return s.tb})),a.d(t,"Id",(function(){return s.Uc})),a.d(t,"Mb",(function(){return s.wb})),a.d(t,"Lb",(function(){return s.vb})),a.d(t,"Jd",(function(){return s.Vc})),a.d(t,"mc",(function(){return s.Wb})),a.d(t,"lc",(function(){return s.Vb})),a.d(t,"ae",(function(){return s.id})),a.d(t,"B",(function(){return s.v})),a.d(t,"xe",(function(){return s.xd})),a.d(t,"z",(function(){return s.t})),a.d(t,"Ob",(function(){return s.yb})),a.d(t,"Nb",(function(){return s.xb})),a.d(t,"Kd",(function(){return s.Wc})),a.d(t,"Qb",(function(){return s.Ab})),a.d(t,"Pb",(function(){return s.zb})),a.d(t,"Ld",(function(){return s.Xc})),a.d(t,"Ub",(function(){return s.Eb})),a.d(t,"Tb",(function(){return s.Db})),a.d(t,"Nd",(function(){return s.Zc})),a.d(t,"Wb",(function(){return s.Gb})),a.d(t,"Vb",(function(){return s.Fb})),a.d(t,"Od",(function(){return s.ad})),a.d(t,"cc",(function(){return s.Mb})),a.d(t,"bc",(function(){return s.Lb})),a.d(t,"Sd",(function(){return s.dd})),a.d(t,"oc",(function(){return s.Yb})),a.d(t,"nc",(function(){return s.Xb})),a.d(t,"be",(function(){return s.jd})),a.d(t,"gc",(function(){return s.Qb})),a.d(t,"fc",(function(){return s.Pb})),a.d(t,"Xd",(function(){return s.fd})),a.d(t,"qc",(function(){return s.ac})),a.d(t,"pc",(function(){return s.Zb})),a.d(t,"ce",(function(){return s.kd})),a.d(t,"sc",(function(){return s.cc})),a.d(t,"rc",(function(){return s.bc})),a.d(t,"de",(function(){return s.ld})),a.d(t,"yc",(function(){return s.ic})),a.d(t,"xc",(function(){return s.hc})),a.d(t,"ge",(function(){return s.od})),a.d(t,"he",(function(){return s.pd})),a.d(t,"Ac",(function(){return s.kc})),a.d(t,"zc",(function(){return s.jc})),a.d(t,"e",(function(){return s.e})),a.d(t,"j",(function(){return s.j})),a.d(t,"t",(function(){return s.n})),a.d(t,"y",(function(){return s.s})),a.d(t,"D",(function(){return s.x})),a.d(t,"Q",(function(){return s.B})),a.d(t,"nd",(function(){return s.Dc})),a.d(t,"Oc",(function(){return s.uc})),a.d(t,"v",(function(){return s.p})),a.d(t,"w",(function(){return s.q})),a.d(t,"Fe",(function(){return s.Dd})),a.d(t,"Ge",(function(){return s.Ed})),a.d(t,"kf",(function(){return s.Pd})),a.d(t,"Te",(function(){return s.Kd})),a.d(t,"Se",(function(){return s.Jd})),a.d(t,"qf",(function(){return s.Rd})),a.d(t,"hd",(function(){return s.xc})),a.d(t,"x",(function(){return s.r})),a.d(t,"Ye",(function(){return s.Md})),a.d(t,"le",(function(){return s.rd})),a.d(t,"Ve",(function(){return s.Ld})),a.d(t,"te",(function(){return s.td})),a.d(t,"E",(function(){return s.y})),a.d(t,"Re",(function(){return s.Id})),a.d(t,"rf",(function(){return s.Sd})),a.d(t,"Jc",(function(){return r.cidrFunction})),a.d(t,"Kc",(function(){return r.cidrToAst})),a.d(t,"Pc",(function(){return r.dateRangeFunction})),a.d(t,"Qc",(function(){return r.dateRangeToAst})),a.d(t,"Uc",(function(){return r.extendedBoundsFunction})),a.d(t,"Vc",(function(){return r.extendedBoundsToAst})),a.d(t,"bd",(function(){return r.geoBoundingBoxFunction})),a.d(t,"cd",(function(){return r.geoBoundingBoxToAst})),a.d(t,"dd",(function(){return r.geoPointFunction})),a.d(t,"ed",(function(){return r.geoPointToAst})),a.d(t,"oe",(function(){return r.ipPrefixFunction})),a.d(t,"pe",(function(){return r.ipPrefixToAst})),a.d(t,"qe",(function(){return r.ipRangeFunction})),a.d(t,"re",(function(){return r.ipRangeToAst})),a.d(t,"He",(function(){return r.kibana})),a.d(t,"Ke",(function(){return r.kqlFunction})),a.d(t,"Le",(function(){return r.luceneFunction})),a.d(t,"Ne",(function(){return r.numericalRangeFunction})),a.d(t,"Oe",(function(){return r.numericalRangeToAst})),a.d(t,"Ze",(function(){return r.queryFilterFunction})),a.d(t,"af",(function(){return r.queryFilterToAst})),a.d(t,"bf",(function(){return r.queryToAst})),a.d(t,"Dc",(function(){return r.aggregateQueryToAst})),a.d(t,"pf",(function(){return r.timerangeToAst})),a.d(t,"wd",(function(){return r.getEsaggsMeta})),a.d(t,"ke",(function(){return r.handleEsaggsRequest})),a.d(t,"ad",(function(){return r.functionWrapper})),a.d(t,"S",(function(){return r.adaptToExpressionValueFilter})),a.d(t,"ef",(function(){return r.rangeFunction})),a.d(t,"Xc",(function(){return r.fieldFunction})),a.d(t,"We",(function(){return r.phraseFilterFunction})),a.d(t,"Tc",(function(){return r.existsFilterFunction})),a.d(t,"df",(function(){return r.rangeFilterFunction})),a.d(t,"ff",(function(){return r.removeFilterFunction})),a.d(t,"hf",(function(){return r.selectFilterFunction})),a.d(t,"Ie",(function(){return r.kibanaFilterFunction})),a.d(t,"Yc",(function(){return r.filtersToAst})),a.d(t,"Je",(function(){return r.kibanaTimerangeFunction})),a.d(t,"Sc",(function(){return r.esRawResponse})),a.d(t,"Rc",(function(){return r.eqlRawResponse})),a.d(t,"xd",(function(){return r.getEsdslFn})),a.d(t,"vd",(function(){return r.getEqlFn})),a.d(t,"yd",(function(){return r.getEsqlFn})),a.d(t,"Nc",(function(){return O})),a.d(t,"me",(function(){return w})),a.d(t,"Wc",(function(){return F})),a.d(t,"Ue",(function(){return k})),a.d(t,"Td",(function(){return M})),a.d(t,"Vd",(function(){return _})),a.d(t,"Wd",(function(){return T})),a.d(t,"Pd",(function(){return S})),a.d(t,"F",(function(){return request_error_RequestFailure})),a.d(t,"gf",(function(){return A})),a.d(t,"M",(function(){return search_source_SearchSource})),a.d(t,"N",(function(){return search_source_service_SearchSourceService})),a.d(t,"P",(function(){return N})),a.d(t,"Be",(function(){return j})),a.d(t,"cf",(function(){return m})),a.d(t,"mf",(function(){return C.c})),a.d(t,"Zc",(function(){return C.a})),a.d(t,"lf",(function(){return C.b})),a.d(t,"nf",(function(){return C.d})),a.d(t,"se",(function(){return P.b})),a.d(t,"Ae",(function(){return P.c})),a.d(t,"ie",(function(){return P.a})),a.d(t,"L",(function(){return L.a})),a.d(t,"O",(function(){return L.b})),a.d(t,"I",(function(){return D})),a.d(t,"H",(function(){return B})),a.d(t,"Xe",(function(){return q})),a.d(t,"s",(function(){return G})),a.d(t,"o",(function(){return U})),a.d(t,"n",(function(){return z})),a.d(t,"K",(function(){return $})),a.d(t,"q",(function(){return V})),a.d(t,"p",(function(){return K})),a.d(t,"r",(function(){return H}));var s=a(27),r=a(14),n=a(13),i=a(4),o=a(1),l=a(2),u=a.n(l),c=a(77),d=a(5),g=a(20),h=a(64),p=a(8);function f(e){if(["number"].includes(e))return"number";if(["string","boolean"].includes(e))return"string";throw new Error(`Unsupported script sort type: ${e}`)}async function m({dataView:e,sort:t,request:a}){let s=e.timeFieldName?[e.timeFieldName]:[];if(t){const e=Array.isArray(t)?t:[t];s.push(...e.flatMap((e=>Object.keys(e))))}for(const e of a.query)if(e.query&&"kuery"===e.language){const t=Object(i.fromKueryExpression)(e.query),a=Object(i.getKqlFieldNames)(t);s=s.concat(a)}const r=a.filters;if(r){const e=Array.isArray(r)?r:[r];for(const t of e){var n;null!=t&&null!==(n=t.meta)&&void 0!==n&&n.key&&!0!==t.meta.disabled&&s.push(t.meta.key)}}const o=e.getSourceFiltering()&&e.getSourceFiltering().excludes.length?["*"]:s;return o.length?(await e.getFields({fieldName:o})).getFieldMapSorted():{}}var b=a(3),y=a(19);const v=Date.now();function _(e){return{preference:S(e)}}function S(e){const t=e(y.f.COURIER_SET_REQUEST_PREFERENCE);return"sessionId"===t?v:"custom"===t?e(y.f.COURIER_CUSTOM_REQUEST_PREFERENCE):void 0}function T(e,t){var a;const{getConfig:s}=t,r=_(s),{track_total_hits:n,...i}=e.body;return{index:e.index.title||e.index,body:i,track_total_hits:n,...(null===(a=e.index)||void 0===a?void 0:a.allowHidden)&&{expand_wildcards:"all"},...r}}class request_error_RequestFailure extends g.KbnError{constructor(e=null,t){super(`Request to Elasticsearch failed: ${JSON.stringify((null==t?void 0:t.rawResponse)||(null==e?void 0:e.message))}`),u()(this,"resp",void 0),this.resp=t}}var E=a(0);function M(e,t){var a;const s=(null==t?void 0:t.history)&&t.history[t.history.length-1],r={};if(e&&e.took&&(r.queryTime={label:E.i18n.translate("data.search.searchSource.queryTimeLabel",{defaultMessage:"Query time"}),value:E.i18n.translate("data.search.searchSource.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:E.i18n.translate("data.search.searchSource.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),e&&void 0!==(null===(a=e.hits)||void 0===a?void 0:a.total)){let t;if("number"==typeof e.hits.total)t=`${e.hits.total}`;else{const a=e.hits.total;t="eq"===a.relation?`${a.value}`:`> ${a.value}`}r.hitsTotal={label:E.i18n.translate("data.search.searchSource.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:t,description:E.i18n.translate("data.search.searchSource.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})}}return e&&e.hits&&(r.hits={label:E.i18n.translate("data.search.searchSource.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:E.i18n.translate("data.search.searchSource.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),s&&(0===s.ms||s.ms)&&(r.requestTime={label:E.i18n.translate("data.search.searchSource.requestTimeLabel",{defaultMessage:"Request time"}),value:E.i18n.translate("data.search.searchSource.requestTimeValue",{defaultMessage:"{requestTime}ms",values:{requestTime:s.ms}}),description:E.i18n.translate("data.search.searchSource.requestTimeDescription",{defaultMessage:"The time of the request from the browser to Elasticsearch and back. Does not include the time the requested waited in the queue."})}),r}const F=e=>{let t={...e};const a=[];if(t.index)if("string"==typeof t.index){const e=t.index,s="kibanaSavedObjectMeta.searchSourceJSON.index";a.push({name:s,type:b.DATA_VIEW_SAVED_OBJECT_TYPE,id:e}),t={...t,indexRefName:s,index:void 0}}else{const{state:e,references:s}=n.DataViewPersistableStateService.extract(t.index);t.index=e,a.push(...s)}return t.filter&&(t={...t,filter:t.filter.map(((e,t)=>{if(!e.meta||!e.meta.index)return e;const s=`kibanaSavedObjectMeta.searchSourceJSON.filter[${t}].meta.index`;return a.push({name:s,type:b.DATA_VIEW_SAVED_OBJECT_TYPE,id:e.meta.index}),{...e,meta:{...e.meta,indexRefName:s,index:void 0}}}))}),[t,a]},A=["dateFormat:tz",b.UI_SETTINGS.COURIER_CUSTOM_REQUEST_PREFERENCE,b.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX,b.UI_SETTINGS.COURIER_MAX_CONCURRENT_SHARD_REQUESTS,b.UI_SETTINGS.COURIER_SET_REQUEST_PREFERENCE,b.UI_SETTINGS.DOC_HIGHLIGHT,b.UI_SETTINGS.META_FIELDS,b.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,b.UI_SETTINGS.QUERY_STRING_OPTIONS,b.UI_SETTINGS.SEARCH_INCLUDE_FROZEN,b.UI_SETTINGS.SORT_OPTIONS],I=e=>Object(o.omitBy)(e,o.isNil);class search_source_SearchSource{constructor(e={},t){u()(this,"id",Object(o.uniqueId)("data_source")),u()(this,"shouldOverwriteDataViewType",!1),u()(this,"overwriteDataViewType",void 0),u()(this,"parent",void 0),u()(this,"requestStartHandlers",[]),u()(this,"inheritOptions",{}),u()(this,"history",[]),u()(this,"fields",void 0),u()(this,"dependencies",void 0),u()(this,"getFieldName",(e=>"string"==typeof e?e:null==e?void 0:e.field));const{parent:a,...s}=e;this.fields=s,this.dependencies=t,a&&this.setParent(new search_source_SearchSource(a,t))}setOverwriteDataViewType(e){!1===e?(this.shouldOverwriteDataViewType=!1,this.overwriteDataViewType=void 0):(this.shouldOverwriteDataViewType=!0,this.overwriteDataViewType=e)}setField(e,t){return null==t?this.removeField(e):(this.fields[e]=t,this)}removeField(e){return delete this.fields[e],this}setFields(e){return this.fields=e,this}getId(){return this.id}getFields(){return{...this.fields}}getField(e,t=!0){if(!t||void 0!==this.fields[e])return this.fields[e];const a=this.getParent();return a&&a.getField(e)}getActiveIndexFilter(){var e,t;const{filter:a,query:s}=this.getFields();let r=[];a&&(r=this.getFilters(a));const n=Array.isArray(s)?s.map((e=>e.query)):Object(i.isOfQueryType)(s)?null==s?void 0:s.query:void 0,l="string"==typeof n?this.parseActiveIndexPatternFromQueryString(n):null!==(e=null==n?void 0:n.reduce(((e,t)=>e.concat(this.parseActiveIndexPatternFromQueryString(t))),[]))&&void 0!==e?e:[],u=null===(t=r)||void 0===t?void 0:t.reduce(((e,t)=>{var a;const s=Object(i.isPhraseFilter)(t),r=Object(i.isPhrasesFilter)(t),n=s?null===(a=t.meta.params)||void 0===a?void 0:a.query:t.meta.params,l=Array.isArray(n)?n:[n];return(s||r)&&"_index"===t.meta.key&&!1===t.meta.disabled?!1===t.meta.negate?Object(o.concat)(e,l):Object(o.difference)(e,l):e}),l);return[...new Set([...u])]}getOwnField(e){return this.getField(e,!1)}create(){return new search_source_SearchSource({},this.dependencies)}createCopy(){const e=new search_source_SearchSource({},this.dependencies);return e.setFields({...this.fields}),e.setField("index",this.getField("index")),e.setParent(this.getParent()),e}createChild(e={}){const t=new search_source_SearchSource({},this.dependencies);return t.setParent(this,e),t}setParent(e,t={}){return this.parent=e,this.inheritOptions=t,this}getParent(){return this.parent}fetch$(e={}){const t=Object(d.defer)((()=>this.requestIsStarting(e))).pipe(Object(d.switchMap)((()=>{const t=this.flatten();return this.history=[t],t.index&&(e.indexPattern=t.index),this.fetchSearch$(t,e)})),Object(d.tap)((e=>{if(!e||e.error)throw new request_error_RequestFailure(null,e)})),Object(d.shareReplay)());return this.inspectSearch(t,e)}async fetch(e={}){return(await Object(d.lastValueFrom)(this.fetch$(e))).rawResponse}onRequestStart(e){this.requestStartHandlers.push(e)}getSearchRequestBody(){return this.flatten().body}destroy(){this.requestStartHandlers.length=0}inspectSearch(e,t){const{id:a,title:s,description:r,adapter:n}=t.inspector||{title:""},i=null==n?void 0:n.start(s,{id:a,description:r,searchSessionId:t.sessionId}),o=()=>{try{null==i||i.json(this.getSearchRequestBody())}catch(e){}},l=e.pipe(Object(d.first)(void 0,null),Object(d.tap)((()=>{null==i||i.stats(function(e){const t={},a=e.getField("index"),s=e.getActiveIndexFilter();return a&&(s.length>0&&(t.indexFilter={label:E.i18n.translate("data.search.searchSource.indexFilterLabel",{defaultMessage:"Index Pattern"}),value:s.join(", "),description:E.i18n.translate("data.search.searchSource.indexFilterDescription",{defaultMessage:"The active index pattern."})}),t.indexPattern={label:E.i18n.translate("data.search.searchSource.dataViewLabel",{defaultMessage:"Data view"}),value:a.title,description:E.i18n.translate("data.search.searchSource.dataViewDescription",{defaultMessage:"The data view that was queried."})},t.indexPatternId={label:E.i18n.translate("data.search.searchSource.dataViewIdLabel",{defaultMessage:"Data view ID"}),value:a.id,description:E.i18n.translate("data.search.searchSource.indexPatternIdDescription",{defaultMessage:"The ID in the {kibanaIndexPattern} index.",values:{kibanaIndexPattern:".kibana"}})}),t}(this)),o()})),Object(d.catchError)((()=>(o(),d.EMPTY))),Object(d.finalize)((()=>{l.unsubscribe()}))).subscribe(),u=e.pipe(Object(d.catchError)((e=>(null==i||i.error({json:"attributes"in e?e.attributes:{message:e.message}}),d.EMPTY))),Object(d.last)(void 0,null),Object(d.tap)((e=>{if(e){const t=e.rawResponse;null==i||i.stats(M(t,this)),null==i||i.ok({json:e})}})),Object(d.finalize)((()=>{u.unsubscribe()}))).subscribe();return e}hasPostFlightRequests(){const e=this.getField("aggs");return e instanceof b.AggConfigs&&e.aggs.some((e=>e.enabled&&"function"==typeof e.type.postFlightRequest&&(e.params.otherBucket||e.params.missingBucket)))}postFlightTransform(e){const t=this.getField("aggs");return t instanceof b.AggConfigs?t.postFlightTransform(e):e}async fetchOthers(e,t){const a=this.getField("aggs");if(a instanceof b.AggConfigs)for(const r of a.aggs){var s;r.enabled&&"function"==typeof r.type.postFlightRequest&&(e=await r.type.postFlightRequest(e,a,r,this,null===(s=t.inspector)||void 0===s?void 0:s.adapter,t.abortSignal,t.sessionId,t.disableWarningToasts))}return e}fetchSearch$(e,t){const{search:a,getConfig:s,onResponse:r}=this.dependencies;return a({params:T(e,{getConfig:s}),indexType:e.indexType},t).pipe(Object(d.switchMap)((e=>new d.Observable((a=>{if(Object(b.isRunningResponse)(e))a.next(this.postFlightTransform(e));else if(this.hasPostFlightRequests()){a.next({...this.postFlightTransform(e),isPartial:!0,isRunning:!0});const s=Object(d.from)(this.fetchOthers(e.rawResponse,t)).subscribe({next:t=>{a.next(this.postFlightTransform({...e,rawResponse:t}))},error:e=>{a.error(e),s.unsubscribe()},complete:()=>{a.complete(),s.unsubscribe()}})}else a.next(this.postFlightTransform(e)),a.complete()})))),Object(d.map)((a=>Object(b.isRunningResponse)(a)?a:r(e,a,t))))}requestIsStarting(e={}){const t=[...this.requestStartHandlers];if(this.inheritOptions.callParentStartHandlers){let e=this.getParent();for(;e;)t.push(...e.requestStartHandlers),e=e.getParent()}return Promise.all(t.map((t=>t(this,e))))}mergeProp(e,t,a){if(null==(t="function"==typeof t?t(this):t)||!a)return;const s=(t,a)=>{e[t]=a},r=(t,a)=>{null==e.body[t]&&(e.body[t]=a)},{getConfig:n}=this.dependencies;switch(a){case"filter":return s("filters",(e.filters||[]).concat(t));case"query":return s(a,(e[a]||[]).concat(t));case"fields":return r("fields",t);case"fieldsFromSource":return s(a,[...new Set((e[a]||[]).concat(t))]);case"index":case"type":case"highlightAll":return a&&null==e[a]&&s(a,t);case"searchAfter":return r("search_after",t);case"trackTotalHits":return r("track_total_hits",t);case"source":return r("_source",t);case"sort":return r(a,function(e,t,a={}){return(Array.isArray(e)?e:[e]).map((function(e){return function(e,t,a){const[[s,r]]=Object.entries(e),n="object"==typeof r?r:{order:r};if(t&&"string"!=typeof t&&!t.getRuntimeField(s)){const e=t.getScriptedField(s);if(e&&e.scripted&&"date"!==e.type)return{_script:{script:{source:e.script,lang:e.lang},type:f(e.type),...n}}}"string"==typeof a&&(a=JSON.parse(a));const{unmapped_type:i,...o}=a;return{[s]:{...n,..."_score"===s?o:a}}}(e,t,a)}))}(t,this.getField("index"),n(b.UI_SETTINGS.SORT_OPTIONS)));case"pit":return s(a,t);case"aggs":return t instanceof b.AggConfigs?r("aggs",t.toDsl()):r("aggs",t);default:return r(a,t)}}mergeProps(e=this,t={body:{}}){return Object.entries(this.fields).forEach((([e,a])=>{this.mergeProp(t,a,e)})),this.parent&&this.parent.mergeProps(e,t),t}getIndexType(e){return this.shouldOverwriteDataViewType?this.overwriteDataViewType:null==e?void 0:e.type}getFieldsWithoutSourceFilters(e,t){var a;if(!e)return t;const{fields:s}=e,r=e.getSourceFiltering();if(!r||0===(null===(a=r.excludes)||void 0===a?void 0:a.length)||0===t.length)return t;const n=r.excludes,i=t.find((e=>"*"===this.getFieldName(e))),o=Object(g.fieldWildcardFilter)(n,this.dependencies.getConfig(b.UI_SETTINGS.META_FIELDS)),l=e=>e&&o(e);return i?s.filter((e=>l(e.name))).map((e=>({field:e.name}))):t.filter((e=>l(this.getFieldName(e))))}getFieldFromDocValueFieldsOrIndexPattern(e,t,a){if("string"==typeof t)return t;const s=this.getFieldName(t),r=Object.assign({},e[s],t);if(!a)return r;const{fields:n}=a,i=n.getByType("date").find((e=>e.name===s));if(!i)return r;const{esTypes:o}=i;return null!=o&&o.includes("date_nanos")?r.format="strict_date_optional_time_nanos":null!=o&&o.includes("date")&&(r.format="strict_date_optional_time"),r}async loadDataViewFields(e){const t=this.mergeProps(this,{body:{}});return await m({dataView:e,request:t})}flatten(){var e;const{getConfig:t}=this.dependencies,a=null!==(e=t(b.UI_SETTINGS.META_FIELDS))&&void 0!==e?e:[],s=this.mergeProps();s.body=s.body||{};const{body:r,index:n}=s,{docvalueFields:i,scriptFields:l,runtimeFields:u}=n?n.getComputedFields():{docvalueFields:[],scriptFields:{},runtimeFields:{}},d=!!r.fields,g=n&&!r.hasOwnProperty("_source")?n.getSourceFiltering():r._source,p=this.getFieldFilter({bodySourceExcludes:null==g?void 0:g.excludes,metaFields:a}),f=p(s.fieldsFromSource||[]),m=p(i),y=!!f.length,v=d||y?p(r.fields||[]):m,_=this.getUniqueFieldNames({fields:v,fieldsFromSource:f}),S=(()=>{const e=this.dependencies.scriptedFieldsEnabled?{...r.script_fields,...l}:{};return d||y?this.filterScriptFields({uniqFieldNames:_,scriptFields:e}):e})(),T=this.getRemainingFields({uniqFieldNames:_,scriptFields:S,runtimeFields:u,_source:g});r._source=g,y&&!Object(o.isEqual)(T,f)&&Object(c.setWith)(r,"_source.includes",T,(e=>Object(o.isObject)(e)?{}:e));const E=this.getBuiltEsQuery({index:n,query:s.query,filters:s.filters,getConfig:t,sort:r.sort}),M={...s.body,pit:s.pit,query:E,highlight:s.highlightAll&&E?Object(h.getHighlightRequest)(t(b.UI_SETTINGS.DOC_HIGHLIGHT)):void 0,_source:!(d&&!y)&&r._source,stored_fields:d||y?[...new Set(T)]:["*"],runtime_mappings:u,script_fields:S,fields:this.getFieldsList({index:n,fields:v,docvalueFields:r.docvalue_fields,fieldsFromSource:f,filteredDocvalueFields:m,metaFields:a,fieldListProvided:d,sourceFieldsProvided:y})};return I({...s,body:I(M),indexType:this.getIndexType(n),highlightAll:s.highlightAll&&E?void 0:s.highlightAll})}getFieldFilter({bodySourceExcludes:e,metaFields:t}){const a=Object(g.fieldWildcardFilter)(e,t);return e=>e.filter((e=>a(this.getFieldName(e))))}getUniqueFieldNames({fields:e,fieldsFromSource:t}){const a=e.map((e=>this.getFieldName(e)));return[...new Set([...a,...t])]}filterScriptFields({uniqFieldNames:e,scriptFields:t}){return e.includes("*")?t:Object(o.pick)(t,Object.keys(t).filter((t=>e.includes(t))))}getBuiltEsQuery({index:e,query:t=[],filters:a=[],getConfig:s,sort:r}){const n=(null!=r?r:[]).some((e=>e.hasOwnProperty("_score"))),o={...Object(b.getEsQueryConfig)({get:s}),filtersInMustClause:n};return Object(i.buildEsQuery)(e,t,a,o)}getRemainingFields({uniqFieldNames:e,scriptFields:t,runtimeFields:a,_source:s}){return Object(o.difference)(e,[...Object.keys(t),...Object.keys(a)]).filter((e=>!(!e||s&&s.excludes&&s.excludes.includes(e))))}getFieldsList({index:e,fields:t,docvalueFields:a,fieldsFromSource:s,filteredDocvalueFields:r,metaFields:n,fieldListProvided:i,sourceFieldsProvided:o}){return i||o?o?[...t,...r.filter((e=>{const t=this.getFieldName(e);return s.includes(t)&&!(a||[]).map((e=>this.getFieldName(e))).includes(t)}))]:this.getUniqueFields({index:e,fields:t,metaFields:n,filteredDocvalueFields:r}):t}getUniqueFields({index:e,fields:t,metaFields:a,filteredDocvalueFields:s}){const r=this.getFieldsWithoutSourceFilters(e,t),n=Object(o.keyBy)(s,"field"),i=new Set(Object.keys(n)),l=new Set,u=[];for(const t of r.concat(s)){const s=this.getFieldName(t);a.includes(s)||l.has(s)||(l.add(s),i.has(s)?u.push("string"==typeof t?n[t]:this.getFieldFromDocValueFieldsOrIndexPattern(n,t,e)):u.push(t))}return u}getSerializedFields(e=!1){const{filter:t,aggs:a,parent:s,size:r,sort:n,index:i,...o}=this.getFields();let l={...o};if(i&&(l.index=i.isPersisted()?i.id:i.toMinimalSpec()),n&&(l.sort=Array.isArray(n)?n:[n]),t){const e=this.getFilters(t);l={...l,filter:e}}if(a){let e=a;"function"==typeof e&&(e=a()),e instanceof b.AggConfigs?l.aggs=e.getAll().map((e=>e.serialize())):l.aggs=e}return e&&this.getParent()&&(l.parent=this.getParent().getSerializedFields(e)),l}serialize(){const[e,t]=F(this.getSerializedFields());return{searchSourceJSON:JSON.stringify(e),references:t}}getFilters(e){return e?Array.isArray(e)?e:Object(o.isFunction)(e)?this.getFilters(e()):[e]:[]}toExpressionAst({asDatatable:e=!0}={}){const t=this.mergeProps(),{body:a,index:s,query:n}=t,i="function"==typeof t.filters?t.filters():t.filters,o=Object(p.buildExpression)([Object(p.buildExpressionFunction)("kibana_context",{q:null==n?void 0:n.map(r.queryToAst),filters:i&&Object(r.filtersToAst)(i)})]).toAst();if(!e)return o;const l=this.getField("aggs"),u="function"==typeof l?l():l,c=u instanceof b.AggConfigs?u:s&&u&&this.dependencies.aggs.createAggConfigs(s,u);return c?o.chain.push(...c.toExpressionAst().chain):o.chain.push(Object(p.buildExpressionFunction)("esdsl",{size:null==a?void 0:a.size,dsl:JSON.stringify({}),index:null==s?void 0:s.id}).toAst()),o}parseActiveIndexPatternFromQueryString(e){let t;const a=new Set,s=/\s?(_index)\s?:\s?[\'\"]?(\w+\-?\*?)[\'\"]?\s?(\w+)?/g;for(;null!==(t=s.exec(e));)t.index===s.lastIndex&&s.lastIndex++,t.forEach(((e,t)=>{2===t&&a.add(e)}));return[...a]}}const O=(e,t)=>{let a;const s=async(r={},i=!1)=>{const{index:o,parent:l,...u}=r,c={...u};if(r.index)if(i){a="string"==typeof r.index?await e.getDataViewLazy(r.index):await e.createDataViewLazy(r.index);const[s,i,o]=await Promise.all([a.toSpec(),t.dataViews.getShortDotsEnable(),t.dataViews.getMetaFields()]),l=new n.DataView({spec:s,fieldFormats:{},shortDotsEnable:i,metaFields:o});c.index=l}else c.index="string"==typeof r.index?await e.get(r.index):await e.create(r.index);return r.parent&&(c.parent=await s(r.parent)),c};return async(e={},r)=>{const n=await s(e,!!r),l=new search_source_SearchSource(n,t),u=l.getOwnField("query");if(void 0!==u&&l.setField("query",function(e){return Object(o.has)(e,"language")||"object"==typeof e&&Object(i.isOfAggregateQueryType)(e)?e:{query:e,language:"lucene"}}(u)),r&&a){var c;const e=await l.loadDataViewFields(a);null===(c=n.index)||void 0===c||c.fields.replaceAll(Object.values(e).map((e=>e.toSpec())))}return l}},w=(e,t)=>{const a={...e};if(e.indexRefName){const s=t.find((t=>t.name===e.indexRefName));if(!s)throw new Error(`Could not find reference for ${e.indexRefName}`);a.index=s.id,delete a.indexRefName}return e.index&&"string"!=typeof e.index&&(e.index=n.DataViewPersistableStateService.inject(e.index,t)),a.filter&&Array.isArray(a.filter)&&a.filter.forEach((e=>{if(!e.meta||!e.meta.indexRefName)return;const a=t.find((t=>t.name===e.meta.indexRefName));if(!a)throw new Error(`Could not find reference for ${e.meta.indexRefName}`);e.meta.index=a.id,delete e.meta.indexRefName})),a},k=e=>{let t;try{t=JSON.parse(e)}catch(t){throw new g.InvalidJSONProperty(`Invalid JSON in search source. ${t.message} JSON: ${e}`)}if(!t||"object"!=typeof t)throw new g.InvalidJSONProperty("Invalid JSON in search source.");return t};var R=a(29);const x=()=>{const e=Object(o.mapValues)(Object(R.b)(),(e=>t=>({...t,filter:e(t.filter)}))),t=Object(o.mapValues)(n.DataViewPersistableStateService.getAllMigrations(),(e=>t=>({...t,index:e(t.index)})));return Object(g.mergeMigrationFunctionMaps)(Object(g.mergeMigrationFunctionMaps)({},e),t)};class search_source_service_SearchSourceService{setup(){return{getAllMigrations:x}}start(e,t){return{create:O(e,t),createLazy:(a={})=>O(e,t)(a,!0),createEmpty:()=>new search_source_SearchSource({},t),extract:e=>{const[t,a]=F(e);return{state:t,references:a}},inject:w,getAllMigrations:x,telemetry:()=>({})}}stop(){}}let N=function(e){return e.asc="asc",e.desc="desc",e}({});function j(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var C=a(63),P=a(55),L=a(74);const D="search-session",B="searchSessionsMgmtUiTable",q=(e,t,{pollInterval:a,abortSignal:s}={})=>Object(d.defer)((()=>{const r=Date.now();if(null!=s&&s.aborted)throw new g.AbortError;t&&(null==s||s.addEventListener("abort",(()=>null==t?void 0:t().catch((e=>{console.error(e)}))),{once:!0}));const n=(s?Object(d.fromEvent)(s,"abort"):d.EMPTY).pipe(Object(d.map)((()=>{throw new g.AbortError})));return Object(d.from)(e()).pipe(Object(d.expand)((()=>{const t=Date.now()-r;return Object(d.timer)((e=>{if("number"==typeof a)return a;switch(!0){case e<1500:return 300;case e<5e3:return 1e3;case e<2e4:return 2500;default:return 5e3}})(t)).pipe(Object(d.switchMap)(e))})),Object(d.tap)((e=>{if(Object(b.isAbortResponse)(e))throw new g.AbortError})),Object(d.takeWhile)(b.isRunningResponse,!0),Object(d.takeUntil)(n))})),G="es",U="eql",z="ese",$="sql",V="esql",K="esql_async",H="es_ql"},function(e,t,a){"use strict";a.d(t,"a",(function(){return BucketAggType})),a.d(t,"b",(function(){return o}));var s=a(2),r=a.n(s),n=a(39);const i="buckets";class BucketAggType extends n.a{getShiftedKey(e,t,a){return t}getTimeShiftInterval(e){}orderBuckets(e,t,a){return Number(t.key)-Number(a.key)}constructor(e){super(e),r()(this,"getKey",void 0),r()(this,"type",i),this.getKey=e.getKey||((e,t)=>t||e.key),e.getShiftedKey&&(this.getShiftedKey=e.getShiftedKey),e.orderBuckets&&(this.orderBuckets=e.orderBuckets),e.getTimeShiftInterval&&(this.getTimeShiftInterval=e.getTimeShiftInterval),e.splitForTimeShift&&(this.splitForTimeShift=e.splitForTimeShift)}}function o(e){return e&&e.type===i}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));let s=function(e){return e.FILTER="filter",e.FILTERS="filters",e.HISTOGRAM="histogram",e.IP_PREFIX="ip_prefix",e.IP_RANGE="ip_range",e.DATE_RANGE="date_range",e.RANGE="range",e.TERMS="terms",e.MULTI_TERMS="multi_terms",e.RARE_TERMS="rare_terms",e.SIGNIFICANT_TERMS="significant_terms",e.SIGNIFICANT_TEXT="significant_text",e.GEOTILE_GRID="geotile_grid",e.DATE_HISTOGRAM="date_histogram",e.SAMPLER="sampler",e.DIVERSIFIED_SAMPLER="diversified_sampler",e.TIME_SERIES="time_series",e}({})},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/dataViews/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t,a){"use strict";a.r(t),a.d(t,"cidrFunction",(function(){return r})),a.d(t,"cidrToAst",(function(){return i})),a.d(t,"dateRangeFunction",(function(){return o})),a.d(t,"dateRangeToAst",(function(){return l})),a.d(t,"extendedBoundsFunction",(function(){return c})),a.d(t,"extendedBoundsToAst",(function(){return d})),a.d(t,"geoBoundingBoxFunction",(function(){return g})),a.d(t,"geoBoundingBoxToAst",(function(){return f})),a.d(t,"geoPointFunction",(function(){return m})),a.d(t,"geoPointToAst",(function(){return h})),a.d(t,"ipPrefixFunction",(function(){return b})),a.d(t,"ipPrefixToAst",(function(){return y})),a.d(t,"ipRangeFunction",(function(){return v})),a.d(t,"ipRangeToAst",(function(){return _})),a.d(t,"kibana",(function(){return T})),a.d(t,"kqlFunction",(function(){return E})),a.d(t,"luceneFunction",(function(){return M})),a.d(t,"numericalRangeFunction",(function(){return F})),a.d(t,"numericalRangeToAst",(function(){return A})),a.d(t,"queryFilterFunction",(function(){return I})),a.d(t,"queryFilterToAst",(function(){return w})),a.d(t,"queryToAst",(function(){return O})),a.d(t,"aggregateQueryToAst",(function(){return k})),a.d(t,"timerangeToAst",(function(){return R})),a.d(t,"getEsaggsMeta",(function(){return L})),a.d(t,"handleEsaggsRequest",(function(){return P})),a.d(t,"functionWrapper",(function(){return D})),a.d(t,"adaptToExpressionValueFilter",(function(){return G})),a.d(t,"rangeFunction",(function(){return U})),a.d(t,"fieldFunction",(function(){return z})),a.d(t,"phraseFilterFunction",(function(){return V})),a.d(t,"existsFilterFunction",(function(){return K})),a.d(t,"rangeFilterFunction",(function(){return H})),a.d(t,"removeFilterFunction",(function(){return Y})),a.d(t,"selectFilterFunction",(function(){return Q})),a.d(t,"kibanaFilterFunction",(function(){return W})),a.d(t,"filtersToAst",(function(){return J})),a.d(t,"kibanaTimerangeFunction",(function(){return X})),a.d(t,"esRawResponse",(function(){return te})),a.d(t,"eqlRawResponse",(function(){return se})),a.d(t,"getEsdslFn",(function(){return re.a})),a.d(t,"getEqlFn",(function(){return ne.a})),a.d(t,"getEsqlFn",(function(){return ie.a}));var s=a(0);const r={name:"cidr",type:"cidr",inputTypes:["null"],help:s.i18n.translate("data.search.functions.cidr.help",{defaultMessage:"Create a CIDR-based range"}),args:{mask:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.cidr.cidr.help",{defaultMessage:"Specify the CIDR block"})}},fn:(e,{mask:t})=>({mask:t,type:"cidr"})};var n=a(8);const i=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("cidr",e)]).toAst(),o={name:"dateRange",type:"date_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.dateRange.help",{defaultMessage:"Create a date range"}),args:{from:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.from.help",{defaultMessage:"Specify the starting date"})},to:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.to.help",{defaultMessage:"Specify the ending date"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"date_range"})},l=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("dateRange",e)]).toAst();var u=a(1);const c={name:"extendedBounds",type:"extended_bounds",inputTypes:["null"],help:s.i18n.translate("data.search.functions.extendedBounds.help",{defaultMessage:"Create extended bounds"}),args:{min:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.min.help",{defaultMessage:"Specify the lower boundary value"})},max:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.max.help",{defaultMessage:"Specify the upper boundary value"})}},fn:(e,{min:t,max:a})=>({type:"extended_bounds",...Object(u.omitBy)({min:t,max:a},u.isNil)})},d=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("extendedBounds",e)]).toAst(),g={name:"geoBoundingBox",type:"geo_bounding_box",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoBoundingBox.help",{defaultMessage:"Create a geo bounding box"}),args:{top:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top.help",{defaultMessage:"Specify the top coordinate"})},left:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.left.help",{defaultMessage:"Specify the left coordinate"})},bottom:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom.help",{defaultMessage:"Specify the bottom coordinate"})},right:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.right.help",{defaultMessage:"Specify the right coordinate"})},wkt:{types:["string"],help:s.i18n.translate("data.search.functions.geoBoundingBox.wkt.help",{defaultMessage:"Specify the Well-Known Text (WKT)"})},topLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_left.help",{defaultMessage:"Specify the top left corner"})},bottomRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_right.help",{defaultMessage:"Specify the bottom right corner"})},topRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_right.help",{defaultMessage:"Specify the top right corner"})},bottomLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_left.help",{defaultMessage:"Specify the bottom left corner"})}},fn(e,t){if(null!=(null==(a=t)?void 0:a.wkt))return{...Object(u.pick)(t,"wkt"),type:"geo_bounding_box"};var a;if(function(e){return null!=(null==e?void 0:e.top)&&null!=(null==e?void 0:e.left)&&null!=(null==e?void 0:e.bottom)&&null!=(null==e?void 0:e.right)}(t))return{...Object(u.pick)(t,["top","left","bottom","right"]),type:"geo_bounding_box"};if(function(e){return null!=(null==e?void 0:e.topLeft)&&null!=(null==e?void 0:e.bottomRight)||null!=(null==e?void 0:e.topRight)&&null!=(null==e?void 0:e.bottomLeft)}(t))return{...Object(u.chain)(t).pick(["topLeft","bottomRight","topRight","bottomLeft"]).omitBy(u.isNil).mapKeys(((e,t)=>Object(u.snakeCase)(t))).mapValues((({value:e})=>e)).value(),type:"geo_bounding_box"};throw new Error(s.i18n.translate("data.search.functions.geoBoundingBox.arguments.error",{defaultMessage:"At least one of the following groups of parameters must be provided: {parameters}.",values:{parameters:[["wkt"],["top","left","bottom","right"],["topLeft","bottomRight"],["topRight","bottomLeft"]].map((e=>e.join(", "))).join("; ")}}))}},h=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("geoPoint","object"!=typeof e||Array.isArray(e)?{point:Array.isArray(e)?e:[e]}:e)]).toAst(),p=["top_left","bottom_right","top_right","bottom_left"],f=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("geoBoundingBox",{...Object(u.omit)(e,p),...Object(u.chain)(e).pick(p).omitBy(u.isNil).mapKeys(((e,t)=>Object(u.camelCase)(t))).mapValues((e=>h(e))).value()})]).toAst(),m={name:"geoPoint",type:"geo_point",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoPoint.help",{defaultMessage:"Create a geo point"}),args:{lat:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lat.help",{defaultMessage:"Specify the latitude"})},lon:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lon.help",{defaultMessage:"Specify the longitude"})},point:{aliases:["_"],types:["number","string"],multi:!0,help:s.i18n.translate("data.search.functions.geoPoint.point.help",{defaultMessage:"Specify the point as a string with comma-separated coordinates or as two numeric values"})}},fn(e,{lat:t,lon:a,point:r}){if(null!=t&&null!=a)return{type:"geo_point",value:{lat:t,lon:a}};if(!r)throw new Error(s.i18n.translate("data.search.functions.geoPoint.arguments.error",{defaultMessage:'Either "lat" and "lon" or "point" parameters should be specified.'}));const[n]=r;if("string"==typeof n)return{value:n,type:"geo_point"};if(2!==r.length)throw new Error(s.i18n.translate("data.search.functions.geoPoint.point.error",{defaultMessage:"The point parameter should either be a string or two numeric values."}));return{type:"geo_point",value:[...r]}}},b={name:"ipPrefix",type:"ip_prefix",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipPrefix.help",{defaultMessage:"Create an IP prefix"}),args:{prefixLength:{types:["number"],help:s.i18n.translate("data.search.functions.ipPrefix.prefixLength.help",{defaultMessage:"Specify the length of the network prefix"})},isIpv6:{types:["boolean"],help:s.i18n.translate("data.search.functions.ipPrefix.isIpv6.help",{defaultMessage:"Specify whether the prefix applies to IPv6 addresses"})}},fn:(e,{prefixLength:t,isIpv6:a})=>({type:"ip_prefix",prefixLength:t,isIpv6:a})},y=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("ipPrefix",e)]).toAst(),v={name:"ipRange",type:"ip_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipRange.help",{defaultMessage:"Create an IP range"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.from.help",{defaultMessage:"Specify the starting address"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.to.help",{defaultMessage:"Specify the ending address"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"ip_range"})},_=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("ipRange",e)]).toAst(),S=e=>e?Array.isArray(e)?e:[e]:[],T={name:"kibana",type:"kibana_context",inputTypes:["kibana_context","null"],help:s.i18n.translate("data.search.functions.kibana.help",{defaultMessage:"Gets kibana global context"}),args:{},fn(e,t,{getSearchContext:a}){var s;return{...e,type:"kibana_context",now:null!==(s=a().now)&&void 0!==s?s:Date.now(),query:[...S(a().query),...S((e||{}).query)],filters:[...a().filters||[],...(e||{}).filters||[]],timeRange:a().timeRange||(e?e.timeRange:void 0)}}},E={name:"kql",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kql.help",{defaultMessage:"Create kibana kql query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.kql.q.help",{defaultMessage:"Specify Kibana KQL free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"kuery",query:t.q})},M={name:"lucene",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.lucene.help",{defaultMessage:"Create kibana lucene query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.lucene.q.help",{defaultMessage:"Specify Lucene free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"lucene",query:JSON.parse(t.q)})},F={name:"numericalRange",type:"numerical_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.numericalRange.help",{defaultMessage:"Create a numerical range"}),args:{from:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.from.help",{defaultMessage:"Specify the starting value"})},to:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.to.help",{defaultMessage:"Specify the ending value"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.numericalRange.label.help",{defaultMessage:"Specify the range label"})}},fn:(e,{from:t,to:a,label:s})=>({type:"numerical_range",...Object(u.omitBy)({from:t,to:a,label:s},u.isNil)})},A=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("numericalRange",e)]).toAst(),I={name:"queryFilter",type:"kibana_query_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.queryFilter.help",{defaultMessage:"Create a query filter"}),args:{input:{types:["kibana_query"],aliases:["_"],required:!0,help:s.i18n.translate("data.search.functions.queryFilter.input.help",{defaultMessage:"Specify the query filter"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.queryFilter.label.help",{defaultMessage:"Specify the filter label"})}},fn:(e,{input:t,label:a})=>({type:"kibana_query_filter",input:Object(u.omit)(t,"type"),...Object(u.omitBy)({label:a},u.isNil)})},O=e=>"kuery"===e.language?Object(n.buildExpression)([Object(n.buildExpressionFunction)("kql",{q:e.query})]).toAst():Object(n.buildExpression)([Object(n.buildExpressionFunction)("lucene",{q:JSON.stringify(e.query)})]).toAst(),w=({input:e,label:t})=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("queryFilter",{label:t,input:O(e)})]).toAst(),k=({query:e,timeField:t,titleForInspector:a,descriptionForInspector:r})=>Object(n.buildExpressionFunction)("esql",{query:e.esql,timeField:t,locale:s.i18n.getLocale(),titleForInspector:a,descriptionForInspector:r}).toAst(),R=e=>Object(n.buildExpression)([Object(n.buildExpressionFunction)("timerange",e)]).toAst();var x=a(27),N=a(5),j=a(3),C=a(63);const P=({abortSignal:e,aggs:t,filters:a,indexPattern:r,inspectorAdapters:n,query:i,searchSessionId:o,searchSourceService:l,timeFields:u,timeRange:c,disableWarningToasts:d,getNow:g,executionContext:h,title:p,description:f})=>Object(N.defer)((async()=>{var e;const s=null==g?void 0:g(),n=await l.create();n.setField("index",r),n.setField("size",0);const o=n.createChild({callParentStartHandlers:!0}),d=o.createChild({callParentStartHandlers:!0}),h=null==r||null===(e=r.getTimeField)||void 0===e?void 0:e.call(r),p=h?[h.name]:[],f=null!=u&&u.length?u:p;return t.setTimeRange(c),t.setForceNow(s),t.setTimeFields(f),Object.defineProperty(d,"history",{get:()=>n.history,set:e=>n.history=e}),d.setField("aggs",t),d.onRequestStart(((e,a)=>t.onSearchRequestStart(e,a))),c&&f.length>0&&o.setField("filter",(()=>t.getSearchSourceTimeFilter(s))),d.setField("filter",a),d.setField("query",i),{allTimeFields:f,forceNow:s,requestSearchSource:d}})).pipe(Object(N.switchMap)((({allTimeFields:a,forceNow:r,requestSearchSource:i})=>i.fetch$({abortSignal:e,disableWarningToasts:d,sessionId:o,inspector:{adapter:n.requests,title:null!=p?p:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.title",{defaultMessage:"Data"}),description:null!=f?f:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},executionContext:h}).pipe(Object(N.map)((({rawResponse:e})=>{const s=c?Object(j.calculateBounds)(c,{forceNow:r}):null,n={metricsAtAllLevels:t.hierarchical,partialRows:t.partialRows,timeRange:s?{from:s.min,to:s.max,timeFields:a}:void 0};return Object(C.b)(t,e,n)})))))),L=()=>({name:"esaggs",type:"datatable",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.functions.esaggs.help",{defaultMessage:"Run AggConfig aggregation"}),args:{index:{types:["index_pattern"],required:!0,help:s.i18n.translate("data.search.functions.esaggs.index.help",{defaultMessage:"Data view retrieved with indexPatternLoad"})},aggs:{types:["agg_type"],multi:!0,default:`{${Object(n.buildExpressionFunction)(x.Q,{}).toString()}}`,help:s.i18n.translate("data.search.functions.esaggs.aggConfigs.help",{defaultMessage:"List of aggs configured with agg_type functions"})},metricsAtAllLevels:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.metricsAtAllLevels.help",{defaultMessage:"Whether to include columns with metrics for each bucket level"})},partialRows:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.partialRows.help",{defaultMessage:"Whether to return rows that only contain partial data"})},timeFields:{types:["string"],multi:!0,help:s.i18n.translate("data.search.functions.esaggs.timeFields.help",{defaultMessage:"Provide time fields to get the resolved time ranges for the query"})},probability:{types:["number"],default:1,help:s.i18n.translate("data.search.functions.esaggs.probability.help",{defaultMessage:"The probability that a document will be included in the aggregated data. Uses random sampler."})},samplerSeed:{types:["number"],help:s.i18n.translate("data.search.functions.esaggs.samplerSeed.help",{defaultMessage:"The seed to generate the random sampling of documents. Uses random sampler."})},ignoreGlobalFilters:{types:["boolean"],help:s.i18n.translate("data.search.functions.esaggs.ignoreGlobalFilters.help",{defaultMessage:"Whether to ignore or use global query and filters"})}}}),D=e=>{const t=Object(u.mapValues)(e.args,(e=>e.default));return(a,s={},r={})=>e.fn(a,{...t,...s},r)};function B(e){const{meta:t}=e,{group:a}=null!=t?t:{};return a}const q={range:function(e){var t;const{query:a}=e,{range:s}=null!=a?a:{},r=Object.keys(s)[0],{gte:n,lte:i}=null!==(t=s[r])&&void 0!==t?t:{};return{filterGroup:B(e),from:n,to:i,column:r,type:"filter",filterType:"time",and:[]}},term:function(e){var t;const{query:a}=e,{term:s}=null!=a?a:{},r=Object.keys(s)[0],{value:n}=null!==(t=s[r])&&void 0!==t?t:{};return{filterGroup:B(e),column:r,value:n,type:"filter",filterType:"exactly",and:[]}},luceneQueryString:function(e){const{query:t}=e,{query_string:a}=null!=t?t:{},{query:s}=a;return{filterGroup:B(e),query:s,type:"filter",filterType:"luceneQueryString",and:[]}}};function G(e){const{query:t={}}=e,a=Object.keys(t)[0],s=q[a];if(!s||"function"!=typeof s)throw new Error(`Unknown filter type: ${a}`);return s(e)}const U={name:"range",type:"kibana_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.range.help",{defaultMessage:"Create kibana range filter"}),args:{gt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gt.help",{defaultMessage:"Greater than"})},lt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lt.help",{defaultMessage:"Less than"})},gte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gte.help",{defaultMessage:"Greater or equal than"})},lte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lte.help",{defaultMessage:"Less or equal than"})}},fn(e,t){if(void 0===t.lt&&void 0===t.lte)throw new Error("lt or lte must be provided");if(void 0===t.gt&&void 0===t.gte)throw new Error("gt or gte must be provided");return{type:"kibana_range",...t}}},z={name:"field",type:"kibana_field",inputTypes:["null"],help:s.i18n.translate("data.search.functions.field.help",{defaultMessage:"Create a Kibana field."}),args:{name:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.name.help",{defaultMessage:"Name of the field"})},type:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.type.help",{defaultMessage:"Type of the field"})},script:{types:["string"],help:s.i18n.translate("data.search.functions.field.script.help",{defaultMessage:"A field script, in case the field is scripted."})}},fn:(e,t)=>({type:"kibana_field",spec:{name:t.name,type:t.type,scripted:!!t.script,script:t.script}})};var $=a(4);const V={name:"phraseFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.phraseFilter.help",{defaultMessage:"Create kibana phrase or phrases filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},phrase:{types:["string"],multi:!0,required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.phrase.help",{defaultMessage:"Specify the phrases"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.phraseFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>1===t.phrase.length?{type:"kibana_filter",...Object($.buildFilter)({},t.field.spec,$.FILTERS.PHRASE,t.negate||!1,!1,t.phrase[0],null)}:{type:"kibana_filter",...Object($.buildFilter)({},t.field.spec,$.FILTERS.PHRASES,t.negate||!1,!1,t.phrase,null)}},K={name:"existsFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.existsFilter.help",{defaultMessage:"Create kibana exists filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.existsFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.existsFilter.negate.help",{defaultMessage:"Should the filter be negated."})}},fn:(e,t)=>({type:"kibana_filter",...Object($.buildFilter)({},t.field.spec,$.FILTERS.EXISTS,t.negate||!1,!1,{},null)})},H={name:"rangeFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.rangeFilter.help",{defaultMessage:"Create kibana range filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},range:{types:["kibana_range"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.range.help",{defaultMessage:"Specify the range, use `range` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.rangeFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>({type:"kibana_filter",...Object($.buildFilter)({},t.field.spec,$.FILTERS.RANGE,t.negate||!1,!1,{from:t.range.gt||t.range.gte,to:t.range.lt||t.range.lte},null)})},Y={name:"removeFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.removeFilter.help",{defaultMessage:"Removes filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.removeFilter.group.help",{defaultMessage:"Removes only filters belonging to the provided group"})},from:{types:["string"],help:s.i18n.translate("data.search.functions.removeFilter.from.help",{defaultMessage:"Removes only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.removeFilter.ungrouped.help",{defaultMessage:"Should filters without group be removed"})}},fn(e,{group:t,from:a,ungrouped:s}){var r;return{...e,filters:(null===(r=e.filters)||void 0===r?void 0:r.filter((({meta:e})=>{const r=!t&&!s||t===e.group||s&&!e.group,n=!a||a===e.controlledBy;return!r||!n})))||[]}}},Q={name:"selectFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.selectFilter.help",{defaultMessage:"Selects filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.selectFilter.group.help",{defaultMessage:"Select only filters belonging to the provided group"}),multi:!0},from:{types:["string"],help:s.i18n.translate("data.search.functions.selectFilter.from.help",{defaultMessage:"Select only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.selectFilter.ungrouped.help",{defaultMessage:"Should filters without group be included"})}},fn(e,{group:t=[],ungrouped:a,from:s}){var r;return{...e,filters:(null===(r=e.filters)||void 0===r?void 0:r.filter((({meta:e})=>{const r=!t.length&&!a||e.group&&t.length&&t.includes(e.group)||a&&!e.group,n=!s||s===e.controlledBy;return r&&n})))||[]}}},W={name:"kibanaFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kibanaFilter.help",{defaultMessage:"Create kibana filter"}),args:{query:{types:["string"],aliases:["q","_"],required:!0,help:s.i18n.translate("data.search.functions.kibanaFilter.field.help",{defaultMessage:"Specify free form esdsl query"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.negate.help",{defaultMessage:"Should the filter be negated"})},disabled:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.disabled.help",{defaultMessage:"Should the filter be disabled"})}},fn:(e,t)=>({type:"kibana_filter",meta:{negate:t.negate||!1,alias:"",disabled:t.disabled||!1},query:JSON.parse(t.query)})},J=e=>(Array.isArray(e)?e:[e]).map((e=>{const t=e.meta.type===$.FILTERS.COMBINED?Object($.fromCombinedFilter)(e):e,{meta:a,$state:s,query:r,...i}=t;return Object(n.buildExpression)([Object(n.buildExpressionFunction)("kibanaFilter",{query:JSON.stringify(r||i),negate:a.negate,disabled:a.disabled})]).toAst()})),X={name:"timerange",type:"timerange",inputTypes:["null"],help:s.i18n.translate("data.search.functions.timerange.help",{defaultMessage:"Create kibana timerange"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.from.help",{defaultMessage:"Specify the start date"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.to.help",{defaultMessage:"Specify the end date"})},mode:{types:["string"],options:["absolute","relative"],help:s.i18n.translate("data.search.functions.timerange.mode.help",{defaultMessage:"Specify the mode (absolute or relative)"})}},fn:(e,t)=>({type:"timerange",from:t.from,to:t.to,mode:t.mode})};function Z(e,t=""){let a={};const s=[],r=t?t+".":"";return Object.keys(e).forEach((t=>{if(Array.isArray(e[t]))s.push(...e[t].map((e=>Z(e,r+t))).reduce(((e,t)=>(e.push(...t),e)),[]));else if("object"==typeof e[t]&&null!==e[t]){const n=Z(e[t],r+t);1===n.length?a={...a,...n[0]}:s.push(...n)}else a[r+t]=e[t]})),0===s.length?[a]:s.map((e=>({...e,...a})))}const ee=e=>e.aggregations?Z(e.aggregations):e.hits.hits.map((e=>e.fields||e._source)).filter((e=>e)),te={name:"es_raw_response",to:{datatable:e=>{var t;const a=ee(e.body),s=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"esdsl",source:"*",statistics:{totalCount:"number"==typeof e.body.hits.total?e.body.hits.total:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:s,rows:a}}}},ae=(e,t)=>e.map((e=>e.fields||e._source)).filter((e=>e)).map((e=>(e=>{const t=(e,a=[])=>Object.keys(e).map((s=>{if("object"!=typeof e[s]||null===e[s]||Array.isArray(e[s])){const t=[...a,s].join(".");return{[t]:e[s]}}return t(e[s],[...a,s])})).flat();return Object.assign({},...t(e))})(e))).map((e=>(t&&(e.joinKeys=t),e))),se={name:"eql_raw_response",to:{datatable:e=>{var t;const a=(s=e.body.hits).sequences?s.sequences.flatMap((e=>ae(e.events,e.join_keys))):ae(s.events);var s;const r=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"eql",source:"*",statistics:{totalCount:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:r,rows:a}}}};var re=a(59),ne=a(60),ie=a(61)},function(e,t){e.exports=__kbnSharedDeps__.MomentTimezone},function(e,t,a){"use strict";a.d(t,"g",(function(){return F})),a.d(t,"e",(function(){return p})),a.d(t,"a",(function(){return invalid_es_calendar_interval_error_InvalidEsCalendarIntervalError})),a.d(t,"b",(function(){return invalid_es_interval_format_error_InvalidEsIntervalFormatError})),a.d(t,"j",(function(){return f})),a.d(t,"k",(function(){return y})),a.d(t,"q",(function(){return S})),a.d(t,"n",(function(){return T})),a.d(t,"m",(function(){return g})),a.d(t,"r",(function(){return E})),a.d(t,"f",(function(){return x})),a.d(t,"c",(function(){return ip_address_IpAddress})),a.d(t,"p",(function(){return C})),a.d(t,"h",(function(){return L})),a.d(t,"o",(function(){return K})),a.d(t,"i",(function(){return H})),a.d(t,"d",(function(){return Y})),a.d(t,"l",(function(){return Q})),a.d(t,"s",(function(){return J}));var s=a(6),r=a.n(s),n=a(19),i=a(41),o=a(21),l=a.n(o),u=a(0);class invalid_es_calendar_interval_error_InvalidEsCalendarIntervalError extends Error{constructor(e,t,a,s){super(u.i18n.translate("data.parseEsInterval.invalidEsCalendarIntervalErrorMessage",{defaultMessage:"Invalid calendar interval: {interval}, value must be 1",values:{interval:e}})),this.interval=e,this.value=t,this.unit=a,this.type=s,this.name="InvalidEsCalendarIntervalError",this.value=t,this.unit=a,this.type=s,Error.captureStackTrace&&Error.captureStackTrace(this,invalid_es_calendar_interval_error_InvalidEsCalendarIntervalError),Object.setPrototypeOf(this,invalid_es_calendar_interval_error_InvalidEsCalendarIntervalError.prototype)}}class invalid_es_interval_format_error_InvalidEsIntervalFormatError extends Error{constructor(e){super(u.i18n.translate("data.parseEsInterval.invalidEsIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format: {interval}",values:{interval:e}})),this.interval=e,this.name="InvalidEsIntervalFormatError",Error.captureStackTrace&&Error.captureStackTrace(this,invalid_es_interval_format_error_InvalidEsIntervalFormatError),Object.setPrototypeOf(this,invalid_es_interval_format_error_InvalidEsIntervalFormatError.prototype)}}const c=new RegExp("^([1-9][0-9]*)\\s*("+l.a.units.join("|")+")$"),d=e=>{switch(e){case"minute":return"1m";case"hour":return"1h";case"day":return"1d";case"week":return"1w";case"month":return"1M";case"quarter":return"1q";case"year":return"1y"}return e};function g(e){const t=String(d(e)).trim().match(c);if(!t)throw new invalid_es_interval_format_error_InvalidEsIntervalFormatError(e);const a=parseFloat(t[1]),s=t[2],r=l.a.unitsMap[s].type;if("calendar"===r&&1!==a)throw new invalid_es_calendar_interval_error_InvalidEsCalendarIntervalError(e,a,s,r);return{value:a,unit:s,type:"mixed"===r&&1===a||"calendar"===r?"calendar":"fixed"}}const h={w:"7d",M:"30d",y:"365d"};function p(e,t){const{type:a,unit:s}=g(e);return"calendar"!==a||t?"calendar"===a?{fixed_interval:h[s]||e}:{fixed_interval:e}:{calendar_interval:e}}function f(e){try{return g(e),!0}catch{return!1}}function m(e,t){return 0===e?Math.abs(t):m(t%e,e)}function b(e,t){return Math.abs(e*t/m(e,t))}function y(e,t){return t?function(e,t){try{return function(e,t){const{unitsMap:a,unitsDesc:s}=l.a,r=g(e),n=g(t);if(e===t)return e;const i=a[r.unit],o=a[n.unit];if(r.type!==n.type)throw Error(`Incompatible intervals: ${e} (${r.type}), ${t} (${n.type})`);if("calendar"===r.type||"calendar"===n.type)return i.weight>o.weight?`${r.value}${r.unit}`:`${n.value}${n.unit}`;const u=r.value*i.base,c=n.value*o.base,d=b(u,c);if(d===c)return t.replace(/\s/g,"");if(d===u)return e.replace(/\s/g,"");const h=s.find((e=>{const t=a[e];return!("calendar"===t.type||d%t.base!=0)}));if(!h)throw Error(`Unable to find common interval for: ${e}, ${t}`);return`${d/a[h].base}${h}`}(t,e)===e.replace(/\s/g,"")}catch(e){return!1}}(e,t):f(e)}var v=a(1);const _=new RegExp("^([0-9\\.]*)\\s*("+l.a.units.join("|")+")$"),S=e=>{if(e){const t=e.toString().trim().match(_);if(t)return{value:parseFloat(t[1])||1,unit:t[2]}}return null};function T(e){const t=S(e);if(!t)return null;try{const{value:e,unit:a}=t,s=r.a.duration(e,a),n=Object(v.find)(l.a.units,(e=>Math.abs(s.as(e))>=1));return l.a.units.indexOf(n)<l.a.units.indexOf(a)?s:r.a.duration(s.as(n),n)}catch(e){return null}}function E(e){const t=l.a.parse(e.from),a=l.a.parse(e.to,{roundUp:!0});if(t&&a)return{from:t.toDate(),to:a.toDate()}}var M=a(23);function F(e){return function(t){const a=E(t);if(!a)return;const s=new i.a({"histogram:maxBars":e(n.f.HISTOGRAM_MAX_BARS),"histogram:barTarget":e(n.f.HISTOGRAM_BAR_TARGET),dateFormat:e("dateFormat"),"dateFormat:scaled":e("dateFormat:scaled")});return s.setInterval(M.a),s.setBounds({min:r()(a.from),max:r()(a.to)}),s.getInterval().expression}}var A=a(2),I=a.n(A),O=a(64),w=a(53);const k=(e,t)=>t(e.address);var R=a(54);function x(e){var t,a,s,r,n,i;class FieldFormatWithCache extends O.FieldFormat{constructor(...e){super(...e),I()(this,"formatCache",new Map)}getCachedFormat(t){const a=this.formatCache.has(t),s=this.formatCache.get(t)||e(t);return a||this.formatCache.set(t,s),s}}return[(t=class AggsRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"textConvert",(e=>{const t=this._params;if(null==e)return"";if(e.label)return e.label;const a=t,s=this.getCachedFormat(a);let r=s.convert(e.gte),n=s.convert(e.lt);if(t.replaceInfinity&&null==a.id){const t="",a="+";r=isFinite(e.gte)?r:t,n=isFinite(e.lt)?n:a}return"arrow_right"===t.template?u.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessageArrowRight",{defaultMessage:"{from}  {to}",values:{from:r,to:n}}):u.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessage",{defaultMessage:"{gte} {from} and {lt} {to}",values:{gte:"",from:r,lt:"<",to:n}})}))}},I()(t,"id","range"),I()(t,"hidden",!0),t),(a=class AggsDateRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return Object(w.a)(e,a.convert.bind(a))}))}},I()(a,"id","date_range"),I()(a,"hidden",!0),a),(s=class AggsIpPrefixFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return k(e,a.convert.bind(a))}))}},I()(s,"id","ip_prefix"),I()(s,"hidden",!0),s),(r=class AggsIpRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return Object(R.a)(e,a.convert.bind(a))}))}},I()(r,"id","ip_range"),I()(r,"hidden",!0),r),(n=class AggsTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"convert",((e,t)=>{const a=this._params,s=this.getCachedFormat(a);return"__other__"===e?`${a.otherBucketLabel}`:"__missing__"===e?`${a.missingBucketLabel}`:s.convert(e,t)})),I()(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},I()(n,"id","terms"),I()(n,"hidden",!0),n),(i=class AggsMultiTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),I()(this,"convert",((e,t)=>{var a,s,r;const n=this._params,i=n.paramsPerField.map((e=>this.getCachedFormat(e)));if("__other__"===String(e))return`${n.otherBucketLabel}`;const o=`${null!==(a=n.separator)&&void 0!==a?a:"  "}`;return null!==(s=null==e||null===(r=e.keys)||void 0===r?void 0:r.map(((e,a)=>i[a].convert(e,t))).join(o))&&void 0!==s?s:""})),I()(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},I()(i,"id","multi_terms"),I()(i,"hidden",!0),i)]}var N=a(48),j=a.n(N);class ip_address_IpAddress{constructor(e){I()(this,"value",void 0);try{this.value=Array.isArray(e)?j.a.fromByteArray(e):j.a.parse(`${e}`)}catch{throw Error("Invalid IP address: "+e)}}toString(){return"ipv6"===this.value.kind()?this.value.toRFC5952String():this.value.toString()}}function C(e){return function(t,a=[]){if(Object(v.isFunction)(a))return t.filter((t=>a(t[e])));if(Array.isArray(a)||(a=a.split(",")),0===a.length)return t;if(a.includes("*"))return t;const s=a.reduce(((e,t)=>{let a="include",s=t;return"!"===t.charAt(0)&&(a="exclude",s=t.substr(1)),e[a]||(e[a]=[]),e[a].push(s),e}),{});return t.filter((t=>{const a=t[e];return(!s.exclude||!s.exclude.includes(a))&&!(s.include&&!s.include.includes(a))}))}}var P=a(55);function L(e,t,a,s,{shouldDetectTimeZone:r}={}){let n=e.time_zone;if(!n&&e.field){var i,o,l,u;const s="string"==typeof e.field?e.field:e.field.name;n=null===(i=t.typeMeta)||void 0===i||null===(o=i.aggs)||void 0===o||null===(l=o[a])||void 0===l||null===(u=l[s])||void 0===u?void 0:u.time_zone}return n||Object(P.a)(s,r)}var D=a(50);const B=["s","m","h","d","w","M","y"],q=/^(startAt|endAt)\((.+)\)$/,G=/^(\d+)\s*(\w)$/,U="invalid",z="previous",$="startAt",V=r.a.HTML5_FMT.DATETIME_LOCAL_MS+"Z",K=e=>{const t=e.trim();if(t===z)return z;const[,a,s]=t.match(G)||[],n=Number(a);return Number.isNaN(n)||!B.includes(s)?U:r.a.duration(Number(a),s)},H=e=>null!=e&&q.test(e),Y={missingTimerange:"missingTimerange",notAbsoluteTimeShift:"notAbsoluteTimeShift",invalidDate:"invalidDate",shiftAfterTimeRange:"shiftAfterTimeRange"},Q=(e,t)=>{const a=e.trim();if(null==t)return{value:U,reason:Y.missingTimerange};const s=J(a,t);if(s)return{value:U,reason:s};const{anchor:n,timestamp:i}=W(a),o=r()(i,V,!0),l=r()(t.to).diff(r()(t.from)),u=n===$?o.add(l):o;return{value:r.a.duration(r()(t.to).diff(u)),reason:null}};function W(e){const[,t,a]=e.match(q)||[];return{anchor:t,timestamp:a}}function J(e,t){const a=e.trim();if(!H(a))return Y.notAbsoluteTimeShift;const{anchor:s,timestamp:n}=W(a),i=r()(n,V,!0);if(!i.isValid())return Y.invalidDate;if(t){const e=Object(D.b)(t),a=r()(e.to).diff(r()(e.from));if(s===$&&i.isAfter(e.from)||i.subtract(a).isAfter(e.from))return Y.shiftAfterTimeRange}}},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"e",(function(){return l}));var s=a(42);a.d(t,"f",(function(){return s.a}));const r="kuery",n="kibana.userQueryLanguage",i="/internal/saved_query",o="1",l="1"},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t){e.exports=__kbnSharedDeps__.KbnDatemath},function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return u})),a.d(t,"c",(function(){return g}));var s=a(44),r=a(78),n=a.n(r),i=a(5),o=a(17);let l=function(e){return e.None="none",e.Loading="loading",e.Completed="completed",e.BackgroundLoading="backgroundLoading",e.BackgroundCompleted="backgroundCompleted",e.Restored="restored",e.Canceled="canceled",e}({}),u=function(e){return e.InProgress="inProgress",e.Completed="completed",e.Errored="errored",e}({});const c={start:e=>({appName:e})=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[],sessionId:Object(s.v4)(),startTime:new Date,appName:e}),restore:e=>e=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[],sessionId:e,isRestore:!0,isStored:!0}),clear:e=>()=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[]}),store:e=>t=>{if(!e.sessionId)throw new Error("Can't store session. Missing sessionId");if(e.isStored||e.isRestore)throw new Error("Can't store because current session is already stored\"");return{...e,isStored:!0,searchSessionSavedObject:t}},trackSearch:e=>(t,a={})=>{if(!e.sessionId)throw new Error("Can't track search. Missing sessionId");return{...e,isStarted:!0,trackedSearches:e.trackedSearches.concat({state:u.InProgress,searchDescriptor:t,searchMeta:a}),completedTime:void 0}},removeSearch:e=>t=>{const a=e.trackedSearches.filter((e=>e.searchDescriptor!==t));return{...e,trackedSearches:a,completedTime:0===a.filter((e=>e.state!==u.InProgress)).length?new Date:e.completedTime}},completeSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:u.Completed}:e))}),errorSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:u.Errored}:e))}),updateSearchMeta:e=>(t,a)=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,searchMeta:{...e.searchMeta,...a}}:e))}),cancel:e=>()=>{if(!e.sessionId)throw new Error("Can't cancel searches. Missing sessionId");if(e.isRestore)throw new Error("Can't cancel searches when restoring older searches");return{...e,pendingSearches:[],isCanceled:!0,canceledTime:new Date,isStored:!1,searchSessionSavedObject:void 0}},setSearchSessionSavedObject:e=>t=>{if(!e.sessionId)throw new Error("Can't add search session saved object session into the state. Missing sessionId");if(e.sessionId!==t.attributes.sessionId)throw new Error("Can't add search session saved object session into the state. SessionIds don't match.");return{...e,searchSessionSavedObject:t}}},d={getState:e=>()=>{if(!e.sessionId)return l.None;if(!e.isStarted)return l.None;if(e.isCanceled)return l.Canceled;const t=e.trackedSearches.filter((e=>e.state===u.InProgress));switch(!0){case e.isRestore:return t.length>0?l.BackgroundLoading:l.Restored;case e.isStored:return t.length>0?l.BackgroundLoading:l.BackgroundCompleted;default:return t.length>0?l.Loading:l.Completed}return l.None},getMeta(e){const t=this.getState(e)();return()=>{var a,s,r;return{state:t,name:null===(a=e.searchSessionSavedObject)||void 0===a?void 0:a.attributes.name,startTime:null!==(s=e.searchSessionSavedObject)&&void 0!==s&&s.attributes.created?new Date(null===(r=e.searchSessionSavedObject)||void 0===r?void 0:r.attributes.created):e.startTime,completedTime:e.completedTime,canceledTime:e.canceledTime,isContinued:e.isContinued}}},getSearch:e=>t=>{var a;return null!==(a=e.trackedSearches.find((e=>e.searchDescriptor===t)))&&void 0!==a?a:null}},g=({freeze:e=!0}={freeze:!0})=>{const t=Object(o.createStateContainer)({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isStarted:!1,trackedSearches:[]},c,d,e?void 0:{freeze:e=>e}),a=t.state$.pipe(Object(i.map)((()=>t.selectors.getMeta())),Object(i.distinctUntilChanged)(n.a),Object(i.shareReplay)(1)),s=a.pipe(Object(i.map)((e=>e.state)),Object(i.distinctUntilChanged)());return{stateContainer:t,sessionState$:s,sessionMeta$:a}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return i}));var s=a(0);const r="auto",n=e=>e===r,i=[{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.autoDisplayName",{defaultMessage:"Auto"}),val:r,enabled:e=>e.fieldIsTimeField()},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecondDisplayName",{defaultMessage:"Millisecond"}),val:"ms"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.secondDisplayName",{defaultMessage:"Second"}),val:"s"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.minuteDisplayName",{defaultMessage:"Minute"}),val:"m"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.hourlyDisplayName",{defaultMessage:"Hour"}),val:"h"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.dailyDisplayName",{defaultMessage:"Day"}),val:"d"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.weeklyDisplayName",{defaultMessage:"Week"}),val:"w"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.monthlyDisplayName",{defaultMessage:"Month"}),val:"M"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.yearlyDisplayName",{defaultMessage:"Year"}),val:"y"}]},function(e,t,a){"use strict";a.d(t,"a",(function(){return BaseParamType}));var s=a(2),r=a.n(s);class BaseParamType{constructor(e){r()(this,"name",void 0),r()(this,"type",void 0),r()(this,"displayName",void 0),r()(this,"required",void 0),r()(this,"advanced",void 0),r()(this,"default",void 0),r()(this,"write",void 0),r()(this,"serialize",void 0),r()(this,"deserialize",void 0),r()(this,"toExpressionAst",void 0),r()(this,"options",void 0),r()(this,"getValueType",void 0),r()(this,"modifyAggConfigOnSearchRequestStart",void 0),this.name=e.name,this.type=e.type,this.displayName=e.displayName||this.name,this.required=!0===e.required,this.advanced=e.advanced||!1,this.onChange=e.onChange,this.shouldShow=e.shouldShow,this.default=e.default,this.write=e.write||((e,t)=>{e.params[this.name]&&(t.params[this.name]=e.params[this.name]||this.default)}),this.serialize=e.serialize,this.deserialize=e.deserialize,this.toExpressionAst=e.toExpressionAst,this.options=e.options,this.modifyAggConfigOnSearchRequestStart=e.modifyAggConfigOnSearchRequestStart||function(){},this.getValueType=e.getValueType}}},function(e,t){e.exports=__kbnSharedDeps__.KbnAnalytics},function(e,t,a){"use strict";a.d(t,"c",(function(){return kbn_field_type_KbnFieldType})),a.d(t,"d",(function(){return c})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));var s=a(2),r=a.n(s);let n=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),i=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class kbn_field_type_KbnFieldType{constructor(e={}){r()(this,"name",void 0),r()(this,"sortable",void 0),r()(this,"filterable",void 0),r()(this,"esTypes",void 0),this.name=e.name||i.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const o=new kbn_field_type_KbnFieldType({name:i.UNKNOWN}),l=[new kbn_field_type_KbnFieldType({name:i.STRING,sortable:!0,filterable:!0,esTypes:[n.STRING,n.TEXT,n.MATCH_ONLY_TEXT,n.KEYWORD,n.VERSION,n._TYPE,n._ID]}),new kbn_field_type_KbnFieldType({name:i.NUMBER,sortable:!0,filterable:!0,esTypes:[n.FLOAT,n.HALF_FLOAT,n.SCALED_FLOAT,n.DOUBLE,n.INTEGER,n.LONG,n.UNSIGNED_LONG,n.SHORT,n.BYTE,n.TOKEN_COUNT,n.AGGREGATE_METRIC_DOUBLE]}),new kbn_field_type_KbnFieldType({name:i.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[n.FLOAT_RANGE,n.DOUBLE_RANGE,n.INTEGER_RANGE,n.LONG_RANGE]}),new kbn_field_type_KbnFieldType({name:i.DATE,sortable:!0,filterable:!0,esTypes:[n.DATE,n.DATE_NANOS]}),new kbn_field_type_KbnFieldType({name:i.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[n.DATE_RANGE]}),new kbn_field_type_KbnFieldType({name:i.IP,sortable:!0,filterable:!0,esTypes:[n.IP]}),new kbn_field_type_KbnFieldType({name:i.IP_RANGE,sortable:!0,filterable:!0,esTypes:[n.IP_RANGE]}),new kbn_field_type_KbnFieldType({name:i.BOOLEAN,sortable:!0,filterable:!0,esTypes:[n.BOOLEAN]}),new kbn_field_type_KbnFieldType({name:i.OBJECT,esTypes:[n.OBJECT]}),new kbn_field_type_KbnFieldType({name:i.NESTED,esTypes:[n.NESTED]}),new kbn_field_type_KbnFieldType({name:i.GEO_POINT,esTypes:[n.GEO_POINT]}),new kbn_field_type_KbnFieldType({name:i.GEO_SHAPE,esTypes:[n.GEO_SHAPE]}),new kbn_field_type_KbnFieldType({name:i.ATTACHMENT,esTypes:[n.ATTACHMENT]}),new kbn_field_type_KbnFieldType({name:i.MURMUR3,esTypes:[n.MURMUR3]}),new kbn_field_type_KbnFieldType({name:i._SOURCE,esTypes:[n._SOURCE]}),new kbn_field_type_KbnFieldType({name:i.HISTOGRAM,filterable:!0,esTypes:[n.HISTOGRAM]}),new kbn_field_type_KbnFieldType({name:i.CONFLICT}),o],u=e=>{const t=l.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:i.UNKNOWN};function c(e){switch(e){case n._INDEX:return i.STRING;case"_version":return i.NUMBER;case"datetime":return i.DATE;default:return u(e)}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s.a})),a.d(t,"b",(function(){return agg_configs_AggConfigs})),a.d(t,"d",(function(){return h})),a.d(t,"c",(function(){return p})),a.d(t,"f",(function(){return v.a})),a.d(t,"vc",(function(){return hr})),a.d(t,"wc",(function(){return pr})),a.d(t,"g",(function(){return agg_types_registry_AggTypesRegistry})),a.d(t,"nc",(function(){return fr})),a.d(t,"h",(function(){return aggs_service_AggsCommonService})),a.d(t,"oc",(function(){return _.a})),a.d(t,"ud",(function(){return _.c})),a.d(t,"sd",(function(){return _.b})),a.d(t,"k",(function(){return S.a})),a.d(t,"vd",(function(){return S.b})),a.d(t,"i",(function(){return T.a})),a.d(t,"U",(function(){return E})),a.d(t,"T",(function(){return M})),a.d(t,"wd",(function(){return U})),a.d(t,"Hc",(function(){return z})),a.d(t,"W",(function(){return $})),a.d(t,"V",(function(){return V})),a.d(t,"Ic",(function(){return Q})),a.d(t,"cb",(function(){return W})),a.d(t,"bb",(function(){return J})),a.d(t,"Lc",(function(){return ae})),a.d(t,"gb",(function(){return se})),a.d(t,"fb",(function(){return re})),a.d(t,"Nc",(function(){return oe})),a.d(t,"mb",(function(){return le})),a.d(t,"lb",(function(){return ue})),a.d(t,"Qc",(function(){return de})),a.d(t,"ob",(function(){return ge})),a.d(t,"nb",(function(){return he})),a.d(t,"Rc",(function(){return be})),a.d(t,"qb",(function(){return ve})),a.d(t,"pb",(function(){return _e})),a.d(t,"Sc",(function(){return Fe})),a.d(t,"sb",(function(){return Ae})),a.d(t,"rb",(function(){return Ie})),a.d(t,"o",(function(){return ke})),a.d(t,"Tc",(function(){return Re})),a.d(t,"l",(function(){return cidr_mask_CidrMask})),a.d(t,"sc",(function(){return xe.a})),a.d(t,"tc",(function(){return Ne.a})),a.d(t,"pc",(function(){return je.a})),a.d(t,"rc",(function(){return je.c})),a.d(t,"qc",(function(){return je.b})),a.d(t,"C",(function(){return I.a})),a.d(t,"Cd",(function(){return Ce})),a.d(t,"zd",(function(){return Pe})),a.d(t,"Bd",(function(){return Le})),a.d(t,"Ad",(function(){return De})),a.d(t,"Fd",(function(){return Be})),a.d(t,"Ib",(function(){return qe})),a.d(t,"Hb",(function(){return Ge})),a.d(t,"bd",(function(){return Ve})),a.d(t,"Sb",(function(){return Ke})),a.d(t,"Rb",(function(){return He})),a.d(t,"gd",(function(){return We})),a.d(t,"Ub",(function(){return Je})),a.d(t,"Tb",(function(){return Xe})),a.d(t,"hd",(function(){return et})),a.d(t,"ec",(function(){return tt})),a.d(t,"dc",(function(){return at})),a.d(t,"Qd",(function(){return ht})),a.d(t,"md",(function(){return mt})),a.d(t,"w",(function(){return multi_field_key_MultiFieldKey})),a.d(t,"yd",(function(){return vt})),a.d(t,"u",(function(){return _t})),a.d(t,"Cb",(function(){return St})),a.d(t,"Bb",(function(){return Tt})),a.d(t,"Yc",(function(){return Ft})),a.d(t,"Kb",(function(){return At})),a.d(t,"Jb",(function(){return It})),a.d(t,"cd",(function(){return wt})),a.d(t,"Ob",(function(){return Nt})),a.d(t,"Nb",(function(){return jt})),a.d(t,"z",(function(){return kt})),a.d(t,"ed",(function(){return xt})),a.d(t,"ab",(function(){return Dt})),a.d(t,"Z",(function(){return Bt})),a.d(t,"m",(function(){return Ct})),a.d(t,"Kc",(function(){return Lt})),a.d(t,"nd",(function(){return zt})),a.d(t,"gc",(function(){return qt})),a.d(t,"fc",(function(){return Gt})),a.d(t,"A",(function(){return $t.a})),a.d(t,"E",(function(){return Vt})),a.d(t,"D",(function(){return Kt})),a.d(t,"yc",(function(){return Yt})),a.d(t,"G",(function(){return Qt})),a.d(t,"F",(function(){return Wt})),a.d(t,"zc",(function(){return na})),a.d(t,"I",(function(){return ia})),a.d(t,"H",(function(){return oa})),a.d(t,"Ac",(function(){return ca})),a.d(t,"K",(function(){return da})),a.d(t,"J",(function(){return ga})),a.d(t,"Bc",(function(){return fa})),a.d(t,"M",(function(){return ma})),a.d(t,"L",(function(){return ba})),a.d(t,"Cc",(function(){return _a})),a.d(t,"eb",(function(){return Sa})),a.d(t,"db",(function(){return Ta})),a.d(t,"Mc",(function(){return Fa})),a.d(t,"O",(function(){return Aa})),a.d(t,"N",(function(){return Ia})),a.d(t,"Ec",(function(){return wa})),a.d(t,"mc",(function(){return ka})),a.d(t,"lc",(function(){return Ra})),a.d(t,"qd",(function(){return Na})),a.d(t,"Fc",(function(){return Pa})),a.d(t,"Q",(function(){return ja})),a.d(t,"P",(function(){return Ca})),a.d(t,"S",(function(){return La})),a.d(t,"R",(function(){return Da})),a.d(t,"Gc",(function(){return Va})),a.d(t,"Y",(function(){return Ka})),a.d(t,"X",(function(){return Ha})),a.d(t,"Jc",(function(){return Wa})),a.d(t,"ib",(function(){return Ja})),a.d(t,"hb",(function(){return Xa})),a.d(t,"Oc",(function(){return ts})),a.d(t,"kb",(function(){return as})),a.d(t,"jb",(function(){return ss})),a.d(t,"Pc",(function(){return is})),a.d(t,"Hd",(function(){return Ga})),a.d(t,"Gd",(function(){return Ua})),a.d(t,"Od",(function(){return ta})),a.d(t,"Nd",(function(){return aa})),a.d(t,"ub",(function(){return os})),a.d(t,"tb",(function(){return ls})),a.d(t,"Uc",(function(){return cs})),a.d(t,"wb",(function(){return ds})),a.d(t,"vb",(function(){return gs})),a.d(t,"Vc",(function(){return ps})),a.d(t,"Wb",(function(){return fs})),a.d(t,"Vb",(function(){return ms})),a.d(t,"id",(function(){return ys})),a.d(t,"v",(function(){return metric_agg_type_MetricAggType})),a.d(t,"xd",(function(){return B})),a.d(t,"t",(function(){return w})),a.d(t,"yb",(function(){return vs})),a.d(t,"xb",(function(){return _s})),a.d(t,"Wc",(function(){return Ts})),a.d(t,"Ab",(function(){return Es})),a.d(t,"zb",(function(){return Ms})),a.d(t,"Xc",(function(){return Is})),a.d(t,"Eb",(function(){return Os})),a.d(t,"Db",(function(){return ws})),a.d(t,"Zc",(function(){return js})),a.d(t,"Gb",(function(){return Cs})),a.d(t,"Fb",(function(){return Ps})),a.d(t,"ad",(function(){return Ds})),a.d(t,"Mb",(function(){return Bs})),a.d(t,"Lb",(function(){return qs})),a.d(t,"dd",(function(){return Us})),a.d(t,"Yb",(function(){return zs})),a.d(t,"Xb",(function(){return $s})),a.d(t,"jd",(function(){return Ks})),a.d(t,"Qb",(function(){return Hs})),a.d(t,"Pb",(function(){return Ys})),a.d(t,"fd",(function(){return Js})),a.d(t,"ac",(function(){return Xs})),a.d(t,"Zb",(function(){return Zs})),a.d(t,"kd",(function(){return tr})),a.d(t,"cc",(function(){return ar})),a.d(t,"bc",(function(){return sr})),a.d(t,"ld",(function(){return nr})),a.d(t,"ic",(function(){return ir})),a.d(t,"hc",(function(){return or})),a.d(t,"od",(function(){return ur})),a.d(t,"pd",(function(){return gr})),a.d(t,"kc",(function(){return cr})),a.d(t,"jc",(function(){return dr})),a.d(t,"e",(function(){return k.a})),a.d(t,"j",(function(){return R.a})),a.d(t,"n",(function(){return x.a})),a.d(t,"s",(function(){return N.a})),a.d(t,"x",(function(){return j.a})),a.d(t,"B",(function(){return C.a})),a.d(t,"Dc",(function(){return q.g})),a.d(t,"uc",(function(){return q.e})),a.d(t,"p",(function(){return q.a})),a.d(t,"q",(function(){return q.b})),a.d(t,"Dd",(function(){return q.j})),a.d(t,"Ed",(function(){return q.k})),a.d(t,"Pd",(function(){return q.q})),a.d(t,"Kd",(function(){return q.n})),a.d(t,"Jd",(function(){return q.m})),a.d(t,"Rd",(function(){return q.r})),a.d(t,"xc",(function(){return q.f})),a.d(t,"r",(function(){return q.c})),a.d(t,"Md",(function(){return q.p})),a.d(t,"rd",(function(){return q.h})),a.d(t,"Ld",(function(){return q.o})),a.d(t,"td",(function(){return q.i})),a.d(t,"y",(function(){return q.d})),a.d(t,"Id",(function(){return q.l})),a.d(t,"Sd",(function(){return q.s}));var s=a(31),r=a(2),n=a.n(r),i=a(15),o=a.n(i),l=a(1),u=a.n(l),c=a(0),d=a(4),g=a(8);const h=Object.freeze({Buckets:"buckets",Metrics:"metrics",None:"none"}),p={[h.Buckets]:c.i18n.translate("data.search.aggs.aggGroups.bucketsText",{defaultMessage:"Buckets"}),[h.Metrics]:c.i18n.translate("data.search.aggs.aggGroups.metricsText",{defaultMessage:"Metrics"}),[h.None]:c.i18n.translate("data.search.aggs.aggGroups.noneText",{defaultMessage:"None"})};var f=a(3);function m({type:e="random_sampler",probability:t,seed:a}){return{[e]:{probability:t,seed:a},aggs:{}}}function b(e){for(const t in e)if("parentAggs"===t)delete e[t];else if("object"==typeof e[t]){const a="parentAggs"in e[t];b(e[t]),a&&0===Object.keys(e[t]).length&&delete e[t]}}function y(e,t){t.parentAggs&&u.a.each(t.parentAggs,((t,a)=>{e[a]=t,y(e,t)}))}class agg_configs_AggConfigs{constructor(e,t=[],a,r){var i;n()(this,"timeRange",void 0),n()(this,"timeFields",void 0),n()(this,"forceNow",void 0),n()(this,"aggs",[]),n()(this,"timeZone",void 0),n()(this,"createAggConfig",((e,{addToAggConfigs:t=!0}={})=>{const{type:a}=e;let r;return e instanceof s.a?(r=e,e.parent=this):r=new s.a(this,{...e,type:"string"==typeof a?(e=>{const t=this.opts.typesRegistry.get(e);if(!t)throw new Error(c.i18n.translate("data.search.aggs.error.aggNotFound",{defaultMessage:'Unable to find a registered agg type for "{type}".',values:{type:a}}));return t})(a):a}),t&&this.aggs.push(r),r})),this.indexPattern=e,this.opts=a,this.getConfig=r,this.timeZone=Object(f.getUserTimeZone)(this.getConfig,null==a||null===(i=a.aggExecutionContext)||void 0===i?void 0:i.shouldDetectTimeZone),(t=s.a.ensureIds(t)).forEach((e=>this.createAggConfig(e)))}get hierarchical(){var e;return null!==(e=this.opts.hierarchical)&&void 0!==e&&e}get partialRows(){var e;return null!==(e=this.opts.partialRows)&&void 0!==e&&e}get samplerConfig(){var e;return{probability:null!==(e=this.opts.probability)&&void 0!==e?e:1,seed:this.opts.samplerSeed}}isSamplingEnabled(){return null!=(e=this.opts.probability)&&1!==e&&this.getRequestAggs().some((e=>!e.type.hasNoDsl));var e}setTimeFields(e){this.timeFields=e}setForceNow(e){this.forceNow=e}setTimeRange(e){this.timeRange=e;const t=a=>{u.a.each(a.params,(e=>{e instanceof s.a&&t(e)})),"date_histogram"===u.a.get(a,"type.name")&&(a.params.timeRange=e)};this.aggs.forEach(t)}getResolvedTimeRange(){return this.timeRange&&Object(f.calculateBounds)(this.timeRange,{forceNow:this.forceNow})}clone({enabledOnly:e=!0,opts:t}={}){return new agg_configs_AggConfigs(this.indexPattern,this.aggs.filter((t=>!e||t.enabled)),{...this.opts,...t},this.getConfig)}jsonDataEquals(e){if(e.length!==this.aggs.length)return!1;for(let t=0;t<this.aggs.length;t+=1)if(!u.a.isEqual(e[t].toJSON(),this.aggs[t].toJSON()))return!1;return!0}toDsl(){const e={};let t,a;const s=this.getTimeShifts(),r=Object.keys(s).length>1;if(this.hierarchical){if(r)throw new Error("Multiple time shifts not supported for hierarchical metrics");a=this.aggs.filter((function(e){return"metrics"===e.type.type&&"count"!==e.type.name})).map((e=>({config:e,dsl:e.toDsl(this)})))}const n=this.getRequestAggs(),i=n.filter((e=>!e.type.hasNoDsl)).length,l=this.getAll().findIndex((e=>"splitForTimeShift"in e.type&&e.type.splitForTimeShift(e,this)));var c;return this.isSamplingEnabled()&&(e.sampling=m({probability:null!==(c=this.opts.probability)&&void 0!==c?c:1,seed:this.opts.samplerSeed})),n.forEach(((n,c,d)=>{if(t){const e=d[c-1],a=t[e.id];t=(null==a?void 0:a.aggs)||t}else t=e,this.isSamplingEnabled()&&(t=t.sampling.aggs);if(r&&(t=function(e,t,a,s,r){if("splitForTimeShift"in t.type&&!t.type.splitForTimeShift(t,e))return s;if(!e.timeFields||e.timeFields.length<1)throw new Error("Time shift can only be used with configured time field");if(!e.timeRange)throw new Error("Time shift can only be used with configured time range");const n=e.timeRange,i={},l=e.timeFields[0],u=Object(f.getTime)(e.indexPattern,n,{fieldName:l,forceNow:e.forceNow});return Object.entries(a).forEach((([e,t])=>{u&&(i[e]={range:{[l]:{format:"strict_date_optional_time",gte:o.a.tz(u.query.range[l].gte,r).subtract(t).toISOString(),lte:o.a.tz(u.query.range[l].lte,r).subtract(t).toISOString()}}})})),s.time_offset_split={filters:{filters:i},aggs:{}},s.time_offset_split.aggs}(this,n,s,t,this.timeZone)),n.type.hasNoDsl)return;const g=n.type.hasNoDslParams?n.toDsl(this):t[n.id]=n.toDsl(this);let p;y(t,g),n.type.type===h.Buckets&&(c<i-1||l>c)&&(p=g.aggs||(g.aggs={})),p&&u.a.each(p,(e=>{y(p,e)})),p&&a&&a.forEach((e=>{p[e.config.id]=e.dsl,e.dsl.parentAggs&&Object.entries(e.dsl.parentAggs).forEach((([e,t])=>{p[e]=t}))}))})),b(e),e}getAll(){return[...this.aggs]}byIndex(e){return this.aggs[e]}byId(e){return this.aggs.find((t=>t.id===e))}byName(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.name)===e}))}byType(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.type)===e}))}byTypeName(e){return this.byName(e)}bySchemaName(e){return this.aggs.filter((t=>t.schema===e))}getRequestAggs(){const e=this.aggs.filter((e=>e.enabled&&e.type)).reduce(((e,t)=>{const a=t.getRequestAggs();return a?e.concat(a):e}),[]);return u.a.sortBy(e,(e=>e.type.type===h.Metrics?1:0))}getTimeShifts(){const e={};return this.getAll().filter((e=>"metric"===e.schema)).map((e=>e.getTimeShift())).forEach((t=>{t?e[String(t.asMilliseconds())]=t:e[0]=o.a.duration(0)})),e}getTimeShiftInterval(){const e=this.getAll().filter((e=>e.type.type===h.Buckets)).find((e=>e.type.splitForTimeShift(e,this)));return null==e?void 0:e.type.getTimeShiftInterval(e)}hasTimeShifts(){return this.getAll().some((e=>e.hasTimeShift()))}getSearchSourceTimeFilter(e){var t;if(!this.timeFields||!this.timeRange)return[];const a=this.timeRange,s=this.timeFields,r=this.getTimeShifts();return this.hasTimeShifts()?[{meta:{index:null===(t=this.indexPattern)||void 0===t?void 0:t.id,params:{},alias:"",disabled:!1,negate:!1},query:{bool:{should:Object.entries(r).map((([,t])=>({bool:{filter:s.map((t=>[Object(f.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}),t])).filter((([e])=>Object(d.isRangeFilter)(e))).map((([e,a])=>({range:{[a]:{format:"strict_date_optional_time",gte:o.a.tz(null==e?void 0:e.query.range[a].gte,this.timeZone).subtract(t).toISOString(),lte:o.a.tz(null==e?void 0:e.query.range[a].lte,this.timeZone).subtract(t).toISOString()}}})))}}))),minimum_should_match:1}}}]:this.timeFields.map((t=>Object(f.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}))).filter(d.isRangeFilter)}postFlightTransform(e){if(!this.hasTimeShifts())return e;const t=Object(l.cloneDeep)(e.rawResponse);var a;return t.aggregations||(t.aggregations={doc_count:null===(a=e.rawResponse.hits)||void 0===a?void 0:a.total}),function(e,t){const a=e.getTimeShifts(),s=Object.keys(a).length>1,r=e.getRequestAggs(),n=e.aggs.filter((e=>e.type.type===h.Buckets)),i=(e,t,a,s)=>{Object.entries(t).forEach((([o,u])=>{if("number"==typeof u&&"doc_count"===o)0===a.asMilliseconds()?e.doc_count=u:e[`doc_count_${a.asMilliseconds()}`]=u;else{if("object"!=typeof u)return;{const c=r.find((e=>o===e.getResponseId()));if(c&&c.type.type===h.Metrics){const s=c.getTimeShift();(s&&s.asMilliseconds()===a.asMilliseconds()||0===a.asMilliseconds()&&!s)&&(e[o]=t[o])}else if(c&&c===n[s]){const t=c,r="buckets"in u?u.buckets:void 0;e[o]||(e[o]={buckets:Object(l.isArray)(r)?[]:{}});const n=e[o],d="buckets"in n?n.buckets:void 0;if(Object(l.isArray)(r)&&Object(l.isArray)(d)){const e={};d.forEach((t=>{e[String(t.key)]=t})),r.forEach((r=>{const n=t.type.getShiftedKey(t,r.key,a);e[n]||(e[String(n)]={key:n}),i(e[n],r,a,s+1)})),n.buckets=Object.values(e).sort(((e,a)=>t.type.orderBuckets(t,e,a)))}else d&&r&&!Object(l.isArray)(d)&&Object.entries(r).forEach((([e,t])=>{d[e]||(d[e]={}),i(d[e],t,a,s+1)}))}}}}))},o=(t,r)=>{if(e.aggs[r].type.splitForTimeShift(e.aggs[r],e))if(s&&t.time_offset_split){const e=t.time_offset_split.buckets,s={};Object.entries(a).forEach((([t,a])=>{i(s,e[t],a,r)})),delete t.time_offset_split,Object.assign(t,s)}else{const[[,e]]=Object.entries(a),s={};i(s,t,e,r),Object.assign(t,s)}else Object.keys(t).forEach((e=>{const a=t[e];"object"==typeof a&&"buckets"in a&&(Object(l.isArray)(a.buckets)?a.buckets.forEach((e=>o(e,r+1))):Object.values(a.buckets).forEach((e=>o(e,r+1))))}))};o(t,0)}(this,this.isSamplingEnabled()?t.aggregations.sampling:t.aggregations),{...e,rawResponse:t}}getRequestAggById(e){return this.aggs.find((t=>t.id===e))}getResponseAggs(){return this.getRequestAggs().reduce((function(e,t){const a=t.getResponseAggs();return a?e.concat(a):e}),[])}getResponseAggById(e){e=String(e);const t=u.a.find(this.getRequestAggs(),(function(t){const a=String(t.id);return e.includes("[")||e.includes(".")?e.substring(0,-1!==e.indexOf("[")?e.indexOf("["):e.indexOf("."))===a:e===a}));if(t)return u.a.find(t.getResponseAggs(),{id:e})}onSearchRequestStart(e,t){return Promise.all(this.getRequestAggs().map((a=>a.onSearchRequestStart(e,t))))}toExpressionAst(){return Object(g.buildExpression)([Object(g.buildExpressionFunction)("esaggs",{index:Object(g.buildExpression)([Object(g.buildExpressionFunction)("indexPatternLoad",{id:this.indexPattern.id})]),metricsAtAllLevels:this.hierarchical,partialRows:this.partialRows,aggs:this.aggs.map((e=>Object(g.buildExpression)(e.toExpressionAst()))),probability:this.opts.probability,samplerSeed:this.opts.samplerSeed})]).toAst()}}var v=a(39),_=a(23),S=a(11),T=a(12);const E="aggDateHistogram",M=()=>({name:E,help:c.i18n.translate("data.search.aggs.function.buckets.dateHistogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.field.help",{defaultMessage:"Field to use for this aggregation"})},useNormalizedEsInterval:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.useNormalizedEsInterval.help",{defaultMessage:"Specifies whether to use useNormalizedEsInterval for this aggregation"})},time_zone:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.timeZone.help",{defaultMessage:"Time zone to use for this aggregation"})},format:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.format.help",{defaultMessage:"Format to use for this aggregation"})},scaleMetricValues:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.scaleMetricValues.help",{defaultMessage:"Specifies whether to use scaleMetricValues for this aggregation"})},interval:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},timeRange:{types:["timerange"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.timeRange.help",{defaultMessage:"Time Range to use for this aggregation"})},min_doc_count:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.minDocCount.help",{defaultMessage:"Minimum document count to use for this aggregation"})},drop_partials:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.dropPartials.help",{defaultMessage:"Specifies whether to use drop_partials for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},extendToTimeRange:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.extendToTimeRange.help",{defaultMessage:"Auto-sets the extended bounds to the currently applied time range. Is ignored if extended_bounds is set"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateHistogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,timeRange:r,extended_bounds:n,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,timeRange:r&&Object(l.omit)(r,"type"),extended_bounds:n&&Object(l.omit)(n,"type")},type:T.a.DATE_HISTOGRAM}})});var F=a(14);const A=(e,t)=>{const a=o.a.tz(t,e.aggConfigs.timeZone),s=e.buckets.getInterval();return Object(d.buildRangeFilter)(e.params.field,{gte:a.toISOString(),lt:a.add(s).toISOString(),format:"strict_date_optional_time"},e.getIndexPattern())};var I=a(41),O=a(43);let w=function(e){return e.AVG="avg",e.FILTERED_METRIC="filtered_metric",e.CARDINALITY="cardinality",e.VALUE_COUNT="value_count",e.AVG_BUCKET="avg_bucket",e.MAX_BUCKET="max_bucket",e.MIN_BUCKET="min_bucket",e.SUM_BUCKET="sum_bucket",e.COUNT="count",e.CUMULATIVE_SUM="cumulative_sum",e.DERIVATIVE="derivative",e.GEO_BOUNDS="geo_bounds",e.GEO_CENTROID="geo_centroid",e.MEDIAN="median",e.SINGLE_PERCENTILE="single_percentile",e.SINGLE_PERCENTILE_RANK="single_percentile_rank",e.MIN="min",e.MAX="max",e.MOVING_FN="moving_avg",e.SERIAL_DIFF="serial_diff",e.SUM="sum",e.TOP_HITS="top_hits",e.TOP_METRICS="top_metrics",e.PERCENTILES="percentiles",e.PERCENTILE_RANKS="percentile_ranks",e.RATE="rate",e.STD_DEV="std_dev",e}({});var k=a(51),R=a(24),x=a(52),N=a(58),j=a(56),C=a(57);const P=(e,t)=>{const a=e.getIndexPattern();if(e.getField())return Object(d.buildExistsFilter)(e.getField(),a)},L=(e,t)=>{const a=e.getIndexPattern(),s=e.getField();if(s)return Array.isArray(t)?Object(d.buildCombinedFilter)(d.BooleanRelation.OR,t.map((e=>Object(d.buildPhraseFilter)(s,e,a))),a):Object(d.buildPhraseFilter)(s,t,a)},D="metrics";class metric_agg_type_MetricAggType extends v.a{constructor(e){e.createFilter||(e.createFilter=P),super(e),n()(this,"subtype",void 0),n()(this,"isScalable",void 0),n()(this,"type",D),n()(this,"getKey",(()=>{})),this.params.push(new R.a({name:"timeShift",type:"string",write:()=>{}})),e.enableEmptyAsNull&&this.params.push(new R.a({name:"emptyAsNull",type:"boolean",default:!1,write:()=>{}})),this.getValue=e.getValue||((e,t)=>{const a=[w.CARDINALITY,w.VALUE_COUNT,w.SUM].includes(e.type.name);if(!t[e.id]&&a&&!e.params.emptyAsNull)return 0;const s=t[e.id]&&t[e.id].value;return 0===s&&e.params.emptyAsNull?null:s}),this.subtype=e.subtype||c.i18n.translate("data.search.aggs.metrics.metricAggregationsSubtypeTitle",{defaultMessage:"Metric Aggregations"}),this.isScalable=e.isScalable||(()=>!1),this.splitForTimeShift=(e,t)=>t.hasTimeShifts()&&t.byType(h.Metrics)[0]===e&&!t.byType(h.Buckets).some((e=>e.type.splitForTimeShift(e,t)))}}function B(e){return e&&e.type===D}var q=a(16);const G=(e,t,a)=>{const s=e.params.timeRange&&(e.fieldIsTimeField()||Object(_.c)(e.params.interval))?t(e.params.timeRange):void 0,r=a||e.buckets;r.setBounds(s),r.setInterval(e.params.interval)};function U(e){return Boolean(e.buckets)}const z=({calculateBounds:e,aggExecutionContext:t,getConfig:a})=>new S.a({name:T.a.DATE_HISTOGRAM,expressionName:E,title:c.i18n.translate("data.search.aggs.buckets.dateHistogramTitle",{defaultMessage:"Date Histogram"}),ordered:{date:!0},makeLabel(e){let t={};this.params&&(t=Object(O.b)(this.params,e));const a=e.getFieldDisplayName();return c.i18n.translate("data.search.aggs.buckets.dateHistogramLabel",{defaultMessage:"{fieldName} per {intervalDescription}",values:{fieldName:a,intervalDescription:t.metricScaleText||t.bucketInterval.description}})},createFilter:A,decorateAggConfig(){let t;return{buckets:{configurable:!0,get(){return t||(t=new I.a({"histogram:maxBars":a(f.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":a(f.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:a("dateFormat"),"dateFormat:scaled":a("dateFormat:scaled")}),G(this,e,t),t)}}}},getSerializedFormat:e=>({id:"date",params:{pattern:e.buckets.getScaledDateFormat()}}),getShiftedKey(e,s,r){const n=Object(q.h)(e.params,e.getIndexPattern(),"date_histogram",a,t);return o.a.tz(s,n).add(r).valueOf()},splitForTimeShift(e,t){var a;return t.hasTimeShifts()&&Boolean(null===(a=t.timeFields)||void 0===a?void 0:a.includes(e.fieldName()))},getTimeShiftInterval(e){const{useNormalizedEsInterval:t}=e.params;return e.buckets.getInterval(t)},params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name},onChange(e){Object(_.c)(Object(l.get)(e,"params.interval"))&&!e.fieldIsTimeField()&&delete e.params.interval}},{name:"timeRange",default:null,write:l.noop,toExpressionAst:F.timerangeToAst},{name:"useNormalizedEsInterval",default:!0,write:l.noop},{name:"extendToTimeRange",default:!1,write:l.noop},{name:"scaleMetricValues",default:!1,write:l.noop,advanced:!0},{name:"interval",deserialize:(e,t)=>"custom"===e?Object(l.get)(t,"params.customInterval"):Object(l.find)(_.b,{val:e})||"year"!==e?e:"y",default:_.a,options:_.b,write(t,a,s){var r,n;G(t,e);const{useNormalizedEsInterval:i,scaleMetricValues:o}=t.params,u=t.buckets.getInterval(i);if(a.bucketInterval=u,"0ms"===u.expression)return;const c=null===(r=t.params.field)||void 0===r||null===(n=r.fixedInterval)||void 0===n?void 0:n.length;if(a.params={...a.params,...Object(q.e)(u.expression,c)},o&&u.scaled&&u.scale&&u.scale<1&&s){const e=s.aggs.filter((e=>B(e.type)));var d;Object(l.every)(e,(e=>{const{type:t}=e;if(B(t))return t.isScalable()}))&&(a.metricScale=u.scale,a.metricScaleText=(null===(d=u.preScaled)||void 0===d?void 0:d.description)||"")}}},{name:"used_interval",default:_.a,shouldShow:()=>!1,write:()=>{},serialize(e,t){if(!t)return;const{useNormalizedEsInterval:a}=t.params;return t.buckets.getInterval(a).expression},toExpressionAst:()=>{}},{name:"time_zone",default:void 0,serialize:l.noop,write(e,s){var r,n;const i=Object(q.h)(e.params,e.getIndexPattern(),"date_histogram",a,t),o=null===(r=e.params.field)||void 0===r||null===(n=r.timeZone)||void 0===n?void 0:n.includes("UTC");s.params.time_zone=o?"UTC":i}},{name:"used_timezone",shouldShow:()=>!1,write:()=>{},serialize(e,s){if(s)return Object(q.h)(s.params,s.getIndexPattern(),"date_histogram",a,t)},toExpressionAst:()=>{}},{name:"drop_partials",default:!1,write:l.noop,shouldShow:e=>{const t=e.params.field;return t&&t.name&&t.name===e.getIndexPattern().timeFieldName}},{name:"format"},{name:"min_doc_count",default:1},{name:"extended_bounds",default:{},write(e,s){const r=e.params.extended_bounds,n=Object(q.h)(e.params,e.getIndexPattern(),"date_histogram",a,t);if(null==r.min&&null==r.max){if(e.params.extendToTimeRange&&e.buckets.hasBounds()&&!e.aggConfigs.hasTimeShifts()){var i,u;const t=e.buckets.getBounds();s.params.extended_bounds=Object(l.omitBy)({min:null===(i=t.min)||void 0===i?void 0:i.valueOf(),max:null===(u=t.max)||void 0===u?void 0:u.valueOf()},l.isNil)}}else s.params.extended_bounds={min:o.a.tz(r.min,n).valueOf(),max:o.a.tz(r.max,n).valueOf()}},toExpressionAst:F.extendedBoundsToAst}]}),$="aggDateRange",V=()=>({name:$,help:c.i18n.translate("data.search.aggs.function.buckets.dateRange.help",{defaultMessage:"Generates a serialized agg config for a Date Range agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.dateRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["date_range"],multi:!0,help:c.i18n.translate("data.search.aggs.buckets.dateRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},time_zone:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.timeZone.help",{defaultMessage:"Time zone to use for this aggregation."})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.dateRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,ranges:null==r?void 0:r.map((e=>Object(l.omit)(e,"type")))},type:T.a.DATE_RANGE}})}),K=(e,{from:t,to:a})=>{const s={};return t&&(s.gte=o.a.tz(t,e.aggConfigs.timeZone).toISOString()),a&&(s.lt=o.a.tz(a,e.aggConfigs.timeZone).toISOString()),a&&t&&(s.format="strict_date_optional_time"),Object(d.buildRangeFilter)(e.params.field,s,e.getIndexPattern())};var H=a(34);const Y=c.i18n.translate("data.search.aggs.buckets.dateRangeTitle",{defaultMessage:"Date Range"}),Q=({aggExecutionContext:e,getConfig:t})=>new S.a({name:T.a.DATE_RANGE,expressionName:$,title:Y,createFilter:K,getKey:({from:e,to:t})=>({from:e,to:t}),getSerializedFormat:e=>({id:"date_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>e.getFieldDisplayName()+" date ranges",params:[{name:"field",type:"field",filterFieldTypes:[H.b.DATE,H.b.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name}},{name:"ranges",default:[{from:"now-1w/w",to:"now"}],toExpressionAst:e=>null==e?void 0:e.map(F.dateRangeToAst)},{name:"time_zone",default:void 0,serialize:()=>{},write:(a,s)=>{const r=Object(f.inferTimeZone)(a.params,a.getIndexPattern(),"date_range",t,e);s.params.time_zone=r}}]}),W="aggFilter",J=()=>({name:W,help:c.i18n.translate("data.search.aggs.function.buckets.filter.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filter.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.filter.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filter.schema.help",{defaultMessage:"Schema to use for this aggregation"})},geo_bounding_box:{types:["geo_bounding_box"],help:c.i18n.translate("data.search.aggs.buckets.filter.geoBoundingBox.help",{defaultMessage:"Filter results based on a point location within a bounding box"})},filter:{types:["kibana_query"],help:c.i18n.translate("data.search.aggs.buckets.filter.filter.help",{defaultMessage:"Filter results based on a kql or lucene query. Do not use together with geo_bounding_box"})},timeWindow:{types:["string"],help:""},timeShift:{types:["string"],help:""},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filter.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filter.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,geo_bounding_box:r,filter:n,...i})=>{if(r&&n)throw new Error("filter and geo_bounding_box can't be used together");return{type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...i,geo_bounding_box:r&&Object(l.omit)(r,"type"),filter:n&&Object(l.omit)(n,"type")},type:T.a.FILTER}}}});var X=a(6),Z=a.n(X),ee=a(30);const te=c.i18n.translate("data.search.aggs.buckets.filterTitle",{defaultMessage:"Filter"}),ae=({getConfig:e,calculateBounds:t})=>new S.a({name:T.a.FILTER,expressionName:W,title:te,makeLabel:()=>te,params:[{name:"geo_bounding_box",toExpressionAst:F.geoBoundingBoxToAst},{name:"timeShift",type:"string",write:()=>{}},{name:"timeWindow",write:()=>{}},{name:"filter",write(a,s,r){const n=a.params.filter,i=a.params.timeWindow,o=Object(l.cloneDeep)(n);if(!o&&!i)return;if(!r)return;let u;if(o){const t=Object(ee.a)({get:e});if(u=Object(d.buildEsQuery)(a.getIndexPattern(),[o],[],t),!u)return void console.log('malformed filter agg params, missing "query" on input')}const c=r.timeRange?Z()(t(r.timeRange).max):void 0;s.params=i&&c&&a.getIndexPattern().timeFieldName?{bool:{filter:[{range:{[a.getIndexPattern().timeFieldName]:{format:"strict_date_optional_time",gte:c.clone().subtract(Object(q.n)(i)).subtract(a.getTimeShift()).toISOString(),lte:c.clone().subtract(a.getTimeShift()).toISOString()}}},u||void 0].filter(Boolean)}}:u},toExpressionAst:F.queryToAst}]}),se="aggFilters",re=()=>({name:se,help:c.i18n.translate("data.search.aggs.function.buckets.filters.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filters.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.filters.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filters.schema.help",{defaultMessage:"Schema to use for this aggregation"})},filters:{types:["kibana_query_filter"],multi:!0,help:c.i18n.translate("data.search.aggs.buckets.filters.filters.help",{defaultMessage:"Filters to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.filters.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,{id:t,enabled:a,schema:s,filters:r,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,filters:null==r?void 0:r.map((e=>Object(l.omit)(e,"type")))},type:T.a.FILTERS}})}),ne=(e,t)=>{const a=Object(l.get)(e.toDsl(),"filters.filters")[t],s=e.getIndexPattern();if(a&&s&&s.id)return Object(d.buildQueryFilter)(a,s.id,t)},ie=c.i18n.translate("data.search.aggs.buckets.filtersTitle",{defaultMessage:"Filters",description:"The name of an aggregation, that allows to specify multiple individual filters to group data by."}),oe=({getConfig:e})=>new S.a({name:T.a.FILTERS,expressionName:se,title:ie,createFilter:ne,customLabels:!1,params:[{name:"filters",default:()=>[{input:{query:"",language:e(f.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)},label:""}],write(t,a){const s=t.params.filters;if(!Object(l.size)(s))return;const r=Object(l.transform)(s,(function(a,s){const r=Object(l.cloneDeep)(s.input);if(!r)return void console.log('malformed filter agg params, missing "input" query');const n=Object(f.getEsQueryConfig)({get:e}),i=Object(d.buildEsQuery)(t.getIndexPattern(),[r],[],n);if(!i)return void console.log('malformed filter agg params, missing "query" on input');const o=""===s.input.query?"*":"";a[s.label||o||("string"==typeof s.input.query?s.input.query:JSON.stringify(s.input.query))]=i}),{});Object(l.size)(r)&&((a.params||(a.params={})).filters=r)},toExpressionAst:e=>null==e?void 0:e.map(F.queryFilterToAst)}]}),le="aggGeoTile",ue=()=>({name:le,help:c.i18n.translate("data.search.aggs.function.buckets.geoTile.help",{defaultMessage:"Generates a serialized agg config for a Geo Tile agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.geoTile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.geoTile.field.help",{defaultMessage:"Field to use for this aggregation"})},useGeocentroid:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.useGeocentroid.help",{defaultMessage:"Specifies whether to use geocentroid for this aggregation"})},precision:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.precision.help",{defaultMessage:"Precision to use for this aggregation."})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.geoTile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:T.a.GEOTILE_GRID,params:{...n}}}}}),ce=c.i18n.translate("data.search.aggs.buckets.geotileGridTitle",{defaultMessage:"Geotile"}),de=()=>new S.a({name:T.a.GEOTILE_GRID,expressionName:le,title:ce,params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.GEO_POINT},{name:"useGeocentroid",default:!0,write:l.noop},{name:"precision",default:0}],getRequestAggs(e){const t=[],a=e.getParam("useGeocentroid");if(t.push(e),a){const a={type:w.GEO_CENTROID,enabled:!0,params:{field:e.getField()}};t.push(e.aggConfigs.createAggConfig(a,{addToAggConfigs:!1}))}return t}}),ge="aggHistogram",he=()=>({name:ge,help:c.i18n.translate("data.search.aggs.function.buckets.histogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.histogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.histogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.histogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.histogram.field.help",{defaultMessage:"Field to use for this aggregation"})},interval:{types:["number","string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.histogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},intervalBase:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.histogram.intervalBase.help",{defaultMessage:"IntervalBase to use for this aggregation"})},min_doc_count:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.histogram.minDocCount.help",{defaultMessage:"Specifies whether to use min_doc_count for this aggregation"})},maxBars:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.histogram.maxBars.help",{defaultMessage:"Calculate interval to get approximately this many bars"})},autoExtendBounds:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.histogram.autoExtendBounds.help",{defaultMessage:"Set to true to extend bounds to the domain of the data. This makes sure each interval bucket within these bounds will create a separate table row"})},has_extended_bounds:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.histogram.hasExtendedBounds.help",{defaultMessage:"Specifies whether to use has_extended_bounds for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:c.i18n.translate("data.search.aggs.buckets.histogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.histogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.histogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,extended_bounds:r,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,extended_bounds:r&&Object(l.omit)(r,"type")},type:T.a.HISTOGRAM}})}),pe=e=>(t,a)=>{const{deserialize:s}=e(),r=parseInt(a,10),n={gte:r,lt:r+("number"==typeof t.params.used_interval?t.params.used_interval:t.params.interval)};return Object(d.buildRangeFilter)(t.params.field,n,t.getIndexPattern(),s(t.toSerializedFieldFormat()).convert(a))};var fe=a(36);const me=({interval:e,maxBucketsUiSettings:t,maxBucketsUserInput:a,intervalBase:s,values:r,esTypes:n})=>{const i=Object(_.c)(e);let o=i?0:"number"!=typeof e?parseFloat(e):e;if(Number.isNaN(o))return o;if(r){const e=r.max-r.min;e&&(o=i?((e,t,a)=>{const s=e/t;if(e<t&&a.every((e=>[fe.a.INTEGER,fe.a.LONG,fe.a.SHORT,fe.a.BYTE].includes(e))))return 1;const r=Math.pow(10,Math.floor(Math.log10(s))),n=e/r;return n>t?n/2<=t?2*r:n/5<=t?5*r:10*r:r})(e,Math.min(t,a||t),n):((e,t,a)=>e/t>a?(e=>{const t=Math.pow(10,Math.floor(Math.log10(e)));let a=t;for(;a<e;)a+=t;return a})(e/a):t)(e,o,t))}return s&&(o<s?o=s:o%s!=0&&(o=Math.round(o/s)*s)),o||1},be=({getConfig:e,getFieldFormatsStart:t})=>new S.a({name:T.a.HISTOGRAM,expressionName:ge,title:c.i18n.translate("data.search.aggs.buckets.histogramTitle",{defaultMessage:"Histogram"}),ordered:{},makeLabel:e=>e.getFieldDisplayName(),createFilter:pe(t),decorateAggConfig(){let e;return{setAutoBounds:{configurable:!0,value(t){e=t}},getAutoBounds:{configurable:!0,value:()=>e}}},params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.NUMBER_RANGE]},{name:"intervalBase",default:null,write:()=>{}},{name:"autoExtendBounds",default:!1,write:()=>{}},{name:"interval",default:_.a,modifyAggConfigOnSearchRequestStart(e,t,a){const s=e.getField();if("number_range"===(null==s?void 0:s.type))return;const r=s.scripted?{script:{source:s.script,lang:s.lang}}:{field:s.name};return t.createChild().setField("size",0).setField("aggs",{maxAgg:{max:r},minAgg:{min:r}}).fetch(a).then((t=>{var a,s,r,n,i,o;const l=null!==(a=null===(s=t.aggregations)||void 0===s||null===(r=s.minAgg)||void 0===r?void 0:r.value)&&void 0!==a?a:0,u=null!==(n=null===(i=t.aggregations)||void 0===i||null===(o=i.maxAgg)||void 0===o?void 0:o.value)&&void 0!==n?n:0;e.setAutoBounds({min:l,max:u})})).catch((e=>{if("AbortError"!==e.name){if("KQLSyntaxError"===e.name)throw e;throw new Error(c.i18n.translate("data.search.aggs.histogram.missingMaxMinValuesWarning",{defaultMessage:"Unable to retrieve max and min values to auto-scale histogram buckets. This may lead to poor visualization performance."}))}}))},write(t,a){a.params.interval=ye(t,e)}},{name:"used_interval",default:_.a,shouldShow:()=>!1,write:()=>{},serialize(t,a){if(a)return ye(a,e)},toExpressionAst:()=>{}},{name:"maxBars",shouldShow(e){const t=e.getField();return"number_range"!==(null==t?void 0:t.type)&&Object(_.c)(Object(l.get)(e,"params.interval"))},write:()=>{}},{name:"min_doc_count",default:!1,write(e,t){e.params.min_doc_count?t.params.min_doc_count=0:t.params.min_doc_count=1}},{name:"has_extended_bounds",default:!1,write:()=>{}},{name:"extended_bounds",default:{min:"",max:""},write(e,t){const{min:a,max:s}=e.params.extended_bounds;!e.params.has_extended_bounds||!a&&0!==a||!s&&0!==s?e.params.autoExtendBounds&&e.getAutoBounds()&&(t.params.extended_bounds=e.getAutoBounds()):t.params.extended_bounds={min:a,max:s}},shouldShow:e=>e.params.has_extended_bounds,toExpressionAst:F.extendedBoundsToAst}]});function ye(e,t){var a,s;const r=e.getAutoBounds();return me({values:r,interval:e.params.interval,maxBucketsUiSettings:t(f.UI_SETTINGS.HISTOGRAM_MAX_BARS),maxBucketsUserInput:e.params.maxBars,intervalBase:e.params.intervalBase,esTypes:(null===(a=e.params.field)||void 0===a||null===(s=a.spec)||void 0===s?void 0:s.esTypes)||[]})}const ve="aggIpPrefix",_e=()=>({name:ve,help:c.i18n.translate("data.search.aggs.function.buckets.ipPrefix.help",{defaultMessage:"Generates a serialized agg config for a Ip Prefix agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.field.help",{defaultMessage:"Field to use for this aggregation"})},ipPrefix:{types:["ip_prefix"],help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.help",{defaultMessage:"Length of the network prefix and whether it is for IPv4 or IPv6"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipPrefix.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,type:T.a.IP_PREFIX,params:{...r}}})});var Se=a(48),Te=a.n(Se);class cidr_mask_CidrMask{static getNetmask(e,t){return new Array(e).fill(255).map(((e,a)=>{const s=8-Math.min(Math.max(t-8*a,0),8);return e>>s<<s}))}constructor(e){n()(this,"address",void 0),n()(this,"netmask",void 0),n()(this,"prefix",void 0);try{const[t,a]=Te.a.parseCIDR(e);this.address=t.toByteArray(),this.netmask=cidr_mask_CidrMask.getNetmask(this.address.length,a),this.prefix=a}catch{throw Error("Invalid CIDR mask: "+e)}}getBroadcastAddress(){const e=this.address.map(((e,t)=>e|255^this.netmask[t]));return new q.c(e).toString()}getNetworkAddress(){const e=this.address.map(((e,t)=>e&this.netmask[t]));return new q.c(e).toString()}getRange(){return{from:this.getNetworkAddress(),to:this.getBroadcastAddress()}}toString(){return`${new q.c(this.address)}/${this.prefix}`}}const Ee=(e,t)=>{let a=t.address;a.includes(".")&&t.prefix_length>=96&&(a="::ffff:"+t.address);const s=new cidr_mask_CidrMask(a+"/"+t.prefix_length).getRange();return Object(d.buildRangeFilter)(e.params.field,{gte:s.from,lte:s.to},e.getIndexPattern())},Me=c.i18n.translate("data.search.aggs.buckets.ipPrefixTitle",{defaultMessage:"IP Prefix"}),Fe=()=>new S.a({name:T.a.IP_PREFIX,expressionName:ve,title:Me,createFilter:Ee,getKey:(e,t,a)=>({type:"ip_prefix",address:t,prefix_length:e.prefix_length}),getSerializedFormat:e=>({id:"ip_prefix",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>c.i18n.translate("data.search.aggs.buckets.ipPrefixLabel",{defaultMessage:"{fieldName} IP prefixes",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.IP},{name:"ipPrefix",default:{prefixLength:0,isIpv6:!1},write:(e,t)=>{t.params.prefix_length=e.params.ipPrefix.prefixLength,t.params.is_ipv6=e.params.ipPrefix.isIpv6},toExpressionAst:F.ipPrefixToAst}]}),Ae="aggIpRange",Ie=()=>({name:Ae,help:c.i18n.translate("data.search.aggs.function.buckets.ipRange.help",{defaultMessage:"Generates a serialized agg config for a Ip Range agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.ipRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.ipRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ipRangeType:{types:["string"],options:["mask","fromTo"],help:c.i18n.translate("data.search.aggs.buckets.ipRange.ipRangeType.help",{defaultMessage:"IP range type to use for this aggregation. Takes one of the following values: mask, fromTo."})},ranges:{types:["cidr","ip_range"],multi:!0,help:c.i18n.translate("data.search.aggs.buckets.ipRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.ipRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...n})=>{const{ip_range:i,cidr:o}=Object(l.mapValues)(Object(l.groupBy)(r,"type"),(e=>Object(l.map)(e,(e=>Object(l.omit)(e,"type"))))),u=Object(l.omitBy)({fromTo:i,mask:o},l.isNil);return{type:"agg_type",value:{id:t,enabled:a,schema:s,type:T.a.IP_RANGE,params:{...n,ranges:Object(l.isEmpty)(u)?void 0:u}}}}}),Oe=(e,t)=>{let a;return a="mask"===t.type?new cidr_mask_CidrMask(t.mask).getRange():{from:t.from?t.from:-1/0,to:t.to?t.to:1/0},Object(d.buildRangeFilter)(e.params.field,{gte:a.from,lte:a.to},e.getIndexPattern())},we=c.i18n.translate("data.search.aggs.buckets.ipRangeTitle",{defaultMessage:"IP Range"});let ke=function(e){return e.FROM_TO="fromTo",e.MASK="mask",e}({});const Re=()=>new S.a({name:T.a.IP_RANGE,expressionName:Ae,title:we,createFilter:Oe,getKey:(e,t,a)=>a.params.ipRangeType===ke.MASK?{type:"mask",mask:t}:{type:"range",from:e.from,to:e.to},getSerializedFormat:e=>({id:"ip_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>c.i18n.translate("data.search.aggs.buckets.ipRangeLabel",{defaultMessage:"{fieldName} IP ranges",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.IP},{name:"ipRangeType",default:ke.FROM_TO,write:l.noop},{name:"ranges",default:{fromTo:[{from:"0.0.0.0",to:"127.255.255.255"},{from:"128.0.0.0",to:"191.255.255.255"}],mask:[{mask:"0.0.0.0/1"},{mask:"128.0.0.0/2"}]},write(e,t){const a=e.params.ipRangeType;let s=e.params.ranges[a];a===ke.FROM_TO&&(s=Object(l.map)(s,(e=>Object(l.omitBy)(e,l.isNull)))),t.params.ranges=s},toExpressionAst:e=>[...Object(l.map)(null==e?void 0:e[ke.FROM_TO],F.ipRangeToAst),...Object(l.map)(null==e?void 0:e[ke.MASK],F.cidrToAst)]}]});var xe=a(53),Ne=a(54),je=a(47);const Ce=(...e)=>t=>{const a=t.params.field;return e.some((e=>a&&a.type===e))},Pe=Ce("number"),Le=Ce("string"),De=Ce("string","number"),Be={serialize(e,t){if(!this.shouldShow||this.shouldShow(t))return!e||Object(l.isString)(e)||Array.isArray(e)?e:e.pattern},write(e,t){const a=e.getParam(this.name);if(Array.isArray(a)&&a.length>0&&Pe(e)){const e=a.filter((e=>Number.isFinite(e)));e.length&&(t.params[this.name]=e)}else if(Array.isArray(a)&&a.length>0&&Le(e)){const s=a.filter((e=>""!==e));if(s.length){const a=e.getParam(`${this.name}IsRegex`);t.params[this.name]=a?s[0]:s}}else Object(l.isObject)(a)?t.params[this.name]=a.pattern:a&&Le(e)&&(t.params[this.name]=a)}},qe="aggRange",Ge=()=>({name:qe,help:c.i18n.translate("data.search.aggs.function.buckets.range.help",{defaultMessage:"Generates a serialized agg config for a Range agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.range.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.range.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.range.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.range.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["numerical_range"],multi:!0,help:c.i18n.translate("data.search.aggs.buckets.range.ranges.help",{defaultMessage:"Serialized ranges to use for this aggregation."})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.range.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.range.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:r,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,ranges:null==r?void 0:r.map((e=>Object(l.omit)(e,"type")))},type:T.a.RANGE}})}),Ue=Symbol("id");class range_key_RangeKey{findCustomLabel(e,t,a){var s;return null===(s=(a||[]).find((a=>(null==e&&null==a.from||a.from===e)&&(null==t&&null==a.to||a.to===t))))||void 0===s?void 0:s.label}constructor(e,t){n()(this,Ue,void 0),n()(this,"gte",void 0),n()(this,"lt",void 0),n()(this,"label",void 0),this.gte=null==e.from?-1/0:e.from,this.lt=null==e.to?1/0:e.to,this.label=this.findCustomLabel(e.from,e.to,t),this[Ue]=range_key_RangeKey.idBucket(e)}static idBucket(e){return`from:${e.from},to:${e.to}`}toString(){return this[Ue]}}const ze=e=>(t,{label:a,...s})=>{const{deserialize:r}=e();return Object(d.buildRangeFilter)(t.params.field,s,t.getIndexPattern(),r(t.toSerializedFieldFormat()).convert(s))},$e=c.i18n.translate("data.search.aggs.buckets.rangeTitle",{defaultMessage:"Range"}),Ve=({getFieldFormatsStart:e})=>{const t=new WeakMap;return new S.a({name:T.a.RANGE,expressionName:qe,title:$e,createFilter:ze(e),makeLabel:e=>c.i18n.translate("data.search.aggs.aggTypesLabel",{defaultMessage:"{fieldName} ranges",values:{fieldName:e.getFieldDisplayName()}}),getKey(e,a,s){let r=t.get(s);r||(r=new Map,t.set(s,r));const n=range_key_RangeKey.idBucket(e);return(a=r.get(n))||(a=new range_key_RangeKey(e,s.params.ranges),r.set(n,a)),a},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"range",params:{id:t.id,params:t.params}}},params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER]},{name:"ranges",default:[{from:0,to:1e3},{from:1e3,to:2e3}],write(e,t){var a;t.params.ranges=null===(a=e.params.ranges)||void 0===a?void 0:a.map((e=>({to:e.to,from:e.from}))),t.params.keyed=!0},toExpressionAst:e=>null==e?void 0:e.map(F.numericalRangeToAst)}]})},Ke="aggSignificantTerms",He=()=>({name:Ke,help:c.i18n.translate("data.search.aggs.function.buckets.significantTerms.help",{defaultMessage:"Generates a serialized agg config for a Significant Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.significantTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.significantTerms.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.shardSize.help",{defaultMessage:"Number of terms provided by each shard and returned to coordinating node"})},exclude:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:T.a.SIGNIFICANT_TERMS,params:{...n}}}}}),Ye=(e,t,a)=>{const s=e.params.field,r=e.aggConfigs.indexPattern;if("__other__"===t){const e=a.terms,t=Object(d.buildPhrasesFilter)(s,e,r);t.meta.negate=!0;const n=[t];return e.some((e=>"__missing__"===e))&&n.push(Object(d.buildExistsFilter)(s,r)),n}if("__missing__"===t){const e=Object(d.buildExistsFilter)(s,r);return e.meta.negate=!0,e}return Object(d.buildPhraseFilter)(s,t,r)},Qe=c.i18n.translate("data.search.aggs.buckets.significantTermsTitle",{defaultMessage:"Significant Terms"}),We=()=>new S.a({name:T.a.SIGNIFICANT_TERMS,expressionName:Ke,title:Qe,makeLabel:e=>c.i18n.translate("data.search.aggs.buckets.significantTermsLabel",{defaultMessage:"Top {size} unusual terms in {fieldName}",values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:Ye,params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:f.KBN_FIELD_TYPES.STRING},{name:"size",default:""},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"exclude",displayName:c.i18n.translate("data.search.aggs.buckets.significantTerms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:Le,...Be},{name:"include",displayName:c.i18n.translate("data.search.aggs.buckets.significantTerms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:Le,...Be}]}),Je="aggSignificantText",Xe=()=>({name:Je,help:c.i18n.translate("data.search.aggs.function.buckets.significantText.help",{defaultMessage:"Generates a serialized agg config for a Significant Text agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.significantText.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.significantText.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.significantText.size.help",{defaultMessage:"Max number of buckets to retrieve"})},min_doc_count:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.significantText.minDocCount.help",{defaultMessage:"Return terms that match more than a configured number"})},filter_duplicate_text:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.significantText.filterDuplicateText.help",{defaultMessage:"Filtering near-duplicate text"})},exclude:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"})},include:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.include.help",{defaultMessage:"Specific bucket values to include in results"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.significantText.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:T.a.SIGNIFICANT_TEXT,params:{...n}}}}}),Ze=c.i18n.translate("data.search.aggs.buckets.significantTextTitle",{defaultMessage:"Significant Text"}),et=()=>new S.a({name:T.a.SIGNIFICANT_TEXT,expressionName:Je,title:Ze,makeLabel:e=>c.i18n.translate("data.search.aggs.buckets.significantTextLabel",{defaultMessage:'Top {size} unusual terms from "{fieldName}" text',values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:Ye,params:[{name:"field",type:"field",filterField:e=>{var t;return Boolean(e.type===f.KBN_FIELD_TYPES.STRING&&(null===(t=e.esTypes)||void 0===t?void 0:t.includes(f.ES_FIELD_TYPES.TEXT)))}},{name:"size",type:"number"},{name:"min_doc_count",type:"number"},{name:"filter_duplicate_text",type:"boolean"},{name:"exclude",displayName:c.i18n.translate("data.search.aggs.buckets.significantText.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,...Be},{name:"include",displayName:c.i18n.translate("data.search.aggs.buckets.significantText.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,...Be}]}),tt="aggTerms",at=()=>({name:tt,help:c.i18n.translate("data.search.aggs.function.buckets.terms.help",{defaultMessage:"Generates a serialized agg config for a Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.terms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.terms.field.help",{defaultMessage:"Field to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:c.i18n.translate("data.search.aggs.buckets.terms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.buckets.terms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.terms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},missingBucket:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.terms.missingBucket.help",{defaultMessage:"When set to true, groups together any buckets with missing fields"})},missingBucketLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.missingBucketLabel.help",{defaultMessage:"Default label used in charts when documents are missing a field."})},otherBucket:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.terms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},exclude:{types:["string","number"],help:c.i18n.translate("data.search.aggs.buckets.terms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string","number"],help:c.i18n.translate("data.search.aggs.buckets.terms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},includeIsRegex:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.terms.includeIsRegex.help",{defaultMessage:"When set to true, the include property is handled as regex"})},excludeIsRegex:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.terms.excludeIsRegex.help",{defaultMessage:"When set to true, the exclude property is handled as regex"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:T.a.TERMS,params:{...i,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}});var st=a(5);const rt="__missing__",nt="",it=new RegExp(`^${nt}`),ot=(e,t)=>{if(e[t])return e[t];const a=Object(l.values)(e);let s;for(let e=0;e<a.length;e++)if(a[e].aggs&&(s=ot(a[e].aggs,t)))return s},lt=(e,t)=>{const a=[];if(e[t]){const s=e[t].buckets.find((e=>e.key===rt));return s&&a.push(s),a}return Object(l.each)(e,(e=>{e.buckets&&Object(l.each)(e.buckets,(e=>{a.push(...lt(e,t))}))})),a},ut=(e,t)=>{var a;return t.isSamplingEnabled()?null===(a=e.aggregations)||void 0===a?void 0:a.sampling:e.aggregations};function ct(e,t,a){const s=((e,t,a)=>e["other-filter"].filters.filters[t].bool.must_not.filter((e=>e.match_phrase&&null!=e.match_phrase[a.params.field.name])).map((e=>e.match_phrase[a.params.field.name])))(e,t,a),r=Object(d.buildPhrasesFilter)(a.params.field,s,a.aggConfigs.indexPattern);return r.meta.negate=!0,r}function dt(e,t){return{query:e["other-filter"].filters.filters[t],meta:{}}}const gt=e=>async(t,a,s,r,n,i,o,u)=>{if(!t.aggregations)return t;const g=r.createChild();if(s.params.otherBucket){const r=((e,t,a)=>{const s=e.aggs.filter((e=>e.type.type===h.Buckets&&e.enabled)),r=s.findIndex((e=>e.id===t.id)),n=e.toDsl(),i=t.aggConfigs.indexPattern,o=e.createAggConfig({type:"filters",id:"other",params:{filters:[]},enabled:!1},{addToAggConfigs:!1}),u={aggs:ot(n,t.id).aggs,filters:o.toDsl()};let c=!1,g=!0;const p=(e,a,n,o,h)=>{var f;const m=a[n];if(!m||(Array.isArray(m.buckets)?!m.buckets.length:!Object.values(m.buckets).length))return void(c=!0);const b=e+1,y=s[b],v=s[e];if(e===r&&m&&m.sum_other_doc_count>0&&(g=!1),e<r)return void Object(l.each)(null==m?void 0:m.buckets,((e,t)=>{const a=v.getKey(e,Object(l.isNumber)(t)?void 0:t),s=Object(l.cloneDeep)(e.filters)||v.createFilter(a),r=Object(l.flatten)([...o,s]);p(b,e,y.id,r,`${h}${nt}${a.toString()}`)}));const _=!(null===(f=t.params.field)||void 0===f||!f.scripted),S=!!t.params.missingBucket,T=m.buckets.some((e=>e.key===rt));!t.params.field||_||S&&!T||o.push(Object(d.buildExistsFilter)(t.params.field,t.aggConfigs.indexPattern)),Object(l.each)(m.buckets,(e=>{if(e.key===rt)return;const t=v.createFilter(v.getKey(e,e.key));t.meta.negate=!0,o.push(t)})),u.filters.filters[h]={bool:Object(d.buildQueryFromFilters)(o,i)}};return p(0,ut(a,e),s[0].id,[],""),!c&&!g&&(()=>e.isSamplingEnabled()?{sampling:{...m(e.samplerConfig),aggs:{"other-filter":u}}}:{"other-filter":u})})(a,s,t);if(!r)return t;g.setField("aggs",r);const{rawResponse:p}=await Object(st.lastValueFrom)(g.fetch$({abortSignal:i,sessionId:o,disableWarningToasts:u,inspector:{adapter:n,title:c.i18n.translate("data.search.aggs.buckets.terms.otherBucketTitle",{defaultMessage:"Other bucket"}),description:c.i18n.translate("data.search.aggs.buckets.terms.otherBucketDescription",{defaultMessage:"This request counts the number of documents that fall outside the criterion of the data buckets."})}}));t=((e,t,a,s,r,n)=>{const i=Object(l.cloneDeep)(t),o=ut(a,e),u=ut(i,e),c="buckets"in o["other-filter"]?o["other-filter"].buckets:{};return Object(l.each)(c,((t,a)=>{if(!t.doc_count||void 0===a)return;const i=a.replace(it,""),o=((e,t,a,s)=>{var r;const n=s.split(nt);let i=t;for(const t in n)if(null!=n[t]){const s=Object(l.values)(i);for(let r=0;r<s.length;r++){const u=s[r],c=Object(l.keys)(i)[r],d=Object(l.find)(e.aggs,(e=>e.id===c));if(d){const e=Object(l.find)(u.buckets,((e,a)=>d.getKey(e,Object(l.isNumber)(a)?void 0:a).toString()===n[t]));var o;if(e&&(null===(o=i)||void 0===o||!o[a.id]||""!==n[t])){i=e;break}}}}return null!==(r=i)&&void 0!==r&&r[a.id]?i[a.id].buckets:[]})(e,u,s,i),c=n(((e,t)=>t.isSamplingEnabled()?e.sampling.aggs:e)(r,e),a,s);t.filters=[c],t.key="__other__",o.some((e=>e.key===rt))&&t.filters.push(Object(d.buildExistsFilter)(s.params.field,s.aggConfigs.indexPattern)),o.push(t)})),i})(a,t,p,s,r(),e)}return s.params.missingBucket&&(t=((e,t,a)=>{const s=Object(l.cloneDeep)(e);return lt(ut(s,t),a.id).forEach((e=>{e.key=rt})),s})(t,a,s)),t},ht=["!top_hits","!percentiles","!percentile_ranks","!filtered_metric","!percentile","!percentile_rank","!geo_bounds","!geo_centroid","!std_dev","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!avg_bucket","!max_bucket","!min_bucket","!sum_bucket"],pt={name:"orderAgg",type:"agg",allowedAggs:ht,default:null,makeAgg(e,t={type:"count"}){t.schema="orderAgg";const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-orderAgg",a},write(e,t,a){const s=e.params.order.value,r=t.params.order={};let n=e.params.orderAgg||a.getResponseAggById(e.params.orderBy);if(t.params.script&&(t.params.value_type="number"===e.getField().type?"float":e.getField().type),e.params.missingBucket&&"string"===e.params.field.type&&(t.params.missing="__missing__"),!n)return void(r[e.params.orderBy||"_count"]=s);if(null!=a&&a.hasTimeShifts()&&Object.keys(null==a?void 0:a.getTimeShifts()).length>1&&a.timeRange){const e=n.getTimeShift(),t=a.getResolvedTimeRange();n=a.createAggConfig({type:"filtered_metric",id:n.id,params:{customBucket:a.createAggConfig({type:"filter",id:"shift",params:{filter:{language:"lucene",query:{range:{[a.timeFields[0]]:{gte:o.a.tz(null==t?void 0:t.min,a.timeZone).subtract(e||0).toISOString(),lte:o.a.tz(null==t?void 0:t.max,a.timeZone).subtract(e||0).toISOString()}}}}}},{addToAggConfigs:!1}).serialize(),customMetric:n.serialize()},enabled:!1},{addToAggConfigs:!1})}if("count"===n.type.name)return void(r._count=s);const i=n.getValueBucketPath();n.parentId&&a&&(n=a.byId(n.parentId)),t.subAggs=(t.subAggs||[]).concat(n),r[i]=s}},ft=c.i18n.translate("data.search.aggs.buckets.termsTitle",{defaultMessage:"Terms"}),mt=()=>new S.a({name:T.a.TERMS,expressionName:tt,title:ft,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"terms",params:{id:t.id,...t.params?{params:t.params}:{},otherBucketLabel:e.params.otherBucketLabel,missingBucketLabel:e.params.missingBucketLabel}}},createFilter:Ye,postFlightRequest:gt(ct),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.BOOLEAN,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.IP,f.KBN_FIELD_TYPES.STRING]},{name:"orderBy",write:l.noop},pt,{name:"order",type:"optioned",default:"desc",options:[{text:c.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:c.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:l.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{e.params.shardSize?t.params.shard_size=e.params.shardSize:e.params.size<=10&&(t.params.shard_size=25)}},{name:"otherBucket",default:!1,write:l.noop},{name:"otherBucketLabel",type:"string",default:c.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:c.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:l.noop},{name:"missingBucket",default:!1,write:l.noop},{name:"missingBucketLabel",default:c.i18n.translate("data.search.aggs.buckets.terms.missingBucketLabel",{defaultMessage:"Missing",description:'Default label used in charts when documents are missing a field.\n          Visible when you create a chart with a terms aggregation and enable "Show missing values"'}),type:"string",displayName:c.i18n.translate("data.search.aggs.otherBucket.labelForMissingValuesLabel",{defaultMessage:"Label for missing values"}),shouldShow:e=>e.getParam("missingBucket"),write:l.noop},{name:"exclude",displayName:c.i18n.translate("data.search.aggs.buckets.terms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:De,...Be},{name:"include",displayName:c.i18n.translate("data.search.aggs.buckets.terms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:De,...Be},{name:"includeIsRegex",default:!0,write:l.noop},{name:"excludeIsRegex",default:!0,write:l.noop}]}),bt=Symbol("id");function yt(e){if(!(e=>Boolean(e&&"object"==typeof e&&"key"in e))(e))throw new Error("bucket malformed - no key found");return Array.isArray(e.key)?e.key.map((e=>String(e))):[String(e.key)]}class multi_field_key_MultiFieldKey{constructor(e){n()(this,bt,void 0),n()(this,"keys",void 0),this.keys=yt(e),this[bt]=multi_field_key_MultiFieldKey.idBucket(e)}static idBucket(e){return yt(e).join(",")}toString(){return this[bt]}}function vt(e){return e instanceof multi_field_key_MultiFieldKey}const _t="  ",St="aggMultiTerms",Tt=()=>({name:St,help:c.i18n.translate("data.search.aggs.function.buckets.multiTerms.help",{defaultMessage:"Generates a serialized agg config for a Multi-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.multiTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},fields:{types:["string"],multi:!0,required:!0,help:c.i18n.translate("data.search.aggs.buckets.multiTerms.fields.help",{defaultMessage:"Fields to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},otherBucket:{types:["boolean"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},separatorLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.separatorLabel.help",{defaultMessage:"The separator label used to join each term combination"})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:T.a.MULTI_TERMS,params:{...i,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}}),Et=(e,t,a)=>{const s=e.params.fields,r=e.aggConfigs.indexPattern;if("__other__"===String(t)){const e=a.terms,t=e.map((e=>e.keys.map(((e,t)=>Object(d.buildPhraseFilter)(r.getFieldByName(s[t]),e,r).query))));return{meta:{negate:!0,alias:e.map((e=>e.keys.join(", "))).join(` ${c.i18n.translate("data.search.aggs.buckets.multiTerms.otherFilterJoinName",{defaultMessage:"or"})} `),index:r.id},query:{bool:{should:t.map((e=>({bool:{must:e}}))),minimum_should_match:1}}}}const n=t.keys.map(((e,t)=>Object(d.buildPhraseFilter)(r.getFieldByName(s[t]),e,r)));return{meta:{alias:t.keys.join(", "),index:r.id},query:{bool:{must:n.map((e=>e.query))}}}},Mt=c.i18n.translate("data.search.aggs.buckets.multiTermsTitle",{defaultMessage:"Multi-Terms"}),Ft=()=>{const e=new WeakMap;return new S.a({name:T.a.MULTI_TERMS,expressionName:St,title:Mt,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getKey(t,a,s){let r=e.get(s);r||(r=new Map,e.set(s,r));const n=multi_field_key_MultiFieldKey.idBucket(t);return(a=r.get(n))||(a=new multi_field_key_MultiFieldKey(t),r.set(n,a)),a},getSerializedFormat(e){const t=e.params,a=t.fields?t.fields.map((t=>{const a=e.aggConfigs.indexPattern.getFieldByName(t);return a?e.aggConfigs.indexPattern.getFormatterForField(a).toJSON():{id:void 0,params:void 0}})):[{id:void 0,params:void 0}];return{id:"multi_terms",params:{otherBucketLabel:t.otherBucketLabel,paramsPerField:a,separator:e.params.separatorLabel}}},createFilter:Et,postFlightRequest:gt(dt),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"fields",write(e,t,a){const s=e.params;t.params.terms=s.fields.map((e=>({field:e})))}},{name:"orderBy",write:l.noop},pt,{name:"order",type:"optioned",default:"desc",options:[{text:c.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:c.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:l.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"otherBucket",default:!1,write:l.noop},{name:"otherBucketLabel",type:"string",default:c.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:c.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:l.noop},{name:"separatorLabel",type:"string",write:l.noop}]})},At="aggRareTerms",It=()=>({name:At,help:c.i18n.translate("data.search.aggs.function.buckets.rareTerms.help",{defaultMessage:"Generates a serialized agg config for a Rare-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.rareTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.rareTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.rareTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.buckets.rareTerms.fields.help",{defaultMessage:"Field to use for this aggregation"})},max_doc_count:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.rareTerms.maxDocCount.help",{defaultMessage:"Maximum number of times a term is allowed to occur to qualify as rare"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:T.a.RARE_TERMS,params:{...n}}}}}),Ot=c.i18n.translate("data.search.aggs.buckets.rareTermsTitle",{defaultMessage:"Rare terms"}),wt=()=>new S.a({name:T.a.RARE_TERMS,expressionName:At,title:Ot,makeLabel:e=>c.i18n.translate("data.search.aggs.rareTerms.aggTypesLabel",{defaultMessage:"Rare terms of {fieldName}",values:{fieldName:e.getFieldDisplayName()}}),createFilter:Ye,params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.BOOLEAN,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.IP,f.KBN_FIELD_TYPES.STRING]},{name:"max_doc_count",default:1}]}),kt="sampler",Rt=c.i18n.translate("data.search.aggs.buckets.samplerTitle",{defaultMessage:"Sampler",description:"Sampler aggregation title"}),xt=()=>new S.a({name:kt,title:Rt,customLabels:!1,expressionName:Nt,params:[{name:"shard_size",type:"number"}]}),Nt="aggSampler",jt=()=>({name:Nt,help:c.i18n.translate("data.search.aggs.function.buckets.sampler.help",{defaultMessage:"Generates a serialized agg config for a Sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.sampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.sampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.sampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.sampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:kt,params:{...n}}}}}),Ct="diversified_sampler",Pt=c.i18n.translate("data.search.aggs.buckets.diversifiedSamplerTitle",{defaultMessage:"Diversified sampler",description:"Diversified sampler aggregation title"}),Lt=()=>new S.a({name:Ct,title:Pt,customLabels:!1,expressionName:Dt,params:[{name:"shard_size",type:"number"},{name:"max_docs_per_value",type:"number"},{name:"field",type:"field"}]}),Dt="aggDiversifiedSampler",Bt=()=>({name:Dt,help:c.i18n.translate("data.search.aggs.function.buckets.diversifiedSampler.help",{defaultMessage:"Generates a serialized agg config for a Diversified sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})},max_docs_per_value:{types:["number"],help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.maxDocsPerValue.help",{defaultMessage:"Limits how many documents are permitted per choice of de-duplicating value."})},field:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.diversifiedSampler.field.help",{defaultMessage:"Used to provide values used for de-duplication."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:Ct,params:{...n}}}}}),qt="aggTimeSeries",Gt=()=>({name:qt,help:c.i18n.translate("data.search.aggs.function.buckets.timeSeries.help",{defaultMessage:"Generates a serialized agg config for a Time Series agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.timeSeries.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.buckets.timeSeries.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.timeSeries.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:T.a.TIME_SERIES,params:{...n}}}}}),Ut=c.i18n.translate("data.search.aggs.buckets.timeSeriesTitle",{defaultMessage:"Time Series"}),zt=()=>new S.a({name:T.a.TIME_SERIES,expressionName:qt,title:Ut,params:[]});var $t=a(38);const Vt="aggAvg",Kt=()=>({name:Vt,help:c.i18n.translate("data.search.aggs.function.metrics.avg.help",{defaultMessage:"Generates a serialized agg config for a Avg agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.avg.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.AVG,params:{...n}}}}}),Ht=c.i18n.translate("data.search.aggs.metrics.averageTitle",{defaultMessage:"Average"}),Yt=()=>new metric_agg_type_MetricAggType({name:w.AVG,expressionName:Vt,title:Ht,getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.averageLabel",{defaultMessage:"Average {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.HISTOGRAM]}]}),Qt="aggBucketAvg",Wt=()=>({name:Qt,help:c.i18n.translate("data.search.aggs.function.metrics.bucket_avg.help",{defaultMessage:"Generates a serialized agg config for a Avg Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:n,schema:i,...o}=t;return{type:"agg_type",value:{id:r,enabled:n,schema:i,type:w.AVG_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Jt=(e,t)=>{const a=Object(l.startCase)(t),s=e.getParam("customMetric"),r=e.getParam("metricAgg");if(s){let e=s.makeLabel();return e.includes(`${a} of `)?(e=e.substring(`${a} of `.length),e=`2. ${t} of ${e}`):e=e.includes(`${t} of `)?parseInt(e.substring(0,1),10)+1+e.substring(1):`${a} of ${e}`,e}const n=e.aggConfigs.byId(r);return n?`${a} of ${n.makeLabel()}`:""},Xt=e=>(t,a,s)=>{if(!t||!t.params)return;const r=t.getParam(e);r&&r.type&&r.type.params&&r.type.params.forEach((e=>{e.modifyAggConfigOnSearchRequestStart&&e.modifyAggConfigOnSearchRequestStart(r,a,s)}))},Zt=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!sum_bucket","!avg_bucket","!min_bucket","!max_bucket","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],ea=["!filter","!sampler","!diversified_sampler","!multi_terms"],ta=c.i18n.translate("data.search.aggs.metrics.siblingPipelineAggregationsSubtypeTitle",{defaultMessage:"Sibling pipeline aggregations"}),aa={subtype:ta,params:(e=ea)=>[{name:"customBucket",type:"agg",allowedAggs:e,default:null,makeAgg(e,t={type:"date_histogram"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-bucket",a},modifyAggConfigOnSearchRequestStart:Xt("customBucket"),write:()=>{}},{name:"customMetric",type:"agg",allowedAggs:Zt,default:null,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:Xt("customMetric"),write:(e,t)=>((e,t)=>{const a=e.getParam("customMetric"),s=e.getParam("customBucket");if(a){if(a.type.name!==w.COUNT){if(s.subAggs=(t.subAggs||[]).concat(a),t.params.buckets_path=`${s.id}>${a.id}`,a.type.subtype===f.siblingPipelineType){const e=a.getParam("customBucket");e&&s.subAggs.push(e)}}else t.params.buckets_path=s.id+">_count";t.parentAggs=(t.parentAggs||[]).concat(s)}})(e,t)}],getSerializedFormat(e){const t=e.getParam("customMetric");return t?t.type.getSerializedFormat(t):{}}},sa=c.i18n.translate("data.search.aggs.metrics.overallAverageLabel",{defaultMessage:"overall average"}),ra=c.i18n.translate("data.search.aggs.metrics.averageBucketTitle",{defaultMessage:"Average Bucket"}),na=()=>{const{subtype:e,params:t,getSerializedFormat:a}=aa;return new metric_agg_type_MetricAggType({name:w.AVG_BUCKET,expressionName:Qt,title:ra,makeLabel:e=>Jt(e,sa),subtype:e,params:[...t()],getSerializedFormat:a,getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket"),r=a.type&&a.type.isScalable();let n=t[e.id]&&t[e.id].value;if(r&&"date_histogram"===s.type.name){const e=s.write();n*=Object(l.get)(e,"bucketInterval.scale",1)}return n}})},ia="aggBucketMax",oa=()=>({name:ia,help:c.i18n.translate("data.search.aggs.function.metrics.bucket_max.help",{defaultMessage:"Generates a serialized agg config for a Max Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.bucket_max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:n,schema:i,...o}=t;return{type:"agg_type",value:{id:r,enabled:n,schema:i,type:w.MAX_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),la=c.i18n.translate("data.search.aggs.metrics.overallMaxLabel",{defaultMessage:"overall max"}),ua=c.i18n.translate("data.search.aggs.metrics.maxBucketTitle",{defaultMessage:"Max Bucket"}),ca=()=>{const{subtype:e,params:t,getSerializedFormat:a}=aa;return new metric_agg_type_MetricAggType({name:w.MAX_BUCKET,expressionName:ia,title:ua,makeLabel:e=>Jt(e,la),subtype:e,params:[...t()],getSerializedFormat:a})},da="aggBucketMin",ga=()=>({name:da,help:c.i18n.translate("data.search.aggs.function.metrics.bucket_min.help",{defaultMessage:"Generates a serialized agg config for a Min Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.bucket_min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:n,schema:i,...o}=t;return{type:"agg_type",value:{id:r,enabled:n,schema:i,type:w.MIN_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ha=c.i18n.translate("data.search.aggs.metrics.overallMinLabel",{defaultMessage:"overall min"}),pa=c.i18n.translate("data.search.aggs.metrics.minBucketTitle",{defaultMessage:"Min Bucket"}),fa=()=>{const{subtype:e,params:t,getSerializedFormat:a}=aa;return new metric_agg_type_MetricAggType({name:w.MIN_BUCKET,expressionName:da,title:pa,makeLabel:e=>Jt(e,ha),subtype:e,params:[...t()],getSerializedFormat:a})},ma="aggBucketSum",ba=()=>({name:ma,help:c.i18n.translate("data.search.aggs.function.metrics.bucket_sum.help",{defaultMessage:"Generates a serialized agg config for a Sum Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.bucket_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:n,schema:i,...o}=t;return{type:"agg_type",value:{id:r,enabled:n,schema:i,type:w.SUM_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ya=c.i18n.translate("data.search.aggs.metrics.overallSumLabel",{defaultMessage:"overall sum"}),va=c.i18n.translate("data.search.aggs.metrics.sumBucketTitle",{defaultMessage:"Sum Bucket"}),_a=()=>{const{subtype:e,params:t,getSerializedFormat:a}=aa;return new metric_agg_type_MetricAggType({name:w.SUM_BUCKET,expressionName:ma,title:va,makeLabel:e=>Jt(e,ya),subtype:e,params:[...t()],getSerializedFormat:a})},Sa="aggFilteredMetric",Ta=()=>({name:Sa,help:c.i18n.translate("data.search.aggs.function.metrics.filtered_metric.help",{defaultMessage:"Generates a serialized agg config for a filtered metric agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations. Has to be a filter aggregation"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.filtered_metric.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:r,enabled:n,schema:i,...o}=t;return{type:"agg_type",value:{id:r,enabled:n,schema:i,type:w.FILTERED_METRIC,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Ea=c.i18n.translate("data.search.aggs.metrics.filteredMetricLabel",{defaultMessage:"filtered"}),Ma=c.i18n.translate("data.search.aggs.metrics.filteredMetricTitle",{defaultMessage:"Filtered metric"}),Fa=({getConfig:e})=>{const{subtype:t,params:a,getSerializedFormat:s}=aa;return new metric_agg_type_MetricAggType({name:w.FILTERED_METRIC,expressionName:Sa,title:Ma,makeLabel:e=>Jt(e,Ea),subtype:t,params:[...a(["filter"])],hasNoDslParams:!0,getSerializedFormat:s,createFilter:(t,a)=>{const s=t.getIndexPattern();if("top_hits"===t.params.customMetric.type.name||"top_metrics"===t.params.customMetric.type.name)return t.params.customMetric.createFilter(a);if(!t.params.customBucket.params.filter)return;const r=Object(f.getEsQueryConfig)({get:e});return Object(d.buildQueryFilter)(Object(d.buildEsQuery)(s,[t.params.customBucket.params.filter],[],r),s.id,t.params.customBucket.params.filter.query)},getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket");return t&&t[s.id]&&a.getValue(t[s.id])},getValueType(e){var t,a,s;const r=e.getParam("customMetric");return(null===(t=(a=r.type).getValueType)||void 0===t?void 0:t.call(a,r))||(null===(s=r.params.field)||void 0===s?void 0:s.type)||"number"},getValueBucketPath(e){const t=e.getParam("customBucket"),a=e.getParam("customMetric");return"count"===a.type.name?t.getValueBucketPath():`${t.getValueBucketPath()}>${a.getValueBucketPath()}`},getResponseId:e=>e.params.customBucket.id})},Aa="aggCardinality",Ia=()=>({name:Aa,help:c.i18n.translate("data.search.aggs.function.metrics.cardinality.help",{defaultMessage:"Generates a serialized agg config for a Cardinality agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cardinality.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.cardinality.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cardinality.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.cardinality.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cardinality.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cardinality.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:c.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.CARDINALITY,params:{...n}}}}}),Oa=c.i18n.translate("data.search.aggs.metrics.uniqueCountTitle",{defaultMessage:"Unique Count"}),wa=()=>new metric_agg_type_MetricAggType({name:w.CARDINALITY,getValueType:()=>"number",expressionName:Aa,title:Oa,enableEmptyAsNull:!0,makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.uniqueCountLabel",{defaultMessage:"Unique count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field",filterFieldTypes:Object.values(f.KBN_FIELD_TYPES).filter((e=>e!==f.KBN_FIELD_TYPES.HISTOGRAM))}]}),ka="aggValueCount",Ra=()=>({name:ka,help:c.i18n.translate("data.search.aggs.function.metrics.valueCount.help",{defaultMessage:"Generates a serialized agg config for a value count agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.value_count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.value_count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.value_count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.value_count.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.value_count.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.value_count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:c.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.VALUE_COUNT,params:{...n}}}}}),xa=c.i18n.translate("data.search.aggs.metrics.valueCountTitle",{defaultMessage:"Value Count"}),Na=()=>new metric_agg_type_MetricAggType({name:w.VALUE_COUNT,getValueType:()=>"number",expressionName:ka,title:xa,enableEmptyAsNull:!0,makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.valueCountLabel",{defaultMessage:"Value count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field"}]}),ja="aggCount",Ca=()=>({name:ja,help:c.i18n.translate("data.search.aggs.function.metrics.count.help",{defaultMessage:"Generates a serialized agg config for a Count agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:c.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.COUNT,params:n}}}}),Pa=()=>new metric_agg_type_MetricAggType({name:w.COUNT,expressionName:ja,title:c.i18n.translate("data.search.aggs.metrics.countTitle",{defaultMessage:"Count"}),hasNoDsl:!0,json:!1,enableEmptyAsNull:!0,makeLabel:()=>c.i18n.translate("data.search.aggs.metrics.countLabel",{defaultMessage:"Count"}),getSerializedFormat:e=>({id:"number"}),getValue(e,t){const a=e.getTimeShift();let s;return s=a?t[`doc_count_${a.asMilliseconds()}`]:t.doc_count,0===s&&e.params.emptyAsNull?null:s},isScalable:()=>!0}),La="aggCumulativeSum",Da=()=>({name:La,help:c.i18n.translate("data.search.aggs.function.metrics.cumulative_sum.help",{defaultMessage:"Generates a serialized agg config for a Cumulative Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.cumulative_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:w.CUMULATIVE_SUM,params:{...i,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Ba=(e,t,a)=>{const s=e.getParam("customMetric"),r=e.getParam("metricAgg"),n=s||a&&a.getResponseAggById(r);s&&"count"!==s.type.name&&(t.parentAggs=(t.parentAggs||[]).concat(n)),t.params={buckets_path:"count"===n.type.name?"_count":n.id}},qa=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],Ga=c.i18n.translate("data.search.aggs.metrics.parentPipelineAggregationsSubtypeTitle",{defaultMessage:"Parent Pipeline Aggregations"}),Ua={subtype:Ga,params:()=>[{name:"metricAgg",default:"custom",write:Ba},{name:"customMetric",type:"agg",allowedAggs:qa,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:Xt("customMetric"),write:l.noop},{name:"buckets_path",write:l.noop}],getSerializedFormat(e){let t;return t=e.getParam("customMetric")||e.aggConfigs.byId(e.getParam("metricAgg")),t?t.type.getSerializedFormat(t):{}}},za=c.i18n.translate("data.search.aggs.metrics.cumulativeSumLabel",{defaultMessage:"cumulative sum"}),$a=c.i18n.translate("data.search.aggs.metrics.cumulativeSumTitle",{defaultMessage:"Cumulative Sum"}),Va=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ua;return new metric_agg_type_MetricAggType({name:w.CUMULATIVE_SUM,expressionName:La,title:$a,makeLabel:e=>Jt(e,za),subtype:e,params:[...t()],getSerializedFormat:a})},Ka="aggDerivative",Ha=()=>({name:Ka,help:c.i18n.translate("data.search.aggs.function.metrics.derivative.help",{defaultMessage:"Generates a serialized agg config for a Derivative agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.derivative.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.derivative.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:w.DERIVATIVE,params:{...i,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Ya=c.i18n.translate("data.search.aggs.metrics.derivativeLabel",{defaultMessage:"derivative"}),Qa=c.i18n.translate("data.search.aggs.metrics.derivativeTitle",{defaultMessage:"Derivative"}),Wa=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ua;return new metric_agg_type_MetricAggType({name:w.DERIVATIVE,expressionName:Ka,title:Qa,makeLabel:e=>Jt(e,Ya),subtype:e,params:[...t()],getSerializedFormat:a})},Ja="aggGeoBounds",Xa=()=>({name:Ja,help:c.i18n.translate("data.search.aggs.function.metrics.geo_bounds.help",{defaultMessage:"Generates a serialized agg config for a Geo Bounds agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_bounds.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.GEO_BOUNDS,params:{...n}}}}}),Za=c.i18n.translate("data.search.aggs.metrics.geoBoundsTitle",{defaultMessage:"Geo Bounds"}),es=c.i18n.translate("data.search.aggs.metrics.geoBoundsLabel",{defaultMessage:"Geo Bounds"}),ts=()=>new metric_agg_type_MetricAggType({name:w.GEO_BOUNDS,expressionName:Ja,title:Za,makeLabel:()=>es,params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.GEO_POINT}]}),as="aggGeoCentroid",ss=()=>({name:as,help:c.i18n.translate("data.search.aggs.function.metrics.geo_centroid.help",{defaultMessage:"Generates a serialized agg config for a Geo Centroid agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.geo_centroid.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.GEO_CENTROID,params:{...n}}}}}),rs=c.i18n.translate("data.search.aggs.metrics.geoCentroidTitle",{defaultMessage:"Geo Centroid"}),ns=c.i18n.translate("data.search.aggs.metrics.geoCentroidLabel",{defaultMessage:"Geo Centroid"}),is=()=>new metric_agg_type_MetricAggType({name:w.GEO_CENTROID,expressionName:as,title:rs,makeLabel:()=>ns,params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.GEO_POINT}],getValue:(e,t)=>t[e.id]&&t[e.id].location}),os="aggMax",ls=()=>({name:os,help:c.i18n.translate("data.search.aggs.function.metrics.max.help",{defaultMessage:"Generates a serialized agg config for a Max agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.max.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MAX,params:{...n}}}}}),us=c.i18n.translate("data.search.aggs.metrics.maxTitle",{defaultMessage:"Max"}),cs=()=>new metric_agg_type_MetricAggType({name:w.MAX,expressionName:os,title:us,makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.maxLabel",{defaultMessage:"Max {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.HISTOGRAM]}]}),ds="aggMedian",gs=()=>({name:ds,help:c.i18n.translate("data.search.aggs.function.metrics.median.help",{defaultMessage:"Generates a serialized agg config for a Median agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.median.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.median.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.median.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.median.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.median.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.median.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MEDIAN,params:{...n}}}}}),hs=c.i18n.translate("data.search.aggs.metrics.medianTitle",{defaultMessage:"Median"}),ps=()=>new metric_agg_type_MetricAggType({name:w.MEDIAN,expressionName:ds,dslName:"percentiles",title:hs,getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.medianLabel",{defaultMessage:"Median {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.50`,params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[50],shouldShow:()=>!1,serialize:()=>{}}],getValue(e,t){var a;return null===(a=t[e.id])||void 0===a?void 0:a.values["50.0"]}}),fs="aggSinglePercentile",ms=()=>({name:fs,help:c.i18n.translate("data.search.aggs.function.metrics.singlePercentile.help",{defaultMessage:"Generates a serialized agg config for a single percentile agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.field.help",{defaultMessage:"Field to use for this aggregation"})},percentile:{types:["number"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.percentile.help",{defaultMessage:"Percentile to fetch"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SINGLE_PERCENTILE,params:{...n}}}}}),bs=c.i18n.translate("data.search.aggs.metrics.singlePercentileTitle",{defaultMessage:"Percentile"}),ys=()=>new metric_agg_type_MetricAggType({name:w.SINGLE_PERCENTILE,expressionName:fs,dslName:"percentiles",title:bs,getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.singlePercentileLabel",{defaultMessage:"Percentile {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.percentile}`,params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percentile",default:95,write:(e,t)=>{t.params.percents=[e.params.percentile]}}],getValue(e,t){var a;let s=String(e.params.percentile);Number.isInteger(e.params.percentile)&&(s+=".0");const{values:r}=null!==(a=t[e.id])&&void 0!==a?a:{};return r?r[s]:NaN}}),vs="aggMin",_s=()=>({name:vs,help:c.i18n.translate("data.search.aggs.function.metrics.min.help",{defaultMessage:"Generates a serialized agg config for a Min agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.min.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.MIN,params:{...n}}}}}),Ss=c.i18n.translate("data.search.aggs.metrics.minTitle",{defaultMessage:"Min"}),Ts=()=>new metric_agg_type_MetricAggType({name:w.MIN,expressionName:vs,title:Ss,makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.minLabel",{defaultMessage:"Min {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.HISTOGRAM]}]}),Es="aggMovingAvg",Ms=()=>({name:Es,help:c.i18n.translate("data.search.aggs.function.metrics.moving_avg.help",{defaultMessage:"Generates a serialized agg config for a Moving Average agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.moving_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},window:{types:["number"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.window.help",{defaultMessage:'The size of window to "slide" across the histogram.'})},buckets_path:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},script:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.script.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.moving_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:w.MOVING_FN,params:{...i,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Fs=c.i18n.translate("data.search.aggs.metrics.movingAvgTitle",{defaultMessage:"Moving Avg"}),As=c.i18n.translate("data.search.aggs.metrics.movingAvgLabel",{defaultMessage:"moving avg"}),Is=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ua;return new metric_agg_type_MetricAggType({name:w.MOVING_FN,expressionName:Es,dslName:"moving_fn",title:Fs,makeLabel:e=>Jt(e,As),subtype:e,getSerializedFormat:a,params:[...t(),{name:"window",default:5},{name:"script",default:"MovingFunctions.unweightedAvg(values)"}],getValue:(e,t)=>t[e.id]?t[e.id].value:null})},Os="aggPercentileRanks",ws=()=>({name:Os,help:c.i18n.translate("data.search.aggs.function.metrics.percentile_ranks.help",{defaultMessage:"Generates a serialized agg config for a Percentile Ranks agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.field.help",{defaultMessage:"Field to use for this aggregation"})},values:{types:["number"],multi:!0,help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.values.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentile_ranks.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.PERCENTILE_RANKS,params:{...n}}}}}),ks=(e,t)=>e.$$_ResponseAggConfigClass?e.$$_ResponseAggConfigClass:e.$$_ResponseAggConfigClass=Rs(e,t),Rs=(e,t)=>{function a(t){const a=e.id;let s;const r=String(t);s=r.indexOf(".")>-1?a+"['"+r.replace(/'/g,"\\'")+"']":a+"."+r,this.id=s,this.key=t,this.parentId=a}return a.prototype=Object.create(e),a.prototype.constructor=a,Object(l.assignIn)(a.prototype,t),a},xs=(e,t)=>{var a;const{values:s}=null!==(a=t[e.parentId])&&void 0!==a?a:{},r=Object(l.find)(s,(({key:t})=>t===e.key));return r?r.value:NaN},Ns=e=>({makeLabel(){const{getDefaultInstance:t}=e(),a=this.getField(),s=a&&a.format||t(f.KBN_FIELD_TYPES.NUMBER),r=this.getParam("customLabel")||this.getFieldDisplayName();return c.i18n.translate("data.search.aggs.metrics.percentileRanks.valuePropsLabel",{defaultMessage:'Percentile rank {format} of "{label}"',values:{format:s.convert(this.key,"text"),label:r}})}}),js=({getFieldFormatsStart:e})=>new metric_agg_type_MetricAggType({name:w.PERCENTILE_RANKS,expressionName:Os,title:c.i18n.translate("data.search.aggs.metrics.percentileRanksTitle",{defaultMessage:"Percentile Ranks"}),makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.percentileRanksLabel",{defaultMessage:"Percentile ranks of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"values",default:[]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(t){const a=ks(t,Ns(e));return t.getParam("values").map((e=>new a(e)))},getSerializedFormat:e=>({id:"percent"}),getValue:(e,t)=>xs(e,t)/100}),Cs="aggPercentiles",Ps=()=>({name:Cs,help:c.i18n.translate("data.search.aggs.function.metrics.percentiles.help",{defaultMessage:"Generates a serialized agg config for a Percentiles agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentiles.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.percentiles.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentiles.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.percentiles.field.help",{defaultMessage:"Field to use for this aggregation"})},percents:{types:["number"],multi:!0,help:c.i18n.translate("data.search.aggs.metrics.percentiles.percents.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentiles.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.percentiles.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.PERCENTILES,params:{...n}}}}});const Ls={makeLabel(){const e=this.getParam("customLabel")||this.getFieldDisplayName();return c.i18n.translate("data.search.aggs.metrics.percentiles.valuePropsLabel",{defaultMessage:"{percentile} percentile of {label}",values:{percentile:(t=this.key,t+""+function(e){const t=Math.floor(parseFloat(e)),a=t%100;if(a>=11&&a<=13)return"th";const s=t%10;return 1===s?"st":2===s?"nd":3===s?"rd":"th"}(t)),label:e}});var t}},Ds=()=>new metric_agg_type_MetricAggType({name:w.PERCENTILES,expressionName:Cs,title:c.i18n.translate("data.search.aggs.metrics.percentilesTitle",{defaultMessage:"Percentiles"}),getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.percentilesLabel",{defaultMessage:"Percentiles of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[1,5,25,50,75,95,99]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(e){const t=ks(e,Ls);return e.getParam("percents").map((e=>new t(e)))},getValue:xs}),Bs="aggRate",qs=()=>({name:Bs,help:c.i18n.translate("data.search.aggs.function.metrics.rate.help",{defaultMessage:"Generates a serialized agg config for a Rate agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.rate.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.rate.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.rate.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.rate.field.help",{defaultMessage:"Field to use for this aggregation"})},unit:{types:["string"],required:!0,options:["second","minute","hour","day","week","month","quarter","year"],help:c.i18n.translate("data.search.aggs.metrics.rate.unit.help",{defaultMessage:"Unit to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.rate.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.rate.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.RATE,params:{...n}}}}}),Gs=c.i18n.translate("data.search.aggs.metrics.rateTitle",{defaultMessage:"Rate"}),Us=()=>new metric_agg_type_MetricAggType({name:w.RATE,expressionName:Bs,title:Gs,getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.rateLabel",{defaultMessage:"Rate of {field} per {unit}",values:{field:e.getFieldDisplayName(),unit:e.getParam("unit")}}),params:[{name:"field",type:"field",required:!1,filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"unit",type:"string",displayName:c.i18n.translate("data.search.aggs.metrics.rate.unit.displayName",{defaultMessage:"Unit"}),required:!0,options:[{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.second",{defaultMessage:"Second"}),value:"second"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.minute",{defaultMessage:"Minute"}),value:"minute"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.hour",{defaultMessage:"Hour"}),value:"hour"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.day",{defaultMessage:"Day"}),value:"day"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.week",{defaultMessage:"Week"}),value:"week"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.month",{defaultMessage:"Month"}),value:"month"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.quarter",{defaultMessage:"Quarter"}),value:"quarter"},{text:c.i18n.translate("data.search.aggs.metrics.rate.unit.year",{defaultMessage:"Year"}),value:"year"}]}]}),zs="aggSinglePercentileRank",$s=()=>({name:zs,help:c.i18n.translate("data.search.aggs.function.metrics.singlePercentileRank.help",{defaultMessage:"Generates a serialized agg config for a single percentile rank agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.field.help",{defaultMessage:"Field to use for this aggregation"})},value:{types:["number"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.value.help",{defaultMessage:"Percentile rank value to fetch"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.singlePercentileRank.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SINGLE_PERCENTILE_RANK,params:{...n}}}}}),Vs=c.i18n.translate("data.search.aggs.metrics.singlePercentileRankTitle",{defaultMessage:"Percentile rank"}),Ks=()=>new metric_agg_type_MetricAggType({name:w.SINGLE_PERCENTILE_RANK,expressionName:zs,dslName:"percentile_ranks",title:Vs,getValueType:()=>"number",makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.singlePercentileRankLabel",{defaultMessage:"Percentile rank of {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.value}`,getSerializedFormat:e=>({id:"percent"}),params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.HISTOGRAM]},{name:"value",default:0,write:(e,t)=>{t.params.values=[e.params.value]}}],getValue(e,t){var a;let s=String(e.params.value);Number.isInteger(e.params.value)&&(s+=".0");const{values:r}=null!==(a=t[e.id])&&void 0!==a?a:{};return r?r[s]/100:NaN}}),Hs="aggSerialDiff",Ys=()=>({name:Hs,help:c.i18n.translate("data.search.aggs.function.metrics.serial_diff.help",{defaultMessage:"Generates a serialized agg config for a Serial Differencing agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.serial_diff.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.serial_diff.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:r,schema:n,...i}=t;return{type:"agg_type",value:{id:s,enabled:r,schema:n,type:w.SERIAL_DIFF,params:{...i,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Qs=c.i18n.translate("data.search.aggs.metrics.serialDiffTitle",{defaultMessage:"Serial Diff"}),Ws=c.i18n.translate("data.search.aggs.metrics.serialDiffLabel",{defaultMessage:"serial diff"}),Js=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ua;return new metric_agg_type_MetricAggType({name:w.SERIAL_DIFF,expressionName:Hs,title:Qs,makeLabel:e=>Jt(e,Ws),subtype:e,params:[...t()],getSerializedFormat:a})},Xs="aggStdDeviation",Zs=()=>({name:Xs,help:c.i18n.translate("data.search.aggs.function.metrics.std_deviation.help",{defaultMessage:"Generates a serialized agg config for a Standard Deviation agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.std_deviation.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.std_deviation.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.std_deviation.schema.help",{defaultMessage:"Schema to use for this aggregation"})},showBounds:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.std_deviation.showBounds.help",{defaultMessage:"Specifies whether this aggregation should return upper and lower bound or the standard deviation itself"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.std_deviation.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.std_deviation.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.std_deviation.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.STD_DEV,params:{...n}}}}}),er={valProp(){const e=this.getParam("customLabel");return this.keyedDetails(e)[this.key].valProp},makeLabel(){const e=this.getFieldDisplayName(),t=this.getParam("customLabel"),a=this.keyedDetails(t,e);return Object(l.get)(a,[this.key,"title"])},keyedDetails(e,t){const a=e||c.i18n.translate("data.search.aggs.metrics.standardDeviation.keyDetailsLabel",{defaultMessage:"Standard Deviation of {fieldDisplayName}",values:{fieldDisplayName:t}});return{std_lower:{valProp:["std_deviation_bounds","lower"],title:c.i18n.translate("data.search.aggs.metrics.standardDeviation.lowerKeyDetailsTitle",{defaultMessage:"Lower {label}",values:{label:a}})},std_upper:{valProp:["std_deviation_bounds","upper"],title:c.i18n.translate("data.search.aggs.metrics.standardDeviation.upperKeyDetailsTitle",{defaultMessage:"Upper {label}",values:{label:a}})}}}},tr=()=>new metric_agg_type_MetricAggType({name:w.STD_DEV,expressionName:Xs,dslName:"extended_stats",title:c.i18n.translate("data.search.aggs.metrics.standardDeviationTitle",{defaultMessage:"Standard Deviation"}),makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.standardDeviationLabel",{defaultMessage:"Standard Deviation of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:f.KBN_FIELD_TYPES.NUMBER},{name:"showBounds",type:"boolean",write:()=>{},shouldShow:()=>!1}],getResponseAggs(e){if(!1===e.getParam("showBounds"))return[e];const t=ks(e,er);return[new t("std_lower"),new t("std_upper")]},getValueBucketPath:e=>`${e.id}.std_deviation`,getValue(e,t){var a;return!1===e.getParam("showBounds")?null===(a=t[e.id])||void 0===a?void 0:a.std_deviation:Object(l.get)(t[e.parentId],e.valProp())}}),ar="aggSum",sr=()=>({name:ar,help:c.i18n.translate("data.search.aggs.function.metrics.sum.help",{defaultMessage:"Generates a serialized agg config for a Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.sum.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:c.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.SUM,params:{...n}}}}}),rr=c.i18n.translate("data.search.aggs.metrics.sumTitle",{defaultMessage:"Sum"}),nr=()=>new metric_agg_type_MetricAggType({name:w.SUM,expressionName:ar,title:rr,getValueType:()=>"number",enableEmptyAsNull:!0,makeLabel:e=>c.i18n.translate("data.search.aggs.metrics.sumLabel",{defaultMessage:"Sum of {field}",values:{field:e.getFieldDisplayName()}}),isScalable:()=>!0,params:[{name:"field",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.HISTOGRAM]}]}),ir="aggTopHit",or=()=>({name:ir,help:c.i18n.translate("data.search.aggs.function.metrics.top_hit.help",{defaultMessage:"Generates a serialized agg config for a Top Hit agg"}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.top_hit.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.top_hit.field.help",{defaultMessage:"Field to use for this aggregation"})},aggregate:{types:["string"],required:!0,options:["min","max","sum","average","concat"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.aggregate.help",{defaultMessage:"Aggregate type"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.size.help",{defaultMessage:"Max number of buckets to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.top_hit.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.TOP_HITS,params:{...n}}}}}),lr=e=>{const t=e.getParam("field");return t&&t.type&&t.type===f.KBN_FIELD_TYPES.NUMBER},ur=()=>new metric_agg_type_MetricAggType({name:w.TOP_HITS,expressionName:ir,title:c.i18n.translate("data.search.aggs.metrics.topHitTitle",{defaultMessage:"Top Hit"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t=c.i18n.translate("data.search.aggs.metrics.topHit.lastPrefixLabel",{defaultMessage:"Last"}),a=c.i18n.translate("data.search.aggs.metrics.topHit.firstPrefixLabel",{defaultMessage:"First"});let s="desc"===e.getParam("sortOrder").value?t:a;const r=e.getParam("size");1!==r&&(s+=` ${r}`);const n=e.getParam("field");return`${s} ${n?n.displayName:""}`},params:[{name:"field",type:"field",onlyAggregatable:!1,filterFieldTypes:Object.values(f.KBN_FIELD_TYPES).filter((e=>e!==f.KBN_FIELD_TYPES.HISTOGRAM)),write(e,t){const a=e.getParam("field");t.params={},a.scripted?t.params.script_fields={[a.name]:{script:{source:a.script,lang:a.lang}}}:("_source"!==a.name&&(t.params.fields=[{field:a.name,...a.type===f.KBN_FIELD_TYPES.DATE&&{format:"date_time"}}]),t.params._source="_source"===a.name)}},{name:"aggregate",type:"optioned",options:[{text:c.i18n.translate("data.search.aggs.metrics.topHit.minLabel",{defaultMessage:"Min"}),isCompatible:lr,disabled:!0,value:"min"},{text:c.i18n.translate("data.search.aggs.metrics.topHit.maxLabel",{defaultMessage:"Max"}),isCompatible:lr,disabled:!0,value:"max"},{text:c.i18n.translate("data.search.aggs.metrics.topHit.sumLabel",{defaultMessage:"Sum"}),isCompatible:lr,disabled:!0,value:"sum"},{text:c.i18n.translate("data.search.aggs.metrics.topHit.averageLabel",{defaultMessage:"Average"}),isCompatible:lr,disabled:!0,value:"average"},{text:c.i18n.translate("data.search.aggs.metrics.topHit.concatenateLabel",{defaultMessage:"Concatenate"}),isCompatible:e=>"*"===u.a.get(e.params,"field.filterFieldTypes","*"),disabled:!0,value:"concat"}],write:u.a.noop},{name:"size",default:1},{name:"sortField",type:"field",filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE,f.KBN_FIELD_TYPES.IP,f.KBN_FIELD_TYPES.STRING],default:e=>e.getIndexPattern().timeFieldName,write:u.a.noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:c.i18n.translate("data.search.aggs.metrics.topHit.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:c.i18n.translate("data.search.aggs.metrics.topHit.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;a.scripted?t.params.sort=[{_script:{script:{source:a.script,lang:a.lang},type:a.type,order:s.value}}]:t.params.sort=[{[a.name]:{order:s.value}}]}}],getValue(e,t){const a=u.a.get(t,`${e.id}.hits.hits`);if(!a||!a.length)return null;const s=e.getParam("field").name;let r=u.a.flatten(a.map((t=>"_source"===s?t._source:Object(f.flattenHit)(t,e.getIndexPattern())[s])));if(1===r.length&&(r=r[0]),Array.isArray(r)){if(!u.a.compact(r).length)return null;switch(e.getParam("aggregate").value){case"max":return u.a.max(r);case"min":return u.a.min(r);case"sum":return u.a.sum(r);case"average":return u.a.sum(r)/r.length}}return r},createFilter:L}),cr="aggTopMetrics",dr=()=>({name:cr,help:c.i18n.translate("data.search.aggs.function.metrics.topMetrics.help",{defaultMessage:"Generates a serialized aggregation configuration for Top metrics."}),type:"agg_type",args:{id:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:c.i18n.translate("data.search.aggs.metrics.topMetrics.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:c.i18n.translate("data.search.aggs.metrics.topMetrics.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.size.help",{defaultMessage:"Number of top values to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.json.help",{defaultMessage:"Advanced JSON to include when the aggregation is sent to Elasticsearch"})},customLabel:{types:["string"],help:c.i18n.translate("data.search.aggs.metrics.topMetrics.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:w.TOP_METRICS,params:{...n}}}}}),gr=()=>new metric_agg_type_MetricAggType({name:w.TOP_METRICS,expressionName:cr,title:c.i18n.translate("data.search.aggs.metrics.topMetricsTitle",{defaultMessage:"Top metrics"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t="desc"===e.getParam("sortOrder").value,a=e.getParam("size"),s=e.getParam("field"),r=e.getParam("sortField");var n,i,o,l;return t?a>1?c.i18n.translate("data.search.aggs.metrics.topMetrics.descWithSizeLabel",{defaultMessage:'Last {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(n=null==r?void 0:r.displayName)&&void 0!==n?n:"_score"}}):c.i18n.translate("data.search.aggs.metrics.topMetrics.descNoSizeLabel",{defaultMessage:'Last "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(i=null==r?void 0:r.displayName)&&void 0!==i?i:"_score"}}):a>1?c.i18n.translate("data.search.aggs.metrics.topMetrics.ascWithSizeLabel",{defaultMessage:'First {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(o=null==r?void 0:r.displayName)&&void 0!==o?o:"_score"}}):c.i18n.translate("data.search.aggs.metrics.topMetrics.ascNoSizeLabel",{defaultMessage:'First "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(l=null==r?void 0:r.displayName)&&void 0!==l?l:"_score"}})},params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:[f.KBN_FIELD_TYPES.STRING,f.KBN_FIELD_TYPES.IP,f.KBN_FIELD_TYPES.BOOLEAN,f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE],write(e,t){const a=e.getParam("field");t.params.metrics={field:a.name}}},{name:"size",default:1},{name:"sortField",type:"field",scriptable:!1,filterFieldTypes:[f.KBN_FIELD_TYPES.NUMBER,f.KBN_FIELD_TYPES.DATE],default:e=>e.getIndexPattern().timeFieldName,write:u.a.noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:c.i18n.translate("data.search.aggs.metrics.topMetrics.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:c.i18n.translate("data.search.aggs.metrics.topMetrics.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;t.params.sort=a&&s?{[a.name]:s.value}:"_score"}}],getValueBucketPath(e){const t=e.getParam("field").name;return`${e.id}[${t}]`},getValue(e,t){var a,s;const r=e.getParam("field").name,n=null!==(a=null===(s=t[e.id])||void 0===s?void 0:s.top.map((e=>e.metrics[r])))&&void 0!==a?a:[];return 0===n.length?null:1===n.length?n[0]:n},createFilter:L}),hr=()=>({metrics:[{name:w.COUNT,fn:Pa},{name:w.AVG,fn:Yt},{name:w.SUM,fn:nr},{name:w.MEDIAN,fn:ps},{name:w.SINGLE_PERCENTILE,fn:ys},{name:w.SINGLE_PERCENTILE_RANK,fn:Ks},{name:w.MIN,fn:Ts},{name:w.MAX,fn:cs},{name:w.STD_DEV,fn:tr},{name:w.CARDINALITY,fn:wa},{name:w.VALUE_COUNT,fn:Na},{name:w.PERCENTILES,fn:Ds},{name:w.PERCENTILE_RANKS,fn:js},{name:w.RATE,fn:Us},{name:w.TOP_HITS,fn:ur},{name:w.TOP_METRICS,fn:gr},{name:w.DERIVATIVE,fn:Wa},{name:w.CUMULATIVE_SUM,fn:Va},{name:w.MOVING_FN,fn:Is},{name:w.SERIAL_DIFF,fn:Js},{name:w.AVG_BUCKET,fn:na},{name:w.SUM_BUCKET,fn:_a},{name:w.MIN_BUCKET,fn:fa},{name:w.MAX_BUCKET,fn:ca},{name:w.FILTERED_METRIC,fn:Fa},{name:w.GEO_BOUNDS,fn:ts},{name:w.GEO_CENTROID,fn:is}],buckets:[{name:T.a.DATE_HISTOGRAM,fn:z},{name:T.a.HISTOGRAM,fn:be},{name:T.a.RANGE,fn:Ve},{name:T.a.DATE_RANGE,fn:Q},{name:T.a.IP_PREFIX,fn:Fe},{name:T.a.IP_RANGE,fn:Re},{name:T.a.TERMS,fn:mt},{name:T.a.MULTI_TERMS,fn:Ft},{name:T.a.RARE_TERMS,fn:wt},{name:T.a.FILTER,fn:ae},{name:T.a.FILTERS,fn:oe},{name:T.a.SIGNIFICANT_TERMS,fn:We},{name:T.a.SIGNIFICANT_TEXT,fn:et},{name:T.a.GEOTILE_GRID,fn:de},{name:T.a.SAMPLER,fn:xt},{name:T.a.DIVERSIFIED_SAMPLER,fn:Lt},{name:T.a.TIME_SERIES,fn:zt}]}),pr=()=>[J,re,He,Xe,_e,Ie,V,Ge,ue,he,M,at,Gt,Tt,It,jt,Bt,Kt,Wt,oa,ga,ba,Ta,Ia,Ra,Ca,Da,Ha,Xa,ss,ls,gs,ms,$s,_s,Ms,ws,Ps,qs,Ys,Zs,sr,or,dr];class agg_types_registry_AggTypesRegistry{constructor(){n()(this,"bucketAggs",new Map),n()(this,"metricAggs",new Map),n()(this,"legacyAggs",new Map),n()(this,"setup",(()=>({registerBucket:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.bucketAggs.set(e,t)},registerMetric:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.metricAggs.set(e,t)},registerLegacy:(e,t)=>{if(this.legacyAggs.get(e)||this.legacyAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.legacyAggs.set(e,t)}}))),n()(this,"start",(e=>{const t=new Map,a=(a,s)=>{if(t.has(a))return t.get(a);const r=s(e);return t.set(a,r),r};return{get:e=>{const t=this.bucketAggs.get(e)||this.metricAggs.get(e)||this.legacyAggs.get(e);return t?a(e,t):void 0},getAll:()=>({buckets:Array.from(this.bucketAggs.entries()).map((([e,t])=>a(e,t))),metrics:Array.from(this.metricAggs.entries()).map((([e,t])=>a(e,t)))})}}))}}const fr=["dateFormat","dateFormat:scaled","dateFormat:tz",f.UI_SETTINGS.HISTOGRAM_BAR_TARGET,f.UI_SETTINGS.HISTOGRAM_MAX_BARS,f.UI_SETTINGS.SEARCH_QUERY_LANGUAGE,f.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,f.UI_SETTINGS.QUERY_STRING_OPTIONS,f.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX];class aggs_service_AggsCommonService{constructor(e){n()(this,"aggTypesRegistry",new agg_types_registry_AggTypesRegistry),this.aggExecutionContext=e}setup({registerFunction:e}){const t=this.aggTypesRegistry.setup(),a=hr();return a.buckets.forEach((({name:e,fn:a})=>t.registerBucket(e,a))),a.metrics.forEach((({name:e,fn:a})=>t.registerMetric(e,a))),pr().forEach((t=>e(t))),{types:t}}start({getConfig:e,fieldFormats:t,calculateBounds:a}){const s=this.aggTypesRegistry.start({getConfig:e,getFieldFormatsStart:()=>t,aggExecutionContext:this.aggExecutionContext,calculateBounds:a});return{types:s,calculateAutoTimeExpression:Object(q.g)(e),createAggConfigs:(t,a,r)=>new agg_configs_AggConfigs(t,a,{...r,typesRegistry:s,aggExecutionContext:this.aggExecutionContext},e)}}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s.a})),a.d(t,"b",(function(){return s.b})),a.d(t,"d",(function(){return s.d})),a.d(t,"c",(function(){return s.c})),a.d(t,"f",(function(){return r})),a.d(t,"e",(function(){return n})),a.d(t,"g",(function(){return c})),a.d(t,"h",(function(){return u}));var s=a(50);const r=e=>!!e&&"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to;a(49);const n=e=>!!e&&"object"==typeof e&&"string"==typeof e.language&&("string"==typeof e.query||"object"==typeof e.query&&!!e.query);var i=a(4),o=a(8),l=a(3);function u({filters:e,query:t,inputQuery:a,time:s,timeFieldName:r,titleForInspector:n,descriptionForInspector:u}){const c=Object(o.buildExpressionFunction)("kibana",{});let d;a&&(d=a);const g=Object(o.buildExpressionFunction)("kibana_context",{q:d&&Object(l.queryToAst)(d),timeRange:s&&Object(l.timerangeToAst)(s),filters:e&&Object(l.filtersToAst)(e)}),h=Object(o.buildExpression)([c,g]).toAst();if(t&&Object(i.isOfAggregateQueryType)(t)){const e=Object(l.aggregateQueryToAst)({query:t,timeField:r,titleForInspector:n,descriptionForInspector:u});e&&h.chain.push(e)}return h}async function c({filters:e,query:t,inputQuery:a,time:s,dataView:r,titleForInspector:n,descriptionForInspector:o}){let l;return t&&Object(i.isOfAggregateQueryType)(t)&&(l=u({filters:e,query:t,inputQuery:a,time:s,timeFieldName:null==r?void 0:r.timeFieldName,titleForInspector:n,descriptionForInspector:o})),l}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return u}));var s=a(44),r=a(13);const n=e=>{const t=[];return{state:e.map((e=>{var a;if(null!==(a=e.meta)&&void 0!==a&&a.index){const a=Object(s.v4)();return t.push({type:r.DATA_VIEW_SAVED_OBJECT_TYPE,name:a,id:e.meta.index}),{...e,meta:{...e.meta,index:a}}}return e})),references:t}},i=(e,t)=>e.map((e=>{if(!e.meta.index)return e;const a=t.find((t=>t.name===e.meta.index));return{...e,meta:{...e.meta,index:a?a.id:e.meta.index}}})),o=(e,t)=>({}),l=e=>e.state,u=()=>({})},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(42);function r(e){return{allowLeadingWildcards:e.get(s.a.QUERY_ALLOW_LEADING_WILDCARDS),queryStringOptions:e.get(s.a.QUERY_STRING_OPTIONS),ignoreFilterIfFieldNotInIndex:e.get(s.a.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX),dateFormatTZ:e.get("dateFormat:tz")}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return AggConfig}));var s=a(2),r=a.n(s),n=a(6),i=a.n(n),o=a(1),l=a.n(o),u=a(0),c=a(43),d=a(16);class AggConfig{static ensureIds(e){const t=[],a=[];e.forEach((function(e){(e.id?t:a).push(e)}));let s=AggConfig.nextId(t);return a.forEach((function(e){e.id=String(s++)})),e}static nextId(e){return 1+e.reduce((function(e,t){return Math.max(e,+t.id||0)}),0)}constructor(e,t){r()(this,"aggConfigs",void 0),r()(this,"id",void 0),r()(this,"enabled",void 0),r()(this,"params",void 0),r()(this,"parent",void 0),r()(this,"brandNew",void 0),r()(this,"schema",void 0),r()(this,"__type",void 0),r()(this,"__typeDecorations",void 0),r()(this,"subAggs",[]),this.aggConfigs=e,this.id=String(t.id||AggConfig.nextId(e.aggs)),this.enabled="boolean"!=typeof t.enabled||t.enabled,this.params={},this.setType(t.type),t.schema&&(this.schema=t.schema),this.setParams(t.params||{}),this.__type=this.__type}setParams(e){e=e||this.params||{};const t=this.params={};this.getAggParams().forEach((a=>{let s=e[a.name];if(null==s){if(null==a.default)return;if(l.a.isFunction(a.default)){if(s=a.default(this),null==s)return}else s=a.default}if(a.deserialize){var r;const e=null===(r=a.getValueType)||void 0===r?void 0:r.call(a,this),n=l.a.isFunction(e),i=n&&s instanceof e,o=!n&&l.a.isObject(s);return i||o||(s=a.deserialize(l.a.cloneDeep(s),this)),void(t[a.name]=s)}t[a.name]=l.a.cloneDeep(s)}))}getParam(e){return l.a.get(this.params,e)}hasTimeShift(){return Boolean(this.getParam("timeShift"))}getTimeShift(){const e=this.getParam("timeShift");if(!e)return;const t=Object(d.o)(e);if("invalid"===t)throw new Error(`could not parse time shift ${e}`);if("previous"===t){const e=this.aggConfigs.getTimeShiftInterval();if(e)return e;if(!this.aggConfigs.timeRange)return;const t=this.aggConfigs.getResolvedTimeRange();return i.a.duration(i.a.tz(t.max,this.aggConfigs.timeZone).diff(t.min))}return t}write(e){return Object(c.b)(this.type.params,this,e)}isFilterable(){return l.a.isFunction(this.type.createFilter)}createFilter(e,t={}){const a=this.type.createFilter;if(!a)throw new TypeError(`The "${this.type.title}" aggregation does not support filtering.`);const s=this.getField(),r=this.getFieldDisplayName();if(s&&!s.filterable){let e=`The "${r}" field can not be used for filtering.`;throw s.scripted&&(e=`The "${r}" field is scripted and can not be used for filtering.`),new TypeError(e)}return a(this,e,t)}onSearchRequestStart(e,t){return this.type?Promise.all(this.type.params.map((a=>a.modifyAggConfigOnSearchRequestStart(this,e,t)))):Promise.resolve()}toDsl(e){if(this.type.hasNoDsl)return;const t=this.write(e),a={};if(this.type.hasNoDslParams||(a[this.type.dslName||this.type.name]=t.params),this.subAggs.length&&(t.subAggs?t.subAggs.push(...this.subAggs):t.subAggs=this.subAggs),t.subAggs){const s=a.aggs||(a.aggs={});t.subAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}if(t.parentAggs){const s=a.parentAggs||(a.parentAggs={});t.parentAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}return a}serialize(){const e=this.params,t=l.a.transform(this.getAggParams(),((t,a)=>{let s=e[a.name];null!=s&&(a.serialize&&(s=a.serialize(s,this)),null!=s&&(t[a.name]=l.a.cloneDeep(s)))}),{});return{id:this.id,enabled:this.enabled,type:this.type&&this.type.name,params:t,...this.schema&&{schema:this.schema}}}toJSON(){return this.serialize()}toSerializedFieldFormat(){return this.type?this.type.getSerializedFormat(this):{}}toExpressionAst(){const e=this.type&&this.type.expressionName,{type:t,...a}=this.serialize();if(e&&a.params)return{type:"expression",chain:[{type:"function",function:e,arguments:{...Object.entries(a.params).reduce(((e,[t,a])=>{const s=this.getAggParams().find((e=>e.name===t));if(s&&s.toExpressionAst){const a=s.toExpressionAst(this.getParam(t));a&&(e[t]=Array.isArray(a)?a:[a])}else if(a&&Array.isArray(a)){const s=a.filter((e=>null!=e));e[t]="object"==typeof s[0]?[JSON.stringify(s)]:s}else"object"==typeof a?e[t]=[JSON.stringify(a)]:void 0!==a&&(e[t]=[a]);return e}),{}),id:[this.id],enabled:[this.enabled],...this.schema?{schema:[this.schema]}:{}}}]}}getAggParams(){return[...l.a.hasIn(this,"type.params")?this.type.params:[]]}getRequestAggs(){return this.type&&this.type.getRequestAggs(this)||[this]}getResponseAggs(){return this.type&&this.type.getResponseAggs(this)||[this]}getValue(e){return this.type.getValue(this,e)}getResponseId(){return this.type.getResponseId(this)}getKey(e,t){return this.type.getKey?this.type.getKey(e,t,this):""}getFieldDisplayName(){const e=this.getField();return e?e.displayName||this.fieldName():""}getField(){return this.params.field}getValueBucketPath(){return this.type.getValueBucketPath(this)}makeLabel(e=!1){return this.params.customLabel?this.params.customLabel:this.type?e?u.i18n.translate("data.search.aggs.percentageOfLabel",{defaultMessage:"Percentage of {label}",values:{label:this.type.makeLabel(this)}}):`${this.type.makeLabel(this)}`:""}getIndexPattern(){return this.aggConfigs.indexPattern}getTimeRange(){return this.aggConfigs.timeRange}fieldName(){const e=this.getField();return e?e.name:""}fieldIsTimeField(){var e,t,a;const s=null===(e=this.getIndexPattern())||void 0===e||null===(t=e.getTimeField)||void 0===t||null===(a=t.call(e))||void 0===a?void 0:a.name,r=s?[s]:[],n=this.aggConfigs.timeFields&&this.aggConfigs.timeFields.length>0?this.aggConfigs.timeFields:r,i=this.fieldName();return n.includes(i)}get type(){return this.__type}set type(e){this.__typeDecorations&&l.a.forOwn(this.__typeDecorations,((e,t)=>{delete this[t]})),e&&l.a.isFunction(e.decorateAggConfig)&&(this.__typeDecorations=e.decorateAggConfig(),Object.defineProperties(this,this.__typeDecorations)),this.__type=e;let t=[];const a=this.type&&this.type.params.find((e=>"field"===e.type));a&&(t=a.getAvailableFields(this)),this.setParams({field:t.find((e=>e.name===this.getField()))})}setType(e){this.type=e}}},function(e,t,a){e.exports=a(68)(4)},function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a(9),r=a(46),n=a.n(r),i=a(76),o=a(7);const l=(e,t)=>a=>(n.a.render(Object(o.jsx)(i.a,t,e),a),()=>n.a.unmountComponentAtNode(a));a(2),a(0),s.Component},function(e,t,a){"use strict";var s=a(26);a.d(t,"a",(function(){return s.a})),a.d(t,"b",(function(){return s.b}))},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/inspector/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t,a){"use strict";a(49);var s=a(34);a.d(t,"a",(function(){return s.a})),a.d(t,"b",(function(){return s.b}))},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(86),r=a(9),n=s.__importDefault(a(89));t.default=function(e,t){var a=r.useState(t),s=a[0],i=a[1];return n.default((function(){var t=e.subscribe(i);return function(){return t.unsubscribe()}}),[e]),s}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var s=a(11),r=a(65);const n="shard_delay",i=()=>new s.a({name:n,title:"Shard Delay",expressionName:r.b,createFilter:()=>({match_all:{}}),customLabels:!1,params:[{name:"delay",type:"string",default:"5s",write(e,t){t.params={...t.params,value:e.params.delay}}}]})},function(e,t,a){"use strict";a.d(t,"a",(function(){return AggType}));var s=a(2),r=a.n(s),n=a(1),i=a(0),o=a(43),l=a(24);class AggType{splitForTimeShift(e,t){return!1}constructor(e){if(r()(this,"name",void 0),r()(this,"type",void 0),r()(this,"subtype",void 0),r()(this,"dslName",void 0),r()(this,"expressionName",void 0),r()(this,"title",void 0),r()(this,"getValueType",void 0),r()(this,"makeLabel",void 0),r()(this,"ordered",void 0),r()(this,"hasNoDsl",void 0),r()(this,"hasNoDslParams",void 0),r()(this,"createFilter",void 0),r()(this,"params",void 0),r()(this,"getRequestAggs",void 0),r()(this,"getResponseAggs",void 0),r()(this,"decorateAggConfig",void 0),r()(this,"hasPrecisionError",void 0),r()(this,"postFlightRequest",void 0),r()(this,"getSerializedFormat",void 0),r()(this,"getValue",void 0),r()(this,"getKey",void 0),r()(this,"paramByName",(e=>this.params.find((t=>t.name===e)))),r()(this,"getValueBucketPath",(e=>e.id)),r()(this,"getResponseId",void 0),this.name=e.name,this.type=e.type||"metrics",this.dslName=e.dslName||e.name,this.expressionName=e.expressionName,this.title=e.title,this.getValueType=e.getValueType,this.makeLabel=e.makeLabel||Object(n.constant)(this.name),this.ordered=e.ordered,this.hasNoDsl=!!e.hasNoDsl,this.hasNoDslParams=!!e.hasNoDslParams,e.createFilter&&(this.createFilter=e.createFilter),e.getValueBucketPath&&(this.getValueBucketPath=e.getValueBucketPath),e.params&&e.params.length&&e.params[0]instanceof l.a)this.params=e.params;else{const t=e.params?[...e.params]:[];!1!==e.json&&t.push({name:"json",type:"json",advanced:!0}),!1!==e.customLabels&&t.push({name:"customLabel",displayName:i.i18n.translate("data.search.aggs.string.customLabel",{defaultMessage:"Custom label"}),type:"string",write:n.noop}),this.params=Object(o.a)(t)}this.getRequestAggs=e.getRequestAggs||n.noop,this.getResponseAggs=e.getResponseAggs||(()=>{}),this.decorateAggConfig=e.decorateAggConfig||(()=>({})),this.postFlightRequest=e.postFlightRequest||n.identity,this.hasPrecisionError=e.hasPrecisionError,this.getSerializedFormat=e.getSerializedFormat||(e=>e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}),this.getValue=e.getValue||((e,t)=>{}),this.getResponseId=e.getResponseId||(e=>e.id)}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s="search_sessions"},function(e,t,a){"use strict";a.d(t,"a",(function(){return time_buckets_TimeBuckets}));var s=a(2),r=a.n(s),n=a(1),i=a(6),o=a.n(i),l=a(16),u=a(47),c=a(21),d=a.n(c),g=a(0);const h=d.a.unitsDesc,p=h.indexOf("w");var f=a(23);function m(e){return e&&"isValid"in e&&e.isValid()}function b(e){return o.a.isDuration(e)&&Boolean(+e)}class time_buckets_TimeBuckets{constructor(e){r()(this,"_timeBucketConfig",void 0),r()(this,"_lb",void 0),r()(this,"_ub",void 0),r()(this,"_originalInterval",null),r()(this,"_i",void 0),this._timeBucketConfig=e}getDuration(){if(void 0===this._ub||void 0===this._lb||!this.hasBounds())return;const e=this._ub.valueOf()-this._lb.valueOf();return o.a.duration(e,"ms")}setBounds(e){if(!e)return this.clearBounds();let t;t=Object(n.isPlainObject)(e)&&!Array.isArray(e)?[e.min,e.max]:Array.isArray(e)?e:[];const a=Object(n.sortBy)(t,Number);if(2!==a.length||!a.every(m))throw this.clearBounds(),new Error("invalid bounds set: "+e);this._lb=a.shift(),this._ub=a.pop();const s=this.getDuration();if(!s||s.asSeconds()<0)throw new TypeError("Intervals must be positive")}clearBounds(){this._lb=this._ub=void 0}hasBounds(){return m(this._ub)&&m(this._lb)}getBounds(){if(this.hasBounds())return{min:this._lb,max:this._ub}}setInterval(e){var t;if(this._originalInterval=null,this._i=(t=e,Object(n.isObject)(t)?e.val:e),this._i&&this._i!==f.a){if(Object(n.isString)(this._i)){const e=Object(l.n)(this._i);b(e)&&(this._originalInterval=this._i,this._i=e)}if(!b(this._i))throw new TypeError('"'+this._i+'" is not a valid interval.')}else this._i=f.a}getInterval(e=!0){const t=this.getDuration(),a=b(this._i)?this._i:Object(u.c)(this._timeBucketConfig["histogram:barTarget"],Number(t)),s=t=>{let a;var s;!t.scaled&&this._originalInterval&&(a=null===(s=Object(l.q)(this._originalInterval))||void 0===s?void 0:s.unit);const r=e||!this._originalInterval?function(e,t){for(let a=0;a<h.length;a++){const s=h[a],r=e.as(s);if(r>=1&&Math.floor(r)===r){if(1===r&&t&&s!==t)continue;if(a<=p&&1!==r)continue;return{value:r,unit:s,expression:r+s}}}const a=e.as("ms");return{value:a,unit:"ms",expression:a+"ms"}}(t,a):function(e){const{value:t,unit:a}=Object(l.m)(e);return{value:t,unit:a,expression:e}}(this._originalInterval),n=o.a.normalizeUnits(r.unit),i=function(e,t){if("millisecond"===t)return 1===e?g.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecond",{defaultMessage:"millisecond"}):g.i18n.translate("data.search.aggs.buckets.intervalOptions.milliseconds",{defaultMessage:"{n} milliseconds",values:{n:e}});const a=o.a.relativeTimeRounding(),s=[{unit:"m",value:60},{unit:"s",value:60},{unit:"ss",value:0},{unit:"ms",value:1e3}],r=s.map((({unit:e})=>o.a.relativeTimeThreshold(e))),n=Math.pow(10,2);o.a.relativeTimeRounding((e=>Math.round(e*n)/n)),s.forEach((({unit:e,value:t})=>o.a.relativeTimeThreshold(e,t)));const i=o.a.localeData()._config;o.a.updateLocale(o.a.locale(),{relativeTime:{ss:e=>1===e?g.i18n.translate("data.search.aggs.buckets.intervalOptions.second",{defaultMessage:"second"}):g.i18n.translate("data.search.aggs.buckets.intervalOptions.seconds",{defaultMessage:"{n} seconds",values:{n:e}}),m:g.i18n.translate("data.search.aggs.buckets.intervalOptions.minute",{defaultMessage:"minute"}),h:g.i18n.translate("data.search.aggs.buckets.intervalOptions.hourly",{defaultMessage:"hour"}),d:g.i18n.translate("data.search.aggs.buckets.intervalOptions.daily",{defaultMessage:"day"}),w:g.i18n.translate("data.search.aggs.buckets.intervalOptions.weekly",{defaultMessage:"week"}),M:g.i18n.translate("data.search.aggs.buckets.intervalOptions.monthly",{defaultMessage:"month"}),y:g.i18n.translate("data.search.aggs.buckets.intervalOptions.yearly",{defaultMessage:"year"})}});const l=o.a.duration(e,t).locale(g.i18n.getLocale()).humanize();return s.forEach((({unit:e},a)=>o.a.relativeTimeThreshold(t,r[a]))),o.a.relativeTimeRounding(a),o.a.updateLocale(o.a.locale(),i),l}(r.value,n);return Object.assign(t,{description:i,esValue:r.value,esUnit:r.unit,expression:r.expression})};return s(e?(e=>{if(!this.hasBounds()||!t)return e;const a=this._timeBucketConfig["histogram:maxBars"],r=Object(u.b)(a,Number(t));let n;return e<r?(n=r,e=s(e),Object.assign(n,{preScaled:e,scale:Number(e)/Number(n),scaled:!0})):e})(a):a)}getScaledDateFormat(){const e=this.getInterval(),t=this._timeBucketConfig["dateFormat:scaled"];for(let a=t.length-1;a>=0;a--){const s=t[a];if(!s[0]||e&&e>=o.a.duration(s[0]))return s[1]}return this._timeBucketConfig.dateFormat}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={META_FIELDS:"metaFields",DOC_HIGHLIGHT:"doc_table:highlight",QUERY_STRING_OPTIONS:"query:queryString:options",QUERY_ALLOW_LEADING_WILDCARDS:"query:allowLeadingWildcards",SEARCH_QUERY_LANGUAGE:"search:queryLanguage",SORT_OPTIONS:"sort:options",COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX:"courier:ignoreFilterIfFieldNotInIndex",COURIER_SET_REQUEST_PREFERENCE:"courier:setRequestPreference",COURIER_CUSTOM_REQUEST_PREFERENCE:"courier:customRequestPreference",COURIER_MAX_CONCURRENT_SHARD_REQUESTS:"courier:maxConcurrentShardRequests",SEARCH_INCLUDE_FROZEN:"search:includeFrozen",SEARCH_TIMEOUT:"search:timeout",HISTOGRAM_BAR_TARGET:"histogram:barTarget",HISTOGRAM_MAX_BARS:"histogram:maxBars",HISTORY_LIMIT:"history:limit",TIMEPICKER_REFRESH_INTERVAL_DEFAULTS:"timepicker:refreshIntervalDefaults",TIMEPICKER_QUICK_RANGES:"timepicker:quickRanges",TIMEPICKER_TIME_DEFAULTS:"timepicker:timeDefaults",FILTERS_PINNED_BY_DEFAULT:"filters:pinnedByDefault",FILTERS_EDITOR_SUGGEST_VALUES:"filterEditor:suggestValues",AUTOCOMPLETE_USE_TIMERANGE:"autocomplete:useTimeRange",AUTOCOMPLETE_VALUE_SUGGESTION_METHOD:"autocomplete:valueSuggestionMethod",DATE_FORMAT:"dateFormat",DATEFORMAT_TZ:"dateFormat:tz"}},function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return d}));var s=a(51),r=a(52),n=a(56),i=a(57),o=a(58),l=a(24);const u={field:r.a,optioned:n.a,string:i.a,json:o.a,agg:s.a,_default:l.a},c=e=>e.map((e=>new(u[e.type]||u._default)(e))),d=(e=[],t,a,s)=>{const r={params:{}};return s=s||{},e.forEach((e=>{e.write?e.write(t,r,a,s):e&&e.name&&(r.params[e.name]=t.params[e.name])})),r}},function(e,t){e.exports=__kbnSharedDeps__.Uuid},function(e,t,a){"use strict";var s=a(62);a.o(s,"CONTAINS_SPACES_KEY")&&a.d(t,"CONTAINS_SPACES_KEY",(function(){return s.CONTAINS_SPACES_KEY})),a.o(s,"ILLEGAL_CHARACTERS")&&a.d(t,"ILLEGAL_CHARACTERS",(function(){return s.ILLEGAL_CHARACTERS})),a.o(s,"ILLEGAL_CHARACTERS_KEY")&&a.d(t,"ILLEGAL_CHARACTERS_KEY",(function(){return s.ILLEGAL_CHARACTERS_KEY})),a.o(s,"ILLEGAL_CHARACTERS_VISIBLE")&&a.d(t,"ILLEGAL_CHARACTERS_VISIBLE",(function(){return s.ILLEGAL_CHARACTERS_VISIBLE})),a.o(s,"validateDataView")&&a.d(t,"validateDataView",(function(){return s.validateDataView}))},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"c",(function(){return m})),a.d(t,"b",(function(){return b}));var s=a(6),r=a.n(s),n=a(0);const i=e=>n.i18n.translate("data.search.timeBuckets.dayLabel",{defaultMessage:"{amount, plural, one {a day} other {# days}}",values:{amount:e}}),o=e=>n.i18n.translate("data.search.timeBuckets.hourLabel",{defaultMessage:"{amount, plural, one {an hour} other {# hours}}",values:{amount:e}}),l=()=>n.i18n.translate("data.search.timeBuckets.yearLabel",{defaultMessage:"a year"}),u=e=>n.i18n.translate("data.search.timeBuckets.minuteLabel",{defaultMessage:"{amount, plural, one {a minute} other {# minutes}}",values:{amount:e}}),c=e=>n.i18n.translate("data.search.timeBuckets.secondLabel",{defaultMessage:"{amount, plural, one {a second} other {# seconds}}",values:{amount:e}}),d=e=>n.i18n.translate("data.search.timeBuckets.millisecondLabel",{defaultMessage:"{amount, plural, one {a millisecond} other {# milliseconds}}",values:{amount:e}}),g=[{bound:1/0,interval:r.a.duration(1,"year"),boundLabel:n.i18n.translate("data.search.timeBuckets.infinityLabel",{defaultMessage:"More than a year"}),intervalLabel:l()},{bound:r.a.duration(1,"year"),interval:r.a.duration(1,"month"),boundLabel:l(),intervalLabel:n.i18n.translate("data.search.timeBuckets.monthLabel",{defaultMessage:"a month"})},{bound:r.a.duration(3,"week"),interval:r.a.duration(1,"week"),boundLabel:i(21),intervalLabel:i(7)},{bound:r.a.duration(1,"week"),interval:r.a.duration(1,"d"),boundLabel:i(7),intervalLabel:i(1)},{bound:r.a.duration(24,"hour"),interval:r.a.duration(12,"hour"),boundLabel:i(1),intervalLabel:o(12)},{bound:r.a.duration(6,"hour"),interval:r.a.duration(3,"hour"),boundLabel:o(6),intervalLabel:o(3)},{bound:r.a.duration(2,"hour"),interval:r.a.duration(1,"hour"),boundLabel:o(2),intervalLabel:o(1)},{bound:r.a.duration(45,"minute"),interval:r.a.duration(30,"minute"),boundLabel:u(45),intervalLabel:u(30)},{bound:r.a.duration(20,"minute"),interval:r.a.duration(10,"minute"),boundLabel:u(20),intervalLabel:u(10)},{bound:r.a.duration(9,"minute"),interval:r.a.duration(5,"minute"),boundLabel:u(9),intervalLabel:u(5)},{bound:r.a.duration(3,"minute"),interval:r.a.duration(1,"minute"),boundLabel:u(3),intervalLabel:u(1)},{bound:r.a.duration(45,"second"),interval:r.a.duration(30,"second"),boundLabel:c(45),intervalLabel:c(30)},{bound:r.a.duration(15,"second"),interval:r.a.duration(10,"second"),boundLabel:c(15),intervalLabel:c(10)},{bound:r.a.duration(7.5,"second"),interval:r.a.duration(5,"second"),boundLabel:c(7.5),intervalLabel:c(5)},{bound:r.a.duration(5,"second"),interval:r.a.duration(1,"second"),boundLabel:c(5),intervalLabel:c(1)},{bound:r.a.duration(500,"ms"),interval:r.a.duration(100,"ms"),boundLabel:d(500),intervalLabel:d(100)}],h=g.map((({bound:e,interval:t})=>({bound:Number(e),interval:Number(t)})));function p(e,t){const a=t/e;return isFinite(a)?a:NaN}function f(e){const t=isNaN(e)?0:Math.max(Math.floor(e),1);return r.a.duration(t)}function m(e,t){const a=p(e,t),s=h.findIndex((({bound:e})=>Number(e)<=a));if(-1!==s){const e=h[s-1].interval;return r.a.duration(e)}return f(a)}function b(e,t){const a=p(e,t);for(const{interval:e}of h)if(e<=a)return r.a.duration(e);return f(a)}},function(e,t,a){!function(t){"use strict";const a="(0?\\d+|0x[a-f0-9]+)",s={fourOctet:new RegExp(`^${a}\\.${a}\\.${a}\\.${a}$`,"i"),threeOctet:new RegExp(`^${a}\\.${a}\\.${a}$`,"i"),twoOctet:new RegExp(`^${a}\\.${a}$`,"i"),longValue:new RegExp(`^${a}$`,"i")},r=new RegExp("^0[0-7]+$","i"),n=new RegExp("^0x[a-f0-9]+$","i"),i="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",l={zoneIndex:new RegExp(i,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${i})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${a}\\.${a}\\.${a}\\.${a}(${i})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${a}\\.${a}\\.${a}\\.${a}(${i})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let a,s,r=0,n=-1,i=(e.match(l.zoneIndex)||[])[0];for(i&&(i=i.substring(1),e=e.replace(/%.+$/,""));(n=e.indexOf(":",n+1))>=0;)r++;if("::"===e.substr(0,2)&&r--,"::"===e.substr(-2,2)&&r--,r>t)return null;for(s=t-r,a=":";s--;)a+="0:";return":"===(e=e.replace("::",a))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),a=[];for(let e=0;e<t.length;e++)a.push(parseInt(t[e],16));return a}(),zoneId:i}}function c(e,t,a,s){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let r,n=0;for(;s>0;){if(r=a-s,r<0&&(r=0),e[n]>>r!=t[n]>>r)return!1;s-=a,n+=1}return!0}function d(e){if(n.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(r.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function g(e,t){for(;e.length<t;)e=`0${e}`;return e}const h={};h.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,a;for(t=0;t<e.length;t++)if(a=e[t],!(0<=a&&a<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return c(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let s,r,n;for(s=3;s>=0;s-=1){if(r=this.octets[s],!(r in a))return null;if(n=a[r],t&&0!==n)return null;8!==n&&(t=!0),e+=n}return 32-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),h.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),a=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),r=[];let n=0;for(;n<4;)r.push(parseInt(a[n],10)|255^parseInt(s[n],10)),n++;return new this(r)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(e){return null!==this.parser(e)},h.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},h.IPv4.isValidFourPartDecimal=function(e){return!(!h.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(e){let t,a,s,r,n;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),r=[],a=0;a<4;)r.push(parseInt(s[a],10)&parseInt(n[a],10)),a++;return new this(r)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},h.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const a=[this.parse(t[1]),e];return Object.defineProperty(a,"toString",{value:function(){return this.join("/")}}),a}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(e){let t,a,r;if(t=e.match(s.fourOctet))return function(){const e=t.slice(1,6),s=[];for(let t=0;t<e.length;t++)a=e[t],s.push(d(a));return s}();if(t=e.match(s.longValue)){if(r=d(t[1]),r>4294967295||r<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(r>>t&255);return e}().reverse()}return(t=e.match(s.twoOctet))?function(){const e=t.slice(1,4),a=[];if(r=d(e[1]),r>16777215||r<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(r>>16&255),a.push(r>>8&255),a.push(255&r),a}():(t=e.match(s.threeOctet))?function(){const e=t.slice(1,5),a=[];if(r=d(e[2]),r>65535||r<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(d(e[1])),a.push(r>>8&255),a.push(255&r),a}():null},h.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let a=0;const s=Math.floor(e/8);for(;a<s;)t[a]=255,a++;return s<4&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.IPv6=function(){function e(e,t){let a,s;if(16===e.length)for(this.parts=[],a=0;a<=14;a+=2)this.parts.push(e[a]<<8|e[a+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(a=0;a<this.parts.length;a++)if(s=this.parts[a],!(0<=s&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return c(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let s,r;for(let n=7;n>=0;n-=1){if(s=this.parts[n],!(s in a))return null;if(r=a[s],t&&0!==r)return null;16!==r&&(t=!0),e+=r}return 128-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],a=this.parts;for(let s=0;s<a.length;s++)e=a[s],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(g(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],a=e[1];return new h.IPv4([t>>8,255&t,a>>8,255&a])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let a,s=0,r=-1;for(;a=e.exec(t);)a[0].length>r&&(s=a.index,r=a[0].length);return r<0?t:`${t.substring(0,s)}::${t.substring(s+r)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),h.IPv6.isIPv6=function(e){return null!==this.parser(e)},h.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},h.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},h.IPv6.parseCIDR=function(e){let t,a,s;if((a=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(a[2]),t>=0&&t<=128))return s=[this.parse(a[1]),t],Object.defineProperty(s,"toString",{value:function(){return this.join("/")}}),s;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(e){let t,a,s,r,n,i;if(s=e.match(l.deprecatedTransitional))return this.parser(`::ffff:${s[1]}`);if(l.native.test(e))return u(e,8);if((s=e.match(l.transitional))&&(i=s[6]||"",t=u(s[1].slice(0,-1)+i,6),t.parts)){for(n=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])],a=0;a<n.length;a++)if(r=n[a],!(0<=r&&r<=255))return null;return t.parts.push(n[0]<<8|n[1]),t.parts.push(n[2]<<8|n[3]),{parts:t.parts,zoneId:t.zoneId}}return null},h.fromByteArray=function(e){const t=e.length;if(4===t)return new h.IPv4(e);if(16===t)return new h.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(e){return h.IPv6.isValid(e)||h.IPv4.isValid(e)},h.parse=function(e){if(h.IPv6.isValid(e))return h.IPv6.parse(e);if(h.IPv4.isValid(e))return h.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(e){try{return h.IPv6.parseCIDR(e)}catch(t){try{return h.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},h.subnetMatch=function(e,t,a){let s,r,n,i;for(r in null==a&&(a="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,r))for(n=t[r],!n[0]||n[0]instanceof Array||(n=[n]),s=0;s<n.length;s++)if(i=n[s],e.kind()===i[0].kind()&&e.match.apply(e,i))return r;return a},e.exports?e.exports=h:t.ipaddr=h}(this)},function(e,t,a){},function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return g})),a.d(t,"d",(function(){return h})),a.d(t,"c",(function(){return p}));var s=a(26),r=a(21),n=a.n(r),i=a(1),o=a(4);const l=(e,t)=>n.a.parse(e,{forceNow:t}),u=(e,t)=>n.a.parse(e,{roundUp:!0,forceNow:t}),c=e=>"string"==typeof e&&e.includes("now");function d(e,t={}){return{min:l(e.from,t.forceNow),max:u(e.to,t.forceNow)}}function g(e,{forceNow:t}={}){const{min:a,max:s}=d(e,{forceNow:t});return{from:a?a.toISOString():e.from,to:s?s.toISOString():e.to}}function h(e,t,a){return f(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!0)}function p(e,t,a){return f(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!1)}function f(e,t,a,r,n=!0){const g=function(e,t){return!e&&t?{name:t,type:s.b.DATE}:e?e.fields.find((a=>a.name===(t||e.timeFieldName))):void 0}(e,a);if(!g)return;let h={format:"strict_date_optional_time"};if(n){var p,f;const e=d(t,{forceNow:r});if(!e)return;h.gte=null===(p=e.min)||void 0===p?void 0:p.toISOString(),h.lte=null===(f=e.max)||void 0===f?void 0:f.toISOString()}else{var m,b;h.gte=c(t.from)?t.from:null===(m=l(t.from,r))||void 0===m?void 0:m.toISOString(),h.lte=c(t.to)?t.to:null===(b=u(t.to,r))||void 0===b?void 0:b.toISOString()}return h=Object(i.omitBy)(h,(e=>null==e)),Object(o.buildRangeFilter)(g,h,e)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return AggParamType}));var s=a(2),r=a.n(s),n=a(31),i=a(24);class AggParamType extends i.a{constructor(e){super(e),r()(this,"makeAgg",void 0),r()(this,"allowedAggs",[]),e.allowedAggs&&(this.allowedAggs=e.allowedAggs),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])}),e.serialize||(this.serialize=e=>e.serialize()),e.deserialize||(this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to AggParamType deserialize function");return this.makeAgg(t,e)}),e.toExpressionAst||(this.toExpressionAst=e=>{if(!e||!e.toExpressionAst)throw new Error("aggConfig was not provided to AggParamType toExpressionAst function");return e.toExpressionAst()}),this.makeAgg=e.makeAgg,this.getValueType=()=>n.a}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return FieldParamType}));var s=a(2),r=a.n(s),n=a(0),i=a(20),o=a(13),l=a(24),u=a(16),c=a(34);const d=Object(u.p)("type");class FieldParamType extends l.a{constructor(e){super(e),r()(this,"required",!0),r()(this,"scriptable",!0),r()(this,"filterFieldTypes",void 0),r()(this,"onlyAggregatable",void 0),r()(this,"filterField",void 0),r()(this,"getAvailableFields",(e=>e.getIndexPattern().fields.filter((e=>{const{onlyAggregatable:t,scriptable:a,filterFieldTypes:s,filterField:r}=this;return r?r(e):!(t&&(!e.aggregatable||Object(o.isNestedField)(e))||!a&&e.scripted)&&0!==d([e],s).length})))),this.filterFieldTypes=e.filterFieldTypes||"*",this.onlyAggregatable=!1!==e.onlyAggregatable,this.scriptable=!1!==e.scriptable,this.filterField=e.filterField,e.write||(this.write=(t,a)=>{const s=t.getField();if(!s){if(!1===e.required)return;throw new TypeError(n.i18n.translate("data.search.aggs.paramTypes.field.requiredFieldParameterErrorMessage",{defaultMessage:"{fieldParameter} is a required parameter",values:{fieldParameter:'"field"'}}))}const r=s.type===c.b.MISSING?s:this.getAvailableFields(t).find((e=>e.name===s.name));var o;if(!r)throw new i.SavedFieldTypeInvalidForAgg(n.i18n.translate("data.search.aggs.paramTypes.field.invalidSavedFieldParameterErrorMessage",{defaultMessage:'Saved field "{fieldParameter}" of data view "{indexPatternTitle}" is invalid for use with the "{aggType}" aggregation. Please select a new field.',values:{fieldParameter:s.name,aggType:null==t||null===(o=t.type)||void 0===o?void 0:o.title,indexPatternTitle:t.getIndexPattern().title}}));r.scripted?a.params.script={source:r.script,lang:r.lang}:a.params.field=r.name}),this.serialize=e=>e.name,this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to FieldParamType deserialize function");return t.getIndexPattern().fields.getByName(e)||new o.DataViewField({type:c.b.MISSING,name:e,searchable:!1,aggregatable:!1})}}}},function(e,t,a){"use strict";function s({from:e,to:t},a){return e?t?a(e)+" to "+a(t):"After "+a(e):"Before "+a(t)}a.d(t,"a",(function(){return s}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s=(e,t)=>"mask"===e.type?t(e.mask):`${e.from?t(e.from):"-Infinity"} to ${e.to?t(e.to):"Infinity"}`},function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return o}));var s=a(15),r=a.n(s);const n=e=>!e||!e.rawResponse,i=e=>{var t;return null!==(t=null==e?void 0:e.isRunning)&&void 0!==t&&t},o=(e,t=!0)=>{const a=e("dateFormat:tz");if("Browser"===a){if(!t)return"UTC";const e=r.a.tz.guess(),a=r()().format("Z");return e||a}return null!=a?a:"UTC"}},function(e,t,a){"use strict";a.d(t,"a",(function(){return OptionedParamType}));var s=a(2),r=a.n(s),n=a(24);class OptionedParamType extends n.a{constructor(e){super(e),r()(this,"options",void 0),e.write||(this.write=(e,t)=>{t.params[this.name]=e.params[this.name].value}),e.serialize||(this.serialize=e=>e.value),e.deserialize||(this.deserialize=e=>this.options.find((t=>t.value===e))),this.options=e.options||[]}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return StringParamType}));var s=a(24);class StringParamType extends s.a{constructor(e){super(e),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])})}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return JsonParamType}));var s=a(1),r=a.n(s),n=a(24);class JsonParamType extends n.a{constructor(e){super(e),this.name=e.name||"json",e.write||(this.write=(e,t)=>{let a;const s=e.params[this.name];if(s){try{a=JSON.parse(function(e){const t=e.split('"""');for(let e=1;e<t.length-1;e+=2)t[e]=JSON.stringify(t[e]);return t.join("")}(s))}catch(e){return}t.params=function e(t,a){return r.a.isPlainObject(t)&&r.a.isPlainObject(a)?function(t,a){return r()(t).keys().union(r.a.keys(a)).transform((function(s,r){const n=e(t[r],a[r]);void 0!==n&&(s[r]=n)}),{}).value()}(t,a):Array.isArray(t)&&Array.isArray(a)?function(t,a){return r.a.times(Math.max(t.length,a.length),(function(s){return e(t[s],a[s])}))}(t,a):null!==a?void 0!==a?a:t:void 0}(t.params,a)}})}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a(0),r=a(4),n=a(5),i=a(35),o=a(30);const l=({getStartDependencies:e})=>({name:"esdsl",type:"es_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.esdsl.help",{defaultMessage:"Run Elasticsearch request"}),args:{dsl:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.esdsl.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.esdsl.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.esdsl.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10}},async fn(t,a,{inspectorAdapters:l,abortSignal:u,getKibanaRequest:c}){const{search:d,uiSettingsClient:g}=await e(c),h=JSON.parse(a.dsl);if(t){const e=Object(o.a)(g),a=Object(r.buildEsQuery)(void 0,t.query||[],t.filters||[],e);h.query&&a.bool.must.push(h.query),h.query=a}l.requests||(l.requests=new i.RequestAdapter);const p=l.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});p.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const{rawResponse:e,requestParams:t}=await Object(n.lastValueFrom)(d({params:{index:a.index,size:a.size,body:h}},{abortSignal:u})),r={};return null!=e&&e.took&&(r.queryTime={label:s.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:s.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:s.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),null!=e&&e.hits&&(r.hitsTotal={label:s.i18n.translate("data.search.es_search.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:`${e.hits.total}`,description:s.i18n.translate("data.search.es_search.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})},r.hits={label:s.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:s.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),p.stats(r).ok({json:e,requestParams:t}),p.json(h),{type:"es_raw_response",body:e}}catch(e){throw p.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var s=a(0),r=a(4),n=a(5),i=a(35),o=a(10),l=a(30);const u=({getStartDependencies:e})=>({name:"eql",type:"eql_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.eql.help",{defaultMessage:"Run Elasticsearch request"}),args:{query:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.eql.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.eql.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.eql.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10},field:{types:["string"],help:s.i18n.translate("data.search.eql.field.help",{defaultMessage:"List of fields to retrieve"}),multi:!0,required:!1}},async fn(t,a,{inspectorAdapters:u,abortSignal:c,getKibanaRequest:d}){const{search:g,uiSettingsClient:h,dataViews:p}=await e(d),f={query:a.query,size:a.size,fields:a.field};if(t){const e=a.index?await p.create({title:a.index}):void 0,s=Object(l.a)(h),n=Object(r.buildEsQuery)(e,t.query||[],t.filters||[],s);f.filter=n}u.requests||(u.requests=new i.RequestAdapter);const m=u.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});m.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const e=await Object(n.lastValueFrom)(g({params:{index:a.index,body:f}},{abortSignal:c,strategy:o.o})),t={};return m.stats(t).ok({json:e}),m.json(f),{type:"eql_raw_response",body:e.rawResponse}}catch(e){throw m.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var s=a(26),r=a(0),n=a(35),i=a(1),o=a(5),l=a(4),u=a(30),c=a(28),d=a(10);function g(e){return["type","reason"].every((t=>t in e))?e:"error"in e?g(e.error):{}}const h=({getStartDependencies:e})=>({name:"esql",type:"datatable",inputTypes:["kibana_context","null"],allowCache:!0,help:r.i18n.translate("data.search.esql.help",{defaultMessage:"Queries Elasticsearch using ES|QL."}),args:{query:{aliases:["_","q"],types:["string"],help:r.i18n.translate("data.search.esql.query.help",{defaultMessage:"An ES|QL query."})},timeField:{aliases:["timeField"],types:["string"],help:r.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})},locale:{aliases:["locale"],types:["string"],help:r.i18n.translate("data.search.essql.locale.help",{defaultMessage:"The locale to use."})},titleForInspector:{aliases:["titleForInspector"],types:["string"],help:r.i18n.translate("data.search.esql.titleForInspector.help",{defaultMessage:"The title to show in Inspector."})},descriptionForInspector:{aliases:["descriptionForInspector"],types:["string"],help:r.i18n.translate("data.search.esql.descriptionForInspector.help",{defaultMessage:"The description to show in Inspector."})}},fn:(t,{query:a,timeField:h,locale:p,titleForInspector:f,descriptionForInspector:m},{abortSignal:b,inspectorAdapters:y,getKibanaRequest:v})=>Object(o.defer)((()=>e((()=>{const e=null==v?void 0:v();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe(Object(o.switchMap)((({search:e,uiSettings:s})=>{const i={query:a,locale:p};if(t){var v;const e=Object(u.a)(s),a=t.timeRange&&Object(c.d)(void 0,t.timeRange,{fieldName:h});i.filter=Object(l.buildEsQuery)(void 0,t.query||[],[...null!==(v=t.filters)&&void 0!==v?v:[],...a?[a]:[]],e)}let _=Date.now();const S=()=>{y.requests||(y.requests=new n.RequestAdapter);const e=y.requests.start(null!=f?f:r.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:null!=m?m:r.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},_);return _=Date.now(),e};return e({params:{...i,dropNullColumns:!0}},{abortSignal:b,strategy:d.p}).pipe(Object(o.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=g(e.attributes);e.message="parsing_exception"===t?`Couldn't parse Elasticsearch ES|QL query. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return Object(o.throwError)((()=>e))})),Object(o.tap)({next({rawResponse:e,requestParams:t}){S().stats({hits:{label:r.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.values.length}`,description:r.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}}).json(i).ok({json:e,requestParams:t})},error(e){S().json(i).error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),Object(o.map)((({rawResponse:e,warning:t})=>{var a,r,n,o,l;const u=e.all_columns&&(null===(a=e.all_columns)||void 0===a?void 0:a.length)>e.columns.length,c=new Set(u&&(null===(r=e.columns)||void 0===r?void 0:r.map((({name:e})=>e)))||[]),g=null!==(n=null===(o=null!==(l=e.all_columns)&&void 0!==l?l:e.columns)||void 0===o?void 0:o.map((({name:e,type:t})=>({id:e,name:e,meta:{type:Object(s.d)(t),esType:t},isNull:!!u&&!c.has(e)}))))&&void 0!==n?n:[];u&&g.sort(((e,t)=>Number(e.isNull)-Number(t.isNull)));const h=null==g?void 0:g.map((({name:e})=>e)),p=e.values.map((e=>Object(i.zipObject)(h,e)));return{type:"datatable",meta:{type:d.r},columns:g,rows:p,warning:t}})))})},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/dataViews/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return v})),a.d(t,"d",(function(){return d}));var s=a(1);const r=["_type","_source"];function n(e,t,a,r,i){for(const o in t){if(!t.hasOwnProperty(o))continue;const l=t[o],u=a+o,c=null==r?void 0:r.fields.getByName(u);if(!1===(null==i?void 0:i.shallow)){const t="nested"===(null==c?void 0:c.type);if(Array.isArray(l)&&!t){for(let t=0;t<l.length;t++){const a=l[t];Object(s.isPlainObject)(a)&&n(e,a,u+".",r,i)}continue}}else if(void 0!==e[u])continue;const d=c&&"conflict"!==c.type,g=!Object(s.isPlainObject)(l);d||g?e[u]?Array.isArray(e[u])?e[u].push(l):e[u]=[e[u],l]:e[u]=l:n(e,l,u+".",r,i)}}function i(e,t,a){const s={};if(n(s,e.fields||{},"",t,a),!1!==(null==a?void 0:a.source)&&e._source)n(s,e._source,"",t,a);else if(null!=a&&a.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!e.ignored_field_values.hasOwnProperty(t))continue;const a=e.ignored_field_values[t];s[t]?Array.isArray(s[t])?s[t]=[...s[t],...a]:s[t]=[s[t],...a]:s[t]=a}if(null!=t&&t.metaFields)for(let a=0;a<(null==t?void 0:t.metaFields.length);a++){const n=null==t?void 0:t.metaFields[a];r.includes(n)||"_"!==n.charAt(0)||(s[n]=e[n])}return function(e,t){function a(e,a){var s,r;const n=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(e)),i=null==t||null===(r=t.metaFields)||void 0===r?void 0:r.includes(String(a));return n&&i?String(e).localeCompare(String(a)):n?1:i?-1:String(e).localeCompare(String(a))}return new Proxy(e,{ownKeys:e=>Reflect.ownKeys(e).sort(a)})}(s,t)}const o=(e,t,a={})=>{const s=[],r=e.hits.hits.map((e=>{const r=i(e,t,a);if(r){for(const[e,a]of Object.entries(r)){const r=null==t?void 0:t.fields.getByName(e),n=(null==r?void 0:r.name)||e;if(!s.find((e=>e.id===n))){const e=(null==r?void 0:r.type)||typeof a,i=r&&(null==t?void 0:t.getFormatterForField(r));s.push({id:n,name:n,meta:{type:e,field:n,index:null==t?void 0:t.id,params:i?i.toJSON():void 0}})}}return r}})).filter((e=>e));return{type:"datatable",columns:s,rows:r}};var l=a(2),u=a.n(l);const c=(e,t)=>{let a="";try{a=e.makeLabel()}catch(e){}return{aggConfig:e,id:`col-${t}-${e.id}`,name:a}};function d(e,t){if(t)return e.map(((e,t)=>c(e,t)));const a=[],r=Object(s.groupBy)(e,(e=>e.type.type));if(!r.buckets)return r.metrics.map(((e,t)=>c(e,t)));let n=0;return r.buckets.forEach((e=>{a.push(c(e,n++)),r.metrics.forEach((e=>{a.push(c(e,n++))}))})),a}class response_writer_TabbedAggResponseWriter{constructor(e,t){u()(this,"columns",void 0),u()(this,"rows",[]),u()(this,"bucketBuffer",[]),u()(this,"metricBuffer",[]),u()(this,"partialRows",void 0),u()(this,"params",void 0),this.partialRows=t.partialRows||!1,this.params=t,this.columns=d(e.getResponseAggs(),!t.metricsAtAllLevels),this.rows=[]}row(){const e={};for(let t=0;t<this.bucketBuffer.length;t++){const a=this.bucketBuffer[t];e[a.id]=a.value}for(let t=0;t<this.metricBuffer.length;t++){const a=this.metricBuffer[t];e[a.id]=a.value}let t=!1;for(let a=0;a<this.columns.length;a++){const s=this.columns[a];if(!e.hasOwnProperty(s.id)){t=!0;break}}const a=t&&!this.partialRows;Object(s.isEmpty)(e)||a||this.rows.push(e)}response(){return{type:"datatable",columns:this.columns.map((e=>{var t,a,s,r,n,i,o,l,u,c,d,g;return{id:e.id,name:e.name,meta:{type:(null===(t=(a=e.aggConfig.type).getValueType)||void 0===t?void 0:t.call(a,e.aggConfig))||(null===(s=e.aggConfig.params.field)||void 0===s?void 0:s.type)||"number",field:null===(r=e.aggConfig.params.field)||void 0===r?void 0:r.name,index:null===(n=e.aggConfig.getIndexPattern())||void 0===n?void 0:n.title,params:e.aggConfig.toSerializedFieldFormat(),source:"esaggs",sourceParams:{hasPrecisionError:Boolean(e.hasPrecisionError),indexPatternId:null===(i=e.aggConfig.getIndexPattern())||void 0===i?void 0:i.id,appliedTimeRange:null!==(o=e.aggConfig.params.field)&&void 0!==o&&o.name&&this.params.timeRange&&this.params.timeRange.timeFields&&this.params.timeRange.timeFields.includes(null===(l=e.aggConfig.params.field)||void 0===l?void 0:l.name)?{from:null===(u=this.params.timeRange)||void 0===u||null===(c=u.from)||void 0===c?void 0:c.toISOString(),to:null===(d=this.params.timeRange)||void 0===d||null===(g=d.to)||void 0===g?void 0:g.toISOString()}:void 0,...e.aggConfig.serialize()}}}})),rows:this.rows}}}var g=a(15),h=a.n(g),p=a(27);const f=(e,t)=>(null==e?void 0:e.from)===(null==t?void 0:t.from)&&(null==e?void 0:e.to)===(null==t?void 0:t.to);class buckets_TabifyBuckets{constructor(e,t,a){u()(this,"length",void 0),u()(this,"objectMode",void 0),u()(this,"buckets",void 0),u()(this,"_keys",[]),e&&e.buckets?this.buckets=e.buckets:this.buckets=e?[e]:[],this.objectMode=Object(s.isPlainObject)(this.buckets),this.objectMode?(this._keys=Object(s.keys)(this.buckets),this.length=this._keys.length):this.length=this.buckets.length,this.length&&t&&(this.orderBucketsAccordingToParams(t.params),t.params.drop_partials&&this.dropPartials(t,a))}forEach(e){const t=this.buckets;if(this.objectMode)for(let a=0;a<this._keys.length;a++){const s=this._keys[a];e(t[s],s)}else for(let a=0;a<t.length;a++){const s=t[a];e(s,s.key)}}orderBucketsAccordingToParams(e){if(e.filters&&this.objectMode)this._keys=e.filters.map((e=>{const t=Object(s.get)(e,"input.query.query_string.query",e.input.query),a="string"==typeof t?t:JSON.stringify(t);return e.label||a||"*"}));else if(e.ranges&&this.objectMode)this._keys=e.ranges.map((e=>Object(s.findKey)(this.buckets,(t=>f(t,e)))));else if(e.ranges&&"date"!==e.field.type){let t=e.ranges;e.ipRangeType&&(t="mask"===e.ipRangeType?t.mask:t.fromTo),this.buckets=t.map((e=>e.mask?this.buckets.find((t=>t.key===e.mask)):this.buckets.find((t=>f(t,e)))))}}dropPartials(e,t){if(!t||this.buckets.length<=1||this.objectMode||!t.timeFields.includes(e.params.field.name))return;const a=e.params.used_interval?Object(p.Kd)(e.serialize().params.used_interval):h.a.duration(this.buckets[1].key-this.buckets[0].key);this.buckets=this.buckets.filter((s=>!h.a.tz(s.key,e.aggConfigs.timeZone).isBefore(t.from)&&!h.a.tz(s.key,e.aggConfigs.timeZone).add(a).isAfter(t.to))),this.length=this.buckets.length}}function m(e,t,a,r,n,i){var o,l;const u=t.columns.shift();if(u){const c=u.aggConfig;if(c.getParam("scaleMetricValues")){const t=c.write(e);n*=t.metricScale||1}switch(c.type.type){case p.d.Buckets:const d=Object(s.get)(a,c.id),g=new buckets_TabifyBuckets(d,c,null==i?void 0:i.timeRange);(null===(o=(l=c.type).hasPrecisionError)||void 0===o?void 0:o.call(l,d))&&(u.hasPrecisionError=!0),g.length?g.forEach(((a,s)=>{const r=c.getKey(a,s),o=void 0!==r;o&&t.bucketBuffer.push({id:u.id,value:r}),m(e,t,a,c.getKey(a,s),n,i),o&&t.bucketBuffer.pop()})):null!=i&&i.partialRows?(t.columns.unshift(u),b(e,t,a,r,n),t.columns.shift()):t.row();break;case p.d.Metrics:let h=c.getValue(a);1!==n&&(h*=n),t.metricBuffer.push({id:u.id,value:h}),t.columns.length?m(e,t,a,r,n,i):t.row(),t.metricBuffer.pop()}t.columns.unshift(u)}}function b(e,t,a,s,r){const n=t.columns.shift();if(n){switch(n.aggConfig.type.type){case p.d.Metrics:return t.columns.unshift(n),void m(e,t,a,s,r);case p.d.Buckets:b(e,t,a,s,r)}t.columns.unshift(n)}}function y(e){return/doc_count_/.test(e)}function v(e,t,a){var s,r,n;const i=new response_writer_TabbedAggResponseWriter(e,a||{});let o=!1;if(t.aggregations)for(const e in t.aggregations)if(y(e)){o=!0;break}const l={...e.isSamplingEnabled()?null===(s=t.aggregations)||void 0===s?void 0:s.sampling:t.aggregations,doc_count:null===(r=t.aggregations)||void 0===r?void 0:r.doc_count};var u;return l.doc_count||o||(l.doc_count=null===(u=t.hits)||void 0===u?void 0:u.total),m(e,i,l,"",1,a),{...i.response(),meta:{type:"esaggs",source:e.indexPattern.id,statistics:{totalCount:null===(n=t.hits)||void 0===n?void 0:n.total}}}}},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/fieldFormats/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return i}));var s=a(0),r=a(38);const n="aggShardDelay",i=()=>({name:n,help:s.i18n.translate("data.search.aggs.function.buckets.shardDelay.help",{defaultMessage:"Generates a serialized agg config for a Shard Delay agg"}),type:"agg_type",args:{id:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:s.i18n.translate("data.search.aggs.buckets.shardDelay.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.schema.help",{defaultMessage:"Schema to use for this aggregation"})},delay:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.delay.help",{defaultMessage:'Delay between shards to process. Example: "5s".'})},json:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:n,...i}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:n,type:r.a,params:{...i}}}}})},function(e,t){e.exports=__kbnSharedDeps__.EmotionCache},function(e,t){e.exports=__kbnSharedDeps__.KbnSearchErrors},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/bfetch/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t){e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,a){"use strict";var s,r=function(){var e={};return function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}e[t]=a}return e[t]}}(),n=[];function i(e){for(var t=-1,a=0;a<n.length;a++)if(n[a].identifier===e){t=a;break}return t}function o(e,t){for(var a={},s=[],r=0;r<e.length;r++){var o=e[r],l=t.base?o[0]+t.base:o[0],u=a[l]||0,c="".concat(l," ").concat(u);a[l]=u+1;var d=i(c),g={css:o[1],media:o[2],sourceMap:o[3]};-1!==d?(n[d].references++,n[d].updater(g)):n.push({identifier:c,updater:f(g,t),references:1}),s.push(c)}return s}function l(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var n=a.nc;n&&(s.nonce=n)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var i=r(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var u,c=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,a,s){var r=a?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=c(t,r);else{var n=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(n,i[t]):e.appendChild(n)}}function g(e,t,a){var s=a.css,r=a.media,n=a.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var h=null,p=0;function f(e,t){var a,s,r;if(t.singleton){var n=p++;a=h||(h=l(t)),s=d.bind(null,a,n,!1),r=d.bind(null,a,n,!0)}else a=l(t),s=g.bind(null,a,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(a)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var a=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<a.length;s++){var r=i(a[s]);n[r].references--}for(var l=o(e,t),u=0;u<a.length;u++){var c=i(a[u]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}a=l}}}},function(e,t,a){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a=function(e,t){var a,s,r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(a=i,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(r," */")),l=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(a,"}"):a})).join("")},t.i=function(e,a,s){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(s)for(var n=0;n<this.length;n++){var i=this[n][0];null!=i&&(r[i]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);s&&r[l[0]]||(a&&(l[2]?l[2]="".concat(a," and ").concat(l[2]):l[2]=a),t.push(l))}},t}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return r}));let s=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e.CANCELLED="cancelled",e.EXPIRED="expired",e}({}),r=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e}({})},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var s=a(0);const r={id:a(40).a,getI18nName:()=>s.i18n.translate("data.mgmt.searchSessions.appTitle",{defaultMessage:"Search Sessions"})};function n(e,t,s,n){t.management.sections.section.kibana.registerApp({id:r.id,title:r.getI18nName(),order:1.75,mount:async r=>{const{SearchSessionsMgmtApp:i}=await a.e(1).then(a.bind(null,107));return new i(e,t,s,n,r).mountManagementSection()}})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));var s=a(32),r=a.n(s),n=a(9),i=a(80),o=a(81),l=a(37),u=a.n(l),c=a(66),d=a.n(c),g=a(18);const h="eui-global",p="eui-utilities",f={darkMode:!1};var m=a(7);const b=[g.euiStylisPrefixer],y=d()({key:"css",stylisPlugins:b,container:document.querySelector('meta[name="emotion"]')}),v=d()({key:h,stylisPlugins:b,container:document.querySelector(`meta[name="${h}"]`)}),_=d()({key:p,stylisPlugins:b,container:document.querySelector(`meta[name="${p}"]`)});y.compat=!0,v.compat=!0,_.compat=!0;const S={default:y,global:v,utility:_},T=({theme:{theme$:e},globalStyles:t,colorMode:a,modify:s,children:r})=>{const i=u()(e,f),o=Object(n.useMemo)((()=>(e=>e.darkMode?g.COLOR_MODES_STANDARD.dark:g.COLOR_MODES_STANDARD.light)(i)),[i]),l=a||o,c=!1!==t&&void 0;return Object(m.jsx)(g.EuiProvider,{cache:S,modify:s,colorMode:l,globalStyles:c,utilityClasses:c},r)},E=({children:e,i18n:t,...a})=>Object(i.useIsNestedEuiProvider)()?(Object(o.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(m.jsx)(t.Context,null,e)):Object(m.jsx)(T,a,Object(m.jsx)(t.Context,null,e));var M=a(70);const F=({children:e,...t})=>Object(m.jsx)(E,r()({globalStyles:!1},t),Object(m.jsx)(M.KibanaErrorBoundaryProvider,{analytics:t.analytics},Object(m.jsx)(M.KibanaErrorBoundary,null,e)))},function(e,t){e.exports=__kbnSharedDeps__.SaferLodashSet},function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var s,r,n;if(Array.isArray(t)){if((s=t.length)!=a.length)return!1;for(r=s;0!=r--;)if(!e(t[r],a[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((s=(n=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(r=s;0!=r--;)if(!Object.prototype.hasOwnProperty.call(a,n[r]))return!1;for(r=s;0!=r--;){var i=n[r];if(!e(t[i],a[i]))return!1}return!0}return t!=t&&a!=a}},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/inspector/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t){e.exports=__kbnSharedDeps__.ElasticEuiLibComponentsUseIsNestedEuiProvider},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEuiDevProviderWarning=t.getEuiDevProviderWarning=t.emitEuiProviderWarning=void 0;var s=void 0;t.setEuiDevProviderWarning=function(e){return s=e},t.getEuiDevProviderWarning=function(){return s},t.emitEuiProviderWarning=function(e){if("function"==typeof s)return s(e);switch(s){case"log":console.log(e);break;case"warn":console.warn(e);break;case"error":throw new Error(e)}}},function(e,t,a){var s="undefined"!=typeof JSON?JSON:a(90);e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var a=t.space||"";"number"==typeof a&&(a=Array(a+1).join(" "));var i,o="boolean"==typeof t.cycles&&t.cycles,l=t.replacer||function(e,t){return t},u=t.cmp&&(i=t.cmp,function(e){return function(t,a){var s={key:t,value:e[t]},r={key:a,value:e[a]};return i(s,r)}}),c=[];return function e(t,i,d,g){var h=a?"\n"+new Array(g+1).join(a):"",p=a?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),void 0!==(d=l.call(t,i,d))){if("object"!=typeof d||null===d)return s.stringify(d);if(r(d)){for(var f=[],m=0;m<d.length;m++){var b=e(d,m,d[m],g+1)||s.stringify(null);f.push(h+a+b)}return"["+f.join(",")+h+"]"}if(-1!==c.indexOf(d)){if(o)return s.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}c.push(d);var y=n(d).sort(u&&u(d));for(f=[],m=0;m<y.length;m++){var v=e(d,i=y[m],d[i],g+1);if(v){var _=s.stringify(i)+p+v;f.push(h+a+_)}}return c.splice(c.indexOf(d),1),"{"+f.join(",")+h+"}"}}({"":e},"",e,0)};var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},n=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},a=[];for(var s in e)t.call(e,s)&&a.push(s);return a}},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/inspector/common/adapters/request");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},function(e,t,a){"use strict";const s=a(94),r=a(95),n=a(96);function i(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function o(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function l(e,t){return t.decode?r(e):e}function u(e){return Array.isArray(e)?e.sort():"object"==typeof e?u(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function c(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=c(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function g(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){i((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=a):s[e]=a};case"bracket":return(e,a,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],a):s[e]=[a]:s[e]=a};case"comma":case"separator":return(t,a,s)=>{const r="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>l(t,e))):null===a?a:l(a,e);s[t]=r};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const r of e.split("&")){let[e,i]=n(t.decode?r.replace(/\+/g," "):r,"=");i=void 0===i?null:["comma","separator"].includes(t.arrayFormat)?i:l(i,t),a(l(e,t),i,s)}for(const e of Object.keys(s)){const a=s[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=g(a[e],t);else s[e]=g(a,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce(((e,t)=>{const a=s[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=u(a):e[t]=a,e}),Object.create(null))}t.extract=d,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";i((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],s=function(e){switch(e.arrayFormat){case"index":return t=>(a,s)=>{const r=a.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[o(t,e),"[",r,"]"].join("")]:[...a,[o(t,e),"[",o(r,e),"]=",o(s,e)].join("")]};case"bracket":return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[o(t,e),"[]"].join("")]:[...a,[o(t,e),"[]=",o(s,e)].join("")];case"comma":case"separator":return t=>(a,s)=>null==s||0===s.length?a:0===a.length?[[o(t,e),"=",o(s,e)].join("")]:[[a,o(s,e)].join(e.arrayFormatSeparator)];default:return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,o(t,e)]:[...a,[o(t,e),"=",o(s,e)].join("")]}}(t),r={};for(const t of Object.keys(e))a(t)||(r[t]=e[t]);const n=Object.keys(r);return!1!==t.sort&&n.sort(t.sort),n.map((a=>{const r=e[a];return void 0===r?"":null===r?o(a,t):Array.isArray(r)?r.reduce(s(a),[]).join("&"):o(a,t)+"="+o(r,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,s]=n(e,"#");return Object.assign({url:a.split("?")[0]||"",query:h(d(e),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:l(s,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const s=c(e.url).split("?")[0]||"",r=t.extract(e.url),n=t.parse(r,{sort:!1}),i=Object.assign(n,e.query);let l=t.stringify(i,a);l&&(l=`?${l}`);let u=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(u=`#${o(e.fragmentIdentifier,a)}`),`${s}${l}${u}`}},function(e,t){e.exports=__kbnSharedDeps__.KbnEsqlAst},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,a){a(88),__kbnBundles__.define("plugin/data/public",a,102),__kbnBundles__.define("plugin/data/common",a,3)},function(e,t,a){a.p=window.__kbnPublicPath__.data},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(9),r="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;t.default=r},function(e,t,a){t.parse=a(91),t.stringify=a(92)},function(e,t){var a,s,r,n,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},o=function(e){throw{name:"SyntaxError",message:e,at:a,text:r}},l=function(e){return e&&e!==s&&o("Expected '"+e+"' instead of '"+s+"'"),s=r.charAt(a),a+=1,s},u=function(){var e,t="";for("-"===s&&(t="-",l("-"));s>="0"&&s<="9";)t+=s,l();if("."===s)for(t+=".";l()&&s>="0"&&s<="9";)t+=s;if("e"===s||"E"===s)for(t+=s,l(),"-"!==s&&"+"!==s||(t+=s,l());s>="0"&&s<="9";)t+=s,l();if(e=+t,isFinite(e))return e;o("Bad number")},c=function(){var e,t,a,r="";if('"'===s)for(;l();){if('"'===s)return l(),r;if("\\"===s)if(l(),"u"===s){for(a=0,t=0;t<4&&(e=parseInt(l(),16),isFinite(e));t+=1)a=16*a+e;r+=String.fromCharCode(a)}else{if("string"!=typeof i[s])break;r+=i[s]}else r+=s}o("Bad string")},d=function(){for(;s&&s<=" ";)l()};n=function(){switch(d(),s){case"{":return function(){var e,t={};if("{"===s){if(l("{"),d(),"}"===s)return l("}"),t;for(;s;){if(e=c(),d(),l(":"),Object.hasOwnProperty.call(t,e)&&o('Duplicate key "'+e+'"'),t[e]=n(),d(),"}"===s)return l("}"),t;l(","),d()}}o("Bad object")}();case"[":return function(){var e=[];if("["===s){if(l("["),d(),"]"===s)return l("]"),e;for(;s;){if(e.push(n()),d(),"]"===s)return l("]"),e;l(","),d()}}o("Bad array")}();case'"':return c();case"-":return u();default:return s>="0"&&s<="9"?u():function(){switch(s){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}o("Unexpected '"+s+"'")}()}},e.exports=function(e,t){var i;return r=e,a=0,s=" ",i=n(),d(),s&&o("Syntax error"),"function"==typeof t?function e(a,s){var r,n,i=a[s];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(void 0!==(n=e(i,r))?i[r]=n:delete i[r]);return t.call(a,s,i)}({"":i},""):i}},function(e,t){var a,s,r,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function o(e){return n.lastIndex=0,n.test(e)?'"'+e.replace(n,(function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function l(e,t){var n,i,u,c,d,g=a,h=t[e];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(e)),"function"==typeof r&&(h=r.call(t,e,h)),typeof h){case"string":return o(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(a+=s,d=[],"[object Array]"===Object.prototype.toString.apply(h)){for(c=h.length,n=0;n<c;n+=1)d[n]=l(n,h)||"null";return u=0===d.length?"[]":a?"[\n"+a+d.join(",\n"+a)+"\n"+g+"]":"["+d.join(",")+"]",a=g,u}if(r&&"object"==typeof r)for(c=r.length,n=0;n<c;n+=1)"string"==typeof(i=r[n])&&(u=l(i,h))&&d.push(o(i)+(a?": ":":")+u);else for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(u=l(i,h))&&d.push(o(i)+(a?": ":":")+u);return u=0===d.length?"{}":a?"{\n"+a+d.join(",\n"+a)+"\n"+g+"}":"{"+d.join(",")+"}",a=g,u}}e.exports=function(e,t,n){var i;if(a="",s="","number"==typeof n)for(i=0;i<n;i+=1)s+=" ";else"string"==typeof n&&(s=n);if(r=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return l("",{"":e})}},function(e,t,a){e.exports=a(68)(3085)},function(e,t,a){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},function(e,t,a){"use strict";var s="%[a-f0-9]{2}",r=new RegExp("("+s+")|([^%]+?)","gi"),n=new RegExp("("+s+")+","gi");function i(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],i(a),i(s))}function o(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(r)||[],a=1;a<t.length;a++)t=(e=i(t,a).join("")).match(r)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},a=n.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var s=o(a[0]);s!==a[0]&&(t[a[0]]=s)}a=n.exec(e)}t["%C2"]="";for(var r=Object.keys(t),i=0;i<r.length;i++){var l=r[i];e=e.replace(new RegExp(l,"g"),t[l])}return e}(e)}}},function(e,t,a){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(98);case"v8light":return a(100)}},function(e,t,a){var s=a(72),r=a(99);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);s(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},function(e,t,a){(t=a(73)(!1)).push([e.i,".insDataTableFormat__filter{opacity:0}.insDataTableFormat__filter:focus,.insDataTableFormat__table tr:hover .insDataTableFormat__filter{opacity:1}",""]),e.exports=t},function(e,t,a){var s=a(72),r=a(101);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);s(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},function(e,t,a){(t=a(73)(!1)).push([e.i,".insDataTableFormat__filter{opacity:0}.insDataTableFormat__filter:focus,.insDataTableFormat__table tr:hover .insDataTableFormat__filter{opacity:1}",""]),e.exports=t},function(e,t,a){"use strict";a.r(t),a.d(t,"getEsQueryConfig",(function(){return s.getEsQueryConfig})),a.d(t,"getDisplayValueFromFilter",(function(){return j})),a.d(t,"getFieldDisplayValueFromFilter",(function(){return N})),a.d(t,"generateFilters",(function(){return k})),a.d(t,"getIndexPatternFromFilter",(function(){return x})),a.d(t,"exporters",(function(){return Rt})),a.d(t,"indexPatterns",(function(){return xt})),a.d(t,"ES_FIELD_TYPES",(function(){return s.ES_FIELD_TYPES})),a.d(t,"KBN_FIELD_TYPES",(function(){return s.KBN_FIELD_TYPES})),a.d(t,"UI_SETTINGS",(function(){return s.UI_SETTINGS})),a.d(t,"fieldList",(function(){return s.fieldList})),a.d(t,"DuplicateDataViewError",(function(){return s.DuplicateDataViewError})),a.d(t,"AggGroupLabels",(function(){return s.AggGroupLabels})),a.d(t,"AggGroupNames",(function(){return s.AggGroupNames})),a.d(t,"METRIC_TYPES",(function(){return s.METRIC_TYPES})),a.d(t,"BUCKET_TYPES",(function(){return s.BUCKET_TYPES})),a.d(t,"parseSearchSourceJSON",(function(){return be.Ue})),a.d(t,"injectSearchSourceReferences",(function(){return be.me})),a.d(t,"extractSearchSourceReferences",(function(){return be.Wc})),a.d(t,"getSearchParamsFromRequest",(function(){return be.Wd})),a.d(t,"noSearchSessionStorageCapabilityMessage",(function(){return Fe})),a.d(t,"SEARCH_SESSIONS_MANAGEMENT_ID",(function(){return Te.a})),a.d(t,"waitUntilNextSessionCompletes$",(function(){return Ae})),a.d(t,"SearchSource",(function(){return be.M})),a.d(t,"SearchSessionState",(function(){return Se.a})),a.d(t,"SortDirection",(function(){return be.P})),a.d(t,"isRunningResponse",(function(){return s.isRunningResponse})),a.d(t,"search",(function(){return Nt})),a.d(t,"createSavedQueryService",(function(){return z})),a.d(t,"connectToQueryState",(function(){return oe})),a.d(t,"syncQueryStateWithUrl",(function(){return ce})),a.d(t,"syncGlobalQueryStateWithUrl",(function(){return ue})),a.d(t,"getDefaultQuery",(function(){return g})),a.d(t,"FilterManager",(function(){return filter_manager_FilterManager})),a.d(t,"TimeHistory",(function(){return time_history_TimeHistory})),a.d(t,"getQueryLog",(function(){return c})),a.d(t,"mapAndFlattenFilters",(function(){return I})),a.d(t,"QueryService",(function(){return query_service_QueryService})),a.d(t,"NowProvider",(function(){return now_provider_NowProvider})),a.d(t,"getTime",(function(){return s.getTime})),a.d(t,"isTimeRange",(function(){return s.isTimeRange})),a.d(t,"isQuery",(function(){return s.isQuery})),a.d(t,"flattenHit",(function(){return s.flattenHit})),a.d(t,"calculateBounds",(function(){return s.calculateBounds})),a.d(t,"tabifyAggResponse",(function(){return s.tabifyAggResponse})),a.d(t,"APPLY_FILTER_TRIGGER",(function(){return ft})),a.d(t,"plugin",(function(){return jt}));var s=a(3),r=a(2),n=a.n(r),i=a(1),o=a.n(i),l=a(5);const u=(e,t)=>o.a.isEqual(e,t);class persisted_log_PersistedLog{constructor(e,t={},a){n()(this,"name",void 0),n()(this,"maxLength",void 0),n()(this,"filterDuplicates",void 0),n()(this,"isDuplicate",void 0),n()(this,"storage",void 0),n()(this,"items",void 0),n()(this,"update$",new l.BehaviorSubject(void 0)),this.name=e,this.maxLength="string"==typeof t.maxLength?this.maxLength=parseInt(t.maxLength,10):t.maxLength,this.filterDuplicates=t.filterDuplicates||!1,this.isDuplicate=t.isDuplicate||u,this.storage=a,this.items=this.storage.get(this.name)||[],void 0===this.maxLength||isNaN(this.maxLength)||(this.items=o.a.take(this.items,this.maxLength))}add(e){return null==e||(this.filterDuplicates&&o.a.remove(this.items,(t=>this.isDuplicate(t,e))),this.items.unshift(e),this.maxLength&&!isNaN(this.maxLength)&&(this.items=o.a.take(this.items,this.maxLength)),this.storage.set(this.name,this.items),this.update$.next(void 0)),this.items}get(){return o.a.cloneDeep(this.items)}get$(){return this.update$.pipe(Object(l.map)((()=>this.get())))}}function c(e,t,a,r){return new persisted_log_PersistedLog(`typeahead:${a}-${r}`,{maxLength:e.get(s.UI_SETTINGS.HISTORY_LIMIT),filterDuplicates:!0},t)}function d({storage:e,uiSettings:t}){return function(a,{language:s,query:r}){c(t,e,a,s).add(r)}}function g(e="kuery"){return{query:"",language:e}}var h=a(4);const p=({$state:e},{$state:t})=>e.store===t.store?0:e.store===h.FilterStateStore.GLOBAL_STATE&&t.store!==h.FilterStateStore.GLOBAL_STATE?-1:1,f=e=>{if(!Object(h.isCombinedFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,params:s.map(A)}},m=e=>{var t;if((null===(t=e.meta)||void 0===t?void 0:t.type)===h.FILTERS.SPATIAL_FILTER)return{type:e.meta.type,key:void 0,value:void 0};throw e},b=e=>{if(Object(h.isMatchAllFilter)(e))return{type:h.FILTERS.MATCH_ALL,key:e.meta.field,value:e.meta.formattedValue||"all"};throw e},y=e=>{if(!(e=>Object(h.isPhraseFilter)(e)||Object(h.isScriptedPhraseFilter)(e))(e))throw e;return(e=>{const t=(e=>Object(i.get)(e,["query","script","script","params","value"]))(e);return{key:Boolean(t)?e.meta.field||"":Object(h.getPhraseFilterField)(e),params:{query:t||Object(h.getPhraseFilterValue)(e)},type:h.FILTERS.PHRASE}})(e)},v=e=>{if(!Object(h.isPhrasesFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,value:s,params:s}};const _=e=>{if(!(e=>Object(h.isRangeFilter)(e)||Object(h.isScriptedRangeFilter)(e))(e))throw e;return function(e){const t=Object(h.isScriptedRangeFilter)(e),a=(t?e.meta.field:(e=>e.query.range&&Object.keys(e.query.range)[0])(e))||"",s=t?Object(i.get)(e.query,"script.script.params"):((e,t)=>Object(i.get)(e.query,["range",t]))(e,a);return{type:h.FILTERS.RANGE,key:a,value:s,params:s}}(e)},S=e=>{if(Object(h.isExistsFilter)(e))return{type:h.FILTERS.EXISTS,value:h.FILTERS.EXISTS,key:Object(i.get)(e,"query.exists.field")};throw e},T=e=>{var t,a;if(Object(h.isQueryStringFilter)(e))return{type:h.FILTERS.QUERY_STRING,key:"query",value:null===(t=e.query)||void 0===t||null===(a=t.query_string)||void 0===a?void 0:a.query};throw e},E=e=>{const t=/(^\$|meta)/,a=Object(i.find)(Object(i.keys)(e),(e=>!e.match(t)));if(a)return{type:h.FILTERS.CUSTOM,key:a,value:JSON.stringify(Object(i.get)(e,a,{}))};throw e},M=()=>{throw new Error("No mappings have been found for filter.")},F=(e,t=M)=>a=>{try{return e(a)}catch(e){if(e===a)return t(a);throw e}};function A(e){const t=[f,m,b,_,y,v,S,T,E],a=Object(i.reduceRight)(t,((e,t)=>F(t,e)),(()=>{throw new Error("No mappings have been found for filter.")})),s=Object(i.cloneDeep)(e),r=a(s);return s.meta=e.meta||{},s.meta.type=r.type,s.meta.key=r.key,s.meta.value=r.value,s.meta.params=r.params,s.meta.disabled=Boolean(s.meta.disabled),s.meta.negate=Boolean(s.meta.negate),s.meta.alias=s.meta.alias||null,s}const I=e=>Object(i.compact)(Object(i.flatten)(e)).map((e=>Object(h.migrateFilter)(e))).map((e=>A(e)));var O=a(29);class filter_manager_FilterManager{constructor(e){n()(this,"filters",[]),n()(this,"updated$",new l.Subject),n()(this,"fetch$",new l.Subject),n()(this,"uiSettings",void 0),n()(this,"extract",O.a),n()(this,"inject",O.c),n()(this,"telemetry",O.e),n()(this,"getAllMigrations",O.b),this.uiSettings=e}mergeIncomingFilters(e){const t=e.globalFilters,a=e.appFilters,s=[];return o.a.each(a,(function(e,a){const r=o.a.find(t,(function(t){return Object(h.compareFilters)(t,e)}));if(!r)return s.push(e);o.a.assignIn(r.meta,e.meta)})),filter_manager_FilterManager.mergeFilters(s,t)}static mergeFilters(e,t){return Object(h.uniqFilters)(e.reverse().concat(t.reverse())).reverse()}static partitionFilters(e){const[t,a]=o.a.partition(e,h.isFilterPinned);return{globalFilters:t,appFilters:a}}handleStateUpdate(e){e.sort(p);const t=!Object(h.compareFilters)(this.filters,e,h.COMPARE_ALL_OPTIONS),a=Object(h.onlyDisabledFiltersChanged)(e,this.filters);this.filters=e,t&&(this.updated$.next(),a||this.fetch$.next())}getFilters(){return o.a.cloneDeep(this.filters)}getAppFilters(){const{appFilters:e}=this.getPartitionedFilters();return e}getGlobalFilters(){const{globalFilters:e}=this.getPartitionedFilters();return e}getPartitionedFilters(){return filter_manager_FilterManager.partitionFilters(this.getFilters())}getUpdates$(){return this.updated$.asObservable()}getFetches$(){return this.fetch$.asObservable()}addFilters(e,t=this.uiSettings.get(s.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){if(Array.isArray(e)||(e=[e]),0===e.length)return;const a=t?h.FilterStateStore.GLOBAL_STATE:h.FilterStateStore.APP_STATE;filter_manager_FilterManager.setFiltersStore(e,a);const r=I(e),n=filter_manager_FilterManager.partitionFilters(r),i=this.getPartitionedFilters();i.appFilters.push(...n.appFilters),i.globalFilters.push(...n.globalFilters);const o=this.mergeIncomingFilters(i);this.handleStateUpdate(o)}setFilters(e,t=this.uiSettings.get(s.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){const a=t?h.FilterStateStore.GLOBAL_STATE:h.FilterStateStore.APP_STATE;filter_manager_FilterManager.setFiltersStore(e,a);const r=I(e),n=filter_manager_FilterManager.partitionFilters(r),i=this.mergeIncomingFilters(n);this.handleStateUpdate(i)}setGlobalFilters(e){e=I(e),filter_manager_FilterManager.setFiltersStore(e,h.FilterStateStore.GLOBAL_STATE,!0);const{appFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({appFilters:t,globalFilters:e});this.handleStateUpdate(a)}setAppFilters(e){e=I(e),filter_manager_FilterManager.setFiltersStore(e,h.FilterStateStore.APP_STATE,!0);const{globalFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({globalFilters:t,appFilters:e});this.handleStateUpdate(a)}removeFilter(e){const t=o.a.findIndex(this.filters,(t=>o.a.isEqual(t.meta,e.meta)&&o.a.isEqual(t.query,e.query)));if(t>=0){const e=o.a.cloneDeep(this.filters);e.splice(t,1),this.handleStateUpdate(e)}}removeAll(){this.setFilters([])}static setFiltersStore(e,t,a=!1){o.a.map(e,(e=>{(a||void 0===e.$state)&&(e.$state={store:t})}))}}var w=a(26);function k(e,t,a,s,r){a=Array.isArray(a)?o.a.uniq(a):[a];const n=o.a.isObject(t)?t:{name:t},i=n.name,l=e.getAppFilters(),u="-"===s;return o.a.chain(a).map((function(e){var t;return n.type===w.b.DATE&&"string"==typeof e?{format:null!==(t=n.esTypes)&&void 0!==t&&t.includes("date_nanos")?"strict_date_optional_time_nanos":"date_time",gte:e,lte:e}:e})).map((e=>{const t=function(e,t,a){return o.a.find(e,(function(e){var s,r,n,i;if(e)return"_exists_"===t&&Object(h.isExistsFilter)(e)?e.query.exists.field===a:Object(h.isPhraseFilter)(e)?Object(h.getPhraseFilterField)(e)===t&&Object(h.getPhraseFilterValue)(e)===a:Object(h.isScriptedPhraseFilter)(e)?e.meta.field===t&&(null===(s=e.query)||void 0===s||null===(r=s.script)||void 0===r||null===(n=r.script)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.value)===a:Object(h.isRangeFilter)(e)?Object(h.getFilterField)(e)===t&&o.a.isEqual(e.query.range[t],a):void 0}))}(l,i,e);return t&&function(e,t){e.meta.disabled=!1,e.meta.negate!==t&&(e.meta.negate=!e.meta.negate)}(t,u),null!=t?t:function(e){var t;if(((null===(t=n.type)||void 0===t?void 0:t.includes("range"))||n.type===w.b.DATE)&&o.a.isObjectLike(e))return Object(h.buildFilter)(r,n,h.FILTERS.RANGE_FROM_VALUE,u,!1,e,null,h.FilterStateStore.APP_STATE);const a="_exists_"===i?h.FILTERS.EXISTS:h.FILTERS.PHRASE,s="_exists_"===i?{name:e}:n,l=null==e;return Object(h.buildFilter)(r,s,l?h.FILTERS.EXISTS:a,l?!u:u,!1,e,null,h.FilterStateStore.APP_STATE)}(e)})).value()}var R=a(0);function x(e,t){return t.find((t=>t.id===e.meta.index))}function N(e,t){var a;const s=x(e,t);if(!s)return"";const r=Object(h.getFilterField)(e);if(!r)return"";const n=s.fields.find((e=>e.name===r));return n&&"customLabel"in n&&null!==(a=n.customLabel)&&void 0!==a?a:""}function j(e,t){var a;const s=x(e,t),r=Object(h.getFilterField)(e),n=null==s?void 0:s.fields.find((e=>e.name===r)),o=null==n?void 0:n.type,l=function(e,t){if(!e||!("getFormatterForField"in e)||!t)return;const a=e.fields.find((e=>e.name===t));if(!a)throw new Error(R.i18n.translate("data.filter.filterBar.fieldNotFound",{defaultMessage:"Field {key} not found in data view {dataView}",values:{key:t,dataView:e.title}}));return e.getFormatterForField(a)}(s,r);return Object(h.isPhraseFilter)(e)||Object(h.isScriptedPhraseFilter)(e)?function(e,t,a){var s,r;const n=null!==(s=e.meta.value)&&void 0!==s?s:null===(r=e.meta.params)||void 0===r?void 0:r.query,i="number"!==a||n?n:0;return null!=t&&t.convert?t.convert(i):void 0===i?"":`${i}`}(e,l,o):Object(h.isPhrasesFilter)(e)?function(e,t){return e.meta.params.map((e=>{var a;return null!==(a=null==t?void 0:t.convert(e))&&void 0!==a?a:e})).join(", ")}(e,l):Object(h.isRangeFilter)(e)||Object(h.isScriptedRangeFilter)(e)?function({meta:{params:e}},t){const a=t?t.getConverterFor("text"):i.identity,{gte:s,gt:r,lte:n,lt:o}=e||{},l=null!=s?s:r,u=null!=n?n:o;return void 0!==l&&void 0!==u?`${a(l)} to ${a(u)}`:void 0!==s?` ${a(s)}`:void 0!==r?`> ${a(r)}`:void 0!==n?` ${a(n)}`:void 0!==o?`< ${a(o)}`:"-"}(e,l):null!==(a=e.meta.value)&&void 0!==a?a:""}class timefilter_service_TimefilterService{constructor(e){this.nowProvider=e}setup({uiSettings:e,storage:t}){const a={timeDefaults:e.get(s.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS),refreshIntervalDefaults:e.get(s.UI_SETTINGS.TIMEPICKER_REFRESH_INTERVAL_DEFAULTS)},r=new time_history_TimeHistory(t);return{timefilter:new timefilter_Timefilter(a,r,this.nowProvider),history:r}}start(){}stop(){}}var C=a(6),P=a.n(C);const L=function(e){if(e)return e.valueOf()};function D(e,t){return o.a.isObject(e)&&o.a.isObject(t)?L(e.value)!==L(t.value)||L(e.pause)!==L(t.pause):!o.a.isEqual(e,t)}class timefilter_Timefilter{constructor(e,t,a){n()(this,"enabledUpdated$",new l.BehaviorSubject(!1)),n()(this,"timeUpdate$",new l.Subject),n()(this,"refreshIntervalUpdate$",new l.Subject),n()(this,"fetch$",new l.Subject),n()(this,"_time",void 0),n()(this,"_isTimeTouched",!1),n()(this,"_refreshInterval",void 0),n()(this,"_isRefreshIntervalTouched",!1),n()(this,"_history",void 0),n()(this,"_isTimeRangeSelectorEnabled",!1),n()(this,"_isAutoRefreshSelectorEnabled",!1),n()(this,"timeDefaults",void 0),n()(this,"refreshIntervalDefaults",void 0),n()(this,"autoRefreshLoop",(()=>{let e=0;const t=new l.Subject;let a,s=0;function r(){if(n(),0===s)return;const i=window.setTimeout((()=>{let s=e;t.next((()=>{i===a&&(s--,0===s&&r())}))}),s);a=i}function n(){window.clearTimeout(a),a=-1}const o=Object(l.fromEvent)(document,"visibilitychange").pipe(Object(l.startWith)(document.visibilityState),Object(l.map)((()=>document.visibilityState)),Object(l.shareReplay)({refCount:!0,bufferSize:1})).pipe(Object(l.filter)((e=>"visible"===e))),u=t.pipe(Object(l.delayWhen)((()=>o)));return{stop:()=>{s=0,n()},start:t=>{s=t,e>0&&r()},loop$:Object(l.defer)((()=>(e++,r(),u.pipe(Object(l.map)((e=>Object(i.once)(e))))))).pipe(Object(l.finalize)((()=>{e--,0===e?n():r()})))}})()),n()(this,"getEnabledUpdated$",(()=>this.enabledUpdated$.asObservable())),n()(this,"getTimeUpdate$",(()=>this.timeUpdate$.asObservable())),n()(this,"getRefreshIntervalUpdate$",(()=>this.refreshIntervalUpdate$.asObservable())),n()(this,"getAutoRefreshFetch$",(()=>this.autoRefreshLoop.loop$)),n()(this,"getFetch$",(()=>this.fetch$.asObservable())),n()(this,"getTime",(()=>{const{from:e,to:t}=this._time;return{...this._time,from:P.a.isMoment(e)?e.toISOString():e,to:P.a.isMoment(t)?t.toISOString():t}})),n()(this,"setTime",(e=>{const t=Object.assign(this.getTime(),e);var a,s;s=t,((a=this.getTime())&&s&&o.a.isObject(a)&&o.a.isObject(s)?L(a.to)===L(s.to)&&L(a.from)===L(s.from):o.a.isEqual(a,s))||(this._time={from:t.from,to:t.to},this._isTimeTouched=!0,this._history.add(this._time),this.timeUpdate$.next(),this.fetch$.next())})),n()(this,"getRefreshInterval",(()=>o.a.clone(this._refreshInterval))),n()(this,"setRefreshInterval",(e=>{const t=this.getRefreshInterval(),a={...t,...e};let s=!1===a.pause&&null!=t;(null==t?void 0:t.value)>0&&a.value<=0&&(s=!1),this._isRefreshIntervalTouched=this._isRefreshIntervalTouched||D(this.refreshIntervalDefaults,a),a.value<=0&&(a.value=0,a.pause=!s),this._refreshInterval={value:a.value,pause:a.pause},t&&D(t,a)&&(this.refreshIntervalUpdate$.next(),a.pause||0===a.value||this.fetch$.next()),this.autoRefreshLoop.stop(),a.pause||0===a.value||this.autoRefreshLoop.start(a.value)})),n()(this,"createFilter",((e,t)=>Object(s.getTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),n()(this,"createRelativeFilter",((e,t)=>Object(s.getRelativeTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),n()(this,"enableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),n()(this,"disableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),n()(this,"enableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),n()(this,"disableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),this.nowProvider=a,this._history=t,this.timeDefaults=e.timeDefaults,this.refreshIntervalDefaults=e.refreshIntervalDefaults,this._time=e.timeDefaults,this.setRefreshInterval(e.refreshIntervalDefaults)}isTimeRangeSelectorEnabled(){return this._isTimeRangeSelectorEnabled}isAutoRefreshSelectorEnabled(){return this._isAutoRefreshSelectorEnabled}isTimeTouched(){return this._isTimeTouched}isRefreshIntervalTouched(){return this._isRefreshIntervalTouched}getAbsoluteTime(){return Object(s.getAbsoluteTimeRange)(this._time,{forceNow:this.nowProvider.get()})}getBounds(){return this.calculateBounds(this._time)}calculateBounds(e){return Object(s.calculateBounds)(e,{forceNow:this.nowProvider.get()})}getActiveBounds(){if(this.isTimeRangeSelectorEnabled())return this.getBounds()}getTimeDefaults(){return o.a.cloneDeep(this.timeDefaults)}getRefreshIntervalDefaults(){return o.a.cloneDeep(this.refreshIntervalDefaults)}}class time_history_TimeHistory{constructor(e){n()(this,"history",void 0),this.history=new persisted_log_PersistedLog("kibana.timepicker.timeHistory",{maxLength:10,filterDuplicates:!0,isDuplicate:(e,t)=>e.from===t.from&&e.to===t.to},e)}add(e){if(!e||!e.from||!e.to)return;const t={from:P.a.isMoment(e.from)?e.from.toISOString():e.from,to:P.a.isMoment(e.to)?e.to.toISOString():e.to};this.history.add(t)}get(){return this.history.get()}get$(){return this.history.get$()}}var B=a(21),q=a.n(B),G=a(19);const U="1",z=e=>({isDuplicateTitle:async(t,a)=>(await e.post(`${G.d}/_is_duplicate_title`,{body:JSON.stringify({title:t,id:a}),version:U})).isDuplicate,createQuery:async(t,{overwrite:a=!1}={})=>await e.post(`${G.d}/_create`,{body:JSON.stringify(t),version:U}),updateQuery:async(t,a)=>await e.put(`${G.d}/${t}`,{body:JSON.stringify(a),version:U}),findSavedQueries:async(t="",a=50,s=1)=>{const{total:r,savedQueries:n}=await e.post(`${G.d}/_find`,{body:JSON.stringify({page:s,perPage:a,search:t}),version:U});return{total:r,queries:n}},getSavedQuery:t=>e.get(`${G.d}/${t}`,{version:U}),deleteSavedQuery:t=>e.delete(`${G.d}/${t}`,{version:U}),getSavedQueryCount:async()=>e.get(`${G.d}/_count`,{version:U})});var $=a(17);function V({timefilter:{timefilter:e},filterManager:t,queryString:a}){return{time:e.getTime(),refreshInterval:e.getRefreshInterval(),filters:t.getFilters(),query:a.getQuery()}}class query_string_manager_QueryStringManager{constructor(e,t){n()(this,"query$",void 0),n()(this,"getUpdates$",(()=>this.query$.asObservable().pipe(Object(l.skip)(1)))),n()(this,"getQuery",(()=>this.query$.getValue())),n()(this,"setQuery",(e=>{const t=this.query$.getValue();Object(i.isEqual)(e,t)||this.query$.next(e)})),n()(this,"clearQuery",(()=>{this.setQuery(this.getDefaultQuery())})),this.storage=e,this.uiSettings=t,this.query$=new l.BehaviorSubject(this.getDefaultQuery())}getDefaultLanguage(){return this.storage.get(s.KIBANA_USER_QUERY_LANGUAGE_KEY)||this.uiSettings.get(s.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)}getDefaultQuery(){return{query:"",language:this.getDefaultLanguage()}}formatQuery(e){return e?"string"==typeof e?{query:e,language:this.getDefaultLanguage()}:e:this.getDefaultQuery()}}const[K,H]=Object($.createGetterSetter)("UiSettings"),[Y,Q]=Object($.createGetterSetter)("Overlays"),[W,J]=Object($.createGetterSetter)("IndexPatterns"),[X,Z]=Object($.createGetterSetter)("Search"),[ee,te]=Object($.createGetterSetter)("Theme");var ae=a(20);const se=e=>{var t;const a=[],{state:s,references:r}=O.a(null!==(t=e.filters)&&void 0!==t?t:[]);return a.push(...r),{state:{...e,filters:s},references:a}},re=(e,t)=>{var a;const s=O.c(null!==(a=e.filters)&&void 0!==a?a:[],t);return{...e,filters:s}},ne=(e,t)=>{var a;return{...O.e(null!==(a=e.filters)&&void 0!==a?a:[],t)}},ie=()=>{const e=Object(i.mapValues)(O.b(),(e=>t=>{var a;return{...t,filters:e(null!==(a=t.filters)&&void 0!==a?a:[])}}));return Object(ae.mergeMigrationFunctionMaps)({},e)};class query_service_QueryService{constructor(){n()(this,"filterManager",void 0),n()(this,"timefilter",void 0),n()(this,"queryStringManager",void 0),n()(this,"state$",void 0),n()(this,"extract",se),n()(this,"inject",re),n()(this,"telemetry",ne),n()(this,"getAllMigrations",ie),n()(this,"migrateToLatest",(e=>(({state:e,version:t})=>{var a;const s=O.d({state:null!==(a=e.filters)&&void 0!==a?a:[],version:t});return{...e,filters:s}})(e)))}setup({storage:e,uiSettings:t,nowProvider:a}){this.filterManager=new filter_manager_FilterManager(t);const s=new timefilter_service_TimefilterService(a);return this.timefilter=s.setup({uiSettings:t,storage:e}),this.queryStringManager=new query_string_manager_QueryStringManager(e,t),this.state$=function({timefilter:e,filterManager:t,queryString:a}){const s=Object($.createStateContainer)(V({timefilter:e,filterManager:t,queryString:a}));return new l.Observable((r=>{let n={};const i=[a.getUpdates$().subscribe((()=>{n.query=!0,s.set({...s.get(),query:a.getQuery()})})),e.timefilter.getTimeUpdate$().subscribe((()=>{n.time=!0,s.set({...s.get(),time:e.timefilter.getTime()})})),e.timefilter.getRefreshIntervalUpdate$().subscribe((()=>{n.refreshInterval=!0,s.set({...s.get(),refreshInterval:e.timefilter.getRefreshInterval()})})),t.getUpdates$().subscribe((()=>{n.filters=!0;const{filters:e}=s.get(),a=null==e?void 0:e.filter((e=>Object(h.isFilterPinned)(e))),r=null==e?void 0:e.filter((e=>!Object(h.isFilterPinned)(e))),i=t.getGlobalFilters(),o=t.getAppFilters();a&&Object(h.compareFilters)(a,i,h.COMPARE_ALL_OPTIONS)||(n.globalFilters=!0),r&&Object(h.compareFilters)(r,o,h.COMPARE_ALL_OPTIONS)||(n.appFilters=!0),s.set({...s.get(),filters:t.getFilters()})})),s.state$.pipe(Object(l.map)((e=>({state:e,changes:n}))),Object(l.tap)((()=>{n={}}))).subscribe(r)];return()=>{i.forEach((e=>e.unsubscribe()))}}))}({filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager}).pipe(Object(l.share)()),{filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager,state$:this.state$,getState:()=>this.getQueryState(),...this.getPersistableStateMethods()}}start({storage:e,uiSettings:t,http:a}){return{addToQueryLog:d({storage:e,uiSettings:t}),filterManager:this.filterManager,queryString:this.queryStringManager,savedQueries:z(a),state$:this.state$,getState:()=>this.getQueryState(),timefilter:this.timefilter,getEsQuery:(e,t)=>{const a=this.timefilter.timefilter.createFilter(e,t);return Object(h.buildEsQuery)(e,this.queryStringManager.getQuery(),[...this.filterManager.getFilters(),...a?[a]:[]],Object(s.getEsQueryConfig)(K()))},...this.getPersistableStateMethods()}}stop(){}getQueryState(){return V({timefilter:this.timefilter,queryString:this.queryStringManager,filterManager:this.filterManager})}getPersistableStateMethods(){return{extract:this.extract.bind(this),inject:this.inject.bind(this),telemetry:this.telemetry.bind(this),migrateToLatest:this.migrateToLatest.bind(this),getAllMigrations:this.getAllMigrations.bind(this)}}}const oe=({timefilter:{timefilter:e},filterManager:t,queryString:a,state$:s},r,n)=>{const i=[];if(n.time&&i.push("time"),n.query&&i.push("query"),n.refreshInterval&&i.push("refreshInterval"),n.filters)switch(n.filters){case!0:i.push("filters");break;case h.FilterStateStore.APP_STATE:i.push("appFilters");break;case h.FilterStateStore.GLOBAL_STATE:i.push("globalFilters")}const u={...r.get()};let c=!1;n.time&&!o.a.isEqual(u.time,e.getTime())&&(u.time=e.getTime(),c=!0),n.refreshInterval&&!o.a.isEqual(u.refreshInterval,e.getRefreshInterval())&&(u.refreshInterval=e.getRefreshInterval(),c=!0),n.filters&&(!0===n.filters?u.filters&&Object(h.compareFilters)(u.filters,t.getFilters(),h.COMPARE_ALL_OPTIONS)||(u.filters=t.getFilters(),c=!0):n.filters===h.FilterStateStore.GLOBAL_STATE?u.filters&&Object(h.compareFilters)(u.filters,t.getGlobalFilters(),{...h.COMPARE_ALL_OPTIONS,state:!1})||(u.filters=t.getGlobalFilters(),c=!0):n.filters===h.FilterStateStore.APP_STATE&&(u.filters&&Object(h.compareFilters)(u.filters,t.getAppFilters(),{...h.COMPARE_ALL_OPTIONS,state:!1})||(u.filters=t.getAppFilters(),c=!0))),c&&r.set({...r.get(),...u});let d=!1;const g=[s.pipe(Object(l.filter)((({changes:e,state:t})=>!d&&i.some((t=>e[t])))),Object(l.map)((({changes:s})=>{const r={};return n.time&&s.time&&(r.time=e.getTime()),n.query&&s.query&&(r.query=a.getQuery()),n.refreshInterval&&s.refreshInterval&&(r.refreshInterval=e.getRefreshInterval()),n.filters&&(!0===n.filters&&s.filters?r.filters=t.getFilters():n.filters===h.FilterStateStore.GLOBAL_STATE&&s.globalFilters?r.filters=t.getGlobalFilters():n.filters===h.FilterStateStore.APP_STATE&&s.appFilters&&(r.filters=t.getAppFilters())),r}))).subscribe((e=>{r.set({...r.get(),...e})})),r.state$.subscribe((s=>{if(d=!0,n.time){const t=function(e){if(!e)return!1;const t=q.a.parse(e.from),a=q.a.parse(e.to);return!!(t&&t.isValid()&&a&&a.isValid())}(s.time)?s.time:e.getTimeDefaults();o.a.isEqual(t,e.getTime())||e.setTime(o.a.cloneDeep(t))}if(n.refreshInterval){const t=s.refreshInterval||e.getRefreshIntervalDefaults();o.a.isEqual(t,e.getRefreshInterval())||e.setRefreshInterval(o.a.cloneDeep(t))}if(n.query){const e=s.query||a.getQuery();o.a.isEqual(e,a.getQuery())||a.setQuery(o.a.cloneDeep(e))}if(n.filters){const e=s.filters||[];!0===n.filters?Object(h.compareFilters)(e,t.getFilters(),h.COMPARE_ALL_OPTIONS)||t.setFilters(o.a.cloneDeep(e)):n.filters===h.FilterStateStore.APP_STATE?Object(h.compareFilters)(e,t.getAppFilters(),{...h.COMPARE_ALL_OPTIONS,state:!1})||t.setAppFilters(o.a.cloneDeep(e)):n.filters===h.FilterStateStore.GLOBAL_STATE&&(Object(h.compareFilters)(e,t.getGlobalFilters(),{...h.COMPARE_ALL_OPTIONS,state:!1})||t.setGlobalFilters(o.a.cloneDeep(e)))}d=!1}))];return()=>{g.forEach((e=>e.unsubscribe()))}},le="_g",ue=(e,t)=>{const{timefilter:{timefilter:a},filterManager:s}=e,r={time:a.getTime(),refreshInterval:a.getRefreshInterval(),filters:s.getGlobalFilters()},n=t.get(le),i=Boolean(n&&Object.keys(n).length),o={...r,...n},l=Object($.createStateContainer)(o),u=oe(e,l,{refreshInterval:!0,time:!0,filters:h.FilterStateStore.GLOBAL_STATE});n||t.set(le,o,{replace:!0}),l.set(o);const{start:c,stop:d}=Object($.syncState)({stateStorage:t,stateContainer:{...l,set:e=>{e&&l.set(e)}},storageKey:le});return c(),{stop:()=>{u(),d()},hasInheritedQueryFromUrl:i}},ce=ue;var de=a(45),ge=a(14);var he=a(59),pe=a(35),fe=a(30),me=a(28),be=a(10);function ye(e){return e.replace(/[\(\)]/g,"_")}var ve=a(61),_e=a(60),Se=a(22),Te=a(40);class session_service_SessionService{constructor(e,t,a,s,r,{freezeState:i=!0}={freezeState:!0}){n()(this,"state$",void 0),n()(this,"state",void 0),n()(this,"sessionMeta$",void 0),n()(this,"_disableSaveAfterSearchesExpire$",new l.BehaviorSubject(!1)),n()(this,"disableSaveAfterSearchesExpire$",void 0),n()(this,"searchSessionInfoProvider",void 0),n()(this,"searchSessionIndicatorUiConfig",void 0),n()(this,"subscription",new l.Subscription),n()(this,"currentApp",void 0),n()(this,"hasAccessToSearchSessions",!1),n()(this,"toastService",void 0),n()(this,"lastSessionSnapshot",void 0),this.sessionsClient=a,this.nowProvider=s,this.usageCollector=r;const{stateContainer:o,sessionState$:u,sessionMeta$:c}=Object(Se.c)({freeze:i});this.state$=u,this.state=o,this.sessionMeta$=c,this.disableSaveAfterSearchesExpire$=Object(l.combineLatest)([this._disableSaveAfterSearchesExpire$,this.sessionMeta$.pipe(Object(l.map)((e=>e.isContinued)))]).pipe(Object(l.map)((([e,t])=>e||t)),Object(l.distinctUntilChanged)());const d=P.a.duration(e.config.get().search.sessions.notTouchedTimeout).asMilliseconds();this.subscription.add(this.state$.pipe(Object(l.switchMap)((e=>e===Se.a.Completed?Object(l.merge)(Object(l.of)(!1),Object(l.timer)(d).pipe(Object(l.mapTo)(!0))):Object(l.of)(!1))),Object(l.distinctUntilChanged)(),Object(l.tap)((e=>{var t;e&&(null===(t=this.usageCollector)||void 0===t||t.trackSessionIndicatorSaveDisabled())}))).subscribe(this._disableSaveAfterSearchesExpire$)),this.subscription.add(c.pipe(Object(l.map)((e=>e.startTime)),Object(l.distinctUntilChanged)()).subscribe((e=>{e?this.nowProvider.set(e):this.nowProvider.reset()}))),t().then((([t])=>{var a,s;this.hasAccessToSearchSessions=null===(a=t.application.capabilities.management)||void 0===a||null===(s=a.kibana)||void 0===s?void 0:s[Te.a],this.toastService=t.notifications.toasts,this.subscription.add(t.application.currentAppId$.subscribe((a=>{if(this.currentApp=a,!this.getSessionId())return;const s=`Application '${this.state.get().appName}' had an open session while navigating`;e.env.mode.dev?t.fatalErrors.add(s):console.warn(s)})))})),this.subscription.add(this.getSession$().pipe(Object(l.switchMap)((e=>e?this.isStored()?l.EMPTY:this.hasAccess()&&this.isSessionStorageReady()?(()=>Object(l.timer)(3e4).pipe(Object(l.mergeMap)((()=>{const t=this.state.get().trackedSearches.filter((e=>!e.searchMeta.isStored&&e.state===Se.b.Completed&&e.searchMeta.lastPollingTime.getTime()<Date.now()-5e3));return Object(l.from)(Promise.all(t.map((t=>t.searchDescriptor.poll().catch((t=>{console.warn("Error while polling search to keep it alive. Considering that it is no longer possible to extend a session.",t),this.isCurrentSession(e)&&this._disableSaveAfterSearchesExpire$.next(!0)}))))))})),Object(l.repeat)(),Object(l.takeUntil)(this.disableSaveAfterSearchesExpire$.pipe(Object(l.filter)((e=>e))))))():l.EMPTY:l.EMPTY))).subscribe((()=>{})))}hasAccess(){return this.hasAccessToSearchSessions}trackSearch(e){return this.state.transitions.trackSearch(e,{lastPollingTime:new Date,isStored:!1}),{complete:()=>{if(this.state.transitions.completeSearch(e),this.isStored()){const t=this.state.selectors.getSearch(e);t&&!t.searchMeta.isStored&&t.searchDescriptor.poll().catch((e=>{console.warn("Failed to extend search after it was completed",e)}))}},error:()=>{this.state.transitions.errorSearch(e)},beforePoll:()=>{var t,a;const s=this.state.selectors.getSearch(e);return this.state.transitions.updateSearchMeta(e,{lastPollingTime:new Date}),[{isSearchStored:null!==(t=null==s||null===(a=s.searchMeta)||void 0===a?void 0:a.isStored)&&void 0!==t&&t},({isSearchStored:t})=>{this.state.transitions.updateSearchMeta(e,{isStored:t})}]}}}destroy(){this.subscription.unsubscribe(),this.clear(),this.lastSessionSnapshot=void 0}getSessionId(){return this.state.get().sessionId}getSession$(){return this.state.state$.pipe(Object(l.startWith)(this.state.get()),Object(l.map)((e=>e.sessionId)),Object(l.distinctUntilChanged)())}isStored(){return this.state.get().isStored}isRestore(){return this.state.get().isRestore}start(){if(!this.currentApp)throw new Error("this.currentApp is missing");return this.state.transitions.start({appName:this.currentApp}),this.getSessionId()}restore(e){this.state.transitions.restore(e),this.refreshSearchSessionSavedObject()}continue(e){var t,a;(null===(t=this.lastSessionSnapshot)||void 0===t?void 0:t.sessionId)===e?(this.state.set({...this.lastSessionSnapshot,appName:this.currentApp,trackedSearches:[],isContinued:!0}),this.lastSessionSnapshot=void 0):console.warn(`Continue search session: last known search session id: "${null===(a=this.lastSessionSnapshot)||void 0===a?void 0:a.sessionId}", but received ${e}`)}clear(){const e=this.state.get().appName;e&&e!==this.currentApp?console.warn(`Skip clearing session "${this.getSessionId()}" because it belongs to a different app. current: "${this.currentApp}", owner: "${e}"`):(this.getSessionId()&&(this.lastSessionSnapshot=this.state.get()),this.state.transitions.clear(),this.searchSessionInfoProvider=void 0,this.searchSessionIndicatorUiConfig=void 0)}async cancel(){const e=this.isStored();this.state.get().trackedSearches.filter((e=>e.state===Se.b.InProgress)).forEach((e=>{e.searchDescriptor.abort()})),this.state.transitions.cancel(),e&&await this.sessionsClient.delete(this.state.get().sessionId)}async save(){const e=this.getSessionId();if(!e)throw new Error("No current session");const t=this.state.get().appName;if(!t)throw new Error("No current session app");if(!this.hasAccess())throw new Error("No access to search sessions");const a=this.searchSessionInfoProvider;if(!a)throw new Error("No info provider for current session");const[s,{initialState:r,restoreState:n,id:i}]=await Promise.all([a.getName(),a.getLocatorData()]),o=(u=s,(c={sessionStartTime:this.state.get().startTime,appendStartTime:a.appendSessionStartTimeToName}).sessionStartTime&&c.appendStartTime&&(u=function(e,t){return`${e} - ${P()(t).format("L @ LT")}`}(u,c.sessionStartTime)),u),l=await this.sessionsClient.create({name:o,appId:t,locatorId:i,restoreState:n,initialState:r,sessionId:e});var u,c;if(this.isCurrentSession(e)){this.state.transitions.store(l);const t=this.state.get().trackedSearches.filter((e=>e.state!==Se.b.Errored&&!e.searchMeta.isStored)),a=Promise.all(t.map((e=>e.searchDescriptor.poll().catch((e=>{console.warn("Failed to extend search after session was saved",e)})))));this.state.get().trackedSearches.filter((e=>e.searchDescriptor.onSavingSession)).forEach((t=>t.searchDescriptor.onSavingSession({sessionId:e,isRestore:this.isRestore(),isStored:this.isStored()}).catch((e=>{console.warn('Failed to execute "onSavingSession" handler after session was saved',e)})))),await a}}async renameCurrentSession(e){const t=this.getSessionId();if(t&&this.state.get().isStored){let s=!1;try{await this.sessionsClient.rename(t,e),s=!0}catch(e){var a;null===(a=this.toastService)||void 0===a||a.addError(e,{title:R.i18n.translate("data.searchSessions.sessionService.sessionEditNameError",{defaultMessage:"Failed to edit name of the search session"})})}s&&t===this.getSessionId()&&await this.refreshSearchSessionSavedObject()}}isCurrentSession(e){return!!e&&this.getSessionId()===e}getSearchOptions(e){if(!e)return null;if(!this.hasAccessToSearchSessions)return null;const t=this.isCurrentSession(e);return{sessionId:e,isRestore:!!t&&this.isRestore(),isStored:!!t&&this.isStored()}}enableStorage(e,t){this.searchSessionInfoProvider={appendSessionStartTimeToName:!0,...e},this.searchSessionIndicatorUiConfig=t}isSessionStorageReady(){return!!this.searchSessionInfoProvider}getSearchSessionIndicatorUiConfig(){return{isDisabled:()=>({disabled:!1}),...this.searchSessionIndicatorUiConfig}}async refreshSearchSessionSavedObject(){const e=this.getSessionId();if(e&&this.state.get().isStored)try{const t=await this.sessionsClient.get(e);this.getSessionId()===e&&this.state.transitions.setSearchSessionSavedObject(t)}catch(e){var t;null===(t=this.toastService)||void 0===t||t.addError(e,{title:R.i18n.translate("data.searchSessions.sessionService.sessionObjectFetchError",{defaultMessage:"Failed to fetch search session info"})})}}}const Ee="1",Me={version:Ee};class sessions_client_SessionsClient{constructor(e){n()(this,"http",void 0),this.http=e.http}get(e){return this.http.get(`/internal/session/${encodeURIComponent(e)}`,Me)}create({name:e,appId:t,locatorId:a,initialState:s,restoreState:r,sessionId:n}){return this.http.post("/internal/session",{version:Ee,body:JSON.stringify({name:e,appId:t,locatorId:a,initialState:s,restoreState:r,sessionId:n})})}find(e){return this.http.post("/internal/session/_find",{version:Ee,body:JSON.stringify(e)})}update(e,t){return this.http.put(`/internal/session/${encodeURIComponent(e)}`,{version:Ee,body:JSON.stringify(t)})}async rename(e,t){await this.update(e,{name:t})}async extend(e,t){await this.http.post(`/internal/session/${encodeURIComponent(e)}/_extend`,{version:Ee,body:JSON.stringify({expires:t})})}delete(e){return this.http.delete(`/internal/session/${encodeURIComponent(e)}`,Me)}}const Fe=R.i18n.translate("data.searchSessionIndicator.noCapability",{defaultMessage:"You don't have permissions to create search sessions."});function Ae(e,{waitForIdle:t=1e3}={waitForIdle:1e3}){return e.state$.pipe(Object(l.skipUntil)(e.state$.pipe(Object(l.first)((e=>e===Se.a.None)))),Object(l.skipUntil)(e.state$.pipe(Object(l.first)((e=>e===Se.a.Loading)))),Object(l.debounceTime)(t),Object(l.first)((e=>e===Se.a.Completed||e===Se.a.BackgroundCompleted)))}Date.now();var Ie=a(44),Oe=a(79),we=a(69),ke=a(33);class bfetch_error_BfetchRequestError extends Error{constructor(e){super(0===e?R.i18n.translate("bfetchError.networkError",{defaultMessage:"Check your network connection and try again."}):R.i18n.translate("bfetchError.networkErrorWithStatus",{defaultMessage:"Check your network connection and try again. Code {code}",values:{code:e}})),n()(this,"code",void 0),this.name="BfetchRequestError",this.code=e}}var Re=a(67),xe=a(9),Ne=a.n(xe),je=a(18),Ce=a(7);let Pe=function(e){return e[e.CONTACT=0]="CONTACT",e[e.CHANGE=1]="CHANGE",e}({});class timeout_error_SearchTimeoutError extends ae.KbnError{constructor(e,t){super(`Request timeout: ${JSON.stringify(null==e?void 0:e.message)}`),n()(this,"mode",void 0),this.mode=t}getMessage(){switch(this.mode){case Pe.CONTACT:return R.i18n.translate("data.search.timeoutContactAdmin",{defaultMessage:"Your query has timed out. Contact your system administrator to increase the run time."});case Pe.CHANGE:return R.i18n.translate("data.search.timeoutIncreaseSetting",{defaultMessage:"Your query has timed out. Increase run time with the search timeout advanced setting."})}}getActionText(){if(this.mode===Pe.CHANGE)return R.i18n.translate("data.search.timeoutIncreaseSettingActionText",{defaultMessage:"Edit setting"})}onClick(e){this.mode===Pe.CHANGE&&e.navigateToApp("management",{path:"/kibana/settings"})}getErrorMessage(e){const t=this.getActionText();return Object(Ce.jsx)(Ne.a.Fragment,null,this.getMessage(),t&&Object(Ce.jsx)(Ne.a.Fragment,null,Object(Ce.jsx)(je.EuiSpacer,{size:"s"}),Object(Ce.jsx)(je.EuiText,{textAlign:"right"},Object(Ce.jsx)(je.EuiButton,{color:"danger",onClick:()=>this.onClick(e),size:"s","data-test-subj":"searchTimeoutError"},t))))}}var Le=a(71);function De(e){const{rawResponse:t}=e,{_clusters:a}=t;if(a){const s=Object.fromEntries(Object.keys(a.details).map((e=>[e,"running"!==a.details[e].status?a.details[e]:{...a.details[e],status:"partial",timed_out:!0}])));return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0,_clusters:{...a,details:s}}}}return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0}}}class search_response_cache_SearchResponseCache{constructor(e,t){n()(this,"responseCache",void 0),n()(this,"cacheSize",0),this.maxItems=e,this.maxCacheSizeMB=t,this.responseCache=new Map}byteToMb(e){return e/1048576}deleteItem(e,t=!0){const a=this.responseCache.get(e);a&&(t&&a.subs.unsubscribe(),this.cacheSize-=a.size,this.responseCache.delete(e))}setItem(e,t){this.deleteItem(e,!1),this.cacheSize+=t.size,this.responseCache.set(e,t)}clear(){this.cacheSize=0,this.responseCache.forEach((e=>{e.subs.unsubscribe()})),this.responseCache.clear()}shrink(){for(;this.responseCache.size>this.maxItems||this.byteToMb(this.cacheSize)>this.maxCacheSizeMB;){const[e]=[...this.responseCache.keys()];this.deleteItem(e)}}has(e){return this.responseCache.has(e)}set(e,t){if(this.responseCache.has(e))throw new Error("duplicate key");const{response$:a,searchAbortController:s}=t,r={response$:a,searchAbortController:s,subs:new l.Subscription,size:0};this.setItem(e,r),r.subs.add(a.subscribe({next:t=>{const a=new Blob([JSON.stringify(t)]).size;this.byteToMb(a)<this.maxCacheSizeMB?(this.setItem(e,{...r,size:a}),this.shrink()):this.deleteItem(e)},error:t=>{this.deleteItem(e)}})),this.shrink()}get(e){const t=this.responseCache.get(e);if(t)return this.setItem(e,t),{response$:t.response$,searchAbortController:t.searchAbortController}}}let Be=function(e){return e.Timeout="timeout",e}({});class search_abort_controller_SearchAbortController{constructor(e){n()(this,"inputAbortSignals",new Array),n()(this,"abortController",new AbortController),n()(this,"timeoutSub",void 0),n()(this,"destroyed",!1),n()(this,"reason",void 0),n()(this,"abortHandler",(()=>{this.inputAbortSignals.every((e=>e.aborted))&&(this.abortController.abort(),this.cleanup())})),e&&(this.timeoutSub=Object(l.timer)(e).subscribe((()=>{this.reason=Be.Timeout,this.abortController.abort(),this.timeoutSub.unsubscribe()})))}cleanup(){var e;this.destroyed||(this.destroyed=!0,null===(e=this.timeoutSub)||void 0===e||e.unsubscribe(),this.inputAbortSignals.forEach((e=>{e.removeEventListener("abort",this.abortHandler)})))}addAbortSignal(e){this.destroyed||(this.inputAbortSignals.push(e),e.aborted?this.abortHandler():e.addEventListener("abort",this.abortHandler))}getSignal(){return this.abortController.signal}abort(){this.cleanup(),this.abortController.abort()}isTimeout(){return this.reason===Be.Timeout}}var qe=a(114),Ge=a(82),Ue=a.n(Ge);class search_interceptor_SearchInterceptor{constructor(e){n()(this,"uiSettingsSubs",[]),n()(this,"searchTimeout",void 0),n()(this,"bFetchDisabled",void 0),n()(this,"responseCache",new search_response_cache_SearchResponseCache(50,10)),n()(this,"pendingCount$",new l.BehaviorSubject(0)),n()(this,"application",void 0),n()(this,"docLinks",void 0),n()(this,"batchedFetch",void 0),n()(this,"inspector",void 0),n()(this,"startRenderServices",void 0),n()(this,"showTimeoutErrorToast",((e,t)=>{this.deps.toasts.addDanger({title:"Timed out",text:Object(ke.a)(e.getErrorMessage(this.application),this.startRenderServices)})})),n()(this,"showTimeoutErrorMemoized",Object(i.memoize)(this.showTimeoutErrorToast,((e,t)=>t))),n()(this,"showRestoreWarningToast",(e=>{var t;this.deps.toasts.addWarning({title:"Your search session is still running",text:Object(ke.a)((t=this.docLinks,Object(Ce.jsx)(Ne.a.Fragment,null,Object(Ce.jsx)(je.EuiSpacer,{size:"s"}),"It needs more time to fully render. You can wait here or come back to it later.",Object(Ce.jsx)(je.EuiSpacer,{size:"m"}),Object(Ce.jsx)(je.EuiText,{textAlign:"right"},Object(Ce.jsx)(je.EuiLink,{href:t.links.search.sessionLimits,color:"warning",target:"_blank","data-test-subj":"searchSessionIncompleteWarning",external:!0},Object(Ce.jsx)(Le.FormattedMessage,{id:"data.searchSession.warning.readDocs",defaultMessage:"Read More"}))))),this.startRenderServices)},{toastLifeTimeMs:6e4})})),n()(this,"showRestoreWarning",Object(i.memoize)(this.showRestoreWarningToast)),n()(this,"showTimeoutError",((e,t)=>{t?this.showTimeoutErrorMemoized(e,t):this.showTimeoutErrorToast(e,t)})),this.deps=e,this.deps.http.addLoadingCountSource(this.pendingCount$),this.deps.startServices.then((([e,t])=>{const{application:a,docLinks:s,analytics:r,i18n:n,theme:i}=e;this.application=a,this.docLinks=s,this.startRenderServices={analytics:r,i18n:n,theme:i},this.inspector=t.inspector})),this.batchedFetch=e.bfetch.batchedFunction({url:"/internal/bsearch"}),this.searchTimeout=e.uiSettings.get(s.UI_SETTINGS.SEARCH_TIMEOUT),this.bFetchDisabled=e.uiSettings.get(we.DISABLE_BFETCH),this.uiSettingsSubs.push(e.uiSettings.get$(s.UI_SETTINGS.SEARCH_TIMEOUT).subscribe((e=>{this.searchTimeout=e})),e.uiSettings.get$(we.DISABLE_BFETCH).subscribe((e=>{this.bFetchDisabled=e})))}stop(){this.responseCache.clear(),this.uiSettingsSubs.forEach((e=>e.unsubscribe()))}getTimeoutMode(){var e;return null!==(e=this.application.capabilities.advancedSettings)&&void 0!==e&&e.save?Pe.CHANGE:Pe.CONTACT}createRequestHash$(e,t){const{sessionId:a}=t,{preference:s,...r}=e.params||{},n={...r,sessionId:a};if(!a)return Object(l.of)(void 0);const i=this.deps.session.getSearchOptions(t.sessionId);return null!=i&&i.isRestore?Object(l.of)(void 0):Object(l.from)(async function(e){return(new qe.a).update(Ue()(e),"utf8").digest("hex")}(n))}handleSearchError(e,t,a,s){if(s||"Request timed out"===e.message){const t=new timeout_error_SearchTimeoutError(e,this.getTimeoutMode());return this.showTimeoutError(t,null==a?void 0:a.sessionId),t}if(e instanceof $.AbortError||e instanceof bfetch_error_BfetchRequestError)return e;if(Object(Re.isEsError)(e)){const s=()=>{var s,r,n,i,o;const l=null!==(s=null==a||null===(r=a.inspector)||void 0===r?void 0:r.id)&&void 0!==s?s:Object(Ie.v4)(),u=null!==(n=null==a||null===(i=a.inspector)||void 0===i?void 0:i.adapter)&&void 0!==n?n:new Oe.RequestAdapter;if(null==a||null===(o=a.inspector)||void 0===o||!o.adapter){const a=u.start(R.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),{id:l});a.json(t),a.error({json:e.attributes})}this.inspector.open({requests:u},{options:{initialRequestId:l,initialTabs:["clusters","response"]}})};return Object(Re.createEsError)(e,s,{application:this.application,docLinks:this.docLinks},null==a?void 0:a.indexPattern)}return e instanceof Error?e:new Error(e.message)}getSerializableOptions(e){const{sessionId:t,...a}=e||{},s={},r={...a,...this.deps.session.getSearchOptions(t)};return void 0!==r.sessionId&&(s.sessionId=r.sessionId),void 0!==r.isRestore&&(s.isRestore=r.isRestore),void 0!==r.retrieveResults&&(s.retrieveResults=r.retrieveResults),void 0!==r.legacyHitsTotal&&(s.legacyHitsTotal=r.legacyHitsTotal),void 0!==r.strategy&&(s.strategy=r.strategy),void 0!==r.isStored&&(s.isStored=r.isStored),void 0!==r.isSearchStored&&(s.isSearchStored=r.isSearchStored),void 0!==r.executionContext&&(s.executionContext=r.executionContext),s}runSearch$({id:e,...t},a,r){const{sessionId:n,strategy:o}=a,u=()=>{var s;const[{isSearchStored:i},o]=null!==(s=null==c?void 0:c.beforePoll())&&void 0!==s?s:[{isSearchStored:!1},()=>{}];return this.runSearch({id:e,...t},{...a,...this.deps.session.getSearchOptions(n),abortSignal:r.getSignal(),isSearchStored:i}).then((e=>{var t;return o({isSearchStored:null!==(t=e.isStored)&&void 0!==t&&t}),e})).catch((e=>{throw o({isSearchStored:!1}),e}))},c=this.deps.session.isCurrentSession(n)?this.deps.session.trackSearch({abort:()=>r.abort(),poll:async()=>{e&&await u()}}):void 0;let d=this.deps.session.isCurrentSession(n)&&this.deps.session.isStored();const g=this.deps.session.isCurrentSession(n)&&this.deps.session.state$.pipe(Object(l.skip)(1),Object(l.filter)((e=>this.deps.session.isCurrentSession(n)&&e===Se.a.BackgroundLoading)),Object(l.take)(1)).subscribe((()=>{d=!0})),h=Object(i.once)((()=>this.deps.http.delete(`/internal/search/${o}/${e}`,{version:"1"}))),p=async()=>{if(e&&!d&&!r.isTimeout())try{await h()}catch(e){console.error(e)}};let f;return Object(s.pollSearch)(u,p,{pollInterval:this.deps.searchConfig.asyncSearch.pollInterval,...a,abortSignal:r.getSignal()}).pipe(Object(l.tap)((t=>{!f&&t.requestParams&&(f=t.requestParams),e=t.id,Object(s.isRunningResponse)(t)||null==c||c.complete()})),Object(l.map)((e=>f?{...e,requestParams:f}:e)),Object(l.catchError)((s=>r.isTimeout()?Object(l.from)(this.runSearch({id:e,...t},{...a,retrieveResults:!0})).pipe(Object(l.map)(De),Object(l.tap)((async()=>{var e,r;await h(),this.handleSearchError(s,null!==(e=null==t||null===(r=t.params)||void 0===r?void 0:r.body)&&void 0!==e?e:{},a,!0)}))):(null==c||c.error(),p(),Object(l.throwError)(s)))),Object(l.finalize)((()=>{r.cleanup(),g&&g.unsubscribe()})),Object(l.shareReplay)(1))}runSearch(e,t){const{abortSignal:a}=t||{};if(this.bFetchDisabled){const{executionContext:s,strategy:r,...n}=this.getSerializableOptions(t);return this.deps.http.post(`/internal/search/${r}${e.id?`/${e.id}`:""}`,{version:"1",signal:a,context:s,body:JSON.stringify({...e,...n})}).catch((e=>{throw null!=e&&e.body?e.body:e}))}{const{executionContext:s,...r}=t||{};return this.batchedFetch({request:e,options:this.getSerializableOptions({...r,executionContext:this.deps.executionContext.withGlobalContext(s)})},a)}}getSearchResponse$(e,t,a){var s;const r=a?this.responseCache.get(a):void 0,n=(null==r?void 0:r.searchAbortController)||new search_abort_controller_SearchAbortController(this.searchTimeout);n.addAbortSignal(null!==(s=t.abortSignal)&&void 0!==s?s:(new AbortController).signal);const i=(null==r?void 0:r.response$)||this.runSearch$(e,t,n);return a&&!this.responseCache.has(a)&&this.responseCache.set(a,{response$:i,searchAbortController:n}),{response$:i,searchAbortController:n}}search({id:e,...t},a={}){const r={...a};r.strategy||(r.strategy=s.ENHANCED_ES_SEARCH_STRATEGY);const{sessionId:n,abortSignal:i}=r;return this.createRequestHash$(t,r).pipe(Object(l.switchMap)((e=>{const{searchAbortController:a,response$:s}=this.getSearchResponse$(t,r,e);this.pendingCount$.next(this.pendingCount$.getValue()+1);const o=(i?Object(l.fromEvent)(i,"abort"):l.EMPTY).pipe(Object(l.map)((()=>{throw new $.AbortError})));return s.pipe(Object(l.takeUntil)(o),Object(l.catchError)((e=>{var s,n;return Object(l.throwError)(this.handleSearchError(e,null!==(s=null==t||null===(n=t.params)||void 0===n?void 0:n.body)&&void 0!==s?s:{},r,a.isTimeout()))})),Object(l.tap)((e=>{n&&n===this.deps.session.getSessionId()&&this.deps.session.isRestore()&&!1===e.isRestored&&this.showRestoreWarning(n)})),Object(l.finalize)((()=>{this.pendingCount$.next(this.pendingCount$.getValue()-1)})))})))}showError(e){if(e instanceof $.AbortError||e instanceof timeout_error_SearchTimeoutError)return;const t=Object(Re.renderSearchError)(e);t?this.deps.toasts.addDanger({title:t.title,text:Object(ke.a)(t.body,this.startRenderServices)}):this.deps.toasts.addError(e,{title:"Search Error"})}}const ze=R.i18n.translate("searchResponseWarnings.viewDetailsButtonLabel",{defaultMessage:"View details",description:"View warning details button label"});function $e(e){const t=new Set;return e.forEach((e=>{Object.keys(e.clusters).forEach((a=>{"successful"!==e.clusters[a].status&&t.add(a)}))})),t}function Ve(e){const t=$e(e),a=R.i18n.translate("searchResponseWarnings.title.clustersClause",{defaultMessage:"Problem with {nonSuccessfulClustersCount} {nonSuccessfulClustersCount, plural, one {cluster} other {clusters}}",values:{nonSuccessfulClustersCount:t.size}});return e.length<=1?a:R.i18n.translate("searchResponseWarnings.title.clustersClauseAndRequestsClause",{defaultMessage:"{clustersClause} in {requestsCount} requests",values:{clustersClause:a,requestsCount:e.length}})}function Ke(e){return $e(e).size<=1?R.i18n.translate("searchResponseWarnings.description.singleCluster",{defaultMessage:"This cluster had issues returning data and results might be incomplete."}):R.i18n.translate("searchResponseWarnings.description.multipleClusters",{defaultMessage:"These clusters had issues returning data and results might be incomplete."})}function He({callback:e,request:t,requestId:a,requestName:s,requestAdapter:r,response:n,services:i}){const o=function(e,t,a,s,r){const n=[];var i;return(e._clusters?e._clusters.partial>0||e._clusters.skipped>0||e._clusters.running>0:e.timed_out||e._shards.failed>0)&&n.push({type:"incomplete",requestName:s,clusters:e._clusters?null!==(i=e._clusters.details)&&void 0!==i?i:{}:{"(local)":{status:"partial",indices:"",took:e.took,timed_out:e.timed_out,_shards:e._shards,failures:e._shards.failures}},openInInspector:()=>{t.open({requests:a},{options:{initialRequestId:r,initialTabs:["clusters","response"]}})}}),n}(n,i.inspector,r,s,a);if(0===o.length)return;const l=e?function(e,t,a,s,r){const n=[];return e.forEach((e=>{(null==t?void 0:t(e,{requestId:r,request:a,response:s}))||n.push(e)})),n}(o,e,t,n,a):o;if(0===l.length)return;const u=l.filter((e=>"incomplete"===e.type));if(0===u.length)return;const[c]=u;i.notifications.toasts.addWarning({title:Ve([c]),text:Object(ke.a)(Object(Ce.jsx)(Ne.a.Fragment,null,Object(Ce.jsx)(je.EuiText,{size:"s"},Ke([c])),Object(Ce.jsx)(je.EuiButtonEmpty,{color:"primary",flush:"left",onClick:()=>{c.openInInspector()},"data-test-subj":"viewWarningBtn"},ze)),i)})}var Ye=a(83),Qe=a(38),We=a(65),Je=a(27);class aggs_service_AggsService{constructor(){n()(this,"aggsCommonService",new Je.h({shouldDetectTimeZone:!0})),n()(this,"getConfig",void 0),n()(this,"subscriptions",[]),n()(this,"nowProvider",void 0),n()(this,"calculateBounds",(e=>Object(s.calculateBounds)(e,{forceNow:this.nowProvider.get()})))}setup({registerFunction:e,uiSettings:t,nowProvider:a}){return this.nowProvider=a,this.getConfig=function(e,t,a){const s={};return t.forEach((t=>{a.push(e.get$(t).subscribe((e=>{s[t]=e})))})),e=>s[e]}(t,Je.nc,this.subscriptions),this.aggsCommonService.setup({registerFunction:e})}start({indexPatterns:e,fieldFormats:t}){const{calculateAutoTimeExpression:a,types:s,createAggConfigs:r}=this.aggsCommonService.start({getConfig:this.getConfig,getIndexPattern:e.get,calculateBounds:this.calculateBounds,fieldFormats:t});return{calculateAutoTimeExpression:a,createAggConfigs:r,types:s}}stop(){this.subscriptions.forEach((e=>e.unsubscribe())),this.subscriptions=[]}}var Xe=a(25);let Ze=function(e){return e.QUERY_TIMED_OUT="queryTimedOut",e.SESSION_INDICATOR_TOUR_LOADING="sessionIndicatorTourLoading",e.SESSION_INDICATOR_TOUR_RESTORED="sessionIndicatorTourRestored",e.SESSION_INDICATOR_SAVE_DISABLED="sessionIndicatorSaveDisabled",e.SESSION_SENT_TO_BACKGROUND="sessionSentToBackground",e.SESSION_SAVED_RESULTS="sessionSavedResults",e.SESSION_VIEW_RESTORED="sessionViewRestored",e.SESSION_IS_RESTORED="sessionIsRestored",e.SESSION_RELOADED="sessionReloaded",e.SESSION_EXTENDED="sessionExtended",e.SESSION_CANCELLED="sessionCancelled",e.SESSION_DELETED="sessionDeleted",e.SESSION_VIEW_LIST="sessionViewList",e.SESSIONS_LIST_LOADED="sessionsListLoaded",e}({});var et=a(75),tt=a(37),at=a.n(tt),st=a(115),rt=a(32),nt=a.n(rt);const it=()=>Object(Ce.jsx)(je.EuiDelayRender,null,Object(Ce.jsx)(je.EuiLoadingSpinner,null)),ot=Ne.a.lazy((()=>a.e(2).then(a.bind(null,129)))),lt=Ne.a.forwardRef(((e,t)=>Object(Ce.jsx)(Ne.a.Suspense,{fallback:Object(Ce.jsx)(it,null)},Object(Ce.jsx)(ot,nt()({},e,{ref:t}))))),ut="data.searchSession.tour.takingTooLong",ct="data.searchSession.tour.restore";function dt(e,t){try{return Boolean(e.get(t))}catch(e){return!0}}function gt(e,t){try{e.set(t,!0)}catch(e){return!0}}const ht=({sessionService:e,application:t,storage:a,usageCollector:s,basePath:r,tourDisabled:n})=>{const o=r.prepend("/app/management/kibana/search_sessions"),u=e.state$.pipe(Object(l.debounce)((e=>Object(l.timer)(e===Se.a.None?50:300))));return()=>{const r=at()(u,Se.a.None),l=e.getSearchSessionIndicatorUiConfig().isDisabled(),c=at()(e.disableSaveAfterSearchesExpire$,!1),[d,g]=Object(xe.useState)(null),h=Object(xe.useCallback)((e=>{null!==e&&g(e)}),[]);let p=!1,f="",m=!1,b="";c&&(p=!0,f=R.i18n.translate("data.searchSessionIndicator.disabledDueToTimeoutMessage",{defaultMessage:"Search session results expired."})),l.disabled&&(p=!0,f=l.reasonText),e.hasAccess()||(m=p=!0,b=f=R.i18n.translate("data.searchSessionIndicator.disabledDueToDisabledGloballyMessage",{defaultMessage:"You don't have permissions to manage search sessions"}));const{markOpenedDone:y,markRestoredDone:v}=function(e,t,a,s,r,n){const o=Object(xe.useCallback)((()=>{gt(e,ut)}),[e]),l=Object(xe.useCallback)((()=>{gt(e,ct)}),[e]),u=Object(xe.useCallback)(Object(i.once)((()=>null==n?void 0:n.trackSessionIndicatorTourLoading())),[n,a]),c=Object(xe.useCallback)(Object(i.once)((()=>null==n?void 0:n.trackSessionIndicatorTourRestored())),[n,a]);return Object(xe.useEffect)((()=>{if(s)return;if(r)return;if(!t)return;let n;return a===Se.a.Loading&&(dt(e,ut)||(n=window.setTimeout((()=>{u(),t.openPopover()}),1e4))),a===Se.a.Restored&&(dt(e,ct)||(c(),t.openPopover())),()=>{clearTimeout(n)}}),[e,t,a,s,r,o,l,n,c,u]),{markOpenedDone:o,markRestoredDone:l}}(a,d,r,p,n,s),_=Object(xe.useCallback)((e=>{y(),e===Se.a.Restored&&v()}),[y,v]),S=Object(xe.useCallback)((()=>{p||(null==s||s.trackSessionSentToBackground(),e.save())}),[p]),T=Object(xe.useCallback)((()=>{p||(null==s||s.trackSessionSavedResults(),e.save())}),[p]),E=Object(xe.useCallback)((()=>{null==s||s.trackSessionCancelled(),e.cancel()}),[]),M=Object(xe.useCallback)((()=>{null==s||s.trackViewSessionsList()}),[]);Object(xe.useEffect)((()=>{r===Se.a.Restored&&(null==s||s.trackSessionIsRestored())}),[r]);const{name:F,startTime:A,completedTime:I,canceledTime:O}=at()(e.sessionMeta$,{state:r,isContinued:!1}),w=Object(xe.useCallback)((async t=>{await e.renameCurrentSession(t)}),[]);return e.isSessionStorageReady()?Object(Ce.jsx)(st.a,{coreStart:{application:t}},Object(Ce.jsx)(lt,{ref:h,state:r,saveDisabled:p,saveDisabledReasonText:f,managementDisabled:m,managementDisabledReasonText:b,onContinueInBackground:S,onSaveResults:T,onCancel:E,onOpened:_,onViewSearchSessions:M,viewSearchSessionsLink:o,searchSessionName:F,saveSearchSessionNameFn:w,startedTime:A,completedTime:I,canceledTime:O})):null}};class search_service_SearchService{constructor(e){n()(this,"aggsService",new aggs_service_AggsService),n()(this,"searchSourceService",new be.N),n()(this,"searchInterceptor",void 0),n()(this,"usageCollector",void 0),n()(this,"sessionService",void 0),n()(this,"sessionsClient",void 0),this.initializerContext=e}setup(e,{bfetch:t,expressions:s,usageCollection:r,nowProvider:n,management:o}){const{http:u,getStartServices:c,notifications:d,uiSettings:g,executionContext:p}=e;this.usageCollector=((e,t)=>{const a=(a,s)=>async()=>{const r=await(async()=>{const[{application:t}]=await e();return t.currentAppId$.pipe(Object(l.first)()).toPromise()})();return null==t?void 0:t.reportUiCounter(r,a,s)};return{trackQueryTimedOut:a(Xe.METRIC_TYPE.LOADED,Ze.QUERY_TIMED_OUT),trackSessionIndicatorTourLoading:a(Xe.METRIC_TYPE.LOADED,Ze.SESSION_INDICATOR_TOUR_LOADING),trackSessionIndicatorTourRestored:a(Xe.METRIC_TYPE.LOADED,Ze.SESSION_INDICATOR_TOUR_RESTORED),trackSessionIndicatorSaveDisabled:a(Xe.METRIC_TYPE.LOADED,Ze.SESSION_INDICATOR_SAVE_DISABLED),trackSessionSentToBackground:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_SENT_TO_BACKGROUND),trackSessionSavedResults:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_SAVED_RESULTS),trackSessionViewRestored:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_VIEW_RESTORED),trackSessionIsRestored:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_IS_RESTORED),trackSessionReloaded:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_RELOADED),trackSessionExtended:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_EXTENDED),trackSessionCancelled:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_CANCELLED),trackSessionDeleted:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_DELETED),trackViewSessionsList:a(Xe.METRIC_TYPE.CLICK,Ze.SESSION_VIEW_LIST),trackSessionsListLoaded:a(Xe.METRIC_TYPE.LOADED,Ze.SESSIONS_LIST_LOADED)}})(c,r),this.sessionsClient=new sessions_client_SessionsClient({http:u}),this.sessionService=new session_service_SessionService(this.initializerContext,c,this.sessionsClient,n,this.usageCollector),this.searchInterceptor=new search_interceptor_SearchInterceptor({bfetch:t,toasts:d.toasts,executionContext:p,http:u,uiSettings:g,startServices:c(),usageCollector:this.usageCollector,session:this.sessionService,searchConfig:this.initializerContext.config.get().search}),s.registerFunction(function({getStartServices:e}){return function({getStartDependencies:e}){return()=>({...Object(ge.getEsaggsMeta)(),fn:(t,s,{inspectorAdapters:r,abortSignal:n,getSearchSessionId:o,getExecutionContext:u,getSearchContext:c})=>Object(l.defer)((async()=>{var t,r;const{aggs:n,indexPatterns:i,searchSource:o,getNow:l}=await e(),u=await i.create(s.index.value,!0),c=n.createAggConfigs(u,null!==(t=null===(r=s.aggs)||void 0===r?void 0:r.map((e=>e.value)))&&void 0!==t?t:[],{hierarchical:s.metricsAtAllLevels,partialRows:s.partialRows,probability:s.probability,samplerSeed:s.samplerSeed}),{handleEsaggsRequest:d}=await Promise.resolve().then(a.bind(null,14));return{aggConfigs:c,indexPattern:u,searchSource:o,getNow:l,handleEsaggsRequest:d}})).pipe(Object(l.switchMap)((({aggConfigs:e,indexPattern:a,searchSource:l,getNow:d,handleEsaggsRequest:g})=>{const{disableWarningToasts:h}=c();return g({abortSignal:n,aggs:e,filters:s.ignoreGlobalFilters?void 0:Object(i.get)(t,"filters",void 0),indexPattern:a,inspectorAdapters:r,query:s.ignoreGlobalFilters?void 0:Object(i.get)(t,"query",void 0),searchSessionId:o(),searchSourceService:l,timeFields:s.timeFields,timeRange:Object(i.get)(t,"timeRange",void 0),disableWarningToasts:h||!1,getNow:d,executionContext:u()})})))})}({getStartDependencies:async()=>{const[,,t]=await e(),{indexPatterns:a,search:s,nowProvider:r}=t;return{aggs:s.aggs,indexPatterns:a,searchSource:s.searchSource,getNow:()=>r.get()}}})}({getStartServices:c})),s.registerFunction(be.He),s.registerFunction(be.Jc),s.registerFunction(be.Pc),s.registerFunction(be.Uc),s.registerFunction(be.oe),s.registerFunction(be.qe),s.registerFunction(be.Le),s.registerFunction(be.Ke),s.registerFunction(be.Je),s.registerFunction(be.Xc),s.registerFunction(be.Ne),s.registerFunction(be.bd),s.registerFunction(be.dd),s.registerFunction(be.ef),s.registerFunction(be.Ie),s.registerFunction(be.Tc),s.registerFunction(be.Ze),s.registerFunction(be.df),s.registerFunction(be.ff),s.registerFunction(be.hf),s.registerFunction(be.We),s.registerFunction(function({getStartServices:e}){return Object(he.a)({getStartDependencies:async()=>{const[t,,{search:a}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search}}})}({getStartServices:c})),s.registerFunction(function({getStartServices:e}){return(({getStartDependencies:e})=>({name:"essql",type:"datatable",inputTypes:["kibana_context","null"],allowCache:!0,help:R.i18n.translate("data.search.essql.help",{defaultMessage:"Queries Elasticsearch using Elasticsearch SQL."}),args:{query:{aliases:["_","q"],types:["string"],help:R.i18n.translate("data.search.essql.query.help",{defaultMessage:"An Elasticsearch SQL query."})},parameter:{aliases:["param"],types:["string","number","boolean"],multi:!0,help:R.i18n.translate("data.search.essql.parameter.help",{defaultMessage:"A parameter to be passed to the SQL query."})},count:{types:["number"],help:R.i18n.translate("data.search.essql.count.help",{defaultMessage:"The number of documents to retrieve. For better performance, use a smaller data set."}),default:1e3},timezone:{aliases:["tz"],types:["string"],default:"UTC",help:R.i18n.translate("data.search.essql.timezone.help",{defaultMessage:"The timezone to use for date operations. Valid ISO8601 formats and UTC offsets both work."})},timeField:{aliases:["timeField"],types:["string"],help:R.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})}},fn:(t,{count:a,parameter:s,query:r,timeField:n,timezone:o},{abortSignal:u,inspectorAdapters:c,getKibanaRequest:d})=>Object(l.defer)((()=>e((()=>{const e=null==d?void 0:d();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe(Object(l.switchMap)((({nowProvider:e,search:i,uiSettings:d})=>{const g={query:r,fetch_size:a,time_zone:o,params:s,field_multi_value_leniency:!0};if(t){var p;const a=Object(fe.a)(d),s=t.timeRange&&Object(me.d)(void 0,t.timeRange,{fieldName:n,forceNow:null==e?void 0:e.get()});g.filter=Object(h.buildEsQuery)(void 0,t.query||[],[...null!==(p=t.filters)&&void 0!==p?p:[],...s?[s]:[]],a)}let f=Date.now();const m=()=>{c.requests||(c.requests=new pe.RequestAdapter);const e=c.requests.start(R.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:R.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},f);return f=Date.now(),e};return i({params:g},{abortSignal:u,strategy:be.K}).pipe(Object(l.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=e.attributes;e.message="parsing_exception"===t?`Couldn't parse Elasticsearch SQL query. You may need to add double quotes to names containing special characters. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return Object(l.throwError)((()=>e))})),Object(l.tap)({next({rawResponse:e,requestParams:t,took:a}){m().stats({hits:{label:R.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.rows.length}`,description:R.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})},queryTime:{label:R.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:R.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:a}}),description:R.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}}).json(g).ok({json:e,requestParams:t})},error(e){m().error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),Object(l.map)((({rawResponse:e})=>{var t,a;const s=null!==(t=null===(a=e.columns)||void 0===a?void 0:a.map((({name:e,type:t})=>({id:ye(e),name:ye(e),meta:{type:Object(w.d)(t)}}))))&&void 0!==t?t:[],r=s.map((({name:e})=>e));return{type:"datatable",meta:{type:"essql"},columns:s,rows:e.rows.map((e=>Object(i.zipObject)(r,e)))}})))}))({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:c})),s.registerFunction(function({getStartServices:e}){return Object(ve.a)({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:c})),s.registerFunction(function({getStartServices:e}){return Object(_e.a)({getStartDependencies:async()=>{const[t,,{search:a,indexPatterns:s}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search,dataViews:s}}})}({getStartServices:c})),s.registerType(be.Sc),s.registerType(be.Rc);const f=this.aggsService.setup({uiSettings:g,registerFunction:s.registerFunction,nowProvider:n});this.initializerContext.config.get().search.aggs.shardDelay.enabled&&(f.types.registerBucket(Qe.a,Qe.b),s.registerFunction(We.a));const m=this.initializerContext.config.get();if(m.search.sessions.enabled){const t=m.search.sessions;Object(et.b)(e,{searchUsageCollector:this.usageCollector,sessionsClient:this.sessionsClient,management:o},t,this.initializerContext.env.packageInfo.version)}return{aggs:f,usageCollector:this.usageCollector,session:this.sessionService,sessionsClient:this.sessionsClient}}start({analytics:e,http:t,theme:a,uiSettings:s,chrome:r,application:n,notifications:i,i18n:o},{fieldFormats:u,indexPatterns:c,inspector:d,screenshotMode:g,scriptedFieldsEnabled:h}){const p=(e,t={})=>this.searchInterceptor.search(e,t),f=new l.BehaviorSubject(0);t.addLoadingCountSource(f);const m=this.aggsService.start({fieldFormats:u,indexPatterns:c}),b={analytics:e,i18n:o,inspector:d,notifications:i,theme:a},y={aggs:m,getConfig:s.get.bind(s),search:p,dataViews:c,onResponse:(e,t,a)=>{if(!a.disableWarningToasts){var s,r,n,i;const{rawResponse:o}=t,l=null!==(s=a.inspector)&&void 0!==s&&s.title?a.inspector.title:R.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),u=null!==(r=a.inspector)&&void 0!==r&&r.adapter?null===(n=a.inspector)||void 0===n?void 0:n.adapter:new Ye.RequestAdapter;if(null===(i=a.inspector)||void 0===i||!i.adapter){const a=u.start(l,{id:e.id});a.json(e.body),a.ok({json:t})}He({request:e.body,requestAdapter:u,requestId:e.id,requestName:l,response:o,services:b})}return t},scriptedFieldsEnabled:h};return this.initializerContext.config.get().search.sessions.enabled&&r.setBreadcrumbsAppendExtension({content:Object(ke.a)(Ne.a.createElement(ht({sessionService:this.sessionService,application:n,basePath:t.basePath,storage:new $.Storage(window.localStorage),usageCollector:this.usageCollector,tourDisabled:g.isScreenshotMode()})),{analytics:e,i18n:o,theme:a})}),{aggs:m,search:p,showError:e=>{this.searchInterceptor.showError(e)},showWarnings:(e,t)=>{null==e||e.getRequests().forEach((a=>{var s,r;const n=null===(s=a.response)||void 0===s||null===(r=s.json)||void 0===r?void 0:r.rawResponse;n&&He({callback:t,request:a.json,requestAdapter:e,requestId:a.id,requestName:a.name,response:n,services:b})}))},session:this.sessionService,sessionsClient:this.sessionsClient,searchSource:this.searchSourceService.start(c,y)}}stop(){this.aggsService.stop(),this.searchSourceService.stop(),this.searchInterceptor.stop()}}var pt=a(84);class now_provider_NowProvider{constructor(){n()(this,"nowFromUrl",function(){const e=function(){const e=window.location.href.split("?");return e.length<=1?{}:Object(pt.parse)(e[1],{sort:!1})}().forceNow;if(!e)return;const t=Date.parse(e);if(isNaN(t))throw new Error(`forceNow query parameter, ${e}, can't be parsed by Date.parse`);return new Date(t)}()),n()(this,"now",void 0)}get(){return this.nowFromUrl?this.nowFromUrl:this.now?this.now:new Date}set(e){this.now=e}reset(){this.now=void 0}}const ft="FILTER_TRIGGER",mt={id:ft,title:R.i18n.translate("data.triggers.applyFilterTitle",{defaultMessage:"Apply filter"}),description:R.i18n.translate("data.triggers.applyFilterDescription",{defaultMessage:"When kibana filter is applied. Could be a single value or a range filter."})};a(97);var bt=a(85);function yt(e,t){return`${e}\n${t}`}const vt=async(e,t,a)=>{var s;if(!(e&&e.columns&&e.columns[t]&&e.columns[t].meta&&"esaggs"===e.columns[t].meta.source&&null!==(s=e.columns[t].meta.sourceParams)&&void 0!==s&&s.indexPatternId))return;const r=e.columns[t],{indexPatternId:n,...i}=e.columns[t].meta.sourceParams,o=X().aggs.createAggConfigs(await W().get(n),[i]).aggs[0];let l=[];const u=a>-1?e.rows[a][r.id]:null;if(null!=u&&o.isFilterable()){if("terms"!==o.type.name&&"multi_terms"!==o.type.name||!o.params.otherBucket)l=o.createFilter(u);else{const s=((e,t,a)=>{if(-1===a)return[];const s=e.rows.filter((s=>e.columns.every(((r,n)=>s[r.id]===e.rows[a][r.id]||n>=t)))).map((a=>a[e.columns[t].id]));return[...new Set(s.filter((e=>{const t="__other__"!==String(e),a="__missing__"!==String(e);return t&&a})))]})(e,t,a);l=o.createFilter(u,{terms:s})}if(l)return Array.isArray(l)||(l=[l]),l}},_t=async({data:e,negate:t})=>{const a=[];return await Promise.all(e.filter((e=>e)).map((async e=>{const{table:s,column:r,row:n}=e,i=await vt(s,r,n)||[];i&&i.forEach((e=>{t&&(e=Object(h.toggleFilterNegated)(e)),a.push(e)}))}))),o.a.uniqWith(I(a),((e,t)=>Object(h.compareFilters)(e,t,h.COMPARE_ALL_OPTIONS)))},St=({data:e,query:t})=>{var a;if(!t)return;const s=e.filter((e=>{var t,a,s,r;return e&&"date"!==(null===(t=e.table)||void 0===t||null===(a=t.columns)||void 0===a||null===(s=a[e.column])||void 0===s||null===(r=s.meta)||void 0===r?void 0:r.type)}));if(!s.length)return;const{table:r,column:n,row:i}=s[s.length-1];if(null!=r&&null!==(a=r.columns)&&void 0!==a&&a[n]){var o;const e=r.columns[n],a=i>-1?r.rows[i][e.id]:null;if(null==a)return;return function(e,t,a,s,r){let n;n="==";let i="string"==typeof a?`"${a.replace(/"/g,'\\"')}"`:a,o=`\`${t}\``;"string"!==r&&"number"!==r&&"boolean"!==r&&(o=`${o}::string`);const{ast:l}=Object(bt.getAstAndSyntaxErrors)(e);if("where"===l[l.length-1].name){const a=l[l.length-1].text;if(a.includes(t)&&a.includes(String(i))){const a=e.split("|"),s=a[a.length-1].match(new RegExp(t+"(.*)"+String(i)));if(s){var u;const t=null===(u=s[1])||void 0===u?void 0:u.trim().replace("`","").toLowerCase();if(!["==","!=","is not null","is null"].includes(t.trim()))return yt(e,`and ${o}${n}${i}`);if(t===n.trim())return e;{const a=s[0].trim(),r=a.replace(t,n);return e.replace(a,r)}}}return yt(e,`AND ${o}${n}${i}`)}return yt(e,`| WHERE ${o}${n}${i}`)}(t.esql,e.name,a,0,null===(o=e.meta)||void 0===o?void 0:o.type)}};var Tt=a(62);async function Et(e){const t=e.table.columns[e.column];if(!t||!t.meta)return[];const{field:a,indexPattern:s}=await(async e=>{const t=e.table.columns[e.column];var a,s,r;if(Object(h.isOfAggregateQueryType)(e.query))return{field:new Tt.DataViewField({name:t.name,type:null!==(a=null===(s=t.meta)||void 0===s?void 0:s.type)&&void 0!==a?a:"unknown",esTypes:null!==(r=t.meta)&&void 0!==r&&r.esType?[t.meta.esType]:void 0,searchable:!0,aggregatable:!1}),indexPattern:void 0};if(t.meta&&"sourceParams"in t.meta){const{indexPatternId:e,...a}=t.meta.sourceParams,s=await W().get(e);return{field:X().aggs.createAggConfigs(s,[a]).aggs[0].params.field,indexPattern:s}}return{field:void 0,indexPattern:void 0}})(e);if(!a||e.range.length<=1)return[];const r=e.range[0],n=Object(i.last)(e.range);if(r===n)return[];const o="date"===a.type,l={gte:o?P()(r).toISOString():r,lt:o?P()(n).toISOString():n};return o&&(l.format="strict_date_optional_time"),I([Object(h.buildRangeFilter)(a,l,s)])}const Mt=e=>!!e,Ft=async({data:e,negate:t})=>{if(!e||0===e.length)return;const a=(await Promise.all(e.map((async e=>{var a;const{table:s,cells:r,relation:n}=e,o=null==s||null===(a=s.meta)||void 0===a?void 0:a.source;if(!o)return;const l=(await Promise.all(r.map((async({column:e,row:t})=>await vt(s,e,t))))).flat().filter(Mt),u=Object(i.uniqWith)(I(l),((e,t)=>Object(h.compareFilters)(e,t,h.COMPARE_ALL_OPTIONS)));if(0===u.length)return;if(1===u.length)return t?[Object(h.toggleFilterNegated)(u[0])]:u;if(!n)return t?u.map((e=>Object(h.toggleFilterNegated)(e))):u;const c=u.every((e=>e.meta.alias))?u.map((e=>e.meta.alias)).join(` ${n} `):"";return Object(h.buildCombinedFilter)(n,u,{id:o},void 0,t,c)})))).flat().filter(Mt);return 0!==a.length?a:void 0},At="ACTION_SELECT_RANGE",It="ACTION_VALUE_CLICK",Ot="ACTION_MULTI_VALUE_CLICK",wt=Object(xe.lazy)((()=>a.e(3).then(a.bind(null,130)))),kt=e=>t=>Object(Ce.jsx)(wt,{adapters:t.adapters,title:t.title,uiSettings:e().uiSettings,fieldFormats:e().fieldFormats,uiActions:e().uiActions,isFilterable:e().isFilterable,options:t.options});class plugin_DataPublicPlugin{constructor(e){n()(this,"searchService",void 0),n()(this,"queryService",void 0),n()(this,"storage",void 0),n()(this,"nowProvider",void 0),this.searchService=new search_service_SearchService(e),this.queryService=new query_service_QueryService,this.storage=new $.Storage(window.localStorage),this.nowProvider=new now_provider_NowProvider}setup(e,{bfetch:t,expressions:a,uiActions:r,usageCollection:n,inspector:i,fieldFormats:o,management:l}){const u=Object($.createStartServicesGetter)(e.getStartServices);te(e.theme);const c=this.searchService.setup(e,{bfetch:t,usageCollection:n,expressions:a,management:l,nowProvider:this.nowProvider}),d=this.queryService.setup({uiSettings:e.uiSettings,storage:this.storage,nowProvider:this.nowProvider});var g;return r.registerTrigger(mt),i.registerView((g=()=>({uiActions:u().plugins.uiActions,uiSettings:u().core.uiSettings,fieldFormats:u().self.fieldFormats,isFilterable:u().self.datatableUtilities.isFilterable}),{title:R.i18n.translate("data.inspector.table.dataTitle",{defaultMessage:"Data"}),order:10,help:R.i18n.translate("data.inspector.table..dataDescriptionTooltip",{defaultMessage:"View the data behind the visualization"}),shouldShow:e=>Boolean(e.tables),component:kt(g)})),o.register(Object(s.getAggsFormats)((e=>u().plugins.fieldFormats.deserialize(e)))),{search:c,query:d}}start(e,{uiActions:t,fieldFormats:a,dataViews:r,inspector:n,screenshotMode:i}){const{uiSettings:o,overlays:l}=e;Q(l),H(o),J(r);const u=this.queryService.start({storage:this.storage,http:e.http,uiSettings:o}),c=this.searchService.start(e,{fieldFormats:a,indexPatterns:r,inspector:n,screenshotMode:i,scriptedFieldsEnabled:r.scriptedFieldsEnabled});var d;Z(c),t.addTriggerAction("SELECT_RANGE_TRIGGER",(d=()=>({uiActions:t}),{type:At,id:At,shouldAutoExecute:async()=>!0,execute:async e=>{try{const t=await Et(e.data);t.length>0&&await d().uiActions.getTrigger(ft).exec({filters:t,embeddable:e.embeddable,timeFieldName:e.data.timeFieldName})}catch(e){console.warn("Error [ACTION_SELECT_RANGE]: can't extract filters from action context")}}})),t.addTriggerAction("VALUE_CLICK_TRIGGER",function(e){return{type:It,id:It,shouldAutoExecute:async()=>!0,isCompatible:async e=>e.data.query&&Object(h.isOfAggregateQueryType)(e.data.query)?null!=await St(e.data):(await _t(e.data)).length>0,execute:async t=>{try{if(t.data.query&&Object(h.isOfAggregateQueryType)(t.data.query)){const a=St(t.data);await e().uiActions.getTrigger("UPDATE_ESQL_QUERY_TRIGGER").exec({queryString:a})}else{const a=await _t(t.data);a.length>0&&await e().uiActions.getTrigger(ft).exec({filters:a,embeddable:t.embeddable,timeFieldName:t.data.timeFieldName})}}catch(e){console.warn("Error [ACTION_EMIT_APPLY_FILTER_TRIGGER]: can't extract filters from action context")}}}}((()=>({uiActions:t})))),t.addTriggerAction("MULTI_VALUE_CLICK_TRIGGER",{type:Ot,id:Ot,shouldAutoExecute:async()=>!0,isCompatible:async e=>{const t=await Ft(e.data);return Boolean(t)},execute:async({data:e})=>{const t=await Ft(e);if(!t||0===(null==t?void 0:t.length))return;const{filterManager:a,timefilter:{timefilter:s}}=u;if(e.timeFieldName){const{timeRangeFilter:r,restOfFilters:n}=Object(h.extractTimeFilter)(e.timeFieldName,t);a.addFilters(n),r&&s.setTime(Object(h.convertRangeFilterToTimeRange)(r))}else a.addFilters(t)}});const g=new s.DatatableUtilitiesService(c.aggs,r,a);return{actions:{createFiltersFromValueClickAction:_t,createFiltersFromRangeSelectAction:Et,createFiltersFromMultiValueClickAction:Ft},datatableUtilities:g,fieldFormats:a,indexPatterns:r,dataViews:r,query:u,search:c,nowProvider:this.nowProvider}}stop(){this.queryService.stop(),this.searchService.stop()}}const Rt={datatableToCSV:s.datatableToCSV,CSV_MIME_TYPE:s.CSV_MIME_TYPE,cellHasFormulas:s.cellHasFormulas,tableHasFormulas:s.tableHasFormulas},xt={ILLEGAL_CHARACTERS_KEY:de.ILLEGAL_CHARACTERS_KEY,CONTAINS_SPACES_KEY:de.CONTAINS_SPACES_KEY,ILLEGAL_CHARACTERS_VISIBLE:de.ILLEGAL_CHARACTERS_VISIBLE,ILLEGAL_CHARACTERS:de.ILLEGAL_CHARACTERS,isFilterable:s.isFilterable,isNestedField:s.isNestedField,isMultiField:s.isMultiField,getFieldSubtypeMulti:s.getFieldSubtypeMulti,getFieldSubtypeNested:s.getFieldSubtypeNested,validate:de.validateDataView},Nt={aggs:{CidrMask:s.CidrMask,dateHistogramInterval:s.dateHistogramInterval,intervalOptions:s.intervalOptions,InvalidEsCalendarIntervalError:s.InvalidEsCalendarIntervalError,InvalidEsIntervalFormatError:s.InvalidEsIntervalFormatError,IpAddress:s.IpAddress,isDateHistogramBucketAggConfig:s.isDateHistogramBucketAggConfig,isNumberType:s.isNumberType,isStringType:s.isStringType,isType:s.isType,isValidEsInterval:s.isValidEsInterval,isValidInterval:s.isValidInterval,parentPipelineType:s.parentPipelineType,parseEsInterval:s.parseEsInterval,parseInterval:s.parseInterval,propFilter:s.propFilter,siblingPipelineType:s.siblingPipelineType,termsAggFilter:s.termsAggFilter,toAbsoluteDates:s.toAbsoluteDates,boundsDescendingRaw:s.boundsDescendingRaw,calcAutoIntervalLessThan:s.calcAutoIntervalLessThan},getResponseInspectorStats:s.getResponseInspectorStats,tabifyAggResponse:s.tabifyAggResponse,tabifyGetColumns:s.tabifyGetColumns};function jt(e){return new plugin_DataPublicPlugin(e)}},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},,function(e,t){e.exports=__kbnSharedDeps__.KbnCodeEditor},function(e,t,a){a.r(t);var s=__kbnBundles__.get("plugin/share/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},,,,,,,,function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return Sha256}));var s=a(2),r=a.n(s);const n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=new Array(64);class Sha256{constructor(){r()(this,"_a",void 0),r()(this,"_b",void 0),r()(this,"_c",void 0),r()(this,"_d",void 0),r()(this,"_e",void 0),r()(this,"_f",void 0),r()(this,"_g",void 0),r()(this,"_h",void 0),r()(this,"_block",void 0),r()(this,"_finalSize",void 0),r()(this,"_blockSize",void 0),r()(this,"_len",void 0),r()(this,"_s",void 0),r()(this,"_w",void 0),this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this._w=i,this._block=e.alloc(64),this._finalSize=56,this._blockSize=64,this._len=0,this._s=0}update(t,a){"string"==typeof t&&(a=a||"utf8",t=e.from(t,a));const s=this._len+=t.length;let r=this._s||0,n=0;const i=this._block;for(;r<s;){const e=Math.min(t.length,n+this._blockSize-r%this._blockSize)-n;for(let a=0;a<e;a++)i[r%this._blockSize+a]=t[a+n];r+=e,n+=e,r%this._blockSize==0&&this._update(i)}return this._s=r,this}digest(e){const t=8*this._len;return this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),t%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(t,this._blockSize-4),this._update(this._block),this._hash().toString(e)}_update(e){const t=this._w;let a,s=0|this._a,r=0|this._b,i=0|this._c,g=0|this._d,h=0|this._e,p=0|this._f,f=0|this._g,m=0|this._h;for(a=0;a<16;++a)t[a]=e.readInt32BE(4*a);for(;a<64;++a)t[a]=0|(((b=t[a-2])>>>17|b<<15)^(b>>>19|b<<13)^b>>>10)+t[a-7]+d(t[a-15])+t[a-16];var b;for(let e=0;e<64;++e){const a=m+c(h)+o(h,p,f)+n[e]+t[e]|0,d=u(s)+l(s,r,i)|0;m=f,f=p,p=h,h=g+a|0,g=i,i=r,r=s,s=a+d|0}this._a=s+this._a|0,this._b=r+this._b|0,this._c=i+this._c|0,this._d=g+this._d|0,this._e=h+this._e|0,this._f=p+this._f|0,this._g=f+this._g|0,this._h=m+this._h|0}_hash(){const t=e.alloc(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t}}function o(e,t,a){return a^e&(t^a)}function l(e,t,a){return e&t|a&(e|t)}function u(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function c(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function d(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}}).call(this,a(93).Buffer)},function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var s=a(9),r=a.n(s),n=a(32),i=a.n(n),o=a(37),l=a.n(o),u=a(7);const c=r.a.createContext(null),d=({children:e,...t})=>{const{navigateToUrl:a,currentAppId:s}=t;return Object(u.jsx)(c.Provider,{value:{navigateToUrl:a,currentAppId:s}},e)},g=({children:e,coreStart:t})=>{const{navigateToUrl:a,currentAppId$:s}=t.application,r=l()(s,void 0);return Object(u.jsx)(c.Provider,{value:{navigateToUrl:a,currentAppId:r}},e)},h={name:"h42ud6",styles:"display:inherit;height:inherit;width:inherit;flex:1;flex-flow:column nowrap"},p=({children:e,navigateToUrl:t,currentAppId:a,...r})=>{const n=Object(s.useRef)(null),o=Object(s.useCallback)((e=>(({event:e,container:t,navigateToUrl:a,currentAppId:s})=>{if(!t||!s)return;const r=((e,t)=>{let a=e;do{var s,r;if("a"===(null===(s=a)||void 0===s?void 0:s.tagName.toLowerCase()))return a;const e=null===(r=a)||void 0===r?void 0:r.parentElement;if(!e||e===document.body||e===t)break;a=e}while(parent||parent!==document.body||parent!==t)})(e.target,t);if(!r)return;const n=r.href,i=""===r.target||"_self"===r.target,o=0===e.button;n&&i&&o&&!e.defaultPrevented&&!(e=>e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)(e)&&(e.preventDefault(),a(r.href))})({event:e,currentAppId:a,navigateToUrl:t,container:n.current})),[a,t]);return Object(u.jsx)("div",i()({onClick:o,ref:n,css:h,"data-test-subj":"kbnRedirectAppLink"},r),e)},f=({children:e,...t})=>Object(u.jsx)(p,i()({},function(){const e=Object(s.useContext)(c);if(!e)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return e}(),t),e),m=({children:e,...t})=>{if(void 0!==t.coreStart){const{coreStart:a,...s}=t,r=Object(u.jsx)(f,s,e);return Object(u.jsx)(g,{coreStart:a},r)}const{navigateToUrl:a,currentAppId:s,...r}=t,n=Object(u.jsx)(f,r,e);return Object(u.jsx)(d,{currentAppId:s,navigateToUrl:a},n)}}]);