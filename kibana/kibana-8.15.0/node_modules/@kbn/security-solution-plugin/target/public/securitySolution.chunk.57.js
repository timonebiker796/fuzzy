/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[57],{1483:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return l})),a.d(t,"e",(function(){return n})),a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return r}));const s=5e3,l=10,n=100,i=10,r=1e4},2106:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return u}));var s=a(7),l=a(1723),n=a(1420),i=a(1483);function r(e,t){if(e=Object(s.defaults)(e,{count:i.a}),!Object(n.b)(e.field,e.isTextBased))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=e.values,{groups:l,sampledValues:r}=function(e,t){const a={};let l=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let n,i=0;const r={};n=Array.isArray(e)?e:null==e?[]:[e],n.forEach((e=>{const s=t?t.convert(e):e;r[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:i++},r[s]=!0,l++)}))})),{groups:a,sampledValues:l}}(a,t);return{buckets:Object(s.sortBy)(l,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:r,sampledDocuments:e.values.length}}function u(e,t,a){return null!=t&&t.name?Object(s.map)(e,(function(e){return Object(l.a)(e,a,{includeIgnoredValues:!0})[t.name]})):[]}},2117:function(e,t,a){"use strict";a.r(t);var s=a(2),l=a.n(s),n=a(54),i=a.n(n);function r(e){return e.isDefault("dateFormat:tz")?i.a.tz.guess()||i()().format("Z"):e.get("dateFormat:tz","Browser")}var u=a(233),o=a(2103),c=a(53),d=a(63),m=a.n(d),b=a(19),f=a(42),j=a(72),p=a(4),g=a(1420),O=a(1479),x=a(89);function y(e,t){const{ast:a}=Object(x.getAstAndSyntaxErrors)(e),s=a.find((({name:e})=>["from","metrics"].includes(e)));if(!s)return e;let l=-1;const n=a.find((({name:e},t)=>(l=t,"sort"===e)));if(!n||n&&1!==l){const a=e.substring(s.location.min,s.location.max+1);return e.replace(a,`${a} \n| LIMIT ${t}`)}const i=e.substring(s.location.min,n.location.max+1);return e.replace(i,`${i} \n| LIMIT ${t}`)}function F(e,t){return`${e}\n${t}`}var v=a(1483),h=a(2106);async function S(e,t=v.b){const{searchHandler:a,field:s,esqlBaseQuery:l}=e,n=T(s.name),i=T(`${s.name}_terms`),r=F(l,`| WHERE ${n} IS NOT NULL\n    | STATS ${i} = count(${n}) BY ${n}\n    | SORT ${i} DESC\n    | LIMIT ${t}`),u=await a({query:r}),o=null==u?void 0:u.values;if(null==o||!o.length)return{};const c=null==o?void 0:o.reduce(((e,t)=>e+t[0]),0);return{totalDocuments:c,sampledDocuments:c,sampledValues:c,topValues:{buckets:o.map((e=>({count:e[0],key:e[1]})))}}}function T(e){return`\`${e}\``}var D=a(2041),E=a(43);const L=({areExamples:e,buckets:t,dataView:a,field:n,sampledValuesCount:i,color:r=V(),"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c})=>{if(null==t||!t.length)return null;const d=a.getFormatterForField(n),m=B(M(t),i),f=t.some((e=>!Number.isInteger(e.count/i)));return Object(E.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(E.jsx)("div",{"data-test-subj":`${u}-topValues`},t.map(((e,t)=>{const a=e.key,l=d.convert(a);return Object(E.jsx)(s.Fragment,{key:String(a)},t>0&&Object(E.jsx)(b.EuiSpacer,{size:"s"}),Object(E.jsx)(D.default,{field:n,fieldValue:a,formattedFieldValue:l,formattedPercentage:w(e.count,i,f),progressValue:k(e.count,i),count:e.count,color:r,"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c}))})),m>0&&Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiSpacer,{size:"s"}),Object(E.jsx)(D.default,{type:"other",field:n,fieldValue:void 0,formattedPercentage:w(m,i,f),progressValue:k(m,i),count:m,color:r,"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c}))))},V=()=>Object(b.euiPaletteColorBlind)()[1],w=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",k=(e,t)=>t>0?e/t:0,M=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,B=(e,t)=>t&&e?t-e:0,A=({message:e})=>Object(E.jsx)(b.EuiText,{size:"s"},e),$=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!I(a))return null;const l=e.getFormatterForField(t),n=[{key:"min",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:l.convert(a.minValue,"text")},{key:"max",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:l.convert(a.maxValue,"text")}],i=[{field:"label",name:"",align:b.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(E.jsx)("strong",null,e),align:b.RIGHT_ALIGNMENT}],r=p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(E.jsx)(b.EuiBasicTable,{compressed:!0,items:n,columns:i,tableCaption:r,"data-test-subj":`${s}-numberSummary`,responsiveBreakpoint:!1,css:Object(E.css)("& .euiTableHeaderCell{",Object(b.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function I(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}var C=a(2104);const N=({services:e,query:t,dslQuery:n,filters:i,fromDate:d,toDate:x,dataViewOrDataViewId:D,field:w,color:k=V(),"data-test-subj":C="fieldStats",overrideMissingContent:N,overrideFooter:R,onAddFilter:z,overrideFieldTopValueBar:G,onStateChange:q})=>{const{fieldFormats:Q,uiSettings:_,charts:H,dataViews:P,data:U}=e,[W,Z]=Object(s.useState)({isLoading:!1}),[K,Y]=Object(s.useState)(null),J=Object(s.useRef)(null),X=Object(s.useRef)(!1),ee=!!t&&Object(c.isOfAggregateQueryType)(t),te=Object(s.useCallback)((e=>{X.current||Z(e)}),[Z,X]);Object(s.useEffect)((function(){q&&q(W)}),[q,W]);const ae=Object(s.useCallback)((e=>{X.current||Y(e)}),[Y,X]);async function se(){if(!X.current)try{var e;const s="string"==typeof D?await P.get(D):D;if(ae(s),W.isLoading)return;te((e=>({...e,isLoading:!0}))),null===(e=J.current)||void 0===e||e.abort(),J.current=new AbortController;const l=ee?await(async({services:e,dataView:t,field:a,fromDate:s,toDate:l,baseQuery:n,abortController:i})=>{const{data:r}=e;try{if(null==t||!t.id||null==a||!a.type)return{};const e=async({query:e})=>{const a=function({timeFieldName:e,fromDate:t,toDate:a}){return e?{range:{[e]:{gte:t,lte:a,format:"strict_date_optional_time"}}}:null}({timeFieldName:t.timeFieldName,fromDate:s,toDate:l});return(await Object(O.b)({esqlQuery:e,filter:a,search:r.search.search,signal:null==i?void 0:i.signal})).response};if(!("esql"in n))throw new Error("query must be of type AggregateQuery");return await async function(e){const{field:t}=e;return Object(g.e)(t)?"boolean"===t.type?await S(e,3):Object(g.f)(t)?await S(e):Object(g.b)(t,!0)?await async function(e){const{searchHandler:t,field:a,esqlBaseQuery:s}=e,l=T(a.name),n=F(s,`| WHERE ${l} IS NOT NULL\n    | KEEP ${l}\n    | LIMIT ${v.e}`),i=await t({query:n}),r=((null==i?void 0:i.values)||[]).map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(null==r||!r.length)return{};const u=null==r?void 0:r.length,o=Object(h.a)({values:r,field:a,count:v.a,isTextBased:!0});return{totalDocuments:u,sampledDocuments:o.sampledDocuments,sampledValues:o.sampledValues,topValues:{buckets:o.buckets,areExamples:!0}}}(e):{}:{}}({searchHandler:e,field:a,esqlBaseQuery:y(n.esql,v.c)})}catch(e){throw new Error("Could not provide field stats",{cause:e})}})({services:{data:U},dataView:s,field:w,fromDate:d,toDate:x,baseQuery:t,abortController:J.current}):await(async e=>{const{loadFieldStats:t}=await a.e(72).then(a.bind(null,2142));return await t(e)})({services:{data:U},dataView:s,field:w,fromDate:d,toDate:x,dslQuery:null!=n?n:Object(c.buildEsQuery)(s,null!=t?t:[],null!=i?i:[],Object(o.a)(_)),abortController:J.current});J.current=null,te((e=>({...e,isLoading:!1,totalDocuments:l.totalDocuments,sampledDocuments:l.sampledDocuments,sampledValues:l.sampledValues,histogram:l.histogram,topValues:l.topValues,numberSummary:l.numberSummary})))}catch(e){te((e=>({...e,isLoading:!1})))}}Object(s.useEffect)((()=>{se()}),[D,w,n,t,i,d,x,e]),Object(s.useEffect)((()=>()=>{var e;X.current=!0,null===(e=J.current)||void 0===e||e.abort()}),[]);const le=H.theme.useChartsBaseTheme(),ne=Object(s.useMemo)((()=>k?{barSeriesStyle:{rect:{fill:k}}}:{}),[k]),{isLoading:ie,histogram:re,topValues:ue,numberSummary:oe,sampledValues:ce,sampledDocuments:de,totalDocuments:me}=W;let be=!!W.histogram;const fe=m.a.parse(d),je=m.a.parse(x),pe=M(null==ue?void 0:ue.buckets),ge=B(pe,ce);pe&&re&&re.buckets.length&&ue&&ue.buckets.length&&(be=ge/pe>.9);const[Oe,xe]=Object(s.useState)(be);if(ie)return Object(E.jsx)(b.EuiLoadingSpinner,{"data-test-subj":`${C}-statsLoading`});if(!K)return null;const ye=K.getFormatterForField(w);let Fe=Object(E.jsx)(l.a.Fragment,null);function ve(t){const a=function(e,t,a,s){const n="unifiedFieldStats-statsFooter-docsCount",{fieldFormats:i}=t,{totalDocuments:r,sampledValues:o,sampledDocuments:c,topValues:d}=e;if(!r)return Object(E.jsx)(l.a.Fragment,null);let m;return m=a?null!=d&&d.areExamples?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},i.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleValuesLabel",defaultMessage:"Calculated from {sampledValuesFormatted} sample {sampledValues, plural, one {value} other {values}}.",values:{sampledValues:o,sampledValuesFormatted:Object(E.jsx)("strong",{"data-test-subj":n},i.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(o))}}):c&&c<r?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},i.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:r,totalDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},i.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(r))}}),Object(E.jsx)(b.EuiText,{color:"subdued",size:"xs","data-test-subj":`${s}-statsFooter`},m)}(W,e,ee,C);return Object(E.jsx)(l.a.Fragment,null,Fe?Object(E.jsx)("div",{"data-test-subj":`${C}-title`},Fe):Object(E.jsx)(l.a.Fragment,null),Object(E.jsx)(b.EuiSpacer,{size:"s"}),t,R?null==R?void 0:R({element:a,totalDocuments:me,sampledDocuments:de}):Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiSpacer,{size:"m"}),a))}if(!Object(g.d)(w,ee)){const e=Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return N?N({reason:"unsupported",element:e}):e}if(Object(g.c)(w,ee)&&I(oe))return Fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),ve(Object(E.jsx)($,{dataView:K,field:w,numberSummary:oe,"data-test-subj":C}));if(!(re&&0!==re.buckets.length||ue&&0!==ue.buckets.length)){const e=de&&me&&de<me?Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:de,sampledDocumentsFormatted:Q.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(de)}})}):Object(E.jsx)(A,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return N?N({reason:"no-data",element:e}):e}if(re&&re.buckets.length&&ue&&ue.buckets.length?Fe=Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:p.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${C}-buttonGroup-topValuesButton`},{label:p.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${C}-buttonGroup-distributionButton`}],onChange:e=>{xe("histogram"===e)},idSelected:Oe?"histogram":"topValues"}),Object(E.jsx)(b.EuiSpacer,{size:"xs"})):"date"===w.type?Fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):ue&&ue.buckets.length&&(Fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,ue.areExamples?p.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),re&&re.buckets.length){const e=p.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===w.type)return ve(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(E.jsx)("div",{"data-test-subj":`${C}-histogram`},Object(E.jsx)(j.Chart,{size:{height:200,width:268}},Object(E.jsx)(j.Tooltip,{type:j.TooltipType.None}),Object(E.jsx)(j.Settings,{locale:p.i18n.getLocale(),theme:ne,baseTheme:le,xDomain:fe&&je?{min:fe.valueOf(),max:je.valueOf(),minInterval:Math.round((je.valueOf()-fe.valueOf())/10)}:void 0}),Object(E.jsx)(j.Axis,{id:"key",position:j.Position.Bottom,tickFormat:fe&&je?Object(j.niceTimeFormatter)([fe.valueOf(),je.valueOf()]):void 0,showOverlappingTicks:!0}),Object(E.jsx)(j.HistogramBarSeries,{data:re.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:j.ScaleType.Time,yScaleType:j.ScaleType.Linear,timeZone:r(_)})))));if(Oe||!ue||!ue.buckets.length)return ve(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(E.jsx)(j.Chart,{"data-test-subj":`${C}-histogram`,size:{height:200,width:"100%"}},Object(E.jsx)(j.Tooltip,{type:j.TooltipType.None}),Object(E.jsx)(j.Settings,{locale:p.i18n.getLocale(),rotation:90,theme:ne,baseTheme:le}),Object(E.jsx)(j.Axis,{id:"key",position:j.Position.Left,showOverlappingTicks:!0,tickFormat:e=>ye.convert(e)}),Object(E.jsx)(j.HistogramBarSeries,{data:re.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:j.ScaleType.Linear,yScaleType:j.ScaleType.Linear}))))}return ue&&ue.buckets.length?ve(Object(E.jsx)(L,{areExamples:ue.areExamples,buckets:ue.buckets,dataView:K,field:w,sampledValuesCount:ce,color:k,"data-test-subj":C,onAddFilter:z,overrideFieldTopValueBar:G})):null};t.default=e=>Object(E.jsx)(C.a,null,Object(E.jsx)(N,e))}}]);