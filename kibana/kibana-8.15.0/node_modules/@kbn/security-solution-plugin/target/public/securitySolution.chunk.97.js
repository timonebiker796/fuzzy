/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[97],{2126:function(e,t,a){"use strict";a.r(t),a.d(t,"CustomCriblForm",(function(){return d}));var n=a(2),r=a.n(n),i=a(56),l=a(19),s=a(4),o=a(42),u=a(5);const c=e=>{const t=e.filter((e=>e.dataId&&e.datastream));return JSON.stringify(t)},m=r.a.memo((({index:e,routeEntries:t,datastreamOpts:a,onChangeCriblDataId:n,onChangeDatastream:i,onDeleteEntry:o})=>{const u=t[e],c=a.map((e=>({label:e}))),m=c.filter((e=>e.label===u.datastream));return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiFlexGroup,null,r.a.createElement(l.EuiFlexItem,null,r.a.createElement(l.EuiFormRow,{label:"Cribl _dataId field"},r.a.createElement(l.EuiFieldText,{value:u.dataId,onChange:t=>n(e,t.currentTarget.value)}))),r.a.createElement(l.EuiFormRow,{hasEmptyLabelSpace:!0},r.a.createElement(l.EuiFlexItem,{grow:!1},s.i18n.translate("xpack.securitySolution.securityIntegration.cribl.mapsTo",{defaultMessage:"MAPS TO"}))),r.a.createElement(l.EuiFlexItem,null,r.a.createElement(l.EuiFormRow,{label:"Datastream"},r.a.createElement(l.EuiComboBox,{placeholder:"Select",singleSelection:!0,options:c,selectedOptions:m,onChange:t=>{t.length>0?i(e,t[0].label):i(e,"")}}))),r.a.createElement(l.EuiFormRow,{hasEmptyLabelSpace:!0},r.a.createElement(l.EuiButtonIcon,{color:"danger",iconType:"trash",onClick:()=>o(e),isDisabled:1===t.length,"aria-label":"entryDeleteButton",className:"itemEntryDeleteButton","data-test-subj":"itemEntryDeleteButton"}))))})),d=Object(n.memo)((({newPolicy:e,onChange:t,isEditPage:a})=>{const{http:d}=Object(i.useKibana)().services,[E,p]=Object(n.useState)(),[g,y]=Object(n.useState)([]),[b]=Object(n.useState)(e);Object(n.useEffect)((()=>{(async()=>{if(!d)return;const{indexTemplates:e,permissionsError:t}=await(async e=>{try{return{indexTemplates:await e.get(u.Hc,{version:"1"})}}catch(e){var t;return 403===(null===(t=e.response)||void 0===t?void 0:t.status)?{indexTemplates:[],permissionsError:!0}:{indexTemplates:[],generalError:!0}}})(d);y(e),t&&p(!0)})()}),[d]);const[h,I]=Object(n.useState)([]);Object(n.useEffect)((()=>{if(a&&b){const e=(e=>{var t;if(void 0===e)return[];const a=null===(t=e.route_entries)||void 0===t?void 0:t.value;return a&&a.length>0?JSON.parse(a):[]})(b.vars);if(e.length>0)return void I(e)}I([{dataId:"",datastream:""}])}),[a,b]);const f=(e,t)=>{const a=[...h];a[e]={...h[e],dataId:t},I(a),S(a)},x=(e,t)=>{const a=[...h];a[e]={...h[e],datastream:t},I(a),S(a)},F=e=>{const t=h.filter(((t,a)=>a!==e));I(t),S(t)},S=a=>{const n={...e,vars:{route_entries:{value:c(a)}}},r=(e=>e.some((e=>{const t=e.dataId&&e.dataId.length>0,a=e.datastream&&e.datastream.length>0;return t&&a})))(a)&&(e=>e.every((e=>{const t=e.dataId&&e.dataId.length>0,a=e.datastream&&e.datastream.length>0;return t&&a||!t&&!a})))(a);t({isValid:r,updatedPolicy:n})};return r.a.createElement(r.a.Fragment,null,E&&r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiCallOut,{size:"s",title:s.i18n.translate("xpack.securitySolution.securityIntegration.cribl.missingPermissionsCalloutTitle",{defaultMessage:"Be sure you have the necessary privileges"}),iconType:"help"},r.a.createElement("p",null,r.a.createElement(o.FormattedMessage,{id:"xpack.securitySolution.securityIntegration.cribl.missingPermissionsCalloutDescription",defaultMessage:"To configure this integration, you must have `manage_index_templates` privileges and `manage_pipeline` or `manage_ingest_pipelines` privileges."}))),r.a.createElement(l.EuiSpacer,{size:"l"})),r.a.createElement(l.EuiFlexGroup,null,r.a.createElement(l.EuiFlexItem,null,r.a.createElement(o.FormattedMessage,{id:"xpack.securitySolution.securityIntegration.cribl.mappingInstruction",defaultMessage:"Add mappings for your Cribl sources to a corresponding Elastic Fleet Integration datastream."}))),r.a.createElement(l.EuiSpacer,null),r.a.createElement(l.EuiFlexGroup,{gutterSize:"s","data-test-subj":"entriesContainer"},r.a.createElement(l.EuiFlexGroup,{gutterSize:"s",direction:"column"},h.map(((e,t)=>r.a.createElement(m,{key:t,index:t,routeEntries:h,datastreamOpts:g,onChangeCriblDataId:f,onChangeDatastream:x,onDeleteEntry:F}))),r.a.createElement(l.EuiSpacer,{size:"s"}),r.a.createElement(l.EuiFlexGroup,null,r.a.createElement(l.EuiFlexItem,{grow:!1},r.a.createElement(l.EuiButton,{fill:!0,size:"s",iconType:"plusInCircle",onClick:()=>{const e=[...h,{dataId:"",datastream:""}];I(e),S(e)}},r.a.createElement(o.FormattedMessage,{id:"xpack.securitySolution.securityIntegration.cribl.addButton",defaultMessage:"Add"})))),r.a.createElement(l.EuiSpacer,{size:"m"}))))}));m.displayName="CriblRouteEntry",d.displayName="CriblForm"}}]);