/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[64],{1218:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var r=a(2),i=a(45),c=a(1370);const s=()=>{const e=Object(i.useSelector)((e=>e.discover.app)),t=Object(i.useSelector)((e=>e.discover.internal)),a=Object(i.useSelector)((e=>e.discover.savedSearch)),s=Object(i.useDispatch)();return{discoverAppState:e,setDiscoverAppState:Object(r.useCallback)((e=>{s(Object(c.a)({newState:e}))}),[s]),discoverInternalState:t,setDiscoverInternalState:Object(r.useCallback)((e=>{s(Object(c.b)({newState:e}))}),[s]),discoverSavedSearchState:a,setDiscoverSavedSearchState:Object(r.useCallback)((e=>{s(Object(c.c)({newState:e}))}),[s])}}},1549:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a(7);const i=(e,t)=>{var a,i;const c={...e,fields:null==e||null===(a=e.searchSource)||void 0===a?void 0:a.getFields()},s={...t,fields:null==t||null===(i=t.searchSource)||void 0===i?void 0:i.getFields()},n=["columns","sort","timeRange","fields.filter","fields.query","title","description"],l=Object(r.pick)(c,n),o=Object(r.pick)(s,n);return Object(r.isEqual)(l,o)}},2119:function(e,t,a){"use strict";a.r(t),a.d(t,"DiscoverTabContent",(function(){return T}));var r=a(2),i=a.n(r),c=a(48),s=a(41),n=a(47),l=a(7),o=a(45),u=a(13),d=a(513),v=a(132),S=a(118),b=a(1218),f=a(127),m=a(70),p=a(236);const g=()=>{const{services:{customDataService:e,uiActions:t}}=Object(S.j)(),a=Object(r.useCallback)((async a=>{let r;if(a.preventDefault&&a.preventDefault(),c=a,Array.isArray(c.data)&&"column"in c.data[0]){var i;r=await e.actions.createFiltersFromValueClickAction({data:a.data,negate:null!==(i=a.negate)&&void 0!==i&&i})}else{if(!(e=>Array.isArray(e.data)&&"cells"in e.data[0])(a))return;r=await e.actions.createFiltersFromMultiValueClickAction({data:a.data,negate:a.negate})}var c;if(r&&!Array.isArray(r)&&(r=[r]),r&&r.length>0){const e=t.getTrigger(p.c.HISTOGRAM_TRIGGER);await e.exec({filters:r,timeFieldName:a.timeFieldName})}}),[t,e.actions]),i=Object(r.useCallback)((t=>{e.query.timefilter.timefilter.setTime({from:new Date(t.range[0]).toISOString(),to:new Date(t.range[1]).toISOString(),mode:"absolute"}),t.preventDefault&&t.preventDefault()}),[e.query.timefilter.timefilter]);return Object(r.useCallback)((({customizations:e})=>{e.set({id:"unified_histogram",onFilter:a,onBrushEnd:i,withDefaultActions:!1,disabledActions:[m.ACTION_GLOBAL_APPLY_FILTER]})}),[a,i])},j=()=>{const{CustomStatefulTopNavKqlQueryBar:e}=(()=>{const{services:{navigation:{ui:{createTopNavWithCustomContext:e}},unifiedSearch:t,customDataService:a}}=Object(S.j)(),{ui:{getCustomSearchBar:i}}=t,c=Object(r.useMemo)((()=>i(a)),[a,i]);return{CustomStatefulTopNavKqlQueryBar:Object(r.useMemo)((()=>{const a={...t,ui:{...t.ui,SearchBar:c,AggregateQuerySearchBar:c}};return e(a)}),[c,e,t])}})();return({customizations:t})=>{t.set({id:"search_bar",CustomSearchBar:e,hideDataViewPicker:!0})}};var h=a(448);const O=a.n(h).a.div`
  width: 100%;
  height: 100%;
  overflow: scroll;
  display: grid,
  place-items: center
`,y=Object(s.createGlobalStyle)(["body:has(.timeline-portal-overlay-mask) .DiscoverFlyout{z-index:1002;}.unifiedDataTable__fullScreen .dscPageBody *{z-index:unset !important;}"]);var w=a(129),D=a(124),C=a(158),A=a(1549),I=a(4);const q=e=>I.i18n.translate("xpack.securitySolution.timelines.discoverInTimeline.savedSearchTitle",{defaultMessage:"Saved search for timeline - {title}",values:{title:e}}),k=Object(s.createGlobalStyle)(["[data-test-subj='searchSessionIndicator']{display:none;}"]),T=({timelineId:e})=>{const t=Object(c.useHistory)(),{services:{customDataService:a,discover:s,dataViews:m,savedSearch:p}}=Object(S.j)(),h=Object(o.useDispatch)(),{dataViewId:I}=Object(v.a)(f.SourcererScopeName.detections),[T,F]=Object(r.useState)(),[E,R]=Object(r.useState)(),B=Object(r.useRef)(),_=Object(r.useRef)(),x=Object(r.useRef)(),M=Object(r.useRef)(),{discoverStateContainer:P,setDiscoverStateContainer:L,getAppStateFromSavedSearch:N,updateSavedSearch:z,initializeLocalSavedSearch:G,defaultDiscoverAppState:V}=Object(d.a)(),{discoverAppState:H,discoverSavedSearchState:Q,setDiscoverSavedSearchState:$,setDiscoverInternalState:K,setDiscoverAppState:U}=Object(b.a)(),W=[j(),g()],Y=Object(r.useMemo)((()=>w.b.getTimelineByIdSelector()),[]),J=Object(D.b)((t=>{var a;return null!==(a=Y(t,e))&&void 0!==a?a:C.b})),{status:X,savedSearchId:Z,activeTab:ee,savedObjectId:te,title:ae,description:re}=J,{data:ie,isFetching:ce,status:se}=Object(n.useQuery)({queryKey:["savedSearchById",null!=Z?Z:""],queryFn:()=>Z?p.get(Z):Promise.resolve(null)}),ne=Object(r.useCallback)((()=>{var e,t,r,i,c,s;if(Q)return{...null!==(e=null===(t=P.current)||void 0===t?void 0:t.savedSearchState.getState())&&void 0!==e?e:Q,timeRange:a.query.timefilter.timefilter.getTime(),refreshInterval:null===(r=P.current)||void 0===r||null===(i=r.globalState.get())||void 0===i?void 0:i.refreshInterval,breakdownField:null===(c=P.current)||void 0===c?void 0:c.appState.getState().breakdownField,rowsPerPage:null===(s=P.current)||void 0===s?void 0:s.appState.getState().rowsPerPage,title:q(ae),description:re}}),[Q,P,a.query.timefilter.timefilter,ae,re]),le=Object(r.useRef)();Object(r.useEffect)((()=>{if(ce)return;if("error"===se&&Z)return void h(Object(u.updateSavedSearchId)({id:e,savedSearchId:null}));if(!te)return;if(!X||"draft"===X)return;const t=ne();(null==t?void 0:t.searchSource.getField("index"))&&t&&le.current!==t&&(Object(l.isEqualWith)(t,ie,A.a)||z(t,e,(function(){le.current=t})))}),[ne,ie,z,ee,X,E,te,ce,e,h,Z,se]),Object(r.useEffect)((()=>{I&&m.get(I).then(F)}),[I,m]),Object(r.useEffect)((()=>()=>{[B.current,_.current,x.current,M.current].forEach((e=>{e&&e.unsubscribe()}))}),[P]);const oe=Object(r.useCallback)((async({stateContainer:t})=>{var r,i,c,s,n,l,o,u;let d;if(L(t),Z)try{const t=await p.get(Z);G(t,e),d=N(t)}catch(e){console.error("Stale Saved search Id which no longer exists",e)}const v=null!==(r=(null===(i=d)||void 0===i||null===(c=i.appState)||void 0===c?void 0:c.query)&&"esql"in(null===(s=d)||void 0===s||null===(n=s.appState)||void 0===n?void 0:n.query)&&(null===(l=d)||void 0===l?void 0:l.appState)||H)&&void 0!==r?r:V,S=null===(o=t.appState.getState())||void 0===o||null===(u=o.query)||void 0===u?void 0:u.esql;var b,f;!t.appState.isEmptyURL()&&S||(null!==(b=d)&&void 0!==b&&b.savedSearch.timeRange&&t.globalState.set({...t.globalState.get(),time:null===(f=d)||void 0===f?void 0:f.savedSearch.timeRange}),t.appState.set(v),await t.appState.replaceUrlState(v));const m=t.appState.state$.subscribe({next:U}),g=t.internalState.state$.subscribe({next:K}),j=t.savedSearchState.getHasChanged$().subscribe({next:e=>{if(e){const e=t.savedSearchState.getState();$(e)}}}),h=a.query.timefilter.timefilter.getTimeUpdate$().subscribe({next:()=>{R(a.query.timefilter.timefilter.getTime())}});B.current=m,_.current=g,x.current=j,M.current=h}),[H,$,K,U,L,N,a.query.timefilter.timefilter,Z,p,V,e,G]),ue=Object(r.useMemo)((()=>[oe,...W]),[oe,W]),de=Object(r.useMemo)((()=>({data:a,filterManager:a.query.filterManager,timefilter:a.query.timefilter.timefilter})),[a]),ve=s.DiscoverContainer,Se=Boolean(!T);return i.a.createElement(O,{"data-test-subj":"timeline-embedded-discover"},i.a.createElement(k,null),i.a.createElement(y,null),i.a.createElement(ve,{overrideServices:de,scopedHistory:t,customizationCallbacks:ue,isLoading:Se}))};t.default=T}}]);