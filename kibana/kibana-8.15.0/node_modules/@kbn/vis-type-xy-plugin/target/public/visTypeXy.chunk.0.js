(window.visTypeXy_bundle_jsonpfunction=window.visTypeXy_bundle_jsonpfunction||[]).push([[0],{35:function(e,i,l){"use strict";l.r(i),l.d(i,"convertToLens",(function(){return x}));var t=l(3),s=l(6),n=l(28),a=l(13),o=l(19),d=l(2),r=l(0),u=l(12);function c(e){const i=null==e?void 0:e.type;return i===r.e.SquareRoot?d.ScaleType.Sqrt:i}function p(e){return"date"===(null==e?void 0:e.dataType)?d.ScaleType.Time:"number"!==(null==e?void 0:e.dataType)?d.ScaleType.Ordinal:d.ScaleType.Linear}function v(e,i=!1){var l;return-(75===(null==e?void 0:e.labels.rotate)?45:null!==(l=null==e?void 0:e.labels.rotate)&&void 0!==l?l:i?0:90)}function m(e,i){const l=i.some((i=>i.valueAxis===e.id&&("histogram"===i.type||"area"===i.type)));return{mode:Object(u.c)(e.scale),lowerBound:null!==e.scale.min?l&&e.scale.min&&e.scale.min>0?0:e.scale.min:void 0,upperBound:null!==e.scale.max?l&&e.scale.max&&e.scale.max<0?0:e.scale.max:void 0,enforce:!0}}function y(e,i,l){const t=l.uiState.get("vis.colors",{});return e.map((e=>{var s,a,o;const r=e.columns.find((e=>e.isBucketed&&!e.isSplit)),c=null===(s=e.columns.find((e=>e.isBucketed&&e.isSplit)))||void 0===s?void 0:s.columnId,v=i.find((i=>i.data.id===e.seriesIdsMap[e.metrics[0]])),m="date_histogram"===(null==r?void 0:r.operationType)||"range"===(null==r?void 0:r.operationType)&&"histogram"===r.params.type,y=(null!==(a=l.params.valueAxes)&&void 0!==a?a:l.type.visConfig.defaults.valueAxes).find((e=>e.id===(null==v?void 0:v.valueAxis))),f="percentage"===(null==y?void 0:y.scale.mode),g=(null==y?void 0:y.position)!==d.Position.Left&&(null==y?void 0:y.position)!==d.Position.Right,h=function(e,i,l,t){let s="histogram"===e?n.SeriesTypes.BAR:null!=e?e:n.SeriesTypes.AREA;return l&&s===n.SeriesTypes.BAR&&(s+="_horizontal"),t&&(s=(s!==n.SeriesTypes.LINE?s:n.SeriesTypes.AREA)+"_percentage"),(t||"stacked"===i)&&(s=(s!==n.SeriesTypes.LINE?s:n.SeriesTypes.AREA)+"_stacked"),s}(null==v?void 0:v.type,null==v?void 0:v.mode,g,f);return{layerId:e.layerId,accessors:e.metrics,layerType:"data",seriesType:h,xAccessor:null==r?void 0:r.columnId,simpleView:!1,splitAccessor:c,palette:null!==(o=l.params.palette)&&void 0!==o?o:l.type.visConfig.defaults.palette,yConfig:e.metrics.map((s=>{var n,a;const o=i.find((i=>i.data.id===e.seriesIdsMap[s])),d=(null!==(n=l.params.valueAxes)&&void 0!==n?n:l.type.visConfig.defaults.valueAxes).find((e=>e.id===(null==o?void 0:o.valueAxis)));return{forAccessor:s,axisMode:Object(u.d)(null!==(a=null==d?void 0:d.position)&&void 0!==a?a:"left"),color:!c&&null!=o&&o.data.label?t[null==o?void 0:o.data.label]:void 0}})),xScaleType:p(r),isHistogram:m,collapseFn:e.collapseFn}}))}function f(e,i){var l,t;const s=null!==(l=i.params.thresholdLine)&&void 0!==l?l:i.type.visConfig.defaults.thresholdLine,n=(null!==(t=i.params.valueAxes)&&void 0!==t?t:i.type.visConfig.defaults.valueAxes)[0];return e.map((e=>({layerType:"referenceLine",layerId:e.layerId,accessors:e.metrics,yConfig:e.metrics.map((e=>{var i;return{forAccessor:e,axisMode:Object(u.d)(null!==(i=null==n?void 0:n.position)&&void 0!==i?i:"left"),color:s.color,lineWidth:null!==s.width?s.width:void 0,lineStyle:s.style===r.f.DotDashed||s.style===r.f.Full?"solid":s.style}}))})))}const g=(e,i,l)=>{var t,s,n,a,o,p,g,h,x,T,L,b,S,A,C,I,w,R,E,M,k,O,P,B,_,F,j,V,U,z,Y;const D=null===(t=l.uiState.get("vis.legendOpen"))||void 0===t||t,K=(null!==(s=l.params.valueAxes)&&void 0!==s?s:l.type.visConfig.defaults.valueAxes).find((e=>Object(u.d)(e.position)===d.Position.Right)),X=(null!==(n=l.params.valueAxes)&&void 0!==n?n:l.type.visConfig.defaults.valueAxes).find((e=>Object(u.d)(e.position)===d.Position.Left)),G=(null!==(a=l.params.categoryAxes)&&void 0!==a?a:l.type.visConfig.defaults.categoryAxes)[0],N={x:G.show,yLeft:null===(o=null==X?void 0:X.show)||void 0===o||o,yRight:null===(p=null==K?void 0:K.show)||void 0===p||p},q=e[0].columns.find((e=>e.isBucketed&&!e.isSplit)),H="date_histogram"===(null==q?void 0:q.operationType),W=null!==(g=l.params.fittingFunction)&&void 0!==g?g:l.type.visConfig.defaults.fittingFunction;return{layers:[...y(e.filter((e=>!e.isReferenceLineLayer)),i,l),...f(e.filter((e=>e.isReferenceLineLayer)),l)],legend:{isVisible:D&&(null!==(h=l.params.addLegend)&&void 0!==h?h:l.type.visConfig.defaults.addLegend),position:null!==(x=l.params.legendPosition)&&void 0!==x?x:l.type.visConfig.defaults.legendPosition,legendSize:null!==(T=l.params.legendSize)&&void 0!==T?T:l.type.visConfig.defaults.legendSize,shouldTruncate:null!==(L=l.params.truncateLegend)&&void 0!==L?L:l.type.visConfig.defaults.truncateLegend,maxLines:null!==(b=l.params.maxLegendLines)&&void 0!==b?b:l.type.visConfig.defaults.maxLegendLines,showSingleSeries:!0,legendStats:Boolean(null!==(S=l.params.labels.show)&&void 0!==S?S:null===(A=l.type.visConfig.defaults.labels)||void 0===A?void 0:A.show)?[d.LegendValue.CurrentAndLastValue]:void 0},fittingFunction:W?W[0].toUpperCase()+W.slice(1):void 0,fillOpacity:null!==(C=l.params.fillOpacity)&&void 0!==C?C:l.type.visConfig.defaults.fillOpacity,gridlinesVisibilitySettings:{x:null!==(I=l.params.grid.categoryLines)&&void 0!==I?I:null===(w=l.type.visConfig.defaults.grid)||void 0===w?void 0:w.categoryLines,yLeft:(null!==(R=l.params.grid.valueAxis)&&void 0!==R?R:null===(E=l.type.visConfig.defaults.grid)||void 0===E?void 0:E.valueAxis)===(null==X?void 0:X.id),yRight:(null!==(M=l.params.grid.valueAxis)&&void 0!==M?M:null===(k=l.type.visConfig.defaults.grid)||void 0===k?void 0:k.valueAxis)===(null==K?void 0:K.id)},axisTitlesVisibilitySettings:N,tickLabelsVisibilitySettings:{x:N.x&&(null===(O=G.labels.show)||void 0===O||O),yLeft:N.yLeft&&(null===(P=null==X?void 0:X.labels.show)||void 0===P||P),yRight:N.yRight&&(null===(B=null==K?void 0:K.labels.show)||void 0===B||B)},labelsOrientation:{x:v(G,H),yLeft:v(X),yRight:v(K)},yLeftScale:null!==(_=c(null==X?void 0:X.scale))&&void 0!==_?_:d.ScaleType.Linear,yRightScale:null!==(F=c(null==K?void 0:K.scale))&&void 0!==F?F:d.ScaleType.Linear,yLeftExtent:null!=X&&X.scale?m(X,i):void 0,yRightExtent:null!=K&&K.scale?m(K,i):void 0,yTitle:null==X?void 0:X.title.text,yRightTitle:null==K?void 0:K.title.text,xTitle:G.title.text,valueLabels:(null!==(j=l.params.labels.show)&&void 0!==j?j:null===(V=l.type.visConfig.defaults.labels)||void 0===V?void 0:V.show)?"show":"hide",showCurrentTimeMarker:H?Boolean(null!==(U=l.params.addTimeMarker)&&void 0!==U?U:l.type.visConfig.defaults.addTimeMarker):void 0,curveType:Object(u.a)((null===(z=i[0])||void 0===z?void 0:z.interpolate)===r.d.StepAfter?r.d.Linear:null===(Y=i[0])||void 0===Y?void 0:Y.interpolate)}},h=[t.METRIC_TYPES.AVG_BUCKET,t.METRIC_TYPES.SUM_BUCKET,t.METRIC_TYPES.MAX_BUCKET,t.METRIC_TYPES.MIN_BUCKET],x=async(e,i)=>{var t,d;if(!i)return null;const r=Object(a.a)(),u=await Object(s.getDataViewByIndexPatternId)(null===(t=e.data.indexPattern)||void 0===t?void 0:t.id,r);if(!u)return null;const c=Object(s.getVisSchemas)(e,{timefilter:i,timeRange:i.getAbsoluteTime()});if(c.group&&c.group.length>1)return null;const p=e.params.valueAxes[0].id,v=Object(o.a)(e.data.aggs,e.params.seriesParams,"metric",p),m=(null!=v?v:e.params.seriesParams).filter((e=>e.show&&c.metric.some((i=>{var l;return(null===(l=i.aggId)||void 0===l?void 0:l.split(".")[0])===e.data.id})))),{getColumnsFromVis:y,createStaticValueColumn:f}=await s.convertToLensModule,x=y(e,i,u,{buckets:["segment"],splits:["group"],unsupported:["split_row","split_column","radius"]},{dropEmptyRowsInDateHistogram:!0,supportMixedSiblingPipelineAggs:!0,isPercentageMode:!1},m.reduce(((e,i)=>{const l=e.find((({type:e,mode:l})=>e===i.type&&l===i.mode));return l&&c.metric.some((e=>{var l;return(null===(l=e.aggId)||void 0===l?void 0:l.split(".")[0])===i.data.id&&!h.includes(e.aggType)}))?l.metrics.push(i.data.id):e.push({metrics:[i.data.id],type:i.type,mode:i.mode}),e}),[]).map((({metrics:e})=>({metrics:e}))));if(null===x)return null;if(x.length>1&&x.some((e=>e.columns.some((e=>e.isSplit&&"orderBy"in e.params&&"column"===e.params.orderBy.type)))))return null;if(null!==(d=c.group)&&void 0!==d&&d.length&&x.some((e=>Object.keys(e.buckets.customBuckets).length)))return null;const T=e.params.valueAxes.filter((e=>m.some((i=>i.valueAxis===e.id)))),L=T.map((e=>e.position)),b=new Set(L);if(T.length>1&&b.size!==L.length)return null;const S=u.id,{v4:A}=await Promise.resolve().then(l.t.bind(null,31,7)),C=x.map((e=>{const i=A(),l={};m.forEach((i=>{const t=e.columns.find((e=>!e.isBucketed&&e.meta.aggId.split(".")[0]===i.data.id));t&&(l[t.columnId]=i.data.id)}));const t=e.bucketCollapseFn?Object.keys(e.bucketCollapseFn).find((i=>e.bucketCollapseFn[i].includes(e.buckets.customBuckets[e.metrics[0]]))):void 0;return{indexPatternId:S,layerId:i,columns:e.columns.map(n.excludeMetaFromColumn),metrics:e.metrics,columnOrder:[],seriesIdsMap:l,collapseFn:t,isReferenceLineLayer:!1,ignoreGlobalFilters:!1}}));if(e.params.thresholdLine.show){const i=f(e.params.thresholdLine.value||0);C.push({indexPatternId:S,layerId:A(),columns:[i],columnOrder:[],metrics:[i.columnId],isReferenceLineLayer:!0,ignoreGlobalFilters:!1,collapseFn:void 0,seriesIdsMap:{}})}return{type:"lnsXY",layers:C.map((({seriesIdsMap:e,collapseFn:i,isReferenceLineLayer:l,...t})=>t)),configuration:g(C,m,e),indexPatternIds:[S]}}}}]);