/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.savedObjectsTagging_bundle_jsonpfunction=window.savedObjectsTagging_bundle_jsonpfunction||[]).push([[3],{117:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(118);case"v8light":return s(120)}},118:function(e,t,s){var a=s(43),n=s(119);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},119:function(e,t,s){(t=s(44)(!1)).push([e.i,".tagAssignFlyout__selectionIcon{margin-left:12px;margin-right:12px}.tagAssignFlyout_searchContainer{padding:16px 24px 8px}.tagAssignFlyout__actionBar{margin-top:4px}",""]),e.exports=t},120:function(e,t,s){var a=s(43),n=s(121);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},121:function(e,t,s){(t=s(44)(!1)).push([e.i,".tagAssignFlyout__selectionIcon{margin-left:12px;margin-right:12px}.tagAssignFlyout_searchContainer{padding:16px 24px 8px}.tagAssignFlyout__actionBar{margin-top:4px}",""]),e.exports=t},126:function(e,t,s){"use strict";s.r(t),s.d(t,"AssignFlyout",(function(){return f}));var a=s(1),n=s.n(a),i=s(2),l=s(5),c=s(17);const o=({id:e,type:t})=>`${t}|${e}`,u=(e,t)=>t?"selected"===t?"full":"none":e,g=(e,t)=>{const s=u(e,t);if(e!==s){if("full"===s)return"added";if("none"===s)return"removed"}return"unchanged"},d={full:1,partial:2,none:3},r=({objects:e,initialStatus:t,overrides:s})=>{const a=[],n=[];return e.forEach((e=>{const i=o(e),l=t[i],c=s[i],u=g(l,c);"added"===u&&a.push(e),"removed"===u&&n.push(e)})),{assigned:a,unassigned:n}};var j=s(11),b=s(9),x=s(0);const p=({tagCache:e,tagIds:t})=>{const s=Object(a.useMemo)((()=>e.getState().filter((e=>t.includes(e.id)))),[e,t]);return Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(i.EuiTitle,{size:"m"},Object(x.jsx)("h3",null,Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.title",defaultMessage:"Manage tag assignments"}))),Object(x.jsx)(i.EuiSpacer,{size:"s"}),Object(x.jsx)(b.b,{tags:s}))},O=({resultCount:e,initiallyAssigned:t,pendingChanges:s,onReset:a,onSelectAll:n,onDeselectAll:l})=>Object(x.jsx)("div",{className:"tagAssignFlyout__actionBar"},Object(x.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",gutterSize:"m"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.totalResultsLabel",defaultMessage:"{count, plural, one {1 saved object} other {# saved objects}}",values:{count:e}}))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)("div",{className:"tagMgt__actionBarDivider"})),Object(x.jsx)(i.EuiFlexItem,{grow:!0},Object(x.jsx)(i.EuiText,{size:"xs",color:"subdued"},s>0?Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.pendingChanges",defaultMessage:"{count} pending changes",values:{count:s}}):Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.currentlyAssigned",defaultMessage:"{count} currently assigned",values:{count:t}}))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"xs"},Object(x.jsx)(i.EuiLink,{onClick:a,"data-test-subj":"assignFlyout-resetButton"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.resetLabel",defaultMessage:"Reset"})))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"xs"},Object(x.jsx)(i.EuiLink,{onClick:n,"data-test-subj":"assignFlyout-selectAllButton"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.selectedAllLabel",defaultMessage:"Select all"})))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"xs"},Object(x.jsx)(i.EuiLink,{onClick:l,"data-test-subj":"assignFlyout-deselectAllButton"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.deselectedAllLabel",defaultMessage:"Deselect all"})))))),y=({isSaving:e,hasPendingChanges:t,onCancel:s,onSave:a})=>Object(x.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButtonEmpty,{onClick:s,"data-test-subj":"assignFlyoutCancelButton"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButton,{onClick:a,isLoading:e,disabled:!t,fill:!0,iconType:"save","data-test-subj":"assignFlyoutConfirmButton"},Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.confirmButtonLabel",defaultMessage:"Save tag assignments"})))),m=({results:e,isLoading:t,initialStatus:s,overrides:a,onChange:l})=>{const c=e.map((e=>{var t;const l=o(e),c=u(s[l],a[l]),d="full"===c?"on":void 0,r="full"===c?"check":"none"===c?"empty":"partial",j=g(s[l],a[l]);return{label:e.title,key:l,"data-test-subj":`assign-result-${e.type}-${e.id}`,checked:d,previously:d,showIcons:!1,prepend:Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(i.EuiIcon,{className:`tagAssignFlyout__selectionIcon status-${c}`,type:r,"data-test-subj":"assign-result-status"}),Object(x.jsx)(i.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:"empty",title:e.type})),append:Object(x.jsx)(h,{action:j})}}));return Object(x.jsx)(i.EuiSelectable,{height:"full","data-test-subj":"assignFlyoutResultList","aria-label":"Saved objects which can be assigned to this tag",options:c,allowExclusions:!1,isLoading:t,onChange:e=>{const t=e.reduce(((e,t)=>t.checked===t.previously?e:{...e,[t.key]:"on"===t.checked?"selected":"deselected"}),{});l(t)}},(e=>e))},h=({action:e})=>"unchanged"===e?null:Object(x.jsx)(i.EuiText,{size:"xs",color:"subdued",style:{display:"inline-block"}},"added"===e?Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.resultList.addedLabel",defaultMessage:"Added"}):Object(x.jsx)(j.FormattedMessage,{id:"xpack.savedObjectsTagging.assignFlyout.resultList.removedLabel",defaultMessage:"Removed"})),v=({onChange:e,types:t,isLoading:s})=>{const n=Object(a.useMemo)((()=>[{type:"field_value_selection",field:"type",name:l.i18n.translate("xpack.savedObjectsTagging.assignFlyout.typeFilterName",{defaultMessage:"Type"}),multiSelect:"or",options:t.map((e=>({value:e,name:e})))}]),[t]);return Object(x.jsx)(i.EuiSearchBar,{box:{"data-test-subj":"assignFlyoutSearchBar",placeholder:l.i18n.translate("xpack.savedObjectsTagging.assignFlyout.searchPlaceholder",{defaultMessage:"Search by saved object name"}),isLoading:s},onChange:e,filters:n})};s(117);const F=(e,t)=>{const s=t.reduce(((t,s)=>t+(e.tags.includes(s)?1:0)),0);return 0===s?"none":s===t.length?"full":"partial"},f=({tagIds:e,tagCache:t,allowedTypes:s,notifications:u,assignmentService:g,onClose:j})=>{const[b,h]=Object(a.useState)([]),[f,C]=Object(a.useState)(i.Query.parse("")),[E,T]=Object(a.useState)({}),[k,S]=Object(a.useState)({}),[M,_]=Object(a.useState)(!1),[B,w]=Object(a.useState)(!1),[A,L]=Object(a.useState)(0),[I,z]=Object(a.useState)(0);Object(a.useEffect)((()=>{(async()=>{_(!0);const{queryText:t,selectedTypes:s}=function(e){let t,s;return e&&(e.ast.getTermClauses().length&&(t=e.ast.getTermClauses().map((e=>e.value)).join(" ")),e.ast.getFieldClauses("type")&&(s=e.ast.getFieldClauses("type")[0].value)),{queryText:t,selectedTypes:s}}(f),a=await g.findAssignableObjects({search:t?`${t}*`:void 0,types:s,maxResults:1e3}),n=a.reduce(((t,s)=>({...t,[o(s)]:F(s,e)})),{}),i=Object.values(n).filter((e=>"none"!==e)).length;var l,u;h((l=a,u=n,Object(c.sortBy)(l,[e=>`${d[u[o(e)]]}-${e.title}`]))),S({}),T(n),L(i),z(0),_(!1)})()}),[f,g,e]),Object(a.useEffect)((()=>{const e=r({objects:b,initialStatus:E,overrides:k});z(e.assigned.length+e.unassigned.length)}),[E,k,b]);const $=Object(a.useCallback)((async()=>{w(!0);const t=r({objects:b,initialStatus:E,overrides:k});await g.updateTagAssignments({tags:e,assign:t.assigned.map((({type:e,id:t})=>({type:e,id:t}))),unassign:t.unassigned.map((({type:e,id:t})=>({type:e,id:t})))}),u.toasts.addSuccess(l.i18n.translate("xpack.savedObjectsTagging.assignFlyout.successNotificationTitle",{defaultMessage:"Saved assignments to {count, plural, one {1 saved object} other {# saved objects}}",values:{count:t.assigned.length+t.unassigned.length}})),j()}),[e,b,E,k,u,g,j]),R=Object(a.useCallback)((()=>{S({})}),[]),N=Object(a.useCallback)((()=>{S(b.reduce(((e,t)=>({...e,[o(t)]:"selected"})),{}))}),[b]),D=Object(a.useCallback)((()=>{S(b.reduce(((e,t)=>({...e,[o(t)]:"deselected"})),{}))}),[b]);return Object(x.jsx)(n.a.Fragment,null,Object(x.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(p,{tagIds:e,tagCache:t})),Object(x.jsx)(i.EuiFlyoutHeader,{hasBorder:!0,className:"tagAssignFlyout_searchContainer"},Object(x.jsx)(v,{onChange:({query:e})=>{C(e)},isLoading:M,types:s}),Object(x.jsx)(O,{resultCount:b.length,initiallyAssigned:A,pendingChanges:I,onReset:R,onSelectAll:N,onDeselectAll:D})),Object(x.jsx)(i.EuiFlexItem,{grow:1},Object(x.jsx)(m,{results:b,isLoading:M,initialStatus:E,overrides:k,onChange:e=>{S((t=>({...t,...e})))}})),Object(x.jsx)(i.EuiFlyoutFooter,null,Object(x.jsx)(y,{isSaving:B,hasPendingChanges:I>0,onSave:$,onCancel:j})))}}}]);