/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.slo_bundle_jsonpfunction=window.slo_bundle_jsonpfunction||[]).push([[20],{143:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={APM:"apm",LOGS:"logs",INFRASTRUCTURE:"infrastructure",OBSERVABILITY:"observability",SLO:"slo",SIEM:"siem",UPTIME:"uptime",ML:"ml",STACK_ALERTS:"stackAlerts",EXAMPLE:"AlertingExample",MONITORING:"monitoring"};Object.values(s).map((e=>e))},245:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a(0);var s=a(16),n=a(55),r=a(28);const l=({children:e,...t})=>Object(r.jsx)(s.Router,t,Object(r.jsx)(n.CompatRouter,null,e))},367:function(e,t,a){"use strict";a.r(t),a.d(t,"getAlertsPanelTitle",(function(){return P})),a.d(t,"getAlertsEmbeddableFactory",(function(){return q}));var s=a(1),n=a(0),r=a.n(n),l=a(245),o=a(10),i=a(139),u=a(17),c=a(7),d=a(56),m=a(3),b=a(21),g=a(32),p=a.n(g),f=a(29),y=a(6),S=a(5),E=a(85);function O({slos:e}){var t;const{data:a}=Object(E.a)({kqlQuery:e.map((e=>`slo.id:${e.id}`)).join(" or "),perPage:0});return r.a.createElement(f.FormattedMessage,{id:"xpack.slo.sloAlertsWrapper.sLOsIncludedFlexItemLabel.withInstances",defaultMessage:"{numOfSlos, number} {numOfSlos, plural, one {SLO} other {SLOs}}{instances} included",values:{numOfSlos:e.length,instances:s.i18n.translate("xpack.slo.sloAlertsWrapper.sLOsIncludedFlexItemLabel.instancesCount",{defaultMessage:" ({count, number} {count, plural, one {Instance} other {Instances}})",values:{count:null!==(t=null==a?void 0:a.total)&&void 0!==t?t:0}})}})}var w=a(38),I=a(143),h=a(75);const v=`${I.a.SLO}-embeddable-alerts-table`,A=10,j="xpack.observability.sloAlertsEmbeddable.alert.table",x=(e,t,a)=>Object(n.useMemo)((()=>{const s={bool:{filter:[{range:{"@timestamp":{gte:t.from}}},{term:{"kibana.alert.rule.rule_type_id":"slo.rules.burnRate"}},{bool:{should:e.map((e=>((e,t,a=!1)=>({bool:{must:[{term:{"slo.id":e}},...t===h.a||a?[]:[{term:{"slo.instanceId":t}}]]}}))(e.id,e.instanceId,a)))}}]}};return s}),[a,e,t.from]);function L({slos:e,deps:t,timeRange:a,onLoaded:s,lastReloadRequestTime:n,showAllGroupByInstances:l}){const{triggersActionsUi:{alertsTableConfigurationRegistry:o,getAlertsStateTable:i},observability:{observabilityRuleTypeRegistry:u}}=t;return r.a.createElement(i,{query:x(e,a,l),alertsTableConfigurationRegistry:o,configurationId:v,featureIds:[I.a.SLO,I.a.OBSERVABILITY],hideLazyLoader:!0,id:j,pageSize:A,showAlertStatusWithFlapping:!0,onLoaded:()=>{s&&s()},lastReloadRequestTime:n,cellContext:{observabilityRuleTypeRegistry:u}})}const R="60s",F="YYYY-MM-DD HH:mm";function T({slos:e,deps:t,timeRange:a,onLoaded:s,showAllGroupByInstances:l}){var o,i;const{triggersActionsUi:{getAlertSummaryWidget:u}}=t,c=x(e,a,l),d=Object(w.useTimeBuckets)(),m=Object(n.useMemo)((()=>Object(w.calculateTimeRangeBucketSize)({from:a.from,to:a.to},d)),[a.from,a.to,d]),b=Object(w.getAlertSummaryTimeRange)({from:a.from,to:a.to},null!==(o=null==m?void 0:m.intervalString)&&void 0!==o?o:R,null!==(i=null==m?void 0:m.dateFormat)&&void 0!==i?i:F);return r.a.createElement(u,{featureIds:S.observabilityAlertFeatureIds,filter:c,timeRange:b,fullSize:!0,onLoaded:()=>{s&&s()}})}function B({slos:e,deps:t,timeRange:a,onRenderComplete:l,reloadSubject:o,showAllGroupByInstances:i,onEdit:u}){const{application:{navigateToUrl:c},http:{basePath:d}}=t,[m,b]=Object(n.useState)(a),[g,p]=Object(n.useState)(void 0);Object(n.useEffect)((()=>{const e=null==o?void 0:o.subscribe((e=>{if(e){const{timeRange:t}=e;!t||t.from===m.from&&t.to===m.to||b(t)}p(Date.now())}));return()=>{null==e||e.unsubscribe()}}),[o,m.from,m.to]),Object(n.useEffect)((()=>{b(a)}),[a]);const[E,w]=Object(n.useState)(!1),[I,h]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{E&&I&&l&&l()}),[E,I,l]),r.a.createElement(C,null,r.a.createElement(k,{"data-shared-item":"",justifyContent:"flexEnd",wrap:!0},r.a.createElement(y.EuiFlexItem,{grow:!1},r.a.createElement(y.EuiLink,{onClick:()=>{u()},"data-test-subj":"o11ySloAlertsWrapperSlOsIncludedLink"},i?r.a.createElement(O,{slos:e}):s.i18n.translate("xpack.slo.sloAlertsWrapper.sLOsIncludedFlexItemLabel",{defaultMessage:"{numOfSlos, number} {numOfSlos, plural, one {SLO} other {SLOs}} included",values:{numOfSlos:e.length}}))),r.a.createElement(y.EuiFlexItem,{grow:!1},r.a.createElement(y.EuiLink,{"data-test-subj":"o11ySloAlertsWrapperGoToAlertsLink",onClick:()=>{let t="";e.map(((a,s)=>{const n=s<e.length-1;t+=`(slo.id:"${a.id}" and slo.instanceId:"${a.instanceId}")`,n&&(t+=" or ")})),c(`${d.prepend(S.observabilityPaths.alerts)}?_a=(kuery:'${t}',rangeFrom:${m.from},rangeTo:${m.to})`)}},r.a.createElement(f.FormattedMessage,{id:"xpack.slo.sloAlertsWrapper.goToAlertsFlexItemLabel",defaultMessage:"Go to alerts"})))),r.a.createElement(y.EuiFlexGroup,{direction:"column",style:{margin:"10px"},responsive:!0},r.a.createElement(y.EuiFlexItem,null,r.a.createElement(T,{slos:e,deps:t,timeRange:m,onLoaded:()=>w(!0),showAllGroupByInstances:i})),r.a.createElement(y.EuiFlexItem,{grow:!0},r.a.createElement(L,{slos:e,deps:t,timeRange:m,onLoaded:()=>h(!0),lastReloadRequestTime:g,showAllGroupByInstances:i}))))}const C=p.a.div.withConfig({displayName:"Wrapper",componentId:"sc-16lwcu8-0"})(["width:100%;overflow:scroll;"]);var k=p()(y.EuiFlexGroup).withConfig({displayName:"_StyledEuiFlexGroup",componentId:"sc-16lwcu8-1"})(["margin:0 35px;"]);const M=Object(d.createBrowserHistory)(),G=new c.QueryClient,P=()=>s.i18n.translate("xpack.slo.sloAlertsEmbeddable.displayTitle",{defaultMessage:"SLO Alerts"});function q(e,t){return{type:b.b,deserializeState:e=>e.rawState,buildEmbeddable:async(d,b,g,p)=>{const[f,y]=await e(),S={...f,...y};async function E(){try{const{openSloConfiguration:e}=await a.e(15).then(a.bind(null,335)),t=await e(f,y,x.getSloAlertsConfig());x.updateSloAlertsConfig(t)}catch(e){return Promise.reject()}}const{titlesApi:O,titleComparators:w,serializeTitles:I}=Object(i.d)(d),h=new o.BehaviorSubject(P()),v=new o.BehaviorSubject(d.slos),A=new o.BehaviorSubject(d.showAllGroupByInstances),j=new o.Subject,x=b({...O,defaultPanelTitle:h,getTypeDisplayName:()=>s.i18n.translate("xpack.slo.editSloAlertswEmbeddable.typeDisplayName",{defaultMessage:"configuration"}),isEditingEnabled:()=>!0,onEdit:async()=>{E()},serializeState:()=>({rawState:{...I(),slos:v.getValue(),showAllGroupByInstances:A.getValue()}}),getSloAlertsConfig:()=>({slos:v.getValue(),showAllGroupByInstances:A.getValue()}),updateSloAlertsConfig:e=>{v.next(e.slos),A.next(e.showAllGroupByInstances)}},{slos:[v,e=>v.next(e)],showAllGroupByInstances:[A,e=>A.next(e)],...w}),L=Object(i.c)(x).pipe().subscribe((e=>{j.next(e)}));return{api:x,Component:()=>{var e;const[a,s]=Object(i.e)(v,A),o=Object(i.f)(x),d=S.i18n.Context;return Object(n.useEffect)((()=>()=>{L.unsubscribe()}),[]),r.a.createElement(d,null,r.a.createElement(u.KibanaContextProvider,{services:{...S,storage:new m.Storage(localStorage),isServerless:!!S.serverless,kibanaVersion:t}},r.a.createElement(l.a,{history:M},r.a.createElement(c.QueryClientProvider,{client:G},r.a.createElement(B,{onEdit:E,deps:S,slos:a,timeRange:null!==(e=o.timeRange)&&void 0!==e?e:{from:"now-15m/m",to:"now"},reloadSubject:j,showAllGroupByInstances:s})))))}}}}}},81:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(34),n=a(74);function r({indexPatternString:e,dataViewId:t}){const{dataViews:a}=Object(n.a)().services,{data:r,loading:l}=Object(s.useFetcher)((async()=>{if(t)try{return await a.get(t)}catch(t){return a.create({id:`${e}-id`,title:e,allowNoIndex:!0})}else if(e)return a.create({id:`${e}-id`,title:e,allowNoIndex:!0})}),[t,a,e]);return{dataView:r,loading:Boolean(l)}}},85:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var s=a(33),n=a(1),r=a(7),l=a(0),o=a(15),i=a(74),u=a(81),c=a(79);function d({kqlQuery:e="",page:t=1,sortBy:a="status",sortDirection:d="desc",perPage:m=o.d,filters:b=[],lastRefresh:g,tagsFilter:p,statusFilter:f,disabled:y=!1}={}){const{http:S,notifications:{toasts:E}}=Object(i.a)().services,O=Object(r.useQueryClient)(),{dataView:w}=Object(u.a)({indexPatternString:o.n}),I=Object(l.useMemo)((()=>{try{return JSON.stringify(Object(s.buildQueryFromFilters)([...b,...f?[f]:[],...p?[p]:[]],w,{ignoreFilterIfFieldNotInIndex:!0}))}catch(e){return""}}),[b,w,p,f]),{isInitialLoading:h,isLoading:v,isError:A,isSuccess:j,isRefetching:x,data:L}=Object(r.useQuery)({queryKey:c.a.list({kqlQuery:e,page:t,perPage:m,sortBy:a,sortDirection:d,filters:I,lastRefresh:g}),queryFn:async({signal:s})=>await S.get("/api/observability/slos",{query:{...e&&{kqlQuery:e},...a&&{sortBy:a},...d&&{sortDirection:d},...void 0!==t&&{page:t},...void 0!==m&&{perPage:m},...I&&{filters:I},hideStale:!0},signal:s}),enabled:!y,cacheTime:0,refetchOnWindowFocus:!1,retry:(e,t)=>"Error: Forbidden"!==String(t)&&e<4,onSuccess:({results:e})=>{O.invalidateQueries({queryKey:c.a.historicalSummaries(),exact:!1}),O.invalidateQueries({queryKey:c.a.activeAlerts(),exact:!1}),O.invalidateQueries({queryKey:c.a.rules(),exact:!1})},onError:e=>{E.addError(e,{title:n.i18n.translate("xpack.slo.list.errorNotification",{defaultMessage:"Something went wrong while fetching SLOs"})})}});return{data:L,isInitialLoading:h,isLoading:v,isRefetching:x,isSuccess:j,isError:A}}}}]);