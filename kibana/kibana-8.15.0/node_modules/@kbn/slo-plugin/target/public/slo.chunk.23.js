/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.slo_bundle_jsonpfunction=window.slo_bundle_jsonpfunction||[]).push([[23],{138:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return l})),a.d(t,"e",(function(){return n})),a.d(t,"a",(function(){return r})),a.d(t,"c",(function(){return i}));const s=5e3,l=10,n=100,r=10,i=1e4},356:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return u}));var s=a(30),l=a(352),n=a(125),r=a(138);function i(e,t){if(e=Object(s.defaults)(e,{count:r.a}),!Object(n.b)(e.field,e.isTextBased))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=e.values,{groups:l,sampledValues:i}=function(e,t){const a={};let l=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let n,r=0;const i={};n=Array.isArray(e)?e:null==e?[]:[e],n.forEach((e=>{const s=t?t.convert(e):e;i[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:r++},i[s]=!0,l++)}))})),{groups:a,sampledValues:l}}(a,t);return{buckets:Object(s.sortBy)(l,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:i,sampledDocuments:e.values.length}}function u(e,t,a){return null!=t&&t.name?Object(s.map)(e,(function(e){return Object(l.a)(e,a,{includeIgnoredValues:!0})[t.name]})):[]}},363:function(e,t,a){"use strict";a.r(t);var s=a(0),l=a.n(s),n=a(9),r=a.n(n);function i(e){return e.isDefault("dateFormat:tz")?r.a.tz.guess()||r()().format("Z"):e.get("dateFormat:tz","Browser")}var u=a(97),o=a(354),c=a(33),d=a(52),m=a.n(d),b=a(6),f=a(29),j=a(40),p=a(1),g=a(125),O=a(10),x=a(63);function y(e,t){const{ast:a}=Object(x.getAstAndSyntaxErrors)(e),s=a.find((({name:e})=>["from","metrics"].includes(e)));if(!s)return e;let l=-1;const n=a.find((({name:e},t)=>(l=t,"sort"===e)));if(!n||n&&1!==l){const a=e.substring(s.location.min,s.location.max+1);return e.replace(a,`${a} \n| LIMIT ${t}`)}const r=e.substring(s.location.min,n.location.max+1);return e.replace(r,`${r} \n| LIMIT ${t}`)}function F(e,t){return`${e}\n${t}`}var h=a(138),v=a(356);async function S(e,t=h.b){const{searchHandler:a,field:s,esqlBaseQuery:l}=e,n=T(s.name),r=T(`${s.name}_terms`),i=F(l,`| WHERE ${n} IS NOT NULL\n    | STATS ${r} = count(${n}) BY ${n}\n    | SORT ${r} DESC\n    | LIMIT ${t}`),u=await a({query:i}),o=null==u?void 0:u.values;if(null==o||!o.length)return{};const c=null==o?void 0:o.reduce(((e,t)=>e+t[0]),0);return{totalDocuments:c,sampledDocuments:c,sampledValues:c,topValues:{buckets:o.map((e=>({count:e[0],key:e[1]})))}}}function T(e){return`\`${e}\``}const D=async({services:e,dataView:t,field:a,fromDate:s,toDate:l,baseQuery:n,abortController:r})=>{const{data:i}=e;try{if(null==t||!t.id||null==a||!a.type)return{};const e=async({query:e})=>{const a=function({timeFieldName:e,fromDate:t,toDate:a}){return e?{range:{[e]:{gte:t,lte:a,format:"strict_date_optional_time"}}}:null}({timeFieldName:t.timeFieldName,fromDate:s,toDate:l}),n=await async function({esqlQuery:e,search:t,signal:a,filter:s,dropNullColumns:l}){const n=await Object(O.lastValueFrom)(t({params:{...s?{filter:s}:{},query:e,...l?{dropNullColumns:!0}:{}}},{abortSignal:a,strategy:"esql_async"}));return{response:n.rawResponse,params:n.requestParams}}({esqlQuery:e,filter:a,search:i.search.search,signal:null==r?void 0:r.signal});return n.response};if(!("esql"in n))throw new Error("query must be of type AggregateQuery");return await async function(e){const{field:t}=e;return Object(g.e)(t)?"boolean"===t.type?await S(e,3):Object(g.f)(t)?await S(e):Object(g.b)(t,!0)?await async function(e){const{searchHandler:t,field:a,esqlBaseQuery:s}=e,l=T(a.name),n=F(s,`| WHERE ${l} IS NOT NULL\n    | KEEP ${l}\n    | LIMIT ${h.e}`),r=await t({query:n}),i=((null==r?void 0:r.values)||[]).map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(null==i||!i.length)return{};const u=null==i?void 0:i.length,o=Object(v.a)({values:i,field:a,count:h.a,isTextBased:!0});return{totalDocuments:u,sampledDocuments:o.sampledDocuments,sampledValues:o.sampledValues,topValues:{buckets:o.buckets,areExamples:!0}}}(e):{}:{}}({searchHandler:e,field:a,esqlBaseQuery:y(n.esql,h.c)})}catch(e){throw new Error("Could not provide field stats",{cause:e})}};var V=a(324),E=a(28);const L=({areExamples:e,buckets:t,dataView:a,field:n,sampledValuesCount:r,color:i=w(),"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c})=>{if(null==t||!t.length)return null;const d=a.getFormatterForField(n),m=A(B(t),r),f=t.some((e=>!Number.isInteger(e.count/r)));return Object(E.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(E.jsx)("div",{"data-test-subj":`${u}-topValues`},t.map(((e,t)=>{const a=e.key,l=d.convert(a);return Object(E.jsx)(s.Fragment,{key:String(a)},t>0&&Object(E.jsx)(b.EuiSpacer,{size:"s"}),Object(E.jsx)(V.default,{field:n,fieldValue:a,formattedFieldValue:l,formattedPercentage:k(e.count,r,f),progressValue:M(e.count,r),count:e.count,color:i,"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c}))})),m>0&&Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiSpacer,{size:"s"}),Object(E.jsx)(V.default,{type:"other",field:n,fieldValue:void 0,formattedPercentage:k(m,r,f),progressValue:M(m,r),count:m,color:i,"data-test-subj":u,onAddFilter:o,overrideFieldTopValueBar:c}))))},w=()=>Object(b.euiPaletteColorBlind)()[1],k=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",M=(e,t)=>t>0?e/t:0,B=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,A=(e,t)=>t&&e?t-e:0,$=({message:e})=>Object(E.jsx)(b.EuiText,{size:"s"},e),C=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!I(a))return null;const l=e.getFormatterForField(t),n=[{key:"min",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:l.convert(a.minValue,"text")},{key:"max",label:p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:l.convert(a.maxValue,"text")}],r=[{field:"label",name:"",align:b.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(E.jsx)("strong",null,e),align:b.RIGHT_ALIGNMENT}],i=p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(E.jsx)(b.EuiBasicTable,{compressed:!0,items:n,columns:r,tableCaption:i,"data-test-subj":`${s}-numberSummary`,responsiveBreakpoint:!1,css:Object(E.css)("& .euiTableHeaderCell{",Object(b.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function I(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}var N=a(355);const R=({services:e,query:t,dslQuery:n,filters:r,fromDate:d,toDate:O,dataViewOrDataViewId:x,field:y,color:F=w(),"data-test-subj":h="fieldStats",overrideMissingContent:v,overrideFooter:S,onAddFilter:T,overrideFieldTopValueBar:V,onStateChange:k})=>{const{fieldFormats:M,uiSettings:N,charts:R,dataViews:z,data:q}=e,[G,Q]=Object(s.useState)({isLoading:!1}),[_,H]=Object(s.useState)(null),P=Object(s.useRef)(null),U=Object(s.useRef)(!1),W=!!t&&Object(c.isOfAggregateQueryType)(t),Z=Object(s.useCallback)((e=>{U.current||Q(e)}),[Q,U]);Object(s.useEffect)((function(){k&&k(G)}),[k,G]);const K=Object(s.useCallback)((e=>{U.current||H(e)}),[H,U]);Object(s.useEffect)((()=>{!async function(){if(!U.current)try{var e;const s="string"==typeof x?await z.get(x):x;if(K(s),G.isLoading)return;Z((e=>({...e,isLoading:!0}))),null===(e=P.current)||void 0===e||e.abort(),P.current=new AbortController;const l=W?await D({services:{data:q},dataView:s,field:y,fromDate:d,toDate:O,baseQuery:t,abortController:P.current}):await(async e=>{const{loadFieldStats:t}=await a.e(28).then(a.bind(null,374));return await t(e)})({services:{data:q},dataView:s,field:y,fromDate:d,toDate:O,dslQuery:null!=n?n:Object(c.buildEsQuery)(s,null!=t?t:[],null!=r?r:[],Object(o.a)(N)),abortController:P.current});P.current=null,Z((e=>({...e,isLoading:!1,totalDocuments:l.totalDocuments,sampledDocuments:l.sampledDocuments,sampledValues:l.sampledValues,histogram:l.histogram,topValues:l.topValues,numberSummary:l.numberSummary})))}catch(e){Z((e=>({...e,isLoading:!1})))}}()}),[x,y,n,t,r,d,O,e]),Object(s.useEffect)((()=>()=>{var e;U.current=!0,null===(e=P.current)||void 0===e||e.abort()}),[]);const Y=R.theme.useChartsBaseTheme(),J=Object(s.useMemo)((()=>F?{barSeriesStyle:{rect:{fill:F}}}:{}),[F]),{isLoading:X,histogram:ee,topValues:te,numberSummary:ae,sampledValues:se,sampledDocuments:le,totalDocuments:ne}=G;let re=!!G.histogram;const ie=m.a.parse(d),ue=m.a.parse(O),oe=B(null==te?void 0:te.buckets),ce=A(oe,se);oe&&ee&&ee.buckets.length&&te&&te.buckets.length&&(re=ce/oe>.9);const[de,me]=Object(s.useState)(re);if(X)return Object(E.jsx)(b.EuiLoadingSpinner,{"data-test-subj":`${h}-statsLoading`});if(!_)return null;const be=_.getFormatterForField(y);let fe=Object(E.jsx)(l.a.Fragment,null);function je(t){const a=function(e,t,a,s){const n="unifiedFieldStats-statsFooter-docsCount",{fieldFormats:r}=t,{totalDocuments:i,sampledValues:o,sampledDocuments:c,topValues:d}=e;if(!i)return Object(E.jsx)(l.a.Fragment,null);let m;return m=a?null!=d&&d.areExamples?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},r.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleValuesLabel",defaultMessage:"Calculated from {sampledValuesFormatted} sample {sampledValues, plural, one {value} other {values}}.",values:{sampledValues:o,sampledValuesFormatted:Object(E.jsx)("strong",{"data-test-subj":n},r.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(o))}}):c&&c<i?Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},r.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(c))}}):Object(E.jsx)(f.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:i,totalDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":n},r.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(i))}}),Object(E.jsx)(b.EuiText,{color:"subdued",size:"xs","data-test-subj":`${s}-statsFooter`},m)}(G,e,W,h);return Object(E.jsx)(l.a.Fragment,null,fe?Object(E.jsx)("div",{"data-test-subj":`${h}-title`},fe):Object(E.jsx)(l.a.Fragment,null),Object(E.jsx)(b.EuiSpacer,{size:"s"}),t,S?null==S?void 0:S({element:a,totalDocuments:ne,sampledDocuments:le}):Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiSpacer,{size:"m"}),a))}if(!Object(g.d)(y,W)){const e=Object(E.jsx)($,{message:p.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return v?v({reason:"unsupported",element:e}):e}if(Object(g.c)(y,W)&&I(ae))return fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),je(Object(E.jsx)(C,{dataView:_,field:y,numberSummary:ae,"data-test-subj":h}));if(!(ee&&0!==ee.buckets.length||te&&0!==te.buckets.length)){const e=le&&ne&&le<ne?Object(E.jsx)($,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:le,sampledDocumentsFormatted:M.getDefaultInstance(u.b.NUMBER,[u.a.INTEGER]).convert(le)}})}):Object(E.jsx)($,{message:p.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return v?v({reason:"no-data",element:e}):e}if(ee&&ee.buckets.length&&te&&te.buckets.length?fe=Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(b.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:p.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${h}-buttonGroup-topValuesButton`},{label:p.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${h}-buttonGroup-distributionButton`}],onChange:e=>{me("histogram"===e)},idSelected:de?"histogram":"topValues"}),Object(E.jsx)(b.EuiSpacer,{size:"xs"})):"date"===y.type?fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,p.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):te&&te.buckets.length&&(fe=Object(E.jsx)(b.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,te.areExamples?p.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):p.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),ee&&ee.buckets.length){const e=p.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===y.type)return je(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(E.jsx)("div",{"data-test-subj":`${h}-histogram`},Object(E.jsx)(j.Chart,{size:{height:200,width:268}},Object(E.jsx)(j.Tooltip,{type:j.TooltipType.None}),Object(E.jsx)(j.Settings,{locale:p.i18n.getLocale(),theme:J,baseTheme:Y,xDomain:ie&&ue?{min:ie.valueOf(),max:ue.valueOf(),minInterval:Math.round((ue.valueOf()-ie.valueOf())/10)}:void 0}),Object(E.jsx)(j.Axis,{id:"key",position:j.Position.Bottom,tickFormat:ie&&ue?Object(j.niceTimeFormatter)([ie.valueOf(),ue.valueOf()]):void 0,showOverlappingTicks:!0}),Object(E.jsx)(j.HistogramBarSeries,{data:ee.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:j.ScaleType.Time,yScaleType:j.ScaleType.Linear,timeZone:i(N)})))));if(de||!te||!te.buckets.length)return je(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(E.jsx)(j.Chart,{"data-test-subj":`${h}-histogram`,size:{height:200,width:"100%"}},Object(E.jsx)(j.Tooltip,{type:j.TooltipType.None}),Object(E.jsx)(j.Settings,{locale:p.i18n.getLocale(),rotation:90,theme:J,baseTheme:Y}),Object(E.jsx)(j.Axis,{id:"key",position:j.Position.Left,showOverlappingTicks:!0,tickFormat:e=>be.convert(e)}),Object(E.jsx)(j.HistogramBarSeries,{data:ee.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:j.ScaleType.Linear,yScaleType:j.ScaleType.Linear}))))}return te&&te.buckets.length?je(Object(E.jsx)(L,{areExamples:te.areExamples,buckets:te.buckets,dataView:_,field:y,sampledValuesCount:se,color:F,"data-test-subj":h,onAddFilter:T,overrideFieldTopValueBar:V})):null};t.default=e=>Object(E.jsx)(N.a,null,Object(E.jsx)(R,e))}}]);