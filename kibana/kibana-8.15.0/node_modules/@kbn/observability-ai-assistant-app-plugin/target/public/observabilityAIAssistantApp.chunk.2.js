/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observabilityAIAssistantApp_bundle_jsonpfunction=window.observabilityAIAssistantApp_bundle_jsonpfunction||[]).push([[2],{104:function(e,t,i){"use strict";i.r(t),i.d(t,"registerFunctions",(function(){return ae}));var a=i(3),s=i(24),n=i(1),r=i.n(n),l=i(4),o=i(0),u=i(36),c=i.n(u);const d="dateFormat";var b=i(50),v=i(29);function p({type:e,timeseries:t,annotations:i}){const s=function(){const e="DARK"===Object(a.useEuiTheme)().colorMode?v.DARK_THEME:v.LIGHT_THEME;return Object(n.useMemo)((()=>({theme:[{chartMargins:{left:10,right:10,top:35,bottom:10},background:{color:"transparent"},lineSeriesStyle:{point:{visible:!1}},areaSeriesStyle:{point:{visible:!1}}}],baseTheme:e})),[e])}();return Object(o.jsx)(v.Chart,{size:{width:128,height:64}},Object(o.jsx)(v.Settings,{theme:[{chartMargins:{left:0,right:0,top:0,bottom:0},chartPaddings:{top:12,bottom:12},lineSeriesStyle:{point:{opacity:0}},areaSeriesStyle:{point:{opacity:0}}},...s.theme],baseTheme:s.baseTheme,showLegend:!1,locale:l.i18n.getLocale()}),Object(o.jsx)(v.Tooltip,{type:"none"}),e&&"bar"===e?Object(o.jsx)(v.BarSeries,{id:"Sparkbar",xScaleType:v.ScaleType.Linear,yScaleType:v.ScaleType.Linear,xAccessor:"x",yAccessors:["y"],data:t}):Object(o.jsx)(v.LineSeries,{id:"Sparkline",xScaleType:v.ScaleType.Time,yScaleType:v.ScaleType.Linear,xAccessor:"x",yAccessors:["y"],data:t,curve:v.CurveType.CURVE_MONOTONE_X}),null==i?void 0:i.map((e=>Object(o.jsx)(v.LineAnnotation,{id:e.id,dataValues:[{dataValue:e.x,header:e.label}],domainType:v.AnnotationDomainType.XDomain,marker:e.icon,markerPosition:v.Position.Bottom,style:{line:{strokeWidth:2,stroke:e.color}}}))))}var g=i(43);let m=function(e){return e[e.low=1]="low",e[e.medium=2]="medium",e[e.high=3]="high",e}({});function y({format:e,time:t}){return c()(t).format(e)}function h({impact:e,theme:t}){return e===m.high?{color:t.colors.danger,label:l.i18n.translate("xpack.observabilityAiAssistant.changesList.dotImpactHigh",{defaultMessage:"High"})}:e===m.medium?{color:t.colors.warning,label:l.i18n.translate("xpack.observabilityAiAssistant.changesList.dotImpactMedium",{defaultMessage:"Medium"})}:{color:t.colors.darkShade,label:l.i18n.translate("xpack.observabilityAiAssistant.changesList.dotImpactLow",{defaultMessage:"Low"})}}var f={name:"1ywqzfv",styles:"display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis"},j={name:"1bmnxg7",styles:"white-space:nowrap"},x={name:"1bmnxg7",styles:"white-space:nowrap"};function O({title:e,items:t}){const i=Object(b.a)(),{services:{uiSettings:s}}=Object(g.a)(),r=Object(n.useMemo)((()=>function({theme:e,uiSettings:t}){const i=t.get(d);return[{name:"",field:"change",render:(t,{change:s})=>{if(!s)return Object(o.jsx)(a.EuiText,{size:"xs",color:"subdued",css:x},l.i18n.translate("xpack.observabilityAiAssistant.changesList.noChangesDetected",{defaultMessage:"No changes detected"}));const{label:n,color:r}=h({theme:e,impact:s.impact});return Object(o.jsx)(a.EuiFlexGroup,{direction:"column",gutterSize:"xs",css:j,justifyContent:"center"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiFlexGroup,{direction:"row",gutterSize:"s"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiFlexGroup,{direction:"row",gutterSize:"none",alignItems:"center"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiIcon,{type:"dot",color:r})),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiText,{size:"xs"},n)))),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiBadge,{color:"hollow"},s.type)))),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiText,{size:"xs",color:"subdued"},y({format:i,time:s.time}))))}},{name:l.i18n.translate("xpack.observabilityAiAssistant.changesList.trendColumnTitle",{defaultMessage:"Trend"}),sortable:!1,field:"timeseries",render:(t,{timeseries:s,change:n})=>Object(o.jsx)(p,{timeseries:s,type:"bar",annotations:n?[{id:"",x:n.time,label:y({format:i,time:n.time}),color:h({impact:n.impact,theme:e}).color,icon:Object(o.jsx)(a.EuiIcon,{type:"dot"})}]:[]})},{name:l.i18n.translate("xpack.observabilityAiAssistant.changesList.labelColumnTitle",{defaultMessage:"Label"}),width:"100%",field:"label",render:(e,{label:t})=>Object(o.jsx)(a.EuiToolTip,{content:t},Object(o.jsx)(a.EuiText,{size:"xs",css:f},t))}]}({theme:i,uiSettings:s})),[i,s]);return Object(o.jsx)(a.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiTitle,{size:"xs"},Object(o.jsx)("h3",null,e))),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiBasicTable,{items:t,columns:r,tableLayout:"auto"})))}function w(e){const t=Object(s.mapValues)(Object(s.groupBy)(e,"name"),((e,t)=>({name:t,items:Object(s.orderBy)(e,(e=>{var t,i;return null!==(t=null===(i=e.changes)||void 0===i?void 0:i.p_value)&&void 0!==t?t:Number.POSITIVE_INFINITY}))})));return Object(s.orderBy)(t,(e=>{var t,i;return null!==(t=null===(i=e.items[0].changes)||void 0===i?void 0:i.p_value)&&void 0!==t?t:Number.POSITIVE_INFINITY}))}function E(e){return{label:"regex"in e?e.regex:e.key,timeseries:e.over_time,change:e.changes&&void 0!==e.changes.p_value&&void 0!==e.changes.time?{impact:(t=e.changes.p_value,t<1e-6?m.high:t<.001?m.medium:m.low),time:new Date(e.changes.time).getTime(),type:e.changes.type}:void 0};var t}function S({logs:e}){const t=w(e);return Object(o.jsx)(a.EuiFlexGroup,{direction:"column"},t.map((e=>Object(o.jsx)(a.EuiFlexItem,null,Object(o.jsx)(O,{title:e.name,items:e.items.map(E)})))))}function A({metrics:e}){const t=w(e);return Object(o.jsx)(a.EuiFlexGroup,{direction:"column"},t.map((e=>Object(o.jsx)(a.EuiFlexItem,null,Object(o.jsx)(O,{title:e.name,items:e.items.map(E)})))))}var T=i(2),_=i.n(T),C=i(10),L=i.n(C);const I="layer",V="infra_lens_ad_hoc_default",F=10;function k(e){return null!=e}const z=({columnName:e,options:t})=>{var i,a;const{interval:s="auto",...n}=null!==(i=null==t?void 0:t.params)&&void 0!==i?i:{};return{[e]:{dataType:"date",isBucketed:!0,label:"@timestamp",operationType:"date_histogram",scale:"interval",sourceField:null!==(a=null==t?void 0:t.sourceField)&&void 0!==a?a:"@timestamp",params:{interval:s,...n}}}},D=({columnName:e,field:t,options:i})=>{const{size:a=F,...s}=null!=i?i:{};return{[e]:{label:`Top ${a} values of ${t}`,dataType:"string",operationType:"terms",scale:"ordinal",sourceField:t,isBucketed:!0,params:{size:a,orderBy:{type:"alphabetical",fallback:!1},orderDirection:"asc",otherBucket:!1,missingBucket:!1,parentFormat:{id:"terms"},include:[],exclude:[],includeIsRegex:!1,excludeIsRegex:!1,...s}}}},M="formula_accessor";class xy_chart_XYChart{constructor(e){L()(this,"_layers",null),this.chartConfig=e}getVisualizationType(){return"lnsXY"}get layers(){return this._layers||(this._layers=Array.isArray(this.chartConfig.layers)?this.chartConfig.layers:[this.chartConfig.layers]),this._layers}getLayers(){return this.layers.reduce(((e,t,i)=>{const a=`${I}_${i}`,s=`${M}_${i}`;return{...e,...t.getLayer(a,s,this.chartConfig.dataView,this.chartConfig.formulaAPI)}}),{})}getVisualizationState(){var e,t,i,a,s,n,r,l,o,u,c;return{...B({layers:[...this.chartConfig.layers.map(((e,t)=>{const i=`${I}_${t}`,a=`${M}_${t}`;return e.getLayerConfig(i,a)}))]}),legend:null!==(e=null===(t=this.chartConfig.visualOptions)||void 0===t?void 0:t.legend)&&void 0!==e?e:{isVisible:!1,position:"right",showSingleSeries:!1},fittingFunction:null!==(i=null===(a=this.chartConfig.visualOptions)||void 0===a?void 0:a.missingValues)&&void 0!==i?i:"None",endValue:null===(s=this.chartConfig.visualOptions)||void 0===s?void 0:s.endValues,curveType:null===(n=this.chartConfig.visualOptions)||void 0===n?void 0:n.lineInterpolation,emphasizeFitting:!(null!==(r=this.chartConfig.visualOptions)&&void 0!==r&&r.showDottedLine),valueLabels:null===(l=this.chartConfig.visualOptions)||void 0===l?void 0:l.valueLabels,axisTitlesVisibilitySettings:null!==(o=null===(u=this.chartConfig.visualOptions)||void 0===u?void 0:u.axisTitlesVisibilitySettings)&&void 0!==o?o:{x:!1,yLeft:!1,yRight:!0},yLeftExtent:null===(c=this.chartConfig.visualOptions)||void 0===c?void 0:c.yLeftExtent}}getReferences(){return this.layers.flatMap(((e,t)=>{const i=`${I}_${t}`;return e.getReference(i,this.chartConfig.dataView)}))}getDataViews(){return[this.chartConfig.dataView,...this.chartConfig.layers.map((e=>e.getDataView())).filter((e=>!!e))]}getTitle(){var e,t;return null!==(e=null!==(t=this.chartConfig.title)&&void 0!==t?t:this.layers[0].getName())&&void 0!==e?e:""}}const B=e=>({legend:{isVisible:!1,position:"right",showSingleSeries:!1,legendStats:[v.LegendValue.CurrentAndLastValue]},valueLabels:"show",yLeftScale:"linear",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},labelsOrientation:{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:"line",hideEndzones:!0,...e});class FormulaColumn{constructor(e){this.valueConfig=e}getValueConfig(){return this.valueConfig}getData(e,t,i,a){const{value:s,...n}=this.getValueConfig(),r=a.insertOrReplaceFormulaColumn(e,{formula:s,...n},t,i);if(!r)throw new Error("Error generating the data layer for the chart");return r}}const R="aggs_breakdown",Q="x_date_histogram";class xy_data_layer_XYDataLayer{constructor(e){var t,i;L()(this,"column",void 0),L()(this,"layerConfig",void 0),this.column=e.data.map((e=>new FormulaColumn(e))),this.layerConfig={...e,layerType:null!==(t=e.layerType)&&void 0!==t?t:"data",options:{...e.options,buckets:{type:"date_histogram",...null===(i=e.options)||void 0===i?void 0:i.buckets}}}}getName(){return this.column[0].getValueConfig().label}getBaseLayer(e,t){var i,a,s;return{..."date_histogram"===(null===(i=t.buckets)||void 0===i?void 0:i.type)?z({columnName:Q,options:{params:{...t.buckets.params},sourceField:null!==(a=t.buckets.field)&&void 0!==a?a:e.timeFieldName}}):{},..."top_values"===(null===(s=t.breakdown)||void 0===s?void 0:s.type)?{...D({columnName:R,field:null==t?void 0:t.breakdown.field,options:{...t.breakdown.params}})}:{}}}getLayer(e,t,i,a){var s,n,r,l,o,u;const c=[];"top_values"===(null===(s=this.layerConfig.options)||void 0===s||null===(n=s.breakdown)||void 0===n?void 0:n.type)&&c.push(R),"date_histogram"===(null===(r=this.layerConfig.options)||void 0===r||null===(l=r.buckets)||void 0===l?void 0:l.type)&&c.push(Q);const d={columnOrder:c,columns:{...this.getBaseLayer(null!==(o=this.layerConfig.dataView)&&void 0!==o?o:i,null!==(u=this.layerConfig.options)&&void 0!==u?u:{})}};return{[e]:this.column.reduce(((e,s,n)=>{var r;return{...e,...s.getData(`${t}_${n}`,e,null!==(r=this.layerConfig.dataView)&&void 0!==r?r:i,a)}}),d)}}getReference(e,t){var i,a,s,n;return a=null!==(i=this.layerConfig.dataView)&&void 0!==i?i:t,s=e,[{type:"index-pattern",id:null!==(n=a.id)&&void 0!==n?n:V,name:`indexpattern-datasource-layer-${s}`}]}getLayerConfig(e,t){var i,a,s,n,r,l;return{layerId:e,seriesType:null!==(i=null===(a=this.layerConfig.options)||void 0===a?void 0:a.seriesType)&&void 0!==i?i:"line",accessors:this.column.map(((e,i)=>`${t}_${i}`)),yConfig:this.layerConfig.data.map((({color:e},i)=>e?{forAccessor:`${t}_${i}`,color:e}:void 0)).filter(k),layerType:"data",xAccessor:"date_histogram"===(null===(s=this.layerConfig.options)||void 0===s||null===(n=s.buckets)||void 0===n?void 0:n.type)?Q:void 0,splitAccessor:"top_values"===(null===(r=this.layerConfig.options)||void 0===r||null===(l=r.breakdown)||void 0===l?void 0:l.type)?R:void 0}}getDataView(){return this.layerConfig.dataView}}class data_view_cache_DataViewCache{constructor(e){L()(this,"cache",new Map),L()(this,"capacity",void 0),this.capacity=e,this.cache=new Map}static getInstance(e=10){return data_view_cache_DataViewCache.instance||(data_view_cache_DataViewCache.instance=new data_view_cache_DataViewCache(e)),data_view_cache_DataViewCache.instance}getSpec(e){var t;const i=null!==(t=e.id)&&void 0!==t?t:"lens_ad_hoc_default",a=this.cache.get(i);if(!a){const t=e.toSpec();return this.setSpec(i,t),t}return a}setSpec(e,t){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}}L()(data_view_cache_DataViewCache,"instance",void 0);class lens_attributes_builder_LensAttributesBuilder{constructor(e){L()(this,"dataViewCache",void 0),this.lens=e,this.dataViewCache=data_view_cache_DataViewCache.getInstance()}build(){const{visualization:e}=this.lens;return{title:e.getTitle(),visualizationType:e.getVisualizationType(),references:e.getReferences(),state:{datasourceStates:{formBased:{layers:e.getLayers()}},internalReferences:e.getReferences(),filters:[],query:{language:"kuery",query:""},visualization:e.getVisualizationState(),adHocDataViews:(t=e.getDataViews().reduce(((e,t)=>({...e,...this.dataViewCache.getSpec(t)})),{}),{[null!==(i=t.id)&&void 0!==i?i:V]:{...t}})}};var t,i}}var N=i(62),q=i.n(N);function $({indexPattern:e,xyDataLayer:t,start:i,end:s,lens:u,dataViews:c,timeField:d}){const b=q()((()=>u.stateHelperApi()),[u]),v=q()((()=>c.create({title:e,timeFieldName:d})),[e,c,d]),[p,g]=Object(n.useState)(!1);if(!b.value||!v.value)return Object(o.jsx)(a.EuiLoadingSpinner,null);const m=new lens_attributes_builder_LensAttributesBuilder({visualization:new xy_chart_XYChart({layers:[t],formulaAPI:b.value.formula,dataView:v.value})}).build(),y={id:e,attributes:m,timeRange:{from:i,to:s,mode:"relative"}};return Object(o.jsx)(r.a.Fragment,null,Object(o.jsx)(a.EuiFlexGroup,{direction:"column"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiFlexGroup,{direction:"row",gutterSize:"s",justifyContent:"flexEnd"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiButton,{"data-test-subj":"observabilityAiAssistantLensOpenInLensButton",iconType:"lensApp",onClick:()=>{u.navigateToPrefilledEditor(y)}},l.i18n.translate("xpack.observabilityAiAssistant.lensFunction.openInLens",{defaultMessage:"Open in Lens"}))),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiButton,{"data-test-subj":"observabilityAiAssistantLensSaveButton",iconType:"save",onClick:()=>{g((()=>!0))}},l.i18n.translate("xpack.observabilityAiAssistant.lensFunction.save",{defaultMessage:"Save"}))))),Object(o.jsx)(a.EuiFlexItem,null,Object(o.jsx)(u.EmbeddableComponent,_()({},y,{style:{height:240}})))),p?Object(o.jsx)(u.SaveModalComponent,{initialInput:y,onClose:()=>{g((()=>!1))}}):null)}var G=i(37),P=i(38);const U="esql";async function H(e){if(crypto.subtle){const t=new TextEncoder,i=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}{const{sha256:t}=await i.e(3).then(i.bind(null,102));return t(e)}}var X=i(12);const Y=({filters:e,query:t,suggestion:i,dataView:a})=>{var s;const n=Object.assign({},null==i?void 0:i.datasourceState),r=Object.assign({},null==i?void 0:i.visualizationState),o=i&&i.datasourceState?{[i.datasourceId]:{...n}}:{formBased:{}},u=r;return{title:null!==(s=null==i?void 0:i.title)&&void 0!==s?s:l.i18n.translate("visualizationUtils.config.suggestion.title",{defaultMessage:"New suggestion"}),references:[],state:{datasourceStates:o,filters:e,query:t,visualization:u,...a&&a.id&&!a.isPersisted()&&{adHocDataViews:{[a.id]:a.toMinimalSpec()}}},visualizationType:i?i.visualizationId:"lnsXY"}};var W=i(6),K=i.n(W),J=i(27),Z=function(e){return e.XY="XY",e.Bar="Bar",e.Line="Line",e.Area="Area",e.Donut="Donut",e.Heatmap="Heat map",e.Treemap="Treemap",e.Tagcloud="Tag cloud",e.Waffle="Waffle",e.Table="Table",e}(Z||{});const ee=l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.save",{defaultMessage:"Save visualization"}),te=l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.edit",{defaultMessage:"Edit visualization"});function ie({lens:e,dataViews:t,uiActions:i,columns:s,rows:u,query:c,onActionClick:d,userOverrides:b,preferredChartType:v,ObservabilityAIAssistantMultipaneFlyoutContext:p,errorMessages:g}){var m;const y=function(e){var t;const{ast:i}=Object(P.getAstAndSyntaxErrors)(e),a=i.find((({name:e})=>["from","metrics"].includes(e))),s=(null!==(t=null==a?void 0:a.args)&&void 0!==t?t:[]).filter((e=>"index"===e.sourceType));return null==s?void 0:s.map((e=>e.text)).join(",")}(c),h=q()((()=>e.stateHelperApi()),[e]),f=q()((()=>async function(e,t){var i,a,s;const n=await t.create({title:e,type:U,id:await H(`esql-${e}`)});return e&&"date"===(null==n||null===(i=n.fields)||void 0===i||null===(a=i.getByName)||void 0===a||null===(s=a.call(i,"@timestamp"))||void 0===s?void 0:s.type)&&(n.timeFieldName="@timestamp"),n}(y,t)),[y,t]),j=Object(n.useContext)(p),[x,O]=Object(n.useState)(!1),[w,E]=Object(n.useState)(!1),[S,A]=Object(n.useState)(b),[T,C]=Object(n.useState)(null),L=Object(n.useCallback)(((e,t,i)=>{var a;(null==t||null===(a=t.tables)||void 0===a?void 0:a.tables)&&!e&&C({adapters:t,embeddableOutput$:i})}),[]);Object(n.useEffect)((()=>{if(h.value&&f.value&&!S){var e;const t={dataViewSpec:null===(e=f.value)||void 0===e?void 0:e.toSpec(),fieldName:"",textBasedColumns:s,query:{esql:c}},i=h.value.suggestions(t,f.value,[],v);if(null!=i&&i.length){const[e]=i,t={attributes:Y({filters:[],query:{esql:c},suggestion:e,dataView:f.value}),id:Object(J.v4)()};A(t)}}}),[s,f.value,h.value,S,c,v]);const I=Object(n.useMemo)((()=>{if(null!=S&&S.attributes)return{attributes:null==S?void 0:S.attributes,lensEvent:null!=T?T:{adapters:{}},onUpdate:e=>{if(S){const t={...S,attributes:e};A(t)}},onApply:e=>{var t;const i={...S,attributes:e};d({type:X.ChatActionClickType.updateVisualization,userOverrides:i,query:c}),null==j||null===(t=j.setVisibility)||void 0===t||t.call(j,!1),null!=j&&j.container&&K.a.unmountComponentAtNode(j.container)},onCancel:()=>{var e;d({type:X.ChatActionClickType.updateVisualization,userOverrides:S,query:c}),null==j||null===(e=j.setVisibility)||void 0===e||e.call(j,!1),null!=j&&j.container&&K.a.unmountComponentAtNode(j.container)},container:null==j?void 0:j.container}}),[j,S,T,d,c]);if(!h.value||!f.value||!S)return Object(o.jsx)(a.EuiLoadingSpinner,null);const V="lnsDatatable"===(null==S||null===(m=S.attributes)||void 0===m?void 0:m.visualizationType),F=w?"observabilityAiAssistantESQLDataGrid":"observabilityAiAssistantESQLLensChart";return Object(o.jsx)(r.a.Fragment,null,Object(o.jsx)(a.EuiFlexGroup,{direction:"column"},!(null==g||!g.length)&&Object(o.jsx)(r.a.Fragment,null,Object(o.jsx)(a.EuiText,{size:"s"},l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.errorMessage",{defaultMessage:"There were some errors in the generated query"})),Object(o.jsx)(a.EuiDescriptionList,{"data-test-subj":"observabilityAiAssistantErrorsList"},g.map(((e,t)=>Object(o.jsx)(a.EuiDescriptionListDescription,{key:t},Object(o.jsx)(a.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiIcon,{type:"error",color:"danger",size:"s"})),Object(o.jsx)(a.EuiFlexItem,{grow:!1},e))))))),!V&&Object(o.jsx)(r.a.Fragment,null,Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiFlexGroup,{direction:"row",gutterSize:"s",justifyContent:"flexEnd"},Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiToolTip,{content:w?l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.visualization",{defaultMessage:"Visualization"}):l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.table",{defaultMessage:"Table of results"})},Object(o.jsx)(a.EuiButtonIcon,{size:"xs",iconType:w?"visBarVerticalStacked":"tableDensityExpanded",onClick:()=>E(!w),"data-test-subj":"observabilityAiAssistantLensESQLDisplayTableButton","aria-label":w?l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.displayChart",{defaultMessage:"Display chart"}):l.i18n.translate("xpack.observabilityAiAssistant.lensESQLFunction.displayTable",{defaultMessage:"Display table"})}))),Object(o.jsx)(a.EuiToolTip,{content:te},Object(o.jsx)(a.EuiButtonIcon,{size:"xs",iconType:"pencil",onClick:()=>{var e;null==j||null===(e=j.setVisibility)||void 0===e||e.call(j,!0),I&&i.getTrigger("IN_APP_EMBEDDABLE_EDIT_TRIGGER").exec(I)},"data-test-subj":"observabilityAiAssistantLensESQLEditButton","aria-label":te})),Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(a.EuiToolTip,{content:ee},Object(o.jsx)(a.EuiButtonIcon,{size:"xs",iconType:"save",onClick:()=>O(!0),"data-test-subj":"observabilityAiAssistantLensESQLSaveButton","aria-label":ee}))))),Object(o.jsx)(a.EuiFlexItem,{"data-test-subj":F},w?Object(o.jsx)(G.ESQLDataGrid,{rows:u,columns:s,dataView:f.value,query:{esql:c},flyoutType:"overlay",isTableView:!0}):Object(o.jsx)(e.EmbeddableComponent,_()({},S,{style:{height:240},onLoad:L})))),V&&!(null!=g&&g.length)&&Object(o.jsx)(a.EuiFlexItem,{"data-test-subj":"observabilityAiAssistantESQLDataGrid"},Object(o.jsx)(G.ESQLDataGrid,{rows:u,columns:s,dataView:f.value,query:{esql:c},flyoutType:"overlay"}))),x?Object(o.jsx)(e.SaveModalComponent,{initialInput:S,onClose:()=>{O((()=>!1))},isSaveable:!1}):null)}async function ae({registerRenderFunction:e,pluginsStart:t}){!function({registerRenderFunction:e,pluginsStart:t}){e("lens",(({arguments:{layers:e,indexPattern:i,breakdown:a,seriesType:s,start:n,end:r,timeField:l}})=>{const u=new xy_data_layer_XYDataLayer({data:e.map((e=>{var t;return{type:"formula",value:e.formula,label:e.label,format:e.format,filter:{language:"kql",query:null!==(t=e.filter)&&void 0!==t?t:""}}})),options:{seriesType:s,breakdown:a?{type:"top_values",params:{size:10},field:a.field}:void 0}});if(l)return Object(o.jsx)($,{indexPattern:i,xyDataLayer:u,start:n,end:r,lens:t.lens,dataViews:t.dataViews,timeField:l})}))}({pluginsStart:t,registerRenderFunction:e}),function({registerRenderFunction:e,pluginsStart:t}){e("visualize_query",(({arguments:{query:e,userOverrides:i,intention:a},response:s,onActionClick:n})=>{const r=s,l="data"in r?r.data.columns:r.content,u="data"in r?r.data.rows:[],c="content"in r&&"errorMessages"in r.content?r.content.errorMessages:[];let d;switch("data"in r&&"userOverrides"in r.data&&(i=r.data.userOverrides),a){case X.VisualizeESQLUserIntention.executeAndReturnResults:case X.VisualizeESQLUserIntention.generateQueryOnly:case X.VisualizeESQLUserIntention.visualizeAuto:break;case X.VisualizeESQLUserIntention.visualizeBar:d=Z.Bar;break;case X.VisualizeESQLUserIntention.visualizeDonut:d=Z.Donut;break;case X.VisualizeESQLUserIntention.visualizeHeatmap:d=Z.Heatmap;break;case X.VisualizeESQLUserIntention.visualizeLine:d=Z.Line;break;case X.VisualizeESQLUserIntention.visualizeArea:d=Z.Area;break;case X.VisualizeESQLUserIntention.visualizeTable:d=Z.Table;break;case X.VisualizeESQLUserIntention.visualizeTagcloud:d=Z.Tagcloud;break;case X.VisualizeESQLUserIntention.visualizeTreemap:d=Z.Treemap;break;case X.VisualizeESQLUserIntention.visualizeWaffle:d=Z.Waffle;break;case X.VisualizeESQLUserIntention.visualizeXy:d=Z.XY}const b=e.trim();return Object(o.jsx)(ie,{ObservabilityAIAssistantMultipaneFlyoutContext:t.observabilityAIAssistant.ObservabilityAIAssistantMultipaneFlyoutContext,lens:t.lens,dataViews:t.dataViews,uiActions:t.uiActions,columns:l,rows:u,query:b,onActionClick:n,userOverrides:i,preferredChartType:d,errorMessages:c})}))}({pluginsStart:t,registerRenderFunction:e}),function({registerRenderFunction:e,pluginsStart:t}){e("changes",(({arguments:e,response:t})=>{const{data:{changes:{metrics:i,logs:s}}}=t;return Object(o.jsx)(a.EuiFlexGroup,{direction:"column",gutterSize:"l"},s.length?Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(S,{logs:s})):null,i.length?Object(o.jsx)(a.EuiFlexItem,{grow:!1},Object(o.jsx)(A,{metrics:i})):null)}))}({pluginsStart:t,registerRenderFunction:e})}},43:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(14);const s=()=>Object(a.useKibana)()},50:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(3);function s(){return Object(a.useEuiTheme)().euiTheme}},62:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(18),s=i(1),n=a.__importDefault(i(89));t.default=function(e,t){void 0===t&&(t=[]);var i=n.default(e,t,{loading:!0}),a=i[0],r=i[1];return s.useEffect((function(){r()}),[r]),a}},89:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(18),s=i(1),n=a.__importDefault(i(90));t.default=function(e,t,i){void 0===t&&(t=[]),void 0===i&&(i={loading:!1});var r=s.useRef(0),l=n.default(),o=s.useState(i),u=o[0],c=o[1],d=s.useCallback((function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=++r.current;return c((function(e){return a.__assign(a.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return l()&&s===r.current&&c({value:e,loading:!1}),e}),(function(e){return l()&&s===r.current&&c({error:e,loading:!1}),e}))}),t);return[u,d]}},90:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(1);t.default=function(){var e=a.useRef(!1),t=a.useCallback((function(){return e.current}),[]);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}}}]);