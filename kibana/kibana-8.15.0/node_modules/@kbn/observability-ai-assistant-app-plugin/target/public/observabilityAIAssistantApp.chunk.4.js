/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observabilityAIAssistantApp_bundle_jsonpfunction=window.observabilityAIAssistantApp_bundle_jsonpfunction||[]).push([[4],{105:function(t,e,s){"use strict";s.r(e),s.d(e,"NavControl",(function(){return E}));var i=s(1),n=s.n(i),o=s(12),a=s(3),r=s(0),c=s(27),l=s(5),u=s.n(l),b=s(4),d=s(45),v=s(55),p=s(43),A=s(39),O=s(15),f=s(40);var j=s(50),w=s(91),h=s.n(w),y=s(41),g=s.n(y);function E({}){var t;const e=Object(d.a)(),{services:{notifications:s,plugins:{start:{observabilityAIAssistant:{ObservabilityAIAssistantChatServiceContext:l}}}}}=Object(p.a)(),[w,y]=Object(i.useState)(!1);!function(){const t=Object(d.a)(),{services:{plugins:{start:{data:e}}}}=Object(p.a)(),{from:s,to:n}=e.query.timefilter.timefilter.getTime(),[o,a]=Object(i.useState)(window.location.href);Object(i.useEffect)((()=>{const t=window.history.pushState.bind(window.history),e=window.history.replaceState.bind(window.history);let s=!1;function i(){s||a(window.location.href)}return window.history.pushState=(...e)=>{t(...e),i()},window.history.replaceState=(...t)=>{e(...t),i()},window.addEventListener("popstate",i),window.addEventListener("hashchange",i),()=>{s=!0,window.removeEventListener("popstate",i),window.removeEventListener("hashchange",i)}}),[]),Object(i.useEffect)((()=>{var e,i,a,r;const c=null!==(e=null===(i=h.a.parse(s))||void 0===i?void 0:i.toISOString())&&void 0!==e?e:g()().subtract(1,"day").toISOString(),l=null!==(a=null===(r=h.a.parse(n))||void 0===r?void 0:r.toISOString())&&void 0!==a?a:g()().toISOString();return t.setScreenContext({screenDescription:`The user is looking at ${o}. The current time range is ${c} - ${l}.`})}),[t,s,n,o])}();const E=Object(o.useAbortableAsync)((({signal:t})=>w?e.start({signal:t}).catch((t=>{throw s.toasts.addError(t,{title:b.i18n.translate("xpack.observabilityAiAssistant.navControl.initFailureErrorTitle",{defaultMessage:"Failed to initialize Observability AI Assistant"})}),y(!1),T(!1),t})):void 0),[e,w,s.toasts]),[m,T]=Object(i.useState)(!1),C=Object(i.useRef)(Object(c.v4)()),{isVisible:I}=function(){const[t,e]=Object(i.useState)(!1),{services:{application:{currentAppId$:s,applications$:n},plugins:{start:{aiAssistantManagementSelection:o}}}}=Object(p.a)();return Object(i.useEffect)((()=>Object(A.combineLatest)([s,n,o.aiAssistantType$]).subscribe({next:([t,s,i])=>{e(function(t,e,s){var i,n;if(s===f.AIAssistantType.Never)return!1;const o=t&&(null===(i=e.get(t))||void 0===i||null===(n=i.category)||void 0===n?void 0:n.id)||O.DEFAULT_APP_CATEGORIES.kibana.id;return s===f.AIAssistantType.Observability?o!==O.DEFAULT_APP_CATEGORIES.security.id:o===O.DEFAULT_APP_CATEGORIES.observability.id}(t,s,i))}}).unsubscribe),[s,n,o.aiAssistantType$]),{isVisible:t}}();Object(i.useEffect)((()=>{const t=e.conversations.predefinedConversation$.subscribe((()=>{y(!0),T(!0)}));return()=>{t.unsubscribe()}}),[e.conversations.predefinedConversation$]);const{messages:x,title:L}=null!==(t=u()(e.conversations.predefinedConversation$))&&void 0!==t?t:{messages:[],title:void 0},$=Object(j.a)(),_=Object(r.css)("padding:0px 8px;svg path{fill:",$.colors.darkestShade,";}","");return Object(i.useEffect)((()=>{const t=t=>{t.ctrlKey&&"Semicolon"===t.code&&e.conversations.openNewConversation({messages:[]})};return window.addEventListener("keypress",t),()=>{window.removeEventListener("keypress",t)}}),[e.conversations]),I?Object(r.jsx)(n.a.Fragment,null,Object(r.jsx)(a.EuiToolTip,{content:S},Object(r.jsx)(a.EuiButton,{"aria-label":S,"data-test-subj":"observabilityAiAssistantAppNavControlButton",css:_,onClick:()=>{e.conversations.openNewConversation({messages:[]})},color:"primary",size:"s",fullWidth:!1,minWidth:0},E.loading?Object(r.jsx)(a.EuiLoadingSpinner,{size:"s"}):Object(r.jsx)(o.AssistantAvatar,{size:"xs"}))),E.value?Object(r.jsx)(l.Provider,{value:E.value},Object(r.jsx)(v.a,{key:C.current,isOpen:m,initialMessages:x,initialTitle:null!=L?L:"",onClose:()=>{T(!1)}})):void 0):null}const S=b.i18n.translate("xpack.observabilityAiAssistant.navControl.openTheAIAssistantPopoverLabel",{defaultMessage:"Open the AI Assistant"})},50:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s(3);function n(){return Object(i.useEuiTheme)().euiTheme}},91:function(t,e,s){t.exports=s(13)(173)}}]);