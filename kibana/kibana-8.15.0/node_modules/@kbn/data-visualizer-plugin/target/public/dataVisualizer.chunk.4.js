/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[4],{105:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n}));const i=()=>({isRunning:!1,loaded:0,total:100}),n=()=>(e,t)=>({...e,...t})},114:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return s}));var i=a(4);const n=75,s=i.i18n.translate("xpack.dataVisualizer.chrome.help.appName",{defaultMessage:"Data Visualizer"})},118:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var i=a(0),n=a(126),s=a(40),r=a(81),l=a(84),o=a(102),c=a(65),u=a(6),d=a(80),p=a(1);const b=({config:e,dataView:t,combinedQuery:a,esql:n,timeFieldName:b})=>{const{stats:m}=e,[g,f]=Object(i.useState)([]),{services:{maps:j,data:v}}=Object(c.a)(),x=Object(i.useMemo)((()=>a?{query:a.searchString,language:a.searchQueryLanguage}:void 0),[a]);return Object(i.useEffect)((()=>{if(!j)return;if(null==t||!t.id||null==e||!e.fieldName||e.type!==u.i.GEO_POINT&&e.type!==u.i.GEO_SHAPE)return void f([]);let a=!1;return j.createLayerDescriptors.createESSearchSourceLayerDescriptor({indexPatternId:t.id,geoFieldName:e.fieldName,geoFieldType:e.type}).then((i=>{if(!a)if(void 0!==n){var s;const a={columns:[{name:e.fieldName,type:e.type}],dataViewId:t.id,dateField:null!==(s=t.timeFieldName)&&void 0!==s?s:b,geoField:e.fieldName,esql:n,narrowByGlobalSearch:!0,narrowByGlobalTime:!0,narrowByMapBounds:!0,id:i.sourceDescriptor.id,type:"ESQL",applyForceRefresh:!0};f([{...i,sourceDescriptor:a}])}else f([i])})).catch((()=>{a||f([])})),()=>{a=!0}}),[t,a,n,e,j,b]),void 0===(null==m?void 0:m.examples)?null:Object(p.jsx)(r.a,{dataTestSubj:"dataVisualizerIndexBasedMapContent"},Object(p.jsx)(l.a,{config:e}),Object(p.jsx)(o.a,{examples:null==m?void 0:m.examples}),j&&Object(p.jsx)(d.a,{className:"dvPanel__wrapper dvMap__wrapper",grow:!0},Object(p.jsx)(j.Map,{layerList:g,hideFilterActions:!0,mapSettings:{initialLocation:s.INITIAL_LOCATION.AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:!0},filters:v.query.filterManager.getFilters(),query:x,timeRange:v.query.timefilter.timefilter.getTime()})))};var m=a(143),g=a(10),f=a(25);const j=()=>Object(p.jsx)(i.Fragment,null,Object(p.jsx)(g.EuiText,{textAlign:"center"},Object(p.jsx)(g.EuiIcon,{type:"warning"})),Object(p.jsx)(g.EuiText,{textAlign:"center",size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"}))),v=()=>Object(p.jsx)(i.Fragment,null,Object(p.jsx)(g.EuiSpacer,{size:"xxl"}),Object(p.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(p.jsx)(g.EuiFlexItem,{grow:!1},Object(p.jsx)(g.EuiLoadingSpinner,{size:"l"}))),Object(p.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(p.jsx)(g.EuiFlexItem,{grow:!1},Object(p.jsx)(g.EuiText,{color:"subdued"},Object(p.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.loadingLabel",defaultMessage:"Loading"})))));var x=a(128);const O=({item:e,dataView:t,combinedQuery:a,onAddFilter:i,esql:s,totalDocuments:r,timeFieldName:l,typeAccessor:o="type"})=>{const c={...e,stats:{...e.stats,totalDocuments:r}},{loading:d,existsInDocs:g,fieldName:f}=c,O=c[o],y=Object(n.a)();return Object(p.jsx)("div",{css:y,"data-test-subj":`dataVisualizerFieldExpandedRow-${f}`},!0===d?Object(p.jsx)(v,null):function(){var e,n;if(!1===g)return Object(p.jsx)(j,null);if(null!==(e=c.stats)&&void 0!==e&&e.error)return Object(p.jsx)(x.a,{fieldName:f,error:null===(n=c.stats)||void 0===n?void 0:n.error});switch(O){case u.i.NUMBER:return Object(p.jsx)(m.e,{config:c,onAddFilter:i});case u.i.BOOLEAN:return Object(p.jsx)(m.a,{config:c,onAddFilter:i});case u.i.DATE:return Object(p.jsx)(m.b,{config:c});case u.i.GEO_POINT:case u.i.GEO_SHAPE:return Object(p.jsx)(b,{config:c,dataView:t,combinedQuery:a,esql:s,timeFieldName:l});case u.i.IP:return Object(p.jsx)(m.c,{config:c,onAddFilter:i});case u.i.KEYWORD:case u.i.VERSION:return Object(p.jsx)(m.d,{config:c,onAddFilter:i});case u.i.TEXT:return Object(p.jsx)(m.g,{config:c});default:return Object(p.jsx)(m.f,{config:c})}}())}},131:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a(0);const n=Object(i.createContext)(void 0)},132:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i={startPageChange:"start::pageChange",endPageReady:"end::pageReady"}},133:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a(220),n=a(5);const s=(e,t,a)=>{const s={percentiles:[],minPercentile:0,maxPercentile:100};if(0===e.length)return s;let r=[],l=a;if(l>=0){s.minPercentile=0,s.maxPercentile=90,r=e.slice(0,e.length-2);const a=l+1.5*(Object(n.last)(r).value-l);for(let i=r.length;i<e.length&&e[i].value<a;i++)r.push(e[i]),s.maxPercentile+=t}else{const t=l;l=e[0].value,s.minPercentile=5,s.maxPercentile=95,r=e.slice(1,e.length-1);const a=Object(n.last)(r).value,i=.25*(a-l);l-t<i&&(r.splice(0,0,e[0]),s.minPercentile=0,l=t),e[e.length-1].value-a<i&&(r.push(e[e.length-1]),s.maxPercentile=100)}const o=r.length;let c=l,u=0;for(let e=0;e<o;e++){const a=r[e];Object(i.a)(a.value)&&(a.value.toPrecision(15)!==c.toPrecision(15)?(u>0&&s.percentiles.push({percent:u*t,minValue:c,maxValue:c}),s.percentiles.push({percent:t,minValue:c,maxValue:a.value}),c=a.value,u=0):(u++,e===o-1&&s.percentiles.push({percent:u*t,minValue:c,maxValue:c})))}return s}},142:function(e,t,a){"use strict";a.d(t,"b",(function(){return H})),a.d(t,"a",(function(){return W}));var i=a(1),n=a(0),s=a.n(n),r=a(27),l=a(10),o=a(32),c=a(38),u=a(63),d=a(230),p=a(302),b=a(295),m=a(109),g=a(229),f=a(129),j=a(77),v=a(103),x=a(108),O=a(118),y=a(72),h=a(65),E=a(187),S=a(183),F=a(6),w=a(156),N=a(4),A=a(121);const M=({overallStats:e,setVisibleFieldNames:t,visibleFieldNames:a,showEmptyFields:s})=>{const r=Object(n.useMemo)((()=>{const t=[];return e&&Object.keys(e).forEach((a=>{const i=e[a];Array.isArray(i)&&i.length>0&&i.forEach((e=>{!0!==e.existsInDocs&&!0!==s||void 0===e.fieldName?t.push({value:e.fieldName,disabled:!0}):t.push({value:e.fieldName})}))})),t}),[e,s]),l=Object(n.useMemo)((()=>N.i18n.translate("xpack.dataVisualizer.index.fieldNameSelect",{defaultMessage:"Field name"})),[]);return Object(i.jsx)(A.a,{title:l,options:r,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldNameSelect"})};var _=a(292),T=a(190),V=a(120);const C=({indexedFieldTypes:e,setVisibleFieldTypes:t,visibleFieldTypes:a})=>{const r=Object(j.a)(),o=Object(n.useMemo)((()=>e.map((e=>{var t;const a=null!==(t=Object(_.a)(e))&&void 0!==t?t:e;return{value:e,name:Object(i.jsx)(l.EuiFlexGroup,null,Object(i.jsx)(l.EuiFlexItem,{grow:!0}," ",a),e&&Object(i.jsx)(l.EuiFlexItem,{grow:!1},Object(i.jsx)(V.a,{type:e,tooltipEnabled:!1})))}}))),[e]),c=Object(n.useMemo)((()=>N.i18n.translate("xpack.dataVisualizer.index.fieldTypeSelect",{defaultMessage:"Field type"})),[]);return Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(A.a,{title:c,options:o,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldTypeSelect",postfix:Object(i.jsx)(T.a,{fieldTypes:e}),cssStyles:{filterGroup:Object(i.css)("margin-left:",r.euiSizeS,";","")}}))},z=({dataView:e,searchString:t,searchQuery:a,searchQueryLanguage:n,overallStats:s,indexedFieldTypes:r,setVisibleFieldTypes:o,visibleFieldTypes:c,setVisibleFieldNames:u,visibleFieldNames:d,setSearchParams:p,showEmptyFields:b})=>{const m=Object(i.css)({marginLeft:"0px !important",paddingLeft:"0px !important",paddingRight:"0px !important",flexDirection:"row",[Object(l.useEuiBreakpoint)(["xs","s","m","l"])]:{padding:0}},"",""),g=Object(i.css)({alignItems:"baseline",[Object(l.useEuiBreakpoint)(["xs","s","m","l"])]:{flexDirection:"column"}},"",""),f=Object(i.css)({[Object(l.useEuiBreakpoint)(["xs","s","m","l"])]:{minWidth:"max(100%, 300px)"}},"",""),j=Object(l.useIsWithinMaxBreakpoint)("xl");return Object(i.jsx)(l.EuiFlexGroup,{gutterSize:"none","data-test-subj":"dataVisualizerSearchPanel",css:g,responsive:!1},Object(i.jsx)(l.EuiFlexItem,{grow:9,css:f},Object(i.jsx)(w.a,{dataView:e,setSearchParams:p,searchString:t,searchQuery:a,searchQueryLanguage:n})),j?Object(i.jsx)(l.EuiSpacer,{size:"s"}):null,Object(i.jsx)(l.EuiFlexItem,{grow:2,css:m},Object(i.jsx)(M,{overallStats:s,setVisibleFieldNames:u,visibleFieldNames:d,showEmptyFields:b}),Object(i.jsx)(C,{indexedFieldTypes:r,setVisibleFieldTypes:o,visibleFieldTypes:c})))};var I=a(5),R=a(25),k=a(220),L=a(71),D=a.n(L);const P=({icon:e,iconAreaLabel:t,title:a,description:n,onClick:s,href:r,isDisabled:o,"data-test-subj":c})=>{const u=Object(j.a)(),d={...r?{href:r}:{},...s?{onClick:s}:{}};return Object(i.jsx)(l.EuiPanel,{style:{cursor:o?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(i.jsx)(l.EuiLink,D()({style:{display:"block",pointerEvents:o?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":c,color:"subdued"},d),Object(i.jsx)(l.EuiFlexGroup,{gutterSize:"s",responsive:!0},Object(i.jsx)(l.EuiFlexItem,{grow:!1,css:Object(i.css)({paddingTop:u.euiSizeXS},"","")},"string"==typeof e?Object(i.jsx)(l.EuiIcon,{size:"m",type:e,"aria-label":t}):e),Object(i.jsx)(l.EuiFlexItem,null,Object(i.jsx)(l.EuiTitle,{size:"xs"},Object(i.jsx)("h3",null,a)),Object(i.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(i.jsx)("p",null,n))))))},B=({dataView:e,searchString:t,searchQueryLanguage:a,getAdditionalLinks:r})=>{const[o]=Object(u.f)("_g"),[c,d]=Object(n.useState)(""),[p,b]=Object(n.useState)(),{services:{data:m,application:{capabilities:g},share:{url:f}}}=Object(h.a)();Object(n.useEffect)((()=>{let i=!1;const n=e.id,s=e.getIndexPattern();return Array.isArray(r)&&void 0!==n&&Promise.all(r.map((async e=>{const t=await e({dataViewId:n,dataViewTitle:s});if(Array.isArray(t))return await Promise.all(t.map((async e=>({...e,canDisplay:await e.canDisplay(),href:await e.getUrl()}))))}))).then((e=>{b(Object(I.flatten)(e).filter(k.a).filter((e=>!0===e.canDisplay)))})),(async()=>{var e,s,r;if(null===(e=null===(s=g.discover)||void 0===s?void 0:s.show)||void 0===e||!e)return;const l=null==f?void 0:f.locators.get("DISCOVER_APP_LOCATOR");if(!l)return void console.error("Discover locator not available");const c=await l.getUrl({indexPatternId:n,filters:null!==(r=m.query.filterManager.getFilters())&&void 0!==r?r:[],query:t&&void 0!==a?{query:t,language:a}:void 0,timeRange:null!=o&&o.time?o.time:void 0,refreshInterval:null!=o&&o.refreshInterval?o.refreshInterval:void 0});i||d(c)})(),()=>{i=!0}}),[e,t,a,o,g,f,m.query,r]);const j=c||Array.isArray(p)&&p.length>0,v=Object(i.css)({[Object(l.useEuiBreakpoint)(["xl","xxl"])]:{width:"240px"},width:"100%"},"","");return j?Object(i.jsx)("div",{"data-test-subj":"dataVisualizerActionsPanel",css:v},Object(i.jsx)(l.EuiTitle,{size:"s"},Object(i.jsx)("h2",null,Object(i.jsx)(R.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),Object(i.jsx)(l.EuiSpacer,{size:"m"}),c&&Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(P,{href:c,icon:"discoverApp",description:N.i18n.translate("xpack.dataVisualizer.index.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:Object(i.jsx)(R.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"dataVisualizerViewInDiscoverCard"}),Object(i.jsx)(l.EuiSpacer,{size:"m"})),Array.isArray(p)&&p.map((e=>Object(i.jsx)(n.Fragment,{key:`dv-action-card-${e.title}`},Object(i.jsx)(P,{href:e.href,icon:e.icon,description:e.description,title:e.title,"data-test-subj":e["data-test-subj"],key:e.href}),Object(i.jsx)(l.EuiSpacer,{size:"m"}))))):null};var q=a(113);function G(e){const{services:{dataViewFieldEditor:t,application:a}}=Object(h.a)(),{useNewFieldsApi:s,currentDataView:r}=e,o=!!(null==t?void 0:t.userPermissions.editIndexPattern())&&s,[c,u]=Object(n.useState)(!1),d=Object(n.useRef)();return Object(n.useEffect)((()=>()=>{d.current&&d.current()}),[]),void 0!==t&&r&&o?Object(i.jsx)(l.EuiPopover,{panelPaddingSize:"s",isOpen:c,closePopover:()=>{u(!1)},ownFocus:!0,"data-test-subj":"dataVisualizerDataViewManagementPopover",button:Object(i.jsx)(l.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"dataVisualizerDataViewManagementButton","aria-label":N.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{u(!c)}})},Object(i.jsx)(l.EuiContextMenuPanel,{"data-test-subj":"dataVisualizerDataViewManagementMenu",size:"s",items:[Object(i.jsx)(l.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"dataVisualizerAddDataViewFieldAction",onClick:()=>{u(!1),(async()=>{d.current=await t.openEditor({ctx:{dataView:r},onSave:()=>{const e={lastRefresh:Date.now()};q.a.next(e)}})})()}},N.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.addFieldButton",{defaultMessage:"Add field to data view"})),Object(i.jsx)(l.EuiContextMenuItem,{key:"manage",icon:"indexSettings","data-test-subj":"dataVisualizerManageDataViewAction",onClick:()=>{var t;u(!1),a.navigateToApp("management",{path:`/kibana/dataViews/dataView/${null===(t=e.currentDataView)||void 0===t?void 0:t.id}`})}},N.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.manageFieldButton",{defaultMessage:"Manage data view fields"}))]})):null}var Q=a(180),U=a(104);const $={match_all:{}},H=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],searchString:"",searchQuery:$,searchQueryLanguage:g.a.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,probability:null,rndSamplerPref:U.b.ON_AUTOMATIC,...e}),W=e=>{var t,a,g,w;const N=Object(j.a)(),[A,M]=Object(m.b)(v.c,U.b.ON_AUTOMATIC),[_,T]=Object(m.b)(v.d,U.a),[V,C]=Object(m.b)(v.b,d.a.EXCLUDE),I=Object(n.useMemo)((()=>H({rndSamplerPref:A,probability:_})),[]),{services:R}=Object(h.a)(),{uiSettings:k,data:L}=R,[D,P]=Object(u.e)(y.a,I),[q,$]=Object(u.f)("_g"),[W,X]=Object(n.useState)(e.currentSavedSearch),{currentDataView:Y,currentSessionId:J,getAdditionalLinks:K}=e,Z=Y.fields,ee=Object(n.useMemo)((()=>{const e=[];return Z.forEach((t=>{if(!F.h.includes(t.name)&&!0!==t.scripted){const a=Object(f.a)(t);void 0===a||e.includes(a)||e.push(a)}})),e.sort()}),[Z]),te=Object(n.useCallback)((e=>{null!==W&&X(null),P({...D,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[W,D,P]),ae=null!==(t=D.visibleFieldTypes)&&void 0!==t?t:I.visibleFieldTypes,ie=null!==(a=D.visibleFieldNames)&&void 0!==a?a:I.visibleFieldNames,ne=null!==(g=D.showEmptyFields)&&void 0!==g?g:I.showEmptyFields,se=Object(n.useMemo)((()=>({dataView:Y,savedSearch:W,sessionId:J,visibleFieldNames:ie,allowEditDataView:!0,id:y.b})),[Y.id,null==W?void 0:W.id,ie,J]),{configs:re,searchQueryLanguage:le,searchString:oe,overallStats:ce,searchQuery:ue,documentCountStats:de,metricsStats:pe,timefilter:be,setLastRefresh:me,progress:ge,extendedColumns:fe,overallStatsProgress:je}=Object(Q.a)(se,D,A,$);Object(n.useEffect)((()=>{var e,t;switch(A){case U.b.OFF:return void ve(1);case U.b.ON_MANUAL:return void ve(null!==(e=null!==(t=null==D?void 0:D.probability)&&void 0!==t?t:null==de?void 0:de.probability)&&void 0!==e?e:null);case U.b.ON_AUTOMATIC:default:return void ve(null)}}),[D.probability,null==de?void 0:de.probability,A]);const ve=Object(n.useCallback)((e=>{A===U.b.ON_MANUAL&&null!==e&&T(e),P({...D,probability:e})}),[D,T,A,P]),xe=Object(n.useCallback)((e=>{e===U.b.ON_MANUAL&&ve(_&&_>0&&_<=.5?_:U.a),M(e)}),[_,ve,M]);Object(n.useEffect)((function(){return()=>{L.query.filterManager.getFilters().filter((e=>{var t;return(null===(t=e.$state)||void 0===t?void 0:t.store)===o.FilterStateStore.APP_STATE})).forEach((e=>L.query.filterManager.removeFilter(e)))}}),[L.query.filterManager]),Object(n.useEffect)((()=>{me(Date.now())}),[Y.id,me]),Object(n.useEffect)((()=>{void 0!==(null==q?void 0:q.time)&&be.setTime({from:q.time.from,to:q.time.to})}),[JSON.stringify(null==q?void 0:q.time),be]),Object(n.useEffect)((()=>{void 0!==(null==q?void 0:q.refreshInterval)&&be.setRefreshInterval(q.refreshInterval)}),[JSON.stringify(null==q?void 0:q.refreshInterval),be]);const Oe=Object(n.useCallback)(((e,t,a)=>{var i;const n=Object(c.generateFilters)(L.query.filterManager,e,t,a,Y);n&&L.query.filterManager.addFilters(n);const s={query:oe||"",language:le},l=Object(o.buildEsQuery)(Y,{query:oe||"",language:le},null!==(i=L.query.filterManager.getFilters())&&void 0!==i?i:[],k?Object(r.getEsQueryConfig)(k):void 0);te({searchQuery:l,searchString:s.query,queryLanguage:s.language,filters:L.query.filterManager.getFilters()})}),[Y,L.query.filterManager,le,oe,te,k]),ye=Object(n.useMemo)((()=>{let e=0,t=0;return Object.keys(ce).forEach((e=>{const a=ce[e];Array.isArray(a)&&a.length>0&&(t+=a.length)})),e=!0===ne?t:ce.aggregatableExistsFields.length+ce.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[ce,ne]),he=Object(n.useCallback)((function(e,t){return e.reduce(((e,a)=>{const n=t.find((e=>e.fieldName===a));return void 0!==n&&(e[a]=Object(i.jsx)(O.a,{item:n,dataView:Y,combinedQuery:{searchQueryLanguage:le,searchString:oe},onAddFilter:Oe,totalDocuments:ce.totalCount})),e}),{})}),[Y,le,oe,Oe,ce.totalCount]),Ee=Object(n.useRef)();Object(n.useEffect)((()=>{const e=Ee;return()=>{e.current&&e.current()}}),[]),Object(n.useEffect)((()=>{null==L||L.query.queryString.setQuery({query:oe,language:le})}),[L,le,oe]);const Se=Object(n.useMemo)((()=>void 0!==Y.timeFieldName&&""!==Y.timeFieldName),[Y.timeFieldName]),Fe=Object(l.useIsWithinMaxBreakpoint)("l"),we=Object(i.css)({[Object(l.useEuiBreakpoint)(["xs","s","m","l"])]:{flexDirection:"column",alignItems:"flex-start"}},"","");return Object(i.jsx)(l.EuiPageTemplate,{offset:0,restrictWidth:!1,bottomBorder:!1,grow:!1,"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none"},Object(i.jsx)(l.EuiPageTemplate.Section,null,Object(i.jsx)(l.EuiPageTemplate.Header,{"data-test-subj":"dataVisualizerPageHeader",css:we},Object(i.jsx)(l.EuiFlexGroup,{"data-test-subj":"dataViewTitleHeader",direction:"row",alignItems:"center",css:Object(i.css)({padding:`${N.euiSizeS} 0`,marginRight:`${N.euiSize}`},"","")},Object(i.jsx)(l.EuiTitle,{size:"s"},Object(i.jsx)("h2",null,Y.getName())),Object(i.jsx)(G,{currentDataView:Y,useNewFieldsApi:!0})),Fe?Object(i.jsx)(l.EuiSpacer,{size:"m"}):null,Object(i.jsx)(l.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},Se?Object(i.jsx)(l.EuiFlexItem,{grow:!1},Object(i.jsx)(p.a,{frozenDataPreference:V,setFrozenDataPreference:C,dataView:Y,query:void 0,disabled:!1,timefilter:be})):null,Object(i.jsx)(l.EuiFlexItem,{grow:!1},Object(i.jsx)(b.a,{isAutoRefreshOnly:!Se,showRefresh:!Se,width:"full"})))),Object(i.jsx)(l.EuiSpacer,{size:"m"}),Object(i.jsx)(l.EuiFlexGroup,{gutterSize:"m",direction:Fe?"column":"row"},Object(i.jsx)(l.EuiFlexItem,null,Object(i.jsx)(l.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(i.jsx)(z,{dataView:Y,searchString:oe,searchQuery:ue,searchQueryLanguage:le,setSearchParams:te,overallStats:ce,indexedFieldTypes:ee,setVisibleFieldTypes:e=>{P({...D,visibleFieldTypes:e})},visibleFieldTypes:ae,visibleFieldNames:ie,setVisibleFieldNames:e=>{P({...D,visibleFieldNames:e})},showEmptyFields:ne,onAddFilter:Oe}),void 0!==(null==ce?void 0:ce.totalCount)&&Object(i.jsx)(s.a.Fragment,null,Object(i.jsx)(l.EuiSpacer,{size:"m"}),Object(i.jsx)(l.EuiFlexGroup,{gutterSize:"s",direction:"column"},Object(i.jsx)(S.a,{documentCountStats:de,totalCount:ce.totalCount,setSamplingProbability:ve,samplingProbability:null===D.probability?null==de?void 0:de.probability:D.probability,loading:je.loaded<100,randomSamplerPreference:A,setRandomSamplerPreference:xe}))),Object(i.jsx)(l.EuiSpacer,{size:"m"}),Object(i.jsx)(E.a,{showEmptyFields:ne,toggleShowEmptyFields:()=>{P({...D,showEmptyFields:!D.showEmptyFields})},fieldsCountStats:ye,metricsStats:pe}),Object(i.jsx)(l.EuiSpacer,{size:"m"}),Object(i.jsx)(l.EuiProgress,{value:ge,max:100,size:"xs"}),Object(i.jsx)(x.a,{items:re,pageState:D,updatePageState:P,getItemIdToExpandedRowMap:he,extendedColumns:fe,loading:ge<100,overallStatsRunning:je.isRunning,showPreviewByDefault:null===(w=D.showDistributions)||void 0===w||w,onChange:P,totalCount:ce.totalCount}))),Fe?Object(i.jsx)(l.EuiSpacer,{size:"m"}):null,Object(i.jsx)(l.EuiFlexItem,{grow:!1},Object(i.jsx)(B,{dataView:Y,searchQueryLanguage:le,searchString:oe,getAdditionalLinks:K})))))}},157:function(e,t,a){var i=a(221),n=a(222),s=a(223),r=a(224),l=a(225),o=a(226),c=a(227);c.alea=i,c.xor128=n,c.xorwow=s,c.xorshift7=r,c.xor4096=l,c.tychei=o,e.exports=c},180:function(e,t,a){"use strict";a.d(t,"a",(function(){return re}));var i=a(0),n=a(8),s=a(4),r=a(27),l=a(11),o=a(157),c=a.n(o),u=a(159),d=a(113),p=a(69),b=a.n(p),m=a(28);a(1);a(131),a(132);var g=a(303),f=a(112),j=a(65),v=a(188),x=a(6),O=a(129),y=a(51),h=a(57);const E=s.i18n.translate("xpack.dataVisualizer.index.lensChart.topValuesLabel",{defaultMessage:"Top values"}),S=s.i18n.translate("xpack.dataVisualizer.index.lensChart.countLabel",{defaultMessage:"Count"});function F(e,t,a,i){var n,r,l,o,c,u,p;const{lens:b,maps:m,data:g}=t,f=[],j=null!==(n=null==g?void 0:g.query.filterManager.getFilters())&&void 0!==n?n:[],v=()=>{const e={lastRefresh:Date.now()};d.a.next(e)};if(!0===(null===(r=t.application)||void 0===r||null===(l=r.capabilities)||void 0===l||null===(o=l.visualize)||void 0===o?void 0:o.show)&&void 0!==b){const t=null==b?void 0:b.canUseEditor();f.push({name:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:e=>void 0!==function(e){let t;switch(e){case x.i.KEYWORD:case x.i.VERSION:t="string";break;case x.i.DATE:t="date";break;case x.i.NUMBER:t="number";break;case x.i.IP:t="ip";break;case x.i.BOOLEAN:t="string";break;default:t=void 0}return t}(e.type)&&t,onClick:t=>{const i=function(e,t,a,i){if(void 0===e||void 0===i.type||void 0===i.fieldName)return;const n=function(e,t,a){if(void 0!==t.fieldName)return e===x.i.DATE?function(e){return{columns:{col2:{dataType:"number",isBucketed:!1,label:S,operationType:"count",scale:"ratio",sourceField:h.DOCUMENT_FIELD_NAME},col1:{dataType:"date",isBucketed:!0,label:e.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:e.fieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t):e===x.i.NUMBER?function(e,t){var a;if(void 0===t.timeFieldName)return{columns:{col1:{label:e.fieldName,dataType:"number",isBucketed:!0,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:e.fieldName},col2:{label:S,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}};const i=null!==(a=e.supportedAggs)&&void 0!==a&&a.has("avg")?"average":"max";return{columns:{col2:{dataType:"number",isBucketed:!1,label:"average"===i?s.i18n.translate("xpack.dataVisualizer.index.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:e.fieldName}}):s.i18n.translate("xpack.dataVisualizer.index.lensChart.maximumOfLabel",{defaultMessage:"Maximum of {fieldName}",values:{fieldName:e.fieldName}}),operationType:i,sourceField:e.fieldName},col1:{dataType:"date",isBucketed:!0,label:t.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:t.timeFieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t,a):e===x.i.IP||e===x.i.KEYWORD||e===x.i.VERSION?function(e){return{columns:{col1:{label:E,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:S,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):e===x.i.BOOLEAN?function(e){return{columns:{col1:{label:E,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:S,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):void 0}(i.type,i,e);return n?{visualizationType:"lnsXY",title:s.i18n.translate("xpack.dataVisualizer.index.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:i.fieldName}}),references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{formBased:{layers:{layer1:{columnOrder:["col1","col2"],columns:n.columns}}}},filters:a,query:{language:t.searchQueryLanguage,query:t.searchString},visualization:{axisTitlesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},fittingFunction:"None",gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},layers:[n.layer],legend:{isVisible:!0,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},valueLabels:"hide"}}}:void 0}(e,a,j,t);i&&b.navigateToPrefilledEditor({id:`dataVisualizer-${t.fieldName}`,attributes:i})},"data-test-subj":"dataVisualizerActionViewInLensButton"})}var O;return null!=t&&t.uiActions&&m&&!0===(null===(c=t.application)||void 0===c||null===(u=c.capabilities)||void 0===u||null===(p=u.maps)||void 0===p?void 0:p.show)&&f.push({name:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsTitle",{defaultMessage:"Explore in Maps"}),description:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsDescription",{defaultMessage:"Explore in Maps"}),type:"icon",icon:"gisApp",available:e=>e.type===x.i.GEO_POINT||e.type===x.i.GEO_SHAPE,onClick:async a=>{if(null!=t&&t.uiActions&&e){const i={dataViewSpec:e.toSpec(),fieldName:a.fieldName,contextualFields:[],originatingApp:x.a},n=await(null==t?void 0:t.uiActions.getTriggerCompatibleActions(y.VISUALIZE_GEO_FIELD_TRIGGER,i));n.length>0&&void 0!==n[0]&&(null==t||t.uiActions.getTrigger(y.VISUALIZE_GEO_FIELD_TRIGGER).exec(i))}},"data-test-subj":"dataVisualizerActionViewInMapsButton"}),void 0!==i&&null!==(O=t.dataViewFieldEditor)&&void 0!==O&&O.userPermissions.editIndexPattern()&&(f.push({name:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldTitle",{defaultMessage:"Edit data view field"}),description:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldDescription",{defaultMessage:"Edit data view field"}),type:"icon",icon:"indexEdit",onClick:async a=>{var n;i.current=await(null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openEditor({ctx:{dataView:e},fieldName:a.fieldName,onSave:v}))},"data-test-subj":"dataVisualizerActionEditIndexPatternFieldButton"}),f.push({name:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteDataViewFieldTitle",{defaultMessage:"Delete data view field"}),description:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteIndexPatternFieldDescription",{defaultMessage:"Delete data view field"}),type:"icon",icon:"trash",available:e=>!0===e.deletable,onClick:a=>{var n;i.current=null===(n=t.dataViewFieldEditor)||void 0===n?void 0:n.openDeleteModal({ctx:{dataView:e},fieldName:a.fieldName,onDelete:v})},"data-test-subj":"dataVisualizerActionDeleteIndexPatternFieldButton"})),f}var w=a(5),N=a(10);function A(e,t){return e.match(/^[a-zA-Z0-9-_.]+$/)?e:`field_${t}`}var M=a(97),_=a(105),T=a(88),V=a(24),C=a(305);const z=e=>Object(V.a)(e,["rawResponse"]);function I(e){return"random_sampling"===e.mode}function R(e){return"normal_sampling"===e.mode}function k(e,t){if(!t)return e;const{seed:a}=t;return R(t)?{sample:{sampler:{shard_size:t.shardSize},aggs:e}}:I(t)?{sample:{random_sampler:{probability:t.probability,...a?{seed:a}:{}},aggs:e}}:{sample:{aggs:e,random_sampler:{probability:1,...a?{seed:a}:{}}}}}const L=(e,t)=>{const a=Object(V.a)(e,["buckets"])?e.buckets:[],i=Object(V.a)(e,["sum_other_doc_count"])?e.sum_other_doc_count:0,n=((null==a?void 0:a.reduce(((e,t)=>t.doc_count+e),0))||0)+i,s=a.map((e=>({...e,doc_count:t?Math.floor(e.doc_count*(t/n)):e.doc_count,percent:e.doc_count/n})));return{topValuesSampleSize:n,topValues:s}};var D=a(220);function P(e){return Object(V.a)(e,["coordinates"])&&Array.isArray(e.coordinates)}function B(e){return Object(V.a)(e,["lon","lat"])}var q=a(133);const G=(e,t,a)=>{const i=Object(w.get)(t,[...a,`${e}_field_stats`,"actual_stats"],void 0);if(i)return{min:Object(w.get)(i,"min"),max:Object(w.get)(i,"max"),avg:Object(w.get)(i,"avg")};const n=Object(w.get)(t,[...a,`${e}_min_max`],{});return n?{min:Object(w.get)(n,["min","value"]),max:Object(w.get)(n,["max","value"])}:{}},Q=(e,t,a,i)=>{switch(a[0].type){case x.i.NUMBER:return((e,t,a,i)=>{const s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e;let s=0;const r=Array.from(Array(T.b/T.c),(()=>s+=T.c)),l={};return t.forEach(((e,t)=>{const{safeFieldName:a,supportedAggs:i}=e,n=!Object(D.a)(i);if((n||i.has("stats"))&&(l[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}),(n||i.has("min")&&i.has("max"))&&(l[`${a}_min_max`]={filter:{exists:{field:e.fieldName}},aggs:{min:{min:{field:e.fieldName}},max:{max:{field:e.fieldName}}}}),(n||i.has("percentiles"))&&(l[`${a}_percentiles`]={percentiles:{field:e.fieldName,percents:r,keyed:!1}}),n||i.has("terms")){const t={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};l[`${a}_top`]=t}})),{index:a,size:0,body:{query:i,aggs:k(l,e.samplingOption),...Object(V.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(n.catchError)((e=>Object(n.of)({fields:a,error:Object(C.b)(e)}))),Object(n.map)((e=>{if(!z(e))return e;const i=e.rawResponse.aggregations,n=["sample"],s=[];return a.forEach(((e,a)=>{const r=e.safeFieldName,l=Object(w.get)(i,[...n,`${r}_field_stats`,"doc_count"],0),o=[...n,`${r}_top`],c=Object(w.get)(i,[...o],{}),{topValuesSampleSize:u,topValues:d}=L(c),p={fieldName:e.fieldName,...G(r,i,n),isTopValuesSampled:R(t.samplingOption)||Object(D.a)(t.samplingProbability)&&t.samplingProbability<1,topValues:d,topValuesSampleSize:u,topValuesSamplerShardSize:Object(w.get)(i,["sample","doc_count"])};if(l>0){const e=Object(w.get)(i,[...n,`${r}_percentiles`,"values"],[]);if(e&&Object(D.a)(p.min)){const t=Object(w.find)(e,{key:50});p.median=void 0!==t?t.value:0,p.distribution=Object(q.a)(e,T.c,p.min)}}s.push(p)})),s})))})(e,t,a,i);case x.i.KEYWORD:case x.i.IP:case x.i.VERSION:return((e,t,a,i)=>{const s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName,i={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};s[`${a}_top`]=i})),{index:a,size:0,body:{query:i,aggs:k(s,e.samplingOption),...Object(V.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(n.catchError)((e=>Object(n.of)({fields:a,error:Object(C.b)(e)}))),Object(n.map)((e=>{if(!z(e))return e;const t=e.rawResponse.aggregations,i=["sample"],n=[];return a.forEach(((e,a)=>{const s=e.safeFieldName,r=[...i,`${s}_top`],l=Object(w.get)(t,[...r],{}),{topValuesSampleSize:o,topValues:c}=L(l,Object(w.get)(t,["sample","probability"])<1?Object(w.get)(t,["sample","doc_count"]):void 0),u={fieldName:e.fieldName,isTopValuesSampled:!0,topValues:c,topValuesSampleSize:o,topValuesSamplerShardSize:Object(w.get)(t,["sample","doc_count"])};n.push(u)})),n})))})(e,t,a,i);case x.i.DATE:return((e,t,a,i)=>{const s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName;s[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}})),{index:a,size:0,body:{query:i,aggs:k(s,e.samplingOption),...Object(V.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(n.catchError)((e=>Object(n.of)({fields:a,error:Object(C.b)(e)}))),Object(n.map)((e=>{if(!z(e))return e;const t=e.rawResponse.aggregations,i=["sample"];return a.map(((e,a)=>{const n=e.safeFieldName,s=Object(w.get)(t,[...i,`${n}_field_stats`,"actual_stats"],{});return{fieldName:e.fieldName,earliest:Object(w.get)(s,"min",0),latest:Object(w.get)(s,"max",0)}}))})))})(e,t,a,i);case x.i.BOOLEAN:return((e,t,a,i)=>{const s=((e,t)=>{const{index:a,query:i,runtimeFieldMap:n}=e,s={};return t.forEach(((e,t)=>{const a=e.safeFieldName;s[`${a}_value_count`]={filter:{exists:{field:e.fieldName}}},s[`${a}_values`]={terms:{field:e.fieldName,size:2}}})),{index:a,size:0,body:{query:i,aggs:k(s,e.samplingOption),...Object(V.a)(n)?{runtime_mappings:n}:{}}}})(t,a);return e.search({params:s},i).pipe(Object(n.catchError)((e=>Object(n.of)({fields:a,error:Object(C.b)(e)}))),Object(n.map)((e=>{if(!z(e))return e;const t=e.rawResponse.aggregations,i=["sample"],n=Object(w.get)(t,[...i,"doc_count"],0);return a.map(((e,a)=>{const s=e.fieldName,r=Object(w.get)(t,[...i,`${s}_value_count`,"doc_count"],0),l=Object(w.get)(t,[...i,`${s}_values`],{}),{topValuesSampleSize:o,topValues:c}=L(l),u=r>n?Object(w.get)(t,[...i,"probability"],1):1,d={fieldName:e.fieldName,count:r*u,trueCount:0,falseCount:0,topValues:c,topValuesSampleSize:o};return Object(w.get)(t,[...i,`${s}_values`,"buckets"],[]).forEach((e=>{d[`${e.key_as_string}Count`]=e.doc_count})),d}))})))})(e,t,a,i);case x.i.TEXT:default:return((e,t,a,i)=>{const{maxExamples:s}=t;return Object(n.combineLatest)(a.map((r=>{const l=((e,t)=>{const{index:a,timeFieldName:i,earliestMs:n,latestMs:s,query:r,runtimeFieldMap:l,maxExamples:o}=e,c=Math.max(100,null!=o?o:T.a),u=Object(M.a)(i,n,s,r);return Array.isArray(u)&&u.push({exists:{field:t.fieldName}}),{index:a,size:c,body:{fields:[t.fieldName],_source:!1,query:{bool:{filter:u}},...Object(V.a)(l)?{runtime_mappings:l}:{}}}})(t,r);return e.search({params:l},i).pipe(Object(n.catchError)((e=>Object(n.of)({fieldName:r.fieldName,fields:a,error:Object(C.b)(e)}))),Object(n.map)((e=>{if(!z(e))return e;const t=e.rawResponse,a={fieldName:r.fieldName,examples:[]};if(t.hits.total>0){const e=t.hits.hits.map((e=>{const t=Object(w.get)(e.fields,r.fieldName);return Array.isArray(t)&&t.length>0?t[0]:t}));a.examples=function(e,t=10){const a=[];if(!Object(D.a)(e))return a;for(let i=0;i<e.length;i++){const n=e[i];if("string"==typeof n&&-1===a.indexOf(n)?a.push(n):(P(n)&&-1===a.findIndex((e=>P(e)&&e.type===n.type&&n.coordinates.every(((t,a)=>t===e.coordinates[a]))))&&a.push(n),B(n)&&-1===a.findIndex((e=>B(e)&&n.lon===e.lon&&n.lat===e.lat))&&a.push(n)),a.length===t)return a}return a}(e,s)}return a})))})))})(e,t,a,i)}};var U=a(72);a(58),a(23);let $=function(e){return e.HISTOGRAM="histogram",e.COUNTER="counter",e.GAUGE="gauge",e.SUMMARY="summary",e}({});a(41),new Set([l.a.UNSIGNED_LONG,l.a.LONG,l.a.INTEGER,l.a.SHORT,l.a.BYTE]),new Set([l.a.DOUBLE,l.a.FLOAT,l.a.HALF_FLOAT,l.a.SCALED_FLOAT]);const H=(e,t,a,i,n,s,r,l,o)=>{const c=e,u=Object(M.a)(n,s,r,t),d=(e=>{return void 0!==(null==(t=e)?void 0:t.aggregations)?t.aggregations:void 0!==(null==t?void 0:t.aggs)?t.aggs:void 0;var t})(l),p=void 0!==d?{...d}:{},b={...Object(V.a)(o)?o:{},...Object(V.a)(l)&&Object(V.a)(l.runtime_mappings)?l.runtime_mappings:{}};return a.forEach((({name:e,supportedAggs:t},a)=>{const i=A(e,a);if(t.has("count")&&(p[`${i}_count`]={filter:{exists:{field:e}}}),t.has("cardinality")){var n;let t;t=null!=l&&null!==(n=l.script_fields)&&void 0!==n&&n.hasOwnProperty(e)?p[`${i}_cardinality`]={cardinality:{script:null==l?void 0:l.script_fields[e].script}}:{cardinality:{field:e}},p[`${i}_cardinality`]=t}})),{index:c,track_total_hits:!1,size:0,body:{query:{bool:{filter:u}},...Object(V.a)(p)?{aggs:k(p,i)}:{},...Object(V.a)(b)?{runtime_mappings:b}:{}}}},W=(e,t,a,i,n,s,r)=>{const l=e,o=Object(M.a)(i,n,s,t);return Array.isArray(o)&&o.push({exists:{field:a}}),{index:l,size:0,body:{query:{bool:{filter:o}},...Object(V.a)(r)?{runtime_mappings:r}:{}},track_total_hits:1}},X=(e,t,a,i,n,s,r)=>{const l=t,o=Object(M.a)(i,n,s,a);return{index:l,body:{fields:e.map((e=>e)),_source:!1,query:{bool:{filter:o}},...Object(V.a)(r)?{runtime_mappings:r}:{},size:1e3}}};var Y=a(104);const J=(e,t,a=!1)=>{if(!e)return;let i=0;if(void 0===t.intervalMs||void 0===t.earliest||void 0===t.latest)return{totalCount:i};const n={},s=Object(w.get)(e,a?["aggregations","sampler","eventRate","buckets"]:["aggregations","eventRate","buckets"],[]);return Object(w.each)(s,(e=>{const t=e.key;n[t]=e.doc_count,i+=e.doc_count})),{interval:t.intervalMs,buckets:n,timeRangeEarliest:"number"==typeof t.earliest?t.earliest:void 0,timeRangeLatest:"number"==typeof t.latest?t.latest:void 0,totalCount:i}};var K=a(158);function Z(e=!1,t,a,s){const{services:{data:r,notifications:{toasts:l}}}=Object(j.a)(),[o,u]=Object(i.useState)(Object(U.d)().overallStats),[d,p]=Object(i.useState)(),[b,m]=Object(i.useReducer)(Object(_.b)(),Object(_.a)()),g=Object(i.useRef)(new AbortController),f=Object(i.useRef)(new AbortController),v=Object(i.useRef)();Object(i.useEffect)((function(){let e=!1;if(!t||null===d)return;const{index:a,searchQuery:i,timeFieldName:s,earliest:l,latest:o}=t;return(async()=>{if(f.current.abort(),f.current=new AbortController,void 0!==s&&(void 0===l||void 0===o))return;const t=Object(M.a)(s,l,o,i),c=await(async(e,t,a=null,i=6e3)=>await Object(n.lastValueFrom)(Object(n.from)(e).pipe(Object(n.timeout)(i),Object(n.catchError)((e=>(console.error("Error occured in fetchDataWithTimeout",e),t.abort(),Object(n.of)(a)))))))(r.dataViews.getFieldsForWildcard({pattern:a,indexFilter:{bool:{filter:t}},includeEmptyFields:!1}),f.current);e||(Array.isArray(c)?p(new Set([...c.map((e=>e.name))])):p(null))})(),()=>{e=!0}}),[null==t?void 0:t.timeFieldName,null==t?void 0:t.earliest,null==t?void 0:t.latest,JSON.stringify({query:null==t?void 0:t.searchQuery}),null==t?void 0:t.index]);const x=Object(i.useCallback)((async()=>{try{var e;if(null===(e=v.current)||void 0===e||e.unsubscribe(),g.current.abort(),g.current=new AbortController,!t||0===a||void 0===d)return;const o=((e,t)=>{if(!e)return;const a=t?Object.keys(t):void 0;return a&&(null==a?void 0:a.length)>0?new Set([...Array.from(e),...a]):e})(d,t.runtimeFieldMap);m({...Object(_.a)(),isRunning:!0,error:void 0});const{aggregatableFields:p,nonAggregatableFields:b,index:f,searchQuery:j,timeFieldName:x,earliest:O,latest:y,runtimeFieldMap:h,samplingOption:E,sessionId:S,embeddableExecutionContext:F}=t,N={abortSignal:g.current.signal,sessionId:S,...F?{executionContext:F}:{}},T=Object(D.a)(o),z=T?p.filter((e=>o.has(e.name))):p,R=T?b.filter((e=>o.has(e))):b,k=await(async(e,t,a,i,n,s)=>{var r,l;const o=null!=i?i:Math.abs(c()().int32()).toString(),{index:u,timeFieldName:d,earliest:p,latest:b,runtimeFieldMap:m,searchQuery:g,intervalMs:f}=t,j={randomlySampled:!1,took:0,totalCount:0,probability:1},v={bool:{filter:Object(M.a)(d,p,b,g)}},x={eventRate:{date_histogram:{field:d,fixed_interval:`${f}ms`,min_doc_count:0,extended_bounds:{min:p,max:b}}}},O=null!=n?n:1e-6,y=e=>({sampler:{aggs:x,random_sampler:{probability:e,seed:o}}}),h=void 0!==d&&""!==d&&void 0!==f&&f>0,E=(e,t=!1)=>({index:u,body:{query:v,...h?{aggs:e}:{},...Object(V.a)(m)?{runtime_mappings:m}:{}},track_total_hits:t,size:0}),S=await e.search({params:E(y(O),!h)},a).toPromise();if(void 0===S)throw Error(`An error occurred with the following query ${JSON.stringify(E(y(O)))}`);if(!h){var F;const e="number"==typeof S.rawResponse.hits.total?S.rawResponse.hits.total:null===(F=S.rawResponse.hits.total)||void 0===F?void 0:F.value;return{...j,randomlySampled:!1,took:S.rawResponse.took,totalCount:null!=e?e:0}}var N;if(Object(D.a)(n))return{...j,randomlySampled:1!==n,took:null===(N=S.rawResponse)||void 0===N?void 0:N.took,probability:n,...J(S.rawResponse,t,!0)};const A=null===(r=S.rawResponse.aggregations)||void 0===r||null===(l=r.sampler)||void 0===l?void 0:l.doc_count,_=1e5;if(void 0!==S&&A<_){const i=O*_/(A-2*Math.sqrt(A));if(i===1/0||A<=4){var T,C;const i=await e.search({params:E(y(1))},a).toPromise();return{...j,randomlySampled:!1,took:S.rawResponse.took+(null!==(T=null==i||null===(C=i.rawResponse)||void 0===C?void 0:C.took)&&void 0!==T?T:0),...J(null==i?void 0:i.rawResponse,t,!0),probability:1}}{const n=Y.c[Object(w.sortedIndex)(Y.c,i)],s=await e.search({params:E(y(n))},a).toPromise();if(s)return{...j,randomlySampled:!0,took:S.rawResponse.took+s.rawResponse.took,...J(s.rawResponse,t,!0),probability:n}}}return j})(r.search,t,N,E.seed,s),L=r.search.search({params:X(R,f,j,x,O,y,h)},N).pipe(Object(n.map)((e=>e))),P=R.map((e=>r.search.search({params:W(f,j,e,x,O,y,h)},N).pipe(Object(n.map)((t=>({...t,rawResponse:{...t.rawResponse,fieldName:e}})))))),B=Object(w.chunk)(z,30);var i;I(E)&&(E.probability=null!==(i=k.probability)&&void 0!==i?i:1);const q=function(e,t=U.c){return Object(n.from)(e).pipe(Object(n.mergeMap)(((e,t)=>e.pipe(Object(n.last)(),Object(n.map)((e=>({index:t,value:e}))))),t),Object(n.toArray)(),Object(n.map)((e=>e.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))))}([L,...B.map((e=>r.search.search({params:H(f,j,e,E,x,O,y,void 0,h)},N).pipe(Object(n.map)((t=>({...t,aggregatableFields:e})))))),...P],U.c);v.current=q.subscribe({next:e=>{var t;const a=[],i=[];let n;e.forEach(((e,t)=>{if(0===t&&(s=e,Object(V.a)(s,["rawResponse"])&&s.rawResponse.hasOwnProperty("hits"))){const t=e.rawResponse.hits.hits.map((e=>e.fields?((e,t)=>{const a={...e};for(const e of Object.keys(a))void 0===t?Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]):!1===t(e)&&Array.isArray(a[e])&&1===a[e].length&&(a[e]=a[e][0]);return a})(e.fields):{}));n=t}var s;(function(e){return Object(V.a)(e,["aggregatableFields"])})(e)&&a.push(e),function(e){return Object(V.a)(e,["rawResponse"])}(e)&&i.push(e)}));const s=null!==(t=null==k?void 0:k.totalCount)&&void 0!==t?t:0,r=((e,t,a,i)=>{const n={aggregatableExistsFields:[],aggregatableNotExistsFields:[]};return e&&0!==t.length?(a&&t.forEach((e=>{a.has(e.name)||n.aggregatableNotExistsFields.push({fieldName:e.name,existsInDocs:!1,stats:{}})})),e.forEach((({rawResponse:e,aggregatableFields:t})=>{const a=e.aggregations,i=["sample"],s=Object(w.get)(a,[...i,"doc_count"]);t.forEach((({name:e,supportedAggs:t},r)=>{const l=A(e,r),o=Object(w.get)(a,[...i,`${l}_count`,"doc_count"],0),c=o>s?Object(w.get)(a,[...i,"probability"],1):1;if(o>0){const t=Object(w.get)(a,[...i,`${l}_cardinality`,"value"]);n.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:s,count:o*c,cardinality:t}})}else{n.aggregatableNotExistsFields.push({fieldName:e,existsInDocs:!1,stats:{}})}}))})),n):n})(a,p,o),l=new Array(R.length).fill(0),c=R.map((()=>new Set));n&&n.forEach((e=>{R.forEach(((t,a)=>{e.hasOwnProperty(t)&&(l[a]+=1,c[a].add(e[t]))}))}));const d=((e,t,a,i,n)=>{const s={nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};return e&&0!==t.length?(t.forEach(((t,r)=>{var l,o,c;const u=n.indexOf(t);if(-1===u)return void s.nonAggregatableNotExistsFields.push({fieldName:t,existsInDocs:!1,stats:{}});const d=e.find((e=>e.rawResponse.fieldName===t)),p=void 0!==d&&d.rawResponse.hits.total>0,b={fieldName:t,existsInDocs:p,stats:{count:null!==(l=a[u])&&void 0!==l?l:0,cardinality:null!==(o=null===(c=i[u])||void 0===c?void 0:c.size)&&void 0!==o?o:0,sampleCount:1e3}};s.nonAggregatableExistsFields.push(b)})),s):s})(i,b,l,c,R);u({documentCountStats:k,...d,...r,totalCount:s})},error:e=>{"AbortError"!==e.name&&Object(K.a)(l,t.index,Object(C.b)(e)),m({isRunning:!1,error:e})},complete:()=>{m({loaded:100,isRunning:!1})}})}catch(e){"AbortError"!==e.name&&Object(K.a)(l,t.index,Object(C.b)(e))}}),[r,t,l,a,s,d]),O=Object(i.useCallback)((()=>{var e,t,a;null===(e=v.current)||void 0===e||e.unsubscribe(),v.current=void 0,null===(t=g.current)||void 0===t||t.abort(),null===(a=f.current)||void 0===a||a.abort()}),[]);return Object(i.useEffect)((()=>{x()}),[x]),Object(i.useEffect)((()=>O),[O]),Object(i.useMemo)((()=>({progress:b,overallStats:o})),[o,b])}const ee={COUNTER:new Set(["count","histogram","variable_width_histogram","rate","min","max","top_metrics","range"]),GAUGE:new Set(["count","max","top_metrics","missing","date_histogram","sum","rate","boxplot","value_count","avg","percentiles","cardinality","histogram","variable_width_histogram","frequent_item_sets","min","stats","diversified_sampler","percentile_ranks","median_absolute_deviation","multi_terms","auto_date_histogram","rare_terms","range","extended_stats","date_range","terms","significant_terms"]),AGGREGATABLE:new Set(["count","avg","cardinality","histogram","percentiles","stats","terms"]),DEFAULT:new Set},te=e=>(e=>(null==e?void 0:e.timeSeriesMetric)===$.COUNTER)(e)?ee.COUNTER:(e=>(null==e?void 0:e.timeSeriesMetric)===$.GAUGE)(e)?ee.GAUGE:e.aggregatable?ee.AGGREGATABLE:ee.DEFAULT;var ae=a(114);const ie=Object(U.d)();function ne(e){return!x.h.includes(e)}const se={mode:"random_sampling",seed:"",probability:0},re=(e,t,a,o)=>{var p,y,h;const E=Object(i.useRef)(window.performance.now()),{services:S}=Object(j.a)(),{uiSettings:V,data:C,security:z,executionContext:I,analytics:R}=S,k=b()(null==I?void 0:I.context$),L=Object(i.useMemo)((()=>{const t={type:"visualization",name:"field_statistics_table",id:e.id};return{...k||{},child:t}}),[k,e.id]);Object(m.useExecutionContext)(I,L);const{visibleFieldTypes:P,showEmptyFields:B}=t,[q,G]=Object(i.useState)(0),$=e.sessionId,H=Object(i.useMemo)((()=>{let e=Math.abs(c()().int32());return void 0!==z&&z.authc.getCurrentUser().then((t=>{const a=t.username;a&&(e=Math.abs(c()(a).int32()))})),e}),[z]),{currentSavedSearch:W,currentDataView:X,currentQuery:Y,currentFilters:J,samplingOption:K}=Object(i.useMemo)((()=>{var t;return{currentSavedSearch:null==e?void 0:e.savedSearch,currentDataView:e.dataView,currentQuery:null==e?void 0:e.query,currentFilters:null==e?void 0:e.filters,samplingOption:null!==(t=null==e?void 0:e.samplingOption)&&void 0!==t?t:se}}),[null==e?void 0:e.savedSearch,e.dataView,null==e?void 0:e.query,null==e?void 0:e.filters,null==e?void 0:e.samplingOption]),ee=Object(i.useMemo)((()=>X.fields),[X]),{visibleFieldNames:re,fieldsToFetch:le}=Object(i.useMemo)((()=>(({input:e,currentDataView:t,shouldGetSubfields:a=!1})=>{var i;const n=t.fields,s=a?[...new Set([...n.filter((t=>{var a,i;if(0===(null==e||null===(a=e.visibleFieldNames)||void 0===a?void 0:a.length))return!0;const n=null!==(i=null==e?void 0:e.visibleFieldNames)&&void 0!==i?i:[];if(n.includes(t.name))return!0;if(t.getSubtypeMulti){var s,r;const e=null===(s=t.getSubtypeMulti())||void 0===s||null===(r=s.multi)||void 0===r?void 0:r.parent;if(e&&n.indexOf(e)>-1)return!0}return!1})).map((e=>e.name)),...null!==(i=e.fieldsToFetch)&&void 0!==i?i:[],,])].filter(D.a):void 0;return{visibleFieldNames:a?s:e.visibleFieldNames,fieldsToFetch:Array.isArray(s)?[...s]:void 0}})({input:e,currentDataView:X,shouldGetSubfields:void 0!==e.shouldGetSubfields?e.shouldGetSubfields:e.id!==U.b})),[e.id,e.fieldsToFetch,e.visibleFieldNames,X]),{searchQueryLanguage:oe,searchString:ce,searchQuery:ue,queryOrAggregateQuery:de}=Object(i.useMemo)((()=>{const e=C.query.filterManager,a=Object(v.a)({dataView:X,uiSettings:V,savedSearch:W,query:Y,filters:J,filterManager:C.query.filterManager});if(void 0===a||""!==t.searchString){if(e){const a=null==e?void 0:e.getGlobalFilters();t.filters&&e.setFilters(t.filters),a&&(null==e||e.addFilters(a))}return{searchQuery:t.searchQuery,searchString:t.searchString,searchQueryLanguage:t.searchQueryLanguage}}return{queryOrAggregateQuery:a.queryOrAggregateQuery,searchQuery:a.searchQuery,searchString:a.searchString,searchQueryLanguage:a.queryLanguage}}),[null==W?void 0:W.id,X.id,t.searchString,t.searchQueryLanguage,JSON.stringify({searchQuery:t.searchQuery,currentQuery:Y,currentFilters:J}),q,C.query.filterManager]),pe=Object(g.a)(V),be=Object(u.c)({timeRangeSelector:void 0!==(null==X?void 0:X.timeFieldName),autoRefreshSelector:!0}),[me,ge]=Object(i.useState)(ie.metricConfigs),[fe,je]=Object(i.useState)(ie.metricsLoaded),[ve,xe]=Object(i.useState)(),[Oe,ye]=Object(i.useState)(ie.nonMetricConfigs),[he,Ee]=Object(i.useState)(ie.nonMetricsLoaded),Se=Object(i.useMemo)((()=>{var t;const a=pe,i=be;if(!a||!i||!X||0===q)return;const n=i.getActiveBounds();let s,o;var c,u;void 0!==n&&void 0!==X.timeFieldName&&(s=null===(c=n.min)||void 0===c?void 0:c.valueOf(),o=null===(u=n.max)||void 0===u?void 0:u.valueOf()),e.timeRange&&(s=e.timeRange.from,o=e.timeRange.to);const d=i.getActiveBounds(),p=null!==(t=V.get(r.UI_SETTINGS.HISTOGRAM_BAR_TARGET))&&void 0!==t?t:ae.a;a.setInterval("auto"),d&&(a.setBounds(d),a.setBarTarget(p));const b=a.getInterval(),m=[],g=[],f=X.fields;return null==f||f.forEach((e=>{if(le&&!le.includes(e.name))return;const t=void 0!==e.displayName?e.displayName:e.name;var a;x.h.includes(t)||(!0!==e.aggregatable||x.f.has(e.type)||null!==(a=e.esTypes)&&void 0!==a&&a.some((e=>e===l.a.AGGREGATE_METRIC_DOUBLE))?g.push(e.name):m.push({name:e.name,supportedAggs:te(e)}))})),{earliest:s,latest:o,aggInterval:b,intervalMs:null==b?void 0:b.asMilliseconds(),searchQuery:ue,sessionId:$,index:X.title,timeFieldName:X.timeFieldName,runtimeFieldMap:X.getRuntimeMappings(),aggregatableFields:m,nonAggregatableFields:g,browserSessionSeed:H,samplingOption:{...K,seed:H.toString()},embeddableExecutionContext:L}}),[X.id,q,JSON.stringify({searchQuery:ue,samplingOption:K,fieldsToFetch:le}),$,H,null===(p=e.timeRange)||void 0===p?void 0:p.from,null===(y=e.timeRange)||void 0===y?void 0:y.to]),{overallStats:Fe,progress:we}=Z(!1,Se,q,t.probability),Ne=Object(i.useMemo)((()=>{if(!(we.loaded<100))return{metricConfigs:me.map((e=>{var t;return{...e,cardinality:null===(t=e.stats)||void 0===t?void 0:t.cardinality}})).filter((e=>void 0!==e)),nonMetricConfigs:Oe.map((e=>{var t;return{...e,cardinality:null===(t=e.stats)||void 0===t?void 0:t.cardinality}})).filter((e=>void 0!==e))}}),[me,Oe,we.loaded]),Ae=Object(i.useMemo)((()=>{var e,a;return null!==(e=null===t.probability?null==Fe||null===(a=Fe.documentCountStats)||void 0===a?void 0:a.probability:t.probability)&&void 0!==e?e:1}),[t.probability,null==Fe||null===(h=Fe.documentCountStats)||void 0===h?void 0:h.probability]),Me=function(e,t,a,r){const{services:{data:l,notifications:{toasts:o}}}=Object(j.a)(),[c,u]=Object(i.useState)(),[d,p]=Object(i.useReducer)(Object(_.b)(),Object(_.a)()),b=Object(i.useRef)(new AbortController),m=Object(i.useRef)(),g=Object(i.useRef)(),v=Object(i.useCallback)((()=>{var i,o,c;if(null===(i=m.current)||void 0===i||i.unsubscribe(),null===(o=g.current)||void 0===o||o.unsubscribe(),b.current.abort(),b.current=new AbortController,p({...Object(_.a)(),error:void 0}),u(void 0),!e||!t||0===t.metricConfigs.length&&0===t.nonMetricConfigs.length)return void p({loaded:100,isRunning:!1});const{sortField:d,sortDirection:j}=a,v=N.Comparators.property(d,N.Comparators.default(j)),x=[...t.metricConfigs,...t.nonMetricConfigs].sort(v),O=Object(f.a)(x,a.visibleFieldNames,a.visibleFieldTypes),{pageIndex:y,pageSize:h}=a,E=null===(c=O.filteredFields)||void 0===c?void 0:c.slice(y*h,(y+1)*h).filter((e=>!0===e.existsInDocs));if(!E||0===E.length)return void p({loaded:100,isRunning:!1});const S=Object(M.a)(e.timeFieldName,e.earliest,e.latest,e.searchQuery),F={index:e.index,timeFieldName:e.timeFieldName,earliestMs:e.earliest,latestMs:e.latest,runtimeFieldMap:e.runtimeFieldMap,intervalMs:e.intervalMs,query:{bool:{filter:S}},maxExamples:T.a,samplingProbability:r,browserSessionSeed:e.browserSessionSeed,samplingOption:e.samplingOption},{sessionId:V,embeddableExecutionContext:C}=e,z={abortSignal:b.current.signal,sessionId:V,...C?{executionContext:C}:{}},I=((e,t=10)=>{const a=[],i={};return e.forEach((e=>{const a=e.type;void 0===i[a]&&(i[a]=[[]]);let n=Object(w.last)(i[a]);n.length===t&&(n=[],i[a].push(n)),n.push(e)})),Object.values(i).forEach((e=>{a.push(...e)})),a})(E.map(((e,t)=>({...e,safeFieldName:A(e.fieldName,t)}))),10),R=new n.Subject,k=new n.Subject,L=I.map((e=>Q(l.search,F,e,z))).filter((e=>void 0!==e)),D=e=>{console.error(s.i18n.translate("xpack.dataVisualizer.index.errorFetchingFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics"}),e),p({isRunning:!1,error:e})},P=()=>{p({isRunning:!1})},B=new Map;m.current=Object(n.from)(L).pipe(Object(n.mergeMap)((e=>e),U.c)).subscribe({next:e=>{if(p({...Object(_.a)(),error:void 0}),e){const a=[];var t;Array.isArray(e)?e.forEach((e=>{void 0!==e.fieldName&&B.set(e.fieldName,e)})):a.push(...null!==(t=e.fields)&&void 0!==t?t:[]),u(B),p({loaded:B.size/E.length*100,isRunning:!0}),a.length>0&&(R.next(B),k.next(a))}},error:D,complete:P}),g.current=Object(n.combineLatest)([R,k.pipe(Object(n.switchMap)((e=>Object(n.combineLatest)(e.map((e=>Q(l.search,F,[e],z))).filter((e=>void 0!==e))))))]).subscribe({next:e=>{const t=Object(w.cloneDeep)(e[0]),a=e[1];Array.isArray(a)&&(a.forEach((e=>{Array.isArray(e)&&1===e.length&&Array.isArray(e[0].fields)&&e[0].fields.length>0&&t.set(e[0].fields[0],e[0])})),u(t),p({loaded:t.size/E.length*100,isRunning:!0}))},error:D,complete:P})}),[l.search,o,t,a.pageSize,a.pageIndex,a.sortDirection,a.sortField,r]),x=Object(i.useCallback)((()=>{var e,t;null===(e=m.current)||void 0===e||e.unsubscribe(),m.current=void 0,null===(t=g.current)||void 0===t||t.unsubscribe(),g.current=void 0,b.current.abort(),p({isRunning:!1})}),[]);return Object(i.useEffect)((()=>{v()}),[v]),Object(i.useEffect)((()=>x),[x]),{progress:d,fieldStats:c,startFetch:v,cancelFetch:x}}(Se,Ne,t,Ae),_e=Object(i.useMemo)((()=>.2*we.loaded+.8*Me.progress.loaded),[we.loaded,Me.progress.loaded]);Object(i.useEffect)((()=>{const e=Object(n.merge)(be.getTimeUpdate$(),be.getAutoRefreshFetch$(),d.a).subscribe((()=>{o&&o({time:be.getTime(),refreshInterval:be.getRefreshInterval()}),G(Date.now())}));return()=>{e.unsubscribe()}}));const Te=Object(i.useCallback)((()=>{const e=[],t=Fe.aggregatableExistsFields||[],a=ee.filter((e=>e.type===l.b.NUMBER&&void 0!==e.displayName&&!0===ne(e.displayName))),i=a.filter((e=>t.find((t=>t.fieldName===e.spec.name))));if(!1===fe)return void je(!0);let n=Fe.aggregatableExistsFields;a.length!==i.length&&!0===fe&&(n=n.concat(Fe.aggregatableNotExistsFields));const s=!0===fe&&!0===B?a:i;s.forEach((t=>{var a;const i=n.find((e=>e.fieldName===t.spec.name));if(!i)return;const s={...i,fieldFormat:X.getFormatterForField(t),type:x.i.NUMBER,secondaryType:Object(O.a)(t),loading:null===(a=null==i?void 0:i.existsInDocs)||void 0===a||a,aggregatable:!0,deletable:void 0!==t.runtimeField,supportedAggs:te(t)};t.displayName!==s.fieldName&&(s.displayName=t.displayName),e.push(s)})),xe({totalMetricFieldsCount:a.length,visibleMetricsCount:s.length}),ge(e)}),[X,ee,fe,Fe,B]),Ve=Object(i.useCallback)((()=>{const e=ee.filter((e=>e.type!==l.b.NUMBER&&void 0!==e.displayName&&!0===ne(e.displayName))),t=[];let a=[];const i=Fe.aggregatableExistsFields||[],n=Fe.nonAggregatableExistsFields||[];if(e.forEach((e=>{const s=i.find((t=>t.fieldName===e.spec.name));if(void 0!==s)t.push(e),a.push(s);else{const i=n.find((t=>t.fieldName===e.spec.name));void 0!==i&&(t.push(e),a.push(i))}})),!1===he)return void Ee(!0);e.length!==a.length&&!0===B&&(a=a.concat(Fe.aggregatableNotExistsFields,Fe.nonAggregatableNotExistsFields));const s=[];(B?e:t).forEach((e=>{var t;const i=a.find((t=>t.fieldName===e.spec.name)),n={...i||{},secondaryType:Object(O.a)(e),fieldFormat:X.getFormatterForField(e),aggregatable:e.aggregatable,loading:null===(t=null==i?void 0:i.existsInDocs)||void 0===t||t,deletable:void 0!==e.runtimeField},r=Object(O.a)(e);void 0!==r?n.type=r:(n.type=e.type,n.isUnsupportedType=!0),e.displayName!==n.fieldName&&(n.displayName=e.displayName),s.push(n)})),ye(s)}),[X,ee,he,Fe,B]);Object(i.useEffect)((()=>{Te(),Ve()}),[Fe,B]),Object(i.useEffect)((()=>{if(100===_e&&void 0!==E.current){const e=window.performance.now()-E.current;E.current=void 0,function(e,t){e.reportEvent("performance_metric",t)}(R,{eventName:"dataVisualizerDataLoaded",duration:e})}}),[_e]);const Ce=Object(i.useMemo)((()=>{const e=Me.fieldStats;let t=[...Oe,...me];return t=Object(f.a)(t,re,P).filteredFields,e&&(t=t.map((t=>{var a;const i=null!==(a=e.get(t.fieldName))&&void 0!==a?a:{};return i?{...t,loading:!1,stats:{...t.stats,...i}}:t}))),t}),[Oe,me,P,re,Me.progress.loaded,t.pageIndex,t.pageSize]),ze=Object(i.useRef)();Object(i.useEffect)((()=>{const e=ze;return()=>{e.current&&e.current()}}),[]);const Ie=Object(i.useMemo)((()=>{if(!e.dataView)return;const t=F(e.dataView,S,{searchQueryLanguage:oe,searchString:ce},e.allowEditDataView?ze:void 0);return!Array.isArray(t)||t.length<1?void 0:[{name:s.i18n.translate("xpack.dataVisualizer.index.dataGrid.actionsColumnLabel",{defaultMessage:"Actions"}),actions:t,width:"70px"}]}),[e.dataView,S,oe,ce,e.allowEditDataView]);return{progress:_e,overallStatsProgress:we,configs:Ce,queryOrAggregateQuery:de,searchQueryLanguage:oe,searchString:ce,searchQuery:ue,extendedColumns:Ie,documentCountStats:Fe.documentCountStats,metricsStats:ve,overallStats:Fe,timefilter:be,setLastRefresh:G}}},183:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var i=a(0),n=a.n(i),s=a(10),r=a(4),l=a(25),o=a(104),c=a(153),u=a(1),d=a(29),p=a(30),b=a.n(p),m=a(293),g=a(46),f=a(65);function j(){return Object(u.jsx)(s.EuiFlexItem,{style:{alignItems:"center"}},Object(u.jsx)(s.EuiLoadingSpinner,{size:"l","data-test-subj":"loadingSpinner"}))}const v=({width:e,chartPoints:t,timeRangeEarliest:a,timeRangeLatest:n,interval:l,loading:o})=>{const{services:{data:c,uiSettings:p,fieldFormats:v,charts:x}}=Object(f.a)(),O=x.theme.useChartsBaseTheme(),y=v.deserialize({id:"date"}),h=p.get("visualization:useLegacyTimeAxis",!1),E=r.i18n.translate("xpack.dataVisualizer.dataGrid.field.documentCountChart.seriesLabel",{defaultMessage:"document count"}),S=Object(i.useMemo)((()=>t.length<1?[{time:a,value:0}]:1===t.length?[...t,{time:l?Number(t[0].time)+l:a,value:0}]:t),[t,a,n,l]),F=Object(i.useCallback)((e=>{c.query.timefilter.timefilter.setTime({from:b()(e.from).toISOString(),to:b()(e.to).toISOString(),mode:"absolute"})}),[c]),w=Object(m.a)(p);return Object(u.jsx)(s.EuiFlexGroup,{alignItems:"center",css:Object(u.css)({width:null!=e?e:"100%"},"",""),"data-test-subj":"dataVisualizerDocumentCountChart"},o?Object(u.jsx)(j,null):Object(u.jsx)(d.Chart,{size:{width:"100%",height:120}},Object(u.jsx)(d.Settings,{onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;F({from:t,to:a})},onElementClick:([e])=>{const t=e[0].x;F({from:t,to:t+l})},baseTheme:O,locale:r.i18n.getLocale()}),Object(u.jsx)(d.Axis,{id:"bottom",position:d.Position.Bottom,showOverlappingTicks:!0,tickFormat:e=>y.convert(e),labelFormat:h?void 0:()=>"",timeAxisLayerCount:h?0:2,style:h?{}:g.MULTILAYER_TIME_AXIS_STYLE}),Object(u.jsx)(d.Axis,{id:"left",position:d.Position.Left}),Object(u.jsx)(d.HistogramBarSeries,{id:"document_count",name:E,xScaleType:d.ScaleType.Time,yScaleType:d.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:S,timeZone:w,yNice:!0})))};var x=a(154),O=a(155);const y=Object(u.jsx)("div",{"data-test-subj":"dvRandomSamplerCalculatingProbabilityMsg"},Object(u.jsx)(s.EuiSpacer,{size:"m"}),Object(u.jsx)(l.FormattedMessage,{id:"xpack.dataVisualizer.randomSamplerSettingsPopUp.calculatingProbabilityLabel",defaultMessage:"Calculating the optimal probability"})),h=({documentCountStats:e,totalCount:t,samplingProbability:a,setSamplingProbability:l,loading:d,randomSamplerPreference:p,setRandomSamplerPreference:b,showSettings:m=!0})=>{const[g,f]=Object(i.useState)(!1),j=Object(i.useCallback)((()=>{f(!g)}),[g]),h=Object(i.useCallback)((()=>{f(!1)}),[f]),E=Object(i.useMemo)((()=>{switch(p){case o.b.OFF:return r.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.offCalloutMessage",{defaultMessage:"Random sampling can be turned on for the total document count and chart to increase speed although some accuracy will be lost."});case o.b.ON_AUTOMATIC:return r.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onAutomaticCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. The probability is automatically set to balance accuracy and speed."});case o.b.ON_MANUAL:default:return r.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onManualCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. A lower percentage probability increases performance, but some accuracy is lost."})}}),[p]);if(void 0===e)return void 0!==t?Object(u.jsx)(c.a,{totalCount:t}):null;const{timeRangeEarliest:S,timeRangeLatest:F}=e;if(void 0===S||void 0===F)return Object(u.jsx)(c.a,{totalCount:t});let w=[];if(void 0!==e.buckets){const t=null==e?void 0:e.buckets;w=Object.entries(t).map((([e,t])=>({time:+e,value:t})))}const N=!0===e.randomlySampled;return Object(u.jsx)(n.a.Fragment,null,Object(u.jsx)(s.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(u.jsx)(c.a,{totalCount:t,approximate:N,loading:d}),m?Object(u.jsx)(s.EuiFlexItem,{grow:!1,style:{marginLeft:"auto"}},Object(u.jsx)(s.EuiPopover,{"data-test-subj":"dvRandomSamplerOptionsPopover",id:"dataVisualizerSamplingOptions",button:Object(u.jsx)(s.EuiToolTip,{content:r.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})},Object(u.jsx)(s.EuiButtonIcon,{size:"xs",iconType:"gear",onClick:j,"data-test-subj":"dvRandomSamplerOptionsButton","aria-label":r.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})})),isOpen:g,closePopover:h,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(u.jsx)(s.EuiPanel,{style:{maxWidth:400}},Object(u.jsx)(s.EuiFlexItem,{grow:!0},Object(u.jsx)(s.EuiCallOut,{size:"s",color:"primary",title:E})),Object(u.jsx)(s.EuiSpacer,{size:"m"}),b?Object(u.jsx)(s.EuiFormRow,{"data-test-subj":"dvRandomSamplerOptionsFormRow",label:r.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.randomSamplerRowLabel",{defaultMessage:"Random sampling"})},Object(u.jsx)(s.EuiSelect,{"data-test-subj":"dvRandomSamplerOptionsSelect",options:o.d,value:p,onChange:e=>b(e.target.value)})):null,p===o.b.ON_MANUAL?Object(u.jsx)(x.a,{samplingProbability:a,setSamplingProbability:l}):null,p===o.b.ON_AUTOMATIC?d?y:Object(u.jsx)(O.a,{samplingProbability:a}):null)),Object(u.jsx)(s.EuiFlexItem,null)):null),Object(u.jsx)(v,{chartPoints:w,timeRangeEarliest:S,timeRangeLatest:F,interval:e.interval,loading:d}))}},187:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var i=a(10),n=a(25),s=(a(0),a(1)),r=a(185);const l=({metricsStats:e,fieldsCountStats:t,showEmptyFields:a,toggleShowEmptyFields:l})=>{const{euiTheme:o}=Object(i.useEuiTheme)(),c=Object(s.css)({marginLeft:o.size.xs,[Object(i.useEuiBreakpoint)(["xs","s"])]:{flexDirection:"column",alignItems:"flex-start"}},"","");return Object(s.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",css:c,"data-test-subj":"dataVisualizerFieldCountPanel",responsive:!1,wrap:!0},Object(s.jsx)(r.b,{fieldsCountStats:t}),Object(s.jsx)(r.a,{metricsStats:e}),Object(s.jsx)(i.EuiFlexItem,{css:r.c},Object(s.jsx)(i.EuiSwitch,{"data-test-subj":"dataVisualizerShowEmptyFieldsSwitch",label:Object(s.jsx)(n.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:a,onChange:l})))}},221:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t,a=this,i=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var i=.02519603282416938*(t+=e.charCodeAt(a));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=i(" "),a.s1=i(" "),a.s2=i(" "),a.s0-=i(e),a.s0<0&&(a.s0+=1),a.s1-=i(e),a.s1<0&&(a.s1+=1),a.s2-=i(e),a.s2<0&&(a.s2+=1),i=null}function l(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var a=new r(e),i=t&&t.state,n=a.next;return n.int32=function(){return 4294967296*a.next()|0},n.double=function(){return n()+11102230246251565e-32*(2097152*n()|0)},n.quick=n,i&&("object"==typeof i&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.alea=o}(0,e,a(73))}).call(this,a(92)(e))},222:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var a=new r(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.xor128=o}(0,e,a(73))}).call(this,a(92)(e))},223:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),i==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var a=new r(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.xorwow=o}(0,e,a(73))}).call(this,a(92)(e))},224:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t=this;t.next=function(){var e,a,i=t.x,n=t.i;return e=i[n],a=(e^=e>>>7)^e<<24,a^=(e=i[n+1&7])^e>>>10,a^=(e=i[n+3&7])^e>>>3,a^=(e=i[n+4&7])^e<<7,e=i[n+7&7],a^=(e^=e<<13)^e<<9,i[n]=a,t.i=n+1&7,a},function(e,t){var a,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,a=0;a<t.length;++a)i[7&a]=i[7&a]<<15^t.charCodeAt(a)+i[a+1&7]<<13;for(;i.length<8;)i.push(0);for(a=0;a<8&&0===i[a];++a);for(8==a?i[7]=-1:i[a],e.x=i,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function l(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var a=new r(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&(i.x&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.xorshift7=o}(0,e,a(73))}).call(this,a(92)(e))},225:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t=this;t.next=function(){var e,a,i=t.w,n=t.X,s=t.i;return t.w=i=i+1640531527|0,a=n[s+34&127],e=n[s=s+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=n[s]=a^e,t.i=s,a+(i^i>>>16)|0},function(e,t){var a,i,n,s,r,l=[],o=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,o=Math.max(o,t.length)),n=0,s=-32;s<o;++s)t&&(i^=t.charCodeAt((s+32)%t.length)),0===s&&(r=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,s>=0&&(r=r+1640531527|0,n=0==(a=l[127&s]^=i+r)?n+1:0);for(n>=128&&(l[127&(t&&t.length||0)]=-1),n=127,s=512;s>0;--s)i=l[n+34&127],a=l[n=n+1&127],i^=i<<13,a^=a<<17,i^=i>>>15,a^=a>>>12,l[n]=i^a;e.w=r,e.X=l,e.i=n}(t,e)}function l(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var a=new r(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&(i.X&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.xor4096=o}(0,e,a(73))}).call(this,a(92)(e))},226:function(e,t,a){(function(e){var i;!function(e,n,s){function r(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,i=t.d,n=t.a;return e=e<<25^e>>>7^a,a=a-i|0,i=i<<24^i>>>8^n,n=n-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-i|0,t.d=i<<16^a>>>16^n,t.a=n-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var i=0;i<a.length+20;i++)t.b^=0|a.charCodeAt(i),t.next()}function l(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var a=new r(e),i=t&&t.state,n=function(){return(a.next()>>>0)/4294967296};return n.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},n.int32=a.next,n.quick=n,i&&("object"==typeof i&&l(i,a),n.state=function(){return l(a,{})}),n}n&&n.exports?n.exports=o:a(73)&&a(93)?void 0===(i=function(){return o}.call(t,a,t,n))||(n.exports=i):this.tychei=o}(0,e,a(73))}).call(this,a(92)(e))},227:function(e,t,a){var i;!function(n,s,r){var l,o=256,c=r.pow(o,6),u=r.pow(2,52),d=2*u,p=o-1;function b(e,t,a){var i=[],p=j(f((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(s)]:null==e?function(){try{var e;return l&&(e=l.randomBytes)?e=e(o):(e=new Uint8Array(o),(n.crypto||n.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=n.navigator,a=t&&t.plugins;return[+new Date,n,a,n.screen,v(s)]}}():e,3),i),b=new m(i),x=function(){for(var e=b.g(6),t=c,a=0;e<u;)e=(e+a)*o,t*=o,a=b.g(1);for(;e>=d;)e/=2,t/=2,a>>>=1;return(e+a)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,j(v(b.S),s),(t.pass||a||function(e,t,a,i){return i&&(i.S&&g(i,b),e.state=function(){return g(b,{})}),a?(r.random=e,t):e})(x,p,"global"in t?t.global:this==r,t.state)}function m(e){var t,a=e.length,i=this,n=0,s=i.i=i.j=0,r=i.S=[];for(a||(e=[a++]);n<o;)r[n]=n++;for(n=0;n<o;n++)r[n]=r[s=p&s+e[n%a]+(t=r[n])],r[s]=t;(i.g=function(e){for(var t,a=0,n=i.i,s=i.j,r=i.S;e--;)t=r[n=p&n+1],a=a*o+r[p&(r[n]=r[s=p&s+t])+(r[s]=t)];return i.i=n,i.j=s,a})(o)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var a,i=[],n=typeof e;if(t&&"object"==n)for(a in e)try{i.push(f(e[a],t-1))}catch(e){}return i.length?i:"string"==n?e:e+"\0"}function j(e,t){for(var a,i=e+"",n=0;n<i.length;)t[p&n]=p&(a^=19*t[p&n])+i.charCodeAt(n++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(j(r.random(),s),e.exports){e.exports=b;try{l=a(228)}catch(e){}}else void 0===(i=function(){return b}.call(t,a,t,e))||(e.exports=i)}("undefined"!=typeof self?self:this,[],Math)},228:function(e,t){},72:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return r}));const i="DATA_VISUALIZER_INDEX_VIEWER",n="index_data_visualizer",s=10;function r(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:!1,nonMetricConfigs:[],nonMetricsLoaded:!1,documentCountStats:void 0}}},73:function(e,t,a){e.exports=a(16)(1784)},88:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return s}));const i=10,n=100,s=5},92:function(e,t,a){e.exports=a(16)(455)},93:function(e,t){(function(t){e.exports=t}).call(this,{})}}]);