/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[8],{116:function(e,t,s){"use strict";const a=s(231);e.exports=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new a;let s=0;const r=async(e,a,...r)=>{s++;const n=(async()=>e(...r))();a(n);try{await n}catch{}s--,t.size>0&&t.dequeue()()},n=(a,...n)=>new Promise((i=>{((a,n,...i)=>{t.enqueue(r.bind(null,a,n,...i)),(async()=>{await Promise.resolve(),s<e&&t.size>0&&t.dequeue()()})()})(a,i,...n)}));return Object.defineProperties(n,{activeCount:{get:()=>s},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),n}},182:function(e,t,s){"use strict";s.d(t,"a",(function(){return Z})),s.d(t,"b",(function(){return ee}));var a=s(0),r=s(159),n=s(113),i=s(8),l=s(10),o=s(63),u=s(11),c=s(152);var d=s(69),m=s.n(d),f=s(229),g=s(28),b=s(303),v=s(32),p=s(232),y=s.n(p),S=s(112),h=s(118),O=s(4),E=s(5),j=s(27);function q(e){const t=Object(a.useRef)(new AbortController),[s,r]=Object(a.useState)(!1);return{runRequest:Object(a.useCallback)(((s,a={})=>new Promise(((n,l)=>{e.search.search(s,{abortSignal:t.current.signal,...a}).pipe(Object(i.tap)((()=>{r(!0)}))).subscribe({next:e=>{Object(j.isRunningResponse)(e)||(r(!1),n(e))},error:e=>{if("AbortError"===e.name)return n(null);r(!1),l(e)}})}))),[e.search]),cancelRequest:Object(a.useCallback)((()=>{t.current.abort(),t.current=new AbortController}),[]),isLoading:s}}var N=s(43);function F(e,t){const{ast:s}=Object(N.getAstAndSyntaxErrors)(e),a=s.find((({name:e})=>["from","metrics"].includes(e)));if(!a)return e;let r=-1;const n=s.find((({name:e},t)=>(r=t,"sort"===e)));if(!n||n&&1!==r){const s=e.substring(a.location.min,a.location.max+1);return e.replace(s,`${s} \n| LIMIT ${t}`)}const i=e.substring(a.location.min,n.location.max+1);return e.replace(i,`${i} \n| LIMIT ${t}`)}var R=s(65),_=s(105),x=s(74);function C(e,t){return`${e}\n${t}`}var T=s(116),A=s.n(T),w=s(133),I=s(88),$=s(94),M=s(72);const Q=({onError:e,request:t,error:s,title:a})=>{console.error(s,t),e&&(s.handled=!0,s.message=JSON.stringify(t),e(s,null!=a?a:O.i18n.translate("xpack.dataVisualizer.esql.errorMessage",{defaultMessage:"Error excecuting ES|QL request:"})))},L=async({runRequest:e,columns:t,esqlBaseQuery:s,filter:a})=>{const r=A()(M.c),n=Object(E.chunk)(t,10),i=await Promise.allSettled(n.map((t=>r((()=>(async({runRequest:e,columns:t,esqlBaseQuery:s,filter:a})=>{const r=x.a.reduce(((e,t,s)=>(e[`p${t}`]=s+2,e)),{min:0,max:1}),n=t.map(((e,t)=>{const s=Object(x.b)(e.name,x.a);return{field:e,query:`${Object(x.c)(`${e.name}_min`)} = MIN(${Object(x.c)(e.name)}),\n    ${Object(x.c)(`${e.name}_max`)} = MAX(${Object(x.c)(e.name)}),\n  ${s.join(",")}\n  `,startIndex:t*Object.keys(r).length}}));if(n.length>0){const t={params:{query:C(s,"| STATS "+n.map((({query:e})=>e)).join(",")),...a?{filter:a}:{}}};try{const s=await e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY});if(s){const e=s.rawResponse.values[0];return n.map((({field:t,startIndex:s},a)=>{const n=e[s+r.min],i=e[s+r.max],l=e[s+r.p50],o=e.slice(s+r.p5,s+r.p100+1).map((e=>({value:e}))),u=Object(w.a)(o,I.c,n);return{fieldName:t.name,...t,min:n,max:i,median:l,distribution:u}}))}}catch(e){return Q({error:e,request:t}),n.map((({field:t})=>({fieldName:t.name,error:e})))}}return[]})({columns:t,filter:a,runRequest:e,esqlBaseQuery:s}))))));return i.filter($.a).flatMap((e=>e.value))},z=async({runRequest:e,columns:t,esqlBaseQuery:s,filter:a})=>{const r=A()(M.c),n=t.map((e=>({field:e,request:{params:{query:C(s,`| STATS ${Object(x.c)(`${e.name}_in_records`)} = count(MV_MIN(${Object(x.c)(e.name)}))\n    BY ${Object(x.c)(e.name)}\n  | SORT ${Object(x.c)(`${e.name}_in_records`)} DESC\n  | LIMIT 10`),...a?{filter:a}:{}}}})));if(n.length>0){const t=await Promise.allSettled(n.map((({request:t})=>r((()=>e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY}))))));if(t)return n.map((({field:e,request:s},a)=>{const r=t[a];if(r){if(!Object($.a)(r))return Object($.b)(r)?(console.error(r,s),{fieldName:e.name,error:r.reason}):void 0;{var n,i;const t=null===(n=r.value)||void 0===n||null===(i=n.rawResponse)||void 0===i?void 0:i.values;if(t){const s=t.reduce(((e,t)=>t[0]+e),0),a=t.map((e=>({key:e[1],doc_count:e[0]})));return{fieldName:e.name,topValues:a,isTopValuesSampled:!0,approximate:!0,topValuesSampleSize:s}}}}}))}return[]},P=async({runRequest:e,columns:t,esqlBaseQuery:s,filter:a})=>{const r=t.map((e=>({field:e,query:`${Object(x.c)(`${e.name}_earliest`)} = MIN(${Object(x.c)(e.name)}), ${Object(x.c)(`${e.name}_latest`)} = MAX(${Object(x.c)(e.name)})`})));if(r.length>0){const t={params:{query:C(s," | STATS "+r.map((({query:e})=>e)).join(",")),...a?{filter:a}:{}}};try{const s=await e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY});if(s)return r.map((({field:e},t)=>{const a=s.rawResponse.values[0],r=a[2*t],n=a[2*t+1];return{fieldName:e.name,earliest:r,latest:n}}))}catch(e){return console.error(e,t),r.map((({field:t},s)=>({fieldName:t.name,error:e})))}}return[]},D=async({runRequest:e,columns:t,esqlBaseQuery:s,filter:a})=>{const r=A()(M.c),n=t.filter((e=>"boolean"===e.secondaryType)).map((e=>({field:e,request:{params:{query:C(s,`| STATS ${Object(x.c)(`${e.name}_terms`)} = count(${Object(x.c)(e.name)}) BY ${Object(x.c)(e.name)}\n        | LIMIT 3`),...a?{filter:a}:{}}}})));if(n.length>0){const t=await Promise.allSettled(n.map((({request:t})=>r((()=>e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY}))))));if(t)return n.map((({field:e,request:s},a)=>{const r=t[a];if(r){if(Object($.a)(r)&&r.value){const t=r.value.rawResponse.values,s=t.reduce(((e,t)=>e+t[0]),0);let a=0,n=0;const i=t.map((e=>(!1===e[1]&&(a=e[0]),!0===e[1]&&(n=e[0]),{key_as_string:!1===e[1]?"false":"true",doc_count:e[0],percent:e[0]/s})));return{fieldName:e.name,topValues:i,topValuesSampleSize:s,topValuesSamplerShardSize:s,isTopValuesSampled:!1,trueCount:n,falseCount:a,count:n+a}}return Object($.b)(r)?(console.error(r,s),{fieldName:e.name,error:r.reason}):void 0}}))}return[]};var B=s(114),V=s(220),k=s(6),Y=s(111);const H=new Set([j.KBN_FIELD_TYPES.GEO_SHAPE,j.KBN_FIELD_TYPES.GEO_POINT,j.KBN_FIELD_TYPES.HISTOGRAM]),U=O.i18n.translate("xpack.dataVisualizer.index.errorFetchingESQLFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics for ES|QL query"}),G=e=>{const{services:{data:t,notifications:{toasts:s}}}=Object(R.a)(),r=Object(a.useRef)(void 0),n=Object(a.useRef)(""),i=Object(a.useRef)(),{runRequest:l,cancelRequest:o}=q(t),[u,c]=Object(a.useReducer)(Object(_.b)(),{timeFieldName:void 0,columns:void 0,totalCount:void 0,exampleDocs:void 0,totalFields:void 0}),[d,m]=Object(a.useState)(!1),[f,g]=Object(a.useReducer)(Object(_.b)(),Object(_.a)()),b=Object(a.useCallback)(((e,t)=>{i.current||(i.current=e,s.addError(e,{title:null!=t?t:U}))}),[s]),v=Object(a.useCallback)((async function(){try{var t;if(!e||0===e.lastRefresh)return;if(void 0===e.id&&void 0!==r.current&&(e.lastRefresh===r.current||e.lastRefresh-r.current<800))return;r.current=e.lastRefresh,o(),g({...Object(_.a)(),isRunning:!0,error:void 0}),i.current=void 0;const{searchQuery:s,intervalMs:a,filter:d,limit:f,totalCount:v}=e;if(!Object(x.d)(s))return;const p=0===a?216e4:a,y=s.esql;m(!0);const S=await l({params:{query:F(y,1e4),...d?{filter:d}:{},dropNullColumns:!0}},{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY});m(!1);const h=null!=S&&S.rawResponse?null!==(t=S.rawResponse.all_columns)&&void 0!==t?t:S.rawResponse.columns:[],q=new Set(null==S?void 0:S.rawResponse.columns.map((e=>e.name))),N=h.map((e=>({...e,secondaryType:Object(Y.b)(e.type)}))),R=N.filter((e=>"date"===e.type)),T=R.find((t=>t.name===(null==e?void 0:e.timeFieldName)))?null==e?void 0:e.timeFieldName:void 0,w=R.length>0?R.find((e=>"@timestamp"===e.name))?"@timestamp":null!=T?T:R[0].name:void 0;c({columns:N,timeFieldName:w});const I=JSON.stringify({searchQuery:s,filter:d,timeFieldName:w,intervalInMs:p});let{totalCount:L,documentCountStats:z}=u;if(void 0!==v&&(L=v),void 0===v&&(void 0===L||void 0===z||I!==n.current)){c({totalCount:void 0,documentCountStats:void 0}),n.current=I;const e=await(async(e,t,s,a,r,n,i)=>{if(!Object(x.d)(t))throw Error(O.i18n.translate("xpack.dataVisualizer.esql.noQueryProvided",{defaultMessage:"No ES|QL query provided"}));const l=t.esql;let o=1/0,u=-1/0;if(a){const t={params:{query:C(l,` | EVAL _timestamp_= TO_DOUBLE(DATE_TRUNC(${r} millisecond, ${Object(x.c)(a)}))\n    | stats rows = count(*) by _timestamp_`),...s?{filter:s}:{}}};try{const s=await e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY});let a=0;const n={};return null==s||s.rawResponse.values.forEach((e=>{const[t,s]=e;n[s]=t,a+=t,s<o&&(o=s),s>=u&&(u=s)})),{documentCountStats:{interval:r,probability:1,randomlySampled:!1,timeRangeEarliest:o,timeRangeLatest:u,buckets:n,totalCount:a},totalCount:a,request:t}}catch(e){return Q({request:t,error:e,onError:i,title:O.i18n.translate("xpack.dataVisualizer.esql.docCountError",{defaultMessage:"Error getting total count & doc count chart for ES|QL time-series data for request:"})}),Promise.reject(e)}}else{const t={params:{query:C(l," | STATS _count_ = COUNT(*)  | LIMIT 1"),...s?{filter:s}:{}}};try{const s=await e(t,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY});return{request:t,documentCountStats:void 0,totalCount:null==s?void 0:s.rawResponse.values[0][0]}}catch(e){return Q({request:t,error:e,title:O.i18n.translate("xpack.dataVisualizer.esql.docCountNoneTimeseriesError",{defaultMessage:"Error getting total count for ES|QL data:"})}),Promise.reject(e)}}})(l,s,d,w,p,0,b);L=e.totalCount,z=e.documentCountStats,c({totalCount:L,documentCountStats:z})}void 0===L&&(L=0),g({loaded:50});const P=[],D=[],B=N.filter((e=>"unsupported"!==e.type&&"null"!==e.type)).map((e=>({...e,aggregatable:!H.has(e.type)}))),U=B.filter((e=>q.has(e.name)));null==B||B.forEach((e=>{const t=e.name;k.h.includes(t)||(e.aggregatable?q.has(t)||P.push({...e,fieldName:e.name,aggregatable:!0,existsInDocs:!1}):q.has(t)||D.push({...e,fieldName:e.name,secondaryType:Object(Y.b)(e.type),existsInDocs:!1}))}));const G=F(s.esql,f);if(0===L)return c({aggregatableFields:void 0,nonAggregatableFields:void 0,overallStats:void 0,columns:void 0,timeFieldName:void 0}),void g({loaded:100,isRunning:!1,error:void 0});if(L>0&&B.length>0){const e=await(async({runRequest:e,fields:t,esqlBaseQueryWithLimit:s,filter:a,limitSize:r,totalCount:n,onError:i})=>{const l=A()(M.c),o=Object(E.chunk)(t,30),u=await Promise.allSettled(o.map(((t,o)=>l((()=>(async({runRequest:e,fields:t,esqlBaseQueryWithLimit:s,filter:a,limitSize:r,totalCount:n,onError:i})=>{if(t.length>0){const l={count:0,cardinality:1};let o=0;const u=t.map((e=>{if(e.aggregatable){const t={...e,startIndex:o,query:`${Object(x.c)(`${e.name}_count`)} = COUNT(MV_MIN(${Object(x.c)(e.name)})), ${Object(x.c)(`${e.name}_cardinality`)} = COUNT_DISTINCT(${Object(x.c)(e.name)})`};return o+=2,t}{const t={...e,startIndex:o,query:`${Object(x.c)(`${e.name}_count`)} = COUNT(${Object(x.c)(e.name)})`};return o+=1,t}}));let c=u.length>0?"| STATS ":"";c+=u.map((e=>e.query)).join(",");const d={params:{query:C(s,c),...a?{filter:a}:{}}};try{const t=await e(d,{strategy:j.ESQL_ASYNC_SEARCH_STRATEGY}),s={aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};if(!t)return;const a=t.rawResponse,i=Object(V.a)(r)?r:n;return u.forEach(((e,t)=>{const r=a.values[0][e.startIndex+l.count];if(!0===e.aggregatable){const t=a.values[0][e.startIndex+l.cardinality];r>0?s.aggregatableExistsFields.push({...e,fieldName:e.name,existsInDocs:!0,stats:{sampleCount:i,count:r,cardinality:t}}):s.aggregatableNotExistsFields.push({...e,fieldName:e.name,existsInDocs:!1,stats:void 0})}else r>0?s.nonAggregatableExistsFields.push({fieldName:e.name,existsInDocs:!0,stats:{sampleCount:i,count:r}}):s.nonAggregatableNotExistsFields.push({fieldName:e.name,existsInDocs:!1})})),s}catch(e){return Q({error:e,request:d,onError:i,title:O.i18n.translate("xpack.dataVisualizer.esql.countAndCardinalityError",{defaultMessage:"Unable to fetch count & cardinality for {count} {count, plural, one {field} other {fields}}: {fieldNames}",values:{count:u.length,fieldNames:u.map((e=>e.name)).join()}})}),Promise.reject(e)}}})({runRequest:e,fields:t,esqlBaseQueryWithLimit:s,limitSize:r,filter:a,totalCount:n,onError:i}))))));return u.filter($.a).map((e=>e.value)).reduce(((e,t)=>(e&&t&&(e.aggregatableExistsFields.push(...t.aggregatableExistsFields),e.aggregatableNotExistsFields.push(...t.aggregatableNotExistsFields),e.nonAggregatableExistsFields.push(...t.nonAggregatableExistsFields),e.nonAggregatableNotExistsFields.push(...t.nonAggregatableNotExistsFields)),e)),{aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]})})({runRequest:l,fields:U,esqlBaseQueryWithLimit:G,filter:d,limitSize:f,totalCount:L,onError:b});if(!e)return;e.aggregatableNotExistsFields=P,e.nonAggregatableNotExistsFields=D,c({overallStats:e,totalFields:N.length}),g({loaded:100,isRunning:!1,error:void 0});const t=h.reduce(((e,t,s)=>("text"!==t.type&&"geo_point"!==t.type&&"geo_shape"!==t.type||(e[t.name]=s),e)),{}),s=Object.entries(t).map((([e,t])=>{var s;return{fieldName:e,examples:[...new Set(null==S||null===(s=S.rawResponse)||void 0===s?void 0:s.values.map((e=>e[t])))].filter(V.a).slice(0,10)}}));c({exampleDocs:s})}}catch(e){g({loaded:100,isRunning:!1,error:e}),m(!1),"AbortError"!==e.name&&!0!==e.handled&&s.addError(e,{title:U}),console.error(`${U}: fetchOverallStats`,e)}}),[JSON.stringify({fieldStatsRequest:e})]);return Object(a.useEffect)((()=>{v()}),[v]),Object(a.useMemo)((()=>({...u,overallStatsProgress:f,cancelOverallStatsRequest:o,queryHistoryStatus:d})),[u,f,o,d])};var J=s(1);const K={match_all:{}},W={esql:""},X=Object(M.d)(),Z=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],limitSize:"10000",searchString:"",searchQuery:K,searchQueryLanguage:f.a.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,probability:null,rndSamplerPref:"off",query:{esql:""},...e}),ee=(e,t)=>{var s,d,f,p,j,N,C;const[T,A]=Object(a.useState)(0),{services:w}=Object(R.a)(),{uiSettings:I,executionContext:$,data:M}=w,Q=m()(null==$?void 0:$.context$),V=Object(a.useMemo)((()=>{const t={type:"visualization",name:"esql_field_statistics_table",id:e.id};return{...Q||{},child:t}}),[Q,e.id]);Object(g.useExecutionContext)($,V);const k=Object(b.a)(I),Y=Object(r.c)({timeRangeSelector:!0,autoRefreshSelector:!0}),[H,U]=Object(a.useState)(null==e?void 0:e.esqlQuery),K=y()(H),{currentDataView:ee,parentQuery:te,parentFilters:se,query:ae,visibleFieldNames:re,indexPattern:ne}=Object(a.useMemo)((()=>{var t;let s=W;return null!=e&&e.query&&Object(x.d)(null==e?void 0:e.query)&&(s=e.query),H&&Object(x.d)(H)&&(s=H),null!=e&&e.savedSearch&&Object(x.d)(e.savedSearch.searchSource.getField("query"))&&(s=e.savedSearch.searchSource.getField("query")),{currentDataView:e.dataView,query:s,parentQuery:null==e?void 0:e.query,parentFilters:null==e?void 0:e.filters,visibleFieldNames:null!==(t=null==e?void 0:e.visibleFieldNames)&&void 0!==t?t:[],indexPattern:null==e?void 0:e.indexPattern}}),[e.query,e.savedSearch,e.dataView,null==e?void 0:e.filters,null==e?void 0:e.visibleFieldNames,null==e?void 0:e.indexPattern,H]),ie=Object(a.useMemo)((()=>Z(t)),[]),[le,oe]=Object(o.f)("_g"),ue=null!==(s=t.showEmptyFields)&&void 0!==s?s:ie.showEmptyFields,ce=null!==(d=t.limitSize)&&void 0!==d?d:ie.limitSize,de=Object(a.useMemo)((()=>{var t;const s=k,a=Y;if(!s||!a||Object(x.d)(ae)&&""===ae.esql)return;const r=a.getActiveBounds();let n,i;var l,o;void 0!==r&&void 0!==(null==ee?void 0:ee.timeFieldName)&&(n=null===(l=r.min)||void 0===l?void 0:l.valueOf(),i=null===(o=r.max)||void 0===o?void 0:o.valueOf());const u=a.getActiveBounds(),c=null!==(t=I.get("histogram:barTarget"))&&void 0!==t?t:B.a;s.setInterval("auto"),u&&(s.setBounds(u),s.setBarTarget(c));const d=s.getInterval();let m=Object(v.buildEsQuery)(e.dataView,Array.isArray(te)?te:[te],null!=se?se:[]);const f=e.timeRange?e.timeRange:Y.getTime();var g,b;return null!=ee&&ee.timeFieldName&&(Array.isArray(null===(g=m)||void 0===g||null===(b=g.bool)||void 0===b?void 0:b.filter)?m.bool.filter.push({range:{[ee.timeFieldName]:{format:"strict_date_optional_time",gte:f.from,lte:f.to}}}):m={bool:{must:[],filter:[{range:{[ee.timeFieldName]:{format:"strict_date_optional_time",gte:f.from,lte:f.to}}}],should:[],must_not:[]}}),{id:e.id,earliest:n,latest:i,aggInterval:d,intervalMs:null==d?void 0:d.asMilliseconds(),searchQuery:ae,limit:void 0!==ce?parseInt(ce,10):1e4,sessionId:void 0,indexPattern:ne,timeFieldName:null==ee?void 0:ee.timeFieldName,runtimeFieldMap:null==ee?void 0:ee.getRuntimeMappings(),lastRefresh:T,filter:m}}),[k,Y,JSON.stringify({query:ae,parentQuery:te,parentFilters:se}),null==ee?void 0:ee.timeFieldName,T,ce,null===(f=e.timeRange)||void 0===f?void 0:f.from,null===(p=e.timeRange)||void 0===p?void 0:p.to]);Object(a.useEffect)((()=>{A(Date.now())}),[A]),Object(a.useEffect)((()=>{void 0!==(null==le?void 0:le.time)&&Y.setTime({from:le.time.from,to:le.time.to})}),[JSON.stringify(null==le?void 0:le.time),Y]),Object(a.useEffect)((()=>{const e=Object(i.merge)(Y.getTimeUpdate$(),Y.getAutoRefreshFetch$(),n.a).subscribe((()=>{oe({time:Y.getTime(),refreshInterval:Y.getRefreshInterval()}),A(Date.now())}));return()=>{e.unsubscribe()}}),[]),Object(a.useEffect)((()=>{void 0!==(null==le?void 0:le.refreshInterval)&&Y.setRefreshInterval(le.refreshInterval)}),[JSON.stringify(null==le?void 0:le.refreshInterval),Y]);const{documentCountStats:me,totalCount:fe,overallStats:ge,totalFields:be,overallStatsProgress:ve,columns:pe,cancelOverallStatsRequest:ye,timeFieldName:Se,queryHistoryStatus:he,exampleDocs:Oe}=G(de),[Ee,je]=Object(a.useState)(X.metricConfigs),[qe]=Object(a.useState)(X.metricsLoaded),[Ne,Fe]=Object(a.useState)(),[Re,_e]=Object(a.useState)(X.nonMetricConfigs),[xe]=Object(a.useState)(X.nonMetricsLoaded),[Ce,Te]=Object(a.useState)(),Ae=null!==(j=t.visibleFieldTypes)&&void 0!==j?j:ie.visibleFieldTypes;Object(a.useEffect)((function(){var e;const{sortField:s,sortDirection:a}=t,r=l.Comparators.property(s,l.Comparators.default(a)),n=[...Re,...Ee].map((e=>{var t,s;return{...e,name:e.fieldName,docCount:null===(t=e.stats)||void 0===t?void 0:t.count,cardinality:null===(s=e.stats)||void 0===s?void 0:s.cardinality}})).sort(r),i=Object(S.a)(n,t.visibleFieldNames,t.visibleFieldTypes),{pageIndex:o,pageSize:u}=t,c=null===(e=i.filteredFields)||void 0===e?void 0:e.slice(o*u,(o+1)*u).filter((e=>!0===e.existsInDocs));Te(c)}),[t.pageIndex,t.pageSize,t.sortField,t.sortDirection,Re,Ee]);const{fieldStats:we,fieldStatsProgress:Ie,cancelFieldStatsRequest:$e}=(({searchQuery:e,columns:t,filter:s,limit:r})=>{const[n,i]=Object(a.useState)(),[l,o]=Object(a.useReducer)(Object(_.b)(),Object(_.a)()),{services:{data:u,notifications:{toasts:c}}}=Object(R.a)(),{runRequest:d,cancelRequest:m}=q(u);return Object(a.useEffect)((function(){let a=!1;return(async()=>{if(m(),o({...Object(_.a)(),isRunning:!0,error:void 0}),Object(x.d)(e)&&t)try{const n=F(e.esql,r),l=t.length,u=new Map;function f(e){a||(e.forEach((e=>{e&&u.set(e.fieldName,e)})),o({loaded:u.size/l*100}))}i(u);const g=Object(E.chunk)(t,25);for(const b of g)await L({columns:b.filter((e=>"number"===e.secondaryType)),filter:s,runRequest:d,esqlBaseQuery:n}).then(f),await z({columns:b.filter((e=>"keyword"===e.secondaryType||"ip"===e.secondaryType)),filter:s,runRequest:d,esqlBaseQuery:n}).then(f),await D({columns:b.filter((e=>"boolean"===e.secondaryType)),filter:s,runRequest:d,esqlBaseQuery:n}).then(f),await P({columns:b.filter((e=>"date"===e.secondaryType)),filter:s,runRequest:d,esqlBaseQuery:n}).then(f);o({loaded:100,isRunning:!1})}catch(v){if("AbortError"!==v.name){const p=O.i18n.translate("xpack.dataVisualizer.index.errorFetchingESQLFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics for ES|QL query"});c.addError(v,{title:p}),console.error(`${p}: fetchFieldStats`,v),o({loaded:100,isRunning:!1,error:v})}}})(),()=>{a=!0}}),[t,JSON.stringify({filter:s}),r]),{fieldStats:n,fieldStatsProgress:l,cancelFieldStatsRequest:m}})({searchQuery:null==de?void 0:de.searchQuery,columns:Ce,filter:null==de?void 0:de.filter,limit:null!==(N=null==de?void 0:de.limit)&&void 0!==N?N:1e4});Object(a.useEffect)((function(){void 0===fe&&Te(void 0),0===fe&&(je(X.metricConfigs),_e(X.nonMetricConfigs),Fe(void 0),Te(void 0))}),[fe]);const Me=Object(a.useCallback)((()=>{if(!pe||!ge)return;const e=[],t=ge.aggregatableExistsFields||[],s=pe.filter((e=>e.secondaryType===u.b.NUMBER)),a=s.filter((e=>t.find((t=>t.fieldName===e.name))));let r=ge.aggregatableExistsFields;s.length!==a.length&&!0===qe&&(r=r.concat(ge.aggregatableNotExistsFields));const n=!0===qe&&!0===ue?s:a;n.forEach((t=>{var s;const a=r.find((e=>e.fieldName===t.name));if(!a)return;const n={...t,...a,loading:null===(s=null==a?void 0:a.existsInDocs)||void 0===s||s,fieldFormat:M.fieldFormats.deserialize({id:t.secondaryType}),aggregatable:!0,deletable:!1,type:Object(c.a)(t)};e.push(n)})),Fe({totalMetricFieldsCount:s.length,visibleMetricsCount:n.length}),je(e)}),[qe,ge,ue,pe,null==ee?void 0:ee.id]),Qe=Object(a.useCallback)((()=>{if(!pe||!ge)return;const e=pe.filter((e=>e.secondaryType!==u.b.NUMBER)),t=[];let s=[];const a=ge.aggregatableExistsFields||[],r=ge.nonAggregatableExistsFields||[];e.forEach((e=>{const n=a.find((t=>t.fieldName===e.name));if(void 0!==n)t.push(e),s.push(n);else{const a=r.find((t=>t.fieldName===e.name));void 0!==a&&(t.push(e),s.push(a))}})),e.length!==s.length&&!0===ue&&(s=s.concat(ge.aggregatableNotExistsFields,ge.nonAggregatableNotExistsFields));const n=[];(ue?e:t).forEach((e=>{var t;const a=s.find((t=>t.fieldName===e.name)),r={...a||{},secondaryType:Object(c.a)(e),loading:null===(t=null==a?void 0:a.existsInDocs)||void 0===t||t,deletable:!1,fieldFormat:M.fieldFormats.deserialize({id:e.secondaryType})},i=Object(c.a)(e);void 0!==i?r.type=i:(r.type=e.type,r.isUnsupportedType=!0),e.name!==r.fieldName&&(r.displayName=e.name),n.push(r)})),_e(n)}),[pe,xe,ge,ue]),Le=Object(a.useMemo)((()=>{if(!ge)return;let e=0;const t=null!=be?be:0;return e=!0===ue?t:ge.aggregatableExistsFields.length+ge.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[ge,ue,be]);Object(a.useEffect)((()=>{Me(),Qe()}),[ge,ue]);const ze=Object(a.useMemo)((()=>{let e=[...Re,...Ee];e=Object(S.a)(e,re,Ae).filteredFields;const t=null==Oe?void 0:Oe.reduce(((e,t)=>(e.set(t.fieldName,t),e)),new Map);return 100===Ie.loaded&&we&&(e=e.map((e=>{var s,a;const r=null!==(s=null!==(a=we.get(e.fieldName))&&void 0!==a?a:null==t?void 0:t.get(e.fieldName))&&void 0!==s?s:{};return r?{...e,loading:!1,stats:{...e.stats,...r}}:e}))),e}),[Re,Ee,Ae,re,Ie.loaded,t.pageIndex,t.pageSize,Oe]),Pe=Object(a.useCallback)((function(t,s){return t.reduce(((t,a)=>{const r=s.find((e=>e.fieldName===a));return void 0!==r&&(t[a]=Object(J.jsx)(h.a,{item:r,dataView:ee,esql:ae.esql,totalDocuments:fe,typeAccessor:"secondaryType",timeFieldName:Se,onAddFilter:e.onAddFilter})),t}),{})}),[ee,fe,ae.esql,Se]),De=Object(a.useMemo)((()=>0===fe?ve.loaded:.3*ve.loaded+.7*Ie.loaded),[fe,ve.loaded,Ie.loaded]),Be=Object(a.useCallback)((e=>{ye&&ye(),$e&&$e(),Te(void 0),je(X.metricConfigs),_e(X.nonMetricConfigs)}),[$e,ye]);return Object(a.useEffect)((()=>{var t;(null==K?void 0:K.esql)!==(null==e||null===(t=e.esqlQuery)||void 0===t?void 0:t.esql)&&(Be(),U(null==e?void 0:e.esqlQuery))}),[null==e||null===(C=e.esqlQuery)||void 0===C?void 0:C.esql,Be]),{totalCount:fe,progress:De,overallStatsProgress:ve,configs:ze,extendedColumns:void 0,documentCountStats:me,metricsStats:Ne,overallStats:ge,timefilter:Y,setLastRefresh:A,getItemIdToExpandedRowMap:Pe,cancelOverallStatsRequest:ye,cancelFieldStatsRequest:$e,resetData:Be,limitSize:ce,showEmptyFields:ue,fieldsCountStats:Le,timeFieldName:Se,queryHistoryStatus:he}}},231:function(e,t){class Node{constructor(e){this.value=e,this.next=void 0}}class Queue{constructor(){this.clear()}enqueue(e){const t=new Node(e);this._head?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t),this._size++}dequeue(){const e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}}e.exports=Queue},232:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(0);t.default=function(e){var t=a.useRef();return a.useEffect((function(){t.current=e})),t.current}},74:function(e,t,s){"use strict";s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return i})),s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return o}));var a=s(24),r=s(88);const n=e=>`\`${e}\``;function i(e){return Object(a.a)(e,["esql"])&&"string"==typeof e.esql}const l=Array.from(Array(r.b/r.c+1),((e,t)=>t*r.c)),o=(e,t=l)=>t.map((t=>`${n(`${e}_p${t}`)} = PERCENTILE(${n(e)}, ${t})`))},94:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return r}));const a=e=>"fulfilled"===e.status,r=e=>"rejected"===e.status}}]);