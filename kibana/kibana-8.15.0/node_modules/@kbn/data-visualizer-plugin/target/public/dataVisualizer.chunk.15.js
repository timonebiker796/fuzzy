/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[15],{115:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a(282);async function s(e,t,a){if(t){const a=await e.find(t);if(a.length>0&&a[0].getIndexPattern()===t)return a[0]}return t&&(null!=a&&a.isPersisted()||t!==(null==a?void 0:a.getIndexPattern()))?await Object(i.a)(t,e):a}},134:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));let i=function(e){return e.EsqlDataVisualizer="esql_data_visualizer",e.IndexDataVisualizer="index_data_visualizer",e.DashboardEmbeddable="dashboard_embeddable",e.DiscoverEmbeddable="discover_embeddable",e}({})},233:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a(43);function s(e){var t;const{ast:a}=Object(i.getAstAndSyntaxErrors)(e),s=a.find((({name:e})=>["from","metrics"].includes(e))),n=(null!==(t=null==s?void 0:s.args)&&void 0!==t?t:[]).filter((e=>"index"===e.sourceType));return null==n?void 0:n.map((e=>e.text)).join(",")}},234:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));const i="enableESQL"},282:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const i="esql";async function s(e){if(crypto.subtle){const t=new TextEncoder,a=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("")}{const{sha256:t}=await a.e(16).then(a.bind(null,298));return t(e)}}async function n(e,t){var a,n,r;const o=await t.create({title:e,type:i,id:await s(`esql-${e}`)});return e&&"date"===(null==o||null===(a=o.fields)||void 0===a||null===(n=a.getByName)||void 0===n||null===(r=n.call(a,"@timestamp"))||void 0===r?void 0:r.type)&&(o.timeFieldName="@timestamp"),o}},301:function(e,t,a){"use strict";a.r(t),a.d(t,"FileDataVisualizer",(function(){return i.FileDataVisualizer})),a.d(t,"IndexDataVisualizer",(function(){return oe})),a.d(t,"DataDrift",(function(){return ce.a}));var i=a(47),s=(a(149),a(5)),n=a(0),r=a.n(n),o=a(12),c=a(3),l=a(7),d=a(4),u=a(50),b=a(28),j=a(78),m=a(71),O=a.n(m),S=a(69),x=a.n(S),h=a(10),g=a(33),v=a(79),f=a(82),p=a(75),E=a(1);const w=({theme:{theme$:e},euiTheme:t,children:a,...i})=>{const s=x()(e,p.a),r=Object(n.useMemo)((()=>Object(p.b)(s)),[s]);return Object(E.jsx)(h.EuiThemeProvider,O()({colorMode:r,theme:t},i),a)},z=({theme:e,children:t,...a})=>Object(g.useIsNestedEuiProvider)()?Object(E.jsx)(w,O()({theme:e},a),t):(Object(v.emitEuiProviderWarning)("KibanaThemeProvider requires a parent KibanaRenderContextProvider.  Check your React tree and ensure that they are wrapped in a KibanaRenderContextProvider."),Object(E.jsx)(f.a,{theme:e,globalStyles:!1},t));var y=a(109),I=a(23),V=a(91),C=a(27),P=a(63),L=a(234),F=a(25),q=a(9),k=a(142),D=a(302),M=a(295),T=a(52),R=a(233),_=a(115),A=a(77),Q=a(72),N=a(65),B=a(183),G=a(108),H=a(187);const K=[{"data-test-subj":"dvESQLLimitSize-5000",value:"5000",text:d.i18n.translate("xpack.dataVisualizer.searchPanel.esql.limitSizeOptionLabel",{defaultMessage:"{limit} rows",values:{limit:"5,000"}})},{"data-test-subj":"dvESQLLimitSize-10000",value:"10000",text:d.i18n.translate("xpack.dataVisualizer.searchPanel.esql.limitSizeOptionLabel",{defaultMessage:"{limit} rows",values:{limit:"10,000"}})},{"data-test-subj":"dvESQLLimitSize-100000",value:"100000",text:d.i18n.translate("xpack.dataVisualizer.searchPanel.esql.limitSizeOptionLabel",{defaultMessage:"{limit} rows",values:{limit:"100,000"}})}],U=({limitSize:e,onChangeLimitSize:t})=>{const a=Object(h.useGeneratedHtmlId)({prefix:"dvESQLLimit"});return Object(E.jsx)(h.EuiSelect,{"data-test-subj":"dvESQLLimitSizeSelect",id:a,options:K,value:e,onChange:e=>{t(e.target.value)},"aria-label":d.i18n.translate("xpack.dataVisualizer.searchPanel.esql.limitSizeAriaLabel",{defaultMessage:"Limit size"}),prepend:Object(E.jsx)(h.EuiText,{textAlign:"center"},Object(E.jsx)(F.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.esql.limitSizeLabel",defaultMessage:"Limit analysis to"}))})};var $=a(182),W=a(74),J=a(134);const X={esql:""},Y=()=>!0,Z=e=>{var t;const{services:a}=Object(N.a)(),{data:i}=a,s=Object(A.a)(),[o,c]=Object(n.useState)(X),[l,d]=Object(n.useState)(X),[u,b]=Object(n.useState)(),j=Object(n.useMemo)((()=>Object($.a)({})),[]),[m,O]=Object(P.e)(Q.a,j),S=Object(n.useMemo)((()=>{let e="";if(Object(W.d)(l)&&(e=Object(R.a)(l.esql)),""!==e)return e}),[null==l?void 0:l.esql]);Object(n.useEffect)((function(){let e=!1;return e||(async()=>{if(!S)return;const e=await Object(_.a)(i.dataViews,S,u);e&&(e=>{e.id!==(null==u?void 0:u.id)&&b(e)})(e)})(),()=>{e=!0}}),[S,i.dataViews,u]);const x=Object(n.useMemo)((()=>({dataView:u,query:l,savedSearch:void 0,sessionId:void 0,visibleFieldNames:void 0,allowEditDataView:!0,id:J.a.EsqlDataVisualizer,indexPattern:S,esql:!0})),[u,null==l?void 0:l.esql]),g=Object(E.css)({[Object(h.useEuiBreakpoint)(["xs","s","m","l"])]:{flexDirection:"column",alignItems:"flex-start"}},"",""),v=Object(h.useIsWithinMaxBreakpoint)("l"),{totalCount:f,progress:p,queryHistoryStatus:w,overallStatsProgress:z,configs:y,documentCountStats:I,metricsStats:V,timefilter:C,getItemIdToExpandedRowMap:L,resetData:F,limitSize:q,showEmptyFields:k,fieldsCountStats:K}=Object($.b)(x,m),Z=Object(n.useMemo)((()=>void 0!==(null==u?void 0:u.timeFieldName)),[null==u?void 0:u.timeFieldName]),ee=Object(n.useMemo)((()=>o.esql!==l.esql||void 0),[o.esql,l.esql]),te=Object(n.useCallback)((()=>{ee&&d(o)}),[ee,o.esql]),ae=Object(n.useCallback)((e=>{Object(W.d)(e)&&c(e)}),[]),ie=Object(n.useCallback)((async e=>{Object(W.d)(e)&&(F(),d(e))}),[F]);return Object(E.jsx)(h.EuiPageTemplate,{offset:0,restrictWidth:!1,bottomBorder:!1,grow:!1,"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none"},Object(E.jsx)(h.EuiPageTemplate.Section,null,Object(E.jsx)(h.EuiPageTemplate.Header,{"data-test-subj":"dataVisualizerPageHeader",css:g},Object(E.jsx)(h.EuiFlexGroup,{"data-test-subj":"dataViewTitleHeader",direction:"row",alignItems:"center",css:Object(E.css)({padding:`${s.euiSizeS} 0`,marginRight:`${s.euiSize}`},"","")}),v?Object(E.jsx)(h.EuiSpacer,{size:"m"}):null,Object(E.jsx)(h.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},Z&&u?Object(E.jsx)(h.EuiFlexItem,{grow:!1},Object(E.jsx)(D.a,{frozenDataPreference:"exclude-frozen",setFrozenDataPreference:()=>{},dataView:u,query:void 0,disabled:!1,timefilter:C})):null,Object(E.jsx)(h.EuiFlexItem,{grow:!1},Object(E.jsx)(M.a,{isAutoRefreshOnly:!Z,showRefresh:!Z,width:"full",needsUpdate:ee,onRefresh:te,isDisabled:!Z})))),Object(E.jsx)(h.EuiSpacer,{size:"m"}),Object(E.jsx)(T.TextBasedLangEditor,{query:o,onTextLangQueryChange:ae,onTextLangQuerySubmit:ie,expandCodeEditor:Y,isCodeEditorExpanded:!0,detectTimestamp:!0,hideMinimizeButton:!0,hideRunQueryText:!1,isLoading:null!=w&&w}),Object(E.jsx)(h.EuiFlexGroup,{gutterSize:"m",direction:v?"column":"row"},Object(E.jsx)(h.EuiFlexItem,null,Object(E.jsx)(h.EuiPanel,{hasShadow:!1,hasBorder:!0,grow:!1},void 0!==f&&Object(E.jsx)(r.a.Fragment,null,Object(E.jsx)(h.EuiFlexGroup,{gutterSize:"s",direction:"column"},Object(E.jsx)(B.a,{documentCountStats:I,totalCount:f,samplingProbability:1,loading:!1,showSettings:!1})),Object(E.jsx)(h.EuiSpacer,{size:"s"})),Object(E.jsx)(h.EuiFlexGroup,{direction:"row"},Object(E.jsx)(H.a,{showEmptyFields:k,toggleShowEmptyFields:()=>{O({...m,showEmptyFields:!m.showEmptyFields})},fieldsCountStats:K,metricsStats:V}),Object(E.jsx)(h.EuiFlexItem,null),Object(E.jsx)(U,{limitSize:q,onChangeLimitSize:e=>{O({...m,limitSize:e})}})),Object(E.jsx)(h.EuiSpacer,{size:"s"}),Object(E.jsx)(h.EuiProgress,{value:p,max:100,size:"xs"}),Object(E.jsx)(G.a,{items:y,pageState:m,updatePageState:O,getItemIdToExpandedRowMap:L,loading:z.isRunning,overallStatsRunning:z.isRunning,showPreviewByDefault:null===(t=m.showDistributions)||void 0===t||t,onChange:O,totalCount:f}))))))};var ee=a(15),te=a(114),ae=a(103);const ie=new u.Storage(window.localStorage),se=e=>{const t=Object(P.d)(e.urlSearchString);let a={dataViewId:t.index,searchSessionId:e.searchSessionId};if(e.savedSearchId&&(a.savedSearchId=e.savedSearchId),t){if(t._g){const{time:e,refreshInterval:i}=t._g;a.timeRange=e,a.refreshInterval=i}t._a&&t._a[Q.a]&&(a={...a,...t._a[Q.a]})}return a},ne=()=>{const{services:e}=Object(N.a)();return Object(n.useMemo)((()=>e.uiSettings.get(L.a)),[e.uiSettings])?Object(E.jsx)(P.b,null,Object(E.jsx)(Z,null)):Object(E.jsx)(h.EuiCallOut,{title:Object(E.jsx)(F.FormattedMessage,{id:"xpack.dataVisualizer.esqlNotEnabledCalloutTitle",defaultMessage:"ES|QL is not enabled"})})},re=({IndexDataVisualizerComponent:e,getAdditionalLinks:t})=>{const{services:a}=Object(N.a)(),{data:{dataViews:i,search:r},savedObjects:{client:u},notifications:{toasts:b},savedSearch:j}=a,m=Object(o.useHistory)(),{search:O}=Object(o.useLocation)(),[S,x]=Object(n.useState)(void 0),[h,g]=Object(n.useState)(null),[v,f]=Object(n.useState)(void 0);Object(n.useEffect)((()=>{const e=Object(P.d)(O);if(r.session&&r.session.enableStorage({getName:async()=>te.b,getLocatorData:async()=>({id:ee.a,initialState:se({...a,urlSearchString:O,dataViewId:null==S?void 0:S.id,savedSearchId:null==h?void 0:h.id,shouldRestoreSearchSession:!1,searchSessionId:r.session.getSessionId()}),restoreState:se({...a,urlSearchString:O,dataViewId:null==S?void 0:S.id,savedSearchId:null==h?void 0:h.id,shouldRestoreSearchSession:!0,searchSessionId:r.session.getSessionId()})})}),void 0!==e.searchSessionId&&e.searchSessionId!==v){var t;null===(t=r.session)||void 0===t||t.restore(e.searchSessionId),f(e.searchSessionId)}else{var i;const e=null===(i=r.session)||void 0===i?void 0:i.start();f(e)}return()=>{r.session.clear()}}),[r.session,O]),Object(n.useEffect)((()=>{const e=O,t=Object(c.parse)(e,{sort:!1});(async()=>{if("string"==typeof(null==t?void 0:t.savedSearchId)){const e=t.savedSearchId;try{const t=await j.get(e),a=t.searchSource.getField("index");a||b.addDanger({title:d.i18n.translate("xpack.dataVisualizer.index.dataViewErrorMessage",{defaultMessage:"Error finding data view"})}),g(t),x(a)}catch(t){b.addError(t,{title:d.i18n.translate("xpack.dataVisualizer.index.savedSearchErrorMessage",{defaultMessage:"Error retrieving saved search {savedSearchId}",values:{savedSearchId:e}})})}}if("string"==typeof(null==t?void 0:t.index)){const e=await i.get(t.index);x(e)}})()}),[u,b,i,O,r,j]);const p=Object(n.useCallback)(((e,t,a,i)=>{const n=O,r=Object(P.d)(n),o=Object(c.parse)(n,{sort:!1});if(Object.prototype.hasOwnProperty.call(r,e)||(r[e]={}),"string"==typeof t){if(Object(s.isEqual)(Object(I.a)(r,`${e}.${t}`),a))return n;r[e][t]=a}else{const a=t;Object.keys(a).forEach((t=>{r[e][t]=a[t]}))}try{const e=Object(c.stringify)(o,{sort:!1,encode:!1});if(Object.keys(r).forEach((e=>{Object(P.c)(e)?o[e]=Object(l.encode)(r[e]):o[e]=r[e]})),e!==Object(c.stringify)(o,{sort:!1,encode:!1})){const e=Object(c.stringify)(o,{sort:!1});i?m.replace({search:e}):m.push({search:e})}}catch(e){console.error("Could not save url state",e)}}),[m,O]);return Object(E.jsx)(P.a,{value:{searchString:O,setUrlState:p}},S?Object(E.jsx)(e,{currentDataView:S,currentSavedSearch:h,currentSessionId:v,getAdditionalLinks:t}):null)},oe=({getAdditionalLinks:e,showFrozenDataTierChoice:t=!0,esql:a})=>{const i=Object(q.a)(),{data:n,maps:r,embeddable:o,share:c,fileUpload:l,lens:d,dataViewFieldEditor:u,uiActions:m,charts:O,unifiedSearch:S}=Object(q.b)(),x={...i,data:n,maps:r,embeddable:o,share:c,fileUpload:l,lens:d,dataViewFieldEditor:u,uiActions:m,charts:O,unifiedSearch:S},h=Object(s.pick)(i,"analytics","i18n","theme"),g={...Object(s.pick)(x,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:C.UI_SETTINGS,showFrozenDataTierChoice:t};return Object(E.jsx)(j.a,h,Object(E.jsx)(z,{theme:i.theme,modify:{breakpoint:{xxl:1400}}},Object(E.jsx)(b.KibanaContextProvider,{services:{...x}},Object(E.jsx)(y.a,{storage:ie,storageKeys:ae.e},Object(E.jsx)(V.a,g,a?Object(E.jsx)(ne,null):Object(E.jsx)(re,{IndexDataVisualizerComponent:k.a,getAdditionalLinks:e}))))))};var ce=a(13)},91:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return o}));var i=a(0),s=a(1);const n=Object(i.createContext)(void 0),r=()=>{const e=Object(i.useContext)(n);if(void 0===e)throw new Error("datePickerContext was used outside of its Provider");return e},o=e=>{const{children:t,...a}=e;return Object(s.jsx)(n.Provider,{value:a},t)}}}]);