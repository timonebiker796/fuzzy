/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[17],{134:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));let i=function(e){return e.EsqlDataVisualizer="esql_data_visualizer",e.IndexDataVisualizer="index_data_visualizer",e.DashboardEmbeddable="dashboard_embeddable",e.DiscoverEmbeddable="discover_embeddable",e}({})},304:function(e,t,a){"use strict";a.r(t),a.d(t,"getDependencies",(function(){return R})),a.d(t,"getFieldStatsChartEmbeddableFactory",(function(){return O}));var i=a(38),n=a(59),r=a(4),s=a(181),d=a(5),o=a(0),l=a(69),u=a.n(l),c=a(8),b=a(64),p=a(220),w=a(10),g=a(1),f=a(32),E=a(282),h=a(233),y=a(60),v=a(106),S=a(14),j=a(163),m=a.n(j),V=a(74),_=a(134);const D=Object(b.a)((()=>a.e(14).then(a.bind(null,198)))),I={APPLY_FILTER_ERR:r.i18n.translate("xpack.dataVisualizer.fieldStats.errors.errorApplyingFilter",{defaultMessage:"Error applying filter"}),UPDATE_CONFIG_ERROR:r.i18n.translate("xpack.dataVisualizer.fieldStats.errors.errorUpdatingConfig",{defaultMessage:"Error updating settings for field statistics."})},R=async e=>{const[{http:t,uiSettings:a,notifications:i,...n},{lens:r,data:s,usageCollection:d,fieldFormats:o}]=await e();return{http:t,uiSettings:a,data:s,notifications:i,lens:r,usageCollection:d,fieldFormats:o,...n}};var A={name:"j6u2k8",styles:"width:100%;height:100%;overflow-y:auto"};const O=e=>({type:S.b,deserializeState:e=>{var t;const a=Object(d.cloneDeep)(e.rawState),i=null===(t=e.references)||void 0===t?void 0:t.find((e=>e.name===S.a));return i&&a&&!a.dataViewId&&(a.dataViewId=null==i?void 0:i.id),a},buildEmbeddable:async(t,d,l,b)=>{const[j,R]=await e(),{http:O,uiSettings:T,notifications:F,...C}=j,{lens:x,data:L,usageCollection:P,fieldFormats:q}=R,z={http:O,uiSettings:T,data:L,notifications:F,lens:x,usageCollection:P,fieldFormats:q,...C},{api:$,comparators:k,serialize:B}=Object(s.e)(t),{titlesApi:U,titleComparators:W,serializeTitles:Y}=Object(s.f)(t),{fieldStatsControlsApi:G,dataLoadingApi:M,fieldStatsControlsComparators:N,serializeFieldStatsChartState:Q,onFieldStatsTableDestroy:J,resetData$:H}=(e=>{var t;const a=new c.BehaviorSubject(null!==(t=e.viewType)&&void 0!==t?t:v.a.ESQL),i=new c.BehaviorSubject(e.dataViewId),n=new c.BehaviorSubject(e.query),r=new c.BehaviorSubject(e.showDistributions),s=new c.BehaviorSubject(Date.now()),d=new c.BehaviorSubject(!0),o=new c.BehaviorSubject(void 0),l={viewType:[a,e=>a.next(e)],dataViewId:[i,e=>i.next(e)],query:[n,e=>n.next(e),m.a],showDistributions:[r,e=>r.next(e)]};return{fieldStatsControlsApi:{viewType$:a,dataViewId$:i,query$:n,updateUserInput:(e,t=!1)=>{t&&s.next(Date.now()),a.next(e.viewType),i.next(e.dataViewId),n.next(e.query)},showDistributions$:r},dataLoadingApi:{dataLoading:d,onRenderComplete:()=>d.next(!1),onLoading:e=>d.next(e),onError:e=>o.next(e),blockingError:o},resetData$:s,serializeFieldStatsChartState:()=>({viewType:a.getValue(),dataViewId:i.getValue(),query:n.getValue(),showDistributions:r.getValue()}),fieldStatsControlsComparators:l,onFieldStatsTableDestroy:()=>{a.complete(),i.complete(),n.complete(),s.complete()}}})(t),{onError:K,dataLoading:X,blockingError:Z}=M,ee=await z.data.dataViews.getDefaultId(),te=Object(p.a)(t.dataViewId)&&""!==t.dataViewId?t.dataViewId:null!=ee?ee:"";let ae;try{ae=[Object(V.d)(t.query)?await Object(E.a)(Object(h.a)(t.query.esql),z.data.dataViews):await z.data.dataViews.get(te)]}catch(e){t.viewType===v.a.DATA_VIEW&&K(e)}const ie=new c.BehaviorSubject(ae),ne=new c.Subscription;G.dataViewId$&&ne.add(G.dataViewId$.pipe(Object(c.skip)(1),Object(c.skipWhile)((e=>!e&&!ee)),Object(c.switchMap)((async e=>{try{return await z.data.dataViews.get(null!=e?e:ee)}catch(e){return}}))).subscribe((e=>{e&&ie.next([e])})));const{toasts:re}=z.notifications,se=d({...$,...U,...G,dataLoading:X,blockingError:Z,getTypeDisplayName:()=>r.i18n.translate("xpack.dataVisualizer.fieldStats.typeDisplayName",{defaultMessage:"field statistics"}),isEditingEnabled:()=>!0,onEdit:async()=>{try{const{resolveEmbeddableFieldStatsUserInput:e}=await Promise.all([a.e(6),a.e(19)]).then(a.bind(null,300)),t=Q(),i=await e(j,R,b,l,!1,t,G);G.updateUserInput(i)}catch(e){re.addError(e,{title:I.UPDATE_CONFIG_ERROR})}},dataViews:ie,serializeState:()=>{var e;const t=null===(e=G.dataViewId$)||void 0===e?void 0:e.getValue(),a=t?[{type:n.DATA_VIEW_SAVED_OBJECT_TYPE,name:S.a,id:t}]:[];return{rawState:{...Y(),...B(),...Q()},references:a}}},{...k,...W,...N}),de=Object(s.d)(se).pipe(Object(c.skipWhile)((e=>!e.isReload)),Object(c.map)((()=>Date.now()))),oe=H.pipe(Object(c.skip)(1),Object(c.distinctUntilChanged)()),le=e=>{Object(p.a)(null==e?void 0:e.showDistributions)&&G.showDistributions$.next(e.showDistributions)},ue=A;return{api:se,Component:()=>{Object(s.a)(b)||K(new Error("Parent API does not have execution context"));const{filters:e,query:t,timeRange:a}=Object(s.h)(se),[n,r,d,l]=Object(s.g)(se.dataViews,se.query$,se.viewType$,se.showDistributions$),c=u()(de,Date.now()),p=d===v.a.ESQL,E=Array.isArray(n)&&n.length>0?n[0]:void 0;return Object(o.useEffect)((()=>()=>{null==ne||ne.unsubscribe(),J()}),[]),Object(g.jsx)(w.EuiFlexItem,{css:ue,"data-test-subj":"dashboardFieldStatsEmbeddedContent"},Object(g.jsx)(D,{id:_.a.DashboardEmbeddable,shouldGetSubfields:!1,dataView:E,esqlQuery:r,query:t,filters:e,lastReloadRequestTime:c,isEsqlMode:p,onTableUpdate:le,showPreviewByDefault:l,onAddFilter:(e,t,a)=>{if(!E||!R.data)return void re.addWarning(I.APPLY_FILTER_ERR);let n=Object(i.generateFilters)(R.data.query.filterManager,e,t,a,E);n=n.map((e=>({...e,$state:{store:f.FilterStateStore.APP_STATE}}))),((e,t=y.ACTION_GLOBAL_APPLY_FILTER)=>{if(!R.uiActions)return void re.addWarning(I.APPLY_FILTER_ERR);const a=R.uiActions.getTrigger(i.APPLY_FILTER_TRIGGER);if(!a)return void re.addWarning(I.APPLY_FILTER_ERR);const n={embeddable:se,trigger:a,filters:e};try{R.uiActions.getAction(t).execute(n)}catch(e){re.addWarning(I.APPLY_FILTER_ERR)}})(n)},resetData$:oe,timeRange:a,onRenderComplete:M.onRenderComplete}))}}}})}}]);