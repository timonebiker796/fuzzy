(window.unifiedHistogram_bundle_jsonpfunction=window.unifiedHistogram_bundle_jsonpfunction||[]).push([[2],{34:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return s}));let n=function(e){return e.Single="single",e.Static="static",e.Resizable="resizable",e}({}),s=function(e){return e.Horizontal="horizontal",e.Vertical="vertical",e}({})},35:function(e,t,i){e.exports=i(11)(2)},37:function(e,t,i){"use strict";e.exports=i(46)},38:function(e,t,i){"use strict";e.exports=i(53)},39:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(20),s=i(2),a=n.__importDefault(i(54));t.default=function(e,t){var i=s.useState(t),n=i[0],r=i[1];return a.default((function(){var t=e.subscribe(r);return function(){return t.unsubscribe()}}),[e]),n}},43:function(e,t,i){"use strict";e.exports=i(44)},44:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(45);i(19),i(37),i(38);var s=n.default({key:"css"}),a=s.flush,r=s.hydrate,o=s.cx,l=s.merge,u=s.getRegisteredStyles,c=s.injectGlobal,d=s.keyframes,g=s.css,m=s.sheet,b=s.cache;t.cache=b,t.css=g,t.cx=o,t.flush=a,t.getRegisteredStyles=u,t.hydrate=r,t.injectGlobal=c,t.keyframes=d,t.merge=l,t.sheet=m},45:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(19),s=i(37),a=i(38);function r(e){return e&&e.__esModule?e:{default:e}}var o=r(n);function l(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function u(e,t,i){var n=[],s=a.getRegisteredStyles(e,n,i);return n.length<2?i:s+t(n)}var c=function e(t){for(var i="",n=0;n<t.length;n++){var s=t[n];if(null!=s){var a=void 0;switch(typeof s){case"boolean":break;case"object":if(Array.isArray(s))a=e(s);else for(var r in a="",s)s[r]&&r&&(a&&(a+=" "),a+=r);break;default:a=s}a&&(i&&(i+=" "),i+=a)}}return i};t.default=function(e){var t=o.default(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var i=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=s.serializeStyles(i,t.registered,void 0);return a.insertStyles(t,r,!1),t.key+"-"+r.name};return{css:i,cx:function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return u(t.registered,i,c(n))},injectGlobal:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var a=s.serializeStyles(i,t.registered);l(t,a)},keyframes:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var a=s.serializeStyles(i,t.registered),r="animation-"+a.name;return l(t,{name:a.name,styles:"@keyframes "+r+"{"+a.styles+"}"}),r},hydrate:function(e){e.forEach((function(e){t.inserted[e]=!0}))},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:a.getRegisteredStyles.bind(null,t.registered),merge:u.bind(null,t.registered,i)}}},46:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(47),s=i(49),a=i(51);function r(e){return e&&e.__esModule?e:{default:e}}var o=r(n),l=r(s),u=/[A-Z]|^ms/g,c=/_EMO_([^_]+?)_([^]*?)_EMO_/g,d=function(e){return 45===e.charCodeAt(1)},g=function(e){return null!=e&&"boolean"!=typeof e},m=r(a).default((function(e){return d(e)?e:e.replace(u,"-$&").toLowerCase()})),b=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(c,(function(e,t,i){return h={name:t,styles:i,next:h},t}))}return 1===l.default[e]||d(e)||"number"!=typeof t||0===t?t:t+"px"};function f(e,t,i){if(null==i)return"";if(void 0!==i.__emotion_styles)return i;switch(typeof i){case"boolean":return"";case"object":if(1===i.anim)return h={name:i.name,styles:i.styles,next:h},i.name;if(void 0!==i.styles){var n=i.next;if(void 0!==n)for(;void 0!==n;)h={name:n.name,styles:n.styles,next:h},n=n.next;return i.styles+";"}return function(e,t,i){var n="";if(Array.isArray(i))for(var s=0;s<i.length;s++)n+=f(e,t,i[s])+";";else for(var a in i){var r=i[a];if("object"!=typeof r)null!=t&&void 0!==t[r]?n+=a+"{"+t[r]+"}":g(r)&&(n+=m(a)+":"+b(a,r)+";");else if(!Array.isArray(r)||"string"!=typeof r[0]||null!=t&&void 0!==t[r[0]]){var o=f(e,t,r);switch(a){case"animation":case"animationName":n+=m(a)+":"+o+";";break;default:n+=a+"{"+o+"}"}}else for(var l=0;l<r.length;l++)g(r[l])&&(n+=m(a)+":"+b(a,r[l])+";")}return n}(e,t,i);case"function":if(void 0!==e){var s=h,a=i(e);return h=s,f(e,t,a)}}if(null==t)return i;var r=t[i];return void 0!==r?r:i}var h,v=/label:\s*([^\s;\n{]+)\s*(;|$)/g;t.serializeStyles=function(e,t,i){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n=!0,s="";h=void 0;var a=e[0];null==a||void 0===a.raw?(n=!1,s+=f(i,t,a)):s+=a[0];for(var r=1;r<e.length;r++)s+=f(i,t,e[r]),n&&(s+=a[r]);v.lastIndex=0;for(var l,u="";null!==(l=v.exec(s));)u+="-"+l[1];return{name:o.default(s)+u,styles:s,next:h}}},47:function(e,t,i){"use strict";e.exports=i(48)},48:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t,i=0,n=0,s=e.length;s>=4;++n,s-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),i=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&i)+(59797*(i>>>16)<<16);switch(s){case 3:i^=(255&e.charCodeAt(n+2))<<16;case 2:i^=(255&e.charCodeAt(n+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(n)))+(59797*(i>>>16)<<16)}return(((i=1540483477*(65535&(i^=i>>>13))+(59797*(i>>>16)<<16))^i>>>15)>>>0).toString(36)}},49:function(e,t,i){"use strict";e.exports=i(50)},50:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1}},51:function(e,t,i){"use strict";e.exports=i(52)},52:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=Object.create(null);return function(i){return void 0===t[i]&&(t[i]=e(i)),t[i]}}},53:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof document,s=function(e,t,i){var s=e.key+"-"+t.name;(!1===i||!1===n&&void 0!==e.compat)&&void 0===e.registered[s]&&(e.registered[s]=t.styles)};t.getRegisteredStyles=function(e,t,i){var n="";return i.split(" ").forEach((function(i){void 0!==e[i]?t.push(e[i]+";"):n+=i+" "})),n},t.insertStyles=function(e,t,i){s(e,t,i);var a=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r="",o=t;do{var l=e.insert(t===o?"."+a:"",o,e.sheet,!0);n||void 0===l||(r+=l),o=o.next}while(void 0!==o);if(!n&&0!==r.length)return r}},t.registerStyles=s},54:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),s="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;t.default=s},55:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(20).__importDefault(i(56));t.default=function(e){n.default((function(){e()}))}},56:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2);t.default=function(e){n.useEffect(e,[])}},62:function(e,t,i){"use strict";i.r(t),i.d(t,"UnifiedHistogramContainer",(function(){return we}));var n,s=i(7),a=i.n(s),r=i(2),o=i.n(r),l=i(17),u=i(5),c=i(55),d=i.n(c),g=i(1),m=i(39),b=i.n(m),f=i(25),h=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},n(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),v="html",p="svg",y=function(e,t){var i,n,s,a={};if(e===v)s=document.createElement("div");else{if(e!==p)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');s=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"==typeof t)for(var r=0,o=Object.entries(t.attributes);r<o.length;r++){var l=o[r],u=l[0],c=l[1];s.setAttribute(u,c)}var d={element:s,elementType:e,setPortalProps:function(e){a=e},getInitialPortalProps:function(){return a},mount:function(t,s){if(s!==n){if(d.unmount(),t!==i&&!function(e,t){if(t===v)return e instanceof HTMLElement;if(t===p)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(d.element,s),i=t,n=s}},unmount:function(e){e&&e!==n||i&&n&&(i.replaceChild(n,d.element),i=void 0,n=void 0)}};return d},j=function(e){function t(t){var i=e.call(this,t)||this;return i.addPropsChannel=function(){Object.assign(i.props.node,{setPortalProps:function(e){i.setState({nodeProps:e})}})},i.state={nodeProps:i.props.node.getInitialPortalProps()},i}return h(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,i=t.children,n=t.node;return f.createPortal(r.Children.map(i,(function(t){return r.isValidElement(t)?r.cloneElement(t,e.state.nodeProps):t})),n.element)},t}(r.PureComponent),C=function(e){function t(t){var i=e.call(this,t)||this;return i.placeholderNode=r.createRef(),i.passPropsThroughPortal(),i}return h(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,i=t.parentNode;e.mount(i,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,i=t.parentNode;e.mount(i,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return r.createElement("div",{ref:this.placeholderNode})},t}(r.PureComponent),O=y.bind(null,v),x=(y.bind(null,p),i(43)),S=i(34),w=i(33);const T=Object(w.a)(Object(r.lazy)((()=>i.e(4).then(i.bind(null,64)))));var R=i(0);const P=({buttons:e,legend:t,buttonSize:i="m","data-test-subj":n})=>{const s=(({euiTheme:e})=>({button:{"&.euiButtonGroupButton":{backgroundColor:e.colors.emptyShade,border:`${e.border.thin} !important`,borderRight:"none !important","&:first-of-type":{borderTopLeftRadius:`${e.border.radius.medium} !important`,borderBottomLeftRadius:`${e.border.radius.medium} !important`},"&:last-of-type":{borderRight:`${e.border.thin} !important`,borderTopRightRadius:`${e.border.radius.medium} !important`,borderBottomRightRadius:`${e.border.radius.medium} !important`},":not(:first-child):not(.euiButtonGroupButton-isSelected):not(:disabled)":{boxShadow:"unset"}}},buttonGroup:{".euiButtonGroup__buttons":{borderRadius:`${e.border.radius.medium}`}}}))(Object(g.useEuiTheme)()),a=e.map(((e,t)=>{const{label:i,title:n=i,...a}=e;return{...a,"aria-label":null!=n?n:i,id:`${Object(g.htmlIdGenerator)()()}${t}`,label:i,title:n,css:[s.button]}}));return Object(R.jsx)(g.EuiButtonGroup,{"data-test-subj":n,buttonSize:i,legend:t,options:a,onChange:e=>{var t;null===(t=a.find((t=>t.id===e)))||void 0===t||t.onClick()},type:"multi",isIconOnly:!0,css:s.buttonGroup})};var I=i(16),q=i(26),E=i(4),k=i(18),A=i(27),H=i.n(A),V={name:"y6n6nb",styles:"flex-grow:0"};const F=e=>{const t=Object(r.useRef)(e);return Object(r.useEffect)((()=>{t.current=e}),[e]),Object(r.useRef)(((...e)=>{var i;return null===(i=t.current)||void 0===i?void 0:i.call(t,...e)})).current};var _=i(28);const $=({searchSessionId:e,getTimeRange:t,attributes:i,onLoad:n})=>({id:"unifiedHistogramLensComponent",viewMode:_.ViewMode.VIEW,timeRange:t(),attributes:i,noPadding:!0,searchSessionId:e,executionContext:{description:"fetch chart data and total hits"},onLoad:n});function L({services:{data:e,lens:t,uiSettings:i},dataView:n,request:s,hits:l,chart:{timeInterval:u},isPlainRecord:c,hasLensSuggestions:d,getTimeRange:m,refetch$:b,visContext:f,disableTriggers:h,disabledActions:v,onTotalHitsChange:p,onChartLoad:y,onFilter:j,onBrushEnd:C,withDefaultActions:O,abortController:x}){const[S,w]=Object(r.useState)(),[T,P]=Object(r.useState)("100%"),{timeRangeText:A,timeRangeDisplay:_}=(({uiSettings:e,bucketInterval:t,timeRange:{from:i,to:n},timeInterval:s,isPlainRecord:a,timeField:o})=>{const l=Object(r.useMemo)((()=>e.get("dateFormat")),[e]),u=Object(r.useCallback)((e=>e?l?e.format(l):String(e):""),[l]),c=Object(r.useMemo)((()=>{var e;if(!o&&a)return"";const r={from:H.a.parse(i),to:H.a.parse(n,{roundUp:!0})},l=Boolean(a)?"":I.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalDescription",{defaultMessage:"(interval: {value})",values:{value:`${"auto"===s?`${I.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalAuto",{defaultMessage:"Auto"})} - `:""}${null!==(e=null==t?void 0:t.description)&&void 0!==e?e:I.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalLoading",{defaultMessage:"Loading"})}`}});return`${u(r.from)} - ${u(r.to)} ${l}`.trim()}),[null==t?void 0:t.description,i,a,o,s,n,u]),{euiTheme:d}=Object(g.useEuiTheme)(),m=Object(R.css)("padding:0 ",d.size.s," 0 ",d.size.s,";","");let b=c?Object(R.jsx)(g.EuiText,{size:"xs",textAlign:"center",css:m},c):null;if(null!=t&&t.scaled){const e=I.i18n.translate("unifiedHistogram.timeIntervalWithValueWarning",{defaultMessage:"Warning"}),i=I.i18n.translate("unifiedHistogram.bucketIntervalTooltip",{defaultMessage:"This interval creates {bucketsDescription} to show in the selected time range, so it has been scaled to {bucketIntervalDescription}.",values:{bucketsDescription:t.scale&&t.scale>1?I.i18n.translate("unifiedHistogram.bucketIntervalTooltip.tooLargeBucketsText",{defaultMessage:"buckets that are too large"}):I.i18n.translate("unifiedHistogram.bucketIntervalTooltip.tooManyBucketsText",{defaultMessage:"too many buckets"}),bucketIntervalDescription:t.description}}),n=V;b=Object(R.jsx)(g.EuiFlexGroup,{alignItems:"baseline",justifyContent:"center",gutterSize:"none",responsive:!1,css:n},Object(R.jsx)(g.EuiFlexItem,{grow:!1},b),Object(R.jsx)(g.EuiFlexItem,{grow:!1},Object(R.jsx)(g.EuiIconTip,{type:"warning",color:"warning",title:e,content:i})))}return{timeRangeText:c,timeRangeDisplay:b}})({uiSettings:i,bucketInterval:S,timeRange:m(),timeInterval:u,isPlainRecord:c,timeField:n.timeFieldName}),L=Object(r.useRef)(null),{height:M,width:z}=Object(g.useResizeObserver)(L.current),{attributes:B}=f;Object(r.useEffect)((()=>{"lnsMetric"===B.visualizationType?P(`${M<z?M:z}px`):P("100%")}),[B,M,z]);const D=F(((t,i,s)=>{var a,r,o;const g=null==i||null===(a=i.requests)||void 0===a?void 0:a.getRequests()[0],b=(null==g?void 0:g.status)===q.RequestStatus.ERROR,f=null==g||null===(r=g.response)||void 0===r?void 0:r.json,h=null==f?void 0:f.rawResponse;if(b)return null==p||p(E.b.error,void 0),void(null==y||y({adapters:null!=i?i:{}}));const v=null==i||null===(o=i.tables)||void 0===o?void 0:o.tables,j=((e,t,i)=>{var n,s,a,r,o,l;if(i&&e)return null===(n=Object.values(null!=t?t:{}))||void 0===n||null===(s=n[0])||void 0===s||null===(a=s.rows)||void 0===a?void 0:a.length;if(i&&!e){var u,c;const e=null===(u=Object.values(null!=t?t:{}))||void 0===u||null===(c=u[0])||void 0===c?void 0:c.rows;if(!e)return;let i=0;return e.forEach((e=>{i+=e.results})),i}return null==t||null===(r=t.unifiedHistogram)||void 0===r||null===(o=r.meta)||void 0===o||null===(l=o.statistics)||void 0===l?void 0:l.totalCount})(d,v,c);if(null==p||p(t?E.b.loading:E.b.complete,null!=j?j:null==l?void 0:l.total),h){const t=(({data:e,dataView:t,timeInterval:i,timeRange:n,response:s})=>{var a;if(!i||!s)return{};const r=function({dataView:e,timeInterval:t,timeRange:i,data:n}){const s=[{type:"count",schema:"metric"},{type:"date_histogram",schema:"segment",params:{field:e.timeFieldName,interval:t,timeRange:i}}];return n.search.aggs.createAggConfigs(e,s)}({dataView:t,timeInterval:i,timeRange:n,data:e}),o=r.aggs[1];return Object(k.tabifyAggResponse)(r,s),k.search.aggs.isDateHistogramBucketAggConfig(o)?null==o||null===(a=o.buckets)||void 0===a?void 0:a.getInterval():void 0})({data:e,dataView:n,timeInterval:u,timeRange:m(),response:h});w(t)}null==y||y({adapters:null!=i?i:{},embeddableOutput$:s})})),{lensProps:N,requestData:G}=(({request:e,getTimeRange:t,refetch$:i,visContext:n,onLoad:s})=>{const a=Object(r.useCallback)((()=>{const{attributes:i,requestData:a}=n;return{requestData:JSON.stringify(a),lensProps:$({searchSessionId:null==e?void 0:e.searchSessionId,getTimeRange:t,attributes:i,onLoad:s})}}),[n,t,s,null==e?void 0:e.searchSessionId]),[o,l]=Object(r.useState)(a()),u=F((()=>l(a())));return Object(r.useEffect)((()=>{const e=i.subscribe(u);return()=>e.unsubscribe()}),[i,u]),o})({request:s,getTimeRange:m,refetch$:b,visContext:f,onLoad:D}),{euiTheme:U}=Object(g.useEuiTheme)(),Q=`0 2px 2px -1px ${U.colors.mediumShade},\n  0 1px 5px -2px ${U.colors.mediumShade}`,W=Object(R.css)("position:relative;flex-grow:1;margin-block:",U.size.xs,";&>div{height:100%;position:absolute;width:100%;}& .lnsExpressionRenderer{width:",T,";margin:auto;box-shadow:","lnsMetric"===B.visualizationType?Q:"none",";}& .echLegend .echLegendList{padding-right:",U.size.s,";}&>.euiLoadingChart{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);}","");return Object(R.jsx)(o.a.Fragment,null,Object(R.jsx)("div",{"data-test-subj":"unifiedHistogramChart","data-time-range":A,"data-request-data":G,"data-suggestion-type":f.suggestionType,css:W,ref:L},Object(R.jsx)(t.EmbeddableComponent,a()({},N,{abortController:x,disableTriggers:h,disabledActions:v,onFilter:j,onBrushEnd:C,withDefaultActions:O}))),_)}var M=i(57),z=i(40);const B=({chart:e,onTimeIntervalChange:t})=>{const i=Object(r.useCallback)((e=>{const i=null==e?void 0:e.value;i&&t(i)}),[t]),n=k.search.aggs.intervalOptions.findIndex((t=>t.val===e.timeInterval)),s=n>-1?k.search.aggs.intervalOptions[n].display:k.search.aggs.intervalOptions[0].display,a=k.search.aggs.intervalOptions.filter((({val:e})=>"custom"!==e)).map((({display:t,val:i})=>({key:i,value:i,label:t,checked:i===e.timeInterval?"on":void 0})));return Object(R.jsx)(z.b,{"data-test-subj":"unifiedHistogramTimeIntervalSelector","data-selected-value":e.timeInterval,searchable:!1,buttonLabel:"auto"!==e.timeInterval?I.i18n.translate("unifiedHistogram.timeIntervalSelector.buttonLabel",{defaultMessage:"Interval: {timeInterval}",values:{timeInterval:s.toLowerCase()}}):I.i18n.translate("unifiedHistogram.timeIntervalSelector.autoIntervalButtonLabel",{defaultMessage:"Auto interval"}),popoverTitle:I.i18n.translate("unifiedHistogram.timeIntervalSelector.timeIntervalPopoverTitle",{defaultMessage:"Select time interval"}),options:a,onChange:i})};var D=i(29);const N=async({services:{data:e},abortController:t,dataView:i,request:n,filters:s,query:a,timeRange:r})=>{const o=e.search.searchSource.createEmpty();o.setField("index",i).setField("query",a).setField("size",0).setField("trackTotalHits",!0);let u=s;if(i.type===D.DataViewType.ROLLUP)o.setOverwriteDataViewType(void 0);else{const t=e.query.timefilter.timefilter.createFilter(i,r);t&&(u=[...u,t])}o.setField("filter",u);const c=null!=n&&n.adapter?{adapter:n.adapter,title:I.i18n.translate("unifiedHistogram.inspectorRequestDataTitleTotalHits",{defaultMessage:"Total hits"}),description:I.i18n.translate("unifiedHistogram.inspectorRequestDescriptionTotalHits",{defaultMessage:"This request queries Elasticsearch to fetch the total hits."})}:void 0,d=o.fetch$({inspector:c,sessionId:null==n?void 0:n.searchSessionId,abortSignal:t.signal,executionContext:{description:"fetch total hits"},disableWarningToasts:!0}).pipe(Object(l.filter)((e=>!Object(k.isRunningResponse)(e))),Object(l.map)((e=>e.rawResponse.hits.total)),Object(l.catchError)((e=>Object(l.of)(e)))),g=await Object(l.lastValueFrom)(d);return{resultStatus:g instanceof Error?E.b.error:E.b.complete,result:g}};var G={name:"x4odxv",styles:"flex-grow:1;display:flex;flex-direction:column;position:relative;.series>rect{fill-opacity:0.5;stroke-width:1;}"},U=i(8);function Q({services:e,visContext:t,lensAdapters:i,lensEmbeddableOutput$:n,currentSuggestionContext:s,isFlyoutVisible:a,setIsFlyoutVisible:o,isPlainRecord:l,query:c,onSuggestionContextEdit:d}){const[g,m]=Object(r.useState)(null),b=Object(r.useRef)(void 0),f=Object(r.useRef)(void 0),h=Object(r.useRef)(void 0),v=Object(r.useCallback)(((e,t,i)=>{var n;const a={...null==s?void 0:s.suggestion,visualizationId:null!=i?i:null==s||null===(n=s.suggestion)||void 0===n?void 0:n.visualizationId,...e&&{datasourceState:e},...t&&{visualizationState:t}};d({...s,suggestion:a})}),[s,d]),p=Object(r.useCallback)((e=>{const i=Object(U.b)({externalVisContext:{...t,attributes:e},queryParams:null});d({type:E.c.lensSuggestion,suggestion:i})}),[d,t]),y=s.suggestion,j=s.type;return Object(r.useEffect)((()=>{var s,r;const d=null==i||null===(s=i.tables)||void 0===s?void 0:s.tables,g=Boolean(d)&&!Object(u.isEqual)(f.current,d)&&c!==(null==h?void 0:h.current),C=(null==y?void 0:y.title)!==(null==b||null===(r=b.current)||void 0===r?void 0:r.title);l&&(g||C||!a)&&async function(){const s=await e.lens.EditLensConfigPanelApi(),a=Object(R.jsx)(s,{attributes:t.attributes,updateSuggestion:p,updatePanelState:v,lensAdapters:i,output$:n,displayFlyoutHeader:!0,closeFlyout:()=>{o(!1)},wrapInFlyout:!0,datasourceId:"textBased",hidesSuggestions:j!==E.c.lensSuggestion});m(a),b.current=y,f.current=d,g&&(h.current=c)}()}),[t.attributes,e.lens,v,p,l,y,c,a,o,i,n,j]),l?g:null}var W=i(10);const X=Object(r.memo)(L);var Y={name:"ovk77c",styles:"min-width:0"},Z={name:"ovk77c",styles:"min-width:0"},J={name:"ovk77c",styles:"min-width:0"};function K({isChartAvailable:e,className:t,services:i,dataView:n,requestParams:s,relativeTimeRange:o,request:c,hits:d,chart:m,breakdown:f,lensVisService:h,isPlainRecord:v,renderCustomChartToggleActions:p,appendHistogram:y,disableAutoFetching:j,disableTriggers:C,disabledActions:O,input$:x,lensAdapters:S,lensEmbeddableOutput$:w,isChartLoading:T,onChartHiddenChange:q,onTimeIntervalChange:k,onBreakdownFieldChange:A,onTotalHitsChange:H,onChartLoad:V,onFilter:_,onBrushEnd:$,withDefaultActions:L,abortController:z}){var D;const U=b()(h.currentSuggestionContext$),K=b()(h.visContext$),ee=null==U?void 0:U.suggestion,[te,ie]=Object(r.useState)(!1),[ne,se]=Object(r.useState)(!1),{chartRef:ae,toggleHideChart:re}=(({chart:e,onChartHiddenChange:t})=>{const i=Object(r.useRef)({element:null,moveFocus:!1});Object(r.useEffect)((()=>{i.current.moveFocus&&i.current.element&&i.current.element.focus()}),[null==e?void 0:e.hidden]);const n=Object(r.useCallback)((()=>{const n=!(null!=e&&e.hidden);i.current.moveFocus=!n,null==t||t(n)}),[null==e?void 0:e.hidden,t]);return{chartRef:i,toggleHideChart:n}})({chart:m,onChartHiddenChange:q}),oe=e&&!!m&&!m.hidden&&!!K&&!(null==K||!K.attributes),le=Object(r.useMemo)((()=>null!=x?x:new l.Subject),[x]),{filters:ue,query:ce,getTimeRange:de,updateTimeRange:ge,relativeTimeRange:me}=s,be=(({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:o,query:c,relativeTimeRange:d,currentSuggestion:g,disableAutoFetching:m,input$:b,beforeRefetch:f})=>{const h=Object(r.useRef)();return Object(r.useEffect)((()=>{if(m)return;const r=(({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:r,query:o,relativeTimeRange:l,currentSuggestion:c})=>Object(u.cloneDeep)([e.id,null==t?void 0:t.searchSessionId,Boolean(i),s,null==n?void 0:n.timeInterval,Boolean(a),null==a?void 0:a.field,r,o,l,null==c?void 0:c.visualizationId]))({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:o,query:c,relativeTimeRange:d,currentSuggestion:g});Object(u.isEqual)(h.current,r)||(h.current&&b.next({type:"refetch"}),h.current=r)}),[a,n,s,g,e,m,o,i,b,c,d,t]),Object(r.useMemo)((()=>b.pipe(Object(l.filter)((e=>"refetch"===e.type)),Object(l.tap)(f),Object(l.share)())),[f,b])})({dataView:n,request:c,hits:d,chart:m,chartVisible:oe,breakdown:f,filters:ue,query:ce,relativeTimeRange:me,currentSuggestion:ee,disableAutoFetching:j,input$:le,beforeRefetch:ge});(({services:e,dataView:t,request:i,hits:n,chartVisible:s,filters:a,query:o,getTimeRange:l,refetch$:u,onTotalHitsChange:c,isPlainRecord:d})=>{const g=Object(r.useRef)(),m=F((()=>{(async({services:e,abortController:t,dataView:i,request:n,hits:s,chartVisible:a,filters:r,query:o,timeRange:l,onTotalHitsChange:u,isPlainRecord:c})=>{var d;if(c)return;if(null===(d=t.current)||void 0===d||d.abort(),t.current=void 0,a)return;null==u||u(E.b.loading,null==s?void 0:s.total);const g=new AbortController;t.current=g;const m=await N({services:e,abortController:g,dataView:i,request:n,filters:r,query:o,timeRange:l});m&&(null==u||u(m.resultStatus,m.result))})({services:e,abortController:g,dataView:t,request:i,hits:n,chartVisible:s,filters:a,query:o,timeRange:l(),onTotalHitsChange:c,isPlainRecord:d})}));Object(r.useEffect)((()=>{const e=u.subscribe(m);return()=>e.unsubscribe()}),[m,u])})({services:i,dataView:n,request:c,hits:d,chartVisible:oe,filters:ue,query:ce,getTimeRange:de,refetch$:be,onTotalHitsChange:H,isPlainRecord:v});const{chartToolbarCss:fe,histogramCss:he}=(e=>{const{euiTheme:t}=Object(g.useEuiTheme)();return{chartToolbarCss:Object(R.css)("padding:",t.size.s," ",t.size.s," ",e?0:t.size.s," ",t.size.s,";min-height:",2.5*t.base,"px;",""),histogramCss:G}})(oe),ve=Object(r.useCallback)((e=>{h.onSuggestionEdited({editedSuggestionContext:e})}),[h]);Object(r.useEffect)((()=>{!oe&&ne&&se(!1)}),[oe,ne]);const pe=(({services:e,dataView:t,relativeTimeRange:i,lensAttributes:n,isPlainRecord:s})=>{const[a,o]=Object(r.useState)(!1),l=Object(r.useCallback)((async()=>{if(!t.id||s)return!1;if(!t.isTimeBased()||!t.getTimeField().visualizable)return!1;const i=await e.uiActions.getTriggerCompatibleActions("VISUALIZE_FIELD_TRIGGER",{dataViewSpec:t.toSpec(!1),fieldName:t.timeFieldName});return Boolean(i.length)}),[t,s,e.uiActions]),u=Object(r.useMemo)((()=>{if(a&&n)return()=>{e.lens.navigateToPrefilledEditor({id:"",timeRange:i,attributes:n})}}),[a,n,i,e.lens]);return Object(r.useEffect)((()=>{l().then(o)}),[l]),u})({services:i,dataView:n,relativeTimeRange:null!=o?o:me,lensAttributes:null==K?void 0:K.attributes,isPlainRecord:v}),ye={id:"unifiedHistogramCollapsablePanel"};if(Boolean(p)&&!oe)return Object(R.jsx)("div",a()({},ye,{"data-test-subj":"unifiedHistogramChartPanelHidden"}));const je=i.lens.SaveModalComponent,Ce=Boolean(v&&(null==U?void 0:U.type)===E.c.lensSuggestion),Oe=v&&ee&&[E.c.lensSuggestion,E.c.histogramForESQL].includes(null==U?void 0:U.type)&&oe,xe=Oe&&(null===(D=i.capabilities.dashboard)||void 0===D?void 0:D.showWriteControls),Se=[];return Oe?Se.push({label:I.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"}),iconType:"pencil",isDisabled:ne,"data-test-subj":"unifiedHistogramEditFlyoutVisualization",onClick:()=>se(!0)}):pe&&Se.push({label:I.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"}),iconType:"lensApp","data-test-subj":"unifiedHistogramEditVisualization",onClick:pe}),xe&&Se.push({label:I.i18n.translate("unifiedHistogram.saveVisualizationButton",{defaultMessage:"Save visualization"}),iconType:"save","data-test-subj":"unifiedHistogramSaveVisualization",onClick:()=>ie(!0)}),Object(R.jsx)(g.EuiFlexGroup,a()({},ye,{className:t,direction:"column",alignItems:"stretch",gutterSize:"none",responsive:!1}),Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:fe},Object(R.jsx)(g.EuiFlexGroup,{direction:"row",gutterSize:"s",responsive:!1,alignItems:"center",justifyContent:"spaceBetween"},Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Y},Object(R.jsx)(g.EuiFlexGroup,{direction:"row",gutterSize:"s",responsive:!1,alignItems:"center"},Object(R.jsx)(g.EuiFlexItem,{grow:!1},p?p():Object(R.jsx)(P,{legend:I.i18n.translate("unifiedHistogram.hideChartButtongroupLegend",{defaultMessage:"Chart visibility"}),buttonSize:"s",buttons:[{label:oe?I.i18n.translate("unifiedHistogram.hideChartButton",{defaultMessage:"Hide chart"}):I.i18n.translate("unifiedHistogram.showChartButton",{defaultMessage:"Show chart"}),iconType:oe?"transitionTopOut":"transitionTopIn","data-test-subj":"unifiedHistogramToggleChartButton",onClick:re}]})),oe&&!v&&!!k&&Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Z},Object(R.jsx)(B,{chart:m,onTimeIntervalChange:k})),Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:J},Object(R.jsx)("div",null,oe&&f&&Object(R.jsx)(M.BreakdownFieldSelector,{dataView:n,breakdown:f,onBreakdownFieldChange:A}))))),oe&&Se.length>0&&Object(R.jsx)(g.EuiFlexItem,{grow:!1},Object(R.jsx)(P,{legend:I.i18n.translate("unifiedHistogram.chartActionsGroupLegend",{defaultMessage:"Chart actions"}),buttonSize:"s",buttons:Se})))),oe&&Object(R.jsx)(g.EuiFlexItem,null,Object(R.jsx)("section",{ref:e=>ae.current.element=e,tabIndex:-1,"aria-label":I.i18n.translate("unifiedHistogram.histogramOfFoundDocumentsAriaLabel",{defaultMessage:"Histogram of found documents"}),css:he,"data-test-subj":"unifiedHistogramRendered"},T&&Object(R.jsx)(g.EuiDelayRender,{delay:500,"data-test-subj":"unifiedHistogramProgressBar"},Object(R.jsx)(g.EuiProgress,{size:"xs",color:"accent",position:"absolute"})),Object(R.jsx)(X,{abortController:z,services:i,dataView:n,request:c,hits:d,chart:m,getTimeRange:de,refetch$:be,visContext:K,isPlainRecord:v,disableTriggers:C,disabledActions:O,onTotalHitsChange:H,hasLensSuggestions:Ce,onChartLoad:V,onFilter:_,onBrushEnd:$,withDefaultActions:L})),y),xe&&te&&K.attributes&&Object(R.jsx)(je,{initialInput:Object(W.b)(K.attributes),onSave:()=>{},onClose:()=>ie(!1),isSaveable:!1}),ne&&!!K&&!!U&&Object(R.jsx)(Q,{services:i,visContext:K,lensAdapters:S,lensEmbeddableOutput$:w,isFlyoutVisible:ne,setIsFlyoutVisible:se,isPlainRecord:v,query:ce,currentSuggestionContext:U,onSuggestionContextEdit:ve}))}var ee=i(21),te=i(35),ie=i.n(te),ne=i(23);var se=i(22),ae=i(30);const re=(e,t)=>{const i=t.query.timefilter.timefilter.calculateBounds(e),n=i.min.valueOf();return(e=>{switch(!0){case e<=500:return"100 millisecond";case e<=5e3:return"1 second";case e<=7500:return"5 second";case e<=15e3:return"10 second";case e<=45e3:return"30 second";case e<=18e4:return"1 minute";case e<=45e4:return"5 minute";case e<=12e5:return"10 minute";case e<=27e5:return"30 minute";case e<=72e5:return"1 hour";case e<=216e5:return"3 hour";case e<=864e5:return"12 hour";case e<=6048e5:return"24 hour";case e<=18144e5:return"1 week";case e<36288e5:return"30 day";default:return"1 year"}})((i.max.valueOf()-n)/50)};var oe=i(9);const le="unifiedHistogram";let ue=function(e){return e.initial="initial",e.completed="completed",e}({});class lens_vis_service_LensVisService{constructor({services:e,lensSuggestionsApi:t}){ie()(this,"state$",void 0),ie()(this,"services",void 0),ie()(this,"lensSuggestionsApi",void 0),ie()(this,"status$",void 0),ie()(this,"currentSuggestionContext$",void 0),ie()(this,"allSuggestions$",void 0),ie()(this,"visContext$",void 0),ie()(this,"prevUpdateContext",void 0),ie()(this,"update",(({externalVisContext:e,queryParams:t,timeInterval:i,breakdownField:n,table:s,onSuggestionContextChange:a,onVisContextChanged:r})=>{const o=this.getAllSuggestions({queryParams:t}),l=this.getCurrentSuggestionState({externalVisContext:e,queryParams:t,allSuggestions:o,timeInterval:i,breakdownField:n}),u=this.getLensAttributesState({currentSuggestionContext:l.currentSuggestionContext,externalVisContext:e,queryParams:t,timeInterval:i,breakdownField:n,table:s});a(l.currentSuggestionContext),null==r||r(u.visContext,u.externalVisContextStatus),this.state$.next({status:ue.completed,allSuggestions:o,currentSuggestionContext:l.currentSuggestionContext,visContext:u.visContext}),this.prevUpdateContext={queryParams:t,timeInterval:i,breakdownField:n,table:s,onSuggestionContextChange:a,onVisContextChanged:r}})),ie()(this,"onSuggestionEdited",(({editedSuggestionContext:e})=>{if(!e||!this.prevUpdateContext)return;const{queryParams:t,timeInterval:i,breakdownField:n,table:s,onVisContextChanged:a}=this.prevUpdateContext,r=this.getLensAttributesState({currentSuggestionContext:e,externalVisContext:void 0,queryParams:t,timeInterval:i,breakdownField:n,table:s});null==a||a(r.visContext,E.a.manuallyCustomized)})),ie()(this,"getCurrentSuggestionState",(({allSuggestions:e,externalVisContext:t,queryParams:i,timeInterval:n,breakdownField:s})=>{let a,r=E.c.unsupported;const o=[];if(e.length&&o.push({suggestion:e[0],type:E.c.lensSuggestion}),i.isPlainRecord){const e=this.getHistogramSuggestionForESQL({queryParams:i});e&&o.push({suggestion:e,type:E.c.histogramForESQL})}else{const e=this.getDefaultHistogramSuggestion({queryParams:i,timeInterval:n,breakdownField:s});e&&o.push({suggestion:e,type:E.c.histogramForDataView})}if(t&&i.isPlainRecord){const e=Object(U.b)({externalVisContext:t,queryParams:i});e&&o.push({suggestion:e,type:E.c.lensSuggestion})}if(t){const e=o.find((e=>Object(U.d)(e.suggestion,t)));e&&(a=e.suggestion,r=e.type)}return!a&&o.length&&(a=o[0].suggestion,r=o[0].type),{currentSuggestionContext:{type:Boolean(a)?r:E.c.unsupported,suggestion:a}}})),ie()(this,"getDefaultHistogramSuggestion",(({queryParams:e,timeInterval:t,breakdownField:i})=>{var n;const{dataView:s}=e,a=i&&Object(oe.a)(i);let r=["date_column","count_column"];a&&(r=["breakdown_column",...r]);let o={date_column:{dataType:"date",isBucketed:!0,label:null!==(n=s.timeFieldName)&&void 0!==n?n:"",operationType:"date_histogram",scale:"interval",sourceField:s.timeFieldName,params:{interval:null!=t?t:"auto"}},count_column:{dataType:"number",isBucketed:!1,label:I.i18n.translate("unifiedHistogram.countColumnLabel",{defaultMessage:"Count of records"}),operationType:"count",scale:"ratio",sourceField:"___records___",params:{format:{id:"number",params:{decimals:0}}}}};a&&(o={...o,breakdown_column:{dataType:"string",isBucketed:!0,label:I.i18n.translate("unifiedHistogram.breakdownColumnLabel",{defaultMessage:"Top 3 values of {fieldName}",values:{fieldName:null==i?void 0:i.displayName}}),operationType:"terms",scale:"ordinal",sourceField:i.name,params:{size:3,orderBy:{type:"column",columnId:"count_column"},orderDirection:"desc",otherBucket:!0,missingBucket:!0,parentFormat:{id:"terms"}}}});const l={layers:{[le]:{columnOrder:r,columns:o}}};return{visualizationId:"lnsXY",visualizationState:{layers:[{accessors:["count_column"],layerId:le,layerType:"data",seriesType:"bar_stacked",xAccessor:"date_column",...a?{splitAccessor:"breakdown_column"}:{yConfig:[{forAccessor:"count_column"}]}}],legend:{isVisible:!0,position:"right",legendSize:ae.LegendSize.EXTRA_LARGE,shouldTruncate:!1},preferredSeriesType:"bar_stacked",valueLabels:"hide",fittingFunction:"None",minBarHeight:2,showCurrentTimeMarker:!0,axisTitlesVisibilitySettings:{x:!1,yLeft:!1,yRight:!1},gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!1},tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!1}},datasourceState:l,datasourceId:"formBased",columns:Object.keys(o).length}})),ie()(this,"getHistogramSuggestionForESQL",(({queryParams:e})=>{const{dataView:t,query:i,timeRange:n}=e;if(t.isTimeBased()&&i&&Object(se.isOfAggregateQueryType)(i)&&"esql"===Object(se.getAggregateQueryMode)(i)&&n){var s;if(!(e=>!function(e){const{ast:t}=Object(ne.getAstAndSyntaxErrors)(e);if(["stats","keep"].some((e=>t.find((({name:t})=>t===e)))))return!0;const i=t.find((({name:e})=>"metrics"===e));return!(!i||!("aggregates"in i))}(e.esql))(i))return;const e=re(n,this.services.data),a=this.getESQLHistogramQuery({dataView:t,query:i,timeRange:n,interval:e}),r={dataViewSpec:null==t?void 0:t.toSpec(),fieldName:"",textBasedColumns:[{id:`${t.timeFieldName} every ${e}`,name:`${t.timeFieldName} every ${e}`,meta:{type:"date"}},{id:"results",name:"results",meta:{type:"number"}}],query:{esql:a}},o=null!==(s=this.lensSuggestionsApi(r,t,["lnsDatatable"]))&&void 0!==s?s:[];if(o.length)return o[0]}})),ie()(this,"getESQLHistogramQuery",(({dataView:e,timeRange:t,query:i,interval:n})=>{const s=null!=n?n:re(t,this.services.data),a=Object(se.getAggregateQueryMode)(i);return r=(i[a]||"").split("|").filter((e=>!/DROP\s/i.test(e))).join("|"),o=`| EVAL timestamp=DATE_TRUNC(${s}, ${e.timeFieldName}) | stats results = count(*) by timestamp | rename timestamp as \`${e.timeFieldName} every ${s}\``,`${r}\n${o}`;var r,o})),ie()(this,"getAllSuggestions",(({queryParams:e})=>{var t;const{dataView:i,columns:n,query:s,isPlainRecord:a}=e,r={dataViewSpec:null==i?void 0:i.toSpec(),fieldName:"",textBasedColumns:n,query:s&&Object(se.isOfAggregateQueryType)(s)?s:void 0};return a&&null!==(t=this.lensSuggestionsApi(r,i,["lnsDatatable"]))&&void 0!==t?t:[]})),ie()(this,"getLensAttributesState",(({currentSuggestionContext:e,externalVisContext:t,queryParams:i,timeInterval:n,breakdownField:s,table:a})=>{var r;const{dataView:o,query:l,filters:c,timeRange:d}=i,{type:g,suggestion:m}=e;if(!(m&&m.datasourceId&&l&&c))return{externalVisContextStatus:E.a.unknown,visContext:void 0};const b=Object(se.isOfAggregateQueryType)(l),f={dataViewId:o.id,timeField:o.timeFieldName,timeInterval:b?void 0:n,breakdownField:b||null==s?void 0:s.name},h=g===E.c.histogramForESQL&&b&&d?{esql:this.getESQLHistogramQuery({dataView:o,query:l,timeRange:d})}:l;let v,p;var y,j;if(null!=t&&t.attributes?Object(u.isEqual)(h,null===(y=t.attributes)||void 0===y||null===(j=y.state)||void 0===j?void 0:j.query)&&function({suggestionType:e,suggestion:t,externalVisContext:i,queryParams:n,requestData:s}){return!Object.keys(s).some((e=>!Object(u.isEqual)(s[e],i.requestData[e])))&&(!(n.isPlainRecord&&e===E.c.lensSuggestion&&!Object(U.b)({externalVisContext:i,queryParams:n}))&&(e===i.suggestionType&&Object(U.d)(t,i)))}({suggestionType:g,suggestion:m,externalVisContext:t,queryParams:i,requestData:f})?(p=t,v=E.a.applied):v=E.a.automaticallyOverridden:v=E.a.automaticallyCreated,!p){const e=(({filters:e,query:t,suggestion:i,dataView:n})=>{var s;const a=Object.assign({},null==i?void 0:i.datasourceState),r=Object.assign({},null==i?void 0:i.visualizationState),o=i&&i.datasourceState?{[i.datasourceId]:{...a}}:{formBased:{}},l=r;return{title:null!==(s=null==i?void 0:i.title)&&void 0!==s?s:I.i18n.translate("visualizationUtils.config.suggestion.title",{defaultMessage:"New suggestion"}),references:[],state:{datasourceStates:o,filters:e,query:t,visualization:l,...n&&n.id&&!n.isPersisted()&&{adHocDataViews:{[n.id]:n.toMinimalSpec()}}},visualizationType:i?i.visualizationId:"lnsXY"}})({query:h,filters:c,suggestion:m,dataView:o});var C;g===E.c.histogramForDataView&&(e.title=I.i18n.translate("unifiedHistogram.lensTitle",{defaultMessage:"Edit visualization"}),e.references=[{id:null!==(C=o.id)&&void 0!==C?C:"",name:`indexpattern-datasource-layer-${le}`,type:"index-pattern"}]),p={attributes:e,requestData:f,suggestionType:g}}return a&&l&&b&&g===E.c.lensSuggestion&&null!==(r=p)&&void 0!==r&&r.attributes&&(p={...p,attributes:Object(W.a)({attributes:p.attributes,table:a})}),{externalVisContextStatus:v,visContext:p}})),this.services=e,this.lensSuggestionsApi=t,this.state$=new l.BehaviorSubject({status:ue.initial,allSuggestions:void 0,currentSuggestionContext:{suggestion:void 0,type:E.c.unsupported},visContext:void 0});const i=(n=this.state$,(e,t)=>n.pipe(Object(l.map)(e),Object(l.distinctUntilChanged)(t)));var n;this.status$=i((e=>e.status)),this.allSuggestions$=i((e=>e.allSuggestions)),this.currentSuggestionContext$=i((e=>e.currentSuggestionContext),u.isEqual),this.visContext$=i((e=>e.visContext),u.isEqual),this.prevUpdateContext=void 0}}var ce=i(31);const de=o.a.memo(K),ge=Object(R.jsx)(g.EuiSpacer,{size:"s"}),me=({className:e,services:t,dataView:i,query:n,filters:s,externalVisContext:a,isChartLoading:l,isPlainRecord:u,timeRange:c,relativeTimeRange:d,columns:m,request:f,hits:h,lensAdapters:v,lensEmbeddableOutput$:p,chart:y,breakdown:w,container:P,topPanelHeight:I,renderCustomChartToggleActions:q,disableAutoFetching:k,disableTriggers:A,disabledActions:H,lensSuggestionsApi:V,input$:_,table:$,onTopPanelHeightChange:L,onChartHiddenChange:M,onTimeIntervalChange:z,onBreakdownFieldChange:B,onSuggestionContextChange:D,onVisContextChanged:N,onTotalHitsChange:G,onChartLoad:U,onFilter:Q,onBrushEnd:W,children:X,withDefaultActions:Y,abortController:Z})=>{const J=Object(r.useMemo)((()=>{if(null!=m&&m.length)return m.reduce(((e,t)=>(e[t.id]=t,e)),{})}),[m]),K=(({services:e,query:t,filters:i,timeRange:n})=>{const{data:s}=e,a=Object(r.useMemo)((()=>null!=i?i:[]),[i]),o=Object(r.useMemo)((()=>null!=t?t:s.query.queryString.getDefaultQuery()),[s.query.queryString,t]),l=Object(r.useMemo)((()=>null!=n?n:s.query.timefilter.timefilter.getTimeDefaults()),[s.query.timefilter.timefilter,n]),u=Object(r.useRef)(Object(ce.getAbsoluteTimeRange)(l));return{filters:a,query:o,getTimeRange:Object(r.useCallback)((()=>u.current),[]),updateTimeRange:F((()=>{u.current=Object(ce.getAbsoluteTimeRange)(l)})),relativeTimeRange:l}})({services:t,query:n,filters:s,timeRange:c}),[te]=Object(r.useState)((()=>new lens_vis_service_LensVisService({services:t,lensSuggestionsApi:V}))),ie=b()(te.currentSuggestionContext$),ne=null==y?void 0:y.timeInterval;Object(r.useEffect)((()=>{l||te.update({externalVisContext:a,queryParams:{dataView:i,query:K.query,filters:K.filters,timeRange:c,isPlainRecord:u,columns:m,columnsMap:J},timeInterval:ne,breakdownField:null==w?void 0:w.field,table:$,onSuggestionContextChange:D,onVisContextChanged:u?N:void 0})}),[te,i,K.query,K.filters,c,ne,u,m,J,w,a,D,N,l,$]);const se=null!=ie&&ie.type&&ie.type!==E.c.unsupported?y:void 0,ae=function({chart:e,dataView:t,isPlainRecord:i}){return Boolean(e&&t.id&&t.type!==ee.DataViewType.ROLLUP&&(i||!i&&t.isTimeBased()))}({chart:se,dataView:i,isPlainRecord:u}),[re]=Object(r.useState)((()=>O({attributes:{class:"eui-fullHeight"}}))),[oe]=Object(r.useState)((()=>O({attributes:{class:"eui-fullHeight"}}))),le=Object(g.useIsWithinBreakpoints)(["xs","s"]),ue=le||!se||se.hidden,{euiTheme:me}=Object(g.useEuiTheme)(),be=12*me.base,fe=10*me.base,he=le&&se&&!se.hidden?Object(x.css)("height:",be,"px;",""):"eui-fullHeight",ve=se||h?ue?S.b.Static:S.b.Resizable:S.b.Single,pe=null!=I?I:be;return Object(R.jsx)(o.a.Fragment,null,Object(R.jsx)(j,{node:re},Object(R.jsx)(de,{abortController:Z,isChartAvailable:ae,className:he,services:t,dataView:i,requestParams:K,relativeTimeRange:d,request:f,hits:h,lensVisService:te,isChartLoading:l,isPlainRecord:u,chart:se,breakdown:w,renderCustomChartToggleActions:q,appendHistogram:ge,disableAutoFetching:k,disableTriggers:A,disabledActions:H,input$:_,onChartHiddenChange:M,onTimeIntervalChange:z,onBreakdownFieldChange:B,onTotalHitsChange:G,onChartLoad:U,onFilter:Q,onBrushEnd:W,lensAdapters:v,lensEmbeddableOutput$:p,withDefaultActions:Y})),Object(R.jsx)(j,{node:oe},o.a.isValidElement(X)?o.a.cloneElement(X,{isChartAvailable:ae}):X),Object(R.jsx)(T,{className:e,mode:ve,direction:S.a.Vertical,container:P,fixedPanelSize:pe,minFixedPanelSize:be,minFlexPanelSize:fe,fixedPanel:Object(R.jsx)(C,{node:re}),flexPanel:Object(R.jsx)(C,{node:oe}),"data-test-subj":"unifiedHistogram",onFixedPanelSizeChange:L}))};var be=i(13),fe=i(3);const he=e=>e.breakdownField,ve=e=>e.chartHidden,pe=e=>e.timeInterval,ye=e=>e.topPanelHeight,je=e=>e.totalHitsResult,Ce=e=>e.totalHitsStatus,Oe=e=>e.lensAdapters,xe=e=>e.lensEmbeddableOutput$,Se=(e,t,i)=>{const[n,s]=Object(r.useState)();return Object(r.useEffect)((()=>{const n=null==e?void 0:e.pipe(Object(l.map)(t),Object(l.distinctUntilChanged)(i)).subscribe(s);return()=>{null==n||n.unsubscribe()}}),[i,t,e]),n},we=Object(r.forwardRef)((({onVisContextChanged:e,...t},i)=>{const[n,s]=Object(r.useState)(),[o,c]=Object(r.useState)(),[g,m]=Object(r.useState)(),[b]=Object(r.useState)((()=>new l.Subject)),[f,h]=Object(r.useState)();Object(r.useImperativeHandle)(i,(()=>f),[f]),d()((async()=>{const{getCreationOptions:e,services:i}=t,n=await(null==e?void 0:e()),a=await i.lens.stateHelperApi();s(Object(u.pick)(n,"disableAutoFetching","disableTriggers","disabledActions")),c((e=>{const{services:t,localStorageKeyPrefix:i,initialState:n}=e;let s,a,r=!1;var o;i&&(r=null!==(o=Object(fe.b)(t.storage,i))&&void 0!==o&&o,s=Object(fe.c)(t.storage,i),a=Object(fe.a)(t.storage,i));const u=new l.BehaviorSubject({breakdownField:a,chartHidden:r,currentSuggestionContext:void 0,lensRequestAdapter:void 0,timeInterval:"auto",topPanelHeight:s,totalHitsResult:void 0,totalHitsStatus:be.UnifiedHistogramFetchStatus.uninitialized,...n}),c=e=>{u.next({...u.getValue(),...e})};return{state$:u,setChartHidden:e=>{i&&Object(fe.e)(t.storage,i,e),c({chartHidden:e})},setTopPanelHeight:e=>{i&&Object(fe.f)(t.storage,i,e),c({topPanelHeight:e})},setBreakdownField:e=>{i&&Object(fe.d)(t.storage,i,e),c({breakdownField:e})},setCurrentSuggestionContext:e=>{c({currentSuggestionContext:e})},setTimeInterval:e=>{c({timeInterval:e})},setLensRequestAdapter:e=>{c({lensRequestAdapter:e})},setLensAdapters:e=>{c({lensAdapters:e})},setLensEmbeddableOutput$:e=>{c({lensEmbeddableOutput$:e})},setTotalHits:e=>{c(e)}}})({services:i,...n})),m((()=>a.suggestions))})),Object(r.useEffect)((()=>{o&&h({refetch:()=>{b.next({type:"refetch"})},...Object(u.pick)(o,"state$","setChartHidden","setTopPanelHeight","setBreakdownField","setTimeInterval","setTotalHits")})}),[b,o]);const{dataView:v,query:p,searchSessionId:y,requestAdapter:j,isChartLoading:C}=t,O=Se(null==o?void 0:o.state$,ye),x=(({stateService:e,dataView:t,query:i,searchSessionId:n,requestAdapter:s})=>{const a=Se(null==e?void 0:e.state$,he),o=Se(null==e?void 0:e.state$,ve),l=Se(null==e?void 0:e.state$,pe),u=Se(null==e?void 0:e.state$,je),c=Se(null==e?void 0:e.state$,Ce),d=Se(null==e?void 0:e.state$,Oe),g=Se(null==e?void 0:e.state$,xe),m=Object(r.useMemo)((()=>i&&Object(se.isOfAggregateQueryType)(i)),[i]),b=Object(r.useMemo)((()=>t&&t.type!==ee.DataViewType.ROLLUP&&t.isTimeBased()),[t]),f=Object(r.useMemo)((()=>{if(!(u instanceof Error))return{status:c,total:u}}),[u,c]),h=Object(r.useMemo)((()=>{if(b||m)return{hidden:o,timeInterval:l}}),[o,m,b,l]),v=Object(r.useMemo)((()=>{if(!m&&b)return{field:a?null==t?void 0:t.getFieldByName(a):void 0}}),[a,t,m,b]),p=Object(r.useMemo)((()=>({searchSessionId:n,adapter:s})),[s,n]),y=Object(r.useCallback)((t=>{null==e||e.setTopPanelHeight(t)}),[e]),j=Object(r.useCallback)((t=>{null==e||e.setTimeInterval(t)}),[e]),C=Object(r.useCallback)(((t,i)=>{null==e||e.setTotalHits({totalHitsStatus:t,totalHitsResult:i})}),[e]),O=Object(r.useCallback)((t=>{null==e||e.setChartHidden(t)}),[e]),x=Object(r.useCallback)((t=>{null==e||e.setLensRequestAdapter(t.adapters.requests),null==e||e.setLensAdapters(t.adapters),null==e||e.setLensEmbeddableOutput$(t.embeddableOutput$)}),[e]),S=Object(r.useCallback)((t=>{null==e||e.setBreakdownField(null==t?void 0:t.name)}),[e]),w=Object(r.useCallback)((t=>{null==e||e.setCurrentSuggestionContext(t)}),[e]);return Object(r.useEffect)((()=>{!o&&h||null==e||e.setLensRequestAdapter(void 0)}),[h,o,e]),{hits:f,chart:h,breakdown:v,request:p,isPlainRecord:m,lensAdapters:d,lensEmbeddableOutput$:g,onTopPanelHeightChange:y,onTimeIntervalChange:j,onTotalHitsChange:C,onChartHiddenChange:O,onChartLoad:x,onBreakdownFieldChange:S,onSuggestionContextChange:w}})({stateService:o,dataView:v,query:p,searchSessionId:y,requestAdapter:j}),S=Object(r.useMemo)((()=>{if(e)return(t,i)=>{const n=Object(U.c)(t);e(n,i)}}),[e]);return n&&g&&f?Object(R.jsx)(me,a()({},t,n,x,{onVisContextChanged:S,isChartLoading:Boolean(C),topPanelHeight:O,input$:b,lensSuggestionsApi:g})):null}));t.default=we}}]);