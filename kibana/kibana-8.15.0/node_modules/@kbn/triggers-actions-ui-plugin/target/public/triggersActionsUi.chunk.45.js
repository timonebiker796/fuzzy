/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[45],{139:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return l}));var n=s(6);function o({id:e,duration:t,rRule:s}){return{...e?{id:e}:{},duration:t,rRule:{...s,...s.until?{until:s.until.toISOString()}:{}}}}async function i({id:e,snoozeSchedule:t,http:s}){await s.post(`${n.m}/rule/${encodeURIComponent(e)}/_snooze`,{body:JSON.stringify({snooze_schedule:o(t)})})}function l({ids:e,filter:t,snoozeSchedule:s,http:i}){let l;try{l=JSON.stringify({ids:null!=e&&e.length?e:void 0,...t?{filter:JSON.stringify(t)}:{},operations:[{operation:"set",field:"snoozeSchedule",value:o(s)}]})}catch(e){throw new Error(`Unable to parse bulk snooze params: ${e}`)}return i.post(`${n.m}/rules/_bulk_edit`,{body:l})}},140:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return i}));var n=s(6);async function o({id:e,http:t,scheduleIds:s}){await t.post(`${n.m}/rule/${encodeURIComponent(e)}/_unsnooze`,{body:JSON.stringify({schedule_ids:s})})}function i({ids:e,filter:t,scheduleIds:s,http:o}){let i;try{i=JSON.stringify({ids:null!=e&&e.length?e:void 0,...t?{filter:JSON.stringify(t)}:{},operations:[{operation:"delete",field:"snoozeSchedule",value:s}]})}catch(e){throw new Error(`Unable to parse bulk unsnooze params: ${e}`)}return o.post(`${n.m}/rules/_bulk_edit`,{body:i})}},98:function(e,t,s){"use strict";s.r(t),s.d(t,"RulesListNotifyBadge",(function(){return x})),s.d(t,"SNOOZE_SUCCESS_MESSAGE",(function(){return b})),s.d(t,"UNSNOOZE_SUCCESS_MESSAGE",(function(){return f})),s.d(t,"SNOOZE_FAILED_MESSAGE",(function(){return j})),s.d(t,"default",(function(){return L}));var n=s(1),o=s(29),i=s(140),l=s(139),a=s(33),u=s.n(a),r=s(3),c=s(2),d=s(187),g=s(169);const b=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeSuccess",{defaultMessage:"Rules notification successfully snoozed"}),f=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.unsnoozeSuccess",{defaultMessage:"Rules notification successfully unsnoozed"}),j=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeFailed",{defaultMessage:"Unable to change rule snooze settings"}),p=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.openSnoozePanel",{defaultMessage:"Open snooze panel"}),h=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.seconds",{defaultMessage:"{value, plural, one {# second} other {# seconds}}",values:{value:e}}),O=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.minutes",{defaultMessage:"{value, plural, one {# minute} other {# minutes}}",values:{value:e}}),v=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.hours",{defaultMessage:"{value, plural, one {# hour} other {# hours}}",values:{value:e}}),y=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.days",{defaultMessage:"{value, plural, one {# day} other {# days}}",values:{value:e}}),m=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.weeks",{defaultMessage:"{value, plural, one {# week} other {# weeks}}",values:{value:e}}),S=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.months",{defaultMessage:"{value, plural, one {# month} other {# months}}",values:{value:e}});var z=s(0);const x=({snoozeSettings:e,loading:t=!1,disabled:s=!1,onRuleChanged:i,snoozeRule:l,unsnoozeRule:a,showOnHover:x=!1,showTooltipInline:L=!1})=>{var I,k,N;const[w,E]=Object(n.useState)(!1),M=t||w,U=Boolean(s)||!e,[A,B]=Object(n.useState)(!1),R=Object(n.useCallback)((()=>B(!0)),[B]),T=Object(n.useCallback)((()=>B(!1)),[B]),C=null==e?void 0:e.isSnoozedUntil,_=null!==(I=null==e?void 0:e.muteAll)&&void 0!==I&&I,F=Object(n.useMemo)((()=>{return!!e&&(t=e,Boolean(t.isSnoozedUntil&&new Date(t.isSnoozedUntil).getTime()>Date.now()||t.muteAll));var t}),[e]),P=Object(n.useMemo)((()=>e?(e=>{if(!e.snoozeSchedule)return null;const t=e.snoozeSchedule.filter((e=>Boolean(e.id)));return 0===t.length?null:t.reduce(((e,t)=>u()(t.rRule.dtstart).isBefore(u()(e.rRule.dtstart))?t:e))})(e):null),[e]),$=Object(n.useMemo)((()=>C?function(e){const t=u.a.duration(u()(e).diff(u()())),s={years:(i=t.years(),c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.years",{defaultMessage:"{value, plural, one {# year} other {# years}}",values:{value:i}})),months:S(t.months()),weeks:m(t.weeks()),days:y(t.days()),hours:v(t.hours()),minutes:O(t.minutes()),seconds:h(t.seconds())},n=Object.entries(s).filter((([e,t])=>""!==t&&t!==`0 ${e}`)).map((([e,t])=>`${t}`)).join(", "),o=n.lastIndexOf(", ");var i;return-1===o?n:n.slice(0,o)+" and"+n.slice(o+1)}(C):void 0),[C]),J=Object(n.useRef)(null),{notifications:{toasts:D}}=Object(o.b)().services,G=Object(n.useMemo)((()=>!F&&Boolean(P)),[P,F]),H=Object(n.useMemo)((()=>C?Object(d.a)(u()(C)):P?Object(d.a)(u()(P.rRule.dtstart)):""),[C,P]),Z=Object(n.useMemo)((()=>_?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedIndefinitelyTooltip",{defaultMessage:"Notifications snoozed indefinitely"}):G?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozeScheduledTooltip",{defaultMessage:"Notifications scheduled to snooze starting {schedStart}",values:{schedStart:Object(d.b)(u()(P.rRule.dtstart))}}):F&&$?Object(z.jsx)(r.EuiToolTip,{title:c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.timeRemaining",{defaultMessage:"Time remaining"}),content:Object(z.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(z.jsx)(r.EuiFlexItem,{grow:!1},Object(z.jsx)("span",null,$)),Object(z.jsx)(r.EuiSpacer,null),Object(z.jsx)(r.EuiFlexItem,{grow:!1},Object(z.jsx)("span",null,null==C?void 0:C.toString())))},Object(z.jsx)(r.EuiTextAlign,null,c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedTooltip",{defaultMessage:"Notifications snoozing for {snoozeTime}",values:{snoozeTime:u()(C).fromNow(!0)}}))):L?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.noSnoozeAppliedTooltip",{defaultMessage:"Notify when alerts generated"}):""),[_,G,F,L,P,$,C]),q=Object(n.useMemo)((()=>Object(z.jsx)(r.EuiButton,{size:"s",isLoading:M,disabled:M||U,"data-test-subj":"rulesListNotifyBadge-snoozed","aria-label":p,minWidth:85,iconType:"bellSlash",color:"accent",onClick:R,buttonRef:J},Object(z.jsx)(r.EuiText,{size:"xs"},H))),[H,M,U,R]),W=Object(n.useMemo)((()=>Object(z.jsx)(r.EuiButton,{size:"s",isLoading:M,disabled:M||U,"data-test-subj":"rulesListNotifyBadge-scheduled",minWidth:85,iconType:"calendar",color:"text","aria-label":p,onClick:R,buttonRef:J},Object(z.jsx)(r.EuiText,{size:"xs"},H))),[H,M,U,R]),Y=Object(n.useMemo)((()=>{const e=x?"ruleSidebarItem__action":"";return Object(z.jsx)(r.EuiButtonIcon,{size:"s",isLoading:M,disabled:M||U,display:M?"base":"empty","data-test-subj":"rulesListNotifyBadge-unsnoozed","aria-label":p,className:A||M?"":e,iconType:"bell",onClick:R,buttonRef:J})}),[A,M,U,x,R]),K=Object(n.useMemo)((()=>Object(z.jsx)(r.EuiButtonIcon,{size:"s",isLoading:M,disabled:M||U,display:"base","data-test-subj":"rulesListNotifyBadge-snoozedIndefinitely","aria-label":p,iconType:"bellSlash",color:"accent",onClick:R,buttonRef:J})),[M,U,R]),Q=Object(n.useMemo)((()=>G?W:_?K:F?q:Y),[F,G,_,W,q,K,Y]),V=Object(n.useMemo)((()=>{const e="string"==typeof s?s:A||L?void 0:$;return Object(z.jsx)(r.EuiToolTip,{title:e?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.timeRemaining",{defaultMessage:"Time remaining"}):void 0,content:e},Q)}),[s,A,Q,L,$]),X=Object(n.useCallback)((async e=>{try{E(!0),T(),await l(e),await i(),D.addSuccess(b)}catch(e){D.addDanger(j)}finally{E(!1),requestAnimationFrame((()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.focus()}))}}),[T,l,i,D]),ee=Object(n.useCallback)((async e=>{try{E(!0),T(),await a(e),await i(),D.addSuccess(f)}catch(e){D.addDanger(j)}finally{E(!1),requestAnimationFrame((()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.focus()}))}}),[T,a,i,D]),te=Object(z.jsx)(r.EuiPopover,{"data-test-subj":"rulesListNotifyBadge",isOpen:A&&!U,closePopover:T,button:V,anchorPosition:"rightCenter",panelStyle:{maxHeight:"100vh",overflowY:"auto"}},Object(z.jsx)(g.a,{snoozeRule:X,unsnoozeRule:ee,interval:Object(g.b)(C),showCancel:F,scheduledSnoozes:null!==(k=null==e?void 0:e.snoozeSchedule)&&void 0!==k?k:[],activeSnoozes:null!==(N=null==e?void 0:e.activeSnoozes)&&void 0!==N?N:[],inPopover:!0}));return L?Object(z.jsx)(r.EuiFlexGroup,{alignItems:"center"},Object(z.jsx)(r.EuiFlexItem,{grow:!1},te),Object(z.jsx)(r.EuiFlexItem,null,Object(z.jsx)(r.EuiText,{color:"subdued",size:"xs"},Z))):te},L=({ruleId:e,snoozeSettings:t,loading:s,disabled:a,showTooltipInline:u,showOnHover:r,onRuleChanged:c})=>{const{http:d}=Object(o.b)().services,g=Object(n.useCallback)((t=>e?Object(l.b)({http:d,id:e,snoozeSchedule:t}):Promise.resolve()),[d,e]),b=Object(n.useCallback)((t=>e?Object(i.b)({http:d,id:e,scheduleIds:t}):Promise.resolve()),[d,e]);return Object(z.jsx)(x,{snoozeSettings:t,loading:s,disabled:a,onRuleChanged:c,snoozeRule:g,unsnoozeRule:b,showTooltipInline:u,showOnHover:r})}}}]);