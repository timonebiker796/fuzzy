/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[13],{246:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var n=s(2),i=s(4),o=s(29),l=s(1),r=s(134),a=s.n(r),u=s(103),c=s(186),d=s(11);const b=n.i18n.translate("xpack.triggersActionsUI.alertsTable.api.bulkGetMaintenanceWindow.errorTitle",{defaultMessage:"Error fetching maintenance windows data"}),g=e=>{const t=new Map;for(const n of null!==(s=null==e?void 0:e.maintenanceWindows)&&void 0!==s?s:[]){var s;t.set(n.id,{...n})}return t},m=e=>{const{ids:t,canFetchMaintenanceWindows:s=!1,queryContext:n}=e,{http:r,notifications:{toasts:m},application:{capabilities:{maintenanceWindow:{show:j}}}}=Object(o.b)().services,{isAtLeastPlatinum:p}=(()=>{var e;const{licensing:t}=Object(o.b)().services,s=a()(null!==(e=null==t?void 0:t.license$)&&void 0!==e?e:new u.Observable,null),n=Object(l.useCallback)((e=>!!s&&s.isAvailable&&s.isActive&&s.hasAtLeast(e)),[s]);return{isAtLeastPlatinum:Object(l.useCallback)((()=>n("platinum")),[n])}})(),f=p(),{data:O,isFetching:v}=Object(i.useQuery)({queryKey:c.a.maintenanceWindowsBulkGet(t),enabled:f&&j&&t.length>0&&s,select:g,queryFn:()=>(async({http:e,ids:t})=>{return{maintenanceWindows:(s=await e.post(`${d.INTERNAL_ALERTING_API_MAINTENANCE_WINDOW_PATH}/_bulk_get`,{body:JSON.stringify({ids:t})})).maintenance_windows.map((e=>(({expiration_date:e,r_rule:t,created_by:s,updated_by:n,created_at:i,updated_at:o,event_start_time:l,event_end_time:r,category_ids:a,...u})=>({...u,expirationDate:e,rRule:t,createdBy:s,updatedBy:n,createdAt:i,updatedAt:o,eventStartTime:l,eventEndTime:r,categoryIds:a}))(e))),errors:s.errors.map((e=>(({status_code:e,...t})=>({...t,statusCode:e}))(e)))};var s})({http:r,ids:t}),onError:e=>{m.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:b})},context:n});return{data:O,isFetching:v}}},327:function(e,t,s){e.exports=s.p+"94cccf20036d014924e63d4d595e88e1.svg"},377:function(e,t,s){"use strict";s.r(t),s.d(t,"AlertsTableState",(function(){return Z})),s.d(t,"default",(function(){return Z}));var n=s(1),i=s.n(n),o=s(10),l=s(3),r=s(71),a=s(41),u=s(31),c=s(4),d=s(2),b=s(95),g=s(9),m=s(186),j=s(36);const p=d.i18n.translate("xpack.triggersActionsUI.mutedAlerts.api.get",{defaultMessage:"Error fetching muted alerts data"});var f=s(234),O=s(359),v=s(24),y=s(327),w=s.n(y),h=s(223),C=s(203),x=s(0);const A={tall:490,short:250},E={maxWidth:500},S=({height:e="tall",controls:t,getInspectQuery:s,showInpectButton:n})=>Object(x.jsx)(l.EuiPanel,{color:"subdued","data-test-subj":"alertsStateTableEmptyState"},Object(x.jsx)(l.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},n&&Object(x.jsx)(l.EuiFlexItem,{grow:!1},Object(x.jsx)(h.a,{getInspectQuery:s,inspectTitle:C.d})),(null==t?void 0:t.right)&&Object(x.jsx)(l.EuiFlexItem,{grow:!1},t.right)),Object(x.jsx)(l.EuiFlexGroup,{style:{height:A[e]},alignItems:"center",justifyContent:"center"},Object(x.jsx)(l.EuiFlexItem,{grow:!1},Object(x.jsx)(l.EuiPanel,{hasBorder:!0,style:E},Object(x.jsx)(l.EuiFlexGroup,null,Object(x.jsx)(l.EuiFlexItem,null,Object(x.jsx)(l.EuiText,{size:"s"},Object(x.jsx)(l.EuiTitle,null,Object(x.jsx)("h3",null,Object(x.jsx)(v.FormattedMessage,{id:"xpack.triggersActionsUI.empty.title",defaultMessage:"No results match your search criteria"}))),Object(x.jsx)("p",null,Object(x.jsx)(v.FormattedMessage,{id:"xpack.triggersActionsUI.empty.description",defaultMessage:"Try searching over a longer period of time or modifying your search"})))),Object(x.jsx)(l.EuiFlexItem,{grow:!1},Object(x.jsx)(l.EuiImage,{style:{width:200,height:148},size:"200",alt:"",url:w.a})))))));var I=s(19);const M=e=>new Map(Array.from(Array(e).keys()).map((e=>[e,{isLoading:!1}]))),T=(e,{action:t,rowIndex:s,rowCount:n,isLoading:i=!1})=>{const{rowSelection:o,rowCount:l}=e,r={...e};if(t===I.f.add&&void 0!==s){const e=new Map(o);e.set(s,{isLoading:i}),r.rowSelection=e}else if(t===I.f.delete&&void 0!==s){const e=new Map(o);e.delete(s),r.rowSelection=e}else if(t===I.f.selectCurrentPage)r.rowSelection=M(l);else if(t===I.f.selectAll)r.rowSelection=M(l),r.isAllSelected=!0;else if(t===I.f.clear)r.rowSelection=new Map,r.isAllSelected=!1;else if(t===I.f.rowCountUpdate&&void 0!==n)r.rowCount=n,r.updatedAt=Date.now();else if(t===I.f.updateAllLoadingState){const e=new Map(Array.from(o.keys()).map((e=>[e,{isLoading:i}])));r.rowSelection=e}else t===I.f.updateRowLoadingState&&void 0!==s&&r.rowSelection.set(s,{isLoading:i});return r.areAllVisibleRowsSelected=r.rowSelection.size===r.rowCount,r};var F=s(128),_=s(157),k=s(29),R=s(211);const B=(e,t,s)=>{return{...N(s,e)||{id:e},schema:(n=L(e,t).type,"date"===n?"datetime":"number"===n?"numeric":"object"===n?"json":n)};var n},L=(e,t)=>{const s={type:"string"};if(!t||0===Object.keys(t).length)return s;const n=(e=>{const t=e.split(".");return 1===t.length?"base":t[0]})(e);if(!t[n])return s;const i=t[n].fields;if(!i)return s;return i[e]||s},P=(e,t,s)=>e.map((e=>(e=>Boolean(e.schema))(e)?e:B(e.id,t,s))),N=(e,t)=>e.find((({id:e})=>e===t)),W=({id:e,storageAlertsTable:t,columns:s,storage:n,visibleColumns:i})=>{t.current={...t.current,columns:s,visibleColumns:i},n.current.set(e,t.current)},z=({featureIds:e,storageAlertsTable:t,storage:s,id:i,defaultColumns:l,initialBrowserFields:a})=>{var u;const[c,d]=(({featureIds:e,initialBrowserFields:t})=>{const{http:s,notifications:{toasts:i}}=Object(k.b)().services,[o,l]=Object(n.useState)(void 0),[r,a]=Object(n.useState)((()=>null!=t?t:{})),[u,c]=Object(n.useState)([]),d=Object(n.useCallback)((async e=>{if(!s)return Promise.resolve({browserFields:{},fields:[]});try{return await s.get(`${_.a}/browser_fields`,{query:{featureIds:e}})}catch(e){return i.addDanger(R.d),Promise.resolve({browserFields:{},fields:[]})}}),[s,i]);return Object(n.useEffect)((()=>{if(t)return void a(t);const s=e.filter((e=>Object(F.b)(e)));void 0!==o||e.includes("siem")||0===s.length||(l(!0),(async e=>{const{browserFields:t,fields:s}=await d(e);c(s),a(t),l(!1)})(s))}),[d,o,e,t]),[o,r,u]})({featureIds:e,initialBrowserFields:a}),[b,g]=Object(n.useState)((()=>{let e=t.current.columns;return a&&l?e=P(e,a,l):e&&0===e.length&&(e=l),e})),[m,j]=Object(n.useState)(null!==(u=t.current.visibleColumns)&&void 0!==u?u:(e=>e.map((e=>e.id)))(b)),[p,f]=Object(n.useState)(!1),O=Object(n.useRef)(l),v=l!==O.current,y=Object(n.useCallback)((e=>{j(e),W({id:i,storage:s,storageAlertsTable:t,columns:b,visibleColumns:e})}),[b,i,s,t]);Object(n.useEffect)((()=>{var e;if(v&&O.current)return O.current=l,f(!1),g(t.current.columns),void j(null!==(e=t.current.visibleColumns)&&void 0!==e?e:m)}),[v,t,l,m]),Object(n.useEffect)((()=>{if(Object(o.isEmpty)(d)||p)return;const e=P(b,d,l);f(!0),g(e)}),[d,l,c,p,b]);const w=Object(n.useCallback)(((e,n)=>{g(e),W({id:i,storage:s,storageAlertsTable:t,columns:e,visibleColumns:n})}),[i,s,t]),h=Object(n.useCallback)((e=>{const t=(({column:e,columns:t,defaultColumns:s})=>{const n=t.findIndex((t=>t.id===e.id)),i=n>=0,o=(e=>{const t={...e};return t.id===r.b&&(t.isSortable=!1,t.displayAsText||(t.displayAsText=C.h)),t.id===r.j&&(t.isSortable=!1,t.displayAsText||(t.displayAsText=C.i)),t})(e);return i?(({columns:e,index:t})=>[...e.slice(0,t),...e.slice(t+1)])({columns:t,index:n}):(({column:e,columns:t,defaultColumns:s})=>{const n=s.findIndex((t=>t.id===e.id));return n>=0?[...t.slice(0,n),e,...t.slice(n)]:0===t.length?[e]:[t[0],e,...t.slice(1)]})({defaultColumns:s,column:o,columns:t})})({column:B(e,d,l),columns:b,defaultColumns:l});let s=m;s=m.includes(e)?m.filter((t=>t!==e)):[m[0],e,...m.slice(1)],j(s),w(t,s)}),[d,b,l,w,m]),x=Object(n.useCallback)((()=>{const e=P(l,d,l),t=e.map((e=>e.id));j(t),w(e,t)}),[d,l,w]),A=Object(n.useCallback)((({columnId:e,width:t})=>{const s=b.findIndex((t=>t.id===e));s>-1&&(b.splice(s,1,{...b[s],initialWidth:t}),w(b,m))}),[b,w,m]),E=Object(n.useMemo)((()=>[...b.map((e=>({field:e.id,include_unmapped:!0})))]),[b]);return Object(n.useMemo)((()=>({columns:b,visibleColumns:m,isBrowserFieldDataLoading:c,browserFields:d,onToggleColumn:h,onResetColumns:x,onChangeVisibleColumns:y,onColumnResize:A,fields:E})),[d,b,E,c,A,x,h,y,m])};var D=s(221);const Q=d.i18n.translate("xpack.triggersActionsUI.cases.api.bulkGet",{defaultMessage:"Error fetching cases data"}),U=e=>{const t=new Map;for(const n of null!==(s=null==e?void 0:e.cases)&&void 0!==s?s:[]){var s;t.set(n.id,{...n})}return t};var q=s(246),G=s(16),H=s.n(G);class error_boundary_ErrorBoundary extends i.a.Component{constructor(...e){super(...e),H()(this,"state",{error:null})}static getDerivedStateFromError(e){return{error:e}}render(){var e;if(null!=this.state.error){const e=this.props.fallback;return Object(x.jsx)(e,{error:this.state.error})}return null!==(e=this.props.children)&&void 0!==e?e:null}}const V={pageSize:10,pageIndex:0},$={id:"",columns:[],sort:[],getRenderCellValue:()=>null},J=[],K=[10,20,50,100],X={rowSelection:new Map,isAllSelected:!1,areAllVisibleRowsSelected:!1,rowCount:0,updatedAt:Date.now()},Y=({error:e})=>Object(x.jsx)(l.EuiEmptyPrompt,{iconType:"error",color:"danger",title:Object(x.jsx)("h2",null,C.g),body:Object(x.jsx)(i.a.Fragment,null,Object(x.jsx)("p",null,C.f),e.message&&Object(x.jsx)(l.EuiCode,null,e.message)),actions:Object(x.jsx)(l.EuiCopy,{textToCopy:[e.message,e.stack].filter(Boolean).join("\n")},(e=>Object(x.jsx)(l.EuiButton,{onClick:e,color:"danger",fill:!0},C.e)))}),Z=Object(n.memo)((e=>Object(x.jsx)(c.QueryClientProvider,{client:D.a,context:j.b},Object(x.jsx)(error_boundary_ErrorBoundary,{fallback:Y},Object(x.jsx)(te,e)))));Z.displayName="AlertsTableState";const ee=[],te=Object(n.memo)((({alertsTableConfigurationRegistry:e,configurationId:t,id:s,featureIds:i,query:d,pageSize:v,leadingControlColumns:y=ee,trailingControlColumns:w,rowHeightsOptions:A,cellContext:E,columns:I,gridStyle:M,browserFields:F,onUpdate:_,onLoaded:k,runtimeMappings:R,showAlertStatusWithFlapping:B,toolbarVisibility:L,shouldHighlightRow:P,dynamicRowHeight:N,lastReloadRequestTime:W,emptyStateHeight:D})=>{var G,H,Y,Z,te,se,ne;const{cases:ie,fieldFormats:oe}=Object(u.useKibana)().services,le=null!==(G=null==e?void 0:e.has(t))&&void 0!==G&&G;le||console.warn(`Missing Alert Table configuration for configuration ID: ${t}`);const re=le?e.get(t):$,ae=Object(n.useRef)(new a.Storage(window.localStorage)),ue=ae.current.get(s),ce=null==re||null===(H=re.usePersistentControls)||void 0===H?void 0:H.call(re),de=null!==(Y=null==re?void 0:re.showInspectButton)&&void 0!==Y&&Y,be=Object(n.useMemo)((()=>{var e;return I&&!Object(o.isEmpty)(I)?I:null!==(e=null==re?void 0:re.columns)&&void 0!==e?e:[]}),[I,re]),ge=ue&&ue.columns&&!Object(o.isEmpty)(null==ue?void 0:ue.columns)?null==ue?void 0:ue.columns:be,me=Object(n.useCallback)((()=>{var e;return{columns:ge,sort:ue&&ue.sort&&!Object(o.isEmpty)(null==ue?void 0:ue.sort)?null==ue?void 0:ue.sort:null!==(e=null==re?void 0:re.sort)&&void 0!==e?e:[],visibleColumns:ue&&ue.visibleColumns&&!Object(o.isEmpty)(null==ue?void 0:ue.visibleColumns)?null==ue?void 0:ue.visibleColumns:ge.map((e=>e.id))}}),[ge,null==re?void 0:re.sort,ue]),je=Object(n.useRef)(me());je.current=me();const[pe,fe]=Object(n.useState)(je.current.sort),[Oe,ve]=Object(n.useState)({...V,pageSize:null!=v?v:V.pageSize}),ye=Object(n.useCallback)((e=>{ve(e)}),[]),{columns:we,browserFields:he,isBrowserFieldDataLoading:Ce,onToggleColumn:xe,onResetColumns:Ae,visibleColumns:Ee,onChangeVisibleColumns:Se,onColumnResize:Ie,fields:Me}=z({featureIds:i,storageAlertsTable:je,storage:ae,id:s,defaultColumns:be,initialBrowserFields:F}),[Te,{alerts:Fe,oldAlertsData:_e,ecsAlertsData:ke,isInitializing:Re,getInspectQuery:Be,refetch:Le,totalAlerts:Pe}]=Object(f.a)({fields:Me,featureIds:i,query:d,pagination:Oe,onPageChange:ye,onLoaded:k,runtimeMappings:R,sort:pe,skip:!1}),Ne=Object(n.useMemo)((()=>[...new Set(Fe.map((e=>e["kibana.alert.rule.uuid"][0])))]),[Fe]),{data:We}=((e,t=!0)=>{const{http:s,notifications:{toasts:n}}=Object(g.useKibana)().services;return Object(c.useQuery)(m.a.mutedAlerts(),(({signal:t})=>(async(e,t,s)=>{const n=b.nodeBuilder.or(t.ids.map((e=>b.nodeBuilder.is("alert.id",`alert:${e}`))));return e.post("/internal/alerting/rules/_find",{body:JSON.stringify({filter:JSON.stringify(n),fields:["id","mutedInstanceIds"],page:1,per_page:t.ids.length}),signal:s})})(s,{ids:e},t).then((({data:e})=>null==e?void 0:e.reduce(((e,t)=>(e[t.id]=t.muted_alert_ids,e)),{})))),{context:j.b,enabled:e.length>0&&t,onError:e=>{"AbortError"!==e.name&&n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:p})}})})(Ne),ze=Object(n.useMemo)((()=>({toggleColumn:xe})),[xe]),De=Object(n.useMemo)((()=>({...re,actions:ze})),[re,ze]);Object(n.useEffect)((()=>{var s;const n=null===(s=e.getActions(t))||void 0===s?void 0:s.toggleColumn;xe!==n&&e.update(t,De)}),[t,e,De,xe]),Object(n.useEffect)((()=>{_&&_({isLoading:Te,totalCount:Pe,refresh:Le})}),[Te,Pe,_,Le]),Object(n.useEffect)((()=>{W&&Le()}),[W,Le]);const Qe=Object(n.useMemo)((()=>(e=>new Set(e.filter((e=>{const t=e[r.b];return null!=t&&t.length>0})).map((e=>e[r.b])).flat()))(Fe)),[Fe]),Ue=Object(n.useMemo)((()=>(e=>new Set(e.filter((e=>{const t=e[r.j];return null!=t&&t.length>0})).map((e=>e[r.j])).flat()))(Fe)),[Fe]),qe=Object(n.useMemo)((()=>{var e,t;return null==ie?void 0:ie.helpers.canUseCases(null!==(e=null==re||null===(t=re.cases)||void 0===t?void 0:t.owner)&&void 0!==e?e:[])}),[re,ie]),Ge=Boolean(null==qe?void 0:qe.read),He=(e=>e.some((({id:e})=>e===r.b)))(we)&&Ge,Ve=(e=>e.some((({id:e})=>e===r.j)))(we),$e=Object(n.useMemo)((()=>Array.from(Qe.values())),[Qe]),{data:Je,isFetching:Ke}=((e,t)=>{const{http:s,notifications:{toasts:n}}=Object(g.useKibana)().services;return Object(c.useQuery)(m.a.casesBulkGet(e),(({signal:t})=>(async(e,t,s)=>await e.post("/internal/cases/_bulk_get",{body:JSON.stringify({...t}),signal:s}))(s,{ids:e},t)),{context:j.b,enabled:e.length>0&&t,select:U,onError:e=>{"AbortError"!==e.name&&n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:Q})}})})($e,He),Xe=Object(n.useMemo)((()=>({ids:Array.from(Ue.values()),canFetchMaintenanceWindows:Ve,queryContext:j.b})),[Ve,Ue]),{data:Ye,isFetching:Ze}=Object(q.a)(Xe),et=Object(n.useReducer)(T,X),tt=Object(n.useCallback)((e=>{const t=e.map((e=>({[e.id]:{order:e.direction}})));je.current={...je.current,sort:t},ae.current.set(s,je.current),fe(t)}),[s]),st=Object(n.useMemo)((()=>null==ie?void 0:ie.ui.getCasesContext()),[null==ie?void 0:ie.ui]),nt=ie&&st,it=Object(n.useMemo)((()=>({data:null!=Je?Je:new Map,isLoading:Ke})),[Je,Ke]),ot=Object(n.useMemo)((()=>({data:null!=Ye?Ye:new Map,isLoading:Ze})),[Ye,Ze]),lt=Object(n.useMemo)((()=>({alertsTableConfiguration:re,cases:it,maintenanceWindows:ot,columns:we,bulkActions:J,deletedEventIds:J,disabledCellActions:J,pageSizeOptions:K,id:s,leadingControlColumns:y,showAlertStatusWithFlapping:B,trailingControlColumns:w,visibleColumns:Ee,"data-test-subj":"internalAlertsState",browserFields:he,onToggleColumn:xe,onResetColumns:Ae,onChangeVisibleColumns:Se,onColumnResize:Ie,query:d,rowHeightsOptions:A,cellContext:E,gridStyle:M,controls:ce,showInspectButton:de,toolbarVisibility:L,shouldHighlightRow:P,dynamicRowHeight:N,featureIds:i,isInitializing:Re,pagination:Oe,sort:pe,isLoading:Te,alerts:Fe,oldAlertsData:_e,ecsAlertsData:ke,getInspectQuery:Be,refetch:Le,alertsCount:Pe,onSortChange:tt,onPageChange:ye,fieldFormats:oe})),[re,it,ot,we,s,y,w,B,Ee,he,xe,Ae,Se,Ie,d,A,M,ce,de,L,P,N,i,E,Re,Oe,pe,Te,Fe,_e,ke,Be,Le,Pe,tt,ye,oe]),rt=Object(n.useMemo)((()=>({mutedAlerts:null!=We?We:{},bulkActions:et})),[et,We]);return le?Object(x.jsx)(j.a.Provider,{value:rt},!Te&&0===Pe&&Object(x.jsx)(h.b,null,Object(x.jsx)(S,{controls:ce,getInspectQuery:Be,showInpectButton:de,height:D})),(Te||Ce)&&Object(x.jsx)(l.EuiProgress,{size:"xs",color:"accent","data-test-subj":"internalAlertsPageLoading"}),0!==Pe&&nt&&Object(x.jsx)(st,{owner:null!==(Z=null===(te=re.cases)||void 0===te?void 0:te.owner)&&void 0!==Z?Z:[],permissions:qe,features:{alerts:{sync:null!==(se=null===(ne=re.cases)||void 0===ne?void 0:ne.syncAlerts)&&void 0!==se&&se}}},Object(x.jsx)(O.AlertsTable,lt)),0!==Pe&&!nt&&Object(x.jsx)(O.AlertsTable,lt)):Object(x.jsx)(l.EuiEmptyPrompt,{"data-test-subj":"alertsTableNoConfiguration",iconType:"watchesApp",title:Object(x.jsx)("h2",null,C.b),body:Object(x.jsx)("p",null,C.a)})}));te.displayName="AlertsTableStateWithQueryProvider"}}]);