/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[3],{260:function(e,t,s){"use strict";s.r(t),s.d(t,"RulesSettingsLink",(function(){return L})),s.d(t,"default",(function(){return L}));var a=s(1),n=s.n(a),l=s(3),i=s(24),r=s(2),o=s(29),u=s(4),c=s(6);var g=s(11),d=s(12),j=s.n(d),b=s(0);const p=Object(a.memo)((e=>{const{label:t,labelPopoverText:s,min:a,max:n,value:i,disabled:r,onChange:o,...u}=e;return Object(b.jsx)(l.EuiFormRow,{label:Object(b.jsx)("div",null,t,"Â ",s&&Object(b.jsx)(l.EuiIconTip,{color:"subdued",size:"s",type:"questionInCircle",content:s}))},Object(b.jsx)(l.EuiRange,j()({min:a,max:n,step:1,value:i,disabled:r,onChange:o,showLabels:!0,showValue:!0},u)))})),x=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowLabel",{defaultMessage:"Rule run look back window"}),h=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowHelp",{defaultMessage:"The minimum number of runs in which the threshold must be met."}),m=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdLabel",{defaultMessage:"Alert status change threshold"}),O=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdHelp",{defaultMessage:"The minimum number of times an alert must switch states in the look back window."}),y=e=>r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.statusChangeThresholdTimes",{defaultMessage:"{amount, number} {amount, plural, one {time} other {times}}",values:{amount:e}}),S=()=>Object(b.jsx)(l.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.alertFlappingDetection",defaultMessage:"Alert flapping detection"}))),f=()=>Object(b.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.alertFlappingDetectionDescription",defaultMessage:"Modify the frequency that an alert can go between active and recovered over a period of rule runs."})),E=Object(a.memo)((e=>{const{flappingSettings:t,compressed:s=!1,onChange:a,canWrite:o}=e,{lookBackWindow:u,statusChangeThreshold:c}=t;return Object(b.jsx)(l.EuiFlexGroup,{direction:"column"},s&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(S,null)),Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(f,null)),Object(b.jsx)(l.EuiSpacer,{size:"s"})))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(p,{"data-test-subj":"lookBackWindowRangeInput",min:g.MIN_LOOK_BACK_WINDOW,max:g.MAX_LOOK_BACK_WINDOW,value:u,onChange:e=>a("lookBackWindow",parseInt(e.currentTarget.value,10)),label:x,labelPopoverText:h,disabled:!o})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(p,{"data-test-subj":"statusChangeThresholdRangeInput",min:g.MIN_STATUS_CHANGE_THRESHOLD,max:g.MAX_STATUS_CHANGE_THRESHOLD,value:c,onChange:e=>a("statusChangeThreshold",parseInt(e.currentTarget.value,10)),label:m,labelPopoverText:O,disabled:!o})),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiPanel,{borderRadius:"none",color:"subdued"},Object(b.jsx)(l.EuiText,{size:"s"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.flappingSettingsDescription",defaultMessage:"An alert is flapping if it changes status at least {statusChangeThreshold} in the last {lookBackWindow}.",values:{lookBackWindow:Object(b.jsx)("b",null,(d=u,r.i18n.translate("xpack.triggersActionsUI.rulesSettings.flapping.lookBackWindowLabelRuleRuns",{defaultMessage:"{amount, number} rule {amount, plural, one {run} other {runs}}",values:{amount:d}}))),statusChangeThreshold:Object(b.jsx)("b",null,y(c))}})))));var d})),k=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingDetectionDescription",{defaultMessage:"Detect alerts that switch quickly between active and recovered states and reduce unwanted noise for these flapping alerts."}),w=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingOnLabel",{defaultMessage:"On (recommended)"}),F=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.flappingOffLabel",{defaultMessage:"Off"}),I=Object(a.memo)((()=>Object(b.jsx)(l.EuiEmptyPrompt,{"data-test-subj":"rulesSettingsFlappingErrorPrompt",color:"danger",iconType:"warning",title:Object(b.jsx)("h4",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.flappingErrorPromptTitle",defaultMessage:"Unable to load your flapping settings"})),body:Object(b.jsx)("p",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.flappingErrorPromptBody",defaultMessage:"There was an error loading your flapping settings. Contact your administrator for help"}))}))),M=Object(a.memo)((e=>{const{settings:t,onChange:s,isSwitchDisabled:a}=e;return Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiFlexGroup,{direction:"column"},Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(b.jsx)("p",null,k))),Object(b.jsx)(l.EuiFlexItem,{grow:!1},Object(b.jsx)(l.EuiSwitch,{"data-test-subj":"rulesSettingsFlappingEnableSwitch",label:t.enabled?w:F,checked:t.enabled,disabled:a,onChange:s}))))})),C=Object(a.memo)((e=>{const{settings:t,onChange:s,canWrite:a}=e;return t?t.enabled?Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(E,{flappingSettings:t,onChange:s,canWrite:a})):Object(b.jsx)(l.EuiFlexItem,{"data-test-subj":"rulesSettingsFlappingOffPrompt"},Object(b.jsx)(l.EuiPanel,{borderRadius:"none",color:"subdued",grow:!1},Object(b.jsx)(l.EuiText,{size:"s"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.flapping.flappingSettingsOffDescription",defaultMessage:"Alert flapping detection is off. Alerts will be generated based on the rule interval, which might result in higher alert volumes."})))):null})),T=Object(a.memo)((e=>{const{onChange:t,settings:s,hasError:a,canShow:n,canWrite:i}=e;return n?a?Object(b.jsx)(I,null):Object(b.jsx)(l.EuiForm,{"data-test-subj":"rulesSettingsFlappingSection"},Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(S,null))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(M,{isSwitchDisabled:!i,settings:s,onChange:e=>t("enabled",e.target.checked)}),Object(b.jsx)(C,{settings:s,onChange:(e,s)=>t(e,s),canWrite:i}))):null})),U=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.queryDelayDescription",{defaultMessage:"Delay all rule queries to mitigate the impact of index refresh intervals on data availability."}),A=r.i18n.translate("xpack.triggersActionsUI.rulesSettings.queryDelayLabel",{defaultMessage:"Query delay length (seconds)"}),v=Object(a.memo)((()=>Object(b.jsx)(l.EuiEmptyPrompt,{"data-test-subj":"rulesSettingsQueryDelayErrorPrompt",color:"danger",iconType:"warning",title:Object(b.jsx)("h4",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.queryDelayErrorPromptTitle",defaultMessage:"Unable to load your query delay settings"})),body:Object(b.jsx)("p",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.queryDelayErrorPromptBody",defaultMessage:"There was an error loading your query delay settings. Contact your administrator for help"}))}))),D=()=>Object(b.jsx)(l.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.queryDelayTitle",defaultMessage:"Query delay"}))),_=Object(a.memo)((e=>{const{onChange:t,settings:s,hasError:a,canShow:n,canWrite:i}=e;return n?a?Object(b.jsx)(v,null):Object(b.jsx)(l.EuiForm,{"data-test-subj":"rulesSettingsQueryDelaySection"},Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(D,null))),Object(b.jsx)(l.EuiSpacer,{size:"s"}),Object(b.jsx)(l.EuiFlexGroup,null,Object(b.jsx)(l.EuiFlexItem,null,Object(b.jsx)(l.EuiText,{color:"subdued",size:"s"},Object(b.jsx)("p",null,U))),Object(b.jsx)(l.EuiFlexItem,{grow:!0},Object(b.jsx)(p,{"data-test-subj":"queryDelayRangeInput",min:g.MIN_QUERY_DELAY,max:g.MAX_QUERY_DELAY,value:s.delay,onChange:e=>t("delay",parseInt(e.currentTarget.value,10)),label:A,disabled:!i})))):null}));var W=s(56);const B=Object(a.memo)((()=>Object(b.jsx)(l.EuiEmptyPrompt,{"data-test-subj":"rulesSettingsErrorPrompt",color:"danger",iconType:"warning",title:Object(b.jsx)("h4",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.errorPromptTitle",defaultMessage:"Unable to load your rules settings"})),body:Object(b.jsx)("p",null,Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.errorPromptBody",defaultMessage:"There was an error loading your rules settings. Contact your administrator for help"}))}))),q=e=>{const t=Object(a.useRef)(e),[s,n]=Object(a.useState)(e),[l,i]=Object(a.useState)(!1);return[s,l,(e,s=!1)=>{n(e),i(!0),s&&(t.current=e)},()=>{n(t.current),i(!1)}]},R=Object(a.memo)((e=>{const{isVisible:t,onClose:s,setUpdatingRulesSettings:g,onSave:d}=e,{application:{capabilities:j},isServerless:p}=Object(o.b)().services,{rulesSettings:{writeFlappingSettingsUI:x,readFlappingSettingsUI:h,writeQueryDelaySettingsUI:m,readQueryDelaySettingsUI:O}}=j,[y,S,f,E]=q(),[k,w,F,I]=q(),{isLoading:M,isError:C}=(e=>{const{enabled:t,onSuccess:s}=e,{http:a}=Object(o.b)().services,{data:n,isFetching:l,isError:i,isLoadingError:r,isLoading:g}=Object(u.useQuery)({queryKey:["getFlappingSettings"],queryFn:()=>(async({http:e})=>(({look_back_window:e,status_change_threshold:t,...s})=>({...s,lookBackWindow:e,statusChangeThreshold:t}))(await e.get(`${c.m}/rules/settings/_flapping`)))({http:a}),onSuccess:s,enabled:t,refetchOnWindowFocus:!1,retry:!1});return{isLoading:g||l,isError:i||r,data:n}})({enabled:t,onSuccess:e=>{y||f({enabled:e.enabled,lookBackWindow:e.lookBackWindow,statusChangeThreshold:e.statusChangeThreshold},!0)}}),{isLoading:U,isError:A}=(e=>{const{enabled:t,onSuccess:s}=e,{http:a}=Object(o.b)().services,{data:n,isFetching:l,isError:i,isLoadingError:r,isLoading:g}=Object(u.useQuery)({queryKey:["getQueryDelaySettings"],queryFn:()=>(async({http:e})=>(({...e})=>({...e}))(await e.get(`${c.m}/rules/settings/_query_delay`)))({http:a}),onSuccess:s,enabled:t,refetchOnWindowFocus:!1,retry:!1});return{isLoading:g||l,isError:i||r,data:n}})({enabled:t,onSuccess:e=>{k||F({delay:e.delay},!0)}}),v=Object(a.useCallback)((()=>{E(),I(),s()}),[s,E,I]),{mutate:D}=(e=>{const{onSave:t,onClose:s,setUpdatingRulesSettings:a}=e,{http:n,notifications:{toasts:l}}=Object(o.b)().services;return Object(u.useMutation)({mutationFn:async e=>{const t=[];return e.flapping&&t.push((async({http:e,flappingSettings:t})=>{let s;try{s=JSON.stringify({enabled:t.enabled,look_back_window:t.lookBackWindow,status_change_threshold:t.statusChangeThreshold})}catch(e){throw new Error(`Unable to parse flapping settings update params: ${e}`)}return(({look_back_window:e,status_change_threshold:t,...s})=>({...s,lookBackWindow:e,statusChangeThreshold:t}))(await e.post(`${c.m}/rules/settings/_flapping`,{body:s}))})({http:n,flappingSettings:e.flapping})),e.queryDelay&&t.push((async({http:e,queryDelaySettings:t})=>{let s;try{s=JSON.stringify({delay:t.delay})}catch(e){throw new Error(`Unable to parse query delay settings update params: ${e}`)}return(({...e})=>({...e}))(await e.post(`${c.m}/rules/settings/_query_delay`,{body:s}))})({http:n,queryDelaySettings:e.queryDelay})),await Promise.all(t)},onMutate:()=>{s(),null==a||a(!0)},onSuccess:()=>{l.addSuccess(r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.updateRulesSettingsSuccess",{defaultMessage:"Rules settings updated successfully."}))},onError:()=>{l.addDanger(r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.updateRulesSettingsFailure",{defaultMessage:"Failed to update rules settings."}))},onSettled:()=>{null==a||a(!1),null==t||t()}})})({onSave:d,onClose:s,setUpdatingRulesSettings:g}),R=x&&!C,L=h,P=m&&!A,z=O,H=(e,t,s)=>{if("flapping"===e){if(!y)return;const e={...y,[t]:s};f({...e,statusChangeThreshold:Math.min(e.lookBackWindow,e.statusChangeThreshold)})}if("queryDelay"===e){if(!k)return;const e={...k,[t]:s};F(e)}};return t?Object(b.jsx)(l.EuiModal,{"data-test-subj":"rulesSettingsModal",onClose:v,maxWidth:880},Object(b.jsx)(l.EuiModalHeader,null,Object(b.jsx)(l.EuiModalHeaderTitle,{component:"h3"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.title",defaultMessage:"Rule settings"}))),Object(b.jsx)(l.EuiModalBody,null,Object(b.jsx)(l.EuiCallOut,{size:"s",title:r.i18n.translate("xpack.triggersActionsUI.rulesSettings.modal.calloutMessage",{defaultMessage:"Apply to all rules within the current space."})}),Object(b.jsx)(l.EuiHorizontalRule,null),L||z?M||U?Object(b.jsx)(W.a,null):Object(b.jsx)(n.a.Fragment,null,y&&Object(b.jsx)(T,{onChange:(e,t)=>H("flapping",e,t),settings:y,canWrite:R,canShow:L,hasError:C}),p&&k&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(_,{onChange:(e,t)=>H("queryDelay",e,t),settings:k,canWrite:P,canShow:z,hasError:A}))):Object(b.jsx)(B,null),Object(b.jsx)(l.EuiSpacer,null),Object(b.jsx)(l.EuiHorizontalRule,{margin:"none"})),Object(b.jsx)(l.EuiModalFooter,null,Object(b.jsx)(l.EuiButtonEmpty,{"data-test-subj":"rulesSettingsModalCancelButton",onClick:v},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.cancelButton",defaultMessage:"Cancel"})),Object(b.jsx)(l.EuiButton,{fill:!0,"data-test-subj":"rulesSettingsModalSaveButton",onClick:()=>{const e={};R&&S&&(e.flapping=y,f(y,!0)),P&&w&&(e.queryDelay=k,F(k,!0)),D(e)},disabled:!R&&!P},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.modal.saveButton",defaultMessage:"Save"})))):null})),L=()=>{const[e,t]=Object(a.useState)(!1),{application:{capabilities:s}}=Object(o.b)().services,{show:r,readFlappingSettingsUI:u,readQueryDelaySettingsUI:c}=s.rulesSettings;return r&&(u||c)?Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(l.EuiButtonEmpty,{onClick:()=>t(!0),iconType:"gear","data-test-subj":"rulesSettingsLink"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.rulesSettings.link.title",defaultMessage:"Settings"})),Object(b.jsx)(R,{isVisible:e,onClose:()=>t(!1)})):null}}}]);