/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[59],{84:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return k}));var a=s(1),n=s.n(a),c=s(24),i=s(3),u=s(2),l=s(10),o=s(145),r=s(11),d=s(190),j=s(170),b=s(19),m=s(222),O=s(215),g=s(185),f=s(37),p=s(172),x=s(0);const y=({onConfirm:e,onCancel:t})=>Object(x.jsx)(i.EuiConfirmModal,{title:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:t,onConfirm:e,confirmButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleSaveModal"},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var v=s(216),S=s(131),h=s(143);const C=({isSaving:e,onSave:t,onCancel:s,onShowRequest:a,isFormLoading:l,isRuleValid:o})=>{const{loadingHealthCheck:r}=Object(h.b)();return Object(x.jsx)(i.EuiFlyoutFooter,null,Object(x.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButtonEmpty,{"data-test-subj":"cancelSaveRuleButton",onClick:s},u.i18n.translate("xpack.triggersActionsUI.sections.ruleAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),l?Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiSpacer,{size:"s"}),Object(x.jsx)(i.EuiLoadingSpinner,{size:"l"})):Object(x.jsx)(n.a.Fragment,null),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"m"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButton,{fill:!0,color:"primary","data-test-subj":"showRequestButton",isDisabled:r||!o,onClick:a},Object(x.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.showRequestButtonLabel",defaultMessage:"Show API request"}))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButton,{fill:!0,color:"success","data-test-subj":"saveRuleButton",type:"submit",iconType:"check",isDisabled:r,isLoading:e,onClick:t},Object(x.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.saveButtonLabel",defaultMessage:"Save"})))))))};var E=s(29),I=s(217),T=s(60),R=s(6),w=s(233),F=s(160),A=s(218);const M=u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}),k=({consumer:e,ruleTypeRegistry:t,actionTypeRegistry:s,onClose:n,canChangeTrigger:k,ruleTypeId:B,initialValues:U,reloadRules:L,onSave:D,hideGrouping:N,hideInterval:P,metadata:q,filteredRuleTypes:z,validConsumers:G,useRuleProducer:V,initialSelectedConsumer:_,...H})=>{var W;const Y=null!=D?D:L,[J,K]=Object(a.useState)(q),Q=Object(a.useCallback)((e=>K(e)),[]),X=Object(a.useMemo)((()=>({params:{},consumer:e,ruleTypeId:B,schedule:{interval:R.h},actions:[],tags:[],...U||{}})),[B,e,U]),Z=Object(a.useMemo)((()=>Object(g.a)(s)),[s]),[{rule:$},ee]=Object(a.useReducer)(Z,{rule:X}),[te,se]=Object(a.useState)({isUsingSecurity:!1}),[ae,ne]=Object(a.useState)({}),[ce,ie]=Object(a.useState)(!1),[ue,le]=Object(a.useState)(!1),[oe,re]=Object(a.useState)(!1),[de,je]=Object(a.useState)(!1),[be,me]=Object(a.useState)(H.ruleTypeIndex),[Oe,ge]=Object(a.useState)(!1),[fe,pe]=Object(a.useState)(!1),xe=Object(a.useMemo)((()=>$.ruleTypeId&&R.o.includes($.ruleTypeId)),[$]),[ye,ve]=Object(a.useState)(xe?_:null),Se=(e,t)=>{ee({command:{type:"setProperty"},payload:{key:e,value:t}})},{http:he,notifications:{toasts:Ce},application:{capabilities:Ee},i18n:Ie,theme:Te,isServerless:Re}=Object(E.b)().services,we=Object(S.f)(Ee);Object(a.useEffect)((()=>{(async()=>{se(await Object(j.a)({http:he}))})()}),[he]),Object(a.useEffect)((()=>{B&&Se("ruleTypeId",B)}),[B]),Object(a.useEffect)((()=>{H.ruleTypeIndex||(async()=>{const e=await Object(f.a)({http:he}),t=new Map;for(const s of e)t.set(s.id,s);me(t)})()}),[H.ruleTypeIndex,he]),Object(a.useEffect)((()=>{Object(l.isEmpty)($.params)&&!Object(l.isEmpty)(ae)?ne({}):Object(l.isEmpty)(ae)&&ne($.params)}),[$.params,ae]);const[Fe,Ae]=Object(a.useState)([]),[Me,ke]=Object(a.useState)(!1);Object(a.useEffect)((()=>{(async()=>{ke(!0);const e=await Object(O.a)($.actions,s);ke(!1),Ae([...e])})()}),[$.actions,s]),Object(a.useEffect)((()=>{var e;!te.minimumScheduleInterval||null!=U&&null!==(e=U.schedule)&&void 0!==e&&e.interval||Se("schedule",{interval:Object(w.a)(te.minimumScheduleInterval.value)})}),[te.minimumScheduleInterval,U]),Object(a.useEffect)((()=>{if($.ruleTypeId&&be){const e=be.get($.ruleTypeId);null!=e&&e.defaultScheduleInterval&&!Oe&&Se("schedule",{interval:e.defaultScheduleInterval})}}),[$.ruleTypeId,be,$.schedule.interval,Oe]),Object(a.useEffect)((()=>{$.schedule.interval===R.h||Oe||ge(!0)}),[$.schedule.interval,Oe]);const Be=()=>{Object(I.a)($,X,!1)||Object(I.b)($.params,ae)?re(!0):n(b.l.CANCELED,J)},Ue=async()=>{const e=await async function(){try{const e=await Object(d.a)({http:he,rule:{...$,...xe&&ye?{consumer:ye}:{}}});return Ce.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:e.name}})),e}catch(t){var e;const s=Object(r.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||M);Ce.addDanger({title:s.summary,...s.details&&{text:Object(o.a)(Object(x.jsx)(F.a,null,s.details),{i18n:Ie,theme:Te})}})}}();ie(!1),e&&(n(b.l.SAVED,J),Y&&Y(J))},Le=$.ruleTypeId?t.get($.ruleTypeId):null,{ruleBaseErrors:De,ruleErrors:Ne,ruleParamsErrors:Pe}=Object(a.useMemo)((()=>Object(O.b)({...$,...xe&&void 0!==ye?{consumer:ye}:{}},Le,te,s,Re)),[$,xe,ye,Le,te,s,Re]),qe=we&&0===(null===(W=$.actions)||void 0===W?void 0:W.length);return Object(a.useEffect)((()=>{pe(Object(O.c)($,Ne,Fe))}),[$,Ne,Fe]),Object(x.jsx)(i.EuiPortal,null,Object(x.jsx)(i.EuiFlyout,{onClose:Be,"aria-labelledby":"flyoutRuleAddTitle",size:"m",maxWidth:620,ownFocus:!0},Object(x.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(i.EuiTitle,{size:"s","data-test-subj":"addRuleFlyoutTitle"},Object(x.jsx)("h3",{id:"flyoutTitle"},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.ruleAdd.flyoutTitle"})))),Object(x.jsx)(h.a,null,Object(x.jsx)(p.a,{inFlyout:!0,waitForCheck:!0},Object(x.jsx)(i.EuiFlyoutBody,null,Object(x.jsx)(m.a,{canShowConsumerSelection:!0,rule:$,config:te,dispatch:ee,errors:Ne,canChangeTrigger:k,operation:u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.operationName",{defaultMessage:"create"}),validConsumers:G,selectedConsumer:ye,actionTypeRegistry:s,ruleTypeRegistry:t,metadata:J,filteredRuleTypes:z,hideGrouping:N,hideInterval:P,onChangeMetaData:Q,setConsumer:ve,useRuleProducer:V,initialSelectedConsumer:_})),Object(x.jsx)(C,{isSaving:ce,isFormLoading:Me,isRuleValid:fe,onSave:async()=>{if(ie(!0),Me||!Object(O.c)($,Ne,Fe))return e=Object(T.a)($,Pe,De,Fe),ee({command:{type:"setRule"},payload:{key:"rule",value:e}}),void ie(!1);var e;qe?le(!0):await Ue()},onCancel:Be,onShowRequest:()=>{je(!0)}}))),ue&&Object(x.jsx)(y,{onConfirm:async()=>{le(!1),await Ue()},onCancel:()=>{ie(!1),le(!1)}}),oe&&Object(x.jsx)(v.a,{onConfirm:()=>{re(!1),n(b.l.CANCELED,J)},onCancel:()=>{re(!1)}}),de&&Object(x.jsx)(A.a,{onClose:()=>{je(!1)},rule:{...$,...xe&&ye?{consumer:ye}:{}}})))}}}]);