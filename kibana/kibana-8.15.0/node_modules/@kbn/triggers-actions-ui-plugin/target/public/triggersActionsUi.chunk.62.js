/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[62],{81:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleEdit",(function(){return F})),s.d(t,"default",(function(){return F}));var i=s(1),a=s.n(i),n=s(24),c=s(11),o=s(3),l=s(10),r=s(2),u=s(145),j=s(191),d=s(170),b=s(19),g=s(222),O=s(215),x=s(185),y=s(37),E=s(172),p=s(143),f=s(29),h=s(216),m=s(217),T=s(60),S=s(160),I=s(218),v=s(0);const w=r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}),C=e=>{const t=Object(l.cloneDeep)(Object(l.omit)(e,"notifyWhen","throttle")),s=Boolean(e.notifyWhen),i=Boolean(e.throttle);if(s||i){const i=s?{summary:!1,notifyWhen:e.notifyWhen,throttle:e.notifyWhen===c.RuleNotifyWhen.THROTTLE?e.throttle:null}:{summary:!1,notifyWhen:c.RuleNotifyWhen.THROTTLE,throttle:e.throttle};t.actions=t.actions.map((e=>(e=>"group"in e&&Boolean(e.group))(e)?{...e,frequency:i}:e))}return t},F=({initialRule:e,onClose:t,reloadRules:s,onSave:l,hideInterval:F,ruleTypeRegistry:R,actionTypeRegistry:A,metadata:k,...B})=>{const M=null!=l?l:s,U=Object(i.useMemo)((()=>Object(x.a)(A)),[A]),[{rule:W},L]=Object(i.useReducer)(U,{rule:C(e)}),[D,N]=Object(i.useState)(!1),[z,H]=Object(i.useState)(!1),[P,q]=Object(i.useState)(!1),[_,G]=Object(i.useState)(!1),[V,J]=Object(i.useState)(!1),[K,Q]=Object(i.useState)(!1),[X,Y]=Object(i.useState)([]),[Z,$]=Object(i.useState)(!1),[ee,te]=Object(i.useState)(B.ruleType),[se,ie]=Object(i.useState)({isUsingSecurity:!1}),[ae,ne]=Object(i.useState)(k),ce=Object(i.useCallback)((e=>ne(e)),[]),{http:oe,notifications:{toasts:le},i18n:re,theme:ue,isServerless:je}=Object(f.b)().services,de=R.get(W.ruleTypeId);Object(i.useEffect)((()=>{(async()=>{ie(await Object(d.a)({http:oe}))})()}),[oe]),Object(i.useEffect)((()=>{(async()=>{$(!0);const e=await Object(O.a)(W.actions,A);Y([...e]),$(!1)})()}),[W.actions,A]),Object(i.useEffect)((()=>{B.ruleType||ee||(async()=>{const e=await Object(y.a)({http:oe});for(const t of e)de.id===t.id&&te(t)})()}),[B.ruleType,de.id,ee,oe]);const{ruleBaseErrors:be,ruleErrors:ge,ruleParamsErrors:Oe}=Object(O.b)(W,de,se,A,je),xe=()=>{Object(m.a)(W,e,!0)?G(!0):t(b.l.CANCELED,ae)};return Object(i.useEffect)((()=>{Q(Object(O.c)(W,ge,X))}),[W,ge,X]),Object(v.jsx)(o.EuiPortal,null,Object(v.jsx)(o.EuiFlyout,{onClose:xe,"aria-labelledby":"flyoutRuleEditTitle",size:"m",maxWidth:620,ownFocus:!0},Object(v.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(v.jsx)(o.EuiTitle,{size:"s","data-test-subj":"editRuleFlyoutTitle"},Object(v.jsx)("h3",{id:"flyoutTitle"},Object(v.jsx)(n.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.ruleEdit.flyoutTitle"})))),Object(v.jsx)(p.a,null,Object(v.jsx)(E.a,{inFlyout:!0,waitForCheck:!0},Object(v.jsx)(o.EuiFlyoutBody,null,z&&Object(v.jsx)(a.a.Fragment,null,Object(v.jsx)(o.EuiCallOut,{size:"s",color:"danger",iconType:"error","data-test-subj":"hasActionsDisabled",title:r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(v.jsx)(o.EuiSpacer,null)),Object(v.jsx)(g.a,{rule:W,config:se,dispatch:L,errors:ge,actionTypeRegistry:A,hideInterval:F,ruleTypeRegistry:R,canChangeTrigger:!1,setHasActionsDisabled:H,setHasActionsWithBrokenConnector:q,operation:r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.operationName",{defaultMessage:"edit"}),metadata:ae,onChangeMetaData:ce})),Object(v.jsx)(o.EuiFlyoutFooter,null,Object(v.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedRuleButton",onClick:()=>xe()},r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),Z?Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiSpacer,{size:"s"}),Object(v.jsx)(o.EuiLoadingSpinner,{size:"l"})):Object(v.jsx)(a.a.Fragment,null),Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiButton,{fill:!0,color:"primary","data-test-subj":"showEditedRequestButton",isDisabled:!K,onClick:()=>{J(!0)}},Object(v.jsx)(n.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.showRequestButtonLabel",defaultMessage:"Show API request"}))),Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiButton,{fill:!0,color:"success","data-test-subj":"saveEditedRuleButton",type:"submit",iconType:"check",isLoading:D,onClick:async()=>await async function(){N(!0);try{if(Z||!Object(O.c)(W,ge,X)||P)s=Object(T.a)(W,Oe,be,X),L({command:{type:"setRule"},payload:{key:"rule",value:s}});else{const e=await Object(j.c)({http:oe,rule:W,id:W.id});le.addSuccess(r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveSuccessNotificationText",{defaultMessage:"Updated ''{ruleName}''",values:{ruleName:e.name}})),t(b.l.SAVED,ae),M&&M(ae)}}catch(t){var e;const s=Object(c.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||w);le.addDanger({title:s.summary,...s.details&&{text:Object(u.a)(Object(v.jsx)(S.a,null,s.details),{i18n:re,theme:ue})}})}var s;N(!1)}()},Object(v.jsx)(n.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.saveButtonLabel",defaultMessage:"Save"}))),se.isUsingSecurity&&Object(v.jsx)(o.EuiFlexItem,{grow:!1},Object(v.jsx)(o.EuiIconTip,{type:"warning",position:"top","data-test-subj":"changeInPrivilegesTip",content:r.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.changeInPrivilegesLabel",{defaultMessage:"Saving this rule will change its privileges and might change its behavior."})})))))))),_&&Object(v.jsx)(h.a,{onConfirm:()=>{G(!1),t(b.l.CANCELED,ae)},onCancel:()=>{G(!1)}}),V&&Object(v.jsx)(I.a,{onClose:()=>{J(!1)},rule:W,ruleId:W.id,edit:!0})))}}}]);