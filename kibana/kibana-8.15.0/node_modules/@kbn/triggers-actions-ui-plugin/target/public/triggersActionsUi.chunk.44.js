/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[44,49,63],{118:function(e,t,n){"use strict";n.r(t),n.d(t,"RuleDefinition",(function(){return f})),n.d(t,"default",(function(){return f}));var s=n(12),i=n.n(s),r=n(1),o=n(3),l=n(128),u=n(2),a=n(11),c=n(57),j=n(29),d=n(131),x=n(80),b=n(21);var g=n(209),p=n(0);function O({ruleActions:e,actionTypeRegistry:t,legacyNotifyWhen:n}){const{isLoadingActionConnectors:s,actionConnectors:i}=function({ruleActions:e}){const{http:t,notifications:{toasts:n}}=Object(j.b)().services,[s,i]=Object(r.useState)({isLoadingActionConnectors:!0,actionConnectors:[],errorActionConnectors:void 0}),o=Object(r.useCallback)((async()=>{try{if(!e||e.length<=0)return void i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:[]})));const n=await Object(b.e)({http:t,includeSystemActions:!0});i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:n})))}catch(e){const t=(s=e instanceof Error?e.message:"string"==typeof e?e:"",u.i18n.translate("xpack.triggersActionsUI.ruleDetails.connectorsLoadError",{defaultMessage:"Unable to load rule actions connectors. Reason: {message}",values:{message:s}}));i((e=>({...e,isLoadingActionConnectors:!1,errorActionConnectors:t}))),n.addDanger({title:t})}var s}),[t,e,n]);return Object(r.useEffect)((()=>{o()}),[o]),{...s,reloadRuleActionConnectors:o}}({ruleActions:e}),l=i&&i.length>0,a=e&&e.length>0;if(!l||!a)return Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{size:"s"},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.noActions",{defaultMessage:"No actions"})));const c=e=>{const n=t.list().find((t=>t.id===e));return"string"==typeof(null==n?void 0:n.iconClass)?null==n?void 0:n.iconClass:Object(x.suspendedComponentWithProps)(null==n?void 0:n.iconClass)};return s?Object(p.jsx)(o.EuiLoadingSpinner,{size:"s"}):Object(p.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},e.map(((e,s)=>{var r;const{actionTypeId:l,id:u}=e,a=(e=>{const t=i.find((t=>t.id===e));return null==t?void 0:t.name})(u);return Object(p.jsx)(o.EuiFlexItem,{key:s},Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",component:"span"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiIcon,{size:"m",type:null!==(r=c(l))&&void 0!==r?r:"apps"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{"data-test-subj":`actionConnectorName-${s}-${a||l}`,size:"s"},a),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",component:"span"},Object(p.jsx)(o.EuiSpacer,{size:"xs"}),Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiIcon,{size:"s",type:"bell"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{"data-test-subj":`actionConnectorName-notify-text${s}-${a||l}`,size:"xs"},String(((e,t)=>{if(t)return g.NOTIFY_WHEN_OPTIONS[1].inputDisplay;if("frequency"in e){var s,i,r,o;const t=g.NOTIFY_WHEN_OPTIONS.find((t=>{var n;return t.value===(null===(n=e.frequency)||void 0===n?void 0:n.notifyWhen)}));return null!==(s=null!==(i=null!==(r=null==t?void 0:t.inputDisplay)&&void 0!==r?r:null===(o=e.frequency)||void 0===o?void 0:o.notifyWhen)&&void 0!==i?i:n)&&void 0!==s?s:""}return""})(e,t.get(l).isSystemActionType))))))),Object(p.jsx)(o.EuiSpacer,{size:"s"}))})))}var m=n(42);const f=({rule:e,actionTypeRegistry:t,ruleTypeRegistry:n,onEditRule:s,hideEditButton:i=!1,filteredRuleTypes:x=[]})=>{var b;const{application:{capabilities:g}}=Object(j.b)().services,[f,E]=Object(r.useState)(!1),[I,h]=Object(r.useState)(),{ruleTypesState:{data:F,isLoading:A}}=Object(c.a)({filteredRuleTypes:x}),T=Object(r.useMemo)((()=>[...F.values()]),[F]),S=Object(r.useMemo)((()=>{if(T.length&&e)return T.find((t=>t.id===e.ruleTypeId))}),[e,T]);Object(r.useEffect)((()=>{h(S)}),[S]);const C=()=>{const t=null!=e&&e.params.criteria?(null==e?void 0:e.params.criteria).length:0;return u.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditions",{defaultMessage:"{numberOfConditions, plural, one {# condition} other {# conditions}}",values:{numberOfConditions:t}})},M=Object(d.f)(g),k=Object(d.c)(g),z=e&&Object(d.a)(e.consumer,I)&&(k||!k&&0===e.actions.length),D=Object(r.useMemo)((()=>!i&&z&&!!n.has(e.ruleTypeId)&&!n.get(e.ruleTypeId).requiresAppContext),[i,z,n,e]),N=Object(r.useMemo)((()=>n.has(e.ruleTypeId)?n.get(e.ruleTypeId).description:e.consumer===l.a.SIEM?u.i18n.translate("xpack.triggersActionsUI.ruleDetails.securityDetectionRule",{defaultMessage:"Security detection rule"}):""),[e,n]);return Object(p.jsx)(o.EuiFlexItem,{"data-test-subj":"ruleSummaryRuleDefinition",grow:3},Object(p.jsx)(o.EuiPanel,{color:"subdued",hasBorder:!1,paddingSize:"m"},Object(p.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(p.jsx)(o.EuiTitle,{size:"s"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.definition",{defaultMessage:"Definition"}))),A?Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleDetailsEditButtonLoadingSpinner"})):D&&Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiButtonEmpty,{"data-test-subj":"ruleDetailsEditButton",iconType:"pencil",onClick:()=>E(!0)}))),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiFlexGroup,null,Object(p.jsx)(v,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.ruleType",{defaultMessage:"Rule type"})),A?Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleSummaryRuleTypeLoadingSpinner"})):Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleType",itemValue:(null===(b=F.get(e.ruleTypeId))||void 0===b?void 0:b.name)||e.ruleTypeId})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"flexStart",responsive:!1},Object(p.jsx)(v,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.description",{defaultMessage:"Description"})),Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleDescription",itemValue:N})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,null,Object(p.jsx)(v,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.runsEvery",{defaultMessage:"Runs every"})),Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleInterval",itemValue:Object(a.formatDuration)(e.schedule.interval)})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center"},Object(p.jsx)(v,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditionsTitle",{defaultMessage:"Conditions"})),Object(p.jsx)(o.EuiFlexItem,{grow:3},Object(p.jsx)(o.EuiFlexGroup,{"data-test-subj":"ruleSummaryRuleConditions",alignItems:"center",gutterSize:"none"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},D?Object(p.jsx)(o.EuiButtonEmpty,{onClick:()=>E(!0),flush:"left"},Object(p.jsx)(o.EuiText,{size:"s"},C())):Object(p.jsx)(o.EuiText,{size:"s"},C()))))),Object(p.jsx)(o.EuiSpacer,{size:"m"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(p.jsx)(v,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.actions",{defaultMessage:"Actions"})),Object(p.jsx)(o.EuiFlexItem,{grow:3},M?Object(p.jsx)(O,{ruleActions:e.actions,actionTypeRegistry:t,legacyNotifyWhen:e.notifyWhen}):Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{size:"s"},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.cannotReadActions",{defaultMessage:"Connector feature privileges are required to view actions"})))))))),f&&Object(p.jsx)(m.b,{onSave:()=>(E(!1),s()),initialRule:e,onClose:()=>E(!1),ruleTypeRegistry:n,actionTypeRegistry:t}))};function y({itemValue:e,extraSpace:t=!0,...n}){return Object(p.jsx)(o.EuiFlexItem,i()({grow:t?3:1},n),Object(p.jsx)(o.EuiText,{size:"s"},e))}function v({children:e}){return Object(p.jsx)(o.EuiTitle,{size:"xxs"},Object(p.jsx)(o.EuiFlexItem,{style:{whiteSpace:"nowrap"},grow:1},e))}},131:function(e,t,n){"use strict";n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u}));const s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},r=(e,t)=>{var n,s;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(s=e.actions)||void 0===s?void 0:s.execute},o=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function l(e,t){var n,s;return null!==(n=null==t||null===(s=t.authorizedConsumers[e])||void 0===s?void 0:s.all)&&void 0!==n&&n}const u=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},209:function(e,t,n){"use strict";n.r(t),n.d(t,"NOTIFY_WHEN_OPTIONS",(function(){return d})),n.d(t,"RuleNotifyWhen",(function(){return x}));var s=n(1),i=n.n(s),r=n(2),o=n(24),l=n(3),u=n(159),a=n(146),c=n(51),j=n(0);const d=[{value:"onActionGroupChange",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))},{value:"onActiveAlert",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))},{value:"onThrottleInterval",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}],x=({rule:e,throttle:t,throttleUnit:n,onNotifyWhenChange:x,onThrottleChange:b})=>{const[g,p]=Object(s.useState)(t||1),[O,m]=Object(s.useState)(!1),[f,y]=Object(s.useState)("onActionGroupChange");Object(s.useEffect)((()=>{e.notifyWhen?y(e.notifyWhen):y(e.throttle?"onThrottleInterval":"onActiveAlert")}),[e]),Object(s.useEffect)((()=>{m("onThrottleInterval"===f)}),[f]);const v=Object(s.useCallback)((e=>{b("onThrottleInterval"===e?g:null,n),x(e),y(e)}),[]),E=Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(o.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.renotifyFieldLabel",defaultMessage:"Notify"})," ",Object(j.jsx)(l.EuiIconTip,{position:"right",type:"questionInCircle",content:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.renotifyWithTooltip",{defaultMessage:"Define how often alerts generate actions."})}));return Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiFormRow,{fullWidth:!0,label:E},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiSuperSelect,{"data-test-subj":"notifyWhenSelect",options:d,valueOfSelected:f,onChange:v}),O&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiSpacer,null),Object(j.jsx)(l.EuiFormRow,{fullWidth:!0},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiFieldNumber,{fullWidth:!0,min:1,value:g,name:"throttle","data-test-subj":"throttleInput",prepend:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.label",{defaultMessage:"Every"}),onChange:e=>{Object(a.pipe)(Object(u.some)(e.target.value.trim()),Object(u.filter)((e=>""!==e)),Object(u.map)((e=>parseInt(e,10))),Object(u.filter)((e=>!isNaN(e))),Object(u.map)((e=>{p(e),b(e,n)})))}})),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiSelect,{"data-test-subj":"throttleUnitInput",value:n,options:Object(c.b)(null!=t?t:1),onChange:e=>{b(t,e.target.value)}})))))))))}}}]);