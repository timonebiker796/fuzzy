/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[40],{186:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a={all:["triggersActionsUi"],alertsTable:()=>[...a.all,"alertsTable"],cases:()=>[...a.alertsTable(),"cases"],mutedAlerts:()=>[...a.alertsTable(),"mutedAlerts"],casesBulkGet:e=>[...a.cases(),"bulkGet",e],maintenanceWindows:()=>[...a.alertsTable(),"maintenanceWindows"],maintenanceWindowsBulkGet:e=>[...a.maintenanceWindows(),"bulkGet",e]}},236:function(e,t,n){"use strict";var a=n(22);n.d(t,"a",(function(){return a.c}))},246:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var a=n(2),s=n(4),i=n(29),r=n(1),l=n(134),o=n.n(l),c=n(103),u=n(186),d=n(11);const b=a.i18n.translate("xpack.triggersActionsUI.alertsTable.api.bulkGetMaintenanceWindow.errorTitle",{defaultMessage:"Error fetching maintenance windows data"}),m=e=>{const t=new Map;for(const a of null!==(n=null==e?void 0:e.maintenanceWindows)&&void 0!==n?n:[]){var n;t.set(a.id,{...a})}return t},j=e=>{const{ids:t,canFetchMaintenanceWindows:n=!1,queryContext:a}=e,{http:l,notifications:{toasts:j},application:{capabilities:{maintenanceWindow:{show:g}}}}=Object(i.b)().services,{isAtLeastPlatinum:x}=(()=>{var e;const{licensing:t}=Object(i.b)().services,n=o()(null!==(e=null==t?void 0:t.license$)&&void 0!==e?e:new c.Observable,null),a=Object(r.useCallback)((e=>!!n&&n.isAvailable&&n.isActive&&n.hasAtLeast(e)),[n]);return{isAtLeastPlatinum:Object(r.useCallback)((()=>a("platinum")),[a])}})(),w=x(),{data:O,isFetching:p}=Object(s.useQuery)({queryKey:u.a.maintenanceWindowsBulkGet(t),enabled:w&&g&&t.length>0&&n,select:m,queryFn:()=>(async({http:e,ids:t})=>{return{maintenanceWindows:(n=await e.post(`${d.INTERNAL_ALERTING_API_MAINTENANCE_WINDOW_PATH}/_bulk_get`,{body:JSON.stringify({ids:t})})).maintenance_windows.map((e=>(({expiration_date:e,r_rule:t,created_by:n,updated_by:a,created_at:s,updated_at:i,event_start_time:r,event_end_time:l,category_ids:o,...c})=>({...c,expirationDate:e,rRule:t,createdBy:n,updatedBy:a,createdAt:s,updatedAt:i,eventStartTime:r,eventEndTime:l,categoryIds:o}))(e))),errors:n.errors.map((e=>(({status_code:e,...t})=>({...t,statusCode:e}))(e)))};var n})({http:l,ids:t}),onError:e=>{j.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:b})},context:a});return{data:O,isFetching:p}}},247:function(e,t,n){"use strict";n.d(t,"a",(function(){return w})),n.d(t,"b",(function(){return O}));var a=n(1),s=n.n(a),i=n(3),r=n(71),l=n(33),o=n.n(l),c=n(2),u=n(11),d=n(0);const b=c.i18n.translate("xpack.triggersActionsUI.alertsTable.maintenanceWindowTooltip.startTime",{defaultMessage:"Start"}),m=c.i18n.translate("xpack.triggersActionsUI.alertsTable.maintenanceWindowTooltip.endTime",{defaultMessage:"End"}),j={name:"19h62v5",styles:"text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden;word-break:break-word"},g=Object(a.memo)((e=>{const{maintenanceWindow:t,timestamp:n}=e,{title:s,events:r,eventStartTime:l,eventEndTime:c}=t,g=Object(a.useMemo)((()=>({gte:l,lte:c})),[l,c]),x=Object(a.useMemo)((()=>n&&r.find((({gte:e,lte:t})=>o()(n).isBetween(e,t,void 0,"[]")))||g),[r,n,g]);return Object(d.jsx)(i.EuiFlexGroup,{"data-test-subj":"maintenance-window-tooltip-content",gutterSize:"xs",direction:"column"},Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiText,{size:"relative",css:j},Object(d.jsx)("strong",null,s))),Object(d.jsx)(i.EuiHorizontalRule,{margin:"none"}),Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiFlexGroup,{gutterSize:"xs",direction:"row"},Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiText,{size:"relative"},b,":")),Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiText,{size:"relative"},Object(i.formatDate)(x.gte,u.MAINTENANCE_WINDOW_DATE_FORMAT))))),Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiFlexGroup,{gutterSize:"xs",direction:"row"},Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiText,{size:"relative"},m,":")),Object(d.jsx)(i.EuiFlexItem,{grow:!1},Object(d.jsx)(i.EuiText,{size:"relative"},Object(i.formatDate)(x.lte,u.MAINTENANCE_WINDOW_DATE_FORMAT))))))})),x=e=>!!e,w=Object(a.memo)((e=>{const{maintenanceWindows:t,maintenanceWindowIds:n,isLoading:r,timestamp:l}=e,o=Object(a.useMemo)((()=>{const e=t.length+n.length;return Object(d.jsx)(s.a.Fragment,null,t.map(((t,n)=>Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)(i.EuiToolTip,{key:`${t.id}_tooltip`,content:Object(d.jsx)(g,{maintenanceWindow:t,timestamp:l})},Object(d.jsx)("span",{key:`${t.id}_title`},t.title,n!==e-1&&Object(d.jsx)(s.a.Fragment,null,",  ")))))),n.map(((n,a)=>Object(d.jsx)(s.a.Fragment,null,Object(d.jsx)("span",{key:`${n}_id`},n,a+t.length!==e-1&&Object(d.jsx)(s.a.Fragment,null,",  "))))))}),[t,n,l]);return Object(d.jsx)(i.EuiSkeletonText,{"data-test-subj":"maintenance-window-cell-loading",lines:1,isLoading:r,size:"s"},o)})),O=Object(a.memo)((e=>{var t;const{alert:n,maintenanceWindows:i,isLoading:l}=e,o=Object(a.useMemo)((()=>(n&&n[r.j]||[]).map((e=>i.get(e))).filter(x)),[n,i]),c=Object(a.useMemo)((()=>(n&&n[r.j]||[]).filter((e=>!i.get(e)))),[n,i]);return 0===o.length&&0===c.length?Object(d.jsx)(s.a.Fragment,null,"--"):Object(d.jsx)(w,{maintenanceWindows:o,maintenanceWindowIds:c,isLoading:l,timestamp:n&&(null===(t=n[r.K])||void 0===t?void 0:t[0])})}));O.displayName="maintenanceWindowCell"},383:function(e,t,n){"use strict";n.r(t),n.d(t,"getConvertedAlertStatus",(function(){return x})),n.d(t,"RuleAlertList",(function(){return v})),n.d(t,"default",(function(){return v}));var a=n(1),s=n(33),i=n.n(s),r=n(10),l=n(3),o=n(2),c=n(129),u=n(6),d=n(0);const b=({alert:e,onMuteAction:t,disabled:n})=>{const[s,i]=Object(a.useState)(null==e?void 0:e.isMuted),[r,o]=Object(a.useState)(!1);return r?Object(d.jsx)(l.EuiLoadingSpinner,{size:"m"}):Object(d.jsx)(l.EuiSwitch,{name:"mute",disabled:n,compressed:!0,checked:s,onChange:async()=>{o(!0),await t(e),i(!s),o(!1)},"data-test-subj":`muteAlertButton_${e.alert}`,showLabel:!1,label:"mute"})};var m=n(236),j=n(246),g=n(247);const x=(e,t)=>t.tracked?"Active"===e?c.a:c.b:c.c,w=()=>({"data-test-subj":"alert-row"}),O=()=>({"data-test-subj":"cell"}),p=e=>!!e,f=e=>{var t;const{alert:n,maintenanceWindows:s,isLoading:i}=e,r=Object(a.useMemo)((()=>(n.maintenanceWindowIds||[]).map((e=>s.get(e))).filter(p)),[n,s]),l=Object(a.useMemo)((()=>(n.maintenanceWindowIds||[]).filter((e=>!s.get(e)))),[n,s]);return Object(d.jsx)(g.a,{timestamp:null===(t=n.start)||void 0===t?void 0:t.toISOString(),maintenanceWindows:r,maintenanceWindowIds:l,isLoading:i})},v=e=>{const{items:t,readOnly:n,onMuteAction:s}=e,[c,g]=Object(a.useState)({index:0,size:u.i}),p=Object(a.useMemo)((()=>function(e,t){return Object(r.chunk)(e,t.size)[t.index]||[]}(t,c)),[t,c]),v=Object(a.useMemo)((()=>({pageIndex:c.index,pageSize:c.size,totalItemCount:t.length})),[c,t]),T=Object(a.useMemo)((()=>new Set(p.map((e=>e.maintenanceWindowIds||[])).flat())),[p]),{data:A,isFetching:E}=Object(j.a)({ids:Array.from(T.values()),canFetchMaintenanceWindows:!0}),M=Object(a.useMemo)((()=>[{field:"alert",name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.Alert",{defaultMessage:"Alert"}),sortable:!1,truncateText:!0,width:"45%","data-test-subj":"alertsTableCell-alert",render:e=>Object(d.jsx)(l.EuiToolTip,{anchorClassName:"eui-textTruncate",content:e},Object(d.jsx)("span",null,e))},{field:"status",name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.status",{defaultMessage:"Status"}),width:"15%",render:(e,t)=>{const n=x(e,t);return Object(d.jsx)(m.a,{alertStatus:n,flapping:t.flapping})},sortable:!1,"data-test-subj":"alertsTableCell-status"},{field:"start",width:"190px",render:e=>e?i()(e).format("D MMM YYYY @ HH:mm:ss"):"",name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.start",{defaultMessage:"Start"}),sortable:!1,"data-test-subj":"alertsTableCell-start"},{field:"duration",render:e=>{return e?[(t=i.a.duration(e)).hours(),t.minutes(),t.seconds()].map((e=>Object(r.padStart)(`${e}`,2,"0"))).join(":"):"";var t},name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.duration",{defaultMessage:"Duration"}),sortable:!1,width:"80px","data-test-subj":"alertsTableCell-duration"},{field:"",width:"250px",render:e=>Object(d.jsx)("div",null,Object(d.jsx)(f,{alert:e,maintenanceWindows:A||new Map,isLoading:E})),name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.maintenanceWindowIds",{defaultMessage:"Maintenance windows"}),sortable:!1,"data-test-subj":"alertsTableCell-maintenanceWindowIds"},{field:"",align:"right",width:"60px",name:o.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.alertsList.columns.mute",{defaultMessage:"Mute"}),render:e=>Object(d.jsx)(b,{disabled:n,onMuteAction:async()=>await s(e),alert:e}),sortable:!1,"data-test-subj":"alertsTableCell-actions"}]),[A,E,s,n]),I=Object(a.useCallback)((({page:e})=>{g(e)}),[g]);return Object(d.jsx)(l.EuiBasicTable,{items:p,pagination:v,onChange:I,rowProps:w,cellProps:O,columns:M,"data-test-subj":"alertsList",tableLayout:"fixed",className:"alertsList"})}}}]);