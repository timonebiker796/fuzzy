/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[49,63],{118:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleDefinition",(function(){return f})),s.d(t,"default",(function(){return f}));var n=s(12),i=s.n(n),r=s(1),o=s(3),l=s(128),a=s(2),u=s(11),c=s(57),j=s(29),x=s(131),b=s(80),d=s(21);var g=s(209),p=s(0);function O({ruleActions:e,actionTypeRegistry:t,legacyNotifyWhen:s}){const{isLoadingActionConnectors:n,actionConnectors:i}=function({ruleActions:e}){const{http:t,notifications:{toasts:s}}=Object(j.b)().services,[n,i]=Object(r.useState)({isLoadingActionConnectors:!0,actionConnectors:[],errorActionConnectors:void 0}),o=Object(r.useCallback)((async()=>{try{if(!e||e.length<=0)return void i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:[]})));const s=await Object(d.e)({http:t,includeSystemActions:!0});i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:s})))}catch(e){const t=(n=e instanceof Error?e.message:"string"==typeof e?e:"",a.i18n.translate("xpack.triggersActionsUI.ruleDetails.connectorsLoadError",{defaultMessage:"Unable to load rule actions connectors. Reason: {message}",values:{message:n}}));i((e=>({...e,isLoadingActionConnectors:!1,errorActionConnectors:t}))),s.addDanger({title:t})}var n}),[t,e,s]);return Object(r.useEffect)((()=>{o()}),[o]),{...n,reloadRuleActionConnectors:o}}({ruleActions:e}),l=i&&i.length>0,u=e&&e.length>0;if(!l||!u)return Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{size:"s"},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.noActions",{defaultMessage:"No actions"})));const c=e=>{const s=t.list().find((t=>t.id===e));return"string"==typeof(null==s?void 0:s.iconClass)?null==s?void 0:s.iconClass:Object(b.suspendedComponentWithProps)(null==s?void 0:s.iconClass)};return n?Object(p.jsx)(o.EuiLoadingSpinner,{size:"s"}):Object(p.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"none"},e.map(((e,n)=>{var r;const{actionTypeId:l,id:a}=e,u=(e=>{const t=i.find((t=>t.id===e));return null==t?void 0:t.name})(a);return Object(p.jsx)(o.EuiFlexItem,{key:n},Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",component:"span"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiIcon,{size:"m",type:null!==(r=c(l))&&void 0!==r?r:"apps"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{"data-test-subj":`actionConnectorName-${n}-${u||l}`,size:"s"},u),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",component:"span"},Object(p.jsx)(o.EuiSpacer,{size:"xs"}),Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiIcon,{size:"s",type:"bell"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{"data-test-subj":`actionConnectorName-notify-text${n}-${u||l}`,size:"xs"},String(((e,t)=>{if(t)return g.NOTIFY_WHEN_OPTIONS[1].inputDisplay;if("frequency"in e){var n,i,r,o;const t=g.NOTIFY_WHEN_OPTIONS.find((t=>{var s;return t.value===(null===(s=e.frequency)||void 0===s?void 0:s.notifyWhen)}));return null!==(n=null!==(i=null!==(r=null==t?void 0:t.inputDisplay)&&void 0!==r?r:null===(o=e.frequency)||void 0===o?void 0:o.notifyWhen)&&void 0!==i?i:s)&&void 0!==n?n:""}return""})(e,t.get(l).isSystemActionType))))))),Object(p.jsx)(o.EuiSpacer,{size:"s"}))})))}var m=s(42);const f=({rule:e,actionTypeRegistry:t,ruleTypeRegistry:s,onEditRule:n,hideEditButton:i=!1,filteredRuleTypes:b=[]})=>{var d;const{application:{capabilities:g}}=Object(j.b)().services,[f,I]=Object(r.useState)(!1),[h,v]=Object(r.useState)(),{ruleTypesState:{data:F,isLoading:A}}=Object(c.a)({filteredRuleTypes:b}),T=Object(r.useMemo)((()=>[...F.values()]),[F]),S=Object(r.useMemo)((()=>{if(T.length&&e)return T.find((t=>t.id===e.ruleTypeId))}),[e,T]);Object(r.useEffect)((()=>{v(S)}),[S]);const C=()=>{const t=null!=e&&e.params.criteria?(null==e?void 0:e.params.criteria).length:0;return a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditions",{defaultMessage:"{numberOfConditions, plural, one {# condition} other {# conditions}}",values:{numberOfConditions:t}})},M=Object(x.f)(g),k=Object(x.c)(g),D=e&&Object(x.a)(e.consumer,h)&&(k||!k&&0===e.actions.length),N=Object(r.useMemo)((()=>!i&&D&&!!s.has(e.ruleTypeId)&&!s.get(e.ruleTypeId).requiresAppContext),[i,D,s,e]),z=Object(r.useMemo)((()=>s.has(e.ruleTypeId)?s.get(e.ruleTypeId).description:e.consumer===l.a.SIEM?a.i18n.translate("xpack.triggersActionsUI.ruleDetails.securityDetectionRule",{defaultMessage:"Security detection rule"}):""),[e,s]);return Object(p.jsx)(o.EuiFlexItem,{"data-test-subj":"ruleSummaryRuleDefinition",grow:3},Object(p.jsx)(o.EuiPanel,{color:"subdued",hasBorder:!1,paddingSize:"m"},Object(p.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(p.jsx)(o.EuiTitle,{size:"s"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.definition",{defaultMessage:"Definition"}))),A?Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleDetailsEditButtonLoadingSpinner"})):N&&Object(p.jsx)(o.EuiFlexItem,{grow:!1},Object(p.jsx)(o.EuiButtonEmpty,{"data-test-subj":"ruleDetailsEditButton",iconType:"pencil",onClick:()=>I(!0)}))),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiFlexGroup,null,Object(p.jsx)(E,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.ruleType",{defaultMessage:"Rule type"})),A?Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiLoadingSpinner,{"data-test-subj":"ruleSummaryRuleTypeLoadingSpinner"})):Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleType",itemValue:(null===(d=F.get(e.ruleTypeId))||void 0===d?void 0:d.name)||e.ruleTypeId})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"flexStart",responsive:!1},Object(p.jsx)(E,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.description",{defaultMessage:"Description"})),Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleDescription",itemValue:z})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,null,Object(p.jsx)(E,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.runsEvery",{defaultMessage:"Runs every"})),Object(p.jsx)(y,{"data-test-subj":"ruleSummaryRuleInterval",itemValue:Object(u.formatDuration)(e.schedule.interval)})),Object(p.jsx)(o.EuiSpacer,{size:"m"}),Object(p.jsx)(o.EuiFlexGroup,{alignItems:"center"},Object(p.jsx)(E,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditionsTitle",{defaultMessage:"Conditions"})),Object(p.jsx)(o.EuiFlexItem,{grow:3},Object(p.jsx)(o.EuiFlexGroup,{"data-test-subj":"ruleSummaryRuleConditions",alignItems:"center",gutterSize:"none"},Object(p.jsx)(o.EuiFlexItem,{grow:!1},N?Object(p.jsx)(o.EuiButtonEmpty,{onClick:()=>I(!0),flush:"left"},Object(p.jsx)(o.EuiText,{size:"s"},C())):Object(p.jsx)(o.EuiText,{size:"s"},C()))))),Object(p.jsx)(o.EuiSpacer,{size:"m"})),Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiFlexGroup,{alignItems:"baseline"},Object(p.jsx)(E,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.actions",{defaultMessage:"Actions"})),Object(p.jsx)(o.EuiFlexItem,{grow:3},M?Object(p.jsx)(O,{ruleActions:e.actions,actionTypeRegistry:t,legacyNotifyWhen:e.notifyWhen}):Object(p.jsx)(o.EuiFlexItem,null,Object(p.jsx)(o.EuiText,{size:"s"},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.cannotReadActions",{defaultMessage:"Connector feature privileges are required to view actions"})))))))),f&&Object(p.jsx)(m.b,{onSave:()=>(I(!1),n()),initialRule:e,onClose:()=>I(!1),ruleTypeRegistry:s,actionTypeRegistry:t}))};function y({itemValue:e,extraSpace:t=!0,...s}){return Object(p.jsx)(o.EuiFlexItem,i()({grow:t?3:1},s),Object(p.jsx)(o.EuiText,{size:"s"},e))}function E({children:e}){return Object(p.jsx)(o.EuiTitle,{size:"xxs"},Object(p.jsx)(o.EuiFlexItem,{style:{whiteSpace:"nowrap"},grow:1},e))}},209:function(e,t,s){"use strict";s.r(t),s.d(t,"NOTIFY_WHEN_OPTIONS",(function(){return x})),s.d(t,"RuleNotifyWhen",(function(){return b}));var n=s(1),i=s.n(n),r=s(2),o=s(24),l=s(3),a=s(159),u=s(146),c=s(51),j=s(0);const x=[{value:"onActionGroupChange",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))},{value:"onActiveAlert",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))},{value:"onThrottleInterval",inputDisplay:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(o.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}],b=({rule:e,throttle:t,throttleUnit:s,onNotifyWhenChange:b,onThrottleChange:d})=>{const[g,p]=Object(n.useState)(t||1),[O,m]=Object(n.useState)(!1),[f,y]=Object(n.useState)("onActionGroupChange");Object(n.useEffect)((()=>{e.notifyWhen?y(e.notifyWhen):y(e.throttle?"onThrottleInterval":"onActiveAlert")}),[e]),Object(n.useEffect)((()=>{m("onThrottleInterval"===f)}),[f]);const E=Object(n.useCallback)((e=>{d("onThrottleInterval"===e?g:null,s),b(e),y(e)}),[]),I=Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(o.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.renotifyFieldLabel",defaultMessage:"Notify"})," ",Object(j.jsx)(l.EuiIconTip,{position:"right",type:"questionInCircle",content:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.renotifyWithTooltip",{defaultMessage:"Define how often alerts generate actions."})}));return Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiFormRow,{fullWidth:!0,label:I},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiSuperSelect,{"data-test-subj":"notifyWhenSelect",options:x,valueOfSelected:f,onChange:E}),O&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiSpacer,null),Object(j.jsx)(l.EuiFormRow,{fullWidth:!0},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiFieldNumber,{fullWidth:!0,min:1,value:g,name:"throttle","data-test-subj":"throttleInput",prepend:r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.label",{defaultMessage:"Every"}),onChange:e=>{Object(u.pipe)(Object(a.some)(e.target.value.trim()),Object(a.filter)((e=>""!==e)),Object(a.map)((e=>parseInt(e,10))),Object(a.filter)((e=>!isNaN(e))),Object(a.map)((e=>{p(e),d(e,s)})))}})),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiSelect,{"data-test-subj":"throttleUnitInput",value:s,options:Object(c.b)(null!=t?t:1),onChange:e=>{d(t,e.target.value)}})))))))))}}}]);