/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[26,55],{110:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleStatusPanel",(function(){return g})),s.d(t,"default",(function(){return p}));var a=s(2),n=s(1),r=s(33),i=s.n(r),l=s(24),u=s(3),o=s(8),c=s(136),d=s(98),b=s(189),j=s(0);const g=({rule:e,bulkEnableRules:t,bulkDisableRules:s,snoozeRule:r,unsnoozeRule:c,requestRefresh:g,isEditable:p,healthColor:x,statusMessage:O,refreshToken:f})=>{const[m,h]=Object(n.useState)(null),y=Object(n.useRef)(!1),E=Object(n.useCallback)((t=>r(e,t)),[e,r]),v=Object(n.useCallback)((t=>c(e,t)),[e,c]),T=Object(n.useMemo)((()=>{var t;return O||Object(j.jsx)(u.EuiStat,{titleSize:"xs",title:"--",description:"",isLoading:!(null!==(t=e.lastRun)&&void 0!==t&&t.outcome||e.nextRun)})}),[e,O]),{data:k,loadEventLogs:I}=Object(b.a)({id:e.id,dateStart:"now-24h",dateEnd:"now",page:0,perPage:10});Object(n.useEffect)((()=>{k&&h(k.total)}),[k]);const w=Object(n.useCallback)((()=>{I(),g()}),[g,I]),A=Object(n.useCallback)((t=>s({ids:[e.id],untrack:t})),[s,e.id]);return Object(n.useEffect)((()=>{y.current&&I(),y.current=!0}),[f]),Object(j.jsx)(u.EuiPanel,{"data-test-subj":"ruleStatusPanel",hasBorder:!0,paddingSize:"none"},Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(u.EuiFlexGroup,{justifyContent:"flexStart"},Object(j.jsx)(u.EuiFlexItem,{grow:!1},Object(j.jsx)(u.EuiTitle,{size:"xxs"},Object(j.jsx)("h5",null,Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.ruleIsEnabledDisabledTitle",defaultMessage:"Rule is"})))),Object(j.jsx)(u.EuiFlexItem,null,Object(j.jsx)(o.h,{disableRule:A,enableRule:()=>t({ids:[e.id]}),snoozeRule:async()=>{},unsnoozeRule:async()=>{},rule:e,onRuleChanged:w,direction:"row",isEditable:p,hideSnoozeOption:!0}))),Object(j.jsx)(u.EuiSpacer,{size:"s"}),Object(j.jsx)(u.EuiText,{size:"s",color:"subdued","data-test-subj":"ruleStatus-numberOfExecutions"},null!==m&&Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.totalExecutions",defaultMessage:"{executions, plural, one {# execution} other {# executions}} in the last 24 hr",values:{executions:m}}))),Object(j.jsx)(u.EuiHorizontalRule,{margin:"none"}),Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(u.EuiFlexGroup,{gutterSize:"none",direction:"row",responsive:!1},Object(j.jsx)(u.EuiFlexItem,null,Object(j.jsx)(u.EuiStat,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,titleSize:"m",descriptionElement:"strong",titleElement:"h5",title:Object(j.jsx)(u.EuiHealth,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,textSize:"m",color:x,style:{fontWeight:400}},T),description:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rulesList.ruleLastExecutionDescription",{defaultMessage:"Last response"})})),Object(j.jsx)(u.EuiFlexItem,{grow:!1},Object(j.jsx)(u.EuiSpacer,{size:"xs"}),Object(j.jsx)(u.EuiText,{color:"subdued",size:"xs"},i()(e.executionStatus.lastExecutionDate).fromNow())))),Object(j.jsx)(u.EuiHorizontalRule,{margin:"none"}),Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(d.RulesListNotifyBadge,{snoozeSettings:e,loading:!e,disabled:!p,onRuleChanged:w,snoozeRule:E,unsnoozeRule:v,showTooltipInline:!0})))},p=Object(c.a)(g)},138:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return i}));var a=s(25);async function n({http:e}){const t=await e.get(`${a.b}/_health`),s=r(t.alerting_framework_health);return{...i(t),alertingFrameworkHealth:s}}const r=({decryption_health:e,execution_health:t,read_health:s,...a})=>({decryptionHealth:e,executionHealth:t,readHealth:s,...a}),i=({is_sufficiently_secure:e,has_permanent_encryption_key:t,alerting_framework_health:s,...a})=>({isSufficientlySecure:e,hasPermanentEncryptionKey:t,alertingFrameworkHealth:s,...a})},176:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(2),n=s(6);const r=(e,t=!1)=>{switch(e){case"logs":return{text:a.i18n.translate("xpack.triggersActionsUI.logs.breadcrumbTitle",{defaultMessage:"Logs"}),...t?{href:`${n.z}`}:{}};case"connectors":return{text:a.i18n.translate("xpack.triggersActionsUI.connectors.breadcrumbTitle",{defaultMessage:"Connectors"}),...t?{href:`${n.x}`}:{}};case"rules":return{text:a.i18n.translate("xpack.triggersActionsUI.rules.breadcrumbTitle",{defaultMessage:"Rules"}),...t?{href:`${n.A}`}:{}};case"alerts":return{text:a.i18n.translate("xpack.triggersActionsUI.alerts.breadcrumbTitle",{defaultMessage:"Alerts"}),...t?{href:`${n.t}`}:{}};default:return{text:a.i18n.translate("xpack.triggersActionsUI.home.breadcrumbTitle",{defaultMessage:"Rules"}),...t?{href:`${n.y}`}:{}}}}},177:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(2);const n=e=>{let t;switch(e){case"logs":t=a.i18n.translate("xpack.triggersActionsUI.logs.breadcrumbTitle",{defaultMessage:"Logs"});break;case"connectors":t=a.i18n.translate("xpack.triggersActionsUI.connectors.breadcrumbTitle",{defaultMessage:"Connectors"});break;case"rules":t=a.i18n.translate("xpack.triggersActionsUI.rules.breadcrumbTitle",{defaultMessage:"Rules"});break;case"alerts":t=a.i18n.translate("xpack.triggersActionsUI.alerts.breadcrumbTitle",{defaultMessage:"Alerts"});break;default:t=a.i18n.translate("xpack.triggersActionsUI.home.breadcrumbTitle",{defaultMessage:"Rules"})}return t}},185:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s(10),n=s(66),r=s(14);const i=e=>(t,s)=>{const{rule:i}=t;switch(s.command.type){case"setRule":{const{key:e,value:a}=s.payload;return"rule"===e?{...t,rule:a}:t}case"setProperty":{const{key:e,value:n}=s.payload;return Object(a.isEqual)(i[e],n)?t:{...t,rule:{...i,[e]:n}}}case"setScheduleProperty":{const{key:e,value:n}=s.payload;return i.schedule&&Object(a.isEqual)(i.schedule[e],n)?t:{...t,rule:{...i,schedule:{...i.schedule,[e]:n}}}}case"setRuleParams":{const{key:e,value:n}=s.payload;return Object(a.isEqual)(i.params[e],n)?t:{...t,rule:{...i,params:{...i.params,[e]:n}}}}case"setRuleActionParams":{const{key:e,value:n,index:r}=s.payload;if(void 0===r||null==i.actions[r]||i.actions[r][e]&&Object(a.isEqual)(i.actions[r][e],n))return t;{const s=i.actions.splice(r,1)[0],a={...s,params:{...s.params,[e]:n}};return i.actions.splice(r,0,a),{...t,rule:{...i,actions:[...i.actions]}}}}case"setRuleActionFrequency":{const{key:n,value:u,index:o}=s.payload;if(void 0===o||null==i.actions[o]||i.actions[o][n]&&Object(a.isEqual)(i.actions[o][n],u))return t;{var l;const s=i.actions.splice(o,1)[0];if(e.get(s.actionTypeId).isSystemActionType)return t;const a=s,c={...a,frequency:{...null!==(l=null==a?void 0:a.frequency)&&void 0!==l?l:r.DEFAULT_FREQUENCY,[n]:u}};return i.actions.splice(o,0,c),{...t,rule:{...i,actions:[...i.actions]}}}}case"setRuleActionAlertsFilter":{const{key:r,value:l,index:u}=s.payload;if(void 0===u||null==i.actions[u])return t;{const s=i.actions.splice(u,1)[0];if(e.get(s.actionTypeId).isSystemActionType)return t;const o=s;if(o.alertsFilter&&Object(a.isEqual)(o.alertsFilter[r],l))return t;const{alertsFilter:c,...d}=o,b={...c,[r]:l},j={...d,...Object(n.isEmpty)(b)?{}:{alertsFilter:b}};return i.actions.splice(u,0,j),{...t,rule:{...i,actions:[...i.actions]}}}}case"setRuleActionProperty":{const{key:e,value:n,index:r}=s.payload;if(void 0===r||Object(a.isEqual)(i.actions[r][e],n))return t;{const s={...i.actions.splice(r,1)[0],[e]:n};return i.actions.splice(r,0,s),{...t,rule:{...i,actions:[...i.actions]}}}}case"setAlertDelayProperty":{const{key:e,value:n}=s.payload;return i.alertDelay&&Object(a.isEqual)(i.alertDelay[e],n)?t:{...t,rule:{...i,alertDelay:{...i.alertDelay,[e]:n}}}}}}},189:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var a=s(1),n=s(4),r=s(58),i=s.n(r),l=s(29),u=s(156);const o=e=>{var t;return e.includes("now")&&(null===(t=i.a.parse(e))||void 0===t?void 0:t.format())||e},c=e=>"*"===e.id;function d(e){const{http:t}=Object(l.b)().services,s=Object(a.useCallback)((()=>c(e)?Object(u.b)({http:t,...e,dateStart:o(e.dateStart),...e.dateEnd?{dateEnd:o(e.dateEnd)}:{}}):Object(u.a)({http:t,...e,dateStart:o(e.dateStart),...e.dateEnd?{dateEnd:o(e.dateEnd)}:{}})),[e,t]),{data:r,error:i,isLoading:d,isFetching:b,refetch:j}=Object(n.useQuery)({queryKey:["loadRuleEventLog",e],queryFn:s,onError:e.onError,retry:0,refetchOnWindowFocus:!1}),g=Object(a.useMemo)((()=>i&&413===i.body.statusCode),[i]);return Object(a.useMemo)((()=>({data:r,hasExceedLogs:g,isLoading:d||b,loadEventLogs:j})),[r,g,b,d,j])}},224:function(e,t,s){"use strict";s.d(t,"a",(function(){return j}));var a=s(12),n=s.n(a),r=(s(1),s(21)),i=s(6),l=s(132);const u=({http:e,outcomeFilter:t,message:s,dateStart:a,dateEnd:n,namespaces:r})=>{const u=Object(l.a)({outcomeFilter:t,message:s});return e.post(`${i.l}/_global_connector_execution_kpi`,{body:JSON.stringify({filter:u.length?u.join(" and "):void 0,date_start:a,date_end:n,namespaces:r?JSON.stringify(r):r})})};var o=s(15);const c=async({http:e,dateStart:t,dateEnd:s,outcomeFilter:a,message:n,perPage:r=10,page:i=0,sort:u=[],namespaces:c})=>{const d=u,b=Object(l.a)({outcomeFilter:a,message:n});return(({data:e,...t})=>({data:e.map((e=>(e=>{const{duration_ms:t,schedule_delay_ms:s,...a}=e;return{execution_duration:e.duration_ms,schedule_delay:e.schedule_delay_ms,...a}})(e))),...t}))(await e.post(`${o.INTERNAL_BASE_ACTION_API_PATH}/_global_connector_execution_logs`,{body:JSON.stringify({date_start:t,date_end:s,filter:b.length?b.join(" and "):void 0,per_page:r,page:i+1,sort:d.length?JSON.stringify(d):void 0,namespaces:c?JSON.stringify(c):void 0})}))};var d=s(29),b=s(0);function j(e){return t=>{const{http:s}=Object(d.b)().services;return Object(b.jsx)(e,n()({},t,{loadActionTypes:async()=>Object(r.d)({http:s,includeSystemActions:!0}),loadGlobalConnectorExecutionLogAggregations:async e=>c({...e,http:s}),loadGlobalConnectorExecutionKPIAggregations:async e=>u({...e,http:s})}))}}},334:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(335);case"v8light":return s(337)}},335:function(e,t,s){var a=s(54),n=s(336);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},336:function(e,t,s){(t=s(55)(!1)).push([e.i,".ruleActionsPopover__deleteButton{color:#f86b63}",""]),e.exports=t},337:function(e,t,s){var a=s(54),n=s(338);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},338:function(e,t,s){(t=s(55)(!1)).push([e.i,".ruleActionsPopover__deleteButton{color:#bd271e}",""]),e.exports=t},339:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(340);case"v8light":return s(342)}},340:function(e,t,s){var a=s(54),n=s(341);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},341:function(e,t,s){(t=s(55)(!1)).push([e.i,".rulesList__health{width:100%}.rulesList__health .euiFlexItem:last-of-type{max-width:100%;min-width:0;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;width:85%}.ruleDurationWarningIcon{bottom:4px;position:relative}",""]),e.exports=t},342:function(e,t,s){var a=s(54),n=s(343);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},343:function(e,t,s){(t=s(55)(!1)).push([e.i,".rulesList__health{width:100%}.rulesList__health .euiFlexItem:last-of-type{max-width:100%;min-width:0;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;width:85%}.ruleDurationWarningIcon{bottom:4px;position:relative}",""]),e.exports=t},362:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleDetailsRoute",(function(){return ee})),s.d(t,"getRuleData",(function(){return te})),s.d(t,"default",(function(){return se}));var a=s(2),n=s(1),r=s.n(n),i=s(3),l=s(93),u=s(24),o=s(145),c=s(11),d=s(130),b=s(170),j=s(258),g=s(256),p=s(257),x=(s(334),s(0));const O=({rule:e,canSaveRule:t,onDelete:s,onApiKeyUpdate:r,onEnableDisable:l,onRunRule:u})=>{const[o,c]=Object(n.useState)(!1);return Object(x.jsx)(i.EuiPopover,{button:Object(x.jsx)(i.EuiButtonEmpty,{disabled:!1,"data-test-subj":"ruleActionsButton","data-testid":"ruleActionsButton",iconType:"boxesHorizontal",onClick:()=>c(!o),"aria-label":a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.popoverButtonTitle",{defaultMessage:"Actions"})}),isOpen:o,closePopover:()=>c(!1),ownFocus:!0,panelPaddingSize:"none"},Object(x.jsx)(i.EuiContextMenu,{initialPanelId:0,panels:[{id:0,items:[{disabled:!t,"data-test-subj":"disableButton",onClick:async()=>{c(!1),l(!e.enabled)},name:e.enabled?a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.disableRuleButtonLabel",{defaultMessage:"Disable"}):a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.enableRuleButtonLabel",{defaultMessage:"Enable"})},{disabled:!t,"data-test-subj":"updateAPIKeyButton",onClick:()=>{c(!1),r(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.updateAPIKeyButtonLabel",{defaultMessage:"Update API key"})},{disabled:!t,"data-test-subj":"runRuleButton",onClick:()=>{c(!1),u(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.runRuleButtonLabel",{defaultMessage:"Run rule"})},{disabled:!t,className:"ruleActionsPopover__deleteButton","data-test-subj":"deleteRuleButton",onClick:()=>{c(!1),s(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.deleteRuleButtonLabel",{defaultMessage:"Delete rule"})}]}],className:"ruleActionsPopover","data-test-subj":"ruleActionsPopover","data-testid":"ruleActionsPopover"}))};var f=s(131),m=s(176),h=s(177),y=s(136),E=s(71),v=s(6),T=s(29),k=(s(339),s(34)),I=s(5),w=s(32),A=s(110),S=s(133);const R=Object(n.lazy)((()=>Promise.all([s.e(3),s.e(6),s.e(9),s.e(48)]).then(s.bind(null,117)))),_=Object(n.lazy)((()=>s.e(40).then(s.bind(null,383)))),M=Object(n.lazy)((()=>s.e(49).then(s.bind(null,118)))),F=Object(n.lazy)((()=>Promise.all([s.e(2),s.e(5),s.e(7),s.e(8),s.e(13),s.e(27)]).then(s.bind(null,377)))),D=Object(y.a)((function({rule:e,ruleType:t,readOnly:s,ruleSummary:l,muteAlertInstance:u,unmuteAlertInstance:o,requestRefresh:d,refreshToken:b,numberOfExecutions:j,onChangeDuration:g,durationEpoch:p=Date.now(),isLoadingChart:O}){const{ruleTypeRegistry:f,actionTypeRegistry:m,alertsTableConfigurationRegistry:h}=Object(T.b)().services,y=Object.entries(l.alerts).map((([e,t])=>function(e,t,s){const a=!(null==s||!s.muted),n=s.status,r=null!=s&&s.activeStartDate?new Date(s.activeStartDate):void 0,i=r?e-r.valueOf():0,l=function(e){switch(e){case"Active":return 0;case"OK":return 1}return 2}(null==s?void 0:s.status),u=!(null==s||!s.tracked);return{alert:t,status:n,start:r,duration:i,isMuted:a,sortPriority:l,flapping:s.flapping,tracked:u,...s.maintenanceWindowIds?{maintenanceWindowIds:s.maintenanceWindowIds}:{}}}(p,e,t))).sort(((e,t)=>e.sortPriority-t.sortPriority)),D=Object(n.useCallback)((async t=>{await(t.isMuted?o(e,t.alert):u(e,t.alert)),d()}),[u,d,e,o]),C=Object(w.d)(e),L=Object(w.e)({rule:e,licenseErrorText:S.a,lastOutcomeTranslations:S.K,executionStatusTranslations:S.L}),U=Object(n.useCallback)((()=>t.hasAlertsMappings||t.hasFieldsForAAD?Object(x.jsx)(F,{id:"rule-detail-alerts-table",configurationId:v.a,alertsTableConfigurationRegistry:h,featureIds:e.consumer===c.ALERTING_FEATURE_ID?[t.producer]:[e.consumer],query:{bool:{filter:{term:{[E.y]:e.id}}}},showAlertStatusWithFlapping:!0}):Object(I.a)(_,"xl")({items:y,readOnly:s,onMuteAction:D})),[y,h,D,s,e.consumer,e.id,t.hasAlertsMappings,t.hasFieldsForAAD,t.producer]),P=[{id:"rule_alert_list",name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rule.alertsTabText",{defaultMessage:"Alerts"}),"data-test-subj":"ruleAlertListTab",content:Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)(i.EuiSpacer,null),U())},{id:"rule_event_log_list",name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rule.eventLogTabText",{defaultMessage:"History"}),"data-test-subj":"eventLogListTab",content:Object(I.a)(R,"xl")({fetchRuleSummary:!1,ruleId:e.id,ruleType:t,ruleSummary:l,numberOfExecutions:j,refreshToken:b,isLoadingRuleSummary:O,onChangeDuration:g,requestRefresh:d})}];return Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)(i.EuiFlexGroup,{gutterSize:"s",wrap:!0},Object(x.jsx)(i.EuiFlexItem,{grow:2},Object(x.jsx)(A.default,{rule:e,isEditable:!s,healthColor:C,statusMessage:L,requestRefresh:d,refreshToken:b})),Object(I.a)(M,"xl")({rule:e,actionTypeRegistry:m,ruleTypeRegistry:f,hideEditButton:!0,onEditRule:d})),Object(x.jsx)(i.EuiSpacer,{size:"xl"}),Object(x.jsx)("input",{type:"hidden","data-test-subj":"alertsDurationEpoch",name:"alertsDurationEpoch",value:p}),Object(k.a)("rulesDetailLogs")?Object(x.jsx)(i.EuiTabbedContent,{"data-test-subj":"ruleDetailsTabbedContent",tabs:P}):U())}));var C=s(56);const L=Object(y.a)((({rule:e,ruleType:t,readOnly:s,requestRefresh:r,loadRuleSummary:i,refreshToken:l})=>{const{notifications:{toasts:u}}=Object(T.b)().services,[o,c]=Object(n.useState)(null),[d,b]=Object(n.useState)(60),[j,g]=Object(n.useState)(!0),p=Object(n.useRef)(null),O=Object(n.useRef)(l),f=Object(n.useCallback)((async(e=d)=>{g(!0),await async function(e,t,s,n,r){try{s(await t(e,r))}catch(e){n.addDanger({title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.unableToLoadRulesMessage",{defaultMessage:"Unable to load rules: {message}",values:{message:e.message}})})}}(p.current,i,c,u,e),g(!1)}),[g,p,i,c,u,d]);Object(n.useEffect)((()=>{p.current!==e.id&&(p.current=e.id,f())}),[e,p,f]),Object(n.useEffect)((()=>{O.current!==l&&(O.current=l,f())}),[l,O,f]);const m=Object(n.useCallback)((e=>{b(e),f(e)}),[f]);return o?Object(x.jsx)(n.Suspense,{fallback:Object(x.jsx)(C.a,null)},Object(x.jsx)(D,{requestRefresh:r,refreshToken:l,rule:e,ruleType:t,readOnly:s,ruleSummary:o,numberOfExecutions:d,isLoadingChart:j,onChangeDuration:m})):Object(x.jsx)(C.a,null)}));var U=s(12),P=s.n(U),B=s(159),z=s(146);const q=!1,N=({rule:e})=>{const{application:{navigateToUrl:t},http:{basePath:s},alerting:a}=Object(T.b)().services,[r,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{Object(z.pipe)(Object(B.fromNullable)(a),Object(B.fold)((()=>l(q)),(t=>t.getNavigation(e.id).then((e=>l(e||q))).catch((()=>{l(q)})))))}),[e.id,a]),Object(x.jsx)(i.EuiButtonEmpty,P()({"data-test-subj":"ruleDetails-viewInApp",isLoading:null===r,disabled:!W(r),iconType:"popout"},function(e,t,s,a){return W(e)?{onClick:()=>{s(a.prepend(e))}}:{}}(r,0,t,s)),Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.viewRuleInAppButtonLabel",defaultMessage:"View in app"}))};function W(e){return"string"==typeof e}var K=s(42),$=s(185),G=s(21),H=s(262),J=s(259),Q=s(188);const V={minWidth:0},Y=Object(y.a)((({rule:e,ruleType:t,bulkDisableRules:s,bulkEnableRules:y,bulkDeleteRules:E,requestRefresh:k,refreshToken:I})=>{var w,A,R;const _=Object(l.useHistory)(),{application:{capabilities:M},ruleTypeRegistry:F,actionTypeRegistry:D,setBreadcrumbs:C,chrome:U,http:P,i18n:B,theme:z,notifications:{toasts:q}}=Object(T.b)().services,W=Object(n.useMemo)((()=>Object($.a)(D)),[D]),[{},Y]=Object(n.useReducer)(W,{rule:e}),[X,Z]=Object(n.useState)([]),[ee,te]=Object(n.useState)([]),[se,ae]=Object(n.useState)(!1),[ne,re]=Object(n.useState)(!1),[ie,le]=Object(n.useState)({isUsingSecurity:!1});Object(n.useEffect)((()=>{(async()=>{le(await Object(b.a)({http:P}))})()}),[P]),Object(n.useEffect)((()=>{C([Object(m.a)("rules",!0),{text:e.name}]),U.docTitle.change(Object(h.a)("rules"))}),[]),Object(n.useEffect)((()=>{(async()=>{let t=[];try{t=await Object(G.e)({http:P,includeSystemActions:!0})}catch(e){t=[]}if(t.length>0){const s=e.actions.some((e=>!t.find((t=>t.id===e.id))));re&&re(s)}})()}),[]);const ue=Object(f.c)(M),oe=Object(f.a)(e.consumer,t)&&(ue||!ue&&0===e.actions.length),ce=oe&&!!F.has(e.ruleTypeId)&&!F.get(e.ruleTypeId).requiresAppContext,[de,be]=Object(n.useState)(!1);Object(n.useEffect)((()=>{if(e.schedule.interval&&ie.minimumScheduleInterval&&Object(c.parseDuration)(e.schedule.interval)<Object(c.parseDuration)(ie.minimumScheduleInterval.value)){const e=q.addInfo({"data-test-subj":"intervalConfigToast",title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastTitle",{defaultMessage:"Configuration settings"}),text:Object(o.a)(Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastMessage",defaultMessage:"This rule has an interval set below the minimum configured interval. This may impact performance."})),ce&&Object(x.jsx)(i.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiButton,{"data-test-subj":"ruleIntervalToastEditButton",onClick:()=>{q.remove(e),be(!0)}},Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastMessageButton",defaultMessage:"Edit rule"}))))),{i18n:B,theme:z})})}}),[B,z,e.schedule.interval,ie.minimumScheduleInterval,q,ce]);const je=ce?Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)(i.EuiButtonEmpty,{"data-test-subj":"openEditRuleFlyoutButton",iconType:"pencil",onClick:()=>be(!0),name:"edit",disabled:!t.enabledInLicense},Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.editRuleButtonLabel",defaultMessage:"Edit"})),de&&Object(x.jsx)(K.b,{initialRule:e,onClose:()=>{Y({command:{type:"setRule"},payload:{key:"rule",value:e}}),be(!1)},actionTypeRegistry:D,ruleTypeRegistry:F,ruleType:t,onSave:async()=>{_.push(Object(d.a)(e.id))}})):null,[ge,pe]=Object(n.useState)(!1),{showToast:xe}=Object(J.a)({}),Oe=()=>{ae(!1)};return Object(x.jsx)(r.a.Fragment,null,ge&&Object(x.jsx)(p.a,{onConfirm:async()=>{pe(!1);const{errors:e,total:t}=await E({ids:X});xe({action:"DELETE",errors:e,total:t}),Z([]),_.push(v.A)},onCancel:()=>{pe(!1),Z([])},confirmButtonText:Object(S.y)(X.length,S.w,S.f),confirmModalText:Object(S.z)(X.length,S.w,S.f)}),se&&Object(x.jsx)(Q.a,{onCancel:Oe,onConfirm:async t=>{Oe(),await s({ids:[e.id],untrack:t}),k()}}),Object(x.jsx)(j.a,{onCancel:()=>{te([])},idsToUpdate:ee,apiUpdateApiKeyCall:g.a,setIsLoadingState:()=>{},onUpdated:async()=>{te([]),k()}}),Object(x.jsx)(i.EuiPageHeader,{"data-test-subj":"ruleDetailsTitle",bottomBorder:!0,pageTitle:Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleDetailsTitle",defaultMessage:"{ruleName}",values:{ruleName:e.name}}),description:Object(x.jsx)(i.EuiFlexGroup,{gutterSize:"m"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"s"},Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.rulesListTable.columns.ruleTypeTitle",defaultMessage:"Type"})))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiBadge,{"data-test-subj":"ruleTypeLabel"},t.name)))),Object(f.d)(M)&&e.apiKeyOwner&&Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center"},Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"s"},Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.rulesListTable.columns.apiKeyOwnerTitle",defaultMessage:"API key owner"})))),Object(x.jsx)(i.EuiFlexItem,{grow:!1},Object(x.jsx)(i.EuiText,{size:"s","data-test-subj":"apiKeyOwnerLabel"},Object(x.jsx)("b",null,e.apiKeyOwner),e.apiKeyCreatedByUser?Object(x.jsx)(r.a.Fragment,null," ",Object(x.jsx)(i.EuiIconTip,{position:"right",content:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.userManagedApikey",{defaultMessage:"This rule is associated with an API key."})})):null))))),rightSideItems:[Object(x.jsx)(O,{canSaveRule:oe,rule:e,onDelete:e=>{pe(!0),Z([e])},onApiKeyUpdate:e=>{te([e])},onEnableDisable:t=>{t?(async()=>{await y({ids:[e.id]}),k()})():ae(!0)},onRunRule:async e=>{await Object(H.a)(P,q,e)}}),je,Object(x.jsx)(i.EuiButtonEmpty,{"data-test-subj":"refreshRulesButton",iconType:"refresh",onClick:k,name:"refresh",color:"primary"},Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.refreshRulesButtonLabel",defaultMessage:"Refresh"})),Object(x.jsx)(N,{rule:e})]}),Object(x.jsx)(i.EuiPageSection,null,e.enabled&&(null===(w=e.executionStatus.error)||void 0===w?void 0:w.reason)===c.RuleExecutionStatusErrorReasons.License?Object(x.jsx)(i.EuiFlexGroup,null,Object(x.jsx)(i.EuiFlexItem,null,Object(x.jsx)(i.EuiCallOut,{color:"danger","data-test-subj":"ruleErrorBanner",size:"s",iconType:"error",title:e.executionStatus.error&&e.executionStatus.error.reason?S.J[e.executionStatus.error.reason]:S.J.unknown},Object(x.jsx)(i.EuiText,{size:"xs"},null===(A=e.executionStatus.error)||void 0===A?void 0:A.message),Object(x.jsx)(i.EuiSpacer,{size:"s"}),Object(x.jsx)(i.EuiLink,{href:`${P.basePath.get()}/app/management/stack/license_management`,color:"primary",target:"_blank"},Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.manageLicensePlanBannerLinkTitle",defaultMessage:"Manage license"}))))):null,e.enabled&&"warning"===e.executionStatus.status?Object(x.jsx)(i.EuiFlexGroup,null,Object(x.jsx)(i.EuiFlexItem,null,Object(x.jsx)(i.EuiCallOut,{color:"warning","data-test-subj":"ruleWarningBanner",size:"s",iconType:"warning"},Object(x.jsx)("p",null,Object(x.jsx)(i.EuiIcon,{color:"warning",type:"warning"})," ",e.executionStatus.warning&&e.executionStatus.warning.reason?S.M[e.executionStatus.warning.reason]:S.M.unknown," ",null===(R=e.executionStatus.warning)||void 0===R?void 0:R.message)))):null,ne&&Object(x.jsx)(i.EuiFlexGroup,null,Object(x.jsx)(i.EuiFlexItem,null,Object(x.jsx)(i.EuiSpacer,{size:"s"}),Object(x.jsx)(i.EuiCallOut,{color:"warning","data-test-subj":"actionWithBrokenConnectorWarningBanner",size:"s"},Object(x.jsx)("p",null,Object(x.jsx)(i.EuiIcon,{color:"warning",type:"warning"})," ",Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.actionWithBrokenConnectorWarningBannerTitle",defaultMessage:"There is an issue with one of the connectors associated with this rule."})," ",ce&&Object(x.jsx)(i.EuiLink,{"data-test-subj":"actionWithBrokenConnectorWarningBannerEdit",color:"primary",onClick:()=>be(!0)},Object(x.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.actionWithBrokenConnectorWarningBannerEditText",defaultMessage:"Edit rule"})))))),Object(x.jsx)(i.EuiFlexGroup,null,Object(x.jsx)(i.EuiFlexItem,{style:V},Object(x.jsx)(L,{requestRefresh:k,refreshToken:I,rule:e,ruleType:t,readOnly:!oe})))))}));var X=s(60),Z=s(224);const ee=({match:{params:{ruleId:e}},loadRuleTypes:t,loadActionTypes:s,resolveRule:l})=>{const{http:u,notifications:{toasts:o},spaces:c}=Object(T.b)().services,{basePath:d}=u,[b,j]=Object(n.useState)(null),[g,p]=Object(n.useState)(null),[O,f]=Object(n.useState)(null),[m,h]=Object(n.useState)(),y=Object(n.useCallback)((()=>new Promise(((e,t)=>{h({resolve:e,reject:t})}))),[h]);return Object(n.useEffect)((()=>{(async()=>{await te(e,t,l,s,j,p,f,o),null==m||m.resolve()})()}),[e,u,s,t,l,o,m]),Object(n.useEffect)((()=>{if(b){const e=b.outcome;if(c&&"aliasMatch"===e){const e=d.prepend(`insightsAndAlerting/triggersActions/rule/${b.id}`);c.ui.redirectLegacyUrl({path:e,aliasPurpose:b.alias_purpose,objectNoun:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.redirectObjectNoun",{defaultMessage:"rule"})})}}}),[b,c,d]),b&&g&&O?Object(x.jsx)(r.a.Fragment,null,(()=>{const e=b.outcome;if(c&&"conflict"===e){const e=b.alias_target_id,t=d.prepend(`insightsAndAlerting/triggersActions/rule/${e}`);return Object(x.jsx)(r.a.Fragment,null,Object(x.jsx)(i.EuiSpacer,null),c.ui.components.getLegacyUrlConflict({objectNoun:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.redirectObjectNoun",{defaultMessage:"rule"}),currentObjectId:null==b?void 0:b.id,otherObjectId:e,otherObjectPath:t}))}return null})(),Object(x.jsx)(Y,{rule:b,ruleType:g,actionTypes:O,requestRefresh:y,refreshToken:m})):Object(x.jsx)(C.a,null)};async function te(e,t,s,n,r,i,l,u){try{const a=await s(e);r(a);const[u,o]=await Promise.all([t().then((e=>e.find((e=>e.id===a.ruleTypeId)))).then(Object(X.b)(`Invalid Rule Type: ${a.ruleTypeId}`)),n().then(Object(X.c)(new Set(a.actions.map((e=>e.actionTypeId))),(e=>`Invalid Connector Type: ${e}`),(e=>e.id)))]);i(u),l(o)}catch(e){u.addDanger({title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.unableToLoadRuleMessage",{defaultMessage:"Unable to load rule: {message}",values:{message:e.message}})})}}const se=Object(Z.a)(Object(y.a)(ee))}}]);