/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[12,19,65],{102:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleTagBadge",(function(){return u})),s.d(t,"default",(function(){return u}));var n=s(1),i=s(2),o=s(3),a=s(0);const r=i.i18n.translate("xpack.triggersActionsUI.sections.rules_list.rules_tag_badge.tagTitle",{defaultMessage:"Tag"}),c={width:"300px"},l=e=>`ruleTagBadgeItem-${e}`,u=e=>{const{tagsOutPopover:t=!1,tags:s=[],badgeDataTestSubj:i="ruleTagBadge",titleDataTestSubj:u="ruleTagPopoverTitle",tagItemDataTestSubj:d=l}=e,{isOpen:b,onClose:j,onClick:g}=e,p=Object(n.useMemo)((()=>Object(a.jsx)(o.EuiBadge,{"data-test-subj":i,color:"hollow",iconType:"tag",iconSide:"left",tabIndex:-1,onClick:g,onClickAriaLabel:"Tags",iconOnClick:g,iconOnClickAriaLabel:"Tags"},s.length)),[i,g,s.length]),m=Object(n.useMemo)((()=>s.map(((e,t)=>Object(a.jsx)(o.EuiBadge,{"data-test-subj":d(e),key:t,color:"hollow",iconType:"tag",iconSide:"left"},e)))),[s,d]);return t?Object(a.jsx)(o.EuiFlexGroup,{"data-test-subj":"tagsOutPopover",style:{marginLeft:0},wrap:!0},m):Object(a.jsx)(o.EuiPopover,{button:p,anchorPosition:"upCenter",isOpen:b,closePopover:j},Object(a.jsx)(o.EuiPopoverTitle,{"data-test-subj":u},r),Object(a.jsx)("div",{style:c},m))}},131:function(e,t,s){"use strict";s.d(t,"f",(function(){return n})),s.d(t,"e",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return r})),s.d(t,"d",(function(){return c}));const n=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},o=(e,t)=>{var s,n;return".sentinelone"===t?null==e||null===(s=e.actions)||void 0===s?void 0:s.save:null==e||null===(n=e.actions)||void 0===n?void 0:n.execute},a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function r(e,t){var s,n;return null!==(s=null==t||null===(n=t.authorizedConsumers[e])||void 0===n?void 0:n.all)&&void 0!==s&&s}const c=e=>{var t,s;return null==e||null===(t=e.management)||void 0===t||null===(s=t.security)||void 0===s?void 0:s.api_keys}},195:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(95),i=s(10);const o=({typesFilter:e,actionTypesFilter:t,ruleExecutionStatusesFilter:s,ruleLastRunOutcomesFilter:o,ruleParamsFilter:a,ruleStatusesFilter:r,tagsFilter:c,searchText:l,kueryNode:u})=>{const d=[];if(u&&!Object(i.isEmpty)(u)&&d.push(u),e&&e.length&&d.push(n.nodeBuilder.or(e.map((e=>n.nodeBuilder.is("alert.attributes.alertTypeId",e))))),t&&t.length&&d.push(n.nodeBuilder.or(t.map((e=>Object(n.fromKueryExpression)(`alert.attributes.actions:{ actionTypeId: ${e} }`))))),s&&s.length&&d.push(n.nodeBuilder.or(s.map((e=>n.nodeBuilder.is("alert.attributes.executionStatus.status",e))))),o&&o.length&&d.push(n.nodeBuilder.or(o.map((e=>n.nodeBuilder.is("alert.attributes.lastRun.outcome",e))))),a&&Object.keys(a).length&&d.push(n.nodeBuilder.and(Object.keys(a).map((e=>n.nodeBuilder.is(`alert.attributes.params.${e}`,String(a[e])))))),r&&r.length){const e=n.nodeBuilder.or([Object(n.fromKueryExpression)("alert.attributes.muteAll: true"),Object(n.fromKueryExpression)("alert.attributes.snoozeSchedule:{ duration > 0 }")]),t=Object(n.fromKueryExpression)("alert.attributes.enabled: true"),s=Object(n.fromKueryExpression)("alert.attributes.enabled: false"),i=[];r.includes("enabled")&&i.push(t),r.includes("disabled")&&i.push(s),r.includes("snoozed")&&i.push(e),d.push(n.nodeBuilder.or(i))}if(c&&c.length&&d.push(n.nodeBuilder.or(c.map((e=>n.nodeBuilder.is("alert.attributes.tags",e))))),l&&""!==l){const e=l.match(/(['"`])(.*?)\1/g)?n.nodeTypes.literal.buildNode(l,!0):n.nodeTypes.wildcard.buildNode(l);d.push(n.nodeBuilder.or([n.nodeBuilder.is("alert.attributes.name",e),n.nodeBuilder.is("alert.attributes.tags",e)]))}return d.length?n.nodeBuilder.and(d):null}},196:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s(1);var n=s(3),i=s(24),o=s(0);const a=()=>Object(o.jsx)(n.EuiPageTemplate.EmptyPrompt,{"data-test-subj":"noPermissionPrompt",iconType:"securityApp",title:Object(o.jsx)("h1",null,Object(o.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.noPermissionToReadTitle",defaultMessage:"No permissions to read rules and alerts"})),body:Object(o.jsx)("p",{"data-test-subj":"permissionDeniedMessage"},Object(o.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.noPermissionToCreateDescription",defaultMessage:"Contact your system administrator."}))})},206:function(e,t,s){"use strict";s.d(t,"a",(function(){return I}));var n=s(1),i=s.n(n),o=s(10),a=s(18),r=s(3),c=s(24),l=s(59),u=s(131),d=s(29),b=s(68),j=s(45),g=s(2),p=s(0);const{emptyField:m}=b.fieldValidators,x={label:"Connector name",validations:[{validator:m(g.i18n.translate("xpack.triggersActionsUI.sections.actionConnectorForm.error.requiredNameText",{defaultMessage:"Name is required."}))}]},O=({canSave:e})=>Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(a.UseField,{path:"id",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"actionTypeId",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"isDeprecated",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"name",config:x,component:j.Field,componentProps:{euiFieldProps:{readOnly:!e,"data-test-subj":"nameInput",fullWidth:!0}}})),f=Object(n.memo)(O),h=({actionTypeModel:e,isEdit:t,registerPreSubmitValidator:s})=>{var o;const{application:{capabilities:a}}=Object(d.b)().services,b=Object(u.e)(a),j=null!==(o=null==e?void 0:e.actionConnectorFields)&&void 0!==o?o:null;return Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(f,{canSave:b}),Object(p.jsx)(r.EuiSpacer,{size:"m"}),null!==j?Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiTitle,{size:"xxs","data-test-subj":"connector-settings-label"},Object(p.jsx)("h4",null,Object(p.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionConnectorForm.connectorSettingsLabel",defaultMessage:"Connector settings"}))),Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiErrorBoundary,null,Object(p.jsx)(n.Suspense,{fallback:Object(p.jsx)(l.a,null,Object(p.jsx)(c.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionConnectorForm.loadingConnectorSettingsDescription",defaultMessage:"Loading connector settingsâ€¦"}))},Object(p.jsx)(j,{readOnly:!b,isEdit:t,registerPreSubmitValidator:s})))):null)},y=Object(n.memo)(h),F=({title:e,dataTestSubj:t})=>Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiCallOut,{size:"s",iconType:"iInCircle","data-test-subj":t,title:e}),Object(p.jsx)(r.EuiSpacer,{size:"m"})),C=e=>null!=e||!C(e),T=({isEdit:e,isMissingSecrets:t})=>{const[s]=Object(a.useFormData)(),{getFields:n}=Object(a.useFormContext)(),i=n(),o=(r=i,Object.keys(r).filter((e=>e.includes("secrets"))).reduce(((e,t)=>({...e,[t]:r[t]})),{}));var r;const c=Object.keys(o).length,l=(e=>{if(0===e.length)return"";if(1===e.length)return`${e[0]}`;if(2===e.length)return e.join(" and ");const t=e[e.length-1];return`${e.slice(0,-1).join(", ")}, and ${t}`})((e=>Object.keys(e).map((t=>e[t].label)).filter(C))(o));return 0===Object.keys(o).length?null:t?Object(p.jsx)(F,{title:g.i18n.translate("xpack.triggersActionsUI.components.builtinActionTypes.missingSecretsValuesLabel",{values:{secretFieldsLabel:l,encryptedFieldsLength:c},defaultMessage:"Sensitive information is not imported. Please enter value{encryptedFieldsLength, plural, one {} other {s}} for the following field{encryptedFieldsLength, plural, one {} other {s}} {secretFieldsLabel}."}),dataTestSubj:"missing-secrets-callout"}):e?e?Object(p.jsx)(F,{title:g.i18n.translate("xpack.triggersActionsUI.components.simpleConnectorForm.secrets.reenterValuesMessage",{values:{secretFieldsLabel:l,encryptedFieldsLength:c},defaultMessage:"Value{encryptedFieldsLength, plural, one {} other {s}} {secretFieldsLabel} {encryptedFieldsLength, plural, one {is} other {are}} encrypted. Please reenter value{encryptedFieldsLength, plural, one {} other {s}} for {encryptedFieldsLength, plural, one {this} other {these}} field{encryptedFieldsLength, plural, one {} other {s}}."}),dataTestSubj:"edit-connector-secrets-callout"}):null:Object(p.jsx)(F,{title:g.i18n.translate("xpack.triggersActionsUI.components.simpleConnectorForm.secrets.reenterValuesLabel",{values:{secretFieldsLabel:l,encryptedFieldsLength:c},defaultMessage:"Remember your {secretFieldsLabel} {encryptedFieldsLength, plural, one {value} other {values}}. You must reenter {encryptedFieldsLength, plural, one {it} other {them}} each time you edit the connector."}),dataTestSubj:"create-connector-secrets-callout"})},E=Object(n.memo)(T),v=e=>{var t,s;if(".webhook"!==e.actionTypeId&&".cases-webhook"!==e.actionTypeId)return e;const n=e,i=Object.entries(null!==(t=null==n||null===(s=n.config)||void 0===s?void 0:s.headers)&&void 0!==t?t:{}).map((([e,t])=>({key:e,value:t})));return{...e,config:{...e.config,headers:Object(o.isEmpty)(i)?void 0:i}}},S=e=>{var t,s;if(".webhook"!==e.actionTypeId&&".cases-webhook"!==e.actionTypeId)return e;const n=(null!==(t=null==e||null===(s=e.config)||void 0===s?void 0:s.headers)&&void 0!==t?t:[]).reduce(((e,t)=>({...e,[t.key]:t.value})),{});return{...e,config:{...e.config,headers:Object(o.isEmpty)(n)?null:n}}},k=({actionTypeModel:e,connector:t,isEdit:s,onChange:i,onFormModifiedChange:o,setResetForm:c})=>{const{form:l}=Object(a.useForm)({defaultValue:t,serializer:S,deserializer:v}),{submit:u,isValid:d,isSubmitted:b,isSubmitting:j,reset:g}=l,[m,x]=Object(n.useState)(null),O=Object(n.useCallback)((e=>{x((()=>e))}),[]),f=Object(a.useFormIsModified)({form:l,discard:["__internal__"]});return Object(n.useEffect)((()=>{i&&i({isValid:d,isSubmitted:b,isSubmitting:j,submit:u,preSubmitValidator:m})}),[i,d,b,j,u,m]),Object(n.useEffect)((()=>{o&&o(f)}),[f,o]),Object(n.useEffect)((()=>{c&&c(g)}),[g]),Object(p.jsx)(a.Form,{form:l},Object(p.jsx)(y,{actionTypeModel:e,isEdit:s,registerPreSubmitValidator:O}),Object(p.jsx)(r.EuiSpacer,{size:"m"}),Object(p.jsx)(E,{isEdit:s,isMissingSecrets:t.isMissingSecrets}))},I=i.a.memo(k)},245:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s(33),i=s.n(n),o=s(2),a=s(4),r=s(6),c=s(195),l=s(38),u=s(29);const d=e=>{var t,s;const{filterConsumers:n,filters:d,page:b,sort:j,onPage:g,enabled:p,refresh:m,hasReference:x}=e,{http:O,notifications:{toasts:f}}=Object(u.b)().services,{refetch:h,isLoading:y,data:F,dataUpdatedAt:C,isInitialLoading:T,isFetching:E}=Object(a.useQuery)({queryKey:["loadRules",d.tags,d.searchText,d.types,d.actionTypes,d.ruleStatuses,d.ruleLastRunOutcomes,d.ruleParams,d.kueryNode,b,j,{refresh:null==m?void 0:m.toISOString()},n,x],queryFn:()=>async function({http:e,page:t,searchText:s,typesFilter:n,actionTypesFilter:i,ruleExecutionStatusesFilter:o,ruleLastRunOutcomesFilter:a,ruleParamsFilter:u,ruleStatusesFilter:d,tagsFilter:b,sort:j={field:"name",direction:"asc"},kueryNode:g,filterConsumers:p,hasReference:m}){const x=Object(c.a)({typesFilter:n,actionTypesFilter:i,tagsFilter:b,ruleExecutionStatusesFilter:o,ruleLastRunOutcomesFilter:a,ruleParamsFilter:u,ruleStatusesFilter:d,searchText:s,kueryNode:g}),O=await e.post(`${r.m}/rules/_find`,{body:JSON.stringify({page:t.index+1,per_page:t.size,...x?{filter:JSON.stringify(x)}:{},sort_field:j.field,sort_order:j.direction,filter_consumers:p,...m?{has_reference:m}:{}})});return{page:O.page,perPage:O.per_page,total:O.total,data:(f=O.data,f.map((e=>Object(l.a)(e))))};var f}({http:O,page:b,searchText:d.searchText,typesFilter:d.types,actionTypesFilter:d.actionTypes,ruleExecutionStatusesFilter:d.ruleExecutionStatuses,ruleLastRunOutcomesFilter:d.ruleLastRunOutcomes,ruleParamsFilter:d.ruleParams,ruleStatusesFilter:d.ruleStatuses,tagsFilter:d.tags,kueryNode:d.kueryNode,sort:j,filterConsumers:n,hasReference:x}),onSuccess:e=>{var t;(null==e||null===(t=e.data)||void 0===t||!t.length)&&b.index>0&&g({...b,index:0})},onError:()=>{f.addDanger(o.i18n.translate("xpack.triggersActionsUI.sections.rulesList.unableToLoadRulesMessage",{defaultMessage:"Unable to load rules"}))},enabled:p,keepPreviousData:!0,cacheTime:0,refetchOnWindowFocus:!1}),v=Boolean(F&&F.data.length>0);return{rulesState:{isLoading:p&&(y||E),data:null!==(t=null==F?void 0:F.data)&&void 0!==t?t:[],totalItemCount:null!==(s=null==F?void 0:F.total)&&void 0!==s?s:0,initialLoad:y||T},lastUpdate:i()(C).format(),hasData:v,loadRules:h}}},82:function(e,t,s){"use strict";s.r(t),s.d(t,"EditConnectorFlyout",(function(){return _})),s.d(t,"default",(function(){return _}));var n=s(1),i=s.n(n),o=s(3),a=s(24),r=s(2),c=s(15),l=s(159),u=s(0);const d=({connectorId:e,connectorName:t,extraComponent:s,href:n})=>{const c=s;return Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiText,null,r.i18n.translate("xpack.triggersActionsUI.sections.editConnectorForm.descriptionText",{defaultMessage:"This connector is readonly."})),Object(u.jsx)(o.EuiLink,{"data-test-subj":"read-only-link",href:n,target:"_blank"},Object(u.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.editConnectorForm.preconfiguredHelpLabel",defaultMessage:"Learn more about preconfigured connectors."})),c&&Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiSpacer,{size:"m"}),Object(u.jsx)(c,{connectorId:e,connectorName:t})))};var b=s(19),j=s(206),g=s(21),p=s(29),m=s(131),x=s(146);const O=({connector:e,executeEnabled:t,executionResult:s,actionParams:c,setActionParams:d,onExecutionAction:j,isExecutingAction:g,actionTypeRegistry:p})=>{const[m,O]=Object(n.useState)({}),[F,C]=Object(n.useState)(!1),T=p.get(e.actionTypeId),E=T.actionParamsFields;Object(n.useEffect)((()=>{(async()=>{const e=(await(null==T?void 0:T.validateParams(c))).errors;O({...e}),C(!!Object.values(e).find((e=>e.length>0)))})()}),[T,c]);const v=[{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.createActionHeader",{defaultMessage:"Create an action"}),children:E?Object(u.jsx)(o.EuiErrorBoundary,null,Object(u.jsx)(n.Suspense,{fallback:Object(u.jsx)(o.EuiFlexGroup,{justifyContent:"center"},Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiLoadingSpinner,{size:"m"})))},Object(u.jsx)(E,{actionParams:c,index:0,errors:m,editAction:(e,t)=>d({...c,[e]:t}),messageVariables:[],actionConnector:e,executionMode:b.b.Test}))):Object(u.jsx)(o.EuiText,null,Object(u.jsx)("p",null,Object(u.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.testConnectorForm.noActionParametersRequiredText",defaultMessage:"This Connector does not require any Action Parameter."})))},{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.runTestHeader",{defaultMessage:"Run the test"}),children:Object(u.jsx)(i.a.Fragment,null,t?null:Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiCallOut,{iconType:"warning",color:"warning"},Object(u.jsx)("p",null,Object(u.jsx)(a.FormattedMessage,{defaultMessage:"Save your changes before testing the connector.",id:"xpack.triggersActionsUI.sections.testConnectorForm.executeTestDisabled"}))),Object(u.jsx)(o.EuiSpacer,{size:"s"})),Object(u.jsx)(o.EuiText,null,Object(u.jsx)(o.EuiButton,{iconType:"play",isLoading:g,isDisabled:!t||F||g,"data-test-subj":"executeActionButton",onClick:j},Object(u.jsx)(a.FormattedMessage,{defaultMessage:"Run",id:"xpack.triggersActionsUI.sections.testConnectorForm.executeTestButton"}))))},{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.testResultsHeader",{defaultMessage:"Results"}),children:Object(x.pipe)(s,Object(l.map)((e=>"ok"===(null==e?void 0:e.status)?Object(u.jsx)(h,null):Object(u.jsx)(y,{executionResult:e}))),Object(l.getOrElse)((()=>Object(u.jsx)(f,null))))}];return Object(u.jsx)(o.EuiSteps,{steps:v,"data-test-subj":"test-connector-form"})},f=()=>Object(u.jsx)(o.EuiCallOut,{"data-test-subj":"executionAwaiting"},Object(u.jsx)("p",null,Object(u.jsx)(a.FormattedMessage,{defaultMessage:"When you run the test, the results will show up here.",id:"xpack.triggersActionsUI.sections.testConnectorForm.awaitingExecutionDescription"}))),h=()=>Object(u.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.executionSuccessfulTitle",{defaultMessage:"Test was successful"}),color:"success","data-test-subj":"executionSuccessfulResult",iconType:"check"},Object(u.jsx)("p",null,Object(u.jsx)(a.FormattedMessage,{defaultMessage:"Ensure the results are what you expect.",id:"xpack.triggersActionsUI.sections.testConnectorForm.executionSuccessfulDescription"}))),y=({executionResult:e})=>{var t;const s=[{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.executionFailureDescription",{defaultMessage:"The following error was found:"}),description:null!==(t=null==e?void 0:e.message)&&void 0!==t?t:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.executionFailureUnknownReason",{defaultMessage:"Unknown reason"})}];return null!=e&&e.serviceMessage&&s.push({title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.executionFailureAdditionalDetails",{defaultMessage:"Details:"}),description:e.serviceMessage}),Object(u.jsx)(o.EuiCallOut,{title:r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.executionFailureTitle",{defaultMessage:"Test failed to run"}),"data-test-subj":"executionFailureResult",color:"danger",iconType:"warning"},Object(u.jsx)(o.EuiDescriptionList,{textStyle:"reverse",listItems:s}))};var F=s(130),C=s(95),T=s(11),E=s(32),v=s(57),S=s(245),k=s(6),I=s(133),M=s(196),A=s(56),L=s(102);const R=e=>{const{connector:t}=e,{application:{getUrlForApp:s}}=Object(p.b)().services,[i,a]=Object(n.useState)(""),[c,l]=Object(n.useState)(""),[d,b]=Object(n.useState)(null),[j,g]=Object(n.useState)({index:0,size:k.f}),[m,x]=Object(n.useState)({field:"name",direction:"asc"}),{ruleTypesState:O,hasAnyAuthorizedRuleType:f,authorizedRuleTypes:h,authorizedToReadAnyRules:y,isSuccess:R}=Object(v.a)({filteredRuleTypes:[]}),U=h.map((e=>e.id)),w=Object(n.useMemo)((()=>{const e={searchText:c,types:U};return t.isPreconfigured?{filters:{...e,kueryNode:Object(C.fromKueryExpression)(`alert.attributes.actions:{ actionRef: "${T.preconfiguredConnectorActionRefPrefix}${t.id}" }`)}}:t.isSystemAction?{filters:{...e,kueryNode:Object(C.fromKueryExpression)(`alert.attributes.actions:{ actionRef: "${T.systemConnectorActionRefPrefix}${t.id}" }`)}}:{filters:e,hasReference:{type:"action",id:t.id}}}),[t,c,U]),{rulesState:B}=Object(S.a)({...w,hasDefaultRuleTypesFiltersOn:0===U.length,page:j,sort:m,onPage:g,enabled:R&&f}),P=!O.initialLoad&&!y,z=(O.initialLoad||B.initialLoad)&&(O.isLoading||!P&&B.isLoading),D=O.isLoading||B.isLoading,N=Object(n.useCallback)((e=>()=>{b(e)}),[b]),_=Object(n.useMemo)((()=>[{field:"name",name:r.i18n.translate("xpack.triggersActionsUI.sections.connectorRulesList.columns.name",{defaultMessage:"Name"}),sortable:!0,truncateText:!1,width:"33%",render:(e,t)=>{var n;return Object(u.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"xs"},Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiLink,{title:e,href:s("management",{path:`insightsAndAlerting/triggersActions/${Object(F.a)(t.id)}`})},e)),Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiText,{color:"subdued",size:"xs"},(null===(n=O.data.get(t.ruleTypeId))||void 0===n?void 0:n.name)||t.ruleTypeId)))}},{field:"tags",name:r.i18n.translate("xpack.triggersActionsUI.sections.connectorRulesList.columns.tags",{defaultMessage:"Tags"}),width:"50px",sortable:!1,render:(e,t)=>e.length>0?Object(u.jsx)(L.RuleTagBadge,{isOpen:d===t.id,tags:e,onClick:N(t.id),onClose:N(null)}):null},{field:"lastRun.outcome",name:r.i18n.translate("xpack.triggersActionsUI.sections.connectorRulesList.columns.lastResponse",{defaultMessage:"Last response"}),width:"150px",sortable:!0,truncateText:!1,align:"right",render:(e,t)=>t.lastRun&&Object(u.jsx)(o.EuiHealth,{color:Object(E.d)(t)||"default"},I.K[t.lastRun.outcome])}]),[O,d,s,N]),V=Object(n.useCallback)((e=>{a(e.target.value)}),[]),$=Object(n.useCallback)((()=>{l(i)}),[i]);return P?Object(u.jsx)(M.a,null):z?Object(u.jsx)(A.a,null):Object(u.jsx)(o.EuiFlexGroup,{direction:"column"},Object(u.jsx)(o.EuiFlexItem,null,Object(u.jsx)(o.EuiFieldSearch,{"data-test-subj":"connectorRulesListSearch","aria-label":r.i18n.translate("xpack.triggersActionsUI.sections.connectorRulesList.fieldSearch.label",{defaultMessage:"Search rules by name and tags"}),fullWidth:!0,incremental:!1,onChange:V,onSearch:$,placeholder:r.i18n.translate("xpack.triggersActionsUI.sections.connectorRulesList.fieldSearch.placeholder",{defaultMessage:"Search rules by name and tags"}),value:i})),Object(u.jsx)(o.EuiFlexItem,null,Object(u.jsx)(o.EuiBasicTable,{"data-test-subj":"connectorRulesList",loading:D,items:B.data,columns:_,sorting:{sort:m},pagination:{pageIndex:j.index,pageSize:j.size,totalItemCount:O.initialLoad?0:B.totalItemCount},onChange:({page:e,sort:t})=>{e&&g(e),t&&x(t)},rowProps:{"data-test-subj":"connectorRuleRow"}})))};var U=s(50);const w=({icon:e,isExperimental:t=!1,isPreconfigured:s,connectorName:c,connectorTypeId:l,connectorTypeDesc:d,selectedTab:j,setTab:g})=>{const{application:{capabilities:x}}=Object(p.b)().services,{euiTheme:O}=Object(o.useEuiTheme)(),f=Object(m.c)(x,l),h=Object(n.useCallback)((()=>{g(b.h.Configuration)}),[g]),y=Object(n.useCallback)((()=>{g(b.h.Test)}),[g]),F=Object(n.useCallback)((()=>{g(b.h.Rules)}),[g]);return Object(u.jsx)(o.EuiFlyoutHeader,{hasBorder:!0,"data-test-subj":"edit-connector-flyout-header"},Object(u.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},e?Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiIcon,{type:e,size:"m","data-test-subj":"edit-connector-flyout-header-icon"})):null,Object(u.jsx)(o.EuiFlexItem,{grow:!1},s?Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiFlexGroup,{gutterSize:"s",justifyContent:"center",alignItems:"center"},Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiTitle,{size:"s"},Object(u.jsx)("h3",{id:"flyoutTitle"},Object(u.jsx)(a.FormattedMessage,{defaultMessage:"{connectorName}",id:"xpack.triggersActionsUI.sections.preconfiguredConnectorForm.flyoutTitle",values:{connectorName:c}})))),Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiBetaBadge,{label:"Preconfigured","data-test-subj":"preconfiguredBadge",tooltipContent:r.i18n.translate("xpack.triggersActionsUI.sections.preconfiguredConnectorForm.tooltipContent",{defaultMessage:"This connector is preconfigured and cannot be edited"})})),Object(u.jsx)(o.EuiFlexItem,{grow:!1},t&&Object(u.jsx)(o.EuiBetaBadge,{label:U.q,tooltipContent:U.p}))),Object(u.jsx)(o.EuiText,{size:"s"},Object(u.jsx)(a.FormattedMessage,{defaultMessage:"{connectorTypeDesc}",id:"xpack.triggersActionsUI.sections.editConnectorForm.actionTypeDescription",values:{connectorTypeDesc:d}}))):Object(u.jsx)(o.EuiFlexGroup,{gutterSize:"s",justifyContent:"center",alignItems:"center"},Object(u.jsx)(o.EuiFlexItem,null,Object(u.jsx)(o.EuiTitle,{size:"s"},Object(u.jsx)("h3",{id:"flyoutTitle"},Object(u.jsx)(a.FormattedMessage,{defaultMessage:"Edit connector",id:"xpack.triggersActionsUI.sections.editConnectorForm.flyoutPreconfiguredTitle"})))),t&&Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiBetaBadge,{label:U.q,tooltipContent:U.p}))))),Object(u.jsx)(o.EuiTabs,{className:"connectorEditFlyoutTabs",bottomBorder:!1,css:Object(u.css)("margin-bottom:-",O.size.l,";","")},Object(u.jsx)(o.EuiTab,{onClick:h,"data-test-subj":"configureConnectorTab",isSelected:b.h.Configuration===j},r.i18n.translate("xpack.triggersActionsUI.sections.editConnectorForm.tabText",{defaultMessage:"Configuration"})),Object(u.jsx)(o.EuiTab,{onClick:F,"data-test-subj":"rulesConnectorTab",isSelected:b.h.Rules===j},r.i18n.translate("xpack.triggersActionsUI.sections.rulesConnectorList.tabText",{defaultMessage:"Rules"})),f&&Object(u.jsx)(o.EuiTab,{onClick:y,"data-test-subj":"testConnectorTab",isSelected:b.h.Test===j},r.i18n.translate("xpack.triggersActionsUI.sections.testConnectorForm.tabText",{defaultMessage:"Test"}))))},B=Object(n.memo)(w),P=({onClose:e})=>Object(u.jsx)(o.EuiFlyoutFooter,{"data-test-subj":"edit-connector-flyout-footer"},Object(u.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(u.jsx)(o.EuiFlexItem,{grow:!1},Object(u.jsx)(o.EuiButtonEmpty,{onClick:e,"data-test-subj":"edit-connector-flyout-close-btn"},r.i18n.translate("xpack.triggersActionsUI.sections.editConnectorForm.closeButtonLabel",{defaultMessage:"Close"}))),Object(u.jsx)(o.EuiFlexItem,{grow:!1}))),z=Object(n.memo)(P),D=e=>{var t;return{...e,isMissingSecrets:null!==(t=e.isMissingSecrets)&&void 0!==t&&t,secrets:{}}},N=({actionTypeRegistry:e,connector:t,onClose:s,tab:x=b.h.Configuration,onConnectorUpdated:f})=>{const{docLinks:h,application:{capabilities:y}}=Object(p.b)().services,F=Object(n.useRef)(!1),C=Object(m.e)(y),{isLoading:T,updateConnector:E}=(()=>{const{http:e,notifications:{toasts:t}}=Object(p.b)().services,[s,i]=Object(n.useState)(!1),o=Object(n.useRef)(new AbortController),a=Object(n.useRef)(!1);return Object(n.useEffect)((()=>(a.current=!0,()=>{a.current=!1,o.current.abort()})),[]),{isLoading:s,updateConnector:async function(s){i(!0),a.current=!0,o.current.abort(),o.current=new AbortController;try{const n=await Object(g.f)({http:e,connector:s,id:s.id});return a.current&&(i(!1),t.addSuccess(r.i18n.translate("xpack.triggersActionsUI.sections.editConnectorForm.updateSuccessNotificationText",{defaultMessage:"Updated ''{connectorName}''",values:{connectorName:n.name}}))),n}catch(e){var n,c;a.current&&(i(!1),"AbortError"!==e.name&&t.addDanger(null!==(n=null===(c=e.body)||void 0===c?void 0:c.message)&&void 0!==n?n:r.i18n.translate("xpack.triggersActionsUI.sections.editConnectorForm.updateErrorNotificationText",{defaultMessage:"Cannot update a connector."})))}}}})(),{isLoading:v,executeConnector:S}=(()=>{const{http:e}=Object(p.b)().services,[t,s]=Object(n.useState)(!1),i=Object(n.useRef)(new AbortController),o=Object(n.useRef)(!1);return Object(n.useEffect)((()=>(o.current=!0,()=>{o.current=!1,i.current.abort()})),[]),{isLoading:t,executeConnector:async function({connectorId:t,params:n}){s(!0),o.current=!0,i.current.abort(),i.current=new AbortController;try{const i=await Object(g.c)({http:e,id:t,params:n});return o.current&&s(!1),i}catch(e){if(o.current&&(s(!1),"AbortError"!==e.name))throw e}}}})(),[k,I]=Object(n.useState)(null),[M,A]=Object(n.useState)({isSubmitted:!1,isSubmitting:!1,isValid:void 0,submit:async()=>({isValid:!1,data:{}}),preSubmitValidator:null}),[L,U]=Object(n.useState)(x),[w,P]=Object(n.useState)({}),[N,_]=Object(n.useState)(l.none),V=Object(n.useCallback)((e=>{e===b.h.Configuration&&N!==l.none&&_(l.none),U(e)}),[N,_]),[$,H]=Object(n.useState)(!1),[K,q]=Object(n.useState)(!1),[G,W]=Object(n.useState)(!0),[J,Y]=Object(n.useState)(!1),{preSubmitValidator:Q,submit:X,isValid:Z,isSubmitting:ee}=M,te=!1===Z,se=T||ee||v,ne=e.get(t.actionTypeId),ie=C&&ne&&!t.isPreconfigured,oe=Object(n.useCallback)((async()=>{try{const e=await S({connectorId:t.id,params:w});_(Object(l.some)(e))}catch(e){const s=Object(c.isActionTypeExecutorResult)(e)?e:{actionId:t.id,status:"error",message:e.message};_(Object(l.some)(s))}}),[t.id,S,w]),ae=Object(n.useCallback)((e=>{e&&Y(!1),H(e),_(l.none)}),[H]),re=Object(n.useCallback)((()=>{$?q(!0):s()}),[s,$,q]),ce=Object(n.useCallback)((async()=>{I(null);const{isValid:e,data:s}=await X();if(F.current&&e){if(Q){const e=await Q();if(e)return void I(e.message)}const{name:e,config:n,secrets:i}=s,o={id:t.id,name:null!=e?e:"",config:null!=n?n:{},secrets:null!=i?i:{}},a=await E(o);return a&&(ae(!1),f&&f(a),Y(!0),W(!1),W(!0)),a}}),[f,X,Q,t.id,E,ae]);Object(n.useEffect)((()=>(F.current=!0,()=>{F.current=!1})),[]);const le=Object(n.useCallback)((()=>t.isPreconfigured||t.isSystemAction?Object(u.jsx)(d,{href:h.links.alerting.preconfiguredConnectors,extraComponent:null==ne?void 0:ne.actionReadOnlyExtraComponent,connectorId:t.id,connectorName:t.name}):Object(u.jsx)(i.a.Fragment,null,G&&Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(j.a,{actionTypeModel:ne,connector:D(t),isEdit:G,onChange:A,onFormModifiedChange:ae}),!!k&&Object(u.jsx)("p",null,k),ie&&Object(u.jsx)(o.EuiButton,{fill:!0,iconType:J?"check":void 0,color:"success","data-test-subj":"edit-connector-flyout-save-btn",isLoading:se,onClick:ce,disabled:!$||te||se},J?Object(u.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.editConnectorForm.saveButtonSavedLabel",defaultMessage:"Changes Saved"}):Object(u.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.editConnectorForm.saveButtonLabel",defaultMessage:"Save"}))))),[t,ne,G,h.links.alerting.preconfiguredConnectors,te,$,J,se,k,ie,ce,ae]),ue=Object(n.useCallback)((()=>Object(u.jsx)(O,{connector:t,executeEnabled:!$,actionParams:w,setActionParams:P,onExecutionAction:oe,isExecutingAction:v,executionResult:N,actionTypeRegistry:e})),[t,e,v,$,w,N,oe]),de=Object(n.useCallback)((()=>Object(u.jsx)(R,{connector:t})),[t]);return Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiFlyout,{onClose:re,"aria-labelledby":"flyoutActionEditTitle",size:"m","data-test-subj":"edit-connector-flyout"},Object(u.jsx)(B,{isPreconfigured:t.isPreconfigured,connectorName:t.name,connectorTypeId:t.actionTypeId,connectorTypeDesc:null==ne?void 0:ne.selectMessage,setTab:V,selectedTab:L,icon:null==ne?void 0:ne.iconClass,isExperimental:null==ne?void 0:ne.isExperimental}),Object(u.jsx)(o.EuiFlyoutBody,null,L===b.h.Configuration&&le(),L===b.h.Test&&ue(),L===b.h.Rules&&de()),Object(u.jsx)(z,{onClose:re})),K&&Object(u.jsx)(o.EuiConfirmModal,{buttonColor:"danger","data-test-subj":"closeConnectorEditConfirm",title:r.i18n.translate("xpack.triggersActionsUI.sections.confirmConnectorEditClose.title",{defaultMessage:"Discard unsaved changes to connector?"}),onCancel:()=>{q(!1)},onConfirm:s,cancelButtonText:r.i18n.translate("xpack.triggersActionsUI.sections.confirmConnectorEditClose.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.triggersActionsUI.sections.confirmConnectorEditClose.discardButtonLabel",{defaultMessage:"Discard Changes"})},Object(u.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmConnectorEditClose.confirmConnectorCloseMessage",defaultMessage:"You can't recover unsaved changes."})))},_=Object(n.memo)(N)}}]);