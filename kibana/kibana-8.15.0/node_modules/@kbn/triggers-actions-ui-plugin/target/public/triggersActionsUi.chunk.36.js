/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[36,19],{120:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var s=n(1),i=n.n(s),o=n(24),a=n(3),c=n(2),r=(n(271),n(50)),l=n(131),u=n(29),d=n(232),b=n(206),j=n(21),g=n(23),p=n(0);const m=({actionType:e,onClose:t,postSaveEventHandler:n,actionTypeRegistry:m})=>{var f,O;const{application:{capabilities:x},http:v,notifications:{toasts:y}}=Object(u.b)().services,[h,F]=Object(s.useState)(e),[C,S]=Object(s.useState)(!1),[M,E]=Object(s.useState)(void 0),{isLoading:T,createConnector:k}=Object(d.a)(),I=Object(s.useRef)(!1),[L,w]=Object(s.useState)({actionTypeId:null!==(f=null==h?void 0:h.id)&&void 0!==f?f:"",isDeprecated:!1,config:{},secrets:{},isMissingSecrets:!1}),A=Object(l.e)(x),z=m.get(h.id),U=z&&z.subtype?(null!==(O=null==z?void 0:z.subtype)&&void 0!==O?O:[]).map((e=>({...m.get(e.id),name:e.name}))):[],V=U.map((e=>({id:e.id,label:e.name,"data-test-subj":`${e.id}Button`}))),_=Object(s.useRef)(),[B,N]=Object(s.useState)(null),[D,R]=Object(s.useState)({isSubmitted:!1,isSubmitting:!1,isValid:void 0,submit:async()=>({isValid:!1,data:{}}),preSubmitValidator:null}),{preSubmitValidator:P,submit:H,isValid:$,isSubmitting:q}=D,G=!1===$,W=T||q,Y=Object(s.useCallback)((async()=>{N(null);const{isValid:e,data:t}=await H();if(I.current&&e){if(P){const e=await P();if(e)return void N(e.message)}const{actionTypeId:e,name:n,config:s,secrets:i}=t,o={actionTypeId:e,name:null!=n?n:"",config:s,secrets:i};return await k(o)}}),[H,P,k]),J=Object(s.useCallback)((()=>{t()}),[t]),K=Object(s.useCallback)((async()=>{const e=await Y();e&&(J(),n&&n(e))}),[Y,J,n]);return Object(s.useEffect)((()=>(I.current=!0,()=>{I.current=!1})),[]),Object(s.useEffect)((()=>{(async()=>{try{S(!0);const e=await Object(j.d)({http:v});S(!1);const t={};for(const n of e)t[n.id]=n;E(t)}catch(e){y&&y.addDanger({title:c.i18n.translate("xpack.triggersActionsUI.sections.actionsConnectorsList.unableToLoadConnectorTypesMessage",{defaultMessage:"Unable to load connector types"})})}})()}),[]),Object(p.jsx)(a.EuiModal,{className:"actConnectorModal","data-test-subj":"connectorAddModal",onClose:J,style:{width:m.get(h.id).modalWidth}},Object(p.jsx)(a.EuiModalHeader,null,Object(p.jsx)(a.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},z&&z.iconClass?Object(p.jsx)(a.EuiFlexItem,{grow:!1},Object(p.jsx)(a.EuiIcon,{type:z.iconClass,size:"xl"})):null,Object(p.jsx)(a.EuiFlexItem,{grow:!1},Object(p.jsx)(a.EuiFlexGroup,{gutterSize:"s",justifyContent:"center",alignItems:"center"},Object(p.jsx)(a.EuiFlexItem,null,Object(p.jsx)(a.EuiModalHeaderTitle,{size:"s",component:"h3",id:"flyoutTitle"},Object(p.jsx)(o.FormattedMessage,{defaultMessage:"{actionTypeName} connector",id:"xpack.triggersActionsUI.sections.addModalConnectorForm.flyoutTitle",values:{actionTypeName:h.name}}))),z&&z.isExperimental&&Object(p.jsx)(a.EuiFlexItem,{className:"betaBadgeFlexItem",grow:!1},Object(p.jsx)(a.EuiBetaBadge,{label:r.q,tooltipContent:r.p})))))),Object(p.jsx)(a.EuiModalBody,null,C?Object(p.jsx)(g.d,null,Object(p.jsx)(o.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddModal.loadingConnectorTypesDescription",defaultMessage:"Loading connector types…"})):Object(p.jsx)(i.a.Fragment,null,U&&Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(a.EuiButtonGroup,{isFullWidth:!0,buttonSize:"m",color:"primary",legend:"",options:V,idSelected:h.id,onChange:e=>{M&&M[e]&&(F(M[e]),w({actionTypeId:e,isDeprecated:!1,config:{},secrets:{},isMissingSecrets:!1}),_.current&&_.current({resetValues:!0,defaultValue:{actionTypeId:e,isDeprecated:!1,config:{},secrets:{}}}))},"data-test-subj":"slackTypeChangeButton"}),Object(p.jsx)(a.EuiSpacer,{size:"xs"})),Object(p.jsx)(b.a,{actionTypeModel:z,connector:L,isEdit:!1,onChange:R,setResetForm:e=>{_.current=e}}),B)),Object(p.jsx)(a.EuiModalFooter,null,Object(p.jsx)(a.EuiButtonEmpty,{onClick:J,isLoading:W},c.i18n.translate("xpack.triggersActionsUI.sections.addModalConnectorForm.cancelButtonLabel",{defaultMessage:"Cancel"})),A?Object(p.jsx)(a.EuiButton,{fill:!0,color:"success","data-test-subj":"saveActionButtonModal",type:"submit",iconType:"check",isLoading:W,disabled:G,onClick:K},Object(p.jsx)(o.FormattedMessage,{id:"xpack.triggersActionsUI.sections.addModalConnectorForm.saveButtonLabel",defaultMessage:"Save"})):null))}},131:function(e,t,n){"use strict";n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return r}));const s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},o=(e,t)=>{var n,s;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(s=e.actions)||void 0===s?void 0:s.execute},a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function c(e,t){var n,s;return null!==(n=null==t||null===(s=t.authorizedConsumers[e])||void 0===s?void 0:s.all)&&void 0!==n&&n}const r=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},206:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var s=n(1),i=n.n(s),o=n(10),a=n(18),c=n(3),r=n(24),l=n(59),u=n(131),d=n(29),b=n(68),j=n(45),g=n(2),p=n(0);const{emptyField:m}=b.fieldValidators,f={label:"Connector name",validations:[{validator:m(g.i18n.translate("xpack.triggersActionsUI.sections.actionConnectorForm.error.requiredNameText",{defaultMessage:"Name is required."}))}]},O=({canSave:e})=>Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(a.UseField,{path:"id",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"actionTypeId",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"isDeprecated",component:j.HiddenField}),Object(p.jsx)(a.UseField,{path:"name",config:f,component:j.Field,componentProps:{euiFieldProps:{readOnly:!e,"data-test-subj":"nameInput",fullWidth:!0}}})),x=Object(s.memo)(O),v=({actionTypeModel:e,isEdit:t,registerPreSubmitValidator:n})=>{var o;const{application:{capabilities:a}}=Object(d.b)().services,b=Object(u.e)(a),j=null!==(o=null==e?void 0:e.actionConnectorFields)&&void 0!==o?o:null;return Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(x,{canSave:b}),Object(p.jsx)(c.EuiSpacer,{size:"m"}),null!==j?Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(c.EuiTitle,{size:"xxs","data-test-subj":"connector-settings-label"},Object(p.jsx)("h4",null,Object(p.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionConnectorForm.connectorSettingsLabel",defaultMessage:"Connector settings"}))),Object(p.jsx)(c.EuiSpacer,{size:"s"}),Object(p.jsx)(c.EuiErrorBoundary,null,Object(p.jsx)(s.Suspense,{fallback:Object(p.jsx)(l.a,null,Object(p.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionConnectorForm.loadingConnectorSettingsDescription",defaultMessage:"Loading connector settings…"}))},Object(p.jsx)(j,{readOnly:!b,isEdit:t,registerPreSubmitValidator:n})))):null)},y=Object(s.memo)(v),h=({title:e,dataTestSubj:t})=>Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(c.EuiSpacer,{size:"s"}),Object(p.jsx)(c.EuiCallOut,{size:"s",iconType:"iInCircle","data-test-subj":t,title:e}),Object(p.jsx)(c.EuiSpacer,{size:"m"})),F=e=>null!=e||!F(e),C=({isEdit:e,isMissingSecrets:t})=>{const[n]=Object(a.useFormData)(),{getFields:s}=Object(a.useFormContext)(),i=s(),o=(c=i,Object.keys(c).filter((e=>e.includes("secrets"))).reduce(((e,t)=>({...e,[t]:c[t]})),{}));var c;const r=Object.keys(o).length,l=(e=>{if(0===e.length)return"";if(1===e.length)return`${e[0]}`;if(2===e.length)return e.join(" and ");const t=e[e.length-1];return`${e.slice(0,-1).join(", ")}, and ${t}`})((e=>Object.keys(e).map((t=>e[t].label)).filter(F))(o));return 0===Object.keys(o).length?null:t?Object(p.jsx)(h,{title:g.i18n.translate("xpack.triggersActionsUI.components.builtinActionTypes.missingSecretsValuesLabel",{values:{secretFieldsLabel:l,encryptedFieldsLength:r},defaultMessage:"Sensitive information is not imported. Please enter value{encryptedFieldsLength, plural, one {} other {s}} for the following field{encryptedFieldsLength, plural, one {} other {s}} {secretFieldsLabel}."}),dataTestSubj:"missing-secrets-callout"}):e?e?Object(p.jsx)(h,{title:g.i18n.translate("xpack.triggersActionsUI.components.simpleConnectorForm.secrets.reenterValuesMessage",{values:{secretFieldsLabel:l,encryptedFieldsLength:r},defaultMessage:"Value{encryptedFieldsLength, plural, one {} other {s}} {secretFieldsLabel} {encryptedFieldsLength, plural, one {is} other {are}} encrypted. Please reenter value{encryptedFieldsLength, plural, one {} other {s}} for {encryptedFieldsLength, plural, one {this} other {these}} field{encryptedFieldsLength, plural, one {} other {s}}."}),dataTestSubj:"edit-connector-secrets-callout"}):null:Object(p.jsx)(h,{title:g.i18n.translate("xpack.triggersActionsUI.components.simpleConnectorForm.secrets.reenterValuesLabel",{values:{secretFieldsLabel:l,encryptedFieldsLength:r},defaultMessage:"Remember your {secretFieldsLabel} {encryptedFieldsLength, plural, one {value} other {values}}. You must reenter {encryptedFieldsLength, plural, one {it} other {them}} each time you edit the connector."}),dataTestSubj:"create-connector-secrets-callout"})},S=Object(s.memo)(C),M=e=>{var t,n;if(".webhook"!==e.actionTypeId&&".cases-webhook"!==e.actionTypeId)return e;const s=e,i=Object.entries(null!==(t=null==s||null===(n=s.config)||void 0===n?void 0:n.headers)&&void 0!==t?t:{}).map((([e,t])=>({key:e,value:t})));return{...e,config:{...e.config,headers:Object(o.isEmpty)(i)?void 0:i}}},E=e=>{var t,n;if(".webhook"!==e.actionTypeId&&".cases-webhook"!==e.actionTypeId)return e;const s=(null!==(t=null==e||null===(n=e.config)||void 0===n?void 0:n.headers)&&void 0!==t?t:[]).reduce(((e,t)=>({...e,[t.key]:t.value})),{});return{...e,config:{...e.config,headers:Object(o.isEmpty)(s)?null:s}}},T=({actionTypeModel:e,connector:t,isEdit:n,onChange:i,onFormModifiedChange:o,setResetForm:r})=>{const{form:l}=Object(a.useForm)({defaultValue:t,serializer:E,deserializer:M}),{submit:u,isValid:d,isSubmitted:b,isSubmitting:j,reset:g}=l,[m,f]=Object(s.useState)(null),O=Object(s.useCallback)((e=>{f((()=>e))}),[]),x=Object(a.useFormIsModified)({form:l,discard:["__internal__"]});return Object(s.useEffect)((()=>{i&&i({isValid:d,isSubmitted:b,isSubmitting:j,submit:u,preSubmitValidator:m})}),[i,d,b,j,u,m]),Object(s.useEffect)((()=>{o&&o(x)}),[x,o]),Object(s.useEffect)((()=>{r&&r(g)}),[g]),Object(p.jsx)(a.Form,{form:l},Object(p.jsx)(y,{actionTypeModel:e,isEdit:n,registerPreSubmitValidator:O}),Object(p.jsx)(c.EuiSpacer,{size:"m"}),Object(p.jsx)(S,{isEdit:n,isMissingSecrets:t.isMissingSecrets}))},k=i.a.memo(T)},232:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var s=n(1),i=n(2),o=n(21),a=n(29);const c=()=>{const{http:e,notifications:{toasts:t}}=Object(a.b)().services,[n,c]=Object(s.useState)(!1),r=Object(s.useRef)(new AbortController),l=Object(s.useRef)(!1);return Object(s.useEffect)((()=>(l.current=!0,()=>{l.current=!1,r.current.abort()})),[]),{isLoading:n,createConnector:async function(n){c(!0),l.current=!0,r.current.abort(),r.current=new AbortController;try{const s=await Object(o.a)({http:e,connector:n});return l.current&&(c(!1),t.addSuccess(i.i18n.translate("xpack.triggersActionsUI.sections.addConnectorForm.updateSuccessNotificationText",{defaultMessage:"Created ''{connectorName}''",values:{connectorName:s.name}}))),s}catch(e){var s,a;l.current&&(c(!1),"AbortError"!==e.name&&t.addDanger(null!==(s=null===(a=e.body)||void 0===a?void 0:a.message)&&void 0!==s?s:i.i18n.translate("xpack.triggersActionsUI.sections.useCreateConnector.updateErrorNotificationText",{defaultMessage:"Cannot create a connector."})))}}}}},271:function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(272);case"v8light":return n(274)}},272:function(e,t,n){var s=n(54),i=n(273);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},273:function(e,t,n){(t=n(55)(!1)).push([e.i,".actConnectorModal{z-index:9000}.euiComboBoxOptionsList{z-index:9001}",""]),e.exports=t},274:function(e,t,n){var s=n(54),i=n(275);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},275:function(e,t,n){(t=n(55)(!1)).push([e.i,".actConnectorModal{z-index:9000}.euiComboBoxOptionsList{z-index:9001}",""]),e.exports=t}}]);