/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[42,45],{124:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleSnoozeModal",(function(){return d})),s.d(t,"default",(function(){return d}));var n=s(1),o=s(3),i=s(29),l=s(139),a=s(140),u=s(98),r=s(169),c=s(0);const d=({rule:e,onClose:t,onLoading:s,onRuleChanged:d})=>{var b,g;const{http:f,notifications:{toasts:j}}=Object(i.b)().services,S=Object(n.useMemo)((()=>(e=>Boolean(e.isSnoozedUntil&&new Date(e.isSnoozedUntil).getTime()>Date.now()||e.muteAll))(e)),[e]),O=Object(n.useCallback)((async n=>{try{s(!0),t(),await Object(l.b)({http:f,id:e.id,snoozeSchedule:n}),d(),j.addSuccess(u.SNOOZE_SUCCESS_MESSAGE)}catch(e){j.addDanger(u.SNOOZE_FAILED_MESSAGE)}finally{s(!1)}}),[s,t,f,e.id,d,j]),p=Object(n.useCallback)((async n=>{try{s(!0),t(),await Object(a.b)({http:f,id:e.id,scheduleIds:n}),d(),j.addSuccess(u.UNSNOOZE_SUCCESS_MESSAGE)}catch(e){j.addDanger(u.SNOOZE_FAILED_MESSAGE)}finally{s(!1)}}),[s,t,f,e.id,d,j]);return Object(c.jsx)(o.EuiModal,{onClose:t,"data-test-subj":"ruleSnoozeModal"},Object(c.jsx)(o.EuiModalBody,null,Object(c.jsx)(o.EuiSpacer,{size:"s"}),Object(c.jsx)(r.a,{inPopover:!1,interval:Object(r.b)(e.isSnoozedUntil),activeSnoozes:null!==(b=e.activeSnoozes)&&void 0!==b?b:[],scheduledSnoozes:null!==(g=e.snoozeSchedule)&&void 0!==g?g:[],showCancel:S,snoozeRule:O,unsnoozeRule:p})))}},139:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return l}));var n=s(6);function o({id:e,duration:t,rRule:s}){return{...e?{id:e}:{},duration:t,rRule:{...s,...s.until?{until:s.until.toISOString()}:{}}}}async function i({id:e,snoozeSchedule:t,http:s}){await s.post(`${n.m}/rule/${encodeURIComponent(e)}/_snooze`,{body:JSON.stringify({snooze_schedule:o(t)})})}function l({ids:e,filter:t,snoozeSchedule:s,http:i}){let l;try{l=JSON.stringify({ids:null!=e&&e.length?e:void 0,...t?{filter:JSON.stringify(t)}:{},operations:[{operation:"set",field:"snoozeSchedule",value:o(s)}]})}catch(e){throw new Error(`Unable to parse bulk snooze params: ${e}`)}return i.post(`${n.m}/rules/_bulk_edit`,{body:l})}},140:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return i}));var n=s(6);async function o({id:e,http:t,scheduleIds:s}){await t.post(`${n.m}/rule/${encodeURIComponent(e)}/_unsnooze`,{body:JSON.stringify({schedule_ids:s})})}function i({ids:e,filter:t,scheduleIds:s,http:o}){let i;try{i=JSON.stringify({ids:null!=e&&e.length?e:void 0,...t?{filter:JSON.stringify(t)}:{},operations:[{operation:"delete",field:"snoozeSchedule",value:s}]})}catch(e){throw new Error(`Unable to parse bulk unsnooze params: ${e}`)}return o.post(`${n.m}/rules/_bulk_edit`,{body:i})}},98:function(e,t,s){"use strict";s.r(t),s.d(t,"RulesListNotifyBadge",(function(){return x})),s.d(t,"SNOOZE_SUCCESS_MESSAGE",(function(){return g})),s.d(t,"UNSNOOZE_SUCCESS_MESSAGE",(function(){return f})),s.d(t,"SNOOZE_FAILED_MESSAGE",(function(){return j})),s.d(t,"default",(function(){return E}));var n=s(1),o=s(29),i=s(140),l=s(139),a=s(33),u=s.n(a),r=s(3),c=s(2),d=s(187),b=s(169);const g=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeSuccess",{defaultMessage:"Rules notification successfully snoozed"}),f=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.unsnoozeSuccess",{defaultMessage:"Rules notification successfully unsnoozed"}),j=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListSnoozePanel.snoozeFailed",{defaultMessage:"Unable to change rule snooze settings"}),S=c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.openSnoozePanel",{defaultMessage:"Open snooze panel"}),O=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.seconds",{defaultMessage:"{value, plural, one {# second} other {# seconds}}",values:{value:e}}),p=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.minutes",{defaultMessage:"{value, plural, one {# minute} other {# minutes}}",values:{value:e}}),h=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.hours",{defaultMessage:"{value, plural, one {# hour} other {# hours}}",values:{value:e}}),v=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.days",{defaultMessage:"{value, plural, one {# day} other {# days}}",values:{value:e}}),y=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.weeks",{defaultMessage:"{value, plural, one {# week} other {# weeks}}",values:{value:e}}),z=e=>c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.months",{defaultMessage:"{value, plural, one {# month} other {# months}}",values:{value:e}});var m=s(0);const x=({snoozeSettings:e,loading:t=!1,disabled:s=!1,onRuleChanged:i,snoozeRule:l,unsnoozeRule:a,showOnHover:x=!1,showTooltipInline:E=!1})=>{var L,I,M;const[N,w]=Object(n.useState)(!1),k=t||N,A=Boolean(s)||!e,[U,B]=Object(n.useState)(!1),C=Object(n.useCallback)((()=>B(!0)),[B]),R=Object(n.useCallback)((()=>B(!1)),[B]),_=null==e?void 0:e.isSnoozedUntil,T=null!==(L=null==e?void 0:e.muteAll)&&void 0!==L&&L,F=Object(n.useMemo)((()=>{return!!e&&(t=e,Boolean(t.isSnoozedUntil&&new Date(t.isSnoozedUntil).getTime()>Date.now()||t.muteAll));var t}),[e]),D=Object(n.useMemo)((()=>e?(e=>{if(!e.snoozeSchedule)return null;const t=e.snoozeSchedule.filter((e=>Boolean(e.id)));return 0===t.length?null:t.reduce(((e,t)=>u()(t.rRule.dtstart).isBefore(u()(e.rRule.dtstart))?t:e))})(e):null),[e]),P=Object(n.useMemo)((()=>_?function(e){const t=u.a.duration(u()(e).diff(u()())),s={years:(i=t.years(),c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.years",{defaultMessage:"{value, plural, one {# year} other {# years}}",values:{value:i}})),months:z(t.months()),weeks:y(t.weeks()),days:v(t.days()),hours:h(t.hours()),minutes:p(t.minutes()),seconds:O(t.seconds())},n=Object.entries(s).filter((([e,t])=>""!==t&&t!==`0 ${e}`)).map((([e,t])=>`${t}`)).join(", "),o=n.lastIndexOf(", ");var i;return-1===o?n:n.slice(0,o)+" and"+n.slice(o+1)}(_):void 0),[_]),$=Object(n.useRef)(null),{notifications:{toasts:G}}=Object(o.b)().services,Z=Object(n.useMemo)((()=>!F&&Boolean(D)),[D,F]),J=Object(n.useMemo)((()=>_?Object(d.a)(u()(_)):D?Object(d.a)(u()(D.rRule.dtstart)):""),[_,D]),H=Object(n.useMemo)((()=>T?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedIndefinitelyTooltip",{defaultMessage:"Notifications snoozed indefinitely"}):Z?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozeScheduledTooltip",{defaultMessage:"Notifications scheduled to snooze starting {schedStart}",values:{schedStart:Object(d.b)(u()(D.rRule.dtstart))}}):F&&P?Object(m.jsx)(r.EuiToolTip,{title:c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.timeRemaining",{defaultMessage:"Time remaining"}),content:Object(m.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)("span",null,P)),Object(m.jsx)(r.EuiSpacer,null),Object(m.jsx)(r.EuiFlexItem,{grow:!1},Object(m.jsx)("span",null,null==_?void 0:_.toString())))},Object(m.jsx)(r.EuiTextAlign,null,c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.snoozedTooltip",{defaultMessage:"Notifications snoozing for {snoozeTime}",values:{snoozeTime:u()(_).fromNow(!0)}}))):E?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.noSnoozeAppliedTooltip",{defaultMessage:"Notify when alerts generated"}):""),[T,Z,F,E,D,P,_]),q=Object(n.useMemo)((()=>Object(m.jsx)(r.EuiButton,{size:"s",isLoading:k,disabled:k||A,"data-test-subj":"rulesListNotifyBadge-snoozed","aria-label":S,minWidth:85,iconType:"bellSlash",color:"accent",onClick:C,buttonRef:$},Object(m.jsx)(r.EuiText,{size:"xs"},J))),[J,k,A,C]),W=Object(n.useMemo)((()=>Object(m.jsx)(r.EuiButton,{size:"s",isLoading:k,disabled:k||A,"data-test-subj":"rulesListNotifyBadge-scheduled",minWidth:85,iconType:"calendar",color:"text","aria-label":S,onClick:C,buttonRef:$},Object(m.jsx)(r.EuiText,{size:"xs"},J))),[J,k,A,C]),Y=Object(n.useMemo)((()=>{const e=x?"ruleSidebarItem__action":"";return Object(m.jsx)(r.EuiButtonIcon,{size:"s",isLoading:k,disabled:k||A,display:k?"base":"empty","data-test-subj":"rulesListNotifyBadge-unsnoozed","aria-label":S,className:U||k?"":e,iconType:"bell",onClick:C,buttonRef:$})}),[U,k,A,x,C]),K=Object(n.useMemo)((()=>Object(m.jsx)(r.EuiButtonIcon,{size:"s",isLoading:k,disabled:k||A,display:"base","data-test-subj":"rulesListNotifyBadge-snoozedIndefinitely","aria-label":S,iconType:"bellSlash",color:"accent",onClick:C,buttonRef:$})),[k,A,C]),Q=Object(n.useMemo)((()=>Z?W:T?K:F?q:Y),[F,Z,T,W,q,K,Y]),V=Object(n.useMemo)((()=>{const e="string"==typeof s?s:U||E?void 0:P;return Object(m.jsx)(r.EuiToolTip,{title:e?c.i18n.translate("xpack.triggersActionsUI.sections.rulesList.rulesListNotifyBadge.timeRemaining",{defaultMessage:"Time remaining"}):void 0,content:e},Q)}),[s,U,Q,E,P]),X=Object(n.useCallback)((async e=>{try{w(!0),R(),await l(e),await i(),G.addSuccess(g)}catch(e){G.addDanger(j)}finally{w(!1),requestAnimationFrame((()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.focus()}))}}),[R,l,i,G]),ee=Object(n.useCallback)((async e=>{try{w(!0),R(),await a(e),await i(),G.addSuccess(f)}catch(e){G.addDanger(j)}finally{w(!1),requestAnimationFrame((()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.focus()}))}}),[R,a,i,G]),te=Object(m.jsx)(r.EuiPopover,{"data-test-subj":"rulesListNotifyBadge",isOpen:U&&!A,closePopover:R,button:V,anchorPosition:"rightCenter",panelStyle:{maxHeight:"100vh",overflowY:"auto"}},Object(m.jsx)(b.a,{snoozeRule:X,unsnoozeRule:ee,interval:Object(b.b)(_),showCancel:F,scheduledSnoozes:null!==(I=null==e?void 0:e.snoozeSchedule)&&void 0!==I?I:[],activeSnoozes:null!==(M=null==e?void 0:e.activeSnoozes)&&void 0!==M?M:[],inPopover:!0}));return E?Object(m.jsx)(r.EuiFlexGroup,{alignItems:"center"},Object(m.jsx)(r.EuiFlexItem,{grow:!1},te),Object(m.jsx)(r.EuiFlexItem,null,Object(m.jsx)(r.EuiText,{color:"subdued",size:"xs"},H))):te},E=({ruleId:e,snoozeSettings:t,loading:s,disabled:a,showTooltipInline:u,showOnHover:r,onRuleChanged:c})=>{const{http:d}=Object(o.b)().services,b=Object(n.useCallback)((t=>e?Object(l.b)({http:d,id:e,snoozeSchedule:t}):Promise.resolve()),[d,e]),g=Object(n.useCallback)((t=>e?Object(i.b)({http:d,id:e,scheduleIds:t}):Promise.resolve()),[d,e]);return Object(m.jsx)(x,{snoozeSettings:t,loading:s,disabled:a,onRuleChanged:c,snoozeRule:b,unsnoozeRule:g,showTooltipInline:u,showOnHover:r})}}}]);