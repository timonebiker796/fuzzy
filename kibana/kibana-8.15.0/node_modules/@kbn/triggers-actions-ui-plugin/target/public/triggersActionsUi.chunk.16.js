/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[16,55,59],{131:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return o}));const r=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},s=(e,t)=>{var n,r;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(r=e.actions)||void 0===r?void 0:r.execute},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function u(e,t){var n,r;return null!==(n=null==t||null===(r=t.authorizedConsumers[e])||void 0===r?void 0:r.all)&&void 0!==n&&n}const o=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},134:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(94),a=n(1),s=r.__importDefault(n(135));t.default=function(e,t){var n=a.useState(t),r=n[0],i=n[1];return s.default((function(){var t=e.subscribe(i);return function(){return t.unsubscribe()}}),[e]),r}},135:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;t.default=a},138:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(25);async function a({http:e}){const t=await e.get(`${r.b}/_health`),n=s(t.alerting_framework_health);return{...i(t),alertingFrameworkHealth:n}}const s=({decryption_health:e,execution_health:t,read_health:n,...r})=>({decryptionHealth:e,executionHealth:t,readHealth:n,...r}),i=({is_sufficiently_secure:e,has_permanent_encryption_key:t,alerting_framework_health:n,...r})=>({isSufficientlySecure:e,hasPermanentEncryptionKey:t,alertingFrameworkHealth:n,...r})},141:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return u}));const r=e=>{const{uuid:t,id:n,connector_type_id:r,params:a}=e;return{..."group"in e&&e.group?{group:e.group}:{},id:n,params:a,actionTypeId:r,..."use_alert_data_for_template"in e&&void 0!==e.use_alert_data_for_template?{useAlertDataForTemplate:e.use_alert_data_for_template}:{},..."frequency"in e&&e.frequency?{frequency:{summary:e.frequency.summary,notifyWhen:e.frequency.notify_when,throttle:e.frequency.throttle}}:{},..."alerts_filter"in e&&e.alerts_filter?{alertsFilter:e.alerts_filter}:{},...t&&{uuid:t}}},a=({last_execution_date:e,last_duration:t,...n})=>({lastExecutionDate:e,lastDuration:t,...n}),s=({outcome_msg:e,outcome_order:t,alerts_count:n,...r})=>({outcomeMsg:e,outcomeOrder:t,alertsCount:n,...r}),i=({rule_type_id:e,created_by:t,updated_by:n,created_at:i,updated_at:u,api_key_owner:o,api_key_created_by_user:c,notify_when:l,mute_all:d,muted_alert_ids:f,scheduled_task_id:m,execution_status:y,actions:b,snooze_schedule:j,is_snoozed_until:p,active_snoozes:g,last_run:v,next_run:O,alert_delay:h,..._})=>({ruleTypeId:e,createdBy:t,updatedBy:n,createdAt:i,updatedAt:u,apiKeyOwner:o,notifyWhen:l,muteAll:d,mutedInstanceIds:f,snoozeSchedule:j,executionStatus:y?a(y):void 0,actions:b?b.map((e=>r(e))):[],scheduledTaskId:m,isSnoozedUntil:p,activeSnoozes:g,...v?{lastRun:s(v)}:{},...O?{nextRun:O}:{},...void 0!==c?{apiKeyCreatedByUser:c}:{},...h?{alertDelay:h}:{},..._}),u=({alias_target_id:e,alias_purpose:t,outcome:n,...r})=>({...i(r),alias_target_id:e,alias_purpose:t,outcome:n})},142:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEuiDevProviderWarning=t.getEuiDevProviderWarning=t.emitEuiProviderWarning=void 0;var r=void 0;t.setEuiDevProviderWarning=function(e){return r=e},t.getEuiDevProviderWarning=function(){return r},t.emitEuiProviderWarning=function(e){if("function"==typeof r)return r(e);switch(r){case"log":console.log(e);break;case"warn":console.warn(e);break;case"error":throw new Error(e)}}},144:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n(12),a=n.n(r),s=n(1),i=n(99),u=n(142),o=n(134),c=n.n(o),l=n(97),d=n.n(l),f=n(3);const m="eui-global",y="eui-utilities",b={darkMode:!1};var j=n(0);const p=[f.euiStylisPrefixer],g=d()({key:"css",stylisPlugins:p,container:document.querySelector('meta[name="emotion"]')}),v=d()({key:m,stylisPlugins:p,container:document.querySelector(`meta[name="${m}"]`)}),O=d()({key:y,stylisPlugins:p,container:document.querySelector(`meta[name="${y}"]`)});g.compat=!0,v.compat=!0,O.compat=!0;const h={default:g,global:v,utility:O},_=({theme:{theme$:e},globalStyles:t,colorMode:n,modify:r,children:a})=>{const i=c()(e,b),u=Object(s.useMemo)((()=>(e=>e.darkMode?f.COLOR_MODES_STANDARD.dark:f.COLOR_MODES_STANDARD.light)(i)),[i]),o=n||u,l=!1!==t&&void 0;return Object(j.jsx)(f.EuiProvider,{cache:h,modify:r,colorMode:o,globalStyles:l,utilityClasses:l},a)},x=({children:e,i18n:t,...n})=>Object(i.useIsNestedEuiProvider)()?(Object(u.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(j.jsx)(t.Context,null,e)):Object(j.jsx)(_,n,Object(j.jsx)(t.Context,null,e));var S=n(100);const E=({children:e,...t})=>Object(j.jsx)(x,a()({globalStyles:!1},t),Object(j.jsx)(S.KibanaErrorBoundaryProvider,{analytics:t.analytics},Object(j.jsx)(S.KibanaErrorBoundary,null,e)))},145:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n(96),s=n.n(a),i=n(144),u=n(0);const o=(e,t)=>n=>(s.a.render(Object(u.jsx)(i.a,t,e),n),()=>s.a.unmountComponentAtNode(n));n(16),n(2),r.Component},160:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(2),a=n(1),s=n.n(a),i=n(3),u=n(0);const o=r.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.seeFullError",{defaultMessage:"See full error"}),c=r.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.hideFullError",{defaultMessage:"Hide full error"}),l=({children:e})=>{const[t,n]=Object(a.useState)(!1),r=Object(a.useCallback)((()=>{n((e=>!e))}),[]);return Object(u.jsx)(s.a.Fragment,null,t&&Object(u.jsx)(s.a.Fragment,null,Object(u.jsx)(i.EuiText,{size:"s"},e),Object(u.jsx)(i.EuiSpacer,null)),Object(u.jsx)(i.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(u.jsx)(i.EuiFlexItem,{grow:!1},Object(u.jsx)(i.EuiButton,{size:"s",color:"danger",onClick:r},t?c:o))))}},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(25);const a=async({http:e})=>e.get(`${r.d}/_config`)},178:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(25);const a=async({http:e})=>{const t=await e.get(`${r.d}/_health`);return t?{isRulesAvailable:t.isAlertsAvailable}:t}},190:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(25),a=n(141);async function s({http:e,rule:t}){const n=await e.post(`${r.b}/rule`,{body:JSON.stringify(i(t))});return Object(a.c)(n)}const i=({ruleTypeId:e,actions:t,alertDelay:n,...r})=>({...r,rule_type_id:e,actions:t.map((e=>{const{id:t,params:n}=e;return{..."group"in e&&e.group?{group:e.group}:{},id:t,params:n,..."frequency"in e&&e.frequency?{frequency:{notify_when:e.frequency.notifyWhen,throttle:e.frequency.throttle,summary:e.frequency.summary}}:{},..."alertsFilter"in e&&e.alertsFilter?{alerts_filter:e.alertsFilter}:{},..."useAlertDataForTemplate"in e&&void 0!==e.useAlertDataForTemplate?{use_alert_data_for_template:e.useAlertDataForTemplate}:{}}})),...n?{alert_delay:n}:{}})},191:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return o}));const r=({actions:e,alertDelay:t,...n})=>({...n,actions:e.map((e=>{const{id:t,params:n,uuid:r}=e;return{..."group"in e?{group:e.group}:{},id:t,params:n,..."frequency"in e?{frequency:e.frequency?{notify_when:e.frequency.notifyWhen,throttle:e.frequency.throttle,summary:e.frequency.summary}:void 0}:{},..."alertsFilter"in e?{alerts_filter:e.alertsFilter}:{},..."useAlertDataForTemplate"in e&&void 0!==e.useAlertDataForTemplate?{use_alert_data_for_template:e.useAlertDataForTemplate}:{},...r&&{uuid:r}}})),...t?{alert_delay:t}:{}});var a=n(10),s=n(25),i=n(141);const u=["name","tags","schedule","params","alertDelay","actions"];async function o({http:e,rule:t,id:n}){const o=await e.put(`${s.b}/rule/${encodeURIComponent(n)}`,{body:JSON.stringify(r(Object(a.pick)(t,u)))});return Object(i.c)(o)}},214:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(10),a=n(2);const s=e=>({isEnabled:!1,message:a.i18n.translate("xpack.triggersActionsUI.checkRuleTypeEnabled.ruleTypeDisabledByLicenseMessage",{defaultMessage:"This rule type requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(r.upperFirst)(e.minimumLicenseRequired)}})});function i(e){return!1===(null==e?void 0:e.enabledInLicense)?s(e):{isEnabled:!0}}},84:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return R}));var r=n(1),a=n.n(r),s=n(24),i=n(3),u=n(2),o=n(10),c=n(145),l=n(11),d=n(190),f=n(170),m=n(19),y=n(222),b=n(215),j=n(185),p=n(37),g=n(172),v=n(0);const O=({onConfirm:e,onCancel:t})=>Object(v.jsx)(i.EuiConfirmModal,{title:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:t,onConfirm:e,confirmButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleSaveModal"},Object(v.jsx)("p",null,Object(v.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var h=n(216),_=n(131),x=n(143);const S=({isSaving:e,onSave:t,onCancel:n,onShowRequest:r,isFormLoading:o,isRuleValid:c})=>{const{loadingHealthCheck:l}=Object(x.b)();return Object(v.jsx)(i.EuiFlyoutFooter,null,Object(v.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(v.jsx)(i.EuiFlexItem,{grow:!1},Object(v.jsx)(i.EuiButtonEmpty,{"data-test-subj":"cancelSaveRuleButton",onClick:n},u.i18n.translate("xpack.triggersActionsUI.sections.ruleAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),o?Object(v.jsx)(i.EuiFlexItem,{grow:!1},Object(v.jsx)(i.EuiSpacer,{size:"s"}),Object(v.jsx)(i.EuiLoadingSpinner,{size:"l"})):Object(v.jsx)(a.a.Fragment,null),Object(v.jsx)(i.EuiFlexItem,{grow:!1},Object(v.jsx)(i.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"m"},Object(v.jsx)(i.EuiFlexItem,{grow:!1},Object(v.jsx)(i.EuiButton,{fill:!0,color:"primary","data-test-subj":"showRequestButton",isDisabled:l||!c,onClick:r},Object(v.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.showRequestButtonLabel",defaultMessage:"Show API request"}))),Object(v.jsx)(i.EuiFlexItem,{grow:!1},Object(v.jsx)(i.EuiButton,{fill:!0,color:"success","data-test-subj":"saveRuleButton",type:"submit",iconType:"check",isDisabled:l,isLoading:e,onClick:t},Object(v.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.saveButtonLabel",defaultMessage:"Save"})))))))};var E=n(29),C=n(217),T=n(60),w=n(6),k=n(233),I=n(160),F=n(218);const A=u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}),R=({consumer:e,ruleTypeRegistry:t,actionTypeRegistry:n,onClose:a,canChangeTrigger:R,ruleTypeId:M,initialValues:D,reloadRules:q,onSave:B,hideGrouping:P,hideInterval:U,metadata:L,filteredRuleTypes:z,validConsumers:W,useRuleProducer:N,initialSelectedConsumer:$,...H})=>{var K;const G=null!=B?B:q,[V,J]=Object(r.useState)(L),Y=Object(r.useCallback)((e=>J(e)),[]),Q=Object(r.useMemo)((()=>({params:{},consumer:e,ruleTypeId:M,schedule:{interval:w.h},actions:[],tags:[],...D||{}})),[M,e,D]),X=Object(r.useMemo)((()=>Object(j.a)(n)),[n]),[{rule:Z},ee]=Object(r.useReducer)(X,{rule:Q}),[te,ne]=Object(r.useState)({isUsingSecurity:!1}),[re,ae]=Object(r.useState)({}),[se,ie]=Object(r.useState)(!1),[ue,oe]=Object(r.useState)(!1),[ce,le]=Object(r.useState)(!1),[de,fe]=Object(r.useState)(!1),[me,ye]=Object(r.useState)(H.ruleTypeIndex),[be,je]=Object(r.useState)(!1),[pe,ge]=Object(r.useState)(!1),ve=Object(r.useMemo)((()=>Z.ruleTypeId&&w.o.includes(Z.ruleTypeId)),[Z]),[Oe,he]=Object(r.useState)(ve?$:null),_e=(e,t)=>{ee({command:{type:"setProperty"},payload:{key:e,value:t}})},{http:xe,notifications:{toasts:Se},application:{capabilities:Ee},i18n:Ce,theme:Te,isServerless:we}=Object(E.b)().services,ke=Object(_.f)(Ee);Object(r.useEffect)((()=>{(async()=>{ne(await Object(f.a)({http:xe}))})()}),[xe]),Object(r.useEffect)((()=>{M&&_e("ruleTypeId",M)}),[M]),Object(r.useEffect)((()=>{H.ruleTypeIndex||(async()=>{const e=await Object(p.a)({http:xe}),t=new Map;for(const n of e)t.set(n.id,n);ye(t)})()}),[H.ruleTypeIndex,xe]),Object(r.useEffect)((()=>{Object(o.isEmpty)(Z.params)&&!Object(o.isEmpty)(re)?ae({}):Object(o.isEmpty)(re)&&ae(Z.params)}),[Z.params,re]);const[Ie,Fe]=Object(r.useState)([]),[Ae,Re]=Object(r.useState)(!1);Object(r.useEffect)((()=>{(async()=>{Re(!0);const e=await Object(b.a)(Z.actions,n);Re(!1),Fe([...e])})()}),[Z.actions,n]),Object(r.useEffect)((()=>{var e;!te.minimumScheduleInterval||null!=D&&null!==(e=D.schedule)&&void 0!==e&&e.interval||_e("schedule",{interval:Object(k.a)(te.minimumScheduleInterval.value)})}),[te.minimumScheduleInterval,D]),Object(r.useEffect)((()=>{if(Z.ruleTypeId&&me){const e=me.get(Z.ruleTypeId);null!=e&&e.defaultScheduleInterval&&!be&&_e("schedule",{interval:e.defaultScheduleInterval})}}),[Z.ruleTypeId,me,Z.schedule.interval,be]),Object(r.useEffect)((()=>{Z.schedule.interval===w.h||be||je(!0)}),[Z.schedule.interval,be]);const Me=()=>{Object(C.a)(Z,Q,!1)||Object(C.b)(Z.params,re)?le(!0):a(m.l.CANCELED,V)},De=async()=>{const e=await async function(){try{const e=await Object(d.a)({http:xe,rule:{...Z,...ve&&Oe?{consumer:Oe}:{}}});return Se.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:e.name}})),e}catch(t){var e;const n=Object(l.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||A);Se.addDanger({title:n.summary,...n.details&&{text:Object(c.a)(Object(v.jsx)(I.a,null,n.details),{i18n:Ce,theme:Te})}})}}();ie(!1),e&&(a(m.l.SAVED,V),G&&G(V))},qe=Z.ruleTypeId?t.get(Z.ruleTypeId):null,{ruleBaseErrors:Be,ruleErrors:Pe,ruleParamsErrors:Ue}=Object(r.useMemo)((()=>Object(b.b)({...Z,...ve&&void 0!==Oe?{consumer:Oe}:{}},qe,te,n,we)),[Z,ve,Oe,qe,te,n,we]),Le=ke&&0===(null===(K=Z.actions)||void 0===K?void 0:K.length);return Object(r.useEffect)((()=>{ge(Object(b.c)(Z,Pe,Ie))}),[Z,Pe,Ie]),Object(v.jsx)(i.EuiPortal,null,Object(v.jsx)(i.EuiFlyout,{onClose:Me,"aria-labelledby":"flyoutRuleAddTitle",size:"m",maxWidth:620,ownFocus:!0},Object(v.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},Object(v.jsx)(i.EuiTitle,{size:"s","data-test-subj":"addRuleFlyoutTitle"},Object(v.jsx)("h3",{id:"flyoutTitle"},Object(v.jsx)(s.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.ruleAdd.flyoutTitle"})))),Object(v.jsx)(x.a,null,Object(v.jsx)(g.a,{inFlyout:!0,waitForCheck:!0},Object(v.jsx)(i.EuiFlyoutBody,null,Object(v.jsx)(y.a,{canShowConsumerSelection:!0,rule:Z,config:te,dispatch:ee,errors:Pe,canChangeTrigger:R,operation:u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.operationName",{defaultMessage:"create"}),validConsumers:W,selectedConsumer:Oe,actionTypeRegistry:n,ruleTypeRegistry:t,metadata:V,filteredRuleTypes:z,hideGrouping:P,hideInterval:U,onChangeMetaData:Y,setConsumer:he,useRuleProducer:N,initialSelectedConsumer:$})),Object(v.jsx)(S,{isSaving:se,isFormLoading:Ae,isRuleValid:pe,onSave:async()=>{if(ie(!0),Ae||!Object(b.c)(Z,Pe,Ie))return e=Object(T.a)(Z,Ue,Be,Ie),ee({command:{type:"setRule"},payload:{key:"rule",value:e}}),void ie(!1);var e;Le?oe(!0):await De()},onCancel:Me,onShowRequest:()=>{fe(!0)}}))),ue&&Object(v.jsx)(O,{onConfirm:async()=>{oe(!1),await De()},onCancel:()=>{ie(!1),oe(!1)}}),ce&&Object(v.jsx)(h.a,{onConfirm:()=>{le(!1),a(m.l.CANCELED,V)},onCancel:()=>{le(!1)}}),de&&Object(v.jsx)(F.a,{onClose:()=>{fe(!1)},rule:{...Z,...ve&&Oe?{consumer:Oe}:{}}})))}}}]);