/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=25)}([function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,n){e.exports=n(19)(2)},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/embeddableEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/presentationUtil/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t,n){e.exports=n(19)(4)},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t){e.exports=__kbnSharedDeps__.EmotionCache},function(e,t){e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},function(e,t){e.exports=__kbnSharedDeps__.KbnEsQuery},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/dashboard/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){e.exports=__kbnSharedDeps__.ElasticEuiLibComponentsUseIsNestedEuiProvider},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(27),r=n(1),a=o.__importDefault(n(28));t.default=function(e,t){var n=r.useState(t),o=n[0],i=n[1];return a.default((function(){var t=e.subscribe(i);return function(){return t.unsubscribe()}}),[e]),o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEuiDevProviderWarning=t.getEuiDevProviderWarning=t.emitEuiProviderWarning=void 0;var o=void 0;t.setEuiDevProviderWarning=function(e){return o=e},t.getEuiDevProviderWarning=function(){return o},t.emitEuiProviderWarning=function(e){if("function"==typeof o)return o(e);switch(o){case"log":console.log(e);break;case"warn":console.warn(e);break;case"error":throw new Error(e)}}},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var o,r,a;if(Array.isArray(t)){if((o=t.length)!=n.length)return!1;for(r=o;0!=r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((o=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=o;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=o;0!=r--;){var i=a[r];if(!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){n.r(t);var o=__kbnBundles__.get("plugin/imageEmbeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},function(e,t,n){n(26),__kbnBundles__.define("plugin/dashboardEnhanced/public",n,29)},function(e,t,n){n.p=window.__kbnPublicPath__.dashboardEnhanced},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),r="undefined"!=typeof window?o.useLayoutEffect:o.useEffect;t.default=r},function(e,t,n){"use strict";n.r(t),n.d(t,"DashboardEnhancedAbstractDashboardDrilldown",(function(){return abstract_dashboard_drilldown_AbstractDashboardDrilldown})),n.d(t,"plugin",(function(){return ue}));var o=n(3),r=n.n(o),a=n(6),i=n(11),s=n(7),d=n(5),l=n(1),c=n.n(l),u=n(8),b=n.n(u),p=n(12),h=n.n(p),f=n(20),g=n(22),_=n(21),v=n.n(_),y=n(14),m=n.n(y),O=n(4);const D="eui-global",w="eui-utilities",j={darkMode:!1};var E=n(2);const C=[O.euiStylisPrefixer],x=m()({key:"css",stylisPlugins:C,container:document.querySelector('meta[name="emotion"]')}),S=m()({key:D,stylisPlugins:C,container:document.querySelector(`meta[name="${D}"]`)}),I=m()({key:w,stylisPlugins:C,container:document.querySelector(`meta[name="${w}"]`)});x.compat=!0,S.compat=!0,I.compat=!0;const A={default:x,global:S,utility:I},P=({theme:{theme$:e},globalStyles:t,colorMode:n,modify:o,children:r})=>{const a=v()(e,j),i=Object(l.useMemo)((()=>(e=>e.darkMode?O.COLOR_MODES_STANDARD.dark:O.COLOR_MODES_STANDARD.light)(a)),[a]),s=n||i,d=!1!==t&&void 0;return Object(E.jsx)(O.EuiProvider,{cache:A,modify:o,colorMode:s,globalStyles:d,utilityClasses:d},r)},T=({children:e,i18n:t,...n})=>Object(f.useIsNestedEuiProvider)()?(Object(g.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(E.jsx)(t.Context,null,e)):Object(E.jsx)(P,n,Object(E.jsx)(t.Context,null,e));var R=n(15);const k=({children:e,...t})=>Object(E.jsx)(T,h()({globalStyles:!1},t),Object(E.jsx)(R.KibanaErrorBoundaryProvider,{analytics:t.analytics},Object(E.jsx)(R.KibanaErrorBoundary,null,e))),L=(e,t)=>n=>(b.a.render(Object(E.jsx)(k,t,e),n),()=>b.a.unmountComponentAtNode(n));l.Component;var M=n(0);const N=e=>Boolean(e&&void 0!==(null==e?void 0:e.parentApi)),F=e=>Boolean(e&&void 0!==(null==e?void 0:e.viewMode)),G=e=>F(e)||N(e)&&F(e.parentApi),B=e=>F(e)?e.viewMode.getValue():N(e)&&F(e.parentApi)?e.parentApi.viewMode.getValue():void 0;n(23);const U=e=>Boolean(e&&"function"==typeof e.supportedTriggers),W=e=>Boolean(e&&e.openOverlay&&e.clearOverlays);var K=n(13),$=n(9);function H(e){return e.includes($.APPLY_FILTER_TRIGGER)||!e.includes(a.VALUE_CLICK_TRIGGER)&&!e.includes(a.SELECT_RANGE_TRIGGER)?e:[...e,$.APPLY_FILTER_TRIGGER]}const V=e=>{const t=e.parentApi;if(!(e=>Boolean((e=>"function"==typeof(null==e?void 0:e.addNewPanel))(e)&&"function"==typeof(null==e?void 0:e.removePanel)&&"function"==typeof(null==e?void 0:e.replacePanel)&&"function"==typeof(null==e?void 0:e.addNewPanel)&&(null==e?void 0:e.children$)))(t))return[];const n=[];for(const c of Object.keys(t.children$.value)){const u=t.children$.value[c];if(c===e.uuid)continue;if(!Object(s.apiHasDynamicActions)(u))continue;const b=u.enhancements.dynamicActions.state.get().events;for(const e of b){var o,r;const t={id:e.eventId,name:e.action.name,icon:"dashboardApp",description:null!==(o=null!==(a=u,void 0,void 0,l=void 0,r=null!==(i=null===(d=a.panelTitle)||void 0===d?void 0:d.value)&&void 0!==i?i:null===(l=a.defaultPanelTitle)||void 0===l?void 0:l.value)&&void 0!==r?r:u.uuid)&&void 0!==o?o:"",config:e.action.config,factoryId:e.action.factoryId,triggers:e.triggers};n.push(t)}}var a,i,d,l;return n},q="OPEN_FLYOUT_ADD_DRILLDOWN",X=e=>Object(s.apiHasDynamicActions)(e)&&N(e)&&G(e)&&U(e);class flyout_create_drilldown_FlyoutCreateDrilldownAction{constructor(e){r()(this,"type",q),r()(this,"id",q),r()(this,"order",12),this.params=e}getDisplayName(){return d.i18n.translate("xpack.dashboard.FlyoutCreateDrilldownAction.displayName",{defaultMessage:"Create drilldown"})}getIconType(){return"plusInCircle"}async isCompatible({embeddable:e}){if(!X(e))return!1;if("edit"!==B(e)||(t=e.parentApi,!Boolean(t&&t.type)||"dashboard"!==t.type))return!1;var t;const n=[a.CONTEXT_MENU_TRIGGER,...e.supportedTriggers()],o=this.params.start().plugins.uiActionsEnhanced.getActionFactories().map((e=>e.isCompatibleLicense()?e.supportedTriggers():[])).reduce(((e,t)=>e.concat(t)),[]);return H(n).some((e=>o.includes(e)))}async execute({embeddable:e}){if(!X(e))throw new K.IncompatibleActionError;const{core:t,plugins:n}=this.params.start(),o=V(e),r=W(e.parentApi)?e.parentApi:void 0,i=()=>{r&&r.clearOverlays(),d.close()},s=[...H(e.supportedTriggers()),a.CONTEXT_MENU_TRIGGER],d=t.overlays.openFlyout(L(Object(E.jsx)(n.uiActionsEnhanced.DrilldownManager,{closeAfterCreate:!0,initialRoute:"/new",dynamicActionManager:e.enhancements.dynamicActions,triggers:s,placeContext:{embeddable:e},templates:o,onClose:i}),t),{ownFocus:!0,"data-test-subj":"createDrilldownFlyout",onClose:()=>{i()}});null==r||r.openOverlay(d)}}const Y=d.i18n.translate("xpack.dashboard.panel.openFlyoutEditDrilldown.displayName",{defaultMessage:"Manage drilldowns"}),Q=({context:{embeddable:e}})=>{const t=(e=>{const t=Object(l.useRef)(!0),[n,o]=Object(l.useState)(null==e?void 0:e.getValue());return Object(l.useEffect)((()=>{if(t.current?t.current=!1:o(null==e?void 0:e.getValue()),!e)return;const n=e.pipe(Object(M.skip)(1)).subscribe((e=>o(e)));return()=>n.unsubscribe()}),[e]),n})(e.dynamicActionsState$),n=Object(l.useMemo)((()=>{var e,n;return(null!==(e=null==t||null===(n=t.dynamicActions)||void 0===n?void 0:n.events)&&void 0!==e?e:[]).length}),[t]);return Object(E.jsx)(O.EuiFlexGroup,{alignItems:"center"},Object(E.jsx)(O.EuiFlexItem,{grow:!0},Y),n>0&&Object(E.jsx)(O.EuiFlexItem,{grow:!1},Object(E.jsx)(O.EuiNotificationBadge,null,n)))},z="OPEN_FLYOUT_EDIT_DRILLDOWN",J=e=>Object(s.apiHasDynamicActions)(e)&&G(e)&&U(e);class flyout_edit_drilldown_FlyoutEditDrilldownAction{constructor(e){r()(this,"type",z),r()(this,"id",z),r()(this,"order",10),r()(this,"MenuItem",Q),this.params=e}getDisplayName(){return Y}getIconType(){return"list"}async isCompatible({embeddable:e}){var t,n;return!(!J(e)||"edit"!==B(e))&&(null!==(t=null===(n=e.dynamicActionsState$.getValue())||void 0===n?void 0:n.dynamicActions.events)&&void 0!==t?t:[]).length>0}async execute({embeddable:e}){if(!J(e))throw new K.IncompatibleActionError;const{core:t,plugins:n}=this.params.start(),o=V(e),r=W(e.parentApi)?e.parentApi:void 0,i=()=>{r&&r.clearOverlays(),s.close()},s=t.overlays.openFlyout(L(Object(E.jsx)(n.uiActionsEnhanced.DrilldownManager,{initialRoute:"/manage",dynamicActionManager:e.enhancements.dynamicActions,triggers:[...H(e.supportedTriggers()),a.CONTEXT_MENU_TRIGGER],placeContext:{embeddable:e},templates:o,onClose:i}),t),{ownFocus:!0,"data-test-subj":"editDrilldownFlyout",onClose:()=>{i()}});null==r||r.openOverlay(s)}}var Z=n(16),ee=n(17),te=n(24),ne=n(10),oe=n(18);const re=d.i18n.translate("xpack.dashboard.components.DashboardDrilldownConfig.chooseDestinationDashboard",{defaultMessage:"Choose destination dashboard"}),ae=Object(ne.withSuspense)(ne.DashboardDrilldownOptionsComponent,null),ie=({dashboards:e,onDashboardSelect:t,onSearchChange:n,isLoading:o,error:r,config:a,onConfigChange:i})=>{var s;const d=(null===(s=e.find((e=>e.value===a.dashboardId)))||void 0===s?void 0:s.label)||"";return Object(E.jsx)(c.a.Fragment,null,Object(E.jsx)(O.EuiFormRow,{label:re,fullWidth:!0,isInvalid:!!r,error:r},Object(E.jsx)(O.EuiComboBox,{async:!0,selectedOptions:a.dashboardId?[{label:d,value:a.dashboardId}]:[],options:e,onChange:([{value:e=""}={value:""}])=>t(e),onSearchChange:n,isLoading:o,singleSelection:{asPlainText:!0},fullWidth:!0,"data-test-subj":"dashboardDrilldownSelectDashboard",isInvalid:!!r})),Object(E.jsx)(ae,{options:a,onOptionChange:i}))},se=(e,t)=>t&&-1===Object(oe.findIndex)(e,{value:t.value})?[t,...e]:e,de=e=>({value:e.id,label:e.attributes.title});class collect_config_container_CollectConfigContainer extends c.a.Component{constructor(e){super(e),r()(this,"isMounted",!0),r()(this,"state",{dashboards:[],isLoading:!1,searchString:void 0,selectedDashboard:void 0,error:void 0}),r()(this,"debouncedLoadDashboards",void 0),this.debouncedLoadDashboards=Object(oe.debounce)(this.loadDashboards.bind(this),500)}componentDidMount(){this.loadSelectedDashboard(),this.loadDashboards()}componentWillUnmount(){this.isMounted=!1}render(){const{config:e,onConfig:t}=this.props,{dashboards:n,selectedDashboard:o,isLoading:r,error:a}=this.state;return Object(E.jsx)(ie,{dashboards:se(n,o),isLoading:r,error:a,onDashboardSelect:n=>{t({...e,dashboardId:n}),this.state.error&&this.setState({error:void 0})},onSearchChange:this.debouncedLoadDashboards,config:e,onConfigChange:n=>{t({...e,...n})}})}async loadSelectedDashboard(){var e;const{config:t,params:{start:n}}=this.props;if(!t.dashboardId)return;const o=await n().core.savedObjects.client.get("dashboard",t.dashboardId);var r;return this.isMounted?404===(null===(e=o.error)||void 0===e?void 0:e.statusCode)?(this.setState({error:(r=t.dashboardId,d.i18n.translate("xpack.dashboard.drilldown.errorDestinationDashboardIsMissing",{defaultMessage:"Destination dashboard (''{dashboardId}'') no longer exists. Choose another dashboard.",values:{dashboardId:r}}))}),void this.props.onConfig({...t,dashboardId:void 0})):o.error?(this.setState({error:o.error.message}),void this.props.onConfig({...t,dashboardId:void 0})):void this.setState({selectedDashboard:de(o)}):void 0}async loadDashboards(e){this.setState({searchString:e,isLoading:!0});const t=this.props.params.start().core.savedObjects.client,{savedObjects:n}=await t.find({type:"dashboard",search:e?`${e}*`:void 0,searchFields:["title^3","description"],defaultSearchOperator:"AND",perPage:100});if(!this.isMounted)return;if(e!==this.state.searchString)return;const o=n.map(de);this.setState({dashboards:o,isLoading:!1})}}const le=d.i18n.translate("xpack.dashboard.drilldown.goToDashboard",{defaultMessage:"Go to Dashboard"});class abstract_dashboard_drilldown_AbstractDashboardDrilldown{constructor(e){r()(this,"order",100),r()(this,"getDisplayName",(()=>le)),r()(this,"euiIcon","dashboardApp"),r()(this,"ReactCollectConfig",void 0),r()(this,"CollectConfig",void 0),r()(this,"createConfig",(()=>({dashboardId:"",...ne.DEFAULT_DASHBOARD_DRILLDOWN_OPTIONS}))),r()(this,"isConfigValid",(e=>!!e.dashboardId)),r()(this,"getHref",(async(e,t)=>{const{app:n,path:o}=await this.getLocation(e,t,!0);return await this.params.start().core.application.getUrlForApp(n,{path:o,absolute:!0})})),r()(this,"execute",(async(e,t)=>{if(e.openInNewTab)window.open(await this.getHref(e,t),"_blank");else{const{app:n,path:o,state:r}=await this.getLocation(e,t,!1);await this.params.start().core.application.navigateToApp(n,{path:o,state:r})}})),this.params=e,this.ReactCollectConfig=e=>Object(E.jsx)(collect_config_container_CollectConfigContainer,h()({},e,{params:this.params})),this.CollectConfig=this.ReactCollectConfig}get locator(){const e=this.params.start().plugins.dashboard.locator;if(!e)throw new Error("Dashboard locator is required for dashboard drilldown.");return e}}const ce=(e,t)=>`drilldown:${t}:${e.eventId}:dashboardId`;class embeddable_to_dashboard_drilldown_EmbeddableToDashboardDrilldown extends abstract_dashboard_drilldown_AbstractDashboardDrilldown{constructor(...e){super(...e),r()(this,"id","DASHBOARD_TO_DASHBOARD_DRILLDOWN"),r()(this,"supportedTriggers",(()=>[$.APPLY_FILTER_TRIGGER,te.IMAGE_CLICK_TRIGGER])),r()(this,"inject",(({drilldownId:e})=>(t,n)=>{const o=t.action,r=ce(t,e),a=n.find((e=>e.name===r));return a?a.id&&a.id===o.config.dashboardId?t:((e,t)=>({...e,action:{...e.action,config:{...e.action.config,dashboardId:t}}}))(t,a.id):t})({drilldownId:this.id})),r()(this,"extract",(({drilldownId:e})=>t=>{const n=t.action,o=n.config.dashboardId?[{name:ce(t,e),type:"dashboard",id:n.config.dashboardId}]:[],{dashboardId:r,...a}=n.config;return{state:{...t,action:{...t.action,config:a}},references:o}})({drilldownId:this.id}))}async getLocation(e,t,n){let o={dashboardId:e.dashboardId};t.embeddable&&(o={...o,...Object(ee.getDashboardLocatorParamsFromEmbeddable)(t.embeddable,e)});const{restOfFilters:r,timeRange:a}=Object(Z.extractTimeRange)(t.filters,t.timeFieldName);var i;r&&(o.filters=[...null!==(i=o.filters)&&void 0!==i?i:[],...r]),a&&(o.timeRange=a);const s=await this.locator.getLocation(o);return n&&this.useUrlForState(s),s}useUrlForState(e){var t;const n=e.state;e.path=Object(i.setStateToKbnUrl)("_a",Object(ee.cleanEmptyKeys)({query:n.query,filters:null===(t=n.filters)||void 0===t?void 0:t.filter((e=>!Object(Z.isFilterPinned)(e)))}),{useHash:!1,storeInHashQuery:!0},e.path)}}class dashboard_drilldowns_services_DashboardDrilldownsService{bootstrap(e,t,{enableDrilldowns:n}){n&&this.setupDrilldowns(e,t)}setupDrilldowns(e,{uiActionsEnhanced:t}){const n=Object(i.createStartServicesGetter)(e.getStartServices),o=new flyout_create_drilldown_FlyoutCreateDrilldownAction({start:n});t.addTriggerAction(a.CONTEXT_MENU_TRIGGER,o);const r=new flyout_edit_drilldown_FlyoutEditDrilldownAction({start:n});t.addTriggerAction(a.CONTEXT_MENU_TRIGGER,r);const s=new embeddable_to_dashboard_drilldown_EmbeddableToDashboardDrilldown({start:n});t.registerDrilldown(s)}}class plugin_DashboardEnhancedPlugin{constructor(e){r()(this,"drilldowns",new dashboard_drilldowns_services_DashboardDrilldownsService),this.context=e}setup(e,t){return this.drilldowns.bootstrap(e,t,{enableDrilldowns:!0}),{}}start(e,t){return{}}stop(){}}function ue(e){return new plugin_DashboardEnhancedPlugin(e)}}]);