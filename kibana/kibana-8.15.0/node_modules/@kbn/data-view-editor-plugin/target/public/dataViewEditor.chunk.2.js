(window.dataViewEditor_bundle_jsonpfunction=window.dataViewEditor_bundle_jsonpfunction||[]).push([[2],{41:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return DataViewEditorService}));var s=i(15),n=i.n(s),a=i(36),d=i(34),r=i(43);const o={allIndices:[],exactMatchedIndices:[],partialMatchedIndices:[],visibleIndices:[]},c={matchedIndices:{...o},rollupIndicesCaps:{},isLoadingSourcesInternal:!1,loadingTimestampFields:!1,timestampFieldOptions:[],rollupIndexName:void 0};class DataViewEditorService{constructor({services:{http:t,dataViews:e},initialValues:{type:i=d.INDEX_PATTERN_TYPE.DEFAULT,indexPattern:s="",name:l=""},requireTimestampField:h=!1}){n()(this,"http",void 0),n()(this,"dataViews",void 0),n()(this,"requireTimestampField",void 0),n()(this,"type",d.INDEX_PATTERN_TYPE.DEFAULT),n()(this,"indexPattern",""),n()(this,"allowHidden",!1),n()(this,"dataViewNames$",void 0),n()(this,"loadTimestampFieldsSub",void 0),n()(this,"matchedIndicesForProviderSub",void 0),n()(this,"rollupIndexForProviderSub",void 0),n()(this,"state$",void 0),n()(this,"rollupIndicesCaps$",void 0),n()(this,"isLoadingSources$",void 0),n()(this,"loadingTimestampFields$",void 0),n()(this,"timestampFieldOptions$",void 0),n()(this,"rollupIndex$",void 0),n()(this,"rollupIndexForProvider$",new a.Subject),n()(this,"matchedIndices$",void 0),n()(this,"matchedIndicesForProvider$",new a.Subject),n()(this,"rollupCapsResponse",void 0),n()(this,"currentLoadingTimestampFields",0),n()(this,"currentLoadingMatchedIndices",0),n()(this,"updateState",(t=>{this.state$.next({...this.state$.getValue(),...t})})),n()(this,"getRollupIndexCaps",(async()=>{if(!1===this.dataViews.getRollupsEnabled())return{};let t={};try{t=await this.http.get("/api/rollup/indices")}catch(t){}return this.updateState({rollupIndicesCaps:t}),t})),n()(this,"getIsRollupIndex",(async()=>{const t=await this.rollupCapsResponse,e=Object.keys(t);return t=>e.includes(t)})),n()(this,"loadMatchedIndices",(async(t,e,i,s)=>{const n=++this.currentLoadingMatchedIndices,a=await this.getIsRollupIndex(),o=[];let c;if(this.updateState({loadingTimestampFields:!0}),null!=t&&t.endsWith("*")){const i=this.getIndicesCached({pattern:t,showAllIndices:e});o.push(i),o.push(Promise.resolve([]))}else{const i=this.getIndicesCached({pattern:t,showAllIndices:e}),s=this.getIndicesCached({pattern:`${t}*`,showAllIndices:e});o.push(i),o.push(s)}const[l,h]=await Object(r.b)(o),u=Object(r.d)(i,h,l,e);if(n===this.currentLoadingMatchedIndices){if(s===d.INDEX_PATTERN_TYPE.ROLLUP){const t=l.filter((t=>a(t.name)));c=1===t.length?t[0].name:null,this.updateState({rollupIndexName:c})}else this.updateState({rollupIndexName:null});this.updateState({matchedIndices:u})}})),n()(this,"setIndexPattern",(t=>{this.indexPattern=Object(r.e)(t),this.loadIndices()})),n()(this,"setAllowHidden",(t=>{this.allowHidden=t,this.loadIndices()})),n()(this,"setType",(t=>{this.type=t,this.loadIndices()})),n()(this,"loadIndices",(async()=>{const t=await this.getIndicesCached({pattern:"*",showAllIndices:this.allowHidden});await this.loadMatchedIndices(this.indexPattern,this.allowHidden,t,this.type),this.updateState({isLoadingSourcesInternal:!1})})),n()(this,"loadDataViewNames",(async t=>{const e=(await this.dataViews.getIdsWithTitle(!0)).map((t=>t.name||t.title));return t?e.filter((e=>e!==t)):e})),n()(this,"getIndicesMemory",{}),n()(this,"getIndicesCached",(async t=>{const e=JSON.stringify(t);return this.getIndicesMemory[e]=this.getIndicesMemory[e]||this.getIsRollupIndex().then((e=>this.dataViews.getIndices({...t,isRollupIndex:e}))),this.getIndicesMemory[e].catch((()=>{delete this.getIndicesMemory[e]})),await this.getIndicesMemory[e]})),n()(this,"timestampOptionsMemory",{}),n()(this,"getTimestampOptionsForWildcard",(async(t,e)=>{try{const i=await Object(r.b)(this.dataViews.getFieldsForWildcard(t));return Object(r.c)(i,e)}catch(t){return[]}})),n()(this,"getTimestampOptionsForWildcardCached",(async(t,e)=>{const i=JSON.stringify(t)+e,s=this.getTimestampOptionsForWildcard(t,e);return this.timestampOptionsMemory[i]=this.timestampOptionsMemory[i]||s,s.catch((()=>{delete this.timestampOptionsMemory[i]})),await s})),n()(this,"loadTimestampFields",(async()=>{const t=this.state$.getValue();if(0===t.matchedIndices.exactMatchedIndices.length)return void this.updateState({timestampFieldOptions:[],loadingTimestampFields:!1});const e=++this.currentLoadingTimestampFields,i={pattern:this.indexPattern,allowHidden:this.allowHidden,allowNoIndex:!0};this.type===d.INDEX_PATTERN_TYPE.ROLLUP&&(i.type=d.INDEX_PATTERN_TYPE.ROLLUP,i.rollupIndex=t.rollupIndexName||"",i.allowNoIndex=!0);let s=[];try{s=await this.getTimestampOptionsForWildcardCached(i,this.requireTimestampField)}finally{e===this.currentLoadingTimestampFields&&this.updateState({timestampFieldOptions:s,loadingTimestampFields:!1})}})),n()(this,"indexPatternValidationProvider",(async()=>{const t=Object(a.firstValueFrom)(this.rollupIndex$.pipe(Object(a.first)((t=>void 0!==t)))),e=Object(a.firstValueFrom)(this.matchedIndicesForProvider$.pipe(Object(a.first)((t=>void 0!==t))));await this.loadIndices();const[i,s]=await Promise.all([t,e]);return{rollupIndex:i,matchedIndices:s||o}})),n()(this,"destroy",(()=>{this.loadTimestampFieldsSub.unsubscribe(),this.matchedIndicesForProviderSub.unsubscribe(),this.rollupIndexForProviderSub.unsubscribe()})),this.http=t,this.dataViews=e,this.requireTimestampField=h,this.type=i,this.indexPattern=Object(r.e)(s),this.rollupCapsResponse=this.getRollupIndexCaps(),this.dataViewNames$=Object(a.from)(this.loadDataViewNames(l)),this.state$=new a.BehaviorSubject({...c});const u=(p=this.state$,(t,e)=>p.pipe(Object(a.map)(t),Object(a.distinctUntilChanged)(e)));var p;this.matchedIndices$=u((t=>t.matchedIndices)),this.rollupIndicesCaps$=u((t=>t.rollupIndicesCaps)),this.isLoadingSources$=u((t=>t.isLoadingSourcesInternal)),this.loadingTimestampFields$=u((t=>t.loadingTimestampFields)),this.timestampFieldOptions$=u((t=>t.timestampFieldOptions)),this.rollupIndex$=u((t=>t.rollupIndexName)),this.loadTimestampFieldsSub=this.matchedIndices$.subscribe((()=>this.loadTimestampFields())),this.matchedIndicesForProviderSub=this.matchedIndices$.subscribe((t=>{this.matchedIndicesForProvider$.next(t),this.matchedIndicesForProvider$.next(void 0)})),this.rollupIndexForProviderSub=this.rollupIndex$.subscribe((t=>{this.rollupIndexForProvider$.next(t),this.rollupIndexForProvider$.next(void 0)}))}}},42:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));const s=i(13).i18n.translate("indexPatternEditor.createIndexPattern.stepTime.noTimeFieldOptionLabel",{defaultMessage:"--- I don't want to use the time filter ---"}),n="";function a(t,e=!1){const i=t.filter((t=>"date"===t.type));if(0===i.length)return[];const a={display:s,fieldName:n},d=i.map((t=>({display:t.name,fieldName:t.name})));return e||d.push(a),d}},43:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a})),i.d(e,"d",(function(){return c})),i.d(e,"c",(function(){return l.a})),i.d(e,"e",(function(){return h}));const s=t=>!(!t||!/[a-z0-9]/i.test(t)||1!==t.length),n=300;async function a(t,e=n){let i;const s=e+5,a=(new Date).getTime();i=Array.isArray(t)?await Promise.all(t):await t;const d=(new Date).getTime();if(d-a<s){const t=s-(d-a);await new Promise((e=>setTimeout(e,t)))}return i}const d=100;function r(t){return!!t.startsWith(".")||!!t.includes(":")&&t.split(":").reduce(((t,e)=>t||r(e)),!1)}function o(t,e){return(e?t:t.filter((t=>!r(t.name)))).slice(0,d)}function c(t,e,i,s=!1){const n=o(t,s),a=o(e,s),d=o(i,s);let r;return r=d.length?d:a.length?a:n,{allIndices:n,exactMatchedIndices:d,partialMatchedIndices:a,visibleIndices:r}}var l=i(42);const h=t=>t.replace(/,\s+/g,",")},51:function(t,e,i){"use strict";i.r(e);var s=i(41);i.d(e,"DataViewEditorService",(function(){return s.a}))}}]);