/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var r,i,o=t[0],a=t[1],s=0,l=[];s<o.length;s++)i=o[s],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&l.push(n[i][0]),n[i]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);for(c&&c(t);l.length;)l.shift()()}var r={},n={0:0};function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var o=new Promise((function(t,i){r=n[e]=[t,i]}));t.push(r[2]=o);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(e){return i.p+"reporting.chunk."+e+".js"}(e);var c=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(l);var r=n[e];if(0!==r){if(r){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",c.name="ChunkLoadError",c.type=i,c.request=o,r[1](c)}n[e]=void 0}};var l=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(t)},i.m=e,i.c=r,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var o=window.reporting_bundle_jsonpfunction=window.reporting_bundle_jsonpfunction||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var c=a;i(i.s=35)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,r){e.exports=r(26)(2)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,r){"use strict";r.d(t,"c",(function(){return n.b})),r.d(t,"g",(function(){return n.e})),r.d(t,"h",(function(){return n.f})),r.d(t,"f",(function(){return n.d})),r.d(t,"a",(function(){return n.a})),r.d(t,"d",(function(){return n.c})),r.d(t,"i",(function(){return n.g})),r.d(t,"j",(function(){return n.h})),r.d(t,"l",(function(){return i})),r.d(t,"k",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"e",(function(){return l}));var n=r(24);r(17),r(15);const i=e=>"number"==typeof e?e:e.asMilliseconds();r(1),r(27);const o=({basePath:e,appPath:t,spaceId:r})=>void 0===r||"default"===r.toLowerCase()?`${e}${t}`:`${e}/s/${r}${t}`,a="/internal/reporting",s={MIGRATE:{MIGRATE_ILM_POLICY:a+"/deprecations/migrate_ilm_policy",GET_ILM_POLICY_STATUS:a+"/ilm_policy_status"},DIAGNOSE:{BROWSER:a+"/diagnose/browser",SCREENSHOT:a+"/diagnose/screenshot"},JOBS:{COUNT:a+"/jobs/count",LIST:a+"/jobs/list",INFO_PREFIX:a+"/jobs/info",DELETE_PREFIX:a+"/jobs/delete",DOWNLOAD_PREFIX:a+"/jobs/download"},DOWNLOAD_CSV:a+"/generate/immediate/csv_searchsource",GENERATE_PREFIX:a+"/generate"},c="/api/reporting",l={GENERATE_PREFIX:c+"/generate",JOBS:{DOWNLOAD_PREFIX:c+"/jobs/download",DELETE_PREFIX:c+"/jobs/delete"}}},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(3),i=r(16),o=r.n(i),a=r(29),s=r(0);const c=(e,t)=>r=>(o.a.render(Object(s.jsx)(a.a,t,e),r),()=>o.a.unmountComponentAtNode(r));r(1),r(2),n.Component},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"e",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"f",(function(){return a})),r.d(t,"d",(function(){return l})),r.d(t,"b",(function(){return u})),r.d(t,"g",(function(){return c}));const n="csv_searchsource",i="csv_searchsource",o="csv_v2",a="csv_v2";var s=r(5);const c=(e,{scroll:t},r)=>(e.setField("size",Object(s.l)(t.size)),e.setField("timeout",t.duration),e.setField("trackTotalHits",!0),r&&e.setField("pit",{id:r,keep_alive:t.duration}),{requestBody:e.getSearchRequestBody()}),l="generateCsvReport",u="csv"},function(e,t,r){e.exports=r(26)(4)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n=e=>{switch(e.state){case"valid":default:return{showLinks:!0,enableLinks:!0,message:""};case"invalid":return{showLinks:!1,enableLinks:!1,message:"Your license does not support Reporting. Please upgrade your license."};case"unavailable":return{showLinks:!0,enableLinks:!1,message:"You cannot use Reporting because license information is not available at this time."};case"expired":return{showLinks:!0,enableLinks:!1,message:"You cannot use Reporting because your license has expired."}}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return job_Job})),r.d(t,"e",(function(){return O})),r.d(t,"a",(function(){return S})),r.d(t,"g",(function(){return w})),r.d(t,"f",(function(){return R})),r.d(t,"c",(function(){return reporting_api_client_ReportingAPIClient})),r.d(t,"d",(function(){return P.a})),r.d(t,"h",(function(){return D}));var n=r(1),i=r.n(n),o=r(15),a=r.n(o),s=r(3),c=r.n(s),l=r(7),u=r(2),d=r(5),p=r(9),g=r(13),b=r(14),h=r(0);p.a,p.c,g.a,g.b,b.a,b.b;const{COMPLETED:f,FAILED:m,PENDING:j,PROCESSING:y,WARNINGS:v}=d.d;class job_Job{constructor(e){var t,r,n,o,a,s;i()(this,"payload",void 0),i()(this,"id",void 0),i()(this,"index",void 0),i()(this,"objectType",void 0),i()(this,"title",void 0),i()(this,"isDeprecated",void 0),i()(this,"spaceId",void 0),i()(this,"browserTimezone",void 0),i()(this,"layout",void 0),i()(this,"pagingStrategy",void 0),i()(this,"version",void 0),i()(this,"jobtype",void 0),i()(this,"created_by",void 0),i()(this,"created_at",void 0),i()(this,"started_at",void 0),i()(this,"completed_at",void 0),i()(this,"status",void 0),i()(this,"attempts",void 0),i()(this,"max_attempts",void 0),i()(this,"timeout",void 0),i()(this,"kibana_name",void 0),i()(this,"kibana_id",void 0),i()(this,"size",void 0),i()(this,"content_type",void 0),i()(this,"csv_contains_formulas",void 0),i()(this,"max_size_reached",void 0),i()(this,"metrics",void 0),i()(this,"warnings",void 0),i()(this,"error_code",void 0),i()(this,"locatorParams",void 0),i()(this,"queue_time_ms",void 0),i()(this,"execution_time_ms",void 0),this.id=e.id,this.index=e.index,this.payload=e.payload,this.jobtype=e.jobtype,this.objectType=e.payload.objectType,this.title=e.payload.title,this.layout=e.payload.layout,this.pagingStrategy=e.payload.pagingStrategy,this.version=e.payload.version,this.created_by=e.created_by,this.created_at=e.created_at,this.started_at=e.started_at,this.completed_at=e.completed_at,this.status=e.status,this.attempts=e.attempts,this.max_attempts=e.max_attempts,this.timeout=e.timeout,this.kibana_name=e.kibana_name,this.kibana_id=e.kibana_id,this.browserTimezone=e.payload.browserTimezone,this.size=null===(t=e.output)||void 0===t?void 0:t.size,this.content_type=null===(r=e.output)||void 0===r?void 0:r.content_type,this.isDeprecated=e.payload.isDeprecated||!1,this.spaceId=e.payload.spaceId,this.csv_contains_formulas=null===(n=e.output)||void 0===n?void 0:n.csv_contains_formulas,this.max_size_reached=null===(o=e.output)||void 0===o?void 0:o.max_size_reached,this.warnings=null===(a=e.output)||void 0===a?void 0:a.warnings,this.error_code=null===(s=e.output)||void 0===s?void 0:s.error_code,this.locatorParams=e.payload.locatorParams,this.metrics=e.metrics,this.queue_time_ms=e.queue_time_ms,this.execution_time_ms=e.execution_time_ms}isSearch(){return"search"===this.objectType}getStatusMessage(){const e=this.status;let t,r;return e===j?t=u.i18n.translate("reporting.jobStatusDetail.pendingStatusReachedText",{defaultMessage:"Waiting for job to process."}):e===y?t=u.i18n.translate("reporting.jobStatusDetail.attemptXofY",{defaultMessage:"Attempt {attempts} of {max_attempts}.",values:{attempts:this.attempts,max_attempts:this.max_attempts}}):this.getWarnings()?t=u.i18n.translate("reporting.jobStatusDetail.warningsText",{defaultMessage:"See report info for warnings."}):this.getError()&&(t=u.i18n.translate("reporting.jobStatusDetail.errorText",{defaultMessage:"See report info for error details."})),this.isDeprecated&&(r=Object(h.jsx)(l.EuiText,{size:"s"}," ",Object(h.jsx)(l.EuiTextColor,{color:"warning"},u.i18n.translate("reporting.jobStatusDetail.deprecatedText",{defaultMessage:"This is a deprecated export type. Automation of this report will need to be re-created for compatibility with future versions of Kibana."})))),t?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(l.EuiText,{size:"s"},Object(h.jsx)(l.EuiTextColor,{color:"subdued"},t)),r||null):null}get prettyStatus(){var e;return null!==(e=_.get(this.status))&&void 0!==e?e:u.i18n.translate("reporting.jobStatusDetail.unknownText",{defaultMessage:"Unknown"})}get canLinkToKibanaApp(){return Boolean(this.locatorParams)}get isDownloadReady(){return this.status===d.d.COMPLETED||this.status===d.d.WARNINGS}get prettyJobTypeName(){switch(this.jobtype){case"printable_pdf":case"printable_pdf_v2":return u.i18n.translate("reporting.jobType.pdfOutputName",{defaultMessage:"PDF"});case"PNG":case"PNGV2":return u.i18n.translate("reporting.jobType.pngOutputName",{defaultMessage:"PNG"});case"csv_v2":case"csv_searchsource":return u.i18n.translate("reporting.jobType.csvOutputName",{defaultMessage:"CSV"});default:return}}get prettyTimeout(){if(null==this.timeout)return u.i18n.translate("reporting.jobStatusDetail.timeoutSecondsUnknown",{defaultMessage:"Unknown"});const e=this.timeout/1e3;return u.i18n.translate("reporting.jobStatusDetail.timeoutSeconds",{defaultMessage:"{timeout} seconds",values:{timeout:e}})}getCreatedAtDate(){return this.formatDate(this.created_at)}getCreatedBy(){return this.created_by||u.i18n.translate("reporting.jobCreatedBy.unknownUserPlaceholderText",{defaultMessage:"Unknown"})}getCreatedAtLabel(){return this.created_by?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)("div",null,this.formatDate(this.created_at)),Object(h.jsx)("span",null,this.created_by)):this.formatDate(this.created_at)}getError(){if(this.status===m)return this.warnings}getDeprecatedMessage(){if(this.isDeprecated)return u.i18n.translate("reporting.jobWarning.exportTypeDeprecated",{defaultMessage:"This is a deprecated export type. Automation of this report will need to be re-created for compatibility with future versions of Kibana."})}getWarnings(){var e;const t=[],r=this.getDeprecatedMessage();if(r&&t.push(r),this.csv_contains_formulas&&t.push(u.i18n.translate("reporting.jobWarning.csvContainsFormulas",{defaultMessage:"Your CSV contains characters that spreadsheet applications might interpret as formulas."})),this.max_size_reached&&t.push(u.i18n.translate("reporting.jobWarning.maxSizeReachedTooltip",{defaultMessage:"Your search reached the max size and contains partial data."})),this.status!==m&&null!==(e=this.warnings)&&void 0!==e&&e.length&&t.push(...this.warnings),t.length)return Object(h.jsx)("ul",null,t.map(((e,t)=>Object(h.jsx)("li",{key:`warning-key-${t}`},e))))}getPrettyStatusTimestamp(){return this.formatDate(this.getStatusTimestamp())}formatDate(e){try{return a()(e).format("YYYY-MM-DD @ hh:mm A")}catch(t){return e}}getStatusTimestamp(){const e=this.status;return e===y&&this.started_at?this.started_at:this.completed_at&&[f,m,v].includes(e)?this.completed_at:this.created_at}}const _=new Map([[j,u.i18n.translate("reporting.jobStatuses.pendingText",{defaultMessage:"Pending"})],[y,u.i18n.translate("reporting.jobStatuses.processingText",{defaultMessage:"Processing"})],[f,u.i18n.translate("reporting.jobStatuses.completedText",{defaultMessage:"Completed"})],[v,u.i18n.translate("reporting.jobStatuses.warningText",{defaultMessage:"Completed"})],[m,u.i18n.translate("reporting.jobStatuses.failedText",{defaultMessage:"Failed"})]]);function O(){return{getPendingJobIds:function(){const e=[];for(const t in localStorage)if(0===t.indexOf(d.c)){const r=t.replace(`${d.c}-`,"");e.push(r)}return e},addPendingJobId:function(e){localStorage.setItem(`${d.c}-${e}`,e)},setPendingJobIds:function(e){for(const e in localStorage)0===e.indexOf(d.c)&&localStorage.removeItem(e);for(let t=0;t<e.length;t++){const r=e[t];localStorage.setItem(`${d.c}-${r}`,r)}}}}const x=Object(s.createContext)(void 0),S=({apiClient:e,http:t,children:r})=>Object(h.jsx)(x.Provider,{value:{http:t,apiClient:e}},r),w=()=>{const e=Object(s.useContext)(x);if(!e)throw new Error('"useInternalApiClient" can only be used inside of "InternalApiClientContext"');return e};var E=r(30);const R=()=>{const{services:{http:e}}=D();return Object(E.useRequest)(e,{path:d.b.MIGRATE.GET_ILM_POLICY_STATUS,method:"get"})};var M=r(19),C=r.n(M),T=r(21);class reporting_api_client_ReportingAPIClient{constructor(e,t,r){i()(this,"http",void 0),i()(this,"addPendingJobId",O().addPendingJobId),i()(this,"getManagementLink",(()=>this.http.basePath.prepend(d.f))),i()(this,"getDownloadLink",(e=>this.getReportURL(e))),i()(this,"getServerBasePath",(()=>this.http.basePath.serverBasePath)),this.uiSettings=t,this.kibanaVersion=r,this.http=e}getKibanaAppHref(e){const t=Object(T.stringify)({jobId:e.id});return`${Object(d.k)({basePath:this.http.basePath.serverBasePath,spaceId:e.spaceId,appPath:d.g})}?${t}`}getReportURL(e){return this.http.basePath.prepend(`${d.b.JOBS.DOWNLOAD_PREFIX}/${e}?elasticInternalOrigin=true`)}downloadReport(e){const t=this.getReportURL(e);window.open(t)}async deleteReport(e){return await this.http.delete(`${d.b.JOBS.DELETE_PREFIX}/${e}`)}async list(e=0,t=[]){const r={page:e};return t.length>0&&(r.ids=t.slice(0,10).join(",")),(await this.http.get(d.b.JOBS.LIST,{query:r,asSystemRequest:!0})).map((e=>new job_Job(e)))}async total(){return await this.http.get(d.b.JOBS.COUNT,{asSystemRequest:!0})}async getError(e){var t;const r=await this.getInfo(e);return null!==(t=r.warnings)&&void 0!==t&&t[0]?r.warnings[0]:u.i18n.translate("reporting.apiClient.unknownError",{defaultMessage:"Report job {job} failed. Error unknown.",values:{job:e}})}async getInfo(e){const t=await this.http.get(`${d.b.JOBS.INFO_PREFIX}/${e}`);return new job_Job(t)}async findForJobIds(e){return(await this.http.fetch(d.b.JOBS.LIST,{query:{page:0,ids:e.join(",")},method:"GET"})).map((e=>new job_Job(e)))}getReportingPublicJobPath(e,t){const r=Object(T.stringify)({jobParams:C.a.encode(t)});return`${this.http.basePath.prepend(d.e.GENERATE_PREFIX)}/${e}?${r}`}async createReportingShareJob(e,t){const r=C.a.encode(t),n=await this.http.post(`${d.b.GENERATE_PREFIX}/${e}`,{method:"POST",body:JSON.stringify({jobParams:r})});if(null!=n&&n.job)return this.addPendingJobId(n.job.id),new job_Job(n.job)}async createReportingJob(e,t){const r=C.a.encode(t);try{const t=await this.http.post(`${d.b.GENERATE_PREFIX}/${e}`,{method:"POST",body:JSON.stringify({jobParams:r})});if(null!=t&&t.job)return this.addPendingJobId(t.job.id),new job_Job(t.job)}catch(e){var n;throw console.error(e),new Error(`${null===(n=e.body)||void 0===n?void 0:n.message}`)}}async createImmediateReport(e){const{objectType:t,...r}=e;return this.http.post(d.b.DOWNLOAD_CSV,{asResponse:!0,body:JSON.stringify(r)})}getDecoratedJobParams(e){return{browserTimezone:"Browser"===this.uiSettings.get("dateFormat:tz")?a.a.tz.guess():this.uiSettings.get("dateFormat:tz"),version:this.kibanaVersion,...e}}verifyBrowser(){return this.http.post(d.b.DIAGNOSE.BROWSER)}verifyScreenCapture(){return this.http.post(d.b.DIAGNOSE.SCREENSHOT)}migrateReportingIndicesIlmPolicy(){return this.http.put(d.b.MIGRATE.MIGRATE_ILM_POLICY)}}var P=r(11),k=r(25);const D=()=>Object(k.useKibana)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a}));const n="printable_pdf",i="printable_pdf_v2",o="printablePdf",a="printablePdfV2"},function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return i})),r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return a}));const n="PNG",i="pngV2",o="PNG",a="PNGV2"},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t,r){"use strict";r.d(t,"a",(function(){return VisualReportingSoftDisabledError}));var n=r(1),i=r.n(n),o=r(2);class ReportingError extends Error{constructor(e){super(),this.details=e}get message(){const e="ReportingError";return this.details?`${e}(code: ${this.code}) "${this.details}"`:`${e}(code: ${this.code})`}toString(){return this.message}}class InvalidLayoutParametersError extends ReportingError{get code(){return InvalidLayoutParametersError.code}}i()(InvalidLayoutParametersError,"code","invalid_layout_parameters_error");class DisallowedOutgoingUrl extends ReportingError{get code(){return DisallowedOutgoingUrl.code}}i()(DisallowedOutgoingUrl,"code","disallowed_outgoing_url_error");class AuthenticationExpiredError extends ReportingError{get code(){return AuthenticationExpiredError.code}}i()(AuthenticationExpiredError,"code","authentication_expired_error");class QueueTimeoutError extends ReportingError{get code(){return QueueTimeoutError.code}}i()(QueueTimeoutError,"code","queue_timeout_error");class UnknownError extends ReportingError{get code(){return UnknownError.code}}i()(UnknownError,"code","unknown_error");class PdfWorkerOutOfMemoryError extends ReportingError{get code(){return PdfWorkerOutOfMemoryError.code}humanFriendlyMessage(){return o.i18n.translate("reporting.common.pdfWorkerOutOfMemoryErrorMessage",{defaultMessage:"Can't generate a PDF due to insufficient memory. Try making a smaller PDF and retrying this report."})}}i()(PdfWorkerOutOfMemoryError,"code","pdf_worker_out_of_memory_error");class BrowserCouldNotLaunchError extends ReportingError{get code(){return BrowserCouldNotLaunchError.code}humanFriendlyMessage(){return o.i18n.translate("reporting.common.browserCouldNotLaunchErrorMessage",{defaultMessage:"Can't generate screenshots because the browser did not launch. See the server logs for more information."})}}i()(BrowserCouldNotLaunchError,"code","browser_could_not_launch_error");class BrowserUnexpectedlyClosedError extends ReportingError{get code(){return BrowserUnexpectedlyClosedError.code}}i()(BrowserUnexpectedlyClosedError,"code","browser_unexpectedly_closed_error");class BrowserScreenshotError extends ReportingError{get code(){return BrowserScreenshotError.code}}i()(BrowserScreenshotError,"code","browser_screenshot_error");class KibanaShuttingDownError extends ReportingError{get code(){return KibanaShuttingDownError.code}}i()(KibanaShuttingDownError,"code","kibana_shutting_down_error");class VisualReportingSoftDisabledError extends ReportingError{get code(){return VisualReportingSoftDisabledError.code}humanFriendlyMessage(){return o.i18n.translate("reporting.common.cloud.insufficientSystemMemoryError",{defaultMessage:"Can't generate this report due to insufficient memory."})}}i()(VisualReportingSoftDisabledError,"code","visual_reporting_soft_disabled_error")},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.KbnRison},function(e,t){e.exports=__kbnSharedDeps__.EmotionCache},function(e,t,r){"use strict";const n=r(37),i=r(38),o=r(39);function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function s(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function c(e,t){return t.decode?i(e):e}function l(e){return Array.isArray(e)?e.sort():"object"==typeof e?l(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function u(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function d(e){const t=(e=u(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function p(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function g(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const i="string"==typeof r&&r.split("").indexOf(e.arrayFormatSeparator)>-1?r.split(e.arrayFormatSeparator).map((t=>c(t,e))):null===r?r:c(r,e);n[t]=i};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const i of e.split("&")){let[e,a]=o(t.decode?i.replace(/\+/g," "):i,"=");a=void 0===a?null:["comma","separator"].includes(t.arrayFormat)?a:c(a,t),r(c(e,t),a,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=p(r[e],t);else n[e]=p(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce(((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=l(r):e[t]=r,e}),Object.create(null))}t.extract=d,t.parse=g,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const i=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[s(t,e),"[",i,"]"].join("")]:[...r,[s(t,e),"[",s(i,e),"]=",s(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[s(t,e),"[]"].join("")]:[...r,[s(t,e),"[]=",s(n,e)].join("")];case"comma":case"separator":return t=>(r,n)=>null==n||0===n.length?r:0===r.length?[[s(t,e),"=",s(n,e)].join("")]:[[r,s(n,e)].join(e.arrayFormatSeparator)];default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,s(t,e)]:[...r,[s(t,e),"=",s(n,e)].join("")]}}(t),i={};for(const t of Object.keys(e))r(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map((r=>{const i=e[r];return void 0===i?"":null===i?s(r,t):Array.isArray(i)?i.reduce(n(r),[]).join("&"):s(r,t)+"="+s(i,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=o(e,"#");return Object.assign({url:r.split("?")[0]||"",query:g(d(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:c(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0},r);const n=u(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),a=Object.assign(o,e.query);let c=t.stringify(a,r);c&&(c=`?${c}`);let l=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(l=`#${s(e.fragmentIdentifier,r)}`),`${n}${c}${l}`}},function(e,t){e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/discover/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return u}));const n="xpack.reporting.jobCompletionNotifications",i="/app/reportingRedirect",o="__REPORTING_REDIRECT_LOCATOR_STORE_KEY__",a="/app/management/insightsAndAlerting/reporting",s="kibana-reporting";let c=function(e){return e.PENDING="pending",e.PROCESSING="processing",e.COMPLETED="completed",e.FAILED="failed",e.WARNINGS="completed_with_warnings",e}({});const l="reportJobListing",u="reportJobRow"},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r(3);var n=r(2),i=r(4),o=r(7),a=r(0);const s={cloud:{insufficientMemoryError:e=>Object(a.jsx)(i.FormattedMessage,{id:"xpack.reporting.listing.infoPanel.callout.cloud.insufficientMemoryError",defaultMessage:"Kibana needs more memory to generate this report. Check {link}.",values:{link:Object(a.jsx)(o.EuiLink,{href:e},n.i18n.translate("xpack.reporting.listing.infoPanel.callout.cloud.insufficientMemoryError.urlLink",{defaultMessage:"RAM requirements"}))}})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));var n=r(10),i=r.n(n),o=r(3),a=r(31),s=r(33),c=r(32),l=r.n(c),u=r(20),d=r.n(u),p=r(7);const g="eui-global",b="eui-utilities",h={darkMode:!1};var f=r(0);const m=[p.euiStylisPrefixer],j=d()({key:"css",stylisPlugins:m,container:document.querySelector('meta[name="emotion"]')}),y=d()({key:g,stylisPlugins:m,container:document.querySelector(`meta[name="${g}"]`)}),v=d()({key:b,stylisPlugins:m,container:document.querySelector(`meta[name="${b}"]`)});j.compat=!0,y.compat=!0,v.compat=!0;const _={default:j,global:y,utility:v},O=({theme:{theme$:e},globalStyles:t,colorMode:r,modify:n,children:i})=>{const a=l()(e,h),s=Object(o.useMemo)((()=>(e=>e.darkMode?p.COLOR_MODES_STANDARD.dark:p.COLOR_MODES_STANDARD.light)(a)),[a]),c=r||s,u=!1!==t&&void 0;return Object(f.jsx)(p.EuiProvider,{cache:_,modify:n,colorMode:c,globalStyles:u,utilityClasses:u},i)},x=({children:e,i18n:t,...r})=>Object(a.useIsNestedEuiProvider)()?(Object(s.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(f.jsx)(t.Context,null,e)):Object(f.jsx)(O,r,Object(f.jsx)(t.Context,null,e));var S=r(22);const w=({children:e,...t})=>Object(f.jsx)(x,i()({globalStyles:!1},t),Object(f.jsx)(S.KibanaErrorBoundaryProvider,{analytics:t.analytics},Object(f.jsx)(S.KibanaErrorBoundary,null,e)))},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/esUiShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t){e.exports=__kbnSharedDeps__.ElasticEuiLibComponentsUseIsNestedEuiProvider},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(40),i=r(3),o=n.__importDefault(r(41));t.default=function(e,t){var r=i.useState(t),n=r[0],a=r[1];return o.default((function(){var t=e.subscribe(a);return function(){return t.unsubscribe()}}),[e]),n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEuiDevProviderWarning=t.getEuiDevProviderWarning=t.emitEuiProviderWarning=void 0;var n=void 0;t.setEuiDevProviderWarning=function(e){return n=e},t.getEuiDevProviderWarning=function(){return n},t.emitEuiProviderWarning=function(e){if("function"==typeof n)return n(e);switch(n){case"log":console.log(e);break;case"warn":console.warn(e);break;case"error":throw new Error(e)}}},function(e,t,r){r.r(t);var n=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},function(e,t,r){r(36),__kbnBundles__.define("plugin/reporting/public",r,42)},function(e,t,r){r.p=window.__kbnPublicPath__.reporting},function(e,t,r){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},function(e,t,r){"use strict";var n="%[a-f0-9]{2}",i=new RegExp("("+n+")|([^%]+?)","gi"),o=new RegExp("("+n+")+","gi");function a(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],a(r),a(n))}function s(e){try{return decodeURIComponent(e)}catch(n){for(var t=e.match(i)||[],r=1;r<t.length;r++)t=(e=a(t,r).join("")).match(i)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=o.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=s(r[0]);n!==r[0]&&(t[r[0]]=n)}r=o.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),a=0;a<i.length;a++){var c=i[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,r){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;t.default=i},function(e,t,r){"use strict";r.r(t),r.d(t,"plugin",(function(){return $}));var n=r(1),i=r.n(n),o=r(6),a=r(18),s=r(2),c=r(5),l=r(12),u=r(4),d=r(8),p=r(3),g=r.n(p),b=r(11),h=r(7),f=r(0);const m=()=>Object(f.jsx)(p.Fragment,null,Object(f.jsx)(h.EuiSpacer,null),Object(f.jsx)(h.EuiFlexGroup,{justifyContent:"spaceAround"},Object(f.jsx)(h.EuiFlexItem,{grow:!1},Object(f.jsx)(h.EuiLoadingSpinner,{size:"l"}))),Object(f.jsx)(h.EuiSpacer,null)),j=Object(p.lazy)((()=>r.e(3).then(r.bind(null,58)).then((({ScreenCapturePanelContent:e})=>({default:e}))))),y=e=>Object(f.jsx)(p.Suspense,{fallback:Object(f.jsx)(m,null)},Object(f.jsx)(j,e)),v=(e,t)=>()=>{const{objectType:r,sharingData:{title:n,layout:i,locatorParams:o}}=e,a={objectType:r,layout:i,title:n};return"printablePdfV2"===t?{...a,locatorParams:[o]}:{...a,locatorParams:o}};var _=r(9),O=r(10),x=r.n(O),S=r(13),w=r(14);function E(e,t){return{ReportingPanelPDFV2:r=>"canvas"===r.layoutOption?Object(f.jsx)(y,x()({requiresSavedState:!1,reportType:S.d,apiClient:e,layoutOption:"canvas",startServices$:t},r)):null,ReportingPanelPNGV2(r){if("canvas"===r.layoutOption)return Object(f.jsx)(y,x()({requiresSavedState:!1,reportType:w.d,apiClient:e,layoutOption:"canvas",startServices$:t},r))},ReportingModalPDF(r){if("canvas"===r.layoutOption)return Object(f.jsx)(y,x()({requiresSavedState:!1,reportType:S.c,apiClient:e,layoutOption:"canvas",startServices$:t},r))},ReportingModalPNG(r){if("canvas"===r.layoutOption)return Object(f.jsx)(y,x()({requiresSavedState:!1,reportType:w.c,apiClient:e,layoutOption:"canvas",startServices$:t},r))}}}var R=r(23),M=r(34);class get_csv_panel_action_ReportingCsvPanelAction{constructor({core:e,csvConfig:t,apiClient:r,startServices$:n,usesUiCapabilities:c}){i()(this,"isDownloading",void 0),i()(this,"type",""),i()(this,"id",_.d),i()(this,"i18nStrings",void 0),i()(this,"notifications",void 0),i()(this,"apiClient",void 0),i()(this,"enablePanelActionDownload",void 0),i()(this,"theme",void 0),i()(this,"startServices$",void 0),i()(this,"usesUiCapabilities",void 0),i()(this,"isCompatible",(async e=>{var t;const{embeddable:r}=e;if("search"!==r.type)return!1;const[{application:n},{licensing:i}]=await Object(o.firstValueFrom)(this.startServices$),s=await Object(o.firstValueFrom)(i.license$),c=Object(b.a)(s.check("reporting","basic")).showLinks,l=!this.usesUiCapabilities||!0===(null===(t=n.capabilities.dashboard)||void 0===t?void 0:t.downloadCsv);return!(!c||!l)&&r.getInput().viewMode!==a.ViewMode.EDIT})),i()(this,"executeDownload",(async e=>{const{searchSource:t,columns:r,title:n,analytics:i,i18nStart:o}=e,a=this.apiClient.getDecoratedJobParams({searchSource:t,columns:r,title:n,objectType:"downloadCsv"});this.isDownloading=!0,this.notifications.toasts.addSuccess({title:this.i18nStrings.download.toasts.success.title,text:Object(d.a)(this.i18nStrings.download.toasts.success.body,{analytics:i,i18n:o,theme:this.theme}),"data-test-subj":"csvDownloadStarted"}),await this.apiClient.createImmediateReport(a).then((({body:e,response:t})=>{this.isDownloading=!1;const r=`${n}.csv`,i=new Blob([e],{type:(null==t?void 0:t.headers.get("content-type"))||void 0});if(window.navigator.msSaveOrOpenBlob)return window.navigator.msSaveOrOpenBlob(i,r);const o=window.document.createElement("a"),a=window.URL.createObjectURL(i);o.href=a,o.download=r,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)})).catch((e=>{console.error(e),this.isDownloading=!1,this.notifications.toasts.addDanger({title:this.i18nStrings.download.toasts.error.title,text:this.i18nStrings.download.toasts.error.body,"data-test-subj":"downloadCsvFail"})}))})),i()(this,"executeGenerate",(async e=>{const{searchSource:t,columns:r,title:n,analytics:i,i18nStart:o}=e,a=this.apiClient.getDecoratedJobParams({searchSource:t,columns:r,title:n,objectType:"search"});await this.apiClient.createReportingJob("csv_searchsource",a).then((e=>{e&&this.notifications.toasts.addSuccess({title:this.i18nStrings.generate.toasts.success.title,text:Object(d.a)(this.i18nStrings.generate.toasts.success.body,{analytics:i,i18n:o,theme:this.theme}),"data-test-subj":"csvReportStarted"})})).catch((e=>{console.error(e),this.notifications.toasts.addDanger({title:this.i18nStrings.generate.toasts.error.title,text:this.i18nStrings.generate.toasts.error.body,"data-test-subj":"generateCsvFail"})}))})),i()(this,"execute",(async e=>{const{embeddable:t}=e;if(!function(e){return e.type===R.SEARCH_EMBEDDABLE_TYPE}(t)||!await this.isCompatible(e))throw new M.IncompatibleActionError;const r=t.getSavedSearch();if(!r||this.isDownloading)return;const[{i18n:n,analytics:i}]=await Object(o.firstValueFrom)(this.startServices$),{columns:a,getSearchSource:s}=await this.getSharingData(r),c={searchSource:s({addGlobalTimeFilter:!t.hasTimeRange(),absoluteTime:!0}),columns:a,title:r.title||"",savedSearch:r,i18nStart:n,analytics:i};return this.enablePanelActionDownload?this.executeDownload(c):this.executeGenerate(c)})),this.isDownloading=!1,this.apiClient=r,this.enablePanelActionDownload=!0===t.enablePanelActionDownload,this.notifications=e.notifications,this.theme=e.theme,this.startServices$=n,this.usesUiCapabilities=c,this.i18nStrings=(e=>({download:{displayName:s.i18n.translate("reporting.share.panelAction.downloadCsvPanelTitle",{defaultMessage:"Download CSV"}),toasts:{error:{title:s.i18n.translate("reporting.share.panelAction.failedCsvReportTitle",{defaultMessage:"CSV download failed"}),body:s.i18n.translate("reporting.share.panelAction.failedCsvReportMessage",{defaultMessage:"We couldn't download your CSV at this time."})},success:{title:s.i18n.translate("reporting.share.panelAction.csvDownloadStartedTitle",{defaultMessage:"CSV download started"}),body:Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.panelAction.csvDownloadStartedMessage",defaultMessage:"Your CSV will download momentarily."})}}},generate:{displayName:s.i18n.translate("reporting.share.panelAction.generateCsvPanelTitle",{defaultMessage:"Generate CSV report"}),toasts:{error:{title:s.i18n.translate("reporting.share.panelAction.failedGenerateCsvReportTitle",{defaultMessage:"CSV report failed"}),body:s.i18n.translate("reporting.share.panelAction.failedGenerateCsvReportMessage",{defaultMessage:"We couldn't generate your CSV at this time."})},success:{title:s.i18n.translate("reporting.share.panelAction.csvReportStartedTitle",{defaultMessage:"Queued report for CSV"}),body:Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.panelAction.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:Object(f.jsx)("a",{href:e.getManagementLink()},Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.panelAction.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}})}}}}))(r)}getIconType(){return"document"}getDisplayName(){return this.enablePanelActionDownload?this.i18nStrings.download.displayName:this.i18nStrings.generate.displayName}async getSharingData(e){const[{uiSettings:t},{data:r}]=await Object(o.firstValueFrom)(this.startServices$),{getSharingData:n}=await Object(R.loadSharingDataHelpers)();return await n(e.searchSource,e,{uiSettings:t,data:r})}}var C=r(17),T=r(28);const P=(e,t,r,n,i)=>({title:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.couldNotCreateReportTitle",defaultMessage:"Cannot create {reportType} report for ''{reportObjectTitle}''.",values:{reportType:t.jobtype,reportObjectTitle:t.title}}),i),text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)(h.EuiCallOut,{size:"m",color:"danger","data-test-errorText":e},t.errorCode===C.a.code?T.a.cloud.insufficientMemoryError(n.links.reporting.cloudMinimumRequirements):e),Object(f.jsx)(h.EuiSpacer,null),Object(f.jsx)("p",null,Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.checkManagement",defaultMessage:"Go to {path} for details.",values:{path:Object(f.jsx)("a",{href:r()},Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Kibana > Reporting"}))}}))),i),iconType:void 0,"data-test-subj":"completeReportFailure"}),k=(e,t,r)=>({text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)(h.EuiCallOut,{title:e,color:"danger",iconType:"warning"},t.toString()),Object(f.jsx)(h.EuiSpacer,null),Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.error.tryRefresh",defaultMessage:"Try refreshing the page."})),r),iconType:void 0}),D=({getUrl:e,job:t})=>Object(f.jsx)(h.EuiButton,{size:"s","data-test-subj":"downloadCompletedReportButton",href:e(t.id),target:"_blank"},Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.downloadReportButtonLabel",defaultMessage:"Download report"})),L=({getUrl:e})=>Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.reportLinkDescription",defaultMessage:"Download it now, or get it later in {path}.",values:{path:Object(f.jsx)("a",{href:e()},Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),F=(e,t,r,n)=>({title:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.successfullyCreatedReportNotificationTitle",defaultMessage:"{reportType} created for ''{reportObjectTitle}''",values:{reportType:e.jobtype,reportObjectTitle:e.title}}),n),color:"success",text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)("p",null,Object(f.jsx)(L,{getUrl:t})),Object(f.jsx)(D,{getUrl:r,job:e})),n),"data-test-subj":"completeReportSuccess"}),N=(e,t,r,n)=>({title:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.csvContainsFormulas.formulaReportTitle",defaultMessage:"{reportType} may contain formulas",values:{reportType:e.jobtype}}),n),text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)("p",null,Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.csvContainsFormulas.formulaReportMessage",defaultMessage:"The report ''{reportObjectTitle}'' contains characters which spreadsheet applications can interpret as formulas.",values:{reportObjectTitle:e.title}})),Object(f.jsx)("p",null,Object(f.jsx)(L,{getUrl:t})),Object(f.jsx)(D,{getUrl:r,job:e})),n),"data-test-subj":"completeReportCsvFormulasWarning"}),I=(e,t,r,n)=>({title:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.maxSizeReached.partialReportTitle",defaultMessage:"Created partial {reportType} for ''{reportObjectTitle}''",values:{reportType:e.jobtype,reportObjectTitle:e.title}}),n),text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)("p",null,Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.maxSizeReached.partialReportDescription",defaultMessage:"The report reached the max size and contains partial data."})),Object(f.jsx)("p",null,Object(f.jsx)(L,{getUrl:t})),Object(f.jsx)(D,{getUrl:r,job:e})),n),"data-test-subj":"completeReportMaxSizeWarning"}),A=(e,t,r,n)=>({title:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"xpack.reporting.publicNotifier.warning.title",defaultMessage:"{reportType} completed with issues",values:{reportType:e.jobtype}}),n),text:Object(d.a)(Object(f.jsx)(g.a.Fragment,null,Object(f.jsx)("p",null,Object(f.jsx)(L,{getUrl:t})),Object(f.jsx)(D,{getUrl:r,job:e})),n),"data-test-subj":"completeReportWarning"});function U(e){var t;return{id:e.id,status:e.status,title:e.title,jobtype:null!==(t=e.prettyJobTypeName)&&void 0!==t?t:e.jobtype,maxSizeReached:e.max_size_reached,csvContainsFormulas:e.csv_contains_formulas,errorCode:e.error_code}}class stream_handler_ReportingNotifierStreamHandler{constructor(e,t){i()(this,"jobCompletionNotifications",Object(l.e)()),this.apiClient=e,this.core=t}startPolling(e,t){o.timer(0,e).pipe(Object(o.takeUntil)(t),Object(o.map)(this.jobCompletionNotifications.getPendingJobIds),Object(o.filter)((e=>e.length>0)),Object(o.mergeMap)((e=>this.findChangedStatusJobs(e))),Object(o.mergeMap)((({completed:e,failed:t})=>this.showNotifications({completed:e,failed:t}))),Object(o.catchError)((e=>(console.error(e),function(e,t){return e.notifications.toasts.addDanger(k(s.i18n.translate("xpack.reporting.publicNotifier.pollingErrorMessage",{defaultMessage:"Reporting notifier error!"}),t,e)),window.console.error(t),o.of({completed:[],failed:[]})}(this.core,e))))).subscribe()}showNotifications({completed:e,failed:t}){const r=this.core.notifications,n=this.apiClient,i=this.core,a=this.core.docLinks,s=n.getManagementLink.bind(n),l=n.getDownloadLink.bind(n);return o.from((async()=>{const o={toastLifeTimeMs:864e5};for(const t of null!=e?e:[])t.csvContainsFormulas?r.toasts.addWarning(N(t,s,l,i),o):t.maxSizeReached?r.toasts.addWarning(I(t,s,l,i),o):t.status===c.d.WARNINGS?r.toasts.addWarning(A(t,s,l,i),o):r.toasts.addSuccess(F(t,s,l,i),o);for(const e of null!=t?t:[]){const t=await n.getError(e.id);r.toasts.addDanger(P(t,e,s,a,i))}return{completed:e,failed:t}})())}findChangedStatusJobs(e){return o.from(this.apiClient.findForJobIds(e)).pipe(Object(o.mergeMap)((async t=>{const r=[],n=[],i=[];for(const o of e){const e=t.find((({id:e})=>e===o));(null==e?void 0:e.status)===c.d.COMPLETED||(null==e?void 0:e.status)===c.d.WARNINGS?r.push(U(e)):(null==e?void 0:e.status)===c.d.FAILED?n.push(U(e)):i.push(o)}return this.jobCompletionNotifications.setPendingJobIds(i),{completed:r,failed:n}})),Object(o.catchError)((e=>(this.core.notifications.toasts.addDanger(k(s.i18n.translate("xpack.reporting.publicNotifier.httpErrorMessage",{defaultMessage:"Could not check Reporting job status!"}),e,this.core)),window.console.error(e),o.of({})))))}}class plugin_ReportingPublicPlugin{constructor(e){i()(this,"kibanaVersion",void 0),i()(this,"apiClient",void 0),i()(this,"stop$",new o.ReplaySubject(1)),i()(this,"title",s.i18n.translate("xpack.reporting.management.reportingTitle",{defaultMessage:"Reporting"})),i()(this,"breadcrumbText",s.i18n.translate("xpack.reporting.breadcrumb",{defaultMessage:"Reporting"})),i()(this,"config",void 0),i()(this,"contract",void 0),i()(this,"startServices$",void 0),this.config=e.config.get(),this.kibanaVersion=e.env.packageInfo.version}getContract(e,t){if(this.contract={usesUiCapabilities:()=>{var e;return!1===(null===(e=this.config.roles)||void 0===e?void 0:e.enabled)},components:E(e,t)},!this.contract)throw new Error("Setup error in Reporting plugin!");return this.contract}setup(e,t){const{getStartServices:n}=e,{home:i,management:c,screenshotMode:p,share:g,uiActions:h}=t,m=Object(o.from)(n()).pipe(Object(o.map)((([e,...t])=>[{application:e.application,analytics:e.analytics,i18n:e.i18n,theme:e.theme,notifications:e.notifications,uiSettings:e.uiSettings},...t]))),j=!this.config.roles.enabled,y=new l.c(e.http,e.uiSettings,this.kibanaVersion);return this.apiClient=y,i.featureCatalogue.register({id:"reporting",title:s.i18n.translate("xpack.reporting.registerFeature.reportingTitle",{defaultMessage:"Reporting"}),description:s.i18n.translate("xpack.reporting.registerFeature.reportingDescription",{defaultMessage:"Manage your reports generated from Discover, Visualize, and Dashboard."}),icon:"reportingApp",path:"/app/management/insightsAndAlerting/reporting",showOnHomePage:!1,category:"admin"}),c.sections.section.insightsAndAlerting.registerApp({id:"reporting",title:this.title,order:3,keywords:["reports","report","reporting"],mount:async e=>{e.setBreadcrumbs([{text:this.breadcrumbText}]);const[[t,i],{mountManagementSection:o}]=await Promise.all([n(),r.e(1).then(r.bind(null,57))]),{licensing:a,data:s,share:c}=i,{docTitle:l}=t.chrome;l.change(this.title);const u=await o(t,a.license$,s,c,this.config,y,e);return()=>{l.reset(),u()}}}),e.application.register({id:"reportingRedirect",mount:async e=>{const{mountRedirectApp:t}=await r.e(2).then(r.bind(null,59));return t({...e,apiClient:y,screenshotMode:p,share:g})},title:"Reporting redirect app",chromeless:!0,exactRoute:!0,visibleIn:[]}),h.addTriggerAction(a.CONTEXT_MENU_TRIGGER,new get_csv_panel_action_ReportingCsvPanelAction({core:e,apiClient:y,startServices$:m,usesUiCapabilities:j,csvConfig:this.config.csv})),m.subscribe((([{application:e},{licensing:t}])=>{t.license$.subscribe((t=>{g.register((({apiClient:e,application:t,license:r,usesUiCapabilities:n,startServices$:i})=>({id:"csvReportsModal",getShareMenuItems:({objectType:a,sharingData:c,toasts:p})=>{if("search"!==a)return[];const g=c.isTextBased?_.c:_.a,b=c.getSearchSource,h={title:c.title,objectType:a},m=e=>g===_.c?{...h,locatorParams:c.locatorParams}:{...h,columns:c.columns,searchSource:b({addGlobalTimeFilter:!0,absoluteTime:!e})},j=[],y=Object(l.d)(r.check("reporting","basic")),v=y.message,O=y.showLinks,x=!y.enableLinks;let S=!1;var w;S=!n||!0===(null===(w=t.capabilities.discover)||void 0===w?void 0:w.generateCsv);const E=({intl:t})=>{const r=e.getDecoratedJobParams(m());return e.createReportingShareJob(g,r).then((()=>Object(o.firstValueFrom)(i))).then((([r])=>{p.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:a}),text:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:Object(f.jsx)("a",{href:e.getManagementLink()},Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;p.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:Object(f.jsx)("span",{dangerouslySetInnerHTML:{__html:null===(r=e.body)||void 0===r?void 0:r.message}})})}))};if(O&&S){const t=s.i18n.translate("reporting.share.contextMenu.export.csvReportsButtonLabel",{defaultMessage:"Export"}),r=new URL(window.location.origin),n=e.getReportingPublicJobPath(g,e.getDecoratedJobParams(m(!0))),i=new URL(n,window.location.href).toString();j.push({shareMenuItem:{name:t,toolTipContent:v,disabled:x,"data-test-subj":"Export"},helpText:Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.csv.reporting.helpTextCSV",defaultMessage:"Export a CSV of this {objectType}.",values:{objectType:a}}),reportType:g,label:"CSV",copyURLButton:{id:"reporting.share.modalContent.csv.copyUrlButtonLabel",dataTestSubj:"shareReportingCopyURL",label:"Post URL"},generateExportButton:Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.generateButtonLabelCSV","data-test-subj":"generateReportButton",defaultMessage:"Generate CSV"}),generateExport:E,generateCopyUrl:r,absoluteUrl:i,renderCopyURLButton:!0})}return j}}))({apiClient:y,license:t,application:e,usesUiCapabilities:j,startServices$:m})),(this.config.export_types.pdf.enabled||this.config.export_types.png.enabled)&&g.register((({apiClient:e,license:t,application:r,usesUiCapabilities:n,startServices$:i})=>({id:"modalImageReports",getShareMenuItems:({objectType:a,objectId:c,isDirty:l,onClose:p,shareableUrl:g,shareableUrlForSavedObject:h,toasts:m,...j})=>{const{enableLinks:y,showLinks:_,message:O}=Object(b.a)(t.check("reporting","gold")),x=O,S=_,w=!y;let E=!1,R=!1;var M,C;if(n?(E=!0===(null===(M=r.capabilities.dashboard)||void 0===M?void 0:M.generateScreenshot),R=!0===(null===(C=r.capabilities.visualize)||void 0===C?void 0:C.generateScreenshot)):(E=!0,R=!0),!S)return[];const T=["dashboard","visualization","lens"].includes(a);if(!T)return[];if("dashboard"===a&&!E)return[];if(T&&!R&&!E)return[];const{sharingData:P}=j,k=[],D={shareableUrl:l?g:null!=h?h:g,objectType:a,sharingData:P},L=null===P.locatorParams,F=e.getReportingPublicJobPath("printablePdfV2",e.getDecoratedJobParams(v(D,"printablePdfV2")())),N=e.getReportingPublicJobPath("pngV2",e.getDecoratedJobParams(v(D,"pngV2")()));return k.push({shareMenuItem:{name:s.i18n.translate("reporting.shareContextMenu.ExportsButtonLabel",{defaultMessage:"PDF"}),toolTipContent:x,disabled:w||P.reportingDisabled,"data-test-subj":"imageExports"},label:"PDF",generateExport:({intl:t,optimizedForPrinting:r=!1})=>{const n=document.querySelector("[data-shared-items-container]"),{height:s,width:c}=n?n.getBoundingClientRect():{height:768,width:1024},l={height:s,width:c},p=e.getDecoratedJobParams({...v(D,"printablePdfV2")(),layout:{id:r?"print":"preserve_layout",dimensions:l},objectType:a,title:P.title});return e.createReportingJob("printablePdfV2",p).then((()=>Object(o.firstValueFrom)(i))).then((([r])=>{m.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:a}),text:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:Object(f.jsx)("a",{href:e.getManagementLink()},Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;m.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:null===(r=e.body)||void 0===r?void 0:r.message})}))},reportType:"printablePdfV2",requiresSavedState:L,helpText:Object(f.jsx)(u.FormattedMessage,{id:"reporting.printablePdfV2.helpText",defaultMessage:"Select the file type you would like to export for this visualization."}),generateExportButton:Object(f.jsx)(u.FormattedMessage,{id:"reporting.printablePdfV2.generateButtonLabel",defaultMessage:"Export file"}),layoutOption:"dashboard"===a?"print":void 0,renderLayoutOptionSwitch:"dashboard"===a,renderCopyURLButton:!0,absoluteUrl:new URL(F,window.location.href).toString()}),k.push({shareMenuItem:{name:s.i18n.translate("reporting.shareContextMenu.ExportsButtonLabelPNG",{defaultMessage:"PNG export"}),toolTipContent:x,disabled:w||P.reportingDisabled,"data-test-subj":"imageExports"},label:"PNG",generateExport:({intl:t})=>{const{layout:r}=v(D,"pngV2")();let n=null==r?void 0:r.dimensions;if(!n){const e=document.querySelector("[data-shared-items-container]"),{height:t,width:r}=e?e.getBoundingClientRect():{height:768,width:1024};n={height:t,width:r}}const s=e.getDecoratedJobParams({...v(D,"pngV2")(),layout:{id:"preserve_layout",dimensions:n},objectType:a,title:P.title});return e.createReportingJob("pngV2",s).then((()=>Object(o.firstValueFrom)(i))).then((([r])=>{m.addSuccess({title:t.formatMessage({id:"reporting.share.modalContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:a}),text:Object(d.a)(Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.modalContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:Object(f.jsx)("a",{href:e.getManagementLink()},Object(f.jsx)(u.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),r),"data-test-subj":"queueReportSuccess"})})).catch((e=>{var r;m.addError(e,{title:t.formatMessage({id:"reporting.share.modalContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:null===(r=e.body)||void 0===r?void 0:r.message})}))},reportType:"pngV2",requiresSavedState:L,helpText:Object(f.jsx)(u.FormattedMessage,{id:"reporting.pngV2.helpText",defaultMessage:"Select the file type you would like to export for this visualization."}),generateExportButton:Object(f.jsx)(u.FormattedMessage,{id:"reporting.pngV2.generateButtonLabel",defaultMessage:"Export file"}),layoutOption:"dashboard"===a?"print":void 0,renderCopyURLButton:!0,absoluteUrl:new URL(N,window.location.href).toString()}),k}}))({apiClient:y,license:t,application:e,usesUiCapabilities:j,startServices$:m}))}))})),this.startServices$=m,this.getContract(y,m)}start(e){const t=new stream_handler_ReportingNotifierStreamHandler(this.apiClient,e),r=Object(c.l)(this.config.poll.jobsRefresh.interval);return t.startPolling(r,this.stop$),this.getContract(this.apiClient,this.startServices$)}stop(){this.stop$.next()}}function $(e){return new plugin_ReportingPublicPlugin(e)}}]);