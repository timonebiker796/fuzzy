/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.reporting_bundle_jsonpfunction=window.reporting_bundle_jsonpfunction||[]).push([[3],{58:function(e,t,s){"use strict";s.r(t),s.d(t,"ScreenCapturePanelContent",(function(){return screen_capture_panel_content_ScreenCapturePanelContent}));var a=s(10),n=s.n(a),o=s(1),r=s.n(o),i=s(7),p=s(4),u=s(3),l=s(6),c=s(9),d=s(13),h=s(14),g=s(2),b=s(8),j=s(0);const y={title:g.i18n.translate("reporting.share.panelContent.unsavedStateErrorTitle",{defaultMessage:"Unsaved work"})},m=()=>Object(j.jsx)(i.EuiCallOut,{size:"s",title:y.title,iconType:"warning",color:"danger","data-test-subj":"shareReportingUnsavedState"},Object(j.jsx)(i.EuiText,{size:"s"},Object(j.jsx)("p",null,Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.unsavedStateErrorText",defaultMessage:"Save your work before copying this URL."}))),Object(j.jsx)(i.EuiSpacer,{size:"s"})),C={title:g.i18n.translate("reporting.share.panelContent.unsavedStateAndExceedsMaxLengthTitle",{defaultMessage:"URL too long"})},x=({isUnsaved:e})=>Object(j.jsx)(i.EuiCallOut,{title:C.title,size:"s",iconType:"warning",color:"danger"},Object(j.jsx)(i.EuiText,{size:"s"},Object(j.jsx)("p",null,e?Object(j.jsx)("span",{"data-test-subj":"urlTooLongTrySavingMessage"},Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.unsavedStateAndExceedsMaxLengthTrySaveDescription",defaultMessage:"This URL cannot be copied. Try saving your work."})):Object(j.jsx)("span",{"data-test-subj":"urlTooLongErrorMessage"},Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.unsavedStateAndExceedsMaxLengthDescription",defaultMessage:"This URL cannot be copied."})))));class reporting_panel_content_ReportingPanelContentUi extends u.Component{constructor(e){super(e),r()(this,"mounted",void 0),r()(this,"getAbsoluteReportGenerationUrl",(e=>{const t=this.props.apiClient.getReportingPublicJobPath(e.reportType,this.props.apiClient.getDecoratedJobParams(this.props.getJobParams(!0)));return new URL(t,window.location.href).toString()})),r()(this,"isNotSaved",(()=>void 0===this.props.objectId||""===this.props.objectId)),r()(this,"renderGenerateReportButton",(e=>Object(j.jsx)(i.EuiButton,{disabled:e||this.state.isCreatingReportJob,fullWidth:!0,fill:!0,onClick:this.createReportingJob,"data-test-subj":"generateReportButton",size:"s",isLoading:this.state.isCreatingReportJob},Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.generateButtonLabel",defaultMessage:"Generate {reportingType}",values:{reportingType:this.prettyPrintReportingType()}})))),r()(this,"prettyPrintReportingType",(()=>{switch(this.props.reportType){case d.c:case d.d:return"PDF";case c.e:case c.f:return"CSV";case"png":case h.d:return h.c;default:return this.props.reportType}})),r()(this,"markAsStale",(()=>{this.mounted&&this.setState({isStale:!0})})),r()(this,"setAbsoluteReportGenerationUrl",(()=>{if(!this.mounted)return;const e=this.getAbsoluteReportGenerationUrl(this.props);this.setState({absoluteUrl:e})})),r()(this,"createReportingJob",(async()=>{const{startServices$:e,apiClient:t,intl:s}=this.props,[a]=await l.firstValueFrom(e),n=t.getDecoratedJobParams(this.props.getJobParams()),{toasts:o}=a.notifications;this.setState({isCreatingReportJob:!0});try{await this.props.apiClient.createReportingJob(this.props.reportType,n),o.addSuccess({title:s.formatMessage({id:"reporting.share.panelContent.successfullyQueuedReportNotificationTitle",defaultMessage:"Queued report for {objectType}"},{objectType:this.state.objectType}),text:Object(b.a)(Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.successfullyQueuedReportNotificationDescription",defaultMessage:"Track its progress in {path}.",values:{path:Object(j.jsx)("a",{href:this.props.apiClient.getManagementLink()},Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.publicNotifier.reportLink.reportingSectionUrlLinkLabel",defaultMessage:"Stack Management > Reporting"}))}}),a),"data-test-subj":"queueReportSuccess"}),this.props.onClose&&this.props.onClose(),this.mounted&&this.setState({isCreatingReportJob:!1})}catch(e){console.error(e),o.addError(e,{title:s.formatMessage({id:"reporting.share.panelContent.notification.reportingErrorTitle",defaultMessage:"Unable to create report"}),toastMessage:s.formatMessage({id:"reporting.share.panelContent.notification.reportingErrorToastMessage",defaultMessage:"We couldn't create a report at this time."})}),this.mounted&&this.setState({isCreatingReportJob:!1})}}));const{objectType:t}=e.getJobParams();this.state={isStale:!1,absoluteUrl:this.getAbsoluteReportGenerationUrl(e),layoutId:"",objectType:t,isCreatingReportJob:!1}}componentDidUpdate(e,t){this.props.layoutId&&this.props.layoutId!==t.layoutId&&this.setState({...t,absoluteUrl:this.getAbsoluteReportGenerationUrl(this.props),layoutId:this.props.layoutId})}componentWillUnmount(){window.removeEventListener("hashchange",this.markAsStale),window.removeEventListener("resize",this.setAbsoluteReportGenerationUrl),this.mounted=!1}componentDidMount(){this.mounted=!0,window.addEventListener("hashchange",this.markAsStale,!1),window.addEventListener("resize",this.setAbsoluteReportGenerationUrl)}renderCopyURLButton({isUnsaved:e,exceedsMaxLength:t}){return e?t?Object(j.jsx)(x,{isUnsaved:!0}):Object(j.jsx)(m,null):t?Object(j.jsx)(x,{isUnsaved:!1}):Object(j.jsx)(i.EuiCopy,{textToCopy:this.state.absoluteUrl,anchorClassName:"eui-displayBlock"},(t=>Object(j.jsx)(i.EuiButton,{color:e?"warning":"primary",fullWidth:!0,onClick:t,size:"s","data-test-subj":"shareReportingCopyURL"},Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.copyUrlButtonLabel",defaultMessage:"Copy POST URL"}))))}render(){const e=this.isNotSaved()||this.props.isDirty||this.state.isStale;if(this.props.requiresSavedState&&e)return Object(j.jsx)(i.EuiForm,{className:"kbnShareContextMenu__finalPanel","data-test-subj":"shareReportingForm"},Object(j.jsx)(i.EuiFormRow,{helpText:Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.saveWorkDescription",defaultMessage:"Please save your work before generating a report."})},this.renderGenerateReportButton(!0)));const t=this.state.absoluteUrl.length>=25e3;return Object(j.jsx)(i.EuiForm,{className:"kbnShareContextMenu__finalPanel","data-test-subj":"shareReportingForm"},Object(j.jsx)(i.EuiText,{size:"s"},Object(j.jsx)("p",null,Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.generationTimeDescription",defaultMessage:"{reportingType}s can take a minute or two to generate based upon the size of your {objectType}.",description:"Here 'reportingType' can be 'PDF' or 'CSV'",values:{reportingType:this.prettyPrintReportingType(),objectType:this.state.objectType}}))),Object(j.jsx)(i.EuiSpacer,{size:"s"}),this.props.options,this.renderGenerateReportButton(!1),Object(j.jsx)(i.EuiHorizontalRule,{margin:"s",style:{width:"auto",marginLeft:"-16px",marginRight:"-16px"}}),Object(j.jsx)(i.EuiAccordion,{id:"advanced-options",buttonContent:g.i18n.translate("reporting.share.panelContent.advancedOptions",{defaultMessage:"Advanced options"}),paddingSize:"none","data-test-subj":"shareReportingAdvancedOptionsButton"},Object(j.jsx)(i.EuiSpacer,{size:"s"}),Object(j.jsx)(i.EuiText,{size:"s"},Object(j.jsx)("p",null,Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.panelContent.howToCallGenerationDescription",defaultMessage:"Alternatively, copy this POST URL to call generation from outside Kibana or from Watcher."}))),Object(j.jsx)(i.EuiSpacer,{size:"s"}),this.renderCopyURLButton({isUnsaved:e,exceedsMaxLength:t})))}}const O=Object(p.injectI18n)(reporting_panel_content_ReportingPanelContentUi);class screen_capture_panel_content_ScreenCapturePanelContent extends u.Component{constructor(e){super(e),r()(this,"renderOptions",(()=>"print"===this.props.layoutOption?Object(j.jsx)(i.EuiFormRow,{helpText:Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.screenCapturePanelContent.optimizeForPrintingHelpText",defaultMessage:"Uses multiple pages, showing at most 2 visualizations per page"})},Object(j.jsx)(i.EuiSwitch,{label:Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.screenCapturePanelContent.optimizeForPrintingLabel",defaultMessage:"Optimize for printing"}),checked:this.state.usePrintLayout,onChange:this.handlePrintLayoutChange,"data-test-subj":"usePrintLayout"})):"canvas"===this.props.layoutOption?Object(j.jsx)(i.EuiFormRow,{helpText:Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.screenCapturePanelContent.canvasLayoutHelpText",defaultMessage:"Remove borders and footer logo"})},Object(j.jsx)(i.EuiSwitch,{label:Object(j.jsx)(p.FormattedMessage,{id:"reporting.share.screenCapturePanelContent.canvasLayoutLabel",defaultMessage:"Full page layout"}),checked:this.state.useCanvasLayout,onChange:this.handleCanvasLayoutChange,"data-test-subj":"reportModeToggle"})):null)),r()(this,"handlePrintLayoutChange",(e=>{this.setState({usePrintLayout:e.target.checked,useCanvasLayout:!1})})),r()(this,"handleCanvasLayoutChange",(e=>{this.setState({useCanvasLayout:e.target.checked,usePrintLayout:!1})})),r()(this,"getLayout",(()=>{const{layout:e}=this.props.getJobParams();let t=null==e?void 0:e.dimensions;if(!t){const e=document.querySelector("[data-shared-items-container]"),{height:s,width:a}=e?e.getBoundingClientRect():{height:768,width:1024};t={height:s,width:a}}return this.state.usePrintLayout?{id:"print",dimensions:t}:this.state.useCanvasLayout?{id:"canvas",dimensions:t}:{id:"preserve_layout",dimensions:t}})),r()(this,"getJobParams",(()=>({...this.props.getJobParams(),layout:this.getLayout()}))),this.state={usePrintLayout:!1,useCanvasLayout:!1}}render(){return Object(j.jsx)(O,n()({},this.props,{layoutId:this.getLayout().id,getJobParams:this.getJobParams,options:this.renderOptions()}))}}}}]);