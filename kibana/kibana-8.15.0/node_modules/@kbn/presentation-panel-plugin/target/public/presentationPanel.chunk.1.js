(window.presentationPanel_bundle_jsonpfunction=window.presentationPanel_bundle_jsonpfunction||[]).push([[1],{60:function(e,t,n){"use strict";n.r(t),n.d(t,"PresentationPanelInternal",(function(){return N}));var a=n(14),i=n.n(a),l=n(3),o=n(31),s=n(5),d=n(56),c=n.n(d),r=n(1),b=n.n(r),u=n(16),j=n(4),m=n(10),p=n(6),g=n(23),O=n(0);const f=({api:e,index:t,getActions:n,actionPredicate:a})=>{const[i,o]=Object(r.useState)(!1),[d,b]=Object(r.useState)([]),[f,P]=Object(r.useState)(void 0),[x,v]=Object(r.useState)([]),[h,T]=Object(s.n)(e.panelTitle,Object(s.l)(e));Object(r.useEffect)((()=>{if(!1===f||!e)return;o(!0);let t=!1;return(async i=>{let l=await(async t=>n?await n(g.b,{embeddable:e}):null!==(t=await p.d.getTriggerCompatibleActions(g.b,{embeddable:e}))&&void 0!==t?t:[])();if(t)return;const s=null===(i=e.disabledActionIds)||void 0===i?void 0:i.value;s&&(l=l.filter((e=>-1===s.indexOf(e.id)))),a&&(l=l.filter((({id:e})=>a(e)))),l.sort((({order:e},{order:t})=>(t||0)-(e||0)));const d=await Object(m.buildContextMenuForActions)({actions:l.map((t=>({action:t,context:{embeddable:e},trigger:g.e}))),closeMenu:()=>P(!1)});t||(o(!1),b(l),v(d))})(),()=>{t=!0}}),[a,e,n,f,T]);const E=Object(r.useMemo)((()=>d.some((e=>e.showNotification))),[d]),_=c()({embPanel__optionsMenuPopover:!0,"embPanel__optionsMenuPopover-notification":E}),w=Object(O.jsx)(l.EuiButtonIcon,{color:"text",className:"embPanel__optionsMenuButton","data-test-subj":"embeddablePanelToggleMenuIcon","aria-label":Object(u.b)(h,t),onClick:()=>P((e=>!e)),iconType:"boxesHorizontal"});return Object(O.jsx)(l.EuiPopover,{repositionOnScroll:!0,panelPaddingSize:"none",anchorPosition:"downRight",button:w,isOpen:f,className:_,closePopover:()=>P(!1),"data-test-subj":f?"embeddablePanelContextMenuOpen":"embeddablePanelContextMenuClosed"},i?Object(O.jsx)(l.EuiContextMenuPanel,{className:"embPanel__optionsMenuPopover-loading",title:j.i18n.translate("presentationPanel.contextMenu.loadingTitle",{defaultMessage:"Options"})},Object(O.jsx)(l.EuiContextMenuItem,null,Object(O.jsx)(l.EuiSkeletonText,null))):Object(O.jsx)(l.EuiContextMenu,{"data-test-subj":"presentationPanelContextMenuItems",initialPanelId:"mainMenu",panels:x}))};var P=n(57),x=n(2),v=n(12),h=n(32);const T=Object(P.once)((()=>Object(x.fromEvent)(document,"mousemove"))),E=Object(P.once)((()=>Object(x.fromEvent)(document,"mouseup"))),_=({api:e,viewMode:t,hideTitle:n,panelTitle:a,panelDescription:i})=>{const[o,s]=Object(r.useState)(null),d=Object(r.useMemo)((()=>{if(n)return null;const i=c()("embPanel__titleText",{embPanel__placeholderTitleText:!a});return"edit"===t&&Object(v.d)(e)?Object(O.jsx)(l.EuiLink,{color:"text",ref:s,className:i,"aria-label":Object(u.c)(a),"data-test-subj":"embeddablePanelTitleLink"},a||u.f):Object(O.jsx)("span",{className:i},a)}),[s,n,a,t,e]),j=(e=>{const t=Object(r.useRef)(null),[n,a]=Object(r.useState)(!1);return Object(r.useEffect)((()=>{if(e){const n=E(),i=T(),l=Object(x.fromEvent)(e,"mousedown"),o=Object(x.fromEvent)(e,"keydown"),s=l.pipe(Object(x.mergeMap)((function(e){const t=e.offsetX,a=e.offsetY;return i.pipe(Object(x.map)((function(e){return{dragged:t!==e.clientX&&a!==e.clientY}}))).pipe(Object(x.takeUntil)(n),Object(x.takeLast)(1)).pipe(Object(x.defaultIfEmpty)({dragged:!1}))}))).pipe(Object(x.repeatWhen)((()=>l)));t.current=Object(x.race)(o.pipe(Object(x.takeWhile)((e=>"Enter"===e.key))).pipe(Object(x.map)((()=>({dragged:!1})))),s),a(!0)}}),[e]),n?t.current:null})(o);return Object(r.useEffect)((()=>{const t=null==j?void 0:j.subscribe((function({dragged:t}){t||Object(h.a)({api:e,focusOnTitle:!0})}));return()=>null==t?void 0:t.unsubscribe()}),[e,j]),Object(r.useMemo)((()=>i?Object(O.jsx)(l.EuiToolTip,{title:n?void 0:a||void 0,content:i,delay:"regular",position:"top",anchorClassName:"embPanel__titleTooltipAnchor",anchorProps:{"data-test-subj":"embeddablePanelTooltipAnchor"}},Object(O.jsx)("span",{"data-test-subj":"embeddablePanelTitleInner",className:"embPanel__titleInner"},n?null:Object(O.jsx)(b.a.Fragment,null,d,"Â "),Object(O.jsx)(l.EuiIcon,{type:"iInCircle",color:"subdued","data-test-subj":"embeddablePanelTitleDescriptionIcon"}))):n?null:Object(O.jsx)("span",{"data-test-subj":"embeddablePanelTitleInner",className:"embPanel__titleInner"},d)),[n,i,a,d])};var w=n(58);const M=({api:e,index:t,viewMode:n,headerId:a,getActions:o,hideTitle:s,panelTitle:d,panelDescription:j,actionPredicate:m,showBadges:P=!0,showNotifications:v=!0})=>{const{notificationElements:h,badgeElements:T}=((e,t,n,a)=>{const[o,s]=Object(r.useState)([]),[d,c]=Object(r.useState)([]);return Object(r.useEffect)((()=>{let e=!1;const t=new x.Subscription,i=null!=a?a:p.d.getTriggerCompatibleActions,l=async e=>{var t,a;let l=null!==(t=await i(e,{embeddable:n}))&&void 0!==t?t:[];const o=null===(a=n.disabledActionIds)||void 0===a?void 0:a.value;return o&&(l=l.filter((e=>-1===o.indexOf(e.id)))),l},o=(t,n,a)=>{e||("badge"===t?s:c)((e=>{const t=null==e?void 0:e.filter((e=>e.id!==a.id));return n?[...t,a]:t}))};return(async()=>{const[a,i]=await Promise.all([l(g.c),l(g.d)]);if(e)return;s(a),c(i);const d={embeddable:n},r=p.d.getFrequentlyChangingActionsForTrigger(g.c,d);for(const e of r)t.add(e.subscribeToCompatibilityChanges(d,((e,t)=>o("badge",e,t))));const b=p.d.getFrequentlyChangingActionsForTrigger(g.d,d);for(const e of b)t.add(e.subscribeToCompatibilityChanges(d,((e,t)=>o("notification",e,t))))})(),()=>{e=!0,t.unsubscribe()}}),[]),{badgeElements:Object(r.useMemo)((()=>t?null==o?void 0:o.map((e=>{var t;const a=null===(t=e.getDisplayNameTooltip)||void 0===t?void 0:t.call(e,{embeddable:n,trigger:g.g}),o=Object(O.jsx)(l.EuiBadge,i()({key:e.id,className:"embPanel__headerBadge",iconType:e.getIconType({embeddable:n,trigger:g.g}),onClick:()=>e.execute({embeddable:n,trigger:g.g}),onClickAriaLabel:e.getDisplayName({embeddable:n,trigger:g.g}),"data-test-subj":`embeddablePanelBadge-${e.id}`},a?{"aria-label":a}:{}),e.MenuItem?b.a.createElement(e.MenuItem,{context:{embeddable:n,trigger:g.g}}):e.getDisplayName({embeddable:n,trigger:g.g}));return a?Object(O.jsx)(l.EuiToolTip,{key:e.id,content:a},o):o})):[]),[n,o,t]),notificationElements:Object(r.useMemo)((()=>e?null==d?void 0:d.map((e=>{let t=e.MenuItem?b.a.createElement(e.MenuItem,{key:e.id,context:{embeddable:n,trigger:g.h}}):Object(O.jsx)(l.EuiNotificationBadge,{"data-test-subj":`embeddablePanelNotification-${e.id}`,key:e.id,style:{marginTop:w.euiThemeVars.euiSizeXS,marginRight:w.euiThemeVars.euiSizeXS},onClick:()=>e.execute({embeddable:n,trigger:g.h})},e.getDisplayName({embeddable:n,trigger:g.h}));if(e.getDisplayNameTooltip){const a=e.getDisplayNameTooltip({embeddable:n,trigger:g.h});a&&(t=Object(O.jsx)(l.EuiToolTip,{position:"top",delay:"regular",content:a,key:e.id},t))}return t})):[]),[n,d,e])}})(v,P,e,o),E=!s||j||"view"!==n||T.length>0||h.length>0,M=Object(u.a)(E?d:void 0),y=Object(O.jsx)(l.EuiScreenReaderOnly,null,Object(O.jsx)("span",{id:a},M)),N=c()("embPanel__header",{"embPanel__header--floater":!E}),I=c()("embPanel__title",{"embPanel--dragHandle":"edit"===n}),C=Object(O.jsx)(f,{index:t,api:e,getActions:o,actionPredicate:m});return E?Object(O.jsx)("figcaption",{className:N,"data-test-subj":`embeddablePanelHeading-${(d||"").replace(/\s/g,"")}`},Object(O.jsx)("h2",{"data-test-subj":"dashboardPanelTitle",className:I},y,Object(O.jsx)(_,{api:e,viewMode:n,hideTitle:s,panelTitle:d,panelDescription:j}),P&&T),v&&h,C):Object(O.jsx)("div",{"data-test-subj":"embeddablePanelHeading",className:N},C,y)};var y=n(18);const N=({index:e,hideHeader:t,showShadow:n,showBorder:a,showBadges:d,showNotifications:b,getActions:u,actionPredicate:j,Component:m,componentProps:p})=>{var g;const[f,P]=Object(r.useState)(null),x=Object(r.useMemo)((()=>Object(l.htmlIdGenerator)()()),[]),v=Object(s.h)(f)?f.viewMode:Object(s.b)(f)&&Object(s.h)(f.parentApi)?f.parentApi.viewMode:void 0,[h,T,E,_,w,N,I,C,S]=Object(s.n)(null==f?void 0:f.dataLoading,null==f?void 0:f.blockingError,null==f?void 0:f.panelTitle,null==f?void 0:f.hidePanelTitle,null==f?void 0:f.panelDescription,null==f?void 0:f.defaultPanelTitle,null==f?void 0:f.defaultPanelDescription,v,null==f||null===(g=f.parentApi)||void 0===g?void 0:g.hidePanelTitle),k=null!=C?C:"view",[A,B]=Object(r.useState)(!h);A||!1!==h&&(!f||f.dataLoading)||B(!0);const D=Boolean(_)||Boolean(S)||"view"===k&&!Boolean(null!=E?E:N),F=Object(r.useMemo)((()=>{const e={};return h?e["data-loading"]=!0:e["data-render-complete"]=!0,T&&(e["data-error"]=!0),e}),[h,T]);return Object(O.jsx)(l.EuiPanel,i()({role:"figure",paddingSize:"none",className:c()("embPanel",{"embPanel--editing":"edit"===k}),hasShadow:n,hasBorder:a,"aria-labelledby":x,"data-test-embeddable-id":null==f?void 0:f.uuid,"data-test-subj":"embeddablePanel"},F),!t&&f&&Object(O.jsx)(M,{api:f,index:e,headerId:x,viewMode:k,hideTitle:D,showBadges:d,getActions:u,actionPredicate:j,showNotifications:b,panelTitle:null!=E?E:N,panelDescription:null!=w?w:I}),T&&f&&Object(O.jsx)(l.EuiFlexGroup,{alignItems:"center",className:"eui-fullHeight embPanel__error","data-test-subj":"embeddableError",justifyContent:"center"},Object(O.jsx)(y.a,{api:f,error:T})),!A&&Object(O.jsx)(o.a,null),Object(O.jsx)("div",{className:T?"embPanel__content--hidden":"embPanel__content"},Object(O.jsx)(l.EuiErrorBoundary,null,Object(O.jsx)(m,i()({},p,{ref:e=>{e&&!f&&P(e)}})))))}}}]);