/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t,n){e.exports=n(10)(2)},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t,n){n.r(t);var i=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(i))},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,n){"use strict";var i=Array.isArray,o=Object.keys,r=Object.prototype.hasOwnProperty,a="undefined"!=typeof Element;function c(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,s,d,l=i(e),u=i(t);if(l&&u){if((s=e.length)!=t.length)return!1;for(n=s;0!=n--;)if(!c(e[n],t[n]))return!1;return!0}if(l!=u)return!1;var b=e instanceof Date,m=t instanceof Date;if(b!=m)return!1;if(b&&m)return e.getTime()==t.getTime();var f=e instanceof RegExp,h=t instanceof RegExp;if(f!=h)return!1;if(f&&h)return e.toString()==t.toString();var p=o(e);if((s=p.length)!==o(t).length)return!1;for(n=s;0!=n--;)if(!r.call(t,p[n]))return!1;if(a&&e instanceof Element&&t instanceof Element)return e===t;for(n=s;0!=n--;)if(!("_owner"===(d=p[n])&&e.$$typeof||c(e[d],t[d])))return!1;return!0}return e!=e&&t!=t}e.exports=function(e,t){try{return c(e,t)}catch(e){if(e.message&&e.message.match(/stack|recursion/i)||-2146828260===e.number)return console.warn("Warning: react-fast-compare does not handle circular references.",e.name,e.message),!1;throw e}}},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,o,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(o=i;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=i;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=i;0!=o--;){var a=r[o];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){n(9),__kbnBundles__.define("plugin/embeddableEnhanced/public",n,11)},function(e,t,n){n.p=window.__kbnPublicPath__.embeddableEnhanced},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return A})),n.d(t,"apiHasDynamicActions",(function(){return f})),n.d(t,"embeddableEnhancedDrilldownGrouping",(function(){return g}));var i=n(2),o=n.n(i),r=n(3),a=n(0);n(1);const c=e=>Boolean(e&&void 0!==(null==e?void 0:e.parentApi)),s=e=>Boolean(e&&void 0!==(null==e?void 0:e.viewMode)),d=e=>s(e)?e.viewMode.getValue():c(e)&&s(e.parentApi)?e.parentApi.viewMode.getValue():void 0;n(7);var l=n(4),u=n(6),b=n.n(u),m=n(5);const f=e=>{const t=e;return Boolean(t&&t.enhancements&&"object"==typeof t.enhancements.dynamicActions&&"function"==typeof t.setDynamicActions&&t.dynamicActionsState$)},h=m.i18n.translate("xpack.embeddableEnhanced.actions.panelNotifications.oneDrilldown",{defaultMessage:"Panel has 1 drilldown"}),p="ACTION_PANEL_NOTIFICATIONS",y=e=>f(e)&&(e=>s(e)||c(e)&&s(e.parentApi))(e);class panel_notifications_action_PanelNotificationsAction{constructor(){o()(this,"id",p),o()(this,"type",p),o()(this,"getIconType",(()=>"")),o()(this,"getDisplayName",(({embeddable:e})=>String(this.getEventCount({embeddable:e})))),o()(this,"subscribeToCompatibilityChanges",(({embeddable:e},t)=>{var n;if(!y(e))return;const i=null!==(n=s(o=e)?o.viewMode:c(o)&&s(o.parentApi)?o.parentApi.viewMode:void 0)&&void 0!==n?n:new a.BehaviorSubject(r.ViewMode.VIEW);var o;return Object(a.merge)(e.dynamicActionsState$,i).subscribe((()=>{t(d(e)===r.ViewMode.EDIT&&this.getEventCount({embeddable:e})>0,this)}))})),o()(this,"getDisplayNameTooltip",(({embeddable:e})=>{const t=this.getEventCount({embeddable:e});return t?1===t?h:(e=>m.i18n.translate("xpack.embeddableEnhanced.actions.panelNotifications.manyDrilldowns",{defaultMessage:"Panel has {count} drilldowns",values:{count:String(e)}}))(t):""})),o()(this,"isCompatible",(async({embeddable:e})=>y(e)&&d(e)===r.ViewMode.EDIT&&this.getEventCount({embeddable:e})>0)),o()(this,"execute",(async()=>{}))}getEventCount({embeddable:e}){var t,n;return y(e)?(null!==(t=null===(n=e.dynamicActionsState$.getValue())||void 0===n?void 0:n.dynamicActions.events)&&void 0!==t?t:[]).length:0}couldBecomeCompatible({embeddable:e}){return y(e)}}const g=[{id:"drilldowns",getDisplayName:()=>m.i18n.translate("xpack.embeddableEnhanced.Drilldowns",{defaultMessage:"Drilldowns"}),getIconType:()=>"symlink",order:25}];class dynamic_action_storage_DynamicActionStorage extends l.UiActionsEnhancedAbstractActionStorage{constructor(e,t,n){super(),this.id=e,this.getPanelTitle=t,this.api=n}put(e){this.api.setDynamicActions({dynamicActions:e})}async create(e){const t=this.getEvents();if(t.find((({eventId:t})=>t===e.eventId)))throw new Error(`[EEXIST]: Event with [eventId = ${e.eventId}] already exists on [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({events:[...t,e]})}async update(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),i=n.findIndex((({eventId:t})=>t===e.eventId));if(-1===i)throw new Error(`[ENOENT]: Event with [eventId = ${e.eventId}] could not be updated as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,i),e,...n.slice(i+1)]})}async remove(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),i=n.findIndex((t=>e===t.eventId));if(-1===i)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be removed as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,i),...n.slice(i+1)]})}async read(e){const t=this.getEvents().find((t=>e===t.eventId));if(!t)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be found in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);return t}async list(){return this.getEvents()}getEvents(){var e,t;const n=this.api.dynamicActionsState$.getValue(),i=null!==(e=null==n||null===(t=n.dynamicActions)||void 0===t?void 0:t.events)&&void 0!==e?e:[];return this.migrate(i)}migrate(e){return e.map((e=>{if("DASHBOARD_TO_DASHBOARD_DRILLDOWN"===e.action.factoryId){const t=e.triggers.filter((e=>e!==r.VALUE_CLICK_TRIGGER&&e!==r.SELECT_RANGE_TRIGGER));return t.length===e.triggers.length||t.includes("FILTER_TRIGGER")||t.push("FILTER_TRIGGER"),{...e,triggers:t}}return e}))}}function v(e){var t;return{dynamicActions:{events:[],...null!==(t=null==e?void 0:e.dynamicActions)&&void 0!==t?t:{}}}}class plugin_EmbeddableEnhancedPlugin{constructor(e){o()(this,"uiActions",void 0),o()(this,"isEmbeddableContext",(e=>!(null==e||!e.embeddable)||(console.warn("For drilldowns to work action context should contain .embeddable field."),!1))),this.context=e}setup(e,t){this.setCustomEmbeddableFactoryProvider(t);const n=new panel_notifications_action_PanelNotificationsAction;return t.uiActionsEnhanced.registerAction(n),t.uiActionsEnhanced.attachAction(r.PANEL_NOTIFICATION_TRIGGER,n.id),{}}start(e,t){return this.uiActions=t.uiActionsEnhanced,{initializeReactEmbeddableDynamicActions:this.initializeDynamicActions.bind(this)}}stop(){}setCustomEmbeddableFactoryProvider(e){e.embeddable.setCustomEmbeddableFactoryProvider((e=>{const t=Object(r.defaultEmbeddableFactoryProvider)(e);return{...t,create:async(...e)=>{const n=await t.create(...e);return n?this.enhanceEmbeddableWithDynamicActions(n):n},createFromSavedObject:async(...e)=>{const n=await t.createFromSavedObject(...e);return n?this.enhanceEmbeddableWithDynamicActions(n):n}}}))}initializeDynamicActions(e,t,n){const i=new a.BehaviorSubject(v(n.enhancements)),o={dynamicActionsState$:i,setDynamicActions:e=>{i.next(e)}},r=new dynamic_action_storage_DynamicActionStorage(e,t,o),c=new l.UiActionsEnhancedDynamicActionManager({isCompatible:async t=>{const{embeddable:n}=t;return i=n,Boolean(i&&void 0!==(null==i?void 0:i.uuid))&&n.uuid===e;var i},storage:r,uiActions:this.uiActions});return{dynamicActionsApi:{...o,enhancements:{dynamicActions:c}},dynamicActionsComparator:{enhancements:[i,o.setDynamicActions,(e,t)=>b()(v(e),v(t))]},serializeDynamicActions:()=>({enhancements:i.getValue()}),startDynamicActions:()=>({stopDynamicActions:this.startDynamicActions(c)})}}enhanceEmbeddableWithDynamicActions(e){var t;const n=e,i=new a.BehaviorSubject({dynamicActions:{events:[]},...null!==(t=e.getInput().enhancements)&&void 0!==t?t:{}}),o={dynamicActionsState$:i,setDynamicActions:t=>{e.updateInput({enhancements:t})}};e.getInput$().pipe(Object(a.distinctUntilChanged)((({enhancements:e},{enhancements:t})=>b()(e,t)))).subscribe((e=>{var t;i.next({dynamicActions:{events:[]},...null!==(t=e.enhancements)&&void 0!==t?t:{}})}));const r=new dynamic_action_storage_DynamicActionStorage(String(e.runtimeId),e.getTitle,o),c=new l.UiActionsEnhancedDynamicActionManager({isCompatible:async t=>!!this.isEmbeddableContext(t)&&t.embeddable.runtimeId===e.runtimeId,storage:r,uiActions:this.uiActions}),s=this.startDynamicActions(c);return e.getInput$().subscribe({next:()=>{r.reload$.next()},error:s,complete:s}),n.enhancements={...n.enhancements,dynamicActions:c},n.dynamicActionsState$=o.dynamicActionsState$,n.setDynamicActions=o.setDynamicActions,n}startDynamicActions(e){return e.start().catch((t=>{console.log("Failed to start embeddable dynamic actions",e),console.error(t)})),()=>{e.stop().catch((t=>{console.log("Failed to stop embeddable dynamic actions",e),console.error(t)}))}}}function A(e){return new plugin_EmbeddableEnhancedPlugin(e)}}]);