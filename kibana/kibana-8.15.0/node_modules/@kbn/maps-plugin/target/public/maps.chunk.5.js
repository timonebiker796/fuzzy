/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.maps_bundle_jsonpfunction=window.maps_bundle_jsonpfunction||[]).push([[5,15],{110:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return u}));var i=n(5),r=n(90),s=n(0);let o=function(t){return t.NONE="NONE",t.LAYER_PANEL="LAYER_PANEL",t.ADD_LAYER_WIZARD="ADD_LAYER_WIZARD",t.MAP_SETTINGS_PANEL="MAP_SETTINGS_PANEL",t}({});const a=!0,l={flyoutDisplay:o.NONE,drawMode:s.x.NONE,isFullScreen:!1,isReadOnly:!Object(i.A)().save,isLayerTOCOpen:a,isTimesliderOpen:!1,openTOCDetails:[],autoOpenLayerWizardId:"",deletedFeatureIds:[]};function u(t=l,e){switch(e.type){case r.l:return{...t,flyoutDisplay:e.display};case r.e:return{...t,drawMode:e.drawMode};case r.g:return{...t,isLayerTOCOpen:e.isLayerTOCOpen};case r.h:return{...t,isTimesliderOpen:e.isTimesliderOpen};case r.f:return{...t,isFullScreen:e.isFullScreen};case r.j:return{...t,isReadOnly:e.isReadOnly};case r.i:return{...t,openTOCDetails:e.layerIds};case r.k:return{...t,openTOCDetails:[...t.openTOCDetails,e.layerId]};case r.b:return{...t,openTOCDetails:t.openTOCDetails.filter((t=>t!==e.layerId))};case r.d:return{...t,autoOpenLayerWizardId:e.autoOpenLayerWizardId};case r.c:return{...t,deletedFeatureIds:[...t.deletedFeatureIds,e.featureId]};case r.a:return{...t,deletedFeatureIds:[]};default:return t}}},111:function(t,e,n){"use strict";n.d(e,"f",(function(){return b})),n.d(e,"d",(function(){return x})),n.d(e,"c",(function(){return E})),n.d(e,"b",(function(){return S})),n.d(e,"e",(function(){return C})),n.d(e,"g",(function(){return O})),n.d(e,"k",(function(){return I})),n.d(e,"a",(function(){return w})),n.d(e,"i",(function(){return L})),n.d(e,"h",(function(){return T})),n.d(e,"j",(function(){return j}));var i=n(75),r=n(6),s=n.n(r),o=n(145);class map_adapter_MapAdapter extends o.EventEmitter{constructor(...t){super(...t),s()(this,"stats",void 0),s()(this,"style",void 0)}setMapState({stats:t,style:e}){this.stats=t,this.style=e,this._onChange()}getMapState(){return{stats:this.stats,style:this.style}}_onChange(){this.emit("change")}}n(34);var a=n(265),l=n.n(a),u=n(0),c=n(146);class vector_tile_adapter_VectorTileAdapter extends o.EventEmitter{constructor(...t){super(...t),s()(this,"_layers",{}),s()(this,"_tiles",[])}addLayer(t,e,n){this._layers[t]={label:e,tileUrl:n},this._onChange()}removeLayer(t){delete this._layers[t],this._onChange()}hasLayers(){return Object.keys(this._layers).length>0}setTiles(t){this._tiles=t,this._onChange()}setTileResults(t,e,n){this._layers[t]&&(this._layers[t]={...this._layers[t],tileErrors:n,tileMetaFeatures:e},this._onChange())}getLayerOptions(){return Object.keys(this._layers).map((t=>({value:t,label:this._layers[t].label})))}getTileRequests(t){if(!this._layers[t])return[];const{tileErrors:e,tileMetaFeatures:n,tileUrl:i}=this._layers[t];return this._tiles.map((r=>({layerId:t,tileUrl:i,tileError:d(r.x,r.y,r.z,e),tileMetaFeature:h(r.x,r.y,r.z,n),...r})))}_onChange(){this.emit("change")}}function h(t,e,n,i){if(i&&0!==i.length)return i.find((i=>{const r=l()(i).geometry;return Object(c.e)(r.coordinates[u.X],r.coordinates[u.bb],t,e,n)}))}function d(t,e,n,i){if(!i||0===i.length)return;const r=`${n}/${t}/${e}`;return i.find((t=>t.tileKey===r))}n(35);var p=n(5);const f="REGISTER_CANCEL_CALLBACK",g="UNREGISTER_CANCEL_CALLBACK",m="SET_EVENT_HANDLERS",_="SET_CHARTS_PALETTE_SERVICE_GET_COLOR",y="SET_ON_MAP_MOVE";function v(){const t={requests:new i.RequestAdapter,vectorTiles:new vector_tile_adapter_VectorTileAdapter};return Object(p.M)()&&(t.map=new map_adapter_MapAdapter),t}function b(t,e={}){if(!t)return{inspectorAdapters:v(),cancelRequestCallbacks:new Map,eventHandlers:{},chartsPaletteServiceGetColor:null};switch(e.type){case f:return t.cancelRequestCallbacks.set(e.requestToken,e.callback),{...t};case g:return t.cancelRequestCallbacks.delete(e.requestToken),{...t};case m:return{...t,eventHandlers:e.eventHandlers};case _:return{...t,chartsPaletteServiceGetColor:e.chartsPaletteServiceGetColor};case y:return{...t,onMapMove:e.onMapMove};default:return t}}const x=({nonSerializableInstances:t})=>t.inspectorAdapters,E=({nonSerializableInstances:t})=>t.eventHandlers;function S({nonSerializableInstances:t}){return t.chartsPaletteServiceGetColor}function C({nonSerializableInstances:t}){return t.onMapMove}const O=(t,e)=>({type:f,requestToken:t,callback:e}),I=t=>({type:g,requestToken:t}),w=t=>(e,n)=>{if(!t)return;const i=(({nonSerializableInstances:t})=>t.cancelRequestCallbacks)(n()).get(t);i&&(i(),e(I(t)))},L=(t={})=>({type:m,eventHandlers:t});function T(t){return{type:_,chartsPaletteServiceGetColor:t}}function j(t){return{type:y,onMapMove:t}}},130:function(t,e,n){"use strict";n.d(e,"B",(function(){return i})),n.d(e,"I",(function(){return r})),n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"f",(function(){return l})),n.d(e,"m",(function(){return u})),n.d(e,"v",(function(){return c})),n.d(e,"k",(function(){return h})),n.d(e,"l",(function(){return d})),n.d(e,"j",(function(){return p})),n.d(e,"i",(function(){return f})),n.d(e,"g",(function(){return g})),n.d(e,"h",(function(){return m})),n.d(e,"M",(function(){return _})),n.d(e,"t",(function(){return y})),n.d(e,"A",(function(){return v})),n.d(e,"H",(function(){return b})),n.d(e,"J",(function(){return x})),n.d(e,"K",(function(){return E})),n.d(e,"u",(function(){return S})),n.d(e,"N",(function(){return C})),n.d(e,"y",(function(){return O})),n.d(e,"e",(function(){return I})),n.d(e,"q",(function(){return w})),n.d(e,"s",(function(){return L})),n.d(e,"c",(function(){return T})),n.d(e,"D",(function(){return j})),n.d(e,"p",(function(){return N})),n.d(e,"n",(function(){return M})),n.d(e,"z",(function(){return F})),n.d(e,"F",(function(){return P})),n.d(e,"G",(function(){return R})),n.d(e,"r",(function(){return D})),n.d(e,"w",(function(){return A})),n.d(e,"C",(function(){return k})),n.d(e,"x",(function(){return G})),n.d(e,"o",(function(){return B})),n.d(e,"E",(function(){return z})),n.d(e,"L",(function(){return q}));const i="SET_SELECTED_LAYER",r="UPDATE_LAYER_ORDER",s="ADD_LAYER",o="ADD_WAITING_FOR_MAP_READY_LAYER",a="CLEAR_LAYER_PROP",l="CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST",u="REMOVE_LAYER",c="SET_LAYER_VISIBILITY",h="MAP_EXTENT_CHANGED",d="MAP_READY",p="MAP_DESTROYED",f="LAYER_DATA_LOAD_STARTED",g="LAYER_DATA_LOAD_ENDED",m="LAYER_DATA_LOAD_ERROR",_="UPDATE_SOURCE_DATA_REQUEST",y="SET_JOINS",v="SET_QUERY",b="UPDATE_LAYER",x="UPDATE_LAYER_PROP",E="UPDATE_LAYER_STYLE",S="SET_LAYER_STYLE_META",C="UPDATE_SOURCE_PROP",O="SET_MOUSE_COORDINATES",I="CLEAR_MOUSE_COORDINATES",w="SET_EMBEDDABLE_SEARCH_CONTEXT",L="SET_GOTO",T="CLEAR_GOTO",j="TRACK_CURRENT_LAYER_STATE",N="ROLLBACK_TO_TRACKED_LAYER_STATE",M="REMOVE_TRACKED_LAYER_STATE",F="SET_OPEN_TOOLTIPS",P="UPDATE_DRAW_STATE",R="UPDATE_EDIT_STATE",D="SET_EXECUTION_CONTEXT",A="SET_MAP_INIT_ERROR",k="SET_WAITING_FOR_READY_HIDDEN_LAYERS",G="SET_MAP_SETTINGS",B="ROLLBACK_MAP_SETTINGS",z="TRACK_MAP_SETTINGS",q="UPDATE_MAP_SETTING"},139:function(t,e,n){"use strict";n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return g})),n.d(e,"i",(function(){return m})),n.d(e,"f",(function(){return y})),n.d(e,"g",(function(){return v})),n.d(e,"h",(function(){return x})),n.d(e,"e",(function(){return E})),n.d(e,"d",(function(){return S})),n.d(e,"a",(function(){return O}));var i=n(56),r=n(0),s=n(89),o=n(111),a=n(130),l=n(91),u=n(112),c=n(93),h=n(182),d=n(102);const p=.1;function f(t){return e=>{t.getInFlightRequestTokens().forEach((t=>{e(Object(o.a)(t))})),e({type:a.J,id:t.getId(),propName:"__dataRequests",newValue:[]})}}function g(){return(t,e)=>{Object(s.n)(e()).forEach((e=>{t(f(e))}))}}function m(t){return async(e,n)=>{const i=Object(s.l)(t,n());if(!i||Object(d.c)(i))return;const r=await i.getStyleMetaDescriptorFromLocalFeatures();r&&e({type:a.u,layerId:t,styleMeta:r})}}function _(t,e,n,i,c){var h;return{dataFilters:Object(s.c)(e()),startLoading:(e,i,r)=>t(function(t,e,n,i){return(r,l)=>{const u=Object(s.l)(t,l());u&&r(Object(o.a)(u.getPrevRequestToken(e)));const c=Object(o.c)(l());c&&c.onDataLoad&&c.onDataLoad({layerId:t,dataId:e}),r({meta:i,type:a.i,layerId:t,dataId:e,requestToken:n})}}(n,e,i,r)),stopLoading:(e,i,l,c)=>t(function(t,e,n,i,l){return(c,h)=>{c(Object(o.k)(n));const d=Object(s.d)(h(),t,e);if(d&&d.dataRequestToken!==n)throw new u.b;const p=i&&"features"in i?i.features:[],f=Object(s.l)(t,h()),g=Object(o.c)(h());if(g&&g.onDataLoadEnd){const n={};if(f&&f.getType()===r.Z.GEOJSON_VECTOR){const t=p.filter((t=>!t.properties||!t.properties[r.U]));n.featuresCount=t.length}g.onDataLoadEnd({layerId:t,dataId:e,resultMeta:n})}c({type:a.g,layerId:t,dataId:e,data:i,meta:l,requestToken:n}),c(m(t))}}(n,e,i,l,c)),onLoadError:(e,i,r)=>t(function(t,e,n,i){return async(r,s)=>{r(Object(o.k)(n));const l=Object(o.c)(s());l&&l.onDataLoadError&&l.onDataLoadError({layerId:t,dataId:e,errorMessage:i.message}),r({type:a.h,layerId:t,dataId:e,error:i,requestToken:n})}}(n,e,i,r)),setJoinError:(e,i)=>{t(function(t,e,n){return(i,r)=>{const o=Object(s.l)(t,r());if(!o||!Object(l.e)(o,"getJoins"))return;const u=o.getJoins().map((t=>t.toDescriptor()));(n||u[e].error)&&i({type:a.t,layerId:t,joins:[...u.slice(0,e),{...u[e],error:n},...u.slice(e+1)]})}}(n,e,i))},updateSourceData:e=>{t(function(t,e){return(n,i)=>{n({type:a.M,dataId:r.zb,layerId:t,newData:e}),n(m(t))}}(n,e))},isRequestStillActive:(t,i)=>{const r=Object(s.d)(e(),n,t);return!!r&&r.dataRequestToken===i},registerCancelCallback:(e,n)=>t(Object(o.g)(e,n)),forceRefreshDueToDrawing:i,isForceRefresh:c,isFeatureEditorOpenForLayer:(null===(h=Object(s.f)(e()))||void 0===h?void 0:h.layerId)===n,inspectorAdapters:Object(o.d)(e())}}function y(t){return async(e,n)=>{const i=Object(s.n)(n()).map((n=>e(b(n,t))));await Promise.all(i)}}function v(t){return async(e,n)=>{const i=_(e,n,t.getId(),!0,!1);t.isVisible()&&t.showAtZoomLevel(i.dataFilters.zoom)&&await t.syncData(i)}}function b(t,e){return async(n,i)=>{const r=_(n,i,t.getId(),!1,e);t.isVisible()&&t.showAtZoomLevel(r.dataFilters.zoom)&&await t.syncData(r)}}function x(t,e){return async(n,i)=>{const r=Object(s.l)(t,i());r&&n(b(r,e))}}function E(t){return async(e,n)=>{const i=Object(s.l)(t,n());if(i)try{const t=await i.getBounds((t=>_(e,n,t,!1,!1)));t&&await e(I(Object(c.q)(t,p)))}catch(t){return void(t instanceof u.b||console.warn("Unhandled getBounds error for layer. Only DataRequestAbortError should be surfaced",t))}}}function S(t){return async(e,n)=>{const i=Object(s.n)(n()).filter((t=>void 0===t.getParent())),r=await Object(h.a)(i,(t=>_(e,n,t,!1,!1)));null!==r?e(I(Object(c.q)(r,p))):t&&t()}}let C="";function O(){return async t=>{const e=Object(i.v4)();if(C=e,await t((async(t,e)=>{const n=Object(s.n)(e()).filter((t=>!!Object(l.e)(t,"hasJoins")&&t.hasJoins())).map((e=>t(b(e,!1))));await Promise.all(n)})),e===C){function n(){e===C&&t(y(!1))}t(S(n))}}}function I(t){return{type:a.s,bounds:t}}},142:function(t,e,n){"use strict";n.d(e,"b",(function(){return j})),n.d(e,"a",(function(){return es_pew_pew_source_ESPewPewSource}));var i=n(6),r=n.n(i),s=n(2),o=n(166),a=n.n(o),l=n(101),u=n(58),c=n(1),h=n(3),d=n(14),p=n(54),f=n(28),g=n(174),m=n(5),_=n(4);class update_source_editor_UpdateSourceEditor extends s.Component{constructor(...t){super(...t),r()(this,"_isMounted",!1),r()(this,"state",{fields:[]}),r()(this,"_onMetricsChange",(t=>{this.props.onChange({propName:"metrics",value:t})}))}componentDidMount(){this._isMounted=!0,this._loadFields()}componentWillUnmount(){this._isMounted=!1}async _loadFields(){let t;try{t=await Object(m.w)().get(this.props.indexPatternId)}catch(t){return}this._isMounted&&this.setState({fields:t.fields.filter((t=>!f.indexPatterns.isNestedField(t)))})}render(){return Object(_.jsx)(s.Fragment,null,Object(_.jsx)(d.EuiPanel,null,Object(_.jsx)(d.EuiTitle,{size:"xs"},Object(_.jsx)("h6",null,Object(_.jsx)(p.FormattedMessage,{id:"xpack.maps.source.pewPew.metricsLabel",defaultMessage:"Metrics"}))),Object(_.jsx)(d.EuiSpacer,{size:"m"}),Object(_.jsx)(g.a,{allowMultipleMetrics:!0,bucketsName:this.props.bucketsName,isJoin:!1,fields:this.state.fields,metrics:this.props.metrics,onChange:this._onMetricsChange})),Object(_.jsx)(d.EuiSpacer,{size:"s"}))}}var y=n(0),v=n(92),b=n(53),x=n.n(b),E=n(93);const S=["key","sourceCentroid"];function C(t){const e=t.split(","),n=parseFloat(e[0]);return[parseFloat(e[1]),n]}var O=n(122),I=n(112),w=n(126),L=n(117),T=n(106);const j=h.i18n.translate("xpack.maps.source.pewPewTitle",{defaultMessage:"Point to point"});class es_pew_pew_source_ESPewPewSource extends O.a{static createDescriptor(t){const e=O.a.createDescriptor(t);if(!Object(L.a)(t.sourceGeoField))throw new Error("Cannot create ESPewPewSourceDescriptor, sourceGeoField is not provided");if(!Object(L.a)(t.destGeoField))throw new Error("Cannot create ESPewPewSourceDescriptor, destGeoField is not provided");return{...e,type:y.Cb.ES_PEW_PEW,sourceGeoField:t.sourceGeoField,destGeoField:t.destGeoField}}constructor(t){super(t),r()(this,"_descriptor",void 0),this._descriptor=t}getBucketsName(){return h.i18n.translate("xpack.maps.source.pewPew.bucketsName",{defaultMessage:"paths"})}renderSourceSettingsEditor({onChange:t}){return Object(_.jsx)(update_source_editor_UpdateSourceEditor,{bucketsName:this.getBucketsName(),indexPatternId:this.getIndexPatternId(),onChange:t,metrics:this._descriptor.metrics})}isFilterByMapBounds(){return!0}supportsJoins(){return!1}getSyncMeta(t){return{...super.getSyncMeta(t),geogridPrecision:this.getGeoGridPrecision(t.zoom)}}isGeoGridPrecisionAware(){return!0}async getSupportedShapeTypes(){return[y.Hb.LINE]}async getImmutableProperties(){return[{label:Object(v.a)(),value:j},{label:Object(v.b)(),value:await this.getDisplayName()},{label:h.i18n.translate("xpack.maps.source.pewPew.sourceGeoFieldLabel",{defaultMessage:"Source"}),value:this._descriptor.sourceGeoField},{label:h.i18n.translate("xpack.maps.source.pewPew.destGeoFieldLabel",{defaultMessage:"Destination"}),value:this._descriptor.destGeoField}]}getGeoGridPrecision(t){const e=Math.ceil(t)+2;return Math.min(e,29)}async getGeoJsonWithMeta(t,e,n,i,r){const s=await this.getIndexPattern(),o=await this.makeSearchSource(e,0);o.setField("trackTotalHits",!1),o.setField("aggs",{destSplit:{terms:{script:{source:`doc['${this._descriptor.destGeoField}'].value.toString()`,lang:"painless"},order:{_count:"desc"},size:100},aggs:{sourceGrid:{geotile_grid:{field:this._descriptor.sourceGeoField,precision:this.getGeoGridPrecision(e.zoom),size:500},aggs:{sourceCentroid:{geo_centroid:{field:this._descriptor.sourceGeoField}},...this.getValueAggsDsl(s)}}}}}),o.setField("filter",[...o.getField("filter"),Object(u.buildExistsFilter)({name:this._descriptor.sourceGeoField,type:"geo_point"},s)]);const a=[],l=await this._runEsQuery({requestId:this.getId(),requestName:Object(T.b)(t),searchSource:o,registerCancelCallback:n,searchSessionId:e.searchSessionId,executionContext:Object(w.b)({description:"es_pew_pew_source:connections"},e.executionContext),requestsAdapter:r.requests,onWarning:t=>{a.push(t)}}),{featureCollection:c}=function(t){const e=[],n=x.a.get(t,"aggregations.destSplit.buckets",[]);for(let t=0;t<n.length;t++){const i=n[t],r=C(i.key),s=x.a.get(i,"sourceGrid.buckets",[]);for(let t=0;t<s.length;t++){const n=s[t],i=n.sourceCentroid;e.push({type:"Feature",geometry:{type:"LineString",coordinates:[[i.location.lon,i.location.lat],r]},id:`${r.join()},${n.key}`,properties:Object(E.j)(n,S)})}}return{featureCollection:{type:"FeatureCollection",features:e}}}(l);return{data:c,meta:{areResultsTrimmed:!1,warnings:a}}}getGeoFieldName(){return this._descriptor.destGeoField}async getBoundsForFilters(t,e){const n=await this.makeSearchSource(t,0);n.setField("trackTotalHits",!1),n.setField("aggs",{destFitToBounds:{geo_bounds:{field:this._descriptor.destGeoField}},sourceFitToBounds:{geo_bounds:{field:this._descriptor.sourceGeoField}}});const i=[];try{var r,s;const o=new AbortController;e((()=>o.abort()));const{rawResponse:a}=await Object(c.lastValueFrom)(n.fetch$({abortSignal:o.signal,legacyHitsTotal:!1,executionContext:Object(w.b)({description:"es_pew_pew_source:bounds"},t.executionContext)})),l=(null===(r=a.aggregations)||void 0===r?void 0:r.destFitToBounds).bounds;l&&(i.push([l.top_left.lon,l.top_left.lat]),i.push([l.bottom_right.lon,l.bottom_right.lat]));const u=(null===(s=a.aggregations)||void 0===s?void 0:s.sourceFitToBounds).bounds;u&&(i.push([u.top_left.lon,u.top_left.lat]),i.push([u.bottom_right.lon,u.bottom_right.lat]))}catch(t){if("AbortError"===t.name)throw new I.b;return null}return 0===i.length?null:Object(E.r)(a()(Object(l.multiPoint)(i)))}hasTooltipProperties(){return!0}}},155:function(t,e,n){"use strict";n.d(e,"a",(function(){return EMSFileSelect}));var i=n(6),r=n.n(i),s=n(2),o=n(14),a=n(3),l=n(95),u=n(121),c=n(4);class EMSFileSelect extends s.Component{constructor(...t){super(...t),r()(this,"_isMounted",!1),r()(this,"state",{hasLoadedOptions:!1,emsFileOptions:[]}),r()(this,"_loadFileOptions",(async()=>{let t=[];try{t=await Object(l.getEmsFileLayers)()}catch(t){this._isMounted&&this.setState({hasLoadedOptions:!0,emsFileOptions:[]})}const e=t.map((t=>({value:t.getId(),label:t.getDisplayName()})));this._isMounted&&this.setState({hasLoadedOptions:!0,emsFileOptions:e})})),r()(this,"_onChange",(t=>{0!==t.length&&this.props.onChange(t[0].value)}))}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0,this._loadFileOptions()}_renderSelect(){if(!this.state.hasLoadedOptions)return Object(c.jsx)(o.EuiSelect,{isLoading:!0});const t=this.state.emsFileOptions.find((t=>t.value===this.props.value));return Object(c.jsx)(o.EuiComboBox,{placeholder:a.i18n.translate("xpack.maps.emsFileSelect.selectPlaceholder",{defaultMessage:"Select EMS boundaries"}),options:this.state.emsFileOptions,selectedOptions:t?[t]:[],onChange:this._onChange,isClearable:!1,singleSelection:!0,isDisabled:0===this.state.emsFileOptions.length,"data-test-subj":"emsFileSelect"})}render(){return Object(c.jsx)(o.EuiFormRow,{label:a.i18n.translate("xpack.maps.source.emsFileSelect.selectLabel",{defaultMessage:"EMS boundaries"}),helpText:0===this.state.emsFileOptions.length?Object(u.a)():null,display:this.props.isColumnCompressed?"columnCompressed":"row"},this._renderSelect())}}},159:function(t,e,n){"use strict";n.d(e,"b",(function(){return O})),n.d(e,"a",(function(){return ems_file_source_EMSFileSource}));var i=n(2),r=n.n(i),s=n(3),o=n(91),a=n(6),l=n.n(a),u=n(14),c=n(155),h=n(4);class create_source_editor_EMSFileCreateSourceEditor extends i.Component{constructor(...t){super(...t),l()(this,"state",{emsFileId:null}),l()(this,"_onChange",(t=>{this.setState({emsFileId:t}),this.props.onSourceConfigChange({id:t})}))}render(){return Object(h.jsx)(u.EuiPanel,null,Object(h.jsx)(c.a,{value:this.state.emsFileId,onChange:this._onChange}))}}var d=n(106),p=n(0),f=n(95),g=n(92),m=n(54),_=n(162);function y(t){const[e,n]=Object(i.useState)(!1),[s,o]=Object(i.useState)([]);return Object(i.useEffect)((()=>{let e=!1;return n(!0),t.source.getFields().then((t=>{e||(o(t),n(!1))})).catch((t=>{e||n(!1)})),()=>{e=!0}}),[]),Object(h.jsx)(r.a.Fragment,null,Object(h.jsx)(u.EuiPanel,null,Object(h.jsx)(u.EuiTitle,{size:"xs"},Object(h.jsx)("h5",null,Object(h.jsx)(m.FormattedMessage,{id:"xpack.maps.emsSource.tooltipsTitle",defaultMessage:"Tooltip fields"}))),Object(h.jsx)(u.EuiSpacer,{size:"m"}),Object(h.jsx)(u.EuiSkeletonText,{isLoading:e},Object(h.jsx)(_.a,{tooltipFields:t.tooltipFields,onChange:e=>{t.onChange({propName:"tooltipProperties",value:e})},fields:s}))),Object(h.jsx)(u.EuiSpacer,{size:"s"}))}var v=n(169);class ems_file_field_EMSFileField extends v.a{constructor({fieldName:t,source:e,origin:n}){super({fieldName:t,origin:n}),l()(this,"_source",void 0),this._source=e}supportsFieldMetaFromEs(){return!1}supportsFieldMetaFromLocalData(){return!0}getSource(){return this._source}async getLabel(){return this._source.getEmsFieldLabel(this.getName())}}var b=n(5),x=n(121),E=n(24);function S(t){return s.i18n.translate("xpack.maps.source.emsFile.unableToFindFileIdErrorMessage",{defaultMessage:"Unable to find EMS vector shapes for id: {id}. {info}",values:{id:t,info:Object(x.a)()}})}function C(){return Object(b.m)().isEMSUrlSet()?s.i18n.translate("xpack.maps.source.emsOnPremFileTitle",{defaultMessage:"Elastic Maps Server Boundaries"}):s.i18n.translate("xpack.maps.source.emsFileTitle",{defaultMessage:"EMS Boundaries"})}class ems_file_source_EMSFileSource extends d.a{static createDescriptor({id:t,tooltipProperties:e=[]}){return{type:p.Cb.EMS_FILE,id:t,tooltipProperties:e}}constructor(t){super(ems_file_source_EMSFileSource.createDescriptor(t)),l()(this,"_tooltipFields",void 0),l()(this,"_descriptor",void 0),l()(this,"getValueSuggestions",(async(t,e)=>{const n=await this._getFieldValues(t.getName());return e.length?n.filter((t=>t.toLowerCase().includes(e.toLowerCase()))):n})),this._descriptor=ems_file_source_EMSFileSource.createDescriptor(t),this._tooltipFields=this._descriptor.tooltipProperties.map((t=>this.getFieldByName(t)))}renderSourceSettingsEditor({onChange:t}){return Object(h.jsx)(y,{onChange:t,tooltipFields:this._tooltipFields,layerId:this._descriptor.id,source:this})}async getEMSFileLayer(){let t;try{t=await Object(f.getEmsFileLayers)()}catch(t){throw new Error(`${S(this._descriptor.id)} - ${t.message}`)}const e=t.find((t=>t.hasId(this._descriptor.id)));if(e)return e;throw new Error(S(this._descriptor.id))}async getEmsFieldLabel(t){const e=(await this.getEMSFileLayer()).getFieldsInLanguage().find((e=>e.name===t));return e?e.description:t}async getGeoJsonWithMeta(){try{const t=await this.getEMSFileLayer(),e=await t.getGeoJson();if(!e)throw new Error("No features found");const n=t.getFields().find((t=>"id"===t.type));return e.features.forEach(((t,e)=>{t.id=n?t.properties[n.id]:e})),{data:e,meta:{}}}catch(t){throw new Error(S(this._descriptor.id))}}async getImmutableProperties(){let t;try{t=(await this.getEMSFileLayer()).getEMSHotLink()}catch(t){}const e=[{label:Object(g.a)(),value:C()},{label:s.i18n.translate("xpack.maps.source.emsFile.layerLabel",{defaultMessage:"Layer"}),value:this._descriptor.id,link:t}],n=Object(b.m)();return n.isEMSUrlSet()&&e.push({label:s.i18n.translate("xpack.maps.source.emsFile.emsOnPremLabel",{defaultMessage:"Elastic Maps Server"}),value:n.getEMSRoot()}),e}async getDisplayName(){try{return(await this.getEMSFileLayer()).getDisplayName()}catch(t){return this._descriptor.id}}getAttributionProvider(){return async()=>(await this.getEMSFileLayer()).getAttributions()}async getFields(){return(await this.getEMSFileLayer()).getFieldsInLanguage().map((t=>this.getFieldByName(t.name)))}getFieldByName(t){return new ems_file_field_EMSFileField({fieldName:t,source:this,origin:p.D.SOURCE})}async getLeftJoinFields(){return this.getFields()}hasTooltipProperties(){return this._tooltipFields.length>0}async getTooltipProperties(t){const e=this._tooltipFields.map((e=>{const n=t[e.getName()];return e.createTooltipProperty(n)}));return Promise.all(e)}async getSupportedShapeTypes(){return[p.Hb.POLYGON]}async getLicensedFeatures(){return Object(b.m)().isEMSUrlSet()?[E.a.ON_PREM_EMS]:[]}async _getFieldValues(t){try{var e;const n=await this.getEMSFileLayer(),i=n.getFields().find((({id:e})=>e===t));if(null!=i&&null!==(e=i.values)&&void 0!==e&&e.length)return i.values;const r=new Set,s=await n.getGeoJson();return null==s||s.features.forEach((e=>{e.properties&&t in e.properties&&null!=e.properties[t]&&r.add(e.properties[t].toString())})),Array.from(r)}catch(t){return[]}}}const O={id:p.Jb.EMS_BOUNDARIES,order:10,categories:[p.ab.REFERENCE],checkVisibility:async()=>Object(b.m)().isIncludeElasticMapsService(),description:function(){const t=Object(b.m)();return s.i18n.translate("xpack.maps.source.emsFileSourceDescription",{defaultMessage:"Administrative boundaries from {host}",values:{host:t.isEMSUrlSet()?t.getEMSRoot():"Elastic Maps Service"}})}(),disabledReason:s.i18n.translate("xpack.maps.source.emsFileDisabledReason",{defaultMessage:"Elastic Maps Server requires an Enterprise license"}),getIsDisabled:()=>{const t=Object(b.m)();return t.isEMSUrlSet()&&!t.hasOnPremLicense()},icon:()=>Object(h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(h.jsx)("path",{className:"mapLayersWizardIcon__backgroundDarker",d:"M30.766 14.01l1.602-12.954-1.389.237c-.744.253-1.768.38-2.702.45a43.28 43.28 0 01-1.259.07l-.092.004c-.312.014-.57.026-.72.042a1.895 1.895 0 00-.558.168c-.156.07-.316.156-.47.238l-.057.03c-.356.191-.687.358-1.025.4l-1.308.339v5.863c0 .698.142 2.17 0 3.443l-.204 1.67h8.182zM20.871 2.748c-.656.039-1.247.282-2.06.4l-.702.102c-.583.086-1.16.172-1.693.238-.75.093-1.389.145-1.82.113-.592-.044-1.124.341-1.61.843-.453.467-.926 1.1-1.429 1.777l-.144.193c-1.132 1.517-2.452 3.218-4.22 4.101-.214.108-.346.313-.432.528-.087.22-.14.489-.172.78-.064.587-.047 1.325.007 2.083.071 1.01.211 2.102.32 2.956.054.42.1.783.128 1.05.08.78-.128 1.769-.37 2.653-.088.319-.178.616-.258.882-.03.1-.06.195-.086.285a9.67 9.67 0 00-.12.434 1.518 1.518 0 00-.054.334c0 .279.11.577.283.842.175.268.426.52.735.708l.067.04.079-.001c4.133-.068 10.22-.554 10.972-.638a.582.582 0 00.334-.17c.083-.08.157-.182.224-.293.134-.223.264-.524.388-.867.249-.69.495-1.6.72-2.52.162-.654.545-1.41.683-2.01l.784-2.796c.066-.379.198-1.13.272-1.705.146-1.148-.01-2.54.097-3.999.107-1.458.171-2.917.146-4.052a10.13 10.13 0 00-.112-1.438 2.469 2.469 0 00-.131-.495c-.053-.128-.276-.358-.276-.358h-.55zm10.931 12.621s-1.169-.652-1.548-.642c-.757.019-1.298-.026-2.352 0h-5.489l-2.863 8.915c.2.066 1.938.444 2.242.447.62.005 1.478-.08 2.393-.197.88-.113 1.824-.258 2.678-.389l.113-.017a49.753 49.753 0 012.166-.305c.347-.034.996-.024 1.858-.007l.127.003c.827.017 1.819.037 2.869.023 2.198-.029 4.694-.204 6.5-.887 1.42-.538 2.099-.87 2.513-1.34.414-.468.575-1.576.575-1.576s-2.907.868-4.807.784c-.927-.04-1.508.045-2.352-.34-1.429-.652-1.206-2.221-2.43-3.205-.77-.62-2.193-1.267-2.193-1.267z"}),Object(h.jsx)("path",{className:"mapLayersWizardIcon__backgroundDarker",d:"M33.322 1.125S31.277 14.3 31.72 14.522c.786.393 2.012.665 3.137 1.67 1.23 1.1 1.172 2.5 2.318 3.24.835.538 6.525-.704 6.525-.704l.228-7.956s-.174-4.5-.89-5.216c-.715-.716-2.488-1.125-3-2.08-1.115-2.08-3.068-2.351-3.068-2.351h-3.648z"})),renderWizard:({previewLayers:t,mapColors:e})=>Object(h.jsx)(create_source_editor_EMSFileCreateSourceEditor,{onSourceConfigChange:n=>{const i=ems_file_source_EMSFileSource.createDescriptor(n),r=o.b.createDescriptor({sourceDescriptor:i},e);t([r])}}),title:C()}},160:function(t,e,n){"use strict";n.d(e,"a",(function(){return heatmap_layer_HeatmapLayer}));var i=n(6),r=n.n(i),s=n(132),o=n(2),a=n.n(o),l=n(14),u=n(99),c=n(3);const h=c.i18n.translate("xpack.maps.heatmap.colorRampLabel",{defaultMessage:"Color range"});var d=n(4);function p({colorRampName:t,onHeatmapColorChange:e}){return Object(d.jsx)(l.EuiFormRow,{label:h,display:"rowCompressed"},Object(d.jsx)(l.EuiColorPalettePicker,{palettes:u.e,onChange:t=>{e({colorRampName:t})},valueOfSelected:t,compressed:!0}))}const f=({colorPaletteId:t})=>{const e=Object(u.f)(t);return e.length?Object(d.jsx)("div",{className:"mapColorGradient",style:{background:Object(u.h)(e)}}):null};var g=n(240),m=n(239);class heatmap_legend_HeatmapLegend extends o.Component{constructor(...t){super(...t),r()(this,"_isMounted",!1),r()(this,"state",{label:""})}componentDidUpdate(){this._loadLabel()}componentDidMount(){this._isMounted=!0,this._loadLabel()}componentWillUnmount(){this._isMounted=!1}async _loadLabel(){const t=await this.props.field.getLabel();this._isMounted&&this.state.label!==t&&this.setState({label:t})}render(){const t=Object(d.jsx)(g.a,{header:Object(d.jsx)(f,{colorPaletteId:this.props.colorRampName}),minLabel:c.i18n.translate("xpack.maps.heatmapLegend.coldLabel",{defaultMessage:"cold"}),maxLabel:c.i18n.translate("xpack.maps.heatmapLegend.hotLabel",{defaultMessage:"hot"}),propertyLabel:h,fieldLabel:this.state.label,invert:!1});let e;if("getMask"in this.props.field){const t=this.props.field.getMask();t&&(e=Object(d.jsx)(m.a,{esAggField:this.props.field,operator:t.operator,value:t.value}))}return e?Object(d.jsx)(a.a.Fragment,null,e,t):t}}var _=n(0);class heatmap_style_HeatmapStyle{constructor(t={colorRampName:u.c}){r()(this,"_descriptor",void 0),this._descriptor=heatmap_style_HeatmapStyle.createDescriptor(t.colorRampName)}static createDescriptor(t){return{type:_.Y.HEATMAP,colorRampName:t||u.c}}getType(){return _.Y.HEATMAP}renderEditor(t){return Object(d.jsx)(p,{colorRampName:this._descriptor.colorRampName,onHeatmapColorChange:({colorRampName:e})=>{const n=heatmap_style_HeatmapStyle.createDescriptor(e);t(n)}})}renderLegendDetails(t){return Object(d.jsx)(heatmap_legend_HeatmapLegend,{colorRampName:this._descriptor.colorRampName,field:t})}getIcon(){return Object(d.jsx)(l.EuiIcon,{size:"m",type:"heatmap"})}setMBPaintProperties({mbMap:t,layerId:e,propertyName:n,max:i,resolution:r}){let s;s=r===_.L.COARSE?128:r===_.L.FINE?64:r===_.L.MOST_FINE?32:8,t.setPaintProperty(e,"heatmap-radius",s),i<=0?t.setPaintProperty(e,"heatmap-weight",0):t.setPaintProperty(e,"heatmap-weight",["/",["get",n],i]);const o=Object(u.i)(this._descriptor.colorRampName,.1,1,!1);o&&t.setPaintProperty(e,"heatmap-color",["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",...o])}}var y=n(103),v=n(91),b=n(242),x=n(133),E=n(129);class heatmap_layer_HeatmapLayer extends s.a{static createDescriptor(t){const e=super.createDescriptor(t);return e.type=_.Z.HEATMAP,e.style=heatmap_style_HeatmapStyle.createDescriptor(),e}constructor({layerDescriptor:t,source:e}){if(super({layerDescriptor:t,source:e}),r()(this,"_style",void 0),t.style)this._style=new heatmap_style_HeatmapStyle(t.style);else{const t=heatmap_style_HeatmapStyle.createDescriptor();this._style=new heatmap_style_HeatmapStyle(t)}}_isTiled(){return!0}getLayerIcon(t){const{docCount:e}=Object(x.e)(this._getTileMetaFeatures());return 0===e?v.d:super.getLayerIcon(t)}getSource(){return super.getSource()}getStyleForEditing(){return this._style}getStyle(){return this._style}getCurrentStyle(){return this._style}_getHeatmapLayerId(){return this.makeMbLayerId("heatmap")}getMbLayerIds(){return[this._getHeatmapLayerId()]}ownsMbLayerId(t){return this._getHeatmapLayerId()===t}ownsMbSourceId(t){return this.getId()===t}async syncData(t){await Object(v.h)({buffer:0,hasLabels:!1,layerId:this.getId(),layerName:await this.getDisplayName(),prevDataRequest:this.getSourceDataRequest(),requestMeta:Object(b.a)(this.getSource(),[],t.dataFilters,this.getQuery(),t.isForceRefresh,t.isFeatureEditorOpenForLayer),source:this.getSource(),syncContext:t})}_requiresPrevSourceCleanup(t){var e;const n=t.getSource(this.getMbSourceId());if(!n)return!1;const i=this.getSourceDataRequest();if(!i)return!1;const r=i.getData();return!!r&&(null===(e=n.tiles)||void 0===e?void 0:e[0])!==r.tileUrl}syncLayerWithMB(t){this._removeStaleMbSourcesAndLayers(t);const e=this.getSourceDataRequest(),n=e?e.getData():void 0;if(!n)return;const i=this.getMbSourceId();t.getSource(i)||t.addSource(i,{type:"vector",tiles:[n.tileUrl],minzoom:n.tileMinZoom,maxzoom:n.tileMaxZoom});const r=this._getHeatmapLayerId();t.getLayer(r)||t.addLayer({id:r,type:"heatmap",source:i,"source-layer":n.tileSourceLayer,paint:{}});const s=this.getSource().getMetricFields();if(!s.length)return;const o=s[0],a=this._requiresPrevSourceCleanup(t)?[]:this._getTileMetaFeatures();let l=0;for(let t=0;t<a.length;t++){const e=o.pluckRangeFromTileMetaFeature(a[t]);e&&(l=Math.max(e.max,l))}this.getCurrentStyle().setMBPaintProperties({mbMap:t,layerId:r,propertyName:o.getMbFieldName(),max:l,resolution:this.getSource().getGridResolution()}),this.syncVisibilityWithMb(t,r),t.setPaintProperty(r,"heatmap-opacity",this.getAlpha());const u=o.getMask();if(u){const e=new E.d({esAggField:o,isGeometrySourceMvt:!0,...u});t.setFilter(r,e.getMatchUnmaskedExpression())}t.setLayerZoomRange(r,this.getMinZoom(),this.getMaxZoom())}getLayerTypeIconName(){return"heatmap"}async getFields(){return this.getSource().getFields()}async hasLegendDetails(){return!0}renderLegendDetails(){const t=this.getSource().getMetricFields();return this.getCurrentStyle().renderLegendDetails(t[0])}async getBounds(t){return await Object(v.g)({layerId:this.getId(),syncContext:t(this.getId()),source:this.getSource(),sourceQuery:this.getQuery()})}async isFilteredByGlobalTime(){return this.getSource().getApplyGlobalTime()&&await this.getSource().isTimeAware()}getIndexPatternIds(){const t=this.getSource();return Object(y.b)(t,"getIndexPatternId")?[t.getIndexPatternId()]:[]}getQueryableIndexPatternIds(){const t=this.getSource();return t.getApplyGlobalQuery()&&Object(y.b)(t,"getIndexPatternId")?[t.getIndexPatternId()]:[]}async getLicensedFeatures(){return await this.getSource().getLicensedFeatures()}}},161:function(t,e,n){"use strict";n.d(e,"a",(function(){return E}));var i=n(2),r=n(3),s=n(98),o=n(91),a=n(142),l=n(100),u=n(0),c=n(99),h=n(6),d=n.n(h),p=n(53),f=n.n(p),g=n(108),m=n(5),_=n(54),y=n(14),v=n(97),b=n(92),x=n(4);class create_source_editor_CreateSourceEditor extends i.Component{constructor(...t){super(...t),d()(this,"state",{isLoadingIndexPattern:!1,indexPattern:void 0,indexPatternId:void 0,sourceGeoField:void 0,destGeoField:void 0,indexPatternHasMultipleGeoFields:!1}),d()(this,"onIndexPatternSelect",(t=>{this.setState({indexPatternId:t},this.loadIndexPattern.bind(null,t))})),d()(this,"loadIndexPattern",(t=>{this.setState({isLoadingIndexPattern:!0,indexPattern:void 0,sourceGeoField:void 0,destGeoField:void 0,indexPatternHasMultipleGeoFields:!1},this.debouncedLoad.bind(null,t))})),d()(this,"debouncedLoad",f.a.debounce((async t=>{if(!t||0===t.length)return;let e;try{e=await Object(m.w)().get(t)}catch(t){return}if(!this._isMounted)return;if(this.state.indexPatternId!==t)return;const n=Object(v.a)(e.fields);this.setState({isLoadingIndexPattern:!1,indexPattern:e,indexPatternHasMultipleGeoFields:n.length>=2})}),300)),d()(this,"_onSourceGeoSelect",(t=>{this.setState({sourceGeoField:t},this.previewLayer)})),d()(this,"_onDestGeoSelect",(t=>{this.setState({destGeoField:t},this.previewLayer)})),d()(this,"previewLayer",(()=>{const{indexPatternId:t,sourceGeoField:e,destGeoField:n}=this.state,i=t&&e&&n?{indexPatternId:t,sourceGeoField:e,destGeoField:n}:null;this.props.onSourceConfigChange(i)}))}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0}_renderGeoSelects(){if(!this.state.indexPattern||!this.state.indexPatternHasMultipleGeoFields)return null;const t=this.state.indexPattern?Object(v.a)(this.state.indexPattern.fields):void 0;return Object(x.jsx)(i.Fragment,null,Object(x.jsx)(y.EuiFormRow,{label:r.i18n.translate("xpack.maps.source.pewPew.sourceGeoFieldLabel",{defaultMessage:"Source"})},Object(x.jsx)(g.a,{placeholder:r.i18n.translate("xpack.maps.source.pewPew.sourceGeoFieldPlaceholder",{defaultMessage:"Select source geo field"}),value:this.state.sourceGeoField,onChange:this._onSourceGeoSelect,fields:t})),Object(x.jsx)(y.EuiFormRow,{label:r.i18n.translate("xpack.maps.source.pewPew.destGeoFieldLabel",{defaultMessage:"Destination"})},Object(x.jsx)(g.a,{placeholder:r.i18n.translate("xpack.maps.source.pewPew.destGeoFieldPlaceholder",{defaultMessage:"Select destination geo field"}),value:this.state.destGeoField,onChange:this._onDestGeoSelect,fields:t})))}_renderIndexPatternSelect(){const t=Object(m.v)();return Object(x.jsx)(y.EuiFormRow,{label:Object(b.b)()},Object(x.jsx)(t,{indexPatternId:this.state.indexPatternId,onChange:this.onIndexPatternSelect,placeholder:Object(b.d)(),fieldTypes:[u.A.GEO_POINT]}))}render(){let t;return this.state.indexPattern&&!this.state.indexPatternHasMultipleGeoFields&&(t=Object(x.jsx)(y.EuiCallOut,{color:"warning"},Object(x.jsx)("p",null,Object(x.jsx)(_.FormattedMessage,{id:"xpack.maps.source.pewPew.noSourceAndDestDetails",defaultMessage:"Selected data view does not contain source and destination fields."})))),Object(x.jsx)(y.EuiPanel,null,t,this._renderIndexPatternSelect(),this._renderGeoSelects())}}const E={id:u.Jb.POINT_2_POINT,order:10,categories:[u.ab.ELASTICSEARCH],description:r.i18n.translate("xpack.maps.source.pewPewDescription",{defaultMessage:"Aggregated data paths between the source and destination"}),icon:()=>Object(x.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(x.jsx)("circle",{cx:"38.311",cy:"12.889",r:"1.636",className:"mapLayersWizardIcon__highlight"}),Object(x.jsx)("circle",{cx:"10.85",cy:"15.12",r:"1.636",className:"mapLayersWizardIcon__highlight",transform:"rotate(-27.34 10.85 15.12)"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M10.746 14.918l12.499-3.892.162.521-12.499 3.892z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M10.746 14.918l12.499-3.892.162.521-12.499 3.892z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M10.746 14.918l12.499-3.892.162.521-12.499 3.892z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M10.746 14.918l12.499-3.892.162.521-12.499 3.892z"}),Object(x.jsx)("circle",{cx:"6.805",cy:"4.603",r:"1.636",className:"mapLayersWizardIcon__highlight",transform:"rotate(-23.178 6.805 4.603)"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M6.27 4.194l17.235 5.888-.176.516L6.094 4.71z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M6.27 4.194l17.235 5.888-.176.516L6.094 4.71z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M6.27 4.194l17.235 5.888-.176.516L6.094 4.71z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M6.27 4.194l17.235 5.888-.176.516L6.094 4.71z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M22.8 9.673l16.113 2.854-.095.538-16.113-2.855z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M22.8 9.673l16.113 2.854-.095.538-16.113-2.855z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M22.8 9.673l16.113 2.854-.095.538-16.113-2.855z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M22.8 9.673l16.113 2.854-.095.538-16.113-2.855z"}),Object(x.jsx)("circle",{cx:"19.542",cy:"22.262",r:"1.636",className:"mapLayersWizardIcon__highlight",transform:"rotate(8.84 19.542 22.262)"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M19.28 22.43l4.937-12.124.505.206-4.937 12.124z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M19.28 22.43l4.937-12.124.505.206-4.937 12.124z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M19.28 22.43l4.937-12.124.505.206-4.937 12.124z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M19.28 22.43l4.937-12.124.505.206-4.937 12.124z"}),Object(x.jsx)("circle",{cx:"42.691",cy:"3.795",r:"1.636",className:"mapLayersWizardIcon__highlight",transform:"rotate(-6.89 42.691 3.795)"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M42.715 3.993l-18.251 7.243-.202-.507 18.252-7.243z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M42.715 3.993l-18.251 7.243-.202-.507 18.252-7.243z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M42.715 3.993l-18.251 7.243-.202-.507 18.252-7.243z"}),Object(x.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M42.715 3.993l-18.251 7.243-.202-.507 18.252-7.243z"}),Object(x.jsx)("circle",{cx:"24.578",cy:"11.109",r:"2.727",className:"mapLayersWizardIcon__highlight"})),renderWizard:({previewLayers:t})=>Object(x.jsx)(create_source_editor_CreateSourceEditor,{onSourceConfigChange:e=>{if(!e)return void t([]);const n=Object(s.i)(),i=o.b.createDescriptor({sourceDescriptor:a.a.createDescriptor(e),style:l.a.createDescriptor({[u.Ib.LINE_COLOR]:{type:u.Eb.DYNAMIC,options:{...n[u.Ib.LINE_COLOR].options,field:{name:u.k,origin:u.D.SOURCE},color:c.e[0].value}},[u.Ib.LINE_WIDTH]:{type:u.Eb.DYNAMIC,options:{...n[u.Ib.LINE_WIDTH].options,field:{name:u.k,origin:u.D.SOURCE}}}})});t([i])}}),title:a.b}},165:function(t,e,n){"use strict";n.d(e,"l",(function(){return u})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return h})),n.d(e,"f",(function(){return d})),n.d(e,"j",(function(){return p})),n.d(e,"i",(function(){return f})),n.d(e,"k",(function(){return g})),n.d(e,"b",(function(){return m})),n.d(e,"e",(function(){return _})),n.d(e,"d",(function(){return y})),n.d(e,"c",(function(){return v})),n.d(e,"a",(function(){return b})),n.d(e,"p",(function(){return x})),n.d(e,"A",(function(){return E})),n.d(e,"r",(function(){return S})),n.d(e,"w",(function(){return C})),n.d(e,"o",(function(){return O})),n.d(e,"y",(function(){return I})),n.d(e,"x",(function(){return w})),n.d(e,"z",(function(){return L})),n.d(e,"q",(function(){return T})),n.d(e,"v",(function(){return j})),n.d(e,"s",(function(){return N})),n.d(e,"n",(function(){return M})),n.d(e,"u",(function(){return F})),n.d(e,"t",(function(){return P})),n.d(e,"m",(function(){return R}));var i=n(94),r=n(110),s=n(210),o=n(190),a=n(0),l=n(130);const u="UPDATE_FLYOUT",c="SET_IS_LAYER_TOC_OPEN",h="SET_IS_TIME_SLIDER_OPEN",d="SET_FULL_SCREEN",p="SET_READ_ONLY",f="SET_OPEN_TOC_DETAILS",g="SHOW_TOC_DETAILS",m="HIDE_TOC_DETAILS",_="SET_DRAW_MODE",y="SET_AUTO_OPEN_WIZARD_ID",v="PUSH_DELETED_FEATURE_ID",b="CLEAR_DELETED_FEATURE_IDS";function x(){return{type:d,isFullScreen:!1}}function E(t){return{type:u,display:t}}function S(){return(t,e)=>{Object(i.d)(e())!==r.c.MAP_SETTINGS_PANEL&&(t(Object(o.v)(null)),t(Object(s.r)()),t(E(r.c.MAP_SETTINGS_PANEL)))}}function C(t){return{type:c,isLayerTOCOpen:t}}function O(){return{type:d,isFullScreen:!0}}function I(t){return{type:p,isReadOnly:t}}function w(t){return{type:f,layerIds:t}}function L(t){return(e,n)=>{Object(i.i)(n()).includes(t)||e({type:g,layerId:t})}}function T(t){return{type:m,layerId:t}}function j(t){return e=>{t===a.x.NONE&&e({type:l.G,editState:void 0}),e({type:_,drawMode:t})}}function N(){return{type:h,isTimesliderOpen:!0}}function M(){return t=>{t({type:h,isTimesliderOpen:!1}),t(Object(s.q)({clearTimeslice:!0}))}}function F(t){return e=>{e(Object(o.v)(null)),e(E(r.c.ADD_LAYER_WIZARD)),e(j(a.x.NONE)),e({type:y,autoOpenLayerWizardId:t})}}function P(t){return{type:v,featureId:t}}function R(){return{type:b}}},172:function(t,e,n){"use strict";function i({attributes:t,references:e=[]}){if(!t.layerListJSON)return{attributes:t,references:e};const n=[];if(t.mapStateJSON)try{const e=JSON.parse(t.mapStateJSON);e.adHocDataViews&&e.adHocDataViews.length>0&&e.adHocDataViews.forEach((t=>{t.id&&n.push(t.id)}))}catch(t){throw new Error("Unable to parse attribute mapStateJSON")}const i=[];let r=[];try{r=JSON.parse(t.layerListJSON)}catch(t){throw new Error("Unable to parse attribute layerListJSON")}return r.forEach(((t,e)=>{if(t.sourceDescriptor&&"indexPatternId"in t.sourceDescriptor&&!n.includes(t.sourceDescriptor.indexPatternId)){const n=t.sourceDescriptor,r=`layer_${e}_source_index_pattern`;i.push({name:r,type:"index-pattern",id:n.indexPatternId}),delete n.indexPatternId,n.indexPatternRefName=r}if("joins"in t){const r=t;(r.joins?r.joins:[]).forEach(((t,r)=>{if(t.right&&"indexPatternId"in t.right&&!n.includes(t.right.indexPatternId)){const n=t.right,s=`layer_${e}_join_${r}_index_pattern`;i.push({name:s,type:"index-pattern",id:n.indexPatternId}),delete n.indexPatternId,n.indexPatternRefName=s}}))}})),{attributes:{...t,layerListJSON:JSON.stringify(r)},references:e.concat(i)}}function r(t,e){const n=e.find((({name:e})=>e===t));if(!n)throw new Error(`Could not find reference "${t}"`);return n}function s({attributes:t,references:e}){if(!t.layerListJSON)return{attributes:t};let n=[];try{n=JSON.parse(t.layerListJSON)}catch(t){throw new Error("Unable to parse attribute layerListJSON")}return n.forEach((t=>{if(t.sourceDescriptor&&"indexPatternRefName"in t.sourceDescriptor){const n=t.sourceDescriptor,i=r(n.indexPatternRefName,e);n.indexPatternId=i.id,delete n.indexPatternRefName}if("joins"in t){const n=t;(n.joins?n.joins:[]).forEach((t=>{if(t.right&&"indexPatternRefName"in t.right){const n=t.right,i=r(n.indexPatternRefName,e);n.indexPatternId=i.id,delete n.indexPatternRefName}}))}})),{attributes:{...t,layerListJSON:JSON.stringify(n)}}}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}))},175:function(t,e,n){"use strict";n.d(e,"b",(function(){return E})),n.d(e,"a",(function(){return f.a})),n.d(e,"c",(function(){return C}));var i=n(3),r=n(2),s=n(6),o=n.n(s),a=n(108),l=n(116),u=n(14),c=n(97),h=n(253),d=n(4);function p(t){return!Object(c.j)(t)}class create_source_editor_CreateSourceEditor extends r.Component{constructor(...t){super(...t),o()(this,"state",{indexPattern:null,geoField:"",requestType:this.props.requestType}),o()(this,"onIndexPatternSelect",(t=>{this.setState({indexPattern:t},(()=>{const e=Object(c.a)(t.fields);e[0]&&this._onGeoFieldSelect(e[0].name)}))})),o()(this,"_onGeoFieldSelect",(t=>{this.setState({geoField:t},this.previewLayer)})),o()(this,"_onRequestTypeSelect",(t=>{this.setState({requestType:t},this.previewLayer)})),o()(this,"previewLayer",(()=>{const{indexPattern:t,geoField:e,requestType:n}=this.state,i=t&&e?{indexPatternId:t.id,geoField:e,requestType:n}:null;this.props.onSourceConfigChange(i)}))}_renderGeoSelect(){return this.state.indexPattern?Object(d.jsx)(u.EuiFormRow,{label:i.i18n.translate("xpack.maps.source.esGeoGrid.geofieldLabel",{defaultMessage:"Cluster field"})},Object(d.jsx)(a.a,{placeholder:i.i18n.translate("xpack.maps.source.esGeoGrid.geofieldPlaceholder",{defaultMessage:"Select geo field"}),value:this.state.geoField,onChange:this._onGeoFieldSelect,fields:this.state.indexPattern?Object(c.b)(this.state.indexPattern.fields):void 0,isFieldDisabled:p,getFieldDisabledReason:c.d})):null}_renderRenderAsSelect(){return this.state.indexPattern?Object(d.jsx)(h.a,{renderAs:this.state.requestType,onChange:this._onRequestTypeSelect}):null}render(){return Object(d.jsx)(u.EuiPanel,null,Object(d.jsx)(l.a,{dataView:this.state.indexPattern,onChange:this.onIndexPatternSelect}),this._renderGeoSelect(),this._renderRenderAsSelect())}}var f=n(123),g=n(91),m=n(98),_=n(100),y=n(0),v=n(99),b=n(244);const x=y.L.FINE,E={id:y.Jb.CLUSTERS,order:10,categories:[y.ab.ELASTICSEARCH],description:i.i18n.translate("xpack.maps.source.esGridClustersDescription",{defaultMessage:"Group documents into grids and hexagons"}),icon:()=>Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(d.jsx)("path",{fill:"#69707D",d:"M37.864 5.114v2.84l2.227 1.137 2.227-1.136V5.114l-2.227-1.137-2.227 1.137zM22.273 5.682h4.454v4.545h-4.454V5.682zM22.273 10.227v4.546h-4.455v-4.546h4.455zM31.182 14.773h-4.455v4.545h4.455v-4.545zM44.545 17.045v2.841l2.228 1.137L49 19.886v-2.84l-2.227-1.137-2.228 1.136zM37.864 15.91v-2.842l2.227-1.136 2.227 1.136v2.841l-2.227 1.136-2.227-1.136z"}),Object(d.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M11.693 3.41c.923 0 1.67-.764 1.67-1.705 0-.942-.747-1.705-1.67-1.705-.922 0-1.67.763-1.67 1.705 0 .94.748 1.704 1.67 1.704zM3.898 6.818c1.537 0 2.784-1.272 2.784-2.84 0-1.57-1.247-2.842-2.784-2.842-1.538 0-2.784 1.272-2.784 2.841 0 1.57 1.246 2.841 2.784 2.841zM9.466 13.068c1.23 0 2.227-1.017 2.227-2.272 0-1.256-.997-2.273-2.227-2.273S7.239 9.54 7.239 10.796c0 1.255.997 2.272 2.227 2.272zM2.227 18.182c1.23 0 2.228-1.018 2.228-2.273 0-1.255-.998-2.273-2.228-2.273C.997 13.636 0 14.654 0 15.91c0 1.255.997 2.273 2.227 2.273zM10.023 25c1.845 0 3.34-1.526 3.34-3.41 0-1.882-1.495-3.408-3.34-3.408-1.845 0-3.341 1.526-3.341 3.409 0 1.883 1.496 3.409 3.34 3.409zM17.818 5.682h4.455v4.545h-4.455V5.682zM26.727 10.227h4.455v4.546h-4.455v-4.546zM26.727 14.773v4.545h-4.454v-4.545h4.454zM40.09 17.046v2.84l2.228 1.137 2.227-1.137v-2.84l-2.227-1.137-2.227 1.136zM35.636 11.932V9.09l2.228-1.136L40.09 9.09v2.84l-2.227 1.137-2.228-1.136zM42.318 5.114v2.84l2.227 1.137 2.228-1.136V5.114l-2.228-1.137-2.227 1.137z"}),Object(d.jsx)("path",{fill:"#98A2B3",d:"M40.09 1.136v2.841l2.228 1.137 2.227-1.137v-2.84L42.318 0l-2.227 1.136zM26.727 1.136h-4.454v4.546h4.454v4.545h-4.454v4.546h-4.455v4.545h4.455v-4.545h4.454v-4.546h4.455V5.682h-4.455V1.136zM40.09 9.09v2.842l2.228 1.136 2.227-1.136V9.09l-2.227-1.136-2.227 1.136zM37.864 23.864v-2.841l2.227-1.137 2.227 1.137v2.84L40.091 25l-2.227-1.136z"}),Object(d.jsx)("path",{fill:"#D3DAE6",d:"M44.545 3.977v-2.84L46.773 0 49 1.136v2.841l-2.227 1.137-2.228-1.137zM42.318 13.068v2.841l2.227 1.136 2.228-1.136v-2.84l-2.228-1.137-2.227 1.136zM26.727 19.318h-4.454v4.546h4.454v-4.546zM42.318 21.023v2.84L44.545 25l2.228-1.136v-2.841l-2.228-1.137-2.227 1.137z"})),renderWizard:({previewLayers:t})=>Object(d.jsx)(create_source_editor_CreateSourceEditor,{requestType:y.ub.POINT,onSourceConfigChange:e=>{if(!e)return void t([]);const n=f.a.createDescriptor({...e,resolution:x}),i=Object(m.i)(),r=_.a.createDescriptor({[y.Ib.FILL_COLOR]:{type:y.Eb.DYNAMIC,options:{...i[y.Ib.FILL_COLOR].options,field:{name:y.k,origin:y.D.SOURCE},color:v.e[0].value,type:y.j.ORDINAL}},[y.Ib.LINE_COLOR]:{type:y.Eb.STATIC,options:{color:"#FFF"}},[y.Ib.LINE_WIDTH]:{type:y.Eb.STATIC,options:{size:0}},[y.Ib.ICON_SIZE]:{type:y.Eb.DYNAMIC,options:{...i[y.Ib.ICON_SIZE].options,...Object(b.a)(x),field:{name:y.k,origin:y.D.SOURCE}}},[y.Ib.LABEL_TEXT]:{type:y.Eb.DYNAMIC,options:{...i[y.Ib.LABEL_TEXT].options,field:{name:y.k,origin:y.D.SOURCE}}}}),s=n.requestType===y.ub.HEX?g.c.createDescriptor({sourceDescriptor:n,style:r}):g.b.createDescriptor({sourceDescriptor:n,style:r});t([s])}}),title:f.b};var S=n(160);const C={id:y.Jb.HEATMAP,order:10,categories:[y.ab.ELASTICSEARCH],description:i.i18n.translate("xpack.maps.source.esGridHeatmapDescription",{defaultMessage:"Group documents in grids to show density"}),icon:()=>Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(d.jsx)("path",{className:"mapLayersWizardIcon__background",fillRule:"evenodd",d:"M29.012 20.309a10.393 10.393 0 01-6.608 2.359c-1.134 0-2.225-.181-3.247-.515a8.322 8.322 0 11-6.005-14.747A10.433 10.433 0 0122.404 1.8c3.973 0 7.428 2.222 9.19 5.49a8.322 8.322 0 11-2.582 13.019z",clipRule:"evenodd",opacity:"0.8"}),Object(d.jsx)("circle",{cx:"35.741",cy:"14.778",r:"3.989",className:"mapLayersWizardIcon__highlight"}),Object(d.jsx)("path",{className:"mapLayersWizardIcon__highlight",fillRule:"evenodd",d:"M20.021 16.957c-1.199-.773-2.221-.518-3.224.826-.896 1.2-2.587 1.272-3.963.482-1.332-.764-1.843-2.084-1.403-3.62.447-1.558 1.517-2.379 3.084-2.365 1.676.015 1.886-.16 2.496-1.863.8-2.235 2.274-3.8 4.704-4.07 2.266-.252 4.174.556 5.41 2.574 1.323 2.158 1.17 4.623-.348 6.462-1.65 1.998-3.962 2.574-6.756 1.574z",clipRule:"evenodd"})),renderWizard:({previewLayers:t})=>Object(d.jsx)(create_source_editor_CreateSourceEditor,{requestType:y.ub.HEATMAP,onSourceConfigChange:e=>{if(!e)return void t([]);const n=S.a.createDescriptor({sourceDescriptor:f.a.createDescriptor({...e,resolution:y.L.SUPER_FINE})});t([n])}}),title:f.c}},190:function(t,e,n){"use strict";n.d(e,"n",(function(){return m})),n.d(e,"o",(function(){return _})),n.d(e,"F",(function(){return y})),n.d(e,"e",(function(){return v})),n.d(e,"a",(function(){return b})),n.d(e,"b",(function(){return x})),n.d(e,"c",(function(){return E})),n.d(e,"l",(function(){return S})),n.d(e,"j",(function(){return C})),n.d(e,"z",(function(){return I})),n.d(e,"g",(function(){return w})),n.d(e,"x",(function(){return L})),n.d(e,"y",(function(){return T})),n.d(e,"v",(function(){return j})),n.d(e,"p",(function(){return N})),n.d(e,"L",(function(){return P})),n.d(e,"M",(function(){return R})),n.d(e,"G",(function(){return D})),n.d(e,"H",(function(){return A})),n.d(e,"s",(function(){return k})),n.d(e,"d",(function(){return G})),n.d(e,"J",(function(){return B})),n.d(e,"I",(function(){return z})),n.d(e,"E",(function(){return q})),n.d(e,"D",(function(){return V})),n.d(e,"C",(function(){return U})),n.d(e,"B",(function(){return W})),n.d(e,"u",(function(){return Y})),n.d(e,"t",(function(){return H})),n.d(e,"m",(function(){return J})),n.d(e,"k",(function(){return X})),n.d(e,"K",(function(){return $})),n.d(e,"r",(function(){return tt})),n.d(e,"q",(function(){return et})),n.d(e,"w",(function(){return nt})),n.d(e,"f",(function(){return st})),n.d(e,"A",(function(){return ot})),n.d(e,"i",(function(){return at})),n.d(e,"h",(function(){return lt}));var i=n(89),r=n(110),s=n(111),o=n(165),a=n(130),l=n(139),u=n(91),c=n(103),h=n(0),d=n(24),p=n(94),f=n(102),g=n(188);function m(){return(t,e)=>{const n=Object(i.G)(e());t({type:a.n,layerId:n})}}function _(t){return(e,n)=>{Object(i.v)(n())?Object(i.p)(n()).forEach((({id:t})=>{e(Z(t))})):e({type:a.f}),t.forEach((t=>{e(b(t))}))}}function y(t){return{type:a.H,layer:t}}function v(t){return async(e,n)=>{const r=Object(i.l)(t,n());r&&(await r.cloneDescriptor()).forEach((n=>{e(b(n)),r.getParent()&&e(at(n.id,t))}))}}function b(t){return async(e,n)=>{if(!Object(i.v)(n()))return void e({type:a.b,layer:t});e({type:a.a,layer:t}),e(Object(l.h)(t.id,!1));const r=Object(i.a)(t,[]);(await r.getLicensedFeatures()).forEach(d.d)}}function x(t){return{type:a.a,layer:t}}function E(t){return e=>{e(S()),t.forEach((t=>{e(b({...t,__isPreviewLayer:!0})),t.style&&(rt(t.style)||t.style.type===h.Y.HEATMAP)&&e(Object(o.z)(t.id))}))}}function S(){return(t,e)=>{Object(i.n)(e()).forEach((e=>{e.isPreviewLayer()&&(Object(f.c)(e)&&t(ot(e.getId())),t(X(e.getId())))}))}}function C(){return(t,e)=>{Object(i.n)(e()).forEach((e=>{e.isPreviewLayer()&&t({type:a.J,id:e.getId(),propName:"__isPreviewLayer",newValue:!1})}))}}function O(t,e){return(n,r)=>{const s=Object(i.l)(t,r());s&&(Object(f.c)(s)&&s.getChildren().forEach((t=>{n(O(t.getId(),e))})),s.isVisible()!==e&&(n({type:a.v,layerId:t,visibility:e}),e&&n(Object(l.h)(t,!1))))}}function I(t){return(e,n)=>{const r=Object(i.l)(t,n());if(!r)return;const s=!r.isVisible();e(O(t,s))}}function w(){return(t,e)=>{Object(i.n)(e()).forEach(((e,n)=>{e.isBasemap(n)||t(O(e.getId(),!1))}))}}function L(){return(t,e)=>{Object(i.n)(e()).forEach(((e,n)=>{t(O(e.getId(),!0))}))}}function T(t){return(e,n)=>{Object(i.n)(n()).forEach(((n,i)=>{n.isBasemap(i)||n.getId()===t||e(O(n.getId(),!1))})),Object(i.l)(t,n())&&e(O(t,!0))}}function j(t){return async(e,n)=>{Object(i.G)(n())&&await e((async(t,e)=>{const n=Object(i.G)(e());await t({type:a.p,layerId:n}),t(Object(l.i)(n)),t(Object(l.h)(n,!1))})),t&&(e(function(t){return{type:a.D,layerId:t}}(t)),Object(p.c)(n())!==h.x.NONE&&e(Object(o.v)(h.x.NONE))),e({type:a.B,selectedLayerId:t})}}function N(){return async(t,e)=>{const n=Object(i.n)(e()).find((t=>t.isPreviewLayer()));n&&t(j(n.getId()))}}function M(t){return{type:a.I,newLayerOrder:t}}function F(t,e,n,r){return async(o,c)=>{if("metrics"===e){if(r)throw new Error("May not change layer-type when modifying metrics source-property");return await o(function(t,e){return async(n,r)=>{const s=Object(i.l)(t,r()),o=s&&Object(u.e)(s,"getFields")?await s.getFields():[];n({type:a.N,layerId:t,propName:"metrics",value:e}),await n(Q(t,o))}}(t,n))}if(o({type:a.N,layerId:t,propName:e,value:n}),r&&o(function(t,e){return(n,r)=>{const o=Object(i.l)(t,r());o&&o.getType()!==e&&(n(Object(l.c)(o)),it(o,Object(s.d)(r())),n({type:a.J,id:t,propName:"type",newValue:e}))}}(t,r)),"scalingType"===e){const e=Object(i.m)(c(),t),r=e.joins?e.joins:[];if(n===h.wb.CLUSTERS&&r.length)o({type:a.t,layerId:t,joins:[]}),await o(Q(t));else if(n===h.wb.MVT){const e=r.filter((t=>!Object(g.a)(t)));o({type:a.t,layerId:t,joins:e.length?[e[0]]:[]}),await o(Q(t))}}}}function P(t,e,n,i){return async r=>{await r(F(t,e,n,i)),r(Object(l.h)(t,!1))}}function R(t,e){return async n=>{for(let i=0;i<e.length;i++){const{propName:r,value:s,newLayerType:o}=e[i];await n(F(t,r,s,o))}n(Object(l.h)(t,!1))}}function D(t,e){return{type:a.J,id:t,propName:"label",newValue:e}}function A(t,e){return{type:a.J,id:t,propName:"locale",newValue:e}}function k(t,e){return{type:a.J,id:t,propName:"attribution",newValue:e}}function G(t){return{type:a.d,id:t,propName:"attribution"}}function B(t,e){return{type:a.J,id:t,propName:"minZoom",newValue:e}}function z(t,e){return{type:a.J,id:t,propName:"maxZoom",newValue:e}}function q(t,e){return{type:a.J,id:t,propName:"alpha",newValue:e}}function V(t,e){return{type:a.J,id:t,propName:"areLabelsOnTop",newValue:e}}function U(t,e){return{type:a.J,id:t,propName:"includeInFitToBounds",newValue:e}}function W(t,e){return{type:a.J,id:t,propName:"disableTooltips",newValue:e}}function Y(t,e){return n=>{n({type:a.J,id:t,propName:"query",newValue:e}),n(Object(l.h)(t,!1))}}function H(t,e){return(n,i)=>{n({type:a.J,id:t,propName:"parent",newValue:e}),e&&n(Object(o.z)(e))}}function J(){return(t,e)=>{const n=e(),r=Object(i.G)(n);r&&t(X(r))}}function X(t){return async(e,n)=>{const s=n(),a=Object(i.G)(s);t===a&&(e(Object(o.A)(r.c.NONE)),await e(j(null))),e(Z(t))}}function Z(t){return(e,n)=>{const r=Object(i.l)(t,n());if(!r)return;r.getInFlightRequestTokens().forEach((t=>{e(Object(s.a)(t))})),it(r,Object(s.d)(n())),e({type:a.m,id:t});const l=Object(i.f)(n());t===(null==l?void 0:l.layerId)&&e(Object(o.v)(h.x.NONE)),Object(p.i)(n()).includes(t)&&e(Object(o.q)(t)),Object(f.c)(r)&&r.getChildren().forEach((t=>{e(Z(t.getId()))}))}}function Q(t,e){return async(n,r)=>{const s=Object(i.l)(t,r());if(!s)return;const o=s.getCurrentStyle();if(!o||o.getType()!==h.Y.VECTOR)return;if(!Object(u.e)(s,"getFields"))return;const a=await s.getFields(),{hasChanges:l,nextStyleDescriptor:c}=await o.getDescriptorWithUpdatedStyleProps(a,Object(i.s)(r()),e);l&&c&&n(K(t,c))}}function K(t,e){return n=>{n({type:a.K,layerId:t,style:{...e}}),rt(e)&&n(Object(o.z)(t)),n(Object(l.i)(t)),n(Object(l.h)(t,!1))}}function $(t){return(e,n)=>{const r=Object(i.G)(n());r&&e(K(r,t))}}function tt(t,e){return async n=>{const i=Object(u.e)(t,"getFields")?await t.getFields():[];n({type:a.t,layerId:t.getId(),joins:e}),await n(Q(t.getId(),i)),n(Object(l.h)(t.getId(),!1))}}function et(t){return(e,n)=>{Object(i.v)(n())?Object(i.p)(n()).forEach((n=>e(O(n.id,!t.includes(n.id))))):e({type:a.C,hiddenLayerIds:t})}}function nt(t,e,n,r){return(o,u)=>{const h=Object(i.l)(t,u());h&&(o({type:a.J,id:t,propName:"__areTilesLoaded",newValue:e}),o({type:a.J,id:t,propName:"__tileErrors",newValue:r}),!Object(f.c)(h)&&Object(c.d)(h.getSource())&&Object(s.d)(u()).vectorTiles.setTileResults(t,n,r),(n||h.getDescriptor().__tileMetaFeatures)&&(o({type:a.J,id:t,propName:"__tileMetaFeatures",newValue:n}),o(Object(l.i)(t))))}}function it(t,e){if(Object(f.c)(t))return;e.vectorTiles&&e.vectorTiles.removeLayer(t.getId());const n=t.getSource();"getInspectorRequestIds"in n&&n.getInspectorRequestIds().forEach((t=>{e.requests.resetRequest(t)})),e.requests&&Object(u.e)(t,"getValidJoins")&&t.getValidJoins().forEach((t=>{e.requests.resetRequest(t.getRightJoinSource().getId())}))}function rt(t){return t.type===h.Y.VECTOR&&Object.values(t.properties).some((t=>(null==t?void 0:t.type)===h.Eb.DYNAMIC))}function st(t,e){return(n,r)=>{const s=f.b.createDescriptor({}),l=Object(i.m)(r(),e);null!=l&&l.parent&&(s.parent=l.parent),n({type:a.a,layer:s}),n(at(s.id,e)),n(Object(o.z)(s.id)),n(H(t,s.id)),n(H(e,s.id)),n(at(t,e))}}function ot(t){return(e,n)=>{const r=Object(i.n)(n()).find((e=>e.getId()===t));r&&Object(f.c)(r)&&r.getChildren().forEach((t=>{e(H(t.getId(),r.getParent()))}))}}function at(t,e){return(n,r)=>{const s=Object(i.n)(r()),o=s.findIndex((e=>e.getId()===t)),a=s.findIndex((t=>t.getId()===e));if(-1===o||-1===a)return;const l=s[o],u=o>a?a+1:a,c=[];for(let t=0;t<s.length;t++)c.push(t);c.splice(o,1),c.splice(u,0,o),n(M(c)),Object(f.c)(l)&&l.getChildren().forEach((t=>{n(at(t.getId(),e))}))}}function lt(t){return(e,n)=>{const r=Object(i.n)(n()),s=r.findIndex((e=>e.getId()===t));if(-1===s)return;const o=r[s],a=[];for(let t=0;t<r.length;t++)a.push(t);a.splice(s,1),a.splice(0,0,s),e(M(a)),Object(f.c)(o)&&o.getChildren().forEach((t=>{e(lt(t.getId()))}))}}},191:function(t,e,n){"use strict";n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return l}));var i=n(3),r=n(5),s=n(0);const o=i.i18n.translate("xpack.maps.breadCrumbs.unsavedChangesWarning",{defaultMessage:"Leave Maps with unsaved work?"}),a=i.i18n.translate("xpack.maps.breadCrumbs.unsavedChangesTitle",{defaultMessage:"Unsaved changes"});function l({pageTitle:t,isByValue:e,getHasUnsavedChanges:n,originatingApp:i,getAppNameFromId:l,history:u}){const c=[];return i&&l&&c.push({onClick:()=>{Object(r.C)()(i)},text:l(i)}),e||c.push({text:s.f,onClick:async()=>{n()?await Object(r.i)().openConfirm(o,{title:a,"data-test-subj":"appLeaveConfirmModal"})&&u.push("/"):u.push("/")}}),c.push({text:t}),c}},193:function(t,e,n){"use strict";n.d(e,"b",(function(){return i.a})),n.d(e,"a",(function(){return map_page_MapPage}));var i=n(262),r=n(64),s=n.n(r),o=n(3),a=n(5),l=n(0);function u(){const t=window.location.href.split("?");if(t.length<=1)return[];let e=new URLSearchParams(t[1]).get(l.R);if(!e)return[];try{return e.endsWith("#")&&(e=e.slice(0,-1)),function(t){return s.a.decodeArray(t).flatMap(((t,e)=>{return"object"==typeof(n=t)&&null!==n&&"string"==typeof t.id?t:(console.error(`item ${e} in mapInitLayers is not a valid LayerDescriptor and was ignored`),[]);var n}))}(e)}catch(t){return Object(a.R)().addWarning({title:o.i18n.translate("xpack.maps.initialLayers.unableToParseTitle",{defaultMessage:"Initial layers not added to map"}),text:o.i18n.translate("xpack.maps.initialLayers.unableToParseMessage",{defaultMessage:"Unable to parse contents of 'initialLayers' parameter. Error: {errorMsg}",values:{errorMsg:t.message}})}),[]}}var c=n(28),h=n(191);function d(){const t=window.location.href.split(/[?#]+/);if(t.length<=1)return"";const e=new URLSearchParams(t[1]);return e.has(l.rb)&&e.has(l.rb)?e.get(l.rb):""}var p=n(6),f=n.n(p),g=n(2),m=n.n(g),_=n(55),y=n(53),v=n.n(y),b=n(1),x=n(58),E=n(65);class app_state_manager_AppStateManager{constructor(){f()(this,"_query",null),f()(this,"_savedQueryId",""),f()(this,"_filters",[]),f()(this,"_updated$",new b.Subject)}setQueryAndFilters({query:t,savedQueryId:e,filters:n}){t&&this._query!==t&&(this._query=t),e&&this._savedQueryId!==e&&(this._savedQueryId=e),n&&this._filters!==n&&(this._filters=n),this._updated$.next()}getQuery(){return this._query}getFilters(){return this._filters}getAppState(){return{query:this._query,savedQueryId:this._savedQueryId,filters:this._filters}}}var S=n(339),C=n(97),O=n(18),I=n.n(O),w=n(85),L=n(86),T=n(29),j=n(4);const N=Object(L.withSuspense)(L.LazySavedObjectSaveModalDashboard);var M=n(335);class map_app_MapApp extends m.a.Component{constructor(t){super(t),f()(this,"_autoRefreshSubscription",null),f()(this,"_globalSyncUnsubscribe",null),f()(this,"_globalSyncChangeMonitorSubscription",null),f()(this,"_appSyncUnsubscribe",null),f()(this,"_appStateManager",new app_state_manager_AppStateManager),f()(this,"_prevIndexPatternIds",null),f()(this,"_isMounted",!1),f()(this,"_kbnUrlStateStorage",void 0),f()(this,"_initialTimeFromUrl",void 0),f()(this,"_updateFromGlobalState",(({changes:t,state:e})=>{this.state.initialized&&t&&e&&this._onQueryChange({time:e.time})})),f()(this,"_onQueryChange",(({filters:t,query:e,time:n})=>{const{filterManager:i}=Object(a.j)().query;t&&i.setFilters(t),this.props.setQuery({forceRefresh:!1,filters:i.getFilters(),query:e,timeFilters:n}),this._appStateManager.setQueryAndFilters({filters:i.getAppFilters(),query:e});const r={filters:i.getGlobalFilters()};n&&(r.time=n),this._updateGlobalState(r)})),f()(this,"_onFiltersChange",(t=>{this._onQueryChange({filters:t})})),f()(this,"_updateStateFromSavedQuery",(t=>{this.setState({savedQuery:{...t}}),this._appStateManager.setQueryAndFilters({savedQueryId:t.id});const{filterManager:e}=Object(a.j)().query,n=[...t.attributes.filters||[],...e.getGlobalFilters()],i=v.a.get(t,"attributes.timefilter.refreshInterval");i&&this._onRefreshConfigChange({isPaused:i.pause,interval:i.value}),this._onQueryChange({filters:n,query:t.attributes.query,time:t.attributes.timefilter})})),f()(this,"_addFilter",(async t=>{t.forEach((t=>{t.$state={store:x.FilterStateStore.APP_STATE}})),this._onFiltersChange([...this.props.filters,...t])})),this.state={indexPatterns:[],initialized:!1,isRefreshPaused:!0,refreshInterval:0},this._kbnUrlStateStorage=Object(E.createKbnUrlStateStorage)({useHash:!1,history:t.history,...Object(E.withNotifyOnErrors)(Object(a.R)())})}componentDidMount(){var t;this._isMounted=!0;const e={type:"application",name:l.e,url:window.location.pathname,id:this.props.savedMap.getSavedObjectId()||"new",page:"editor"};Object(a.q)().set(e),this.props.setExecutionContext(e),this._autoRefreshSubscription=Object(a.Q)().getAutoRefreshFetch$().pipe(Object(b.tap)((()=>{this.props.setQuery({forceRefresh:!0})})),Object(b.switchMap)((t=>Object(M.a)(this.props.savedMap.getStore()).pipe(Object(b.finalize)(t))))).subscribe(),this._initialTimeFromUrl=null===(t=this._getGlobalState())||void 0===t?void 0:t.time;const{stop:n}=Object(c.syncGlobalQueryStateWithUrl)(Object(a.j)().query,this._kbnUrlStateStorage);this._globalSyncUnsubscribe=n,this._appSyncUnsubscribe=function(t,e){const{query:n}=Object(a.j)();n.filterManager.setAppFilters([]);const i={get:()=>({query:t.getQuery(),filters:t.getFilters()}),set:e=>e&&t.setQueryAndFilters({query:e.query,filters:e.filters}),state$:t._updated$.pipe(Object(b.map)((()=>({query:t.getQuery(),filters:t.getFilters()}))))},r=Object(c.connectToQueryState)(n,i,{filters:x.FilterStateStore.APP_STATE,query:!0}),{start:s,stop:o}=Object(E.syncState)({storageKey:"_a",stateStorage:e,stateContainer:i}),l={...i.get(),...e.get("_a")};return i.set(l),e.set("_a",l,{replace:!0}),s(),()=>{r(),o()}}(this._appStateManager,this._kbnUrlStateStorage),this._globalSyncChangeMonitorSubscription=Object(a.j)().query.state$.subscribe(this._updateFromGlobalState),this._initMap(),this.props.onAppLeave((t=>this.props.savedMap.hasUnsavedChanges()?t.confirm(h.c,h.b):t.default()))}componentDidUpdate(){this._updateIndexPatterns()}componentWillUnmount(){this._isMounted=!1,this._autoRefreshSubscription&&this._autoRefreshSubscription.unsubscribe(),this._globalSyncUnsubscribe&&this._globalSyncUnsubscribe(),this._appSyncUnsubscribe&&this._appSyncUnsubscribe(),this._globalSyncChangeMonitorSubscription&&this._globalSyncChangeMonitorSubscription.unsubscribe(),this.props.onAppLeave((t=>t.default()))}_getGlobalState(){var t;return null!==(t=this._kbnUrlStateStorage.get("_g"))&&void 0!==t?t:{}}_updateGlobalState(t){this._kbnUrlStateStorage.set("_g",{...this._getGlobalState(),...t}),this.state.initialized||this._kbnUrlStateStorage.kbnUrlControls.flush(!0)}async _updateIndexPatterns(){const{nextIndexPatternIds:t}=this.props;if(v.a.isEqual(t,this._prevIndexPatternIds))return;this._prevIndexPatternIds=t;let e=[];if(0===t.length){const t=await Object(a.w)().getDefaultDataView();t&&(e=[t])}else e=await Object(C.e)(t);this._isMounted&&v.a.isEqual(t,this._prevIndexPatternIds)&&this.setState({indexPatterns:e})}_getInitialTime(t){return this._initialTimeFromUrl?this._initialTimeFromUrl:!this.props.savedMap.hasSaveAndReturnConfig()&&null!=t&&t.timeFilters?t.timeFilters:Object(a.Q)().getTime()}_initMapAndLayerSettings(t){const e=this._getGlobalState(),n=null!=t&&t.filters?t.filters:[],i=this._appStateManager.getFilters()||[],r=function({mapState:t,appState:e={}}){return e.query?e.query:null!=t&&t.query?t.query:Object(a.j)().query.queryString.getDefaultQuery()}({mapState:t,appState:this._appStateManager.getAppState()});r&&Object(a.j)().query.queryString.setQuery(r),this._onQueryChange({filters:[...v.a.get(e,"filters",[]),...i,...n],query:r,time:this._getInitialTime(t)}),this._onRefreshConfigChange(function({mapState:t,globalState:e={}}){const n=Object(a.T)();if(null!=t&&t.refreshConfig)return t.refreshConfig;const i={...n.get(c.UI_SETTINGS.TIMEPICKER_REFRESH_INTERVAL_DEFAULTS),...e.refreshInterval};return{isPaused:i.pause,interval:i.value}}({mapState:t,globalState:e}))}_onRefreshConfigChange({isPaused:t,interval:e}){this.setState({isRefreshPaused:t,refreshInterval:e}),this._updateGlobalState({refreshInterval:{pause:t,value:e}})}async _initMap(){var t,e;const n=null===(t=this.props.history.location)||void 0===t?void 0:t.state;if(null!=n&&null!==(e=n.dataViewSpec)&&void 0!==e&&e.id){const t=Object(a.w)();try{(await t.get(n.dataViewSpec.id)).isPersisted()||await t.create(n.dataViewSpec)}catch(t){}}try{await this.props.savedMap.whenReady()}catch(t){return void(this._isMounted&&(Object(a.R)().addWarning({title:o.i18n.translate("xpack.maps.loadMap.errorAttemptingToLoadSavedMap",{defaultMessage:"Unable to load map"}),text:`${t.message}`}),this.props.history.push("/")))}if(!this._isMounted)return;const i=this.props.savedMap.getSharingSavedObjectProps(),r=Object(a.O)();if(r&&"aliasMatch"===(null==i?void 0:i.outcome)){const t=i.aliasTargetId,e=`${Object(l.Mb)(t)}${this.props.history.location.hash}`;return void await r.ui.redirectLegacyUrl({path:e,aliasPurpose:i.aliasPurpose,objectNoun:l.db})}this.props.savedMap.setBreadcrumbs(this.props.history),Object(a.g)().docTitle.change(this.props.savedMap.getTitle());const s=this.props.savedMap.getSavedObjectId();let u;s&&Object(a.g)().recentlyAccessed.add(Object(l.Nb)(s),this.props.savedMap.getTitle(),s);try{const t=this.props.savedMap.getAttributes();t.mapStateJSON&&(u=JSON.parse(t.mapStateJSON))}catch(t){}this._initMapAndLayerSettings(u),this.setState({initialized:!0})}_renderTopNav(){if(this.props.isFullScreen)return null;const t=function({savedMap:t,isOpenSettingsDisabled:e,isSaveDisabled:n,enableFullScreen:i,openMapSettings:r,inspectorAdapters:s,history:u}){const c=[];if(c.push({id:"mapSettings",label:o.i18n.translate("xpack.maps.topNav.openSettingsButtonLabel",{defaultMessage:"Settings"}),description:o.i18n.translate("xpack.maps.topNav.openSettingsDescription",{defaultMessage:"Open map settings"}),testId:"openSettingsButton",disableButton:()=>e,run(){r()}},{id:"inspect",label:o.i18n.translate("xpack.maps.topNav.openInspectorButtonLabel",{defaultMessage:"inspect"}),description:o.i18n.translate("xpack.maps.topNav.openInspectorDescription",{defaultMessage:"Open Inspector"}),testId:"openInspectorButton",run(){Object(a.x)().open(s,{})}},{id:"full-screen",label:o.i18n.translate("xpack.maps.topNav.fullScreenButtonLabel",{defaultMessage:"full screen"}),description:o.i18n.translate("xpack.maps.topNav.fullScreenDescription",{defaultMessage:"full screen"}),testId:"mapsFullScreenMode",run(){i()}}),t.hasOriginatingApp()&&c.push({label:o.i18n.translate("xpack.maps.topNav.cancel",{defaultMessage:"Cancel"}),run:()=>{Object(a.C)()(t.getOriginatingApp(),{path:t.getOriginatingPath()})},testId:"mapsCancelButton",description:o.i18n.translate("xpack.maps.topNav.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),Object(a.A)().save){const e=t.hasSaveAndReturnConfig(),i=t.getAttributes().description?t.getAttributes().description:"",r=t.isByValue()?o.i18n.translate("xpack.maps.topNav.saveToMapsButtonLabel",{defaultMessage:"Save to maps"}):o.i18n.translate("xpack.maps.topNav.saveAsButtonLabel",{defaultMessage:"Save as"});c.push({id:"save",iconType:e?void 0:"save",label:e?r:o.i18n.translate("xpack.maps.topNav.saveMapButtonLabel",{defaultMessage:"save"}),description:o.i18n.translate("xpack.maps.topNav.saveMapDescription",{defaultMessage:"Save map"}),emphasize:!e,testId:"mapSaveButton",disableButton:()=>n,tooltip(){if(n)return o.i18n.translate("xpack.maps.topNav.saveMapDisabledButtonTooltip",{defaultMessage:"Confirm or Cancel your layer changes before saving"})},run:()=>{let e=t.getTags();const n=Object(a.H)(),r=n?Object(j.jsx)(n.ui.components.SavedObjectSaveModalTagSelector,{initialSelection:e,onTagsSelected:function(t){e=t},markOptional:!0}):void 0,s={onSave:async n=>{try{await Object(T.a)({id:n.newCopyOnSave?void 0:t.getSavedObjectId(),title:n.newTitle,copyOnSave:n.newCopyOnSave,lastSavedTitle:t.getSavedObjectId()?t.getTitle():"",isTitleDuplicateConfirmed:n.isTitleDuplicateConfirmed,getDisplayName:()=>l.db,onTitleDuplicate:n.onTitleDuplicate},{overlays:Object(a.i)()})}catch(t){return{}}return await t.save({...n,tags:e,saveByReference:n.addToLibrary,history:u}),{id:"id"}},onClose:()=>{},documentInfo:{description:i,id:t.getSavedObjectId(),title:t.getTitle()},objectType:o.i18n.translate("xpack.maps.topNav.saveModalType",{defaultMessage:"map"})},c=Object(a.F)();let h;h=t.hasOriginatingApp()?Object(j.jsx)(w.SavedObjectSaveModalOrigin,I()({},s,{onSave:async t=>s.onSave({...t,addToLibrary:!0}),originatingApp:t.getOriginatingApp(),getAppNameFromId:t.getAppNameFromId,returnToOriginSwitchLabel:t.isByValue()?o.i18n.translate("xpack.maps.topNav.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:t.getOriginatingAppName()}}):void 0,options:r})):Object(j.jsx)(N,I()({},s,{canSaveByReference:!0,mustCopyOnSaveMessage:t.isManaged()?o.i18n.translate("xpack.maps.topNav.mustCopyOnSaveMessage",{defaultMessage:"Elastic manages this map. Save any changes to a new map."}):void 0,tagOptions:r})),Object(w.showSaveModal)(h,c)}}),e&&c.push({id:"saveAndReturn",label:o.i18n.translate("xpack.maps.topNav.saveAndReturnButtonLabel",{defaultMessage:"Save and return"}),emphasize:!0,iconType:"checkInCircleFilled",run:()=>{t.save({newTitle:t.getTitle(),newDescription:i,newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0,onTitleDuplicate:()=>{},saveByReference:!t.isByValue(),history:u})},testId:"mapSaveAndReturnButton"})}return c}({savedMap:this.props.savedMap,isOpenSettingsDisabled:this.props.isOpenSettingsDisabled,isSaveDisabled:this.props.isSaveDisabled,enableFullScreen:this.props.enableFullScreen,openMapSettings:this.props.openMapSettings,inspectorAdapters:this.props.inspectorAdapters,history:this.props.history}),{TopNavMenu:e}=Object(a.E)().ui;return Object(j.jsx)(e,{setMenuMountPoint:this.props.setHeaderActionMenu,appName:l.e,badges:this.props.savedMap.isManaged()?[(n=o.i18n.translate("xpack.maps.mapController.managedMapDescriptionTooltip",{defaultMessage:"Elastic manages this map. Save any changes to a new map."}),{"data-test-subj":"managedContentBadge",badgeText:o.i18n.translate("managedContentBadge.text",{defaultMessage:"Managed"}),title:o.i18n.translate("managedContentBadge.text",{defaultMessage:"Managed"}),color:"primary",iconType:"glasses",toolTipProps:{content:n,position:"bottom"}})]:void 0,config:t,indexPatterns:this.state.indexPatterns,filters:this.props.filters,query:this.props.query,onQuerySubmit:({dateRange:t,query:e})=>{v.a.isEqual(t,this.props.timeFilters)&&v.a.isEqual(e,this.props.query)?this.props.setQuery({forceRefresh:!0}):this._onQueryChange({query:e,time:t})},onFiltersUpdated:this._onFiltersChange,dateRangeFrom:this.props.timeFilters.from,dateRangeTo:this.props.timeFilters.to,isRefreshPaused:this.state.isRefreshPaused,refreshInterval:this.state.refreshInterval,onRefreshChange:({isPaused:t,refreshInterval:e})=>{this._onRefreshConfigChange({isPaused:t,interval:e})},showSearchBar:!0,showFilterBar:!0,showDatePicker:!0,saveQueryMenuVisibility:Object(a.A)().saveQuery?"allowed_by_app_privilege":"globally_managed",savedQuery:this.state.savedQuery,onSaved:this._updateStateFromSavedQuery,onSavedQueryUpdated:this._updateStateFromSavedQuery,onClearSavedQuery:()=>{const{filterManager:t,queryString:e}=Object(a.j)().query;this.setState({savedQuery:void 0}),this._appStateManager.setQueryAndFilters({savedQueryId:""}),this._onQueryChange({filters:t.getGlobalFilters(),query:e.getDefaultQuery()})}});var n}_renderLegacyUrlConflict(){const t=this.props.savedMap.getSharingSavedObjectProps(),e=Object(a.O)();return e&&"conflict"===(null==t?void 0:t.outcome)?e.ui.components.getLegacyUrlConflict({objectNoun:l.db,currentObjectId:this.props.savedMap.getSavedObjectId(),otherObjectId:t.aliasTargetId,otherObjectPath:`${Object(l.Mb)(t.aliasTargetId)}${this.props.history.location.hash}`}):null}render(){return this.state.initialized?Object(j.jsx)("div",{id:"maps-plugin",className:this.props.isFullScreen?"mapFullScreen":""},this._renderTopNav(),Object(j.jsx)("h1",{className:"euiScreenReaderOnly"},"screenTitle placeholder"),Object(j.jsx)("div",{id:"react-maps-root"},this._renderLegacyUrlConflict(),Object(j.jsx)(S.a,{addFilters:this._addFilter,title:this.props.savedMap.getAttributes().title,description:this.props.savedMap.getAttributes().description,waitUntilTimeLayersLoad$:Object(M.a)(this.props.savedMap.getStore()),isSharable:!0}))):null}}var F=n(94),P=n(89),R=n(90),D=n(110),A=n(111);const k=Object(_.connect)((function(t){return{isFullScreen:Object(F.e)(t),isOpenSettingsDisabled:Object(F.d)(t)!==D.c.NONE,isSaveDisabled:Object(P.M)(t),inspectorAdapters:Object(A.d)(t),nextIndexPatternIds:Object(P.C)(t),flyoutDisplay:Object(F.d)(t),filters:Object(P.h)(t),query:Object(P.B)(t),timeFilters:Object(P.J)(t)}}),(function(t){return{setQuery:({forceRefresh:e,filters:n,query:i,timeFilters:r,searchSessionId:s})=>{t(Object(R.mb)({filters:n,query:i,timeFilters:r,forceRefresh:e,searchSessionId:s}))},enableFullScreen:()=>t(Object(R.z)()),openMapSettings:()=>t(Object(R.K)()),setExecutionContext:e=>t(Object(R.Z)(e))}}))(map_app_MapApp);class map_page_MapPage extends g.Component{constructor(t){super(t),f()(this,"_isMounted",!1),f()(this,"updateSaveCounter",(()=>{this._isMounted&&this.setState((t=>({saveCounter:t.saveCounter+1})))})),this.state={savedMap:new i.a({defaultLayers:u(),mapSerializedState:t.mapSerializedState,embeddableId:t.embeddableId,originatingApp:t.originatingApp,originatingPath:t.originatingPath,stateTransfer:t.stateTransfer,onSaveCallback:this.updateSaveCounter,defaultLayerWizard:d()||""}),saveCounter:0}}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){return Object(j.jsx)(_.Provider,{store:this.state.savedMap.getStore()},Object(j.jsx)(k,{history:this.props.history,savedMap:this.state.savedMap,onAppLeave:this.props.onAppLeave,setHeaderActionMenu:this.props.setHeaderActionMenu,saveCounter:this.state.saveCounter}))}}},199:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(48),r=n(2),s=i.__importDefault(n(359));e.default=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=[]);var i=s.default(t,e),o=i[0],a=i[1],l=i[2];return r.useEffect(l,n),[o,a]}},210:function(t,e,n){"use strict";n.d(e,"n",(function(){return E})),n.d(e,"o",(function(){return S})),n.d(e,"i",(function(){return C})),n.d(e,"r",(function(){return O})),n.d(e,"w",(function(){return I})),n.d(e,"s",(function(){return w})),n.d(e,"d",(function(){return L})),n.d(e,"h",(function(){return T})),n.d(e,"f",(function(){return j})),n.d(e,"g",(function(){return N})),n.d(e,"p",(function(){return M})),n.d(e,"c",(function(){return F})),n.d(e,"m",(function(){return P})),n.d(e,"b",(function(){return R})),n.d(e,"q",(function(){return D})),n.d(e,"k",(function(){return A})),n.d(e,"l",(function(){return k})),n.d(e,"t",(function(){return G})),n.d(e,"v",(function(){return B})),n.d(e,"j",(function(){return z})),n.d(e,"u",(function(){return q})),n.d(e,"a",(function(){return V})),n.d(e,"e",(function(){return U}));var i=n(53),r=n.n(i),s=n(3),o=n(263),a=n.n(o),l=n(264),u=n.n(l),c=n(62),h=n(0),d=n(111),p=n(89),f=n(130),g=n(139),m=n(190),_=n(91),y=n(165),v=n(146),b=n(5),x=n(94);function E(t){return{type:f.w,errorMessage:t}}function S(t){return{type:f.x,settings:t}}function C(){return{type:f.o}}function O(){return{type:f.E}}function I(t,e){return n=>{n({type:f.L,settingKey:t,settingValue:e}),"autoFitToDataBounds"===t&&!0===e&&n(Object(g.a)())}}function w(t){return{type:f.L,settingKey:"customIcons",settingValue:t}}function L(t){return async(e,n)=>{const i=Object(p.n)(n()).filter((e=>{const n=e.getCurrentStyle();return!(!n||n.getType()!==h.Y.VECTOR)&&n.isUsingCustomIcon(t)}));if(i.length>0){const t=await Object(c.asyncMap)(i,(async t=>await t.getDisplayName()));Object(b.R)().addWarning(s.i18n.translate("xpack.maps.mapActions.deleteCustomIconWarning",{defaultMessage:"Unable to delete icon. The icon is in use by the {count, plural, one {layer} other {layers}}: {layerNames}",values:{count:t.length,layerNames:t.join(", ")}}))}else e(I("customIcons",n().map.settings.customIcons.filter((({symbolId:e})=>e!==t))))}}function T(){return(t,e)=>{t({type:f.l});const n=Object(p.L)(e());Object(p.w)(e()).initialLocation===h.S.AUTO_FIT_TO_BOUNDS?(n.forEach((e=>{t(Object(m.b)(e))})),t(Object(g.a)())):n.forEach((e=>{t(Object(m.a)(e))})),t({type:f.f})}}function j(){return{type:f.j}}function N(t){return(e,n)=>{const{extent:i,zoom:r}=t,{buffer:s,zoom:o}=Object(p.c)(n());let l=!0;if(s){const t=a()([s.minLon,s.minLat,s.maxLon,s.maxLat]),e=a()([i.minLon,i.minLat,i.maxLon,i.maxLat]);l=u()(t,e)}const c=!s||!l||o!==r;c&&Object(d.d)(n()).vectorTiles.setTiles(Object(v.d)(r,i)),e({type:f.k,mapViewContext:{...t,buffer:c?Object(v.a)(i,Math.ceil(r)):s}}),e(Object(g.f)(!1))}}function M({lat:t,lon:e}){let n=e;return e>180?n=e-180-180:e<-180&&(n=180-(Math.abs(e)-180)),{type:f.y,lat:t,lon:n}}function F(){return{type:f.e}}function P({lat:t,lon:e,zoom:n}){return{type:f.s,center:{lat:t,lon:e,zoom:n}}}function R(){return{type:f.c}}function D({query:t,timeFilters:e,timeslice:n,filters:i,forceRefresh:s=!1,searchSessionId:o,searchSessionMapBuffer:a,clearTimeslice:l}){return async(u,c)=>{const h=Object(p.B)(c()),d=Object(p.J)(c()),m={timeFilters:e||d,timeslice:function(){if(!l&&(void 0===e||r.a.isEqual(e,d)))return n||Object(p.K)(c())}(),query:t||h,filters:i||Object(p.h)(c()),searchSessionId:o||Object(p.D)(c()),searchSessionMapBuffer:a},_={timeFilters:d,timeslice:Object(p.K)(c()),query:h,filters:Object(p.h)(c()),searchSessionId:Object(p.D)(c()),searchSessionMapBuffer:Object(p.E)(c())};!s&&r.a.isEqual(m,_)||(u({type:f.A,...m}),Object(p.w)(c()).autoFitToDataBounds?u(Object(g.a)()):await u(Object(g.f)(s)))}}function A({query:t,filters:e}){return{type:f.q,embeddableSearchContext:{filters:e,query:t}}}function k(t){return{type:f.r,executionContext:t}}function G(t){return e=>{null!==t&&e({type:f.z,openTooltips:[]}),e({type:f.F,drawState:t})}}function B(t){return(e,n)=>{const i=Object(p.f)(n());i&&(e({type:f.G,editState:{...i,drawShape:t}}),t!==h.y.DELETE&&e(Object(y.m)()))}}function z(){return async(t,e)=>{const n=Object(p.G)(e());n&&t(q(n))}}function q(t){return e=>{null!==t&&e({type:f.z,openTooltips:[]}),e({type:y.e,drawMode:h.x.NONE}),e({type:f.G,editState:t?{layerId:t}:void 0}),e(Object(g.h)(t,!1))}}function V(t){return async(e,n)=>{const i=Object(p.f)(n()),r=i?i.layerId:void 0;if(!r)return;const o=Object(p.l)(r,n());if(o&&Object(_.e)(o,"addFeature")){try{e(B(h.y.WAIT)),await Object(c.asyncForEach)(t,(async t=>{await o.addFeature(t)})),await e(Object(g.g)(o))}catch(t){Object(b.R)().addError(t,{title:s.i18n.translate("xpack.maps.mapActions.addFeatureError",{defaultMessage:"Unable to add feature to index."})})}e(B(h.y.SIMPLE_SELECT))}}}function U(t){return async(e,n)=>{if(Object(x.b)(n()).includes(t))return;const i=Object(p.f)(n()),r=i?i.layerId:void 0;if(!r)return;const o=Object(p.l)(r,n());if(o&&Object(_.e)(o,"deleteFeature")){try{e(B(h.y.WAIT)),await o.deleteFeature(t),e(Object(y.t)(t)),await e(Object(g.g)(o))}catch(t){Object(b.R)().addError(t,{title:s.i18n.translate("xpack.maps.mapActions.removeFeatureError",{defaultMessage:"Unable to remove feature from index."})})}e(B(h.y.DELETE))}}}},245:function(t,e,n){"use strict";var i=n(142);n.d(e,"a",(function(){return i.a})),n(161)},246:function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return WMSSource}));var i=n(6),r=n.n(i),s=n(3),o=n(135),a=n(92),l=n(332),u=n(0);const c=s.i18n.translate("xpack.maps.source.wmsTitle",{defaultMessage:"Web Map Service"});class WMSSource extends o.a{static createDescriptor({serviceUrl:t,layers:e,styles:n}){return{type:WMSSource.type,serviceUrl:t,layers:e,styles:n}}constructor(t){super(t),r()(this,"_descriptor",void 0),this._descriptor=t}async hasLegendDetails(){return!1}renderLegendDetails(){return null}isSourceStale(t,e){var n;return!!e.url&&(null===(n=t.tiles)||void 0===n?void 0:n[0])!==e.url}async canSkipSourceUpdate(){return!1}async getImmutableProperties(){return[{label:Object(a.a)(),value:c},{label:Object(a.f)(),value:this._descriptor.serviceUrl},{label:s.i18n.translate("xpack.maps.source.wms.layersLabel",{defaultMessage:"Layers"}),value:this._descriptor.layers},{label:s.i18n.translate("xpack.maps.source.wms.stylesLabel",{defaultMessage:"Styles"}),value:this._descriptor.styles}]}async getDisplayName(){return this._descriptor.serviceUrl}async getUrlTemplate(){return new l.a({serviceUrl:this._descriptor.serviceUrl}).getUrlTemplate(this._descriptor.layers,this._descriptor.styles||"")}}r()(WMSSource,"type",u.Cb.WMS)},254:function(t,e,n){"use strict";n.d(e,"a",(function(){return y}));var i=n(2),r=n(3),s=n(6),o=n.n(s),a=n(54),l=n(14),u=n(332),c=n(53),h=n.n(c),d=n(4);const p=r.i18n.translate("xpack.maps.source.wms.layersLabel",{defaultMessage:"Layers"}),f=r.i18n.translate("xpack.maps.source.wms.stylesLabel",{defaultMessage:"Styles"});class wms_create_source_editor_WMSCreateSourceEditor extends i.Component{constructor(...t){super(...t),o()(this,"state",{serviceUrl:"",layers:"",styles:"",isLoadingCapabilities:!1,getCapabilitiesError:null,hasAttemptedToLoadCapabilities:!1,layerOptions:[],styleOptions:[],selectedLayerOptions:[],selectedStyleOptions:[]}),o()(this,"_previewIfPossible",h.a.debounce((()=>{const{serviceUrl:t,layers:e,styles:n}=this.state,i=t&&e?{serviceUrl:t,layers:e,styles:n}:null;this.props.onSourceConfigChange(i)}),2e3)),o()(this,"_loadCapabilities",(async()=>{if(!this.state.serviceUrl)return;this.setState({hasAttemptedToLoadCapabilities:!0,isLoadingCapabilities:!0,getCapabilitiesError:null});const t=new u.a({serviceUrl:this.state.serviceUrl});let e;try{e=await t.getCapabilities()}catch(t){return void(this._isMounted&&this.setState({isLoadingCapabilities:!1,getCapabilitiesError:t.message}))}this._isMounted&&this.setState({isLoadingCapabilities:!1,layerOptions:e.layers,styleOptions:e.styles})})),o()(this,"_handleServiceUrlChange",(t=>{this.setState({serviceUrl:t.target.value,hasAttemptedToLoadCapabilities:!1,layerOptions:[],styleOptions:[],selectedLayerOptions:[],selectedStyleOptions:[],layers:"",styles:""},this._previewIfPossible)})),o()(this,"_handleLayersChange",(t=>{this.setState({layers:t.target.value},this._previewIfPossible)})),o()(this,"_handleLayerOptionsChange",(t=>{this.setState({selectedLayerOptions:t,layers:t.map((t=>t.value)).join(",")},this._previewIfPossible)})),o()(this,"_handleStylesChange",(t=>{this.setState({styles:t.target.value},this._previewIfPossible)})),o()(this,"_handleStyleOptionsChange",(t=>{this.setState({selectedStyleOptions:t,styles:t.map((t=>t.value)).join(",")},this._previewIfPossible)}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}_renderLayerAndStyleInputs(){return!this.state.hasAttemptedToLoadCapabilities||this.state.isLoadingCapabilities?null:this.state.getCapabilitiesError||0===this.state.layerOptions.length?Object(d.jsx)(i.Fragment,null,Object(d.jsx)(l.EuiSpacer,null),Object(d.jsx)(l.EuiCallOut,{title:r.i18n.translate("xpack.maps.source.wms.getCapabilitiesErrorCalloutTitle",{defaultMessage:"Unable to load service metadata"}),color:"warning"},Object(d.jsx)("p",null,this.state.getCapabilitiesError)),Object(d.jsx)(l.EuiSpacer,null),Object(d.jsx)(l.EuiFormRow,{label:p,helpText:r.i18n.translate("xpack.maps.source.wms.layersHelpText",{defaultMessage:"Use comma separated list of layer names"})},Object(d.jsx)(l.EuiFieldText,{onChange:this._handleLayersChange})),Object(d.jsx)(l.EuiFormRow,{label:f,helpText:r.i18n.translate("xpack.maps.source.wms.stylesHelpText",{defaultMessage:"Use comma separated list of style names"})},Object(d.jsx)(l.EuiFieldText,{onChange:this._handleStylesChange}))):Object(d.jsx)(i.Fragment,null,Object(d.jsx)(l.EuiFormRow,{label:p},Object(d.jsx)(l.EuiComboBox,{options:this.state.layerOptions,selectedOptions:this.state.selectedLayerOptions,onChange:this._handleLayerOptionsChange})),Object(d.jsx)(l.EuiFormRow,{label:f},Object(d.jsx)(l.EuiComboBox,{options:this.state.styleOptions,selectedOptions:this.state.selectedStyleOptions,onChange:this._handleStyleOptionsChange})))}_renderGetCapabilitiesButton(){return!this.state.isLoadingCapabilities&&this.state.hasAttemptedToLoadCapabilities?null:Object(d.jsx)(i.Fragment,null,Object(d.jsx)(l.EuiButton,{onClick:this._loadCapabilities,isDisabled:!this.state.serviceUrl,isLoading:this.state.isLoadingCapabilities},Object(d.jsx)(a.FormattedMessage,{id:"xpack.maps.source.wms.getCapabilitiesButtonText",defaultMessage:"Load capabilities"})))}render(){return Object(d.jsx)(l.EuiPanel,null,Object(d.jsx)(l.EuiFormRow,{label:r.i18n.translate("xpack.maps.source.wms.urlLabel",{defaultMessage:"Url"})},Object(d.jsx)(l.EuiFieldText,{value:this.state.serviceUrl,onChange:this._handleServiceUrlChange})),this._renderGetCapabilitiesButton(),this._renderLayerAndStyleInputs())}}var g=n(246),m=n(176),_=n(0);const y={id:_.Jb.WMS_LAYER,order:10,categories:[_.ab.REFERENCE],description:r.i18n.translate("xpack.maps.source.wmsDescription",{defaultMessage:"Maps from OGC Standard WMS"}),icon:()=>Object(d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(d.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M30.766 14.01l1.602-12.954-1.389.237c-.744.253-1.768.38-2.702.45a43.28 43.28 0 01-1.259.07l-.092.004c-.312.014-.57.026-.72.042a1.895 1.895 0 00-.558.168c-.156.07-.316.156-.47.238l-.057.03c-.356.191-.687.358-1.025.4l-1.308.339v5.863c0 .698.142 2.17 0 3.443l-.204 1.67h8.182zM20.871 2.748c-.656.039-1.247.282-2.06.4l-.702.102c-.583.086-1.16.172-1.693.238-.75.093-1.389.145-1.82.113-.592-.044-1.124.341-1.61.843-.453.467-.926 1.1-1.429 1.777l-.144.193c-1.132 1.517-2.452 3.218-4.22 4.101-.214.108-.346.313-.432.528-.087.22-.14.489-.172.78-.064.587-.047 1.325.007 2.083.071 1.01.211 2.102.32 2.956.054.42.1.783.128 1.05.08.78-.128 1.769-.37 2.653-.088.319-.178.616-.258.882-.03.1-.06.195-.086.285a9.67 9.67 0 00-.12.434 1.518 1.518 0 00-.054.334c0 .279.11.577.283.842.175.268.426.52.735.708l.067.04.079-.001c4.133-.068 10.22-.554 10.972-.638a.582.582 0 00.334-.17c.083-.08.157-.182.224-.293.134-.223.264-.524.388-.867.249-.69.495-1.6.72-2.52.162-.654.545-1.41.683-2.01l.784-2.796c.066-.379.198-1.13.272-1.705.146-1.148-.01-2.54.097-3.999.107-1.458.171-2.917.146-4.052a10.13 10.13 0 00-.112-1.438 2.469 2.469 0 00-.131-.495c-.053-.128-.276-.358-.276-.358h-.55zm10.931 12.621s-1.169-.652-1.548-.642c-.757.019-1.298-.026-2.352 0h-5.489l-2.863 8.915c.2.066 1.938.444 2.242.447.62.005 1.478-.08 2.393-.197.88-.113 1.824-.258 2.678-.389l.113-.017a49.753 49.753 0 012.166-.305c.347-.034.996-.024 1.858-.007l.127.003c.827.017 1.819.037 2.869.023 2.198-.029 4.694-.204 6.5-.887 1.42-.538 2.099-.87 2.513-1.34.414-.468.575-1.576.575-1.576s-2.907.868-4.807.784c-.927-.04-1.508.045-2.352-.34-1.429-.652-1.206-2.221-2.43-3.205-.77-.62-2.193-1.267-2.193-1.267z"}),Object(d.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M33.322 1.125S31.277 14.3 31.72 14.522c.786.393 2.012.665 3.137 1.67 1.23 1.1 1.172 2.5 2.318 3.24.835.538 6.525-.704 6.525-.704l.228-7.956s-.174-4.5-.89-5.216c-.715-.716-2.488-1.125-3-2.08-1.115-2.08-3.068-2.351-3.068-2.351h-3.648z"})),renderWizard:({previewLayers:t})=>Object(d.jsx)(wms_create_source_editor_WMSCreateSourceEditor,{onSourceConfigChange:e=>{if(!e)return void t([]);const n=m.a.createDescriptor({sourceDescriptor:g.a.createDescriptor(e)});t([n])}}),title:g.b}},257:function(t,e,n){"use strict";n.d(e,"a",(function(){return geojson_file_source_GeoJsonFileSource}));var i=n(106),r=n(0),s=n(325),o=n(189);class geojson_file_source_GeoJsonFileSource extends i.a{static createDescriptor(t){return{type:r.Cb.GEOJSON_FILE,__featureCollection:(e=t.__featureCollection,e?"FeatureCollection"===e.type?e:"Feature"===e.type?{type:"FeatureCollection",features:[e]}:r.z:r.z),__fields:t.__fields||[],areResultsTrimmed:void 0!==t.areResultsTrimmed&&t.areResultsTrimmed,tooltipContent:t.tooltipContent?t.tooltipContent:null,name:t.name||"Features"};var e}constructor(t){super(geojson_file_source_GeoJsonFileSource.createDescriptor(t))}_getFieldDescriptors(){return this._descriptor.__fields||[]}_createField(t){return new o.a({fieldName:t.name,source:this,origin:r.D.SOURCE,dataType:t.type})}async getFields(){return this._getFieldDescriptors().map((t=>this._createField(t)))}getFieldByName(t){const e=this._getFieldDescriptors().find((e=>e.name===t));return e?this._createField(e):null}isBoundsAware(){return!0}async getBoundsForFilters(t,e){const n=this.getFeatureCollection();return Object(s.a)(n,!1)}async getGeoJsonWithMeta(){return{data:this.getFeatureCollection(),meta:{}}}async getDisplayName(){return this._descriptor.name}hasTooltipProperties(){return!0}getSourceStatus(){return{tooltipContent:this._descriptor.tooltipContent,areResultsTrimmed:this._descriptor.areResultsTrimmed}}getFeatureCollection(){return this._descriptor.__featureCollection}}},262:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return SavedMap}));var i=n(6),r=n.n(i),s=n(53),o=n.n(s),a=n(19),l=n(3),u=n(0),c=n(623),h=n(89),d=n(90),p=n(94),f=n(592),g=n(593),m=n(5),_=n(134),y=n(191),v=n(110),b=n(157),x=n(24),E=n(165),S=n(625),C=n(97),O=n(172),I=n(334);function w(e){const n=e.customIcons?e.customIcons.map((e=>({...e,svg:t.from(e.svg,"base64").toString("utf-8")}))):[];return Object(d.jb)({...e,customIcons:n})}class SavedMap{constructor({defaultLayers:t=[],mapSerializedState:e,embeddableId:n,onSaveCallback:i,originatingApp:s,stateTransfer:a,originatingPath:l,defaultLayerWizard:u}){r()(this,"_attributes",null),r()(this,"_sharingSavedObjectProps",null),r()(this,"_defaultLayers",void 0),r()(this,"_embeddableId",void 0),r()(this,"_initialLayerListConfig",[]),r()(this,"_mapSerializedState",void 0),r()(this,"_onSaveCallback",void 0),r()(this,"_originatingApp",void 0),r()(this,"_originatingPath",void 0),r()(this,"_stateTransfer",void 0),r()(this,"_store",void 0),r()(this,"_tags",[]),r()(this,"_defaultLayerWizard",void 0),r()(this,"_managed",void 0),r()(this,"hasUnsavedChanges",(()=>{if(!this._attributes)throw new Error("Invalid usage, must await whenReady before calling hasUnsavedChanges");const t=this._attributes.layerListJSON?JSON.parse(this._attributes.layerListJSON):null,e=Object(h.o)(this._store.getState());return t?!o.a.isEqual(JSON.parse(JSON.stringify(e)),t):!o.a.isEqual(e,this._initialLayerListConfig)})),r()(this,"getAppNameFromId",(t=>this._getStateTransfer().getAppNameFromId(t))),this._defaultLayers=t,this._mapSerializedState=e,this._embeddableId=n,this._onSaveCallback=i,this._originatingApp=s,this._originatingPath=l,this._stateTransfer=a,this._store=Object(c.a)(),this._defaultLayerWizard=u||"",this._managed=!1}getStore(){return this._store}async whenReady(){var t,e,n,i,r,s,o,a,l,u,c;if(await Object(x.g)(),null!==(t=this._mapSerializedState)&&void 0!==t&&t.savedObjectId){const{attributes:t,managed:e,references:n,sharingSavedObjectProps:i}=await Object(f.a)(this._mapSerializedState.savedObjectId);this._attributes=t,i&&(this._sharingSavedObjectProps=i),this._managed=e;const r=Object(m.H)();r&&n&&n.length&&(this._tags=r.ui.getTagIdsFromReferences(n))}else{var h;this._attributes=null!==(h=this._mapSerializedState)&&void 0!==h&&h.attributes?this._mapSerializedState.attributes:{title:""}}if(this._reportUsage(),null!==(e=this._attributes)&&void 0!==e&&e.mapStateJSON)try{const t=JSON.parse(this._attributes.mapStateJSON);if(t.adHocDataViews&&t.adHocDataViews.length>0){const e=Object(m.w)(),n=t.adHocDataViews.map((t=>e.create(t)));await Promise.all(n)}}catch(t){}if(void 0!==(null===(n=this._mapSerializedState)||void 0===n?void 0:n.mapSettings))this._store.dispatch(w(this._mapSerializedState.mapSettings));else if(null!==(i=this._attributes)&&void 0!==i&&i.mapStateJSON)try{const t=JSON.parse(this._attributes.mapStateJSON);t.settings&&this._store.dispatch(w(t.settings))}catch(t){}let p=v.a;if(void 0!==(null===(r=this._mapSerializedState)||void 0===r?void 0:r.isLayerTOCOpen))p=this._mapSerializedState.isLayerTOCOpen;else if(null!==(s=this._attributes)&&void 0!==s&&s.uiStateJSON)try{const t=JSON.parse(this._attributes.uiStateJSON);"isLayerTOCOpen"in t&&(p=t.isLayerTOCOpen)}catch(t){}this._store.dispatch(Object(d.db)(p));let g=[];if(void 0!==(null===(o=this._mapSerializedState)||void 0===o?void 0:o.openTOCDetails))g=this._mapSerializedState.openTOCDetails;else if(null!==(a=this._attributes)&&void 0!==a&&a.uiStateJSON)try{const t=JSON.parse(this._attributes.uiStateJSON);"openTOCDetails"in t&&(g=t.openTOCDetails)}catch(t){}if(this._store.dispatch(Object(d.lb)(g)),void 0!==(null===(l=this._mapSerializedState)||void 0===l?void 0:l.mapCenter))this._store.dispatch(Object(d.bb)({lat:this._mapSerializedState.mapCenter.lat,lon:this._mapSerializedState.mapCenter.lon,zoom:this._mapSerializedState.mapCenter.zoom}));else if(null!==(u=this._attributes)&&void 0!==u&&u.mapStateJSON)try{const t=JSON.parse(this._attributes.mapStateJSON);this._store.dispatch(Object(d.bb)({lat:t.center.lat,lon:t.center.lon,zoom:t.zoom}))}catch(t){}let y=[];if(this._attributes.layerListJSON)try{y=JSON.parse(this._attributes.layerListJSON)}catch(t){throw new Error("Malformed saved object: unable to parse layerListJSON")}else{const t=Object(b.createBasemapLayerDescriptor)();t&&y.push(t),this._defaultLayers.length&&y.push(...this._defaultLayers)}this._store.dispatch(Object(d.T)(y)),void 0!==(null===(c=this._mapSerializedState)||void 0===c?void 0:c.hiddenLayers)&&this._store.dispatch(Object(d.cb)(this._mapSerializedState.hiddenLayers)),this._initialLayerListConfig=Object(_.b)(y),this._defaultLayerWizard&&this._store.dispatch(Object(E.u)(this._defaultLayerWizard))}_getStateTransfer(){if(!this._stateTransfer)throw new Error("stateTransfer not provided in constructor");return this._stateTransfer}_getPageTitle(){return this._mapSerializedState?this.isByValue()?l.i18n.translate("xpack.maps.breadcrumbsEditByValue",{defaultMessage:"Edit map"}):this._attributes.title:l.i18n.translate("xpack.maps.breadcrumbsCreate",{defaultMessage:"Create"})}_reportUsage(){const t=Object(m.U)();if(!t||!this._attributes)return;const e=new S.b(this._attributes),n=new S.a(this._attributes),i={layer:n.getLayerCounts(),scaling:n.getScalingCounts(),resolution:n.getResolutionCounts(),join:n.getJoinCounts(),ems_basemap:n.getBasemapCounts(),settings:{custom_icons_count:e.getCustomIconsCount()}};for(const[e,n]of Object.entries(i))for(const[i,r]of Object.entries(n))t.reportUiCounter(u.e,a.METRIC_TYPE.LOADED,`${e}_${i}`,r)}setBreadcrumbs(t){if(!this._attributes)throw new Error("Invalid usage, must await whenReady before calling hasUnsavedChanges");if(Object(m.K)())Object(m.K)().setBreadcrumbs({text:this._getPageTitle()});else{const e=Object(y.a)({pageTitle:this._getPageTitle(),isByValue:this.isByValue(),getHasUnsavedChanges:this.hasUnsavedChanges,originatingApp:this._originatingApp,getAppNameFromId:this._getStateTransfer().getAppNameFromId,history:t});Object(m.g)().setBreadcrumbs(e)}}getSavedObjectId(){var t;return null!==(t=this._mapSerializedState)&&void 0!==t&&t.savedObjectId?this._mapSerializedState.savedObjectId:void 0}getOriginatingApp(){return this._originatingApp}getOriginatingAppName(){return this._originatingApp?this.getAppNameFromId(this._originatingApp):void 0}hasOriginatingApp(){return!!this._originatingApp}getOriginatingPath(){return this._originatingPath}getTags(){return this._tags}hasSaveAndReturnConfig(){return this.hasOriginatingApp()}getTitle(){if(!this._attributes)throw new Error("Invalid usage, must await getTitle before calling getAttributes");return void 0!==this._attributes.title?this._attributes.title:""}getAttributes(){if(!this._attributes)throw new Error("Invalid usage, must await whenReady before calling getAttributes");return this._attributes}getAutoFitToBounds(){var t,e;if(void 0!==(null===(t=this._mapSerializedState)||void 0===t||null===(e=t.mapSettings)||void 0===e?void 0:e.autoFitToDataBounds))return this._mapSerializedState.mapSettings.autoFitToDataBounds;if(!this._attributes||!this._attributes.mapStateJSON)return!1;try{const t=JSON.parse(this._attributes.mapStateJSON);if(void 0!==(null==t?void 0:t.settings.autoFitToDataBounds))return t.settings.autoFitToDataBounds}catch(t){}return!1}getSharingSavedObjectProps(){return this._sharingSavedObjectProps}isManaged(){return this._managed}isByValue(){const t=!!this.getSavedObjectId();return!!this._originatingApp&&!t}async save({newDescription:t,newTitle:e,newCopyOnSave:n,returnToOrigin:i,tags:r,saveByReference:s,dashboardId:o,history:a}){if(!this._attributes)throw new Error("Invalid usage, must await whenReady before calling save");const c=this._attributes.title,h=this._attributes.description;let d;if(this._attributes.title=e,this._attributes.description=t,await this._syncAttributesWithStore(),s)try{var p;const{attributes:t,references:e}=Object(O.a)({attributes:this._attributes}),i=Object(m.H)(),s=i&&r?i.ui.updateTagsReferences([],r):[],{id:o}=await Object(g.a)(t,[...e,...s],n||null===(p=this._mapSerializedState)||void 0===p?void 0:p.savedObjectId);d=Object(I.a)(this._mapSerializedState,o)}catch(t){return this._attributes.title=c,this._attributes.description=h,void Object(m.R)().addDanger({title:l.i18n.translate("xpack.maps.saveToLibraryError",{defaultMessage:"An error occurred while saving. Error: {errorMessage}",values:{errorMessage:t.message}})})}else d=Object(I.b)(this._mapSerializedState,this._attributes);if(r&&(this._tags=r),i)return this._originatingApp?void await this._getStateTransfer().navigateToWithEmbeddablePackage(this._originatingApp,{state:{embeddableId:n?void 0:this._embeddableId,type:u.fb,input:d},path:this._originatingPath}):void Object(m.R)().addDanger({title:l.i18n.translate("xpack.maps.topNav.saveErrorTitle",{defaultMessage:"Error saving ''{title}''",values:{title:e}}),text:l.i18n.translate("xpack.maps.topNav.saveErrorText",{defaultMessage:"Unable to return to app without an originating app"})});o?await this._getStateTransfer().navigateToWithEmbeddablePackage("dashboards",{state:{type:u.fb,input:d},path:"new"===o?"#/create":`#/view/${o}`}):(this._mapSerializedState=d,this._originatingApp=void 0,this._getStateTransfer().clearEditorState(u.e),Object(m.R)().addSuccess({title:l.i18n.translate("xpack.maps.topNav.saveSuccessMessage",{defaultMessage:"Saved ''{title}''",values:{title:e}})}),Object(m.g)().docTitle.change(e),this.setBreadcrumbs(a),a.push(`/${u.eb}/${this.getSavedObjectId()}${window.location.hash}`),this._onSaveCallback&&this._onSaveCallback())}async _syncAttributesWithStore(){const e=this._store.getState(),n=Object(h.p)(e),i=Object(_.b)(n);this._attributes.layerListJSON=JSON.stringify(i);const r=Object(h.w)(e);this._attributes.mapStateJSON=JSON.stringify({adHocDataViews:await this._getAdHocDataViews(),zoom:Object(h.x)(e),center:Object(h.r)(e),timeFilters:Object(h.J)(e),refreshConfig:{isPaused:Object(m.Q)().getRefreshInterval().pause,interval:Object(m.Q)().getRefreshInterval().value},query:Object(h.B)(e),filters:Object(h.h)(e),settings:{...r,customIcons:r.customIcons.map((e=>({...e,svg:t.from(e.svg).toString("base64")})))}}),this._attributes.uiStateJSON=JSON.stringify({isLayerTOCOpen:Object(p.f)(e),openTOCDetails:Object(p.i)(e)})}async _getAdHocDataViews(){const t=[];return Object(h.n)(this._store.getState()).forEach((e=>{t.push(...e.getIndexPatternIds())})),(await Object(C.e)(o.a.uniq(t))).filter((t=>!t.isPersisted())).map((t=>t.toSpec(!1)))}}}).call(this,n(143).Buffer)},330:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n(2);var i=n(14),r=n(3),s=n(4);function o({applyForceRefresh:t,setApplyForceRefresh:e}){return Object(s.jsx)(i.EuiFormRow,{display:"columnCompressedSwitch"},Object(s.jsx)(i.EuiToolTip,{position:"top",content:r.i18n.translate("xpack.maps.filterEditor.applyForceRefreshTooltip",{defaultMessage:'When on, layer re-fetches data when automatic refresh fires and when "Refresh" is clicked.'})},Object(s.jsx)(i.EuiSwitch,{label:r.i18n.translate("xpack.maps.filterEditor.applyForceRefreshLabel",{defaultMessage:"Re-fetch layer data on refresh"}),checked:t,onChange:t=>{e(t.target.checked)},"data-test-subj":"mapLayerPanelRespondToForceRefreshCheckbox",compressed:!0})))}},332:function(t,e,n){"use strict";n.d(e,"a",(function(){return WmsClient}));var i=n(53),r=n.n(i),s=n(319),o=n(333),a=n.n(o),l=n(219);class WmsClient{constructor({serviceUrl:t}){this._serviceUrl=t}async _fetch(t){return a()(t)}_createUrl(t){const e=Object(l.parse)(this._serviceUrl,!0),n={...e.query,...t};return Object(l.format)({protocol:e.protocol,hostname:e.hostname,port:e.port,pathname:e.pathname,query:n})}getUrlTemplate(t,e){return`${this._createUrl({format:"image/png",service:"WMS",version:"1.1.1",request:"GetMap",srs:"EPSG:3857",transparent:"true",width:"256",height:"256",layers:t,styles:e})}&bbox={bbox-epsg-3857}`}async _fetchCapabilities(){const t=Object(l.parse)(this._serviceUrl,!0),e={...t.query,version:"1.1.1",request:"GetCapabilities",service:"WMS"},n=await this._fetch(Object(l.format)({protocol:t.protocol,hostname:t.hostname,port:t.port,pathname:t.pathname,query:e}));if(n.status>=400)throw new Error(`Unable to access ${this.state.serviceUrl}`);const i=await n.text();return await Object(s.a)(i)}async getCapabilities(){const t=await this._fetchCapabilities(),{layers:e,styles:n}=u([],r.a.get(t,"WMT_MS_Capabilities.Capability[0].Layer",[]));return{layers:c(e),styles:c(n)}}}function u(t,e){function n(t,e,n){return{path:[...t,e],value:n}}return e.reduce(((e,i)=>{if(i.Layer){const n=u([...t,i.Title[0]],i.Layer);return{layers:[...e.layers,...n.layers],styles:[...e.styles,...n.styles]}}const s=[...e.styles];return r.a.has(i,"Style[0]")&&s.push(n(t,r.a.get(i,"Style[0].Title[0]",""),r.a.get(i,"Style[0].Name[0]",""))),{layers:[...e.layers,n(t,r.a.get(i,"Title[0]",""),r.a.get(i,"Name[0]",""))],styles:s}}),{layers:[],styles:[]})}function c(t){if(0===t.length)return[];let e=0;t.forEach((({path:t})=>{t.length>e&&(e=t.length)}));let n=t[0].path;for(let e=1;e<t.length&&0!==n.length;e++){const i=t[e].path;for(let t=0;t<i.length&&t<n.length;t++)if(n[t]!==i[t]){n=n.slice(0,t);break}}const i=new Map,r=t.map((({path:t,value:e})=>{const r=t[t.length-1],s=n.length===t.length?r:t.splice(n.length).join(" - "),o=r===e?s:`${s} (${e})`;let a;if(i.has(o)){const t=i.get(o)+1;i.set(o,t),a=`${o}:${t}`}else i.set(o,0),a=o;return{label:a,value:e}}));return 0===n.length||n.length===e?r:[{label:n.join(" - "),options:r}]}},333:function(t,e,n){"use strict";(function(n){var i=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=i.fetch,i.fetch&&(e.default=i.fetch.bind(i)),e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response}).call(this,n(118))},334:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return l}));var i=n(5),r=n(29),s=n(0);function o(t,e){const{attributes:n,...i}=null!=t?t:{};return{...i,savedObjectId:e}}function a(t,e){const{savedObjectId:n,...i}=null!=t?t:{};return{...i,attributes:e}}function l(t,e){return{canLinkToLibrary:async()=>{const{maps:e}=Object(i.f)().application.capabilities;return e.save&&void 0===t.getSavedObjectId()},saveToLibrary:async t=>{var n,i,s;const o=e(),{item:{id:a}}=await Object(r.b)().create({data:{...null!==(n=null===(i=o.rawState)||void 0===i?void 0:i.attributes)&&void 0!==n?n:{},title:t},options:{references:null!==(s=o.references)&&void 0!==s?s:[]}});return a},getByReferenceState:t=>o(e().rawState,t),checkForDuplicateTitle:async(t,e,n)=>{await Object(r.a)({title:t,copyOnSave:!1,lastSavedTitle:"",isTitleDuplicateConfirmed:e,getDisplayName:()=>s.db,onTitleDuplicate:n},{overlays:Object(i.i)()})},canUnlinkFromLibrary:async()=>void 0!==t.getSavedObjectId(),getByValueState:()=>a(e().rawState,t.getAttributes())}}},335:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(1),r=n(89);function s(t){return Object(i.from)(t).pipe(Object(i.debounceTime)(300),Object(i.switchMap)((async t=>{const e=Object(r.x)(t),n=Object(r.n)(t).map((async t=>({isFilteredByGlobalTime:await t.isFilteredByGlobalTime(),layer:t,zoom:e})));return await Promise.all(n)})),Object(i.first)((t=>!t.filter((({isFilteredByGlobalTime:t})=>t)).some((({layer:t,zoom:e})=>t.isLayerLoading(e))))),Object(i.map)((()=>{})))}},339:function(t,e,n){"use strict";n.d(e,"a",(function(){return Ln}));var i=n(55),r=n(18),s=n.n(r),o=n(6),a=n.n(o),l=(n(594),n(2)),u=n.n(l),c=n(57),h=n.n(c),d=n(14),p=n(3),f=n(56),g=n(4),m=n(109),_=n.n(m),y=n(32),v=n.n(y);n(609);const b=p.i18n.translate("sharedUXPackages.exitFullScreenButton.exitFullScreenModeButtonText",{defaultMessage:"Exit full screen"}),x=p.i18n.translate("sharedUXPackages.exitFullScreenButton.fullScreenModeDescription",{defaultMessage:"In full screen mode, press ESC to exit."}),E=({onClick:t,className:e,customLogo:n})=>{const{euiTheme:i}=Object(d.useEuiTheme)(),{colors:r,size:s,border:o}=i,a=Object(g.css)("padding:",s.xs," ",s.s,";background:",r.fullShade,";border-radius:",o.radius.small,";height:",s.xl,";color:",Object(d.makeHighContrastColor)(r.emptyShade)(r.fullShade),";outline-color:",r.emptyShade,";","");return Object(g.jsx)("div",null,Object(g.jsx)(d.EuiScreenReaderOnly,null,Object(g.jsx)("p",{"aria-live":"polite"},x)),Object(g.jsx)("button",{css:a,className:h()("exitFullScreenButton",e),onClick:t,"data-test-subj":"exitFullScreenModeButton"},Object(g.jsx)(d.EuiFlexGroup,{component:"span",responsive:!1,alignItems:"center",gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,{component:"span",grow:!1},n?Object(g.jsx)(d.EuiImage,{src:n,size:16,alt:"customLogo"}):Object(g.jsx)(d.EuiIcon,{type:"logoElastic",size:"m"})),Object(g.jsx)(d.EuiFlexItem,{component:"span",grow:!1,"data-test-subj":"exitFullScreenModeText"},b),Object(g.jsx)(d.EuiFlexItem,{component:"span",grow:!1},Object(g.jsx)(d.EuiIcon,{type:"fullScreenExit",size:"s"})))))};var S=n(608);const C=({onExit:t=(()=>{}),toggleChrome:e=!0})=>{const{euiTheme:n}=Object(d.useEuiTheme)(),{setIsFullscreen:i,customBranding$:r}=Object(S.b)(),s=_()(),o=v()(r),a=null==o?void 0:o.logo,u=Object(l.useCallback)((()=>{e&&i(!1),t()}),[t,i,e]),c=Object(l.useCallback)((t=>{t.key===d.keys.ESCAPE&&u()}),[u]);Object(l.useEffect)((()=>(document.addEventListener("keydown",c,!1),e&&i(!0),()=>{u(),document.removeEventListener("keydown",c,!1)})),[c,e,i,u]),Object(l.useEffect)((()=>{!s()&&e&&i(!1)}),[s,i,e]);const h=Object(g.css)("bottom:",n.size.s,";left:",n.size.s,";position:fixed;z-index:5;","");return Object(g.jsx)(E,{css:h,customLogo:a,onClick:u})};var O=n(53),I=n.n(O),w=n(599),L=n(321),T=n(19),j=n(0),N=n(93),M=n(5),F=n(600),P=n.n(F),R=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],D=n(601),A=n.n(D),k=n(243),G=n.n(k),B=n(266),z=n.n(B);const q="draw-circle-radius",V={id:"gl-draw-radius-label",type:"symbol",filter:["==","meta",q],layout:{"text-anchor":"right","text-field":"{radiusLabel}","text-size":16,"text-offset":[-1,0],"text-ignore-placement":!0,"text-allow-overlap":!0},paint:{"text-color":"#fbb03b","text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":2}},U={onSetup(){const t=this.newFeature({type:"Feature",properties:{center:null,edge:null,radiusKm:0},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{circle:t}},onKeyUp(t,e){27===e.keyCode&&(t.circle.properties.center=null,t.circle.properties.radiusKm=0,t.circle.incomingCoords([[]]))},onClick(t,e){t.circle.properties.center?(this.updateUIClasses({mouse:"pointer"}),t.circle.properties.radiusKm=G()(t.circle.properties.center,[e.lngLat.lng,e.lngLat.lat]),this.changeMode("simple_select",{featuresId:t.circle.id})):t.circle.properties.center=[e.lngLat.lng,e.lngLat.lat]},onMouseMove(t,e){if(!t.circle.properties.center)return;const n=[e.lngLat.lng,e.lngLat.lat];t.circle.properties.edge=n,t.circle.properties.radiusKm=G()(t.circle.properties.center,n);const i=z()(t.circle.properties.center,t.circle.properties.radiusKm);t.circle.incomingCoords(i.geometry.coordinates)},onStop(t){this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(t.circle.id)&&(t.circle.properties.center&&t.circle.properties.radiusKm>0?this.map.fire("draw.create",{features:[t.circle.toGeoJSON()]}):(this.deleteFeature([t.circle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures(t,e,n){if(!t.circle.properties.center||!t.circle.properties.edge)return null;e.properties.active="true";let i="";i=t.circle.properties.radiusKm<=1?`${Math.round(1e3*t.circle.properties.radiusKm)} m`:t.circle.properties.radiusKm<=10?`${t.circle.properties.radiusKm.toFixed(1)} km`:`${Math.round(t.circle.properties.radiusKm)} km`,n({type:"Feature",properties:{meta:q,parent:t.circle.id,radiusLabel:i,active:"false"},geometry:{type:"Point",coordinates:t.circle.properties.edge}}),n({type:"Feature",properties:{meta:"draw-circle-radius-line",parent:t.circle.id,active:"true"},geometry:{type:"LineString",coordinates:[t.circle.properties.center,t.circle.properties.edge]}}),n(e)},onTrash(t){this.deleteFeature([t.circle.id],{silent:!0}),this.changeMode("simple_select")}},W=()=>{};class draw_tooltip_DrawTooltip extends l.Component{constructor(...t){super(...t),a()(this,"_popoverRef",u.a.createRef()),a()(this,"_isMounted",!1),a()(this,"state",{x:void 0,y:void 0,isOpen:!1}),a()(this,"_hideTooltip",(()=>{this._updateTooltipLocation.cancel(),this.setState({isOpen:!1})})),a()(this,"_updateTooltipLocation",I.a.throttle((({lngLat:t})=>{const e=this.props.mbMap.project(t);this._isMounted&&this.setState({isOpen:!0,x:e.x,y:e.y})}),100))}componentDidMount(){this._isMounted=!0,this.props.mbMap.on("mousemove",this._updateTooltipLocation),this.props.mbMap.on("mouseout",this._hideTooltip)}componentDidUpdate(){this._popoverRef.current&&this._popoverRef.current.positionPopoverFluid()}componentWillUnmount(){this._isMounted=!1,this.props.mbMap.off("mousemove",this._updateTooltipLocation),this.props.mbMap.off("mouseout",this._hideTooltip),this._updateTooltipLocation.cancel()}render(){if(void 0===this.state.x||void 0===this.state.y)return null;let t;if(this.props.drawShape===j.y.BOUNDS)t=p.i18n.translate("xpack.maps.drawTooltip.boundsInstructions",{defaultMessage:"Click to start rectangle. Move mouse to adjust rectangle size. Click again to finish."});else if(this.props.drawShape===j.y.DISTANCE)t=p.i18n.translate("xpack.maps.drawTooltip.distanceInstructions",{defaultMessage:"Click to set point. Move mouse to adjust distance. Click to finish."});else if(this.props.drawShape===j.y.POLYGON)t=p.i18n.translate("xpack.maps.drawTooltip.polygonInstructions",{defaultMessage:"Click to start shape. Click to add vertex. Double click to finish."});else if(this.props.drawShape===j.y.LINE)t=p.i18n.translate("xpack.maps.drawTooltip.lineInstructions",{defaultMessage:"Click to start line. Click to add vertex. Double click to finish."});else if(this.props.drawShape===j.y.POINT)t=p.i18n.translate("xpack.maps.drawTooltip.pointInstructions",{defaultMessage:"Click to create point."});else{if(this.props.drawShape!==j.y.DELETE)return null;t=p.i18n.translate("xpack.maps.drawTooltip.deleteInstructions",{defaultMessage:"Click feature to delete."})}const e=Object(g.jsx)("div",{style:{height:"26px",width:"26px",background:"transparent"}});return Object(g.jsx)(d.EuiPopover,{id:"drawInstructionsTooltip",button:e,anchorPosition:"rightCenter",isOpen:this.state.isOpen,closePopover:W,ref:this._popoverRef,style:{pointerEvents:"none",transform:`translate(${this.state.x-13}px, ${this.state.y-13}px)`}},Object(g.jsx)(d.EuiText,{color:"subdued",size:"xs"},t))}}const Y="draw_rectangle",H="draw_circle",J=P.a.modes;J[Y]=A.a,J[H]=U;class draw_control_DrawControl extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_isMapRemoved",!1),a()(this,"_mbDrawControlAdded",!1),a()(this,"_mbDrawControl",new P.a({displayControlsDefault:!1,modes:J,styles:[...R,V]})),a()(this,"_setIsMapRemoved",(()=>{this._isMapRemoved=!0})),a()(this,"_onDraw",(t=>{this.props.onDraw(t,this._mbDrawControl)})),a()(this,"_onClick",(t=>{this.props.onClick&&this.props.onClick(t,this._mbDrawControl)})),a()(this,"_syncDrawControl",I.a.debounce((()=>{this._isMounted&&(this.props.enable?this._updateDrawControl():this._removeDrawControl())}),0))}componentDidUpdate(){this._syncDrawControl()}componentDidMount(){this._isMounted=!0,this.props.mbMap.on("remove",this._setIsMapRemoved),this._syncDrawControl()}componentWillUnmount(){this._isMounted=!1,this.props.mbMap.off("remove",this._setIsMapRemoved),this._removeDrawControl()}_removeDrawControl(){this._mbDrawControlAdded&&!this._isMapRemoved&&(this.props.mbMap.getCanvas().style.cursor="",this.props.mbMap.off("draw.create",this._onDraw),this.props.onClick&&this.props.mbMap.off("click",this._onClick),this.props.mbMap.removeControl(this._mbDrawControl),this._mbDrawControlAdded=!1)}_updateDrawControl(){this._mbDrawControlAdded||(this.props.mbMap.addControl(this._mbDrawControl),this._mbDrawControlAdded=!0,this.props.mbMap.on("draw.create",this._onDraw),this.props.onClick&&this.props.mbMap.on("click",this._onClick)),this.props.mbMap.getCanvas().style.cursor=this.props.drawShape&&this.props.drawShape!==j.y.SIMPLE_SELECT?"crosshair":"";const{DRAW_LINE_STRING:t,DRAW_POLYGON:e,DRAW_POINT:n,SIMPLE_SELECT:i}=this._mbDrawControl.modes,r=this._mbDrawControl.getMode();r!==Y&&this.props.drawShape===j.y.BOUNDS?this._mbDrawControl.changeMode(Y):r!==H&&this.props.drawShape===j.y.DISTANCE?this._mbDrawControl.changeMode(H):r!==e&&this.props.drawShape===j.y.POLYGON?this._mbDrawControl.changeMode(e):r!==t&&this.props.drawShape===j.y.LINE?this._mbDrawControl.changeMode(t):r!==n&&this.props.drawShape===j.y.POINT?this._mbDrawControl.changeMode(n):this.props.drawShape===j.y.DELETE?this._mbDrawControl.changeMode(i):this.props.drawShape===j.y.WAIT?(this.props.mbMap.getCanvas().style.cursor="wait",this._mbDrawControl.changeMode(i)):(r!==i&&!this.props.drawShape||this.props.drawShape===j.y.SIMPLE_SELECT)&&this._mbDrawControl.changeMode(i)}render(){return this.props.drawShape?Object(g.jsx)(draw_tooltip_DrawTooltip,{mbMap:this.props.mbMap,drawShape:this.props.drawShape}):null}}class draw_filter_control_DrawFilterControl extends l.Component{constructor(...t){super(...t),a()(this,"_onDraw",(async t=>{if(!t.features.length||!this.props.drawState||!this.props.geoFieldNames.length)return;let e;if(this.props.drawState.drawShape===j.y.DISTANCE){const n=t.features[0],i=I.a.round(n.properties.radiusKm,n.properties.radiusKm>10?0:2);let r=2;i<=1?r=5:i<=10?r=4:i<=100&&(r=3),e=Object(N.g)({alias:this.props.drawState.filterLabel?this.props.drawState.filterLabel:"",distanceKm:i,geoFieldNames:this.props.geoFieldNames,point:[I.a.round(n.properties.center[0],r),I.a.round(n.properties.center[1],r)]})}else{const n=t.features[0].geometry;Object(N.p)(n.coordinates),e=Object(N.c)({geometry:this.props.drawState.drawShape===j.y.BOUNDS?Object(N.k)(n):n,geoFieldNames:this.props.geoFieldNames,geometryLabel:this.props.drawState.geometryLabel?this.props.drawState.geometryLabel:"",relation:this.props.drawState.relation?this.props.drawState.relation:"intersects"})}try{await this.props.addFilters([e],this.props.drawState.actionId)}catch(t){Object(M.R)().addWarning(p.i18n.translate("xpack.maps.drawFilterControl.unableToCreatFilter",{defaultMessage:"Unable to create filter, error: ''{errorMsg}''.",values:{errorMsg:t.message}}))}finally{this.props.disableDrawState()}}))}render(){return Object(g.jsx)(draw_control_DrawControl,{drawShape:this.props.filterModeActive&&this.props.drawState?this.props.drawState.drawShape:void 0,onDraw:this._onDraw,mbMap:this.props.mbMap,enable:this.props.filterModeActive})}}var X=n(90),Z=n(89),Q=n(94);const K=Object(i.connect)((function(t){return{drawState:Object(Z.e)(t),filterModeActive:Object(Q.c)(t)===j.x.DRAW_FILTERS,geoFieldNames:Object(Z.i)(t)}}),(function(t){return{disableDrawState(){t(Object(X.xb)(null)),t(Object(X.W)(j.x.NONE))}}}))(draw_filter_control_DrawFilterControl);class scale_control_ScaleControl extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{label:"",width:0}),a()(this,"_onUpdate",(()=>{if(!this._isMounted)return;const t=this.props.mbMap.getContainer().clientHeight/2,e=this.props.mbMap.unproject([0,t]),n=this.props.mbMap.unproject([110,t]),i=e.distanceTo(n);i>=1e3?this._setScale(i/1e3,p.i18n.translate("xpack.maps.kilometersAbbr",{defaultMessage:"km"})):this._setScale(i,p.i18n.translate("xpack.maps.metersAbbr",{defaultMessage:"m"}))}))}componentDidMount(){this._isMounted=!0,this.props.mbMap.on("move",this._onUpdate),this._onUpdate()}componentWillUnmount(){this._isMounted=!1,this.props.mbMap.off("move",this._onUpdate)}_setScale(t,e){const n=function(t){const e=Math.floor(Math.log10(t)),n=Math.pow(10,e),i=t/n;return i<1?n*(Math.round(10*i)/10):i>=10?10*n:i>=5?5*n:i>=3?3*n:Math.floor(i)*n}(t),i=this.props.mbMap.getZoom(),r=this.props.mbMap.getBounds();let s=`${n} ${e}`;(i<=4||i<=6&&(r.getNorth()>23.5||r.getSouth()<-23.5)||i<=8&&(r.getNorth()>45||r.getSouth()<-45))&&(s="~"+s),this.setState({width:n/t*110,label:s})}render(){return Object(g.jsx)("div",{className:h()("mapScaleControl",{mapScaleControlFullScreen:this.props.isFullScreen}),style:{width:`${this.state.width}px`}},this.state.label)}}var $=n(252);const tt=()=>{};class tooltip_popover_TooltipPopover extends l.Component{constructor(...t){super(...t),a()(this,"_popoverRef",u.a.createRef()),a()(this,"state",{}),a()(this,"_updatePopoverPosition",(()=>{const t=this.props.mbMap.project(this.props.location),e=this.props.location[j.X],n=this.props.location[j.bb],i=this.props.mbMap.getBounds();e<i.getNorth()&&e>i.getSouth()&&n>i.getWest()&&n<i.getEast()?this.setState({x:t.x,y:t.y}):this.props.closeTooltip()})),a()(this,"_loadFeatureProperties",(async({layerId:t,properties:e})=>{const n=this.props.findLayerById(t);return n?await n.getPropertiesForTooltip(e,this.props.executionContext):[]})),a()(this,"_getLayerName",(async t=>{const e=this.props.findLayerById(t);return e?e.getDisplayName():null})),a()(this,"_renderTooltipContent",(()=>{const t={addFilters:this.props.addFilters,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,onSingleValueTrigger:this.props.onSingleValueTrigger,closeTooltip:this.props.closeTooltip,features:this.props.features,isLocked:this.props.isLocked,loadFeatureProperties:this._loadFeatureProperties,loadFeatureGeometry:this.props.loadFeatureGeometry,getLayerName:this._getLayerName};return this.props.renderTooltipContent?this.props.renderTooltipContent(t):Object(g.jsx)(d.EuiText,{size:"xs",style:{maxWidth:"425px"}},Object(g.jsx)($.b,s()({},t,{findLayerById:this.props.findLayerById})))}))}componentDidMount(){this._updatePopoverPosition(),this.props.mbMap.on("move",this._updatePopoverPosition)}componentDidUpdate(){this._popoverRef.current&&this._popoverRef.current.positionPopoverFluid()}componentWillUnmount(){this.props.mbMap.off("move",this._updatePopoverPosition)}render(){if(void 0===this.state.x||void 0===this.state.y)return null;const t=Object(g.jsx)("div",{style:{height:"26px",width:"26px",background:"none"}}),e=26*this.props.index;return Object(g.jsx)(d.EuiPopover,{id:"mapTooltip",button:t,anchorPosition:"upCenter",isOpen:!0,closePopover:tt,ref:this._popoverRef,style:{pointerEvents:"none",transform:`translate(${this.state.x-13-e}px, ${this.state.y-13}px)`},repositionOnScroll:!0},this._renderTooltipContent())}}var et=n(91);function nt(t,e){let n=[t.lng,t.lat];if("Point"===e.geometry.type){const i=e.geometry.coordinates.slice();for(;Math.abs(t.lng-i[j.bb])>180;)i[0]+=t.lng>i[j.bb]?360:-360;n=i}return n}class tooltip_control_TooltipControl extends l.Component{constructor(...t){super(...t),a()(this,"_isMapRemoved",!1),a()(this,"_setIsMapRemoved",(()=>{this._isMapRemoved=!0})),a()(this,"_onSourceData",(t=>{!t.sourceId||t.sourceId===j.Db||"source"!==t.dataType||"vector"!==t.source.type&&"geojson"!==t.source.type||this._updateOpentooltips()})),a()(this,"_updateOpentooltips",I.a.debounce((()=>{if(0===this.props.openTooltips.length)return;const t=this.props.openTooltips.map((t=>{const e=this._getMbFeaturesUnderPointer(this.props.mbMap.project(t.location));return{...t,features:this._getTooltipFeatures(e,t.isLocked,t.id)}})).filter((t=>t.features.length>0));this.props.updateOpenTooltips(t)}),300)),a()(this,"_onMouseout",(()=>{this._updateHoverTooltipState.cancel(),this.props.hasLockedTooltips||this.props.closeOnHoverTooltip()})),a()(this,"_findLayerById",(t=>this.props.layerList.find((e=>e.getId()===t&&Object(et.f)(e))))),a()(this,"_getFeatureGeometry",(({layerId:t,featureId:e})=>{const n=this._findLayerById(t);if(!n||void 0===e)return null;const i=n.getFeatureById(e);return i?i.geometry:null})),a()(this,"_lockTooltip",(t=>{if(this.props.filterModeActive||this.props.drawModeActive)return;this._updateHoverTooltipState.cancel();const e=this._getMbFeaturesUnderPointer(t.point);if(!e.length)return;const n=e[0],i=nt(t.lngLat,n),r=!0,s=Object(f.v4)(),o=this._getTooltipFeatures(e,r,s);0!==o.length&&this.props.openOnClickTooltip({features:o,location:i,isLocked:r,id:s})})),a()(this,"_updateHoverTooltipState",I.a.debounce((t=>{if(this._isMapRemoved)return;if(this.props.filterModeActive||this.props.hasLockedTooltips||this.props.drawModeActive)return;const e=this._getMbFeaturesUnderPointer(t.point);if(!e.length)return void this.props.closeOnHoverTooltip();const n=e[0],i=this._getLayerByMbLayerId(n.layer.id);if(i&&this.props.openTooltips[0]&&this.props.openTooltips[0].features.length){const t=this.props.openTooltips[0].features[0];if(i.getFeatureId(n)===t.id)return}const r=nt(t.lngLat,n),s=!1,o=Object(f.v4)(),a=this._getTooltipFeatures(e,s,o);0!==a.length&&this.props.openOnHoverTooltip({features:a,location:r,isLocked:s,id:o})}),100))}componentDidMount(){this.props.mbMap.on("mouseout",this._onMouseout),this.props.mbMap.on("mousemove",this._updateHoverTooltipState),this.props.mbMap.on("click",this._lockTooltip),this.props.mbMap.on("remove",this._setIsMapRemoved),this.props.mbMap.on("sourcedata",this._onSourceData)}componentWillUnmount(){this.props.mbMap.off("mouseout",this._onMouseout),this.props.mbMap.off("mousemove",this._updateHoverTooltipState),this.props.mbMap.off("click",this._lockTooltip),this.props.mbMap.off("remove",this._setIsMapRemoved),this.props.mbMap.off("sourcedata",this._onSourceData)}_getLayerByMbLayerId(t){return this.props.layerList.find((e=>{const n=e.getMbLayerIds();return Object(et.f)(e)&&n.indexOf(t)>-1}))}_getTooltipFeatures(t,e,n){const i=[];for(let r=0;r<t.length;r++){const s=t[r],o=this._getLayerByMbLayerId(s.layer.id);if(!o||!o.canShowTooltip()||o.areTooltipsDisabled())continue;if(o.getMasks().find((t=>t.isFeatureMasked(s))))continue;const a=o.getFeatureId(s);if(void 0===a)continue;const l=o.getId();let u=!1;for(let t=0;t<i.length;t++){const e=i[t];a!==e.id||l!==e.layerId||(u=!0)}if(!u){const t={...s.properties?s.properties:{},...s.state?s.state:{}},r=e?o.getSource().getFeatureActions({addFilters:this.props.addFilters,featureId:a+"",geoFieldNames:this.props.geoFieldNames,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,getGeojsonGeometry:()=>{const t=o.getFeatureById(a);return t?t.geometry:null},mbFeature:s,onClose:()=>{this.props.closeOnClickTooltip(n)}}):[];(e&&r.length||o.canShowTooltip())&&i.push({id:a,layerId:l,mbProperties:t,actions:r})}}return i}_getMbLayerIdsForTooltips(){return this.props.layerList.reduce(((t,e)=>e.isVisible()&&Object(et.f)(e)?t.concat(e.getMbTooltipLayerIds()):t),[]).filter((t=>!!this.props.mbMap.getLayer(t)))}_getMbFeaturesUnderPointer(t){if(!this.props.mbMap)return[];const e=this._getMbLayerIdsForTooltips(),n=[{x:t.x-2,y:t.y-2},{x:t.x+2,y:t.y+2}];return this.props.mbMap.queryRenderedFeatures(n,{layers:e})}render(){return 0===this.props.openTooltips.length?null:this.props.openTooltips.map((({features:t,location:e,id:n,isLocked:i},r)=>{const s=i?()=>{this.props.closeOnClickTooltip(n)}:this.props.closeOnHoverTooltip;return Object(g.jsx)(tooltip_popover_TooltipPopover,{key:n,mbMap:this.props.mbMap,findLayerById:this._findLayerById,addFilters:this.props.addFilters,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,onSingleValueTrigger:this.props.onSingleValueTrigger,renderTooltipContent:this.props.renderTooltipContent,features:t,location:e,closeTooltip:s,isLocked:i,index:r,loadFeatureGeometry:this._getFeatureGeometry,executionContext:this.props.executionContext})}))}}const it=Object(i.connect)((function(t){return{layerList:Object(Z.n)(t),hasLockedTooltips:Object(Z.k)(t),filterModeActive:Object(Q.c)(t)===j.x.DRAW_FILTERS,drawModeActive:Object(Q.c)(t)===j.x.DRAW_SHAPES||Object(Q.c)(t)===j.x.DRAW_POINTS,openTooltips:Object(Z.A)(t),geoFieldNames:Object(Z.i)(t),executionContext:Object(Z.g)(t)}}),(function(t){return{closeOnClickTooltip(e){t(Object(X.t)(e))},openOnClickTooltip(e){t(Object(X.L)(e))},closeOnHoverTooltip(){t(Object(X.u)())},openOnHoverTooltip(e){t(Object(X.M)(e))},updateOpenTooltips(e){t(Object(X.Lb)(e))}}}))(tooltip_control_TooltipControl);var rt=n(333),st=n.n(rt);let ot,at=null;function lt(){return Object(M.t)().basePath.prepend(`${j.E}/{fontstack}/{range}`)}function ut(t){return t.startsWith("gl-draw")}function ct(t,e,n){if(!t.ownsMbLayerId(e.id))return!1;if(n===ht.ANY)return!0;const i=function(t){if("symbol"!==t.type)return!1;const e=[];return t.paint&&e.push(...Object.keys(t.paint)),t.layout&&e.push(...Object.keys(t.layout)),e.some((t=>t.startsWith("text-")))}(e);return n===ht.LABEL?i:!i}var ht=function(t){return t.ANY="ANY",t.LABEL="LABEL",t.NON_LABEL="NON_LABEL",t}(ht||{});function dt(t,e,n,i,r){e.filter((t=>ct(n,t,i))).forEach((e=>{t.moveLayer(e.id,r)}))}function pt(t,e,n){const i=t.find((t=>ct(e,t,n)));return i?i.id:void 0}function ft(t,e,n,i){const r=t.getStyle().layers;if(!i)return ct(e,r[r.length-1],n);let s=!1,o=null;for(let t=0;t<r.length;t++)if(s){if(!ct(e,r[t],n)){o=r[t].id;break}}else ct(e,r[t],n)&&(s=!0);return o===i}var gt=n(102),mt=n(103),_t=n(146);function yt(t){return{minLon:Object(O.round)(t.getWest(),j.o),minLat:Object(O.round)(t.getSouth(),j.o),maxLon:Object(O.round)(t.getEast(),j.o),maxLat:Object(O.round)(t.getNorth(),j.o)}}var vt=n(133);function bt(t){return`${t.z}/${t.x}/${t.y}`}class tile_error_cache_TileErrorCache{constructor(){a()(this,"_cache",{})}clearLayer(t,e){t in this._cache&&(delete this._cache[t],e())}clearTileError(t,e,n){if(!t||!(t in this._cache))return;const i=this._cache[t];e in i&&(delete i[e],this._cache[t]=i,n())}hasAny(){return Object.keys(this._cache).some((t=>Object.keys(this._cache[t]).length))}hasTileError(t,e){return t in this._cache&&e in this._cache[t]}setTileError(t,e){const n=this._cache[t]?this._cache[t]:{};n[e.tileKey]=e,this._cache[t]=n}getInViewTileErrors(t,e,n){const i=this._cache[t];if(!i)return;const r=Object.values(i);if(!r.length)return;const s=Object(_t.d)(e,n).map(bt),o=r.filter((t=>s.includes(t.tileKey)));return o.length?o:void 0}}class tile_status_tracker_TileStatusTracker extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_tileCache",[]),a()(this,"_tileErrorCache",new tile_error_cache_TileErrorCache),a()(this,"_layerCache",new Map),a()(this,"_prevCenterTileKey",void 0),a()(this,"_onSourceDataLoading",(t=>{if(t.sourceId&&t.sourceId!==j.Db&&"source"===t.dataType&&t.tile&&("vector"===t.source.type||"raster"===t.source.type)){const e=this.props.layerList.find((e=>e.ownsMbSourceId(t.sourceId))),n=e?e.getId():void 0;n&&!this._layerCache.has(n)&&this._layerCache.set(n,!0),this._tileErrorCache.clearTileError(n,bt(t.tile.tileID.canonical),this._updateTileStatusForAllLayers),this._tileCache.find((e=>e.mbKey===t.tile.tileID.key&&e.mbSourceId===t.sourceId))||(this._tileCache.push({mbKey:t.tile.tileID.key,mbSourceId:t.sourceId,mbTile:t.tile}),this._updateTileStatusForAllLayers())}})),a()(this,"_onError",(t=>{if(t.sourceId&&t.sourceId!==j.Db&&t.tile&&("vector"===t.source.type||"raster"===t.source.type)){this._removeTileFromCache(t.sourceId,t.tile.tileID.key);const e=this.props.layerList.find((e=>e.ownsMbSourceId(t.sourceId)));if(!e)return;const n=e.getId(),i=bt(t.tile.tileID.canonical),r={message:t.error.message,tileKey:i};this._tileErrorCache.setTileError(n,r);const s="body"in t.error&&"statusText"in t.error?t.error:void 0;if(!s||!Object(mt.d)(e.getSource()))return void this._updateTileStatusForAllLayers();s.body.text().then((t=>{if(this._tileErrorCache.hasTileError(n,i)){const e=JSON.parse(t);e.error&&"type"in e.error&&(this._tileErrorCache.setTileError(n,{...r,error:e.error}),this._updateTileStatusForAllLayers())}})).catch((t=>{}))}})),a()(this,"_onSourceData",(t=>{t.sourceId&&t.sourceId!==j.Db&&"source"===t.dataType&&t.tile&&("vector"===t.source.type||"raster"===t.source.type)&&this._removeTileFromCache(t.sourceId,t.tile.tileID.key)})),a()(this,"_onMoveEnd",(()=>{const t=this.props.mbMap.getCenter(),e=Object(_t.c)(t.lat,t.lng,Math.floor(this.props.mbMap.getZoom()));this._prevCenterTileKey!==e&&(this._prevCenterTileKey=e,this._tileErrorCache.hasAny()&&this._updateTileStatusForAllLayers())})),a()(this,"_updateTileStatusForAllLayers",I.a.debounce((()=>{if(!this._isMounted)return;this._tileCache=this._tileCache.filter((t=>"boolean"!=typeof t.mbTile.aborted||!t.mbTile.aborted));const t=this.props.layerList;for(let e=0;e<t.length;e++){const n=t[e];if(!this._layerCache.has(n.getId()))continue;let i=!1;for(let t=0;t<this._tileCache.length;t++){const e=this._tileCache[t];if(n.ownsMbSourceId(e.mbSourceId)){i=!0;break}}this.props.onTileStateChange(n.getId(),!i,this._getTileMetaFeatures(n),this._tileErrorCache.getInViewTileErrors(n.getId(),this.props.mbMap.getZoom(),yt(this.props.mbMap.getBounds())))}}),100)),a()(this,"_getTileMetaFeatures",(t=>t.isVisible()&&Object(mt.d)(t.getSource())?this.props.mbMap.querySourceFeatures(t.getMbSourceId(),{sourceLayer:vt.c}).map((t=>{try{return{type:"Feature",id:null==t?void 0:t.id,geometry:null==t?void 0:t.geometry,properties:null==t?void 0:t.properties}}catch(t){return null}})).filter((t=>null!==t)):void 0)),a()(this,"_removeTileFromCache",((t,e)=>{const n=this._tileCache.findIndex((n=>n.mbKey===e&&n.mbSourceId===t));n>=0&&(this._tileCache.splice(n,1),this._updateTileStatusForAllLayers())}))}componentDidMount(){this._isMounted=!0,this.props.mbMap.on("sourcedataloading",this._onSourceDataLoading),this.props.mbMap.on("error",this._onError),this.props.mbMap.on("sourcedata",this._onSourceData),this.props.mbMap.on("moveend",this._onMoveEnd)}componentDidUpdate(){this.props.layerList.forEach((t=>{Object(gt.c)(t)||Object(mt.d)(t.getSource())||this._tileErrorCache.clearLayer(t.getId(),this._updateTileStatusForAllLayers)}))}componentWillUnmount(){this._isMounted=!1,this.props.mbMap.off("error",this._onError),this.props.mbMap.off("sourcedata",this._onSourceData),this.props.mbMap.off("sourcedataloading",this._onSourceDataLoading),this.props.mbMap.off("moveend",this._onMoveEnd),this._tileCache.length=0}render(){return null}}const xt=Object(i.connect)((function(t){return{layerList:Object(Z.n)(t)}}),(function(t){return{onTileStateChange(e,n,i,r){t(Object(X.pb)(e,n,i,r))}}}))(tile_status_tracker_TileStatusTracker);var Et=n(602),St=n(323);const Ct=new Et.io.GeoJSONReader;class draw_feature_control_DrawFeatureControl extends l.Component{constructor(...t){super(...t),a()(this,"_onDraw",(async(t,e)=>{try{const e=[];t.features.forEach((t=>{const{geometry:n}=Ct.read(t);if(!n.isSimple()||!n.isValid())throw new Error(p.i18n.translate("xpack.maps.drawFeatureControl.invalidGeometry",{defaultMessage:"Invalid geometry detected"}));if("coordinates"in t.geometry){const n=this.props.drawMode===j.x.DRAW_POINTS?t.geometry.coordinates:t.geometry;e.push(n)}})),e.length&&this.props.addNewFeatureToIndex(e)}catch(t){Object(M.R)().addWarning(p.i18n.translate("xpack.maps.drawFeatureControl.unableToCreateFeature",{defaultMessage:"Unable to create feature, error: ''{errorMsg}''.",values:{errorMsg:t.message}}))}finally{try{e.deleteAll()}catch(t){}}})),a()(this,"_onClick",(async(t,e)=>{const n=t.point;if(!this.props.editLayer||this.props.drawShape!==j.y.DELETE)return;const i=this.props.editLayer.getMbLayerIds().filter((t=>!!this.props.mbMap.getLayer(t))),r=[{x:n.x-2,y:n.y-2},{x:n.x+2,y:n.y+2}],s=this.props.mbMap.queryRenderedFeatures(r,{layers:i,filter:["all",St.a]});if(!s.length)return;const o=s[0];try{if(!o.properties||!o.properties._id)throw Error("Associated Elasticsearch document id not found");const t=o.properties._id;this.props.deleteFeatureFromIndex(t)}catch(t){Object(M.R)().addWarning(p.i18n.translate("xpack.maps.drawFeatureControl.unableToDeleteFeature",{defaultMessage:"Unable to delete feature, error: ''{errorMsg}''.",values:{errorMsg:t.message}}))}}))}render(){return Object(g.jsx)(draw_control_DrawControl,{drawShape:this.props.drawShape,onDraw:this._onDraw,onClick:this._onClick,mbMap:this.props.mbMap,enable:!0})}}const Ot=Object(i.connect)((function(t){const e=Object(Z.f)(t),n=e?Object(Z.l)(e.layerId,t):void 0;return{drawShape:e?e.drawShape:void 0,drawMode:Object(Q.c)(t),editLayer:n}}),(function(t){return{addNewFeatureToIndex(e){t(Object(X.m)(e))},deleteFeatureFromIndex(e){t(Object(X.y)(e))}}}))(draw_feature_control_DrawFeatureControl);var It=n(115),wt=n(320);const Lt=navigator.platform.toLowerCase().indexOf("mac")>=0;class keydown_scroll_zoom_KeydownScrollZoom extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_hideTimeout",void 0),a()(this,"state",{show:!1}),a()(this,"_onWheel",(t=>{this._hideTimeout&&(clearTimeout(this._hideTimeout),this._hideTimeout=void 0),Lt&&t.originalEvent.metaKey||!Lt&&t.originalEvent.ctrlKey?this.setState({show:!1}):(this.setState({show:!0}),this._hideTimeout=setTimeout((()=>{this._isMounted&&this.setState({show:!1})}),1500),t.preventDefault())}))}componentDidMount(){this._isMounted=!0,this.props.mbMap.on("wheel",this._onWheel)}componentWillUnmount(){this._isMounted=!1,this.props.mbMap.off("wheel",this._onWheel)}render(){return Object(g.jsx)("aside",{className:h()("mapKeydownScrollZoom",{"mapKeydownScrollZoom--show":this.state.show})},Object(g.jsx)(d.EuiText,{textAlign:"center",size:"s",color:"ghost"},Object(g.jsx)("h3",null,p.i18n.translate("xpack.maps.keydownScrollZoom.keydownToZoomInstructions",{defaultMessage:"Use {key} + scroll to zoom the map",values:{key:Lt?"⌘":"control"}})),Object(g.jsx)("p",null,p.i18n.translate("xpack.maps.keydownScrollZoom.keydownClickAndDragZoomInstructions",{defaultMessage:"Use shift + click and drag to zoom the map to fit within a bounding box"}))))}}const Tt="elastic-api-version",jt="x-elastic-internal-origin";function Nt(t,e){const n=function(t){return(t=t.trim()).startsWith("/")?new URL(t,window.location.origin).toString():t}(t);return"Glyphs"===e&&n.includes(j.E)?{url:n,method:"GET",headers:{[Tt]:"1",[jt]:"kibana"}}:"Tile"===e&&n.includes(j.pb)?{url:n,method:"GET",headers:{[Tt]:"1",[jt]:"kibana"}}:"Tile"===e&&n.includes(j.ob)?{url:n,method:"GET",headers:{[Tt]:"1",[jt]:"kibana"}}:{url:n}}class mb_map_MbMap extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_containerRef",null),a()(this,"_prevCustomIcons",void 0),a()(this,"_prevDisableInteractive",void 0),a()(this,"_prevLayerList",void 0),a()(this,"_prevTimeslice",void 0),a()(this,"_navigationControl",new L.a.NavigationControl({showCompass:!1})),a()(this,"state",{mbMap:void 0}),a()(this,"_debouncedSync",I.a.debounce((()=>{if(this._isMounted&&this.props.isMapReady&&this.state.mbMap){const t=this._prevLayerList!==this.props.layerList,e=!I.a.isEqual(this._prevTimeslice,this.props.timeslice);(t||e)&&(this._prevLayerList=this.props.layerList,this._prevTimeslice=this.props.timeslice,this._syncMbMapWithLayerList(),this._syncMbMapWithInspector()),this.props.spatialFiltersLayer.syncLayerWithMB(this.state.mbMap),this._syncSettings()}}),256)),a()(this,"_syncMbMapWithMapState",(()=>{const{isMapReady:t,goto:e,clearGoto:n}=this.props;if(t&&e&&this.state.mbMap)if(n(),e.bounds){const t=new L.a.LngLatBounds(new L.a.LngLat(Object(N.f)(e.bounds.minLon),Object(N.e)(e.bounds.minLat)),new L.a.LngLat(Object(N.f)(e.bounds.maxLon),Object(N.e)(e.bounds.maxLat)));this.state.mbMap.fitBounds(t,{maxZoom:17,padding:16})}else e.center&&(this.state.mbMap.setZoom(e.center.zoom),this.state.mbMap.setCenter({lng:e.center.lon,lat:e.center.lat}))})),a()(this,"_syncMbMapWithLayerList",(()=>{this.state.mbMap&&(function(t,e,n){const i=t.getStyle();if(i.layers){i.layers.forEach((i=>{n.ownsMbLayerId(i.id)||ut(i.id)||e.find((t=>t.ownsMbLayerId(i.id)))||t.removeLayer(i.id)}));for(const r in i.sources)if(i.sources.hasOwnProperty(r)){if(n.ownsMbSourceId(r))continue;e.find((t=>t.ownsMbSourceId(r)))||t.removeSource(r)}}}(this.state.mbMap,this.props.layerList,this.props.spatialFiltersLayer),this.props.layerList.forEach((t=>t.syncLayerWithMB(this.state.mbMap,this.props.timeslice))),function(t,e,n){const i=t.getStyle().layers;if(!i||0===i.length)return;ft(t,e,ht.ANY)||dt(t,i,e,ht.ANY);let r=pt(i,e,ht.ANY);const s={ownsMbLayerId:t=>ut(t)};dt(t,i,s,ht.ANY,r);const o=pt(i,s,ht.ANY);o&&(r=o),[...n].reverse().filter((t=>t.areLabelsOnTop())).forEach((e=>{ft(t,e,ht.LABEL,r)||dt(t,i,e,ht.LABEL,r);const n=pt(i,e,ht.LABEL);n&&(r=n)})),[...n].reverse().forEach((e=>{const n=e.areLabelsOnTop()?ht.NON_LABEL:ht.ANY;ft(t,e,n,r)||dt(t,i,e,n,r);const s=pt(i,e,n);s&&(r=s)}))}(this.state.mbMap,this.props.spatialFiltersLayer,this.props.layerList))})),a()(this,"_syncMbMapWithInspector",(()=>{if(!this.props.inspectorAdapters.map||!this.state.mbMap)return;const t={center:this.state.mbMap.getCenter().toArray(),zoom:this.state.mbMap.getZoom()};this.props.inspectorAdapters.map.setMapState({stats:t,style:this.state.mbMap.getStyle()})})),a()(this,"_setContainerRef",(t=>{this._containerRef=t}))}componentDidMount(){this._initializeMap(),this._isMounted=!0}componentDidUpdate(){this._syncMbMapWithMapState(),this._debouncedSync()}componentWillUnmount(){this._isMounted=!1,this.state.mbMap&&(this.state.mbMap.remove(),this.state.mbMap=void 0),this.props.onMapDestroyed()}_getMapExtentState(){const t=this.state.mbMap.getZoom(),e=this.state.mbMap.getCenter(),n=this.state.mbMap.getBounds();return{zoom:I.a.round(t,j.Kb),center:{lon:I.a.round(e.lng,j.o),lat:I.a.round(e.lat,j.o)},extent:yt(n)}}async _createMbMapInstance(t){return this._reportUsage(),new Promise((e=>{const n=function(){const t=Object(M.m)();return t&&t.isEMSEnabled()&&("boolean"!=typeof ot||ot)?{glyphUrlTemplate:t.getEMSFontLibraryUrl(),isEmsFont:!0}:{glyphUrlTemplate:lt(),isEmsFont:!1}}(),i={version:8,sources:{},layers:[],glyphs:n.glyphUrlTemplate},r={attributionControl:!1,container:this._containerRef,style:i,preserveDrawingBuffer:Object(M.G)(),maxZoom:this.props.settings.maxZoom,minZoom:this.props.settings.minZoom,transformRequest:Nt};t?(r.zoom=t.zoom,r.center={lng:t.lon,lat:t.lat}):r.bounds=[-170,-60,170,75];const s=new L.a.Map(r);let o;s.dragRotate.disable(),s.touchZoomRotate.disableRotation(),s.on("styleimagemissing",(t=>{o&&s.addImage(t.id,o)})),s.on("load",(()=>{s.resize(),o=new Image,o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",o.crossOrigin="anonymous",e(s)})),n.isEmsFont&&async function(){return at||(at=new Promise((async t=>{try{ot=void 0;const e=Object(M.m)();e&&e.isEMSEnabled()||t(!1);const n=e.getEMSFontLibraryUrl().replace("{fontstack}","Open Sans").replace("{range}","0-255"),i=await st()(n,{method:"HEAD"});if(i.status>=400)throw new Error(`status: ${i.status}`);ot=!0,t(!0)}catch(e){console.warn(`Unable to access fonts from Elastic Maps Service (EMS). To avoid unnecessary EMS requests, set 'map.includeElasticMapsService: false' in 'kibana.yml'. For more details please visit: ${Object(M.l)().links.maps.connectToEms}`),ot=!1,t(!1)}}))),at}().then((t=>{this._isMounted&&!t&&s.setStyle({...s.getStyle(),glyphs:lt()})}))}))}async _initializeMap(){const t=await async function(t,e){return e.initialLocation===j.S.FIXED_LOCATION?{lat:e.fixedLocation.lat,lon:e.fixedLocation.lon,zoom:e.fixedLocation.zoom}:e.initialLocation===j.S.BROWSER_LOCATION?await new Promise(((t,n)=>{navigator.geolocation.getCurrentPosition((n=>{t({lat:n.coords.latitude,lon:n.coords.longitude,zoom:e.browserLocation.zoom})}),(()=>{console.warn("Unable to fetch browser location for initial map location"),t(null)}))})):e.initialLocation===j.S.AUTO_FIT_TO_BOUNDS?null:t&&t.center?t.center:null}(this.props.goto,this.props.settings);if(!this._isMounted)return;let e;try{e=await this._createMbMapInstance(t)}catch(t){return void this.props.setMapInitError(t.message)}this._isMounted&&this.setState({mbMap:e},(()=>{this._loadMakiSprites(e),this._registerMapEventListeners(e),this.props.onMapReady(this._getMapExtentState())}))}_registerMapEventListeners(t){if(t.on("moveend",I.a.debounce((()=>{this._isMounted&&this.props.extentChanged(this._getMapExtentState())}),100)),t.on("move",(()=>{if(this.props.onMapMove){const{zoom:t,center:e}=this._getMapExtentState();this.props.onMapMove(e.lat,e.lon,t)}})),!this.props.settings.hideViewControl){const e=I.a.throttle((t=>{this.props.setMouseCoordinates({lat:t.lngLat.lat,lon:t.lngLat.lng})}),100);t.on("mousemove",e),t.on("mouseout",(()=>{e.cancel(),this.props.clearMouseCoordinates()}))}}_reportUsage(){const t=Object(M.U)();if(!t)return;const e=Object(w.supported)();t.reportUiCounter(j.e,T.METRIC_TYPE.LOADED,e?"gl_webglSupported":"gl_webglNotSupported"),e&&!Object(w.supported)({failIfMajorPerformanceCaveat:!0})&&t.reportUiCounter(j.e,T.METRIC_TYPE.LOADED,"gl_majorPerformanceCaveat")}async _loadMakiSprites(t){if(this._isMounted){const e=Math.max(Math.floor(window.devicePixelRatio),1);for(const[n,{svg:i}]of Object.entries(wt.a))if(!t.hasImage(n)){const r=await Object(It.e)({renderSize:j.cb,svg:i});r&&t.addImage(n,r,{pixelRatio:e,sdf:!0})}}}_syncSettings(){if(!this.state.mbMap)return;if(!Object(M.W)()&&(void 0===this._prevDisableInteractive||this._prevDisableInteractive!==this.props.settings.disableInteractive))if(this._prevDisableInteractive=this.props.settings.disableInteractive,this.props.settings.disableInteractive){this.state.mbMap.boxZoom.disable(),this.state.mbMap.doubleClickZoom.disable(),this.state.mbMap.dragPan.disable();try{this.state.mbMap.removeControl(this._navigationControl)}catch(t){}}else this.state.mbMap.boxZoom.enable(),this.state.mbMap.doubleClickZoom.enable(),this.state.mbMap.dragPan.enable(),this.state.mbMap.addControl(this._navigationControl,"top-left");if(void 0===this._prevCustomIcons||!I.a.isEqual(this._prevCustomIcons,this.props.customIcons)){this._prevCustomIcons=this.props.customIcons;const t=this.state.mbMap;for(const{symbolId:e,svg:n,cutoff:i,radius:r}of this.props.customIcons)Object(It.e)({svg:n,renderSize:j.m,cutoff:i,radius:r}).then((n=>{n&&(t.hasImage(e)?t.updateImage(e,n):t.addImage(e,n,{sdf:!0,pixelRatio:It.a}))}))}let t=!1;this.props.settings.minZoom!==this.state.mbMap.getMinZoom()&&(this.state.mbMap.setMinZoom(this.props.settings.minZoom),t=!0),this.props.settings.maxZoom!==this.state.mbMap.getMaxZoom()&&(this.state.mbMap.setMaxZoom(this.props.settings.maxZoom),t=!0),t&&setTimeout((()=>{this._isMounted&&this.props.extentChanged(this._getMapExtentState())}),300)}render(){let t,e,n,i,r,s;return this.state.mbMap&&(t=this.props.addFilters&&this.props.filterModeActive?Object(g.jsx)(K,{mbMap:this.state.mbMap,addFilters:this.props.addFilters}):null,e=this.props.featureModeActive?Object(g.jsx)(Ot,{mbMap:this.state.mbMap}):null,n=this.props.settings.disableTooltipControl?null:Object(g.jsx)(it,{mbMap:this.state.mbMap,addFilters:this.props.addFilters,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,onSingleValueTrigger:this.props.onSingleValueTrigger,renderTooltipContent:this.props.renderTooltipContent}),i=this.props.settings.showScaleControl?Object(g.jsx)(scale_control_ScaleControl,{mbMap:this.state.mbMap,isFullScreen:this.props.isFullScreen}):null,r=this.props.settings.keydownScrollZoom?Object(g.jsx)(keydown_scroll_zoom_KeydownScrollZoom,{mbMap:this.state.mbMap}):null,s=Object(g.jsx)(xt,{mbMap:this.state.mbMap})),Object(g.jsx)("div",{id:"mapContainer",className:"mapContainer",ref:this._setContainerRef,"data-test-subj":"mapContainer"},t,e,r,i,n,s)}}var Mt=n(111);const Ft=Object(i.connect)((function(t){return{isMapReady:Object(Z.v)(t),settings:Object(Z.w)(t),customIcons:Object(Z.b)(t),layerList:Object(Z.n)(t),spatialFiltersLayer:Object(Z.I)(t),goto:Object(Z.j)(t),inspectorAdapters:Object(Mt.d)(t),isFullScreen:Object(Q.e)(t),timeslice:Object(Z.K)(t),featureModeActive:Object(Q.c)(t)===j.x.DRAW_SHAPES||Object(Q.c)(t)===j.x.DRAW_POINTS,filterModeActive:Object(Q.c)(t)===j.x.DRAW_FILTERS,onMapMove:Object(Mt.e)(t)}}),(function(t){return{extentChanged:e=>{t(Object(X.G)(e))},onMapReady:e=>{t(Object(X.p)()),t(Object(X.G)(e)),t(Object(X.H)())},onMapDestroyed:()=>{t(Object(X.F)())},setMouseCoordinates:({lat:e,lon:n})=>{t(Object(X.kb)({lat:e,lon:n}))},clearMouseCoordinates:()=>{t(Object(X.r)())},clearGoto:()=>{t(Object(X.p)())},setMapInitError(e){t(Object(X.ib)(e))}}}))(mb_map_MbMap);var Pt=n(54),Rt=n(132);class toc_entry_button_TOCEntryButton extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{isFilteredByGlobalTime:!1})}componentDidMount(){this._isMounted=!0,this._loadIsFilteredByGlobalTime()}componentDidUpdate(){this._loadIsFilteredByGlobalTime()}componentWillUnmount(){this._isMounted=!1}async _loadIsFilteredByGlobalTime(){const t=await this.props.layer.isFilteredByGlobalTime();this._isMounted&&t!==this.state.isFilteredByGlobalTime&&this.setState({isFilteredByGlobalTime:t})}getIconAndTooltipContent(){const t=this.props.layer.getErrors(this.props.inspectorAdapters);if(t.length){const e=Object(g.jsx)(d.EuiIcon,{size:"m",type:"error",color:"danger","data-test-subj":`layerTocErrorIcon${this.props.escapedDisplayName}`});return Object(gt.c)(this.props.layer)?{icon:e,footnotes:[],postScript:t[0].title}:{icon:e,tooltipContent:this.props.layer.getErrors(this.props.inspectorAdapters).map((({title:t})=>Object(g.jsx)("div",{key:t},t))),footnotes:[]}}if(!this.props.layer.isVisible())return{icon:Object(g.jsx)(d.EuiIcon,{size:"m",type:"eyeClosed"}),tooltipContent:p.i18n.translate("xpack.maps.layer.layerHiddenTooltip",{defaultMessage:"Layer is hidden."}),footnotes:[]};if(!this.props.layer.showAtZoomLevel(this.props.zoom)){const t=this.props.layer.getMinZoom(),e=this.props.layer.getMaxZoom();return{icon:Object(g.jsx)(d.EuiIcon,{size:"m",type:"expand"}),tooltipContent:p.i18n.translate("xpack.maps.layer.zoomFeedbackTooltip",{defaultMessage:"Layer is visible between zoom levels {minZoom} and {maxZoom}.",values:{minZoom:t,maxZoom:e}}),footnotes:[]}}if(this.props.layer.isLayerLoading(this.props.zoom))return{icon:Object(g.jsx)(d.EuiLoadingSpinner,{size:"m"}),tooltipContent:"",footnotes:[]};const{icon:e,tooltipContent:n}=this.props.layer.getLayerIcon(!0),i=this.props.layer.getWarnings(),r=i.length?Object(g.jsx)(d.EuiIcon,{size:"m",type:"warning",color:"warning","data-test-subj":`layerTocWarningIcon${this.props.escapedDisplayName}`}):e;if(Object(gt.c)(this.props.layer))return{icon:r,tooltipContent:n,footnotes:[],postScript:i.length?i[0].title:void 0};const s=[];this.props.isUsingSearch&&this.props.layer.getQueryableIndexPatternIds().length&&s.push({icon:Object(g.jsx)(d.EuiIcon,{color:"subdued",type:"filter",size:"s"}),message:p.i18n.translate("xpack.maps.layer.isUsingSearchMsg",{defaultMessage:"Results narrowed by global search"})}),this.state.isFilteredByGlobalTime&&s.push({icon:Object(g.jsx)(d.EuiIcon,{color:"subdued",type:"clock",size:"s"}),message:p.i18n.translate("xpack.maps.layer.isUsingTimeFilter",{defaultMessage:"Results narrowed by global time"})});const o=this.props.layer.getSource();return"function"==typeof o.isFilterByMapBounds&&o.isFilterByMapBounds()&&s.push({icon:Object(g.jsx)(d.EuiIcon,{color:"subdued",type:"stop",size:"s"}),message:p.i18n.translate("xpack.maps.layer.isUsingBoundsFilter",{defaultMessage:"Results narrowed by visible map area"})}),{icon:r,tooltipContent:n,footnotes:s,postScript:i.length?Rt.b:void 0}}render(){const{icon:t,tooltipContent:e,footnotes:n,postScript:i}=this.getIconAndTooltipContent(),r=n.map(((t,e)=>Object(g.jsx)(l.Fragment,{key:e},"",t.icon))),s=n.map(((t,e)=>Object(g.jsx)("div",{key:e},t.icon," ",t.message)));return Object(g.jsx)(d.EuiToolTip,{anchorClassName:"mapLayTocActions__tooltipAnchor",position:"top",title:this.props.displayName,content:Object(g.jsx)(l.Fragment,null,e,s,i?Object(g.jsx)("p",{style:{fontStyle:"italic",marginTop:"16px"}},i):null),"data-test-subj":"layerTocTooltip"},Object(g.jsx)(d.EuiButtonEmpty,{className:"mapTocEntry__layerName eui-textLeft",size:"xs",flush:"left",color:"text",onClick:this.props.onClick,"data-test-subj":`layerTocActionsPanelToggleButton${this.props.escapedDisplayName}`},Object(g.jsx)("span",{className:"mapTocEntry__layerNameIcon"},t),this.props.displayName," ",r))}}const Dt=Object(i.connect)((function(t,e){return{inspectorAdapters:Object(Mt.d)(t),isUsingSearch:Object(Z.Q)(t),zoom:Object(Z.x)(t)}}))(toc_entry_button_TOCEntryButton);function At(t){return t?"eyeClosed":"eye"}function kt(t){return t?p.i18n.translate("xpack.maps.layerTocActions.hideLayerTitle",{defaultMessage:"Hide layer"}):p.i18n.translate("xpack.maps.layerTocActions.showLayerTitle",{defaultMessage:"Show layer"})}const Gt=p.i18n.translate("xpack.maps.layerControl.layerTocActions.layerSettingsButtonLabel",{defaultMessage:"Edit layer settings"}),Bt=p.i18n.translate("xpack.maps.layerControl.layerTocActions.editFeaturesButtonLabel",{defaultMessage:"Edit features"}),zt=p.i18n.translate("xpack.maps.layerTocActions.fitToDataTitle",{defaultMessage:"Fit to data"});var qt=n(131);function Vt(t){function e(t){let n=0;return t.getChildren().forEach((t=>{n++,Object(gt.c)(t)&&(n+=e(t))})),n}return Object(g.jsx)(d.EuiConfirmModal,{title:p.i18n.translate("xpack.maps.deleteLayerConfirmModal.title",{defaultMessage:"Remove layer?"}),onCancel:t.onCancel,onConfirm:t.onConfirm,cancelButtonText:p.i18n.translate("xpack.maps.deleteLayerConfirmModal.cancelButtonText",{defaultMessage:"Cancel"}),confirmButtonText:p.i18n.translate("xpack.maps.deleteLayerConfirmModal.confirmButtonText",{defaultMessage:"Remove layer"}),buttonColor:"danger",defaultFocusedButton:"cancel"},Object(g.jsx)(d.EuiText,null,function(){if(!Object(gt.c)(t.layer))return null;const n=e(t.layer);return n>0?Object(g.jsx)("p",null,p.i18n.translate("xpack.maps.deleteLayerConfirmModal.multiLayerWarning",{defaultMessage:"Removing this layer also removes {numChildren} nested {numChildren, plural, one {layer} other {layers}}.",values:{numChildren:n}})):null}(),Object(g.jsx)("p",null,p.i18n.translate("xpack.maps.deleteLayerConfirmModal.unrecoverableWarning",{defaultMessage:"You can't recover removed layers."}))))}class toc_entry_actions_popover_TOCEntryActionsPopover extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1,showRemoveModal:!1,supportsFeatureEditing:!1,isFeatureEditingEnabled:!1}),a()(this,"_isMounted",!1),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState((()=>({isPopoverOpen:!1})))}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(){this._loadFeatureEditing()}async _loadFeatureEditing(){if(!Object(et.e)(this.props.layer,"supportsFeatureEditing"))return;const t=this.props.layer.supportsFeatureEditing(),e=await this._getIsFeatureEditingEnabled();!this._isMounted||t===this.state.supportsFeatureEditing&&e===this.state.isFeatureEditingEnabled||this.setState({supportsFeatureEditing:t,isFeatureEditingEnabled:e})}async _getIsFeatureEditingEnabled(){if(!Object(et.e)(this.props.layer,"hasJoins"))return!1;const t=this.props.layer.getSource();return t instanceof qt.ESSearchSource&&!(t.getSyncMeta().scalingType===j.wb.CLUSTERS||this.props.layer.isPreviewLayer()||!this.props.layer.isVisible()||this.props.layer.hasJoins())}_getActionsPanel(){const t=[{name:zt,icon:Object(g.jsx)(d.EuiIcon,{type:"expand",size:"m"}),"data-test-subj":"fitToBoundsButton",toolTipContent:this.props.supportsFitToBounds?null:p.i18n.translate("xpack.maps.layerTocActions.noFitSupportTooltip",{defaultMessage:"Layer does not support fit to data"}),disabled:!this.props.supportsFitToBounds,onClick:()=>{this._closePopover(),this.props.fitToBounds(this.props.layer.getId())}},{name:kt(this.props.layer.isVisible()),icon:Object(g.jsx)(d.EuiIcon,{type:At(this.props.layer.isVisible()),size:"m"}),"data-test-subj":"layerVisibilityToggleButton",toolTipContent:null,onClick:()=>{this._closePopover(),this.props.toggleVisible(this.props.layer.getId())}}];return this.props.numLayers>2&&t.push({name:p.i18n.translate("xpack.maps.layerTocActions.showThisLayerOnlyTitle",{defaultMessage:"Show this layer only"}),icon:Object(g.jsx)(d.EuiIcon,{type:"eye",size:"m"}),"data-test-subj":"showThisLayerOnlyButton",toolTipContent:null,onClick:()=>{this._closePopover(),this.props.showThisLayerOnly(this.props.layer.getId())}}),this.props.isReadOnly||(t.push({disabled:this.props.isEditButtonDisabled,name:Gt,icon:Object(g.jsx)(d.EuiIcon,{type:"pencil",size:"m"}),"data-test-subj":"layerSettingsButton",toolTipContent:null,onClick:()=>{this._closePopover(),this.props.openLayerSettings()}}),this.state.supportsFeatureEditing&&t.push({name:Bt,icon:Object(g.jsx)(d.EuiIcon,{type:"vector",size:"m"}),"data-test-subj":"editLayerButton",toolTipContent:this.state.isFeatureEditingEnabled?null:p.i18n.translate("xpack.maps.layerTocActions.editFeaturesTooltip.disabledMessage",{defaultMessage:"Edit features is only supported for layers without clustering and term joins"}),disabled:!this.state.isFeatureEditingEnabled,onClick:async()=>{this._closePopover();const t=await this.props.layer.getSource().getSupportedShapeTypes();t.includes(j.Hb.POLYGON)&&t.includes(j.Hb.LINE)?this.props.enableShapeEditing(this.props.layer.getId()):this.props.enablePointEditing(this.props.layer.getId())}}),t.push({name:p.i18n.translate("xpack.maps.layerTocActions.cloneLayerTitle",{defaultMessage:"Clone layer"}),icon:Object(g.jsx)(d.EuiIcon,{type:"copy",size:"m"}),toolTipContent:null,"data-test-subj":"cloneLayerButton",onClick:()=>{this._closePopover(),this.props.cloneLayer(this.props.layer.getId())}}),Object(gt.c)(this.props.layer)&&this.props.layer.getChildren().length>0&&t.push({name:p.i18n.translate("xpack.maps.layerTocActions.ungroupLayerTitle",{defaultMessage:"Ungroup layers"}),icon:Object(g.jsx)(d.EuiIcon,{type:"layers",size:"m"}),toolTipContent:null,"data-test-subj":"removeLayerButton",onClick:()=>{this._closePopover(),this.props.ungroupLayer(this.props.layer.getId()),this.props.removeLayer(this.props.layer.getId())}}),t.push({name:p.i18n.translate("xpack.maps.layerTocActions.removeLayerTitle",{defaultMessage:"Remove layer"}),icon:Object(g.jsx)(d.EuiIcon,{type:"trash",size:"m"}),toolTipContent:null,"data-test-subj":"removeLayerButton",onClick:()=>{this.setState({showRemoveModal:!0})}})),{id:0,title:p.i18n.translate("xpack.maps.layerTocActions.layerActionsTitle",{defaultMessage:"Layer actions"}),items:t}}render(){const t=this.state.showRemoveModal?Object(g.jsx)(Vt,{layer:this.props.layer,onCancel:()=>{this.setState({showRemoveModal:!1})},onConfirm:()=>{this.setState({showRemoveModal:!1}),this._closePopover(),this.props.removeLayer(this.props.layer.getId())}}):null;return Object(g.jsx)(u.a.Fragment,null,t,Object(g.jsx)(d.EuiPopover,{id:this.props.layer.getId(),className:"mapLayTocActions",button:Object(g.jsx)(Dt,{layer:this.props.layer,displayName:this.props.displayName,escapedDisplayName:this.props.escapedDisplayName,onClick:this._togglePopover}),isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,panelPaddingSize:"none",anchorPosition:"leftUp"},Object(g.jsx)(d.EuiContextMenu,{initialPanelId:0,panels:[this._getActionsPanel()],"data-test-subj":`layerTocActionsPanel${this.props.escapedDisplayName}`})))}}const Ut=Object(i.connect)((function(t){return{isReadOnly:Object(Q.g)(t),numLayers:Object(Z.p)(t).length}}),(function(t){return{cloneLayer:e=>{t(Object(X.s)(e))},fitToBounds:e=>{t(Object(X.C)(e))},removeLayer:e=>{t(Object(X.P)(e))},toggleVisible:e=>{t(Object(X.tb)(e))},enableShapeEditing:e=>{t(Object(X.yb)(e)),t(Object(X.W)(j.x.DRAW_SHAPES))},enablePointEditing:e=>{t(Object(X.yb)(e)),t(Object(X.W)(j.x.DRAW_POINTS))},showThisLayerOnly:e=>{t(Object(X.sb)(e))},ungroupLayer:e=>{t(Object(X.ub)(e))}}}))(toc_entry_actions_popover_TOCEntryActionsPopover);function Wt({inspectorAdapters:t,layer:e}){const n=e.getErrors(t);if(n.length)return Object(g.jsx)(u.a.Fragment,null,n.map((({title:t,body:e},n)=>Object(g.jsx)("div",{key:n},Object(g.jsx)(d.EuiCallOut,{color:"danger",size:"s",title:t},e),Object(g.jsx)(d.EuiSpacer,{size:"m"})))));const i=e.getWarnings();return i.length?Object(g.jsx)(u.a.Fragment,null,i.map((({title:t,body:e},n)=>Object(g.jsx)("div",{key:n},Object(g.jsx)(d.EuiCallOut,{color:"warning",size:"s"},e),Object(g.jsx)(d.EuiSpacer,{size:"m"})))),e.renderLegendDetails()):e.renderLegendDetails()}function Yt(t){return t.split(" ").join("_")}class toc_entry_TOCEntry extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{displayName:"",hasLegendDetails:!1,shouldShowModal:!1,supportsFitToBounds:!1}),a()(this,"_toggleLayerDetailsVisibility",(()=>{this.props.isLegendDetailsOpen?this.props.hideTOCDetails(this.props.layer.getId()):this.props.showTOCDetails(this.props.layer.getId())})),a()(this,"_openLayerPanelWithCheck",(()=>{const{selectedLayer:t,hasDirtyStateSelector:e}=this.props;t&&t.getId()===this.props.layer.getId()||(e?this.setState({shouldShowModal:!0}):this.props.openLayerPanel(this.props.layer.getId()))})),a()(this,"_fitToBounds",(()=>{this.props.fitToBounds(this.props.layer.getId())})),a()(this,"_toggleVisible",(()=>{this.props.toggleVisible(this.props.layer.getId())}))}componentDidMount(){this._isMounted=!0,this._updateDisplayName(),this._loadHasLegendDetails(),this._loadSupportsFitToBounds()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(){this._updateDisplayName(),this._loadHasLegendDetails()}async _loadSupportsFitToBounds(){const t=await this.props.layer.supportsFitToBounds();this._isMounted&&this.setState({supportsFitToBounds:t})}async _loadHasLegendDetails(){const t=(await this.props.layer.hasLegendDetails()||this.props.layer.hasErrors()||this.props.layer.hasWarnings())&&this.props.layer.isVisible()&&this.props.layer.showAtZoomLevel(this.props.zoom);this._isMounted&&t!==this.state.hasLegendDetails&&this.setState({hasLegendDetails:t})}async _updateDisplayName(){const t=await this.props.layer.getDisplayName();this._isMounted&&t!==this.state.displayName&&this.setState({displayName:t})}_renderCancelModal(){if(!this.state.shouldShowModal)return null;const t=()=>{this.setState({shouldShowModal:!1})};return Object(g.jsx)(d.EuiConfirmModal,{title:"Discard changes",onCancel:t,onConfirm:()=>{t(),this.props.openLayerPanel(this.props.layer.getId())},cancelButtonText:"Do not proceed",confirmButtonText:"Proceed and discard changes",buttonColor:"danger",defaultFocusedButton:"cancel"},Object(g.jsx)("p",null,"There are unsaved changes to your layer."),Object(g.jsx)("p",null,"Are you sure you want to proceed?"))}_renderQuickActions(){const t=[Object(g.jsx)(d.EuiButtonIcon,{key:"toggleVisiblity",iconType:At(this.props.layer.isVisible()),title:kt(this.props.layer.isVisible()),"aria-label":kt(this.props.layer.isVisible()),onClick:this._toggleVisible})];return this.state.supportsFitToBounds&&t.push(Object(g.jsx)(d.EuiButtonIcon,{key:"fitToBounds",iconType:"expand",title:zt,"aria-label":zt,onClick:this._fitToBounds})),this.props.isReadOnly||(t.push(Object(g.jsx)(d.EuiButtonIcon,{key:"settings",isDisabled:this.props.isEditButtonDisabled,iconType:"pencil","aria-label":Gt,title:Gt,onClick:this._openLayerPanelWithCheck})),t.push(Object(g.jsx)(d.EuiButtonIcon,s()({key:"reorder",iconType:"grab",title:p.i18n.translate("xpack.maps.layerControl.tocEntry.grabButtonTitle",{defaultMessage:"Reorder layer"}),"aria-label":p.i18n.translate("xpack.maps.layerControl.tocEntry.grabButtonAriaLabel",{defaultMessage:"Reorder layer"}),className:"mapTocEntry__grab"},this.props.dragHandleProps)))),Object(g.jsx)("div",{className:"mapTocEntry__layerIcons"},t)}_renderDetailsToggle(){if(this.props.isDragging||!this.state.hasLegendDetails)return null;const{isLegendDetailsOpen:t}=this.props;return Object(g.jsx)("span",{className:"mapTocEntry__detailsToggle"},Object(g.jsx)("button",{className:"mapTocEntry__detailsToggleButton","aria-label":t?p.i18n.translate("xpack.maps.layerControl.tocEntry.hideDetailsButtonAriaLabel",{defaultMessage:"Hide layer details"}):p.i18n.translate("xpack.maps.layerControl.tocEntry.showDetailsButtonAriaLabel",{defaultMessage:"Show layer details"}),title:t?p.i18n.translate("xpack.maps.layerControl.tocEntry.hideDetailsButtonTitle",{defaultMessage:"Hide layer details"}):p.i18n.translate("xpack.maps.layerControl.tocEntry.showDetailsButtonTitle",{defaultMessage:"Show layer details"}),onClick:this._toggleLayerDetailsVisibility},Object(g.jsx)(d.EuiIcon,{className:"eui-alignBaseline",type:t?"arrowUp":"arrowDown",size:"s"})))}_renderLayerHeader(){const{layer:t,zoom:e}=this.props;return Object(g.jsx)("div",{className:t.isVisible()&&t.showAtZoomLevel(e)?"mapTocEntry-visible":"mapTocEntry-notVisible"},Object(g.jsx)(Ut,{layer:t,displayName:this.state.displayName,escapedDisplayName:Yt(this.state.displayName),openLayerSettings:this._openLayerPanelWithCheck,isEditButtonDisabled:this.props.isEditButtonDisabled,supportsFitToBounds:this.state.supportsFitToBounds}),this._renderQuickActions())}_hightlightAsSelectedLayer(){return!this.props.isCombineLayer&&(!!this.props.layer.isPreviewLayer()||this.props.selectedLayer&&this.props.selectedLayer.getId()===this.props.layer.getId())}render(){const t=h()("mapTocEntry",{"mapTocEntry-isDragging":this.props.isDragging,"mapTocEntry-isDraggingOver":this.props.isDraggingOver,"mapTocEntry-isCombineLayer":this.props.isCombineLayer,"mapTocEntry-isSelected":this._hightlightAsSelectedLayer(),"mapTocEntry-isInEditingMode":this.props.isFeatureEditorOpenForLayer}),e=this.props.depth>0?{paddingLeft:8+24*this.props.depth+"px"}:{};return Object(g.jsx)("div",{style:e,className:t,id:this.props.layer.getId(),"data-layerid":this.props.layer.getId()},this._renderLayerHeader(),this.props.isLegendDetailsOpen&&this.state.hasLegendDetails&&!Object(gt.c)(this.props.layer)?Object(g.jsx)("div",{className:"mapTocEntry__layerDetails","data-test-subj":`mapLayerTOCDetails${Yt(this.state.displayName)}`},Object(g.jsx)(Wt,{inspectorAdapters:this.props.inspectorAdapters,layer:this.props.layer})):null,this._renderDetailsToggle(),this._renderCancelModal(),this.props.isFeatureEditorOpenForLayer&&Object(g.jsx)("div",{className:"mapTocEntry-isInEditingMode__row"},Object(g.jsx)(d.EuiIcon,{type:"vector",size:"s"}),Object(g.jsx)("span",{className:"mapTocEntry-isInEditingMode__editFeatureText"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerControl.tocEntry.EditFeatures",defaultMessage:"Edit features"})),Object(g.jsx)(d.EuiButtonEmpty,{size:"xs",flush:"both",onClick:this.props.cancelEditing},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerControl.tocEntry.exitEditModeAriaLabel",defaultMessage:"Exit"}))))}}var Ht=n(110);const Jt=Object(i.connect)((function(t,e){var n;const i=Object(Q.d)(t);return{inspectorAdapters:Object(Mt.d)(t),isReadOnly:Object(Q.g)(t),zoom:Object(Z.x)(t),selectedLayer:Object(Z.F)(t),hasDirtyStateSelector:Object(Z.M)(t),isLegendDetailsOpen:Object(Q.i)(t).includes(e.layer.getId()),isEditButtonDisabled:i!==Ht.c.NONE&&i!==Ht.c.LAYER_PANEL,isFeatureEditorOpenForLayer:(null===(n=Object(Z.f)(t))||void 0===n?void 0:n.layerId)===e.layer.getId()}}),(function(t){return{fitToBounds:e=>{t(Object(X.C)(e))},openLayerPanel:async e=>{await t(Object(X.ob)(e)),t(Object(X.Bb)(Ht.c.LAYER_PANEL))},hideTOCDetails:e=>{t(Object(X.E)(e))},showTOCDetails:e=>{t(Object(X.rb)(e))},toggleVisible:e=>{t(Object(X.tb)(e))},cancelEditing:()=>{t(Object(X.xb)(null)),t(Object(X.W)(j.x.NONE))}}}))(toc_entry_TOCEntry),Xt={combineLayer:null,isOwnAncestor:!1,newRightSiblingLayer:null,sourceLayer:null};class layer_toc_LayerTOC extends l.Component{constructor(...t){super(...t),a()(this,"state",{...Xt}),a()(this,"_updateDebounced",I.a.debounce(this.forceUpdate,100)),a()(this,"_onDragStart",(({source:t})=>{const e=this._reverseIndex(t.index),n=this.props.layerList[e];this.setState({...Xt,sourceLayer:n})})),a()(this,"_onDragUpdate",(({combine:t,destination:e,source:n})=>{const i=this._reverseIndex(n.index),r=this.props.layerList[i];if(t){const e=this.props.layerList.findIndex((e=>e.getId()===t.draggableId)),n=-1!==e?this.props.layerList[e]:null,i=e-1,s=i<0?null:this.props.layerList[i],o=n?this._getForebearers(n):[];return void this.setState({combineLayer:n,newRightSiblingLayer:s,sourceLayer:r,isOwnAncestor:o.includes(r.getId())})}if(!e||n.index===e.index)return void this.setState({...Xt});const s=this._reverseIndex(e.index),o=i>s?s-1:s,a=o<0?null:this.props.layerList[o],l=a?this._getForebearers(a):[];this.setState({combineLayer:null,newRightSiblingLayer:a,sourceLayer:r,isOwnAncestor:l.includes(r.getId())})})),a()(this,"_onDragEnd",(()=>{const{combineLayer:t,isOwnAncestor:e,sourceLayer:n,newRightSiblingLayer:i}=this.state;if(this.setState({...Xt}),!e&&n)return t?Object(gt.c)(t)&&i?(this.props.setLayerParent(n.getId(),t.getId()),void this.props.moveLayerToLeftOfTarget(n.getId(),i.getId())):void this.props.createLayerGroup(n.getId(),t.getId()):i?(this.props.setLayerParent(n.getId(),i.getParent()),void this.props.moveLayerToLeftOfTarget(n.getId(),i.getId())):void this.props.moveLayerToBottom(n.getId())}))}componentWillUnmount(){this._updateDebounced.cancel()}shouldComponentUpdate(){return this._updateDebounced(),!1}_reverseIndex(t){return this.props.layerList.length-t-1}_getForebearers(t){const e=t.getParent();if(!e)return[];const n=this.props.layerList.find((t=>t.getId()===e));return n?[...this._getForebearers(n),e]:[]}_getDepth(t,e){if(void 0===t.getParent())return{depth:e,showInTOC:!0};const n=this.props.layerList.find((e=>t.getParent()===e.getId()));return n&&this.props.openTOCDetails.includes(n.getId())?this._getDepth(n,e+1):{depth:e,showInTOC:!1}}_getDroppableClass(){return this.state.sourceLayer?this.state.isOwnAncestor?"mapLayerToc-droppable-dropNotAllowed":this.state.combineLayer?"mapLayerToc-droppable-isCombining":"mapLayerToc-droppable-isDragging":""}_renderLayers(){const t=this.props.layerList.map(((t,e)=>({...this._getDepth(t,0),draggableIndex:this._reverseIndex(e),layer:t}))).filter((({showInTOC:t})=>t)).reverse();return this.props.isReadOnly?t.map((({depth:t,layer:e})=>Object(g.jsx)(Jt,{key:e.getId(),depth:t,layer:e}))):Object(g.jsx)(d.EuiDragDropContext,{onDragStart:this._onDragStart,onDragUpdate:this._onDragUpdate,onDragEnd:this._onDragEnd},Object(g.jsx)(d.EuiDroppable,{droppableId:"mapLayerTOC",spacing:"none",isCombineEnabled:!this.state.isOwnAncestor,className:this._getDroppableClass()},((e,n)=>{const i=t.map((({draggableIndex:t,depth:e,layer:i})=>Object(g.jsx)(d.EuiDraggable,{spacing:"none",key:i.getId(),index:t,draggableId:i.getId(),customDragHandle:!0,disableInteractiveElementBlocking:!0},((t,r)=>Object(g.jsx)(Jt,{depth:e,layer:i,dragHandleProps:t.dragHandleProps,isDragging:r.isDragging,isDraggingOver:n.isDraggingOver,isCombineLayer:null!==this.state.combineLayer&&this.state.combineLayer.getId()===i.getId()})))));return Object(g.jsx)("div",null,i)})))}render(){return Object(g.jsx)("div",{"data-test-subj":"mapLayerTOC"},this._renderLayers())}}const Zt=Object(i.connect)((function(t){return{isReadOnly:Object(Q.g)(t),layerList:Object(Z.n)(t),openTOCDetails:Object(Q.i)(t)}}),(function(t){return{createLayerGroup:(e,n)=>t(Object(X.w)(e,n)),moveLayerToBottom:e=>t(Object(X.I)(e)),moveLayerToLeftOfTarget:(e,n)=>t(Object(X.J)(e,n)),setLayerParent:(e,n)=>t(Object(X.gb)(e,n))}}))(layer_toc_LayerTOC);function Qt({hasErrorsOrWarnings:t,isLoading:e,onClick:n}){return Object(g.jsx)(d.EuiButtonEmpty,{"aria-label":p.i18n.translate("xpack.maps.layerControl.openLayerTOCButtonAriaLabel",{defaultMessage:"Expand layers panel"}),className:"mapLayerControl__openLayerTOCButton",color:"text",onClick:n,"data-test-subj":"mapExpandLayerControlButton"},e?Object(g.jsx)("div",{style:{paddingTop:"6px"}},Object(g.jsx)(d.EuiLoadingSpinner,null)):Object(g.jsx)(d.EuiIcon,{type:t?"warning":"menuLeft"}))}const Kt=Object(i.connect)((function(t){return{isReadOnly:Object(Q.g)(t),isLayerTOCOpen:Object(Q.f)(t),layerList:Object(Z.n)(t),isFlyoutOpen:Object(Q.d)(t)!==Ht.c.NONE,zoom:Object(Z.x)(t)}}),(function(t){return{showAddLayerWizard:async()=>{await t(Object(X.ob)(null)),t(Object(X.Bb)(Ht.c.ADD_LAYER_WIZARD)),t(Object(X.W)(j.x.NONE))},closeLayerTOC:()=>{t(Object(X.db)(!1))},openLayerTOC:()=>{t(Object(X.db)(!0))},hideAllLayers:()=>{t(Object(X.D)())},showAllLayers:()=>{t(Object(X.qb)())}}}))((function({isReadOnly:t,isLayerTOCOpen:e,showAddLayerWizard:n,closeLayerTOC:i,openLayerTOC:r,layerList:s,isFlyoutOpen:o,hideAllLayers:a,showAllLayers:u,zoom:c}){if(!e){if(Object(M.W)())return null;const t=s.some((t=>t.hasErrors()||t.hasWarnings())),e=s.some((t=>t.isLayerLoading(c)));return Object(g.jsx)(d.EuiToolTip,{delay:"long",content:p.i18n.translate("xpack.maps.layerControl.openLayerTOCButtonAriaLabel",{defaultMessage:"Expand layers panel"}),position:"left"},Object(g.jsx)(Qt,{hasErrorsOrWarnings:t,isLoading:e,onClick:r}))}let h;return t||(h=Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(d.EuiButton,{isDisabled:o,className:"mapLayerControl__addLayerButton",fill:!0,fullWidth:!0,onClick:n,"data-test-subj":"addLayerButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerControl.addLayerButtonLabel",defaultMessage:"Add layer"})))),Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiPanel,{className:"mapWidgetControl mapWidgetControl-hasShadow",paddingSize:"none",grow:!1},Object(g.jsx)(d.EuiFlexItem,{className:"mapWidgetControl__headerFlexItem",grow:!1},Object(g.jsx)(d.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",responsive:!1,gutterSize:"none"},Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiTitle,{size:"xxxs",className:"mapWidgetControl__header"},Object(g.jsx)("h2",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerControl.layersTitle",defaultMessage:"Layers"})))),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiToolTip,{delay:"long",content:p.i18n.translate("xpack.maps.layerControl.hideAllLayersButton",{defaultMessage:"Hide all layers"})},Object(g.jsx)(d.EuiButtonIcon,{onClick:a,iconType:"eyeClosed",color:"text","aria-label":p.i18n.translate("xpack.maps.layerControl.hideAllLayersButton",{defaultMessage:"Hide all layers"})}))),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiToolTip,{delay:"long",content:p.i18n.translate("xpack.maps.layerControl.showAllLayersButton",{defaultMessage:"Show all layers"})},Object(g.jsx)(d.EuiButtonIcon,{onClick:u,iconType:"eye",color:"text","aria-label":p.i18n.translate("xpack.maps.layerControl.showAllLayersButton",{defaultMessage:"Show all layers"})}))),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiToolTip,{delay:"long",content:p.i18n.translate("xpack.maps.layerControl.closeLayerTOCButtonAriaLabel",{defaultMessage:"Collapse layers panel"})},Object(g.jsx)(d.EuiButtonIcon,{className:"mapLayerControl__closeLayerTOCButton",onClick:i,iconType:"menuRight",color:"text","aria-label":p.i18n.translate("xpack.maps.layerControl.closeLayerTOCButtonAriaLabel",{defaultMessage:"Collapse layers panel"}),"data-test-subj":"mapToggleLegendButton"}))))),Object(g.jsx)(d.EuiFlexItem,{className:"mapLayerControl"},Object(g.jsx)(Zt,null))),h)})),$t=Object(i.connect)((function(t){return{mouseCoordinates:Object(Z.z)(t),zoom:Object(Z.x)(t)}}),{})((function({mouseCoordinates:t,zoom:e}){let n;return t&&(n=Object(g.jsx)(l.Fragment,null,Object(g.jsx)("strong",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.viewControl.latLabel",defaultMessage:"lat:"}))," ",I.a.round(t.lat,j.o),","," ",Object(g.jsx)("strong",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.viewControl.lonLabel",defaultMessage:"lon:"}))," ",I.a.round(t.lon,j.o),","," ")),Object(g.jsx)("div",{className:"mapViewControl__coordinates"},Object(g.jsx)(d.EuiText,{size:"xs"},Object(g.jsx)("small",null,n,Object(g.jsx)("strong",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.viewControl.zoomLabel",defaultMessage:"zoom:"}))," ",e)))}));class attribution_control_AttributionControl extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{uniqueAttributions:[]}),a()(this,"_loadAttributions",(async()=>{const t=this.props.layerList.map((async t=>{try{return await t.getAttributions()}catch(t){return[]}})),e=await Promise.all(t);if(!this._isMounted)return;const n=[];for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++){const r=e[t][i];n.find((t=>t.url===r.url&&t.label===r.label))||n.push(r)}n.reverse(),I.a.isEqual(this.state.uniqueAttributions,n)||this.setState({uniqueAttributions:n})}))}componentDidMount(){this._isMounted=!0,this._loadAttributions()}componentWillUnmount(){this._isMounted=!1}componentDidUpdate(){this._loadAttributions()}_renderAttribution({url:t,label:e}){return!t||Object(M.W)()?e:Object(g.jsx)(d.EuiLink,{color:"text",href:t,target:"_blank"},e)}_renderAttributions(){return this.state.uniqueAttributions.map(((t,e)=>Object(g.jsx)(l.Fragment,{key:e},this._renderAttribution(t),e<this.state.uniqueAttributions.length-1&&", ")))}render(){return 0===this.state.uniqueAttributions.length?null:Object(g.jsx)("div",{className:h()("mapAttributionControl",{mapAttributionControl__fullScreen:this.props.isFullScreen})},Object(g.jsx)(d.EuiText,{size:"xs"},Object(g.jsx)("small",null,this._renderAttributions())))}}const te=Object(i.connect)((function(t){return{layerList:Object(Z.n)(t),isFullScreen:Object(Q.e)(t)}}),{})(attribution_control_AttributionControl),ee=Object(i.connect)((function(t){return{settings:Object(Z.w)(t)}}),{})((function({settings:t}){return Object(g.jsx)(d.EuiFlexGroup,{className:"mapWidgetOverlay",responsive:!1,direction:"column",alignItems:"flexEnd",gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,{className:"mapWidgetOverlay__layerWrapper"},!t.hideLayerControl&&Object(g.jsx)(Kt,null)),Object(g.jsx)(d.EuiFlexItem,{grow:!1},!t.hideViewControl&&Object(g.jsx)($t,null)),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(te,null)))}));var ne=n(1),ie=n(25),re=n(82);class timeslider_Timeslider extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_subscriptions",new ne.Subscription),a()(this,"_getCreationOptions",(async(t,e)=>(e.addTimeSliderControl(t),{initialInput:{...t,viewMode:ie.ViewMode.VIEW,timeRange:this.props.timeRange}}))),a()(this,"_onLoadComplete",(t=>{this._isMounted&&t&&this._subscriptions.add(t.getOutput$().pipe(Object(ne.distinctUntilChanged)((({timeslice:t},{timeslice:e})=>I.a.isEqual(t,e)))).subscribe((({timeslice:e})=>{this.props.waitForTimesliceToLoad$.pipe(Object(ne.first)()).subscribe((()=>{t.anyControlOutputConsumerLoading$.next(!1)})),this.props.setTimeslice(void 0===e?void 0:{from:e[0],to:e[1]})})))}))}componentWillUnmount(){this._isMounted=!1,this._subscriptions.unsubscribe()}componentDidMount(){this._isMounted=!0}render(){return Object(g.jsx)("div",{className:"mapTimeslider mapTimeslider--animation"},Object(g.jsx)(re.ControlGroupRenderer,{ref:this._onLoadComplete,getCreationOptions:this._getCreationOptions,timeRange:this.props.timeRange}))}}const se=Object(i.connect)((function(t){return{timeRange:Object(Z.J)(t)}}),(function(t){return{setTimeslice:e=>{t(Object(X.mb)({forceRefresh:!1,timeslice:e}))}}}))(timeslider_Timeslider);var oe=n(83);const{mgrsToDD:ae,mgrstoUSNG:le,utmToDD:ue,withinRange:ce,ddToMGRS:he,ddToUTM:de,converter:pe}=oe.geoUtils;class decimal_degrees_form_DecimalDegreesForm extends l.Component{constructor(...t){super(...t),a()(this,"state",{lat:this.props.center.lat,lon:this.props.center.lon,zoom:this.props.zoom}),a()(this,"_onLatChange",(t=>{const e=parseFloat(t.target.value);this.setState({lat:isNaN(e)?"":e})})),a()(this,"_onLonChange",(t=>{const e=parseFloat(t.target.value);this.setState({lon:isNaN(e)?"":e})})),a()(this,"_onZoomChange",(t=>{const e=parseFloat(t.target.value);this.setState({zoom:isNaN(e)?"":e})})),a()(this,"_onSubmit",(()=>{const{lat:t,lon:e,zoom:n}=this.state;this.props.onSubmit(t,e,n)}))}render(){const{isInvalid:t,error:e}=ce(this.state.lat,-90,90),{isInvalid:n,error:i}=ce(this.state.lon,-180,180),{isInvalid:r,error:s}=ce(this.state.zoom,this.props.settings.minZoom,this.props.settings.maxZoom);return Object(g.jsx)(d.EuiForm,null,Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.latitudeLabel",{defaultMessage:"Latitude"}),isInvalid:t,error:e,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.lat,onChange:this._onLatChange,isInvalid:t,"data-test-subj":"latitudeInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.longitudeLabel",{defaultMessage:"Longitude"}),isInvalid:n,error:i,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.lon,onChange:this._onLonChange,isInvalid:n,"data-test-subj":"longitudeInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.zoomLabel",{defaultMessage:"Zoom"}),isInvalid:r,error:s,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.zoom,onChange:this._onZoomChange,isInvalid:r,"data-test-subj":"zoomInput"})),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(d.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(d.EuiButton,{size:"s",fill:!0,disabled:t||n||r,onClick:this._onSubmit,"data-test-subj":"submitViewButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.setViewControl.submitButtonLabel",defaultMessage:"Go"}))))}}class mgrs_form_MgrsForm extends l.Component{constructor(...t){super(...t),a()(this,"state",{mgrs:he(this.props.center.lat,this.props.center.lon),zoom:this.props.zoom}),a()(this,"_onMGRSChange",(t=>{this.setState({mgrs:I.a.isNull(t.target.value)?"":t.target.value})})),a()(this,"_onZoomChange",(t=>{const e=parseFloat(t.target.value);this.setState({zoom:isNaN(e)?"":e})})),a()(this,"_onSubmit",(()=>{const t=this._toPoint();t&&this.props.onSubmit(t.north,t.east,this.state.zoom)}))}_toPoint(){return""===this.state.mgrs?void 0:ae(this.state.mgrs)}_isMgrsInvalid(){const t=this._toPoint();return void 0===t||!t.north||I.a.isNaN(t.north)||!t.south||I.a.isNaN(t.south)||!t.east||I.a.isNaN(t.east)||!t.west||I.a.isNaN(t.west)}render(){const t=this._isMgrsInvalid(),e=t?p.i18n.translate("xpack.maps.setViewControl.mgrsInvalid",{defaultMessage:"MGRS is invalid"}):null,{isInvalid:n,error:i}=ce(this.state.zoom,this.props.settings.minZoom,this.props.settings.maxZoom);return Object(g.jsx)(d.EuiForm,null,Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.mgrsLabel",{defaultMessage:"MGRS"}),isInvalid:t,error:e,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldText,{compressed:!0,value:this.state.mgrs,onChange:this._onMGRSChange,isInvalid:t,"data-test-subj":"mgrsInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.zoomLabel",{defaultMessage:"Zoom"}),isInvalid:n,error:i,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.zoom,onChange:this._onZoomChange,isInvalid:n,"data-test-subj":"zoomInput"})),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(d.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(d.EuiButton,{size:"s",fill:!0,disabled:t||n,onClick:this._onSubmit,"data-test-subj":"submitViewButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.setViewControl.submitButtonLabel",defaultMessage:"Go"}))))}}class utm_form_UtmForm extends l.Component{constructor(t){super(t),a()(this,"_onZoneChange",(t=>{this.setState({zone:I.a.isNull(t.target.value)?"":t.target.value})})),a()(this,"_onEastingChange",(t=>{this.setState({easting:I.a.isNull(t.target.value)?"":t.target.value})})),a()(this,"_onNorthingChange",(t=>{this.setState({northing:I.a.isNull(t.target.value)?"":t.target.value})})),a()(this,"_onZoomChange",(t=>{const e=parseFloat(t.target.value);this.setState({zoom:isNaN(e)?"":e})})),a()(this,"_onSubmit",(()=>{const t=this._toPoint();t&&this.props.onSubmit(t.lat,t.lon,this.state.zoom)}));const e=de(this.props.center.lat,this.props.center.lon);this.state={northing:e.northing,easting:e.easting,zone:e.zone,zoom:this.props.zoom}}_toPoint(){const{northing:t,easting:e,zone:n}=this.state;return""===t||""===e||n.length<2?void 0:ue(t,e,n.substring(0,n.length-1))}_isUtmInvalid(){return void 0===this._toPoint()}render(){const t=this._isUtmInvalid(),e=t||""===this.state.northing?p.i18n.translate("xpack.maps.setViewControl.utmInvalidNorthing",{defaultMessage:"UTM Northing is invalid"}):null,n=t||""===this.state.northing?p.i18n.translate("xpack.maps.setViewControl.utmInvalidEasting",{defaultMessage:"UTM Easting is invalid"}):null,i=t||""===this.state.northing?p.i18n.translate("xpack.maps.setViewControl.utmInvalidZone",{defaultMessage:"UTM Zone is invalid"}):null,{isInvalid:r,error:s}=ce(this.state.zoom,this.props.settings.minZoom,this.props.settings.maxZoom);return Object(g.jsx)(d.EuiForm,null,Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.utmZoneLabel",{defaultMessage:"UTM Zone"}),isInvalid:t,error:i,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldText,{compressed:!0,value:this.state.zone,onChange:this._onZoneChange,isInvalid:t,"data-test-subj":"utmZoneInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.utmEastingLabel",{defaultMessage:"UTM Easting"}),isInvalid:t,error:n,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.easting,onChange:this._onEastingChange,isInvalid:t,"data-test-subj":"utmEastingInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.utmNorthingLabel",{defaultMessage:"UTM Northing"}),isInvalid:t,error:e,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.northing,onChange:this._onNorthingChange,isInvalid:t,"data-test-subj":"utmNorthingInput"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.setViewControl.zoomLabel",{defaultMessage:"Zoom"}),isInvalid:r,error:s,display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{compressed:!0,value:this.state.zoom,onChange:this._onZoomChange,isInvalid:r,"data-test-subj":"zoomInput"})),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(d.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(d.EuiButton,{size:"s",fill:!0,disabled:t||r,onClick:this._onSubmit,"data-test-subj":"submitViewButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.setViewControl.submitButtonLabel",defaultMessage:"Go"}))))}}const fe="mgrs",ge=[{id:"dd",label:p.i18n.translate("xpack.maps.setViewControl.decimalDegreesLabel",{defaultMessage:"Decimal degrees"})},{id:"utm",label:"UTM"},{id:fe,label:"MGRS"}];class set_view_form_SetViewForm extends l.Component{constructor(...t){super(...t),a()(this,"state",{coordinateSystem:"dd",isPopoverOpen:!1}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_onCoordinateSystemChange",(t=>{this._closePopover(),this.setState({coordinateSystem:t})}))}_renderForm(){return this.state.coordinateSystem===fe?Object(g.jsx)(mgrs_form_MgrsForm,{settings:this.props.settings,zoom:this.props.zoom,center:this.props.center,onSubmit:this.props.onSubmit}):"utm"===this.state.coordinateSystem?Object(g.jsx)(utm_form_UtmForm,{settings:this.props.settings,zoom:this.props.zoom,center:this.props.center,onSubmit:this.props.onSubmit}):Object(g.jsx)(decimal_degrees_form_DecimalDegreesForm,{settings:this.props.settings,zoom:this.props.zoom,center:this.props.center,onSubmit:this.props.onSubmit})}render(){return Object(g.jsx)("div",{"data-test-subj":"mapSetViewForm",style:{width:240}},Object(g.jsx)(d.EuiPopover,{panelPaddingSize:"s",isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,button:Object(g.jsx)(d.EuiButtonEmpty,{iconType:"controlsHorizontal",size:"xs",onClick:this._togglePopover},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.setViewControl.changeCoordinateSystemButtonLabel",defaultMessage:"Coordinate system"}))},Object(g.jsx)(d.EuiRadioGroup,{options:ge,idSelected:this.state.coordinateSystem,onChange:this._onCoordinateSystemChange})),this._renderForm())}}class set_view_control_SetViewControl extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_onSubmit",((t,e,n)=>{this._closePopover(),this.props.onSubmit({lat:t,lon:e,zoom:n})}))}render(){return Object(g.jsx)(d.EuiPopover,{anchorPosition:"leftUp",panelPaddingSize:"s",button:Object(g.jsx)(d.EuiPanel,{paddingSize:"none",className:"mapToolbarOverlay__button"},Object(g.jsx)(d.EuiButtonIcon,{className:"mapToolbarOverlay__buttonIcon-empty",size:"s",onClick:this._togglePopover,"data-test-subj":"toggleSetViewVisibilityButton",iconType:"crosshairs",color:"text","aria-label":p.i18n.translate("xpack.maps.setViewControl.goToButtonLabel",{defaultMessage:"Go to"}),title:p.i18n.translate("xpack.maps.setViewControl.goToButtonLabel",{defaultMessage:"Go to"})})),isOpen:this.state.isPopoverOpen,closePopover:this._closePopover},Object(g.jsx)(set_view_form_SetViewForm,{settings:this.props.settings,zoom:this.props.zoom,center:this.props.center,onSubmit:this._onSubmit}))}}const me=Object(i.connect)((function(t){return{settings:Object(Z.w)(t),zoom:Object(Z.x)(t),center:Object(Z.r)(t)}}),(function(t){return{onSubmit:({lat:e,lon:n,zoom:i})=>{t(Object(X.bb)({lat:e,lon:n,zoom:i}))}}}))(set_view_control_SetViewControl);var _e=n(268),ye=n(60),ve=n(269);class distance_filter_form_DistanceFilterForm extends l.Component{constructor(...t){super(...t),a()(this,"state",{actionId:ye.ACTION_GLOBAL_APPLY_FILTER,filterLabel:""}),a()(this,"_onFilterLabelChange",(t=>{this.setState({filterLabel:t.target.value})})),a()(this,"_onActionIdChange",(t=>{this.setState({actionId:t})})),a()(this,"_onSubmit",(()=>{this.props.onSubmit({actionId:this.state.actionId,filterLabel:this.state.filterLabel})}))}render(){return Object(g.jsx)(d.EuiForm,{className:this.props.className},Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.distanceFilterForm.filterLabelLabel",{defaultMessage:"Filter label"}),display:"rowCompressed"},Object(g.jsx)(d.EuiFieldText,{compressed:!0,value:this.state.filterLabel,onChange:this._onFilterLabelChange})),Object(g.jsx)(ve.a,{getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,value:this.state.actionId,onChange:this._onActionIdChange}),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(d.EuiButton,{size:"s",fill:!0,onClick:this._onSubmit},this.props.buttonLabel)))}}const be=p.i18n.translate("xpack.maps.toolbarOverlay.drawShapeLabel",{defaultMessage:"Draw shape to filter data"}),xe=p.i18n.translate("xpack.maps.toolbarOverlay.drawBoundsLabel",{defaultMessage:"Draw bounds to filter data"}),Ee=p.i18n.translate("xpack.maps.toolbarOverlay.drawDistanceLabel",{defaultMessage:"Draw distance to filter data"}),Se=p.i18n.translate("xpack.maps.toolbarOverlay.drawShapeLabelShort",{defaultMessage:"Draw shape"}),Ce=p.i18n.translate("xpack.maps.toolbarOverlay.drawBoundsLabelShort",{defaultMessage:"Draw bounds"}),Oe=p.i18n.translate("xpack.maps.toolbarOverlay.drawDistanceLabelShort",{defaultMessage:"Draw distance"});class tools_control_ToolsControl extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1}),this.props.filterModeActive&&this.props.cancelDraw()})),a()(this,"_initiateShapeDraw",(t=>{this.props.initiateDraw({drawShape:j.y.POLYGON,...t}),this._closePopover()})),a()(this,"_initiateBoundsDraw",(t=>{this.props.initiateDraw({drawShape:j.y.BOUNDS,...t}),this._closePopover()})),a()(this,"_initiateDistanceDraw",(t=>{this.props.initiateDraw({drawShape:j.y.DISTANCE,...t}),this._closePopover()}))}_getDrawPanels(){const t=[{name:be,panel:1},{name:xe,panel:2},{name:Ee,panel:3}];return[{id:0,title:p.i18n.translate("xpack.maps.toolbarOverlay.tools.toolbarTitle",{defaultMessage:"Tools"}),items:t},{id:1,title:Se,content:Object(g.jsx)(_e.a,{className:"mapDrawControl__geometryFilterForm",buttonLabel:Se,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,intitialGeometryLabel:p.i18n.translate("xpack.maps.toolbarOverlay.drawShape.initialGeometryLabel",{defaultMessage:"shape"}),onSubmit:this._initiateShapeDraw})},{id:2,title:Ce,content:Object(g.jsx)(_e.a,{className:"mapDrawControl__geometryFilterForm",buttonLabel:Ce,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,intitialGeometryLabel:p.i18n.translate("xpack.maps.toolbarOverlay.drawBounds.initialGeometryLabel",{defaultMessage:"bounds"}),onSubmit:this._initiateBoundsDraw})},{id:3,title:Oe,content:Object(g.jsx)(distance_filter_form_DistanceFilterForm,{className:"mapDrawControl__geometryFilterForm",buttonLabel:Oe,getFilterActions:this.props.getFilterActions,getActionContext:this.props.getActionContext,onSubmit:this._initiateDistanceDraw})}]}_renderToolsButton(){return Object(g.jsx)(d.EuiPanel,{paddingSize:"none",className:"mapToolbarOverlay__button"},Object(g.jsx)(d.EuiButtonIcon,{className:"mapToolbarOverlay__buttonIcon-empty",size:"s",color:"text",iconType:"wrench",onClick:this._togglePopover,"aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.toolsControlTitle",{defaultMessage:"Tools"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.toolsControlTitle",{defaultMessage:"Tools"}),isDisabled:this.props.disableToolsControl}))}render(){const t=Object(g.jsx)(d.EuiPopover,{id:"toolsControlPopover",button:this._renderToolsButton(),isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,panelPaddingSize:"none",anchorPosition:"leftUp","data-test-subj":"mapToolsControlPopover"},Object(g.jsx)(d.EuiContextMenu,{initialPanelId:0,panels:this._getDrawPanels()}));return this.props.filterModeActive?Object(g.jsx)(d.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,null,t),Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiButton,{size:"s",fill:!0,onClick:this.props.cancelDraw},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.tooltip.toolsControl.cancelDrawButtonLabel",defaultMessage:"Cancel"})))):t}}const Ie=Object(i.connect)((function(t){return{filterModeActive:Object(Q.c)(t)===j.x.DRAW_FILTERS}}),(function(t){return{cancelDraw:()=>{t(Object(X.xb)(null)),t(Object(X.W)(j.x.NONE))},initiateDraw:e=>{t(Object(X.W)(j.x.DRAW_FILTERS)),t(Object(X.xb)(e))}}}))(tools_control_ToolsControl);var we=n(84);const Le=t=>Object(g.jsx)("svg",s()({width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),Object(g.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8C1 11.866 4.13401 15 8 15ZM8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z"})),Te=t=>Object(g.jsx)("svg",s()({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},t),Object(g.jsx)("path",{d:"M11.506 3.881l.707.707-7.594 7.594-.707-.707z"}),Object(g.jsx)("path",{fillRule:"evenodd",d:"M5 11H1v4h4v-4zm-1 1H2v2h2v-2zM15 1h-4v4h4V1zm-1 1h-2v2h2V2z",clipRule:"evenodd"})),je=t=>Object(g.jsx)("svg",s()({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"},t),Object(g.jsx)("path",{fillRule:"evenodd",d:"M1.5 2a.5.5 0 01.5-.5h12a.5.5 0 01.5.5v12a.5.5 0 01-.5.5H2a.5.5 0 01-.5-.5V2zm1 .5v11h11v-11h-11z",clipRule:"evenodd"})),Ne=Object(i.connect)((function(t){const e=Object(Z.f)(t);return{drawShape:e?e.drawShape:void 0}}),(function(t){return{setDrawShape:e=>{t(Object(X.zb)(e))}}}))((function(t){const e=t.drawShape===j.y.LINE,n=t.drawShape===j.y.POLYGON,i=t.drawShape===j.y.DISTANCE,r=t.drawShape===j.y.BOUNDS,s=t.drawShape===j.y.POINT,o=t.drawShape===j.y.DELETE,a=t.drawShape===j.y.WAIT;function l(e){e&&t.drawShape===e?t.setDrawShape(null):t.setDrawShape(e)}return Object(g.jsx)(we.TrackApplicationView,{viewId:"featureEditTools"},Object(g.jsx)(d.EuiPanel,{paddingSize:"none",className:"mapToolbarOverlay__buttonGroup mapToolbarOverlay__buttonGroupAnimated"},t.pointsOnly?null:Object(g.jsx)(u.a.Fragment,null,Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!e}),key:"line",size:"s",onClick:()=>l(j.y.LINE),iconType:Te,"aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawLineLabel",{defaultMessage:"Draw line"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawLineTitle",{defaultMessage:"Draw line"}),"aria-pressed":e,isSelected:e,display:e?"fill":"empty",isDisabled:a}),Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!n}),key:"polygon",size:"s",onClick:()=>l(j.y.POLYGON),iconType:"node","aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawPolygonLabel",{defaultMessage:"Draw polygon"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawPolygonTitle",{defaultMessage:"Draw polygon"}),"aria-pressed":n,isSelected:n,display:n?"fill":"empty",isDisabled:a}),Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!i}),key:"circle",size:"s",onClick:()=>l(j.y.DISTANCE),iconType:Le,"aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawCircleLabel",{defaultMessage:"Draw circle"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawCircleTitle",{defaultMessage:"Draw circle"}),"aria-pressed":i,isSelected:i,display:i?"fill":"empty",isDisabled:a}),Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!r}),key:"boundingBox",size:"s",onClick:()=>l(j.y.BOUNDS),iconType:je,"aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawBBoxLabel",{defaultMessage:"Draw bounding box"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawBBoxTitle",{defaultMessage:"Draw bounding box"}),"aria-pressed":r,isSelected:r,display:r?"fill":"empty",isDisabled:a})),Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!s}),key:"point",size:"s",onClick:()=>l(j.y.POINT),iconType:"dot","aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawPointLabel",{defaultMessage:"Draw point"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.drawPointTitle",{defaultMessage:"Draw point"}),"aria-pressed":s,isSelected:s,display:s?"fill":"empty",isDisabled:a}),Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!o}),key:"delete",size:"s",onClick:()=>l(j.y.DELETE),iconType:"trash","aria-label":p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.deletePointOrShapeLabel",{defaultMessage:"Delete point or shape"}),title:p.i18n.translate("xpack.maps.toolbarOverlay.featureDraw.deletePointOrShapeTitle",{defaultMessage:"Delete point or shape"}),"aria-pressed":o,isSelected:o,display:o?"fill":"empty",isDisabled:a})))})),Me=Object(i.connect)((function(t){return{autoFitToDataBounds:Object(Z.w)(t).autoFitToDataBounds}}),(function(t){return{fitToBounds:()=>{t(Object(X.B)())}}}))((function(t){const e=p.i18n.translate("xpack.maps.fitToData.label",{defaultMessage:"Fit to data bounds"});let n=e;return t.autoFitToDataBounds&&(n=`${n}. `+p.i18n.translate("xpack.maps.fitToData.autoFitToDataBounds",{defaultMessage:'Map setting "auto fit map to data bounds" enabled, map will automatically pan and zoom to show the data bounds.'})),Object(g.jsx)(d.EuiPanel,{paddingSize:"none",className:"mapToolbarOverlay__button"},Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!t.autoFitToDataBounds}),size:"s",onClick:t.fitToBounds,"data-test-subj":"fitToData",iconType:"expand","aria-label":e,title:n,display:t.autoFitToDataBounds?"fill":"empty"}))})),Fe=Object(i.connect)((function(t){return{isTimesliderOpen:Object(Q.h)(t)}}),(function(t){return{closeTimeslider:()=>{t(Object(X.v)())},openTimeslider:()=>{t(Object(X.N)())}}}))((function(t){const e=t.isTimesliderOpen?p.i18n.translate("xpack.maps.timesliderToggleButton.closeLabel",{defaultMessage:"Close timeslider"}):p.i18n.translate("xpack.maps.timesliderToggleButton.openLabel",{defaultMessage:"Open timeslider"});return Object(g.jsx)(d.EuiPanel,{paddingSize:"none",className:"mapToolbarOverlay__button"},Object(g.jsx)(d.EuiButtonIcon,{className:h()({"mapToolbarOverlay__buttonIcon-empty":!t.isTimesliderOpen}),size:"s",onClick:function(){t.isTimesliderOpen?t.closeTimeslider():t.openTimeslider()},"data-test-subj":"timesliderToggleButton",iconType:"timeslider","aria-label":e,title:e,isSelected:t.isTimesliderOpen,display:t.isTimesliderOpen?"fill":"empty"}))})),Pe=Object(i.connect)((function(t){return{showToolsControl:0!==Object(Z.i)(t).length,shapeDrawModeActive:Object(Q.c)(t)===j.x.DRAW_SHAPES,pointDrawModeActive:Object(Q.c)(t)===j.x.DRAW_POINTS}}))((function(t){const e=t.addFilters&&t.showToolsControl?Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(Ie,{getFilterActions:t.getFilterActions,getActionContext:t.getActionContext,disableToolsControl:t.pointDrawModeActive||t.shapeDrawModeActive})):null,n=t.showFitToBoundsButton?Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(Me,null)):null,i=t.showTimesliderButton?Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(Fe,null)):null,r=t.shapeDrawModeActive||t.pointDrawModeActive?Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(Ne,{pointsOnly:t.pointDrawModeActive})):null;return Object(g.jsx)(d.EuiFlexGroup,{className:"mapToolbarOverlay",responsive:!1,direction:"column",alignItems:"flexStart",gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(me,null)),n,e,i,r)}));var Re=n(59),De=n(65);function Ae({applyGlobalQuery:t,label:e,setApplyGlobalQuery:n,isFeatureEditorOpenForLayer:i}){const r=i?p.i18n.translate("xpack.maps.filterEditor.isGlobalSearchNotApplied",{defaultMessage:"Global search is not applied to the layer while editing features"}):p.i18n.translate("xpack.maps.filterEditor.applyGlobalFilterHelp",{defaultMessage:"When enabled, results narrowed by global search"});return Object(g.jsx)(d.EuiFormRow,{display:"columnCompressedSwitch"},Object(g.jsx)(d.EuiToolTip,{position:"top",content:r},Object(g.jsx)(d.EuiSwitch,{label:e,checked:!i&&t,onChange:t=>{n(t.target.checked)},"data-test-subj":"mapLayerPanelApplyGlobalQueryCheckbox",compressed:!0,disabled:i})))}function ke({applyGlobalTime:t,label:e,setApplyGlobalTime:n,isFeatureEditorOpenForLayer:i}){const r=i?p.i18n.translate("xpack.maps.filterEditor.isGlobalTimeNotApplied",{defaultMessage:"Global time is not applied to the layer while editing features"}):p.i18n.translate("xpack.maps.filterEditor.applyGlobalTimeHelp",{defaultMessage:"When enabled, results narrowed by global time"});return Object(g.jsx)(d.EuiFormRow,{display:"columnCompressedSwitch"},Object(g.jsx)(d.EuiToolTip,{position:"top",content:r},Object(g.jsx)(d.EuiSwitch,{label:e,checked:!i&&t,onChange:t=>{n(t.target.checked)},"data-test-subj":"mapLayerPanelApplyGlobalTimeCheckbox",compressed:!0,disabled:i})))}var Ge=n(330);class filter_editor_FilterEditor extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{isPopoverOpen:!1,isSourceTimeAware:!1}),a()(this,"_toggle",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_close",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_onQueryChange",(({query:t})=>{t&&(this.props.setLayerQuery(this.props.layer.getId(),t),this._close())})),a()(this,"_onApplyGlobalQueryChange",(t=>{this.props.updateSourceProp(this.props.layer.getId(),"applyGlobalQuery",t)})),a()(this,"_onApplyGlobalTimeChange",(t=>{this.props.updateSourceProp(this.props.layer.getId(),"applyGlobalTime",t)})),a()(this,"_onRespondToForceRefreshChange",(t=>{this.props.updateSourceProp(this.props.layer.getId(),"applyForceRefresh",t)}))}componentDidMount(){this._isMounted=!0,this._loadDataView(),this._loadSourceTimeAware()}componentWillUnmount(){this._isMounted=!1}async _loadDataView(){const t=this.props.layer.getSource();if(!Object(mt.b)(t,"getIndexPattern"))return;const e=await t.getIndexPattern();this._isMounted&&this.setState({dataView:e})}async _loadSourceTimeAware(){const t=await this.props.layer.getSource().isTimeAware();this._isMounted&&this.setState({isSourceTimeAware:t})}_renderQueryPopover(){const t=this.props.layer.getQuery(),e=Object(M.I)();return Object(g.jsx)(d.EuiPopover,{id:"layerQueryPopover",button:this._renderOpenButton(),isOpen:this.state.isPopoverOpen,closePopover:this._close,anchorPosition:"leftCenter",ownFocus:!0},Object(g.jsx)("div",{className:"mapFilterEditor","data-test-subj":"mapFilterEditor"},Object(g.jsx)(e,{appName:j.e,showFilterBar:!1,showDatePicker:!1,showQueryInput:!0,query:t||Object(M.j)().query.queryString.getDefaultQuery(),onQuerySubmit:this._onQueryChange,indexPatterns:this.state.dataView?[this.state.dataView]:[],customSubmitButton:Object(g.jsx)(d.EuiButton,{fill:!0,"data-test-subj":"mapFilterEditorSubmitButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.filterEditor.queryBarSubmitButtonLabel",defaultMessage:"Set filter"}))})))}_renderQuery(){if(this.props.isFeatureEditorOpenForLayer)return Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.filterEditor.isLayerFilterNotApplied",defaultMessage:"Layer filter is not applied while editing features"});const t=this.props.layer.getQuery();return t&&t.query?Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiCodeBlock,{paddingSize:"s"},t.query),Object(g.jsx)(d.EuiSpacer,{size:"m"})):Object(g.jsx)(d.EuiText,{size:"s"},Object(g.jsx)("p",null,Object(g.jsx)(d.EuiTextColor,{color:"subdued"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.filterEditor.emptyState.description",defaultMessage:"Add a filter to narrow the layer data."}))))}_renderOpenButton(){const t=this.props.layer.getQuery(),e=t&&t.query?p.i18n.translate("xpack.maps.layerPanel.filterEditor.editFilterButtonLabel",{defaultMessage:"Edit filter"}):p.i18n.translate("xpack.maps.layerPanel.filterEditor.addFilterButtonLabel",{defaultMessage:"Set filter"}),n=t&&t.query?"pencil":"plusInCircleFilled";return Object(g.jsx)(d.EuiButtonEmpty,{size:"xs",onClick:this._toggle,"data-test-subj":"mapLayerPanelOpenFilterEditorButton",iconType:n,disabled:this.props.isFeatureEditorOpenForLayer},e)}render(){const t=this.state.isSourceTimeAware?Object(g.jsx)(ke,{label:p.i18n.translate("xpack.maps.filterEditor.applyGlobalTimeCheckboxLabel",{defaultMessage:"Apply global time to layer data"}),applyGlobalTime:this.props.layer.getSource().getApplyGlobalTime(),setApplyGlobalTime:this._onApplyGlobalTimeChange,isFeatureEditorOpenForLayer:this.props.isFeatureEditorOpenForLayer}):null;return Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.filterEditor.title",defaultMessage:"Filtering"}))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiFlexGroup,{direction:"row",wrap:!1,component:"span"},Object(g.jsx)(d.EuiFlexItem,{grow:1},this._renderQueryPopover()),Object(g.jsx)(d.EuiFlexItem,{grow:6},this._renderQuery())),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiHorizontalRule,{size:"full",margin:"s"}),Object(g.jsx)(Ae,{label:p.i18n.translate("xpack.maps.filterEditor.applyGlobalQueryCheckboxLabel",{defaultMessage:"Apply global search to layer data"}),applyGlobalQuery:this.props.layer.getSource().getApplyGlobalQuery(),setApplyGlobalQuery:this._onApplyGlobalQueryChange,isFeatureEditorOpenForLayer:this.props.isFeatureEditorOpenForLayer}),t,Object(g.jsx)(Ge.a,{applyForceRefresh:this.props.layer.getSource().getApplyForceRefresh(),setApplyForceRefresh:this._onRespondToForceRefreshChange}))}}const Be=Object(i.connect)((function(t){var e;const n=Object(Z.F)(t);return{layer:n,isFeatureEditorOpenForLayer:(null===(e=Object(Z.f)(t))||void 0===e?void 0:e.layerId)===n.getId()}}),(function(t){return{setLayerQuery:(e,n)=>{t(Object(X.hb)(e,n))},updateSourceProp:(e,n,i)=>t(Object(X.Mb)(e,n,i))}}))(filter_editor_FilterEditor);var ze=n(28),qe=n(97),Ve=n(116),Ue=n(171),We=n(170),Ye=n(342),He=n(158);function Je(t){const[e,n]=Object(l.useState)(void 0),[i,r]=Object(l.useState)([]),[s,o]=Object(l.useState)(!1),[a,c]=Object(l.useState)(!1);Object(l.useEffect)((()=>{if(void 0===t.sourceDescriptor.indexPatternId)return;let e=!1;return o(!0),Object(M.w)().get(t.sourceDescriptor.indexPatternId).then((t=>{e||(o(!1),n(t),r(Object(qe.b)(t.fields)))})).catch((t=>{e||(o(!1),c(!0))})),()=>{e=!0}}),[]);const h=a?Object(g.jsx)(u.a.Fragment,null,Object(g.jsx)(d.EuiCallOut,{color:"warning"},Object(g.jsx)("p",null,p.i18n.translate("xpack.maps.spatialJoinExpression.noDataViewTitle",{defaultMessage:"Unable to load data view {dataViewId}.",values:{dataViewId:t.sourceDescriptor.indexPatternId}}))),Object(g.jsx)(d.EuiSpacer,{size:"s"})):null,f=e?Object(g.jsx)(Ue.a,{value:t.sourceDescriptor.geoField?t.sourceDescriptor.geoField:"",onChange:e=>{e&&t.onSourceDescriptorChange({...t.sourceDescriptor,geoField:e})},geoFields:i,isClearable:!1}):null;return Object(g.jsx)("div",{style:{width:300}},Object(g.jsx)(d.EuiPopoverTitle,null,p.i18n.translate("xpack.maps.spatialJoinExpression.popoverTitle",{defaultMessage:"Configure spatial join"})),Object(g.jsx)(d.EuiSkeletonText,{lines:3,isLoading:s},Object(g.jsx)(d.EuiFormRow,{label:We.a.relationshipLabel},Object(g.jsx)(Ye.a,{distance:"number"==typeof t.sourceDescriptor.distance?t.sourceDescriptor.distance:He.a,onDistanceChange:e=>{t.onSourceDescriptorChange({...t.sourceDescriptor,distance:e})}})),h,Object(g.jsx)(Ve.a,{dataView:e,onChange:e=>{c(!1),n(e);const i=Object(qe.b)(e.fields);r(i),t.onSourceDescriptorChange({...t.sourceDescriptor,indexPatternId:e.id,geoField:i.length?i[0].name:void 0})}}),f))}function Xe(t){const[e,n]=Object(l.useState)(!1),{geoField:i}=t.sourceDescriptor,r=void 0!==i?p.i18n.translate("xpack.maps.spatialJoinExpression.value",{defaultMessage:"features from {geoField}",values:{geoField:i}}):p.i18n.translate("xpack.maps.spatialJoinExpression.emptyValue",{defaultMessage:"-- configure spatial join --"});return Object(g.jsx)(d.EuiPopover,{id:t.sourceDescriptor.id,isOpen:e,closePopover:()=>{n(!1)},ownFocus:!0,initialFocus:"body",anchorPosition:"leftCenter",button:Object(g.jsx)(d.EuiExpression,{onClick:()=>{n(!e)},description:p.i18n.translate("xpack.maps.spatialJoinExpression.description",{defaultMessage:"Join with"}),uppercase:!1,value:r}),repositionOnScroll:!0},Object(g.jsx)(Je,{sourceDescriptor:t.sourceDescriptor,onSourceDescriptorChange:t.onSourceDescriptorChange}))}var Ze=n(92),Qe=n(108),Ke=n(326);function $e(t){function e(e){if(!e||0===e.length)return;const{term:n,...i}=t.sourceDescriptor;t.onSourceDescriptorChange({...i,indexPatternId:e})}function n(e){var n,i;const r=null==e||null===(n=e[0])||void 0===n||null===(i=n.value)||void 0===i?void 0:i.name;r&&t.onLeftFieldChange(r)}const{leftSourceName:i}=t;return Object(g.jsx)("div",{style:{width:300}},Object(g.jsx)(d.EuiPopoverTitle,null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.termJoinExpression.popoverTitle",defaultMessage:"Configure term join"})),Object(g.jsx)(d.EuiFormHelpText,{className:"mapJoinExpressionHelpText"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.termJoinExpression.helpText",defaultMessage:"Configure the shared key that combines layer features, the left source, with the results of an Elasticsearch aggregation, the right source."})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.termJoinExpression.leftSourceLabel",{defaultMessage:"Left source"})},Object(g.jsx)(d.EuiComboBox,{selectedOptions:i?[{value:i,label:i}]:[],isDisabled:!0})),function(){const{leftValue:e,leftFields:i}=t;if(!i)return null;const r=i.map((t=>({value:t,label:t.label})));let s;e&&(s=r.find((t=>t.value.name===e)));const o=s?[s]:[];return Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.termJoinExpression.leftFieldLabel",{defaultMessage:"Left field"}),helpText:p.i18n.translate("xpack.maps.termJoinExpression.leftSourceLabelHelpText",{defaultMessage:"Left source field that contains the shared key."})},Object(g.jsx)(d.EuiComboBox,{placeholder:We.a.fieldSelectPlaceholder,singleSelection:!0,isClearable:!1,options:r,selectedOptions:o,onChange:n}))}(),function(){var n;if(!t.leftValue)return null;const i=Object(M.v)();return Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.termJoinExpression.rightSourceLabel",{defaultMessage:"Right source"})},Object(g.jsx)(i,{placeholder:Object(Ze.d)(),indexPatternId:null!==(n=t.sourceDescriptor.indexPatternId)&&void 0!==n?n:"",onChange:e,isClearable:!1}))}(),t.rightFields&&t.leftValue?Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.termJoinExpression.rightFieldLabel",{defaultMessage:"Right field"}),helpText:p.i18n.translate("xpack.maps.termJoinExpression.rightSourceLabelHelpText",{defaultMessage:"Right source field that contains the shared key."})},Object(g.jsx)(Qe.a,{placeholder:We.a.fieldSelectPlaceholder,value:null!==(r=t.sourceDescriptor.term)&&void 0!==r?r:null,onChange:function(e){e&&0!==e.length&&t.onSourceDescriptorChange({...t.sourceDescriptor,term:e})},fields:Object(qe.i)(t.rightFields),isClearable:!1})):null,t.leftValue?Object(g.jsx)(Ke.a,{initialValue:void 0!==t.sourceDescriptor.size?t.sourceDescriptor.size:j.s,min:1,max:j.s,onChange:e=>{t.onSourceDescriptorChange({...t.sourceDescriptor,size:e})},label:p.i18n.translate("xpack.maps.termJoinExpression.rightSizeLabel",{defaultMessage:"Right size"}),helpText:p.i18n.translate("xpack.maps.termJoinExpression.rightSizeHelpText",{defaultMessage:"Right field term limit."})}):null);var r}function tn(t){const[e,n]=Object(l.useState)(!1),{size:i,term:r}=t.sourceDescriptor,s=void 0!==r?p.i18n.translate("xpack.maps.termJoinExpression.value",{defaultMessage:"{topTerms} terms from {term}",values:{topTerms:void 0!==i?p.i18n.translate("xpack.maps.termJoinExpression.topTerms",{defaultMessage:"top {size}",values:{size:i}}):"",term:r}}):p.i18n.translate("xpack.maps.termJoinExpression.placeholder",{defaultMessage:"-- configure term join --"});return Object(g.jsx)(d.EuiPopover,{id:t.sourceDescriptor.id,isOpen:e,closePopover:()=>{n(!1)},ownFocus:!0,initialFocus:"body",anchorPosition:"leftCenter",button:Object(g.jsx)(d.EuiExpression,{onClick:()=>{n(!e)},description:p.i18n.translate("xpack.maps.termJoinExpression.description",{defaultMessage:"Join with"}),uppercase:!1,value:s}),repositionOnScroll:!0},Object(g.jsx)($e,{leftSourceName:t.leftSourceName,leftValue:t.leftValue,leftFields:t.leftFields,onLeftFieldChange:t.onLeftFieldChange,sourceDescriptor:t.sourceDescriptor,onSourceDescriptorChange:t.onSourceDescriptorChange,rightFields:t.rightFields}))}var en=n(174);class metrics_expression_MetricsExpression extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_renderMetricsEditor",(()=>this.props.rightFields?Object(g.jsx)(en.a,{fields:this.props.rightFields,metrics:this.props.metrics,onChange:this.props.onChange,allowMultipleMetrics:!0,isJoin:!0}):Object(g.jsx)(d.EuiFormErrorText,null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.metricsExpression.joinMustBeSetErrorMessage",defaultMessage:"JOIN must be set"}))))}render(){const t=this.props.metrics.filter((t=>t.type===j.b.COUNT||!!t.field)).map((t=>t.type===j.b.COUNT?j.b.COUNT:`${t.type} ${t.field}`)),e=p.i18n.translate("xpack.maps.layerPanel.metricsExpression.useMetricsDescription",{defaultMessage:"{metricsLength, plural, one {and use metric} other {and use metrics}}",values:{metricsLength:t.length}});return Object(g.jsx)(d.EuiPopover,{id:"metricsPopover",isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,ownFocus:!0,initialFocus:"body",anchorPosition:"leftCenter",button:Object(g.jsx)(d.EuiExpression,{onClick:this._togglePopover,description:e,uppercase:!1,value:t.length>0?t.join(", "):j.b.COUNT}),repositionOnScroll:!0},Object(g.jsx)("div",{style:{width:400}},Object(g.jsx)(d.EuiPopoverTitle,null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.metricsExpression.metricsPopoverTitle",defaultMessage:"Configure join metrics"})),Object(g.jsx)(d.EuiFormHelpText,{className:"mapJoinExpressionHelpText"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.metricsExpression.helpText",defaultMessage:"Metrics are added to layer features and used for data driven styling and tooltip content."})),this._renderMetricsEditor()))}}class where_expression_WhereExpression extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_onQueryChange",(({query:t})=>{this.props.onChange(t),this._closePopover()}))}render(){const t=Object(M.I)(),{whereQuery:e,indexPattern:n}=this.props,i=e&&e.query?e.query:p.i18n.translate("xpack.maps.layerPanel.whereExpression.expressionValuePlaceholder",{defaultMessage:"-- add filter --"});return Object(g.jsx)(d.EuiPopover,{id:"whereClausePopover",isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,ownFocus:!0,anchorPosition:"leftCenter",button:Object(g.jsx)(d.EuiExpression,{onClick:this._togglePopover,description:p.i18n.translate("xpack.maps.layerPanel.whereExpression.expressionDescription",{defaultMessage:"where"}),uppercase:!1,value:i,"data-test-subj":"mapJoinWhereExpressionButton"}),repositionOnScroll:!0},Object(g.jsx)("div",{className:"mapFilterEditor","data-test-subj":"mapJoinWhereFilterEditor"},Object(g.jsx)(d.EuiFormHelpText,{className:"mapJoinExpressionHelpText"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.whereExpression.helpText",defaultMessage:"Use a query to narrow right source."})),Object(g.jsx)(t,{appName:j.e,showFilterBar:!1,showDatePicker:!1,showQueryInput:!0,query:e||Object(M.j)().query.queryString.getDefaultQuery(),onQuerySubmit:this._onQueryChange,indexPatterns:[n],customSubmitButton:Object(g.jsx)(d.EuiButton,{fill:!0,"data-test-subj":"mapWhereFilterEditorSubmitButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.whereExpression.queryBarSubmitButtonLabel",defaultMessage:"Set filter"}))})))}}var nn=n(188);class join_Join extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_nextIndexPatternId",void 0),a()(this,"state",{rightFields:[],indexPattern:void 0,loadError:void 0}),a()(this,"_onLeftFieldChange",(t=>{this.props.onChange({leftField:t,right:this.props.join.right})})),a()(this,"_onRightSourceDescriptorChange",(t=>{var e;const n=t.indexPatternId;(null===(e=this.state.indexPattern)||void 0===e?void 0:e.id)!==n&&(this.setState({indexPattern:void 0,rightFields:[],loadError:void 0}),n&&this._loadRightFields(n)),this.props.onChange({leftField:this.props.join.leftField,right:{...t}})})),a()(this,"_onMetricsChange",(t=>{this.props.onChange({leftField:this.props.join.leftField,right:{...this.props.join.right,metrics:t}})})),a()(this,"_onWhereQueryChange",(t=>{this.props.onChange({leftField:this.props.join.leftField,right:{...this.props.join.right,whereQuery:t}})})),a()(this,"_onApplyGlobalQueryChange",(t=>{this.props.onChange({leftField:this.props.join.leftField,right:{...this.props.join.right,applyGlobalQuery:t}})})),a()(this,"_onApplyGlobalTimeChange",(t=>{this.props.onChange({leftField:this.props.join.leftField,right:{...this.props.join.right,applyGlobalTime:t}})}))}componentDidMount(){this._isMounted=!0,this._loadRightFields(I.a.get(this.props.join,"right.indexPatternId"))}componentWillUnmount(){this._isMounted=!1}async _loadRightFields(t){if(!t)return;let e;this._nextIndexPatternId=t;try{e=await Object(M.w)().get(t)}catch(e){return void(this._isMounted&&this.setState({loadError:Object(Ze.c)(t)}))}this._isMounted&&this._nextIndexPatternId===t&&this.setState({rightFields:e.fields.filter((t=>!ze.indexPatterns.isNestedField(t))),indexPattern:e})}render(){var t;const{join:e,onRemove:n,leftFields:i,leftSourceName:r}=this.props,{rightFields:s,indexPattern:o}=this.state,a=null!==(t=null==e?void 0:e.right)&&void 0!==t?t:{};let l,u,c,h,f,m=!1;return a.type===j.Cb.ES_TERM_SOURCE?(m=void 0!==e.leftField&&Object(He.g)(a),l=Object(g.jsx)(tn,{leftSourceName:r,leftValue:e.leftField,leftFields:i,onLeftFieldChange:this._onLeftFieldChange,sourceDescriptor:a,onSourceDescriptorChange:this._onRightSourceDescriptorChange,rightFields:s})):Object(nn.a)(this.props.join)?(m=void 0!==e.leftField&&Object(He.e)(a),l=Object(g.jsx)(Xe,{sourceDescriptor:a,onSourceDescriptorChange:this._onRightSourceDescriptorChange})):l=Object(g.jsx)(d.EuiText,{size:"s"},Object(g.jsx)("p",null,Object(g.jsx)(d.EuiTextColor,{color:"warning"},p.i18n.translate("xpack.maps.layerPanel.join.joinExpression.noEditorMsg",{defaultMessage:"Unable to edit {type} join.",values:{type:a.type}})))),m&&(u=Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(metrics_expression_MetricsExpression,{metrics:a.metrics?a.metrics:[{type:j.b.COUNT}],rightFields:s,onChange:this._onMetricsChange})),c=Object(g.jsx)(Ae,{applyGlobalQuery:void 0===a.applyGlobalQuery||a.applyGlobalQuery,setApplyGlobalQuery:this._onApplyGlobalQueryChange,label:p.i18n.translate("xpack.maps.layerPanel.join.applyGlobalQueryCheckboxLabel",{defaultMessage:"Apply global search to join"})}),this.state.indexPattern&&this.state.indexPattern.timeFieldName&&(h=Object(g.jsx)(ke,{applyGlobalTime:void 0===a.applyGlobalTime||a.applyGlobalTime,setApplyGlobalTime:this._onApplyGlobalTimeChange,label:p.i18n.translate("xpack.maps.layerPanel.join.applyGlobalTimeCheckboxLabel",{defaultMessage:"Apply global time to join"})}))),o&&m&&(f=Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(where_expression_WhereExpression,{indexPattern:o,whereQuery:a.whereQuery,onChange:this._onWhereQueryChange}))),Object(g.jsx)("div",{className:"mapJoinItem"},Object(g.jsx)(d.EuiFlexGroup,{className:"mapJoinItem__inner",responsive:!1,wrap:!0,gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,{grow:!1},l),u,f),c,h,Object(g.jsx)(d.EuiButtonIcon,{className:"mapJoinItem__delete",iconType:"trash",color:"danger","aria-label":p.i18n.translate("xpack.maps.layerPanel.join.deleteJoinAriaLabel",{defaultMessage:"Delete join"}),title:p.i18n.translate("xpack.maps.layerPanel.join.deleteJoinTitle",{defaultMessage:"Delete join"}),onClick:n}))}}function rn(){const[t,e]=Object(l.useState)(!1);return Object(g.jsx)(d.EuiPopover,{id:"joinHelpPopover",anchorPosition:"leftCenter",button:Object(g.jsx)(d.EuiButtonIcon,{onClick:()=>{e(!t)},iconType:"documentation","aria-label":"Join documentation"}),isOpen:t,closePopover:()=>{e(!1)},repositionOnScroll:!0,ownFocus:!0},Object(g.jsx)(d.EuiPopoverTitle,null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.joinEditor.title",defaultMessage:"Joins"})),Object(g.jsx)("div",null,Object(g.jsx)(d.EuiText,{size:"s",style:{maxWidth:"36em"}},Object(g.jsx)("p",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.intro",defaultMessage:"Joins add metrics to layer features for data driven styling and tooltip content."})," ",Object(g.jsx)("i",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.noMatches",defaultMessage:"Layer features that do have a matches are not visible on the map."}))),Object(g.jsx)("dl",null,Object(g.jsx)("dt",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.termJoinTitle",defaultMessage:"Term join"})),Object(g.jsx)("dd",null,Object(g.jsx)("p",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.termsJoinIntro",defaultMessage:"A term join uses a shared key to combine layer features with metrics from an Elasticsearch terms aggregation."})),Object(g.jsx)(d.EuiLink,{href:Object(M.l)().links.maps.termJoinsExample,target:"_blank",external:!0},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.linkLabel",defaultMessage:"Term join example"}))),Object(g.jsx)("dt",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.spatialJoinTitle",defaultMessage:"Spatial join"})),Object(g.jsx)("dd",null,Object(g.jsx)("p",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.joinDocs.spatialJoinIntro",defaultMessage:"A spatial join uses a geospatial relationship to combine layer features with metrics from an Elasticsearch geo query filters aggregation."})))))))}function sn(t){const e=Object(g.jsx)(d.EuiButtonEmpty,{onClick:t.onClick,size:"xs",iconType:"plusInCircleFilled","aria-label":t.label,isDisabled:t.isDisabled},t.label);return t.isDisabled?Object(g.jsx)(d.EuiToolTip,{content:t.disabledReason},e):e}const on=Object(i.connect)((function(t){return{joins:Object(Z.H)(t)}}),(function(t){return{onChange:(e,n)=>{t(Object(X.eb)(e,n))}}}))((function({joins:t,layer:e,onChange:n,leftJoinFields:i,layerDisplayName:r}){const[s,o]=Object(l.useState)(!1),[a,u]=Object(l.useState)(""),[c,h]=Object(l.useState)(!1);Object(l.useEffect)((()=>{let t=!1;const n=e.getSource();return Object(mt.c)(n)?n.isMvt()?(u(p.i18n.translate("xpack.maps.layerPanel.joinEditor.spatialJoin.disabled.geoJsonOnly",{defaultMessage:"Spatial joins are not supported with vector tiles."})),void o(!1)):(h(!0),n.getSupportedShapeTypes().then((e=>{if(!t){const t=1===e.length&&e[0]===j.Hb.POINT;if(!t)return u(p.i18n.translate("xpack.maps.layerPanel.joinEditor.spatialJoin.disabled.pointsOnly",{defaultMessage:"Spatial joins are not supported with geo_shape geometry."})),o(t),void h(!1);u(""),o(!0),h(!1)}})).catch((t=>{})),()=>{t=!0}):(u(p.i18n.translate("xpack.maps.layerPanel.joinEditor.spatialJoin.disabled.esSourceOnly",{defaultMessage:"Spatial joins are not supported for {sourceType}.",values:{sourceType:n.getType()}})),void o(!1))}),[e]);const m=i=>{var r;n(e,[...t,{...i,right:{...null!==(r=null==i?void 0:i.right)&&void 0!==r?r:{}}}])};return Object(g.jsx)("div",null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.joinEditor.title",defaultMessage:"Joins"})," ",Object(g.jsx)(rn,null))),t.map(((s,o)=>{var a,l;return Object(g.jsx)(join_Join,{key:null!==(a=null==s||null===(l=s.right)||void 0===l?void 0:l.id)&&void 0!==a?a:o,join:s,onChange:i=>{n(e,[...t.slice(0,o),i,...t.slice(o+1)])},onRemove:()=>{n(e,[...t.slice(0,o),...t.slice(o+1)])},leftFields:i,leftSourceName:r})})),Object(g.jsx)(d.EuiSkeletonText,{lines:1,isLoading:c},Object(g.jsx)(d.EuiTextAlign,{textAlign:"center"},Object(g.jsx)(sn,{disabledReason:a,isDisabled:!s,label:p.i18n.translate("xpack.maps.layerPanel.joinEditor.spatialJoin.addButtonLabel",{defaultMessage:"Add spatial join"}),onClick:()=>{m({leftField:"_id",right:{type:j.Cb.ES_DISTANCE_SOURCE,id:Object(f.v4)(),applyGlobalQuery:!0,applyGlobalTime:!0}})}}),Object(g.jsx)(sn,{disabledReason:p.i18n.translate("xpack.maps.layerPanel.joinEditor.termJoin.mvtSingleJoinMsg",{defaultMessage:"Vector tiles can only support a single join."}),isDisabled:e.getSource().isMvt()&&t.length>=1,label:p.i18n.translate("xpack.maps.layerPanel.joinEditor.termJoin.addButtonLabel",{defaultMessage:"Add term join"}),onClick:()=>{m({right:{type:j.Cb.ES_TERM_SOURCE,id:Object(f.v4)(),applyGlobalQuery:!0,applyGlobalTime:!0}})}}))))}));var an=n(154);class flyout_footer_FlyoutFooter extends l.Component{constructor(...t){super(...t),a()(this,"state",{showRemoveModal:!1}),a()(this,"_showRemoveModal",(()=>{this.setState({showRemoveModal:!0})}))}render(){const t=this.props.selectedLayer&&this.state.showRemoveModal?Object(g.jsx)(Vt,{layer:this.props.selectedLayer,onCancel:()=>{this.setState({showRemoveModal:!1})},onConfirm:()=>{this.setState({showRemoveModal:!1}),this.props.removeLayer()}}):null;return Object(g.jsx)(u.a.Fragment,null,t,Object(g.jsx)(d.EuiFlexGroup,{responsive:!1},Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButtonEmpty,{onClick:this.props.cancelLayerPanel,flush:"left","data-test-subj":"layerPanelCancelButton"},this.props.hasStateChanged?an.a.discardChanges:an.a.close)),Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiSpacer,null)),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButtonEmpty,{color:"danger",onClick:this._showRemoveModal,flush:"right","data-test-subj":"mapRemoveLayerButton"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.footer.removeLayerButtonLabel",defaultMessage:"Remove layer"}))),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButton,{disabled:!this.props.hasStateChanged,iconType:"check",onClick:this.props.saveLayerEdits,fill:!0},an.a.keepChanges))))}}const ln=Object(i.connect)((function(t){return{hasStateChanged:Object(Z.M)(t),selectedLayer:Object(Z.F)(t)}}),(t=>({cancelLayerPanel:()=>{t(Object(X.Bb)(Ht.c.NONE)),t(Object(X.ob)(null))},saveLayerEdits:()=>{t(Object(X.Bb)(Ht.c.NONE)),t(Object(X.S)()),t(Object(X.ob)(null))},removeLayer:()=>{t(Object(X.R)())}})))(flyout_footer_FlyoutFooter);var un=n(149);function cn({alpha:t,onChange:e}){return Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerTransparencyLabel",{defaultMessage:"Opacity"}),display:"columnCompressed"},Object(g.jsx)(un.a,{min:0,max:100,step:1,value:Math.round(100*t),onChange:t=>{e(t/100)},showInput:!0,showRange:!0,compressed:!0,append:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.percentageLabel",{defaultMessage:"%",description:"Percentage"})}))}class attribution_popover_AttributionPopover extends l.Component{constructor(...t){super(...t),a()(this,"state",{isPopoverOpen:!1,label:this.props.label,url:this.props.url}),a()(this,"_togglePopover",(()=>{this.setState((t=>({isPopoverOpen:!t.isPopoverOpen})))})),a()(this,"_closePopover",(()=>{this.setState({isPopoverOpen:!1})})),a()(this,"_onApply",(()=>{this.props.onChange({label:this.state.label,url:this.state.url}),this._closePopover()})),a()(this,"_onLabelChange",(t=>{this.setState({label:t.target.value})})),a()(this,"_onUrlChange",(t=>{this.setState({url:t.target.value})}))}_renderPopoverButton(){return Object(g.jsx)(d.EuiButtonEmpty,{className:this.props.popoverButtonClassName,"aria-label":this.props.popoverButtonAriaLabel,onClick:this._togglePopover,size:"xs",iconType:this.props.popoverButtonIcon,flush:"left"},this.props.popoverButtonLabel)}_renderContent(){const t=0!==this.state.label.length&&0!==this.state.url.length,e=this.state.label!==this.props.label||this.state.url!==this.props.url;return Object(g.jsx)("div",{className:"mapAttributionPopover"},Object(g.jsx)(d.EuiPopoverTitle,null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.attribution.attributionFormLabel",defaultMessage:"Attribution"})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.attribution.labelFieldLabel",{defaultMessage:"Label"}),fullWidth:!0},Object(g.jsx)(d.EuiFieldText,{compressed:!0,fullWidth:!0,value:this.state.label,onChange:this._onLabelChange})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.attribution.urlLabel",{defaultMessage:"Link"}),fullWidth:!0},Object(g.jsx)(d.EuiFieldText,{compressed:!0,fullWidth:!0,value:this.state.url,onChange:this._onUrlChange})),Object(g.jsx)(d.EuiSpacer,{size:"xs"}),Object(g.jsx)(d.EuiPopoverFooter,null,Object(g.jsx)(d.EuiTextAlign,{textAlign:"right"},Object(g.jsx)(d.EuiButton,{fill:!0,isDisabled:!t||!e,onClick:this._onApply,size:"s"},an.a.apply))))}render(){return Object(g.jsx)(d.EuiPopover,{id:"attributionPopover",panelPaddingSize:"s",anchorPosition:"leftCenter",button:this._renderPopoverButton(),isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,ownFocus:!0},this._renderContent())}}function hn(t){return t.layer.getSource().getAttributionProvider()?null:function(){const e=t.layer.getDescriptor();return Object(g.jsx)("fieldset",{"aria-labelledby":"mapsLayerSettingsAttributionLegend"},Object(g.jsx)("div",{className:"mapAttributionFormRow"},Object(g.jsx)("legend",{id:"mapsLayerSettingsAttributionLegend",className:"mapAttributionFormRow__legend"},p.i18n.translate("xpack.maps.layerSettings.attributionLegend",{defaultMessage:"Attribution"})),void 0===e.attribution?Object(g.jsx)("div",{className:"mapAttributionFormRow__field"},Object(g.jsx)(attribution_popover_AttributionPopover,{onChange:t.onChange,popoverButtonIcon:"plusInCircleFilled",popoverButtonLabel:p.i18n.translate("xpack.maps.attribution.addBtnLabel",{defaultMessage:"Add attribution"}),popoverButtonAriaLabel:p.i18n.translate("xpack.maps.attribution.addBtnAriaLabel",{defaultMessage:"Add attribution"}),popoverButtonClassName:"mapAttributionFormRow__addButton",label:"",url:""})):Object(g.jsx)("div",{className:"mapAttributionFormRow__field"},Object(g.jsx)(d.EuiPanel,{color:"subdued",paddingSize:"s"},Object(g.jsx)(d.EuiLink,{color:"text",href:e.attribution.url,target:"_blank"},e.attribution.label)),Object(g.jsx)("div",{className:"mapAttributionFormRow__buttons"},Object(g.jsx)(attribution_popover_AttributionPopover,{onChange:t.onChange,popoverButtonIcon:"pencil",popoverButtonAriaLabel:p.i18n.translate("xpack.maps.attribution.editBtnAriaLabel",{defaultMessage:"Edit attribution"}),popoverButtonLabel:an.a.edit,label:e.attribution.label,url:e.attribution.url}),Object(g.jsx)(d.EuiButtonEmpty,{onClick:()=>{t.onChange()},size:"xs",iconType:"trash",color:"danger","aria-label":p.i18n.translate("xpack.maps.attribution.clearBtnAriaLabel",{defaultMessage:"Clear attribution"})},an.a.clear)))))}()}const dn=Object(i.connect)(null,(function(t){return{clearLayerAttribution:e=>t(Object(X.q)(e)),setLayerAttribution:(e,n)=>t(Object(X.fb)(e,n)),updateLabel:(e,n)=>t(Object(X.Fb)(e,n)),updateLocale:(e,n)=>t(Object(X.Gb)(e,n)),updateMinZoom:(e,n)=>t(Object(X.Ib)(e,n)),updateMaxZoom:(e,n)=>t(Object(X.Hb)(e,n)),updateAlpha:(e,n)=>t(Object(X.Db)(e,n)),updateLabelsOnTop:(e,n)=>t(Object(X.Cb)(e,n)),updateIncludeInFitToBounds:(e,n)=>t(Object(X.Ab)(e,n)),updateDisableTooltips:(e,n)=>t(Object(X.wb)(e,n))}}))((function(t){const e=t.layer.getMinSourceZoom(),n=j.hb,i=t.layer.getId(),r=e=>{const{value:n}=e.target;n&&t.updateLocale(i,n)};return Object(g.jsx)(l.Fragment,null,Object(gt.c)(t.layer)?Object(g.jsx)(u.a.Fragment,null,Object(g.jsx)(d.EuiCallOut,{title:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerGroupCalloutTitle",{defaultMessage:"Drag layers in and out of the group"}),iconType:"layers"},Object(g.jsx)(d.EuiText,null,Object(g.jsx)("ul",null,Object(g.jsx)("li",null,p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerGroupAddToFront",{defaultMessage:"To add your first layer, drag it onto the group name."})),Object(g.jsx)("li",null,p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerGroupAddToPosition",{defaultMessage:"To add another layer, drag it anywhere above the last layer in the group."})),Object(g.jsx)("li",null,p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerGroupRemove",{defaultMessage:"To remove a layer, drag it above or below the group."}))))),Object(g.jsx)(d.EuiSpacer,{size:"m"})):null,Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.layerSettingsTitle",defaultMessage:"Layer settings"}))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerNameLabel",{defaultMessage:"Name"}),display:"columnCompressed"},Object(g.jsx)(d.EuiFieldText,{value:t.layer.getLabel(),onChange:e=>{const n=e.target.value;t.updateLabel(i,n)},compressed:!0})),Object(gt.c)(t.layer)?null:Object(g.jsx)(Re.ValidatedDualRange,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.visibleZoomLabel",{defaultMessage:"Visibility"}),formRowDisplay:"columnCompressed",min:e,max:n,value:[t.layer.getMinZoom(),t.layer.getMaxZoom()],showInput:"inputWithPopover",showRange:!0,showLabels:!0,onChange:r=>{t.updateMinZoom(i,Math.max(e,parseInt(r[0],10))),t.updateMaxZoom(i,Math.min(n,parseInt(r[1],10)))},allowEmptyRange:!1,compressed:!0,prepend:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.visibleZoom",{defaultMessage:"Zoom levels"})}),Object(gt.c)(t.layer)?null:Object(g.jsx)(cn,{alpha:t.layer.getAlpha(),onChange:e=>{t.updateAlpha(i,e)}}),t.layer.supportsLabelsOnTop()?Object(g.jsx)(d.EuiFormRow,{display:"columnCompressedSwitch"},Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.labelsOnTop",{defaultMessage:"Show labels on top"}),checked:t.layer.areLabelsOnTop(),onChange:e=>{t.updateLabelsOnTop(i,e.target.checked)},"data-test-subj":"mapLayerPanelApplyGlobalQueryCheckbox",compressed:!0})):null,(()=>{var e;if(!t.layer.supportsLabelLocales())return null;const n=[{text:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.labelLanguageAutoselectDropDown",{defaultMessage:"Autoselect based on Kibana locale"}),value:j.g},{value:"ar",text:"العربية"},{value:"de",text:"Deutsch"},{value:"en",text:"English"},{value:"es",text:"Español"},{value:"fr-fr",text:"Français"},{value:"hi-in",text:"हिन्दी"},{value:"it",text:"Italiano"},{value:"ja-jp",text:"日本語"},{value:"ko",text:"한국어"},{value:"pt-pt",text:"Português"},{value:"ru-ru",text:"русский"},{value:"zh-cn",text:"简体中文"},{text:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.labelLanguageNoneDropDown",{defaultMessage:"None"}),value:j.qb}];return Object(g.jsx)(d.EuiFormRow,{display:"columnCompressed",label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.labelLanguageLabel",{defaultMessage:"Label language"})},Object(g.jsx)(d.EuiSelect,{options:n,value:null!==(e=t.layer.getLocale())&&void 0!==e?e:j.qb,onChange:r,compressed:!0}))})(),Object(gt.c)(t.layer)?null:Object(g.jsx)(hn,{layer:t.layer,onChange:e=>{e?t.setLayerAttribution(i,e):t.clearLayerAttribution(i)}}),!t.supportsFitToBounds||Object(gt.c)(t.layer)?null:Object(g.jsx)(d.EuiFormRow,{display:"columnCompressedSwitch"},Object(g.jsx)(d.EuiToolTip,{position:"top",content:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.fittableFlagTooltip",{defaultMessage:"Fit to data bounds adjusts your map extent to show all of your data. Layers may provide reference data and should not be included in the fit to data bounds computation. Use this option to exclude a layer from fit to data bounds computation."})},Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.fittableFlagLabel",{defaultMessage:"Include layer in fit to data bounds computation"}),checked:t.layer.isIncludeInFitToBounds(),onChange:e=>{t.updateIncludeInFitToBounds(i,e.target.checked)},"data-test-subj":"mapLayerPanelFittableFlagCheckbox",compressed:!0}))),Object(et.f)(t.layer)?Object(g.jsx)(d.EuiFormRow,{display:"columnCompressedSwitch"},Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.layerPanel.settingsPanel.DisableTooltips",{defaultMessage:"Show tooltips"}),disabled:!t.layer.canShowTooltip(),checked:!t.layer.areTooltipsDisabled(),onChange:e=>{t.updateDisableTooltips(i,!e.target.checked)},compressed:!0})):null),Object(g.jsx)(d.EuiSpacer,{size:"s"}))})),pn=Object(i.connect)((function(t){return{layer:Object(Z.F)(t)}}),(function(t){return{updateStyleDescriptor:e=>{t(Object(X.Jb)(e))},updateCustomIcons:e=>{t(Object(X.vb)(e))}}}))((function({layer:t,updateStyleDescriptor:e,updateCustomIcons:n}){const i=t.renderStyleEditor(e,n);return i?Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiPanel,{className:"mapStyleSettings"},Object(g.jsx)(d.EuiFlexGroup,null,Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.layerPanel.styleSettingsTitle",defaultMessage:"Layer style"}))))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),i),Object(g.jsx)(d.EuiSpacer,{size:"s"})):null})),fn=Object(i.connect)((function(t){return{dataFilters:Object(Z.c)(t)}}),{})((function(t){const[e,n]=Object(l.useState)(!1),[i,r]=Object(l.useState)([]);return Object(l.useEffect)((()=>{let e=!1;return n(!0),t.source.getImmutableProperties(t.dataFilters).then((t=>{e||(r(t),n(!1))})),()=>{e=!0}}),[t.dataFilters,t.source]),Object(g.jsx)("div",{className:"mapLayerPanel__sourceDetails"},Object(g.jsx)(d.EuiAccordion,{id:"accordion1",buttonContent:p.i18n.translate("xpack.maps.layerPanel.sourceDetailsLabel",{defaultMessage:"Source details"})},Object(g.jsx)(d.EuiSpacer,{size:"xs"}),Object(g.jsx)(d.EuiSkeletonText,{lines:3,size:"s",isLoading:e},Object(g.jsx)(d.EuiText,{color:"subdued",size:"s"},i.map((({label:t,value:e,link:n})=>Object(g.jsx)("p",{key:t,className:"mapLayerPanel__sourceDetail"},Object(g.jsx)("strong",null,t)," ",n?Object(g.jsx)(d.EuiLink,{href:n,target:"_blank"},e):Object(g.jsx)("span",null,e))))))))})),gn=new De.Storage(window.localStorage);class edit_layer_panel_EditLayerPanel extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{displayName:"",leftJoinFields:[],supportsFitToBounds:!1}),a()(this,"_loadSupportsFitToBounds",(async()=>{if(!this.props.selectedLayer)return;const t=await this.props.selectedLayer.supportsFitToBounds();this._isMounted&&this.setState({supportsFitToBounds:t})})),a()(this,"_loadDisplayName",(async()=>{if(!this.props.selectedLayer)return;const t=await this.props.selectedLayer.getDisplayName();this._isMounted&&this.setState({displayName:t})})),a()(this,"_onSourceChange",((...t)=>this.props.updateSourceProps(this.props.selectedLayer.getId(),t)))}componentDidMount(){this._isMounted=!0,this._loadDisplayName(),this._loadLeftJoinFields(),this._loadSupportsFitToBounds()}componentWillUnmount(){this._isMounted=!1}async _loadLeftJoinFields(){if(!this.props.selectedLayer||!Object(et.f)(this.props.selectedLayer))return;if(!this.props.selectedLayer.getSource().supportsJoins()||void 0===this.props.selectedLayer.getLeftJoinFields)return;let t=[];try{const e=(await this.props.selectedLayer.getLeftJoinFields()).map((async t=>({name:t.getName(),label:await t.getLabel()})));t=await Promise.all(e)}catch(t){}this._isMounted&&this.setState({leftJoinFields:t})}_renderFilterSection(){return this.props.selectedLayer&&!Object(gt.c)(this.props.selectedLayer)&&Object(mt.c)(this.props.selectedLayer.getSource())?Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(Be,null)),Object(g.jsx)(d.EuiSpacer,{size:"s"})):null}_renderJoinSection(){if(this.props.selectedLayer&&Object(et.f)(this.props.selectedLayer))return this.props.selectedLayer.getSource().supportsJoins()?Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(on,{layer:this.props.selectedLayer,leftJoinFields:this.state.leftJoinFields,layerDisplayName:this.state.displayName})),Object(g.jsx)(d.EuiSpacer,{size:"s"})):null}_renderSourceDetails(){return!this.props.selectedLayer||Object(gt.c)(this.props.selectedLayer)?null:Object(g.jsx)(fn,{source:this.props.selectedLayer.getSource()})}_renderSourceEditor(){var t;if(!this.props.selectedLayer)return null;const e=this.props.selectedLayer.getDescriptor();return Object(gt.c)(this.props.selectedLayer)?null:this.props.selectedLayer.renderSourceSettingsEditor({currentLayerType:this.props.selectedLayer.getType(),hasSpatialJoins:(null!==(t=e.joins)&&void 0!==t?t:[]).some(nn.a),numberOfJoins:e.joins?e.joins.length:0,onChange:this._onSourceChange,onStyleDescriptorChange:this.props.updateStyleDescriptor,style:this.props.selectedLayer.getStyleForEditing()})}_renderStyleEditor(){return!this.props.selectedLayer||Object(gt.c)(this.props.selectedLayer)?null:Object(g.jsx)(pn,null)}render(){return this.props.selectedLayer?Object(g.jsx)(Re.KibanaContextProvider,{services:{appName:"maps",storage:gn,data:Object(M.j)(),...Object(M.f)()}},Object(g.jsx)(d.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(d.EuiFlyoutHeader,{hasBorder:!0,className:"mapLayerPanel__header"},Object(g.jsx)(d.EuiFlexGroup,{responsive:!1,alignItems:"center",gutterSize:"s"},Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiIcon,{type:this.props.selectedLayer.getLayerTypeIconName()})),Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiTitle,{size:"s"},Object(g.jsx)("h2",null,this.state.displayName)))),Object(g.jsx)(d.EuiSpacer,{size:"xs"}),this._renderSourceDetails()),Object(g.jsx)("div",{className:"mapLayerPanel__body"},Object(g.jsx)("div",{className:"mapLayerPanel__bodyOverflow"},Object(g.jsx)(dn,{layer:this.props.selectedLayer,supportsFitToBounds:this.state.supportsFitToBounds}),this._renderSourceEditor(),this._renderFilterSection(),this._renderJoinSection(),this._renderStyleEditor())),Object(g.jsx)(d.EuiFlyoutFooter,{className:"mapLayerPanel__footer"},Object(g.jsx)(ln,null)))):null}}var mn=n(106);const _n=Object(i.connect)((function(t){const e=Object(Z.F)(t);let n="none";if(e){const t=!Object(gt.c)(e)&&e.getSource();n=t&&Object(mn.c)(t,"supportsJoins")?`${e.getId()}${t.supportsJoins()}`:e.getId()}return{key:n,selectedLayer:e}}),(function(t){return{updateSourceProps:async(e,n)=>await t(Object(X.Nb)(e,n)),updateStyleDescriptor:e=>{t(Object(X.Jb)(e))}}}))(edit_layer_panel_EditLayerPanel);var yn=n(344);const vn=Object(i.connect)((function(t){return{hasPreviewLayers:Object(Z.O)(t),autoOpenLayerWizardId:Object(Q.a)(t)}}),(function(t){return{addPreviewLayers:e=>{t(Object(X.n)(e))},addLayersAndClose:()=>{t(Object(X.Bb)(Ht.c.NONE)),t(Object(X.O)())},addLayersAndContinue:()=>{t(Object(X.ab)()),t(Object(X.Bb)(Ht.c.LAYER_PANEL)),t(Object(X.O)())},closeFlyout:()=>{t(Object(X.Bb)(Ht.c.NONE)),t(Object(X.Q)())},enableEditMode:()=>{t(Object(X.X)()),t(Object(X.W)(j.x.DRAW_SHAPES))},clearAutoOpenLayerWizardId:()=>{t(Object(X.V)(""))}}}),null,{forwardRef:!0})(yn.b),bn=[{id:j.S.LAST_SAVED_LOCATION,label:p.i18n.translate("xpack.maps.mapSettingsPanel.lastSavedLocationLabel",{defaultMessage:"Map location at save"})},{id:j.S.AUTO_FIT_TO_BOUNDS,label:p.i18n.translate("xpack.maps.mapSettingsPanel.autoFitToBoundsLocationLabel",{defaultMessage:"Auto fit map to data bounds"})},{id:j.S.FIXED_LOCATION,label:p.i18n.translate("xpack.maps.mapSettingsPanel.fixedLocationLabel",{defaultMessage:"Fixed location"})},{id:j.S.BROWSER_LOCATION,label:p.i18n.translate("xpack.maps.mapSettingsPanel.browserLocationLabel",{defaultMessage:"Browser location"})}];function xn({center:t,settings:e,updateMapSetting:n,zoom:i}){const r=t=>{let i=parseFloat(t.target.value);isNaN(i)?i=0:i<-90?i=-90:i>90&&(i=90),n("fixedLocation",{...e.fixedLocation,lat:i})},s=t=>{let i=parseFloat(t.target.value);isNaN(i)?i=0:i<-180?i=-180:i>180&&(i=180),n("fixedLocation",{...e.fixedLocation,lon:i})},o=t=>{n("fixedLocation",{...e.fixedLocation,zoom:t})},a=t=>{n("browserLocation",{zoom:t})},l=()=>{n("fixedLocation",{lat:t.lat,lon:t.lon,zoom:Math.round(i)})};return Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.navigationTitle",defaultMessage:"Navigation"}))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiFormRow,null,Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.autoFitToDataBoundsLabel",{defaultMessage:"Auto fit map to data bounds"}),checked:e.autoFitToDataBounds,onChange:t=>{n("autoFitToDataBounds",t.target.checked)},compressed:!0,"data-test-subj":"autoFitToDataBoundsSwitch"})),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(Re.ValidatedDualRange,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.zoomRangeLabel",{defaultMessage:"Zoom range"}),formRowDisplay:"columnCompressed",min:j.mb,max:j.hb,value:[e.minZoom,e.maxZoom],showInput:"inputWithPopover",showRange:!0,showLabels:!0,onChange:t=>{const i=Math.max(j.mb,parseInt(t[0],10)),r=Math.min(j.hb,parseInt(t[1],10));n("minZoom",i),n("maxZoom",r),e.fixedLocation.zoom<i?o(i):e.fixedLocation.zoom>r&&o(r),e.browserLocation.zoom<i?a(i):e.browserLocation.zoom>r&&a(r)},allowEmptyRange:!1,compressed:!0}),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.source.mapSettingsPanel.initialLocationLabel",{defaultMessage:"Initial map location"})},Object(g.jsx)(d.EuiRadioGroup,{options:bn,idSelected:e.initialLocation,onChange:t=>{n("initialLocation",t)}})),function(){if(e.initialLocation===j.S.LAST_SAVED_LOCATION||e.initialLocation===j.S.AUTO_FIT_TO_BOUNDS)return null;const t=Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.initialZoomLabel",{defaultMessage:"Initial zoom"}),display:"columnCompressed"},Object(g.jsx)(un.a,{min:e.minZoom,max:e.maxZoom,step:1,value:e.initialLocation===j.S.BROWSER_LOCATION?e.browserLocation.zoom:e.fixedLocation.zoom,onChange:e.initialLocation===j.S.BROWSER_LOCATION?a:o,showInput:!0,showRange:!0,compressed:!0}));return e.initialLocation===j.S.BROWSER_LOCATION?t:Object(g.jsx)(u.a.Fragment,null,Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.initialLatLabel",{defaultMessage:"Initial latitude"}),display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{value:e.fixedLocation.lat,onChange:r,compressed:!0})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.initialLonLabel",{defaultMessage:"Initial longitude"}),display:"columnCompressed"},Object(g.jsx)(d.EuiFieldNumber,{value:e.fixedLocation.lon,onChange:s,compressed:!0})),t,Object(g.jsx)(d.EuiFlexGroup,{justifyContent:"flexEnd"},Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButtonEmpty,{onClick:l},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.useCurrentViewBtnLabel",defaultMessage:"Set to current view"})))))}())}var En=n(167);function Sn({settings:t,updateMapSetting:e}){return Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.spatialFiltersTitle",defaultMessage:"Spatial filters"}))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),Object(g.jsx)(d.EuiFormRow,null,Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.showSpatialFiltersLabel",{defaultMessage:"Show spatial filters on map"}),checked:t.showSpatialFilters,onChange:t=>{e("showSpatialFilters",t.target.checked)},compressed:!0})),t.showSpatialFilters?Object(g.jsx)(u.a.Fragment,null,Object(g.jsx)(cn,{alpha:t.spatialFiltersAlpa,onChange:t=>{e("spatialFiltersAlpa",t)}}),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.spatialFiltersFillColorLabel",{defaultMessage:"Fill color"}),display:"columnCompressed"},Object(g.jsx)(En.a,{color:t.spatialFiltersFillColor,onChange:t=>{e("spatialFiltersFillColor",t)}})),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.spatialFiltersLineColorLabel",{defaultMessage:"Border color"}),display:"columnCompressed"},Object(g.jsx)(En.a,{color:t.spatialFiltersLineColor,onChange:t=>{e("spatialFiltersLineColor",t)}}))):null)}function Cn({settings:t,updateMapSetting:e}){return Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.displayTitle",defaultMessage:"Display"}))),Object(g.jsx)(d.EuiFormRow,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.backgroundColorLabel",{defaultMessage:"Background color"}),display:"columnCompressed"},Object(g.jsx)(En.a,{color:t.backgroundColor,onChange:t=>{e("backgroundColor",t)}})),Object(g.jsx)(d.EuiFormRow,null,Object(g.jsx)(d.EuiSwitch,{label:p.i18n.translate("xpack.maps.mapSettingsPanel.showScaleLabel",{defaultMessage:"Show scale"}),checked:t.showScaleControl,onChange:t=>{e("showScaleControl",t.target.checked)},compressed:!0})))}var On=n(184),In=n(347);class custom_icons_panel_CustomIconsPanel extends l.Component{constructor(...t){super(...t),a()(this,"state",{isModalVisible:!1,selectedIcon:void 0}),a()(this,"_handleIconEdit",(t=>{this.setState({selectedIcon:t,isModalVisible:!0})})),a()(this,"_handleNewIcon",(()=>{this.setState({isModalVisible:!0})})),a()(this,"_renderModal",(()=>{if(!this.state.isModalVisible)return null;if(this.state.selectedIcon){const{symbolId:t,label:e,svg:n,cutoff:i,radius:r}=this.state.selectedIcon;return Object(g.jsx)(In.a,{title:p.i18n.translate("xpack.maps.mapSettingsPanel.editCustomIcon",{defaultMessage:"Edit custom icon"}),symbolId:t,label:e,svg:n,cutoff:i||j.p,radius:r||j.q,onSave:this._handleSave,onCancel:this._hideModal,onDelete:this._handleDelete})}return Object(g.jsx)(In.a,{title:p.i18n.translate("xpack.maps.mapSettingsPanel.addCustomIcon",{defaultMessage:"Add custom icon"}),cutoff:j.p,radius:j.q,onSave:this._handleSave,onCancel:this._hideModal})})),a()(this,"_hideModal",(()=>{this.setState({isModalVisible:!1,selectedIcon:void 0})})),a()(this,"_handleSave",(t=>{const{symbolId:e,label:n,svg:i,cutoff:r,radius:s}=t,o=[...this.props.customIcons.filter((t=>t.symbolId!==e)),{symbolId:e,svg:i,label:n,cutoff:r,radius:s}];this.props.updateCustomIcons(o),this._hideModal()})),a()(this,"_handleDelete",(t=>{this.props.deleteCustomIcon(t),this._hideModal()})),a()(this,"_renderCustomIconsList",(()=>{const t=Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiTextAlign,{textAlign:"center"},Object(g.jsx)(d.EuiButtonEmpty,{size:"xs",iconType:"plusInCircleFilled",onClick:()=>this._handleNewIcon(),"data-test-subj":"mapsCustomIconPanel-add"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.customIconsAddIconButton",defaultMessage:"Add"}))));if(!this.props.customIcons.length)return Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiText,{size:"s",textAlign:"center"},Object(g.jsx)("p",null,Object(g.jsx)(d.EuiTextColor,{color:"subdued"},Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.customIcons.emptyState.description",defaultMessage:"Add a custom icon that can be used in layers in this map."})))),t);const e=this.props.customIcons.map((t=>{const{symbolId:e,label:n,svg:i}=t;return{label:n,key:e,icon:Object(g.jsx)(On.a,{symbolId:n,svg:i,fill:Object(M.z)()?"rgb(223, 229, 239)":"rgb(52, 55, 65)"}),extraAction:{iconType:"gear",alwaysShow:!0,onClick:()=>{this._handleIconEdit(t)}}}}));return Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiListGroup,{listItems:e}),t)}))}render(){return Object(g.jsx)(l.Fragment,null,Object(g.jsx)(d.EuiPanel,null,Object(g.jsx)(d.EuiTitle,{size:"xs"},Object(g.jsx)("h5",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.customIconsTitle",defaultMessage:"Custom icons"}))),Object(g.jsx)(d.EuiSpacer,{size:"m"}),this._renderCustomIconsList()),this._renderModal())}}const wn=Object(i.connect)((function(t){return{center:Object(Z.r)(t),customIcons:Object(Z.b)(t),hasMapSettingsChanges:Object(Z.N)(t),settings:Object(Z.w)(t),zoom:Object(Z.x)(t)}}),(function(t){return{cancelChanges:()=>{t(Object(X.U)()),t(Object(X.Bb)(Ht.c.NONE))},keepChanges:()=>{t(Object(X.Bb)(Ht.c.NONE))},updateMapSetting:(e,n)=>{t(Object(X.Kb)(e,n))},updateCustomIcons:e=>{t(Object(X.vb)(e))},deleteCustomIcon:e=>{t(Object(X.x)(e))}}}))((function({cancelChanges:t,center:e,hasMapSettingsChanges:n,keepChanges:i,settings:r,customIcons:s,updateMapSetting:o,updateCustomIcons:a,deleteCustomIcon:l,zoom:u}){return Object(g.jsx)(d.EuiFlexGroup,{direction:"column",gutterSize:"none"},Object(g.jsx)(d.EuiFlyoutHeader,{hasBorder:!0,className:"mapLayerPanel__header"},Object(g.jsx)(d.EuiTitle,{size:"s"},Object(g.jsx)("h2",null,Object(g.jsx)(Pt.FormattedMessage,{id:"xpack.maps.mapSettingsPanel.title",defaultMessage:"Settings"})))),Object(g.jsx)("div",{className:"mapLayerPanel__body"},Object(g.jsx)("div",{className:"mapLayerPanel__bodyOverflow"},Object(g.jsx)(custom_icons_panel_CustomIconsPanel,{customIcons:s,updateCustomIcons:a,deleteCustomIcon:l}),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(Cn,{settings:r,updateMapSetting:o}),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(xn,{center:e,settings:r,updateMapSetting:o,zoom:u}),Object(g.jsx)(d.EuiSpacer,{size:"s"}),Object(g.jsx)(Sn,{settings:r,updateMapSetting:o}))),Object(g.jsx)(d.EuiFlyoutFooter,{className:"mapLayerPanel__footer"},Object(g.jsx)(d.EuiFlexGroup,{responsive:!1},Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButtonEmpty,{onClick:t,flush:"left","data-test-subj":"layerPanelCancelButton"},n?an.a.discardChanges:an.a.close)),Object(g.jsx)(d.EuiFlexItem,null,Object(g.jsx)(d.EuiSpacer,null)),Object(g.jsx)(d.EuiFlexItem,{grow:!1},Object(g.jsx)(d.EuiButton,{disabled:!n,iconType:"check",onClick:i,fill:!0,"data-test-subj":"mapSettingSubmitButton"},an.a.keepChanges)))))}));class map_container_MapContainer extends l.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"_isInitalLoadRenderTimerStarted",!1),a()(this,"state",{isInitialLoadRenderTimeoutComplete:!1,domId:Object(f.v4)(),showFitToBoundsButton:!1,showTimesliderButton:!1}),a()(this,"_onInitialLoadRenderComplete",(()=>{const t=document.querySelector(`[data-dom-id="${this.state.domId}"]`);t&&t.dispatchEvent(new CustomEvent("renderComplete",{bubbles:!0}))})),a()(this,"_startInitialLoadRenderTimer",(()=>{window.setTimeout((()=>{this._isMounted&&(this.setState({isInitialLoadRenderTimeoutComplete:!0}),this._onInitialLoadRenderComplete())}),j.vb)}))}componentDidMount(){this._isMounted=!0,this._loadShowFitToBoundsButton(),this._loadShowTimesliderButton()}componentDidUpdate(){this._loadShowFitToBoundsButton(),this._loadShowTimesliderButton(),!this.props.isSharable||this.props.isMapLoading||this._isInitalLoadRenderTimerStarted||(this._isInitalLoadRenderTimerStarted=!0,this._startInitialLoadRenderTimer())}componentWillUnmount(){this._isMounted=!1,this.props.cancelAllInFlightRequests()}async _loadShowFitToBoundsButton(){const t=this.props.layerList.map((async t=>await t.isFittable())),e=(await Promise.all(t)).some((t=>t));this._isMounted&&this.state.showFitToBoundsButton!==e&&this.setState({showFitToBoundsButton:e})}async _loadShowTimesliderButton(){if(!this.props.settings.showTimesliderToggleButton)return void(this.state.showTimesliderButton&&this.setState({showTimesliderButton:!1}));const t=this.props.layerList.map((async t=>await t.isFilteredByGlobalTime())),e=(await Promise.all(t)).some((t=>t));this._isMounted&&this.state.showTimesliderButton!==e&&this.setState({showTimesliderButton:e})}render(){const{addFilters:t,getFilterActions:e,getActionContext:n,onSingleValueTrigger:i,flyoutDisplay:r,isFullScreen:o,exitFullScreen:a,mapInitError:l,renderTooltipContent:u}=this.props;if(l)return Object(g.jsx)("div",{"data-render-complete":!0,"data-shared-item":!0,"data-title":this.props.title,"data-description":this.props.description},Object(g.jsx)(d.EuiCallOut,{title:p.i18n.translate("xpack.maps.map.initializeErrorTitle",{defaultMessage:"Unable to initialize map"}),color:"danger",iconType:"cross"},Object(g.jsx)("p",null,l)));let c,f=null;r===Ht.c.ADD_LAYER_WIZARD?f=Object(g.jsx)(vn,null):r===Ht.c.LAYER_PANEL?f=Object(g.jsx)(_n,null):r===Ht.c.MAP_SETTINGS_PANEL&&(f=Object(g.jsx)(wn,null)),o&&(c=Object(g.jsx)(C,{onExit:a}));const m=this.props.isSharable?{"data-dom-id":this.state.domId,"data-render-complete":this.state.isInitialLoadRenderTimeoutComplete,"data-shared-item":!0,"data-title":this.props.title,"data-description":this.props.description}:{};return Object(g.jsx)(d.EuiFlexGroup,s()({gutterSize:"none",responsive:!1},m),Object(g.jsx)(d.EuiFlexItem,{className:"mapMapWrapper",style:{backgroundColor:this.props.settings.backgroundColor}},Object(g.jsx)(Ft,{addFilters:t,getFilterActions:e,getActionContext:n,onSingleValueTrigger:i,renderTooltipContent:u}),!this.props.settings.hideToolbarOverlay&&!Object(M.W)()&&Object(g.jsx)(Pe,{addFilters:t,getFilterActions:e,getActionContext:n,showFitToBoundsButton:this.state.showFitToBoundsButton,showTimesliderButton:this.state.showTimesliderButton}),Object(g.jsx)(ee,null),this.props.isTimesliderOpen&&Object(g.jsx)(se,{waitForTimesliceToLoad$:this.props.waitUntilTimeLayersLoad$})),Object(g.jsx)(d.EuiFlexItem,{className:h()("mapMapLayerPanel",{"mapMapLayerPanel-isVisible":!!f}),grow:!1},f),c)}}const Ln=Object(i.connect)((function(t){return{isTimesliderOpen:Object(Q.h)(t),isMapLoading:Object(Z.P)(t),flyoutDisplay:Object(Q.d)(t),isFullScreen:Object(Q.e)(t),mapInitError:Object(Z.u)(t),indexPatternIds:Object(Z.C)(t),settings:Object(Z.w)(t),layerList:Object(Z.n)(t)}}),(function(t){return{exitFullScreen:()=>t(Object(X.A)()),cancelAllInFlightRequests:()=>t(Object(X.o)())}}))(map_container_MapContainer)},340:function(t,e,n){"use strict";n.d(e,"a",(function(){return esql_source_ESQLSource})),n.d(e,"b",(function(){return Q}));var i=n(6),r=n.n(i),s=n(2),o=n.n(s),a=n(3),l=n(1),u=n(56),c=n(79);function h(t){var e;const{ast:n}=Object(c.getAstAndSyntaxErrors)(t),i=n.find((({name:t})=>["from","metrics"].includes(t))),r=(null!==(e=null==i?void 0:i.args)&&void 0!==e?e:[]).filter((t=>"index"===t.sourceType));return null==r?void 0:r.map((t=>t.text)).join(",")}var d=n(58);var p=n(28),f=n(0),g=n(93),m=n(117),_=n(106),y=n(189),v=n(5),b=n(590);const x="esql";async function E(t){if(crypto.subtle){const e=new TextEncoder,n=await crypto.subtle.digest("SHA-256",e.encode(t));return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}{const{sha256:e}=await n.e(18).then(n.bind(null,646));return e(t)}}async function S(t,e){var n,i,r;const s=await e.create({title:t,type:x,id:await E(`esql-${t}`)});return t&&"date"===(null==s||null===(n=s.fields)||void 0===n||null===(i=n.getByName)||void 0===i||null===(r=i.call(n,"@timestamp"))||void 0===r?void 0:r.type)&&(s.timeFieldName="@timestamp"),s}async function C({esqlQuery:t,search:e,signal:n}){try{var i;return null!==(i=(await Object(l.lastValueFrom)(e({params:{query:`${t} | limit 0`}},{abortSignal:n,strategy:"esql_async"}))).rawResponse.columns)&&void 0!==i?i:[]}catch(t){throw new Error(a.i18n.translate("esqlUtils.columnsErrorMsg",{defaultMessage:"Unable to load columns. {errorMessage}",values:{errorMessage:t.message}}))}}n(43);const O="geo_point",I="geo_shape";function w(t){return[O,I].includes(t.type)}function L(t){switch(t.type){case"boolean":case"date":case"ip":case"keyword":case"text":return"string";case"double":case"int":case"long":case"unsigned_long":return"number";default:return}}function T(t){const e=[],n=[];return t.fields.forEach((t=>{"date"===t.type?e.push(t.name):t.type!==f.A.GEO_POINT&&t.type!==f.A.GEO_SHAPE||n.push(t.name)})),{dateFields:e,geoFields:n}}function j(t){const e=t.columns.findIndex(w);if(-1===e)return f.z;const n=[];for(let i=0;i<t.values.length;i++){const r=t.values[i],s=r[e];if(s)try{const i=Object(b.parse)(s),o={};for(let n=0;n<r.length;n++)n!==e&&(o[t.columns[n].name]=r[n]);n.push({type:"Feature",geometry:i,properties:o})}catch(t){}}return{type:"FeatureCollection",features:n}}var N=n(14),M=n(330),F=n(53),P=n(109),R=n.n(P),D=n(80),A=n(4);function k(t){const e=R()(),[n,i]=Object(s.useState)(),[r,l]=Object(s.useState)(),[u,c]=Object(s.useState)(!1),[d,p]=Object(s.useState)({esql:t.esql});return Object(A.jsx)(o.a.Fragment,null,Object(A.jsx)(D.TextBasedLangEditor,{query:d,onTextLangQueryChange:p,onTextLangQuerySubmit:async s=>{if(s){r&&l(void 0),n&&i(void 0),c(!0);try{const n=s.esql,i=await async function(t){const e=await S(h(t),Object(v.w)());return{columns:await C({esqlQuery:t,search:Object(v.j)().search.search}),adhocDataViewId:e.id,...T(e)}}(n);if(!e())return;!function(t){const e=t.filter(w);if(0===e.length)throw new Error(a.i18n.translate("xpack.maps.source.esql.noGeometryColumnErrorMsg",{defaultMessage:"Elasticsearch ES|QL query does not have a geometry column."}));if(e.length>1)throw new Error(a.i18n.translate("xpack.maps.source.esql.multipleGeometryColumnErrorMsg",{defaultMessage:"Elasticsearch ES|QL query has {count} geometry columns when only 1 is allowed. Use 'DROP' or 'KEEP' to narrow columns.",values:{count:e.length}}))}(i.columns),i.columns.length>=6&&l(a.i18n.translate("xpack.maps.esqlSource.tooManyColumnsWarning",{defaultMessage:"ES|QL statement returns {count} columns. For faster maps, use 'DROP' or 'KEEP' to narrow columns.",values:{count:i.columns.length}})),t.onESQLChange({esql:n,...i})}catch(t){if(!e())return;i(t)}c(!1)}},errors:n?[n]:void 0,warning:r,expandCodeEditor:t=>{},isCodeEditorExpanded:!0,hideMinimizeButton:!0,editorIsInline:!0,hideRunQueryText:!0,isLoading:u,disableSubmitAction:Object(F.isEqual)(d,t.esql)}))}var G=n(18),B=n.n(G);function z(t){return Object(A.jsx)(V,B()({switchLabel:a.i18n.translate("xpack.maps.esqlSource.narrowByMapExtentLabel",{defaultMessage:"Dynamically filter for data in the visible map area"}),fieldTypes:[f.A.GEO_POINT,f.A.GEO_SHAPE]},t))}function q(t){return Object(A.jsx)(V,B()({switchLabel:a.i18n.translate("xpack.maps.esqlSource.narrowByGlobalTimeLabel",{defaultMessage:"Apply global time range to ES|QL statement"}),fieldTypes:["date"]},t))}function V(t){const e=Object(s.useMemo)((()=>t.fields.map((t=>({value:t,text:t})))),[t.fields]),n=Object(A.jsx)(N.EuiSwitch,{label:t.switchLabel,checked:t.narrowByField,onChange:e=>{t.onNarrowByFieldChange(e.target.checked)},disabled:0===t.fields.length,compressed:!0});return Object(A.jsx)(o.a.Fragment,null,Object(A.jsx)(N.EuiFormRow,null,0===t.fields.length?Object(A.jsx)(N.EuiToolTip,{position:"top",content:a.i18n.translate("xpack.maps.esqlSource.noFieldsMsg",{defaultMessage:"No {fieldTypes} fields are available from index pattern: {pattern}.",values:{fieldTypes:t.fieldTypes.map((t=>`'${t}'`)).join(", "),pattern:h(t.esql)}})},n):n),t.narrowByField&&Object(A.jsx)(N.EuiFormRow,{label:a.i18n.translate("xpack.maps.source.esql.narrowByFieldLabel",{defaultMessage:"Filter by"}),display:"columnCompressed"},Object(A.jsx)(N.EuiSelect,{options:e,value:t.field,onChange:e=>{t.onFieldChange(e.target.value)},compressed:!0})))}function U(t){const[e,n]=Object(s.useState)([]),[i,r]=Object(s.useState)([]),[l,u]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{let e=!1;return Object(v.w)().get(t.sourceDescriptor.dataViewId).then((t=>{if(e)return;const i=T(t);n(i.dateFields),r(i.geoFields),u(!0)})).catch((t=>{e||u(!0)})),()=>{e=!0}}),[]),Object(A.jsx)(o.a.Fragment,null,Object(A.jsx)(N.EuiPanel,null,Object(A.jsx)(N.EuiTitle,{size:"xs"},Object(A.jsx)("h5",null,a.i18n.translate("xpack.maps.esqlSearch.sourceEditorTitle",{defaultMessage:"ES|QL"}))),Object(A.jsx)(N.EuiSpacer,{size:"m"}),Object(A.jsx)(N.EuiSkeletonText,{lines:3,isLoading:!l},Object(A.jsx)(k,{esql:t.sourceDescriptor.esql,onESQLChange:e=>{n(e.dateFields),r(e.geoFields);const i=[{propName:"columns",value:e.columns},{propName:"dataViewId",value:e.adhocDataViewId},{propName:"esql",value:e.esql}];function s(e,n){if(t.sourceDescriptor[e]&&!n.includes(t.sourceDescriptor[e])){const t=n.length?n[0]:void 0;i.push({propName:e,value:t}),t||i.push({propName:"dateField"===e?"narrowByGlobalTime":"narrowByMapBounds",value:!1})}}s("dateField",e.dateFields),s("geoField",e.geoFields),t.onChange(...i)}}),Object(A.jsx)(N.EuiSpacer,{size:"m"}),Object(A.jsx)(z,{esql:t.sourceDescriptor.esql,field:t.sourceDescriptor.geoField,fields:i,narrowByField:t.sourceDescriptor.narrowByMapBounds,onFieldChange:e=>{t.onChange({propName:"geoField",value:e})},onNarrowByFieldChange:e=>{const n=[{propName:"narrowByMapBounds",value:e}];e&&i.length&&!t.sourceDescriptor.geoField&&n.push({propName:"geoField",value:i[0]}),t.onChange(...n)}}),Object(A.jsx)(N.EuiFormRow,null,Object(A.jsx)(N.EuiSwitch,{label:a.i18n.translate("xpack.maps.esqlSource.narrowByGlobalSearchLabel",{defaultMessage:"Apply global search to ES|QL statement"}),checked:t.sourceDescriptor.narrowByGlobalSearch,onChange:e=>{t.onChange({propName:"narrowByGlobalSearch",value:e.target.checked})},compressed:!0})),Object(A.jsx)(q,{esql:t.sourceDescriptor.esql,field:t.sourceDescriptor.dateField,fields:e,narrowByField:t.sourceDescriptor.narrowByGlobalTime,onFieldChange:e=>{t.onChange({propName:"dateField",value:e})},onNarrowByFieldChange:n=>{const i=[{propName:"narrowByGlobalTime",value:n}];n&&e.length&&!t.sourceDescriptor.dateField&&i.push({propName:"dateField",value:e[0]}),t.onChange(...i)}}),Object(A.jsx)(M.a,{applyForceRefresh:t.sourceDescriptor.applyForceRefresh,setApplyForceRefresh:e=>{t.onChange({propName:"applyForceRefresh",value:e})}}))),Object(A.jsx)(N.EuiSpacer,{size:"s"}))}const W=a.i18n.translate("xpack.maps.source.esqlSearchTitle",{defaultMessage:"ES|QL"});class esql_source_ESQLSource extends _.a{static createDescriptor(t){if(!Object(m.a)(t.esql))throw new Error("Cannot create ESQLSourceDescriptor when esql is not provided");if(!Object(m.a)(t.dataViewId))throw new Error("Cannot create ESQLSourceDescriptor when dataViewId is not provided");return{...t,id:Object(m.a)(t.id)?t.id:Object(u.v4)(),type:f.Cb.ESQL,esql:t.esql,columns:t.columns?t.columns:[],dataViewId:t.dataViewId,narrowByGlobalSearch:void 0===t.narrowByGlobalSearch||t.narrowByGlobalSearch,narrowByGlobalTime:void 0!==t.narrowByGlobalTime?t.narrowByGlobalTime:"undefined"!==t.dateField,narrowByMapBounds:void 0!==t.narrowByMapBounds?t.narrowByMapBounds:"undefined"!==t.geoField,applyForceRefresh:void 0===t.applyForceRefresh||t.applyForceRefresh}}constructor(t){const e=esql_source_ESQLSource.createDescriptor(t);super(e),r()(this,"_descriptor",void 0),this._descriptor=e}_getRequestId(){return this._descriptor.id}async getDisplayName(){return h(this._descriptor.esql)||"ES|QL"}async supportsFitToBounds(){return!1}getInspectorRequestIds(){return[this._getRequestId()]}isQueryAware(){return!0}getApplyGlobalQuery(){return this._descriptor.narrowByGlobalSearch}async isTimeAware(){return this._descriptor.narrowByGlobalTime}getApplyGlobalTime(){return this._descriptor.narrowByGlobalTime}getApplyForceRefresh(){return this._descriptor.applyForceRefresh}isFilterByMapBounds(){return this._descriptor.narrowByMapBounds}async getSupportedShapeTypes(){const t=this._descriptor.columns.findIndex(w);return-1!==t&&this._descriptor.columns[t].type===I?[f.Hb.POINT,f.Hb.LINE,f.Hb.POLYGON]:[f.Hb.POINT]}supportsJoins(){return!1}async getGeoJsonWithMeta(t,e,n,i,r){const s=function(t){const e=t.match(new RegExp(/LIMIT\s[0-9]+/,"ig"));if(!e)return 500;const n=e[e.length-1].split(" ");return parseInt(n[1],10)}(this._descriptor.esql),o={query:this._descriptor.esql,dropNullColumns:!0},u=[],c=[];var h,f;if(this._descriptor.narrowByGlobalSearch&&(e.query&&u.push(e.query),null!==(h=e.embeddableSearchContext)&&void 0!==h&&h.query&&u.push(e.embeddableSearchContext.query),c.push(...e.filters),e.embeddableSearchContext&&c.push(...e.embeddableSearchContext.filters)),this._descriptor.narrowByMapBounds&&e.buffer){if(!this._descriptor.geoField)throw new Error(a.i18n.translate("xpack.maps.source.esql.noGeoFieldError",{defaultMessage:"Unable to narrow ES|QL statement by visible map area, geospatial field is not provided"}));const t=Object(g.h)(e.buffer,[this._descriptor.geoField]);c.push(t)}if(e.applyGlobalTime){if(!this._descriptor.dateField)throw new Error(a.i18n.translate("xpack.maps.source.esql.noDateFieldError",{defaultMessage:"Unable to narrow ES|QL statement by global time, date field is not provided"}));const t=e.timeslice?{from:new Date(e.timeslice.from).toISOString(),to:new Date(e.timeslice.to).toISOString(),mode:"absolute"}:e.timeFilters,n=Object(p.getTime)(void 0,t,{fieldName:this._descriptor.dateField});n&&c.push(n)}o.filter=Object(d.buildEsQuery)(void 0,u,c,{allowLeadingWildcards:(f=Object(v.T)()).get("query:allowLeadingWildcards"),queryStringOptions:f.get("query:queryString:options"),ignoreFilterIfFieldNotInIndex:f.get("courier:ignoreFilterIfFieldNotInIndex"),dateFormatTZ:f.get("dateFormat:tz")});const m=r.requests.start(Object(_.b)(t),{id:this._getRequestId()});m.json(o);const{rawResponse:y,requestParams:b}=await Object(l.lastValueFrom)(Object(v.j)().search.search({params:o},{strategy:"esql"}).pipe(Object(l.tap)({error(t){m.error({json:"attributes"in t?t.attributes:{message:t.message}})}})));m.ok({json:y,requestParams:b});const x=y,E=x.values.length;return{data:j(x),meta:{resultsCount:E,areResultsTrimmed:E>=s}}}getSourceStatus(t){var e;const n=t?t.getMeta():null;return n?n.areResultsTrimmed?{tooltipContent:a.i18n.translate("xpack.maps.esqlSearch.resultsTrimmedMsg",{defaultMessage:"Results limited to first {count} rows.",values:{count:null===(i=n.resultsCount)||void 0===i?void 0:i.toLocaleString()}}),areResultsTrimmed:!0}:{tooltipContent:a.i18n.translate("xpack.maps.esqlSearch.rowCountMsg",{defaultMessage:"Found {count} rows.",values:{count:null===(e=n.resultsCount)||void 0===e?void 0:e.toLocaleString()}}),areResultsTrimmed:!1}:{tooltipContent:null,areResultsTrimmed:!1};var i}getFieldByName(t){const e=this._descriptor.columns.find((({name:e})=>e===t)),n=e?L(e):void 0;return e&&n?new y.a({fieldName:e.name,source:this,origin:f.D.SOURCE,dataType:n}):null}async getFields(){const t=[];return this._descriptor.columns.forEach((e=>{const n=L(e);n&&t.push(new y.a({fieldName:e.name,source:this,origin:f.D.SOURCE,dataType:n}))})),t}renderSourceSettingsEditor({onChange:t}){return Object(A.jsx)(U,{onChange:t,sourceDescriptor:this._descriptor})}getSyncMeta(){return{columns:this._descriptor.columns,dateField:this._descriptor.dateField,esql:this._descriptor.esql,geoField:this._descriptor.geoField,narrowByMapBounds:this._descriptor.narrowByMapBounds,narrowByGlobalTime:this._descriptor.narrowByGlobalTime}}getIndexPatternId(){return this._descriptor.dataViewId}getGeoFieldName(){return this._descriptor.geoField}}var Y=n(199),H=n.n(Y);function J(t){const[e,n]=Object(s.useState)(!1),[i,r]=Object(s.useState)(),[l,u]=Object(s.useState)([]),[c,h]=Object(s.useState)(""),[d,p]=Object(s.useState)(),[g,m]=Object(s.useState)([]),[_,y]=Object(s.useState)(),[b,x]=Object(s.useState)([]),[E,C]=Object(s.useState)(!0),[w,L]=Object(s.useState)(!0),[T,j]=Object(s.useState)(!0);return Object(s.useEffect)((()=>{let e=!1;return(t.mostCommonDataViewId?Object(v.w)().get(t.mostCommonDataViewId):Object(v.w)().getDefaultDataView()).then((async t=>{const i=t?await S(t.getIndexPattern(),Object(v.w)()):void 0;if(!e){if(i){let e;const n=[],s=[];for(let t=0;t<i.fields.length;t++){const r=i.fields[t];[f.A.GEO_POINT,f.A.GEO_SHAPE].includes(r.type)?(s.push(r.name),e||(e=r)):"date"===r.type&&n.push(r.name)}if(e){let o;null!=t&&t.timeFieldName?o=t.timeFieldName:n.length&&(o=n[0]);const a=`from ${i.getIndexPattern()} | keep ${e.name} | limit 10000`;u([{name:e.name,type:e.type===f.A.GEO_SHAPE?I:O}]),r(i.id),p(o),m(n),y(e.name),x(s),h(a),o||L(!1)}}n(!0)}})).catch((t=>{e||n(!0)})),()=>{e=!0}}),[]),H()((()=>{const e=c&&c.length&&i?{columns:l,dataViewId:i,dateField:d,geoField:_,esql:c,narrowByGlobalSearch:E,narrowByGlobalTime:w,narrowByMapBounds:T}:null;t.onSourceConfigChange(e)}),0,[i,l,d,_,c,E,w,T]),Object(A.jsx)(N.EuiPanel,null,Object(A.jsx)(N.EuiSkeletonText,{lines:3,isLoading:!e},Object(A.jsx)(k,{esql:c,onESQLChange:t=>{r(t.adhocDataViewId),u(t.columns),h(t.esql),m(t.dateFields),x(t.geoFields),d&&t.dateFields.includes(d)||(t.dateFields.length?p(t.dateFields[0]):(p(void 0),L(!1))),_&&t.geoFields.includes(_)||(t.geoFields.length?y(t.geoFields[0]):(y(void 0),j(!1)))}}),c&&Object(A.jsx)(o.a.Fragment,null,Object(A.jsx)(N.EuiSpacer,{size:"m"}),Object(A.jsx)(z,{esql:c,field:_,fields:b,narrowByField:T,onFieldChange:t=>{y(t)},onNarrowByFieldChange:t=>{j(t),t&&b.length&&_&&y(b[0])}}),Object(A.jsx)(N.EuiFormRow,null,Object(A.jsx)(N.EuiSwitch,{label:a.i18n.translate("xpack.maps.esqlSource.narrowByGlobalSearchLabel",{defaultMessage:"Apply global search to ES|QL statement"}),checked:E,onChange:t=>{C(t.target.checked)},compressed:!0})),Object(A.jsx)(q,{esql:c,field:d,fields:g,narrowByField:w,onFieldChange:t=>{p(t)},onNarrowByFieldChange:t=>{L(t),t&&g.length&&d&&p(g[0])}}))))}var X=n(91),Z=n(329);const Q={id:f.Jb.ESQL,order:10,categories:[f.ab.ELASTICSEARCH],description:a.i18n.translate("xpack.maps.source.esqlDescription",{defaultMessage:"Create a layer using the Elasticsearch Query Language"}),icon:Z.a,isBeta:!0,renderWizard:({previewLayers:t,mapColors:e,mostCommonDataViewId:n})=>Object(A.jsx)(J,{mostCommonDataViewId:n,onSourceConfigChange:n=>{if(!n)return void t([]);const i=esql_source_ESQLSource.createDescriptor(n),r=X.b.createDescriptor({sourceDescriptor:i},e);t([r])}}),title:W}},341:function(t,e,n){"use strict";n.d(e,"b",(function(){return H})),n.d(e,"a",(function(){return es_geo_line_source_ESGeoLineSource}));var i=n(3),r=n(2),s=n.n(r),o=n(6),a=n.n(o),l=n(14),u=n(116),c=n(171),h=n(97),d=n(156),p=n(28),f=n(108),g=n(328),m=n(54);const _=250,y="_tsid";var v=n(4);function b(){return Object(v.jsx)(l.EuiToolTip,{content:Object(v.jsx)(l.EuiText,{size:"s"},Object(v.jsx)("dl",null,Object(v.jsx)("dt",null,d.d),Object(v.jsx)("dd",null,Object(v.jsx)("p",null,Object(v.jsx)(m.FormattedMessage,{id:"xpack.maps.source.esGeoLine.groupBy.timeseriesDescription",defaultMessage:"Create a track for each unique time series. Track is simplifed when number of points exceeds limit."}))),Object(v.jsx)("dt",null,d.c),Object(v.jsx)("dd",null,Object(v.jsx)("p",null,Object(v.jsx)(m.FormattedMessage,{id:"xpack.maps.source.esGeoGrid.groupBy.termsDescription",defaultMessage:"Create a track for top {maxTermsTracks} terms. Track is truncated when number of points exceeds limit.",values:{maxTermsTracks:_}})))))},Object(v.jsx)("span",null,Object(v.jsx)(m.FormattedMessage,{id:"xpack.maps.source.esGeoGrid.groupByLabel",defaultMessage:"Group by"})," ",Object(v.jsx)(l.EuiIcon,{type:"questionInCircle",color:"subdued"})))}var x=n(199),E=n.n(x);function S({onChange:t,value:e}){const[n,i]=Object(r.useState)(e),[,s]=E()((()=>{t(n)}),150,[n]);return Object(r.useEffect)((()=>()=>{s()}),[s]),Object(v.jsx)(l.EuiRange,{value:n,onChange:t=>{i(parseInt(t.currentTarget.value,10))},min:100,max:1e4,showLabels:!0,showValue:!0,step:100})}function C(t){const e=Object(r.useMemo)((()=>Object(h.f)(t.indexPattern)),[t.indexPattern]);return Object(v.jsx)(s.a.Fragment,null,e&&Object(v.jsx)(l.EuiFormRow,{label:Object(v.jsx)(b,null),display:t.isColumnCompressed?"columnCompressed":"row"},Object(v.jsx)(g.a,{groupByTimeseries:t.groupByTimeseries,onGroupByTimeseriesChange:t.onGroupByTimeseriesChange})),t.groupByTimeseries?Object(v.jsx)(l.EuiFormRow,{label:i.i18n.translate("xpack.maps.esGeoLine.lineSImplificationSizeLabel",{defaultMessage:"Simplification threshold"}),helpText:i.i18n.translate("xpack.maps.esGeoLine.lineSImplificationSizeHelpText",{defaultMessage:"The maximum number of points for each track. Track is simplifed when threshold is exceeded. Use smaller values for better performance."}),display:t.isColumnCompressed?"columnCompressed":"row"},Object(v.jsx)(S,{value:t.lineSimplificationSize,onChange:t.onLineSimplificationSizeChange})):Object(v.jsx)(s.a.Fragment,null,Object(v.jsx)(l.EuiFormRow,{label:d.a,display:t.isColumnCompressed?"columnCompressed":"row"},Object(v.jsx)(f.a,{placeholder:i.i18n.translate("xpack.maps.source.esGeoLine.splitFieldPlaceholder",{defaultMessage:"Select entity field"}),value:t.splitField,onChange:function(e){void 0!==e&&t.onSplitFieldChange(e)},fields:Object(h.i)(t.indexPattern.fields),isClearable:!1,compressed:t.isColumnCompressed})),Object(v.jsx)(l.EuiFormRow,{label:d.b,display:t.isColumnCompressed?"columnCompressed":"row"},Object(v.jsx)(f.a,{placeholder:i.i18n.translate("xpack.maps.source.esGeoLine.sortFieldPlaceholder",{defaultMessage:"Select sort field"}),value:t.sortField,onChange:function(e){void 0!==e&&t.onSortFieldChange(e)},fields:t.indexPattern.fields.filter((e=>!(t.splitField&&e.name===t.splitField)&&e.sortable&&!p.indexPatterns.isNestedField(e)&&["number","date"].includes(e.type))),isClearable:!1,compressed:t.isColumnCompressed}))))}class create_source_editor_CreateSourceEditor extends r.Component{constructor(...t){super(...t),a()(this,"state",{indexPattern:null,pointFields:[],geoField:"",groupByTimeseries:!1,splitField:"",sortField:"",lineSimplificationSize:500}),a()(this,"_onIndexPatternSelect",(t=>{const e=Object(h.c)(t.fields);this.setState({indexPattern:t,pointFields:e,groupByTimeseries:Object(h.f)(t),geoField:e.length?e[0].name:"",sortField:t.timeFieldName?t.timeFieldName:""},this.previewLayer)})),a()(this,"_onGeoFieldSelect",(t=>{void 0!==t&&this.setState({geoField:t},this.previewLayer)})),a()(this,"_onGroupByTimeseriesChange",(t=>{this.setState({groupByTimeseries:t},this.previewLayer)})),a()(this,"_onLineSimplificationSizeChange",(t=>{this.setState({lineSimplificationSize:t},this.previewLayer)})),a()(this,"_onSplitFieldSelect",(t=>{this.setState({splitField:t},this.previewLayer)})),a()(this,"_onSortFieldSelect",(t=>{this.setState({sortField:t},this.previewLayer)})),a()(this,"previewLayer",(()=>{const{indexPattern:t,geoField:e,groupByTimeseries:n,splitField:i,sortField:r,lineSimplificationSize:s}=this.state,o=t&&t.id&&e&&(n||i&&r)?{indexPatternId:t.id,geoField:e,groupByTimeseries:n,lineSimplificationSize:s,splitField:i,sortField:r}:null;this.props.onSourceConfigChange(o)}))}_renderGeoSelect(){return this.state.indexPattern?Object(v.jsx)(c.a,{value:this.state.geoField,onChange:this._onGeoFieldSelect,geoFields:this.state.pointFields,isClearable:!1}):null}_renderGeoLineForm(){return this.state.indexPattern&&this.state.geoField?Object(v.jsx)(C,{isColumnCompressed:!1,indexPattern:this.state.indexPattern,onGroupByTimeseriesChange:this._onGroupByTimeseriesChange,onLineSimplificationSizeChange:this._onLineSimplificationSizeChange,onSortFieldChange:this._onSortFieldSelect,onSplitFieldChange:this._onSplitFieldSelect,groupByTimeseries:this.state.groupByTimeseries,lineSimplificationSize:this.state.lineSimplificationSize,sortField:this.state.sortField,splitField:this.state.splitField}):null}render(){return Object(v.jsx)(l.EuiPanel,null,Object(v.jsx)(u.a,{dataView:this.state.indexPattern,onChange:this._onIndexPatternSelect,isGeoPointsOnly:!0}),this._renderGeoSelect(),this._renderGeoLineForm())}}var O=n(53),I=n.n(O),w=n(58),L=n(0),T=n(93),j=n(92),N=n(122);const M=["key","path"];function F(t,e){const n=[];let i=0;const r=I.a.get(t,"aggregations.tracks.buckets",{}),s=Object.keys(r);for(let t=0;t<s.length;t++){const o=s[t],a=r[o],l={...a.path};l.properties.complete||i++,l.id=o,l.properties={[e]:o,...l.properties,...Object(T.j)(a,M)},n.push(l)}return{featureCollection:{type:"FeatureCollection",features:n},numTrimmedTracks:i}}var P=n(153),R=n(189),D=n(174),A=n(5);class update_source_editor_UpdateSourceEditor extends r.Component{constructor(...t){super(...t),a()(this,"_isMounted",!1),a()(this,"state",{indexPattern:null,fields:[]}),a()(this,"_onMetricsChange",(t=>{this.props.onChange({propName:"metrics",value:t})})),a()(this,"_onGroupByTimeseriesChange",(t=>{this.props.onChange({propName:"groupByTimeseries",value:t})})),a()(this,"_onLineSimplificationSizeChange",(t=>{this.props.onChange({propName:"lineSimplificationSize",value:t})})),a()(this,"_onSplitFieldChange",(t=>{this.props.onChange({propName:"splitField",value:t})})),a()(this,"_onSortFieldChange",(t=>{this.props.onChange({propName:"sortField",value:t})}))}componentDidMount(){this._isMounted=!0,this._loadFields()}componentWillUnmount(){this._isMounted=!1}async _loadFields(){let t;try{t=await Object(A.w)().get(this.props.indexPatternId)}catch(t){return}this._isMounted&&this.setState({indexPattern:t,fields:t.fields.filter((t=>!p.indexPatterns.isNestedField(t)))})}render(){return this.state.indexPattern?Object(v.jsx)(r.Fragment,null,Object(v.jsx)(l.EuiPanel,null,Object(v.jsx)(l.EuiTitle,{size:"xs"},Object(v.jsx)("h6",null,Object(v.jsx)(m.FormattedMessage,{id:"xpack.maps.source.esGeoLine.metricsLabel",defaultMessage:"Track metrics"}))),Object(v.jsx)(l.EuiSpacer,{size:"m"}),Object(v.jsx)(D.a,{allowMultipleMetrics:!0,bucketsName:this.props.bucketsName,isJoin:!1,fields:this.state.fields,metrics:this.props.metrics,onChange:this._onMetricsChange})),Object(v.jsx)(l.EuiSpacer,{size:"s"}),Object(v.jsx)(l.EuiPanel,null,Object(v.jsx)(l.EuiTitle,{size:"xs"},Object(v.jsx)("h6",null,Object(v.jsx)(m.FormattedMessage,{id:"xpack.maps.source.esGeoLine.trackSettingsLabel",defaultMessage:"Tracks"}))),Object(v.jsx)(l.EuiSpacer,{size:"m"}),Object(v.jsx)(C,{isColumnCompressed:!0,indexPattern:this.state.indexPattern,onGroupByTimeseriesChange:this._onGroupByTimeseriesChange,onLineSimplificationSizeChange:this._onLineSimplificationSizeChange,onSortFieldChange:this._onSortFieldChange,onSplitFieldChange:this._onSplitFieldChange,groupByTimeseries:this.props.groupByTimeseries,lineSimplificationSize:this.props.lineSimplificationSize,sortField:this.props.sortField,splitField:this.props.splitField})),Object(v.jsx)(l.EuiSpacer,{size:"s"})):null}}var k=n(106),G=n(117),B=n(125),z=n(24),q=n(126);const V=i.i18n.translate("xpack.maps.source.esGeoLineTitle",{defaultMessage:"Tracks"}),U=i.i18n.translate("xpack.maps.source.esGeoLineDisabledReason",{defaultMessage:"{title} requires a Gold license.",values:{title:V}});class es_geo_line_source_ESGeoLineSource extends N.a{static createDescriptor(t){const e=N.a.createDescriptor(t);if(!Object(G.a)(e.geoField))throw new Error("Cannot create an ESGeoLineSource without a geoField");const n="boolean"==typeof e.groupByTimeseries&&e.groupByTimeseries;return{...e,type:L.Cb.ES_GEO_LINE,groupByTimeseries:n,lineSimplificationSize:"number"==typeof e.lineSimplificationSize?e.lineSimplificationSize:500,geoField:e.geoField,splitField:e.splitField,sortField:e.sortField}}constructor(t){const e=es_geo_line_source_ESGeoLineSource.createDescriptor(t);super(e),a()(this,"_descriptor",void 0),this._descriptor=e}getBucketsName(){return i.i18n.translate("xpack.maps.source.esGeoLine.bucketsName",{defaultMessage:"tracks"})}renderSourceSettingsEditor({onChange:t}){var e,n;return Object(v.jsx)(update_source_editor_UpdateSourceEditor,{bucketsName:this.getBucketsName(),indexPatternId:this.getIndexPatternId(),onChange:t,metrics:this._descriptor.metrics,groupByTimeseries:this._descriptor.groupByTimeseries,lineSimplificationSize:this._descriptor.lineSimplificationSize,splitField:null!==(e=this._descriptor.splitField)&&void 0!==e?e:"",sortField:null!==(n=this._descriptor.sortField)&&void 0!==n?n:""})}getSyncMeta(t){return{...super.getSyncMeta(t),groupByTimeseries:this._descriptor.groupByTimeseries,lineSimplificationSize:this._descriptor.lineSimplificationSize,splitField:this._descriptor.splitField,sortField:this._descriptor.sortField}}async getImmutableProperties(){return[{label:Object(j.a)(),value:V},{label:Object(j.b)(),value:await this.getDisplayName()},{label:i.i18n.translate("xpack.maps.source.esGeoLine.geospatialFieldLabel",{defaultMessage:"Geospatial field"}),value:this._descriptor.geoField}]}_createSplitField(){return this._descriptor.splitField?new P.a({fieldName:this._descriptor.splitField,source:this,origin:L.D.SOURCE}):null}_createTsidField(){return new R.a({fieldName:y,label:y,source:this,origin:L.D.SOURCE,dataType:"string"})}async getFields(){const t=this._descriptor.groupByTimeseries?this._createTsidField():this._createSplitField();return t?[...this.getMetricFields(),t]:this.getMetricFields()}getFieldByName(t){return t===this._descriptor.splitField?this._createSplitField():t===y?this._createTsidField():this.getMetricFieldForName(t)}isGeoGridPrecisionAware(){return!1}supportsJoins(){return!1}async getGeoJsonWithMeta(t,e,n,i,r){if(!Object(z.b)())throw new Error(U);return this._descriptor.groupByTimeseries?this._getGeoLineByTimeseries(t,e,n,i,r):this._getGeoLineByTerms(t,e,n,i,r)}getInspectorRequestIds(){return[this._getTracksRequestId(),this._getEntitiesRequestId()]}_getTracksRequestId(){return`${this.getId()}_tracks`}_getEntitiesRequestId(){return`${this.getId()}_entities`}async _getGeoLineByTimeseries(t,e,n,i,r){var s,o,a;const l=await this.getIndexPattern(),u=await this.makeSearchSource(e,0);u.setField("trackTotalHits",!1),u.setField("aggs",{totalEntities:{cardinality:{field:"_tsid"}},tracks:{time_series:{},aggs:{path:{geo_line:{point:{field:this._descriptor.geoField},size:this._descriptor.lineSimplificationSize}},...this.getValueAggsDsl(l)}}});const c=[],h=await this._runEsQuery({requestId:this._getTracksRequestId(),requestName:Object(k.b)(t),searchSource:u,registerCancelCallback:n,searchSessionId:e.searchSessionId,executionContext:Object(q.b)({description:"es_geo_line:time_series_tracks"},e.executionContext),requestsAdapter:r.requests,onWarning:t=>{c.push(t)}}),{featureCollection:d}=F(h,y),p=d.features.length,f=p>=1e4;return{data:d,meta:{areResultsTrimmed:f,areEntitiesTrimmed:f,entityCount:p,numTrimmedTracks:0,totalEntities:null!==(s=null==h||null===(o=h.aggregations)||void 0===o||null===(a=o.totalEntities)||void 0===a?void 0:a.value)&&void 0!==s?s:0,warnings:c}}}async _getGeoLineByTerms(t,e,n,r,s){if(!this._descriptor.splitField)throw new Error(i.i18n.translate("xpack.maps.source.esGeoLine.missingConfigurationError",{defaultMessage:"Unable to create tracks. Provide a value for required configuration ''{inputLabel}''",values:{inputLabel:d.a}}));if(!this._descriptor.sortField)throw new Error(i.i18n.translate("xpack.maps.source.esGeoLine.missingConfigurationError",{defaultMessage:"Unable to create tracks. Provide a value for required configuration ''{inputLabel}''",values:{inputLabel:d.b}}));const o=await this.getIndexPattern(),a=[],l=await this.makeSearchSource(e,0);l.setField("trackTotalHits",!1);const u=Object(T.l)(o,this._descriptor.splitField),c={precision_threshold:_},h={size:_};if(l.setField("aggs",{totalEntities:{cardinality:Object(T.a)(c,u)},entitySplit:{terms:Object(T.a)(h,u)}}),"string"===u.type){const t=Object(w.buildPhraseFilter)(u,"",o);t.meta.negate=!0,l.setField("filter",[...l.getField("filter"),t])}const p=await this._runEsQuery({requestId:this._getEntitiesRequestId(),requestName:i.i18n.translate("xpack.maps.source.esGeoLine.entityRequestName",{defaultMessage:"load track entities ({layerName})",values:{layerName:t}}),searchSource:l,registerCancelCallback:n,searchSessionId:e.searchSessionId,executionContext:Object(q.b)({description:"es_geo_line:entities"},e.executionContext),requestsAdapter:s.requests,onWarning:t=>{a.push(t)}}),f=I.a.get(p,"aggregations.entitySplit.buckets",[]),g=I.a.get(p,"aggregations.totalEntities.value",0),m=f.length>=_;if(0===g)return{data:L.z,meta:{areResultsTrimmed:!1,areEntitiesTrimmed:!1,entityCount:0,numTrimmedTracks:0,totalEntities:0}};const y={};for(let t=0;t<f.length;t++)y[f[t].key]=Object(w.buildPhraseFilter)(u,f[t].key,o).query;const v={...e};delete v.buffer;const b=await this.makeSearchSource(v,0);b.setField("trackTotalHits",!1),b.setField("aggs",{tracks:{filters:{filters:y},aggs:{path:{geo_line:{point:{field:this._descriptor.geoField},sort:{field:this._descriptor.sortField}}},...this.getValueAggsDsl(o)}}});const x=await this._runEsQuery({requestId:this._getTracksRequestId(),requestName:Object(k.b)(t),searchSource:b,registerCancelCallback:n,searchSessionId:e.searchSessionId,executionContext:Object(q.b)({description:"es_geo_line:terms_tracks"},e.executionContext),requestsAdapter:s.requests,onWarning:t=>{a.push(t)}}),{featureCollection:E,numTrimmedTracks:S}=F(x,this._descriptor.splitField);return{data:E,meta:{areResultsTrimmed:m,areEntitiesTrimmed:m,entityCount:f.length,numTrimmedTracks:S,totalEntities:g,warnings:a}}}getSourceStatus(t){const e=t?t.getData():null,n=t?t.getMeta():null;if(!e||!n)return{tooltipContent:null,areResultsTrimmed:!1};const r=n.areEntitiesTrimmed?i.i18n.translate("xpack.maps.esGeoLine.areEntitiesTrimmedMsg",{defaultMessage:"Results limited to first {entityCount} tracks of ~{totalEntities}.",values:{entityCount:n.entityCount.toLocaleString(),totalEntities:n.totalEntities.toLocaleString()}}):i.i18n.translate("xpack.maps.esGeoLine.tracksCountMsg",{defaultMessage:"Found {entityCount} tracks.",values:{entityCount:n.entityCount.toLocaleString()}}),s=n.numTrimmedTracks>0?i.i18n.translate("xpack.maps.esGeoLine.tracksTrimmedMsg",{defaultMessage:"{numTrimmedTracks} of {entityCount} tracks are incomplete.",values:{entityCount:n.entityCount.toLocaleString(),numTrimmedTracks:n.numTrimmedTracks.toLocaleString()}}):void 0;return{tooltipContent:s?`${r} ${s}`:r,areResultsTrimmed:n.areEntitiesTrimmed||n.numTrimmedTracks>0}}isFilterByMapBounds(){return!0}hasTooltipProperties(){return!0}async getSupportedShapeTypes(){return[L.Hb.LINE]}async getTooltipProperties(t){const e=await super.getTooltipProperties(t);return t&&"boolean"==typeof t.complete&&e.push(new B.a("__kbn__track__complete",this._descriptor.groupByTimeseries?i.i18n.translate("xpack.maps.source.esGeoLine.isTrackSimplifiedLabel",{defaultMessage:"track is simplified"}):i.i18n.translate("xpack.maps.source.esGeoLine.isTrackTruncatedLabel",{defaultMessage:"track is truncated"}),(!t.complete).toString())),e}async getLicensedFeatures(){return[z.a.GEO_LINE_AGG]}}var W=n(100),Y=n(91);const H={id:L.Jb.GEO_LINE,order:10,categories:[L.ab.ELASTICSEARCH],description:i.i18n.translate("xpack.maps.source.esGeoLineDescription",{defaultMessage:"Create lines from points"}),disabledReason:U,icon:()=>Object(v.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25"},Object(v.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M12.733 12.136h32.283v.545H12.935L4.452 19.98l-.356-.413 8.637-7.43z"}),Object(v.jsx)("circle",{cx:"24.939",cy:"12.409",r:"2.182",className:"mapLayersWizardIcon__highlight"}),Object(v.jsx)("circle",{cx:"35.849",cy:"12.409",r:"2.182",className:"mapLayersWizardIcon__highlight"}),Object(v.jsx)("circle",{cx:"45.561",cy:"12.409",r:"3.273",className:"mapLayersWizardIcon__highlight"}),Object(v.jsx)("circle",{cx:"5.197",cy:"18.954",r:"2.182",className:"mapLayersWizardIcon__highlight"}),Object(v.jsx)("circle",{cx:"13.485",cy:"12.409",r:"2.182",className:"mapLayersWizardIcon__highlight"})),getIsDisabled:()=>!Object(z.b)(),renderWizard:({previewLayers:t})=>Object(v.jsx)(create_source_editor_CreateSourceEditor,{onSourceConfigChange:e=>{if(!e)return void t([]);const n=Y.b.createDescriptor({sourceDescriptor:es_geo_line_source_ESGeoLineSource.createDescriptor(e),style:W.a.createDescriptor({[L.Ib.LINE_WIDTH]:{type:L.Eb.STATIC,options:{size:2}}})});n.alpha=1,t([n])}}),title:V}},342:function(t,e,n){"use strict";n.d(e,"b",(function(){return j})),n.d(e,"a",(function(){return p}));var i=n(2),r=n.n(i),s=n(3),o=n(0),a=n(14),l=n(154),u=n(4);const c=s.i18n.translate("xpack.maps.spatialJoin.wizardForm.kilometersAbbreviation",{defaultMessage:"km"});function h(t){return"string"==typeof t?parseFloat(t):t}function d(t){const[e,n]=Object(i.useState)(t.initialDistance),o=h(e),d=isNaN(o)||o<=0;return Object(u.jsx)(r.a.Fragment,null,Object(u.jsx)(a.EuiFormRow,{label:s.i18n.translate("xpack.maps.spatialJoin.wizardForm.distanceLabel",{defaultMessage:"Distance"}),isInvalid:d,error:d?[s.i18n.translate("xpack.maps.spatialJoin.wizardForm.invalidDistanceMessage",{defaultMessage:"Value must be a number greater than 0"})]:[]},Object(u.jsx)(a.EuiFieldNumber,{append:c,"aria-label":s.i18n.translate("xpack.maps.spatialJoin.wizardForm.distanceInputAriaLabel",{defaultMessage:"distance input"}),isInvalid:d,min:0,onChange:t=>{n(t.target.value)},value:e})),Object(u.jsx)(a.EuiPopoverFooter,{paddingSize:"s"},Object(u.jsx)(a.EuiFlexGroup,null,Object(u.jsx)(a.EuiFlexItem,null,Object(u.jsx)(a.EuiButtonEmpty,{onClick:t.onClose,size:"s"},l.a.close)),Object(u.jsx)(a.EuiFlexItem,null,Object(u.jsx)(a.EuiButton,{fill:!0,isDisabled:d||t.initialDistance.toString()===e.toString(),onClick:()=>{t.onDistanceChange(h(e)),t.onClose()},size:"s"},l.a.apply)))))}function p(t){const[e,n]=Object(i.useState)(!1);function r(){n(!1)}return Object(u.jsx)(a.EuiPopover,{id:"spatialJoinRelationship",button:Object(u.jsx)(a.EuiExpression,{color:"subdued",description:s.i18n.translate("xpack.maps.spatialJoin.wizardForm.withinExpressionDescription",{defaultMessage:"within"}),value:s.i18n.translate("xpack.maps.spatialJoin.wizardForm.withinExpressionValue",{defaultMessage:"{distance} {units} of layer features",values:{distance:t.distance,units:c}}),onClick:()=>{n(!e)},uppercase:!1}),isOpen:e,closePopover:r,panelPaddingSize:"s",anchorPosition:"downCenter",repositionOnScroll:!0},Object(u.jsx)(d,{initialDistance:t.distance,onDistanceChange:t.onDistanceChange,onClose:r}))}var f=n(97),g=n(116),m=n(171);function _(t){const e=t.geoFields.length?Object(u.jsx)(m.a,{value:t.geoField?t.geoField:"",onChange:t.onGeoFieldSelect,geoFields:t.geoFields,isClearable:!1}):null;return Object(u.jsx)(a.EuiPanel,null,Object(u.jsx)(a.EuiTitle,{size:"xs"},Object(u.jsx)("h5",null,s.i18n.translate("xpack.maps.spatialJoin.wizard.leftSourceTitle",{defaultMessage:"Layer features source"}))),Object(u.jsx)(a.EuiSpacer,{size:"m"}),Object(u.jsx)(g.a,{dataView:t.dataView,onChange:t.onDataViewSelect,isGeoPointsOnly:!0}),e)}var y=n(170);function v(t){const e=t.dataView?Object(u.jsx)(m.a,{value:t.geoField?t.geoField:"",onChange:t.onGeoFieldSelect,geoFields:t.geoFields,isClearable:!1}):null;return Object(u.jsx)(a.EuiPanel,null,Object(u.jsx)(a.EuiTitle,{size:"xs"},Object(u.jsx)("h5",null,s.i18n.translate("xpack.maps.spatialJoin.wizardForm.rightSourceTitle",{defaultMessage:"Join source"}))),Object(u.jsx)(a.EuiSpacer,{size:"m"}),Object(u.jsx)(a.EuiFormRow,{label:y.a.relationshipLabel},Object(u.jsx)(p,{distance:t.distance,onDistanceChange:t.onDistanceChange})),Object(u.jsx)(g.a,{dataView:t.dataView,onChange:t.onDataViewSelect}),e)}var b=n(56),x=n(120),E=n(100),S=n(91),C=n(131),O=n(98);const I=Object(O.i)();var w=n(158);function L(t,e){return void 0!==t&&t.id&&void 0!==e}function T({previewLayers:t}){const[e,n]=Object(i.useState)(w.a),[s,l]=Object(i.useState)(),[c,h]=Object(i.useState)([]),[d,p]=Object(i.useState)(),[g,m]=Object(i.useState)(),[y,O]=Object(i.useState)([]),[T,j]=Object(i.useState)();Object(i.useEffect)((()=>{if(!L(s,d)||!function(t,e){return void 0!==t&&t.id&&void 0!==e}(g,T))return void t([]);const n=function({distance:t,leftDataViewId:e,leftGeoField:n,rightDataViewId:i,rightGeoField:r}){const s={type:o.b.COUNT},a=Object(b.v4)(),l=Object(x.a)({aggType:s.type,rightSourceId:a}),u={[o.Ib.LABEL_TEXT]:{type:o.Eb.DYNAMIC,options:{...I[o.Ib.LABEL_TEXT].options,field:{name:l,origin:o.D.JOIN}}}},c=[{leftField:"_id",right:{type:o.Cb.ES_DISTANCE_SOURCE,id:a,indexPatternId:i,metrics:[s],distance:t,geoField:r,applyGlobalQuery:!0,applyGlobalTime:!0,applyForceRefresh:!0}}];return S.b.createDescriptor({joins:c,sourceDescriptor:C.ESSearchSource.createDescriptor({indexPatternId:e,geoField:n,scalingType:o.wb.LIMIT,applyGlobalQuery:!0,applyGlobalTime:!0,applyForceRefresh:!0}),style:E.a.createDescriptor(u)})}({distance:e,leftDataViewId:s.id,leftGeoField:d,rightDataViewId:g.id,rightGeoField:T});t([n])}),[e,s,d,g,T,t]);const N=L(s,d)?Object(u.jsx)(v,{dataView:g,distance:e,geoField:T,geoFields:y,onDataViewSelect:t=>{m(t);const e=Object(f.b)(t.fields);O(e),j(e.length?e[0].name:void 0)},onDistanceChange:n,onGeoFieldSelect:j}):null;return Object(u.jsx)(r.a.Fragment,null,Object(u.jsx)(_,{dataView:s,geoField:d,geoFields:c,onDataViewSelect:t=>{l(t);const e=Object(f.c)(t.fields);h(e),p(e.length?e[0].name:void 0)},onGeoFieldSelect:p}),Object(u.jsx)(a.EuiSpacer,{size:"s"}),N)}const j={id:o.Jb.SPATIAL_JOIN,order:10,categories:[o.ab.ELASTICSEARCH],description:s.i18n.translate("xpack.maps.spatialJoinWizard.description",{defaultMessage:"Group documents by geospatial relationships"}),icon:()=>Object(u.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25",className:"mapLayersWizardIcon"},Object(u.jsx)("path",{className:"mapLayersWizardIcon__background",d:"M32.206 15.364V1.588l-1.492.204c-.743.254-1.768.38-2.702.45a41.39 41.39 0 01-1.258.07l-.093.005c-.312.014-.57.025-.72.042a1.895 1.895 0 00-.558.167c-.156.07-.316.156-.47.238l-.057.031c-.356.19-.687.357-1.025.4l-2.262.474v5.864c0 .698-.677 2.578-.818 3.852l.34 1.807 11.114.17z"}),Object(u.jsx)("path",{fill:"#69707D",d:"M22.36 3.558c-.178-.104-.416-.15-.664-.172a6.333 6.333 0 00-.885 0c-.657.04-1.452.144-2.264.261l-.703.103c-.583.087-1.16.172-1.692.238-.751.093-1.39.145-1.82.113-.593-.044-1.125.341-1.611.843-.453.467-.925 1.101-1.429 1.777l-.144.193c-1.132 1.517-2.452 3.218-4.22 4.102-.213.107-.346.312-.431.528a3.065 3.065 0 00-.173.78c-.064.586-.046 1.324.007 2.083.072 1.01.211 2.102.32 2.955.055.42.101.784.128 1.05.08.78-.128 1.77-.37 2.653-.088.319-.178.616-.258.882l-.086.285a9.67 9.67 0 00-.12.434 1.518 1.518 0 00-.053.334c0 .28.11.577.283.842a2.3 2.3 0 00.735.708l.067.04h.078c4.133-.069 11.445-.366 12.196-.45a.58.58 0 00.334-.17 1.41 1.41 0 00.224-.293c.134-.223.264-.524.388-.867.249-.69.495-1.6.72-2.52.162-.654.314-1.32.452-1.92l.16-.695c.088-.378.167-.707.235-.963.07-.267.123-.43.156-.494a1.57 1.57 0 00.1-.314c.03-.129.063-.291.096-.48.067-.38.14-.876.213-1.45.146-1.149.296-2.614.403-4.073.107-1.458.171-2.917.146-4.052a10.13 10.13 0 00-.112-1.438 2.469 2.469 0 00-.131-.495c-.053-.128-.135-.275-.276-.358z"}),Object(u.jsx)("path",{className:"mapLayersWizardIcon__background",d:"M31.435 15.227c-.218.006-1.066-.01-1.445 0-.758.02-1.298-.026-2.353 0H22.15l-2.864 8.915c.2.067 1.938.445 2.242.447.62.005 1.478-.08 2.393-.197.88-.112 1.824-.257 2.679-.389l.112-.017c.888-.136 1.664-.254 2.166-.304.348-.035.996-.025 1.858-.007l.128.002c.827.017 1.818.037 2.868.023 2.199-.028 4.695-.203 6.5-.887 1.42-.538 2.1-.87 2.513-1.339.414-.469.558-.468.643-1.44.086-.972.086-2.063.086-2.063l-8.131-2.744h-3.907z"}),Object(u.jsx)("path",{className:"mapLayersWizardIcon__background",d:"M32.206 1.588s-2.046 13.417-1.603 13.639c.787.393 2.66.63 3.785 1.636 1.23 1.1 1.171 2.5 2.318 3.239.834.538 6.73-.874 6.73-.874l.228-7.956s-.174-4.5-.89-5.216c-.716-.715-2.489-1.125-3-2.08-1.115-2.08-3.068-2.351-3.068-2.351l-4.5-.037z"}),Object(u.jsx)("circle",{cx:"14.761",cy:"9.754",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"36.63",cy:"10.706",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"24.842",cy:"19.181",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"39.024",cy:"15.363",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"27.569",cy:"6.091",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"28.66",cy:"11",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"35.206",cy:"4.454",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"}),Object(u.jsx)("circle",{cx:"18.842",cy:"6.091",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"10.115",cy:"13.727",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"16.66",cy:"14.818",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"11.206",cy:"20.272",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"17.751",cy:"20.818",r:"1.091",className:"mapLayersWizardIcon__highlight"}),Object(u.jsx)("circle",{cx:"30.842",cy:"20.818",r:"1.091",className:"mapLayersWizardIcon__backgroundDarker"})),renderWizard:t=>Object(u.jsx)(T,t),title:s.i18n.translate("xpack.maps.spatialJoinWizard.title",{defaultMessage:"Spatial join"})}},343:function(t,e,n){"use strict";n.d(e,"a",(function(){return mvt_single_layer_vector_source_MVTSingleLayerVectorSource})),n.d(e,"b",(function(){return O}));var i=n(6),r=n.n(i),s=n(3),o=n(56),a=n(2),l=n.n(a),u=n(135),c=n(0),h=n(92),d=n(169);class mvt_field_MVTField extends d.a{constructor({fieldName:t,type:e,source:n,origin:i}){super({fieldName:t,origin:i}),r()(this,"_source",void 0),r()(this,"_type",void 0),this._source=n,this._type=e}supportsFieldMetaFromEs(){return!1}supportsFieldMetaFromLocalData(){return!1}getMVTFieldDescriptor(){return{type:this._type,name:this.getName()}}getSource(){return this._source}async getDataType(){if(this._type===c.nb.STRING)return"string";if(this._type===c.nb.NUMBER)return"number";throw new Error(`Unrecognized MVT field-type ${this._type}`)}async getLabel(){return this.getName()}}var p=n(53),f=n.n(p),g=n(14),m=n(54),_=n(162),y=n(59),v=n(633),b=n(4);const x=[{value:c.nb.STRING,icon:"string",message:s.i18n.translate("xpack.maps.mvtSource.stringFieldLabel",{defaultMessage:"string"})},{value:c.nb.NUMBER,icon:"number",message:s.i18n.translate("xpack.maps.mvtSource.numberFieldLabel",{defaultMessage:"number"})}].map((function({value:t,icon:e,message:n}){return{value:t,inputDisplay:Object(b.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(b.jsx)(g.EuiFlexItem,{grow:null},Object(b.jsx)(v.a,{type:e,fill:"none"})),Object(b.jsx)(g.EuiFlexItem,null,n))}}));class mvt_field_config_editor_MVTFieldConfigEditor extends a.Component{constructor(...t){super(...t),r()(this,"state",{currentFields:f.a.cloneDeep(this.props.fields)}),r()(this,"_notifyChange",f.a.debounce((()=>{this.state.currentFields.some((t=>""===t.name))||this.props.onChange(this.state.currentFields)}))),r()(this,"_addField",(()=>{const t=this.state.currentFields.slice();t.push({type:c.nb.STRING,name:""}),this._fieldChange(t)}))}_fieldChange(t){this.setState({currentFields:t},this._notifyChange)}_removeField(t){const e=this.state.currentFields.slice();e.splice(t,1),this._fieldChange(e)}_renderFieldTypeDropDown(t,e){const n=t=>{const n=this.state.currentFields.slice();n[e]={type:t,name:n[e].name},this._fieldChange(n)};return Object(b.jsx)(g.EuiSuperSelect,{options:x,valueOfSelected:t.type,onChange:t=>n(t),compressed:!0})}_renderFieldButtonDelete(t){return Object(b.jsx)(g.EuiButtonIcon,{iconType:"trash",color:"danger",onClick:()=>{this._removeField(t)},title:s.i18n.translate("xpack.maps.mvtSource.trashButtonTitle",{defaultMessage:"Remove field"}),"aria-label":s.i18n.translate("xpack.maps.mvtSource.trashButtonAriaLabel",{defaultMessage:"Remove field"})})}_renderFieldNameInput(t,e){const n=""===t.name,i=this.state.currentFields.filter((e=>e.name===t.name)).length>1;return Object(b.jsx)(g.EuiFieldText,{value:t.name,onChange:t=>{const n=t.target.value,i=this.state.currentFields.slice();i[e]={name:n,type:i[e].type},this._fieldChange(i)},"aria-label":"Fieldname",placeholder:s.i18n.translate("xpack.maps.mvtSource.fieldPlaceholderText",{defaultMessage:"Field name"}),isInvalid:n||i,compressed:!0})}_renderFieldConfig(){return this.state.currentFields.map(((t,e)=>Object(b.jsx)(a.Fragment,{key:e},Object(b.jsx)(g.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},Object(b.jsx)(g.EuiFlexItem,null,this._renderFieldNameInput(t,e)),Object(b.jsx)(g.EuiFlexItem,null,this._renderFieldTypeDropDown(t,e)),Object(b.jsx)(g.EuiFlexItem,{grow:!1},this._renderFieldButtonDelete(e))),Object(b.jsx)(g.EuiSpacer,{size:"xs"}))))}render(){return Object(b.jsx)(a.Fragment,null,this._renderFieldConfig(),Object(b.jsx)(g.EuiSpacer,{size:"s"}),Object(b.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround",alignItems:"center",gutterSize:"xs"},Object(b.jsx)(g.EuiFlexItem,{grow:!1},Object(b.jsx)(g.EuiButtonEmpty,{onClick:this._addField,size:"xs",iconType:"plusInCircleFilled"},s.i18n.translate("xpack.maps.mvtSource.addFieldLabel",{defaultMessage:"Add"})))))}}class mvt_single_layer_source_settings_MVTSingleLayerSourceSettings extends a.Component{constructor(...t){super(...t),r()(this,"state",{currentLayerName:this.props.layerName,currentMinSourceZoom:this.props.minSourceZoom,currentMaxSourceZoom:this.props.maxSourceZoom,currentFields:f.a.cloneDeep(this.props.fields)}),r()(this,"_handleChange",f.a.debounce((()=>{this.props.handleChange({layerName:this.state.currentLayerName,minSourceZoom:this.state.currentMinSourceZoom,maxSourceZoom:this.state.currentMaxSourceZoom,fields:this.state.currentFields})}),200)),r()(this,"_handleLayerNameInputChange",(t=>{this.setState({currentLayerName:t.target.value},this._handleChange)})),r()(this,"_handleFieldChange",(t=>{this.setState({currentFields:t},this._handleChange)})),r()(this,"_handleZoomRangeChange",(t=>{this.setState({currentMinSourceZoom:parseInt(t[0],10),currentMaxSourceZoom:parseInt(t[1],10)},this._handleChange)}))}render(){const t=s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.fieldsPreHelpMessage",{defaultMessage:"Fields which are available in "}),e=Object(b.jsx)(l.a.Fragment,null,Object(b.jsx)("b",null,this.state.currentLayerName),"."," "),n=s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.fieldsPostHelpMessage",{defaultMessage:"These can be used for tooltips and dynamic styling."}),i=this.props.showFields&&""!==this.state.currentLayerName?Object(b.jsx)(g.EuiFormRow,{label:Object(b.jsx)(g.EuiToolTip,{anchorClassName:"eui-alignMiddle",content:Object(b.jsx)(l.a.Fragment,null,t,e,n)},Object(b.jsx)("span",null,s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.fieldsMessage",{defaultMessage:"Fields"})," ",Object(b.jsx)(g.EuiIcon,{type:"questionInCircle",color:"subdued"})))},Object(b.jsx)(mvt_field_config_editor_MVTFieldConfigEditor,{fields:this.state.currentFields.slice(),onChange:this._handleFieldChange})):null;return Object(b.jsx)(a.Fragment,null,Object(b.jsx)(g.EuiFormRow,{display:"columnCompressed",label:s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.layerNameMessage",{defaultMessage:"Source layer"})},Object(b.jsx)(g.EuiFieldText,{value:this.state.currentLayerName,onChange:this._handleLayerNameInputChange,isInvalid:""===this.state.currentLayerName,compressed:!0})),Object(b.jsx)(y.ValidatedDualRange,{label:Object(b.jsx)(g.EuiToolTip,{anchorClassName:"eui-alignMiddle",content:s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.zoomRangeHelpMessage",{defaultMessage:"Zoom levels where the layer is present in the tiles. This does not correspond directly to visibility. Layer data from lower levels can always be displayed at higher zoom levels (but not vice versa)."})},Object(b.jsx)("span",null,s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.zoomRangeTopMessage",{defaultMessage:"Available levels"})," ",Object(b.jsx)(g.EuiIcon,{type:"questionInCircle",color:"subdued"}))),formRowDisplay:"columnCompressed",value:[this.state.currentMinSourceZoom,this.state.currentMaxSourceZoom],min:c.mb,max:c.hb,onChange:this._handleZoomRangeChange,allowEmptyRange:!1,showInput:"inputWithPopover",compressed:!0,showLabels:!0,prepend:s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.dataZoomRangeMessage",{defaultMessage:"Zoom"})}),i)}}class update_source_editor_UpdateSourceEditor extends a.Component{constructor(...t){super(...t),r()(this,"_onTooltipPropertiesSelect",(t=>{this.props.onChange({propName:"tooltipProperties",value:t})})),r()(this,"_handleChange",(t=>{const e=[];if(t.layerName!==this.props.source.getTileSourceLayer()&&e.push({propName:"layerName",value:t.layerName}),t.minSourceZoom!==this.props.source.getMinZoom()&&e.push({propName:"minSourceZoom",value:t.minSourceZoom}),t.maxSourceZoom!==this.props.source.getMaxZoom()&&e.push({propName:"maxSourceZoom",value:t.maxSourceZoom}),!f.a.isEqual(t.fields,this._getFieldDescriptors())){e.push({propName:"fields",value:t.fields});const n=[];for(let e=0;e<this.props.tooltipFields.length;e++){const i=this.props.tooltipFields[e].getName();for(let e=0;e<t.fields.length;e++)if(t.fields[e].name===i){n.push(i);break}}f.a.isEqual(n,this.props.tooltipFields)||e.push({propName:"tooltipProperties",value:n})}this.props.onChange(...e)}))}_getFieldDescriptors(){return this.props.source.getMVTFields().map((t=>t.getMVTFieldDescriptor()))}_renderSourceSettingsCard(){const t=this._getFieldDescriptors();return Object(b.jsx)(a.Fragment,null,Object(b.jsx)(g.EuiPanel,null,Object(b.jsx)(g.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(m.FormattedMessage,{id:"xpack.maps.mvtSource.sourceSettings",defaultMessage:"Source settings"}))),Object(b.jsx)(g.EuiSpacer,{size:"m"}),Object(b.jsx)(mvt_single_layer_source_settings_MVTSingleLayerSourceSettings,{handleChange:this._handleChange,layerName:this.props.source.getTileSourceLayer()||"",fields:t,minSourceZoom:this.props.source.getMinZoom(),maxSourceZoom:this.props.source.getMaxZoom(),showFields:!0})),Object(b.jsx)(g.EuiSpacer,{size:"s"}))}_renderTooltipSelectionCard(){return Object(b.jsx)(a.Fragment,null,Object(b.jsx)(g.EuiPanel,null,Object(b.jsx)(g.EuiTitle,{size:"xs"},Object(b.jsx)("h5",null,Object(b.jsx)(m.FormattedMessage,{id:"xpack.maps.mvtSource.tooltipsTitle",defaultMessage:"Tooltip fields"}))),Object(b.jsx)(g.EuiSpacer,{size:"m"}),Object(b.jsx)(_.a,{tooltipFields:this.props.tooltipFields,onChange:this._onTooltipPropertiesSelect,fields:this.props.source.getMVTFields()})),Object(b.jsx)(g.EuiSpacer,{size:"s"}))}render(){return Object(b.jsx)(a.Fragment,null,this._renderSourceSettingsCard(),this._renderTooltipSelectionCard())}}var E=n(125);const S=s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSource.sourceTitle",{defaultMessage:"Vector tiles"});class mvt_single_layer_vector_source_MVTSingleLayerVectorSource extends u.a{static createDescriptor({urlTemplate:t,layerName:e,minSourceZoom:n,maxSourceZoom:i,fields:r,tooltipProperties:s}){return{type:c.Cb.MVT_SINGLE_LAYER,id:Object(o.v4)(),urlTemplate:t||"",layerName:e||"",minSourceZoom:"number"==typeof n?Math.max(c.mb,n):c.mb,maxSourceZoom:"number"==typeof i?Math.min(c.hb,i):c.hb,fields:r||[],tooltipProperties:s||[]}}constructor(t){super(t),r()(this,"_descriptor",void 0),r()(this,"_tooltipFields",void 0),this._descriptor=mvt_single_layer_vector_source_MVTSingleLayerVectorSource.createDescriptor(t),this._tooltipFields=this._descriptor.tooltipProperties.map((t=>this.getFieldByName(t))).filter((t=>null!==t))}isMvt(){return!0}async supportsFitToBounds(){return!1}renderSourceSettingsEditor({onChange:t}){return Object(b.jsx)(update_source_editor_UpdateSourceEditor,{onChange:t,tooltipFields:this._tooltipFields,source:this})}addFeature(t){throw new Error("Does not implement addFeature")}deleteFeature(t){throw new Error("Does not implement deleteFeature")}getMVTFields(){return this._descriptor.fields.map((t=>new mvt_field_MVTField({fieldName:t.name,type:t.type,source:this,origin:c.D.SOURCE})))}getFieldByName(t){const e=this._descriptor.fields.find((e=>e.name===t));return e?new mvt_field_MVTField({fieldName:e.name,type:e.type,source:this,origin:c.D.SOURCE}):null}getGeoJsonWithMeta(){throw new Error("Does not implement getGeoJsonWithMeta")}async getFields(){return this.getMVTFields()}getTileSourceLayer(){return this._descriptor.layerName}async getImmutableProperties(){return[{label:Object(h.a)(),value:S},{label:Object(h.f)(),value:this._descriptor.urlTemplate}]}async getDisplayName(){return this.getTileSourceLayer()}async getTileUrl(){return this._descriptor.urlTemplate}async getSupportedShapeTypes(){return[c.Hb.POINT,c.Hb.LINE,c.Hb.POLYGON]}hasTooltipProperties(){return!!this._tooltipFields.length}getMinZoom(){return this._descriptor.minSourceZoom}getMaxZoom(){return this._descriptor.maxSourceZoom}async getBoundsForFilters(t,e){return null}getSyncMeta(){return{mvtFields:this._descriptor.fields.map((t=>t.name))}}isBoundsAware(){return!1}getSourceStatus(){return{tooltipContent:null,areResultsTrimmed:!1}}async getLeftJoinFields(){return[]}async getTooltipProperties(t){const e=[];for(const n in t)if(t.hasOwnProperty(n))for(let i=0;i<this._tooltipFields.length;i++)if(this._tooltipFields[i].getName()===n){const i=new E.a(n,n,t[n]);e.push(i);break}return e}async getTimesliceMaskFieldName(){return null}async supportsFeatureEditing(){return!1}supportsJoins(){return!1}getFeatureActions(t){return[]}getInspectorRequestIds(){return[]}}class mvt_single_layer_vector_source_editor_MVTSingleLayerVectorSourceEditor extends a.Component{constructor(...t){super(...t),r()(this,"state",{urlTemplate:"",layerName:"",minSourceZoom:c.mb,maxSourceZoom:c.hb,fields:[]}),r()(this,"_sourceConfigChange",f.a.debounce((()=>{this.state.urlTemplate.indexOf("{x}")>=0&&this.state.urlTemplate.indexOf("{y}")>=0&&this.state.urlTemplate.indexOf("{z}")>=0&&this.state.layerName&&this.props.onSourceConfigChange({urlTemplate:this.state.urlTemplate,layerName:this.state.layerName,minSourceZoom:this.state.minSourceZoom,maxSourceZoom:this.state.maxSourceZoom,fields:this.state.fields})}),200)),r()(this,"_handleUrlTemplateChange",(t=>{const e=t.target.value;this.setState({urlTemplate:e},(()=>this._sourceConfigChange()))})),r()(this,"_handleChange",(t=>{this.setState(t,(()=>this._sourceConfigChange()))}))}render(){return Object(b.jsx)(g.EuiPanel,null,Object(b.jsx)(g.EuiFormRow,{label:s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.urlMessage",{defaultMessage:"Url"}),helpText:s.i18n.translate("xpack.maps.source.MVTSingleLayerVectorSourceEditor.urlHelpMessage",{defaultMessage:"URL of the .mvt vector tile service. e.g. {url}",values:{url:"http://company.com/{z}/{x}/{y}.pbf"}})},Object(b.jsx)(g.EuiFieldText,{value:this.state.urlTemplate,onChange:this._handleUrlTemplateChange,compressed:!0})),Object(b.jsx)(mvt_single_layer_source_settings_MVTSingleLayerSourceSettings,{handleChange:this._handleChange,layerName:this.state.layerName,fields:this.state.fields,minSourceZoom:this.state.minSourceZoom,maxSourceZoom:this.state.maxSourceZoom,showFields:!1}))}}var C=n(91);const O={id:c.Jb.MVT_VECTOR,order:10,categories:[c.ab.REFERENCE],description:s.i18n.translate("xpack.maps.source.mvtVectorSourceWizard",{defaultMessage:"Data service implementing the Mapbox vector tile specification"}),icon:()=>Object(b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"49",height:"25",fill:"none",viewBox:"0 0 49 25"},Object(b.jsx)("g",{clipPath:"url(#clip0)"},Object(b.jsx)("path",{className:"mapLayersWizardIcon__background",d:"M33.547 14.847l2.439-19.72-2.114.36c-1.133.385-2.692.577-4.114.684-.706.052-1.368.083-1.916.108l-.14.006c-.475.02-.868.038-1.097.064a2.885 2.885 0 00-.85.255c-.237.106-.48.237-.714.362l-.088.047c-.541.29-1.045.543-1.56.608l-1.99.515v8.926c0 1.062.215 3.302 0 5.242l-.311 2.543h12.455zM18.485-2.298c-1 .058-1.9.429-3.135.607-.356.051-.714.104-1.07.157-.888.131-1.765.26-2.577.362-1.143.142-2.115.22-2.77.172C8.031-1.067 7.22-.48 6.48.283c-.69.711-1.408 1.676-2.174 2.704l-.22.295C2.363 5.591.354 8.18-2.337 9.526c-.326.163-.528.475-.658.803-.132.334-.214.743-.263 1.188-.097.893-.07 2.016.011 3.17.109 1.539.322 3.2.488 4.5.082.64.153 1.192.194 1.598.122 1.188-.195 2.693-.564 4.038-.134.486-.27.939-.392 1.343l-.13.434a14.78 14.78 0 00-.184.661c-.044.178-.081.36-.081.508 0 .425.168.879.43 1.282.267.408.65.793 1.12 1.078l.102.061.12-.002c6.291-.103 15.558-.843 16.703-.97a.886.886 0 00.507-.259 2.15 2.15 0 00.342-.447c.204-.34.401-.797.59-1.32.38-1.05.753-2.434 1.098-3.834.244-.997.828-2.148 1.037-3.062l1.194-4.256c.101-.576.302-1.721.414-2.595.223-1.748-.015-3.866.148-6.088.162-2.22.26-4.44.223-6.168-.019-.862-.072-1.615-.172-2.19a3.756 3.756 0 00-.199-.752c-.08-.196-.42-.545-.42-.545h-.837zm16.639 19.212s-1.78-.992-2.356-.978c-1.153.03-1.976-.038-3.58 0h-8.356l-4.36 13.571c.305.102 2.95.677 3.414.681.943.008 2.25-.12 3.643-.3 1.338-.17 2.776-.392 4.077-.591l.171-.027c1.352-.207 2.532-.387 3.297-.463.53-.053 1.517-.037 2.829-.011l.194.004c1.259.025 2.768.056 4.367.035 3.347-.043 7.146-.31 9.894-1.35 2.162-.82 3.196-1.325 3.826-2.039.63-.714.876-2.4.876-2.4s-4.425 1.321-7.318 1.194c-1.411-.062-2.295.067-3.58-.52-2.175-.991-1.835-3.38-3.698-4.877-1.174-.944-3.34-1.929-3.34-1.929z"}),Object(b.jsx)("path",{className:"mapLayersWizardIcon__background",d:"M37.439-4.77s-3.114 20.058-2.44 20.395c1.197.598 3.063 1.012 4.775 2.543 1.872 1.673 1.784 3.805 3.53 4.93 1.27.82 9.932-1.07 9.932-1.07l.348-12.112s-.265-6.85-1.355-7.94C51.14.886 48.441.264 47.662-1.189c-1.697-3.169-4.67-3.581-4.67-3.581h-5.553z"}),Object(b.jsx)("circle",{cx:"9.487",cy:"7.606",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"42.779",cy:"9.055",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"24.834",cy:"21.957",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"46.423",cy:"16.145",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"28.986",cy:"2.029",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"30.646",cy:"9.502",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"40.61",cy:"-0.462",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"15.7",cy:"2.029",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"2.415",cy:"13.654",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"12.379",cy:"15.315",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"4.075",cy:"23.618",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"14.039",cy:"24.448",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("circle",{cx:"33.968",cy:"24.448",r:"1.661",className:"mapLayersWizardIcon__highlight"}),Object(b.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M.834 23.863h48v.545h-48zm0-11.727h48v.545h-48zm0-11.727h48v.545h-48z"}),Object(b.jsx)("path",{className:"mapLayersWizardIcon__highlight",d:"M.834.409h.545v24H.834zm15.818 0h.545v24h-.545zm16.091 0h.545v24h-.545zm15.545 0h.545v24h-.545z"})),Object(b.jsx)("defs",null,Object(b.jsx)("clipPath",{id:"clip0"},Object(b.jsx)("path",{fill:"#fff",d:"M0 0h48v24H0z",transform:"translate(.834 .409)"})))),renderWizard:({previewLayers:t,mapColors:e})=>Object(b.jsx)(mvt_single_layer_vector_source_editor_MVTSingleLayerVectorSourceEditor,{onSourceConfigChange:n=>{const i=mvt_single_layer_vector_source_MVTSingleLayerVectorSource.createDescriptor(n),r=C.c.createDescriptor({sourceDescriptor:i},e);t([r])}}),title:S}},344:function(t,e,n){"use strict";n.d(e,"a",(function(){return y})),n.d(e,"b",(function(){return view_AddLayerPanel}));var i=n(6),r=n.n(i),s=n(2),o=n.n(s),a=n(14),l=n(3),u=n(54),c=n(55),h=n(53),d=n.n(h),p=n(30),f=n(0),g=(n(603),n(4));class layer_wizard_select_LayerWizardSelect extends s.Component{constructor(...t){super(...t),r()(this,"_isMounted",!1),r()(this,"state",{activeCategories:[],hasLoadedWizards:!1,layerWizards:[],selectedCategory:null})}componentDidMount(){this._isMounted=!0,this._loadLayerWizards()}componentWillUnmount(){this._isMounted=!1}async _loadLayerWizards(){const t=await Object(p.a)(),e=[];t.forEach((t=>{t.categories.forEach((t=>{e.includes(t)||e.push(t)}))})),this._isMounted&&this.setState({activeCategories:e,layerWizards:t,hasLoadedWizards:!0})}_filterByCategory(t){this.setState({selectedCategory:t})}_renderCategoryFacets(){if(0===this.state.activeCategories.length)return null;const t=this.state.activeCategories.map((t=>Object(g.jsx)(a.EuiFacetButton,{key:t,isSelected:t===this.state.selectedCategory,onClick:()=>this._filterByCategory(t),minWidth:!1},function(t){if(t===f.ab.ELASTICSEARCH)return l.i18n.translate("xpack.maps.layerWizardSelect.elasticsearchCategoryLabel",{defaultMessage:"Elasticsearch"});if(t===f.ab.REFERENCE)return l.i18n.translate("xpack.maps.layerWizardSelect.referenceCategoryLabel",{defaultMessage:"Reference"});if(t===f.ab.SOLUTIONS)return l.i18n.translate("xpack.maps.layerWizardSelect.solutionsCategoryLabel",{defaultMessage:"Solutions"});throw new Error(`Unexpected category: ${t}`)}(t))));return Object(g.jsx)(a.EuiFacetGroup,{layout:"horizontal",gutterSize:"s"},Object(g.jsx)(a.EuiFacetButton,{key:"all",isSelected:!this.state.selectedCategory,onClick:()=>this._filterByCategory(null),minWidth:!1},Object(g.jsx)(u.FormattedMessage,{id:"xpack.maps.layerWizardSelect.allCategories",defaultMessage:"All"})),t)}render(){if(!this.state.hasLoadedWizards)return Object(g.jsx)(a.EuiPanel,null,Object(g.jsx)(a.EuiSkeletonText,{lines:2}));const t=this.state.layerWizards.filter((t=>!this.state.selectedCategory||t.categories.includes(this.state.selectedCategory))).map((t=>{const e=t.icon?Object(g.jsx)(a.EuiIcon,{type:t.icon,size:"l"}):void 0,n=Object(g.jsx)(a.EuiCard,{title:t.title,titleSize:"xs",betaBadgeProps:{label:t.isBeta?l.i18n.translate("xpack.maps.layerWizardSelect.technicalPreviewLabel",{defaultMessage:"Technical preview"}):""},icon:e,onClick:()=>{this.props.onSelect(t)},description:t.description,isDisabled:t.isDisabled,"data-test-subj":d.a.camelCase(t.title)});return Object(g.jsx)(a.EuiFlexItem,{key:t.title},t.isDisabled&&t.disabledReason?Object(g.jsx)(a.EuiToolTip,{position:"top",anchorClassName:"mapMapLayerWizardSelect__tooltip",content:t.disabledReason},n):n)}));return Object(g.jsx)(o.a.Fragment,null,this._renderCategoryFacets(),Object(g.jsx)(a.EuiSpacer,{size:"s"}),Object(g.jsx)(a.EuiFlexGrid,{columns:2,gutterSize:"m"},t))}}var m=n(89);const _=Object(c.connect)((function(t){return{mapColors:Object(m.s)(t),mostCommonDataViewId:Object(m.y)(t)}}),{})((t=>Object(g.jsx)("div",{className:"mapLayerPanel__body","data-test-subj":"layerAddForm"},Object(g.jsx)("div",{className:"mapLayerPanel__bodyOverflow"},function(){if(!t.layerWizard||!t.currentStepId)return Object(g.jsx)(layer_wizard_select_LayerWizardSelect,{onSelect:t.onWizardSelect});const e={previewLayers:t.previewLayers,mapColors:t.mapColors,mostCommonDataViewId:t.mostCommonDataViewId,currentStepId:t.currentStepId,isOnFinalStep:t.isOnFinalStep,enableNextBtn:t.enableNextBtn,disableNextBtn:t.disableNextBtn,startStepLoading:t.startStepLoading,stopStepLoading:t.stopStepLoading,advanceToNextStep:t.advanceToNextStep},n=t.showBackButton?Object(g.jsx)(s.Fragment,null,Object(g.jsx)(a.EuiButtonEmpty,{size:"xs",flush:"left",onClick:t.onClear,iconType:"arrowLeft"},Object(g.jsx)(u.FormattedMessage,{id:"xpack.maps.addLayerPanel.changeDataSourceButtonLabel",defaultMessage:"Change layer"})),Object(g.jsx)(a.EuiSpacer,{size:"s"})):null;return Object(g.jsx)(s.Fragment,null,n,t.layerWizard.renderWizard(e))}())))),y="ADD_LAYER_STEP_ID",v=l.i18n.translate("xpack.maps.addLayerPanel.addLayer",{defaultMessage:"Add layer"}),b=l.i18n.translate("xpack.maps.addLayerPanel.addLayerNextButtonLabel",{defaultMessage:"Add and continue"}),x=l.i18n.translate("xpack.maps.addLayerPanel.addLayerSecondaryActionButtonLabel",{defaultMessage:"Add and close"}),E={currentStepIndex:0,currentStep:null,layerSteps:null,layerWizard:null,isNextStepBtnEnabled:!1,isStepLoading:!1};class view_AddLayerPanel extends s.Component{constructor(...t){super(...t),r()(this,"state",{...E}),r()(this,"_previewLayers",(t=>{this.props.addPreviewLayers(t)})),r()(this,"_clearLayerWizard",(()=>{this.setState(E),this.props.addPreviewLayers([])})),r()(this,"_onWizardSelect",(t=>{const e=[...t.prerequisiteSteps?t.prerequisiteSteps:[],{id:y,label:v,nextButtonLabel:b,renderSecondaryActionButton:({isDisabled:t,isLoading:e,addLayersAndClose:n})=>Object(g.jsx)(a.EuiButton,{disabled:t||e,isLoading:e,onClick:n,iconSide:"right"},x)}];this.setState({...E,layerWizard:t,layerSteps:e,currentStep:e[0]})})),r()(this,"_onNext",(()=>{var t;this.state.layerSteps&&(this.state.layerSteps.length-1===this.state.currentStepIndex?(this.props.addLayersAndContinue(),null!==(t=this.state.layerWizard)&&void 0!==t&&t.showFeatureEditTools&&this.props.enableEditMode()):this.setState((t=>{const e=t.currentStepIndex+1;return{currentStepIndex:e,currentStep:t.layerSteps[e],isNextStepBtnEnabled:!1,isStepLoading:!1}})))})),r()(this,"_enableNextBtn",(()=>{this.setState({isNextStepBtnEnabled:!0})})),r()(this,"_disableNextBtn",(()=>{this.setState({isNextStepBtnEnabled:!1})})),r()(this,"_startStepLoading",(()=>{this.setState({isStepLoading:!0})})),r()(this,"_stopStepLoading",(()=>{this.setState({isStepLoading:!1})}))}componentDidMount(){this.props.autoOpenLayerWizardId&&this._openWizard()}_openWizard(){const t=Object(p.b)(this.props.autoOpenLayerWizardId);t&&this._onWizardSelect(t),this.props.clearAutoOpenLayerWizardId()}_renderNextButton(){if(!this.state.currentStep)return null;const t=this.state.currentStep.id===y?!this.props.hasPreviewLayers:!this.state.isNextStepBtnEnabled,e=Object(g.jsx)(a.EuiFlexItem,{grow:!1},Object(g.jsx)(a.EuiButton,{"data-test-subj":"importFileButton",disabled:t||this.state.isStepLoading,isLoading:this.state.isStepLoading,iconSide:"right",iconType:"arrowRight",onClick:this._onNext,fill:!0},this.state.currentStep.nextButtonLabel?this.state.currentStep.nextButtonLabel:this.state.currentStep.label));return this.state.currentStep.renderSecondaryActionButton?Object(g.jsx)(a.EuiFlexItem,{grow:!1},Object(g.jsx)(a.EuiFlexGroup,{responsive:!1,gutterSize:"s"},Object(g.jsx)(a.EuiFlexItem,{grow:!1},this.state.currentStep.renderSecondaryActionButton({isDisabled:t,isLoading:this.state.isStepLoading,addLayersAndClose:this.props.addLayersAndClose})),e)):e}render(){return Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(a.EuiFlyoutHeader,{hasBorder:!0,className:"mapLayerPanel__header"},Object(g.jsx)(a.EuiTitle,{size:"s"},Object(g.jsx)("h2",null,this.state.currentStep?this.state.currentStep.label:v))),Object(g.jsx)(_,{layerWizard:this.state.layerWizard,onClear:this._clearLayerWizard,onWizardSelect:this._onWizardSelect,previewLayers:this._previewLayers,showBackButton:!this.state.isStepLoading,currentStepId:this.state.currentStep?this.state.currentStep.id:null,isOnFinalStep:!!this.state.currentStep&&this.state.currentStep.id===y,enableNextBtn:this._enableNextBtn,disableNextBtn:this._disableNextBtn,startStepLoading:this._startStepLoading,stopStepLoading:this._stopStepLoading,advanceToNextStep:this._onNext}),Object(g.jsx)(a.EuiFlyoutFooter,{className:"mapLayerPanel__footer"},Object(g.jsx)(a.EuiFlexGroup,{justifyContent:"spaceBetween",responsive:!1,gutterSize:"none"},Object(g.jsx)(a.EuiFlexItem,{grow:!1},Object(g.jsx)(a.EuiButtonEmpty,{onClick:this.props.closeFlyout,flush:"left","data-test-subj":"layerAddCancelButton"},Object(g.jsx)(u.FormattedMessage,{id:"xpack.maps.addLayerPanel.footer.cancelButtonLabel",defaultMessage:"Cancel"}))),this._renderNextButton())))}}},345:function(t,e,n){"use strict";n.d(e,"a",(function(){return xyz_tms_source_XYZTMSSource})),n.d(e,"b",(function(){return y}));var i=n(6),r=n.n(i),s=n(3),o=n(92),a=n(0),l=n(135),u=n(152);const c=s.i18n.translate("xpack.maps.source.ems_xyzTitle",{defaultMessage:"Tile Map Service"});class xyz_tms_source_XYZTMSSource extends l.a{static createDescriptor({urlTemplate:t}){return{type:xyz_tms_source_XYZTMSSource.type,urlTemplate:t}}constructor(t){super(t),r()(this,"_descriptor",void 0),this._descriptor=t}async getImmutableProperties(){return[{label:Object(o.a)(),value:c},{label:Object(o.f)(),value:this._descriptor.urlTemplate}]}async getDisplayName(){return this._descriptor.urlTemplate}async getUrlTemplate(){return this._descriptor.urlTemplate}async hasLegendDetails(){return!1}renderLegendDetails(){return null}isSourceStale(t,e){var n;return!!e.url&&(null===(n=t.tiles)||void 0===n?void 0:n[0])!==e.url}async canSkipSourceUpdate(t,e){const n=null==t?void 0:t.getMeta();return await Object(u.b)({extentAware:!1,source:this,prevDataRequest:t,nextRequestMeta:e,getUpdateDueToTimeslice:t=>!n||this.getUpdateDueToTimeslice(n,t)})}}r()(xyz_tms_source_XYZTMSSource,"type",a.Cb.EMS_XYZ);var h=n(2),d=n(53),p=n.n(d),f=n(14),g=n(4);class xyz_tms_editor_XYZTMSEditor extends h.Component{constructor(...t){super(...t),r()(this,"state",{url:""}),r()(this,"_previewLayer",p.a.debounce((()=>{const{url:t}=this.state,e=t.indexOf("{x}")>=0&&t.indexOf("{y}")>=0&&t.indexOf("{z}")>=0?{urlTemplate:t}:null;this.props.onSourceConfigChange(e)}),500)),r()(this,"_onUrlChange",(t=>{this.setState({url:t.target.value},this._previewLayer)}))}render(){return Object(g.jsx)(f.EuiPanel,null,Object(g.jsx)(f.EuiFormRow,{label:"Url"},Object(g.jsx)(f.EuiFieldText,{placeholder:"https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",onChange:this._onUrlChange})))}}var m=n(176),_=n(327);const y={id:a.Jb.TMS_LAYER,order:10,categories:[a.ab.REFERENCE],description:s.i18n.translate("xpack.maps.source.ems_xyzDescription",{defaultMessage:"Raster image tile map service using {z}/{x}/{y} url pattern.",values:{z:"{z}",x:"{x}",y:"{y}"}}),icon:_.a,renderWizard:({previewLayers:t})=>Object(g.jsx)(xyz_tms_editor_XYZTMSEditor,{onSourceConfigChange:e=>{if(!e)return void t([]);const n=m.a.createDescriptor({sourceDescriptor:xyz_tms_source_XYZTMSSource.createDescriptor(e)});t([n])}}),title:c}},359:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2);e.default=function(t,e){void 0===e&&(e=0);var n=i.useRef(!1),r=i.useRef(),s=i.useRef(t),o=i.useCallback((function(){return n.current}),[]),a=i.useCallback((function(){n.current=!1,r.current&&clearTimeout(r.current),r.current=setTimeout((function(){n.current=!0,s.current()}),e)}),[e]),l=i.useCallback((function(){n.current=null,r.current&&clearTimeout(r.current)}),[]);return i.useEffect((function(){s.current=t}),[t]),i.useEffect((function(){return a(),l}),[e]),[o,l,a]}},590:function(t,e){t.exports=r,t.exports.parse=r,t.exports.stringify=function t(e){function n(t){return t.join(" ")}function i(t){return t.map(n).join(", ")}function r(t){return t.map(i).map(s).join(", ")}function s(t){return"("+t+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+n(e.coordinates)+")";case"LineString":return"LINESTRING ("+i(e.coordinates)+")";case"Polygon":return"POLYGON ("+r(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+i(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+e.coordinates.map(r).map(s).join(", ")+")";case"MultiLineString":return"MULTILINESTRING ("+r(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(t).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};var n=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,i=new RegExp("^"+n.source+"(\\s"+n.source+"){1,}");function r(t){var e,n=t.split(";"),r=n.pop(),s=(n.shift()||"").split("=").pop(),o=0;function a(t){var e=r.substring(o).match(t);return e?(o+=e[0].length,e[0]):null}function l(){a(/^\s*/)}function u(){l();for(var t,e=0,n=[],r=[n],s=n;t=a(/^(\()/)||a(/^(\))/)||a(/^(,)/)||a(i);){if("("===t)r.push(s),s=[],r[r.length-1].push(s),e++;else if(")"===t){if(0===s.length)return null;if(!(s=r.pop()))return null;if(0==--e)break}else if(","===t)s=[],r[r.length-1].push(s);else{if(t.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(s,t.split(/\s/g).map(parseFloat))}l()}return 0!==e?null:n}function c(){for(var t,e,n=[];e=a(i)||a(/^(,)/);)","===e?(n.push(t),t=[]):e.split(/\s/g).some(isNaN)||(t||(t=[]),Array.prototype.push.apply(t,e.split(/\s/g).map(parseFloat))),l();return t?(n.push(t),n.length?n:null):null}return(e=function t(){return function(){if(!a(/^(point(\sz)?)/i))return null;if(l(),!a(/^(\()/))return null;var t=c();return t?(l(),a(/^(\))/)?{type:"Point",coordinates:t[0]}:null):null}()||function(){if(!a(/^(linestring(\sz)?)/i))return null;if(l(),!a(/^(\()/))return null;var t=c();return t&&a(/^(\))/)?{type:"LineString",coordinates:t}:null}()||function(){if(!a(/^(polygon(\sz)?)/i))return null;l();var t=u();return t?{type:"Polygon",coordinates:t}:null}()||function(){if(!a(/^(multipoint)/i))return null;l();var t=r.substring(r.indexOf("(")+1,r.length-1).replace(/\(/g,"").replace(/\)/g,"");r="MULTIPOINT ("+t+")";var e=u();return e?(l(),{type:"MultiPoint",coordinates:e}):null}()||function(){if(!a(/^(multilinestring)/i))return null;l();var t=u();return t?(l(),{type:"MultiLineString",coordinates:t}):null}()||function(){if(!a(/^(multipolygon)/i))return null;l();var t=u();return t?{type:"MultiPolygon",coordinates:t}:null}()||function(){var e,n=[];if(!a(/^(geometrycollection)/i))return null;if(l(),!a(/^(\()/))return null;for(;e=t();)n.push(e),l(),a(/^(,)/),l();return a(/^(\))/)?{type:"GeometryCollection",geometries:n}:null}()}())&&s.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+s}}),e}},591:function(t,e,n){"use strict";function i(t){return function(e){var n=e.dispatch,i=e.getState;return function(e){return function(r){return"function"==typeof r?r(n,i,t):e(r)}}}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i();r.withExtraArgument=i;var s=r;e.default=s},592:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var i=n(29),r=n(172);async function s(t){const{item:e,meta:{outcome:n,aliasPurpose:s,aliasTargetId:o}}=await Object(i.b)().get(t);if(e.error)throw e.error;const{attributes:a}=Object(r.b)(e);return{attributes:a,sharingSavedObjectProps:{aliasTargetId:o,outcome:n,aliasPurpose:s,sourceId:t},managed:Boolean(e.managed),references:e.references}}},593:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var i=n(29);async function r(t,e,n){const{item:{id:r}}=await(n?Object(i.b)().update({id:n,data:t,options:{references:e}}):Object(i.b)().create({data:t,options:{references:e}}));return{id:r}}},594:function(t,e,n){switch(window.__kbnThemeTag__){case"v8dark":return n(595);case"v8light":return n(597)}},595:function(t,e,n){var i=n(104),r=n(596);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},596:function(t,e,n){(e=n(105)(!1)).push([t.i,"#maps-plugin{display:flex;flex-direction:column;height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)));overflow:hidden;width:100%}.mapFullScreen{height:100vh!important}#react-maps-root{display:flex;flex-direction:column;flex-grow:1}.euiColorPicker__emptySwatch{position:relative}.mapContainer{flex-grow:1}.mapContainer .maplibregl-ctrl-top-left .maplibregl-ctrl{margin-left:12px;margin-top:12px}.mapContainer .maplibregl-ctrl-group:not(:empty){background-color:#1d1e24;border-radius:4px;box-shadow:0 2.7px 9px rgba(0,0,0,.325),0 9.4px 24px rgba(0,0,0,.225),0 21.8px 43px #0003;overflow:hidden;transition:transform .25s ease-in-out}.mapContainer .maplibregl-ctrl-group:not(:empty):hover{transform:translateY(-1px)}.mapContainer .maplibregl-ctrl-group:not(:empty)>button{height:32px;width:32px}.mapContainer .maplibregl-ctrl-group:not(:empty)>button+button{border:none}.mapContainer .maplibregl-ctrl button:not(:disabled){transition:background .25s ease-in-out}.mapContainer .maplibregl-ctrl button:not(:disabled):hover{background-color:#98a2b31a}.mapContainer .maplibregl-ctrl-group button:focus:focus-visible{box-shadow:none}.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='15' height='15' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23DFE5EF' d='M8 7V3.5a.5.5 0 0 0-1 0V7H3.5a.5.5 0 0 0 0 1H7v3.5a.5.5 0 1 0 1 0V8h3.5a.5.5 0 1 0 0-1H8Zm-.5 8a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z'/%3E%3C/svg%3E\")!important;background-position:50%!important;background-repeat:no-repeat!important}.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='15' height='15' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23DFE5EF' d='M7.5 0C11.636 0 15 3.364 15 7.5S11.636 15 7.5 15 0 11.636 0 7.5 3.364 0 7.5 0Zm-4 7a.5.5 0 0 0 0 1h8a.5.5 0 1 0 0-1h-8Z'/%3E%3C/svg%3E\")!important;background-position:50%!important;background-repeat:no-repeat!important}.mapMapWrapper{position:relative}.mapMapLayerPanel{background-color:#141519;overflow:hidden;width:0}.mapMapLayerPanel>*{width:480px}.mapMapLayerPanel-isVisible{transition:width .25s cubic-bezier(.694,.0482,.335,1);width:480px}.mapTimeslider{bottom:16px;left:calc(50% - 400px);position:absolute;z-index:99999}.mapTimeslider .controlFrame__formControlLayout{box-shadow:0 2.7px 9px rgba(0,0,0,.325),0 9.4px 24px rgba(0,0,0,.225),0 21.8px 43px #0003}.mapTimeslider--animation{animation:mapAnimationPulse .6s ease-in-out}.mapLayerPanel__footer,.mapLayerPanel__header{padding:16px}.mapLayerPanel__body{flex-basis:1px;flex-grow:1;overflow-y:auto;padding-bottom:0;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mapLayerPanel__body::-webkit-scrollbar{height:16px;width:16px}.mapLayerPanel__body::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mapLayerPanel__body::-webkit-scrollbar-corner,.mapLayerPanel__body::-webkit-scrollbar-track{background-color:#0000}.mapLayerPanel__body .mapLayerPanel__bodyOverflow{padding:16px}.mapLayerPanel__body .mapLayerPanel__bodyOverflow>:last-child{margin-bottom:16px}.mapLayerPanel__sourceDetails{margin-left:32px}.mapLayerPanel__sourceDetail{margin-bottom:0!important}.mapLayerPanel__footer{border-top:1px solid #343741}.mapAttributionFormRow{display:flex;margin:8px 0}.mapAttributionFormRow__legend{align-items:center;color:#dfe5ef;display:inline-flex;font-size:12px;font-size:.8571428571rem;font-weight:600;height:32px;line-height:1.1428571429rem;margin-right:8px;overflow-wrap:break-word!important;width:calc(33% - 8px);word-break:break-word}.mapAttributionFormRow__field{width:67%}.mapAttributionFormRow__addButton{margin-top:4px}.mapAttributionFormRow__buttons{display:flex;justify-content:flex-end;margin-top:4px}.mapAttributionPopover{width:480px}.mapFilterEditor{overflow-y:visible;width:calc(95vw - 440px)}.mapJoinItem{background:#343741;border-radius:6px;margin-bottom:12px;padding:8px 4px;position:relative}.mapJoinItem .mapJoinItem__inner{overflow-x:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar{height:16px;width:16px}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-corner,.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-track{background-color:#0000}.mapJoinItem:focus .mapJoinItem__delete,.mapJoinItem:hover .mapJoinItem__delete{opacity:1;visibility:visible}.mapJoinItem__delete{background:#1d1e24;box-shadow:0 .7px 1.4px rgba(0,0,0,.175),0 1.9px 4px rgba(0,0,0,.125),0 4.5px 10px rgba(0,0,0,.125);margin-right:-8px;margin-top:-12px;opacity:0;padding:4px;position:absolute;right:0;top:50%;visibility:hidden}.mapJoinExpressionHelpText{padding-bottom:8px;padding-top:0}.mapStyleSettings__fixedBox{width:120px}.mapWidgetOverlay{bottom:12px;left:0;pointer-events:none;position:absolute;right:12px;top:12px;z-index:1000}.mapWidgetOverlay__layerWrapper{align-items:flex-end;min-height:0;width:320px}.mapWidgetControl__headerFlexItem{flex-shrink:0}.mapWidgetControl{border-color:#0000!important;display:flex;flex-direction:column;max-height:100%;overflow:hidden;padding-bottom:8px;pointer-events:all;width:100%}.mapWidgetControl.mapWidgetControl-hasShadow{box-shadow:0 2.7px 9px rgba(0,0,0,.325),0 9.4px 24px rgba(0,0,0,.225),0 21.8px 43px #0003}.mapWidgetControl__header{flex-shrink:0;padding:0 16px;text-transform:uppercase}.mapAttributionControl{overflow-wrap:break-word!important;padding-left:12px;pointer-events:all;text-shadow:0 0 2px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24 0 0 1px #1d1e24 0 0 1px #1d1e24;word-break:break-word}.mapAttributionControl__fullScreen{margin-left:160px}.mapLayerControl{border-top:1px solid #25262e;flex-basis:auto!important;overflow-y:auto;padding-bottom:9px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.mapLayerControl::-webkit-scrollbar{height:16px;width:16px}.mapLayerControl::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.mapLayerControl::-webkit-scrollbar-corner,.mapLayerControl::-webkit-scrollbar-track{background-color:#0000}.mapLayerControl__addLayerButton{flex-shrink:0}.mapLayerControl__addLayerButton.euiButton-isDisabled{background-color:#343741!important}.mapLayerControl__addLayerButton,.mapLayerControl__openLayerTOCButton{pointer-events:all}.mapLayerControl__addLayerButton:enabled,.mapLayerControl__addLayerButton:enabled:focus,.mapLayerControl__addLayerButton:enabled:hover,.mapLayerControl__openLayerTOCButton:enabled,.mapLayerControl__openLayerTOCButton:enabled:focus,.mapLayerControl__openLayerTOCButton:enabled:hover{box-shadow:0 2.7px 9px rgba(0,0,0,.325),0 9.4px 24px rgba(0,0,0,.225),0 21.8px 43px #0003}.mapLayerControl__closeLayerTOCButton,.mapLayerControl__openLayerTOCButton{background-color:#1d1e24!important;height:32px;width:32px}.mapLayerToc-droppable-dropNotAllowed *{cursor:not-allowed!important}.mapLayerToc-droppable-isCombining *{cursor:alias!important}.mapLayerToc-droppable-isCombining{background-color:#1d1e24!important}.mapLayerToc-droppable-isDragging *{cursor:ns-resize!important}.mapTocEntry{border-bottom:1px solid #25262e;padding:8px;position:relative}.mapTocEntry:focus,.mapTocEntry:focus-within,.mapTocEntry:hover{z-index:2}.mapTocEntry .mapTocEntry__detailsToggle:focus,.mapTocEntry .mapTocEntry__detailsToggle:hover,.mapTocEntry .mapTocEntry__layerIcons:focus,.mapTocEntry .mapTocEntry__layerIcons:hover,.mapTocEntry:focus .mapTocEntry__detailsToggle,.mapTocEntry:focus .mapTocEntry__layerIcons,.mapTocEntry:focus-within .mapTocEntry__detailsToggle,.mapTocEntry:focus-within .mapTocEntry__layerIcons,.mapTocEntry:hover .mapTocEntry__detailsToggle,.mapTocEntry:hover .mapTocEntry__layerIcons{animation:mapTocEntryBecomeVisible .15s cubic-bezier(.694,.0482,.335,1);display:block}.mapTocEntry-isInEditingMode{background-color:#103148!important;font-size:12px;font-weight:500}.mapTocEntry-isInEditingMode__row{align-items:center;display:inline-flex;margin-left:24px}.mapTocEntry-isInEditingMode__row>*{margin-right:4px}.mapTocEntry-isInEditingMode__editFeatureText{line-height:1;padding-right:4px}.mapTocEntry-isDragging{box-shadow:0 .9px 4px -1px #0003,0 2.6px 8px -1px #00000026,0 5.7px 12px -1px rgba(0,0,0,.125),0 15px 15px -1px #0000001a}.mapTocEntry-isDraggingOver{background-color:#1d1e24;pointer-events:none!important}.mapTocEntry-isCombineLayer{background-color:#7dded840;transition:background-color .5s ease}.mapTocEntry-isSelected{background-color:#2a2c34}.mapTocEntry-notVisible,.mapTocEntry-visible{display:flex}.mapLayTocActions{flex-grow:1;overflow:hidden}.mapLayTocActions__tooltipAnchor{max-width:100%}.mapTocEntry-notVisible .mapTocEntry__layerName{opacity:.5}.mapTocEntry__grab:hover{cursor:grab}.mapTocEntry__layerName{font-weight:500}.mapTocEntry__layerNameText{align-items:center;display:flex}.mapTocEntry__layerNameIcon{flex-shrink:0;margin-right:8px}.mapTocEntry__layerNameIcon>*{vertical-align:sub}.mapTocEntry__layerIcons{display:none;flex-shrink:0}.mapTocEntry__detailsToggle{display:none;left:50%;position:absolute;top:32px;transform:translateX(-50%)}.mapTocEntry__detailsToggleButton{background-color:#1d1e24;border:1px solid #343741;border-radius:3px;color:#dfe5ef;height:16px;line-height:16px;text-align:center;width:32px}.mapTocEntry__detailsToggleButton:focus{outline:2px solid currentColor}.mapTocEntry__detailsToggleButton:focus:focus-visible{outline-style:auto}.mapTocEntry__detailsToggleButton:focus:not(:focus-visible){outline:none}.mapTocEntry__layerDetails{background-color:#141519;margin:8px -8px -8px;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);padding:16px 8px 8px}@keyframes mapTocEntryBecomeVisible{0%{opacity:0}to{opacity:1}}.mapViewControl__coordinates{justify-content:center;pointer-events:none;text-shadow:0 0 2px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24,0 0 1px #1d1e24 0 0 1px #1d1e24 0 0 1px #1d1e24}.mapDrawControl__geometryFilterForm{padding:8px}.mapToolbarOverlay{left:12px;position:absolute;top:84px;z-index:2}.mapToolbarOverlay__button,.mapToolbarOverlay__buttonGroup{position:relative;transition:transform .25s ease-in-out,background .25s ease-in-out}.mapToolbarOverlay__button .mapToolbarOverlay__buttonIcon-empty,.mapToolbarOverlay__buttonGroup .mapToolbarOverlay__buttonIcon-empty{color:#dfe5ef!important}.mapToolbarOverlay__button:hover,.mapToolbarOverlay__buttonGroup:hover{transform:translateY(-1px)}.mapToolbarOverlay__button .euiButtonIcon:hover,.mapToolbarOverlay__buttonGroup .euiButtonIcon:hover{transform:translateY(0)}.mapToolbarOverlay__button .mapToolbarOverlay__buttonIcon-empty:focus:not(:hover),.mapToolbarOverlay__buttonGroup .mapToolbarOverlay__buttonIcon-empty:focus:not(:hover){background:none}.mapToolbarOverlay__buttonGroup{border-radius:4px;display:flex;flex-direction:column;overflow:hidden}.mapToolbarOverlay__buttonGroup .euiButtonIcon{border-radius:0}.mapToolbarOverlay__buttonGroupAnimated{animation:mapAnimationHeadShake 1.2s ease-in-out}.mapToolbarOverlay__button__exit .euiButtonIcon{color:#f86b63!important}.mapKeydownScrollZoom{align-content:center;background:#00000080;bottom:0;display:flex;flex-direction:column;justify-content:center;left:0;opacity:0;padding:16px;pointer-events:none;position:absolute;right:0;top:0;transition:opacity .25s ease .25s;z-index:2000}.mapKeydownScrollZoom--show{opacity:1;transition-duration:.15s}.mapFeatureTooltip_table{width:100%}.mapFeatureTooltip_table td{padding:4px}.mapFeatureTooltip_tableWrapper{max-height:calc(49vh - 64px);overflow:auto}.mapFeatureTooltip_row{border-bottom:1px solid #25262e}.mapFeatureTooltip_actionLinks{padding:4px}.mapFeatureTooltip_backButton{padding-left:0}.mapFeatureTooltip__propertyLabel{font-weight:600;max-width:128px;min-width:80px}.mapFeatureTooltip_actionsRow>span{display:flex;justify-content:flex-end}.mapFeatureTooltip_layerIcon img{margin-bottom:0}.mapScaleControl{border-bottom:2px solid #dfe5ef;border-left:2px solid #dfe5ef;bottom:12px;color:#dfe5ef;left:12px;pointer-events:none;position:absolute;text-align:right;z-index:1000}.mapScaleControlFullScreen{bottom:48px}.mapActionSelectIcon{margin-right:8px}.mapMetricEditorPanel{margin-bottom:8px}.mapMetricEditorPanel__metricEditor{border-top:1px solid #343741;padding:12px 0}.mapMetricEditorPanel__metricEditor:first-child{border-top:none;padding-top:0}.mapMetricEditorPanel__metricEditor:last-child{border-bottom:1px solid #343741;margin-bottom:12px}.mapMetricEditorPanel__metricRemoveButton{padding-top:12px;text-align:right}.mapGeometryFilter__geoFieldSuperSelect{height:48px}.mapGeometryFilter__geoFieldSuperSelectWrapper{height:72px}.mapGeometryFilter__geoFieldItem{padding:4px}.mapTooltipSelector__propertyRow{background-color:#1d1e24;border-bottom:1px solid #343741;display:flex;padding:4px 0}.mapTooltipSelector__propertyRow .mapTooltipSelector__propertyIcons:focus,.mapTooltipSelector__propertyRow .mapTooltipSelector__propertyIcons:hover,.mapTooltipSelector__propertyRow:focus .mapTooltipSelector__propertyIcons,.mapTooltipSelector__propertyRow:focus-within .mapTooltipSelector__propertyIcons,.mapTooltipSelector__propertyRow:hover .mapTooltipSelector__propertyIcons{animation:mapPropertyIconsBecomeVisible .15s cubic-bezier(.694,.0482,.335,1);display:block}.mapTooltipSelector__propertyRow-isDragging{box-shadow:0 .9px 4px -1px #0003,0 2.6px 8px -1px #00000026,0 5.7px 12px -1px rgba(0,0,0,.125),0 15px 15px -1px #0000001a}.mapTooltipSelector__propertyRow-isDraggingOver{pointer-events:none!important}.mapTooltipSelector__propertyContent{flex-grow:1;min-height:24px;overflow:hidden}.mapTooltipSelector__propertyIcons{display:none;flex-shrink:0}.mapTooltipSelector__grab:hover{cursor:grab}@keyframes mapPropertyIconsBecomeVisible{0%{opacity:0}to{opacity:1}}.mapColorGradient{bottom:0;height:4px;left:0;position:relative;right:0;top:0;width:100%}.mapFillableCircle{overflow:visible}.mapStyleFormDisabledTooltip{width:100%}.mapColorStop{position:relative}.mapColorStop+.mapColorStop{margin-top:8px}.mapIconSelectSymbol__inputButton{margin:0 4px}.mapsCustomIconPreview__mapContainer{height:150px}.mapsCustomIconForm{min-width:400px}.mapsCustomIconForm__preview{max-width:210px;min-height:210px}.mapLegendIconPreview{width:24px}.vectorStyleLegendSpacer:not(:last-child){margin-bottom:8px}.mapLayersWizardIcon{margin-top:8px}.mapLayersWizardIcon__highlight{fill:#fff}.mapLayersWizardIcon__background{fill:#535966}.mapLayersWizardIcon__backgroundDarker{fill:#98a2b3}@keyframes mapAnimationHeadShake{0%{transform:translateX(0)}6.5%{transform:translateX(-6px) rotateY(-9deg)}18.5%{transform:translateX(5px) rotateY(7deg)}31.5%{transform:translateX(-3px) rotateY(-5deg)}43.5%{transform:translateX(2px) rotateY(3deg)}50%{transform:translateX(0)}}@keyframes mapAnimationPulse{0%{transform:scaleX(1)}50%{transform:scale3d(1.005,1.005,1.005)}to{transform:scaleX(1)}}.mapEmbeddableContainer{display:flex;flex:1 1 100%;height:100%;min-height:0;width:100%;z-index:1}.mapEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}",""]),t.exports=e},597:function(t,e,n){var i=n(104),r=n(598);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},598:function(t,e,n){(e=n(105)(!1)).push([t.i,"#maps-plugin{display:flex;flex-direction:column;height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)));overflow:hidden;width:100%}.mapFullScreen{height:100vh!important}#react-maps-root{display:flex;flex-direction:column;flex-grow:1}.euiColorPicker__emptySwatch{position:relative}.mapContainer{flex-grow:1}.mapContainer .maplibregl-ctrl-top-left .maplibregl-ctrl{margin-left:12px;margin-top:12px}.mapContainer .maplibregl-ctrl-group:not(:empty){background-color:#fff;border-radius:4px;box-shadow:0 2.7px 9px #00000021,0 9.4px 24px #00000017,0 21.8px 43px #00000014;overflow:hidden;transition:transform .25s ease-in-out}.mapContainer .maplibregl-ctrl-group:not(:empty):hover{transform:translateY(-1px)}.mapContainer .maplibregl-ctrl-group:not(:empty)>button{height:32px;width:32px}.mapContainer .maplibregl-ctrl-group:not(:empty)>button+button{border:none}.mapContainer .maplibregl-ctrl button:not(:disabled){transition:background .25s ease-in-out}.mapContainer .maplibregl-ctrl button:not(:disabled):hover{background-color:#69707d1a}.mapContainer .maplibregl-ctrl-group button:focus:focus-visible{box-shadow:none}.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='15' height='15' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23343741' d='M8 7V3.5a.5.5 0 0 0-1 0V7H3.5a.5.5 0 0 0 0 1H7v3.5a.5.5 0 1 0 1 0V8h3.5a.5.5 0 1 0 0-1H8Zm-.5 8a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z'/%3E%3C/svg%3E\")!important;background-position:50%!important;background-repeat:no-repeat!important}.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='15' height='15' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23343741' d='M7.5 0C11.636 0 15 3.364 15 7.5S11.636 15 7.5 15 0 11.636 0 7.5 3.364 0 7.5 0Zm-4 7a.5.5 0 0 0 0 1h8a.5.5 0 1 0 0-1h-8Z'/%3E%3C/svg%3E\")!important;background-position:50%!important;background-repeat:no-repeat!important}.mapMapWrapper{position:relative}.mapMapLayerPanel{background-color:#fafbfd;overflow:hidden;width:0}.mapMapLayerPanel>*{width:480px}.mapMapLayerPanel-isVisible{transition:width .25s cubic-bezier(.694,.0482,.335,1);width:480px}.mapTimeslider{bottom:16px;left:calc(50% - 400px);position:absolute;z-index:99999}.mapTimeslider .controlFrame__formControlLayout{box-shadow:0 2.7px 9px #00000021,0 9.4px 24px #00000017,0 21.8px 43px #00000014}.mapTimeslider--animation{animation:mapAnimationPulse .6s ease-in-out}.mapLayerPanel__footer,.mapLayerPanel__header{padding:16px}.mapLayerPanel__body{flex-basis:1px;flex-grow:1;overflow-y:auto;padding-bottom:0;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mapLayerPanel__body::-webkit-scrollbar{height:16px;width:16px}.mapLayerPanel__body::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mapLayerPanel__body::-webkit-scrollbar-corner,.mapLayerPanel__body::-webkit-scrollbar-track{background-color:#0000}.mapLayerPanel__body .mapLayerPanel__bodyOverflow{padding:16px}.mapLayerPanel__body .mapLayerPanel__bodyOverflow>:last-child{margin-bottom:16px}.mapLayerPanel__sourceDetails{margin-left:32px}.mapLayerPanel__sourceDetail{margin-bottom:0!important}.mapLayerPanel__footer{border-top:1px solid #d3dae6}.mapAttributionFormRow{display:flex;margin:8px 0}.mapAttributionFormRow__legend{align-items:center;color:#1a1c21;display:inline-flex;font-size:12px;font-size:.8571428571rem;font-weight:600;height:32px;line-height:1.1428571429rem;margin-right:8px;overflow-wrap:break-word!important;width:calc(33% - 8px);word-break:break-word}.mapAttributionFormRow__field{width:67%}.mapAttributionFormRow__addButton{margin-top:4px}.mapAttributionFormRow__buttons{display:flex;justify-content:flex-end;margin-top:4px}.mapAttributionPopover{width:480px}.mapFilterEditor{overflow-y:visible;width:calc(95vw - 440px)}.mapJoinItem{background:#f8f9fb;border-radius:6px;margin-bottom:12px;padding:8px 4px;position:relative}.mapJoinItem .mapJoinItem__inner{overflow-x:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar{height:16px;width:16px}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-corner,.mapJoinItem .mapJoinItem__inner::-webkit-scrollbar-track{background-color:#0000}.mapJoinItem:focus .mapJoinItem__delete,.mapJoinItem:hover .mapJoinItem__delete{opacity:1;visibility:visible}.mapJoinItem__delete{background:#fff;box-shadow:0 .7px 1.4px #00000012,0 1.9px 4px #0000000d,0 4.5px 10px #0000000d;margin-right:-8px;margin-top:-12px;opacity:0;padding:4px;position:absolute;right:0;top:50%;visibility:hidden}.mapJoinExpressionHelpText{padding-bottom:8px;padding-top:0}.mapStyleSettings__fixedBox{width:120px}.mapWidgetOverlay{bottom:12px;left:0;pointer-events:none;position:absolute;right:12px;top:12px;z-index:1000}.mapWidgetOverlay__layerWrapper{align-items:flex-end;min-height:0;width:320px}.mapWidgetControl__headerFlexItem{flex-shrink:0}.mapWidgetControl{border-color:#0000!important;display:flex;flex-direction:column;max-height:100%;overflow:hidden;padding-bottom:8px;pointer-events:all;width:100%}.mapWidgetControl.mapWidgetControl-hasShadow{box-shadow:0 2.7px 9px #00000021,0 9.4px 24px #00000017,0 21.8px 43px #00000014}.mapWidgetControl__header{flex-shrink:0;padding:0 16px;text-transform:uppercase}.mapAttributionControl{overflow-wrap:break-word!important;padding-left:12px;pointer-events:all;text-shadow:0 0 2px #fff,0 0 1px #fff,0 0 1px #fff,0 0 1px #fff,0 0 1px #fff 0 0 1px #fff 0 0 1px #fff;word-break:break-word}.mapAttributionControl__fullScreen{margin-left:160px}.mapLayerControl{border-top:1px solid #f5f7fa;flex-basis:auto!important;overflow-y:auto;padding-bottom:9px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.mapLayerControl::-webkit-scrollbar{height:16px;width:16px}.mapLayerControl::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.mapLayerControl::-webkit-scrollbar-corner,.mapLayerControl::-webkit-scrollbar-track{background-color:#0000}.mapLayerControl__addLayerButton{flex-shrink:0}.mapLayerControl__addLayerButton.euiButton-isDisabled{background-color:#d3dae6!important}.mapLayerControl__addLayerButton,.mapLayerControl__openLayerTOCButton{pointer-events:all}.mapLayerControl__addLayerButton:enabled,.mapLayerControl__addLayerButton:enabled:focus,.mapLayerControl__addLayerButton:enabled:hover,.mapLayerControl__openLayerTOCButton:enabled,.mapLayerControl__openLayerTOCButton:enabled:focus,.mapLayerControl__openLayerTOCButton:enabled:hover{box-shadow:0 2.7px 9px #00000021,0 9.4px 24px #00000017,0 21.8px 43px #00000014}.mapLayerControl__closeLayerTOCButton,.mapLayerControl__openLayerTOCButton{background-color:#fff!important;height:32px;width:32px}.mapLayerToc-droppable-dropNotAllowed *{cursor:not-allowed!important}.mapLayerToc-droppable-isCombining *{cursor:alias!important}.mapLayerToc-droppable-isCombining{background-color:#fff!important}.mapLayerToc-droppable-isDragging *{cursor:ns-resize!important}.mapTocEntry{border-bottom:1px solid #f5f7fa;padding:8px;position:relative}.mapTocEntry:focus,.mapTocEntry:focus-within,.mapTocEntry:hover{z-index:2}.mapTocEntry .mapTocEntry__detailsToggle:focus,.mapTocEntry .mapTocEntry__detailsToggle:hover,.mapTocEntry .mapTocEntry__layerIcons:focus,.mapTocEntry .mapTocEntry__layerIcons:hover,.mapTocEntry:focus .mapTocEntry__detailsToggle,.mapTocEntry:focus .mapTocEntry__layerIcons,.mapTocEntry:focus-within .mapTocEntry__detailsToggle,.mapTocEntry:focus-within .mapTocEntry__layerIcons,.mapTocEntry:hover .mapTocEntry__detailsToggle,.mapTocEntry:hover .mapTocEntry__layerIcons{animation:mapTocEntryBecomeVisible .15s cubic-bezier(.694,.0482,.335,1);display:block}.mapTocEntry-isInEditingMode{background-color:#e6f1fa!important;font-size:12px;font-weight:500}.mapTocEntry-isInEditingMode__row{align-items:center;display:inline-flex;margin-left:24px}.mapTocEntry-isInEditingMode__row>*{margin-right:4px}.mapTocEntry-isInEditingMode__editFeatureText{line-height:1;padding-right:4px}.mapTocEntry-isDragging{box-shadow:0 .9px 4px -1px #00000014,0 2.6px 8px -1px #0000000f,0 5.7px 12px -1px #0000000d,0 15px 15px -1px #0000000a}.mapTocEntry-isDraggingOver{background-color:#fff;pointer-events:none!important}.mapTocEntry-isCombineLayer{background-color:#00bfb340;transition:background-color .5s ease}.mapTocEntry-isSelected{background-color:#edf0f5}.mapTocEntry-notVisible,.mapTocEntry-visible{display:flex}.mapLayTocActions{flex-grow:1;overflow:hidden}.mapLayTocActions__tooltipAnchor{max-width:100%}.mapTocEntry-notVisible .mapTocEntry__layerName{opacity:.5}.mapTocEntry__grab:hover{cursor:grab}.mapTocEntry__layerName{font-weight:500}.mapTocEntry__layerNameText{align-items:center;display:flex}.mapTocEntry__layerNameIcon{flex-shrink:0;margin-right:8px}.mapTocEntry__layerNameIcon>*{vertical-align:sub}.mapTocEntry__layerIcons{display:none;flex-shrink:0}.mapTocEntry__detailsToggle{display:none;left:50%;position:absolute;top:32px;transform:translateX(-50%)}.mapTocEntry__detailsToggleButton{background-color:#fff;border:1px solid #d3dae6;border-radius:3px;color:#343741;height:16px;line-height:16px;text-align:center;width:32px}.mapTocEntry__detailsToggleButton:focus{outline:2px solid currentColor}.mapTocEntry__detailsToggleButton:focus:focus-visible{outline-style:auto}.mapTocEntry__detailsToggleButton:focus:not(:focus-visible){outline:none}.mapTocEntry__layerDetails{background-color:#fafbfd;margin:8px -8px -8px;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);padding:16px 8px 8px}@keyframes mapTocEntryBecomeVisible{0%{opacity:0}to{opacity:1}}.mapViewControl__coordinates{justify-content:center;pointer-events:none;text-shadow:0 0 2px #fff,0 0 1px #fff,0 0 1px #fff,0 0 1px #fff,0 0 1px #fff 0 0 1px #fff 0 0 1px #fff}.mapDrawControl__geometryFilterForm{padding:8px}.mapToolbarOverlay{left:12px;position:absolute;top:84px;z-index:2}.mapToolbarOverlay__button,.mapToolbarOverlay__buttonGroup{position:relative;transition:transform .25s ease-in-out,background .25s ease-in-out}.mapToolbarOverlay__button .mapToolbarOverlay__buttonIcon-empty,.mapToolbarOverlay__buttonGroup .mapToolbarOverlay__buttonIcon-empty{color:#343741!important}.mapToolbarOverlay__button:hover,.mapToolbarOverlay__buttonGroup:hover{transform:translateY(-1px)}.mapToolbarOverlay__button .euiButtonIcon:hover,.mapToolbarOverlay__buttonGroup .euiButtonIcon:hover{transform:translateY(0)}.mapToolbarOverlay__button .mapToolbarOverlay__buttonIcon-empty:focus:not(:hover),.mapToolbarOverlay__buttonGroup .mapToolbarOverlay__buttonIcon-empty:focus:not(:hover){background:none}.mapToolbarOverlay__buttonGroup{border-radius:4px;display:flex;flex-direction:column;overflow:hidden}.mapToolbarOverlay__buttonGroup .euiButtonIcon{border-radius:0}.mapToolbarOverlay__buttonGroupAnimated{animation:mapAnimationHeadShake 1.2s ease-in-out}.mapToolbarOverlay__button__exit .euiButtonIcon{color:#bd271e!important}.mapKeydownScrollZoom{align-content:center;background:#00000080;bottom:0;display:flex;flex-direction:column;justify-content:center;left:0;opacity:0;padding:16px;pointer-events:none;position:absolute;right:0;top:0;transition:opacity .25s ease .25s;z-index:2000}.mapKeydownScrollZoom--show{opacity:1;transition-duration:.15s}.mapFeatureTooltip_table{width:100%}.mapFeatureTooltip_table td{padding:4px}.mapFeatureTooltip_tableWrapper{max-height:calc(49vh - 64px);overflow:auto}.mapFeatureTooltip_row{border-bottom:1px solid #f5f7fa}.mapFeatureTooltip_actionLinks{padding:4px}.mapFeatureTooltip_backButton{padding-left:0}.mapFeatureTooltip__propertyLabel{font-weight:600;max-width:128px;min-width:80px}.mapFeatureTooltip_actionsRow>span{display:flex;justify-content:flex-end}.mapFeatureTooltip_layerIcon img{margin-bottom:0}.mapScaleControl{border-bottom:2px solid #343741;border-left:2px solid #343741;bottom:12px;color:#343741;left:12px;pointer-events:none;position:absolute;text-align:right;z-index:1000}.mapScaleControlFullScreen{bottom:48px}.mapActionSelectIcon{margin-right:8px}.mapMetricEditorPanel{margin-bottom:8px}.mapMetricEditorPanel__metricEditor{border-top:1px solid #d3dae6;padding:12px 0}.mapMetricEditorPanel__metricEditor:first-child{border-top:none;padding-top:0}.mapMetricEditorPanel__metricEditor:last-child{border-bottom:1px solid #d3dae6;margin-bottom:12px}.mapMetricEditorPanel__metricRemoveButton{padding-top:12px;text-align:right}.mapGeometryFilter__geoFieldSuperSelect{height:48px}.mapGeometryFilter__geoFieldSuperSelectWrapper{height:72px}.mapGeometryFilter__geoFieldItem{padding:4px}.mapTooltipSelector__propertyRow{background-color:#fff;border-bottom:1px solid #d3dae6;display:flex;padding:4px 0}.mapTooltipSelector__propertyRow .mapTooltipSelector__propertyIcons:focus,.mapTooltipSelector__propertyRow .mapTooltipSelector__propertyIcons:hover,.mapTooltipSelector__propertyRow:focus .mapTooltipSelector__propertyIcons,.mapTooltipSelector__propertyRow:focus-within .mapTooltipSelector__propertyIcons,.mapTooltipSelector__propertyRow:hover .mapTooltipSelector__propertyIcons{animation:mapPropertyIconsBecomeVisible .15s cubic-bezier(.694,.0482,.335,1);display:block}.mapTooltipSelector__propertyRow-isDragging{box-shadow:0 .9px 4px -1px #00000014,0 2.6px 8px -1px #0000000f,0 5.7px 12px -1px #0000000d,0 15px 15px -1px #0000000a}.mapTooltipSelector__propertyRow-isDraggingOver{pointer-events:none!important}.mapTooltipSelector__propertyContent{flex-grow:1;min-height:24px;overflow:hidden}.mapTooltipSelector__propertyIcons{display:none;flex-shrink:0}.mapTooltipSelector__grab:hover{cursor:grab}@keyframes mapPropertyIconsBecomeVisible{0%{opacity:0}to{opacity:1}}.mapColorGradient{bottom:0;height:4px;left:0;position:relative;right:0;top:0;width:100%}.mapFillableCircle{overflow:visible}.mapStyleFormDisabledTooltip{width:100%}.mapColorStop{position:relative}.mapColorStop+.mapColorStop{margin-top:8px}.mapIconSelectSymbol__inputButton{margin:0 4px}.mapsCustomIconPreview__mapContainer{height:150px}.mapsCustomIconForm{min-width:400px}.mapsCustomIconForm__preview{max-width:210px;min-height:210px}.mapLegendIconPreview{width:24px}.vectorStyleLegendSpacer:not(:last-child){margin-bottom:8px}.mapLayersWizardIcon{margin-top:8px}.mapLayersWizardIcon__highlight{fill:#000}.mapLayersWizardIcon__background{fill:#d3dae6}.mapLayersWizardIcon__backgroundDarker{fill:#98a2b3}@keyframes mapAnimationHeadShake{0%{transform:translateX(0)}6.5%{transform:translateX(-6px) rotateY(-9deg)}18.5%{transform:translateX(5px) rotateY(7deg)}31.5%{transform:translateX(-3px) rotateY(-5deg)}43.5%{transform:translateX(2px) rotateY(3deg)}50%{transform:translateX(0)}}@keyframes mapAnimationPulse{0%{transform:scaleX(1)}50%{transform:scale3d(1.005,1.005,1.005)}to{transform:scaleX(1)}}.mapEmbeddableContainer{display:flex;flex:1 1 100%;height:100%;min-height:0;width:100%;z-index:1}.mapEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}",""]),t.exports=e},599:function(t,e,n){"use strict";function i(t){return!r(t)}function r(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(n);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(e=t&&t.failIfMajorPerformanceCaveat,void 0===s[e]&&(s[e]=function(t){var e,n=function(t){var e=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t);if(!n)return!1;try{e=n.createShader(n.VERTEX_SHADER)}catch(t){return!1}return!(!e||n.isContextLost())&&(n.shaderSource(e,"void main() {}"),n.compileShader(e),!0===n.getShaderParameter(e,n.COMPILE_STATUS))}(e)),s[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}e.supported=i,e.notSupportedReason=r;var s={};i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},600:function(t,e,n){(function(e){t.exports=function(){"use strict";var t=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},i={on:function(t,e,i){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:i})},render:function(t){e.store.featureChanged(t)}},r=function(t,r){for(var s=n[t],o=s.length;o--;){var a=s[o];if(a.selector(r)){a.fn.call(i,r)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(i),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){r("drag",t)},click:function(t){r("click",t)},mousemove:function(t){r("mousemove",t)},mousedown:function(t){r("mousedown",t)},mouseup:function(t){r("mouseup",t)},mouseout:function(t){r("mouseout",t)},keydown:function(t){r("keydown",t)},keyup:function(t){r("keyup",t)},touchstart:function(t){r("touchstart",t)},touchmove:function(t){r("touchmove",t)},touchend:function(t){r("touchend",t)},tap:function(t){r("tap",t)}}},n=6378137;function i(t){var e=0;if(t&&t.length>0){e+=Math.abs(r(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(r(t[n]))}return e}function r(t){var e,i,r,o,a,l,u=0,c=t.length;if(c>2){for(l=0;l<c;l++)l===c-2?(r=c-2,o=c-1,a=0):l===c-1?(r=c-1,o=0,a=1):(r=l,o=l+1,a=l+2),e=t[r],i=t[o],u+=(s(t[a][0])-s(e[0]))*Math.sin(s(i[1]));u=u*n*n/2}return u}function s(t){return t*Math.PI/180}var o=function t(e){var n,r=0;switch(e.type){case"Polygon":return i(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)r+=i(e.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)r+=t(e.geometries[n]);return r}},a="active",l="mapbox-gl-draw-hot",u="mapbox-gl-draw-cold",c="add",h="move",d="pointer",p="none",f={POLYGON:"polygon",LINE:"line_string",POINT:"point"},g="Feature",m="Polygon",_="LineString",y="Point",v="FeatureCollection",b="Multi",x={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},E="draw.create",S="draw.delete",C="draw.update",O="draw.selectionchange",I="draw.render",w="feature",L="midpoint",T="vertex",j="true",N="false",M=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],F={Point:0,LineString:1,Polygon:2};function P(t,e){var n=F[t.geometry.type]-F[e.geometry.type];return 0===n&&t.geometry.type===m?t.area-e.area:n}function R(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}R.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},R.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},R.prototype.has=function(t){return!("string"!=typeof t&&"number"!=typeof t||void 0===this._items[t]&&void 0===this._nums[t])},R.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},R.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var D=[w,L,T],A={click:function(t,e,n){return k(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return k(t,e,n,n.options.touchBuffer)}};function k(t,e,n,i){if(null===n.map)return[];var r=t?function(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}(t,i):e,s={};n.options.styles&&(s.layers=n.options.styles.map((function(t){return t.id})));var a=n.map.queryRenderedFeatures(r,s).filter((function(t){return-1!==D.indexOf(t.properties.meta)})),l=new R,u=[];return a.forEach((function(t){var e=t.properties.id;l.has(e)||(l.add(e),u.push(t))})),function(t){return t.map((function(t){return t.geometry.type===m&&(t.area=o({type:g,property:{},geometry:t.geometry})),t})).sort(P).map((function(t){return delete t.area,t}))}(u)}function G(t,e){var n=A.click(t,null,e),i={mouse:p};return n[0]&&(i.mouse=n[0].properties.active===j?h:d,i.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(i.mouse=c),e.ui.queueMapClasses(i),e.ui.updateMapClasses(),n[0]}function B(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function z(t,e,n){void 0===n&&(n={});var i=null!=n.fineTolerance?n.fineTolerance:4,r=null!=n.grossTolerance?n.grossTolerance:12,s=null!=n.interval?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var o=B(t.point,e.point);return o<i||o<r&&e.time-t.time<s}function q(t,e,n){void 0===n&&(n={});var i=null!=n.tolerance?n.tolerance:25,r=null!=n.interval?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,B(t.point,e.point)<i&&e.time-t.time<r}function V(t,e){return t(e={exports:{}},e.exports),e.exports}var U=V((function(t){var e=t.exports=function(t,n){if(n||(n=16),void 0===t&&(t=128),t<=0)return"0";for(var i=Math.log(Math.pow(2,t))/Math.log(n),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,t/r))/Math.log(n)*r;var s=i-Math.floor(i),o="";for(r=0;r<Math.floor(i);r++)o=Math.floor(Math.random()*n).toString(n)+o;if(s){var a=Math.pow(n,s);o=Math.floor(Math.random()*a).toString(n)+o}var l=parseInt(o,n);return l!==1/0&&l>=Math.pow(2,t)?e(t,n):o};e.rack=function(t,n,i){var r=function(r){var o=0;do{if(o++>10){if(!i)throw new Error("too many ID collisions, use more bits");t+=i}var a=e(t,n)}while(Object.hasOwnProperty.call(s,a));return s[a]=r,a},s=r.hats={};return r.get=function(t){return r.hats[t]},r.set=function(t,e){return r.hats[t]=e,r},r.bits=t||128,r.base=n||16,r}})),W=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||U(),this.type=e.geometry.type};W.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},W.prototype.incomingCoords=function(t){this.setCoordinates(t)},W.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},W.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},W.prototype.setProperty=function(t,e){this.properties[t]=e},W.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:g,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},W.prototype.internal=function(t){var e={id:this.id,meta:w,"meta:type":this.type,active:N,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:g,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Y=function(t,e){W.call(this,t,e)};(Y.prototype=Object.create(W.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},Y.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},Y.prototype.getCoordinate=function(){return this.getCoordinates()};var H=function(t,e){W.call(this,t,e)};(H.prototype=Object.create(W.prototype)).isValid=function(){return this.coordinates.length>1},H.prototype.addCoordinate=function(t,e,n){this.changed();var i=parseInt(t,10);this.coordinates.splice(i,0,[e,n])},H.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},H.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},H.prototype.updateCoordinate=function(t,e,n){var i=parseInt(t,10);this.coordinates[i]=[e,n],this.changed()};var J=function(t,e){W.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(J.prototype=Object.create(W.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},J.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},J.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},J.prototype.addCoordinate=function(t,e,n){this.changed();var i=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[i[0]].splice(i[1],0,[e,n])},J.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},J.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},J.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},J.prototype.updateCoordinate=function(t,e,n){this.changed();var i=t.split("."),r=parseInt(i[0],10),s=parseInt(i[1],10);void 0===this.coordinates[r]&&(this.coordinates[r]=[]),this.coordinates[r][s]=[e,n]};var X={MultiPoint:Y,MultiLineString:H,MultiPolygon:J},Z=function(t,e,n,i,r){var s=n.split("."),o=parseInt(s[0],10),a=s[1]?s.slice(1).join("."):null;return t[o][e](a,i,r)},Q=function(t,e){if(W.call(this,t,e),delete this.coordinates,this.model=X[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function K(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(Q.prototype=Object.create(W.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:U(),type:g,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},Q.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},Q.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},Q.prototype.getCoordinate=function(t){return Z(this.features,"getCoordinate",t)},Q.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===m?t.getCoordinates():t.coordinates}))))},Q.prototype.updateCoordinate=function(t,e,n){Z(this.features,"updateCoordinate",t,e,n),this.changed()},Q.prototype.addCoordinate=function(t,e,n){Z(this.features,"addCoordinate",t,e,n),this.changed()},Q.prototype.removeCoordinate=function(t){Z(this.features,"removeCoordinate",t),this.changed()},Q.prototype.getFeatures=function(){return this.features},K.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},K.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},K.prototype.getSelected=function(){return this._ctx.store.getSelected()},K.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},K.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},K.prototype.getFeature=function(t){return this._ctx.store.get(t)},K.prototype.select=function(t){return this._ctx.store.select(t)},K.prototype.deselect=function(t){return this._ctx.store.deselect(t)},K.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},K.prototype.addFeature=function(t){return this._ctx.store.add(t)},K.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},K.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},K.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},K.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},K.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},K.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},K.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return A[n](t,e,this._ctx)},K.prototype.newFeature=function(t){var e=t.geometry.type;return e===y?new Y(this._ctx,t):e===_?new H(this._ctx,t):e===m?new J(this._ctx,t):new Q(this._ctx,t)},K.prototype.isInstanceOf=function(t,e){if(t===y)return e instanceof Y;if(t===_)return e instanceof H;if(t===m)return e instanceof J;if("MultiFeature"===t)return e instanceof Q;throw new Error("Unknown feature class: "+t)},K.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},K.prototype.onSetup=function(){},K.prototype.onDrag=function(){},K.prototype.onClick=function(){},K.prototype.onMouseMove=function(){},K.prototype.onMouseDown=function(){},K.prototype.onMouseUp=function(){},K.prototype.onMouseOut=function(){},K.prototype.onKeyUp=function(){},K.prototype.onKeyDown=function(){},K.prototype.onTouchStart=function(){},K.prototype.onTouchMove=function(){},K.prototype.onTouchEnd=function(){},K.prototype.onTap=function(){},K.prototype.onStop=function(){},K.prototype.onTrash=function(){},K.prototype.onCombineFeature=function(){},K.prototype.onUncombineFeature=function(){},K.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var $={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},tt=Object.keys($);function et(t){return[].concat(t).filter((function(t){return void 0!==t}))}function nt(){var t=this;if(!t.ctx.map||void 0===t.ctx.map.getSource(l))return c();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],i=[];t.isDirty?i=t.getAllIds():(n=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),i=t.sources.hot.filter((function(e){return e.properties.id&&-1===n.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(t){return t.properties.id}))),t.sources.hot=[];var r=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===n.indexOf(e)}));var s=r!==t.sources.cold.length||i.length>0;function o(n,i){var r=t.get(n).internal(e);t.ctx.events.currentModeRender(r,(function(e){t.sources[i].push(e)}))}if(n.forEach((function(t){return o(t,"hot")})),i.forEach((function(t){return o(t,"cold")})),s&&t.ctx.map.getSource(u).setData({type:v,features:t.sources.cold}),t.ctx.map.getSource(l).setData({type:v,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(O,{features:t.getSelected().map((function(t){return t.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(t){return{type:g,properties:{},geometry:{type:y,coordinates:t.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var a=t._deletedFeaturesToEmit.map((function(t){return t.toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(S,{features:a})}function c(){t.isDirty=!1,t.clearChangedIds()}c(),t.ctx.map.fire(I,{})}function it(t){var e,n=this;this._features={},this._featureIds=new R,this._selectedFeatureIds=new R,this._selectedCoordinates=[],this._changedFeatureIds=new R,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame((function(){e=null,nt.call(n)})))},this.isDirty=!1}function rt(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}it.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},it.prototype.setDirty=function(){return this.isDirty=!0,this},it.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},it.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},it.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},it.prototype.getAllIds=function(){return this._featureIds.values()},it.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},it.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),et(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),rt(this,e),this},it.prototype.get=function(t){return this._features[t]},it.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},it.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),et(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},it.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),et(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),rt(this,e),this},it.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},it.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=et(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},it.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},it.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},it.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},it.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},it.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},it.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},it.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},it.prototype.storeMapConfig=function(){var t=this;M.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},it.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},it.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var st=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var i=t[n];for(var r in i)ot.call(i,r)&&(e[r]=i[r])}return e},ot=Object.prototype.hasOwnProperty,at=["mode","feature","mouse"];function lt(e){var n=null,i=null,r={onRemove:function(){return e.map.off("load",r.connect),clearInterval(i),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect:function(){e.map.off("load",r.connect),clearInterval(i),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(s){var o=s.fire;return s.fire=function(t,e){var n=arguments;return 1===o.length&&1!==arguments.length&&(n=[st({},{type:t},e)]),o.apply(s,n)},e.map=s,e.events=function(e){var n=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=function(t){var e=Object.keys(t);return function(n,i){void 0===i&&(i={});var r={},s=e.reduce((function(e,n){return e[n]=t[n],e}),new K(n));return{start:function(){var e=this;r=s.onSetup(i),tt.forEach((function(n){var i,o=$[n],a=function(){return!1};t[o]&&(a=function(){return!0}),e.on(n,a,(i=o,function(t){return s[i](r,t)}))}))},stop:function(){s.onStop(r)},trash:function(){s.onTrash(r)},combineFeatures:function(){s.onCombineFeatures(r)},uncombineFeatures:function(){s.onUncombineFeatures(r)},render:function(t,e){s.toDisplayFeatures(r,t,e)}}}}(e.options.modes[n]),t}),{}),i={},r={},s={},o=null,a=null;s.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:"drag"}),a.drag(t)):t.originalEvent.stopPropagation()},s.mousedrag=function(t){s.drag(t,(function(t){return!z(i,t)}))},s.touchdrag=function(t){s.drag(t,(function(t){return!q(r,t)}))},s.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return s.mousedrag(t);var n=G(t,e);t.featureTarget=n,a.mousemove(t)},s.mousedown=function(t){i={time:(new Date).getTime(),point:t.point};var n=G(t,e);t.featureTarget=n,a.mousedown(t)},s.mouseup=function(t){var n=G(t,e);t.featureTarget=n,z(i,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},s.mouseout=function(t){a.mouseout(t)},s.touchstart=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){r={time:(new Date).getTime(),point:t.point};var n=A.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)}},s.touchmove=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled)return a.touchmove(t),s.touchdrag(t)},s.touchend=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){var n=A.touch(t,null,e)[0];t.featureTarget=n,q(r,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)}};var l=function(t){return!(8===t||46===t||t>=48&&t<=57)};function u(i,r,s){void 0===s&&(s={}),a.stop();var l=n[i];if(void 0===l)throw new Error(i+" is not valid");o=i;var u=l(e,r);a=t(u,e),s.silent||e.map.fire("draw.modechange",{mode:i}),e.store.setDirty(),e.store.render()}s.keydown=function(t){"mapboxgl-canvas"===(t.srcElement||t.target).classList[0]&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?l(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?u(x.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?u(x.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&u(x.DRAW_POLYGON):(t.preventDefault(),a.trash()))},s.keyup=function(t){l(t.keyCode)&&a.keyup(t)},s.zoomend=function(){e.store.changeZoom()},s.data=function(t){if("style"===t.dataType){var n=e.setup,i=e.map,r=e.options,s=e.store;r.styles.some((function(t){return i.getLayer(t.id)}))||(n.addLayers(),s.setDirty(),s.render())}};var c={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){o=e.options.defaultMode,a=t(n[o](e),e)},changeMode:u,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===c[e])throw new Error("Invalid action type");c[e]!==t[e]&&(n=!0),c[e]=t[e]})),n&&e.map.fire("draw.actionable",{actions:c})},currentModeName:function(){return o},currentModeRender:function(t,e){return a.render(t,e)},fire:function(t,e){s[t]&&s[t](e)},addEventListeners:function(){e.map.on("mousemove",s.mousemove),e.map.on("mousedown",s.mousedown),e.map.on("mouseup",s.mouseup),e.map.on("data",s.data),e.map.on("touchmove",s.touchmove),e.map.on("touchstart",s.touchstart),e.map.on("touchend",s.touchend),e.container.addEventListener("mouseout",s.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",s.keydown),e.container.addEventListener("keyup",s.keyup))},removeEventListeners:function(){e.map.off("mousemove",s.mousemove),e.map.off("mousedown",s.mousedown),e.map.off("mouseup",s.mouseup),e.map.off("data",s.data),e.map.off("touchmove",s.touchmove),e.map.off("touchstart",s.touchstart),e.map.off("touchend",s.touchend),e.container.removeEventListener("mouseout",s.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",s.keydown),e.container.removeEventListener("keyup",s.keyup))},trash:function(t){a.trash(t)},combineFeatures:function(){a.combineFeatures()},uncombineFeatures:function(){a.uncombineFeatures()},getMode:function(){return o}}}(e),e.ui=function(t){var e={},n=null,i={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function s(t){r=st(r,t)}function o(){var e,n;if(t.container){var s=[],o=[];at.forEach((function(t){r[t]!==i[t]&&(s.push(t+"-"+i[t]),null!==r[t]&&o.push(t+"-"+r[t]))})),s.length>0&&(e=t.container.classList).remove.apply(e,s),o.length>0&&(n=t.container.classList).add.apply(n,o),i=st(i,r)}}function l(t,e){void 0===e&&(e={});var i=document.createElement("button");return i.className="mapbox-gl-draw_ctrl-draw-btn "+e.className,i.setAttribute("title",e.title),e.container.appendChild(i),i.addEventListener("click",(function(i){if(i.preventDefault(),i.stopPropagation(),i.target===n)return u(),void e.onDeactivate();c(t),e.onActivate()}),!0),i}function u(){n&&(n.classList.remove(a),n=null)}function c(t){u();var i=e[t];i&&i&&"trash"!==t&&(i.classList.add(a),n=i)}return{setActiveButton:c,queueMapClasses:s,updateMapClasses:o,clearMapClasses:function(){s({mode:null,feature:null,mouse:null}),o()},addButtons:function(){var n=t.options.controls,i=document.createElement("div");return i.className="mapboxgl-ctrl-group mapboxgl-ctrl",n?(n[f.LINE]&&(e[f.LINE]=l(f.LINE,{container:i,className:"mapbox-gl-draw_line",title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(x.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[f.POLYGON]&&(e[f.POLYGON]=l(f.POLYGON,{container:i,className:"mapbox-gl-draw_polygon",title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(x.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[f.POINT]&&(e[f.POINT]=l(f.POINT,{container:i,className:"mapbox-gl-draw_point",title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(x.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=l("trash",{container:i,className:"mapbox-gl-draw_trash",title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=l("combineFeatures",{container:i,className:"mapbox-gl-draw_combine",title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=l("uncombineFeatures",{container:i,className:"mapbox-gl-draw_uncombine",title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),i):i},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))}}}(e),e.container=s.getContainer(),e.store=new it(e),n=e.ui.addButtons(),e.options.boxSelect&&(s.boxZoom.disable(),s.dragPan.disable(),s.dragPan.enable()),s.loaded()?r.connect():(s.on("load",r.connect),i=setInterval((function(){s.loaded()&&r.connect()}),16)),e.events.start(),n},addLayers:function(){e.map.addSource(u,{data:{type:v,features:[]},type:"geojson"}),e.map.addSource(l,{data:{type:v,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(u)&&e.map.removeSource(u),e.map.getSource(l)&&e.map.removeSource(l)}};return e.setup=r,r}function ut(t){return function(e){var n=e.featureTarget;return!!n&&!!n.properties&&n.properties.meta===t}}function ct(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===j&&t.featureTarget.properties.meta===w}function ht(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.active===N&&t.featureTarget.properties.meta===w}function dt(t){return void 0===t.featureTarget}function pt(t){var e=t.featureTarget;return!!e&&!!e.properties&&e.properties.meta===T}function ft(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function gt(t){return 27===t.keyCode}function mt(t){return 13===t.keyCode}var _t=yt;function yt(t,e){this.x=t,this.y=e}function vt(t,e){var n=e.getBoundingClientRect();return new _t(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function bt(t,e,n,i){return{type:g,properties:{meta:T,parent:t,coord_path:n,active:i?j:N},geometry:{type:y,coordinates:e}}}function xt(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var i,r=t.geometry,s=r.type,o=r.coordinates,a=t.properties&&t.properties.id,l=[];function u(t,n){var i="",r=null;t.forEach((function(t,s){var o=null!=n?n+"."+s:String(s),u=bt(a,t,o,c(o));if(e.midpoints&&r){var h=function(t,e,n){var i=e.geometry.coordinates,r=n.geometry.coordinates;if(i[1]>85||i[1]<-85||r[1]>85||r[1]<-85)return null;var s={lng:(i[0]+r[0])/2,lat:(i[1]+r[1])/2};return{type:g,properties:{meta:L,parent:t,lng:s.lng,lat:s.lat,coord_path:n.properties.coord_path},geometry:{type:y,coordinates:[s.lng,s.lat]}}}(a,r,u);h&&l.push(h)}r=u;var d=JSON.stringify(t);i!==d&&l.push(u),0===s&&(i=d)}))}function c(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return s===y?l.push(bt(a,o,n,c(n))):s===m?o.forEach((function(t,e){u(t,null!==n?n+"."+e:String(e))})):s===_?u(o,n):0===s.indexOf(b)&&(i=s.replace(b,""),o.forEach((function(n,r){var s={type:g,properties:t.properties,geometry:{type:i,coordinates:n}};l=l.concat(xt(s,e,r))}))),l}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=i,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x+n*(this.x-e.x)-i*(this.y-e.y),s=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(t){return t instanceof yt?t:Array.isArray(t)?new yt(t[0],t[1]):t};var Et=function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},St=function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)},Ct=function(t){if(!t||!t.type)return null;var e=Ot[t.type];return e?"geometry"===e?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]}:"feature"===e?{type:"FeatureCollection",features:[t]}:"featurecollection"===e?t:void 0:null},Ot={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function It(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce((function(t,e){return t.concat(It(e))}),[]),t;case"Feature":return t.geometry?It(t.geometry).map((function(e){var n={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(n.id=t.id),n})):[t];case"MultiPoint":return t.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return t.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return t.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return t.geometries.map(It).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[t]}}var wt=V((function(t){var e=t.exports=function(t){return new n(t)};function n(t){this.value=t}function i(t,e,n){var i=[],o=[],c=!0;return function t(h){var d=n?r(h):h,p={},f=!0,g={node:d,node_:h,path:[].concat(i),parent:o[o.length-1],parents:o,key:i.slice(-1)[0],isRoot:0===i.length,level:i.length,circular:null,update:function(t,e){g.isRoot||(g.parent.node[g.key]=t),g.node=t,e&&(f=!1)},delete:function(t){delete g.parent.node[g.key],t&&(f=!1)},remove:function(t){a(g.parent.node)?g.parent.node.splice(g.key,1):delete g.parent.node[g.key],t&&(f=!1)},keys:null,before:function(t){p.before=t},after:function(t){p.after=t},pre:function(t){p.pre=t},post:function(t){p.post=t},stop:function(){c=!1},block:function(){f=!1}};if(!c)return g;function m(){if("object"==typeof g.node&&null!==g.node){g.keys&&g.node_===g.node||(g.keys=s(g.node)),g.isLeaf=0==g.keys.length;for(var t=0;t<o.length;t++)if(o[t].node_===h){g.circular=o[t];break}}else g.isLeaf=!0,g.keys=null;g.notLeaf=!g.isLeaf,g.notRoot=!g.isRoot}m();var _=e.call(g,g.node);return void 0!==_&&g.update&&g.update(_),p.before&&p.before.call(g,g.node),f?("object"!=typeof g.node||null===g.node||g.circular||(o.push(g),m(),l(g.keys,(function(e,r){i.push(e),p.pre&&p.pre.call(g,g.node[e],e);var s=t(g.node[e]);n&&u.call(g.node,e)&&(g.node[e]=s.node),s.isLast=r==g.keys.length-1,s.isFirst=0==r,p.post&&p.post.call(g,s),i.pop()})),o.pop()),p.after&&p.after.call(g,g.node),g):g}(t).node}function r(t){if("object"==typeof t&&null!==t){var e;if(a(t))e=[];else if("[object Date]"===o(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===o(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===o(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===o(t)}(t))e=new Boolean(t);else if(function(t){return"[object Number]"===o(t)}(t))e=new Number(t);else if(function(t){return"[object String]"===o(t)}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},i=function(){};i.prototype=n,e=new i}return l(s(t),(function(n){e[n]=t[n]})),e}return t}n.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var i=t[n];if(!e||!u.call(e,i)){e=void 0;break}e=e[i]}return e},n.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var i=t[n];if(!e||!u.call(e,i))return!1;e=e[i]}return!0},n.prototype.set=function(t,e){for(var n=this.value,i=0;i<t.length-1;i++){var r=t[i];u.call(n,r)||(n[r]={}),n=n[r]}return n[t[i]]=e,e},n.prototype.map=function(t){return i(this.value,t,!0)},n.prototype.forEach=function(t){return this.value=i(this.value,t,!1),this.value},n.prototype.reduce=function(t,e){var n=1===arguments.length,i=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(i=t.call(this,i,e))})),i},n.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},n.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},n.prototype.clone=function(){var t=[],e=[];return function n(i){for(var o=0;o<t.length;o++)if(t[o]===i)return e[o];if("object"==typeof i&&null!==i){var a=r(i);return t.push(i),e.push(a),l(s(i),(function(t){a[t]=n(i[t])})),t.pop(),e.pop(),a}return i}(this.value)};var s=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function o(t){return Object.prototype.toString.call(t)}var a=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},l=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};l(s(n.prototype),(function(t){e[t]=function(e){var i=[].slice.call(arguments,1),r=new n(e);return r[t].apply(r,i)}}));var u=Object.hasOwnProperty||function(t,e){return e in t}})),Lt=Tt;function Tt(t){if(!(this instanceof Tt))return new Tt(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Tt.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Tt.prototype.equals=function(t){var e;return e=t instanceof Tt?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Tt.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Tt.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Tt?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Tt.prototype.bbox=function(){return this._valid?this._bbox:null},Tt.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Tt.prototype.intersect=function(t){return this._valid?(e=t instanceof Tt?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Tt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Tt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var jt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Nt=Object.keys(jt),Mt=function(t){return Ft(t).bbox()};function Ft(t){for(var e=Lt(),n=function(t){if(!t)return[];var e=It(Ct(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(function t(e){return Array.isArray(e)&&e.length&&"number"==typeof e[0]?[e]:e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t.geometry.coordinates)))})),n}(t),i=0;i<n.length;i++)e.include(n[i]);return e}function Pt(t,e){var n=-90,i=90,r=-90,s=90,o=270,a=-270;t.forEach((function(t){var e=Mt(t),l=e[1],u=e[3],c=e[0],h=e[2];l>n&&(n=l),u<i&&(i=u),u>r&&(r=u),l<s&&(s=l),c<o&&(o=c),h>a&&(a=h)}));var l=e;return n+l.lat>85&&(l.lat=85-n),r+l.lat>90&&(l.lat=90-r),i+l.lat<-85&&(l.lat=-85-i),s+l.lat<-90&&(l.lat=-90-s),o+l.lng<=-270&&(l.lng+=360*Math.ceil(Math.abs(l.lng)/360)),a+l.lng>=270&&(l.lng-=360*Math.ceil(Math.abs(l.lng)/360)),l}function Rt(t,e){var n=Pt(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,i=t.getCoordinates(),r=function(t){var e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},s=function(t){return t.map((function(t){return r(t)}))};t.type===y?e=r(i):t.type===_||"MultiPoint"===t.type?e=i.map(r):t.type===m||"MultiLineString"===t.type?e=i.map(s):"MultiPolygon"===t.type&&(e=i.map((function(t){return t.map((function(t){return s(t)}))}))),t.incomingCoords(e)}))}Mt.polygon=function(t){return Ft(t).polygon()},Mt.bboxify=function(t){return wt(t).map((function(t){t&&Nt.some((function(e){return!!t[e]&&-1!==jt[e].indexOf(t.type)}))&&(t.bbox=Ft(t).bbox(),this.update(t))}))};var Dt={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(C,{action:"move",features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),i=!1;if(e.length>1){i=!0;var r=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==r&&(i=!1)}))}var s=n.length>0,o=e.length>0;this.setActionableState({combineFeatures:i,uncombineFeatures:s,trash:o})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new R).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){Et(this)},onMouseMove:function(t){return this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};Dt.onTap=Dt.onClick=function(t,e){return dt(e)?this.clickAnywhere(t,e):ut(T)(e)?this.clickOnVertex(t,e):function(t){return!!t.featureTarget&&!!t.featureTarget.properties&&t.featureTarget.properties.meta===w}(e)?this.clickOnFeature(t,e):void 0},Dt.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),Et(this),this.stopExtendedInteractions(t)},Dt.clickOnVertex=function(t,e){this.changeMode(x.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:h})},Dt.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},Dt.clickOnFeature=function(t,e){var n=this;St(this),this.stopExtendedInteractions(t);var i=ft(e),r=this.getSelectedIds(),s=e.featureTarget.properties.id,o=this.isSelected(s);if(!i&&o&&this.getFeature(s).type!==y)return this.changeMode(x.DIRECT_SELECT,{featureId:s});o&&i?(this.deselect(s),this.updateUIClasses({mouse:d}),1===r.length&&Et(this)):!o&&i?(this.select(s),this.updateUIClasses({mouse:h})):o||i||(r.forEach((function(t){return n.doRender(t)})),this.setSelected(s),this.updateUIClasses({mouse:h})),this.doRender(s)},Dt.onMouseDown=function(t,e){return ct(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&function(t){return!!t.originalEvent&&!!t.originalEvent.shiftKey&&0===t.originalEvent.button}(e)?this.startBoxSelect(t,e):void 0},Dt.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=vt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},Dt.onTouchStart=function(t,e){if(ct(e))return this.startOnActiveFeature(t,e)},Dt.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},Dt.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:c}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add("mapbox-gl-draw_boxselect"),this.map.getContainer().appendChild(t.boxSelectElement));var n=vt(e.originalEvent,this.map.getContainer()),i=Math.min(t.boxSelectStartLocation.x,n.x),r=Math.max(t.boxSelectStartLocation.x,n.x),s=Math.min(t.boxSelectStartLocation.y,n.y),o=Math.max(t.boxSelectStartLocation.y,n.y),a="translate("+i+"px, "+s+"px)";t.boxSelectElement.style.transform=a,t.boxSelectElement.style.WebkitTransform=a,t.boxSelectElement.style.width=r-i+"px",t.boxSelectElement.style.height=o-s+"px"},Dt.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Rt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},Dt.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var i=[t.boxSelectStartLocation,vt(e.originalEvent,this.map.getContainer())],r=this.featuresAt(null,i,"click"),s=this.getUniqueIds(r).filter((function(t){return!n.isSelected(t)}));s.length&&(this.select(s),s.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:h}))}this.stopExtendedInteractions(t)},Dt.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?j:N,n(e),this.fireActionable(),e.properties.active===j&&e.geometry.type!==y&&xt(e).forEach(n)},Dt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Dt.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],i=t[0].type.replace("Multi",""),r=0;r<t.length;r++){var s=t[r];if(s.type.replace("Multi","")!==i)return;s.type.includes("Multi")?s.getCoordinates().forEach((function(t){e.push(t)})):e.push(s.getCoordinates()),n.push(s.toGeoJSON())}if(n.length>1){var o=this.newFeature({type:g,properties:n[0].properties,geometry:{type:"Multi"+i,coordinates:e}});this.addFeature(o),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([o.id]),this.map.fire("draw.combine",{createdFeatures:[o.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},Dt.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],i=[],r=function(r){var s=e[r];t.isInstanceOf("MultiFeature",s)&&(s.getFeatures().forEach((function(e){t.addFeature(e),e.properties=s.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(s.id,{silent:!0}),i.push(s.toGeoJSON()))},s=0;s<e.length;s++)r(s);n.length>1&&this.map.fire("draw.uncombine",{createdFeatures:n,deletedFeatures:i}),this.fireActionable()}};var At=ut(T),kt=ut(L),Gt={fireUpdate:function(){this.map.fire(C,{action:"change_coordinates",features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,i=t.selectedCoordPaths.indexOf(n.coord_path);ft(e)||-1!==i?ft(e)&&-1===i&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var r=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Rt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var i=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),r=Pt(i.map((function(t){return{type:g,properties:{},geometry:{type:y,coordinates:t}}})),n),s=0;s<i.length;s++){var o=i[s];t.feature.updateCoordinate(t.selectedCoordPaths[s],o[0]+r.lng,o[1]+r.lat)}},clickNoTarget:function(){this.changeMode(x.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(x.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===y)throw new TypeError("direct_select mode doesn't handle point features");var i={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,i.selectedCoordPaths)),this.setSelected(e),St(this),this.setActionableState({trash:!0}),i},onStop:function(){Et(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=j,n(e),xt(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=N,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(x.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=ct(e),i=At(e),r=0===t.selectedCoordPaths.length;return n&&r||i&&!r?this.updateUIClasses({mouse:h}):this.updateUIClasses({mouse:p}),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};Gt.onTouchStart=Gt.onMouseDown=function(t,e){return At(e)?this.onVertex(t,e):ct(e)?this.onFeature(t,e):kt(e)?this.onMidpoint(t,e):void 0},Gt.onDrag=function(t,e){if(!0===t.canDragMove){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},Gt.onClick=function(t,e){return dt(e)?this.clickNoTarget(t,e):ct(e)?this.clickActiveFeature(t,e):ht(e)?this.clickInactive(t,e):void this.stopDragging(t)},Gt.onTap=function(t,e){return dt(e)?this.clickNoTarget(t,e):ct(e)?this.clickActiveFeature(t,e):ht(e)?this.clickInactive(t,e):void 0},Gt.onTouchEnd=Gt.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var Bt={};function zt(t,e){return!!t.lngLat&&t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]}Bt.onSetup=function(){var t=this.newFeature({type:g,properties:{},geometry:{type:y,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:c}),this.activateUIButton(f.POINT),this.setActionableState({trash:!0}),{point:t}},Bt.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)},Bt.onTap=Bt.onClick=function(t,e){this.updateUIClasses({mouse:h}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(E,{features:[t.point.toGeoJSON()]}),this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.point.id]})},Bt.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},Bt.toDisplayFeatures=function(t,e,n){var i=e.properties.id===t.point.id;if(e.properties.active=i?j:N,!i)return n(e)},Bt.onTrash=Bt.stopDrawingAndRemove,Bt.onKeyUp=function(t,e){if(gt(e)||mt(e))return this.stopDrawingAndRemove(t,e)};var qt={onSetup:function(){var t=this.newFeature({type:g,properties:{},geometry:{type:m,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),St(this),this.updateUIClasses({mouse:c}),this.activateUIButton(f.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&zt(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:c}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),pt(e)&&this.updateUIClasses({mouse:d})}};qt.onTap=qt.onClick=function(t,e){return pt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},qt.onKeyUp=function(t,e){gt(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)):mt(e)&&this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},qt.onStop=function(t){this.updateUIClasses({mouse:p}),Et(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(E,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT,{},{silent:!0})))},qt.toDisplayFeatures=function(t,e,n){var i=e.properties.id===t.polygon.id;if(e.properties.active=i?j:N,!i)return n(e);if(0!==e.geometry.coordinates.length){var r=e.geometry.coordinates[0].length;if(!(r<3)){if(e.properties.meta=w,n(bt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),r>3){var s=e.geometry.coordinates[0].length-3;n(bt(t.polygon.id,e.geometry.coordinates[0][s],"0."+s,!1))}if(r<=4){var o=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:g,properties:e.properties,geometry:{coordinates:o,type:_}}),3===r)return}return n(e)}}},qt.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)};var Vt={onSetup:function(t){var e,n,i=(t=t||{}).featureId,r="forward";if(i){if(!(e=this.getFeature(i)))throw new Error("Could not find a feature with the provided featureId");var s=t.from;if(s&&"Feature"===s.type&&s.geometry&&"Point"===s.geometry.type&&(s=s.geometry),s&&"Point"===s.type&&s.coordinates&&2===s.coordinates.length&&(s=s.coordinates),!s||!Array.isArray(s))throw new Error("Please use the `from` property to indicate which point to continue the line from");var o=e.coordinates.length-1;if(e.coordinates[o][0]===s[0]&&e.coordinates[o][1]===s[1])n=o+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[o]));else{if(e.coordinates[0][0]!==s[0]||e.coordinates[0][1]!==s[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:g,properties:{},geometry:{type:_,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),St(this),this.updateUIClasses({mouse:c}),this.activateUIButton(f.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:r}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&zt(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&zt(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:c}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),pt(e)&&this.updateUIClasses({mouse:d})}};Vt.onTap=Vt.onClick=function(t,e){if(pt(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Vt.onKeyUp=function(t,e){mt(e)?this.changeMode(x.SIMPLE_SELECT,{featureIds:[t.line.id]}):gt(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT))},Vt.onStop=function(t){Et(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(E,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT,{},{silent:!0})))},Vt.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(x.SIMPLE_SELECT)},Vt.toDisplayFeatures=function(t,e,n){var i=e.properties.id===t.line.id;if(e.properties.active=i?j:N,!i)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=w,n(bt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var Ut={simple_select:Dt,direct_select:Gt,draw_point:Bt,draw_polygon:qt,draw_line_string:Vt},Wt={defaultMode:x.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Ut,controls:{},userProperties:!1},Yt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Ht={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Jt(t,e){return t.map((function(t){return t.source?t:st(t,{id:t.id+"."+e,source:"hot"===e?l:u})}))}var Xt=V((function(t,n){var i="[object Arguments]",r="[object Map]",s="[object Object]",o="[object Set]",a=/^\[object .+?Constructor\]$/,l=/^(?:0|[1-9]\d*)$/,u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u[i]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u[r]=u["[object Number]"]=u[s]=u["[object RegExp]"]=u[o]=u["[object String]"]=u["[object WeakMap]"]=!1;var c="object"==typeof e&&e&&e.Object===Object&&e,h="object"==typeof self&&self&&self.Object===Object&&self,d=c||h||Function("return this")(),p=n&&!n.nodeType&&n,f=p&&t&&!t.nodeType&&t,g=f&&f.exports===p,m=g&&c.process,_=function(){try{return m&&m.binding&&m.binding("util")}catch(t){}}(),y=_&&_.isTypedArray;function v(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function b(t){var e=-1,n=Array(t.size);return t.forEach((function(t,i){n[++e]=[i,t]})),n}function x(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var E,S,C,O=Array.prototype,I=Function.prototype,w=Object.prototype,L=d["__core-js_shared__"],T=I.toString,j=w.hasOwnProperty,N=(E=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"",M=w.toString,F=RegExp("^"+T.call(j).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),P=g?d.Buffer:void 0,R=d.Symbol,D=d.Uint8Array,A=w.propertyIsEnumerable,k=O.splice,G=R?R.toStringTag:void 0,B=Object.getOwnPropertySymbols,z=P?P.isBuffer:void 0,q=(S=Object.keys,C=Object,function(t){return S(C(t))}),V=ft(d,"DataView"),U=ft(d,"Map"),W=ft(d,"Promise"),Y=ft(d,"Set"),H=ft(d,"WeakMap"),J=ft(Object,"create"),X=yt(V),Z=yt(U),Q=yt(W),K=yt(Y),$=yt(H),tt=R?R.prototype:void 0,et=tt?tt.valueOf:void 0;function nt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function it(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function rt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function st(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new rt;++e<n;)this.add(t[e])}function ot(t){var e=this.__data__=new it(t);this.size=e.size}function at(t,e){for(var n=t.length;n--;)if(vt(t[n][0],e))return n;return-1}function lt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":G&&G in Object(t)?function(t){var e=j.call(t,G),n=t[G];try{t[G]=void 0;var i=!0}catch(t){}var r=M.call(t);return i&&(e?t[G]=n:delete t[G]),r}(t):function(t){return M.call(t)}(t)}function ut(t){return It(t)&&lt(t)==i}function ct(t,e,n,a,l){return t===e||(null==t||null==e||!It(t)&&!It(e)?t!=t&&e!=e:function(t,e,n,a,l,u){var c=xt(t),h=xt(e),d=c?"[object Array]":mt(t),p=h?"[object Array]":mt(e),f=(d=d==i?s:d)==s,g=(p=p==i?s:p)==s,m=d==p;if(m&&Et(t)){if(!Et(e))return!1;c=!0,f=!1}if(m&&!f)return u||(u=new ot),c||wt(t)?ht(t,e,n,a,l,u):function(t,e,n,i,s,a,l){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new D(t),new D(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return vt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case r:var u=b;case o:var c=1&i;if(u||(u=x),t.size!=e.size&&!c)return!1;var h=l.get(t);if(h)return h==e;i|=2,l.set(t,e);var d=ht(u(t),u(e),i,s,a,l);return l.delete(t),d;case"[object Symbol]":if(et)return et.call(t)==et.call(e)}return!1}(t,e,d,n,a,l,u);if(!(1&n)){var _=f&&j.call(t,"__wrapped__"),y=g&&j.call(e,"__wrapped__");if(_||y){var v=_?t.value():t,E=y?e.value():e;return u||(u=new ot),l(v,E,n,a,u)}}return!!m&&(u||(u=new ot),function(t,e,n,i,r,s){var o=1&n,a=dt(t),l=a.length;if(l!=dt(e).length&&!o)return!1;for(var u=l;u--;){var c=a[u];if(!(o?c in e:j.call(e,c)))return!1}var h=s.get(t);if(h&&s.get(e))return h==e;var d=!0;s.set(t,e),s.set(e,t);for(var p=o;++u<l;){var f=t[c=a[u]],g=e[c];if(i)var m=o?i(g,f,c,e,t,s):i(f,g,c,t,e,s);if(!(void 0===m?f===g||r(f,g,n,i,s):m)){d=!1;break}p||(p="constructor"==c)}if(d&&!p){var _=t.constructor,y=e.constructor;_==y||!("constructor"in t)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(d=!1)}return s.delete(t),s.delete(e),d}(t,e,n,a,l,u))}(t,e,n,a,ct,l))}function ht(t,e,n,i,r,s){var o=1&n,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var u=s.get(t);if(u&&s.get(e))return u==e;var c=-1,h=!0,d=2&n?new st:void 0;for(s.set(t,e),s.set(e,t);++c<a;){var p=t[c],f=e[c];if(i)var g=o?i(f,p,c,e,t,s):i(p,f,c,t,e,s);if(void 0!==g){if(g)continue;h=!1;break}if(d){if(!v(e,(function(t,e){if(o=e,!d.has(o)&&(p===t||r(p,t,n,i,s)))return d.push(e);var o}))){h=!1;break}}else if(p!==f&&!r(p,f,n,i,s)){h=!1;break}}return s.delete(t),s.delete(e),h}function dt(t){return function(t,e,n){var i=e(t);return xt(t)?i:function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}(i,n(t))}(t,Lt,gt)}function pt(t,e){var n,i,r=t.__data__;return("string"==(i=typeof(n=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function ft(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Ot(t)||function(t){return!!N&&N in t}(t))&&(St(t)?F:a).test(yt(t))}(n)?n:void 0}nt.prototype.clear=function(){this.__data__=J?J(null):{},this.size=0},nt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},nt.prototype.get=function(t){var e=this.__data__;if(J){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return j.call(e,t)?e[t]:void 0},nt.prototype.has=function(t){var e=this.__data__;return J?void 0!==e[t]:j.call(e,t)},nt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=J&&void 0===e?"__lodash_hash_undefined__":e,this},it.prototype.clear=function(){this.__data__=[],this.size=0},it.prototype.delete=function(t){var e=this.__data__,n=at(e,t);return!(n<0||(n==e.length-1?e.pop():k.call(e,n,1),--this.size,0))},it.prototype.get=function(t){var e=this.__data__,n=at(e,t);return n<0?void 0:e[n][1]},it.prototype.has=function(t){return at(this.__data__,t)>-1},it.prototype.set=function(t,e){var n=this.__data__,i=at(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this},rt.prototype.clear=function(){this.size=0,this.__data__={hash:new nt,map:new(U||it),string:new nt}},rt.prototype.delete=function(t){var e=pt(this,t).delete(t);return this.size-=e?1:0,e},rt.prototype.get=function(t){return pt(this,t).get(t)},rt.prototype.has=function(t){return pt(this,t).has(t)},rt.prototype.set=function(t,e){var n=pt(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this},st.prototype.add=st.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},st.prototype.has=function(t){return this.__data__.has(t)},ot.prototype.clear=function(){this.__data__=new it,this.size=0},ot.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ot.prototype.get=function(t){return this.__data__.get(t)},ot.prototype.has=function(t){return this.__data__.has(t)},ot.prototype.set=function(t,e){var n=this.__data__;if(n instanceof it){var i=n.__data__;if(!U||i.length<199)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new rt(i)}return n.set(t,e),this.size=n.size,this};var gt=B?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,i=null==t?0:t.length,r=0,s=[];++n<i;){var o=t[n];e(o)&&(s[r++]=o)}return s}(B(t),(function(e){return A.call(t,e)})))}:function(){return[]},mt=lt;function _t(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||l.test(t))&&t>-1&&t%1==0&&t<e}function yt(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function vt(t,e){return t===e||t!=t&&e!=e}(V&&"[object DataView]"!=mt(new V(new ArrayBuffer(1)))||U&&mt(new U)!=r||W&&"[object Promise]"!=mt(W.resolve())||Y&&mt(new Y)!=o||H&&"[object WeakMap]"!=mt(new H))&&(mt=function(t){var e=lt(t),n=e==s?t.constructor:void 0,i=n?yt(n):"";if(i)switch(i){case X:return"[object DataView]";case Z:return r;case Q:return"[object Promise]";case K:return o;case $:return"[object WeakMap]"}return e});var bt=ut(function(){return arguments}())?ut:function(t){return It(t)&&j.call(t,"callee")&&!A.call(t,"callee")},xt=Array.isArray,Et=z||function(){return!1};function St(t){if(!Ot(t))return!1;var e=lt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Ct(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Ot(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function It(t){return null!=t&&"object"==typeof t}var wt=y?function(t){return function(e){return t(e)}}(y):function(t){return It(t)&&Ct(t.length)&&!!u[lt(t)]};function Lt(t){return null!=(e=t)&&Ct(e.length)&&!St(e)?function(t,e){var n=xt(t),i=!n&&bt(t),r=!n&&!i&&Et(t),s=!n&&!i&&!r&&wt(t),o=n||i||r||s,a=o?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],l=a.length;for(var u in t)!e&&!j.call(t,u)||o&&("length"==u||r&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||_t(u,l))||a.push(u);return a}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||w))return q(t);var e,n,i=[];for(var r in Object(t))j.call(t,r)&&"constructor"!=r&&i.push(r);return i}(t);var e}t.exports=function(t,e){return ct(t,e)}})),Zt={Polygon:J,LineString:H,Point:Y,MultiPolygon:Q,MultiLineString:Q,MultiPoint:Q};var Qt=function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=st(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=st(Ht,t.controls):e.controls=st(Yt,t.controls),(e=st(Wt,e)).styles=Jt(e.styles,"cold").concat(Jt(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=x,e.getFeatureIdsAt=function(e){return A.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:v,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:v,features:t.store.getSelectedCoordinates().map((function(t){return{type:g,properties:{},geometry:{type:y,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==v||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var i=t.store.createRenderBatch(),r=t.store.getAllIds().slice(),s=e.add(n),o=new R(s);return(r=r.filter((function(t){return!o.has(t)}))).length&&e.delete(r),i(),s},e.add=function(e){var n=JSON.parse(JSON.stringify(Ct(e))).features.map((function(e){if(e.id=e.id||U(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){var n=Zt[e.geometry.type];if(void 0===n)throw new Error("Invalid geometry type: "+e.geometry.type+".");var i=new n(t,e);t.store.add(i)}else{var r=t.store.get(e.id);r.properties=e.properties,Xt(r.getCoordinates(),e.geometry.coordinates)||r.incomingCoords(e.geometry.coordinates)}return e.id}));return t.store.render(),n},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:v,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==x.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(x.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===x.DIRECT_SELECT?t.events.changeMode(x.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,i){return void 0===i&&(i={}),n===x.SIMPLE_SELECT&&e.getMode()===x.SIMPLE_SELECT?(r=i.featureIds||[],s=t.store.getSelectedIds(),r.length===s.length&&JSON.stringify(r.map((function(t){return t})).sort())===JSON.stringify(s.map((function(t){return t})).sort())||(t.store.setSelected(i.featureIds,{silent:!0}),t.store.render()),e):(n===x.DIRECT_SELECT&&e.getMode()===x.DIRECT_SELECT&&i.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,i,{silent:!0}),e);var r,s},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,i,r){return t.store.setFeatureProperty(n,i,r),e},e}(n,e),n.api=e;var i=lt(n);return e.onAdd=i.onAdd,e.onRemove=i.onRemove,e.types=f,e.options=t,e};function Kt(t){Qt(t,this)}return Kt.modes=Ut,Kt}()}).call(this,n(118))},601:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={onSetup:function(t){var e,n=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(n),this.clearSelectedFeatures(),e=this,setTimeout((function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:n}},onTap:function(t,e){t.startPoint&&this.onMouseMove(t,e),this.onClick(t,e)},onClick:function(t,e){t.startPoint&&t.startPoint[0]!==e.lngLat.lng&&t.startPoint[1]!==e.lngLat.lat&&(this.updateUIClasses({mouse:"pointer"}),t.endPoint=[e.lngLat.lng,e.lngLat.lat],this.changeMode("simple_select",{featuresId:t.rectangle.id}));var n=[e.lngLat.lng,e.lngLat.lat];t.startPoint=n},onMouseMove:function(t,e){t.startPoint&&(t.rectangle.updateCoordinate("0.0",t.startPoint[0],t.startPoint[1]),t.rectangle.updateCoordinate("0.1",e.lngLat.lng,t.startPoint[1]),t.rectangle.updateCoordinate("0.2",e.lngLat.lng,e.lngLat.lat),t.rectangle.updateCoordinate("0.3",t.startPoint[0],e.lngLat.lat),t.rectangle.updateCoordinate("0.4",t.startPoint[0],t.startPoint[1]))},onKeyUp:function(t,e){if(27===e.keyCode)return this.changeMode("simple_select")},onStop:function(t){var e;e=this,setTimeout((function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(t.rectangle.id)&&(t.rectangle.removeCoordinate("0.4"),t.rectangle.isValid()?this.map.fire("draw.create",{features:[t.rectangle.toGeoJSON()]}):(this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(t,e,n){var i=e.properties.id===t.rectangle.id;return e.properties.active=i?"true":"false",i?t.startPoint?n(e):void 0:n(e)},onTrash:function(t){this.deleteFeature([t.rectangle.id],{silent:!0}),this.changeMode("simple_select")}};e.default=i},602:function(t,e,n){
/**
 * JSTS. See https://github.com/bjornharrtell/jsts
 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_EDLv1.txt
 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_EPLv1.txt
 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_LICENSE_ES6_COLLECTIONS.txt
 * @license
 */
!function(t){"use strict";function e(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function n(){}function i(){}function r(t,e){this.low=0|e,this.high=0|t}function s(){}var o,a,l,u,c,h,d;function p(){}function f(){}function g(){}function m(){}function _(t){this.name="RuntimeException",this.message=t,this.stack=(new Error).stack,Error.call(this,t)}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}function v(){if(0===arguments.length)_.call(this);else if(1===arguments.length){var t=arguments[0];_.call(this,t)}}function b(){}function x(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)x.call(this,0,0);else if(1===arguments.length){var t=arguments[0];x.call(this,t.x,t.y,t.z)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];x.call(this,e,n,x.NULL_ORDINATE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this.x=i,this.y=r,this.z=s}}function E(){if(this._dimensionsToTest=2,0===arguments.length)E.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new i("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}function S(t,e){return t.interfaces_&&-1<t.interfaces_().indexOf(e)}function C(){}function O(){}function I(t){this.message=t||""}function w(){}function L(t){this.message=t||""}function T(t){this.message=t||""}function j(){this.array_=[],arguments[0]instanceof O&&this.addAll(arguments[0])}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)e[i]=t,++i;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)},Math.log2=Math.log2||function(t){return Math.log(t)*Math.LOG2E},e(n.prototype,{interfaces_:function(){return[]},getClass:function(){return n}}),n.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n},r.toBinaryString=function(t){for(var e="",n=2147483648;0<n;n>>>=1)e+=(t.high&n)===n?"1":"0";for(n=2147483648;0<n;n>>>=1)e+=(t.low&n)===n?"1":"0";return e},s.isNaN=function(t){return Number.isNaN(t)},s.isInfinite=function(t){return!Number.isFinite(t)},s.MAX_VALUE=Number.MAX_VALUE,s.longBitsToDouble="function"==typeof Float64Array&&"function"==typeof Int32Array?(c=2146435072,h=new Float64Array(1),d=new Int32Array(h.buffer),s.doubleToLongBits=function(t){h[0]=t;var e=0|d[0],n=0|d[1];return(n&c)===c&&!!(1048575&n)&&0!==e&&(e=0,n=2146959360),new r(n,e)},function(t){return d[0]=t.low,d[1]=t.high,h[0]}):(o=Math.log2,a=Math.floor,l=Math.pow,u=function(){for(var t=53;0<t;t--){var e=l(2,t)-1;if(a(o(e))+1===t)return e}return 0}(),s.doubleToLongBits=function(t){var e,n,i,s,c,h,d,p,f;if(t<0||1/t===Number.NEGATIVE_INFINITY?(h=1<<31,t=-t):h=0,0===t)return new r(p=h,f=0);if(t===1/0)return new r(p=2146435072|h,f=0);if(t!=t)return new r(p=2146959360,f=0);if(f=s=0,1<(e=a(t)))if(e<=u)p=(s=a(o(e)))<=20?(f=0,e<<20-s&1048575):(f=e%(n=l(2,i=s-20))<<32-i,e/n&1048575);else for(i=e,f=0;0!==(i=a(n=i/2));)s++,f>>>=1,f|=(1&p)<<31,p>>>=1,n!==i&&(p|=524288);if(d=s+1023,c=0===e,e=t-e,s<52&&0!==e)for(i=0;;){if(1<=(n=2*e)?(e=n-1,c?(d--,c=!1):(i<<=1,i|=1,s++)):(e=n,c?0==--d&&(s++,c=!1):(i<<=1,s++)),20===s)p|=i,i=0;else if(52===s){f|=i;break}if(1===n){s<20?p|=i<<20-s:s<52&&(f|=i<<52-s);break}}return p|=d<<20,new r(p|=h,f)},function(t){var e,n,i,r,s=t.high,o=t.low;n=s&1<<31?-1:1,i=((2146435072&s)>>20)-1023,r=0,e=1<<19;for(var a=1;a<=20;a++)s&e&&(r+=l(2,-a)),e>>>=1;for(e=1<<31,a=21;a<=52;a++)o&e&&(r+=l(2,-a)),e>>>=1;if(-1023===i){if(0===r)return 0*n;i=-1022}else{if(1024===i)return 0===r?n/0:NaN;r+=1}return n*r*l(2,i)}),(_.prototype=Object.create(Error.prototype)).constructor=Error,y(v,_),e(v.prototype,{interfaces_:function(){return[]},getClass:function(){return v}}),e(b.prototype,{interfaces_:function(){return[]},getClass:function(){return b}}),b.shouldNeverReachHere=function(){if(0===arguments.length)b.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new v("Should never reach here"+(null!==t?": "+t:""))}},b.isTrue=function(){if(1===arguments.length){var t=arguments[0];b.isTrue(t,null)}else if(2===arguments.length){var e=arguments[1];if(!arguments[0])throw null===e?new v:new v(e)}},b.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];b.equals(t,e,null)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(!i.equals(n))throw new v("Expected "+n+" but encountered "+i+(null!==r?": "+r:""))}},e(x.prototype,{setOrdinate:function(t,e){switch(t){case x.X:this.x=e;break;case x.Y:this.y=e;break;case x.Z:this.z=e;break;default:throw new i("Invalid ordinate index: "+t)}},equals2D:function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!n.equalsWithTolerance(this.x,e.x,i)&&!!n.equalsWithTolerance(this.y,e.y,i)}},getOrdinate:function(t){switch(t){case x.X:return this.x;case x.Y:return this.y;case x.Z:return this.z}throw new i("Invalid ordinate index: "+t)},equals3D:function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||s.isNaN(this.z)&&s.isNaN(t.z))},equals:function(t){return t instanceof x&&this.equals2D(t)},equalInZ:function(t,e){return n.equalsWithTolerance(this.z,t.z,e)},compareTo:function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return b.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}},copy:function(){return new x(this)},toString:function(){return"("+this.x+", "+this.y+", "+this.z+")"},distance3D:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+n*n+i*i)},distance:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return 37*(t=37*t+x.hashCode(this.x))+x.hashCode(this.y)},setCoordinate:function(t){this.x=t.x,this.y=t.y,this.z=t.z},interfaces_:function(){return[p,f,m]},getClass:function(){return x}}),x.hashCode=function(){if(1===arguments.length&&"number"==typeof arguments[0]){var t=arguments[0],e=s.doubleToLongBits(t);return Math.trunc(e^e>>>32)}},e(E.prototype,{compare:function(t,e){var n=t,i=e,r=E.compare(n.x,i.x);if(0!==r)return r;var s=E.compare(n.y,i.y);return 0!==s?s:this._dimensionsToTest<=2?0:E.compare(n.z,i.z)},interfaces_:function(){return[g]},getClass:function(){return E}}),E.compare=function(t,e){return t<e?-1:e<t?1:s.isNaN(t)?s.isNaN(e)?0:-1:s.isNaN(e)?1:0},x.DimensionalComparator=E,x.serialVersionUID=0x5cbf2c235c7e5800,x.NULL_ORDINATE=s.NaN,x.X=0,x.Y=1,x.Z=2,C.prototype.hasNext=function(){},C.prototype.next=function(){},C.prototype.remove=function(){},O.prototype.add=function(){},O.prototype.addAll=function(){},O.prototype.isEmpty=function(){},O.prototype.iterator=function(){},O.prototype.size=function(){},O.prototype.toArray=function(){},O.prototype.remove=function(){},(I.prototype=new Error).name="IndexOutOfBoundsException",((w.prototype=Object.create(O.prototype)).constructor=w).prototype.get=function(){},w.prototype.set=function(){},w.prototype.isEmpty=function(){},(L.prototype=new Error).name="NoSuchElementException",(T.prototype=new Error).name="OperationNotSupported",((j.prototype=Object.create(w.prototype)).constructor=j).prototype.ensureCapacity=function(){},j.prototype.interfaces_=function(){return[w,O]},j.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(t,0,arguments[1]),!0},j.prototype.clear=function(){this.array_=[]},j.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},j.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},j.prototype.iterator=function(){return new N(this)},j.prototype.get=function(t){if(t<0||t>=this.size())throw new I;return this.array_[t]},j.prototype.isEmpty=function(){return 0===this.array_.length},j.prototype.size=function(){return this.array_.length},j.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},j.prototype.remove=function(t){for(var e=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},j.prototype.removeAll=function(t){for(var e=t.iterator();e.hasNext();)this.remove(e.next());return!0};var N=function(t){this.arrayList_=t,this.position_=0};function M(){if(j.apply(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.ensureCapacity(e.length),this.add(e,n)}}function F(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof F){var e=arguments[0];this.init(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];this.init(r,s,o,a)}}function P(){}function R(){P.call(this,"Projective point not representable on the Cartesian plane.")}function D(t){this.str=t}function A(t){this.value=t}function k(){}function G(){if(this._hi=0,(this._lo=0)===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof G){var e=arguments[0];this.init(e)}else if("string"==typeof arguments[0]){var n=arguments[0];G.call(this,G.parse(n))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i,r)}}function B(){}function z(){}function q(){}function V(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];this.x=e,this.y=n,this.w=1}else if(arguments[0]instanceof V&&arguments[1]instanceof V){var i=arguments[0],r=arguments[1];this.x=i.y*r.w-r.y*i.w,this.y=r.x*i.w-i.x*r.w,this.w=i.x*r.y-r.x*i.y}else if(arguments[0]instanceof x&&arguments[1]instanceof x){var s=arguments[0],o=arguments[1];this.x=s.y-o.y,this.y=o.x-s.x,this.w=s.x*o.y-o.x*s.y}}else if(3===arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2];this.x=a,this.y=l,this.w=u}else if(4===arguments.length){var c=arguments[0],h=arguments[1],d=arguments[2],p=arguments[3],f=c.y-h.y,g=h.x-c.x,m=c.x*h.y-h.x*c.y,_=d.y-p.y,y=p.x-d.x,v=d.x*p.y-p.x*d.y;this.x=g*v-y*m,this.y=_*m-f*v,this.w=f*y-_*g}}function U(){}function W(){}function Y(){}function H(){}function J(){}function X(){this._envelope=null,this._factory=null,this._SRID=null,this._userData=null;var t=arguments[0];this._factory=t,this._SRID=t.getSRID()}function Z(){}function Q(){}function K(){}function $(){}function tt(){}function et(){}function nt(){}function it(){}function rt(){}function st(){}function ot(){}function at(){}function lt(){this.array_=[],arguments[0]instanceof O&&this.addAll(arguments[0])}N.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new L;return this.arrayList_.get(this.position_++)},N.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},N.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},N.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},y(M,j),e(M.prototype,{getCoordinate:function(t){return this.get(t)},addAll:function(){if(2===arguments.length&&"boolean"==typeof arguments[1]&&S(arguments[0],O)){for(var t=arguments[1],e=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),t),e=!0;return e}return j.prototype.addAll.apply(this,arguments)},clone:function(){for(var t=j.prototype.clone.call(this),e=0;e<this.size();e++)t.add(e,this.get(e).clone());return t},toCoordinateArray:function(){return this.toArray(M.coordArrayType)},add:function(){if(1===arguments.length){var t=arguments[0];j.prototype.add.call(this,t)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var e=arguments[0],n=arguments[1];return this.add(e,n,!0),!0}if(arguments[0]instanceof x&&"boolean"==typeof arguments[1]){var i=arguments[0];if(!arguments[1]&&1<=this.size()&&this.get(this.size()-1).equals2D(i))return null;j.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var r=arguments[0],s=arguments[1];return this.add(r,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1];if(arguments[2])for(var l=0;l<o.length;l++)this.add(o[l],a);else for(l=o.length-1;0<=l;l--)this.add(o[l],a);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof x){var u=arguments[0],c=arguments[1];if(!arguments[2]){var h=this.size();if(0<h){if(0<u&&this.get(u-1).equals2D(c))return null;if(u<h&&this.get(u).equals2D(c))return null}}j.prototype.add.call(this,u,c)}}else if(4===arguments.length){var d=arguments[0],p=arguments[1],f=arguments[2],g=arguments[3],m=1;for(g<f&&(m=-1),l=f;l!==g;l+=m)this.add(d[l],p);return!0}},closeRing:function(){0<this.size()&&this.add(new x(this.get(0)),!1)},interfaces_:function(){return[]},getClass:function(){return M}}),M.coordArrayType=new Array(0).fill(null),e(F.prototype,{getArea:function(){return this.getWidth()*this.getHeight()},equals:function(t){if(!(t instanceof F))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},intersection:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new F;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny;return new F(e,this._maxx<t._maxx?this._maxx:t._maxx,n,this._maxy<t._maxy?this._maxy:t._maxy)},isNull:function(){return this._maxx<this._minx},getMaxX:function(){return this._maxx},covers:function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof F){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}},intersects:function(){if(1===arguments.length){if(arguments[0]instanceof F){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof x){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){if(arguments[0]instanceof x&&arguments[1]instanceof x){var n=arguments[0],i=arguments[1];return!(this.isNull()||(n.x<i.x?n.x:i.x)>this._maxx||(n.x>i.x?n.x:i.x)<this._minx||(n.y<i.y?n.y:i.y)>this._maxy||(n.y>i.y?n.y:i.y)<this._miny)}if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],s=arguments[1];return!this.isNull()&&!(r>this._maxx||r<this._minx||s>this._maxy||s<this._miny)}}},getMinY:function(){return this._miny},getMinX:function(){return this._minx},expandToInclude:function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof F){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}},minExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},getWidth:function(){return this.isNull()?0:this._maxx-this._minx},compareTo:function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},translate:function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},toString:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},setToNull:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},getHeight:function(){return this.isNull()?0:this._maxy-this._miny},maxExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return e<t?t:e},expandBy:function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},contains:function(){if(1===arguments.length){if(arguments[0]instanceof F){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof x){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},centre:function(){return this.isNull()?null:new x((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},init:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof F){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];this._maxx=r<s?(this._minx=r,s):(this._minx=s,r),this._maxy=o<a?(this._miny=o,a):(this._miny=a,o)}},getMaxY:function(){return this._maxy},distance:function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return 37*(t=37*(t=37*(t=37*t+x.hashCode(this._minx))+x.hashCode(this._maxx))+x.hashCode(this._miny))+x.hashCode(this._maxy)},interfaces_:function(){return[p,m]},getClass:function(){return F}}),F.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=Math.min(s.x,o.x),l=Math.max(s.x,o.x),u=Math.min(i.x,r.x),c=Math.max(i.x,r.x);return!(l<u||c<a||(a=Math.min(s.y,o.y),l=Math.max(s.y,o.y),u=Math.min(i.y,r.y),c=Math.max(i.y,r.y),l<u||c<a))}},F.serialVersionUID=0x51845cd552189800,y(R,P),e(R.prototype,{interfaces_:function(){return[]},getClass:function(){return R}}),D.prototype.append=function(t){this.str+=t},D.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},D.prototype.toString=function(t){return this.str},A.prototype.intValue=function(){return this.value},A.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},A.isNaN=function(t){return Number.isNaN(t)},k.isWhitespace=function(t){return t<=32&&0<=t||127==t},k.toUpperCase=function(t){return t.toUpperCase()},e(G.prototype,{le:function(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<=t._lo},extractSignificantDigits:function(t,e){var n=this.abs(),i=G.magnitude(n._hi),r=G.TEN.pow(i);(n=n.divide(r)).gt(G.TEN)?(n=n.divide(G.TEN),i+=1):n.lt(G.ONE)&&(n=n.multiply(G.TEN),i-=1);for(var s=i+1,o=new D,a=G.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){t&&l===s&&o.append(".");var u=Math.trunc(n._hi);if(u<0)break;var c,h=!1;c=9<u?(h=!0,"9"):"0"+u,o.append(c),n=n.subtract(G.valueOf(u)).multiply(G.TEN),h&&n.selfAdd(G.TEN);var d=!0,p=G.magnitude(n._hi);if(p<0&&Math.abs(p)>=a-l&&(d=!1),!d)break}return e[0]=i,o.toString()},sqr:function(){return this.multiply(this)},doubleValue:function(){return this._hi+this._lo},subtract:function(){if(arguments[0]instanceof G){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},equals:function(){if(1===arguments.length&&arguments[0]instanceof G){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},isZero:function(){return 0===this._hi&&0===this._lo},selfSubtract:function(){if(arguments[0]instanceof G){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},getSpecialNumberString:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},min:function(t){return this.le(t)?this:t},selfDivide:function(){if(1===arguments.length){if(arguments[0]instanceof G){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n,i,r,s,o=arguments[0],a=arguments[1],l=null,u=null,c=null,h=null;return r=this._hi/o,h=(l=(c=G.SPLIT*r)-(l=c-r))*(u=(h=G.SPLIT*o)-(u=h-o))-(s=r*o)+l*(i=o-u)+(n=r-l)*u+n*i,h=r+(c=(this._hi-s-h+this._lo-r*a)/o),this._hi=h,this._lo=r-h+c,this}},dump:function(){return"DD<"+this._hi+", "+this._lo+">"},divide:function(){if(arguments[0]instanceof G){var t,e,n,i,r=arguments[0],o=null,a=null,l=null,u=null;return t=(n=this._hi/r._hi)-(o=(l=G.SPLIT*n)-(o=l-n)),u=o*(a=(u=G.SPLIT*r._hi)-(a=u-r._hi))-(i=n*r._hi)+o*(e=r._hi-a)+t*a+t*e,new G(u=n+(l=(this._hi-i-u+this._lo-n*r._lo)/r._hi),n-u+l)}if("number"==typeof arguments[0]){var c=arguments[0];return s.isNaN(c)?G.createNaN():G.copy(this).selfDivide(c,0)}},ge:function(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>=t._lo},pow:function(t){if(0===t)return G.valueOf(1);var e=new G(this),n=G.valueOf(1),i=Math.abs(t);if(1<i)for(;0<i;)i%2==1&&n.selfMultiply(e),0<(i/=2)&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},ceil:function(){if(this.isNaN())return G.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new G(t,e)},compareTo:function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},rint:function(){return this.isNaN()?this:this.add(.5).floor()},setValue:function(){if(arguments[0]instanceof G){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},max:function(t){return this.ge(t)?this:t},sqrt:function(){if(this.isZero())return G.valueOf(0);if(this.isNegative())return G.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=G.valueOf(e),i=this.subtract(n.sqr())._hi*(.5*t);return n.add(i)},selfAdd:function(){if(1===arguments.length){if(arguments[0]instanceof G){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,i=null,r=null,s=null,o=null,a=null;return s=(r=this._hi+e)-(o=r-this._hi),i=(a=(s=e-o+(this._hi-s))+this._lo)+(r-(n=r+a)),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(2===arguments.length){var l,u=arguments[0],c=arguments[1],h=(n=null,i=null,null);r=null,s=null,o=null,a=null,r=this._hi+u,l=this._lo+c,s=r-(o=r-this._hi),h=l-(a=l-this._lo);var d=(n=r+(o=(s=u-o+(this._hi-s))+l))+(o=(h=c-a+(this._lo-h))+(i=o+(r-n))),p=o+(n-d);return this._hi=d,this._lo=p,this}},selfMultiply:function(){if(1===arguments.length){if(arguments[0]instanceof G){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n,i,r=arguments[0],s=arguments[1],o=null,a=null,l=null,u=null;o=(l=G.SPLIT*this._hi)-this._hi,u=G.SPLIT*r,o=l-o,n=this._hi-o,a=u-r;var c=(l=this._hi*r)+(u=o*(a=u-a)-l+o*(i=r-a)+n*a+n*i+(this._hi*s+this._lo*r)),h=u+(o=l-c);return this._hi=c,this._lo=h,this}},selfSqr:function(){return this.selfMultiply(this)},floor:function(){if(this.isNaN())return G.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new G(t,e)},negate:function(){return this.isNaN()?this:new G(-this._hi,-this._lo)},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}},multiply:function(){if(arguments[0]instanceof G){var t=arguments[0];return t.isNaN()?G.createNaN():G.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return s.isNaN(e)?G.createNaN():G.copy(this).selfMultiply(e,0)}},isNaN:function(){return s.isNaN(this._hi)},intValue:function(){return Math.trunc(this._hi)},toString:function(){var t=G.magnitude(this._hi);return-3<=t&&t<=20?this.toStandardNotation():this.toSciNotation()},toStandardNotation:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),i=e[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(i<0)r="0."+G.stringOfChar("0",-i)+n;else if(-1===n.indexOf(".")){var s=i-n.length;r=n+G.stringOfChar("0",s)+".0"}return this.isNegative()?"-"+r:r},reciprocal:function(){var t,e,n,i,r=null,s=null,o=null,a=null;t=(n=1/this._hi)-(r=(o=G.SPLIT*n)-(r=o-n)),s=(a=G.SPLIT*this._hi)-this._hi;var l=n+(o=(1-(i=n*this._hi)-(a=r*(s=a-s)-i+r*(e=this._hi-s)+t*s+t*e)-n*this._lo)/this._hi);return new G(l,n-l+o)},toSciNotation:function(){if(this.isZero())return G.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),i=G.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new IllegalStateException("Found leading zero: "+n);var r="";1<n.length&&(r=n.substring(1));var s=n.charAt(0)+"."+r;return this.isNegative()?"-"+s+i:s+i},abs:function(){return this.isNaN()?G.NaN:this.isNegative()?this.negate():new G(this)},isPositive:function(){return 0<this._hi||0===this._hi&&0<this._lo},lt:function(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<t._lo},add:function(){if(arguments[0]instanceof G){var t=arguments[0];return G.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return G.copy(this).selfAdd(e)}},init:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof G){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}},gt:function(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>t._lo},isNegative:function(){return this._hi<0||0===this._hi&&this._lo<0},trunc:function(){return this.isNaN()?G.NaN:this.isPositive()?this.floor():this.ceil()},signum:function(){return 0<this._hi?1:this._hi<0?-1:0<this._lo?1:this._lo<0?-1:0},interfaces_:function(){return[m,p,f]},getClass:function(){return G}}),G.sqr=function(t){return G.valueOf(t).selfMultiply(t)},G.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return G.parse(t)}if("number"==typeof arguments[0])return new G(arguments[0])},G.sqrt=function(t){return G.valueOf(t).sqrt()},G.parse=function(t){for(var e=0,n=t.length;k.isWhitespace(t.charAt(e));)e++;var i=!1;if(e<n){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(i=!0))}for(var s=new G,o=0,a=0,l=0;!(n<=e);){var u=t.charAt(e);if(e++,k.isDigit(u)){var c=u-"0";s.selfMultiply(G.TEN),s.selfAdd(c),o++}else{if("."!==u){if("e"!==u&&"E"!==u)throw new NumberFormatException("Unexpected character '"+u+"' at position "+e+" in string "+t);var h=t.substring(e);try{l=A.parseInt(h)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+h+" in string "+t):e}break}a=o}}var d=s,p=o-a-l;if(0===p)d=s;else if(0<p){var f=G.TEN.pow(p);d=s.divide(f)}else p<0&&(f=G.TEN.pow(-p),d=s.multiply(f));return i?d.negate():d},G.createNaN=function(){return new G(s.NaN,s.NaN)},G.copy=function(t){return new G(t)},G.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=e&&(i+=1),i},G.stringOfChar=function(t,e){for(var n=new D,i=0;i<e;i++)n.append(t);return n.toString()},G.PI=new G(3.141592653589793,12246467991473532e-32),G.TWO_PI=new G(6.283185307179586,24492935982947064e-32),G.PI_2=new G(1.5707963267948966,6123233995736766e-32),G.E=new G(2.718281828459045,14456468917292502e-32),G.NaN=new G(s.NaN,s.NaN),G.EPS=123259516440783e-46,G.SPLIT=134217729,G.MAX_PRINT_DIGITS=32,G.TEN=G.valueOf(10),G.ONE=G.valueOf(1),G.SCI_NOT_EXPONENT_CHAR="E",G.SCI_NOT_ZERO="0.0E0",e(B.prototype,{interfaces_:function(){return[]},getClass:function(){return B}}),B.orientationIndex=function(t,e,n){var i=B.orientationIndexFilter(t,e,n);if(i<=1)return i;var r=G.valueOf(e.x).selfAdd(-t.x),s=G.valueOf(e.y).selfAdd(-t.y),o=G.valueOf(n.x).selfAdd(-e.x),a=G.valueOf(n.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(s.selfMultiply(o)).signum()},B.signOfDet2x2=function(){if(arguments[0]instanceof G){var t=arguments[1],e=arguments[2],n=arguments[3];return arguments[0].multiply(n).selfSubtract(t.multiply(e)).signum()}if("number"==typeof arguments[0]){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=G.valueOf(i),l=G.valueOf(r),u=G.valueOf(s),c=G.valueOf(o);return a.multiply(c).selfSubtract(l.multiply(u)).signum()}},B.intersection=function(t,e,n,i){var r=G.valueOf(i.y).selfSubtract(n.y).selfMultiply(G.valueOf(e.x).selfSubtract(t.x)),s=G.valueOf(i.x).selfSubtract(n.x).selfMultiply(G.valueOf(e.y).selfSubtract(t.y)),o=r.subtract(s),a=G.valueOf(i.x).selfSubtract(n.x).selfMultiply(G.valueOf(t.y).selfSubtract(n.y)),l=G.valueOf(i.y).selfSubtract(n.y).selfMultiply(G.valueOf(t.x).selfSubtract(n.x)),u=a.subtract(l).selfDivide(o).doubleValue(),c=G.valueOf(t.x).selfAdd(G.valueOf(e.x).selfSubtract(t.x).selfMultiply(u)).doubleValue(),h=G.valueOf(e.x).selfSubtract(t.x).selfMultiply(G.valueOf(t.y).selfSubtract(n.y)),d=G.valueOf(e.y).selfSubtract(t.y).selfMultiply(G.valueOf(t.x).selfSubtract(n.x)),p=h.subtract(d).selfDivide(o).doubleValue();return new x(c,G.valueOf(n.y).selfAdd(G.valueOf(i.y).selfSubtract(n.y).selfMultiply(p)).doubleValue())},B.orientationIndexFilter=function(t,e,n){var i=null,r=(t.x-n.x)*(e.y-n.y),s=(t.y-n.y)*(e.x-n.x),o=r-s;if(0<r){if(s<=0)return B.signum(o);i=r+s}else{if(!(r<0))return B.signum(o);if(0<=s)return B.signum(o);i=-r-s}var a=B.DP_SAFE_EPSILON*i;return a<=o||a<=-o?B.signum(o):2},B.signum=function(t){return 0<t?1:t<0?-1:0},B.DP_SAFE_EPSILON=1e-15,e(z.prototype,{interfaces_:function(){return[]},getClass:function(){return z}}),z.index=function(t,e,n){return B.orientationIndex(t,e,n)},z.isCCW=function(t){var e=t.length-1;if(e<3)throw new i("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,s=1;s<=e;s++){var o=t[s];o.y>n.y&&(n=o,r=s)}for(var a=r;(a-=1)<0&&(a=e),t[a].equals2D(n)&&a!==r;);for(var l=r;t[l=(l+1)%e].equals2D(n)&&l!==r;);var u=t[a],c=t[l];if(u.equals2D(n)||c.equals2D(n)||u.equals2D(c))return!1;var h=z.index(u,n,c);return 0===h?u.x>c.x:0<h},z.RIGHT=z.CLOCKWISE=-1,z.LEFT=z.COUNTERCLOCKWISE=1,z.STRAIGHT=z.COLLINEAR=0,q.arraycopy=function(t,e,n,i,r){for(var s=0,o=e;o<e+r;o++)n[i+s]=t[o],s++},q.getProperty=function(t){return{"line.separator":"\n"}[t]},e(V.prototype,{getY:function(){var t=this.y/this.w;if(s.isNaN(t)||s.isInfinite(t))throw new R;return t},getX:function(){var t=this.x/this.w;if(s.isNaN(t)||s.isInfinite(t))throw new R;return t},getCoordinate:function(){var t=new x;return t.x=this.getX(),t.y=this.getY(),t},interfaces_:function(){return[]},getClass:function(){return V}}),V.intersection=function(t,e,n,i){var r=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,l=n.y-i.y,u=i.x-n.x,c=n.x*i.y-i.x*n.y,h=r*u-l*o,d=(o*c-u*a)/h,p=(l*a-r*c)/h;if(s.isNaN(d)||s.isInfinite(d)||s.isNaN(p)||s.isInfinite(p))throw new R;return new x(d,p)},e(U.prototype,{interfaces_:function(){return[]},getClass:function(){return U}}),U.log10=function(t){var e=Math.log(t);return s.isInfinite(e)||s.isNaN(e)?e:e/U.LOG_10},U.min=function(t,e,n,i){var r=t;return e<r&&(r=e),n<r&&(r=n),i<r&&(r=i),r},U.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:n<t?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],s=arguments[2];return i<r?r:s<i?s:i}},U.wrap=function(t,e){return t<0?e- -t%e:t%e},U.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2];return(n=arguments[0])<t&&(n=t),n<e&&(n=e),n}if(4===arguments.length){var n,i=arguments[1],r=arguments[2],s=arguments[3];return(n=arguments[0])<i&&(n=i),n<r&&(n=r),n<s&&(n=s),n}},U.average=function(t,e){return(t+e)/2},U.LOG_10=Math.log(10),e(W.prototype,{interfaces_:function(){return[]},getClass:function(){return W}}),W.segmentToSegment=function(t,e,n,i){if(t.equals(e))return W.pointToSegment(t,n,i);if(n.equals(i))return W.pointToSegment(i,t,e);var r=!1;if(F.intersects(t,e,n,i)){var s=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(0===s)r=!0;else{var o=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),a=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/s,l=o/s;(l<0||1<l||a<0||1<a)&&(r=!0)}}else r=!0;return r?U.min(W.pointToSegment(t,n,i),W.pointToSegment(e,n,i),W.pointToSegment(n,t,e),W.pointToSegment(i,t,e)):0},W.pointToSegment=function(t,e,n){if(e.x===n.x&&e.y===n.y)return t.distance(e);var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;if(r<=0)return t.distance(e);if(1<=r)return t.distance(n);var s=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(s)*Math.sqrt(i)},W.pointToLinePerpendicular=function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(r)*Math.sqrt(i)},W.pointToSegmentString=function(t,e){if(0===e.length)throw new i("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var s=W.pointToSegment(t,e[r],e[r+1]);s<n&&(n=s)}return n},e(Y.prototype,{setOrdinate:function(t,e,n){},size:function(){},getOrdinate:function(t,e){},getCoordinate:function(){},getCoordinateCopy:function(t){},getDimension:function(){},getX:function(t){},expandEnvelope:function(t){},copy:function(){},getY:function(t){},toCoordinateArray:function(){},interfaces_:function(){return[f]},getClass:function(){return Y}}),Y.X=0,Y.Y=1,Y.Z=2,Y.M=3,e(H.prototype,{create:function(){1===arguments.length&&(arguments[0]instanceof Array||S(arguments[0],Y))},interfaces_:function(){return[]},getClass:function(){return H}}),e(J.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return J}}),e(X.prototype,{isGeometryCollection:function(){return this.getTypeCode()===X.TYPECODE_GEOMETRYCOLLECTION},getFactory:function(){return this._factory},getGeometryN:function(t){return this},getArea:function(){return 0},isRectangle:function(){return!1},equals:function(){if(arguments[0]instanceof X){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof X))return!1;var n=e;return this.equalsExact(n)}},equalsExact:function(t){return this===t||this.equalsExact(t,0)},geometryChanged:function(){this.apply(X.geometryChangedFilter)},geometryChangedAction:function(){this._envelope=null},equalsNorm:function(t){return null!==t&&this.norm().equalsExact(t.norm())},getLength:function(){return 0},getNumGeometries:function(){return 1},compareTo:function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return e=n,this.getTypeCode()!==e.getTypeCode()?this.getTypeCode()-e.getTypeCode():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,i)}},getUserData:function(){return this._userData},getSRID:function(){return this._SRID},getEnvelope:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},checkNotGeometryCollection:function(t){if(t.getTypeCode()===X.TYPECODE_GEOMETRYCOLLECTION)throw new i("This method does not support GeometryCollection arguments")},equal:function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},norm:function(){var t=this.copy();return t.normalize(),t},getPrecisionModel:function(){return this._factory.getPrecisionModel()},getEnvelopeInternal:function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new F(this._envelope)},setSRID:function(t){this._SRID=t},setUserData:function(t){this._userData=t},compare:function(t,e){for(var n=t.iterator(),i=e.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),s=i.next(),o=r.compareTo(s);if(0!==o)return o}return n.hasNext()?1:i.hasNext()?-1:0},hashCode:function(){return this.getEnvelopeInternal().hashCode()},isGeometryCollectionOrDerived:function(){return this.getTypeCode()===X.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===X.TYPECODE_MULTIPOINT||this.getTypeCode()===X.TYPECODE_MULTILINESTRING||this.getTypeCode()===X.TYPECODE_MULTIPOLYGON},interfaces_:function(){return[f,p,m]},getClass:function(){return X}}),X.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},X.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},X.serialVersionUID=0x799ea46522854c00,X.TYPECODE_POINT=0,X.TYPECODE_MULTIPOINT=1,X.TYPECODE_LINESTRING=2,X.TYPECODE_LINEARRING=3,X.TYPECODE_MULTILINESTRING=4,X.TYPECODE_POLYGON=5,X.TYPECODE_MULTIPOLYGON=6,X.TYPECODE_GEOMETRYCOLLECTION=7,X.TYPENAME_POINT="Point",X.TYPENAME_MULTIPOINT="MultiPoint",X.TYPENAME_LINESTRING="LineString",X.TYPENAME_LINEARRING="LinearRing",X.TYPENAME_MULTILINESTRING="MultiLineString",X.TYPENAME_POLYGON="Polygon",X.TYPENAME_MULTIPOLYGON="MultiPolygon",X.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",X.geometryChangedFilter={interfaces_:function(){return[J]},filter:function(t){t.geometryChangedAction()}},e(Z.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return Z}}),e(Q.prototype,{isInBoundary:function(t){},interfaces_:function(){return[]},getClass:function(){return Q}}),e(K.prototype,{isInBoundary:function(t){return t%2==1},interfaces_:function(){return[Q]},getClass:function(){return K}}),e($.prototype,{isInBoundary:function(t){return 0<t},interfaces_:function(){return[Q]},getClass:function(){return $}}),e(tt.prototype,{isInBoundary:function(t){return 1<t},interfaces_:function(){return[Q]},getClass:function(){return tt}}),e(et.prototype,{isInBoundary:function(t){return 1===t},interfaces_:function(){return[Q]},getClass:function(){return et}}),Q.Mod2BoundaryNodeRule=K,Q.EndPointBoundaryNodeRule=$,Q.MultiValentEndPointBoundaryNodeRule=tt,Q.MonoValentEndPointBoundaryNodeRule=et,Q.MOD2_BOUNDARY_RULE=new K,Q.ENDPOINT_BOUNDARY_RULE=new $,Q.MULTIVALENT_ENDPOINT_BOUNDARY_RULE=new tt,Q.MONOVALENT_ENDPOINT_BOUNDARY_RULE=new et,Q.OGC_SFS_BOUNDARY_RULE=Q.MOD2_BOUNDARY_RULE,e(nt.prototype,{interfaces_:function(){return[]},getClass:function(){return nt}}),nt.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},nt.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(nt.indexOf(i,e)<0)return i}return null},nt.scroll=function(t,e){var n=nt.indexOf(e,t);if(n<0)return null;var i=new Array(t.length).fill(null);q.arraycopy(t,n,i,0,t.length-n),q.arraycopy(t,0,i,t.length-n,n),q.arraycopy(i,0,t,0,t.length)},nt.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(n=0;n<i.length;n++)if(0!==s.compare(i[n],r[n]))return!1;return!0}},nt.intersection=function(t,e){for(var n=new M,i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()},nt.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},nt.removeRepeatedPoints=function(t){return nt.hasRepeatedPoints(t)?new M(t,!1).toCoordinateArray():t},nt.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),i=0;i<=n;i++){var r=t[i];t[i]=t[e-i],t[e-i]=r}},nt.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var i=new Array(e).fill(null);if(0===e)return i;var r=0;for(n=0;n<t.length;n++)null!==t[n]&&(i[r++]=t[n]);return i},nt.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new x(t[n]);return e}if(5===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3],a=arguments[4];for(n=0;n<a;n++)s[o+n]=new x(i[r+n])}},nt.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[t.length-n-1];if(0!==i.compareTo(r))return!1}return!0},nt.envelope=function(t){for(var e=new F,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},nt.toCoordinateArray=function(t){return t.toArray(nt.coordArrayType)},nt.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},nt.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},nt.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,i=t[e].compareTo(t[n]);if(0!==i)return i}return 1},nt.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var i=t[n].compareTo(e[n]);if(0!==i)return i;n++}return n<e.length?-1:n<t.length?1:0},nt.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||0<e.compareTo(t[n]))&&(e=t[n]);return e},nt.extract=function(t,e,n){e=U.clamp(e,0,t.length);var i=(n=U.clamp(n,-1,t.length))-e+1;n<0&&(i=0),e>=t.length&&(i=0),n<e&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var s=0,o=e;o<=n;o++)r[s++]=t[o];return r},e(it.prototype,{compare:function(t,e){return nt.compare(t,e)},interfaces_:function(){return[g]},getClass:function(){return it}}),e(rt.prototype,{compare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=nt.compare(n,i);return nt.isEqualReversed(n,i)?0:r},OLDcompare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=nt.increasingDirection(n),s=nt.increasingDirection(i),o=0<r?0:n.length-1,a=0<s?0:n.length-1,l=0;l<n.length;l++){var u=n[o].compareTo(i[a]);if(0!==u)return u;o+=r,a+=s}return 0},interfaces_:function(){return[g]},getClass:function(){return rt}}),nt.ForwardComparator=it,nt.BidirectionalComparator=rt,nt.coordArrayType=new Array(0).fill(null),st.prototype.get=function(){},st.prototype.put=function(){},st.prototype.size=function(){},st.prototype.values=function(){},st.prototype.entrySet=function(){},ot.prototype=new st,(at.prototype=new O).contains=function(){},(lt.prototype=new at).contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},lt.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},lt.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},lt.prototype.remove=function(t){throw new javascript.util.OperationNotSupported},lt.prototype.size=function(){return this.array_.length},lt.prototype.isEmpty=function(){return 0===this.array_.length},lt.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},lt.prototype.iterator=function(){return new ut(this)};var ut=function(t){this.hashSet_=t,this.position_=0};ut.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new L;return this.hashSet_.array_[this.position_++]},ut.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},ut.prototype.remove=function(){throw new T};function ct(t){return null==t?0:t.color}function ht(t){return null==t?null:t.parent}function dt(t,e){null!==t&&(t.color=e)}function pt(t){return null==t?null:t.left}function ft(t){return null==t?null:t.right}function gt(){this.root_=null,this.size_=0}function mt(){}function _t(){}function yt(){this.array_=[],arguments[0]instanceof O&&this.addAll(arguments[0])}(gt.prototype=new ot).get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(0<n))return e.value;e=e.right}}return null},gt.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=t.compareTo(r.key))<0)r=r.left;else{if(!(0<i)){var s=r.value;return r.value=e,s}r=r.right}}while(null!==r);var o={key:t,left:null,right:null,value:e,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=o:n.right=o,this.fixAfterInsertion(o),this.size_++,null},gt.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!=this.root_&&1==t.parent.color;){var e;ht(t)==pt(ht(ht(t)))?1==ct(e=ft(ht(ht(t))))?(dt(ht(t),0),dt(e,0),dt(ht(ht(t)),1),t=ht(ht(t))):(t==ft(ht(t))&&(t=ht(t),this.rotateLeft(t)),dt(ht(t),0),dt(ht(ht(t)),1),this.rotateRight(ht(ht(t)))):1==ct(e=pt(ht(ht(t))))?(dt(ht(t),0),dt(e,0),dt(ht(ht(t)),1),t=ht(ht(t))):(t==pt(ht(t))&&(t=ht(t),this.rotateRight(t)),dt(ht(t),0),dt(ht(ht(t)),1),this.rotateLeft(ht(ht(t))))}this.root_.color=0},gt.prototype.values=function(){var t=new j,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=gt.successor(e));)t.add(e.value);return t},gt.prototype.entrySet=function(){var t=new lt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=gt.successor(e));)t.add(e);return t},gt.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.left==t?t.parent.left=e:t.parent.right=e,(e.left=t).parent=e}},gt.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.right==t?t.parent.right=e:t.parent.left=e,(e.right=t).parent=e}},gt.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},gt.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}e=t.parent;for(var n=t;null!==e&&n===e.right;)e=(n=e).parent;return e},gt.prototype.size=function(){return this.size_},gt.prototype.containsKey=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(0<n))return!0;e=e.right}}return!1},e(mt.prototype,{interfaces_:function(){return[]},getClass:function(){return mt}}),_t.prototype=new at,(yt.prototype=new _t).contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},yt.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},yt.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},yt.prototype.remove=function(t){throw new T},yt.prototype.size=function(){return this.array_.length},yt.prototype.isEmpty=function(){return 0===this.array_.length},yt.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},yt.prototype.iterator=function(){return new bt(this)};var vt,bt=function(t){this.treeSet_=t,this.position_=0};function xt(){}function Et(){}function St(){}function Ct(){}function Ot(){this._geometries=null;var t=arguments[0],e=arguments[1];if(X.call(this,e),null===t&&(t=[]),X.hasNullElements(t))throw new i("geometries must not contain null elements");this._geometries=t}function It(){var t=arguments[0],e=arguments[1];Ot.call(this,t,e)}function wt(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0];wt.call(this,t,Q.MOD2_BOUNDARY_RULE)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._geom=e,this._geomFact=e.getFactory(),this._bnRule=n}}function Lt(){this.count=null}function Tt(){}function jt(){}function Nt(){}function Mt(){}function Ft(){}function Pt(){}function Rt(){}function Dt(t){this.str=t}function At(){}function kt(){this._points=null;var t=arguments[0],e=arguments[1];X.call(this,e),this.init(t)}function Gt(){}function Bt(){this._coordinates=null;var t=arguments[0],e=arguments[1];X.call(this,e),this.init(t)}function zt(){}function qt(){}function Vt(){this._shell=null,this._holes=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(X.call(this,n),null===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),X.hasNullElements(e))throw new i("holes must not contain null elements");if(t.isEmpty()&&X.hasNonEmptyElements(e))throw new i("shell is empty but holes are not");this._shell=t,this._holes=e}function Ut(){var t=arguments[0],e=arguments[1];Ot.call(this,t,e)}function Wt(){if(arguments[0]instanceof Array&&arguments[1]instanceof le){var t=arguments[0],e=arguments[1];Wt.call(this,e.getCoordinateSequenceFactory().create(t),e)}else if(S(arguments[0],Y)&&arguments[1]instanceof le){var n=arguments[0],i=arguments[1];kt.call(this,n,i),this.validateConstruction()}}function Yt(){var t=arguments[0],e=arguments[1];Ot.call(this,t,e)}function Ht(){if(this._factory=null,this._isUserDataCopied=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._factory=t}}function Jt(){}function Xt(){}function Zt(){}function Qt(){}function Kt(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];Kt.call(this,t,3)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)this._coordinates[n]=new x}else if(S(arguments[0],Y)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;for(this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null),n=0;n<this._coordinates.length;n++)this._coordinates[n]=i.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var r=arguments[0],s=arguments[1];this._coordinates=r,this._dimension=s,null===r&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];for(this._coordinates=new Array(o).fill(null),this._dimension=a,n=0;n<o;n++)this._coordinates[n]=new x}}function $t(){}bt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new L;return this.treeSet_.array_[this.position_++]},bt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},bt.prototype.remove=function(){throw new T},xt.sort=function(){var t,e,n,i,r=arguments[0];if(1===arguments.length)return i=function(t,e){return t.compareTo(e)},void r.sort(i);if(2===arguments.length)n=arguments[1],i=function(t,e){return n.compare(t,e)},r.sort(i);else{if(3===arguments.length){(e=r.slice(arguments[1],arguments[2])).sort();var s=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<s.length;t++)r.push(s[t]);return}if(4===arguments.length){for(e=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(t,e){return n.compare(t,e)},e.sort(i),s=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<s.length;t++)r.push(s[t]);return}}},xt.asList=function(t){for(var e=new j,n=0,i=t.length;n<i;n++)e.add(t[n]);return e},e(Et.prototype,{interfaces_:function(){return[]},getClass:function(){return Et}}),Et.toDimensionSymbol=function(t){switch(t){case Et.FALSE:return Et.SYM_FALSE;case Et.TRUE:return Et.SYM_TRUE;case Et.DONTCARE:return Et.SYM_DONTCARE;case Et.P:return Et.SYM_P;case Et.L:return Et.SYM_L;case Et.A:return Et.SYM_A}throw new i("Unknown dimension value: "+t)},Et.toDimensionValue=function(t){switch(k.toUpperCase(t)){case Et.SYM_FALSE:return Et.FALSE;case Et.SYM_TRUE:return Et.TRUE;case Et.SYM_DONTCARE:return Et.DONTCARE;case Et.SYM_P:return Et.P;case Et.SYM_L:return Et.L;case Et.SYM_A:return Et.A}throw new i("Unknown dimension symbol: "+t)},Et.P=0,Et.L=1,Et.A=2,Et.FALSE=-1,Et.TRUE=-2,Et.DONTCARE=-3,Et.SYM_FALSE="F",Et.SYM_TRUE="T",Et.SYM_DONTCARE="*",Et.SYM_P="0",Et.SYM_L="1",Et.SYM_A="2",e(St.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return St}}),e(Ct.prototype,{filter:function(t,e){},isDone:function(){},isGeometryChanged:function(){},interfaces_:function(){return[]},getClass:function(){return Ct}}),y(Ot,X),e(Ot.prototype,{computeEnvelopeInternal:function(){for(var t=new F,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},getGeometryN:function(t){return this._geometries[t]},getCoordinates:function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this._geometries.length;n++)for(var i=this._geometries[n].getCoordinates(),r=0;r<i.length;r++)t[++e]=i[r];return t},getArea:function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this._geometries.length!==n._geometries.length)return!1;for(var i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(n._geometries[i],e))return!1;return!0}return X.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();xt.sort(this._geometries)},getCoordinate:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},getBoundaryDimension:function(){for(var t=Et.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},getTypeCode:function(){return X.TYPECODE_GEOMETRYCOLLECTION},getDimension:function(){for(var t=Et.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},getLength:function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},getNumPoints:function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},getNumGeometries:function(){return this._geometries.length},reverse:function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=new yt(xt.asList(this._geometries)),n=new yt(xt.asList(t._geometries));return this.compare(e,n)}if(2===arguments.length){for(var i=arguments[1],r=arguments[0],s=this.getNumGeometries(),o=r.getNumGeometries(),a=0;a<s&&a<o;){var l=this.getGeometryN(a),u=r.getGeometryN(a),c=l.compareToSameClass(u,i);if(0!==c)return c;a++}return a<s?1:a<o?-1:0}},apply:function(){if(S(arguments[0],Z))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(S(arguments[0],Ct)){var n=arguments[0];if(0===this._geometries.length)return null;for(e=0;e<this._geometries.length&&(this._geometries[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(S(arguments[0],St)){var i=arguments[0];for(i.filter(this),e=0;e<this._geometries.length;e++)this._geometries[e].apply(i)}else if(S(arguments[0],J)){var r=arguments[0];for(r.filter(this),e=0;e<this._geometries.length;e++)this._geometries[e].apply(r)}},getBoundary:function(){return this.checkNotGeometryCollection(this),b.shouldNeverReachHere(),null},getGeometryType:function(){return X.TYPENAME_GEOMETRYCOLLECTION},copy:function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Ot(t,this._factory)},isEmpty:function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},interfaces_:function(){return[]},getClass:function(){return Ot}}),Ot.serialVersionUID=-0x4f07bcb1f857d800,y(It,Ot),e(It.prototype,{equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&Ot.prototype.equalsExact.call(this,t,e)}return Ot.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return this.isClosed()?Et.FALSE:0},isClosed:function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},getTypeCode:function(){return X.TYPECODE_MULTILINESTRING},getDimension:function(){return 1},reverse:function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[t-1-n]=this._geometries[n].reverse();return this.getFactory().createMultiLineString(e)},getBoundary:function(){return new wt(this).getBoundary()},getGeometryType:function(){return X.TYPENAME_MULTILINESTRING},copy:function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new It(t,this._factory)},interfaces_:function(){return[mt]},getClass:function(){return It}}),It.serialVersionUID=0x7155d2ab4afa8000,e(wt.prototype,{boundaryMultiLineString:function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},getBoundary:function(){return this._geom instanceof kt?this.boundaryLineString(this._geom):this._geom instanceof It?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},boundaryLineString:function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},getEmptyMultiPoint:function(){return this._geomFact.createMultiPoint()},computeBoundaryCoordinates:function(t){var e=new j;this._endpointMap=new gt;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this._endpointMap.entrySet().iterator();r.hasNext();){var s=r.next(),o=s.getValue().count;this._bnRule.isInBoundary(o)&&e.add(s.getKey())}return nt.toCoordinateArray(e)},addEndpoint:function(t){var e=this._endpointMap.get(t);null===e&&(e=new Lt,this._endpointMap.put(t,e)),e.count++},interfaces_:function(){return[]},getClass:function(){return wt}}),wt.getBoundary=function(){return 1===arguments.length?new wt(arguments[0]).getBoundary():2===arguments.length?new wt(arguments[0],arguments[1]).getBoundary():void 0},e(Lt.prototype,{interfaces_:function(){return[]},getClass:function(){return Lt}}),e(Tt.prototype,{interfaces_:function(){return[]},getClass:function(){return Tt}}),Tt.ofLine=function(t){var e=t.size();if(e<=1)return 0;var n=0,i=new x;t.getCoordinate(0,i);for(var r=i.x,s=i.y,o=1;o<e;o++){t.getCoordinate(o,i);var a=i.x,l=i.y,u=a-r,c=l-s;n+=Math.sqrt(u*u+c*c),r=a,s=l}return n},e(Rt.prototype,{interfaces_:function(){return[]},getClass:function(){return Rt}}),Rt.chars=function(t,e){for(var n=new Array(e).fill(null),i=0;i<e;i++)n[i]=t;return new String(n)},Rt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new Mt,n=new jt(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],s="",o=new Pt(new Nt(Rt.getStackTrace(i))),a=0;a<r;a++)try{s+=o.readLine()+Rt.NEWLINE}catch(t){if(!(t instanceof Ft))throw t;b.shouldNeverReachHere()}return s}},Rt.split=function(t,e){for(var n=e.length,i=new j,r=""+t,s=r.indexOf(e);0<=s;){var o=r.substring(0,s);i.add(o),s=(r=r.substring(s+n)).indexOf(e)}0<r.length&&i.add(r);for(var a=new Array(i.size()).fill(null),l=0;l<a.length;l++)a[l]=i.get(l);return a},Rt.toString=function(){if(1===arguments.length&&"number"==typeof arguments[0]){var t=arguments[0];return Rt.SIMPLE_ORDINATE_FORMAT.format(t)}},Rt.spaces=function(t){return Rt.chars(" ",t)},Rt.NEWLINE=q.getProperty("line.separator"),Rt.SIMPLE_ORDINATE_FORMAT=new function(){}("0.#"),Dt.prototype.append=function(t){this.str+=t},Dt.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},Dt.prototype.toString=function(t){return this.str},e(At.prototype,{interfaces_:function(){return[]},getClass:function(){return At}}),At.copyCoord=function(t,e,n,i){for(var r=Math.min(t.getDimension(),n.getDimension()),s=0;s<r;s++)n.setOrdinate(i,s,t.getOrdinate(e,s))},At.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,Y.X)===t.getOrdinate(e-1,Y.X)&&t.getOrdinate(0,Y.Y)===t.getOrdinate(e-1,Y.Y)},At.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),r=0;r<n;r++)for(var o=0;o<i;o++){var a=t.getOrdinate(r,o),l=e.getOrdinate(r,o);if(!(t.getOrdinate(r,o)===e.getOrdinate(r,o)||s.isNaN(a)&&s.isNaN(l)))return!1}return!0},At.extend=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();if(At.copy(e,0,i,0,r),0<r)for(var s=r;s<n;s++)At.copy(e,r-1,i,s,1);return i},At.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),i=0;i<=n;i++)At.swap(t,i,e-i)},At.swap=function(t,e,n){if(e===n)return null;for(var i=0;i<t.getDimension();i++){var r=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,r)}},At.copy=function(t,e,n,i,r){for(var s=0;s<r;s++)At.copyCoord(t,e+s,n,i+s)},At.toString=function(){if(1===arguments.length&&S(arguments[0],Y)){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),i=new Dt;i.append("(");for(var r=0;r<e;r++){0<r&&i.append(" ");for(var s=0;s<n;s++)0<s&&i.append(","),i.append(Rt.toString(t.getOrdinate(r,s)))}return i.append(")"),i.toString()}},At.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?At.createClosedRing(t,e,4):e.getOrdinate(0,Y.X)===e.getOrdinate(n-1,Y.X)&&e.getOrdinate(0,Y.Y)===e.getOrdinate(n-1,Y.Y)?e:At.createClosedRing(t,e,n+1)},At.createClosedRing=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();At.copy(e,0,i,0,r);for(var s=r;s<n;s++)At.copy(e,0,i,s,1);return i},y(kt,X),e(kt.prototype,{computeEnvelopeInternal:function(){return this.isEmpty()?new F:this._points.expandEnvelope(new F)},isRing:function(){return this.isClosed()&&this.isSimple()},getCoordinates:function(){return this._points.toCoordinateArray()},equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this._points.size()!==n._points.size())return!1;for(var i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),n._points.getCoordinate(i),e))return!1;return!0}return X.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e))){if(0<this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))){var n=this._points.copy();At.reverse(n),this._points=n}return null}}},getCoordinate:function(){return this.isEmpty()?null:this._points.getCoordinate(0)},getBoundaryDimension:function(){return this.isClosed()?Et.FALSE:0},isClosed:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},getEndPoint:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},getTypeCode:function(){return X.TYPECODE_LINESTRING},getDimension:function(){return 1},getLength:function(){return Tt.ofLine(this._points)},getNumPoints:function(){return this._points.size()},reverse:function(){var t=this._points.copy();return At.reverse(t),this.getFactory().createLineString(t)},compareToSameClass:function(){if(1===arguments.length){for(var t=arguments[0],e=0,n=0;e<this._points.size()&&n<t._points.size();){var i=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(n));if(0!==i)return i;e++,n++}return e<this._points.size()?1:n<t._points.size()?-1:0}if(2===arguments.length)return t=arguments[0],arguments[1].compare(this._points,t._points)},apply:function(){if(S(arguments[0],Z))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(S(arguments[0],Ct)){var n=arguments[0];if(0===this._points.size())return null;for(e=0;e<this._points.size()&&(n.filter(this._points,e),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else(S(arguments[0],St)||S(arguments[0],J))&&arguments[0].filter(this)},getBoundary:function(){return new wt(this).getBoundary()},isEquivalentClass:function(t){return t instanceof kt},getCoordinateN:function(t){return this._points.getCoordinate(t)},getGeometryType:function(){return X.TYPENAME_LINESTRING},copy:function(){return new kt(this._points.copy(),this._factory)},getCoordinateSequence:function(){return this._points},isEmpty:function(){return 0===this._points.size()},init:function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new i("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},isCoordinate:function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},getStartPoint:function(){return this.isEmpty()?null:this.getPointN(0)},getPointN:function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},interfaces_:function(){return[mt]},getClass:function(){return kt}}),kt.serialVersionUID=0x2b2b51ba435c8e00,e(Gt.prototype,{interfaces_:function(){return[]},getClass:function(){return Gt}}),y(Bt,X),e(Bt.prototype,{computeEnvelopeInternal:function(){if(this.isEmpty())return new F;var t=new F;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},getCoordinates:function(){return this.isEmpty()?[]:[this.getCoordinate()]},equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))}return X.prototype.equalsExact.apply(this,arguments)},normalize:function(){},getCoordinate:function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},getBoundaryDimension:function(){return Et.FALSE},getTypeCode:function(){return X.TYPECODE_POINT},getDimension:function(){return 0},getNumPoints:function(){return this.isEmpty()?0:1},reverse:function(){return this.copy()},getX:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length)return t=arguments[0],arguments[1].compare(this._coordinates,t._coordinates)},apply:function(){if(S(arguments[0],Z)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(S(arguments[0],Ct)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(S(arguments[0],St)||S(arguments[0],J))&&arguments[0].filter(this)},getBoundary:function(){return this.getFactory().createGeometryCollection()},getGeometryType:function(){return X.TYPENAME_POINT},copy:function(){return new Bt(this._coordinates.copy(),this._factory)},getCoordinateSequence:function(){return this._coordinates},getY:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y},isEmpty:function(){return 0===this._coordinates.size()},init:function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),b.isTrue(t.size()<=1),this._coordinates=t},isSimple:function(){return!0},interfaces_:function(){return[Gt]},getClass:function(){return Bt}}),Bt.serialVersionUID=0x44077bad161cbc00,e(zt.prototype,{interfaces_:function(){return[]},getClass:function(){return zt}}),zt.ofRing=function(){if(arguments[0]instanceof Array){var t=arguments[0];return Math.abs(zt.ofRingSigned(t))}if(S(arguments[0],Y)){var e=arguments[0];return Math.abs(zt.ofRingSigned(e))}},zt.ofRingSigned=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++){var r=t[i].x-n,s=t[i+1].y;e+=r*(t[i-1].y-s)}return e/2}if(S(arguments[0],Y)){var o=arguments[0],a=o.size();if(a<3)return 0;var l=new x,u=new x,c=new x;for(o.getCoordinate(0,u),o.getCoordinate(1,c),n=u.x,c.x-=n,e=0,i=1;i<a-1;i++)l.y=u.y,u.x=c.x,u.y=c.y,o.getCoordinate(i+1,c),c.x-=n,e+=u.x*(l.y-c.y);return e/2}},e(qt.prototype,{interfaces_:function(){return[]},getClass:function(){return qt}}),y(Vt,X),e(Vt.prototype,{computeEnvelopeInternal:function(){return this._shell.getEnvelopeInternal()},getCoordinates:function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this._shell.getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];for(var r=0;r<this._holes.length;r++)for(var s=this._holes[r].getCoordinates(),o=0;o<s.length;o++)t[++e]=s[o];return t},getArea:function(){var t=0;t+=zt.ofRing(this._shell.getCoordinateSequence());for(var e=0;e<this._holes.length;e++)t-=zt.ofRing(this._holes[e].getCoordinateSequence());return t},isRectangle:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){if((s=t.getX(n))!==e.getMinX()&&s!==e.getMaxX())return!1;if((o=t.getY(n))!==e.getMinY()&&o!==e.getMaxY())return!1}var i=t.getX(0),r=t.getY(0);for(n=1;n<=4;n++){var s,o;if((s=t.getX(n))!==i==((o=t.getY(n))!==r))return!1;i=s,r=o}return!0},equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t,i=this._shell,r=n._shell;if(!i.equalsExact(r,e))return!1;if(this._holes.length!==n._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(n._holes[s],e))return!1;return!0}return X.prototype.equalsExact.apply(this,arguments)},normalize:function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);xt.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var i=new Array(e.getCoordinates().length-1).fill(null);q.arraycopy(e.getCoordinates(),0,i,0,i.length);var r=nt.minCoordinate(e.getCoordinates());nt.scroll(i,r),q.arraycopy(i,0,e.getCoordinates(),0,i.length),e.getCoordinates()[i.length]=i[0],z.isCCW(e.getCoordinates())===n&&nt.reverse(e.getCoordinates())}},getCoordinate:function(){return this._shell.getCoordinate()},getNumInteriorRing:function(){return this._holes.length},getBoundaryDimension:function(){return 1},getTypeCode:function(){return X.TYPECODE_POLYGON},getDimension:function(){return 2},getLength:function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},getNumPoints:function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},reverse:function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},convexHull:function(){return this.getExteriorRing().convexHull()},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=this._shell,n=t._shell;return e.compareToSameClass(n)}if(2===arguments.length){var i=arguments[1],r=arguments[0],s=(e=this._shell,n=r._shell,e.compareToSameClass(n,i));if(0!==s)return s;for(var o=this.getNumInteriorRing(),a=r.getNumInteriorRing(),l=0;l<o&&l<a;){var u=this.getInteriorRingN(l),c=r.getInteriorRingN(l),h=u.compareToSameClass(c,i);if(0!==h)return h;l++}return l<o?1:l<a?-1:0}},apply:function(){if(S(arguments[0],Z)){var t=arguments[0];this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(S(arguments[0],Ct)){var n=arguments[0];if(this._shell.apply(n),!n.isDone())for(e=0;e<this._holes.length&&(this._holes[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(S(arguments[0],St))arguments[0].filter(this);else if(S(arguments[0],J)){var i=arguments[0];for(i.filter(this),this._shell.apply(i),e=0;e<this._holes.length;e++)this._holes[e].apply(i)}},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},getGeometryType:function(){return X.TYPENAME_POLYGON},copy:function(){for(var t=this._shell.copy(),e=new Array(this._holes.length).fill(null),n=0;n<this._holes.length;n++)e[n]=this._holes[n].copy();return new Vt(t,e,this._factory)},getExteriorRing:function(){return this._shell},isEmpty:function(){return this._shell.isEmpty()},getInteriorRingN:function(t){return this._holes[t]},interfaces_:function(){return[qt]},getClass:function(){return Vt}}),Vt.serialVersionUID=-0x307ffefd8dc97200,y(Ut,Ot),e(Ut.prototype,{isValid:function(){return!0},equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&Ot.prototype.equalsExact.call(this,t,e)}return Ot.prototype.equalsExact.apply(this,arguments)},getCoordinate:function(){if(1===arguments.length&&Number.isInteger(arguments[0])){var t=arguments[0];return this._geometries[t].getCoordinate()}return Ot.prototype.getCoordinate.apply(this,arguments)},getBoundaryDimension:function(){return Et.FALSE},getTypeCode:function(){return X.TYPECODE_MULTIPOINT},getDimension:function(){return 0},getBoundary:function(){return this.getFactory().createGeometryCollection()},getGeometryType:function(){return X.TYPENAME_MULTIPOINT},copy:function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Ut(t,this._factory)},interfaces_:function(){return[Gt]},getClass:function(){return Ut}}),Ut.serialVersionUID=-0x6fb1ed4162e0fc00,y(Wt,kt),e(Wt.prototype,{getBoundaryDimension:function(){return Et.FALSE},isClosed:function(){return!!this.isEmpty()||kt.prototype.isClosed.call(this)},getTypeCode:function(){return X.TYPECODE_LINEARRING},reverse:function(){var t=this._points.copy();return At.reverse(t),this.getFactory().createLinearRing(t)},validateConstruction:function(){if(!this.isEmpty()&&!kt.prototype.isClosed.call(this))throw new i("Points of LinearRing do not form a closed linestring");if(1<=this.getCoordinateSequence().size()&&this.getCoordinateSequence().size()<Wt.MINIMUM_VALID_SIZE)throw new i("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},getGeometryType:function(){return X.TYPENAME_LINEARRING},copy:function(){return new Wt(this._points.copy(),this._factory)},interfaces_:function(){return[]},getClass:function(){return Wt}}),Wt.MINIMUM_VALID_SIZE=4,Wt.serialVersionUID=-0x3b229e262367a600,y(Yt,Ot),e(Yt.prototype,{equalsExact:function(){if(2===arguments.length&&"number"==typeof arguments[1]&&arguments[0]instanceof X){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&Ot.prototype.equalsExact.call(this,t,e)}return Ot.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return 1},getTypeCode:function(){return X.TYPECODE_MULTIPOLYGON},getDimension:function(){return 2},reverse:function(){for(var t=this._geometries.length,e=new Array(t).fill(null),n=0;n<this._geometries.length;n++)e[n]=this._geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new j,e=0;e<this._geometries.length;e++)for(var n=this._geometries[e].getBoundary(),i=0;i<n.getNumGeometries();i++)t.add(n.getGeometryN(i));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))},getGeometryType:function(){return X.TYPENAME_MULTIPOLYGON},copy:function(){for(var t=new Array(this._geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Yt(t,this._factory)},interfaces_:function(){return[qt]},getClass:function(){return Yt}}),Yt.serialVersionUID=-0x7a5aa1369171980,e(Ht.prototype,{setCopyUserData:function(t){this._isUserDataCopied=t},edit:function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n},editInternal:function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Ot?this.editGeometryCollection(t,e):t instanceof Vt?this.editPolygon(t,e):t instanceof Bt||t instanceof kt?e.edit(t,this._factory):(b.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},editGeometryCollection:function(t,e){for(var n=e.edit(t,this._factory),i=new j,r=0;r<n.getNumGeometries();r++){var s=this.edit(n.getGeometryN(r),e);null===s||s.isEmpty()||i.add(s)}return n.getClass()===Ut?this._factory.createMultiPoint(i.toArray([])):n.getClass()===It?this._factory.createMultiLineString(i.toArray([])):n.getClass()===Yt?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))},editPolygon:function(t,e){var n=e.edit(t,this._factory);if(null===n&&(n=this._factory.createPolygon()),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),e);if(null===i||i.isEmpty())return this._factory.createPolygon();for(var r=new j,s=0;s<n.getNumInteriorRing();s++){var o=this.edit(n.getInteriorRingN(s),e);null===o||o.isEmpty()||r.add(o)}return this._factory.createPolygon(i,r.toArray([]))},interfaces_:function(){return[]},getClass:function(){return Ht}}),Ht.GeometryEditorOperation=Jt,e(Xt.prototype,{edit:function(t,e){return t},interfaces_:function(){return[Jt]},getClass:function(){return Xt}}),e(Zt.prototype,{edit:function(t,e){var n=this.edit(t.getCoordinates(),t);return t instanceof Wt?null===n?e.createLinearRing():e.createLinearRing(n):t instanceof kt?null===n?e.createLineString():e.createLineString(n):t instanceof Bt?null===n||0===n.length?e.createPoint():e.createPoint(n[0]):t},interfaces_:function(){return[Jt]},getClass:function(){return Zt}}),e(Qt.prototype,{edit:function(t,e){return t instanceof Wt?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof kt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Bt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},interfaces_:function(){return[Jt]},getClass:function(){return Qt}}),Ht.NoOpGeometryOperation=Xt,Ht.CoordinateOperation=Zt,Ht.CoordinateSequenceOperation=Qt,e(Kt.prototype,{setOrdinate:function(t,e,n){switch(e){case Y.X:this._coordinates[t].x=n;break;case Y.Y:this._coordinates[t].y=n;break;case Y.Z:this._coordinates[t].z=n;break;default:throw new i("invalid ordinateIndex")}},size:function(){return this._coordinates.length},getOrdinate:function(t,e){switch(e){case Y.X:return this._coordinates[t].x;case Y.Y:return this._coordinates[t].y;case Y.Z:return this._coordinates[t].z}return s.NaN},getCoordinate:function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}},getCoordinateCopy:function(t){return new x(this._coordinates[t])},getDimension:function(){return this._dimension},getX:function(t){return this._coordinates[t].x},expandEnvelope:function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},copy:function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new Kt(t,this._dimension)},toString:function(){if(0<this._coordinates.length){var t=new Dt(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},getY:function(t){return this._coordinates[t].y},toCoordinateArray:function(){return this._coordinates},interfaces_:function(){return[Y,m]},getClass:function(){return Kt}}),Kt.serialVersionUID=-0xcb44a778db18e00,e($t.prototype,{readResolve:function(){return $t.instance()},create:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Kt(arguments[0]);if(S(arguments[0],Y))return new Kt(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return 3<e&&(e=3),e<2?new Kt(t):new Kt(t,e)}},interfaces_:function(){return[H,m]},getClass:function(){return $t}}),$t.instance=function(){return $t.instanceObject},$t.serialVersionUID=-0x38e49fa6cf6f2e00,$t.instanceObject=new $t;var te=Object.defineProperty,ee=function(t,e){function n(t){if(!this||this.constructor!==n)return new n(t);this._keys=[],this._values=[],this._itp=[],this.objectOnly=e,t&&function(t){this.add?t.forEach(this.add,this):t.forEach((function(t){this.set(t[0],t[1])}),this)}.call(this,t)}return te(t,"size",{get:ie}),(t.constructor=n).prototype=t,n}({delete:function(t){return this.has(t)&&(this._keys.splice(vt,1),this._values.splice(vt,1),this._itp.forEach((function(t){vt<t[0]&&t[0]--}))),-1<vt},has:function(t){return function(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!=e||0===e)for(vt=t.length;vt--&&(n=t[vt])!==(i=e)&&(n==n||i==i););else vt=t.indexOf(e);var n,i;return-1<vt}.call(this,this._keys,t)},get:function(t){return this.has(t)?this._values[vt]:void 0},set:function(t,e){return this.has(t)?this._values[vt]=e:this._values[this._keys.push(t)-1]=e,this},keys:function(){return ne(this._itp,this._keys)},values:function(){return ne(this._itp,this._values)},entries:function(){return ne(this._itp,this._keys,this._values)},forEach:function(t,e){for(var n=this.entries();;){var i=n.next();if(i.done)break;t.call(e,i.value[1],i.value[0],this)}},clear:function(){(this._keys||0).length=this._values.length=0}});function ne(t,e,n){var i=[0],r=!1;return t.push(i),{next:function(){var s,o=i[0];return!r&&o<e.length?(s=n?[e[o],n[o]]:e[o],i[0]++):(r=!0,t.splice(t.indexOf(i),1)),{done:r,value:s}}}}function ie(){return this._values.length}var re="undefined"!=typeof Map&&Map.prototype.values?Map:ee;function se(){this.map_=new re}function oe(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=oe.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof ae){var t=arguments[0];(this._modelType=t)===oe.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var e=arguments[0];this._modelType=oe.FIXED,this.setScale(e)}else if(arguments[0]instanceof oe){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}function ae(){this._name=null;var t=arguments[0];this._name=t,ae.nameToTypeMap.put(t,this)}function le(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,0===arguments.length)le.call(this,new oe,0);else if(1===arguments.length){if(S(arguments[0],H)){var t=arguments[0];le.call(this,new oe,0,t)}else if(arguments[0]instanceof oe){var e=arguments[0];le.call(this,e,0,le.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];le.call(this,n,i,le.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this._precisionModel=r,this._coordinateSequenceFactory=o,this._SRID=s}}(se.prototype=new st).get=function(t){return this.map_.get(t)||null},se.prototype.put=function(t,e){return this.map_.set(t,e),e},se.prototype.values=function(){for(var t=new j,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},se.prototype.entrySet=function(){var t=new lt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},se.prototype.size=function(){return this.map_.size()},e(oe.prototype,{equals:function(t){if(!(t instanceof oe))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},compareTo:function(t){var e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return new A(n).compareTo(new A(i))},getScale:function(){return this._scale},isFloating:function(){return this._modelType===oe.FLOATING||this._modelType===oe.FLOATING_SINGLE},getType:function(){return this._modelType},toString:function(){var t="UNKNOWN";return this._modelType===oe.FLOATING?t="Floating":this._modelType===oe.FLOATING_SINGLE?t="Floating-Single":this._modelType===oe.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},makePrecise:function(){if("number"==typeof arguments[0]){var t=arguments[0];return s.isNaN(t)?t:this._modelType!==oe.FLOATING_SINGLE&&this._modelType===oe.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof x){var e=arguments[0];if(this._modelType===oe.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},getMaximumSignificantDigits:function(){var t=16;return this._modelType===oe.FLOATING?t=16:this._modelType===oe.FLOATING_SINGLE?t=6:this._modelType===oe.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},setScale:function(t){this._scale=Math.abs(t)},interfaces_:function(){return[m,p]},getClass:function(){return oe}}),oe.mostPrecise=function(t,e){return 0<=t.compareTo(e)?t:e},e(ae.prototype,{readResolve:function(){return ae.nameToTypeMap.get(this._name)},toString:function(){return this._name},interfaces_:function(){return[m]},getClass:function(){return ae}}),ae.serialVersionUID=-552860263173159e4,ae.nameToTypeMap=new se,oe.Type=ae,oe.serialVersionUID=0x6bee6404e9a25c00,oe.FIXED=new ae("FIXED"),oe.FLOATING=new ae("FLOATING"),oe.FLOATING_SINGLE=new ae("FLOATING SINGLE"),oe.maximumPreciseValue=9007199254740992,e(le.prototype,{toGeometry:function(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new x(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new x(t.getMinX(),t.getMinY()),new x(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new x(t.getMinX(),t.getMinY()),new x(t.getMinX(),t.getMaxY()),new x(t.getMaxX(),t.getMaxY()),new x(t.getMaxX(),t.getMinY()),new x(t.getMinX(),t.getMinY())]),null)},createLineString:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLineString(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(S(arguments[0],Y))return new kt(arguments[0],this)}},createMultiLineString:function(){return 0===arguments.length?new It(null,this):1===arguments.length?new It(arguments[0],this):void 0},buildGeometry:function(t){for(var e=null,n=!1,i=!1,r=t.iterator();r.hasNext();){var s=r.next(),o=s.getClass();null===e&&(e=o),o!==e&&(n=!0),s instanceof Ot&&(i=!0)}if(null===e)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(le.toGeometryArray(t));var a=t.iterator().next();if(1<t.size()){if(a instanceof Vt)return this.createMultiPolygon(le.toPolygonArray(t));if(a instanceof kt)return this.createMultiLineString(le.toLineStringArray(t));if(a instanceof Bt)return this.createMultiPoint(le.toPointArray(t));b.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},createMultiPointFromCoords:function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},createPoint:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(S(arguments[0],Y))return new Bt(arguments[0],this)}},getCoordinateSequenceFactory:function(){return this._coordinateSequenceFactory},createPolygon:function(){if(0===arguments.length)return this.createPolygon(null,null);if(1===arguments.length){if(S(arguments[0],Y)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Wt){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length)return new Vt(arguments[0],arguments[1],this)},getSRID:function(){return this._SRID},createGeometryCollection:function(){return 0===arguments.length?new Ot(null,this):1===arguments.length?new Ot(arguments[0],this):void 0},createGeometry:function(t){return new Ht(this).edit(t,{edit:function(){if(2===arguments.length&&arguments[1]instanceof X&&S(arguments[0],Y)){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},getPrecisionModel:function(){return this._precisionModel},createLinearRing:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(S(arguments[0],Y))return new Wt(arguments[0],this)}},createMultiPolygon:function(){return 0===arguments.length?new Yt(null,this):1===arguments.length?new Yt(arguments[0],this):void 0},createMultiPoint:function(){if(0===arguments.length)return new Ut(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ut(arguments[0],this);if(S(arguments[0],Y)){var t=arguments[0];if(null===t)return this.createMultiPoint(new Array(0).fill(null));for(var e=new Array(t.size()).fill(null),n=0;n<t.size();n++){var i=this.getCoordinateSequenceFactory().create(1,t.getDimension());At.copy(t,n,i,0,1),e[n]=this.createPoint(i)}return this.createMultiPoint(e)}}},interfaces_:function(){return[m]},getClass:function(){return le}}),le.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},le.getDefaultCoordinateSequenceFactory=function(){return $t.instance()},le.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},le.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},le.serialVersionUID=-0x5ea75f2051eeb400;var ue={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};function ce(t){this.geometryFactory=t||new le,this.precisionModel=this.geometryFactory.getPrecisionModel()}e(ce.prototype,{read:function(t){var e,n,i;t=t.replace(/[\n\r]/g," ");var r=ue.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((r=ue.emptyTypeStr.exec(t))[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],de[n]&&(e=de[n].call(this,i))),void 0===e)throw new Error("Could not parse WKT "+t);return e},write:function(t){return this.extractGeometry(t)},extractGeometry:function(t){var e=t.getGeometryType().toLowerCase();if(!he[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+he[e].call(this,t)+")"}});var he={coordinate:function(t){return t.x+" "+t.y},point:function(t){return he.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],n=0,i=t._geometries.length;n<i;++n)e.push("("+he.point.call(this,t._geometries[n])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,i=t._points._coordinates.length;n<i;++n)e.push(he.coordinate.call(this,t._points._coordinates[n]));return e.join(",")},linearring:function(t){for(var e=[],n=0,i=t._points._coordinates.length;n<i;++n)e.push(he.coordinate.call(this,t._points._coordinates[n]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,i=t._geometries.length;n<i;++n)e.push("("+he.linestring.call(this,t._geometries[n])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+he.linestring.call(this,t._shell)+")");for(var n=0,i=t._holes.length;n<i;++n)e.push("("+he.linestring.call(this,t._holes[n])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,i=t._geometries.length;n<i;++n)e.push("("+he.polygon.call(this,t._geometries[n])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,i=t._geometries.length;n<i;++n)e.push(this.extractGeometry(t._geometries[n]));return e.join(",")}},de={coord:function(t){var e=t.trim().split(ue.spaces),n=new x(Number.parseFloat(e[0]),Number.parseFloat(e[1]));return this.precisionModel.makePrecise(n),n},point:function(t){return void 0===t?this.geometryFactory.createPoint():this.geometryFactory.createPoint(de.coord.call(this,t))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,n=t.trim().split(","),i=[],r=0,s=n.length;r<s;++r)e=n[r].replace(ue.trimParens,"$1"),i.push(de.point.call(this,e));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],i=0,r=e.length;i<r;++i)n.push(de.coord.call(this,e[i]));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],i=0,r=e.length;i<r;++i)n.push(de.coord.call(this,e[i]));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,n=t.trim().split(ue.parenComma),i=[],r=0,s=n.length;r<s;++r)e=n[r].replace(ue.trimParens,"$1"),i.push(de.linestring.call(this,e));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,n,i,r,s=t.trim().split(ue.parenComma),o=[],a=0,l=s.length;a<l;++a)e=s[a].replace(ue.trimParens,"$1"),n=de.linestring.call(this,e),i=this.geometryFactory.createLinearRing(n._points),0===a?r=i:o.push(i);return this.geometryFactory.createPolygon(r,o)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,n=t.trim().split(ue.doubleParenComma),i=[],r=0,s=n.length;r<s;++r)e=n[r].replace(ue.trimParens,"$1"),i.push(de.polygon.call(this,e));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],i=0,r=e.length;i<r;++i)n.push(this.read(e[i]));return this.geometryFactory.createGeometryCollection(n)}};function pe(t){this.parser=new ce(t)}function fe(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new x,this._intPt[1]=new x,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}function ge(){fe.apply(this)}function me(){if(this.p0=null,this.p1=null,0===arguments.length)me.call(this,new x,new x);else if(1===arguments.length){var t=arguments[0];me.call(this,t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0=e,this.p1=n}else if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];me.call(this,new x(i,r),new x(s,o))}}function _e(){}function ye(){if(this._matrix=null,0===arguments.length)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(Et.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];ye.call(this),this.set(t)}else if(arguments[0]instanceof ye){var e=arguments[0];ye.call(this),this._matrix[_e.INTERIOR][_e.INTERIOR]=e._matrix[_e.INTERIOR][_e.INTERIOR],this._matrix[_e.INTERIOR][_e.BOUNDARY]=e._matrix[_e.INTERIOR][_e.BOUNDARY],this._matrix[_e.INTERIOR][_e.EXTERIOR]=e._matrix[_e.INTERIOR][_e.EXTERIOR],this._matrix[_e.BOUNDARY][_e.INTERIOR]=e._matrix[_e.BOUNDARY][_e.INTERIOR],this._matrix[_e.BOUNDARY][_e.BOUNDARY]=e._matrix[_e.BOUNDARY][_e.BOUNDARY],this._matrix[_e.BOUNDARY][_e.EXTERIOR]=e._matrix[_e.BOUNDARY][_e.EXTERIOR],this._matrix[_e.EXTERIOR][_e.INTERIOR]=e._matrix[_e.EXTERIOR][_e.INTERIOR],this._matrix[_e.EXTERIOR][_e.BOUNDARY]=e._matrix[_e.EXTERIOR][_e.BOUNDARY],this._matrix[_e.EXTERIOR][_e.EXTERIOR]=e._matrix[_e.EXTERIOR][_e.EXTERIOR]}}function ve(){}function be(){this.p0=null,this.p1=null,this.p2=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.p0=t,this.p1=e,this.p2=n}e(pe.prototype,{write:function(t){return this.parser.write(t)}}),e(pe,{toLineString:function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}),e(fe.prototype,{getIndexAlongSegment:function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},getTopologySummary:function(){var t=new Dt;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},computeIntersection:function(t,e,n,i){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(t,e,n,i)},getIntersectionNum:function(){return this._result},computeIntLineIndex:function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);this._intLineIndex[t][1]=n<e?(this._intLineIndex[t][0]=0,1):(this._intLineIndex[t][0]=1,0)}},isProper:function(){return this.hasIntersection()&&this._isProper},setPrecisionModel:function(t){this._precisionModel=t},isInteriorIntersection:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},getIntersection:function(t){return this._intPt[t]},isEndPoint:function(){return this.hasIntersection()&&!this._isProper},hasIntersection:function(){return this._result!==fe.NO_INTERSECTION},getEdgeDistance:function(t,e){return fe.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},isCollinear:function(){return this._result===fe.COLLINEAR_INTERSECTION},toString:function(){return pe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+pe.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},getEndpoint:function(t,e){return this._inputLines[t][e]},isIntersection:function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},getIntersectionAlongSegment:function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},interfaces_:function(){return[]},getClass:function(){return fe}}),fe.computeEdgeDistance=function(t,e,n){var i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y),s=-1;if(t.equals(e))s=0;else if(t.equals(n))s=r<i?i:r;else{var o=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(s=r<i?o:a)||t.equals(e)||(s=Math.max(o,a))}return b.isTrue(!(0===s&&!t.equals(e)),"Bad distance calculation"),s},fe.nonRobustComputeEdgeDistance=function(t,e,n){var i=t.x-e.x,r=t.y-e.y,s=Math.sqrt(i*i+r*r);return b.isTrue(!(0===s&&!t.equals(e)),"Invalid distance calculation"),s},fe.DONT_INTERSECT=0,fe.DO_INTERSECT=1,fe.COLLINEAR=2,fe.NO_INTERSECTION=0,fe.POINT_INTERSECTION=1,fe.COLLINEAR_INTERSECTION=2,y(ge,fe),e(ge.prototype,{isInSegmentEnvelopes:function(t){var e=new F(this._inputLines[0][0],this._inputLines[0][1]),n=new F(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)},computeIntersection:function(){if(3!==arguments.length)return fe.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2];if(this._isProper=!1,F.intersects(e,n,t)&&0===z.index(e,n,t)&&0===z.index(n,e,t))return this._isProper=!0,(t.equals(e)||t.equals(n))&&(this._isProper=!1),this._result=fe.POINT_INTERSECTION,null;this._result=fe.NO_INTERSECTION},normalizeToMinimum:function(t,e,n,i,r){r.x=this.smallestInAbsValue(t.x,e.x,n.x,i.x),r.y=this.smallestInAbsValue(t.y,e.y,n.y,i.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},safeHCoordinateIntersection:function(t,e,n,i){var r=null;try{r=V.intersection(t,e,n,i)}catch(s){if(!(s instanceof R))throw s;r=ge.nearestEndpoint(t,e,n,i)}return r},intersection:function(t,e,n,i){var r=this.intersectionWithNormalization(t,e,n,i);return this.isInSegmentEnvelopes(r)||(r=new x(ge.nearestEndpoint(t,e,n,i))),null!==this._precisionModel&&this._precisionModel.makePrecise(r),r},smallestInAbsValue:function(t,e,n,i){var r=t,s=Math.abs(r);return Math.abs(e)<s&&(r=e,s=Math.abs(e)),Math.abs(n)<s&&(r=n,s=Math.abs(n)),Math.abs(i)<s&&(r=i),r},checkDD:function(t,e,n,i,r){var s=B.intersection(t,e,n,i),o=this.isInSegmentEnvelopes(s);q.out.println("DD in env = "+o+"  --------------------- "+s),1e-4<r.distance(s)&&q.out.println("Distance = "+r.distance(s))},intersectionWithNormalization:function(t,e,n,i){var r=new x(t),s=new x(e),o=new x(n),a=new x(i),l=new x;this.normalizeToEnvCentre(r,s,o,a,l);var u=this.safeHCoordinateIntersection(r,s,o,a);return u.x+=l.x,u.y+=l.y,u},computeCollinearIntersection:function(t,e,n,i){var r=F.intersects(t,e,n),s=F.intersects(t,e,i),o=F.intersects(n,i,t),a=F.intersects(n,i,e);return r&&s?(this._intPt[0]=n,this._intPt[1]=i,fe.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=t,this._intPt[1]=e,fe.COLLINEAR_INTERSECTION):r&&o?(this._intPt[0]=n,this._intPt[1]=t,!n.equals(t)||s||a?fe.COLLINEAR_INTERSECTION:fe.POINT_INTERSECTION):r&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||o?fe.COLLINEAR_INTERSECTION:fe.POINT_INTERSECTION):s&&o?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||r||a?fe.COLLINEAR_INTERSECTION:fe.POINT_INTERSECTION):s&&a?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||r||o?fe.COLLINEAR_INTERSECTION:fe.POINT_INTERSECTION):fe.NO_INTERSECTION},normalizeToEnvCentre:function(t,e,n,i,r){var s=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,u=n.x<i.x?n.x:i.x,c=n.y<i.y?n.y:i.y,h=n.x>i.x?n.x:i.x,d=n.y>i.y?n.y:i.y,p=((u<s?s:u)+(a<h?a:h))/2,f=((c<o?o:c)+(l<d?l:d))/2;r.x=p,r.y=f,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},computeIntersect:function(t,e,n,i){if(this._isProper=!1,!F.intersects(t,e,n,i))return fe.NO_INTERSECTION;var r=z.index(t,e,n),s=z.index(t,e,i);if(0<r&&0<s||r<0&&s<0)return fe.NO_INTERSECTION;var o=z.index(n,i,t),a=z.index(n,i,e);return 0<o&&0<a||o<0&&a<0?fe.NO_INTERSECTION:0===r&&0===s&&0===o&&0===a?this.computeCollinearIntersection(t,e,n,i):(0===r||0===s||0===o||0===a?(this._isProper=!1,t.equals2D(n)||t.equals2D(i)?this._intPt[0]=t:e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:0===r?this._intPt[0]=new x(n):0===s?this._intPt[0]=new x(i):0===o?this._intPt[0]=new x(t):0===a&&(this._intPt[0]=new x(e))):(this._isProper=!0,this._intPt[0]=this.intersection(t,e,n,i)),fe.POINT_INTERSECTION)},interfaces_:function(){return[]},getClass:function(){return ge}}),ge.nearestEndpoint=function(t,e,n,i){var r=t,s=W.pointToSegment(t,n,i),o=W.pointToSegment(e,n,i);return o<s&&(s=o,r=e),(o=W.pointToSegment(n,t,e))<s&&(s=o,r=n),(o=W.pointToSegment(i,t,e))<s&&(s=o,r=i),r},e(me.prototype,{minX:function(){return Math.min(this.p0.x,this.p1.x)},orientationIndex:function(){if(arguments[0]instanceof me){var t=arguments[0],e=z.index(this.p0,this.p1,t.p0),n=z.index(this.p0,this.p1,t.p1);return 0<=e&&0<=n||e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof x){var i=arguments[0];return z.index(this.p0,this.p1,i)}},toGeometry:function(t){return t.createLineString([this.p0,this.p1])},isVertical:function(){return this.p0.x===this.p1.x},equals:function(t){if(!(t instanceof me))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},intersection:function(t){var e=new ge;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},project:function(){if(arguments[0]instanceof x){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new x(t);var e=this.projectionFactor(t),n=new x;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof me){var i=arguments[0],r=this.projectionFactor(i.p0),s=this.projectionFactor(i.p1);if(1<=r&&1<=s)return null;if(r<=0&&s<=0)return null;var o=this.project(i.p0);r<0&&(o=this.p0),1<r&&(o=this.p1);var a=this.project(i.p1);return s<0&&(a=this.p0),1<s&&(a=this.p1),new me(o,a)}},normalize:function(){this.p1.compareTo(this.p0)<0&&this.reverse()},angle:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},getCoordinate:function(t){return 0===t?this.p0:this.p1},distancePerpendicular:function(t){return W.pointToLinePerpendicular(t,this.p0,this.p1)},minY:function(){return Math.min(this.p0.y,this.p1.y)},midPoint:function(){return me.midPoint(this.p0,this.p1)},projectionFactor:function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=e*e+n*n;return i<=0?s.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/i},closestPoints:function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),i=s.MAX_VALUE,r=null,o=this.closestPoint(t.p0);i=o.distance(t.p0),n[0]=o,n[1]=t.p0;var a=this.closestPoint(t.p1);(r=a.distance(t.p1))<i&&(i=r,n[0]=a,n[1]=t.p1);var l=t.closestPoint(this.p0);(r=l.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=l);var u=t.closestPoint(this.p1);return(r=u.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=u),n},closestPoint:function(t){var e=this.projectionFactor(t);return 0<e&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},maxX:function(){return Math.max(this.p0.x,this.p1.x)},getLength:function(){return this.p0.distance(this.p1)},compareTo:function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},reverse:function(){var t=this.p0;this.p0=this.p1,this.p1=t},equalsTopo:function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)},lineIntersection:function(t){try{return V.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof R))throw t}return null},maxY:function(){return Math.max(this.p0.y,this.p1.y)},pointAlongOffset:function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,s=this.p1.y-this.p0.y,o=Math.sqrt(r*r+s*s),a=0,l=0;if(0!==e){if(o<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");a=e*r/o,l=e*s/o}return new x(n-l,i+a)},setCoordinates:function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},segmentFraction:function(t){var e=this.projectionFactor(t);return e<0?e=0:(1<e||s.isNaN(e))&&(e=1),e},toString:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},isHorizontal:function(){return this.p0.y===this.p1.y},distance:function(){if(arguments[0]instanceof me){var t=arguments[0];return W.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof x){var e=arguments[0];return W.pointToSegment(e,this.p0,this.p1)}},pointAlong:function(t){var e=new x;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},hashCode:function(){var t=java.lang.Double.doubleToLongBits(this.p0.x);t^=31*java.lang.Double.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=java.lang.Double.doubleToLongBits(this.p1.x);return n^=31*java.lang.Double.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},interfaces_:function(){return[p,m]},getClass:function(){return me}}),me.midPoint=function(t,e){return new x((t.x+e.x)/2,(t.y+e.y)/2)},me.serialVersionUID=0x2d2172135f411c00,e(_e.prototype,{interfaces_:function(){return[]},getClass:function(){return _e}}),_e.toLocationSymbol=function(t){switch(t){case _e.EXTERIOR:return"e";case _e.BOUNDARY:return"b";case _e.INTERIOR:return"i";case _e.NONE:return"-"}throw new i("Unknown location value: "+t)},_e.INTERIOR=0,_e.BOUNDARY=1,_e.EXTERIOR=2,_e.NONE=-1,e(ye.prototype,{isIntersects:function(){return!this.isDisjoint()},isCovers:function(){return(ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])||ye.isTrue(this._matrix[_e.INTERIOR][_e.BOUNDARY])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.INTERIOR])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.BOUNDARY]))&&this._matrix[_e.EXTERIOR][_e.INTERIOR]===Et.FALSE&&this._matrix[_e.EXTERIOR][_e.BOUNDARY]===Et.FALSE},isCoveredBy:function(){return(ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])||ye.isTrue(this._matrix[_e.INTERIOR][_e.BOUNDARY])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.INTERIOR])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.BOUNDARY]))&&this._matrix[_e.INTERIOR][_e.EXTERIOR]===Et.FALSE&&this._matrix[_e.BOUNDARY][_e.EXTERIOR]===Et.FALSE},set:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this._matrix[n][i]=Et.toDimensionValue(t.charAt(e))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this._matrix[r][s]=o}},isContains:function(){return ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&this._matrix[_e.EXTERIOR][_e.INTERIOR]===Et.FALSE&&this._matrix[_e.EXTERIOR][_e.BOUNDARY]===Et.FALSE},setAtLeast:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.setAtLeast(n,i,Et.toDimensionValue(t.charAt(e)))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this._matrix[r][s]<o&&(this._matrix[r][s]=o)}},setAtLeastIfValid:function(t,e,n){0<=t&&0<=e&&this.setAtLeast(t,e,n)},isWithin:function(){return ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&this._matrix[_e.INTERIOR][_e.EXTERIOR]===Et.FALSE&&this._matrix[_e.BOUNDARY][_e.EXTERIOR]===Et.FALSE},isTouches:function(t,e){return e<t?this.isTouches(e,t):(t===Et.A&&e===Et.A||t===Et.L&&e===Et.L||t===Et.L&&e===Et.A||t===Et.P&&e===Et.A||t===Et.P&&e===Et.L)&&this._matrix[_e.INTERIOR][_e.INTERIOR]===Et.FALSE&&(ye.isTrue(this._matrix[_e.INTERIOR][_e.BOUNDARY])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.INTERIOR])||ye.isTrue(this._matrix[_e.BOUNDARY][_e.BOUNDARY]))},isOverlaps:function(t,e){return t===Et.P&&e===Et.P||t===Et.A&&e===Et.A?ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&ye.isTrue(this._matrix[_e.INTERIOR][_e.EXTERIOR])&&ye.isTrue(this._matrix[_e.EXTERIOR][_e.INTERIOR]):t===Et.L&&e===Et.L&&1===this._matrix[_e.INTERIOR][_e.INTERIOR]&&ye.isTrue(this._matrix[_e.INTERIOR][_e.EXTERIOR])&&ye.isTrue(this._matrix[_e.EXTERIOR][_e.INTERIOR])},isEquals:function(t,e){return t===e&&ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&this._matrix[_e.INTERIOR][_e.EXTERIOR]===Et.FALSE&&this._matrix[_e.BOUNDARY][_e.EXTERIOR]===Et.FALSE&&this._matrix[_e.EXTERIOR][_e.INTERIOR]===Et.FALSE&&this._matrix[_e.EXTERIOR][_e.BOUNDARY]===Et.FALSE},toString:function(){for(var t=new Dt("123456789"),e=0;e<3;e++)for(var n=0;n<3;n++)t.setCharAt(3*e+n,Et.toDimensionSymbol(this._matrix[e][n]));return t.toString()},setAll:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this._matrix[e][n]=t},get:function(t,e){return this._matrix[t][e]},transpose:function(){var t=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=t,t=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=t,t=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=t,this},matches:function(t){if(9!==t.length)throw new i("Should be length 9: "+t);for(var e=0;e<3;e++)for(var n=0;n<3;n++)if(!ye.matches(this._matrix[e][n],t.charAt(3*e+n)))return!1;return!0},add:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this.setAtLeast(e,n,t.get(e,n))},isDisjoint:function(){return this._matrix[_e.INTERIOR][_e.INTERIOR]===Et.FALSE&&this._matrix[_e.INTERIOR][_e.BOUNDARY]===Et.FALSE&&this._matrix[_e.BOUNDARY][_e.INTERIOR]===Et.FALSE&&this._matrix[_e.BOUNDARY][_e.BOUNDARY]===Et.FALSE},isCrosses:function(t,e){return t===Et.P&&e===Et.L||t===Et.P&&e===Et.A||t===Et.L&&e===Et.A?ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&ye.isTrue(this._matrix[_e.INTERIOR][_e.EXTERIOR]):t===Et.L&&e===Et.P||t===Et.A&&e===Et.P||t===Et.A&&e===Et.L?ye.isTrue(this._matrix[_e.INTERIOR][_e.INTERIOR])&&ye.isTrue(this._matrix[_e.EXTERIOR][_e.INTERIOR]):t===Et.L&&e===Et.L&&0===this._matrix[_e.INTERIOR][_e.INTERIOR]},interfaces_:function(){return[f]},getClass:function(){return ye}}),ye.matches=function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],e=arguments[1];return e===Et.SYM_DONTCARE||e===Et.SYM_TRUE&&(0<=t||t===Et.TRUE)||e===Et.SYM_FALSE&&t===Et.FALSE||e===Et.SYM_P&&t===Et.P||e===Et.SYM_L&&t===Et.L||e===Et.SYM_A&&t===Et.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var n=arguments[1];return new ye(arguments[0]).matches(n)}},ye.isTrue=function(t){return 0<=t||t===Et.TRUE},e(ve.prototype,{interfaces_:function(){return[]},getClass:function(){return ve}}),ve.toDegrees=function(t){return 180*t/Math.PI},ve.normalize=function(t){for(;t>Math.PI;)t-=ve.PI_TIMES_2;for(;t<=-Math.PI;)t+=ve.PI_TIMES_2;return t},ve.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=n.x-e.x,r=n.y-e.y;return Math.atan2(r,i)}},ve.isAcute=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return 0<i*(n.x-e.x)+r*(n.y-e.y)},ve.isObtuse=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)<0},ve.interiorAngle=function(t,e,n){var i=ve.angle(e,t),r=ve.angle(e,n);return Math.abs(r-i)},ve.normalizePositive=function(t){if(t<0){for(;t<0;)t+=ve.PI_TIMES_2;ve.PI_TIMES_2<=t&&(t=0)}else{for(;ve.PI_TIMES_2<=t;)t-=ve.PI_TIMES_2;t<0&&(t=0)}return t},ve.angleBetween=function(t,e,n){var i=ve.angle(e,t),r=ve.angle(e,n);return ve.diff(i,r)},ve.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},ve.toRadians=function(t){return t*Math.PI/180},ve.getTurn=function(t,e){var n=Math.sin(e-t);return 0<n?ve.COUNTERCLOCKWISE:n<0?ve.CLOCKWISE:ve.NONE},ve.angleBetweenOriented=function(t,e,n){var i=ve.angle(e,t),r=ve.angle(e,n)-i;return r<=-Math.PI?r+ve.PI_TIMES_2:r>Math.PI?r-ve.PI_TIMES_2:r},ve.PI_TIMES_2=2*Math.PI,ve.PI_OVER_2=Math.PI/2,ve.PI_OVER_4=Math.PI/4,ve.COUNTERCLOCKWISE=z.COUNTERCLOCKWISE,ve.CLOCKWISE=z.CLOCKWISE,ve.NONE=z.COLLINEAR,e(be.prototype,{area:function(){return be.area(this.p0,this.p1,this.p2)},signedArea:function(){return be.signedArea(this.p0,this.p1,this.p2)},interpolateZ:function(t){if(null===t)throw new i("Supplied point is null.");return be.interpolateZ(t,this.p0,this.p1,this.p2)},longestSideLength:function(){return be.longestSideLength(this.p0,this.p1,this.p2)},isAcute:function(){return be.isAcute(this.p0,this.p1,this.p2)},circumcentre:function(){return be.circumcentre(this.p0,this.p1,this.p2)},area3D:function(){return be.area3D(this.p0,this.p1,this.p2)},centroid:function(){return be.centroid(this.p0,this.p1,this.p2)},inCentre:function(){return be.inCentre(this.p0,this.p1,this.p2)},interfaces_:function(){return[]},getClass:function(){return be}}),be.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},be.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},be.det=function(t,e,n,i){return t*i-e*n},be.interpolateZ=function(t,e,n,i){var r=e.x,s=e.y,o=n.x-r,a=i.x-r,l=n.y-s,u=i.y-s,c=o*u-a*l,h=t.x-r,d=t.y-s,p=(u*h-a*d)/c,f=(-l*h+o*d)/c;return e.z+p*(n.z-e.z)+f*(i.z-e.z)},be.longestSideLength=function(t,e,n){var i=t.distance(e),r=e.distance(n),s=n.distance(t),o=i;return o<r&&(o=r),o<s&&(o=s),o},be.isAcute=function(t,e,n){return!!ve.isAcute(t,e,n)&&!!ve.isAcute(e,n,t)&&!!ve.isAcute(n,t,e)},be.circumcentre=function(t,e,n){var i=n.x,r=n.y,s=t.x-i,o=t.y-r,a=e.x-i,l=e.y-r,u=2*be.det(s,o,a,l);return new x(i-be.det(o,s*s+o*o,l,a*a+l*l)/u,r+be.det(s,s*s+o*o,a,a*a+l*l)/u)},be.perpendicularBisector=function(t,e){var n=e.x-t.x,i=e.y-t.y;return new V(new V(t.x+n/2,t.y+i/2,1),new V(t.x-i+n/2,t.y+n+i/2,1))},be.angleBisector=function(t,e,n){var i=e.distance(t),r=i/(i+e.distance(n)),s=n.x-t.x,o=n.y-t.y;return new x(t.x+r*s,t.y+r*o)},be.area3D=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=e.z-t.z,o=n.x-t.x,a=n.y-t.y,l=n.z-t.z,u=r*l-s*a,c=s*o-i*l,h=i*a-r*o,d=u*u+c*c+h*h;return Math.sqrt(d)/2},be.centroid=function(t,e,n){return new x((t.x+e.x+n.x)/3,(t.y+e.y+n.y)/3)},be.inCentre=function(t,e,n){var i=e.distance(n),r=t.distance(n),s=t.distance(e),o=i+r+s;return new x((i*t.x+r*e.x+s*n.x)/o,(i*t.y+r*e.y+s*n.y)/o)};var xe=Object.freeze({Coordinate:x,CoordinateList:M,Envelope:F,LineSegment:me,GeometryFactory:le,Geometry:X,Point:Bt,LineString:kt,LinearRing:Wt,Polygon:Vt,GeometryCollection:Ot,MultiPoint:Ut,MultiLineString:It,MultiPolygon:Yt,Dimension:Et,IntersectionMatrix:ye,PrecisionModel:oe,Location:_e,Triangle:be});function Ee(){this._pt=[new x,new x],this._distance=s.NaN,this._isNull=!0}function Se(){}function Ce(){this._g0=null,this._g1=null,this._ptDist=new Ee;var t=arguments[this._densifyFrac=0],e=arguments[1];this._g0=t,this._g1=e}function Oe(){this._maxPtDist=new Ee,this._minPtDist=new Ee,this._euclideanDist=new Se,this._geom=null;var t=arguments[0];this._geom=t}function Ie(){this._maxPtDist=new Ee,this._minPtDist=new Ee,this._geom=null;var t=arguments[this._numSubSegs=0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))}e(Ee.prototype,{getCoordinates:function(){return this._pt},getCoordinate:function(t){return this._pt[t]},setMinimum:function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var i=e.distance(n);i<this._distance&&this.initialize(e,n,i)}},initialize:function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}},toString:function(){return pe.toLineString(this._pt[0],this._pt[1])},getDistance:function(){return this._distance},setMaximum:function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var i=e.distance(n);i>this._distance&&this.initialize(e,n,i)}},interfaces_:function(){return[]},getClass:function(){return Ee}}),e(Se.prototype,{interfaces_:function(){return[]},getClass:function(){return Se}}),Se.computeDistance=function(){if(arguments[2]instanceof Ee&&arguments[0]instanceof kt&&arguments[1]instanceof x)for(var t=arguments[0],e=arguments[1],n=arguments[2],i=new me,r=t.getCoordinates(),s=0;s<r.length-1;s++){i.setCoordinates(r[s],r[s+1]);var o=i.closestPoint(e);n.setMinimum(o,e)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof Vt&&arguments[1]instanceof x){var a=arguments[0],l=arguments[1],u=arguments[2];for(Se.computeDistance(a.getExteriorRing(),l,u),s=0;s<a.getNumInteriorRing();s++)Se.computeDistance(a.getInteriorRingN(s),l,u)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof X&&arguments[1]instanceof x){var c=arguments[0],h=arguments[1],d=arguments[2];if(c instanceof kt)Se.computeDistance(c,h,d);else if(c instanceof Vt)Se.computeDistance(c,h,d);else if(c instanceof Ot){var p=c;for(s=0;s<p.getNumGeometries();s++){var f=p.getGeometryN(s);Se.computeDistance(f,h,d)}}else d.setMinimum(c.getCoordinate(),h)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof me&&arguments[1]instanceof x){var g=arguments[1],m=arguments[2];o=arguments[0].closestPoint(g),m.setMinimum(o,g)}},e(Ce.prototype,{getCoordinates:function(){return this._ptDist.getCoordinates()},setDensifyFraction:function(t){if(1<t||t<=0)throw new i("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},compute:function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},distance:function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},computeOrientedDistance:function(t,e,n){var i=new Oe(e);if(t.apply(i),n.setMaximum(i.getMaxPointDistance()),0<this._densifyFrac){var r=new Ie(e,this._densifyFrac);t.apply(r),n.setMaximum(r.getMaxPointDistance())}},orientedDistance:function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},interfaces_:function(){return[]},getClass:function(){return Ce}}),Ce.distance=function(){if(2===arguments.length)return(t=new Ce(arguments[0],arguments[1])).distance();if(3===arguments.length){var t,e=arguments[2];return(t=new Ce(arguments[0],arguments[1])).setDensifyFraction(e),t.distance()}},e(Oe.prototype,{filter:function(t){this._minPtDist.initialize(),Se.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},getMaxPointDistance:function(){return this._maxPtDist},interfaces_:function(){return[Z]},getClass:function(){return Oe}}),e(Ie.prototype,{filter:function(t,e){if(0===e)return null;for(var n=t.getCoordinate(e-1),i=t.getCoordinate(e),r=(i.x-n.x)/this._numSubSegs,s=(i.y-n.y)/this._numSubSegs,o=0;o<this._numSubSegs;o++){var a=new x(n.x+o*r,n.y+o*s);this._minPtDist.initialize(),Se.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},isDone:function(){return!1},isGeometryChanged:function(){return!1},getMaxPointDistance:function(){return this._maxPtDist},interfaces_:function(){return[Ct]},getClass:function(){return Ie}}),Ce.MaxPointDistanceFilter=Oe,Ce.MaxDensifiedByFractionDistanceFilter=Ie;var we=Object.freeze({DiscreteHausdorffDistance:Ce,DistanceToPoint:Se,PointPairDistance:Ee});function Le(){}function Te(){}function je(){this._min=s.POSITIVE_INFINITY,this._max=s.NEGATIVE_INFINITY}function Ne(){}function Me(){je.apply(this),this._item=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._min=t,this._max=e,this._item=n}e(Le.prototype,{visitItem:function(t){},interfaces_:function(){return[]},getClass:function(){return Le}}),e(Te.prototype,{locate:function(t){},interfaces_:function(){return[]},getClass:function(){return Te}}),e(je.prototype,{getMin:function(){return this._min},intersects:function(t,e){return!(this._min>e||this._max<t)},getMax:function(){return this._max},toString:function(){return pe.toLineString(new x(this._min,0),new x(this._max,0))},interfaces_:function(){return[]},getClass:function(){return je}}),e(Ne.prototype,{compare:function(t,e){var n=t,i=e,r=(n._min+n._max)/2,s=(i._min+i._max)/2;return r<s?-1:s<r?1:0},interfaces_:function(){return[g]},getClass:function(){return Ne}}),je.NodeComparator=Ne,y(Me,je),e(Me.prototype,{query:function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)},interfaces_:function(){return[]},getClass:function(){return Me}});var Fe={reverseOrder:function(){return{compare:function(t,e){return e.compareTo(t)}}},min:function(t){return Fe.sort(t),t.get(0)},sort:function(t,e){var n=t.toArray();e?xt.sort(n,e):xt.sort(n);for(var i=t.iterator(),r=0,s=n.length;r<s;r++)i.next(),i.set(n[r])},singletonList:function(t){var e=new j;return e.add(t),e}};function Pe(){je.apply(this),this._node1=null,this._node2=null;var t=arguments[0],e=arguments[1];this._node1=t,this._node2=e,this.buildExtent(this._node1,this._node2)}function Re(){this._leaves=new j,this._root=null,this._level=0}function De(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}}function Ae(){this._items=new j}function ke(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t}function Ge(){this._index=null;var t=arguments[0];if(!(S(t,qt)||t instanceof Wt))throw new i("Argument must be Polygonal or LinearRing");this._index=new ze(t)}function Be(){this._counter=null;var t=arguments[0];this._counter=t}function ze(){this._index=new Re;var t=arguments[0];this.init(t)}function qe(){}function Ve(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}function Ue(){this._geom=null;var t=arguments[0];this._geom=t}y(Pe,je),e(Pe.prototype,{buildExtent:function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},query:function(t,e,n){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,n),null!==this._node2&&this._node2.query(t,e,n)},interfaces_:function(){return[]},getClass:function(){return Pe}}),e(Re.prototype,{buildTree:function(){Fe.sort(this._leaves,new je.NodeComparator);for(var t=this._leaves,e=null,n=new j;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},insert:function(t,e,n){if(null!==this._root)throw new IllegalStateException("Index cannot be added to once it has been queried");this._leaves.add(new Me(t,e,n))},query:function(t,e,n){this.init(),this._root.query(t,e,n)},buildRoot:function(){if(null!==this._root)return null;this._root=this.buildTree()},printNode:function(t){q.out.println(pe.toLineString(new x(t._min,this._level),new x(t._max,this._level)))},init:function(){if(null!==this._root)return null;this.buildRoot()},buildLevel:function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var i=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(i);else{var r=new Pe(t.get(n),t.get(n+1));e.add(r)}}},interfaces_:function(){return[]},getClass:function(){return Re}}),e(De.prototype,{filter:function(t){if(this._isForcedToLineString&&t instanceof Wt){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof kt&&this._lines.add(t)},setForceToLineString:function(t){this._isForcedToLineString=t},interfaces_:function(){return[J]},getClass:function(){return De}}),De.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(De.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(De.getLines(e,n))}},De.getLines=function(){if(1===arguments.length){var t=arguments[0];return De.getLines(t,!1)}if(2===arguments.length){if(S(arguments[0],O)&&S(arguments[1],O)){for(var e=arguments[1],n=arguments[0].iterator();n.hasNext();){var i=n.next();De.getLines(i,e)}return e}if(arguments[0]instanceof X&&"boolean"==typeof arguments[1]){var r=arguments[0],s=arguments[1],o=new j;return r.apply(new De(o,s)),o}if(arguments[0]instanceof X&&S(arguments[1],O)){var a=arguments[0],l=arguments[1];return a instanceof kt?l.add(a):a.apply(new De(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&S(arguments[0],O)&&S(arguments[1],O)){var u=arguments[1],c=arguments[2];for(n=arguments[0].iterator();n.hasNext();)i=n.next(),De.getLines(i,u,c);return u}if("boolean"==typeof arguments[2]&&arguments[0]instanceof X&&S(arguments[1],O)){var h=arguments[1],d=arguments[2];return arguments[0].apply(new De(h,d)),h}}},e(Ae.prototype,{visitItem:function(t){this._items.add(t)},getItems:function(){return this._items},interfaces_:function(){return[Le]},getClass:function(){return Ae}}),e(ke.prototype,{countSegment:function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,i=e.x;return i<n&&(n=e.x,i=t.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var r=z.index(t,e,this._p);if(r===z.COLLINEAR)return this._isPointOnSegment=!0,null;e.y<t.y&&(r=-r),r===z.LEFT&&this._crossingCount++}},isPointInPolygon:function(){return this.getLocation()!==_e.EXTERIOR},getLocation:function(){return this._isPointOnSegment?_e.BOUNDARY:this._crossingCount%2==1?_e.INTERIOR:_e.EXTERIOR},isOnSegment:function(){return this._isPointOnSegment},interfaces_:function(){return[]},getClass:function(){return ke}}),ke.locatePointInRing=function(){if(arguments[0]instanceof x&&S(arguments[1],Y)){for(var t=arguments[1],e=new ke(arguments[0]),n=new x,i=new x,r=1;r<t.size();r++)if(t.getCoordinate(r,n),t.getCoordinate(r-1,i),e.countSegment(n,i),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof x&&arguments[1]instanceof Array){var s=arguments[1];for(e=new ke(arguments[0]),r=1;r<s.length;r++)if(n=s[r],i=s[r-1],e.countSegment(n,i),e.isOnSegment())return e.getLocation();return e.getLocation()}},e(Ge.prototype,{locate:function(t){var e=new ke(t),n=new Be(e);return this._index.query(t.y,t.y,n),e.getLocation()},interfaces_:function(){return[Te]},getClass:function(){return Ge}}),e(Be.prototype,{visitItem:function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},interfaces_:function(){return[Le]},getClass:function(){return Be}}),e(ze.prototype,{init:function(t){for(var e=De.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},addLine:function(t){for(var e=1;e<t.length;e++){var n=new me(t[e-1],t[e]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this._index.insert(i,r,n)}},query:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new Ae;return this._index.query(t,e,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this._index.query(i,r,s)}},interfaces_:function(){return[]},getClass:function(){return ze}}),Ge.SegmentVisitor=Be,Ge.IntervalIndexedGeometry=ze,e(qe.prototype,{interfaces_:function(){return[]},getClass:function(){return qe}}),qe.isOnLine=function(){if(arguments[0]instanceof x&&S(arguments[1],Y)){for(var t=arguments[0],e=arguments[1],n=new ge,i=new x,r=new x,s=e.size(),o=1;o<s;o++)if(e.getCoordinate(o-1,i),e.getCoordinate(o,r),n.computeIntersection(t,i,r),n.hasIntersection())return!0;return!1}if(arguments[0]instanceof x&&arguments[1]instanceof Array){var a=arguments[0],l=arguments[1];for(n=new ge,o=1;o<l.length;o++)if(i=l[o-1],r=l[o],n.computeIntersection(a,i,r),n.hasIntersection())return!0;return!1}},qe.locateInRing=function(t,e){return ke.locatePointInRing(t,e)},qe.isInRing=function(t,e){return qe.locateInRing(t,e)!==_e.EXTERIOR},e(Ve.prototype,{next:function(){if(this._atStart)return this._atStart=!1,Ve.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new L;var t=this._parent.getGeometryN(this._index++);return t instanceof Ot?(this._subcollectionIterator=new Ve(t),this._subcollectionIterator.next()):t},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},interfaces_:function(){return[C]},getClass:function(){return Ve}}),Ve.isAtomic=function(t){return!(t instanceof Ot)},e(Ue.prototype,{locate:function(t){return Ue.locate(t,this._geom)},interfaces_:function(){return[Te]},getClass:function(){return Ue}}),Ue.locatePointInPolygon=function(t,e){if(e.isEmpty())return _e.EXTERIOR;var n=e.getExteriorRing(),i=Ue.locatePointInRing(t,n);if(i!==_e.INTERIOR)return i;for(var r=0;r<e.getNumInteriorRing();r++){var s=e.getInteriorRingN(r),o=Ue.locatePointInRing(t,s);if(o===_e.BOUNDARY)return _e.BOUNDARY;if(o===_e.INTERIOR)return _e.EXTERIOR}return _e.INTERIOR},Ue.locatePointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?qe.locateInRing(t,e.getCoordinates()):_e.EXTERIOR},Ue.containsPointInPolygon=function(t,e){return _e.EXTERIOR!==Ue.locatePointInPolygon(t,e)},Ue.locateInGeometry=function(t,e){if(e instanceof Vt)return Ue.locatePointInPolygon(t,e);if(e instanceof Ot)for(var n=new Ve(e);n.hasNext();){var i=n.next();if(i!==e){var r=Ue.locateInGeometry(t,i);if(r!==_e.EXTERIOR)return r}}return _e.EXTERIOR},Ue.locate=function(t,e){return e.isEmpty()?_e.EXTERIOR:Ue.locateInGeometry(t,e)};var We=Object.freeze({IndexedPointInAreaLocator:Ge,PointOnGeometryLocator:Te,SimplePointInAreaLocator:Ue});function Ye(){}function He(){}function Je(){}function Xe(){}e(Ye.prototype,{measure:function(t,e){},interfaces_:function(){return[]},getClass:function(){return Ye}}),e(He.prototype,{measure:function(t,e){return t.intersection(e).getArea()/t.union(e).getArea()},interfaces_:function(){return[Ye]},getClass:function(){return He}}),e(Je.prototype,{measure:function(t,e){var n=Ce.distance(t,e,Je.DENSIFY_FRACTION),i=new F(t.getEnvelopeInternal());return i.expandToInclude(e.getEnvelopeInternal()),1-n/Je.diagonalSize(i)},interfaces_:function(){return[Ye]},getClass:function(){return Je}}),Je.diagonalSize=function(t){if(t.isNull())return 0;var e=t.getWidth(),n=t.getHeight();return Math.sqrt(e*e+n*n)},Je.DENSIFY_FRACTION=.25,e(Xe.prototype,{interfaces_:function(){return[]},getClass:function(){return Xe}}),Xe.combine=function(t,e){return Math.min(t,e)};var Ze=Object.freeze({AreaSimilarityMeasure:He,HausdorffSimilarityMeasure:Je,SimilarityMeasure:Ye,SimilarityMeasureCombiner:Xe});function Qe(){this._areaBasePt=null,this._triangleCent3=new x,this._areasum2=0,this._cg3=new x,this._lineCentSum=new x,this._totalLength=0,this._ptCount=0,this._ptCentSum=new x;var t=arguments[0];this._areaBasePt=null,this.add(t)}function Ke(){}function $e(t){this.message=t||""}function tn(){this.array_=[]}function en(){this.treeSet=new yt,this.list=new j}function nn(){if(this._geomFactory=null,this._inputPts=null,1===arguments.length){var t=arguments[0];nn.call(this,nn.extractCoordinates(t),t.getFactory())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._inputPts=en.filterCoordinates(e),this._geomFactory=n}}function rn(){this._origin=null;var t=arguments[0];this._origin=t}function sn(){this._factory=null,this._interiorPoint=null;var t=arguments[this._maxWidth=0];this._factory=t.getFactory(),this.add(t)}function on(){this._poly=null,this._centreY=null,this._hiY=s.MAX_VALUE,this._loY=-s.MAX_VALUE;var t=arguments[0];this._poly=t,this._hiY=t.getEnvelopeInternal().getMaxY(),this._loY=t.getEnvelopeInternal().getMinY(),this._centreY=sn.avg(this._loY,this._hiY)}function an(){this._centroid=null,this._minDistance=s.MAX_VALUE,this._interiorPoint=null;var t=arguments[0];this._centroid=t.getCentroid().getCoordinate(),this.addInterior(t),null===this._interiorPoint&&this.addEndpoints(t)}function ln(){this._centroid=null,this._minDistance=s.MAX_VALUE,this._interiorPoint=null;var t=arguments[0];this._centroid=t.getCentroid().getCoordinate(),this.add(t)}function un(){this.selectedSegment=new me}function cn(){this._items=new j,this._subnode=new Array(2).fill(null)}function hn(){if(this.min=null,this.max=null,0===arguments.length)this.min=0,this.max=0;else if(1===arguments.length){var t=arguments[0];this.init(t.min,t.max)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.init(e,n)}}function dn(){}function pn(){this._pt=0,this._level=0,this._interval=null;var t=arguments[0];this.computeKey(t)}function fn(){cn.apply(this),this._interval=null,this._centre=null,this._level=null;var t=arguments[0],e=arguments[1];this._interval=t,this._level=e,this._centre=(t.getMin()+t.getMax())/2}function gn(){}function mn(){cn.apply(this)}function _n(){this._root=null,this._minExtent=1,this._root=new mn}function yn(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=i}function vn(){}function bn(){}function xn(){}function En(){}function Sn(){this._ring=null,this._tree=null,this._crossings=0,this._interval=new hn;var t=arguments[0];this._ring=t,this.buildIndex()}function Cn(){un.apply(this),this.mcp=null,this.p=null;var t=arguments[0],e=arguments[1];this.mcp=t,this.p=e}function On(){this._input=null,this._extremalPts=null,this._centre=null;var t=arguments[this._radius=0];this._input=t}function In(){if(this._inputGeom=null,this._isConvex=null,this._convexHullPts=null,this._minBaseSeg=new me,this._minWidthPt=null,this._minPtIndex=null,this._minWidth=0,1===arguments.length){var t=arguments[0];In.call(this,t,!1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._inputGeom=e,this._isConvex=n}}e(Qe.prototype,{setAreaBasePoint:function(t){this._areaBasePt=t},addPoint:function(t){this._ptCount+=1,this._ptCentSum.x+=t.x,this._ptCentSum.y+=t.y},addLineSegments:function(t){for(var e=0,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);if(0!==i){e+=i;var r=(t[n].x+t[n+1].x)/2;this._lineCentSum.x+=i*r;var s=(t[n].y+t[n+1].y)/2;this._lineCentSum.y+=i*s}}this._totalLength+=e,0===e&&0<t.length&&this.addPoint(t[0])},addHole:function(t){for(var e=z.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this._areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},getCentroid:function(){var t=new x;if(0<Math.abs(this._areasum2))t.x=this._cg3.x/3/this._areasum2,t.y=this._cg3.y/3/this._areasum2;else if(0<this._totalLength)t.x=this._lineCentSum.x/this._totalLength,t.y=this._lineCentSum.y/this._totalLength;else{if(!(0<this._ptCount))return null;t.x=this._ptCentSum.x/this._ptCount,t.y=this._ptCentSum.y/this._ptCount}return t},addShell:function(t){0<t.length&&this.setAreaBasePoint(t[0]);for(var e=!z.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this._areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},addTriangle:function(t,e,n,i){var r=i?1:-1;Qe.centroid3(t,e,n,this._triangleCent3);var s=Qe.area2(t,e,n);this._cg3.x+=r*s*this._triangleCent3.x,this._cg3.y+=r*s*this._triangleCent3.y,this._areasum2+=r*s},add:function(){if(arguments[0]instanceof Vt){var t=arguments[0];this.addShell(t.getExteriorRing().getCoordinates());for(var e=0;e<t.getNumInteriorRing();e++)this.addHole(t.getInteriorRingN(e).getCoordinates())}else if(arguments[0]instanceof X){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Bt)this.addPoint(n.getCoordinate());else if(n instanceof kt)this.addLineSegments(n.getCoordinates());else if(n instanceof Vt){var i=n;this.add(i)}else if(n instanceof Ot){var r=n;for(e=0;e<r.getNumGeometries();e++)this.add(r.getGeometryN(e))}}},interfaces_:function(){return[]},getClass:function(){return Qe}}),Qe.area2=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)},Qe.centroid3=function(t,e,n,i){return i.x=t.x+e.x+n.x,i.y=t.y+e.y+n.y,null},Qe.getCentroid=function(t){return new Qe(t).getCentroid()},e(Ke.prototype,{interfaces_:function(){return[]},getClass:function(){return Ke}}),Ke.orientationIndex=function(t,e,n){return B.orientationIndex(t,e,n)},Ke.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++){var r=t[i].x-n,s=t[i+1].y;e+=r*(t[i-1].y-s)}return e/2}if(S(arguments[0],Y)){var o=arguments[0],a=o.size();if(a<3)return 0;var l=new x,u=new x,c=new x;for(o.getCoordinate(0,u),o.getCoordinate(1,c),n=u.x,c.x-=n,e=0,i=1;i<a-1;i++)l.y=u.y,u.x=c.x,u.y=c.y,o.getCoordinate(i+1,c),c.x-=n,e+=u.x*(l.y-c.y);return e/2}},Ke.distanceLineLine=function(t,e,n,i){if(t.equals(e))return Ke.distancePointLine(t,n,i);if(n.equals(i))return Ke.distancePointLine(i,t,e);var r=!1;if(F.intersects(t,e,n,i)){var s=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(0===s)r=!0;else{var o=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),a=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/s,l=o/s;(l<0||1<l||a<0||1<a)&&(r=!0)}}else r=!0;return r?U.min(Ke.distancePointLine(t,n,i),Ke.distancePointLine(e,n,i),Ke.distancePointLine(n,t,e),Ke.distancePointLine(i,t,e)):0},Ke.isPointInRing=function(t,e){return Ke.locatePointInRing(t,e)!==_e.EXTERIOR},Ke.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,i=new x;t.getCoordinate(0,i);for(var r=i.x,s=i.y,o=1;o<e;o++){t.getCoordinate(o,i);var a=i.x,l=i.y,u=a-r,c=l-s;n+=Math.sqrt(u*u+c*c),r=a,s=l}return n},Ke.isCCW=function(t){var e=t.length-1;if(e<3)throw new i("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,s=1;s<=e;s++){var o=t[s];o.y>n.y&&(n=o,r=s)}for(var a=r;(a-=1)<0&&(a=e),t[a].equals2D(n)&&a!==r;);for(var l=r;t[l=(l+1)%e].equals2D(n)&&l!==r;);var u=t[a],c=t[l];if(u.equals2D(n)||c.equals2D(n)||u.equals2D(c))return!1;var h=Ke.computeOrientation(u,n,c);return 0===h?u.x>c.x:0<h},Ke.locatePointInRing=function(t,e){return ke.locatePointInRing(t,e)},Ke.distancePointLinePerpendicular=function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(r)*Math.sqrt(i)},Ke.computeOrientation=function(t,e,n){return Ke.orientationIndex(t,e,n)},Ke.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new i("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var s=Ke.distancePointLine(t,e[r],e[r+1]);s<n&&(n=s)}return n}if(3===arguments.length){var o=arguments[0],a=arguments[1],l=arguments[2];if(a.x===l.x&&a.y===l.y)return o.distance(a);var u=(l.x-a.x)*(l.x-a.x)+(l.y-a.y)*(l.y-a.y),c=((o.x-a.x)*(l.x-a.x)+(o.y-a.y)*(l.y-a.y))/u;if(c<=0)return o.distance(a);if(1<=c)return o.distance(l);var h=((a.y-o.y)*(l.x-a.x)-(a.x-o.x)*(l.y-a.y))/u;return Math.abs(h)*Math.sqrt(u)}},Ke.isOnLine=function(t,e){for(var n=new ge,i=1;i<e.length;i++){var r=e[i-1],s=e[i];if(n.computeIntersection(t,r,s),n.hasIntersection())return!0}return!1},Ke.RIGHT=Ke.CLOCKWISE=-1,Ke.LEFT=Ke.COUNTERCLOCKWISE=1,Ke.STRAIGHT=Ke.COLLINEAR=0,($e.prototype=new Error).name="EmptyStackException",(tn.prototype=new w).add=function(t){return this.array_.push(t),!0},tn.prototype.get=function(t){if(t<0||t>=this.size())throw new IndexOutOfBoundsException;return this.array_[t]},tn.prototype.push=function(t){return this.array_.push(t),t},tn.prototype.pop=function(t){if(0===this.array_.length)throw new $e;return this.array_.pop()},tn.prototype.peek=function(){if(0===this.array_.length)throw new $e;return this.array_[this.array_.length-1]},tn.prototype.empty=function(){return 0===this.array_.length},tn.prototype.isEmpty=function(){return this.empty()},tn.prototype.search=function(t){return this.array_.indexOf(t)},tn.prototype.size=function(){return this.array_.length},tn.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e(en.prototype,{filter:function(t){this.treeSet.contains(t)||(this.list.add(t),this.treeSet.add(t))},getCoordinates:function(){var t=new Array(this.list.size()).fill(null);return this.list.toArray(t)},interfaces_:function(){return[Z]},getClass:function(){return en}}),en.filterCoordinates=function(t){for(var e=new en,n=0;n<t.length;n++)e.filter(t[n]);return e.getCoordinates()},e(nn.prototype,{preSort:function(t){for(var e=null,n=1;n<t.length;n++)(t[n].y<t[0].y||t[n].y===t[0].y&&t[n].x<t[0].x)&&(e=t[0],t[0]=t[n],t[n]=e);return xt.sort(t,1,t.length,new rn(t[0])),t},computeOctRing:function(t){var e=this.computeOctPts(t),n=new M;return n.add(e,!1),n.size()<3?null:(n.closeRing(),n.toCoordinateArray())},lineOrPolygon:function(t){if(3===(t=this.cleanRing(t)).length)return this._geomFactory.createLineString([t[0],t[1]]);var e=this._geomFactory.createLinearRing(t);return this._geomFactory.createPolygon(e)},cleanRing:function(t){b.equals(t[0],t[t.length-1]);for(var e=new j,n=null,i=0;i<=t.length-2;i++){var r=t[i],s=t[i+1];r.equals(s)||null!==n&&this.isBetween(n,r,s)||(e.add(r),n=r)}e.add(t[t.length-1]);var o=new Array(e.size()).fill(null);return e.toArray(o)},isBetween:function(t,e,n){if(0!==z.index(t,e,n))return!1;if(t.x!==n.x){if(t.x<=e.x&&e.x<=n.x)return!0;if(n.x<=e.x&&e.x<=t.x)return!0}if(t.y!==n.y){if(t.y<=e.y&&e.y<=n.y)return!0;if(n.y<=e.y&&e.y<=t.y)return!0}return!1},reduce:function(t){var e=this.computeOctRing(t);if(null===e)return t;for(var n=new yt,i=0;i<e.length;i++)n.add(e[i]);for(i=0;i<t.length;i++)qe.isInRing(t[i],e)||n.add(t[i]);var r=nt.toCoordinateArray(n);return r.length<3?this.padArray3(r):r},getConvexHull:function(){if(0===this._inputPts.length)return this._geomFactory.createGeometryCollection();if(1===this._inputPts.length)return this._geomFactory.createPoint(this._inputPts[0]);if(2===this._inputPts.length)return this._geomFactory.createLineString(this._inputPts);var t=this._inputPts;50<this._inputPts.length&&(t=this.reduce(this._inputPts));var e=this.preSort(t),n=this.grahamScan(e),i=this.toCoordinateArray(n);return this.lineOrPolygon(i)},padArray3:function(t){for(var e=new Array(3).fill(null),n=0;n<e.length;n++)n<t.length?e[n]=t[n]:e[n]=t[0];return e},computeOctPts:function(t){for(var e=new Array(8).fill(null),n=0;n<e.length;n++)e[n]=t[0];for(var i=1;i<t.length;i++)t[i].x<e[0].x&&(e[0]=t[i]),t[i].x-t[i].y<e[1].x-e[1].y&&(e[1]=t[i]),t[i].y>e[2].y&&(e[2]=t[i]),t[i].x+t[i].y>e[3].x+e[3].y&&(e[3]=t[i]),t[i].x>e[4].x&&(e[4]=t[i]),t[i].x-t[i].y>e[5].x-e[5].y&&(e[5]=t[i]),t[i].y<e[6].y&&(e[6]=t[i]),t[i].x+t[i].y<e[7].x+e[7].y&&(e[7]=t[i]);return e},toCoordinateArray:function(t){for(var e=new Array(t.size()).fill(null),n=0;n<t.size();n++){var i=t.get(n);e[n]=i}return e},grahamScan:function(t){var e=null,n=new tn;n.push(t[0]),n.push(t[1]),n.push(t[2]);for(var i=3;i<t.length;i++){for(e=n.pop();!n.empty()&&0<z.index(n.peek(),e,t[i]);)e=n.pop();n.push(e),n.push(t[i])}return n.push(t[0]),n},interfaces_:function(){return[]},getClass:function(){return nn}}),nn.extractCoordinates=function(t){var e=new en;return t.apply(e),e.getCoordinates()},e(rn.prototype,{compare:function(t,e){var n=t,i=e;return rn.polarCompare(this._origin,n,i)},interfaces_:function(){return[g]},getClass:function(){return rn}}),rn.polarCompare=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=n.x-t.x,o=n.y-t.y,a=z.index(t,e,n);if(a===z.COUNTERCLOCKWISE)return 1;if(a===z.CLOCKWISE)return-1;var l=i*i+r*r,u=s*s+o*o;return l<u?-1:u<l?1:0},nn.RadialComparator=rn,e(sn.prototype,{addPolygon:function(t){if(t.isEmpty())return null;var e=null,n=null,i=this.horizontalBisector(t);if(0===i.getLength())n=0,e=i.getCoordinate();else{var r=i.intersection(t),s=this.widestGeometry(r);n=s.getEnvelopeInternal().getWidth(),e=sn.centre(s.getEnvelopeInternal())}(null===this._interiorPoint||n>this._maxWidth)&&(this._interiorPoint=e,this._maxWidth=n)},getInteriorPoint:function(){return this._interiorPoint},widestGeometry:function(){if(arguments[0]instanceof Ot){var t=arguments[0];if(t.isEmpty())return t;for(var e=t.getGeometryN(0),n=1;n<t.getNumGeometries();n++)t.getGeometryN(n).getEnvelopeInternal().getWidth()>e.getEnvelopeInternal().getWidth()&&(e=t.getGeometryN(n));return e}if(arguments[0]instanceof X){var i=arguments[0];return i instanceof Ot?this.widestGeometry(i):i}},horizontalBisector:function(t){var e=t.getEnvelopeInternal(),n=on.getBisectorY(t);return this._factory.createLineString([new x(e.getMinX(),n),new x(e.getMaxX(),n)])},add:function(t){if(t instanceof Vt)this.addPolygon(t);else if(t instanceof Ot)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))},interfaces_:function(){return[]},getClass:function(){return sn}}),sn.centre=function(t){return new x(sn.avg(t.getMinX(),t.getMaxX()),sn.avg(t.getMinY(),t.getMaxY()))},sn.avg=function(t,e){return(t+e)/2},e(on.prototype,{updateInterval:function(t){t<=this._centreY?t>this._loY&&(this._loY=t):t>this._centreY&&t<this._hiY&&(this._hiY=t)},getBisectorY:function(){this.process(this._poly.getExteriorRing());for(var t=0;t<this._poly.getNumInteriorRing();t++)this.process(this._poly.getInteriorRingN(t));return sn.avg(this._hiY,this._loY)},process:function(t){for(var e=t.getCoordinateSequence(),n=0;n<e.size();n++){var i=e.getY(n);this.updateInterval(i)}},interfaces_:function(){return[]},getClass:function(){return on}}),on.getBisectorY=function(t){return new on(t).getBisectorY()},sn.SafeBisectorFinder=on,e(an.prototype,{addEndpoints:function(){if(arguments[0]instanceof X){var t=arguments[0];if(t instanceof kt)this.addEndpoints(t.getCoordinates());else if(t instanceof Ot)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addEndpoints(e.getGeometryN(n))}else if(arguments[0]instanceof Array){var i=arguments[0];this.add(i[0]),this.add(i[i.length-1])}},getInteriorPoint:function(){return this._interiorPoint},addInterior:function(){if(arguments[0]instanceof X){var t=arguments[0];if(t instanceof kt)this.addInterior(t.getCoordinates());else if(t instanceof Ot)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addInterior(e.getGeometryN(n))}else if(arguments[0]instanceof Array){var i=arguments[0];for(n=1;n<i.length-1;n++)this.add(i[n])}},add:function(t){var e=t.distance(this._centroid);e<this._minDistance&&(this._interiorPoint=new x(t),this._minDistance=e)},interfaces_:function(){return[]},getClass:function(){return an}}),e(ln.prototype,{getInteriorPoint:function(){return this._interiorPoint},add:function(){if(arguments[0]instanceof X){var t=arguments[0];if(t instanceof Bt)this.add(t.getCoordinate());else if(t instanceof Ot)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))}else if(arguments[0]instanceof x){var i=arguments[0],r=i.distance(this._centroid);r<this._minDistance&&(this._interiorPoint=new x(i),this._minDistance=r)}},interfaces_:function(){return[]},getClass:function(){return ln}}),e(un.prototype,{select:function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},interfaces_:function(){return[]},getClass:function(){return un}}),e(cn.prototype,{hasChildren:function(){for(var t=0;t<2;t++)if(null!==this._subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this._items);for(var e=0;e<2;e++)null!==this._subnode[e]&&this._subnode[e].addAllItems(t);return t},size:function(){for(var t=0,e=0;e<2;e++)null!==this._subnode[e]&&(t+=this._subnode[e].size());return t+this._items.size()},addAllItemsFromOverlapping:function(t,e){if(null!==t&&!this.isSearchMatch(t))return null;e.addAll(this._items),null!==this._subnode[0]&&this._subnode[0].addAllItemsFromOverlapping(t,e),null!==this._subnode[1]&&this._subnode[1].addAllItemsFromOverlapping(t,e)},hasItems:function(){return!this._items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1;for(var n=!1,i=0;i<2;i++)if(null!==this._subnode[i]&&(n=this._subnode[i].remove(t,e))){this._subnode[i].isPrunable()&&(this._subnode[i]=null);break}return n||this._items.remove(e)},getItems:function(){return this._items},depth:function(){for(var t=0,e=0;e<2;e++)if(null!==this._subnode[e]){var n=this._subnode[e].depth();t<n&&(t=n)}return t+1},nodeSize:function(){for(var t=0,e=0;e<2;e++)null!==this._subnode[e]&&(t+=this._subnode[e].nodeSize());return t+1},add:function(t){this._items.add(t)},interfaces_:function(){return[]},getClass:function(){return cn}}),cn.getSubnodeIndex=function(t,e){var n=-1;return t.min>=e&&(n=1),t.max<=e&&(n=0),n},e(hn.prototype,{expandToInclude:function(t){t.max>this.max&&(this.max=t.max),t.min<this.min&&(this.min=t.min)},getWidth:function(){return this.max-this.min},overlaps:function(){if(1===arguments.length){var t=arguments[0];return this.overlaps(t.min,t.max)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!(this.min>n||this.max<e)}},getMin:function(){return this.min},toString:function(){return"["+this.min+", "+this.max+"]"},contains:function(){if(1===arguments.length){if(arguments[0]instanceof hn){var t=arguments[0];return this.contains(t.min,t.max)}if("number"==typeof arguments[0]){var e=arguments[0];return e>=this.min&&e<=this.max}}else if(2===arguments.length){var n=arguments[1];return arguments[0]>=this.min&&n<=this.max}},init:function(t,e){this.min=t,(this.max=e)<t&&(this.min=e,this.max=t)},getMax:function(){return this.max},interfaces_:function(){return[]},getClass:function(){return hn}}),dn.exponent=function(t){return function(t,e){var n,i,r,s;if(s||(n=e<0||1/e<0,isFinite(e)||(s={d:32752,c:0,b:0,a:0},n&&(s.d+=32768),i=Math.pow(2,11)-1,r=0)),!s){for(i=1023,r=Math.abs(e);2<=r;)i++,r/=2;for(;r<1&&0<i;)i--,r*=2;i<=0&&(r/=2)}return i}(0,t)-1023},dn.powerOf2=function(t){return Math.pow(2,t)},e(pn.prototype,{getInterval:function(){return this._interval},getLevel:function(){return this._level},computeKey:function(t){for(this._level=pn.computeLevel(t),this._interval=new hn,this.computeInterval(this._level,t);!this._interval.contains(t);)this._level+=1,this.computeInterval(this._level,t)},computeInterval:function(t,e){var n=dn.powerOf2(t);this._pt=Math.floor(e.getMin()/n)*n,this._interval.init(this._pt,this._pt+n)},getPoint:function(){return this._pt},interfaces_:function(){return[]},getClass:function(){return pn}}),pn.computeLevel=function(t){var e=t.getWidth();return dn.exponent(e)+1},y(fn,cn),e(fn.prototype,{getInterval:function(){return this._interval},find:function(t){var e=cn.getSubnodeIndex(t,this._centre);return-1===e||null===this._subnode[e]?this:this._subnode[e].find(t)},insert:function(t){b.isTrue(null===this._interval||this._interval.contains(t._interval));var e=cn.getSubnodeIndex(t._interval,this._centre);if(t._level===this._level-1)this._subnode[e]=t;else{var n=this.createSubnode(e);n.insert(t),this._subnode[e]=n}},isSearchMatch:function(t){return t.overlaps(this._interval)},getSubnode:function(t){return null===this._subnode[t]&&(this._subnode[t]=this.createSubnode(t)),this._subnode[t]},getNode:function(t){var e=cn.getSubnodeIndex(t,this._centre);return-1===e?this:this.getSubnode(e).getNode(t)},createSubnode:function(t){var e=0,n=0;switch(t){case 0:e=this._interval.getMin(),n=this._centre;break;case 1:e=this._centre,n=this._interval.getMax()}return new fn(new hn(e,n),this._level-1)},interfaces_:function(){return[]},getClass:function(){return fn}}),fn.createNode=function(t){var e=new pn(t);return new fn(e.getInterval(),e.getLevel())},fn.createExpanded=function(t,e){var n=new hn(e);null!==t&&n.expandToInclude(t._interval);var i=fn.createNode(n);return null!==t&&i.insert(t),i},e(gn.prototype,{interfaces_:function(){return[]},getClass:function(){return gn}}),gn.isZeroWidth=function(t,e){var n=e-t;if(0===n)return!0;var i=Math.max(Math.abs(t),Math.abs(e));return dn.exponent(n/i)<=gn.MIN_BINARY_EXPONENT},gn.MIN_BINARY_EXPONENT=-50,y(mn,cn),e(mn.prototype,{insert:function(t,e){var n=cn.getSubnodeIndex(t,mn.origin);if(-1===n)return this.add(e),null;var i=this._subnode[n];if(null===i||!i.getInterval().contains(t)){var r=fn.createExpanded(i,t);this._subnode[n]=r}this.insertContained(this._subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){b.isTrue(t.getInterval().contains(e)),(gn.isZeroWidth(e.getMin(),e.getMax())?t.find(e):t.getNode(e)).add(n)},interfaces_:function(){return[]},getClass:function(){return mn}}),mn.origin=0,e(_n.prototype,{size:function(){return null!==this._root?this._root.size():0},insert:function(t,e){this.collectStats(t);var n=_n.ensureExtent(t,this._minExtent);this._root.insert(n,e)},query:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];return this.query(new hn(t,t))}if(arguments[0]instanceof hn){var e=arguments[0],n=new j;return this.query(e,n),n}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._root.addAllItemsFromOverlapping(i,r)}},iterator:function(){var t=new j;return this._root.addAllItems(t),t.iterator()},remove:function(t,e){var n=_n.ensureExtent(t,this._minExtent);return this._root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this._minExtent&&0<e&&(this._minExtent=e)},depth:function(){return null!==this._root?this._root.depth():0},nodeSize:function(){return null!==this._root?this._root.nodeSize():0},interfaces_:function(){return[]},getClass:function(){return _n}}),_n.ensureExtent=function(t,e){var n=t.getMin(),i=t.getMax();return n!==i?t:(n===i&&(i=(n-=e/2)+e/2),new hn(n,i))},e(yn.prototype,{getLineSegment:function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},computeSelect:function(t,e,n,i){var r=this._pts[e],s=this._pts[n];if(n-e==1)return i.select(this,e),null;if(!t.intersects(r,s))return null;var o=Math.trunc((e+n)/2);e<o&&this.computeSelect(t,e,o,i),o<n&&this.computeSelect(t,o,n,i)},getCoordinates:function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t},computeOverlaps:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.computeOverlaps(this._start,this._end,t,t._start,t._end,e)}else if(6===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3],o=arguments[4],a=arguments[5];if(i-n==1&&o-s==1)return a.overlap(this,n,r,s),null;if(!this.overlaps(n,i,r,s,o))return null;var l=Math.trunc((n+i)/2),u=Math.trunc((s+o)/2);n<l&&(s<u&&this.computeOverlaps(n,l,r,s,u,a),u<o&&this.computeOverlaps(n,l,r,u,o,a)),l<i&&(s<u&&this.computeOverlaps(l,i,r,s,u,a),u<o&&this.computeOverlaps(l,i,r,u,o,a))}},setId:function(t){this._id=t},select:function(t,e){this.computeSelect(t,this._start,this._end,e)},getEnvelope:function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new F(t,e)}return this._env},overlaps:function(t,e,n,i,r){return F.intersects(this._pts[t],this._pts[e],n._pts[i],n._pts[r])},getEndIndex:function(){return this._end},getStartIndex:function(){return this._start},getContext:function(){return this._context},getId:function(){return this._id},interfaces_:function(){return[]},getClass:function(){return yn}}),e(vn.prototype,{interfaces_:function(){return[]},getClass:function(){return vn}}),vn.isNorthern=function(t){return t===vn.NE||t===vn.NW},vn.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},vn.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(e<t?t:e)?3:n},vn.isInHalfPlane=function(t,e){return e===vn.SE?t===vn.SE||t===vn.SW:t===e||t===e+1},vn.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new i("Cannot compute the quadrant for point ( "+t+", "+e+" )");return 0<=t?0<=e?vn.NE:vn.SE:0<=e?vn.NW:vn.SW}if(arguments[0]instanceof x&&arguments[1]instanceof x){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new i("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?vn.NE:vn.SE:r.y>=n.y?vn.NW:vn.SW}},vn.NE=0,vn.NW=1,vn.SW=2,vn.SE=3,e(bn.prototype,{interfaces_:function(){return[]},getClass:function(){return bn}}),bn.getChainStartIndices=function(t){var e=0,n=new j;n.add(new A(e));do{var i=bn.findChainEnd(t,e);n.add(new A(i)),e=i}while(e<t.length-1);return bn.toIntArray(n)},bn.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=vn.quadrant(t[n],t[n+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||vn.quadrant(t[r-1],t[r])===i);)r++;return r-1},bn.getChains=function(){if(1===arguments.length){var t=arguments[0];return bn.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new j,r=bn.getChainStartIndices(e),s=0;s<r.length-1;s++){var o=new yn(e,r[s],r[s+1],n);i.add(o)}return i}},bn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},e(xn.prototype,{interfaces_:function(){return[]},getClass:function(){return xn}}),xn.orientationIndex=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,s=n.x-e.x,o=n.y-e.y;return xn.signOfDet2x2(i,r,s,o)},xn.signOfDet2x2=function(t,e,n,i){var r=null,s=null,o=null;if(r=1,0===t||0===i)return 0===e||0===n?0:0<e?0<n?-r:r:0<n?r:-r;if(0===e||0===n)return 0<i?0<t?r:-r:0<t?-r:r;if(0<e?0<i?e<=i||(r=-r,s=t,t=n,n=s,s=e,e=i,i=s):i=e<=-i?(r=-r,n=-n,-i):(s=t,t=-n,n=s,s=e,e=-i,s):0<i?-e<=i?(r=-r,t=-t,e=-e):(s=-t,t=n,n=s,s=-e,e=i,i=s):i=i<=e?(t=-t,e=-e,n=-n,-i):(r=-r,s=-t,t=-n,n=s,s=-e,e=-i,s),0<t){if(!(0<n))return r;if(!(t<=n))return r}else{if(0<n)return-r;if(!(n<=t))return-r;r=-r,t=-t,n=-n}for(;;){if((i-=(o=Math.floor(n/t))*e)<0)return-r;if(e<i)return r;if((n-=o*t)+n<t){if(e<i+i)return r}else{if(i+i<e)return-r;n=t-n,i=e-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if((e-=(o=Math.floor(t/n))*i)<0)return r;if(i<e)return-r;if((t-=o*n)+t<n){if(i<e+e)return-r}else{if(e+e<i)return r;t=n-t,e=i-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}},e(En.prototype,{isInside:function(t){},interfaces_:function(){return[]},getClass:function(){return En}}),e(Sn.prototype,{testLineSegment:function(t,e){var n,i,r,s,o=e.p0,a=e.p1;n=o.x-t.x,i=o.y-t.y,r=a.x-t.x,s=a.y-t.y,(0<i&&s<=0||0<s&&i<=0)&&0<xn.signOfDet2x2(n,i,r,s)/(s-i)&&this._crossings++},buildIndex:function(){this._tree=new _n;for(var t=nt.removeRepeatedPoints(this._ring.getCoordinates()),e=bn.getChains(t),n=0;n<e.size();n++){var i=e.get(n),r=i.getEnvelope();this._interval.min=r.getMinY(),this._interval.max=r.getMaxY(),this._tree.insert(this._interval,i)}},testMonotoneChain:function(t,e,n){n.select(t,e)},isInside:function(t){this._crossings=0;var e=new F(s.NEGATIVE_INFINITY,s.POSITIVE_INFINITY,t.y,t.y);this._interval.min=t.y,this._interval.max=t.y;for(var n=this._tree.query(this._interval),i=new Cn(this,t),r=n.iterator();r.hasNext();){var o=r.next();this.testMonotoneChain(e,i,o)}return this._crossings%2==1},interfaces_:function(){return[En]},getClass:function(){return Sn}}),y(Cn,un),e(Cn.prototype,{select:function(){if(1!==arguments.length)return un.prototype.select.apply(this,arguments);var t=arguments[0];this.mcp.testLineSegment(this.p,t)},interfaces_:function(){return[]},getClass:function(){return Cn}}),Sn.MCSelecter=Cn,e(On.prototype,{getRadius:function(){return this.compute(),this._radius},getDiameter:function(){switch(this.compute(),this._extremalPts.length){case 0:return this._input.getFactory().createLineString();case 1:return this._input.getFactory().createPoint(this._centre)}var t=this._extremalPts[0],e=this._extremalPts[1];return this._input.getFactory().createLineString([t,e])},getExtremalPoints:function(){return this.compute(),this._extremalPts},computeCirclePoints:function(){if(this._input.isEmpty())return this._extremalPts=new Array(0).fill(null),null;if(1===this._input.getNumPoints()){var t=this._input.getCoordinates();return this._extremalPts=[new x(t[0])],null}var e=this._input.convexHull().getCoordinates();if(t=e,e[0].equals2D(e[e.length-1])&&(t=new Array(e.length-1).fill(null),nt.copyDeep(e,0,t,0,e.length-1)),t.length<=2)return this._extremalPts=nt.copyDeep(t),null;for(var n=On.lowestPoint(t),i=On.pointWitMinAngleWithX(t,n),r=0;r<t.length;r++){var s=On.pointWithMinAngleWithSegment(t,n,i);if(ve.isObtuse(n,s,i))return this._extremalPts=[new x(n),new x(i)],null;if(ve.isObtuse(s,n,i))n=s;else{if(!ve.isObtuse(s,i,n))return this._extremalPts=[new x(n),new x(i),new x(s)],null;i=s}}b.shouldNeverReachHere("Logic failure in Minimum Bounding Circle algorithm!")},compute:function(){if(null!==this._extremalPts)return null;this.computeCirclePoints(),this.computeCentre(),null!==this._centre&&(this._radius=this._centre.distance(this._extremalPts[0]))},getFarthestPoints:function(){switch(this.compute(),this._extremalPts.length){case 0:return this._input.getFactory().createLineString();case 1:return this._input.getFactory().createPoint(this._centre)}var t=this._extremalPts[0],e=this._extremalPts[this._extremalPts.length-1];return this._input.getFactory().createLineString([t,e])},getCircle:function(){if(this.compute(),null===this._centre)return this._input.getFactory().createPolygon();var t=this._input.getFactory().createPoint(this._centre);return 0===this._radius?t:t.buffer(this._radius)},getCentre:function(){return this.compute(),this._centre},computeCentre:function(){switch(this._extremalPts.length){case 0:this._centre=null;break;case 1:this._centre=this._extremalPts[0];break;case 2:this._centre=new x((this._extremalPts[0].x+this._extremalPts[1].x)/2,(this._extremalPts[0].y+this._extremalPts[1].y)/2);break;case 3:this._centre=be.circumcentre(this._extremalPts[0],this._extremalPts[1],this._extremalPts[2])}},interfaces_:function(){return[]},getClass:function(){return On}}),On.pointWitMinAngleWithX=function(t,e){for(var n=s.MAX_VALUE,i=null,r=0;r<t.length;r++){var o=t[r];if(o!==e){var a=o.x-e.x,l=o.y-e.y;l<0&&(l=-l);var u=l/Math.sqrt(a*a+l*l);u<n&&(n=u,i=o)}}return i},On.lowestPoint=function(t){for(var e=t[0],n=1;n<t.length;n++)t[n].y<e.y&&(e=t[n]);return e},On.pointWithMinAngleWithSegment=function(t,e,n){for(var i=s.MAX_VALUE,r=null,o=0;o<t.length;o++){var a=t[o];if(a!==e&&a!==n){var l=ve.angleBetween(e,a,n);l<i&&(i=l,r=a)}}return r},e(In.prototype,{getWidthCoordinate:function(){return this.computeMinimumDiameter(),this._minWidthPt},getSupportingSegment:function(){return this.computeMinimumDiameter(),this._inputGeom.getFactory().createLineString([this._minBaseSeg.p0,this._minBaseSeg.p1])},getDiameter:function(){if(this.computeMinimumDiameter(),null===this._minWidthPt)return this._inputGeom.getFactory().createLineString();var t=this._minBaseSeg.project(this._minWidthPt);return this._inputGeom.getFactory().createLineString([t,this._minWidthPt])},computeWidthConvex:function(t){this._convexHullPts=t instanceof Vt?t.getExteriorRing().getCoordinates():t.getCoordinates(),0===this._convexHullPts.length?(this._minWidth=0,this._minWidthPt=null,this._minBaseSeg=null):1===this._convexHullPts.length?(this._minWidth=0,this._minWidthPt=this._convexHullPts[0],this._minBaseSeg.p0=this._convexHullPts[0],this._minBaseSeg.p1=this._convexHullPts[0]):2===this._convexHullPts.length||3===this._convexHullPts.length?(this._minWidth=0,this._minWidthPt=this._convexHullPts[0],this._minBaseSeg.p0=this._convexHullPts[0],this._minBaseSeg.p1=this._convexHullPts[1]):this.computeConvexRingMinDiameter(this._convexHullPts)},computeConvexRingMinDiameter:function(t){this._minWidth=s.MAX_VALUE;for(var e=1,n=new me,i=0;i<t.length-1;i++)n.p0=t[i],n.p1=t[i+1],e=this.findMaxPerpDistance(t,n,e)},computeMinimumDiameter:function(){if(null!==this._minWidthPt)return null;if(this._isConvex)this.computeWidthConvex(this._inputGeom);else{var t=new nn(this._inputGeom).getConvexHull();this.computeWidthConvex(t)}},getLength:function(){return this.computeMinimumDiameter(),this._minWidth},findMaxPerpDistance:function(t,e,n){for(var i=e.distancePerpendicular(t[n]),r=i,s=n,o=s;i<=r;)i=r,o=In.nextIndex(t,s=o),r=e.distancePerpendicular(t[o]);return i<this._minWidth&&(this._minPtIndex=s,this._minWidth=i,this._minWidthPt=t[this._minPtIndex],this._minBaseSeg=new me(e)),s},getMinimumRectangle:function(){if(this.computeMinimumDiameter(),0===this._minWidth)return this._minBaseSeg.p0.equals2D(this._minBaseSeg.p1)?this._inputGeom.getFactory().createPoint(this._minBaseSeg.p0):this._minBaseSeg.toGeometry(this._inputGeom.getFactory());for(var t=this._minBaseSeg.p1.x-this._minBaseSeg.p0.x,e=this._minBaseSeg.p1.y-this._minBaseSeg.p0.y,n=s.MAX_VALUE,i=-s.MAX_VALUE,r=s.MAX_VALUE,o=-s.MAX_VALUE,a=0;a<this._convexHullPts.length;a++){var l=In.computeC(t,e,this._convexHullPts[a]);i<l&&(i=l),l<n&&(n=l);var u=In.computeC(-e,t,this._convexHullPts[a]);o<u&&(o=u),u<r&&(r=u)}var c=In.computeSegmentForLine(-t,-e,o),h=In.computeSegmentForLine(-t,-e,r),d=In.computeSegmentForLine(-e,t,i),p=In.computeSegmentForLine(-e,t,n),f=d.lineIntersection(c),g=p.lineIntersection(c),m=p.lineIntersection(h),_=d.lineIntersection(h),y=this._inputGeom.getFactory().createLinearRing([f,g,m,_,f]);return this._inputGeom.getFactory().createPolygon(y)},interfaces_:function(){return[]},getClass:function(){return In}}),In.nextIndex=function(t,e){return++e>=t.length&&(e=0),e},In.computeC=function(t,e,n){return t*n.y-e*n.x},In.getMinimumDiameter=function(t){return new In(t).getDiameter()},In.getMinimumRectangle=function(t){return new In(t).getMinimumRectangle()},In.computeSegmentForLine=function(t,e,n){var i=null;return new me(i,Math.abs(e)>Math.abs(t)?(i=new x(0,n/e),new x(1,n/e-t/e)):(i=new x(n/t,0),new x(n/t-e/t,1)))};var wn=Object.freeze({distance:we,locate:We,match:Ze,Angle:ve,Centroid:Qe,CGAlgorithms:Ke,ConvexHull:nn,Distance:W,InteriorPointArea:sn,InteriorPointLine:an,InteriorPointPoint:ln,RobustLineIntersector:ge,MCPointInRing:Sn,MinimumBoundingCircle:On,MinimumDiameter:In});function Ln(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}function Tn(){this._inputGeom=null,this._distanceTolerance=null;var t=arguments[0];this._inputGeom=t}function jn(){Ln.apply(this),this.distanceTolerance=null;var t=arguments[0];this.distanceTolerance=t}e(Ln.prototype,{transformPoint:function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},transformPolygon:function(t,e){var n=!0,i=this.transformLinearRing(t.getExteriorRing(),t);null!==i&&i instanceof Wt&&!i.isEmpty()||(n=!1);for(var r=new j,s=0;s<t.getNumInteriorRing();s++){var o=this.transformLinearRing(t.getInteriorRingN(s),t);null===o||o.isEmpty()||(o instanceof Wt||(n=!1),r.add(o))}if(n)return this._factory.createPolygon(i,r.toArray([]));var a=new j;return null!==i&&a.add(i),a.addAll(r),this._factory.buildGeometry(a)},createCoordinateSequence:function(t){return this._factory.getCoordinateSequenceFactory().create(t)},getInputGeometry:function(){return this._inputGeom},transformMultiLineString:function(t,e){for(var n=new j,i=0;i<t.getNumGeometries();i++){var r=this.transformLineString(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this._factory.buildGeometry(n)},transformCoordinates:function(t,e){return this.copy(t)},transformLineString:function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},transformMultiPoint:function(t,e){for(var n=new j,i=0;i<t.getNumGeometries();i++){var r=this.transformPoint(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this._factory.buildGeometry(n)},transformMultiPolygon:function(t,e){for(var n=new j,i=0;i<t.getNumGeometries();i++){var r=this.transformPolygon(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this._factory.buildGeometry(n)},copy:function(t){return t.copy()},transformGeometryCollection:function(t,e){for(var n=new j,i=0;i<t.getNumGeometries();i++){var r=this.transform(t.getGeometryN(i));null!==r&&(this._pruneEmptyGeometry&&r.isEmpty()||n.add(r))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(le.toGeometryArray(n)):this._factory.buildGeometry(n)},transform:function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Bt)return this.transformPoint(t,null);if(t instanceof Ut)return this.transformMultiPoint(t,null);if(t instanceof Wt)return this.transformLinearRing(t,null);if(t instanceof kt)return this.transformLineString(t,null);if(t instanceof It)return this.transformMultiLineString(t,null);if(t instanceof Vt)return this.transformPolygon(t,null);if(t instanceof Yt)return this.transformMultiPolygon(t,null);if(t instanceof Ot)return this.transformGeometryCollection(t,null);throw new i("Unknown Geometry subtype: "+t.getClass().getName())},transformLinearRing:function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this._factory.createLinearRing(null);var i=n.size();return 0<i&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)},interfaces_:function(){return[]},getClass:function(){return Ln}}),e(Tn.prototype,{getResultGeometry:function(){return new jn(this._distanceTolerance).transform(this._inputGeom)},setDistanceTolerance:function(t){if(t<=0)throw new i("Tolerance must be positive");this._distanceTolerance=t},interfaces_:function(){return[]},getClass:function(){return Tn}}),Tn.densifyPoints=function(t,e,n){for(var i=new me,r=new M,s=0;s<t.length-1;s++){i.p0=t[s],i.p1=t[s+1],r.add(i.p0,!1);var o=i.getLength(),a=Math.trunc(o/e)+1;if(1<a)for(var l=o/a,u=1;u<a;u++){var c=u*l/o,h=i.pointAlong(c);n.makePrecise(h),r.add(h,!1)}}return r.add(t[t.length-1],!1),r.toCoordinateArray()},Tn.densify=function(t,e){var n=new Tn(t);return n.setDistanceTolerance(e),n.getResultGeometry()},y(jn,Ln),e(jn.prototype,{transformMultiPolygon:function(t,e){var n=Ln.prototype.transformMultiPolygon.call(this,t,e);return this.createValidArea(n)},transformPolygon:function(t,e){var n=Ln.prototype.transformPolygon.call(this,t,e);return e instanceof Yt?n:this.createValidArea(n)},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=Tn.densifyPoints(n,this.distanceTolerance,e.getPrecisionModel());return e instanceof kt&&1===i.length&&(i=new Array(0).fill(null)),this._factory.getCoordinateSequenceFactory().create(i)},createValidArea:function(t){return t.buffer(0)},interfaces_:function(){return[]},getClass:function(){return jn}}),Tn.DensifyTransformer=jn;var Nn=Object.freeze({Densifier:Tn});function Mn(){this._orig=null,this._sym=null,this._next=null;var t=arguments[0];this._orig=t}function Fn(){this._isMarked=!1;var t=arguments[0];Mn.call(this,t)}function Pn(){this._vertexMap=new se}function Rn(){this._isStart=!1;var t=arguments[0];Fn.call(this,t)}function Dn(){Pn.apply(this)}function An(){this._result=null,this._factory=null,this._graph=null,this._lines=new j,this._nodeEdgeStack=new tn,this._ringStartEdge=null,this._graph=new Dn}e(Mn.prototype,{find:function(t){var e=this;do{if(null===e)return null;if(e.dest().equals2D(t))return e;e=e.oNext()}while(e!==this);return null},dest:function(){return this._sym._orig},oNext:function(){return this._sym._next},insert:function(t){if(this.oNext()===this)return this.insertAfter(t),null;var e=this.compareTo(t),n=this;do{var i=n.oNext();if(i.compareTo(t)!==e||i===this)return n.insertAfter(t),null;n=i}while(n!==this);b.shouldNeverReachHere()},insertAfter:function(t){b.equals(this._orig,t.orig());var e=this.oNext();this._sym.setNext(t),t.sym().setNext(e)},degree:function(){for(var t=0,e=this;t++,(e=e.oNext())!==this;);return t},equals:function(){if(2===arguments.length&&arguments[1]instanceof x&&arguments[0]instanceof x){var t=arguments[0],e=arguments[1];return this._orig.equals2D(t)&&this._sym._orig.equals(e)}},deltaY:function(){return this._sym._orig.y-this._orig.y},sym:function(){return this._sym},prev:function(){return this._sym.next()._sym},compareAngularDirection:function(t){var e=this.deltaX(),n=this.deltaY(),i=t.deltaX(),r=t.deltaY();if(e===i&&n===r)return 0;var s=vn.quadrant(e,n),o=vn.quadrant(i,r);return o<s?1:s<o?-1:z.index(t._orig,t.dest(),this.dest())},prevNode:function(){for(var t=this;2===t.degree();)if((t=t.prev())===this)return null;return t},compareTo:function(t){var e=t;return this.compareAngularDirection(e)},next:function(){return this._next},setSym:function(t){this._sym=t},orig:function(){return this._orig},toString:function(){return"HE("+this._orig.x+" "+this._orig.y+", "+this._sym._orig.x+" "+this._sym._orig.y+")"},setNext:function(t){this._next=t},init:function(t){this.setSym(t),t.setSym(this),this.setNext(t),t.setNext(this)},deltaX:function(){return this._sym._orig.x-this._orig.x},interfaces_:function(){return[]},getClass:function(){return Mn}}),Mn.init=function(t,e){if(null!==t._sym||null!==e._sym||null!==t._next||null!==e._next)throw new IllegalStateException("Edges are already initialized");return t.init(e),t},Mn.create=function(t,e){var n=new Mn(t),i=new Mn(e);return n.init(i),n},y(Fn,Mn),e(Fn.prototype,{mark:function(){this._isMarked=!0},setMark:function(t){this._isMarked=t},isMarked:function(){return this._isMarked},interfaces_:function(){return[]},getClass:function(){return Fn}}),Fn.setMarkBoth=function(t,e){t.setMark(e),t.sym().setMark(e)},Fn.isMarked=function(t){return t.isMarked()},Fn.setMark=function(t,e){t.setMark(e)},Fn.markBoth=function(t){t.mark(),t.sym().mark()},Fn.mark=function(t){t.mark()},e(Pn.prototype,{insert:function(t,e,n){var i=this.create(t,e);null!==n?n.insert(i):this._vertexMap.put(t,i);var r=this._vertexMap.get(e);return null!==r?r.insert(i.sym()):this._vertexMap.put(e,i.sym()),i},create:function(t,e){var n=this.createEdge(t),i=this.createEdge(e);return Mn.init(n,i),n},createEdge:function(t){return new Mn(t)},addEdge:function(t,e){if(!Pn.isValidEdge(t,e))return null;var n=this._vertexMap.get(t),i=null;return null!==n&&(i=n.find(e)),null!==i?i:this.insert(t,e,n)},getVertexEdges:function(){return this._vertexMap.values()},findEdge:function(t,e){var n=this._vertexMap.get(t);return null===n?null:n.find(e)},interfaces_:function(){return[]},getClass:function(){return Pn}}),Pn.isValidEdge=function(t,e){return 0!==e.compareTo(t)},y(Rn,Fn),e(Rn.prototype,{setStart:function(){this._isStart=!0},isStart:function(){return this._isStart},interfaces_:function(){return[]},getClass:function(){return Rn}}),y(Dn,Pn),e(Dn.prototype,{createEdge:function(t){return new Rn(t)},interfaces_:function(){return[]},getClass:function(){return Dn}}),e(An.prototype,{addLine:function(t){this._lines.add(this._factory.createLineString(t.toCoordinateArray()))},updateRingStartEdge:function(t){return t.isStart()||(t=t.sym()).isStart()?null===this._ringStartEdge?(this._ringStartEdge=t,null):void(t.orig().compareTo(this._ringStartEdge.orig())<0&&(this._ringStartEdge=t)):null},getResult:function(){return null===this._result&&this.computeResult(),this._result},process:function(t){var e=t.prevNode();null===e&&(e=t),this.stackEdges(e),this.buildLines()},buildRing:function(t){var e=new M,n=t;for(e.add(n.orig().copy(),!1);2===n.sym().degree();){var i=n.next();if(i===t)break;e.add(i.orig().copy(),!1),n=i}e.add(n.dest().copy(),!1),this.addLine(e)},buildLine:function(t){var e=new M,n=t;for(this._ringStartEdge=null,Fn.markBoth(n),e.add(n.orig().copy(),!1);2===n.sym().degree();){this.updateRingStartEdge(n);var i=n.next();if(i===t)return this.buildRing(this._ringStartEdge),null;e.add(i.orig().copy(),!1),Fn.markBoth(n=i)}e.add(n.dest().clone(),!1),this.stackEdges(n.sym()),this.addLine(e)},stackEdges:function(t){for(var e=t;Fn.isMarked(e)||this._nodeEdgeStack.add(e),(e=e.oNext())!==t;);},computeResult:function(){for(var t=this._graph.getVertexEdges().iterator();t.hasNext();){var e=t.next();Fn.isMarked(e)||this.process(e)}this._result=this._factory.buildGeometry(this._lines)},buildLines:function(){for(;!this._nodeEdgeStack.empty();){var t=this._nodeEdgeStack.pop();Fn.isMarked(t)||this.buildLine(t)}},add:function(){if(arguments[0]instanceof X)arguments[0].apply({interfaces_:function(){return[J]},filter:function(t){t instanceof kt&&this.add(t)}});else if(S(arguments[0],O))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.add(e)}else if(arguments[0]instanceof kt){var n=arguments[0];null===this._factory&&(this._factory=n.getFactory());var i=n.getCoordinateSequence(),r=!1;for(t=1;t<i.size();t++){var s=this._graph.addEdge(i.getCoordinate(t-1),i.getCoordinate(t));null!==s&&(r||(s.setStart(),r=!0))}}},interfaces_:function(){return[]},getClass:function(){return An}}),An.dissolve=function(t){var e=new An;return e.add(t),e.getResult()};var kn=Object.freeze({LineDissolver:An});function Gn(){if(this._boundaryRule=Q.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new i("Rule must be non-null");this._boundaryRule=t}}function Bn(){}function zn(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e}function qn(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var t=arguments[0],e=arguments[1];this._eventType=qn.DELETE,this._xValue=t,this._insertEvent=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._eventType=qn.INSERT,this._label=n,this._xValue=i,this._obj=r}}function Vn(){}function Un(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n}function Wn(){Vn.apply(this),this.events=new j,this.nOverlaps=null}function Yn(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.init(1),this.location[Bn.ON]=e}else if(arguments[0]instanceof Yn){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var i=0;i<this.location.length;i++)this.location[i]=n.location[i]}}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.init(3),this.location[Bn.ON]=r,this.location[Bn.LEFT]=s,this.location[Bn.RIGHT]=o}}function Hn(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Yn(t),this.elt[1]=new Yn(t)}else if(arguments[0]instanceof Hn){var e=arguments[0];this.elt[0]=new Yn(e.elt[0]),this.elt[1]=new Yn(e.elt[1])}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.elt[0]=new Yn(_e.NONE),this.elt[1]=new Yn(_e.NONE),this.elt[n].setLocation(i)}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];this.elt[0]=new Yn(r,s,o),this.elt[1]=new Yn(r,s,o)}else if(4===arguments.length){var a=arguments[0],l=arguments[1],u=arguments[2],c=arguments[3];this.elt[0]=new Yn(_e.NONE,_e.NONE,_e.NONE),this.elt[1]=new Yn(_e.NONE,_e.NONE,_e.NONE),this.elt[a].setLocations(l,u,c)}}function Jn(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new x(t),this.segmentIndex=e,this.dist=n}function Xn(){this._nodeMap=new gt,this.edge=null;var t=arguments[0];this.edge=t}function Zn(){}function Qn(){this.e=null,this.pts=null,this.startIndex=null;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Zn;this.startIndex=e.getChainStartIndices(this.pts)}function Kn(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var e=0;e<3;e++)this._depth[t][e]=Kn.NULL_VALUE}function $n(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}}function ti(){if($n.apply(this),this.pts=null,this._env=null,this.eiList=new Xn(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Kn,this._depthDelta=0,1===arguments.length){var t=arguments[0];ti.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.pts=e,this._label=n}}function ei(){$n.apply(this),this._coord=null,this._edges=null;var t=arguments[0],e=arguments[1];this._coord=t,this._edges=e,this._label=new Hn(0,_e.NONE)}function ni(){this.nodeMap=new gt,this.nodeFact=null;var t=arguments[0];this.nodeFact=t}function ii(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];ii.call(this,e,n,i,null)}else if(4===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];ii.call(this,r),this.init(s,o),this._label=a}}function ri(){if(this.pt=null,1===arguments.length){var t=arguments[0];_.call(this,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];_.call(this,ri.msgWithCoord(e,n)),this.name="TopologyException",this.pt=new x(n)}}function si(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var t=arguments[0],e=arguments[1];if(ii.call(this,t),this._isForward=e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var n=t.getNumPoints()-1;this.init(t.getCoordinate(n),t.getCoordinate(n-1))}this.computeDirectedLabel()}function oi(){}function ai(){if(this._edges=new j,this._nodes=null,this._edgeEndList=new j,0===arguments.length)this._nodes=new ni(new oi);else if(1===arguments.length){var t=arguments[0];this._nodes=new ni(t)}}function li(){if(ai.apply(this),this._parentGeom=null,this._lineEdgeMap=new se,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Gn,2===arguments.length){var t=arguments[0],e=arguments[1];li.call(this,t,e,Q.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=r,null!==i&&this.add(i)}}e(Gn.prototype,{locateInPolygonRing:function(t,e){return e.getEnvelopeInternal().intersects(t)?qe.locateInRing(t,e.getCoordinates()):_e.EXTERIOR},intersects:function(t,e){return this.locate(t,e)!==_e.EXTERIOR},updateLocationInfo:function(t){t===_e.INTERIOR&&(this._isIn=!0),t===_e.BOUNDARY&&this._numBoundaries++},computeLocation:function(t,e){if(e instanceof Bt&&this.updateLocationInfo(this.locateOnPoint(t,e)),e instanceof kt)this.updateLocationInfo(this.locateOnLineString(t,e));else if(e instanceof Vt)this.updateLocationInfo(this.locateInPolygon(t,e));else if(e instanceof It)for(var n=e,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateOnLineString(t,r))}else if(e instanceof Yt){var s=e;for(i=0;i<s.getNumGeometries();i++){var o=s.getGeometryN(i);this.updateLocationInfo(this.locateInPolygon(t,o))}}else if(e instanceof Ot)for(var a=new Ve(e);a.hasNext();){var l=a.next();l!==e&&this.computeLocation(t,l)}},locateOnPoint:function(t,e){return e.getCoordinate().equals2D(t)?_e.INTERIOR:_e.EXTERIOR},locateOnLineString:function(t,e){if(!e.getEnvelopeInternal().intersects(t))return _e.EXTERIOR;var n=e.getCoordinateSequence();return e.isClosed()||!t.equals(n.getCoordinate(0))&&!t.equals(n.getCoordinate(n.size()-1))?qe.isOnLine(t,n)?_e.INTERIOR:_e.EXTERIOR:_e.BOUNDARY},locateInPolygon:function(t,e){if(e.isEmpty())return _e.EXTERIOR;var n=e.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===_e.EXTERIOR)return _e.EXTERIOR;if(i===_e.BOUNDARY)return _e.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var s=e.getInteriorRingN(r),o=this.locateInPolygonRing(t,s);if(o===_e.INTERIOR)return _e.EXTERIOR;if(o===_e.BOUNDARY)return _e.BOUNDARY}return _e.INTERIOR},locate:function(t,e){return e.isEmpty()?_e.EXTERIOR:e instanceof kt?this.locateOnLineString(t,e):e instanceof Vt?this.locateInPolygon(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?_e.BOUNDARY:0<this._numBoundaries||this._isIn?_e.INTERIOR:_e.EXTERIOR)},interfaces_:function(){return[]},getClass:function(){return Gn}}),e(Bn.prototype,{interfaces_:function(){return[]},getClass:function(){return Bn}}),Bn.opposite=function(t){return t===Bn.LEFT?Bn.RIGHT:t===Bn.RIGHT?Bn.LEFT:t},Bn.ON=0,Bn.LEFT=1,Bn.RIGHT=2,e(zn.prototype,{computeIntersections:function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},interfaces_:function(){return[]},getClass:function(){return zn}}),e(qn.prototype,{isDelete:function(){return this._eventType===qn.DELETE},setDeleteEventIndex:function(t){this._deleteEventIndex=t},getObject:function(){return this._obj},compareTo:function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},getInsertEvent:function(){return this._insertEvent},isInsert:function(){return this._eventType===qn.INSERT},isSameLabel:function(t){return null!==this._label&&this._label===t._label},getDeleteEventIndex:function(){return this._deleteEventIndex},interfaces_:function(){return[p]},getClass:function(){return qn}}),qn.INSERT=1,qn.DELETE=2,e(Vn.prototype,{interfaces_:function(){return[]},getClass:function(){return Vn}}),e(Un.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this._li.getIntersectionNum()){if(Un.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this._properIntersectionPoint},setIsDoneIfProperInt:function(t){this._isDoneWhenProperInt=t},hasProperInteriorIntersection:function(){return this._hasProperInterior},isBoundaryPointInternal:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next().getCoordinate();if(t.isIntersection(i))return!0}return!1},hasProperIntersection:function(){return this._hasProper},hasIntersection:function(){return this._hasIntersection},isDone:function(){return this._isDone},isBoundaryPoint:function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},setBoundaryNodes:function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},addIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},interfaces_:function(){return[]},getClass:function(){return Un}}),Un.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},y(Wn,Vn),e(Wn.prototype,{prepareEvents:function(){Fe.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},computeIntersections:function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Un&&S(arguments[0],w)&&S(arguments[1],w)){var i=arguments[0],r=arguments[1],s=arguments[2];this.addEdges(i,i),this.addEdges(r,r),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&S(arguments[0],w)&&arguments[1]instanceof Un){var o=arguments[0],a=arguments[1];arguments[2]?this.addEdges(o,null):this.addEdges(o),this.computeIntersections(a)}},addEdge:function(t,e){for(var n=t.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var s=new zn(n,r),o=new qn(e,n.getMinX(r),s);this.events.add(o),this.events.add(new qn(n.getMaxX(r),o))}},processOverlaps:function(t,e,n,i){for(var r=n.getObject(),s=t;s<e;s++){var o=this.events.get(s);if(o.isInsert()){var a=o.getObject();n.isSameLabel(o)||(r.computeIntersections(a,i),this.nOverlaps++)}}},addEdges:function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length){var n=arguments[1];for(t=arguments[0].iterator();t.hasNext();)e=t.next(),this.addEdge(e,n)}},interfaces_:function(){return[]},getClass:function(){return Wn}}),e(Yn.prototype,{setAllLocations:function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},isNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==_e.NONE)return!1;return!0},setAllLocationsIfNull:function(t){for(var e=0;e<this.location.length;e++)this.location[e]===_e.NONE&&(this.location[e]=t)},isLine:function(){return 1===this.location.length},merge:function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Bn.ON]=this.location[Bn.ON],e[Bn.LEFT]=_e.NONE,e[Bn.RIGHT]=_e.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===_e.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},getLocations:function(){return this.location},flip:function(){if(this.location.length<=1)return null;var t=this.location[Bn.LEFT];this.location[Bn.LEFT]=this.location[Bn.RIGHT],this.location[Bn.RIGHT]=t},toString:function(){var t=new D;return 1<this.location.length&&t.append(_e.toLocationSymbol(this.location[Bn.LEFT])),t.append(_e.toLocationSymbol(this.location[Bn.ON])),1<this.location.length&&t.append(_e.toLocationSymbol(this.location[Bn.RIGHT])),t.toString()},setLocations:function(t,e,n){this.location[Bn.ON]=t,this.location[Bn.LEFT]=e,this.location[Bn.RIGHT]=n},get:function(t){return t<this.location.length?this.location[t]:_e.NONE},isArea:function(){return 1<this.location.length},isAnyNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===_e.NONE)return!0;return!1},setLocation:function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Bn.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},init:function(t){this.location=new Array(t).fill(null),this.setAllLocations(_e.NONE)},isEqualOnSide:function(t,e){return this.location[e]===t.location[e]},allPositionsEqual:function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},interfaces_:function(){return[]},getClass:function(){return Yn}}),e(Hn.prototype,{getGeometryCount:function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},setAllLocations:function(t,e){this.elt[t].setAllLocations(e)},isNull:function(t){return this.elt[t].isNull()},setAllLocationsIfNull:function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},isLine:function(t){return this.elt[t].isLine()},merge:function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Yn(t.elt[e]):this.elt[e].merge(t.elt[e])},flip:function(){this.elt[0].flip(),this.elt[1].flip()},getLocation:function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Bn.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},toString:function(){var t=new D;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},isArea:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},isAnyNull:function(t){return this.elt[t].isAnyNull()},setLocation:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Bn.ON,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},isEqualOnSide:function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},allPositionsEqual:function(t,e){return this.elt[t].allPositionsEqual(e)},toLine:function(t){this.elt[t].isArea()&&(this.elt[t]=new Yn(this.elt[t].location[0]))},interfaces_:function(){return[]},getClass:function(){return Hn}}),Hn.toLineLabel=function(t){for(var e=new Hn(_e.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e},e(Jn.prototype,{getSegmentIndex:function(){return this.segmentIndex},getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},compareTo:function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},isEndPoint:function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},toString:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},getDistance:function(){return this.dist},compare:function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},interfaces_:function(){return[p]},getClass:function(){return Jn}}),e(Xn.prototype,{print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},iterator:function(){return this._nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},addEndpoints:function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],r=0<e.dist||!e.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new x(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)s[o++]=this.edge.pts[a];return r&&(s[o]=e.coord),new ti(s,new Hn(this.edge._label))},add:function(t,e,n){var i=new Jn(t,e,n),r=this._nodeMap.get(i);return null!==r?r:(this._nodeMap.put(i,i),i)},isIntersection:function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},interfaces_:function(){return[]},getClass:function(){return Xn}}),e(Zn.prototype,{getChainStartIndices:function(t){var e=0,n=new j;n.add(new A(e));do{var i=this.findChainEnd(t,e);n.add(new A(i)),e=i}while(e<t.length-1);return Zn.toIntArray(n)},findChainEnd:function(t,e){for(var n=vn.quadrant(t[e],t[e+1]),i=e+1;i<t.length&&vn.quadrant(t[i-1],t[i])===n;)i++;return i-1},interfaces_:function(){return[]},getClass:function(){return Zn}}),Zn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},e(Qn.prototype,{getCoordinates:function(){return this.pts},getMaxX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return n<e?e:n},getMinX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},computeIntersectsForChain:function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],l=arguments[4],u=arguments[5];if(s-r==1&&l-a==1)return u.addIntersections(this.e,r,o.e,a),null;if(!this.overlaps(r,s,o,a,l))return null;var c=Math.trunc((r+s)/2),h=Math.trunc((a+l)/2);r<c&&(a<h&&this.computeIntersectsForChain(r,c,o,a,h,u),h<l&&this.computeIntersectsForChain(r,c,o,h,l,u)),c<s&&(a<h&&this.computeIntersectsForChain(c,s,o,a,h,u),h<l&&this.computeIntersectsForChain(c,s,o,h,l,u))}},overlaps:function(t,e,n,i,r){return F.intersects(this.pts[t],this.pts[e],n.pts[i],n.pts[r])},getStartIndexes:function(){return this.startIndex},computeIntersects:function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)},interfaces_:function(){return[]},getClass:function(){return Qn}}),e(Kn.prototype,{getDepth:function(t,e){return this._depth[t][e]},setDepth:function(t,e,n){this._depth[t][e]=n},isNull:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==Kn.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this._depth[n][1]===Kn.NULL_VALUE}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this._depth[i][r]===Kn.NULL_VALUE}},normalize:function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var n=1;n<3;n++){var i=0;this._depth[t][n]>e&&(i=1),this._depth[t][n]=i}}},getDelta:function(t){return this._depth[t][Bn.RIGHT]-this._depth[t][Bn.LEFT]},getLocation:function(t,e){return this._depth[t][e]<=0?_e.EXTERIOR:_e.INTERIOR},toString:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},add:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var n=1;n<3;n++){var i=t.getLocation(e,n);i!==_e.EXTERIOR&&i!==_e.INTERIOR||(this.isNull(e,n)?this._depth[e][n]=Kn.depthAtLocation(i):this._depth[e][n]+=Kn.depthAtLocation(i))}else if(3===arguments.length){var r=arguments[0],s=arguments[1];arguments[2]===_e.INTERIOR&&this._depth[r][s]++}},interfaces_:function(){return[]},getClass:function(){return Kn}}),Kn.depthAtLocation=function(t){return t===_e.EXTERIOR?0:t===_e.INTERIOR?1:Kn.NULL_VALUE},Kn.NULL_VALUE=-1,e($n.prototype,{setVisited:function(t){this._isVisited=t},setInResult:function(t){this._isInResult=t},isCovered:function(){return this._isCovered},isCoveredSet:function(){return this._isCoveredSet},setLabel:function(t){this._label=t},getLabel:function(){return this._label},setCovered:function(t){this._isCovered=t,this._isCoveredSet=!0},updateIM:function(t){b.isTrue(2<=this._label.getGeometryCount(),"found partial label"),this.computeIM(t)},isInResult:function(){return this._isInResult},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return $n}}),y(ti,$n),e(ti.prototype,{getDepth:function(){return this._depth},getCollapsedEdge:function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new ti(t,Hn.toLineLabel(this._label))},isIsolated:function(){return this._isIsolated},getCoordinates:function(){return this.pts},setIsolated:function(t){this._isIsolated=t},setName:function(t){this._name=t},equals:function(t){if(!(t instanceof ti))return!1;var e=t;if(this.pts.length!==e.pts.length)return!1;for(var n=!0,i=!0,r=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(e.pts[s])||(n=!1),this.pts[s].equals2D(e.pts[--r])||(i=!1),!n&&!i)return!1;return!0},getCoordinate:function(){if(0===arguments.length)return 0<this.pts.length?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},print:function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)0<e&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},computeIM:function(t){ti.updateIM(this._label,t)},isCollapsed:function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getMaximumSegmentIndex:function(){return this.pts.length-1},getDepthDelta:function(){return this._depthDelta},getNumPoints:function(){return this.pts.length},printReverse:function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;0<=e;e--)t.print(this.pts[e]+" ");t.println("")},getMonotoneChainEdge:function(){return null===this._mce&&(this._mce=new Qn(this)),this._mce},getEnvelope:function(){if(null===this._env){this._env=new F;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},addIntersection:function(t,e,n,i){var r=new x(t.getIntersection(i)),s=e,o=t.getEdgeDistance(n,i),a=s+1;if(a<this.pts.length){var l=this.pts[a];r.equals2D(l)&&(s=a,o=0)}this.eiList.add(r,s,o)},toString:function(){var t=new Dt;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)0<e&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},isPointwiseEqual:function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},setDepthDelta:function(t){this._depthDelta=t},getEdgeIntersectionList:function(){return this.eiList},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[]},getClass:function(){return ti}}),ti.updateIM=function(){if(!(2===arguments.length&&arguments[1]instanceof ye&&arguments[0]instanceof Hn))return $n.prototype.updateIM.apply(this,arguments);var t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,Bn.ON),t.getLocation(1,Bn.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,Bn.LEFT),t.getLocation(1,Bn.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,Bn.RIGHT),t.getLocation(1,Bn.RIGHT),2))},y(ei,$n),e(ei.prototype,{isIncidentEdgeInResult:function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},isIsolated:function(){return 1===this._label.getGeometryCount()},getCoordinate:function(){return this._coord},print:function(t){t.println("node "+this._coord+" lbl: "+this._label)},computeIM:function(t){},computeMergedLocation:function(t,e){var n=_e.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){var i=t.getLocation(e);n!==_e.BOUNDARY&&(n=i)}return n},setLabel:function(){if(2!==arguments.length||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return $n.prototype.setLabel.apply(this,arguments);var t=arguments[0],e=arguments[1];null===this._label?this._label=new Hn(t,e):this._label.setLocation(t,e)},getEdges:function(){return this._edges},mergeLabel:function(){if(arguments[0]instanceof ei){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Hn)for(var e=arguments[0],n=0;n<2;n++){var i=this.computeMergedLocation(e,n);this._label.getLocation(n)===_e.NONE&&this._label.setLocation(n,i)}},add:function(t){this._edges.insert(t),t.setNode(this)},setLabelBoundary:function(t){if(null===this._label)return null;var e=_e.NONE;null!==this._label&&(e=this._label.getLocation(t));var n=null;switch(e){case _e.BOUNDARY:n=_e.INTERIOR;break;case _e.INTERIOR:default:n=_e.BOUNDARY}this._label.setLocation(t,n)},interfaces_:function(){return[]},getClass:function(){return ei}}),e(ni.prototype,{find:function(t){return this.nodeMap.get(t)},addNode:function(){if(arguments[0]instanceof x){var t=arguments[0];return null===(e=this.nodeMap.get(t))&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof ei){var e,n=arguments[0];return null===(e=this.nodeMap.get(n.getCoordinate()))?(this.nodeMap.put(n.getCoordinate(),n),n):(e.mergeLabel(n),e)}},print:function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},iterator:function(){return this.nodeMap.values().iterator()},values:function(){return this.nodeMap.values()},getBoundaryNodes:function(t){for(var e=new j,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===_e.BOUNDARY&&e.add(i)}return e},add:function(t){var e=t.getCoordinate();this.addNode(e).add(t)},interfaces_:function(){return[]},getClass:function(){return ni}}),e(ii.prototype,{compareDirection:function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:z.index(t._p0,t._p1,this._p1)},getDy:function(){return this._dy},getCoordinate:function(){return this._p0},setNode:function(t){this._node=t},print:function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);t.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},compareTo:function(t){var e=t;return this.compareDirection(e)},getDirectedCoordinate:function(){return this._p1},getDx:function(){return this._dx},getLabel:function(){return this._label},getEdge:function(){return this._edge},getQuadrant:function(){return this._quadrant},getNode:function(){return this._node},toString:function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},computeLabel:function(t){},init:function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=vn.quadrant(this._dx,this._dy),b.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},interfaces_:function(){return[p]},getClass:function(){return ii}}),y(ri,_),e(ri.prototype,{getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return ri}}),ri.msgWithCoord=function(t,e){return null!==e?t+" [ "+e+" ]":t},y(si,ii),e(si.prototype,{getNextMin:function(){return this._nextMin},getDepth:function(t){return this._depth[t]},setVisited:function(t){this._isVisited=t},computeDirectedLabel:function(){this._label=new Hn(this._edge.getLabel()),this._isForward||this._label.flip()},getNext:function(){return this._next},setDepth:function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new ri("assigned depths do not match",this.getCoordinate());this._depth[t]=e},isInteriorAreaEdge:function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Bn.LEFT)===_e.INTERIOR&&this._label.getLocation(e,Bn.RIGHT)===_e.INTERIOR||(t=!1);return t},setNextMin:function(t){this._nextMin=t},print:function(t){ii.prototype.print.call(this,t),t.print(" "+this._depth[Bn.LEFT]+"/"+this._depth[Bn.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},setMinEdgeRing:function(t){this._minEdgeRing=t},isLineEdge:function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,_e.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,_e.EXTERIOR);return t&&e&&n},setEdgeRing:function(t){this._edgeRing=t},getMinEdgeRing:function(){return this._minEdgeRing},getDepthDelta:function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},setInResult:function(t){this._isInResult=t},getSym:function(){return this._sym},isForward:function(){return this._isForward},getEdge:function(){return this._edge},printEdge:function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},setSym:function(t){this._sym=t},setVisitedEdge:function(t){this.setVisited(t),this._sym.setVisited(t)},setEdgeDepths:function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var i=1;t===Bn.LEFT&&(i=-1);var r=Bn.opposite(t),s=e+n*i;this.setDepth(t,e),this.setDepth(r,s)},getEdgeRing:function(){return this._edgeRing},isInResult:function(){return this._isInResult},setNext:function(t){this._next=t},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return si}}),si.depthFactor=function(t,e){return t===_e.EXTERIOR&&e===_e.INTERIOR?1:t===_e.INTERIOR&&e===_e.EXTERIOR?-1:0},e(oi.prototype,{createNode:function(t){return new ei(t,null)},interfaces_:function(){return[]},getClass:function(){return oi}}),e(ai.prototype,{printEdges:function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var n=this._edges.get(e);n.print(t),n.eiList.print(t)}},find:function(t){return this._nodes.find(t)},addNode:function(){if(arguments[0]instanceof ei){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof x){var e=arguments[0];return this._nodes.addNode(e)}},getNodeIterator:function(){return this._nodes.iterator()},linkResultDirectedEdges:function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},debugPrintln:function(t){q.out.println(t)},isBoundaryNode:function(t,e){var n=this._nodes.find(e);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(t)===_e.BOUNDARY},linkAllDirectedEdges:function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},matchInSameDirection:function(t,e,n,i){return!!t.equals(n)&&z.index(t,e,i)===z.COLLINEAR&&vn.quadrant(t,e)===vn.quadrant(n,i)},getEdgeEnds:function(){return this._edgeEndList},debugPrint:function(t){q.out.print(t)},getEdgeIterator:function(){return this._edges.iterator()},findEdgeInSameDirection:function(t,e){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return i;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return i}return null},insertEdge:function(t){this._edges.add(t)},findEdgeEnd:function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},addEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this._edges.add(n);var i=new si(n,!0),r=new si(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},add:function(t){this._nodes.add(t),this._edgeEndList.add(t)},getNodes:function(){return this._nodes.values()},findEdge:function(t,e){for(var n=0;n<this._edges.size();n++){var i=this._edges.get(n),r=i.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return i}return null},interfaces_:function(){return[]},getClass:function(){return ai}}),ai.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},y(li,ai),e(li.prototype,{insertBoundaryPoint:function(t,e){var n=this._nodes.addNode(e).getLabel(),i=1;n.getLocation(t,Bn.ON)===_e.BOUNDARY&&i++;var r=li.determineBoundary(this._boundaryNodeRule,i);n.setLocation(t,r)},computeSelfNodes:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[1],i=arguments[2],r=new Un(arguments[0],!0,!1);r.setIsDoneIfProperInt(i);var s=this.createEdgeSetIntersector(),o=this._parentGeom instanceof Wt||this._parentGeom instanceof Vt||this._parentGeom instanceof Yt,a=n||!o;return s.computeIntersections(this._edges,r,a),this.addSelfIntersectionNodes(this._argIndex),r}},computeSplitEdges:function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},computeEdgeIntersections:function(t,e,n){var i=new Un(e,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,i),i},getGeometry:function(){return this._parentGeom},getBoundaryNodeRule:function(){return this._boundaryNodeRule},hasTooFewPoints:function(){return this._hasTooFewPoints},addPoint:function(){if(arguments[0]instanceof Bt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,_e.INTERIOR)}else if(arguments[0]instanceof x){var e=arguments[0];this.insertPoint(this._argIndex,e,_e.INTERIOR)}},addPolygon:function(t){this.addPolygonRing(t.getExteriorRing(),_e.EXTERIOR,_e.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,_e.INTERIOR,_e.EXTERIOR)}},addEdge:function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],_e.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],_e.BOUNDARY)},addLineString:function(t){var e=nt.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var n=new ti(e,new Hn(this._argIndex,_e.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),b.isTrue(2<=e.length,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},getInvalidPoint:function(){return this._invalidPoint},getBoundaryPoints:function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,i=t.iterator();i.hasNext();){var r=i.next();e[n++]=r.getCoordinate().copy()}return e},getBoundaryNodes:function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},addSelfIntersectionNode:function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===_e.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},addPolygonRing:function(t,e,n){if(t.isEmpty())return null;var i=nt.removeRepeatedPoints(t.getCoordinates());if(i.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var r=e,s=n;z.isCCW(i)&&(r=n,s=e);var o=new ti(i,new Hn(this._argIndex,_e.BOUNDARY,r,s));this._lineEdgeMap.put(t,o),this.insertEdge(o),this.insertPoint(this._argIndex,i[0],_e.BOUNDARY)},insertPoint:function(t,e,n){var i=this._nodes.addNode(e),r=i.getLabel();null===r?i._label=new Hn(t,n):r.setLocation(t,n)},createEdgeSetIntersector:function(){return new Wn},addSelfIntersectionNodes:function(t){for(var e=this._edges.iterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.eiList.iterator();r.hasNext();){var s=r.next();this.addSelfIntersectionNode(t,s.coord,i)}},add:function(){if(!(1===arguments.length&&arguments[0]instanceof X))return ai.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Yt&&(this._useBoundaryDeterminationRule=!1),t instanceof Vt)this.addPolygon(t);else if(t instanceof kt)this.addLineString(t);else if(t instanceof Bt)this.addPoint(t);else if(t instanceof Ut)this.addCollection(t);else if(t instanceof It)this.addCollection(t);else if(t instanceof Yt)this.addCollection(t);else{if(!(t instanceof Ot))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},locate:function(t){return S(this._parentGeom,qt)&&50<this._parentGeom.getNumGeometries()?(null===this._areaPtLocator&&(this._areaPtLocator=new Ge(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},findEdge:function(){if(1===arguments.length&&arguments[0]instanceof kt){var t=arguments[0];return this._lineEdgeMap.get(t)}return ai.prototype.findEdge.apply(this,arguments)},interfaces_:function(){return[]},getClass:function(){return li}}),li.determineBoundary=function(t,e){return t.isInBoundary(e)?_e.BOUNDARY:_e.INTERIOR};var ui=Object.freeze({GeometryGraph:li});function ci(){}function hi(){if(this._p=null,this._data=null,this._left=null,this._right=null,this._count=null,2===arguments.length){var t=arguments[0],e=arguments[1];this._p=new x(t),this._left=null,this._right=null,this._count=1,this._data=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._p=new x(n,i),this._left=null,this._right=null,this._count=1,this._data=r}}function di(){if(this._root=null,this._numberOfNodes=null,this._tolerance=null,0===arguments.length)di.call(this,0);else if(1===arguments.length){var t=arguments[0];this._tolerance=t}}function pi(){this._tolerance=null,this._matchNode=null,this._matchDist=0,this._p=null;var t=arguments[0],e=arguments[1];this._p=t,this._tolerance=e}e(ci.prototype,{visit:function(t){},interfaces_:function(){return[]},getClass:function(){return ci}}),e(hi.prototype,{isRepeated:function(){return 1<this._count},getRight:function(){return this._right},getCoordinate:function(){return this._p},setLeft:function(t){this._left=t},getX:function(){return this._p.x},getData:function(){return this._data},getCount:function(){return this._count},getLeft:function(){return this._left},getY:function(){return this._p.y},increment:function(){this._count=this._count+1},setRight:function(t){this._right=t},interfaces_:function(){return[]},getClass:function(){return hi}}),e(di.prototype,{insert:function(){if(1===arguments.length){var t=arguments[0];return this.insert(t,null)}if(2===arguments.length){var e=arguments[0],n=arguments[1];if(null===this._root)return this._root=new hi(e,n),this._root;if(0<this._tolerance){var i=this.findBestMatchNode(e);if(null!==i)return i.increment(),i}return this.insertExact(e,n)}},query:function(){if(1===arguments.length){var t=arguments[0],e=new j;return this.query(t,e),e}if(2===arguments.length)if(arguments[0]instanceof F&&S(arguments[1],w)){var n=arguments[0],i=arguments[1];this.queryNode(this._root,n,!0,{interfaces_:function(){return[ci]},visit:function(t){i.add(t)}})}else if(arguments[0]instanceof F&&S(arguments[1],ci)){var r=arguments[0],s=arguments[1];this.queryNode(this._root,r,!0,s)}},queryNode:function(t,e,n,i){if(null===t)return null;var r,s=null,o=null,a=(r=n?(s=e.getMinX(),o=e.getMaxX(),t.getX()):(s=e.getMinY(),o=e.getMaxY(),t.getY()))<=o;s<r&&this.queryNode(t.getLeft(),e,!n,i),e.contains(t.getCoordinate())&&i.visit(t),a&&this.queryNode(t.getRight(),e,!n,i)},findBestMatchNode:function(t){var e=new pi(t,this._tolerance);return this.query(e.queryEnvelope(),e),e.getNode()},isEmpty:function(){return null===this._root},insertExact:function(t,e){for(var n=this._root,i=this._root,r=!0,s=!0;null!==n;){if(null!==n&&t.distance(n.getCoordinate())<=this._tolerance)return n.increment(),n;s=r?t.x<n.getX():t.y<n.getY(),i=n,n=s?n.getLeft():n.getRight(),r=!r}this._numberOfNodes=this._numberOfNodes+1;var o=new hi(t,e);return s?i.setLeft(o):i.setRight(o),o},interfaces_:function(){return[]},getClass:function(){return di}}),di.toCoordinates=function(){if(1===arguments.length){var t=arguments[0];return di.toCoordinates(t,!1)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new M,r=e.iterator();r.hasNext();)for(var s=r.next(),o=n?s.getCount():1,a=0;a<o;a++)i.add(s.getCoordinate(),!0);return i.toCoordinateArray()}},e(pi.prototype,{visit:function(t){var e=this._p.distance(t.getCoordinate());if(!(e<=this._tolerance))return null;var n=!1;(null===this._matchNode||e<this._matchDist||null!==this._matchNode&&e===this._matchDist&&t.getCoordinate().compareTo(this._matchNode.getCoordinate())<1)&&(n=!0),n&&(this._matchNode=t,this._matchDist=e)},queryEnvelope:function(){var t=new F(this._p);return t.expandBy(this._tolerance),t},getNode:function(){return this._matchNode},interfaces_:function(){return[ci]},getClass:function(){return pi}}),di.BestMatchVisitor=pi;var fi=Object.freeze({KdTree:di});function gi(){this._items=new j,this._subnode=new Array(4).fill(null)}function mi(){this._pt=new x,this._level=0,this._env=null;var t=arguments[0];this.computeKey(t)}function _i(){gi.apply(this),this._env=null,this._centrex=null,this._centrey=null,this._level=null;var t=arguments[0],e=arguments[1];this._env=t,this._level=e,this._centrex=(t.getMinX()+t.getMaxX())/2,this._centrey=(t.getMinY()+t.getMaxY())/2}function yi(){gi.apply(this)}function vi(){}function bi(){this._root=null,this._minExtent=1,this._root=new yi}e(gi.prototype,{hasChildren:function(){for(var t=0;t<4;t++)if(null!==this._subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this._items);for(var e=0;e<4;e++)null!==this._subnode[e]&&this._subnode[e].addAllItems(t);return t},getNodeCount:function(){for(var t=0,e=0;e<4;e++)null!==this._subnode[e]&&(t+=this._subnode[e].size());return t+1},size:function(){for(var t=0,e=0;e<4;e++)null!==this._subnode[e]&&(t+=this._subnode[e].size());return t+this._items.size()},addAllItemsFromOverlapping:function(t,e){if(!this.isSearchMatch(t))return null;e.addAll(this._items);for(var n=0;n<4;n++)null!==this._subnode[n]&&this._subnode[n].addAllItemsFromOverlapping(t,e)},visitItems:function(t,e){for(var n=this._items.iterator();n.hasNext();)e.visitItem(n.next())},hasItems:function(){return!this._items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1;for(var n=!1,i=0;i<4;i++)if(null!==this._subnode[i]&&(n=this._subnode[i].remove(t,e))){this._subnode[i].isPrunable()&&(this._subnode[i]=null);break}return n||this._items.remove(e)},visit:function(t,e){if(!this.isSearchMatch(t))return null;this.visitItems(t,e);for(var n=0;n<4;n++)null!==this._subnode[n]&&this._subnode[n].visit(t,e)},getItems:function(){return this._items},depth:function(){for(var t=0,e=0;e<4;e++)if(null!==this._subnode[e]){var n=this._subnode[e].depth();t<n&&(t=n)}return t+1},isEmpty:function(){var t=!0;if(this._items.isEmpty()){for(var e=0;e<4;e++)if(null!==this._subnode[e]&&!this._subnode[e].isEmpty()){t=!1;break}}else t=!1;return t},add:function(t){this._items.add(t)},interfaces_:function(){return[m]},getClass:function(){return gi}}),gi.getSubnodeIndex=function(t,e,n){var i=-1;return t.getMinX()>=e&&(t.getMinY()>=n&&(i=3),t.getMaxY()<=n&&(i=1)),t.getMaxX()<=e&&(t.getMinY()>=n&&(i=2),t.getMaxY()<=n&&(i=0)),i},e(mi.prototype,{getLevel:function(){return this._level},computeKey:function(){if(1===arguments.length){var t=arguments[0];for(this._level=mi.computeQuadLevel(t),this._env=new F,this.computeKey(this._level,t);!this._env.contains(t);)this._level+=1,this.computeKey(this._level,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=dn.powerOf2(e);this._pt.x=Math.floor(n.getMinX()/i)*i,this._pt.y=Math.floor(n.getMinY()/i)*i,this._env.init(this._pt.x,this._pt.x+i,this._pt.y,this._pt.y+i)}},getEnvelope:function(){return this._env},getCentre:function(){return new x((this._env.getMinX()+this._env.getMaxX())/2,(this._env.getMinY()+this._env.getMaxY())/2)},getPoint:function(){return this._pt},interfaces_:function(){return[]},getClass:function(){return mi}}),mi.computeQuadLevel=function(t){var e=t.getWidth(),n=t.getHeight();return dn.exponent(n<e?e:n)+1},y(_i,gi),e(_i.prototype,{find:function(t){var e=gi.getSubnodeIndex(t,this._centrex,this._centrey);return-1===e||null===this._subnode[e]?this:this._subnode[e].find(t)},isSearchMatch:function(t){return null!==t&&this._env.intersects(t)},getSubnode:function(t){return null===this._subnode[t]&&(this._subnode[t]=this.createSubnode(t)),this._subnode[t]},getEnvelope:function(){return this._env},getNode:function(t){var e=gi.getSubnodeIndex(t,this._centrex,this._centrey);return-1===e?this:this.getSubnode(e).getNode(t)},createSubnode:function(t){var e=0,n=0,i=0,r=0;switch(t){case 0:e=this._env.getMinX(),n=this._centrex,i=this._env.getMinY(),r=this._centrey;break;case 1:e=this._centrex,n=this._env.getMaxX(),i=this._env.getMinY(),r=this._centrey;break;case 2:e=this._env.getMinX(),n=this._centrex,i=this._centrey,r=this._env.getMaxY();break;case 3:e=this._centrex,n=this._env.getMaxX(),i=this._centrey,r=this._env.getMaxY()}return new _i(new F(e,n,i,r),this._level-1)},insertNode:function(t){b.isTrue(null===this._env||this._env.contains(t._env));var e=gi.getSubnodeIndex(t._env,this._centrex,this._centrey);if(t._level===this._level-1)this._subnode[e]=t;else{var n=this.createSubnode(e);n.insertNode(t),this._subnode[e]=n}},interfaces_:function(){return[]},getClass:function(){return _i}}),_i.createNode=function(t){var e=new mi(t);return new _i(e.getEnvelope(),e.getLevel())},_i.createExpanded=function(t,e){var n=new F(e);null!==t&&n.expandToInclude(t._env);var i=_i.createNode(n);return null!==t&&i.insertNode(t),i},y(yi,gi),e(yi.prototype,{insert:function(t,e){var n=gi.getSubnodeIndex(t,yi.origin.x,yi.origin.y);if(-1===n)return this.add(e),null;var i=this._subnode[n];if(null===i||!i.getEnvelope().contains(t)){var r=_i.createExpanded(i,t);this._subnode[n]=r}this.insertContained(this._subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){b.isTrue(t.getEnvelope().contains(e));var i=gn.isZeroWidth(e.getMinX(),e.getMaxX()),r=gn.isZeroWidth(e.getMinY(),e.getMaxY());(i||r?t.find(e):t.getNode(e)).add(n)},interfaces_:function(){return[]},getClass:function(){return yi}}),yi.origin=new x(0,0),e(vi.prototype,{insert:function(t,e){},remove:function(t,e){},query:function(){},interfaces_:function(){return[]},getClass:function(){return vi}}),e(bi.prototype,{size:function(){return null!==this._root?this._root.size():0},insert:function(t,e){this.collectStats(t);var n=bi.ensureExtent(t,this._minExtent);this._root.insert(n,e)},query:function(){if(1===arguments.length){var t=arguments[0],e=new Ae;return this.query(t,e),e.getItems()}if(2===arguments.length){var n=arguments[0],i=arguments[1];this._root.visit(n,i)}},queryAll:function(){var t=new j;return this._root.addAllItems(t),t},remove:function(t,e){var n=bi.ensureExtent(t,this._minExtent);return this._root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this._minExtent&&0<e&&(this._minExtent=e);var n=t.getHeight();n<this._minExtent&&0<n&&(this._minExtent=n)},depth:function(){return null!==this._root?this._root.depth():0},isEmpty:function(){return null===this._root||this._root.isEmpty()},interfaces_:function(){return[vi,m]},getClass:function(){return bi}}),bi.ensureExtent=function(t,e){var n=t.getMinX(),i=t.getMaxX(),r=t.getMinY(),s=t.getMaxY();return n!==i&&r!==s?t:(n===i&&(i=(n-=e/2)+e/2),r===s&&(s=(r-=e/2)+e/2),new F(n,i,r,s))},bi.serialVersionUID=-0x678b60c967a25400;var xi=Object.freeze({Quadtree:bi});function Ei(){}function Si(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e}function Ci(){this._size=null,this._items=null,this._size=0,this._items=new j,this._items.add(null)}function Oi(){if(this._childBoundables=new j,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}}function Ii(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()}function wi(){if(this._root=null,this._built=!1,this._itemBoundables=new j,this._nodeCapacity=null,0===arguments.length)wi.call(this,wi.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];b.isTrue(1<t,"Node capacity must be greater than 1"),this._nodeCapacity=t}}function Li(){}function Ti(){if(0===arguments.length)Ti.call(this,Ti.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];wi.call(this,t)}}function ji(){var t=arguments[0];Oi.call(this,t)}e(Ei.prototype,{getBounds:function(){},interfaces_:function(){return[]},getClass:function(){return Ei}}),e(Si.prototype,{getItem:function(){return this._item},getBounds:function(){return this._bounds},interfaces_:function(){return[Ei,m]},getClass:function(){return Si}}),e(Ci.prototype,{poll:function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},size:function(){return this._size},reorder:function(t){for(var e=null,n=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(n)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,n)},clear:function(){this._size=0,this._items.clear()},peek:function(){return this.isEmpty()?null:this._items.get(1)},isEmpty:function(){return 0===this._size},add:function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},interfaces_:function(){return[]},getClass:function(){return Ci}}),e(Oi.prototype,{getLevel:function(){return this._level},size:function(){return this._childBoundables.size()},getChildBoundables:function(){return this._childBoundables},addChildBoundable:function(t){b.isTrue(null===this._bounds),this._childBoundables.add(t)},isEmpty:function(){return this._childBoundables.isEmpty()},getBounds:function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},interfaces_:function(){return[Ei,m]},getClass:function(){return Oi}}),Oi.serialVersionUID=0x5a1e55ec41369800,e(Ii.prototype,{expandToQueue:function(t,e){var n=Ii.isComposite(this._boundable1),r=Ii.isComposite(this._boundable2);if(n&&r)return Ii.area(this._boundable1)>Ii.area(this._boundable2)?this.expand(this._boundable1,this._boundable2,t,e):this.expand(this._boundable2,this._boundable1,t,e),null;if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new i("neither boundable is composite")},isLeaves:function(){return!(Ii.isComposite(this._boundable1)||Ii.isComposite(this._boundable2))},compareTo:function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},expand:function(t,e,n,i){for(var r=t.getChildBoundables().iterator();r.hasNext();){var s=new Ii(r.next(),e,this._itemDistance);s.getDistance()<i&&n.add(s)}},getBoundable:function(t){return 0===t?this._boundable1:this._boundable2},getDistance:function(){return this._distance},distance:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},interfaces_:function(){return[p]},getClass:function(){return Ii}}),Ii.area=function(t){return t.getBounds().getArea()},Ii.isComposite=function(t){return t instanceof Oi},e(wi.prototype,{queryInternal:function(){if(S(arguments[2],Le)&&arguments[0]instanceof Object&&arguments[1]instanceof Oi)for(var t=arguments[0],e=arguments[2],n=arguments[1].getChildBoundables(),i=0;i<n.size();i++){var r=n.get(i);this.getIntersectsOp().intersects(r.getBounds(),t)&&(r instanceof Oi?this.queryInternal(t,r,e):r instanceof Si?e.visitItem(r.getItem()):b.shouldNeverReachHere())}else if(S(arguments[2],w)&&arguments[0]instanceof Object&&arguments[1]instanceof Oi){var s=arguments[0],o=arguments[2];for(n=arguments[1].getChildBoundables(),i=0;i<n.size();i++)r=n.get(i),this.getIntersectsOp().intersects(r.getBounds(),s)&&(r instanceof Oi?this.queryInternal(s,r,o):r instanceof Si?o.add(r.getItem()):b.shouldNeverReachHere())}},getNodeCapacity:function(){return this._nodeCapacity},lastNode:function(t){return t.get(t.size()-1)},size:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();n instanceof Oi?t+=this.size(n):n instanceof Si&&(t+=1)}return t}},removeItem:function(t,e){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Si&&r.getItem()===e&&(n=r)}return null!==n&&(t.getChildBoundables().remove(n),!0)},itemsTree:function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new j:t}if(1===arguments.length){for(var e=arguments[0],n=new j,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Oi){var s=this.itemsTree(r);null!==s&&n.add(s)}else r instanceof Si?n.add(r.getItem()):b.shouldNeverReachHere()}return n.size()<=0?null:n}},insert:function(t,e){b.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Si(t,e))},boundablesAtLevel:function(){if(1===arguments.length){var t=arguments[0],e=new j;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(b.isTrue(-2<n),i.getLevel()===n)return r.add(i),null;for(var s=i.getChildBoundables().iterator();s.hasNext();){var o=s.next();o instanceof Oi?this.boundablesAtLevel(n,o,r):(b.isTrue(o instanceof Si),-1===n&&r.add(o))}return null}},query:function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new j;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e),e}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,i)}},build:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},getRoot:function(){return this.build(),this._root},remove:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=this.removeItem(i,r);if(s)return!0;for(var o=null,a=i.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),n)&&l instanceof Oi&&(s=this.remove(n,l,r))){o=l;break}}return null!==o&&o.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(o),s}},createHigherLevels:function(t,e){b.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},depth:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();if(n instanceof Oi){var i=this.depth(n);t<i&&(t=i)}}return t+1}},createParentBoundables:function(t,e){b.isTrue(!t.isEmpty());var n=new j;n.add(this.createNode(e));var i=new j(t);Fe.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var s=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(s)}return n},isEmpty:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},interfaces_:function(){return[m]},getClass:function(){return wi}}),wi.compareDoubles=function(t,e){return e<t?1:t<e?-1:0},wi.IntersectsOp=function(){},wi.serialVersionUID=-0x35ef64c82d4c5400,wi.DEFAULT_NODE_CAPACITY=10,e(Li.prototype,{distance:function(t,e){},interfaces_:function(){return[]},getClass:function(){return Li}}),y(Ti,wi),e(Ti.prototype,{createParentBoundablesFromVerticalSlices:function(t,e){b.isTrue(0<t.length);for(var n=new j,i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n},createNode:function(t){return new ji(t)},size:function(){return 0===arguments.length?wi.prototype.size.call(this):wi.prototype.size.apply(this,arguments)},insert:function(){if(!(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof F))return wi.prototype.insert.apply(this,arguments);var t=arguments[0],e=arguments[1];if(t.isNull())return null;wi.prototype.insert.call(this,t,e)},getIntersectsOp:function(){return Ti.intersectsOp},verticalSlices:function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),r=t.iterator(),s=0;s<e;s++){i[s]=new j;for(var o=0;r.hasNext()&&o<n;){var a=r.next();i[s].add(a),o++}}return i},query:function(){if(1===arguments.length){var t=arguments[0];return wi.prototype.query.call(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];wi.prototype.query.call(this,e,n)}},getComparator:function(){return Ti.yComparator},createParentBoundablesFromVerticalSlice:function(t,e){return wi.prototype.createParentBoundables.call(this,t,e)},remove:function(){if(2===arguments.length&&arguments[1]instanceof Object&&arguments[0]instanceof F){var t=arguments[0],e=arguments[1];return wi.prototype.remove.call(this,t,e)}return wi.prototype.remove.apply(this,arguments)},depth:function(){return 0===arguments.length?wi.prototype.depth.call(this):wi.prototype.depth.apply(this,arguments)},createParentBoundables:function(t,e){b.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new j(t);Fe.sort(i,Ti.xComparator);var r=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(r,e)},nearestNeighbour:function(){if(1===arguments.length){if(S(arguments[0],Li)){var t=arguments[0],e=new Ii(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof Ii){var n=arguments[0];return this.nearestNeighbour(n,s.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof Ti&&S(arguments[1],Li)){var i=arguments[0],r=arguments[1];return e=new Ii(this.getRoot(),i.getRoot(),r),this.nearestNeighbour(e)}if(arguments[0]instanceof Ii&&"number"==typeof arguments[1]){var o=arguments[0],a=arguments[1],l=null;for((p=new Ci).add(o);!p.isEmpty()&&0<a&&!(a<=(y=(_=p.poll()).getDistance()));)_.isLeaves()?(a=y,l=_):_.expandToQueue(p,a);return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}if(arguments[0]instanceof Ii&&Number.isInteger(arguments[1])){var u=arguments[0],c=arguments[1];return this.nearestNeighbour(u,s.POSITIVE_INFINITY,c)}}else if(3===arguments.length){if(S(arguments[2],Li)&&arguments[0]instanceof F&&arguments[1]instanceof Object){var h=arguments[2],d=new Si(arguments[0],arguments[1]);return e=new Ii(this.getRoot(),d,h),this.nearestNeighbour(e)[0]}if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ii&&"number"==typeof arguments[1]){var p,f=arguments[0],g=arguments[2];a=arguments[1],(p=new Ci).add(f);for(var m=new Ci;!p.isEmpty()&&0<=a;){var _,y;if(a<=(y=(_=p.poll()).getDistance()))break;_.isLeaves()?m.size()<g?m.add(_):(m.peek().getDistance()>y&&(m.poll(),m.add(_)),a=m.peek().getDistance()):_.expandToQueue(p,a)}return Ti.getItems(m)}}else if(4===arguments.length){var v=arguments[2],b=arguments[3];return d=new Si(arguments[0],arguments[1]),e=new Ii(this.getRoot(),d,v),this.nearestNeighbour(e,b)}},interfaces_:function(){return[vi,m]},getClass:function(){return Ti}}),Ti.centreX=function(t){return Ti.avg(t.getMinX(),t.getMaxX())},Ti.avg=function(t,e){return(t+e)/2},Ti.getItems=function(t){for(var e=new Array(t.size()).fill(null),n=0;!t.isEmpty();){var i=t.poll();e[n]=i.getBoundable(0).getItem(),n++}return e},Ti.centreY=function(t){return Ti.avg(t.getMinY(),t.getMaxY())},y(ji,Oi),e(ji.prototype,{computeBounds:function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new F(n.getBounds()):t.expandToInclude(n.getBounds())}return t},interfaces_:function(){return[]},getClass:function(){return ji}}),Ti.STRtreeNode=ji,Ti.serialVersionUID=0x39920f7d5f261e0,Ti.xComparator={interfaces_:function(){return[g]},compare:function(t,e){return wi.compareDoubles(Ti.centreX(t.getBounds()),Ti.centreX(e.getBounds()))}},Ti.yComparator={interfaces_:function(){return[g]},compare:function(t,e){return wi.compareDoubles(Ti.centreY(t.getBounds()),Ti.centreY(e.getBounds()))}},Ti.intersectsOp={interfaces_:function(){return[IntersectsOp]},intersects:function(t,e){return t.intersects(e)}},Ti.DEFAULT_NODE_CAPACITY=10;var Ni=Object.freeze({STRtree:Ti}),Mi=Object.freeze({kdtree:fi,quadtree:xi,strtree:Ni}),Fi=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];function Pi(t){this.geometryFactory=t||new le}e(Pi.prototype,{read:function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!Ri[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==Fi.indexOf(n)?Ri[n].call(this,e.coordinates):"GeometryCollection"===n?Ri[n].call(this,e.geometries):Ri[n].call(this,e)},write:function(t){var e=t.getGeometryType();if(!Di[e])throw new Error("Geometry is not supported");return Di[e].call(this,t)}});var Ri={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var i=t.geometry.type;if(!Ri[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Ri.bbox.call(this,t.bbox)),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.call(this,t.bbox)),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(new x(i[0],i[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new x(t[0],t[1]),new x(t[2],t[1]),new x(t[2],t[3]),new x(t[0],t[3]),new x(t[0],t[1])])},Point:function(t){var e=new x(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Ri.Point.call(this,t[n]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Ri.coordinates.call(this,t);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Ri.LineString.call(this,t[n]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Ri.coordinates.call(this,t[0]),n=this.geometryFactory.createLinearRing(e),i=[],r=1;r<t.length;++r){var s=t[r],o=Ri.coordinates.call(this,s),a=this.geometryFactory.createLinearRing(o);i.push(a)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(Ri.Polygon.call(this,i))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(this.read(i))}return this.geometryFactory.createGeometryCollection(e)}},Di={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Di.coordinate.call(this,t.getCoordinate())}},MultiPoint:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],r=Di.Point.call(this,i);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),i=0;i<n.length;++i){var r=n[i];e.push(Di.coordinate.call(this,r))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],r=Di.LineString.call(this,i);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=Di.LineString.call(this,t._shell);e.push(n.coordinates);for(var i=0;i<t._holes.length;++i){var r=t._holes[i],s=Di.LineString.call(this,r);e.push(s.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],r=Di.Polygon.call(this,i);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t._geometries.length;++n){var i=t._geometries[n],r=i.getGeometryType();e.push(Di[r].call(this,i))}return{type:"GeometryCollection",geometries:e}}};function Ai(t){this.parser=new Pi(t||new le)}function ki(){this.parser=new Pi(this.geometryFactory)}function Gi(t){this.parser=new ce(t||new le)}function Bi(t){return[t.x,t.y]}function zi(t,e){this.geometryFactory=t||new le,this.ol=e||"undefined"!=typeof ol&&ol}e(Ai.prototype,{read:function(t){return this.parser.read(t)}}),e(ki.prototype,{write:function(t){return this.parser.write(t)}}),e(Gi.prototype,{read:function(t){return this.parser.read(t)}}),e(zi.prototype,{inject:function(t,e,n,i,r,s,o,a){this.ol={geom:{Point:t,LineString:e,LinearRing:n,Polygon:i,MultiPoint:r,MultiLineString:s,MultiPolygon:o,GeometryCollection:a}}},read:function(t){var e=this.ol;return t instanceof e.geom.Point?this.convertFromPoint(t):t instanceof e.geom.LineString?this.convertFromLineString(t):t instanceof e.geom.LinearRing?this.convertFromLinearRing(t):t instanceof e.geom.Polygon?this.convertFromPolygon(t):t instanceof e.geom.MultiPoint?this.convertFromMultiPoint(t):t instanceof e.geom.MultiLineString?this.convertFromMultiLineString(t):t instanceof e.geom.MultiPolygon?this.convertFromMultiPolygon(t):t instanceof e.geom.GeometryCollection?this.convertFromCollection(t):void 0},convertFromPoint:function(t){var e=t.getCoordinates();return this.geometryFactory.createPoint(new x(e[0],e[1]))},convertFromLineString:function(t){return this.geometryFactory.createLineString(t.getCoordinates().map((function(t){return new x(t[0],t[1])})))},convertFromLinearRing:function(t){return this.geometryFactory.createLinearRing(t.getCoordinates().map((function(t){return new x(t[0],t[1])})))},convertFromPolygon:function(t){for(var e=t.getLinearRings(),n=null,i=[],r=0;r<e.length;r++){var s=this.convertFromLinearRing(e[r]);0===r?n=s:i.push(s)}return this.geometryFactory.createPolygon(n,i)},convertFromMultiPoint:function(t){var e=t.getPoints().map((function(t){return this.convertFromPoint(t)}),this);return this.geometryFactory.createMultiPoint(e)},convertFromMultiLineString:function(t){var e=t.getLineStrings().map((function(t){return this.convertFromLineString(t)}),this);return this.geometryFactory.createMultiLineString(e)},convertFromMultiPolygon:function(t){var e=t.getPolygons().map((function(t){return this.convertFromPolygon(t)}),this);return this.geometryFactory.createMultiPolygon(e)},convertFromCollection:function(t){var e=t.getGeometries().map((function(t){return this.read(t)}),this);return this.geometryFactory.createGeometryCollection(e)},write:function(t){return"Point"===t.getGeometryType()?this.convertToPoint(t.getCoordinate()):"LineString"===t.getGeometryType()?this.convertToLineString(t):"LinearRing"===t.getGeometryType()?this.convertToLinearRing(t):"Polygon"===t.getGeometryType()?this.convertToPolygon(t):"MultiPoint"===t.getGeometryType()?this.convertToMultiPoint(t):"MultiLineString"===t.getGeometryType()?this.convertToMultiLineString(t):"MultiPolygon"===t.getGeometryType()?this.convertToMultiPolygon(t):"GeometryCollection"===t.getGeometryType()?this.convertToCollection(t):void 0},convertToPoint:function(t){return new this.ol.geom.Point([t.x,t.y])},convertToLineString:function(t){var e=t._points._coordinates.map(Bi);return new this.ol.geom.LineString(e)},convertToLinearRing:function(t){var e=t._points._coordinates.map(Bi);return new this.ol.geom.LinearRing(e)},convertToPolygon:function(t){for(var e=[t._shell._points._coordinates.map(Bi)],n=0;n<t._holes.length;n++)e.push(t._holes[n]._points._coordinates.map(Bi));return new this.ol.geom.Polygon(e)},convertToMultiPoint:function(t){return new this.ol.geom.MultiPoint(t.getCoordinates().map(Bi))},convertToMultiLineString:function(t){for(var e=[],n=0;n<t._geometries.length;n++)e.push(this.convertToLineString(t._geometries[n]).getCoordinates());return new this.ol.geom.MultiLineString(e)},convertToMultiPolygon:function(t){for(var e=[],n=0;n<t._geometries.length;n++)e.push(this.convertToPolygon(t._geometries[n]).getCoordinates());return new this.ol.geom.MultiPolygon(e)},convertToCollection:function(t){for(var e=[],n=0;n<t._geometries.length;n++){var i=t._geometries[n];e.push(this.write(i))}return new this.ol.geom.GeometryCollection(e)}});var qi=Object.freeze({GeoJSONReader:Ai,GeoJSONWriter:ki,OL3Parser:zi,WKTReader:Gi,WKTWriter:pe});function Vi(){}function Ui(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this._segString=t,this.coord=new x(e),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!e.equals2D(t.getCoordinate(n))}function Wi(){this._nodeMap=new gt,this._edge=null;var t=arguments[0];this._edge=t}function Yi(){this._nodeList=null,this._edge=null,this._nodeIt=null,this._currNode=null,this._nextNode=null;var t=arguments[this._currSegIndex=0];this._nodeList=t,this._edge=t.getEdge(),this._nodeIt=t.iterator(),this.readNextNode()}function Hi(){}function Ji(){}function Xi(){}function Zi(){this._nodeList=new Wi(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e}function Qi(){this._overlapSeg1=new me,this._overlapSeg2=new me}function Ki(){}function $i(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}}function tr(){if(this._monoChains=new j,this._index=new Ti,this._idCounter=0,this._nodedSegStrings=null,(this._nOverlaps=0)===arguments.length);else if(1===arguments.length){var t=arguments[0];$i.call(this,t)}}function er(){Qi.apply(this),this._si=null;var t=arguments[0];this._si=t}function nr(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];nr.call(this,t,e,0,0)}else if(4===arguments.length){var n=arguments[0],i=arguments[1];this._noder=n,this._scaleFactor=i,this._isScaled=!this.isIntegerPrecision()}}e(Vi.prototype,{interfaces_:function(){return[]},getClass:function(){return Vi}}),Vi.relativeSign=function(t,e){return t<e?-1:e<t?1:0},Vi.compare=function(t,e,n){if(e.equals2D(n))return 0;var i=Vi.relativeSign(e.x,n.x),r=Vi.relativeSign(e.y,n.y);switch(t){case 0:return Vi.compareValue(i,r);case 1:return Vi.compareValue(r,i);case 2:return Vi.compareValue(r,-i);case 3:return Vi.compareValue(-i,r);case 4:return Vi.compareValue(-i,-r);case 5:return Vi.compareValue(-r,-i);case 6:return Vi.compareValue(-r,i);case 7:return Vi.compareValue(i,-r)}return b.shouldNeverReachHere("invalid octant value"),0},Vi.compareValue=function(t,e){return t<0?-1:0<t?1:e<0?-1:0<e?1:0},e(Ui.prototype,{getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},compareTo:function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Vi.compare(this._segmentOctant,this.coord,e.coord)},isEndPoint:function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},isInterior:function(){return this._isInterior},interfaces_:function(){return[p]},getClass:function(){return Ui}}),e(Wi.prototype,{getSplitCoordinates:function(){var t=new M;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()},addCollapsedNodes:function(){var t=new j;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}},print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},findCollapsesFromExistingVertices:function(t){for(var e=0;e<this._edge.size()-2;e++){var n=this._edge.getCoordinate(e),i=(this._edge.getCoordinate(e+1),this._edge.getCoordinate(e+2));n.equals2D(i)&&t.add(new A(e+1))}},addEdgeCoordinates:function(t,e,n){e.segmentIndex,t.segmentIndex;var i=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);n.add(new x(t.coord),!1);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)n.add(this._edge.getCoordinate(s));r&&n.add(new x(e.coord))},iterator:function(){return this._nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},findCollapseIndex:function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,1===i&&(n[0]=t.segmentIndex+1,!0)},findCollapsesFromInsertedNodes:function(t){for(var e=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,e)&&t.add(new A(e[0])),i=r}},getEdge:function(){return this._edge},addEndpoints:function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);r||n--;var s=new Array(n).fill(null),o=0;s[o++]=new x(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)s[o++]=this._edge.getCoordinate(a);return r&&(s[o]=new x(e.coord)),new Zi(s,this._edge.getData())},add:function(t,e){var n=new Ui(this._edge,t,e,this._edge.getSegmentOctant(e)),i=this._nodeMap.get(n);return null!==i?(b.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)},checkSplitEdgesCorrectness:function(t){var e=this._edge.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new _("bad split edge start point at "+n);var i=t.get(t.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(e[e.length-1]))throw new _("bad split edge end point at "+r)},interfaces_:function(){return[]},getClass:function(){return Wi}}),e(Yi.prototype,{next:function(){return null===this._currNode?(this._currNode=this._nextNode,this._currSegIndex=this._currNode.segmentIndex,this.readNextNode(),this._currNode):null===this._nextNode?null:this._nextNode.segmentIndex===this._currNode.segmentIndex?(this._currNode=this._nextNode,this._currSegIndex=this._currNode.segmentIndex,this.readNextNode(),this._currNode):(this._nextNode.segmentIndex,this._currNode.segmentIndex,null)},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){return null!==this._nextNode},readNextNode:function(){this._nodeIt.hasNext()?this._nextNode=this._nodeIt.next():this._nextNode=null},interfaces_:function(){return[C]},getClass:function(){return Yi}}),e(Hi.prototype,{interfaces_:function(){return[]},getClass:function(){return Hi}}),Hi.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new i("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return 0<=t?0<=e?r<=n?0:1:r<=n?7:6:0<=e?r<=n?3:2:r<=n?4:5}if(arguments[0]instanceof x&&arguments[1]instanceof x){var s=arguments[0],o=arguments[1],a=o.x-s.x,l=o.y-s.y;if(0===a&&0===l)throw new i("Cannot compute the octant for two identical points "+s);return Hi.octant(a,l)}},e(Ji.prototype,{getCoordinates:function(){},size:function(){},getCoordinate:function(t){},isClosed:function(){},setData:function(t){},getData:function(){},interfaces_:function(){return[]},getClass:function(){return Ji}}),e(Xi.prototype,{addIntersection:function(t,e){},interfaces_:function(){return[Ji]},getClass:function(){return Xi}}),e(Zi.prototype,{getCoordinates:function(){return this._pts},size:function(){return this._pts.length},getCoordinate:function(t){return this._pts[t]},isClosed:function(){return this._pts[0].equals(this._pts[this._pts.length-1])},getSegmentOctant:function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this._data=t},safeOctant:function(t,e){return t.equals2D(e)?0:Hi.octant(t,e)},getData:function(){return this._data},addIntersection:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[1],i=arguments[3],r=new x(arguments[0].getIntersection(i));this.addIntersection(r,n)}},toString:function(){return pe.toLineString(new Kt(this._pts))},getNodeList:function(){return this._nodeList},addIntersectionNode:function(t,e){var n=e,i=n+1;if(i<this._pts.length){var r=this._pts[i];t.equals2D(r)&&(n=i)}return this._nodeList.add(t,n)},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[Xi]},getClass:function(){return Zi}}),Zi.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new j;return Zi.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[1],i=arguments[0].iterator();i.hasNext();)i.next().getNodeList().addSplitEdges(n)},e(Qi.prototype,{overlap:function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},interfaces_:function(){return[]},getClass:function(){return Qi}}),e(Ki.prototype,{computeNodes:function(t){},getNodedSubstrings:function(){},interfaces_:function(){return[]},getClass:function(){return Ki}}),e($i.prototype,{setSegmentIntersector:function(t){this._segInt=t},interfaces_:function(){return[Ki]},getClass:function(){return $i}}),y(tr,$i),e(tr.prototype,{getMonotoneChains:function(){return this._monoChains},getNodedSubstrings:function(){return Zi.getNodedSubstrings(this._nodedSegStrings)},getIndex:function(){return this._index},add:function(t){for(var e=bn.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var n=e.next();n.setId(this._idCounter++),this._index.insert(n.getEnvelope(),n),this._monoChains.add(n)}},computeNodes:function(t){for(var e=(this._nodedSegStrings=t).iterator();e.hasNext();)this.add(e.next());this.intersectChains()},intersectChains:function(){for(var t=new er(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var n=e.next(),i=this._index.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,t),this._nOverlaps++),this._segInt.isDone())return null}},interfaces_:function(){return[]},getClass:function(){return tr}}),y(er,Qi),e(er.prototype,{overlap:function(){if(4!==arguments.length)return Qi.prototype.overlap.apply(this,arguments);var t=arguments[1],e=arguments[2],n=arguments[3],i=arguments[0].getContext(),r=e.getContext();this._si.processIntersections(i,t,r,n)},interfaces_:function(){return[]},getClass:function(){return er}}),tr.SegmentOverlapAction=er,e(nr.prototype,{rescale:function(){if(S(arguments[0],O))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){var n=arguments[0];for(2===n.length&&(new x(n[0]),new x(n[1])),t=0;t<n.length;t++)n[t].x=n[t].x/this._scaleFactor+this._offsetX,n[t].y=n[t].y/this._scaleFactor+this._offsetY;2===n.length&&n[0].equals2D(n[1])&&q.out.println(n)}},scale:function(){if(S(arguments[0],O)){for(var t=arguments[0],e=new j(t.size()),n=t.iterator();n.hasNext();){var i=n.next();e.add(new Zi(this.scale(i.getCoordinates()),i.getData()))}return e}if(arguments[0]instanceof Array){var r=arguments[0],s=new Array(r.length).fill(null);for(n=0;n<r.length;n++)s[n]=new x(Math.round((r[n].x-this._offsetX)*this._scaleFactor),Math.round((r[n].y-this._offsetY)*this._scaleFactor),r[n].z);return nt.removeRepeatedPoints(s)}},isIntegerPrecision:function(){return 1===this._scaleFactor},getNodedSubstrings:function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},computeNodes:function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},interfaces_:function(){return[Ki]},getClass:function(){return nr}});var ir=Object.freeze({MCIndexNoder:tr,ScaledNoder:nr,SegmentString:Ji});function rr(){if(this._inputGeom=null,this._isClosedEndpointsInInterior=!0,this._nonSimpleLocation=null,1===arguments.length){var t=arguments[0];this._inputGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._inputGeom=e,this._isClosedEndpointsInInterior=!n.isInBoundary(2)}}function sr(){this.pt=null,this.isClosed=null,this.degree=null;var t=arguments[0];this.pt=t,this.isClosed=!1,this.degree=0}function or(){if(this._quadrantSegments=or.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=or.CAP_ROUND,this._joinStyle=or.JOIN_ROUND,this._mitreLimit=or.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=or.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2],o=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(r),this.setJoinStyle(s),this.setMitreLimit(o)}}function ar(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}function lr(){this.array_=[]}function ur(){this._finder=null,this._dirEdgeList=new j,this._nodes=new j,this._rightMostCoord=null,this._env=null,this._finder=new ar}function cr(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new j,this._pts=new j,this._label=new Hn(_e.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new j,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()}function hr(){var t=arguments[0],e=arguments[1];cr.call(this,t,e)}function dr(){var t=arguments[0],e=arguments[1];cr.call(this,t,e)}function pr(){this._geometryFactory=null,this._shellList=new j;var t=arguments[0];this._geometryFactory=t}function fr(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=z.COUNTERCLOCKWISE;var t=arguments[0];this._inputLine=t}function gr(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new j}function mr(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new me,this._seg1=new me,this._offset0=new me,this._offset1=new me,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new ge,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),8<=e.getQuadrantSegments()&&e.getJoinStyle()===or.JOIN_ROUND&&(this._closingSegLengthFactor=mr.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}function _r(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e}function yr(){this._subgraphs=null,this._seg=new me;var t=arguments[0];this._subgraphs=t}function vr(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new me(t),this._leftDepth=e}function br(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new j;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n}function xr(){this._edgeMap=new gt,this._edgeList=null,this._ptInAreaLocation=[_e.NONE,_e.NONE]}function Er(){xr.apply(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}function Sr(){oi.apply(this)}function Cr(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=Cr.orientation(t)}function Or(){this._edges=new j,this._ocaMap=new gt}function Ir(){}function wr(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0;var t=arguments[this.numTests=0];this._li=t}function Lr(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Or;var t=arguments[0];this._bufParams=t}function Tr(){this._li=new ge,this._segStrings=null;var t=arguments[0];this._segStrings=t}function jr(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new i("Scale factor must be non-zero");1!==e&&(this._pt=new x(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new x,this._p1Scaled=new x),this.initCorners(this._pt)}function Nr(){this._index=null;var t=arguments[0];this._index=t}function Mr(){un.apply(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._hotPixel=t,this._parentEdge=e,this._hotPixelVertexIndex=n}function Fr(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new j}function Pr(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new ge,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}function Rr(){if(this._argGeom=null,this._distance=null,this._bufParams=new or,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}}e(rr.prototype,{isSimpleMultiPoint:function(t){if(t.isEmpty())return!0;for(var e=new yt,n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n).getCoordinate();if(e.contains(i))return this._nonSimpleLocation=i,!1;e.add(i)}return!0},isSimplePolygonal:function(t){for(var e=De.getLines(t).iterator();e.hasNext();){var n=e.next();if(!this.isSimpleLinearGeometry(n))return!1}return!0},hasClosedEndpointIntersection:function(t){for(var e=new gt,n=t.getEdgeIterator();n.hasNext();){var i=n.next(),r=(i.getMaximumSegmentIndex(),i.isClosed()),s=i.getCoordinate(0);this.addEndpoint(e,s,r);var o=i.getCoordinate(i.getNumPoints()-1);this.addEndpoint(e,o,r)}for(n=e.values().iterator();n.hasNext();){var a=n.next();if(a.isClosed&&2!==a.degree)return this._nonSimpleLocation=a.getCoordinate(),!0}return!1},getNonSimpleLocation:function(){return this._nonSimpleLocation},isSimpleLinearGeometry:function(t){if(t.isEmpty())return!0;var e=new li(0,t),n=new ge,i=e.computeSelfNodes(n,!0);return!(i.hasIntersection()&&(i.hasProperIntersection()?(this._nonSimpleLocation=i.getProperIntersectionPoint(),1):this.hasNonEndpointIntersection(e)||this._isClosedEndpointsInInterior&&this.hasClosedEndpointIntersection(e)))},hasNonEndpointIntersection:function(t){for(var e=t.getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getMaximumSegmentIndex(),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next();if(!s.isEndPoint(i))return this._nonSimpleLocation=s.getCoordinate(),!0}return!1},addEndpoint:function(t,e,n){var i=t.get(e);null===i&&(i=new sr(e),t.put(e,i)),i.addEndpoint(n)},computeSimple:function(t){return this._nonSimpleLocation=null,!!t.isEmpty()||(t instanceof kt||t instanceof It?this.isSimpleLinearGeometry(t):t instanceof Ut?this.isSimpleMultiPoint(t):S(t,qt)?this.isSimplePolygonal(t):!(t instanceof Ot)||this.isSimpleGeometryCollection(t))},isSimple:function(){return this._nonSimpleLocation=null,this.computeSimple(this._inputGeom)},isSimpleGeometryCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.computeSimple(n))return!1}return!0},interfaces_:function(){return[]},getClass:function(){return rr}}),rr.isSimple=function(){return 1===arguments.length?new rr(arguments[0]).isSimple():2===arguments.length?new rr(arguments[0],arguments[1]).isSimple():void 0},e(sr.prototype,{addEndpoint:function(t){this.degree++,this.isClosed|=t},getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return sr}}),rr.EndpointInfo=sr,e(or.prototype,{getEndCapStyle:function(){return this._endCapStyle},isSingleSided:function(){return this._isSingleSided},setQuadrantSegments:function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=or.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=or.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==or.JOIN_ROUND&&(this._quadrantSegments=or.DEFAULT_QUADRANT_SEGMENTS)},getJoinStyle:function(){return this._joinStyle},setJoinStyle:function(t){this._joinStyle=t},setSimplifyFactor:function(t){this._simplifyFactor=t<0?0:t},getSimplifyFactor:function(){return this._simplifyFactor},getQuadrantSegments:function(){return this._quadrantSegments},setEndCapStyle:function(t){this._endCapStyle=t},getMitreLimit:function(){return this._mitreLimit},setMitreLimit:function(t){this._mitreLimit=t},setSingleSided:function(t){this._isSingleSided=t},interfaces_:function(){return[]},getClass:function(){return or}}),or.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},or.CAP_ROUND=1,or.CAP_FLAT=2,or.CAP_SQUARE=3,or.JOIN_ROUND=1,or.JOIN_MITRE=2,or.JOIN_BEVEL=3,or.DEFAULT_QUADRANT_SEGMENTS=8,or.DEFAULT_MITRE_LIMIT=5,or.DEFAULT_SIMPLIFY_FACTOR=.01,e(ar.prototype,{getCoordinate:function(){return this._minCoord},getRightmostSide:function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n},findRightmostEdgeAtVertex:function(){var t=this._minDe.getEdge().getCoordinates();b.isTrue(0<this._minIndex&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],i=z.index(this._minCoord,n,e),r=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&i===z.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&i===z.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)},getRightmostSideOfSegment:function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var i=Bn.LEFT;return n[e].y<n[e+1].y&&(i=Bn.RIGHT),i},getEdge:function(){return this._orientedDe},checkForRightmostCoordinate:function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this._minCoord||e[n].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=n,this._minCoord=e[n])},findRightmostEdgeAtNode:function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},findEdge:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}b.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Bn.LEFT&&(this._orientedDe=this._minDe.getSym())},interfaces_:function(){return[]},getClass:function(){return ar}}),lr.prototype.addLast=function(t){this.array_.push(t)},lr.prototype.removeFirst=function(){return this.array_.shift()},lr.prototype.isEmpty=function(){return 0===this.array_.length},e(ur.prototype,{clearVisitedEdges:function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},getRightmostCoordinate:function(){return this._rightMostCoord},computeNodeDepth:function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();)if((i=n.next()).isVisited()||i.getSym().isVisited()){e=i;break}if(null===e)throw new ri("unable to find edge to compute depths at "+t.getCoordinate());for(t.getEdges().computeDepths(e),n=t.getEdges().iterator();n.hasNext();){var i;(i=n.next()).setVisited(!0),this.copySymDepths(i)}},computeDepth:function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(Bn.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},create:function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},findResultEdges:function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();1<=e.getDepth(Bn.RIGHT)&&e.getDepth(Bn.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},computeDepths:function(t){var e=new lt,n=new lr,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();e.add(r),this.computeNodeDepth(r);for(var s=r.getEdges().iterator();s.hasNext();){var o=s.next().getSym();if(!o.isVisited()){var a=o.getNode();e.contains(a)||(n.addLast(a),e.add(a))}}}},compareTo:function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},getEnvelope:function(){if(null===this._env){for(var t=new F,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)t.expandToInclude(n[i]);this._env=t}return this._env},addReachable:function(t){var e=new tn;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},copySymDepths:function(t){var e=t.getSym();e.setDepth(Bn.LEFT,t.getDepth(Bn.RIGHT)),e.setDepth(Bn.RIGHT,t.getDepth(Bn.LEFT))},add:function(t,e){t.setVisited(!0),this._nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();this._dirEdgeList.add(i);var r=i.getSym().getNode();r.isVisited()||e.push(r)}},getNodes:function(){return this._nodes},getDirectedEdges:function(){return this._dirEdgeList},interfaces_:function(){return[p]},getClass:function(){return ur}}),e(cr.prototype,{computeRing:function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=z.isCCW(this._ring.getCoordinates())},isIsolated:function(){return 1===this._label.getGeometryCount()},computePoints:function(t){var e=this._startDe=t,n=!0;do{if(null===e)throw new ri("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new ri("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var i=e.getLabel();b.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},getLinearRing:function(){return this._ring},getCoordinate:function(t){return this._pts.get(t)},computeMaxNodeDegree:function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},addPoints:function(t,e,n){var i=t.getCoordinates();if(e){var r=1;n&&(r=0);for(var s=r;s<i.length;s++)this._pts.add(i[s])}else for(r=i.length-2,n&&(r=i.length-1),s=r;0<=s;s--)this._pts.add(i[s])},isHole:function(){return this._isHole},setInResult:function(){for(var t=this._startDe;t.getEdge().setInResult(!0),(t=t.getNext())!==this._startDe;);},containsPoint:function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!qe.isInRing(t,e.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},addHole:function(t){this._holes.add(t)},isShell:function(){return null===this._shell},getLabel:function(){return this._label},getEdges:function(){return this._edges},getMaxNodeDegree:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},getShell:function(){return this._shell},mergeLabel:function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],n=arguments[0].getLocation(e,Bn.RIGHT);if(n===_e.NONE)return null;if(this._label.getLocation(e)===_e.NONE)return this._label.setLocation(e,n),null}},setShell:function(t){null!==(this._shell=t)&&t.addHole(this)},toPolygon:function(t){for(var e=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)e[n]=this._holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},interfaces_:function(){return[]},getClass:function(){return cr}}),y(hr,cr),e(hr.prototype,{setEdgeRing:function(t,e){t.setMinEdgeRing(e)},getNext:function(t){return t.getNextMin()},interfaces_:function(){return[]},getClass:function(){return hr}}),y(dr,cr),e(dr.prototype,{buildMinimalRings:function(){var t=new j,e=this._startDe;do{if(null===e.getMinEdgeRing()){var n=new hr(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t},setEdgeRing:function(t,e){t.setEdgeRing(e)},linkDirectedEdgesForMinimalEdgeRings:function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},getNext:function(t){return t.getNext()},interfaces_:function(){return[]},getClass:function(){return dr}}),e(pr.prototype,{sortShellsAndHoles:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):e.add(r)}},computePolygons:function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next().toPolygon(this._geometryFactory);e.add(i)}return e},placeFreeHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,t);if(null===r)throw new ri("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},buildMinimalEdgeRings:function(t,e,n){for(var i=new j,r=t.iterator();r.hasNext();){var s=r.next();if(2<s.getMaxNodeDegree()){s.linkDirectedEdgesForMinimalEdgeRings();var o=s.buildMinimalRings(),a=this.findShell(o);null!==a?(this.placePolygonHoles(a,o),e.add(a)):n.addAll(o)}else i.add(s)}return i},containsPoint:function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},buildMaximalEdgeRings:function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new dr(i,this._geometryFactory);e.add(r),r.setInResult()}}return e},placePolygonHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}},getPolygons:function(){return this.computePolygons(this._shellList)},findEdgeRingContaining:function(t,e){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,o=null,a=e.iterator();a.hasNext();){var l=a.next(),u=l.getLinearRing(),c=u.getEnvelopeInternal();null!==s&&(o=s.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(i)&&qe.isInRing(r,u.getCoordinates())&&(h=!0),h&&(null===s||o.contains(c))&&(s=l)}return s},findShell:function(t){for(var e=0,n=null,i=t.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,e++)}return b.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},add:function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];ai.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(e),r=new j,s=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(s,this._shellList,r),this.placeFreeHoles(this._shellList,r)}},interfaces_:function(){return[]},getClass:function(){return pr}}),e(fr.prototype,{isDeletable:function(t,e,n,i){var r=this._inputLine[t],s=this._inputLine[e],o=this._inputLine[n];return!!this.isConcave(r,s,o)&&!!this.isShallow(r,s,o,i)&&this.isShallowSampled(r,s,t,n,i)},deleteShallowConcavities:function(){for(var t=1,e=(this._inputLine.length,this.findNextNonDeletedIndex(t)),n=this.findNextNonDeletedIndex(e),i=!1;n<this._inputLine.length;){var r=!1;this.isDeletable(t,e,n,this._distanceTol)&&(this._isDeleted[e]=fr.DELETE,i=r=!0),t=r?n:e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return i},isShallowConcavity:function(t,e,n,i){return z.index(t,e,n)===this._angleOrientation&&W.pointToSegment(e,t,n)<i},isShallowSampled:function(t,e,n,i,r){var s=Math.trunc((i-n)/fr.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var o=n;o<i;o+=s)if(!this.isShallow(t,e,this._inputLine[o],r))return!1;return!0},isConcave:function(t,e,n){return z.index(t,e,n)===this._angleOrientation},simplify:function(t){for(this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=z.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);this.deleteShallowConcavities(););return this.collapseLine()},findNextNonDeletedIndex:function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===fr.DELETE;)e++;return e},isShallow:function(t,e,n,i){return W.pointToSegment(e,t,n)<i},collapseLine:function(){for(var t=new M,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==fr.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return fr}}),fr.simplify=function(t,e){return new fr(t).simplify(e)},fr.INIT=0,fr.DELETE=1,fr.KEEP=1,fr.NUM_PTS_TO_CHECK=10,e(gr.prototype,{getCoordinates:function(){return this._ptList.toArray(gr.COORDINATE_ARRAY_TYPE)},setPrecisionModel:function(t){this._precisionModel=t},addPt:function(t){var e=new x(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},reverse:function(){},addPts:function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(n=t.length-1;0<=n;n--)this.addPt(t[n])},isRedundant:function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},toString:function(){return(new le).createLineString(this.getCoordinates()).toString()},closeRing:function(){if(this._ptList.size()<1)return null;var t=new x(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(2<=this._ptList.size()&&this._ptList.get(this._ptList.size()-2),t.equals(e))return null;this._ptList.add(t)},setMinimumVertexDistance:function(t){this._minimimVertexDistance=t},interfaces_:function(){return[]},getClass:function(){return gr}}),gr.COORDINATE_ARRAY_TYPE=new Array(0).fill(null),e(mr.prototype,{addNextSegment:function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=z.index(this._s0,this._s1,this._s2),i=n===z.CLOCKWISE&&this._side===Bn.LEFT||n===z.COUNTERCLOCKWISE&&this._side===Bn.RIGHT;0===n?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},addLineEndCap:function(t,e){var n=new me(t,e),i=new me;this.computeOffsetSegment(n,Bn.LEFT,this._distance,i);var r=new me;this.computeOffsetSegment(n,Bn.RIGHT,this._distance,r);var s=e.x-t.x,o=e.y-t.y,a=Math.atan2(o,s);switch(this._bufParams.getEndCapStyle()){case or.CAP_ROUND:this._segList.addPt(i.p1),this.addDirectedFillet(e,a+Math.PI/2,a-Math.PI/2,z.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case or.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case or.CAP_SQUARE:var l=new x;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var u=new x(i.p1.x+l.x,i.p1.y+l.y),c=new x(r.p1.x+l.x,r.p1.y+l.y);this._segList.addPt(u),this._segList.addPt(c)}},getCoordinates:function(){return this._segList.getCoordinates()},addMitreJoin:function(t,e,n,i){var r=!0,s=null;try{s=V.intersection(e.p0,e.p1,n.p0,n.p1),(i<=0?1:s.distance(t)/Math.abs(i))>this._bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof R))throw t;s=new x(0,0),r=!1}r?this._segList.addPt(s):this.addLimitedMitreJoin(e,n,i,this._bufParams.getMitreLimit())},addOutsideTurn:function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*mr.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===or.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===or.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},createSquare:function(t){this._segList.addPt(new x(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new x(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new x(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new x(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},addSegments:function(t,e){this._segList.addPts(t,e)},addFirstSegment:function(){this._segList.addPt(this._offset1.p0)},addCornerFillet:function(t,e,n,i,r){var s=e.x-t.x,o=e.y-t.y,a=Math.atan2(o,s),l=n.x-t.x,u=n.y-t.y,c=Math.atan2(u,l);i===z.CLOCKWISE?a<=c&&(a+=2*Math.PI):c<=a&&(a-=2*Math.PI),this._segList.addPt(e),this.addDirectedFillet(t,a,c,i,r),this._segList.addPt(n)},addLastSegment:function(){this._segList.addPt(this._offset1.p1)},initSideSegments:function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)},addLimitedMitreJoin:function(t,e,n,i){var r=this._seg0.p1,s=ve.angle(r,this._seg0.p0),o=(ve.angle(r,this._seg1.p1),ve.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2),a=ve.normalize(s+o),l=ve.normalize(a+Math.PI),u=i*n,c=n-u*Math.abs(Math.sin(o)),h=new me(r,new x(r.x+u*Math.cos(l),r.y+u*Math.sin(l))),d=h.pointAlongOffset(1,c),p=h.pointAlongOffset(1,-c);this._side===Bn.LEFT?(this._segList.addPt(d),this._segList.addPt(p)):(this._segList.addPt(p),this._segList.addPt(d))},addDirectedFillet:function(t,e,n,i,r){var s,o=i===z.CLOCKWISE?-1:1,a=Math.abs(e-n),l=Math.trunc(a/this._filletAngleQuantum+.5);if(l<1)return null;s=a/l;for(var u=0,c=new x;u<a;){var h=e+o*u;c.x=t.x+r*Math.cos(h),c.y=t.y+r*Math.sin(h),this._segList.addPt(c),u+=s}},computeOffsetSegment:function(t,e,n,i){var r=e===Bn.LEFT?1:-1,s=t.p1.x-t.p0.x,o=t.p1.y-t.p0.y,a=Math.sqrt(s*s+o*o),l=r*n*s/a,u=r*n*o/a;i.p0.x=t.p0.x-u,i.p0.y=t.p0.y+l,i.p1.x=t.p1.x-u,i.p1.y=t.p1.y+l},addInsideTurn:function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*mr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),0<this._closingSegLengthFactor){var n=new x((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new x((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},createCircle:function(t){var e=new x(t.x+this._distance,t.y);this._segList.addPt(e),this.addDirectedFillet(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},addBevelJoin:function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},init:function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new gr,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*mr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},addCollinear:function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),2<=this._li.getIntersectionNum()&&(this._bufParams.getJoinStyle()===or.JOIN_BEVEL||this._bufParams.getJoinStyle()===or.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,z.CLOCKWISE,this._distance))},closeRing:function(){this._segList.closeRing()},hasNarrowConcaveAngle:function(){return this._hasNarrowConcaveAngle},interfaces_:function(){return[]},getClass:function(){return mr}}),mr.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,mr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,mr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,mr.MAX_CLOSING_SEG_LEN_FACTOR=80,e(_r.prototype,{getOffsetCurve:function(t,e){if(0===(this._distance=e))return null;var n=e<0,i=Math.abs(e),r=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,n,r);var s=r.getCoordinates();return n&&nt.reverse(s),s},computeSingleSidedBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var r=fr.simplify(t,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],Bn.LEFT),n.addFirstSegment();for(var o=s-2;0<=o;o--)n.addNextSegment(r[o],!0)}else{n.addSegments(t,!1);var a=fr.simplify(t,i),l=a.length-1;for(n.initSideSegments(a[0],a[1],Bn.LEFT),n.addFirstSegment(),o=2;o<=l;o++)n.addNextSegment(a[o],!0)}n.addLastSegment(),n.closeRing()},computeRingBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this._distance);e===Bn.RIGHT&&(i=-i);var r=fr.simplify(t,i),s=r.length-1;n.initSideSegments(r[s-1],r[0],e);for(var o=1;o<=s;o++){var a=1!==o;n.addNextSegment(r[o],a)}n.closeRing()},computeLineBufferCurve:function(t,e){var n=this.simplifyTolerance(this._distance),i=fr.simplify(t,n),r=i.length-1;e.initSideSegments(i[0],i[1],Bn.LEFT);for(var s=2;s<=r;s++)e.addNextSegment(i[s],!0);e.addLastSegment(),e.addLineEndCap(i[r-1],i[r]);var o=fr.simplify(t,-n),a=o.length-1;for(e.initSideSegments(o[a],o[a-1],Bn.LEFT),s=a-2;0<=s;s--)e.addNextSegment(o[s],!0);e.addLastSegment(),e.addLineEndCap(o[1],o[0]),e.closeRing()},computePointCurve:function(t,e){switch(this._bufParams.getEndCapStyle()){case or.CAP_ROUND:e.createCircle(t);break;case or.CAP_SQUARE:e.createSquare(t)}},getLineCurve:function(t,e){if((this._distance=e)<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this._bufParams.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,i)}else this.computeLineBufferCurve(t,i);return i.getCoordinates()},getBufferParameters:function(){return this._bufParams},simplifyTolerance:function(t){return t*this._bufParams.getSimplifyFactor()},getRingCurve:function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return _r.copyCoordinates(t);var i=this.getSegGen(n);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()},computeOffsetCurve:function(t,e,n){var i=this.simplifyTolerance(this._distance);if(e){var r=fr.simplify(t,-i),s=r.length-1;n.initSideSegments(r[s],r[s-1],Bn.LEFT),n.addFirstSegment();for(var o=s-2;0<=o;o--)n.addNextSegment(r[o],!0)}else{var a=fr.simplify(t,i),l=a.length-1;for(n.initSideSegments(a[0],a[1],Bn.LEFT),n.addFirstSegment(),o=2;o<=l;o++)n.addNextSegment(a[o],!0)}n.addLastSegment()},getSegGen:function(t){return new mr(this._precisionModel,this._bufParams,t)},interfaces_:function(){return[]},getClass:function(){return _r}}),_r.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new x(t[n]);return e},e(yr.prototype,{findStabbedSegments:function(){if(1===arguments.length){for(var t=arguments[0],e=new j,n=this._subgraphs.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,i.getDirectedEdges(),e)}return e}if(3===arguments.length)if(S(arguments[2],w)&&arguments[0]instanceof x&&arguments[1]instanceof si){var s=arguments[0],o=arguments[1],a=arguments[2],l=o.getEdge().getCoordinates();for(n=0;n<l.length-1;n++)if(this._seg.p0=l[n],this._seg.p1=l[n+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<s.x||this._seg.isHorizontal()||s.y<this._seg.p0.y||s.y>this._seg.p1.y||z.index(this._seg.p0,this._seg.p1,s)===z.RIGHT)){var u=o.getDepth(Bn.LEFT);this._seg.p0.equals(l[n])||(u=o.getDepth(Bn.RIGHT));var c=new vr(this._seg,u);a.add(c)}}else if(S(arguments[2],w)&&arguments[0]instanceof x&&S(arguments[1],w)){var h=arguments[0],d=arguments[2];for(n=arguments[1].iterator();n.hasNext();){var p=n.next();p.isForward()&&this.findStabbedSegments(h,p,d)}}},getDepth:function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Fe.min(e)._leftDepth},interfaces_:function(){return[]},getClass:function(){return yr}}),e(vr.prototype,{compareTo:function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==n||0!=(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?n:this._upwardSeg.compareTo(e._upwardSeg)},compareX:function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},toString:function(){return this._upwardSeg.toString()},interfaces_:function(){return[p]},getClass:function(){return vr}}),yr.DepthSegment=vr,e(br.prototype,{addPoint:function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,_e.EXTERIOR,_e.INTERIOR)},addPolygon:function(t){var e=this._distance,n=Bn.LEFT;this._distance<0&&(e=-this._distance,n=Bn.RIGHT);var i=t.getExteriorRing(),r=nt.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance))return null;if(this._distance<=0&&r.length<3)return null;this.addPolygonRing(r,e,n,_e.EXTERIOR,_e.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var o=t.getInteriorRingN(s),a=nt.removeRepeatedPoints(o.getCoordinates());0<this._distance&&this.isErodedCompletely(o,-this._distance)||this.addPolygonRing(a,e,Bn.opposite(n),_e.INTERIOR,_e.EXTERIOR)}},isTriangleErodedCompletely:function(t,e){var n=new be(t[0],t[1],t[2]),i=n.inCentre();return W.pointToSegment(i,n.p0,n.p1)<Math.abs(e)},addLineString:function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=nt.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,_e.EXTERIOR,_e.INTERIOR)},addCurve:function(t,e,n){if(null===t||t.length<2)return null;var i=new Zi(t,new Hn(0,_e.BOUNDARY,e,n));this._curveList.add(i)},getCurves:function(){return this.add(this._inputGeom),this._curveList},addPolygonRing:function(t,e,n,i,r){if(0===e&&t.length<Wt.MINIMUM_VALID_SIZE)return null;var s=i,o=r;t.length>=Wt.MINIMUM_VALID_SIZE&&z.isCCW(t)&&(s=r,o=i,n=Bn.opposite(n));var a=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(a,s,o)},add:function(t){if(t.isEmpty())return null;if(t instanceof Vt)this.addPolygon(t);else if(t instanceof kt)this.addLineString(t);else if(t instanceof Bt)this.addPoint(t);else if(t instanceof Ut)this.addCollection(t);else if(t instanceof It)this.addCollection(t);else if(t instanceof Yt)this.addCollection(t);else{if(!(t instanceof Ot))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},isErodedCompletely:function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var i=t.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>r},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},interfaces_:function(){return[]},getClass:function(){return br}}),e(xr.prototype,{getNextCW:function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return 0===e&&(n=this._edgeList.size()-1),this._edgeList.get(n)},propagateSideLabels:function(t){for(var e=_e.NONE,n=this.iterator();n.hasNext();)(s=(r=n.next()).getLabel()).isArea(t)&&s.getLocation(t,Bn.LEFT)!==_e.NONE&&(e=s.getLocation(t,Bn.LEFT));if(e===_e.NONE)return null;var i=e;for(n=this.iterator();n.hasNext();){var r,s;if((s=(r=n.next()).getLabel()).getLocation(t,Bn.ON)===_e.NONE&&s.setLocation(t,Bn.ON,i),s.isArea(t)){var o=s.getLocation(t,Bn.LEFT),a=s.getLocation(t,Bn.RIGHT);if(a!==_e.NONE){if(a!==i)throw new ri("side location conflict",r.getCoordinate());o===_e.NONE&&b.shouldNeverReachHere("found single null side (at "+r.getCoordinate()+")"),i=o}else b.isTrue(s.getLocation(t,Bn.LEFT)===_e.NONE,"found single null side"),s.setLocation(t,Bn.RIGHT,i),s.setLocation(t,Bn.LEFT,i)}}},getCoordinate:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},print:function(t){q.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},isAreaLabelsConsistent:function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},checkAreaLabelsConsistent:function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,i=e.get(n).getLabel().getLocation(t,Bn.LEFT);b.isTrue(i!==_e.NONE,"Found unlabelled area edge");for(var r=i,s=this.iterator();s.hasNext();){var o=s.next().getLabel();b.isTrue(o.isArea(t),"Found non-area edge");var a=o.getLocation(t,Bn.LEFT),l=o.getLocation(t,Bn.RIGHT);if(a===l)return!1;if(l!==r)return!1;r=a}return!0},findIndex:function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},iterator:function(){return this.getEdges().iterator()},getEdges:function(){return null===this._edgeList&&(this._edgeList=new j(this._edgeMap.values())),this._edgeList},getLocation:function(t,e,n){return this._ptInAreaLocation[t]===_e.NONE&&(this._ptInAreaLocation[t]=Ue.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]},toString:function(){var t=new D;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},computeEdgeEndLabels:function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},computeLabelling:function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var i=(s=n.next()).getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===_e.BOUNDARY&&(e[r]=!0);for(n=this.iterator();n.hasNext();){var s;for(i=(s=n.next()).getLabel(),r=0;r<2;r++)if(i.isAnyNull(r)){var o=_e.NONE;if(e[r])o=_e.EXTERIOR;else{var a=s.getCoordinate();o=this.getLocation(r,a,t)}i.setAllLocationsIfNull(r,o)}}},getDegree:function(){return this._edgeMap.size()},insertEdgeEnd:function(t,e){this._edgeMap.put(t,e),this._edgeList=null},interfaces_:function(){return[]},getClass:function(){return xr}}),y(Er,xr),e(Er.prototype,{linkResultDirectedEdges:function(){this.getResultAreaEdges();for(var t=null,e=null,n=this._SCANNING_FOR_INCOMING,i=0;i<this._resultAreaEdgeList.size();i++){var r=this._resultAreaEdgeList.get(i),s=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),n){case this._SCANNING_FOR_INCOMING:if(!s.isInResult())continue;e=s,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!r.isInResult())continue;e.setNext(r),n=this._SCANNING_FOR_INCOMING}}if(n===this._LINKING_TO_OUTGOING){if(null===t)throw new ri("no outgoing dirEdge found",this.getCoordinate());b.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},insert:function(t){var e=t;this.insertEdgeEnd(e,e)},getRightmostEdge:function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var i=t.get(e-1),r=n.getQuadrant(),s=i.getQuadrant();return vn.isNorthern(r)&&vn.isNorthern(s)?n:vn.isNorthern(r)||vn.isNorthern(s)?0!==n.getDy()?n:0!==i.getDy()?i:(b.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},print:function(t){q.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},getResultAreaEdges:function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new j;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},updateLabelling:function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},linkAllDirectedEdges:function(){this.getEdges();for(var t=null,e=null,n=this._edgeList.size()-1;0<=n;n--){var i=this._edgeList.get(n),r=i.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=i}e.setNext(t)},computeDepths:function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=(t.getLabel(),t.getDepth(Bn.LEFT)),i=t.getDepth(Bn.RIGHT),r=this.computeDepths(e+1,this._edgeList.size(),n);if(this.computeDepths(0,e,r)!==i)throw new ri("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var s=arguments[1],o=arguments[2],a=arguments[0];a<s;a++){var l=this._edgeList.get(a);l.getLabel(),l.setEdgeDepths(Bn.RIGHT,o),o=l.getDepth(Bn.LEFT)}return o}},mergeSymLabels:function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},linkMinimalDirectedEdges:function(t){for(var e=null,n=null,i=this._SCANNING_FOR_INCOMING,r=this._resultAreaEdgeList.size()-1;0<=r;r--){var s=this._resultAreaEdgeList.get(r),o=s.getSym();switch(null===e&&s.getEdgeRing()===t&&(e=s),i){case this._SCANNING_FOR_INCOMING:if(o.getEdgeRing()!==t)continue;n=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(s.getEdgeRing()!==t)continue;n.setNextMin(s),i=this._SCANNING_FOR_INCOMING}}i===this._LINKING_TO_OUTGOING&&(b.isTrue(null!==e,"found null for first outgoing dirEdge"),b.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))},getOutgoingDegree:function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){var n=arguments[0];for(t=0,e=this.iterator();e.hasNext();)e.next().getEdgeRing()===n&&t++;return t}},getLabel:function(){return this._label},findCoveredLineEdges:function(){for(var t=_e.NONE,e=this.iterator();e.hasNext();){var n=(r=e.next()).getSym();if(!r.isLineEdge()){if(r.isInResult()){t=_e.INTERIOR;break}if(n.isInResult()){t=_e.EXTERIOR;break}}}if(t===_e.NONE)return null;var i=t;for(e=this.iterator();e.hasNext();){var r;n=(r=e.next()).getSym(),r.isLineEdge()?r.getEdge().setCovered(i===_e.INTERIOR):(r.isInResult()&&(i=_e.EXTERIOR),n.isInResult()&&(i=_e.INTERIOR))}},computeLabelling:function(t){xr.prototype.computeLabelling.call(this,t),this._label=new Hn(_e.NONE);for(var e=this.iterator();e.hasNext();)for(var n=e.next().getEdge().getLabel(),i=0;i<2;i++){var r=n.getLocation(i);r!==_e.INTERIOR&&r!==_e.BOUNDARY||this._label.setLocation(i,_e.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Er}}),y(Sr,oi),e(Sr.prototype,{createNode:function(t){return new ei(t,new Er)},interfaces_:function(){return[]},getClass:function(){return Sr}}),e(Cr.prototype,{compareTo:function(t){var e=t;return Cr.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},interfaces_:function(){return[p]},getClass:function(){return Cr}}),Cr.orientation=function(t){return 1===nt.increasingDirection(t)},Cr.compareOriented=function(t,e,n,i){for(var r=e?1:-1,s=i?1:-1,o=e?t.length:-1,a=i?n.length:-1,l=e?0:t.length-1,u=i?0:n.length-1;;){var c=t[l].compareTo(n[u]);if(0!==c)return c;var h=(l+=r)===o,d=(u+=s)===a;if(h&&!d)return-1;if(!h&&d)return 1;if(h&&d)return 0}},e(Or.prototype,{print:function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var n=this._edges.get(e);0<e&&t.print(","),t.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)0<r&&t.print(","),t.print(i[r].x+" "+i[r].y);t.println(")")}t.print(")  ")},addAll:function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},findEdgeIndex:function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},iterator:function(){return this._edges.iterator()},getEdges:function(){return this._edges},get:function(t){return this._edges.get(t)},findEqualEdge:function(t){var e=new Cr(t.getCoordinates());return this._ocaMap.get(e)},add:function(t){this._edges.add(t);var e=new Cr(t.getCoordinates());this._ocaMap.put(e,t)},interfaces_:function(){return[]},getClass:function(){return Or}}),e(Ir.prototype,{processIntersections:function(t,e,n,i){},isDone:function(){},interfaces_:function(){return[]},getClass:function(){return Ir}}),e(wr.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this._li.getIntersectionNum()){if(wr.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this._properIntersectionPoint},hasProperInteriorIntersection:function(){return this._hasProperInterior},getLineIntersector:function(){return this._li},hasProperIntersection:function(){return this._hasProper},processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},hasIntersection:function(){return this._hasIntersection},isDone:function(){return!1},hasInteriorIntersection:function(){return this._hasInterior},interfaces_:function(){return[Ir]},getClass:function(){return wr}}),wr.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},e(Lr.prototype,{setWorkingPrecisionModel:function(t){this._workingPrecisionModel=t},insertUniqueEdge:function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new Hn(t.getLabel())).flip(),n.merge(i);var r=Lr.depthDelta(i),s=e.getDepthDelta()+r;e.setDepthDelta(s)}else this._edgeList.add(t),t.setDepthDelta(Lr.depthDelta(t.getLabel()))},buildSubgraphs:function(t,e){for(var n=new j,i=t.iterator();i.hasNext();){var r=i.next(),s=r.getRightmostCoordinate(),o=new yr(n).getDepth(s);r.computeDepth(o),r.findResultEdges(),n.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},createSubgraphs:function(t){for(var e=new j,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new ur;r.create(i),e.add(r)}}return Fe.sort(e,Fe.reverseOrder()),e},createEmptyResultGeometry:function(){return this._geomFact.createPolygon()},getNoder:function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new tr,n=new ge;return n.setPrecisionModel(t),e.setSegmentIntersector(new wr(n)),e},buffer:function(t,e){var n=this._workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var i=new br(t,e,new _r(n,this._bufParams)).getCurves();if(i.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(i,n),this._graph=new ai(new Sr),this._graph.addEdges(this._edgeList.getEdges());var r=this.createSubgraphs(this._graph),s=new pr(this._geomFact);this.buildSubgraphs(r,s);var o=s.getPolygons();return o.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(o)},computeNodedEdges:function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),s=r.getCoordinates();if(2!==s.length||!s[0].equals2D(s[1])){var o=r.getData(),a=new ti(r.getCoordinates(),new Hn(o));this.insertUniqueEdge(a)}}},setNoder:function(t){this._workingNoder=t},interfaces_:function(){return[]},getClass:function(){return Lr}}),Lr.depthDelta=function(t){var e=t.getLocation(0,Bn.LEFT),n=t.getLocation(0,Bn.RIGHT);return e===_e.INTERIOR&&n===_e.EXTERIOR?1:e===_e.EXTERIOR&&n===_e.INTERIOR?-1:0},Lr.convertSegStrings=function(t){for(var e=new le,n=new j;t.hasNext();){var i=t.next(),r=e.createLineString(i.getCoordinates());n.add(r)}return e.buildGeometry(n)},e(Tr.prototype,{checkEndPtVertexIntersections:function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length){var n=arguments[0];for(t=arguments[1].iterator();t.hasNext();){e=t.next().getCoordinates();for(var i=1;i<e.length-1;i++)if(e[i].equals(n))throw new _("found endpt/interior pt intersection at index "+i+" :pt "+n)}}},checkInteriorIntersections:function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),n=this._segStrings.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(e,i)}else if(2===arguments.length)for(var r=arguments[0],s=arguments[1],o=r.getCoordinates(),a=s.getCoordinates(),l=0;l<o.length-1;l++)for(var u=0;u<a.length-1;u++)this.checkInteriorIntersections(r,l,s,u);else if(4===arguments.length){var c=arguments[0],h=arguments[1],d=arguments[2],p=arguments[3];if(c===d&&h===p)return null;var f=c.getCoordinates()[h],g=c.getCoordinates()[h+1],m=d.getCoordinates()[p],y=d.getCoordinates()[p+1];if(this._li.computeIntersection(f,g,m,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,g)||this.hasInteriorIntersection(this._li,m,y)))throw new _("found non-noded intersection at "+f+"-"+g+" and "+m+"-"+y)}},checkValid:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},checkCollapses:function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length){var n=arguments[0].getCoordinates();for(t=0;t<n.length-2;t++)this.checkCollapse(n[t],n[t+1],n[t+2])}},hasInteriorIntersection:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++){var r=t.getIntersection(i);if(!r.equals(e)&&!r.equals(n))return!0}return!1},checkCollapse:function(t,e,n){if(t.equals(n))throw new _("found non-noded collapse at "+Tr.fact.createLineString([t,e,n]))},interfaces_:function(){return[]},getClass:function(){return Tr}}),Tr.fact=new le,e(jr.prototype,{intersectsScaled:function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),r=Math.min(t.y,e.y),s=Math.max(t.y,e.y),o=this._maxx<n||this._minx>i||this._maxy<r||this._miny>s;if(o)return!1;var a=this.intersectsToleranceSquare(t,e);return b.isTrue(!(o&&a),"Found bad envelope test"),a},initCorners:function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new x(this._maxx,this._maxy),this._corner[1]=new x(this._minx,this._maxy),this._corner[2]=new x(this._minx,this._miny),this._corner[3]=new x(this._maxx,this._miny)},intersects:function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},scale:function(t){return Math.round(t*this._scaleFactor)},getCoordinate:function(){return this._originalPt},copyScaled:function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},getSafeEnvelope:function(){if(null===this._safeEnv){var t=jr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new F(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},intersectsPixelClosure:function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},intersectsToleranceSquare:function(t,e){var n=!1,i=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||n&&i||t.equals(this._pt)||e.equals(this._pt)))))},addSnappedNode:function(t,e){var n=t.getCoordinate(e),i=t.getCoordinate(e+1);return!!this.intersects(n,i)&&(t.addIntersection(this.getCoordinate(),e),!0)},interfaces_:function(){return[]},getClass:function(){return jr}}),jr.SAFE_ENV_EXPANSION_FACTOR=.75,e(Nr.prototype,{snap:function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2],r=e.getSafeEnvelope(),s=new Mr(e,n,i);return this._index.query(r,{interfaces_:function(){return[Le]},visitItem:function(t){t.select(r,s)}}),s.isNodeAdded()}},interfaces_:function(){return[]},getClass:function(){return Nr}}),y(Mr,un),e(Mr.prototype,{isNodeAdded:function(){return this._isNodeAdded},select:function(){if(!(2===arguments.length&&Number.isInteger(arguments[1])&&arguments[0]instanceof yn))return un.prototype.select.apply(this,arguments);var t=arguments[1],e=arguments[0].getContext();if(null!==this._parentEdge&&e===this._parentEdge&&t===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(e,t)},interfaces_:function(){return[]},getClass:function(){return Mr}}),Nr.HotPixelSnapAction=Mr,e(Fr.prototype,{processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];if(this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1)}},isDone:function(){return!1},getInteriorIntersections:function(){return this._interiorIntersections},interfaces_:function(){return[Ir]},getClass:function(){return Fr}}),e(Pr.prototype,{checkCorrectness:function(t){var e=new Tr(Zi.getNodedSubstrings(t));try{e.checkValid()}catch(t){if(!(t instanceof P))throw t;t.printStackTrace()}},getNodedSubstrings:function(){return Zi.getNodedSubstrings(this._nodedSegStrings)},snapRound:function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},findInteriorIntersections:function(t,e){var n=new Fr(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()},computeVertexSnaps:function(){if(S(arguments[0],O))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof Zi)for(var n=arguments[0],i=n.getCoordinates(),r=0;r<i.length;r++){var s=new jr(i[r],this._scaleFactor,this._li);this._pointSnapper.snap(s,n,r)&&n.addIntersection(i[r],r)}},computeNodes:function(t){this._nodedSegStrings=t,this._noder=new tr,this._pointSnapper=new Nr(this._noder.getIndex()),this.snapRound(t,this._li)},computeIntersectionSnaps:function(t){for(var e=t.iterator();e.hasNext();){var n=new jr(e.next(),this._scaleFactor,this._li);this._pointSnapper.snap(n)}},interfaces_:function(){return[Ki]},getClass:function(){return Pr}}),e(Rr.prototype,{bufferFixedPrecision:function(t){var e=new nr(new Pr(new oe(1)),t.getScale()),n=new Lr(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)},bufferReducedPrecision:function(){if(0===arguments.length){for(var t=Rr.MAX_PRECISION_DIGITS;0<=t;t--){try{this.bufferReducedPrecision(t)}catch(t){if(!(t instanceof ri))throw t;this._saveException=t}if(null!==this._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var e=arguments[0],n=new oe(Rr.precisionScaleFactor(this._argGeom,this._distance,e));this.bufferFixedPrecision(n)}},computeGeometry:function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===oe.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},setQuadrantSegments:function(t){this._bufParams.setQuadrantSegments(t)},bufferOriginalPrecision:function(){try{var t=new Lr(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof _))throw t;this._saveException=t}},getResultGeometry:function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},setEndCapStyle:function(t){this._bufParams.setEndCapStyle(t)},interfaces_:function(){return[]},getClass:function(){return Rr}}),Rr.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new Rr(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof X&&"number"==typeof arguments[1]){var e=arguments[1],n=arguments[2];return(r=new Rr(arguments[0])).setQuadrantSegments(n),r.getResultGeometry(e)}if(arguments[2]instanceof or&&arguments[0]instanceof X&&"number"==typeof arguments[1]){var i=arguments[1];return(r=new Rr(arguments[0],arguments[2])).getResultGeometry(i)}}else if(4===arguments.length){var r,s=arguments[1],o=arguments[2],a=arguments[3];return(r=new Rr(arguments[0])).setQuadrantSegments(o),r.setEndCapStyle(a),r.getResultGeometry(s)}},Rr.precisionScaleFactor=function(t,e,n){var i=t.getEnvelopeInternal(),r=U.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(0<e?e:0),s=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,s)},Rr.CAP_ROUND=or.CAP_ROUND,Rr.CAP_BUTT=or.CAP_FLAT,Rr.CAP_FLAT=or.CAP_FLAT,Rr.CAP_SQUARE=or.CAP_SQUARE,Rr.MAX_PRECISION_DIGITS=12;var Dr=Object.freeze({BufferOp:Rr,BufferParameters:or});function Ar(){this._comps=null;var t=arguments[0];this._comps=t}function kr(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var t=arguments[0],e=arguments[1];kr.call(this,t,kr.INSIDE_AREA,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._component=n,this._segIndex=i,this._pt=r}}function Gr(){this._pts=null;var t=arguments[0];this._pts=t}function Br(){this._locations=null;var t=arguments[0];this._locations=t}function zr(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Gn,this._minDistanceLocation=null,this._minDistance=s.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];zr.call(this,t,e,0)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=r}}e(Ar.prototype,{filter:function(t){t instanceof Vt&&this._comps.add(t)},interfaces_:function(){return[St]},getClass:function(){return Ar}}),Ar.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Ar.getPolygons(t,new j)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Vt?n.add(e):e instanceof Ot&&e.apply(new Ar(n)),n}},e(kr.prototype,{isInsideArea:function(){return this._segIndex===kr.INSIDE_AREA},getCoordinate:function(){return this._pt},getGeometryComponent:function(){return this._component},getSegmentIndex:function(){return this._segIndex},interfaces_:function(){return[]},getClass:function(){return kr}}),kr.INSIDE_AREA=-1,e(Gr.prototype,{filter:function(t){t instanceof Bt&&this._pts.add(t)},interfaces_:function(){return[St]},getClass:function(){return Gr}}),Gr.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Bt?Fe.singletonList(t):Gr.getPoints(t,new j)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Bt?n.add(e):e instanceof Ot&&e.apply(new Gr(n)),n}},e(Br.prototype,{filter:function(t){(t instanceof Bt||t instanceof kt||t instanceof Vt)&&this._locations.add(new kr(t,0,t.getCoordinate()))},interfaces_:function(){return[St]},getClass:function(){return Br}}),Br.getLocations=function(t){var e=new j;return t.apply(new Br(e)),e},e(zr.prototype,{computeContainmentDistance:function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=this._geom[e];if(i.getDimension()<2)return null;var r=1-e,s=Ar.getPolygons(i);if(0<s.size()){var o=Br.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,s,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=n[0],this._minDistanceLocation[e]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&S(arguments[0],w)&&S(arguments[1],w)){for(var a=arguments[0],l=arguments[1],u=arguments[2],c=0;c<a.size();c++)for(var h=a.get(c),d=0;d<l.size();d++)if(this.computeContainmentDistance(h,l.get(d),u),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof kr&&arguments[1]instanceof Vt){var p=arguments[0],f=arguments[1],g=arguments[2],m=p.getCoordinate();if(_e.EXTERIOR!==this._ptLocator.locate(m,f))return g[this._minDistance=0]=p,g[1]=new kr(f,m),null}},computeMinDistanceLinesPoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s);if(this.computeMinDistance(r,o,n),this._minDistance<=this._terminateDistance)return null}},computeFacetDistance:function(){var t=new Array(2).fill(null),e=De.getLines(this._geom[0]),n=De.getLines(this._geom[1]),i=Gr.getPoints(this._geom[0]),r=Gr.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(i,r,t),void this.updateMinDistance(t,!1))))},nearestLocations:function(){return this.computeMinDistance(),this._minDistanceLocation},updateMinDistance:function(t,e){if(null===t[0])return null;this._minDistanceLocation[1]=e?(this._minDistanceLocation[0]=t[1],t[0]):(this._minDistanceLocation[0]=t[0],t[1])},nearestPoints:function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},computeMinDistance:function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof kt&&arguments[1]instanceof Bt){var t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var i=t.getCoordinates(),r=e.getCoordinate(),s=0;s<i.length-1;s++){if((d=W.pointToSegment(r,i[s],i[s+1]))<this._minDistance){this._minDistance=d;var o=new me(i[s],i[s+1]).closestPoint(r);n[0]=new kr(t,s,o),n[1]=new kr(e,0,r)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof kt&&arguments[1]instanceof kt){var a=arguments[0],l=arguments[1],u=arguments[2];if(a.getEnvelopeInternal().distance(l.getEnvelopeInternal())>this._minDistance)return null;i=a.getCoordinates();var c=l.getCoordinates();for(s=0;s<i.length-1;s++)for(var h=0;h<c.length-1;h++){var d;if((d=W.segmentToSegment(i[s],i[s+1],c[h],c[h+1]))<this._minDistance){this._minDistance=d;var p=new me(i[s],i[s+1]),f=new me(c[h],c[h+1]),g=p.closestPoints(f);u[0]=new kr(a,s,g[0]),u[1]=new kr(l,h,g[1])}if(this._minDistance<=this._terminateDistance)return null}}},computeMinDistancePoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s),a=r.getCoordinate().distance(o.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,n[0]=new kr(r,0,r.getCoordinate()),n[1]=new kr(o,0,o.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},distance:function(){if(null===this._geom[0]||null===this._geom[1])throw new i("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},computeMinDistanceLines:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),s=0;s<e.size();s++){var o=e.get(s);if(this.computeMinDistance(r,o,n),this._minDistance<=this._terminateDistance)return null}},interfaces_:function(){return[]},getClass:function(){return zr}}),zr.distance=function(t,e){return new zr(t,e).distance()},zr.isWithinDistance=function(t,e,n){return!(n<t.getEnvelopeInternal().distance(e.getEnvelopeInternal()))&&new zr(t,e,n).distance()<=n},zr.nearestPoints=function(t,e){return new zr(t,e).nearestPoints()};var qr=Object.freeze({DistanceOp:zr});function Vr(){this._factory=null,this._directedEdges=new j,this._coordinates=null;var t=arguments[0];this._factory=t}function Ur(){this._isMarked=!1,this._isVisited=!1,this._data=null}function Wr(){Ur.apply(this),this._parentEdge=null,this._from=null,this._to=null,this._p0=null,this._p1=null,this._sym=null,this._edgeDirection=null,this._quadrant=null,this._angle=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this._from=t,this._to=e,this._edgeDirection=i,this._p0=t.getCoordinate(),this._p1=n;var r=this._p1.x-this._p0.x,s=this._p1.y-this._p0.y;this._quadrant=vn.quadrant(r,s),this._angle=Math.atan2(s,r)}function Yr(){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];Wr.call(this,t,e,n,i)}function Hr(){if(Ur.apply(this),this._dirEdge=null,0===arguments.length);else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.setDirectedEdges(t,e)}}function Jr(){this._outEdges=new j,this._sorted=!1}function Xr(){if(Ur.apply(this),this._pt=null,this._deStar=null,1===arguments.length){var t=arguments[0];Xr.call(this,t,new Jr)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._pt=e,this._deStar=n}}function Zr(){Hr.apply(this),this._line=null;var t=arguments[0];this._line=t}function Qr(){this._nodeMap=new gt}function Kr(){this._edges=new lt,this._dirEdges=new lt,this._nodeMap=new Qr}function $r(){Kr.apply(this)}function ts(){this._graph=new $r,this._mergedLineStrings=null,this._factory=null,this._edgeStrings=null}e(Vr.prototype,{getCoordinates:function(){if(null===this._coordinates){for(var t=0,e=0,n=new M,i=this._directedEdges.iterator();i.hasNext();){var r=i.next();r.getEdgeDirection()?t++:e++,n.add(r.getEdge().getLine().getCoordinates(),!1,r.getEdgeDirection())}this._coordinates=n.toCoordinateArray(),t<e&&nt.reverse(this._coordinates)}return this._coordinates},toLineString:function(){return this._factory.createLineString(this.getCoordinates())},add:function(t){this._directedEdges.add(t)},interfaces_:function(){return[]},getClass:function(){return Vr}}),e(Ur.prototype,{setVisited:function(t){this._isVisited=t},isMarked:function(){return this._isMarked},setData:function(t){this._data=t},getData:function(){return this._data},setMarked:function(t){this._isMarked=t},getContext:function(){return this._data},isVisited:function(){return this._isVisited},setContext:function(t){this._data=t},interfaces_:function(){return[]},getClass:function(){return Ur}}),Ur.getComponentWithVisitedState=function(t,e){for(;t.hasNext();){var n=t.next();if(n.isVisited()===e)return n}return null},Ur.setVisited=function(t,e){for(;t.hasNext();)t.next().setVisited(e)},Ur.setMarked=function(t,e){for(;t.hasNext();)t.next().setMarked(e)},y(Wr,Ur),e(Wr.prototype,{isRemoved:function(){return null===this._parentEdge},compareDirection:function(t){return this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:z.index(t._p0,t._p1,this._p1)},getCoordinate:function(){return this._from.getCoordinate()},print:function(t){var e=this.getClass().getName(),n=e.lastIndexOf("."),i=e.substring(n+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+this._angle)},getDirectionPt:function(){return this._p1},getAngle:function(){return this._angle},compareTo:function(t){var e=t;return this.compareDirection(e)},getFromNode:function(){return this._from},getSym:function(){return this._sym},setEdge:function(t){this._parentEdge=t},remove:function(){this._sym=null,this._parentEdge=null},getEdge:function(){return this._parentEdge},getQuadrant:function(){return this._quadrant},setSym:function(t){this._sym=t},getToNode:function(){return this._to},getEdgeDirection:function(){return this._edgeDirection},interfaces_:function(){return[p]},getClass:function(){return Wr}}),Wr.toEdges=function(t){for(var e=new j,n=t.iterator();n.hasNext();)e.add(n.next()._parentEdge);return e},y(Yr,Wr),e(Yr.prototype,{getNext:function(){return 2!==this.getToNode().getDegree()?null:this.getToNode().getOutEdges().getEdges().get(0)===this.getSym()?this.getToNode().getOutEdges().getEdges().get(1):(b.isTrue(this.getToNode().getOutEdges().getEdges().get(1)===this.getSym()),this.getToNode().getOutEdges().getEdges().get(0))},interfaces_:function(){return[]},getClass:function(){return Yr}}),y(Hr,Ur),e(Hr.prototype,{isRemoved:function(){return null===this._dirEdge},setDirectedEdges:function(t,e){this._dirEdge=[t,e],t.setEdge(this),e.setEdge(this),t.setSym(e),e.setSym(t),t.getFromNode().addOutEdge(t),e.getFromNode().addOutEdge(e)},getDirEdge:function(){if(Number.isInteger(arguments[0])){var t=arguments[0];return this._dirEdge[t]}if(arguments[0]instanceof Xr){var e=arguments[0];return this._dirEdge[0].getFromNode()===e?this._dirEdge[0]:this._dirEdge[1].getFromNode()===e?this._dirEdge[1]:null}},remove:function(){this._dirEdge=null},getOppositeNode:function(t){return this._dirEdge[0].getFromNode()===t?this._dirEdge[0].getToNode():this._dirEdge[1].getFromNode()===t?this._dirEdge[1].getToNode():null},interfaces_:function(){return[]},getClass:function(){return Hr}}),e(Jr.prototype,{getNextEdge:function(t){var e=this.getIndex(t);return this._outEdges.get(this.getIndex(e+1))},getCoordinate:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},iterator:function(){return this.sortEdges(),this._outEdges.iterator()},sortEdges:function(){this._sorted||(Fe.sort(this._outEdges),this._sorted=!0)},remove:function(t){this._outEdges.remove(t)},getEdges:function(){return this.sortEdges(),this._outEdges},getNextCWEdge:function(t){var e=this.getIndex(t);return this._outEdges.get(this.getIndex(e-1))},getIndex:function(){if(arguments[0]instanceof Hr){var t=arguments[0];this.sortEdges();for(var e=0;e<this._outEdges.size();e++)if(this._outEdges.get(e).getEdge()===t)return e;return-1}if(arguments[0]instanceof Wr){var n=arguments[0];for(this.sortEdges(),e=0;e<this._outEdges.size();e++)if(this._outEdges.get(e)===n)return e;return-1}if(Number.isInteger(arguments[0])){var i=arguments[0]%this._outEdges.size();return i<0&&(i+=this._outEdges.size()),i}},add:function(t){this._outEdges.add(t),this._sorted=!1},getDegree:function(){return this._outEdges.size()},interfaces_:function(){return[]},getClass:function(){return Jr}}),y(Xr,Ur),e(Xr.prototype,{isRemoved:function(){return null===this._pt},addOutEdge:function(t){this._deStar.add(t)},getCoordinate:function(){return this._pt},getOutEdges:function(){return this._deStar},remove:function(){if(0===arguments.length)this._pt=null;else if(1===arguments.length){var t=arguments[0];this._deStar.remove(t)}},getIndex:function(t){return this._deStar.getIndex(t)},getDegree:function(){return this._deStar.getDegree()},interfaces_:function(){return[]},getClass:function(){return Xr}}),Xr.getEdgesBetween=function(t,e){var n=new lt(Wr.toEdges(t.getOutEdges().getEdges())),i=Wr.toEdges(e.getOutEdges().getEdges());return n.retainAll(i),n},y(Zr,Hr),e(Zr.prototype,{getLine:function(){return this._line},interfaces_:function(){return[]},getClass:function(){return Zr}}),e(Qr.prototype,{find:function(t){return this._nodeMap.get(t)},iterator:function(){return this._nodeMap.values().iterator()},remove:function(t){return this._nodeMap.remove(t)},values:function(){return this._nodeMap.values()},add:function(t){return this._nodeMap.put(t.getCoordinate(),t),t},interfaces_:function(){return[]},getClass:function(){return Qr}}),e(Kr.prototype,{findNodesOfDegree:function(t){for(var e=new j,n=this.nodeIterator();n.hasNext();){var i=n.next();i.getDegree()===t&&e.add(i)}return e},dirEdgeIterator:function(){return this._dirEdges.iterator()},edgeIterator:function(){return this._edges.iterator()},remove:function(){if(arguments[0]instanceof Hr){var t=arguments[0];this.remove(t.getDirEdge(0)),this.remove(t.getDirEdge(1)),this._edges.remove(t),t.remove()}else if(arguments[0]instanceof Wr){var e=arguments[0];null!==(r=e.getSym())&&r.setSym(null),e.getFromNode().remove(e),e.remove(),this._dirEdges.remove(e)}else if(arguments[0]instanceof Xr){for(var n=arguments[0],i=n.getOutEdges().getEdges().iterator();i.hasNext();){var r,s=i.next();null!==(r=s.getSym())&&this.remove(r),this._dirEdges.remove(s);var o=s.getEdge();null!==o&&this._edges.remove(o)}this._nodeMap.remove(n.getCoordinate()),n.remove()}},findNode:function(t){return this._nodeMap.find(t)},getEdges:function(){return this._edges},nodeIterator:function(){return this._nodeMap.iterator()},contains:function(){if(arguments[0]instanceof Hr){var t=arguments[0];return this._edges.contains(t)}if(arguments[0]instanceof Wr){var e=arguments[0];return this._dirEdges.contains(e)}},add:function(){if(arguments[0]instanceof Xr){var t=arguments[0];this._nodeMap.add(t)}else if(arguments[0]instanceof Hr){var e=arguments[0];this._edges.add(e),this.add(e.getDirEdge(0)),this.add(e.getDirEdge(1))}else if(arguments[0]instanceof Wr){var n=arguments[0];this._dirEdges.add(n)}},getNodes:function(){return this._nodeMap.values()},interfaces_:function(){return[]},getClass:function(){return Kr}}),y($r,Kr),e($r.prototype,{addEdge:function(t){if(t.isEmpty())return null;var e=nt.removeRepeatedPoints(t.getCoordinates());if(e.length<=1)return null;var n=e[0],i=e[e.length-1],r=this.getNode(n),s=this.getNode(i),o=new Yr(r,s,e[1],!0),a=new Yr(s,r,e[e.length-2],!1),l=new Zr(t);l.setDirectedEdges(o,a),this.add(l)},getNode:function(t){var e=this.findNode(t);return null===e&&(e=new Xr(t),this.add(e)),e},interfaces_:function(){return[]},getClass:function(){return $r}}),e(ts.prototype,{buildEdgeStringsForUnprocessedNodes:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next();e.isMarked()||(b.isTrue(2===e.getDegree()),this.buildEdgeStringsStartingAt(e),e.setMarked(!0))}},buildEdgeStringsForNonDegree2Nodes:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next();2!==e.getDegree()&&(this.buildEdgeStringsStartingAt(e),e.setMarked(!0))}},buildEdgeStringsForObviousStartNodes:function(){this.buildEdgeStringsForNonDegree2Nodes()},getMergedLineStrings:function(){return this.merge(),this._mergedLineStrings},buildEdgeStringsStartingAt:function(t){for(var e=t.getOutEdges().iterator();e.hasNext();){var n=e.next();n.getEdge().isMarked()||this._edgeStrings.add(this.buildEdgeStringStartingWith(n))}},merge:function(){if(null!==this._mergedLineStrings)return null;Ur.setMarked(this._graph.nodeIterator(),!1),Ur.setMarked(this._graph.edgeIterator(),!1),this._edgeStrings=new j,this.buildEdgeStringsForObviousStartNodes(),this.buildEdgeStringsForIsolatedLoops(),this._mergedLineStrings=new j;for(var t=this._edgeStrings.iterator();t.hasNext();){var e=t.next();this._mergedLineStrings.add(e.toLineString())}},buildEdgeStringStartingWith:function(t){for(var e=new Vr(this._factory),n=t;e.add(n),n.getEdge().setMarked(!0),null!==(n=n.getNext())&&n!==t;);return e},add:function(){if(arguments[0]instanceof X)arguments[0].apply({interfaces_:function(){return[J]},filter:function(t){t instanceof kt&&this.add(t)}});else if(S(arguments[0],O)){var t=arguments[0];this._mergedLineStrings=null;for(var e=t.iterator();e.hasNext();){var n=e.next();this.add(n)}}else if(arguments[0]instanceof kt){var i=arguments[0];null===this._factory&&(this._factory=i.getFactory()),this._graph.addEdge(i)}},buildEdgeStringsForIsolatedLoops:function(){this.buildEdgeStringsForUnprocessedNodes()},interfaces_:function(){return[]},getClass:function(){return ts}});var es=Object.freeze({LineMerger:ts});function ns(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e}function is(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new j,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null}function rs(){this._li=new ge,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t}function ss(){this._nv=null;var t=arguments[0];this._nv=new rs(ss.toSegmentStrings(t))}function os(){this._mapOp=null;var t=arguments[0];this._mapOp=t}function as(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new j,this._resultLineList=new j;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n}function ls(){this._op=null,this._geometryFactory=null,this._resultPointList=new j;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e}function us(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new me,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof kt&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];us.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this._srcPts=n,this._isClosed=us.isClosed(n),this._snapTolerance=i}}function cs(){this._srcGeom=null;var t=arguments[0];this._srcGeom=t}function hs(){if(Ln.apply(this),this._snapTolerance=null,this._snapPts=null,this._isSelfSnap=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._snapTolerance=t,this._snapPts=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._snapTolerance=n,this._snapPts=i,this._isSelfSnap=r}}function ds(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=new r,this._commonSignExp=null}function ps(){this._commonCoord=null,this._ccFilter=new fs}function fs(){this._commonBitsX=new ds,this._commonBitsY=new ds}function gs(){this.trans=null;var t=arguments[0];this.trans=t}function ms(){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null;var t=arguments[0],e=arguments[1];this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()}function _s(){this._geom=new Array(2).fill(null);var t=arguments[0],e=arguments[1];this._geom[0]=t,this._geom[1]=e}function ys(){if(this._li=new ge,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new li(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];ys.call(this,e,n,Q.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];0<=i.getPrecisionModel().compareTo(r.getPrecisionModel())?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new li(0,i,s),this._arg[1]=new li(1,r,s)}}function vs(){this._ptLocator=new Gn,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Or,this._resultPolyList=new j,this._resultLineList=new j,this._resultPointList=new j;var t=arguments[0],e=arguments[1];ys.call(this,t,e),this._graph=new ai(new Sr),this._geomFact=t.getFactory()}e(ns.prototype,{getCoordinates:function(){return this._pts},size:function(){return this._pts.length},getCoordinate:function(t){return this._pts[t]},isClosed:function(){return this._pts[0].equals(this._pts[this._pts.length-1])},getSegmentOctant:function(t){return t===this._pts.length-1?-1:Hi.octant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this._data=t},getData:function(){return this._data},toString:function(){return pe.toLineString(new Kt(this._pts))},interfaces_:function(){return[Ji]},getClass:function(){return ns}}),e(is.prototype,{getInteriorIntersection:function(){return this._interiorIntersection},setCheckEndSegmentsOnly:function(t){this._isCheckEndSegmentsOnly=t},getIntersectionSegments:function(){return this._intSegments},count:function(){return this._intersectionCount},getIntersections:function(){return this._intersections},setFindAllIntersections:function(t){this._findAllIntersections=t},setKeepIntersections:function(t){this._keepIntersections=t},processIntersections:function(t,e,n,i){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===i)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,i))return null;var r=t.getCoordinates()[e],s=t.getCoordinates()[e+1],o=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this._li.computeIntersection(r,s,o,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=r,this._intSegments[1]=s,this._intSegments[2]=o,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},isEndSegment:function(t,e){return 0===e||e>=t.size()-2},hasIntersection:function(){return null!==this._interiorIntersection},isDone:function(){return!this._findAllIntersections&&null!==this._interiorIntersection},interfaces_:function(){return[Ir]},getClass:function(){return is}}),is.createAllIntersectionsFinder=function(t){var e=new is(t);return e.setFindAllIntersections(!0),e},is.createAnyIntersectionFinder=function(t){return new is(t)},is.createIntersectionCounter=function(t){var e=new is(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e},e(rs.prototype,{execute:function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},getIntersections:function(){return this._segInt.getIntersections()},isValid:function(){return this.execute(),this._isValid},setFindAllIntersections:function(t){this._findAllIntersections=t},checkInteriorIntersections:function(){this._isValid=!0,this._segInt=new is(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new tr;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},checkValid:function(){if(this.execute(),!this._isValid)throw new ri(this.getErrorMessage(),this._segInt.getInteriorIntersection())},getErrorMessage:function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+pe.toLineString(t[0],t[1])+" and "+pe.toLineString(t[2],t[3])},interfaces_:function(){return[]},getClass:function(){return rs}}),rs.computeIntersections=function(t){var e=new rs(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()},e(ss.prototype,{checkValid:function(){this._nv.checkValid()},interfaces_:function(){return[]},getClass:function(){return ss}}),ss.toSegmentStrings=function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next();e.add(new ns(i.getCoordinates(),i))}return e},ss.checkValid=function(t){new ss(t).checkValid()},e(os.prototype,{map:function(t){for(var e=new j,n=0;n<t.getNumGeometries();n++){var i=this._mapOp.map(t.getGeometryN(n));i.isEmpty()||e.add(i)}return t.getFactory().createGeometryCollection(le.toGeometryArray(e))},interfaces_:function(){return[]},getClass:function(){return os}}),os.map=function(t,e){return new os(e).map(t)},e(as.prototype,{collectLines:function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next();this.collectLineEdge(n,t,this._lineEdgesList),this.collectBoundaryTouchEdge(n,t,this._lineEdgesList)}},labelIsolatedLine:function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)},build:function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},collectLineEdge:function(t,e,n){var i=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!vs.isResultOfOp(i,e)||r.isCovered()||(n.add(r),t.setVisitedEdge(!0)))},findCoveredLineEdges:function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this._op.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},labelIsolatedLines:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},buildLines:function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var n=e.next(),i=(n.getLabel(),this._geometryFactory.createLineString(n.getCoordinates()));this._resultLineList.add(i),n.setInResult(!0)}},collectBoundaryTouchEdge:function(t,e,n){var i=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(b.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(vs.isResultOfOp(i,e)&&e===vs.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},interfaces_:function(){return[]},getClass:function(){return as}}),e(ls.prototype,{filterCoveredNodeToPoint:function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}},extractNonCoveredResultNodes:function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&t!==vs.INTERSECTION)){var i=n.getLabel();vs.isResultOfOp(i,t)&&this.filterCoveredNodeToPoint(n)}}},build:function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},interfaces_:function(){return[]},getClass:function(){return ls}}),e(us.prototype,{snapVertices:function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),i=0;i<n;i++){var r=t.get(i),s=this.findSnapForVertex(r,e);null!==s&&(t.set(i,new x(s)),0===i&&this._isClosed&&t.set(t.size()-1,new x(s)))}},findSnapForVertex:function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null},snapTo:function(t){var e=new M(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},snapSegments:function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var i=0;i<n;i++){var r=e[i],s=this.findSegmentIndexToSnap(r,t);0<=s&&t.add(s+1,new x(r),!1)}},findSegmentIndexToSnap:function(t,e){for(var n=s.MAX_VALUE,i=-1,r=0;r<e.size()-1;r++){if(this._seg.p0=e.get(r),this._seg.p1=e.get(r+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<n&&(n=o,i=r)}return i},setAllowSnappingToSourceVertices:function(t){this._allowSnappingToSourceVertices=t},interfaces_:function(){return[]},getClass:function(){return us}}),us.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])},e(cs.prototype,{snapTo:function(t,e){return new hs(e,this.extractTargetCoordinates(t)).transform(this._srcGeom)},snapToSelf:function(t,e){var n=new hs(t,this.extractTargetCoordinates(this._srcGeom),!0).transform(this._srcGeom),i=n;return e&&S(i,qt)&&(i=n.buffer(0)),i},computeSnapTolerance:function(t){return this.computeMinimumSegmentLength(t)/10},extractTargetCoordinates:function(t){for(var e=new yt,n=t.getCoordinates(),i=0;i<n.length;i++)e.add(n[i]);return e.toArray(new Array(0).fill(null))},computeMinimumSegmentLength:function(t){for(var e=s.MAX_VALUE,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);i<e&&(e=i)}return e},interfaces_:function(){return[]},getClass:function(){return cs}}),cs.snap=function(t,e,n){var i=new Array(2).fill(null),r=new cs(t);i[0]=r.snapTo(e,n);var s=new cs(e);return i[1]=s.snapTo(i[0],n),i},cs.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=cs.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===oe.FIXED){var i=1/n.getScale()*2/1.415;e<i&&(e=i)}return e}if(2===arguments.length){var r=arguments[0],s=arguments[1];return Math.min(cs.computeOverlaySnapTolerance(r),cs.computeOverlaySnapTolerance(s))}},cs.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*cs.SNAP_PRECISION_FACTOR},cs.snapToSelf=function(t,e,n){return new cs(t).snapToSelf(e,n)},cs.SNAP_PRECISION_FACTOR=1e-9,y(hs,Ln),e(hs.prototype,{snapLine:function(t,e){var n=new us(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(i)},interfaces_:function(){return[]},getClass:function(){return hs}}),e(ds.prototype,{getCommon:function(){return s.longBitsToDouble(this._commonBits)},add:function(t){var e=s.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=ds.signExpBits(this._commonBits),this._isFirst=!1,null):ds.signExpBits(e)!==this._commonSignExp?(this._commonBits.high=0,this._commonBits.low=0,null):(this._commonMantissaBitsCount=ds.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=ds.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},toString:function(){if(1===arguments.length){var t=arguments[0],e=s.longBitsToDouble(t),n="0000000000000000000000000000000000000000000000000000000000000000"+r.toBinaryString(t),i=n.substring(n.length-64);return i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]"}},interfaces_:function(){return[]},getClass:function(){return ds}}),ds.getBit=function(t,e){var n=1<<e%32;return e<32?t.low&n?1:0:t.high&n?1:0},ds.signExpBits=function(t){return t.high>>>20},ds.zeroLowerBits=function(t,e){var n="low";if(32<e&&(t.low=0,e%=32,n="high"),0<e){var i=e<32?~((1<<e)-1):0;t[n]&=i}return t},ds.numCommonMostSigMantissaBits=function(t,e){for(var n=0,i=52;0<=i;i--){if(ds.getBit(t,i)!==ds.getBit(e,i))return n;n++}return 52},e(ps.prototype,{addCommonBits:function(t){var e=new gs(this._commonCoord);t.apply(e),t.geometryChanged()},removeCommonBits:function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new x(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new gs(e);return t.apply(n),t.geometryChanged(),t},getCommonCoordinate:function(){return this._commonCoord},add:function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},interfaces_:function(){return[]},getClass:function(){return ps}}),e(fs.prototype,{filter:function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},getCommonCoordinate:function(){return new x(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},interfaces_:function(){return[Z]},getClass:function(){return fs}}),e(gs.prototype,{filter:function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)},isDone:function(){return!1},isGeometryChanged:function(){return!0},interfaces_:function(){return[Ct]},getClass:function(){return gs}}),ps.CommonCoordinateFilter=fs,ps.Translater=gs,e(ms.prototype,{selfSnap:function(t){return new cs(t).snapTo(t,this._snapTolerance)},removeCommonBits:function(t){this._cbr=new ps,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},prepareResult:function(t){return this._cbr.addCommonBits(t),t},getResultGeometry:function(t){var e=this.snap(this._geom),n=vs.overlayOp(e[0],e[1],t);return this.prepareResult(n)},checkValid:function(t){t.isValid()||q.out.println("Snapped geometry is invalid")},computeSnapTolerance:function(){this._snapTolerance=cs.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},snap:function(t){var e=this.removeCommonBits(t);return cs.snap(e[0],e[1],this._snapTolerance)},interfaces_:function(){return[]},getClass:function(){return ms}}),ms.overlayOp=function(t,e,n){return new ms(t,e).getResultGeometry(n)},ms.union=function(t,e){return ms.overlayOp(t,e,vs.UNION)},ms.intersection=function(t,e){return ms.overlayOp(t,e,vs.INTERSECTION)},ms.symDifference=function(t,e){return ms.overlayOp(t,e,vs.SYMDIFFERENCE)},ms.difference=function(t,e){return ms.overlayOp(t,e,vs.DIFFERENCE)},e(_s.prototype,{getResultGeometry:function(t){var e=null,n=!1,i=null;try{e=vs.overlayOp(this._geom[0],this._geom[1],t),n=!0}catch(t){if(!(t instanceof _))throw t;i=t}if(!n)try{e=ms.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof _?i:t}return e},interfaces_:function(){return[]},getClass:function(){return _s}}),_s.overlayOp=function(t,e,n){return new _s(t,e).getResultGeometry(n)},_s.union=function(t,e){return _s.overlayOp(t,e,vs.UNION)},_s.intersection=function(t,e){return _s.overlayOp(t,e,vs.INTERSECTION)},_s.symDifference=function(t,e){return _s.overlayOp(t,e,vs.SYMDIFFERENCE)},_s.difference=function(t,e){return _s.overlayOp(t,e,vs.DIFFERENCE)},e(ys.prototype,{getArgGeometry:function(t){return this._arg[t].getGeometry()},setComputationPrecision:function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},interfaces_:function(){return[]},getClass:function(){return ys}}),y(vs,ys),e(vs.prototype,{insertUniqueEdge:function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new Hn(t.getLabel())).flip();var r=e.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this._edgeList.add(t)},getGraph:function(){return this._graph},cancelDuplicateResultEdges:function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},isCoveredByLA:function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},computeGeometry:function(t,e,n,i){var r=new j;return r.addAll(t),r.addAll(e),r.addAll(n),r.isEmpty()?vs.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(r)},mergeSymLabels:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},isCovered:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(this._ptLocator.locate(t,i)!==_e.EXTERIOR)return!0}return!1},replaceCollapsedEdges:function(){for(var t=new j,e=this._edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)},updateNodeLabelling:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},getResultGeometry:function(t){return this.computeOverlay(t),this._resultGeom},insertUniqueEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},computeOverlay:function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new j;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ss.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new pr(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();var i=new as(this,this._geomFact,this._ptLocator);this._resultLineList=i.build(t);var r=new ls(this,this._geomFact,this._ptLocator);this._resultPointList=r.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},labelIncompleteNode:function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)},copyPoints:function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},findResultAreaEdges:function(t){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&vs.isResultOfOp(i.getLocation(0,Bn.RIGHT),i.getLocation(1,Bn.RIGHT),t)&&n.setInResult(!0)}},computeLabelsFromDepths:function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),i=e.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(b.isTrue(!i.isNull(r,Bn.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,Bn.LEFT,i.getLocation(r,Bn.LEFT)),b.isTrue(!i.isNull(r,Bn.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,Bn.RIGHT,i.getLocation(r,Bn.RIGHT))))}}},computeLabelling:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},labelIncompleteNodes:function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},isCoveredByA:function(t){return!!this.isCovered(t,this._resultPolyList)},interfaces_:function(){return[]},getClass:function(){return vs}}),vs.overlayOp=function(t,e,n){return new vs(t,e).getResultGeometry(n)},vs.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return vs.createEmptyResult(vs.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}if(t.isGeometryCollection()||e.isGeometryCollection())throw new i("This method does not support GeometryCollection arguments");return _s.overlayOp(t,e,vs.UNION)},vs.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return vs.createEmptyResult(vs.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return os.map(t,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(n)}})}if(t.isGeometryCollection()||e.isGeometryCollection())throw new i("This method does not support GeometryCollection arguments");return _s.overlayOp(t,e,vs.INTERSECTION)},vs.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return vs.createEmptyResult(vs.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}if(t.isGeometryCollection()||e.isGeometryCollection())throw new i("This method does not support GeometryCollection arguments");return _s.overlayOp(t,e,vs.SYMDIFFERENCE)},vs.resultDimension=function(t,e,n){var i=e.getDimension(),r=n.getDimension(),s=-1;switch(t){case vs.INTERSECTION:s=Math.min(i,r);break;case vs.UNION:s=Math.max(i,r);break;case vs.DIFFERENCE:s=i;break;case vs.SYMDIFFERENCE:s=Math.max(i,r)}return s},vs.createEmptyResult=function(t,e,n,i){var r=null;switch(vs.resultDimension(t,e,n)){case-1:r=i.createGeometryCollection();break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},vs.difference=function(t,e){if(t.isEmpty())return vs.createEmptyResult(vs.DIFFERENCE,t,e,t.getFactory());if(e.isEmpty())return t.copy();if(t.isGeometryCollection()||e.isGeometryCollection())throw new i("This method does not support GeometryCollection arguments");return _s.overlayOp(t,e,vs.DIFFERENCE)},vs.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return vs.isResultOfOp(n,i,e)}if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];switch(r===_e.BOUNDARY&&(r=_e.INTERIOR),s===_e.BOUNDARY&&(s=_e.INTERIOR),o){case vs.INTERSECTION:return r===_e.INTERIOR&&s===_e.INTERIOR;case vs.UNION:return r===_e.INTERIOR||s===_e.INTERIOR;case vs.DIFFERENCE:return r===_e.INTERIOR&&s!==_e.INTERIOR;case vs.SYMDIFFERENCE:return r===_e.INTERIOR&&s!==_e.INTERIOR||r!==_e.INTERIOR&&s===_e.INTERIOR}return!1}},vs.INTERSECTION=1,vs.UNION=2,vs.DIFFERENCE=3,vs.SYMDIFFERENCE=4;var bs=Object.freeze({OverlayOp:vs});function xs(){this._edgeRing=null,this._next=null,this._label=-1;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];Wr.call(this,t,e,n,i)}function Es(){Hr.apply(this),this._line=null;var t=arguments[0];this._line=t}function Ss(){this._factory=null,this._deList=new j,this._lowestEdge=null,this._ring=null,this._ringPts=null,this._holes=null,this._shell=null,this._isHole=null,this._isProcessed=!1,this._isIncludedSet=!1,this._isIncluded=!1;var t=arguments[0];this._factory=t}function Cs(){}function Os(){Kr.apply(this),this._factory=null;var t=arguments[0];this._factory=t}function Is(){if(this._lineStringAdder=new ws(this),this._graph=null,this._dangles=new j,this._cutEdges=new j,this._invalidRingLines=new j,this._holeList=null,this._shellList=null,this._polyList=null,this._isCheckingRingsValid=!0,this._extractOnlyPolygonal=null,this._geomFactory=null,0===arguments.length)Is.call(this,!1);else if(1===arguments.length){var t=arguments[0];this._extractOnlyPolygonal=t}}function ws(){this.p=null;var t=arguments[0];this.p=t}y(xs,Wr),e(xs.prototype,{getNext:function(){return this._next},isInRing:function(){return null!==this._edgeRing},setRing:function(t){this._edgeRing=t},setLabel:function(t){this._label=t},getLabel:function(){return this._label},setNext:function(t){this._next=t},getRing:function(){return this._edgeRing},interfaces_:function(){return[]},getClass:function(){return xs}}),y(Es,Hr),e(Es.prototype,{getLine:function(){return this._line},interfaces_:function(){return[]},getClass:function(){return Es}}),e(Ss.prototype,{isIncluded:function(){return this._isIncluded},getCoordinates:function(){if(null===this._ringPts){for(var t=new M,e=this._deList.iterator();e.hasNext();){var n=e.next(),i=n.getEdge();Ss.addEdge(i.getLine().getCoordinates(),n.getEdgeDirection(),t)}this._ringPts=t.toCoordinateArray()}return this._ringPts},isIncludedSet:function(){return this._isIncludedSet},isValid:function(){return this.getCoordinates(),!(this._ringPts.length<=3)&&(this.getRing(),this._ring.isValid())},build:function(t){for(var e=t;this.add(e),e.setRing(this),e=e.getNext(),b.isTrue(null!==e,"found null DE in ring"),b.isTrue(e===t||!e.isInRing(),"found DE already in ring"),e!==t;);},isOuterHole:function(){return!!this._isHole&&!this.hasShell()},getPolygon:function(){var t=null;if(null!==this._holes){t=new Array(this._holes.size()).fill(null);for(var e=0;e<this._holes.size();e++)t[e]=this._holes.get(e)}return this._factory.createPolygon(this._ring,t)},isHole:function(){return this._isHole},isProcessed:function(){return this._isProcessed},addHole:function(){if(arguments[0]instanceof Wt){var t=arguments[0];null===this._holes&&(this._holes=new j),this._holes.add(t)}else if(arguments[0]instanceof Ss){var e=arguments[0];e.setShell(this);var n=e.getRing();null===this._holes&&(this._holes=new j),this._holes.add(n)}},setIncluded:function(t){this._isIncluded=t,this._isIncludedSet=!0},getOuterHole:function(){if(this.isHole())return null;for(var t=0;t<this._deList.size();t++){var e=this._deList.get(t).getSym().getRing();if(e.isOuterHole())return e}return null},computeHole:function(){var t=this.getRing();this._isHole=z.isCCW(t.getCoordinates())},hasShell:function(){return null!==this._shell},isOuterShell:function(){return null!==this.getOuterHole()},getLineString:function(){return this.getCoordinates(),this._factory.createLineString(this._ringPts)},toString:function(){return pe.toLineString(new Kt(this.getCoordinates()))},getShell:function(){return this.isHole()?this._shell:this},add:function(t){this._deList.add(t)},getRing:function(){if(null!==this._ring)return this._ring;this.getCoordinates(),this._ringPts.length<3&&q.out.println(this._ringPts);try{this._ring=this._factory.createLinearRing(this._ringPts)}catch(t){if(!(t instanceof P))throw t;q.out.println(this._ringPts)}return this._ring},updateIncluded:function(){if(this.isHole())return null;for(var t=0;t<this._deList.size();t++){var e=this._deList.get(t).getSym().getRing().getShell();if(null!==e&&e.isIncludedSet())return this.setIncluded(!e.isIncluded()),null}},setShell:function(t){this._shell=t},setProcessed:function(t){this._isProcessed=t},interfaces_:function(){return[]},getClass:function(){return Ss}}),Ss.findDirEdgesInRing=function(t){for(var e=t,n=new j;n.add(e),e=e.getNext(),b.isTrue(null!==e,"found null DE in ring"),b.isTrue(e===t||!e.isInRing(),"found DE already in ring"),e!==t;);return n},Ss.addEdge=function(t,e,n){if(e)for(var i=0;i<t.length;i++)n.add(t[i],!1);else for(i=t.length-1;0<=i;i--)n.add(t[i],!1)},Ss.findEdgeRingContaining=function(t,e){for(var n=t.getRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),s=null,o=null,a=e.iterator();a.hasNext();){var l=a.next(),u=l.getRing(),c=u.getEnvelopeInternal();if(!c.equals(i)&&c.contains(i)){r=nt.ptNotInList(n.getCoordinates(),u.getCoordinates());var h=!1;qe.isInRing(r,u.getCoordinates())&&(h=!0),h&&(null===s||o.contains(c))&&(o=(s=l).getRing().getEnvelopeInternal())}}return s},e(Cs.prototype,{compare:function(t,e){var n=e;return t.getRing().getEnvelope().compareTo(n.getRing().getEnvelope())},interfaces_:function(){return[g]},getClass:function(){return Cs}}),Ss.EnvelopeComparator=Cs,y(Os,Kr),e(Os.prototype,{findEdgeRing:function(t){var e=new Ss(this._factory);return e.build(t),e},computeDepthParity:function(){if(0===arguments.length)for(;;)return null},computeNextCWEdges:function(){for(var t=this.nodeIterator();t.hasNext();){var e=t.next();Os.computeNextCWEdges(e)}},addEdge:function(t){if(t.isEmpty())return null;var e=nt.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return null;var n=e[0],i=e[e.length-1],r=this.getNode(n),s=this.getNode(i),o=new xs(r,s,e[1],!0),a=new xs(s,r,e[e.length-2],!1),l=new Es(t);l.setDirectedEdges(o,a),this.add(l)},deleteCutEdges:function(){this.computeNextCWEdges(),Os.findLabeledEdgeRings(this._dirEdges);for(var t=new j,e=this._dirEdges.iterator();e.hasNext();){var n=e.next();if(!n.isMarked()){var i=n.getSym();if(n.getLabel()===i.getLabel()){n.setMarked(!0),i.setMarked(!0);var r=n.getEdge();t.add(r.getLine())}}}return t},getEdgeRings:function(){this.computeNextCWEdges(),Os.label(this._dirEdges,-1);var t=Os.findLabeledEdgeRings(this._dirEdges);this.convertMaximalToMinimalEdgeRings(t);for(var e=new j,n=this._dirEdges.iterator();n.hasNext();){var i=n.next();if(!i.isMarked()&&!i.isInRing()){var r=this.findEdgeRing(i);e.add(r)}}return e},getNode:function(t){var e=this.findNode(t);return null===e&&(e=new Xr(t),this.add(e)),e},convertMaximalToMinimalEdgeRings:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel(),r=Os.findIntersectionNodes(n,i);if(null!==r)for(var s=r.iterator();s.hasNext();){var o=s.next();Os.computeNextCCWEdges(o,i)}}},deleteDangles:function(){for(var t=this.findNodesOfDegree(1),e=new lt,n=new tn,i=t.iterator();i.hasNext();)n.push(i.next());for(;!n.isEmpty();){var r=n.pop();for(Os.deleteAllEdges(r),i=r.getOutEdges().getEdges().iterator();i.hasNext();){var s=i.next();s.setMarked(!0);var o=s.getSym();null!==o&&o.setMarked(!0);var a=s.getEdge();e.add(a.getLine());var l=s.getToNode();1===Os.getDegreeNonDeleted(l)&&n.push(l)}}return e},interfaces_:function(){return[]},getClass:function(){return Os}}),Os.findLabeledEdgeRings=function(t){for(var e=new j,n=1,i=t.iterator();i.hasNext();){var r=i.next();if(!(r.isMarked()||0<=r.getLabel())){e.add(r);var s=Ss.findDirEdgesInRing(r);Os.label(s,n),n++}}return e},Os.getDegreeNonDeleted=function(t){for(var e=0,n=t.getOutEdges().getEdges().iterator();n.hasNext();)n.next().isMarked()||e++;return e},Os.deleteAllEdges=function(t){for(var e=t.getOutEdges().getEdges().iterator();e.hasNext();){var n=e.next();n.setMarked(!0);var i=n.getSym();null!==i&&i.setMarked(!0)}},Os.label=function(t,e){for(var n=t.iterator();n.hasNext();)n.next().setLabel(e)},Os.computeNextCWEdges=function(t){for(var e=null,n=null,i=t.getOutEdges().getEdges().iterator();i.hasNext();){var r=i.next();r.isMarked()||(null===e&&(e=r),null!==n&&n.getSym().setNext(r),n=r)}null!==n&&n.getSym().setNext(e)},Os.computeNextCCWEdges=function(t,e){for(var n=null,i=null,r=t.getOutEdges().getEdges(),s=r.size()-1;0<=s;s--){var o=r.get(s),a=o.getSym(),l=null;o.getLabel()===e&&(l=o);var u=null;a.getLabel()===e&&(u=a),null===l&&null===u||(null!==u&&(i=u),null!==l&&(null!==i&&(i.setNext(l),i=null),null===n&&(n=l)))}null!==i&&(b.isTrue(null!==n),i.setNext(n))},Os.getDegree=function(t,e){for(var n=0,i=t.getOutEdges().getEdges().iterator();i.hasNext();)i.next().getLabel()===e&&n++;return n},Os.findIntersectionNodes=function(t,e){var n=t,i=null;do{var r=n.getFromNode();1<Os.getDegree(r,e)&&(null===i&&(i=new j),i.add(r)),n=n.getNext(),b.isTrue(null!==n,"found null DE in ring"),b.isTrue(n===t||!n.isInRing(),"found DE already in ring")}while(n!==t);return i},e(Is.prototype,{getGeometry:function(){return null===this._geomFactory&&(this._geomFactory=new le),this.polygonize(),this._extractOnlyPolygonal?this._geomFactory.buildGeometry(this._polyList):this._geomFactory.createGeometryCollection(le.toGeometryArray(this._polyList))},getInvalidRingLines:function(){return this.polygonize(),this._invalidRingLines},findValidRings:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isValid()?e.add(r):n.add(r.getLineString())}},polygonize:function(){if(null!==this._polyList)return null;if(this._polyList=new j,null===this._graph)return null;this._dangles=this._graph.deleteDangles(),this._cutEdges=this._graph.deleteCutEdges();var t=this._graph.getEdgeRings(),e=new j;this._invalidRingLines=new j,this._isCheckingRingsValid?this.findValidRings(t,e,this._invalidRingLines):e=t,this.findShellsAndHoles(e),Is.assignHolesToShells(this._holeList,this._shellList),Fe.sort(this._shellList,new Ss.EnvelopeComparator);var n=!0;this._extractOnlyPolygonal&&(Is.findDisjointShells(this._shellList),n=!1),this._polyList=Is.extractPolygons(this._shellList,n)},getDangles:function(){return this.polygonize(),this._dangles},getCutEdges:function(){return this.polygonize(),this._cutEdges},getPolygons:function(){return this.polygonize(),this._polyList},add:function(){if(S(arguments[0],O))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.add(e)}else if(arguments[0]instanceof kt){var n=arguments[0];this._geomFactory=n.getFactory(),null===this._graph&&(this._graph=new Os(this._geomFactory)),this._graph.addEdge(n)}else arguments[0]instanceof X&&arguments[0].apply(this._lineStringAdder)},setCheckRingsValid:function(t){this._isCheckingRingsValid=t},findShellsAndHoles:function(t){this._holeList=new j,this._shellList=new j;for(var e=t.iterator();e.hasNext();){var n=e.next();n.computeHole(),n.isHole()?this._holeList.add(n):this._shellList.add(n)}},interfaces_:function(){return[]},getClass:function(){return Is}}),Is.findOuterShells=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getOuterHole();null===i||i.isProcessed()||(n.setIncluded(!0),i.setProcessed(!0))}},Is.extractPolygons=function(t,e){for(var n=new j,i=t.iterator();i.hasNext();){var r=i.next();(e||r.isIncluded())&&n.add(r.getPolygon())}return n},Is.assignHolesToShells=function(t,e){for(var n=t.iterator();n.hasNext();){var i=n.next();Is.assignHoleToShell(i,e)}},Is.assignHoleToShell=function(t,e){var n=Ss.findEdgeRingContaining(t,e);null!==n&&n.addHole(t)},Is.findDisjointShells=function(t){Is.findOuterShells(t);var e=null;do{e=!1;for(var n=t.iterator();n.hasNext();){var i=n.next();i.isIncludedSet()||(i.updateIncluded(),i.isIncludedSet()||(e=!0))}}while(e)},e(ws.prototype,{filter:function(t){t instanceof kt&&this.p.add(t)},interfaces_:function(){return[J]},getClass:function(){return ws}}),Is.LineStringAdder=ws;var Ls=Object.freeze({Polygonizer:Is});function Ts(){}function js(){if(this._edgeEnds=new j,1===arguments.length){var t=arguments[0];js.call(this,null,t)}else if(2===arguments.length){var e=arguments[1];ii.call(this,e.getEdge(),e.getCoordinate(),e.getDirectedCoordinate(),new Hn(e.getLabel())),this.insert(e)}}function Ns(){xr.apply(this)}function Ms(){var t=arguments[0],e=arguments[1];ei.call(this,t,e)}function Fs(){oi.apply(this)}function Ps(){this._li=new ge,this._ptLocator=new Gn,this._arg=null,this._nodes=new ni(new Fs),this._im=null,this._isolatedEdges=new j,this._invalidPoint=null;var t=arguments[0];this._arg=t}function Rs(){this._rectEnv=null;var t=arguments[0];this._rectEnv=t.getEnvelopeInternal()}function Ds(){this._li=new ge,this._rectEnv=null,this._diagUp0=null,this._diagUp1=null,this._diagDown0=null,this._diagDown1=null;var t=arguments[0];this._rectEnv=t,this._diagUp0=new x(t.getMinX(),t.getMinY()),this._diagUp1=new x(t.getMaxX(),t.getMaxY()),this._diagDown0=new x(t.getMinX(),t.getMaxY()),this._diagDown1=new x(t.getMaxX(),t.getMinY())}function As(){this._isDone=!1}function ks(){this._rectangle=null,this._rectEnv=null;var t=arguments[0];this._rectangle=t,this._rectEnv=t.getEnvelopeInternal()}function Gs(){As.apply(this),this._rectEnv=null,this._intersects=!1;var t=arguments[0];this._rectEnv=t}function Bs(){As.apply(this),this._rectSeq=null,this._rectEnv=null,this._containsPoint=!1;var t=arguments[0];this._rectSeq=t.getExteriorRing().getCoordinateSequence(),this._rectEnv=t.getEnvelopeInternal()}function zs(){As.apply(this),this._rectEnv=null,this._rectIntersector=null,this._hasIntersection=!1,this._p0=new x,this._p1=new x;var t=arguments[0];this._rectEnv=t.getEnvelopeInternal(),this._rectIntersector=new Ds(this._rectEnv)}function qs(){if(this._relate=null,2===arguments.length){var t=arguments[0],e=arguments[1];ys.call(this,t,e),this._relate=new Ps(this._arg)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];ys.call(this,n,i,r),this._relate=new Ps(this._arg)}}e(Ts.prototype,{createEdgeEndForNext:function(t,e,n,i){var r=n.segmentIndex+1;if(r>=t.getNumPoints()&&null===i)return null;var s=t.getCoordinate(r);null!==i&&i.segmentIndex===n.segmentIndex&&(s=i.coord);var o=new ii(t,n.coord,s,new Hn(t.getLabel()));e.add(o)},createEdgeEndForPrev:function(t,e,n,i){var r=n.segmentIndex;if(0===n.dist){if(0===r)return null;r--}var s=t.getCoordinate(r);null!==i&&i.segmentIndex>=r&&(s=i.coord);var o=new Hn(t.getLabel());o.flip();var a=new ii(t,n.coord,s,o);e.add(a)},computeEdgeEnds:function(){if(1===arguments.length){for(var t=arguments[0],e=new j,n=t;n.hasNext();){var i=n.next();this.computeEdgeEnds(i,e)}return e}if(2===arguments.length){var r=arguments[0],s=arguments[1],o=r.getEdgeIntersectionList();o.addEndpoints();var a=o.iterator(),l=null,u=null;if(!a.hasNext())return null;for(var c=a.next();l=u,u=c,c=null,a.hasNext()&&(c=a.next()),null!==u&&(this.createEdgeEndForPrev(r,s,u,l),this.createEdgeEndForNext(r,s,u,c)),null!==u;);}},interfaces_:function(){return[]},getClass:function(){return Ts}}),y(js,ii),e(js.prototype,{insert:function(t){this._edgeEnds.add(t)},print:function(t){t.println("EdgeEndBundle--\x3e Label: "+this._label);for(var e=this.iterator();e.hasNext();)e.next().print(t),t.println()},iterator:function(){return this._edgeEnds.iterator()},getEdgeEnds:function(){return this._edgeEnds},computeLabelOn:function(t,e){for(var n=0,i=!1,r=this.iterator();r.hasNext();)(s=r.next().getLabel().getLocation(t))===_e.BOUNDARY&&n++,s===_e.INTERIOR&&(i=!0);var s=_e.NONE;i&&(s=_e.INTERIOR),0<n&&(s=li.determineBoundary(e,n)),this._label.setLocation(t,s)},computeLabelSide:function(t,e){for(var n=this.iterator();n.hasNext();){var i=n.next();if(i.getLabel().isArea()){var r=i.getLabel().getLocation(t,e);if(r===_e.INTERIOR)return this._label.setLocation(t,e,_e.INTERIOR),null;r===_e.EXTERIOR&&this._label.setLocation(t,e,_e.EXTERIOR)}}},getLabel:function(){return this._label},computeLabelSides:function(t){this.computeLabelSide(t,Bn.LEFT),this.computeLabelSide(t,Bn.RIGHT)},updateIM:function(t){ti.updateIM(this._label,t)},computeLabel:function(t){for(var e=!1,n=this.iterator();n.hasNext();)n.next().getLabel().isArea()&&(e=!0);this._label=e?new Hn(_e.NONE,_e.NONE,_e.NONE):new Hn(_e.NONE);for(var i=0;i<2;i++)this.computeLabelOn(i,t),e&&this.computeLabelSides(i)},interfaces_:function(){return[]},getClass:function(){return js}}),y(Ns,xr),e(Ns.prototype,{updateIM:function(t){for(var e=this.iterator();e.hasNext();)e.next().updateIM(t)},insert:function(t){var e=this._edgeMap.get(t);null===e?(e=new js(t),this.insertEdgeEnd(t,e)):e.insert(t)},interfaces_:function(){return[]},getClass:function(){return Ns}}),y(Ms,ei),e(Ms.prototype,{updateIMFromEdges:function(t){this._edges.updateIM(t)},computeIM:function(t){t.setAtLeastIfValid(this._label.getLocation(0),this._label.getLocation(1),0)},interfaces_:function(){return[]},getClass:function(){return Ms}}),y(Fs,oi),e(Fs.prototype,{createNode:function(t){return new Ms(t,new Ns)},interfaces_:function(){return[]},getClass:function(){return Fs}}),e(Ps.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this._nodes.add(n)}},computeProperIntersectionIM:function(t,e){var n=this._arg[0].getGeometry().getDimension(),i=this._arg[1].getGeometry().getDimension(),r=t.hasProperIntersection(),s=t.hasProperInteriorIntersection();2===n&&2===i?r&&e.setAtLeast("212101212"):2===n&&1===i?(r&&e.setAtLeast("FFF0FFFF2"),s&&e.setAtLeast("1FFFFF1FF")):1===n&&2===i?(r&&e.setAtLeast("F0FFFFFF2"),s&&e.setAtLeast("1F1FFFFFF")):1===n&&1===i&&s&&e.setAtLeast("0FFFFFFFF")},labelIsolatedEdges:function(t,e){for(var n=this._arg[t].getEdgeIterator();n.hasNext();){var i=n.next();i.isIsolated()&&(this.labelIsolatedEdge(i,e,this._arg[e].getGeometry()),this._isolatedEdges.add(i))}},labelIsolatedEdge:function(t,e,n){if(0<n.getDimension()){var i=this._ptLocator.locate(t.getCoordinate(),n);t.getLabel().setAllLocations(e,i)}else t.getLabel().setAllLocations(e,_e.EXTERIOR)},computeIM:function(){var t=new ye;if(t.set(_e.EXTERIOR,_e.EXTERIOR,2),!this._arg[0].getGeometry().getEnvelopeInternal().intersects(this._arg[1].getGeometry().getEnvelopeInternal()))return this.computeDisjointIM(t),t;this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1);var e=this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!1);this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(e,t);var n=new Ts,i=n.computeEdgeEnds(this._arg[0].getEdgeIterator());this.insertEdgeEnds(i);var r=n.computeEdgeEnds(this._arg[1].getEdgeIterator());return this.insertEdgeEnds(r),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(t),t},labelNodeEdges:function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg)},copyNodesAndLabels:function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var n=e.next();this._nodes.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},labelIntersectionNodes:function(t){for(var e=this._arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next(),o=this._nodes.find(s.coord);o.getLabel().isNull(t)&&(i===_e.BOUNDARY?o.setLabelBoundary(t):o.setLabel(t,_e.INTERIOR))}},labelIsolatedNode:function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setAllLocations(e,n)},computeIntersectionNodes:function(t){for(var e=this._arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var s=r.next(),o=this._nodes.addNode(s.coord);i===_e.BOUNDARY?o.setLabelBoundary(t):o.getLabel().isNull(t)&&o.setLabel(t,_e.INTERIOR)}},labelIsolatedNodes:function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next(),n=e.getLabel();b.isTrue(0<n.getGeometryCount(),"node with empty label found"),e.isIsolated()&&(n.isNull(0)?this.labelIsolatedNode(e,0):this.labelIsolatedNode(e,1))}},updateIM:function(t){for(var e=this._isolatedEdges.iterator();e.hasNext();)e.next().updateIM(t);for(var n=this._nodes.iterator();n.hasNext();){var i=n.next();i.updateIM(t),i.updateIMFromEdges(t)}},computeDisjointIM:function(t){var e=this._arg[0].getGeometry();e.isEmpty()||(t.set(_e.INTERIOR,_e.EXTERIOR,e.getDimension()),t.set(_e.BOUNDARY,_e.EXTERIOR,e.getBoundaryDimension()));var n=this._arg[1].getGeometry();n.isEmpty()||(t.set(_e.EXTERIOR,_e.INTERIOR,n.getDimension()),t.set(_e.EXTERIOR,_e.BOUNDARY,n.getBoundaryDimension()))},interfaces_:function(){return[]},getClass:function(){return Ps}}),e(Rs.prototype,{isContainedInBoundary:function(t){if(t instanceof Vt)return!1;if(t instanceof Bt)return this.isPointContainedInBoundary(t);if(t instanceof kt)return this.isLineStringContainedInBoundary(t);for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.isContainedInBoundary(n))return!1}return!0},isLineSegmentContainedInBoundary:function(t,e){if(t.equals(e))return this.isPointContainedInBoundary(t);if(t.x===e.x){if(t.x===this._rectEnv.getMinX()||t.x===this._rectEnv.getMaxX())return!0}else if(t.y===e.y&&(t.y===this._rectEnv.getMinY()||t.y===this._rectEnv.getMaxY()))return!0;return!1},isLineStringContainedInBoundary:function(t){for(var e=t.getCoordinateSequence(),n=new x,i=new x,r=0;r<e.size()-1;r++)if(e.getCoordinate(r,n),e.getCoordinate(r+1,i),!this.isLineSegmentContainedInBoundary(n,i))return!1;return!0},isPointContainedInBoundary:function(){if(arguments[0]instanceof Bt){var t=arguments[0];return this.isPointContainedInBoundary(t.getCoordinate())}if(arguments[0]instanceof x){var e=arguments[0];return e.x===this._rectEnv.getMinX()||e.x===this._rectEnv.getMaxX()||e.y===this._rectEnv.getMinY()||e.y===this._rectEnv.getMaxY()}},contains:function(t){return!!this._rectEnv.contains(t.getEnvelopeInternal())&&!this.isContainedInBoundary(t)},interfaces_:function(){return[]},getClass:function(){return Rs}}),Rs.contains=function(t,e){return new Rs(t).contains(e)},e(Ds.prototype,{intersects:function(t,e){var n=new F(t,e);if(!this._rectEnv.intersects(n))return!1;if(this._rectEnv.intersects(t))return!0;if(this._rectEnv.intersects(e))return!0;if(0<t.compareTo(e)){var i=t;t=e,e=i}var r=!1;return e.y>t.y&&(r=!0),r?this._li.computeIntersection(t,e,this._diagDown0,this._diagDown1):this._li.computeIntersection(t,e,this._diagUp0,this._diagUp1),!!this._li.hasIntersection()},interfaces_:function(){return[]},getClass:function(){return Ds}}),e(As.prototype,{applyTo:function(t){for(var e=0;e<t.getNumGeometries()&&!this._isDone;e++){var n=t.getGeometryN(e);if(n instanceof Ot)this.applyTo(n);else if(this.visit(n),this.isDone())return this._isDone=!0,null}},interfaces_:function(){return[]},getClass:function(){return As}}),e(ks.prototype,{intersects:function(t){if(!this._rectEnv.intersects(t.getEnvelopeInternal()))return!1;var e=new Gs(this._rectEnv);if(e.applyTo(t),e.intersects())return!0;var n=new Bs(this._rectangle);if(n.applyTo(t),n.containsPoint())return!0;var i=new zs(this._rectangle);return i.applyTo(t),!!i.intersects()},interfaces_:function(){return[]},getClass:function(){return ks}}),ks.intersects=function(t,e){return new ks(t).intersects(e)},y(Gs,As),e(Gs.prototype,{isDone:function(){return!0===this._intersects},visit:function(t){var e=t.getEnvelopeInternal();return this._rectEnv.intersects(e)?this._rectEnv.contains(e)||e.getMinX()>=this._rectEnv.getMinX()&&e.getMaxX()<=this._rectEnv.getMaxX()||e.getMinY()>=this._rectEnv.getMinY()&&e.getMaxY()<=this._rectEnv.getMaxY()?(this._intersects=!0,null):void 0:null},intersects:function(){return this._intersects},interfaces_:function(){return[]},getClass:function(){return Gs}}),y(Bs,As),e(Bs.prototype,{isDone:function(){return!0===this._containsPoint},visit:function(t){if(!(t instanceof Vt))return null;var e=t.getEnvelopeInternal();if(!this._rectEnv.intersects(e))return null;for(var n=new x,i=0;i<4;i++)if(this._rectSeq.getCoordinate(i,n),e.contains(n)&&Ue.containsPointInPolygon(n,t))return this._containsPoint=!0,null},containsPoint:function(){return this._containsPoint},interfaces_:function(){return[]},getClass:function(){return Bs}}),y(zs,As),e(zs.prototype,{intersects:function(){return this._hasIntersection},isDone:function(){return!0===this._hasIntersection},visit:function(t){var e=t.getEnvelopeInternal();if(!this._rectEnv.intersects(e))return null;var n=De.getLines(t);this.checkIntersectionWithLineStrings(n)},checkIntersectionWithLineStrings:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();if(this.checkIntersectionWithSegments(n),this._hasIntersection)return null}},checkIntersectionWithSegments:function(t){for(var e=t.getCoordinateSequence(),n=1;n<e.size();n++)if(e.getCoordinate(n-1,this._p0),e.getCoordinate(n,this._p1),this._rectIntersector.intersects(this._p0,this._p1))return this._hasIntersection=!0,null},interfaces_:function(){return[]},getClass:function(){return zs}}),y(qs,ys),e(qs.prototype,{getIntersectionMatrix:function(){return this._relate.computeIM()},interfaces_:function(){return[]},getClass:function(){return qs}}),qs.covers=function(t,e){return!(2===e.getDimension()&&t.getDimension()<2)&&!(1===e.getDimension()&&t.getDimension()<1&&0<e.getLength())&&!!t.getEnvelopeInternal().covers(e.getEnvelopeInternal())&&(!!t.isRectangle()||new qs(t,e).getIntersectionMatrix().isCovers())},qs.intersects=function(t,e){if(!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal()))return!1;if(t.isRectangle())return ks.intersects(t,e);if(e.isRectangle())return ks.intersects(e,t);if(t.isGeometryCollection()||e.isGeometryCollection()){for(var n=0;n<t.getNumGeometries();n++)for(var i=0;i<e.getNumGeometries();i++)if(t.getGeometryN(n).intersects(e.getGeometryN(i)))return!0;return!1}return new qs(t,e).getIntersectionMatrix().isIntersects()},qs.touches=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&new qs(t,e).getIntersectionMatrix().isTouches(t.getDimension(),e.getDimension())},qs.relate=function(){return 2===arguments.length?new qs(arguments[0],arguments[1]).getIntersectionMatrix():3===arguments.length?new qs(arguments[0],arguments[1],arguments[2]).getIntersectionMatrix():void 0},qs.overlaps=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&new qs(t,e).getIntersectionMatrix().isOverlaps(t.getDimension(),e.getDimension())},qs.crosses=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&new qs(t,e).getIntersectionMatrix().isCrosses(t.getDimension(),e.getDimension())},qs.contains=function(t,e){return!(2===e.getDimension()&&t.getDimension()<2)&&!(1===e.getDimension()&&t.getDimension()<1&&0<e.getLength())&&!!t.getEnvelopeInternal().contains(e.getEnvelopeInternal())&&(t.isRectangle()?Rs.contains(t,e):new qs(t,e).getIntersectionMatrix().isContains())};var Vs=Object.freeze({RelateOp:qs});function Us(){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null;var t=arguments[0];this._geomFactory=Us.extractFactory(t),this._inputGeoms=t}function Ws(){this._pointGeom=null,this._otherGeom=null,this._geomFact=null;var t=arguments[0],e=arguments[1];this._pointGeom=t,this._otherGeom=e,this._geomFact=e.getFactory()}function Ys(){this._geometryType=null,this._comps=null;var t=arguments[0],e=arguments[1];this._geometryType=t,this._comps=e}function Hs(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new j)}function Js(){if(this._polygons=new j,this._lines=new j,this._points=new j,this._geomFact=null,1===arguments.length){if(S(arguments[0],O)){var t=arguments[0];this.extract(t)}else if(arguments[0]instanceof X){var e=arguments[0];this.extract(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this._geomFact=i,this.extract(n)}}e(Us.prototype,{extractElements:function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);this._skipEmpty&&i.isEmpty()||e.add(i)}},combine:function(){for(var t=new j,e=this._inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection():null:this._geomFactory.buildGeometry(t)},interfaces_:function(){return[]},getClass:function(){return Us}}),Us.combine=function(){if(1===arguments.length)return new Us(arguments[0]).combine();if(2===arguments.length){var t=arguments[0],e=arguments[1];return new Us(Us.createList(t,e)).combine()}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];return new Us(Us.createList(n,i,r)).combine()}},Us.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Us.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return(n=new j).add(t),n.add(e),n}if(3===arguments.length){var n,i=arguments[0],r=arguments[1],s=arguments[2];return(n=new j).add(i),n.add(r),n.add(s),n}},e(Ws.prototype,{union:function(){for(var t=new Gn,e=new yt,n=0;n<this._pointGeom.getNumGeometries();n++){var i=this._pointGeom.getGeometryN(n).getCoordinate();t.locate(i,this._otherGeom)===_e.EXTERIOR&&e.add(i)}if(0===e.size())return this._otherGeom;var r,s=nt.toCoordinateArray(e);return r=1===s.length?this._geomFact.createPoint(s[0]):this._geomFact.createMultiPointFromCoords(s),Us.combine(r,this._otherGeom)},interfaces_:function(){return[]},getClass:function(){return Ws}}),Ws.union=function(t,e){return new Ws(t,e).union()},e(Ys.prototype,{filter:function(t){(null===this._geometryType||Ys.isOfType(t,this._geometryType))&&this._comps.add(t)},interfaces_:function(){return[St]},getClass:function(){return Ys}}),Ys.isOfType=function(t,e){return t.getGeometryType()===e||e===X.TYPENAME_LINESTRING&&t.getGeometryType()===X.TYPENAME_LINEARRING},Ys.extract=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return Ys.extract(t,e,new j)}if(3===arguments.length){if(S(arguments[2],w)&&arguments[0]instanceof X&&"string"==typeof arguments[1]){var n=arguments[0],i=arguments[1],r=arguments[2];return n.getGeometryType()===i?r.add(n):n instanceof Ot&&n.apply(new Ys(i,r)),r}if(S(arguments[2],w)&&arguments[0]instanceof X&&arguments[1]instanceof Class){var s=arguments[0],o=arguments[1],a=arguments[2];return Ys.extract(s,Ys.toGeometryType(o),a)}}},e(Hs.prototype,{reduceToGeometries:function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next(),r=null;S(i,w)?r=this.unionTree(i):i instanceof X&&(r=i),e.add(r)}return e},extractByEnvelope:function(t,e,n){for(var i=new j,r=0;r<e.getNumGeometries();r++){var s=e.getGeometryN(r);s.getEnvelopeInternal().intersects(t)?i.add(s):n.add(s)}return this._geomFactory.buildGeometry(i)},unionOptimized:function(t,e){var n=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();if(!n.intersects(i))return Us.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(t,e,r)},union:function(){if(null===this._inputPolys)throw new IllegalStateException("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new Ti(Hs.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=t.itemsTree();return this.unionTree(i)},binaryUnion:function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Hs.getGeometry(e,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(Hs.getGeometry(e,n),Hs.getGeometry(e,n+1));var s=Math.trunc((i+n)/2),o=(r=this.binaryUnion(e,n,s),this.binaryUnion(e,s,i));return this.unionSafe(r,o)}},repeatedUnion:function(t){for(var e=null,n=t.iterator();n.hasNext();){var i=n.next();e=null===e?i.copy():e.union(i)}return e},unionSafe:function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},unionActual:function(t,e){return Hs.restrictToPolygons(t.union(e))},unionTree:function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},unionUsingEnvelopeIntersection:function(t,e,n){var i=new j,r=this.extractByEnvelope(n,t,i),s=this.extractByEnvelope(n,e,i),o=this.unionActual(r,s);return i.add(o),Us.combine(i)},bufferUnion:function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().createGeometryCollection([e,n]).buffer(0)}},interfaces_:function(){return[]},getClass:function(){return Hs}}),Hs.restrictToPolygons=function(t){if(S(t,qt))return t;var e=Ar.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(le.toPolygonArray(e))},Hs.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Hs.union=function(t){return new Hs(t).union()},Hs.STRTREE_NODE_CAPACITY=4,e(Js.prototype,{unionNoOpt:function(t){var e=this._geomFact.createPoint();return _s.overlayOp(t,e,vs.UNION)},unionWithNull:function(t,e){return null===t&&null===e?null:null===e?t:null===t?e:t.union(e)},extract:function(){if(S(arguments[0],O))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.extract(e)}else if(arguments[0]instanceof X){var n=arguments[0];null===this._geomFact&&(this._geomFact=n.getFactory()),Ys.extract(n,X.TYPENAME_POLYGON,this._polygons),Ys.extract(n,X.TYPENAME_LINESTRING,this._lines),Ys.extract(n,X.TYPENAME_POINT,this._points)}},union:function(){if(null===this._geomFact)return null;var t=null;if(0<this._points.size()){var e=this._geomFact.buildGeometry(this._points);t=this.unionNoOpt(e)}var n=null;if(0<this._lines.size()){var i=this._geomFact.buildGeometry(this._lines);n=this.unionNoOpt(i)}var r=null;0<this._polygons.size()&&(r=Hs.union(this._polygons));var s,o=this.unionWithNull(n,r);return null===(s=null===t?o:null===o?t:Ws.union(t,o))?this._geomFact.createGeometryCollection():s},interfaces_:function(){return[]},getClass:function(){return Js}}),Js.union=function(){if(1===arguments.length){if(S(arguments[0],O))return new Js(arguments[0]).union();if(arguments[0]instanceof X)return new Js(arguments[0]).union()}else if(2===arguments.length)return new Js(arguments[0],arguments[1]).union()};var Xs=Object.freeze({UnaryUnionOp:Js});function Zs(){this._geometryFactory=new le,this._geomGraph=null,this._disconnectedRingcoord=null;var t=arguments[0];this._geomGraph=t}function Qs(){this._nodes=new ni(new Fs)}function Ks(){this._li=new ge,this._geomGraph=null,this._nodeGraph=new Qs,this._invalidPoint=null;var t=arguments[0];this._geomGraph=t}function $s(){this._graph=null,this._rings=new j,this._totalEnv=new F,this._index=null,this._nestedPt=null;var t=arguments[0];this._graph=t}function to(){if(this._errorType=null,this._pt=null,1===arguments.length){var t=arguments[0];to.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._errorType=e,null!==n&&(this._pt=n.copy())}}function eo(){this._parentGeometry=null,this._isSelfTouchingRingFormingHoleValid=!1,this._validErr=null;var t=arguments[0];this._parentGeometry=t}e(Zs.prototype,{visitInteriorRing:function(t,e){var n=t.getCoordinates(),i=n[0],r=Zs.findDifferentPoint(n,i),s=e.findEdgeInSameDirection(i,r),o=e.findEdgeEnd(s),a=null;o.getLabel().getLocation(0,Bn.RIGHT)===_e.INTERIOR?a=o:o.getSym().getLabel().getLocation(0,Bn.RIGHT)===_e.INTERIOR&&(a=o.getSym()),b.isTrue(null!==a,"unable to find dirEdge with Interior on RHS"),this.visitLinkedDirectedEdges(a)},visitShellInteriors:function(t,e){if(t instanceof Vt){var n=t;this.visitInteriorRing(n.getExteriorRing(),e)}if(t instanceof Yt)for(var i=t,r=0;r<i.getNumGeometries();r++)n=i.getGeometryN(r),this.visitInteriorRing(n.getExteriorRing(),e)},getCoordinate:function(){return this._disconnectedRingcoord},setInteriorEdgesInResult:function(t){for(var e=t.getEdgeEnds().iterator();e.hasNext();){var n=e.next();n.getLabel().getLocation(0,Bn.RIGHT)===_e.INTERIOR&&n.setInResult(!0)}},visitLinkedDirectedEdges:function(t){for(var e=t,n=t;b.isTrue(null!==n,"found null Directed Edge"),n.setVisited(!0),(n=n.getNext())!==e;);},buildEdgeRings:function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&null===i.getEdgeRing()){var r=new dr(i,this._geometryFactory);r.linkDirectedEdgesForMinimalEdgeRings();var s=r.buildMinimalRings();e.addAll(s)}}return e},hasUnvisitedShellEdge:function(t){for(var e=0;e<t.size();e++){var n=t.get(e);if(!n.isHole()){var i=n.getEdges(),r=i.get(0);if(r.getLabel().getLocation(0,Bn.RIGHT)===_e.INTERIOR)for(var s=0;s<i.size();s++)if(!(r=i.get(s)).isVisited())return this._disconnectedRingcoord=r.getCoordinate(),!0}}return!1},isInteriorsConnected:function(){var t=new j;this._geomGraph.computeSplitEdges(t);var e=new ai(new Sr);e.addEdges(t),this.setInteriorEdgesInResult(e),e.linkResultDirectedEdges();var n=this.buildEdgeRings(e.getEdgeEnds());return this.visitShellInteriors(this._geomGraph.getGeometry(),e),!this.hasUnvisitedShellEdge(n)},interfaces_:function(){return[]},getClass:function(){return Zs}}),Zs.findDifferentPoint=function(t,e){for(var n=0;n<t.length;n++)if(!t[n].equals(e))return t[n];return null},e(Qs.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this._nodes.add(n)}},getNodeIterator:function(){return this._nodes.iterator()},copyNodesAndLabels:function(t,e){for(var n=t.getNodeIterator();n.hasNext();){var i=n.next();this._nodes.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},build:function(t){this.computeIntersectionNodes(t,0),this.copyNodesAndLabels(t,0);var e=(new Ts).computeEdgeEnds(t.getEdgeIterator());this.insertEdgeEnds(e)},computeIntersectionNodes:function(t,e){for(var n=t.getEdgeIterator();n.hasNext();)for(var i=n.next(),r=i.getLabel().getLocation(e),s=i.getEdgeIntersectionList().iterator();s.hasNext();){var o=s.next(),a=this._nodes.addNode(o.coord);r===_e.BOUNDARY?a.setLabelBoundary(e):a.getLabel().isNull(e)&&a.setLabel(e,_e.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Qs}}),e(Ks.prototype,{isNodeEdgeAreaLabelsConsistent:function(){for(var t=this._nodeGraph.getNodeIterator();t.hasNext();){var e=t.next();if(!e.getEdges().isAreaLabelsConsistent(this._geomGraph))return this._invalidPoint=e.getCoordinate().copy(),!1}return!0},getInvalidPoint:function(){return this._invalidPoint},hasDuplicateRings:function(){for(var t=this._nodeGraph.getNodeIterator();t.hasNext();)for(var e=t.next().getEdges().iterator();e.hasNext();){var n=e.next();if(1<n.getEdgeEnds().size())return this._invalidPoint=n.getEdge().getCoordinate(0),!0}return!1},isNodeConsistentArea:function(){var t=this._geomGraph.computeSelfNodes(this._li,!0,!0);return t.hasProperIntersection()?(this._invalidPoint=t.getProperIntersectionPoint(),!1):(this._nodeGraph.build(this._geomGraph),this.isNodeEdgeAreaLabelsConsistent())},interfaces_:function(){return[]},getClass:function(){return Ks}}),e($s.prototype,{buildIndex:function(){this._index=new Ti;for(var t=0;t<this._rings.size();t++){var e=this._rings.get(t),n=e.getEnvelopeInternal();this._index.insert(n,e)}},getNestedPoint:function(){return this._nestedPt},isNonNested:function(){this.buildIndex();for(var t=0;t<this._rings.size();t++)for(var e=this._rings.get(t),n=e.getCoordinates(),i=this._index.query(e.getEnvelopeInternal()),r=0;r<i.size();r++){var s=i.get(r),o=s.getCoordinates();if(e!==s&&e.getEnvelopeInternal().intersects(s.getEnvelopeInternal())){var a=eo.findPtNotNode(n,s,this._graph);if(null!==a&&qe.isInRing(a,o))return this._nestedPt=a,!1}}return!0},add:function(t){this._rings.add(t),this._totalEnv.expandToInclude(t.getEnvelopeInternal())},interfaces_:function(){return[]},getClass:function(){return $s}}),e(to.prototype,{getErrorType:function(){return this._errorType},getMessage:function(){return to.errMsg[this._errorType]},getCoordinate:function(){return this._pt},toString:function(){var t="";return null!==this._pt&&(t=" at or near point "+this._pt),this.getMessage()+t},interfaces_:function(){return[]},getClass:function(){return to}}),to.ERROR=0,to.REPEATED_POINT=1,to.HOLE_OUTSIDE_SHELL=2,to.NESTED_HOLES=3,to.DISCONNECTED_INTERIOR=4,to.SELF_INTERSECTION=5,to.RING_SELF_INTERSECTION=6,to.NESTED_SHELLS=7,to.DUPLICATE_RINGS=8,to.TOO_FEW_POINTS=9,to.INVALID_COORDINATE=10,to.RING_NOT_CLOSED=11,to.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"],e(eo.prototype,{checkInvalidCoordinates:function(){if(arguments[0]instanceof Array){for(var t=arguments[0],e=0;e<t.length;e++)if(!eo.isValid(t[e]))return this._validErr=new to(to.INVALID_COORDINATE,t[e]),null}else if(arguments[0]instanceof Vt){var n=arguments[0];if(this.checkInvalidCoordinates(n.getExteriorRing().getCoordinates()),null!==this._validErr)return null;for(e=0;e<n.getNumInteriorRing();e++)if(this.checkInvalidCoordinates(n.getInteriorRingN(e).getCoordinates()),null!==this._validErr)return null}},checkHolesNotNested:function(t,e){for(var n=new $s(e),i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);n.add(r)}n.isNonNested()||(this._validErr=new to(to.NESTED_HOLES,n.getNestedPoint()))},checkConsistentArea:function(t){var e=new Ks(t);if(!e.isNodeConsistentArea())return this._validErr=new to(to.SELF_INTERSECTION,e.getInvalidPoint()),null;e.hasDuplicateRings()&&(this._validErr=new to(to.DUPLICATE_RINGS,e.getInvalidPoint()))},isValid:function(){return this.checkValid(this._parentGeometry),null===this._validErr},checkShellInsideHole:function(t,e,n){var i=t.getCoordinates(),r=e.getCoordinates(),s=eo.findPtNotNode(i,e,n);if(null!==s&&!qe.isInRing(s,r))return s;var o=eo.findPtNotNode(r,t,n);return null!==o?qe.isInRing(o,i)?o:null:(b.shouldNeverReachHere("points in shell and hole appear to be equal"),null)},checkNoSelfIntersectingRings:function(t){for(var e=t.getEdgeIterator();e.hasNext();){var n=e.next();if(this.checkNoSelfIntersectingRing(n.getEdgeIntersectionList()),null!==this._validErr)return null}},checkConnectedInteriors:function(t){var e=new Zs(t);e.isInteriorsConnected()||(this._validErr=new to(to.DISCONNECTED_INTERIOR,e.getCoordinate()))},checkNoSelfIntersectingRing:function(t){for(var e=new yt,n=!0,i=t.iterator();i.hasNext();){var r=i.next();if(n)n=!1;else{if(e.contains(r.coord))return this._validErr=new to(to.RING_SELF_INTERSECTION,r.coord),null;e.add(r.coord)}}},checkHolesInShell:function(t,e){for(var n=t.getExteriorRing(),i=new Ge(n),r=0;r<t.getNumInteriorRing();r++){var s=t.getInteriorRingN(r),o=eo.findPtNotNode(s.getCoordinates(),n,e);if(null===o)return null;if(_e.EXTERIOR===i.locate(o))return this._validErr=new to(to.HOLE_OUTSIDE_SHELL,o),null}},checkTooFewPoints:function(t){if(t.hasTooFewPoints())return this._validErr=new to(to.TOO_FEW_POINTS,t.getInvalidPoint()),null},getValidationError:function(){return this.checkValid(this._parentGeometry),this._validErr},checkValid:function(){if(arguments[0]instanceof Bt){var t=arguments[0];this.checkInvalidCoordinates(t.getCoordinates())}else if(arguments[0]instanceof Ut){var e=arguments[0];this.checkInvalidCoordinates(e.getCoordinates())}else if(arguments[0]instanceof Wt){var n=arguments[0];if(this.checkInvalidCoordinates(n.getCoordinates()),null!==this._validErr)return null;if(this.checkClosedRing(n),null!==this._validErr)return null;var i=new li(0,n);if(this.checkTooFewPoints(i),null!==this._validErr)return null;var r=new ge;i.computeSelfNodes(r,!0,!0),this.checkNoSelfIntersectingRings(i)}else if(arguments[0]instanceof kt){var s=arguments[0];if(this.checkInvalidCoordinates(s.getCoordinates()),null!==this._validErr)return null;i=new li(0,s),this.checkTooFewPoints(i)}else if(arguments[0]instanceof Vt){var o=arguments[0];if(this.checkInvalidCoordinates(o),null!==this._validErr)return null;if(this.checkClosedRings(o),null!==this._validErr)return null;if(i=new li(0,o),this.checkTooFewPoints(i),null!==this._validErr)return null;if(this.checkConsistentArea(i),null!==this._validErr)return null;if(!this._isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this._validErr))return null;if(this.checkHolesInShell(o,i),null!==this._validErr)return null;if(this.checkHolesNotNested(o,i),null!==this._validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof Yt){for(var a=arguments[0],l=0;l<a.getNumGeometries();l++){var u=a.getGeometryN(l);if(this.checkInvalidCoordinates(u),null!==this._validErr)return null;if(this.checkClosedRings(u),null!==this._validErr)return null}if(i=new li(0,a),this.checkTooFewPoints(i),null!==this._validErr)return null;if(this.checkConsistentArea(i),null!==this._validErr)return null;if(!this._isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this._validErr))return null;for(l=0;l<a.getNumGeometries();l++)if(u=a.getGeometryN(l),this.checkHolesInShell(u,i),null!==this._validErr)return null;for(l=0;l<a.getNumGeometries();l++)if(u=a.getGeometryN(l),this.checkHolesNotNested(u,i),null!==this._validErr)return null;if(this.checkShellsNotNested(a,i),null!==this._validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof Ot){var c=arguments[0];for(l=0;l<c.getNumGeometries();l++){var h=c.getGeometryN(l);if(this.checkValid(h),null!==this._validErr)return null}}else if(arguments[0]instanceof X){var d=arguments[0];if(this._validErr=null,d.isEmpty())return null;if(d instanceof Bt)this.checkValid(d);else if(d instanceof Ut)this.checkValid(d);else if(d instanceof Wt)this.checkValid(d);else if(d instanceof kt)this.checkValid(d);else if(d instanceof Vt)this.checkValid(d);else if(d instanceof Yt)this.checkValid(d);else{if(!(d instanceof Ot))throw new UnsupportedOperationException(d.getClass().getName());this.checkValid(d)}}},setSelfTouchingRingFormingHoleValid:function(t){this._isSelfTouchingRingFormingHoleValid=t},checkShellNotNested:function(t,e,n){var i=t.getCoordinates(),r=e.getExteriorRing(),s=r.getCoordinates(),o=eo.findPtNotNode(i,r,n);if(null===o)return null;if(!qe.isInRing(o,s))return null;if(e.getNumInteriorRing()<=0)return this._validErr=new to(to.NESTED_SHELLS,o),null;for(var a=null,l=0;l<e.getNumInteriorRing();l++){var u=e.getInteriorRingN(l);if(null===(a=this.checkShellInsideHole(t,u,n)))return null}this._validErr=new to(to.NESTED_SHELLS,a)},checkClosedRings:function(t){if(this.checkClosedRing(t.getExteriorRing()),null!==this._validErr)return null;for(var e=0;e<t.getNumInteriorRing();e++)if(this.checkClosedRing(t.getInteriorRingN(e)),null!==this._validErr)return null},checkClosedRing:function(t){if(!t.isClosed()){var e=null;1<=t.getNumPoints()&&(e=t.getCoordinateN(0)),this._validErr=new to(to.RING_NOT_CLOSED,e)}},checkShellsNotNested:function(t,e){for(var n=0;n<t.getNumGeometries();n++)for(var i=t.getGeometryN(n).getExteriorRing(),r=0;r<t.getNumGeometries();r++)if(n!==r){var s=t.getGeometryN(r);if(this.checkShellNotNested(i,s,e),null!==this._validErr)return null}},interfaces_:function(){return[]},getClass:function(){return eo}}),eo.findPtNotNode=function(t,e,n){for(var i=n.findEdge(e).getEdgeIntersectionList(),r=0;r<t.length;r++){var s=t[r];if(!i.isIntersection(s))return s}return null},eo.isValid=function(){if(arguments[0]instanceof X)return new eo(arguments[0]).isValid();if(arguments[0]instanceof x){var t=arguments[0];return!(s.isNaN(t.x)||s.isInfinite(t.x)||s.isNaN(t.y)||s.isInfinite(t.y))}};var no=Object.freeze({IsValidOp:eo,ConsistentAreaTester:Ks}),io=Object.freeze({BoundaryOp:wt,IsSimpleOp:rr,buffer:Dr,distance:qr,linemerge:es,overlay:bs,polygonize:Ls,relate:Vs,union:Xs,valid:no});function ro(){Ht.CoordinateOperation.apply(this),this._targetPM=null,this._removeCollapsed=!0;var t=arguments[0],e=arguments[1];this._targetPM=t,this._removeCollapsed=e}function so(){this._targetPM=null,this._removeCollapsed=!0,this._changePrecisionModel=!1,this._isPointwise=!1;var t=arguments[0];this._targetPM=t}y(ro,Ht.CoordinateOperation),e(ro.prototype,{edit:function(){if(2===arguments.length&&arguments[1]instanceof X&&arguments[0]instanceof Array){var t=arguments[0],e=arguments[1];if(0===t.length)return null;for(var n=new Array(t.length).fill(null),i=0;i<t.length;i++){var r=new x(t[i]);this._targetPM.makePrecise(r),n[i]=r}var s=new M(n,!1).toCoordinateArray(),o=0;e instanceof kt&&(o=2),e instanceof Wt&&(o=4);var a=n;return this._removeCollapsed&&(a=null),s.length<o?a:s}return Ht.CoordinateOperation.prototype.edit.apply(this,arguments)},interfaces_:function(){return[]},getClass:function(){return ro}}),e(so.prototype,{fixPolygonalTopology:function(t){var e=t;this._changePrecisionModel||(e=this.changePM(t,this._targetPM));var n=Rr.bufferOp(e,0),i=n;return this._changePrecisionModel||(i=n.copy(),this.changePM(i,t.getPrecisionModel())),i},reducePointwise:function(t){var e=null;e=this._changePrecisionModel?new Ht(this.createFactory(t.getFactory(),this._targetPM)):new Ht;var n=this._removeCollapsed;return 2<=t.getDimension()&&(n=!0),e.edit(t,new ro(this._targetPM,n))},changePM:function(t,e){return this.createEditor(t.getFactory(),e).edit(t,new Ht.NoOpGeometryOperation)},setRemoveCollapsedComponents:function(t){this._removeCollapsed=t},createFactory:function(t,e){return new le(e,t.getSRID(),t.getCoordinateSequenceFactory())},setChangePrecisionModel:function(t){this._changePrecisionModel=t},reduce:function(t){var e=this.reducePointwise(t);return this._isPointwise?e:S(e,qt)?eo.isValid(e)?e:this.fixPolygonalTopology(e):e},setPointwise:function(t){this._isPointwise=t},createEditor:function(t,e){return t.getPrecisionModel()===e?new Ht:new Ht(this.createFactory(t,e))},interfaces_:function(){return[]},getClass:function(){return so}}),so.reduce=function(t,e){return new so(e).reduce(t)},so.reducePointwise=function(t,e){var n=new so(e);return n.setPointwise(!0),n.reduce(t)};var oo=Object.freeze({GeometryPrecisionReducer:so});function ao(){this._pts=null,this._usePt=null,this._distanceTolerance=null,this._seg=new me;var t=arguments[0];this._pts=t}function lo(){this._inputGeom=null,this._distanceTolerance=null,this._isEnsureValidTopology=!0;var t=arguments[0];this._inputGeom=t}function uo(){Ln.apply(this),this._isEnsureValidTopology=!0,this._distanceTolerance=null;var t=arguments[0],e=arguments[1];this._isEnsureValidTopology=t,this._distanceTolerance=e}function co(){if(this._parent=null,this._index=null,2===arguments.length){var t=arguments[0],e=arguments[1];co.call(this,t,e,null,-1)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],s=arguments[3];me.call(this,n,i),this._parent=r,this._index=s}}function ho(){if(this._parentLine=null,this._segs=null,this._resultSegs=new j,this._minimumSize=null,1===arguments.length){var t=arguments[0];ho.call(this,t,2)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._parentLine=e,this._minimumSize=n,this.init()}}function po(){this._index=new bi}function fo(){this._querySeg=null,this._items=new j;var t=arguments[0];this._querySeg=t}function go(){this._li=new ge,this._inputIndex=new po,this._outputIndex=new po,this._line=null,this._linePts=null;var t=arguments[this._distanceTolerance=0],e=arguments[1];this._inputIndex=t,this._outputIndex=e}function mo(){this._inputIndex=new po,this._outputIndex=new po,this._distanceTolerance=0}function _o(){this._inputGeom=null,this._lineSimplifier=new mo,this._linestringMap=null;var t=arguments[0];this._inputGeom=t}function yo(){Ln.apply(this),this._linestringMap=null;var t=arguments[0];this._linestringMap=t}function vo(){this.tps=null;var t=arguments[0];this.tps=t}e(ao.prototype,{simplifySection:function(t,e){if(t+1===e)return null;this._seg.p0=this._pts[t],this._seg.p1=this._pts[e];for(var n=-1,i=t,r=t+1;r<e;r++){var s=this._seg.distance(this._pts[r]);n<s&&(n=s,i=r)}if(n<=this._distanceTolerance)for(r=t+1;r<e;r++)this._usePt[r]=!1;else this.simplifySection(t,i),this.simplifySection(i,e)},setDistanceTolerance:function(t){this._distanceTolerance=t},simplify:function(){this._usePt=new Array(this._pts.length).fill(null);for(var t=0;t<this._pts.length;t++)this._usePt[t]=!0;this.simplifySection(0,this._pts.length-1);var e=new M;for(t=0;t<this._pts.length;t++)this._usePt[t]&&e.add(new x(this._pts[t]));return e.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return ao}}),ao.simplify=function(t,e){var n=new ao(t);return n.setDistanceTolerance(e),n.simplify()},e(lo.prototype,{setEnsureValid:function(t){this._isEnsureValidTopology=t},getResultGeometry:function(){return this._inputGeom.isEmpty()?this._inputGeom.copy():new uo(this._isEnsureValidTopology,this._distanceTolerance).transform(this._inputGeom)},setDistanceTolerance:function(t){if(t<0)throw new i("Tolerance must be non-negative");this._distanceTolerance=t},interfaces_:function(){return[]},getClass:function(){return lo}}),lo.simplify=function(t,e){var n=new lo(t);return n.setDistanceTolerance(e),n.getResultGeometry()},y(uo,Ln),e(uo.prototype,{transformPolygon:function(t,e){if(t.isEmpty())return null;var n=Ln.prototype.transformPolygon.call(this,t,e);return e instanceof Yt?n:this.createValidArea(n)},createValidArea:function(t){return this._isEnsureValidTopology?t.buffer(0):t},transformCoordinates:function(t,e){var n,i=t.toCoordinateArray();return n=0===i.length?new Array(0).fill(null):ao.simplify(i,this._distanceTolerance),this._factory.getCoordinateSequenceFactory().create(n)},transformMultiPolygon:function(t,e){var n=Ln.prototype.transformMultiPolygon.call(this,t,e);return this.createValidArea(n)},transformLinearRing:function(t,e){var n=e instanceof Vt,i=Ln.prototype.transformLinearRing.call(this,t,e);return!n||i instanceof Wt?i:null},interfaces_:function(){return[]},getClass:function(){return uo}}),lo.DPTransformer=uo,y(co,me),e(co.prototype,{getIndex:function(){return this._index},getParent:function(){return this._parent},interfaces_:function(){return[]},getClass:function(){return co}}),e(ho.prototype,{addToResult:function(t){this._resultSegs.add(t)},asLineString:function(){return this._parentLine.getFactory().createLineString(ho.extractCoordinates(this._resultSegs))},getResultSize:function(){var t=this._resultSegs.size();return 0===t?0:t+1},getParent:function(){return this._parentLine},getSegment:function(t){return this._segs[t]},getParentCoordinates:function(){return this._parentLine.getCoordinates()},getMinimumSize:function(){return this._minimumSize},asLinearRing:function(){return this._parentLine.getFactory().createLinearRing(ho.extractCoordinates(this._resultSegs))},getSegments:function(){return this._segs},init:function(){var t=this._parentLine.getCoordinates();this._segs=new Array(t.length-1).fill(null);for(var e=0;e<t.length-1;e++){var n=new co(t[e],t[e+1],this._parentLine,e);this._segs[e]=n}},getResultCoordinates:function(){return ho.extractCoordinates(this._resultSegs)},interfaces_:function(){return[]},getClass:function(){return ho}}),ho.extractCoordinates=function(t){for(var e=new Array(t.size()+1).fill(null),n=null,i=0;i<t.size();i++)n=t.get(i),e[i]=n.p0;return e[e.length-1]=n.p1,e},e(po.prototype,{remove:function(t){this._index.remove(new F(t.p0,t.p1),t)},add:function(){if(arguments[0]instanceof ho)for(var t=arguments[0].getSegments(),e=0;e<t.length;e++){var n=t[e];this.add(n)}else if(arguments[0]instanceof me){var i=arguments[0];this._index.insert(new F(i.p0,i.p1),i)}},query:function(t){var e=new F(t.p0,t.p1),n=new fo(t);return this._index.query(e,n),n.getItems()},interfaces_:function(){return[]},getClass:function(){return po}}),e(fo.prototype,{visitItem:function(t){var e=t;F.intersects(e.p0,e.p1,this._querySeg.p0,this._querySeg.p1)&&this._items.add(t)},getItems:function(){return this._items},interfaces_:function(){return[Le]},getClass:function(){return fo}}),e(go.prototype,{flatten:function(t,e){var n=new me(this._linePts[t],this._linePts[e]);return this.remove(this._line,t,e),this._outputIndex.add(n),n},hasBadIntersection:function(t,e,n){return!!this.hasBadOutputIntersection(n)||!!this.hasBadInputIntersection(t,e,n)},setDistanceTolerance:function(t){this._distanceTolerance=t},simplifySection:function(t,e,n){n+=1;var i=new Array(2).fill(null);if(t+1===e){var r=this._line.getSegment(t);return this._line.addToResult(r),null}var s=!0;this._line.getResultSize()<this._line.getMinimumSize()&&n+1<this._line.getMinimumSize()&&(s=!1);var o=new Array(1).fill(null),a=this.findFurthestPoint(this._linePts,t,e,o);o[0]>this._distanceTolerance&&(s=!1);var l=new me;if(l.p0=this._linePts[t],l.p1=this._linePts[e],i[0]=t,i[1]=e,this.hasBadIntersection(this._line,i,l)&&(s=!1),s)return r=this.flatten(t,e),this._line.addToResult(r),null;this.simplifySection(t,a,n),this.simplifySection(a,e,n)},hasBadOutputIntersection:function(t){for(var e=this._outputIndex.query(t).iterator();e.hasNext();){var n=e.next();if(this.hasInteriorIntersection(n,t))return!0}return!1},findFurthestPoint:function(t,e,n,i){var r=new me;r.p0=t[e],r.p1=t[n];for(var s=-1,o=e,a=e+1;a<n;a++){var l=t[a],u=r.distance(l);s<u&&(s=u,o=a)}return i[0]=s,o},simplify:function(t){this._line=t,this._linePts=t.getParentCoordinates(),this.simplifySection(0,this._linePts.length-1,0)},remove:function(t,e,n){for(var i=e;i<n;i++){var r=t.getSegment(i);this._inputIndex.remove(r)}},hasInteriorIntersection:function(t,e){return this._li.computeIntersection(t.p0,t.p1,e.p0,e.p1),this._li.isInteriorIntersection()},hasBadInputIntersection:function(t,e,n){for(var i=this._inputIndex.query(n).iterator();i.hasNext();){var r=i.next();if(this.hasInteriorIntersection(r,n)){if(go.isInLineSection(t,e,r))continue;return!0}}return!1},interfaces_:function(){return[]},getClass:function(){return go}}),go.isInLineSection=function(t,e,n){if(n.getParent()!==t.getParent())return!1;var i=n.getIndex();return i>=e[0]&&i<e[1]},e(mo.prototype,{setDistanceTolerance:function(t){this._distanceTolerance=t},simplify:function(t){for(var e=t.iterator();e.hasNext();)this._inputIndex.add(e.next());for(e=t.iterator();e.hasNext();){var n=new go(this._inputIndex,this._outputIndex);n.setDistanceTolerance(this._distanceTolerance),n.simplify(e.next())}},interfaces_:function(){return[]},getClass:function(){return mo}}),e(_o.prototype,{getResultGeometry:function(){return this._inputGeom.isEmpty()?this._inputGeom.copy():(this._linestringMap=new se,this._inputGeom.apply(new vo(this)),this._lineSimplifier.simplify(this._linestringMap.values()),new yo(this._linestringMap).transform(this._inputGeom))},setDistanceTolerance:function(t){if(t<0)throw new i("Tolerance must be non-negative");this._lineSimplifier.setDistanceTolerance(t)},interfaces_:function(){return[]},getClass:function(){return _o}}),_o.simplify=function(t,e){var n=new _o(t);return n.setDistanceTolerance(e),n.getResultGeometry()},y(yo,Ln),e(yo.prototype,{transformCoordinates:function(t,e){if(0===t.size())return null;if(e instanceof kt){var n=this._linestringMap.get(e);return this.createCoordinateSequence(n.getResultCoordinates())}return Ln.prototype.transformCoordinates.call(this,t,e)},interfaces_:function(){return[]},getClass:function(){return yo}}),e(vo.prototype,{filter:function(t){if(t instanceof kt){var e=t;if(e.isEmpty())return null;var n=new ho(e,e.isClosed()?4:2);this.tps._linestringMap.put(e,n)}},interfaces_:function(){return[J]},getClass:function(){return vo}}),_o.LineStringTransformer=yo,_o.LineStringMapBuilderFilter=vo;var bo=Object.freeze({DouglasPeuckerSimplifier:lo,TopologyPreservingSimplifier:_o});function xo(){this._seg=null,this._segLen=null,this._splitPt=null;var t=arguments[this._minimumLen=0];this._seg=t,this._segLen=t.getLength()}function Eo(){}function So(){}function Co(){}function Oo(){if(this._p=null,1===arguments.length){var t=arguments[0];this._p=new x(t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this._p=new x(e,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this._p=new x(i,r,s)}}function Io(){this._isOnConstraint=null,this._constraint=null;var t=arguments[0];Oo.call(this,t)}function wo(){this._rot=null,this._vertex=null,this._next=null,this._data=null}function Lo(){this._subdiv=null,this._isUsingTolerance=!1;var t=arguments[0];this._subdiv=t,this._isUsingTolerance=0<t.getTolerance()}function To(){}function jo(){this._subdiv=null,this._lastEdge=null;var t=arguments[0];this._subdiv=t,this.init()}function No(){if(this._seg=null,1===arguments.length){if("string"==typeof arguments[0]){var t=arguments[0];_.call(this,t)}else if(arguments[0]instanceof me){var e=arguments[0];_.call(this,"Locate failed to converge (at edge: "+e+").  Possible causes include invalid Subdivision topology or very close sites"),this._seg=new me(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];_.call(this,No.msgWithSpatial(n,i)),this._seg=new me(i)}}function Mo(){}function Fo(){this._visitedKey=0,this._quadEdges=new j,this._startingEdge=null,this._tolerance=null,this._edgeCoincidenceTolerance=null,this._frameVertex=new Array(3).fill(null),this._frameEnv=null,this._locator=null,this._seg=new me,this._triEdges=new Array(3).fill(null);var t=arguments[0],e=arguments[1];this._tolerance=e,this._edgeCoincidenceTolerance=e/Fo.EDGE_COINCIDENCE_TOL_FACTOR,this.createFrame(t),this._startingEdge=this.initSubdiv(),this._locator=new jo(this)}function Po(){}function Ro(){this._triList=new j}function Do(){this._triList=new j}function Ao(){this._coordList=new M,this._triCoords=new j}function ko(){if(this._ls=null,this._data=null,2===arguments.length){var t=arguments[0],e=arguments[1];this._ls=new me(t,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this._ls=new me(n,i),this._data=r}else if(6===arguments.length){var s=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3],u=arguments[4],c=arguments[5];ko.call(this,new x(s,o,a),new x(l,u,c))}else if(7===arguments.length){var h=arguments[0],d=arguments[1],p=arguments[2],f=arguments[3],g=arguments[4],m=arguments[5],_=arguments[6];ko.call(this,new x(h,d,p),new x(f,g,m),_)}}function Go(){this._initialVertices=null,this._segVertices=null,this._segments=new j,this._subdiv=null,this._incDel=null,this._convexHull=null,this._splitFinder=new So,this._kdt=null,this._vertexFactory=null,this._computeAreaEnv=null,this._splitPt=null,this._tolerance=null;var t=arguments[0],e=arguments[1];this._initialVertices=new j(t),this._tolerance=e,this._kdt=new di(e)}function Bo(){this._siteCoords=null,this._tolerance=0,this._subdiv=null}function zo(){this._siteCoords=null,this._constraintLines=null,this._tolerance=0,this._subdiv=null,this._constraintVertexMap=new gt}function qo(){this._siteCoords=null,this._tolerance=0,this._subdiv=null,this._clipEnv=null,this._diagramEnv=null}e(xo.prototype,{splitAt:function(){if(1===arguments.length){var t=arguments[0],e=this._minimumLen/this._segLen;if(t.distance(this._seg.p0)<this._minimumLen)return this._splitPt=this._seg.pointAlong(e),null;if(t.distance(this._seg.p1)<this._minimumLen)return this._splitPt=xo.pointAlongReverse(this._seg,e),null;this._splitPt=t}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=this.getConstrainedLength(n)/this._segLen;i.equals2D(this._seg.p0)?this._splitPt=this._seg.pointAlong(r):this._splitPt=xo.pointAlongReverse(this._seg,r)}},setMinimumLength:function(t){this._minimumLen=t},getConstrainedLength:function(t){return t<this._minimumLen?this._minimumLen:t},getSplitPoint:function(){return this._splitPt},interfaces_:function(){return[]},getClass:function(){return xo}}),xo.pointAlongReverse=function(t,e){var n=new x;return n.x=t.p1.x-e*(t.p1.x-t.p0.x),n.y=t.p1.y-e*(t.p1.y-t.p0.y),n},e(Eo.prototype,{findSplitPoint:function(t,e){},interfaces_:function(){return[]},getClass:function(){return Eo}}),e(So.prototype,{findSplitPoint:function(t,e){var n=t.getLineSegment(),i=n.getLength()/2,r=new xo(n),s=So.projectedSplitPoint(t,e),o=2*s.distance(e)*.8;return i<o&&(o=i),r.setMinimumLength(o),r.splitAt(s),r.getSplitPoint()},interfaces_:function(){return[Eo]},getClass:function(){return So}}),So.projectedSplitPoint=function(t,e){return t.getLineSegment().project(e)},e(Co.prototype,{interfaces_:function(){return[]},getClass:function(){return Co}}),Co.triArea=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)},Co.isInCircleDDNormalized=function(t,e,n,i){var r=G.valueOf(t.x).selfSubtract(i.x),s=G.valueOf(t.y).selfSubtract(i.y),o=G.valueOf(e.x).selfSubtract(i.x),a=G.valueOf(e.y).selfSubtract(i.y),l=G.valueOf(n.x).selfSubtract(i.x),u=G.valueOf(n.y).selfSubtract(i.y),c=r.multiply(a).selfSubtract(o.multiply(s)),h=o.multiply(u).selfSubtract(l.multiply(a)),d=l.multiply(s).selfSubtract(r.multiply(u)),p=r.multiply(r).selfAdd(s.multiply(s)),f=o.multiply(o).selfAdd(a.multiply(a)),g=l.multiply(l).selfAdd(u.multiply(u));return 0<p.selfMultiply(h).selfAdd(f.selfMultiply(d)).selfAdd(g.selfMultiply(c)).doubleValue()},Co.checkRobustInCircle=function(t,e,n,i){var r=Co.isInCircleNonRobust(t,e,n,i),s=Co.isInCircleDDSlow(t,e,n,i),o=Co.isInCircleCC(t,e,n,i),a=be.circumcentre(t,e,n);q.out.println("p radius diff a = "+Math.abs(i.distance(a)-t.distance(a))/t.distance(a)),r===s&&r===o||(q.out.println("inCircle robustness failure (double result = "+r+", DD result = "+s+", CC result = "+o+")"),q.out.println(pe.toLineString(new Kt([t,e,n,i]))),q.out.println("Circumcentre = "+pe.toPoint(a)+" radius = "+t.distance(a)),q.out.println("p radius diff a = "+Math.abs(i.distance(a)/t.distance(a)-1)),q.out.println("p radius diff b = "+Math.abs(i.distance(a)/e.distance(a)-1)),q.out.println("p radius diff c = "+Math.abs(i.distance(a)/n.distance(a)-1)),q.out.println())},Co.isInCircleDDFast=function(t,e,n,i){var r=G.sqr(t.x).selfAdd(G.sqr(t.y)).selfMultiply(Co.triAreaDDFast(e,n,i)),s=G.sqr(e.x).selfAdd(G.sqr(e.y)).selfMultiply(Co.triAreaDDFast(t,n,i)),o=G.sqr(n.x).selfAdd(G.sqr(n.y)).selfMultiply(Co.triAreaDDFast(t,e,i)),a=G.sqr(i.x).selfAdd(G.sqr(i.y)).selfMultiply(Co.triAreaDDFast(t,e,n));return 0<r.selfSubtract(s).selfAdd(o).selfSubtract(a).doubleValue()},Co.isInCircleCC=function(t,e,n,i){var r=be.circumcentre(t,e,n),s=t.distance(r);return i.distance(r)-s<=0},Co.isInCircleNormalized=function(t,e,n,i){var r=t.x-i.x,s=t.y-i.y,o=e.x-i.x,a=e.y-i.y,l=n.x-i.x,u=n.y-i.y;return 0<(r*r+s*s)*(o*u-l*a)+(o*o+a*a)*(l*s-r*u)+(l*l+u*u)*(r*a-o*s)},Co.isInCircleDDSlow=function(t,e,n,i){var r=G.valueOf(i.x),s=G.valueOf(i.y),o=G.valueOf(t.x),a=G.valueOf(t.y),l=G.valueOf(e.x),u=G.valueOf(e.y),c=G.valueOf(n.x),h=G.valueOf(n.y),d=o.multiply(o).add(a.multiply(a)).multiply(Co.triAreaDDSlow(l,u,c,h,r,s)),p=l.multiply(l).add(u.multiply(u)).multiply(Co.triAreaDDSlow(o,a,c,h,r,s)),f=c.multiply(c).add(h.multiply(h)).multiply(Co.triAreaDDSlow(o,a,l,u,r,s)),g=r.multiply(r).add(s.multiply(s)).multiply(Co.triAreaDDSlow(o,a,l,u,c,h));return 0<d.subtract(p).add(f).subtract(g).doubleValue()},Co.isInCircleNonRobust=function(t,e,n,i){return 0<(t.x*t.x+t.y*t.y)*Co.triArea(e,n,i)-(e.x*e.x+e.y*e.y)*Co.triArea(t,n,i)+(n.x*n.x+n.y*n.y)*Co.triArea(t,e,i)-(i.x*i.x+i.y*i.y)*Co.triArea(t,e,n)},Co.isInCircleRobust=function(t,e,n,i){return Co.isInCircleNormalized(t,e,n,i)},Co.triAreaDDSlow=function(t,e,n,i,r,s){return n.subtract(t).multiply(s.subtract(e)).subtract(i.subtract(e).multiply(r.subtract(t)))},Co.triAreaDDFast=function(t,e,n){var i=G.valueOf(e.x).selfSubtract(t.x).selfMultiply(G.valueOf(n.y).selfSubtract(t.y)),r=G.valueOf(e.y).selfSubtract(t.y).selfMultiply(G.valueOf(n.x).selfSubtract(t.x));return i.selfSubtract(r)},e(Oo.prototype,{circleCenter:function(t,e){var n=new Oo(this.getX(),this.getY()),i=new V(this.bisector(n,t),this.bisector(t,e)),r=null;try{r=new Oo(i.getX(),i.getY())}catch(i){if(!(i instanceof R))throw i;q.err.println("a: "+n+"  b: "+t+"  c: "+e),q.err.println(i)}return r},dot:function(t){return this._p.x*t.getX()+this._p.y*t.getY()},magn:function(){return Math.sqrt(this._p.x*this._p.x+this._p.y*this._p.y)},getZ:function(){return this._p.z},bisector:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return new V(new V(t.getX()+n/2,t.getY()+i/2,1),new V(t.getX()-i+n/2,t.getY()+n+i/2,1))},equals:function(){if(1===arguments.length){var t=arguments[0];return this._p.x===t.getX()&&this._p.y===t.getY()}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this._p.distance(e.getCoordinate())<n}},getCoordinate:function(){return this._p},isInCircle:function(t,e,n){return Co.isInCircleRobust(t._p,e._p,n._p,this._p)},interpolateZValue:function(t,e,n){var i=t.getX(),r=t.getY(),s=e.getX()-i,o=n.getX()-i,a=e.getY()-r,l=n.getY()-r,u=s*l-o*a,c=this.getX()-i,h=this.getY()-r,d=(l*c-o*h)/u,p=(-a*c+s*h)/u;return t.getZ()+d*(e.getZ()-t.getZ())+p*(n.getZ()-t.getZ())},midPoint:function(t){return new Oo((this._p.x+t.getX())/2,(this._p.y+t.getY())/2,(this._p.z+t.getZ())/2)},rightOf:function(t){return this.isCCW(t.dest(),t.orig())},isCCW:function(t,e){return 0<(t._p.x-this._p.x)*(e._p.y-this._p.y)-(t._p.y-this._p.y)*(e._p.x-this._p.x)},getX:function(){return this._p.x},crossProduct:function(t){return this._p.x*t.getY()-this._p.y*t.getX()},setZ:function(t){this._p.z=t},times:function(t){return new Oo(t*this._p.x,t*this._p.y)},cross:function(){return new Oo(this._p.y,-this._p.x)},leftOf:function(t){return this.isCCW(t.orig(),t.dest())},toString:function(){return"POINT ("+this._p.x+" "+this._p.y+")"},sub:function(t){return new Oo(this._p.x-t.getX(),this._p.y-t.getY())},getY:function(){return this._p.y},classify:function(t,e){var n=e.sub(t),i=this.sub(t),r=n.crossProduct(i);return 0<r?Oo.LEFT:r<0?Oo.RIGHT:n.getX()*i.getX()<0||n.getY()*i.getY()<0?Oo.BEHIND:n.magn()<i.magn()?Oo.BEYOND:t.equals(this)?Oo.ORIGIN:e.equals(this)?Oo.DESTINATION:Oo.BETWEEN},sum:function(t){return new Oo(this._p.x+t.getX(),this._p.y+t.getY())},distance:function(t,e){return Math.sqrt(Math.pow(e.getX()-t.getX(),2)+Math.pow(e.getY()-t.getY(),2))},circumRadiusRatio:function(t,e){var n=this.circleCenter(t,e),i=this.distance(n,t),r=this.distance(this,t),s=this.distance(t,e);return s<r&&(r=s),(s=this.distance(e,this))<r&&(r=s),i/r},interfaces_:function(){return[]},getClass:function(){return Oo}}),Oo.interpolateZ=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=e.distance(n),r=t.distance(e),s=n.z-e.z;return e.z+s*(r/i)}if(4===arguments.length){var o=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3],c=a.x,h=a.y,d=l.x-c,p=u.x-c,f=l.y-h,g=u.y-h,m=d*g-p*f,_=o.x-c,y=o.y-h,v=(g*_-p*y)/m,b=(-f*_+d*y)/m;return a.z+v*(l.z-a.z)+b*(u.z-a.z)}},Oo.LEFT=0,Oo.RIGHT=1,Oo.BEYOND=2,Oo.BEHIND=3,Oo.BETWEEN=4,Oo.ORIGIN=5,Oo.DESTINATION=6,y(Io,Oo),e(Io.prototype,{getConstraint:function(){return this._constraint},setOnConstraint:function(t){this._isOnConstraint=t},merge:function(t){t._isOnConstraint&&(this._isOnConstraint=!0,this._constraint=t._constraint)},isOnConstraint:function(){return this._isOnConstraint},setConstraint:function(t){this._isOnConstraint=!0,this._constraint=t},interfaces_:function(){return[]},getClass:function(){return Io}}),e(wo.prototype,{equalsNonOriented:function(t){return!!this.equalsOriented(t)||!!this.equalsOriented(t.sym())},toLineSegment:function(){return new me(this._vertex.getCoordinate(),this.dest().getCoordinate())},dest:function(){return this.sym().orig()},oNext:function(){return this._next},equalsOriented:function(t){return!(!this.orig().getCoordinate().equals2D(t.orig().getCoordinate())||!this.dest().getCoordinate().equals2D(t.dest().getCoordinate()))},dNext:function(){return this.sym().oNext().sym()},lPrev:function(){return this._next.sym()},rPrev:function(){return this.sym().oNext()},rot:function(){return this._rot},oPrev:function(){return this._rot._next._rot},sym:function(){return this._rot._rot},setOrig:function(t){this._vertex=t},lNext:function(){return this.invRot().oNext().rot()},getLength:function(){return this.orig().getCoordinate().distance(this.dest().getCoordinate())},invRot:function(){return this._rot.sym()},setDest:function(t){this.sym().setOrig(t)},setData:function(t){this._data=t},getData:function(){return this._data},delete:function(){this._rot=null},orig:function(){return this._vertex},rNext:function(){return this._rot._next.invRot()},toString:function(){var t=this._vertex.getCoordinate(),e=this.dest().getCoordinate();return pe.toLineString(t,e)},isLive:function(){return null!==this._rot},getPrimary:function(){return this.orig().getCoordinate().compareTo(this.dest().getCoordinate())<=0?this:this.sym()},dPrev:function(){return this.invRot().oNext().invRot()},setNext:function(t){this._next=t},interfaces_:function(){return[]},getClass:function(){return wo}}),wo.makeEdge=function(t,e){var n=new wo,i=new wo,r=new wo,s=new wo;((((n._rot=i)._rot=r)._rot=s)._rot=n).setNext(n),i.setNext(s),r.setNext(r),s.setNext(i);var o=n;return o.setOrig(t),o.setDest(e),o},wo.swap=function(t){var e=t.oPrev(),n=t.sym().oPrev();wo.splice(t,e),wo.splice(t.sym(),n),wo.splice(t,e.lNext()),wo.splice(t.sym(),n.lNext()),t.setOrig(e.dest()),t.setDest(n.dest())},wo.splice=function(t,e){var n=t.oNext().rot(),i=e.oNext().rot(),r=e.oNext(),s=t.oNext(),o=i.oNext(),a=n.oNext();t.setNext(r),e.setNext(s),n.setNext(o),i.setNext(a)},wo.connect=function(t,e){var n=wo.makeEdge(t.dest(),e.orig());return wo.splice(n,t.lNext()),wo.splice(n.sym(),e),n},e(Lo.prototype,{insertSite:function(t){var e=this._subdiv.locate(t);if(this._subdiv.isVertexOfEdge(e,t))return e;this._subdiv.isOnEdge(e,t.getCoordinate())&&(e=e.oPrev(),this._subdiv.delete(e.oNext()));var n=this._subdiv.makeEdge(e.orig(),t);wo.splice(n,e);for(var i=n;(e=(n=this._subdiv.connect(e,n.sym())).oPrev()).lNext()!==i;);for(;;){var r=e.oPrev();if(r.dest().rightOf(e)&&t.isInCircle(e.orig(),r.dest(),e.dest()))wo.swap(e),e=e.oPrev();else{if(e.oNext()===i)return n;e=e.oNext().lPrev()}}},insertSites:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertSite(n)}},interfaces_:function(){return[]},getClass:function(){return Lo}}),e(To.prototype,{locate:function(t){},interfaces_:function(){return[]},getClass:function(){return To}}),e(jo.prototype,{init:function(){this._lastEdge=this.findEdge()},locate:function(t){this._lastEdge.isLive()||this.init();var e=this._subdiv.locateFromEdge(t,this._lastEdge);return this._lastEdge=e},findEdge:function(){return this._subdiv.getEdges().iterator().next()},interfaces_:function(){return[To]},getClass:function(){return jo}}),y(No,_),e(No.prototype,{getSegment:function(){return this._seg},interfaces_:function(){return[]},getClass:function(){return No}}),No.msgWithSpatial=function(t,e){return null!==e?t+" [ "+e+" ]":t},e(Mo.prototype,{visit:function(t){},interfaces_:function(){return[]},getClass:function(){return Mo}}),e(Fo.prototype,{getTriangleVertices:function(t){var e=new Do;return this.visitTriangles(e,t),e.getTriangleVertices()},isFrameVertex:function(t){return!!t.equals(this._frameVertex[0])||!!t.equals(this._frameVertex[1])||!!t.equals(this._frameVertex[2])},isVertexOfEdge:function(t,e){return!(!e.equals(t.orig(),this._tolerance)&&!e.equals(t.dest(),this._tolerance))},connect:function(t,e){var n=wo.connect(t,e);return this._quadEdges.add(n),n},getVoronoiCellPolygon:function(t,e){var n=new j,i=t;do{var r=t.rot().orig().getCoordinate();n.add(r),t=t.oPrev()}while(t!==i);var s=new M;s.addAll(n,!1),s.closeRing(),s.size()<4&&(q.out.println(s),s.add(s.get(s.size()-1),!0));var o=s.toCoordinateArray(),a=e.createPolygon(e.createLinearRing(o)),l=i.orig();return a.setUserData(l.getCoordinate()),a},setLocator:function(t){this._locator=t},initSubdiv:function(){var t=this.makeEdge(this._frameVertex[0],this._frameVertex[1]),e=this.makeEdge(this._frameVertex[1],this._frameVertex[2]);wo.splice(t.sym(),e);var n=this.makeEdge(this._frameVertex[2],this._frameVertex[0]);return wo.splice(e.sym(),n),wo.splice(n.sym(),t),t},isFrameBorderEdge:function(t){var e=new Array(3).fill(null);Fo.getTriangleEdges(t,e);var n=new Array(3).fill(null);Fo.getTriangleEdges(t.sym(),n);var i=t.lNext().dest();if(this.isFrameVertex(i))return!0;var r=t.sym().lNext().dest();return!!this.isFrameVertex(r)},makeEdge:function(t,e){var n=wo.makeEdge(t,e);return this._quadEdges.add(n),n},visitTriangles:function(t,e){this._visitedKey++;var n=new tn;n.push(this._startingEdge);for(var i=new lt;!n.empty();){var r=n.pop();if(!i.contains(r)){var s=this.fetchTriangleToVisit(r,n,e,i);null!==s&&t.visit(s)}}},isFrameEdge:function(t){return!(!this.isFrameVertex(t.orig())&&!this.isFrameVertex(t.dest()))},isOnEdge:function(t,e){return this._seg.setCoordinates(t.orig().getCoordinate(),t.dest().getCoordinate()),this._seg.distance(e)<this._edgeCoincidenceTolerance},getEnvelope:function(){return new F(this._frameEnv)},createFrame:function(t){var e,n=t.getWidth(),i=t.getHeight();e=i<n?10*n:10*i,this._frameVertex[0]=new Oo((t.getMaxX()+t.getMinX())/2,t.getMaxY()+e),this._frameVertex[1]=new Oo(t.getMinX()-e,t.getMinY()-e),this._frameVertex[2]=new Oo(t.getMaxX()+e,t.getMinY()-e),this._frameEnv=new F(this._frameVertex[0].getCoordinate(),this._frameVertex[1].getCoordinate()),this._frameEnv.expandToInclude(this._frameVertex[2].getCoordinate())},getTriangleCoordinates:function(t){var e=new Ao;return this.visitTriangles(e,t),e.getTriangles()},getVertices:function(t){for(var e=new lt,n=this._quadEdges.iterator();n.hasNext();){var i=n.next(),r=i.orig();!t&&this.isFrameVertex(r)||e.add(r);var s=i.dest();!t&&this.isFrameVertex(s)||e.add(s)}return e},fetchTriangleToVisit:function(t,e,n,i){var r=t,s=0,o=!1;do{this._triEdges[s]=r,this.isFrameEdge(r)&&(o=!0);var a=r.sym();i.contains(a)||e.push(a),i.add(r),s++,r=r.lNext()}while(r!==t);return o&&!n?null:this._triEdges},getEdges:function(){if(0===arguments.length)return this._quadEdges;if(1===arguments.length){for(var t=arguments[0],e=this.getPrimaryEdges(!1),n=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var s=r.next();n[i++]=t.createLineString([s.orig().getCoordinate(),s.dest().getCoordinate()])}return t.createMultiLineString(n)}},getVertexUniqueEdges:function(t){for(var e=new j,n=new lt,i=this._quadEdges.iterator();i.hasNext();){var r=i.next(),s=r.orig();n.contains(s)||(n.add(s),!t&&this.isFrameVertex(s)||e.add(r));var o=r.sym(),a=o.orig();n.contains(a)||(n.add(a),!t&&this.isFrameVertex(a)||e.add(o))}return e},getTriangleEdges:function(t){var e=new Ro;return this.visitTriangles(e,t),e.getTriangleEdges()},getPrimaryEdges:function(t){this._visitedKey++;var e=new j,n=new tn;n.push(this._startingEdge);for(var i=new lt;!n.empty();){var r=n.pop();if(!i.contains(r)){var s=r.getPrimary();!t&&this.isFrameEdge(s)||e.add(s),n.push(r.oNext()),n.push(r.sym().oNext()),i.add(r),i.add(r.sym())}}return e},delete:function(t){wo.splice(t,t.oPrev()),wo.splice(t.sym(),t.sym().oPrev());var e=t.sym(),n=t.rot(),i=t.rot().sym();this._quadEdges.remove(t),this._quadEdges.remove(e),this._quadEdges.remove(n),this._quadEdges.remove(i),t.delete(),e.delete(),n.delete(),i.delete()},locateFromEdge:function(t,e){for(var n=0,i=this._quadEdges.size(),r=e;;){if(i<++n)throw new No(r.toLineSegment());if(t.equals(r.orig())||t.equals(r.dest()))break;if(t.rightOf(r))r=r.sym();else if(t.rightOf(r.oNext())){if(t.rightOf(r.dPrev()))break;r=r.dPrev()}else r=r.oNext()}return r},getTolerance:function(){return this._tolerance},getVoronoiCellPolygons:function(t){this.visitTriangles(new Po,!0);for(var e=new j,n=this.getVertexUniqueEdges(!1).iterator();n.hasNext();){var i=n.next();e.add(this.getVoronoiCellPolygon(i,t))}return e},getVoronoiDiagram:function(t){var e=this.getVoronoiCellPolygons(t);return t.createGeometryCollection(le.toGeometryArray(e))},getTriangles:function(t){for(var e=this.getTriangleCoordinates(!1),n=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var s=r.next();n[i++]=t.createPolygon(t.createLinearRing(s))}return t.createGeometryCollection(n)},insertSite:function(t){var e=this.locate(t);if(t.equals(e.orig(),this._tolerance)||t.equals(e.dest(),this._tolerance))return e;var n=this.makeEdge(e.orig(),t);wo.splice(n,e);for(var i=n;(e=(n=this.connect(e,n.sym())).oPrev()).lNext()!==i;);return i},locate:function(){if(1===arguments.length){if(arguments[0]instanceof Oo){var t=arguments[0];return this._locator.locate(t)}if(arguments[0]instanceof x){var e=arguments[0];return this._locator.locate(new Oo(e))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=this._locator.locate(new Oo(n));if(null===r)return null;var s=r;r.dest().getCoordinate().equals2D(n)&&(s=r.sym());var o=s;do{if(o.dest().getCoordinate().equals2D(i))return o;o=o.oNext()}while(o!==s);return null}},interfaces_:function(){return[]},getClass:function(){return Fo}}),Fo.getTriangleEdges=function(t,e){if(e[0]=t,e[1]=e[0].lNext(),e[2]=e[1].lNext(),e[2].lNext()!==e[0])throw new i("Edges do not form a triangle")},e(Po.prototype,{visit:function(t){for(var e=t[0].orig().getCoordinate(),n=t[1].orig().getCoordinate(),i=t[2].orig().getCoordinate(),r=new Oo(be.circumcentre(e,n,i)),s=0;s<3;s++)t[s].rot().setOrig(r)},interfaces_:function(){return[Mo]},getClass:function(){return Po}}),e(Ro.prototype,{getTriangleEdges:function(){return this._triList},visit:function(t){this._triList.add(t)},interfaces_:function(){return[Mo]},getClass:function(){return Ro}}),e(Do.prototype,{visit:function(t){this._triList.add([t[0].orig(),t[1].orig(),t[2].orig()])},getTriangleVertices:function(){return this._triList},interfaces_:function(){return[Mo]},getClass:function(){return Do}}),e(Ao.prototype,{checkTriangleSize:function(t){2<=t.length?pe.toLineString(t[0],t[1]):1<=t.length&&pe.toPoint(t[0])},visit:function(t){this._coordList.clear();for(var e=0;e<3;e++){var n=t[e].orig();this._coordList.add(n.getCoordinate())}if(0<this._coordList.size()){this._coordList.closeRing();var i=this._coordList.toCoordinateArray();if(4!==i.length)return null;this._triCoords.add(i)}},getTriangles:function(){return this._triCoords},interfaces_:function(){return[Mo]},getClass:function(){return Ao}}),Fo.TriangleCircumcentreVisitor=Po,Fo.TriangleEdgesListVisitor=Ro,Fo.TriangleVertexListVisitor=Do,Fo.TriangleCoordinatesVisitor=Ao,Fo.EDGE_COINCIDENCE_TOL_FACTOR=1e3,e(ko.prototype,{getLineSegment:function(){return this._ls},getEndZ:function(){return this._ls.getCoordinate(1).z},getStartZ:function(){return this._ls.getCoordinate(0).z},intersection:function(t){return this._ls.intersection(t.getLineSegment())},getStart:function(){return this._ls.getCoordinate(0)},getEnd:function(){return this._ls.getCoordinate(1)},getEndY:function(){return this._ls.getCoordinate(1).y},getStartX:function(){return this._ls.getCoordinate(0).x},equalsTopo:function(t){return this._ls.equalsTopo(t.getLineSegment())},getStartY:function(){return this._ls.getCoordinate(0).y},setData:function(t){this._data=t},getData:function(){return this._data},getEndX:function(){return this._ls.getCoordinate(1).x},toString:function(){return this._ls.toString()},interfaces_:function(){return[]},getClass:function(){return ko}}),e(Go.prototype,{getInitialVertices:function(){return this._initialVertices},getKDT:function(){return this._kdt},enforceConstraints:function(){this.addConstraintVertices();for(var t=0;0<this.enforceGabriel(this._segments)&&++t<Go.MAX_SPLIT_ITER;);},insertSites:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertSite(n)}},getVertexFactory:function(){return this._vertexFactory},getPointArray:function(){for(var t=new Array(this._initialVertices.size()+this._segVertices.size()).fill(null),e=0,n=this._initialVertices.iterator();n.hasNext();){var i=n.next();t[e++]=i.getCoordinate()}for(var r=this._segVertices.iterator();r.hasNext();)i=r.next(),t[e++]=i.getCoordinate();return t},setConstraints:function(t,e){this._segments=t,this._segVertices=e},computeConvexHull:function(){var t=new le,e=new nn(this.getPointArray(),t);this._convexHull=e.getConvexHull()},addConstraintVertices:function(){this.computeConvexHull(),this.insertSites(this._segVertices)},findNonGabrielPoint:function(t){var e=t.getStart(),n=t.getEnd(),i=new x((e.x+n.x)/2,(e.y+n.y)/2),r=e.distance(i),o=new F(i);o.expandBy(r);for(var a=this._kdt.query(o),l=null,u=s.MAX_VALUE,c=a.iterator();c.hasNext();){var h=c.next().getCoordinate();if(!h.equals2D(e)&&!h.equals2D(n)){var d=i.distance(h);d<r&&(null===l||d<u)&&(l=h,u=d)}}return l},getConstraintSegments:function(){return this._segments},setSplitPointFinder:function(t){this._splitFinder=t},getConvexHull:function(){return this._convexHull},getTolerance:function(){return this._tolerance},enforceGabriel:function(t){for(var e=new j,n=0,i=new j,r=t.iterator();r.hasNext();){var s=r.next(),o=this.findNonGabrielPoint(s);if(null!==o){this._splitPt=this._splitFinder.findSplitPoint(s,o);var a=this.createVertex(this._splitPt,s);this.insertSite(a).getCoordinate().equals2D(this._splitPt);var l=new ko(s.getStartX(),s.getStartY(),s.getStartZ(),a.getX(),a.getY(),a.getZ(),s.getData()),u=new ko(a.getX(),a.getY(),a.getZ(),s.getEndX(),s.getEndY(),s.getEndZ(),s.getData());e.add(l),e.add(u),i.add(s),n+=1}}return t.removeAll(i),t.addAll(e),n},createVertex:function(){if(1===arguments.length){var t=arguments[0],e=null;return null!==this._vertexFactory?this._vertexFactory.createVertex(t,null):new Io(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return e=null,(e=null!==this._vertexFactory?this._vertexFactory.createVertex(n,i):new Io(n)).setOnConstraint(!0),e}},getSubdivision:function(){return this._subdiv},computeBoundingBox:function(){var t=Go.computeVertexEnvelope(this._initialVertices),e=Go.computeVertexEnvelope(this._segVertices),n=new F(t);n.expandToInclude(e);var i=.2*n.getWidth(),r=.2*n.getHeight(),s=Math.max(i,r);this._computeAreaEnv=new F(n),this._computeAreaEnv.expandBy(s)},setVertexFactory:function(t){this._vertexFactory=t},formInitialDelaunay:function(){this.computeBoundingBox(),this._subdiv=new Fo(this._computeAreaEnv,this._tolerance),this._subdiv.setLocator(new jo(this._subdiv)),this._incDel=new Lo(this._subdiv),this.insertSites(this._initialVertices)},insertSite:function(){if(arguments[0]instanceof Io){var t=arguments[0],e=this._kdt.insert(t.getCoordinate(),t);if(e.isRepeated()){var n=e.getData();return n.merge(t),n}return this._incDel.insertSite(t),t}if(arguments[0]instanceof x){var i=arguments[0];this.insertSite(this.createVertex(i))}},interfaces_:function(){return[]},getClass:function(){return Go}}),Go.computeVertexEnvelope=function(t){for(var e=new F,n=t.iterator();n.hasNext();){var i=n.next();e.expandToInclude(i.getCoordinate())}return e},Go.MAX_SPLIT_ITER=99,e(Bo.prototype,{create:function(){if(null!==this._subdiv)return null;var t=Bo.envelope(this._siteCoords),e=Bo.toVertices(this._siteCoords);this._subdiv=new Fo(t,this._tolerance),new Lo(this._subdiv).insertSites(e)},setTolerance:function(t){this._tolerance=t},setSites:function(){if(arguments[0]instanceof X){var t=arguments[0];this._siteCoords=Bo.extractUniqueCoordinates(t)}else if(S(arguments[0],O)){var e=arguments[0];this._siteCoords=Bo.unique(nt.toCoordinateArray(e))}},getEdges:function(t){return this.create(),this._subdiv.getEdges(t)},getSubdivision:function(){return this.create(),this._subdiv},getTriangles:function(t){return this.create(),this._subdiv.getTriangles(t)},interfaces_:function(){return[]},getClass:function(){return Bo}}),Bo.extractUniqueCoordinates=function(t){if(null===t)return new M;var e=t.getCoordinates();return Bo.unique(e)},Bo.envelope=function(t){for(var e=new F,n=t.iterator();n.hasNext();){var i=n.next();e.expandToInclude(i)}return e},Bo.unique=function(t){var e=nt.copyDeep(t);return xt.sort(e),new M(e,!1)},Bo.toVertices=function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next();e.add(new Oo(i))}return e},e(zo.prototype,{createSiteVertices:function(t){for(var e=new j,n=t.iterator();n.hasNext();){var i=n.next();this._constraintVertexMap.containsKey(i)||e.add(new Io(i))}return e},create:function(){if(null!==this._subdiv)return null;var t=Bo.envelope(this._siteCoords),e=new j;null!==this._constraintLines&&(t.expandToInclude(this._constraintLines.getEnvelopeInternal()),this.createVertices(this._constraintLines),e=zo.createConstraintSegments(this._constraintLines));var n=new Go(this.createSiteVertices(this._siteCoords),this._tolerance);n.setConstraints(e,new j(this._constraintVertexMap.values())),n.formInitialDelaunay(),n.enforceConstraints(),this._subdiv=n.getSubdivision()},setTolerance:function(t){this._tolerance=t},setConstraints:function(t){this._constraintLines=t},setSites:function(t){this._siteCoords=Bo.extractUniqueCoordinates(t)},getEdges:function(t){return this.create(),this._subdiv.getEdges(t)},getSubdivision:function(){return this.create(),this._subdiv},getTriangles:function(t){return this.create(),this._subdiv.getTriangles(t)},createVertices:function(t){for(var e=t.getCoordinates(),n=0;n<e.length;n++){var i=new Io(e[n]);this._constraintVertexMap.put(e[n],i)}},interfaces_:function(){return[]},getClass:function(){return zo}}),zo.createConstraintSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=De.getLines(t),n=new j,i=e.iterator();i.hasNext();){var r=i.next();zo.createConstraintSegments(r,n)}return n}if(2===arguments.length){var s=arguments[1],o=arguments[0].getCoordinates();for(i=1;i<o.length;i++)s.add(new ko(o[i-1],o[i]))}},e(qo.prototype,{create:function(){if(null!==this._subdiv)return null;var t=Bo.envelope(this._siteCoords);this._diagramEnv=t;var e=Math.max(this._diagramEnv.getWidth(),this._diagramEnv.getHeight());this._diagramEnv.expandBy(e),null!==this._clipEnv&&this._diagramEnv.expandToInclude(this._clipEnv);var n=Bo.toVertices(this._siteCoords);this._subdiv=new Fo(t,this._tolerance),new Lo(this._subdiv).insertSites(n)},getDiagram:function(t){this.create();var e=this._subdiv.getVoronoiDiagram(t);return qo.clipGeometryCollection(e,this._diagramEnv)},setTolerance:function(t){this._tolerance=t},setSites:function(){if(arguments[0]instanceof X){var t=arguments[0];this._siteCoords=Bo.extractUniqueCoordinates(t)}else if(S(arguments[0],O)){var e=arguments[0];this._siteCoords=Bo.unique(nt.toCoordinateArray(e))}},setClipEnvelope:function(t){this._clipEnv=t},getSubdivision:function(){return this.create(),this._subdiv},interfaces_:function(){return[]},getClass:function(){return qo}}),qo.clipGeometryCollection=function(t,e){for(var n=t.getFactory().toGeometry(e),i=new j,r=0;r<t.getNumGeometries();r++){var s=t.getGeometryN(r),o=null;e.contains(s.getEnvelopeInternal())?o=s:e.intersects(s.getEnvelopeInternal())&&(o=n.intersection(s)).setUserData(s.getUserData()),null===o||o.isEmpty()||i.add(o)}return t.getFactory().createGeometryCollection(le.toGeometryArray(i))};var Vo=Object.freeze({Vertex:Oo}),Uo=Object.freeze({ConformingDelaunayTriangulationBuilder:zo,DelaunayTriangulationBuilder:Bo,VoronoiDiagramBuilder:qo,quadedge:Vo});function Wo(){if(this._componentIndex=0,this._segmentIndex=0,(this._segmentFraction=0)===arguments.length);else if(1===arguments.length){var t=arguments[0];this._componentIndex=t._componentIndex,this._segmentIndex=t._segmentIndex,this._segmentFraction=t._segmentFraction}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Wo.call(this,0,e,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];this._componentIndex=i,this._segmentIndex=r,this._segmentFraction=s,this.normalize()}else if(4===arguments.length){var o=arguments[0],a=arguments[1],l=arguments[2],u=arguments[3];this._componentIndex=o,this._segmentIndex=a,this._segmentFraction=l,u&&this.normalize()}}function Yo(){if(this._linearGeom=null,this._numLines=null,this._currentLine=null,this._componentIndex=0,this._vertexIndex=0,1===arguments.length){var t=arguments[0];Yo.call(this,t,0,0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Yo.call(this,e,n.getComponentIndex(),Yo.segmentEndVertexIndex(n))}else if(3===arguments.length){var r=arguments[0],s=arguments[1],o=arguments[2];if(!S(r,mt))throw new i("Lineal geometry is required");this._linearGeom=r,this._numLines=r.getNumGeometries(),this._componentIndex=s,this._vertexIndex=o,this.loadCurrentLine()}}function Ho(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t}function Jo(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t}function Xo(){this._geomFact=null,this._lines=new j,this._coordList=null,this._ignoreInvalidLines=!1,this._fixInvalidLines=!1,this._lastPt=null;var t=arguments[0];this._geomFact=t}function Zo(){this._line=null;var t=arguments[0];this._line=t}function Qo(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t,this.checkGeometryType()}function Ko(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t}function $o(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t}function ta(){this._linearGeom=null;var t=arguments[0];this._linearGeom=t}e(Wo.prototype,{getSegmentIndex:function(){return this._segmentIndex},getComponentIndex:function(){return this._componentIndex},isEndpoint:function(t){var e=t.getGeometryN(this._componentIndex).getNumPoints()-1;return this._segmentIndex>=e||this._segmentIndex===e&&1<=this._segmentFraction},isValid:function(t){if(this._componentIndex<0||this._componentIndex>=t.getNumGeometries())return!1;var e=t.getGeometryN(this._componentIndex);return!(this._segmentIndex<0||this._segmentIndex>e.getNumPoints()||this._segmentIndex===e.getNumPoints()&&0!==this._segmentFraction||this._segmentFraction<0||1<this._segmentFraction)},normalize:function(){this._segmentFraction<0&&(this._segmentFraction=0),1<this._segmentFraction&&(this._segmentFraction=1),this._componentIndex<0&&(this._componentIndex=0,this._segmentIndex=0,this._segmentFraction=0),this._segmentIndex<0&&(this._segmentIndex=0,this._segmentFraction=0),1===this._segmentFraction&&(this._segmentFraction=0,this._segmentIndex+=1)},toLowest:function(t){var e=t.getGeometryN(this._componentIndex).getNumPoints()-1;return this._segmentIndex<e?this:new Wo(this._componentIndex,e,1,!1)},getCoordinate:function(t){var e=t.getGeometryN(this._componentIndex),n=e.getCoordinateN(this._segmentIndex);if(this._segmentIndex>=e.getNumPoints()-1)return n;var i=e.getCoordinateN(this._segmentIndex+1);return Wo.pointAlongSegmentByFraction(n,i,this._segmentFraction)},getSegmentFraction:function(){return this._segmentFraction},getSegment:function(t){var e=t.getGeometryN(this._componentIndex),n=e.getCoordinateN(this._segmentIndex);return this._segmentIndex>=e.getNumPoints()-1?new me(e.getCoordinateN(e.getNumPoints()-2),n):new me(n,e.getCoordinateN(this._segmentIndex+1))},clamp:function(t){if(this._componentIndex>=t.getNumGeometries())return this.setToEnd(t),null;if(this._segmentIndex>=t.getNumPoints()){var e=t.getGeometryN(this._componentIndex);this._segmentIndex=e.getNumPoints()-1,this._segmentFraction=1}},setToEnd:function(t){this._componentIndex=t.getNumGeometries()-1;var e=t.getGeometryN(this._componentIndex);this._segmentIndex=e.getNumPoints()-1,this._segmentFraction=1},compareTo:function(t){var e=t;return this._componentIndex<e._componentIndex?-1:this._componentIndex>e._componentIndex?1:this._segmentIndex<e._segmentIndex?-1:this._segmentIndex>e._segmentIndex?1:this._segmentFraction<e._segmentFraction?-1:this._segmentFraction>e._segmentFraction?1:0},copy:function(){return new Wo(this._componentIndex,this._segmentIndex,this._segmentFraction)},toString:function(){return"LinearLoc["+this._componentIndex+", "+this._segmentIndex+", "+this._segmentFraction+"]"},isOnSameSegment:function(t){return this._componentIndex===t._componentIndex&&(this._segmentIndex===t._segmentIndex||t._segmentIndex-this._segmentIndex==1&&0===t._segmentFraction||this._segmentIndex-t._segmentIndex==1&&0===this._segmentFraction)},snapToVertex:function(t,e){if(this._segmentFraction<=0||1<=this._segmentFraction)return null;var n=this.getSegmentLength(t),i=this._segmentFraction*n,r=n-i;i<=r&&i<e?this._segmentFraction=0:r<=i&&r<e&&(this._segmentFraction=1)},compareLocationValues:function(t,e,n){return this._componentIndex<t?-1:this._componentIndex>t?1:this._segmentIndex<e?-1:this._segmentIndex>e?1:this._segmentFraction<n?-1:this._segmentFraction>n?1:0},getSegmentLength:function(t){var e=t.getGeometryN(this._componentIndex),n=this._segmentIndex;this._segmentIndex>=e.getNumPoints()-1&&(n=e.getNumPoints()-2);var i=e.getCoordinateN(n),r=e.getCoordinateN(n+1);return i.distance(r)},isVertex:function(){return this._segmentFraction<=0||1<=this._segmentFraction},interfaces_:function(){return[p]},getClass:function(){return Wo}}),Wo.getEndLocation=function(t){var e=new Wo;return e.setToEnd(t),e},Wo.pointAlongSegmentByFraction=function(t,e,n){return n<=0?t:1<=n?e:new x((e.x-t.x)*n+t.x,(e.y-t.y)*n+t.y,(e.z-t.z)*n+t.z)},Wo.compareLocationValues=function(t,e,n,i,r,s){return t<i?-1:i<t?1:e<r?-1:r<e?1:n<s?-1:s<n?1:0},e(Yo.prototype,{getComponentIndex:function(){return this._componentIndex},getLine:function(){return this._currentLine},getVertexIndex:function(){return this._vertexIndex},getSegmentEnd:function(){return this._vertexIndex<this.getLine().getNumPoints()-1?this._currentLine.getCoordinateN(this._vertexIndex+1):null},next:function(){if(!this.hasNext())return null;this._vertexIndex++,this._vertexIndex>=this._currentLine.getNumPoints()&&(this._componentIndex++,this.loadCurrentLine(),this._vertexIndex=0)},loadCurrentLine:function(){if(this._componentIndex>=this._numLines)return this._currentLine=null;this._currentLine=this._linearGeom.getGeometryN(this._componentIndex)},getSegmentStart:function(){return this._currentLine.getCoordinateN(this._vertexIndex)},isEndOfLine:function(){return!(this._componentIndex>=this._numLines||this._vertexIndex<this._currentLine.getNumPoints()-1)},hasNext:function(){return!(this._componentIndex>=this._numLines||this._componentIndex===this._numLines-1&&this._vertexIndex>=this._currentLine.getNumPoints())},interfaces_:function(){return[]},getClass:function(){return Yo}}),Yo.segmentEndVertexIndex=function(t){return 0<t.getSegmentFraction()?t.getSegmentIndex()+1:t.getSegmentIndex()},e(Ho.prototype,{indexOf:function(t){return this.indexOfFromStart(t,null)},indexOfFromStart:function(t,e){for(var n=s.MAX_VALUE,i=0,r=0,o=-1,a=new me,l=new Yo(this._linearGeom);l.hasNext();l.next())if(!l.isEndOfLine()){a.p0=l.getSegmentStart(),a.p1=l.getSegmentEnd();var u=a.distance(t),c=a.segmentFraction(t),h=l.getComponentIndex(),d=l.getVertexIndex();u<n&&(null===e||e.compareLocationValues(h,d,c)<0)&&(i=h,r=d,o=c,n=u)}return n===s.MAX_VALUE?new Wo(e):new Wo(i,r,o)},indexOfAfter:function(t,e){if(null===e)return this.indexOf(t);var n=Wo.getEndLocation(this._linearGeom);if(n.compareTo(e)<=0)return n;var i=this.indexOfFromStart(t,e);return b.isTrue(0<=i.compareTo(e),"computed location is before specified minimum location"),i},interfaces_:function(){return[]},getClass:function(){return Ho}}),Ho.indexOf=function(t,e){return new Ho(t).indexOf(e)},Ho.indexOfAfter=function(t,e,n){return new Ho(t).indexOfAfter(e,n)},e(Jo.prototype,{indicesOf:function(t){var e=t.getGeometryN(0).getCoordinateN(0),n=t.getGeometryN(t.getNumGeometries()-1),i=n.getCoordinateN(n.getNumPoints()-1),r=new Ho(this._linearGeom),s=new Array(2).fill(null);return s[0]=r.indexOf(e),0===t.getLength()?s[1]=s[0].copy():s[1]=r.indexOfAfter(i,s[0]),s},interfaces_:function(){return[]},getClass:function(){return Jo}}),Jo.indicesOf=function(t,e){return new Jo(t).indicesOf(e)},e(Xo.prototype,{getGeometry:function(){return this.endLine(),this._geomFact.buildGeometry(this._lines)},getLastCoordinate:function(){return this._lastPt},endLine:function(){if(null===this._coordList)return null;if(this._ignoreInvalidLines&&this._coordList.size()<2)return this._coordList=null;var t=this._coordList.toCoordinateArray(),e=t;this._fixInvalidLines&&(e=this.validCoordinateSequence(t));var n=this._coordList=null;try{n=this._geomFact.createLineString(e)}catch(t){if(!(t instanceof i))throw t;if(!this._ignoreInvalidLines)throw t}null!==n&&this._lines.add(n)},setFixInvalidLines:function(t){this._fixInvalidLines=t},add:function(){if(1===arguments.length){var t=arguments[0];this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];null===this._coordList&&(this._coordList=new M),this._coordList.add(e,n),this._lastPt=e}},setIgnoreInvalidLines:function(t){this._ignoreInvalidLines=t},validCoordinateSequence:function(t){return 2<=t.length?t:[t[0],t[0]]},interfaces_:function(){return[]},getClass:function(){return Xo}}),e(Zo.prototype,{computeLinear:function(t,e){var n=new Xo(this._line.getFactory());n.setFixInvalidLines(!0),t.isVertex()||n.add(t.getCoordinate(this._line));for(var i=new Yo(this._line,t);i.hasNext()&&!(e.compareLocationValues(i.getComponentIndex(),i.getVertexIndex(),0)<0);i.next()){var r=i.getSegmentStart();n.add(r),i.isEndOfLine()&&n.endLine()}return e.isVertex()||n.add(e.getCoordinate(this._line)),n.getGeometry()},computeLine:function(t,e){var n=this._line.getCoordinates(),i=new M,r=t.getSegmentIndex();0<t.getSegmentFraction()&&(r+=1);var s=e.getSegmentIndex();1===e.getSegmentFraction()&&(s+=1),s>=n.length&&(s=n.length-1),t.isVertex()||i.add(t.getCoordinate(this._line));for(var o=r;o<=s;o++)i.add(n[o]);e.isVertex()||i.add(e.getCoordinate(this._line)),i.size()<=0&&i.add(t.getCoordinate(this._line));var a=i.toCoordinateArray();return a.length<=1&&(a=[a[0],a[0]]),this._line.getFactory().createLineString(a)},extract:function(t,e){return e.compareTo(t)<0?this.reverse(this.computeLinear(e,t)):this.computeLinear(t,e)},reverse:function(t){return t instanceof kt||t instanceof It?t.reverse():(b.shouldNeverReachHere("non-linear geometry encountered"),null)},interfaces_:function(){return[]},getClass:function(){return Zo}}),Zo.extract=function(t,e,n){return new Zo(t).extract(e,n)},e(Qo.prototype,{clampIndex:function(t){var e=t.copy();return e.clamp(this._linearGeom),e},project:function(t){return Ho.indexOf(this._linearGeom,t)},checkGeometryType:function(){if(!(this._linearGeom instanceof kt||this._linearGeom instanceof It))throw new i("Input geometry must be linear")},extractPoint:function(){if(1===arguments.length)return arguments[0].getCoordinate(this._linearGeom);if(2===arguments.length){var t=arguments[1],e=arguments[0].toLowest(this._linearGeom);return e.getSegment(this._linearGeom).pointAlongOffset(e.getSegmentFraction(),t)}},isValidIndex:function(t){return t.isValid(this._linearGeom)},getEndIndex:function(){return Wo.getEndLocation(this._linearGeom)},getStartIndex:function(){return new Wo},indexOfAfter:function(t,e){return Ho.indexOfAfter(this._linearGeom,t,e)},extractLine:function(t,e){return Zo.extract(this._linearGeom,t,e)},indexOf:function(t){return Ho.indexOf(this._linearGeom,t)},indicesOf:function(t){return Jo.indicesOf(this._linearGeom,t)},interfaces_:function(){return[]},getClass:function(){return Qo}}),e(Ko.prototype,{indexOf:function(t){return this.indexOfFromStart(t,-1)},indexOfFromStart:function(t,e){for(var n=s.MAX_VALUE,i=e,r=0,o=new me,a=new Yo(this._linearGeom);a.hasNext();){if(!a.isEndOfLine()){o.p0=a.getSegmentStart(),o.p1=a.getSegmentEnd();var l=o.distance(t),u=this.segmentNearestMeasure(o,t,r);l<n&&e<u&&(i=u,n=l),r+=o.getLength()}a.next()}return i},indexOfAfter:function(t,e){if(e<0)return this.indexOf(t);var n=this._linearGeom.getLength();if(n<e)return n;var i=this.indexOfFromStart(t,e);return b.isTrue(e<=i,"computed index is before specified minimum index"),i},segmentNearestMeasure:function(t,e,n){var i=t.projectionFactor(e);return i<=0?n:i<=1?n+i*t.getLength():n+t.getLength()},interfaces_:function(){return[]},getClass:function(){return Ko}}),Ko.indexOf=function(t,e){return new Ko(t).indexOf(e)},Ko.indexOfAfter=function(t,e,n){return new Ko(t).indexOfAfter(e,n)},e($o.prototype,{getLength:function(t){for(var e=0,n=new Yo(this._linearGeom);n.hasNext();){if(!n.isEndOfLine()){var i=n.getSegmentStart(),r=n.getSegmentEnd().distance(i);if(t.getComponentIndex()===n.getComponentIndex()&&t.getSegmentIndex()===n.getVertexIndex())return e+r*t.getSegmentFraction();e+=r}n.next()}return e},resolveHigher:function(t){if(!t.isEndpoint(this._linearGeom))return t;var e=t.getComponentIndex();if(e>=this._linearGeom.getNumGeometries()-1)return t;for(;++e<this._linearGeom.getNumGeometries()-1&&0===this._linearGeom.getGeometryN(e).getLength(););return new Wo(e,0,0)},getLocation:function(){if(1===arguments.length){var t=arguments[0];return this.getLocation(t,!0)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=e;e<0&&(i=this._linearGeom.getLength()+e);var r=this.getLocationForward(i);return n?r:this.resolveHigher(r)}},getLocationForward:function(t){if(t<=0)return new Wo;for(var e=0,n=new Yo(this._linearGeom);n.hasNext();){if(n.isEndOfLine()){if(e===t)return new Wo(n.getComponentIndex(),n.getVertexIndex(),0)}else{var i=n.getSegmentStart(),r=n.getSegmentEnd().distance(i);if(t<e+r){var s=(t-e)/r;return new Wo(n.getComponentIndex(),n.getVertexIndex(),s)}e+=r}n.next()}return Wo.getEndLocation(this._linearGeom)},interfaces_:function(){return[]},getClass:function(){return $o}}),$o.getLength=function(t,e){return new $o(t).getLength(e)},$o.getLocation=function(){if(2===arguments.length){var t=arguments[1];return new $o(arguments[0]).getLocation(t)}if(3===arguments.length){var e=arguments[1],n=arguments[2];return new $o(arguments[0]).getLocation(e,n)}},e(ta.prototype,{clampIndex:function(t){var e=this.positiveIndex(t),n=this.getStartIndex();if(e<n)return n;var i=this.getEndIndex();return i<e?i:e},locationOf:function(){if(1===arguments.length){var t=arguments[0];return $o.getLocation(this._linearGeom,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return $o.getLocation(this._linearGeom,e,n)}},project:function(t){return Ko.indexOf(this._linearGeom,t)},positiveIndex:function(t){return 0<=t?t:this._linearGeom.getLength()+t},extractPoint:function(){if(1===arguments.length){var t=arguments[0];return $o.getLocation(this._linearGeom,t).getCoordinate(this._linearGeom)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=$o.getLocation(this._linearGeom,e).toLowest(this._linearGeom);return i.getSegment(this._linearGeom).pointAlongOffset(i.getSegmentFraction(),n)}},isValidIndex:function(t){return t>=this.getStartIndex()&&t<=this.getEndIndex()},getEndIndex:function(){return this._linearGeom.getLength()},getStartIndex:function(){return 0},indexOfAfter:function(t,e){return Ko.indexOfAfter(this._linearGeom,t,e)},extractLine:function(t,e){new Qo(this._linearGeom);var n=this.clampIndex(t),i=this.clampIndex(e),r=n===i,s=this.locationOf(n,r),o=this.locationOf(i);return Zo.extract(this._linearGeom,s,o)},indexOf:function(t){return Ko.indexOf(this._linearGeom,t)},indicesOf:function(t){var e=Jo.indicesOf(this._linearGeom,t);return[$o.getLength(this._linearGeom,e[0]),$o.getLength(this._linearGeom,e[1])]},interfaces_:function(){return[]},getClass:function(){return ta}});var ea=Object.freeze({LengthIndexedLine:ta,LengthLocationMap:$o,LinearGeometryBuilder:Xo,LinearIterator:Yo,LinearLocation:Wo,LocationIndexedLine:Qo});function na(){}e(na.prototype,{interfaces_:function(){return[]},getClass:function(){return na}}),na.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return vs.createEmptyResult(vs.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),_s.overlayOp(t,e,vs.UNION)},e(X.prototype,{equalsTopo:function(t){return!!this.getEnvelopeInternal().equals(t.getEnvelopeInternal())&&qs.relate(this,t).isEquals(this.getDimension(),t.getDimension())},union:function(){if(0===arguments.length)return Js.union(this);if(1===arguments.length){var t=arguments[0];return na.union(this,t)}},isValid:function(){return eo.isValid(this)},intersection:function(t){if(this.isEmpty()||t.isEmpty())return vs.createEmptyResult(vs.INTERSECTION,this,t,this._factory);if(this.isGeometryCollection()){var e=t;return os.map(this,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(e)}})}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),_s.overlayOp(this,t,vs.INTERSECTION)},covers:function(t){return qs.covers(this,t)},coveredBy:function(t){return qs.covers(t,this)},touches:function(t){return qs.touches(this,t)},intersects:function(t){return qs.intersects(this,t)},within:function(t){return qs.contains(t,this)},overlaps:function(t){return qs.overlaps(this,t)},disjoint:function(t){return qs.disjoint(this,t)},crosses:function(t){return qs.crosses(this,t)},buffer:function(){if(1===arguments.length){var t=arguments[0];return Rr.bufferOp(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return Rr.bufferOp(this,e,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],s=arguments[2];return Rr.bufferOp(this,i,r,s)}},convexHull:function(){return new nn(this).getConvexHull()},relate:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(1===arguments.length){var i=arguments[0];return qs.relate(this,i)}if(2===arguments.length){var r=arguments[0],s=arguments[1];return qs.relate(this,r).matches(s)}},getCentroid:function(){if(this.isEmpty())return this._factory.createPoint();var t=Qe.getCentroid(this);return this.createPointFromInternalCoord(t,this)},getInteriorPoint:function(){if(this.isEmpty())return this._factory.createPoint();var t,e=this.getDimension();return t=0===e?new ln(this).getInteriorPoint():1===e?new an(this).getInteriorPoint():new sn(this).getInteriorPoint(),this.createPointFromInternalCoord(t,this)},symDifference:function(t){if(this.isEmpty()||t.isEmpty()){if(this.isEmpty()&&t.isEmpty())return vs.createEmptyResult(vs.SYMDIFFERENCE,this,t,this._factory);if(this.isEmpty())return t.copy();if(t.isEmpty())return this.copy()}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),_s.overlayOp(this,t,vs.SYMDIFFERENCE)},createPointFromInternalCoord:function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},toText:function(){return(new pe).write(this)},toString:function(){this.toText()},contains:function(t){return qs.contains(this,t)},difference:function(t){return this.isEmpty()?vs.createEmptyResult(vs.DIFFERENCE,this,t,this._factory):t.isEmpty()?this.copy():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),_s.overlayOp(this,t,vs.DIFFERENCE))},isSimple:function(){return new rr(this).isSimple()},isWithinDistance:function(t,e){return!(e<this.getEnvelopeInternal().distance(t.getEnvelopeInternal()))&&zr.isWithinDistance(this,t,e)},distance:function(t){return zr.distance(this,t)},isEquivalentClass:function(t){return this.getClass()===t.getClass()}}),t.version="1.6.2 (258b53b)",t.algorithm=wn,t.densify=Nn,t.dissolve=kn,t.geom=xe,t.geomgraph=ui,t.index=Mi,t.io=qi,t.noding=ir,t.operation=io,t.precision=oo,t.simplify=bo,t.triangulate=Uo,t.linearref=ea,Object.defineProperty(t,"__esModule",{value:!0})}(e)},603:function(t,e,n){switch(window.__kbnThemeTag__){case"v8dark":return n(604);case"v8light":return n(606)}},604:function(t,e,n){var i=n(104),r=n(605);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},605:function(t,e,n){(e=n(105)(!1)).push([t.i,".mapMapLayerWizardSelect__tooltip{display:flex;flex:1}",""]),t.exports=e},606:function(t,e,n){var i=n(104),r=n(607);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},607:function(t,e,n){(e=n(105)(!1)).push([t.i,".mapMapLayerWizardSelect__tooltip{display:flex;flex:1}",""]),t.exports=e},608:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return l}));var i=n(2),r=n.n(i),s=n(4);const o=r.a.createContext(null),a=({children:t,...e})=>Object(s.jsx)(o.Provider,{value:{setIsFullscreen:t=>{e.coreStart.chrome.setIsVisible(!t)},customBranding$:e.coreStart.customBranding.customBranding$}},t);function l(){const t=Object(i.useContext)(o);if(!t)throw new Error("ExitFullScreenButtonContext is missing.  Ensure your component or React root is wrapped with ExitFullScreenButtonProvider.");return t}},609:function(t,e,n){switch(window.__kbnThemeTag__){case"v8dark":return n(610);case"v8light":return n(612)}},610:function(t,e,n){var i=n(104),r=n(611);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},611:function(t,e,n){(e=n(105)(!1)).push([t.i,".exitFullScreenButton{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-appearance:none;appearance:none;box-shadow:0 1px 5px #00000040,0 3.6px 13px rgba(0,0,0,.175),0 8.4px 23px #00000026,0 23px 35px rgba(0,0,0,.125);cursor:pointer;display:inline-block;font-family:Inter,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-kerning:normal;font-size:14px;font-size:1rem;font-weight:400;font-weight:500;height:40px;letter-spacing:normal;line-height:40px;line-height:1.7142857143rem;max-width:100%;outline-offset:-1px;text-align:center;text-decoration:none;vertical-align:middle;white-space:nowrap}@media screen and (prefers-reduced-motion:no-preference){.exitFullScreenButton{transition:transform .25s ease-in-out,background-color .25s ease-in-out}.exitFullScreenButton:hover:not(:disabled){transform:translateY(-1px)}.exitFullScreenButton:focus{animation:euiButtonActive .25s cubic-bezier(.34,1.61,.7,1)}.exitFullScreenButton:active:not(:disabled){transform:translateY(1px)}}.exitFullScreenButton:focus,.exitFullScreenButton:hover:not(:disabled){text-decoration:underline}",""]),t.exports=e},612:function(t,e,n){var i=n(104),r=n(613);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);i(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},613:function(t,e,n){(e=n(105)(!1)).push([t.i,".exitFullScreenButton{-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-webkit-appearance:none;appearance:none;box-shadow:0 1px 5px #0000001a,0 3.6px 13px #00000012,0 8.4px 23px #0000000f,0 23px 35px #0000000d;cursor:pointer;display:inline-block;font-family:Inter,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-kerning:normal;font-size:14px;font-size:1rem;font-weight:400;font-weight:500;height:40px;letter-spacing:normal;line-height:40px;line-height:1.7142857143rem;max-width:100%;outline-offset:-1px;text-align:center;text-decoration:none;vertical-align:middle;white-space:nowrap}@media screen and (prefers-reduced-motion:no-preference){.exitFullScreenButton{transition:transform .25s ease-in-out,background-color .25s ease-in-out}.exitFullScreenButton:hover:not(:disabled){transform:translateY(-1px)}.exitFullScreenButton:focus{animation:euiButtonActive .25s cubic-bezier(.34,1.61,.7,1)}.exitFullScreenButton:active:not(:disabled){transform:translateY(1px)}}.exitFullScreenButton:focus,.exitFullScreenButton:hover:not(:disabled){text-decoration:underline}",""]),t.exports=e},623:function(t,e,n){"use strict";n.d(e,"a",(function(){return x}));var i=n(74),r=n(591),s=n.n(r),o=n(110),a=n(0),l=n(130),u=n(63),c=n(134);function h(t,e){return t.findIndex((({id:t})=>e===t))}function d(t,e){return t.layerList.find((({id:t})=>e===t))}function p(t,e,n,i){if(!e)return t;const{layerList:r}=t,s=h(r,e);if(-1===s)return t;const o={...r[s],[n]:i},a=[...r.slice(0,s),o,...r.slice(s+1)];return{...t,layerList:a}}function f(t,e){const n=h(t,e.id);if(-1===n)return t;const i=[...t];return i[n]=e,i}function g(t,e,n,i,r,s,o){const a=_(t,e,n,i);return a?m(t,e,{...a,data:s,dataRequestMeta:{...a.dataRequestMetaAtStart?a.dataRequestMetaAtStart:{},...r||{},requestStopTime:Date.now()},dataRequestMetaAtStart:void 0,dataRequestToken:void 0,error:o}):t}function m(t,e,n){const i=d(t,e);if(!i)return t;const r={...i,__dataRequests:i.__dataRequests?[...i.__dataRequests]:[]},s=r.__dataRequests.findIndex((({dataId:t})=>n.dataId===t));return-1===s?r.__dataRequests.push(n):r.__dataRequests[s]=n,{...t,layerList:f(t.layerList,r)}}function _(t,e,n,i){const r=d(t,e);if(r&&r.__dataRequests)return r.__dataRequests.find((t=>i?t.dataRequestToken===i&&t.dataId===n:t.dataId===n))}const y={executionContext:{name:a.e},ready:!1,mapInitError:null,goto:null,openTooltips:[],mapState:{zoom:void 0,center:void 0,extent:void 0,mouseCoordinates:void 0,timeFilters:void 0,timeslice:void 0,query:void 0,filters:[],drawState:void 0,editState:void 0},selectedLayerId:null,layerList:[],waitingForMapReadyLayerList:[],settings:{autoFitToDataBounds:!1,backgroundColor:u.euiThemeVars.euiColorEmptyShade,customIcons:[],disableInteractive:!1,disableTooltipControl:!1,hideToolbarOverlay:!1,hideLayerControl:!1,hideViewControl:!1,initialLocation:a.S.LAST_SAVED_LOCATION,fixedLocation:{lat:0,lon:0,zoom:2},browserLocation:{zoom:2},keydownScrollZoom:!1,maxZoom:a.hb,minZoom:a.mb,showScaleControl:!1,showSpatialFilters:!0,showTimesliderToggleButton:!0,spatialFiltersAlpa:.3,spatialFiltersFillColor:"#DA8B45",spatialFiltersLineColor:"#DA8B45"},__rollbackSettings:null};function v(t=y,e){switch(e.type){case l.F:return{...t,mapState:{...t.mapState,drawState:e.drawState}};case l.G:return{...t,mapState:{...t.mapState,editState:e.editState}};case l.n:return function(t,e){const n=d(t,e);if(!n)return t;const i={...n};return delete i[c.a],{...t,layerList:f(t.layerList,i)}}(t,e.layerId);case l.D:return function(t,e){const n=d(t,e),i=Object(c.b)(n);return p(t,e,c.a,i)}(t,e.layerId);case l.p:return function(t,e){const n=d(t,e);if(!n)return t;const i=n[c.a],r={...n,...i};return delete r[c.a],{...t,layerList:f(t.layerList,r)}}(t,e.layerId);case l.z:return{...t,openTooltips:e.openTooltips};case l.y:return{...t,mapState:{...t.mapState,mouseCoordinates:{lat:e.lat,lon:e.lon}}};case l.e:return{...t,mapState:{...t.mapState,mouseCoordinates:void 0}};case l.s:return{...t,goto:{center:e.center,bounds:e.bounds}};case l.c:return{...t,goto:null};case l.x:return{...t,settings:{...t.settings,...e.settings}};case l.o:return t.__rollbackSettings?{...t,settings:{...t.__rollbackSettings},__rollbackSettings:null}:t;case l.E:return{...t,__rollbackSettings:t.settings};case l.L:return{...t,settings:{...t.settings?t.settings:{},[e.settingKey]:e.settingValue}};case l.M:return function(t,e,n){const i=_(t,e,a.zb);return i?m(t,e,{...i,data:n}):t}(t,e.layerId,e.newData);case l.i:return function(t,e,n,i,r){if(!d(t,e))return t;const s=_(t,e,n),o=s?{...s}:{dataId:n};return o.dataRequestMetaAtStart=r,o.dataRequestToken=i,m(t,e,o)}(t,e.layerId,e.dataId,e.requestToken,e.meta);case l.h:return g(t,e.layerId,e.dataId,e.requestToken,void 0,void 0,e.error);case l.g:return g(t,e.layerId,e.dataId,e.requestToken,e.meta,e.data);case l.l:return{...t,ready:!0};case l.j:return{...t,ready:!1};case l.k:return{...t,mapState:{...t.mapState,...e.mapViewContext}};case l.A:const{query:n,timeFilters:i,timeslice:r,filters:s,searchSessionId:o,searchSessionMapBuffer:u}=e;return{...t,mapState:{...t.mapState,query:n,timeFilters:i,timeslice:r,filters:s,searchSessionId:o,searchSessionMapBuffer:u}};case l.B:const y=t.layerList.find((t=>t.id===e.selectedLayerId));return{...t,selectedLayerId:y?e.selectedLayerId:null};case l.I:return{...t,layerList:e.newLayerOrder.map((e=>t.layerList[e]))};case l.J:return p(t,e.id,e.propName,e.newValue);case l.d:return function(t,e,n){if(!e)return t;const{layerList:i}=t,r=h(i,e);if(-1===r)return t;const s={...i[r]};delete s[n];const o=[...i.slice(0,r),s,...i.slice(r+1)];return{...t,layerList:o}}(t,e.id,e.propName);case l.N:return function(t,e,n,i){const{layerList:r}=t,s=h(r,e),o={...r[s],sourceDescriptor:{...r[s].sourceDescriptor,[n]:i}},a=[...r.slice(0,s),o,...r.slice(s+1)];return{...t,layerList:a}}(t,e.layerId,e.propName,e.value);case l.t:const v=t.layerList.find((t=>t.id===e.layerId));if(v){const n={...v,joins:e.joins.slice()},i=t.layerList.findIndex((t=>t.id===e.layerId)),r=t.layerList.slice();return r[i]=n,{...t,layerList:r}}return t;case l.a:return{...t,layerList:[...t.layerList,e.layer]};case l.m:return{...t,layerList:[...t.layerList.filter((({id:t})=>t!==e.id))]};case l.H:return{...t,layerList:f(t.layerList,e.layer)};case l.b:return{...t,waitingForMapReadyLayerList:[...t.waitingForMapReadyLayerList,e.layer]};case l.f:return{...t,waitingForMapReadyLayerList:[]};case l.v:return p(t,e.layerId,"visible",e.visibility);case l.K:const b=e.layerId;return p(t,b,"style",{...e.style});case l.u:const{layerId:x,styleMeta:E}=e,S=h(t.layerList,x);return-1===S?t:p(t,x,"style",{...t.layerList[S].style,__styleMeta:E});case l.w:return{...t,mapInitError:e.errorMessage};case l.C:return{...t,waitingForMapReadyLayerList:t.waitingForMapReadyLayerList.map((t=>({...t,visible:!e.hiddenLayerIds.includes(t.id)})))};case l.q:return{...t,mapState:{...t.mapState,embeddableSearchContext:e.embeddableSearchContext}};case l.r:return{...t,executionContext:e.executionContext};default:return t}}var b=n(111);function x(){const t=[Object(i.applyMiddleware)(s.a)],e=Object(i.combineReducers)({map:v,ui:o.d,nonSerializableInstances:b.f}),n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.compose;return Object(i.createStore)(e,{},n(...t))}o.b},625:function(t,e,n){"use strict";n.d(e,"a",(function(){return layer_stats_collector_LayerStatsCollector})),n.d(e,"b",(function(){return map_settings_collector_MapSettingsCollector}));var i=n(6),r=n.n(i),s=n(81),o=n(0);let a=function(t){return t.ROADMAP_DESATURATED="roadmap_desaturated",t.ROADMAP="roadmap",t.AUTO="auto",t.DARK="dark",t}({}),l=function(t){return t.DISTANCE="distance",t.TERM="term",t}({}),u=function(t){return t.ES_DOCS="es_docs",t.ES_TOP_HITS="es_top_hits",t.ES_TRACKS="es_tracks",t.ES_POINT_TO_POINT="es_point_to_point",t.ES_AGG_CLUSTERS="es_agg_clusters",t.ES_AGG_GRIDS="es_agg_grids",t.ES_AGG_HEXAGONS="es_agg_hexagons",t.ES_AGG_HEATMAP="es_agg_heatmap",t.ES_ML_ANOMALIES="es_ml_anomalies",t.ESQL="esql",t.EMS_REGION="ems_region",t.EMS_BASEMAP="ems_basemap",t.KBN_TMS_RASTER="kbn_tms_raster",t.LAYER_GROUP="layer_group",t.UX_TMS_RASTER="ux_tms_raster",t.UX_TMS_MVT="ux_tms_mvt",t.UX_WMS="ux_wms",t}({}),c=function(t){return t.COARSE="coarse",t.FINE="fine",t.MOST_FINE="most_fine",t.SUPER_FINE="super_fine",t}({}),h=function(t){return t.LIMIT="limit",t.MVT="mvt",t.CLUSTERS="clusters",t}({});class layer_stats_collector_LayerStatsCollector{constructor(t){if(r()(this,"_layerCount",0),r()(this,"_basemapCounts",{}),r()(this,"_joinCounts",{}),r()(this,"_layerCounts",{}),r()(this,"_resolutionCounts",{}),r()(this,"_scalingCounts",{}),r()(this,"_emsFileCounts",{}),r()(this,"_layerTypeCounts",{}),r()(this,"_sourceIds",new Set),!t||!t.layerListJSON)return;let e=[];try{e=JSON.parse(t.layerListJSON)}catch(t){return}this._layerCount=e.length,e.forEach((t=>{var e;this._updateCounts(function(t){if(!t.sourceDescriptor||t.sourceDescriptor.type!==o.Cb.EMS_TMS)return null;const e=t.sourceDescriptor;return e.isAutoSelect?a.AUTO:e.id===s.DEFAULT_EMS_ROADMAP_ID?a.ROADMAP:e.id===s.DEFAULT_EMS_ROADMAP_DESATURATED_ID?a.ROADMAP_DESATURATED:e.id===s.DEFAULT_EMS_DARKMAP_ID?a.DARK:null}(t),this._basemapCounts);const n=null==t?void 0:t.joins;n&&n.length&&n.forEach((t=>{this._updateCounts(function(t){var e,n;return(null==t||null===(e=t.right)||void 0===e?void 0:e.type)===o.Cb.ES_TERM_SOURCE?l.TERM:(null==t||null===(n=t.right)||void 0===n?void 0:n.type)===o.Cb.ES_DISTANCE_SOURCE?l.DISTANCE:null}(t),this._joinCounts)})),this._updateCounts(function(t){if(t.type===o.Z.HEATMAP)return u.ES_AGG_HEATMAP;if(t.type===o.Z.LAYER_GROUP)return u.LAYER_GROUP;if(!t.sourceDescriptor)return null;if(t.sourceDescriptor.type===o.Cb.EMS_FILE)return u.EMS_REGION;if(t.sourceDescriptor.type===o.Cb.EMS_TMS)return u.EMS_BASEMAP;if(t.sourceDescriptor.type===o.Cb.KIBANA_TILEMAP)return u.KBN_TMS_RASTER;if(t.sourceDescriptor.type===o.Cb.EMS_XYZ)return u.UX_TMS_RASTER;if(t.sourceDescriptor.type===o.Cb.WMS)return u.UX_WMS;if(t.sourceDescriptor.type===o.Cb.MVT_SINGLE_LAYER)return u.UX_TMS_MVT;if(t.sourceDescriptor.type===o.Cb.ES_GEO_LINE)return u.ES_TRACKS;if(t.sourceDescriptor.type===o.Cb.ES_PEW_PEW)return u.ES_POINT_TO_POINT;if(t.sourceDescriptor.type===o.Cb.ES_ML_ANOMALIES)return u.ES_ML_ANOMALIES;if(t.sourceDescriptor.type===o.Cb.ESQL)return u.ESQL;if(t.sourceDescriptor.type===o.Cb.ES_SEARCH)return t.sourceDescriptor.scalingType===o.wb.TOP_HITS?u.ES_TOP_HITS:u.ES_DOCS;if(t.sourceDescriptor.type===o.Cb.ES_GEO_GRID){const e=t.sourceDescriptor;if(e.requestType===o.ub.POINT)return u.ES_AGG_CLUSTERS;if(e.requestType===o.ub.GRID)return u.ES_AGG_GRIDS;if(e.requestType===o.ub.HEX)return u.ES_AGG_HEXAGONS}return null}(t),this._layerCounts),this._updateCounts(function(t){if(!t.sourceDescriptor||t.sourceDescriptor.type!==o.Cb.ES_GEO_GRID||!t.sourceDescriptor.resolution)return null;const e=t.sourceDescriptor;return e.resolution===o.L.COARSE?c.COARSE:e.resolution===o.L.FINE?c.FINE:e.resolution===o.L.MOST_FINE?c.MOST_FINE:e.resolution===o.L.SUPER_FINE?c.SUPER_FINE:null}(t),this._resolutionCounts),this._updateCounts(function(t){if(!t.sourceDescriptor||t.sourceDescriptor.type!==o.Cb.ES_SEARCH||!t.sourceDescriptor.scalingType)return null;const e=t.sourceDescriptor;return e.scalingType===o.wb.CLUSTERS?h.CLUSTERS:e.scalingType===o.wb.MVT?h.MVT:e.scalingType===o.wb.LIMIT?h.LIMIT:null}(t),this._scalingCounts),this._updateCounts(function(t){return null!==t.sourceDescriptor&&t.sourceDescriptor.type===o.Cb.EMS_FILE&&"id"in t.sourceDescriptor?t.sourceDescriptor.id:null}(t),this._emsFileCounts),t.type&&this._updateCounts(t.type,this._layerTypeCounts),null!==(e=t.sourceDescriptor)&&void 0!==e&&e.id&&this._sourceIds.add(t.sourceDescriptor.id)}))}getLayerCount(){return this._layerCount}getBasemapCounts(){return this._basemapCounts}getJoinCounts(){return this._joinCounts}getLayerCounts(){return this._layerCounts}getResolutionCounts(){return this._resolutionCounts}getScalingCounts(){return this._scalingCounts}getEmsFileCounts(){return this._emsFileCounts}getLayerTypeCounts(){return this._layerTypeCounts}getSourceCount(){return this._sourceIds.size}_updateCounts(t,e){t&&(t in e?e[t]+=1:e[t]=1)}}class map_settings_collector_MapSettingsCollector{constructor(t){if(r()(this,"_customIconsCount",0),!t||!t.mapStateJSON)return;let e;try{e=JSON.parse(t.mapStateJSON).settings}catch(t){return}e&&e.customIcons&&(this._customIconsCount=e.customIcons.length)}getCustomIconsCount(){return this._customIconsCount}}},89:function(t,e,n){"use strict";n.d(e,"a",(function(){return B})),n.d(e,"w",(function(){return z})),n.d(e,"N",(function(){return q})),n.d(e,"A",(function(){return V})),n.d(e,"k",(function(){return U})),n.d(e,"v",(function(){return W})),n.d(e,"u",(function(){return Y})),n.d(e,"j",(function(){return H})),n.d(e,"G",(function(){return J})),n.d(e,"p",(function(){return X})),n.d(e,"L",(function(){return Z})),n.d(e,"t",(function(){return Q})),n.d(e,"q",(function(){return K})),n.d(e,"x",(function(){return $})),n.d(e,"r",(function(){return tt})),n.d(e,"z",(function(){return et})),n.d(e,"J",(function(){return nt})),n.d(e,"K",(function(){return it})),n.d(e,"b",(function(){return rt})),n.d(e,"B",(function(){return st})),n.d(e,"h",(function(){return ot})),n.d(e,"D",(function(){return lt})),n.d(e,"E",(function(){return ut})),n.d(e,"Q",(function(){return ct})),n.d(e,"e",(function(){return ht})),n.d(e,"f",(function(){return dt})),n.d(e,"m",(function(){return pt})),n.d(e,"d",(function(){return ft})),n.d(e,"g",(function(){return gt})),n.d(e,"c",(function(){return mt})),n.d(e,"I",(function(){return _t})),n.d(e,"n",(function(){return yt})),n.d(e,"o",(function(){return vt})),n.d(e,"l",(function(){return bt})),n.d(e,"F",(function(){return xt})),n.d(e,"O",(function(){return Et})),n.d(e,"s",(function(){return St})),n.d(e,"H",(function(){return Ct})),n.d(e,"C",(function(){return Ot})),n.d(e,"y",(function(){return It})),n.d(e,"i",(function(){return wt})),n.d(e,"M",(function(){return Lt})),n.d(e,"P",(function(){return Tt}));var i=n(76),r=n(53),s=n.n(r),o=n(176),a=n(250),l=n(91),u=n(100),c=n(102),h=n(160),d=n(6),p=n.n(d),f=n(3),g=n(132),m=n(135);class invalid_layer_InvalidSource extends m.a{constructor(t){super({id:t,type:"INVALID"})}}class invalid_layer_InvalidLayer extends g.a{constructor(t,e){var n;super({layerDescriptor:t,source:new invalid_layer_InvalidSource(null===(n=t.sourceDescriptor)||void 0===n?void 0:n.id)}),p()(this,"_error",void 0),p()(this,"_style",void 0),this._error=e,this._style={getType:()=>"INVALID",renderEditor:()=>null}}isLayerLoading(){return!1}hasErrors(){return!0}getErrors(){return[{title:f.i18n.translate("xpack.maps.invalidLayer.errorTitle",{defaultMessage:"Unable to create layer"}),body:this._error.message}]}getStyleForEditing(){return this._style}getStyle(){return this._style}getCurrentStyle(){return this._style}getMbLayerIds(){return[]}ownsMbLayerId(){return!1}ownsMbSourceId(){return!1}syncLayerWithMB(){}getLayerTypeIconName(){return"error"}}var _=n(5),y=n(111),v=n(134),b=n(114),x=n(0),E=n(158);class inner_join_InnerJoin{constructor(t,e){p()(this,"_descriptor",void 0),p()(this,"_rightSource",void 0),p()(this,"_leftField",void 0),this._descriptor=t,this._rightSource=function(t){if(t)return t.type===x.Cb.ES_DISTANCE_SOURCE&&Object(E.e)(t)?new E.b(t):t.type===x.Cb.ES_TERM_SOURCE&&Object(E.g)(t)?new E.c(t):t.type===x.Cb.TABLE_SOURCE?new E.d(t):void 0}(this._descriptor.right),this._leftField=t.leftField?e.getFieldByName(t.leftField):void 0}hasCompleteConfig(){return!(!this._leftField||!this._rightSource)&&this._rightSource.hasCompleteConfig()}getJoinFields(){return this._rightSource?this._rightSource.getRightFields():[]}getSourceDataRequestId(){return`join_source_${this._rightSource.getId()}`}getSourceMetaDataRequestId(){return`${this.getSourceDataRequestId()}_${x.kb}`}getSourceFormattersDataRequestId(){return`${this.getSourceDataRequestId()}_${x.F}`}getLeftField(){if(!this._leftField)throw new Error("Cannot get leftField from InnerJoin with incomplete config");return this._leftField}joinPropertiesToFeature(t,e){if(!t.properties||!this._leftField||!this._rightSource)return!1;const n=this._rightSource.getRightFields();for(let e=0;e<n.length;e++){const i=n[e].getName();delete t.properties[i];const r=Object(b.f)(i);Object.keys(t.properties).forEach((e=>{e.length>=r.length&&e.substring(0,r.length)===r&&delete t.properties[e]}))}const i=this.getJoinKey(t);return!(null===i||!e.has(i)||(Object.assign(t.properties,e.get(i)),0))}getJoinKey(t){const e=t.properties&&this._leftField?t.properties[this._leftField.getName()]:void 0;return null==e?null:e.toString()}getRightJoinSource(){if(!this._rightSource)throw new Error("Cannot get rightSource from InnerJoin with incomplete config");return this._rightSource}toDescriptor(){return this._descriptor}async getTooltipProperties(t,e){return await this.getRightJoinSource().getTooltipProperties(t,e)}getWhereQuery(){return this.getRightJoinSource().getWhereQuery()}}var S=n(33),C=n(159),O=n(251),I=n(175),w=n(341),L=n(245),T=n(131),j=n(340),N=n(257),M=n(331),F=n(343),P=(n(254),n(246)),R=n(345);let D=!1;D||(Object(S.b)({ConstructorFunction:C.a,type:x.Cb.EMS_FILE}),Object(S.b)({ConstructorFunction:O.a,type:x.Cb.EMS_TMS}),Object(S.b)({ConstructorFunction:I.a,type:x.Cb.ES_GEO_GRID}),Object(S.b)({ConstructorFunction:w.a,type:x.Cb.ES_GEO_LINE}),Object(S.b)({ConstructorFunction:L.a,type:x.Cb.ES_PEW_PEW}),Object(S.b)({ConstructorFunction:T.ESSearchSource,type:x.Cb.ES_SEARCH}),Object(S.b)({ConstructorFunction:j.a,type:x.Cb.ESQL}),Object(S.b)({ConstructorFunction:N.a,type:x.Cb.GEOJSON_FILE}),Object(S.b)({ConstructorFunction:M.a,type:x.Cb.KIBANA_TILEMAP}),Object(S.b)({ConstructorFunction:F.a,type:x.Cb.MVT_SINGLE_LAYER}),Object(S.b)({ConstructorFunction:P.a,type:x.Cb.WMS}),Object(S.b)({ConstructorFunction:R.a,type:x.Cb.EMS_XYZ}),D=!0);var A=n(93),k=n(94);function G(t,e){return t.joins?t.joins.map((t=>new inner_join_InnerJoin(t,e))):[]}function B(t,e,n){try{if(t.type===x.Z.LAYER_GROUP)return new c.b({layerDescriptor:t});const i=function(t){if(null===t)throw new Error("Source-descriptor should be initialized");const e=Object(S.a)(t.type);if(!e)throw new Error(`Unrecognized sourceType ${t.type}`);return new e.ConstructorFunction(t)}(t.sourceDescriptor);switch(t.type){case x.Z.RASTER_TILE:return new o.a({layerDescriptor:t,source:i});case x.Z.EMS_VECTOR_TILE:return new a.a({layerDescriptor:t,source:i});case x.Z.HEATMAP:return new h.a({layerDescriptor:t,source:i});case x.Z.GEOJSON_VECTOR:return new l.b({layerDescriptor:t,source:i,joins:G(t,i),customIcons:e,chartsPaletteServiceGetColor:n});case x.Z.BLENDED_VECTOR:return new l.a({layerDescriptor:t,source:i,customIcons:e,chartsPaletteServiceGetColor:n});case x.Z.MVT_VECTOR:return new l.c({layerDescriptor:t,source:i,joins:G(t,i),customIcons:e});default:throw new Error(`Unrecognized layerType ${t.type}`)}}catch(e){return new invalid_layer_InvalidLayer(t,e)}}const z=({map:t})=>t.settings,q=Object(i.createSelector)(z,(({map:t})=>t.__rollbackSettings),((t,e)=>!!e&&!s.a.isEqual(t,e))),V=({map:t})=>t&&t.openTooltips?t.openTooltips:[],U=t=>V(t).some((({isLocked:t})=>t)),W=({map:t})=>t&&t.ready,Y=({map:t})=>t.mapInitError,H=({map:t})=>t&&t.goto,J=({map:t})=>t.selectedLayerId&&t.layerList?t.selectedLayerId:null,X=({map:t})=>t.layerList?t.layerList:[],Z=({map:t})=>t.waitingForMapReadyLayerList?t.waitingForMapReadyLayerList:[],Q=({map:t})=>t.mapState.extent,K=({map:t})=>t.mapState.buffer,$=({map:t})=>t.mapState.zoom?t.mapState.zoom:0,tt=({map:t})=>t.mapState.center?t.mapState.center:{lat:0,lon:0},et=({map:t})=>t.mapState.mouseCoordinates,nt=({map:t})=>t.mapState.timeFilters?t.mapState.timeFilters:Object(_.Q)().getTime(),it=({map:t})=>t.mapState.timeslice,rt=({map:t})=>t.settings.customIcons,st=({map:t})=>t.mapState.query,ot=({map:t})=>t.mapState.filters,at=({map:t})=>t.mapState.embeddableSearchContext,lt=({map:t})=>t.mapState.searchSessionId,ut=({map:t})=>t.mapState.searchSessionMapBuffer,ct=t=>{const e=ot(t).filter((t=>!t.meta.disabled)),n=s.a.get(st(t),"query","");return!!e.length||!!n.length},ht=({map:t})=>t.mapState.drawState,dt=({map:t})=>t.mapState.editState;function pt(t,e){return X(t).find((t=>t.id===e))}function ft(t,e,n){const i=pt(t,e);if(i&&i.__dataRequests)return i.__dataRequests.find((t=>t.dataId===n))}function gt(t){return t.map.executionContext}const mt=Object(i.createSelector)(Q,K,$,nt,it,st,ot,at,lt,ut,k.g,gt,((t,e,n,i,r,s,o,a,l,u,c,h)=>({extent:t,buffer:l&&u?u:e,zoom:n,timeFilters:i,timeslice:r,query:s,filters:o,embeddableSearchContext:a,searchSessionId:l,isReadOnly:c,executionContext:h}))),_t=Object(i.createSelector)(ot,at,z,((t,e,n)=>{var i;const r={type:"FeatureCollection",features:Object(A.i)([...t,...null!==(i=null==e?void 0:e.filters)&&void 0!==i?i:[]])},s=N.a.createDescriptor({__featureCollection:r,name:"spatialFilters"});return new l.b({layerDescriptor:l.b.createDescriptor({id:x.Db,visible:n.showSpatialFilters,alpha:n.spatialFiltersAlpa,__dataRequests:[{dataId:x.zb,data:r}],style:u.a.createDescriptor({[x.Ib.FILL_COLOR]:{type:x.Eb.STATIC,options:{color:n.spatialFiltersFillColor}},[x.Ib.LINE_COLOR]:{type:x.Eb.STATIC,options:{color:n.spatialFiltersLineColor}}})}),source:new N.a(s),customIcons:[]})})),yt=Object(i.createSelector)(X,y.b,rt,((t,e,n)=>{const i=t.map((t=>B(t,n,e))),r=new Map;return i.forEach((t=>{const e=t.getParent();if(!e)return;const n=r.has(e)?r.get(e):[];r.set(e,[...n,t])})),r.forEach(((t,e)=>{const n=i.find((t=>t.getId()===e));n&&Object(c.c)(n)&&n.setChildren(t)})),i})),vt=Object(i.createSelector)(X,(t=>Object(v.b)(t)));function bt(t,e){return yt(e).find((e=>t===e.getId()))}const xt=Object(i.createSelector)(J,yt,((t,e)=>e.find((e=>e.getId()===t)))),Et=Object(i.createSelector)(yt,(t=>t.some((t=>t.isPreviewLayer())))),St=Object(i.createSelector)(X,(t=>t.filter((t=>!t.__isPreviewLayer)).reduce(((t,e)=>{const n=s.a.get(e,"style.properties.fillColor.options.color");return n&&t.push(n),t}),[]))),Ct=Object(i.createSelector)(xt,(t=>t&&Object(l.e)(t,"getJoins")?t.getJoins().map((t=>t.toDescriptor())):[])),Ot=Object(i.createSelector)(yt,Z,((t,e)=>{const n=[];return e.length?e.forEach((t=>{const e=B(t,[]);e.isVisible()&&n.push(...e.getQueryableIndexPatternIds())})):t.forEach((t=>{t.isVisible()&&n.push(...t.getQueryableIndexPatternIds())})),s.a.uniq(n)})),It=Object(i.createSelector)(yt,Z,((t,e)=>{const n={};function i(t){t.forEach((t=>{const e=n.hasOwnProperty(t)?n[t]:0;n[t]=e+1}))}let r;e.length?e.forEach((t=>{i(B(t,[]).getIndexPatternIds())})):t.forEach((t=>{i(t.getIndexPatternIds())}));let s=0;return Object.keys(n).forEach((t=>{n[t]>s&&(r=t,s=n[t])})),r})),wt=Object(i.createSelector)(yt,Z,((t,e)=>{const n=[];return e.length?e.forEach((t=>{const e=B(t,[]);n.push(...e.getGeoFieldNames())})):t.forEach((t=>{n.push(...t.getGeoFieldNames())})),s.a.uniq(n)})),Lt=Object(i.createSelector)(X,(t=>t.some((t=>{if(t.__isPreviewLayer)return!0;const e=t[v.a];if(!e)return!1;const n=Object(v.b)(t);return!s.a.isEqual(n,e)})))),Tt=Object(i.createSelector)(yt,Z,$,((t,e,n)=>{if(e.length)return!0;for(let e=0;e<t.length;e++){const i=t[e];if(!i.hasErrors()&&i.isLayerLoading(n))return!0}return!1}))},90:function(t,e,n){"use strict";n.d(e,"l",(function(){return i.l})),n.d(e,"g",(function(){return i.g})),n.d(e,"h",(function(){return i.h})),n.d(e,"f",(function(){return i.f})),n.d(e,"j",(function(){return i.j})),n.d(e,"i",(function(){return i.i})),n.d(e,"k",(function(){return i.k})),n.d(e,"b",(function(){return i.b})),n.d(e,"e",(function(){return i.e})),n.d(e,"d",(function(){return i.d})),n.d(e,"c",(function(){return i.c})),n.d(e,"a",(function(){return i.a})),n.d(e,"A",(function(){return i.p})),n.d(e,"Bb",(function(){return i.A})),n.d(e,"K",(function(){return i.r})),n.d(e,"db",(function(){return i.w})),n.d(e,"z",(function(){return i.o})),n.d(e,"nb",(function(){return i.y})),n.d(e,"lb",(function(){return i.x})),n.d(e,"rb",(function(){return i.z})),n.d(e,"E",(function(){return i.q})),n.d(e,"W",(function(){return i.v})),n.d(e,"N",(function(){return i.s})),n.d(e,"v",(function(){return i.n})),n.d(e,"V",(function(){return i.u})),n.d(e,"ib",(function(){return r.n})),n.d(e,"jb",(function(){return r.o})),n.d(e,"U",(function(){return r.i})),n.d(e,"Kb",(function(){return r.w})),n.d(e,"vb",(function(){return r.s})),n.d(e,"x",(function(){return r.d})),n.d(e,"H",(function(){return r.h})),n.d(e,"F",(function(){return r.f})),n.d(e,"G",(function(){return r.g})),n.d(e,"kb",(function(){return r.p})),n.d(e,"r",(function(){return r.c})),n.d(e,"bb",(function(){return r.m})),n.d(e,"p",(function(){return r.b})),n.d(e,"mb",(function(){return r.q})),n.d(e,"Y",(function(){return r.k})),n.d(e,"Z",(function(){return r.l})),n.d(e,"xb",(function(){return r.t})),n.d(e,"zb",(function(){return r.v})),n.d(e,"X",(function(){return r.j})),n.d(e,"yb",(function(){return r.u})),n.d(e,"m",(function(){return r.a})),n.d(e,"y",(function(){return r.e})),n.d(e,"S",(function(){return o.n})),n.d(e,"T",(function(){return o.o})),n.d(e,"Eb",(function(){return o.F})),n.d(e,"s",(function(){return o.e})),n.d(e,"n",(function(){return o.c})),n.d(e,"Q",(function(){return o.l})),n.d(e,"O",(function(){return o.j})),n.d(e,"tb",(function(){return o.z})),n.d(e,"D",(function(){return o.g})),n.d(e,"qb",(function(){return o.x})),n.d(e,"sb",(function(){return o.y})),n.d(e,"ob",(function(){return o.v})),n.d(e,"ab",(function(){return o.p})),n.d(e,"Mb",(function(){return o.L})),n.d(e,"Nb",(function(){return o.M})),n.d(e,"Fb",(function(){return o.G})),n.d(e,"Gb",(function(){return o.H})),n.d(e,"fb",(function(){return o.s})),n.d(e,"q",(function(){return o.d})),n.d(e,"Ib",(function(){return o.J})),n.d(e,"Hb",(function(){return o.I})),n.d(e,"Db",(function(){return o.E})),n.d(e,"Cb",(function(){return o.D})),n.d(e,"Ab",(function(){return o.C})),n.d(e,"wb",(function(){return o.B})),n.d(e,"hb",(function(){return o.u})),n.d(e,"gb",(function(){return o.t})),n.d(e,"R",(function(){return o.m})),n.d(e,"P",(function(){return o.k})),n.d(e,"Jb",(function(){return o.K})),n.d(e,"eb",(function(){return o.r})),n.d(e,"cb",(function(){return o.q})),n.d(e,"pb",(function(){return o.w})),n.d(e,"w",(function(){return o.f})),n.d(e,"ub",(function(){return o.A})),n.d(e,"J",(function(){return o.i})),n.d(e,"I",(function(){return o.h})),n.d(e,"o",(function(){return a.b})),n.d(e,"C",(function(){return a.e})),n.d(e,"B",(function(){return a.d})),n.d(e,"t",(function(){return h})),n.d(e,"L",(function(){return d})),n.d(e,"u",(function(){return p})),n.d(e,"M",(function(){return f})),n.d(e,"Lb",(function(){return g}));var i=n(165),r=n(210),s=n(130),o=n(190),a=n(139),l=n(53),u=n.n(l),c=n(89);function h(t){return(e,n)=>{e({type:s.z,openTooltips:Object(c.A)(n()).filter((({id:e})=>t!==e))})}}function d(t){return(e,n)=>{const i=Object(c.A)(n()).filter((({features:e,location:n,isLocked:i})=>i&&!u.a.isEqual(n,t.location)&&!u.a.isEqual(e.map((({id:t,layerId:e})=>({id:t,layerId:e}))),t.features.map((({id:t,layerId:e})=>({id:t,layerId:e}))))));i.push(t),e({type:s.z,openTooltips:i})}}function p(){return(t,e)=>{Object(c.A)(e()).length&&t({type:s.z,openTooltips:[]})}}function f(t){return{type:s.z,openTooltips:[t]}}function g(t){return{type:s.z,openTooltips:t}}n(182)},94:function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"f",(function(){return s})),n.d(e,"h",(function(){return o})),n.d(e,"i",(function(){return a})),n.d(e,"e",(function(){return l})),n.d(e,"g",(function(){return u})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return h}));const i=({ui:t})=>t.flyoutDisplay,r=({ui:t})=>t.drawMode,s=({ui:t})=>t.isLayerTOCOpen,o=({ui:t})=>t.isTimesliderOpen,a=({ui:t})=>t.openTOCDetails,l=({ui:t})=>t.isFullScreen,u=({ui:t})=>t.isReadOnly,c=({ui:t})=>t.autoOpenLayerWizardId,h=({ui:t})=>t.deletedFeatureIds}}]);