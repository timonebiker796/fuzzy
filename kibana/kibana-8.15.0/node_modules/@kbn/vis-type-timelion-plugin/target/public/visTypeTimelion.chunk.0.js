(window.visTypeTimelion_bundle_jsonpfunction=window.visTypeTimelion_bundle_jsonpfunction||[]).push([[0],{38:function(e,t,n){"use strict";var i,o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),r=[];function s(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},i=[],o=0;o<e.length;o++){var a=e[o],l=t.base?a[0]+t.base:a[0],c=n[l]||0,u="".concat(l," ").concat(c);n[l]=c+1;var d=s(u),m={css:a[1],media:a[2],sourceMap:a[3]};-1!==d?(r[d].references++,r[d].updater(m)):r.push({identifier:u,updater:p(m,t),references:1}),i.push(u)}return i}function l(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var s=o(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,u=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function d(e,t,n,i){var o=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=u(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function m(e,t,n){var i=n.css,o=n.media,r=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var f=null,v=0;function p(e,t){var n,i,o;if(t.singleton){var r=v++;n=f||(f=l(t)),i=d.bind(null,n,r,!1),o=d.bind(null,n,r,!0)}else n=l(t),i=m.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var o=s(n[i]);r[o].references--}for(var l=a(e,t),c=0;c<n.length;c++){var u=s(n[c]);0===r[u].references&&(r[u].updater(),r.splice(u,1))}n=l}}}},39:function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,i,o,r=e[1]||"",s=e[3];if(!s)return r;if(t&&"function"==typeof btoa){var a=(n=s,i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(o," */")),l=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[r].concat(l).concat([a]).join("\n")}return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(i)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(o[s]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);i&&o[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},40:function(e,t,n){e.exports=n(23)(71)},41:function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(42);case"v8light":return n(44)}},42:function(e,t,n){var i=n(38),o=n(43);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);i(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},43:function(e,t,n){(t=n(39)(!1)).push([e.i,".timelionChart{display:flex;flex-direction:column;height:100%;width:100%}.timelionChart__topTitle{text-align:center}",""]),e.exports=t},44:function(e,t,n){var i=n(38),o=n(45);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);i(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},45:function(e,t,n){(t=n(39)(!1)).push([e.i,".timelionChart{display:flex;flex-direction:column;height:100%;width:100%}.timelionChart__topTitle{text-align:center}",""]),e.exports=t},54:function(e,t,n){"use strict";n.r(t),n.d(t,"getTimelionRequestHandler",(function(){return c})),n.d(t,"TimelionVisComponent",(function(){return P}));var i=n(7),o=n(32),r=n(3),s=n(30),a=n.n(s),l=n(1);function c({uiSettings:e,http:t,timefilter:n,expressionAbortSignal:s}){const c=function(e){return e.isDefault("dateFormat:tz")?a.a.tz.guess()||a()().format("Z"):e.get("dateFormat:tz","Browser")}(e);return async function({timeRange:a,filters:u,query:d,visParams:m,searchSessionId:f,executionContext:v}){var p;const h=Object(l.c)(),b=m.expression,g=new AbortController,y=function(){g.abort()};if(s.addEventListener("abort",y),!b)throw new Error(i.i18n.translate("timelion.emptyExpressionErrorMessage",{defaultMessage:"Timelion error: No expression provided"}));let x;const j=null===(p=u[0])||void 0===p?void 0:p.meta.index;j&&(x=await Object(l.e)().get(j).catch((()=>{})));const w=Object(r.getEsQueryConfig)(e),C=async e=>await t.post("/internal/timelion/run",{body:JSON.stringify({sheet:[b],extended:{es:{filter:Object(o.buildEsQuery)(x,d,u,w)}},time:{from:T.min,to:T.max,interval:m.interval,timezone:c},...e?{searchSession:e}:{}}),context:v,signal:g.signal}),T=n.calculateBounds(a),k=h.session.isCurrentSession(f)?h.session.trackSearch({abort:()=>g.abort(),poll:async()=>{},onSavingSession:async e=>{await C(e)}}):void 0;try{const e=h.session.getSearchOptions(f),t=await C(e);return null==k||k.complete(),t}catch(e){if(null==k||k.error(),e&&e.body){const t=new Error(`${i.i18n.translate("timelion.requestHandlerErrorTitle",{defaultMessage:"Timelion request error"})}:${e.body.title?" "+e.body.title:""} ${e.body.message}`);throw t.stack=e.stack,t}throw e}finally{s.removeEventListener("abort",y)}}}var u=n(2),d=n(5),m=n(29),f=n(6),v=n(15),p=n(33),h=n(0);const b=({color:e,bars:t})=>{var n,i;let o=null!==(n=t.fill)&&void 0!==n?n:1;return o<0?o=0:o>1&&(o=1),{rectBorder:{visible:!1},rect:{fill:e,opacity:o,widthPixel:Math.max(1,null!==(i=t.lineWidth)&&void 0!==i?i:1)}}},g=({index:e,groupId:t,visData:n})=>Object(h.jsx)(m.BarSeries,{id:e+n.label,groupId:t,name:n.label,xScaleType:m.ScaleType.Time,yScaleType:m.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:n._hide?[]:n.data,enableHistogramMode:!1,color:n.color,stackAccessors:n.stack?[0]:void 0,barSeriesStyle:b(n)});var y=n(40),x=n.n(y);const j=(e,t)=>!(null==e||!e.show)||null==t||!t.show,w=(e,t)=>{var n;const i=null!=e&&e.fillColor||void 0===(null==e?void 0:e.fill)?"white":t;return i&&x()(i).alpha(null!==(n=null==e?void 0:e.fill)&&void 0!==n?n:1).css()},C=({color:e,lines:t,points:n})=>{var i,o,r,s,a,l;return{line:{opacity:j(t,n)?1:0,stroke:e,strokeWidth:void 0!==(null==t?void 0:t.lineWidth)?Number(t.lineWidth):3,visible:j(t,n)},area:{fill:e,opacity:null!==(i=null==t?void 0:t.fill)&&void 0!==i?i:0,visible:null===(o=null!==(r=null==t?void 0:t.show)&&void 0!==r?r:null==n?void 0:n.show)||void 0===o||o},point:{fill:w(n,e),opacity:1,radius:null!==(s=null==n?void 0:n.radius)&&void 0!==s?s:3,stroke:e,strokeWidth:null!==(a=null==n?void 0:n.lineWidth)&&void 0!==a?a:2,visible:null!==(l=null==n?void 0:n.show)&&void 0!==l&&l,shape:"cross"===(null==n?void 0:n.symbol)?m.PointShape.X:null==n?void 0:n.symbol}}},T=({index:e,groupId:t,visData:n})=>{var i;return Object(h.jsx)(m.AreaSeries,{id:e+n.label,groupId:t,name:n.label,xScaleType:m.ScaleType.Time,yScaleType:m.ScaleType.Linear,xAccessor:0,yAccessors:[1],data:n._hide?[]:n.data,color:n.color,curve:null!==(i=n.lines)&&void 0!==i&&i.steps?m.CurveType.CURVE_STEP:m.CurveType.LINEAR,stackAccessors:n.stack?[0]:void 0,areaSeriesStyle:C(n)})};var k=n(34),O=n.n(k);const S={};[["ms","milliseconds","millisecond"],["s","seconds","second","sec"],["m","minutes","minute","min"],["h","hours","hour"],["d","days","day"],["w","weeks","week"],["M","months","month"],["quarter"],["y","years","year"]].forEach((e=>{const t=a.a.normalizeUnits(e[0]),n=a.a.duration(1,t).asMilliseconds();[].concat(t,e).forEach((e=>{S[e]=n}))}));const M=new RegExp("^(\\d+(?:\\.\\d*)?)?\\s*("+Object(d.keys)(S).join("|")+")$");function E(e){const t=e.match(M);if(t){if("M"===t[2]&&"1"!==t[1])throw new Error("Invalid interval. 1M is only valid monthly interval.");return parseFloat(t[1]||"1")*S[t[2]]}}function L(e,t){return n=>{let i=0;const o=n<0;for(n=Math.abs(n);n>=e&&i<t.length;)n/=e,i++;return`${Math.round(100*n)/100*(o?-1:1)}${t[i]}`}}const _=(e,t,n)=>{const o=t.getBounds(),r=function(e,t,n,i,o){if("auto"!==i)return i;const r=function(e){switch(!0){case e<=500:return"100ms";case e<=5e3:return"1s";case e<=7500:return"5s";case e<=15e3:return"10s";case e<=45e3:return"30s";case e<=18e4:return"1m";case e<=45e4:return"5m";case e<=12e5:return"10m";case e<=27e5:return"30m";case e<=72e5:return"1h";case e<=216e5:return"3h";case e<=864e5:return"12h";case e<=6048e5:return"24h";case e<=18144e5:return"1w";case e<36288e5:return"30d";default:return"1y"}}((t-e)/n),s=E(r),a=E(o);return void 0!==s&&void 0!==a&&s<a?o:r}(o.min&&o.min.valueOf()||0,o.max&&o.max.valueOf()||0,n.get("timelion:target_buckets")||200,e,n.get("timelion:min_interval")||"1ms"),s=(l=n,e=>function(e){const t=e.match(/(\d+)(ms|s|m|h|d|w|M|y|)/);if(null===t||null===t[1]||null===t[2])throw new Error(i.i18n.translate("timelion.panels.timechart.unknownIntervalErrorMessage",{defaultMessage:"Unknown interval"}));const n=a.a.duration(Number(t[1]),t[2]),o=l.get("dateFormat:scaled");for(let e=o.length-1;e>=0;e--){const t=o[e];if(!t[0]||n>=a.a.duration(t[0]))return t[1]}return l.get("dateFormat")}(e))(r);var l;return e=>O()(e).format(s)},A=e=>({...e,padding:20,paddingUnit:"pixel"}),B=e=>{var t,n;const i=(null!==(t=null===(n=e._global)||void 0===n?void 0:n.yaxes)&&void 0!==t?t:[]).reduce(((e,t)=>({...e,...t})),{});if(Object.keys(i).length)return(e=>{var t,n;const i={...e};if(i.units){const e=(o=i,{bits:L(1e3,["b","kb","mb","gb","tb","pb"]),"bits/s":L(1e3,["b/s","kb/s","mb/s","gb/s","tb/s","pb/s"]),bytes:L(1024,["B","KB","MB","GB","TB","PB"]),"bytes/s":L(1024,["B/s","KB/s","MB/s","GB/s","TB/s","PB/s"]),currency:e=>e.toLocaleString("en",{style:"currency",currency:o&&o.units&&o.units.prefix||"USD"}),percent(e){let t=Object(d.get)(o,"tickDecimals",0)-Object(d.get)(o,"units.tickDecimalsShift",0);return t<0?t=0:t>20&&(t=20),(100*e).toFixed(t)+"%"},custom(e){const t=function(e,t){const n=t.tickDecimals?Math.pow(10,t.tickDecimals):1,i=""+Math.round(e*n)/n;if(null!=t.tickDecimals){const e=i.indexOf("."),o=-1===e?0:i.length-e-1;if(o<t.tickDecimals)return(o?i:i+".")+(""+n).substr(1,t.tickDecimals-o)}return i}(e,o);return(o&&o.units&&o.units.prefix)+t+(o&&o.units&&o.units.suffix)}});i.tickFormatter=e[i.units.type]}else e.tickDecimals&&(i.tickFormatter=t=>t.toFixed(e.tickDecimals));var o;return{title:i.axisLabel,position:i.position,tickFormat:i.tickFormatter,domain:A({fit:void 0===i.min&&void 0===i.max,min:null!==(t=i.min)&&void 0!==t?t:NaN,max:null!==(n=i.max)&&void 0!==n?n:NaN})}})(i)},N=["#01A4A4","#C66","#D0D102","#616161","#00A1CB","#32742C","#F18D05","#113F8C","#61AE24","#D70060"];n(41);const D=()=>Object(h.jsx)(m.Axis,{id:"left",domain:A({fit:!1,min:NaN,max:NaN}),position:m.Position.Left,groupId:"1"}),P=({interval:e,seriesList:t,renderComplete:n,onBrushEvent:o,ariaLabel:r,syncTooltips:s,syncCursor:a})=>{var c;const b=Object(v.useKibana)(),y=Object(u.useRef)(null),x=t.list,j=Object(l.a)(),w=j.theme.useChartsBaseTheme(),C=Object(p.useActiveCursor)(j.activeCursor,y,{isDateHistogram:!0}),k=Object(u.useCallback)((({x:e})=>{e&&o({gte:e[0],lte:e[1]})}),[o]),O=Object(u.useCallback)((e=>{e&&n()}),[n]),S=Object(u.useMemo)((()=>Object(d.last)(Object(d.compact)(Object(d.map)(t.list,"_title")))||""),[t.list]),M=Object(u.useMemo)((()=>_(e,b.services.timefilter,b.services.uiSettings)),[e,b.services.timefilter,b.services.uiSettings]),E=Object(u.useMemo)((()=>{const e={floating:!0,floatingColumns:1,vAlign:m.Position.Top,hAlign:m.Position.Left,direction:m.LayoutDirection.Vertical};let t=!0;return x.forEach((n=>{var i;if(null!==(i=n._global)&&void 0!==i&&i.legend){var o,r;const{show:i=!0,position:s,noColumns:a=e.floatingColumns}=null!==(o=null===(r=n._global)||void 0===r?void 0:r.legend)&&void 0!==o?o:{};if((e=>/^(n|s)(e|w)$/s.test(e))(s)){const[t,n]=s.split("");e.vAlign="n"===t?m.Position.Top:m.Position.Bottom,e.hAlign="e"===n?m.Position.Right:m.Position.Left}i||(t=!1),void 0!==a&&(e.floatingColumns=a)}})),{legendPosition:e,showLegend:t}}),[x]);return Object(h.jsx)("div",{className:"timelionChart","data-test-subj":"timelionChart"},S&&Object(h.jsx)(f.EuiTitle,{className:"timelionChart__topTitle",size:"xxxs"},Object(h.jsx)("h4",null,S)),Object(h.jsx)(m.Chart,{ref:y,renderer:"canvas",size:{width:"100%"}},Object(h.jsx)(m.Tooltip,{snap:!0,headerFormatter:({value:e})=>M(e),type:m.TooltipType.VerticalCursor}),Object(h.jsx)(m.Settings,{debugState:null!==(c=window._echDebugStateFlag)&&void 0!==c&&c,onBrushEnd:k,showLegend:E.showLegend,legendValues:[m.LegendValue.CurrentAndLastValue],legendPosition:E.legendPosition,onRenderChange:O,onPointerUpdate:a?C:void 0,externalPointerEvents:{tooltip:{visible:s,placement:m.Placement.Right}},baseTheme:w,ariaLabel:r,ariaUseDefaultSummary:!r,locale:i.i18n.getLocale()}),Object(h.jsx)(m.Axis,{id:"bottom",position:m.Position.Bottom,showOverlappingTicks:!0,tickFormat:M,gridLine:{visible:!1}}),(e=>{const t=(e=>e.reduce(((e,t,n)=>{const i=B(t),o=`${t.yaxis?t.yaxis:1}`;if(e.every((e=>e.groupId!==o)))e.push({groupId:o,domain:A({fit:!1,min:NaN,max:NaN}),id:((null==i?void 0:i.position)||m.Position.Left)+n,position:m.Position.Left,...i});else if(i){const t=e.findIndex((e=>e.groupId===o));e[t]={...e[t],...i}}return e}),[]))(e),n=e=>Object(l.d)().getInstance("number").convert(e),i=t.map(((e,t)=>Object(h.jsx)(m.Axis,{groupId:e.groupId,key:t,id:e.id,title:e.title,position:e.position,tickFormat:e.tickFormat||n,gridLine:{visible:!t},domain:e.domain})));return i.length?i:Object(h.jsx)(D,null)})(x),x.map(((e,t)=>{const n={...e},i=e.bars?g:T;return n.color||(n.color=N[t%N.length]),Object(h.jsx)(i,{key:`${t}-${n.label}`,visData:n,index:x.length-t,groupId:`${n.yaxis?n.yaxis:1}`})}))))}}}]);