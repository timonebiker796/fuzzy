(window.visTypeTimelion_bundle_jsonpfunction=window.visTypeTimelion_bundle_jsonpfunction||[]).push([[2],{38:function(e,t,n){"use strict";var i,a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function s(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function r(e,t){for(var n={},i=[],a=0;a<e.length;a++){var r=e[a],l=t.base?r[0]+t.base:r[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var d=s(c),m={css:r[1],media:r[2],sourceMap:r[3]};-1!==d?(o[d].references++,o[d].updater(m)):o.push({identifier:c,updater:f(m,t),references:1}),i.push(c)}return i}function l(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var o=n.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var s=a(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var u,c=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,n,i){var a=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=c(t,a);else{var o=document.createTextNode(a),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function m(e,t,n){var i=n.css,a=n.media,o=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var p=null,g=0;function f(e,t){var n,i,a;if(t.singleton){var o=g++;n=p||(p=l(t)),i=d.bind(null,n,o,!1),a=d.bind(null,n,o,!0)}else n=l(t),i=m.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=r(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var a=s(n[i]);o[a].references--}for(var l=r(e,t),u=0;u<n.length;u++){var c=s(n[u]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=l}}}},39:function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,i,a,o=e[1]||"",s=e[3];if(!s)return o;if(t&&"function"==typeof btoa){var r=(n=s,i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(a," */")),l=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[o].concat(l).concat([r]).join("\n")}return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(a[s]=!0)}for(var r=0;r<e.length;r++){var l=[].concat(e[r]);i&&a[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},46:function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(47);case"v8light":return n(49)}},47:function(e,t,n){var i=n(38),a=n(48);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},48:function(e,t,n){(t=n(39)(!1)).push([e.i,".timExpressionInput{display:flex;flex:1 1 auto;flex-direction:column;margin-top:16px}.timExpressionInput__editor{flex:1;padding-top:8px;position:relative}.timExpressionInput__absolute{bottom:0;left:0;position:absolute;right:0;top:0}@media only screen and (max-width:574px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}@media only screen and (min-width:575px)and (max-width:767px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}@media only screen and (min-width:768px)and (max-width:991px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}.visEditor--timelion .visEditorSidebar__timelionOptions{display:flex;flex:1 1 auto;flex-direction:column}",""]),e.exports=t},49:function(e,t,n){var i=n(38),a=n(50);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},50:function(e,t,n){(t=n(39)(!1)).push([e.i,".timExpressionInput{display:flex;flex:1 1 auto;flex-direction:column;margin-top:16px}.timExpressionInput__editor{flex:1;padding-top:8px;position:relative}.timExpressionInput__absolute{bottom:0;left:0;position:absolute;right:0;top:0}@media only screen and (max-width:574px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}@media only screen and (min-width:575px)and (max-width:767px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}@media only screen and (min-width:768px)and (max-width:991px){.timExpressionInput__editor{flex:auto;height:240px;max-height:240px}}.visEditor--timelion .visEditorSidebar__timelionOptions{display:flex;flex:1 1 auto;flex-direction:column}",""]),e.exports=t},55:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C}));var i=n(2),a=n(6),o=n(15),s=n(35),r=n(31),l=n(36),u=n(5),c=n(7),d=n(17);let m=function(e){return e.ARGUMENTS="arguments",e.ARGUMENT_VALUE="argument_value",e.FUNCTIONS="functions",e}({});function p(e,t){return e>=t.min&&e<=t.max}function g(e,t=[]){if(!e)return[];const n=e.chainable?e.args.slice(1):e.args.slice(0),i=t.map((e=>e.name));return n.filter((e=>!e.hidden&&!i.includes(e.name)))}async function f(e,t,n,i){try{const a=await Object(d.a)(e);return await async function(e,t,n,i){const a=e.functions.find((({location:e})=>p(t,e)));if(!a)return;const o=n.find((({name:e})=>e===a.function));if(!o)return;const s=a.location.min+a.function.length+2;if(t<s)return{list:[o],type:m.FUNCTIONS};const r=a.arguments.find((e=>p(t,e.location)));if(r&&"namedArg"===r.type&&p(t,r.value.location)){const{function:e,arguments:t}=a,{name:n,value:{text:s}}=r;let l;if(i.hasDynamicSuggestionsForArgument(e,n))l=await i.getDynamicSuggestionsForArgument(e,n,t,s);else{const{suggestions:e}=o.args.find((e=>e.name===r.name))||{};l=i.getStaticSuggestionsForInput(s,e)}return{list:l,type:m.ARGUMENT_VALUE}}return{list:g(o,a.arguments).filter((e=>"namedArg"===(null==r?void 0:r.type)?Object(u.startsWith)(e.name,r.name):!r||Object(u.startsWith)(e.name,r.text))),type:m.ARGUMENTS}}(a,n,t,i)}catch(e){let n;try{n=JSON.parse(e.message)}catch(e){return}switch(n.type){case"incompleteFunction":{let e;return e=n.function?t.filter((e=>Object(u.startsWith)(e.name,n.function))):t,{list:e,type:m.FUNCTIONS}}case"incompleteArgument":{const{currentFunction:e,currentArgs:i}=n;return{list:g(t.find((t=>t.name===e)),i),type:m.ARGUMENTS}}case"incompleteArgumentValue":{const{name:e,currentFunction:a,currentArgs:o}=n;let s=[];if(i.hasDynamicSuggestionsForArgument(a,e))s=await i.getDynamicSuggestionsForArgument(a,e,o);else{const n=t.find((e=>e.name===a));if(n){const t=n.args.find((t=>t.name===e));t&&t.suggestions&&(s=t.suggestions)}}return{list:s,type:m.ARGUMENT_VALUE}}}}}var v=n(18),x=n(0);const h="timelion_expression";function b({value:e,setValue:t}){const n=Object(i.useRef)([]),u=Object(o.useKibana)(),d=Object(i.useMemo)(v.a,[]),p=Object(i.useCallback)((async(e,t)=>{const i=e.getValue(),a=e.getWordUntilPosition(t),o=new r.monaco.Range(t.lineNumber,a.startColumn,t.lineNumber,a.endColumn),s=await f(i,n.current,t.column-1,d);return{suggestions:s?s.list.map((e=>function(e,t,n){let i,a,o=r.monaco.languages.CompletionItemKind.Method,s=e.name,l="";switch(t){case m.ARGUMENTS:a={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"},o=r.monaco.languages.CompletionItemKind.Property,s=`${s}=`,l=`${c.i18n.translate("timelion.expressionSuggestions.argument.description.acceptsText",{defaultMessage:"Accepts"})}: ${e.types}`;break;case m.FUNCTIONS:a={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"},o=r.monaco.languages.CompletionItemKind.Function,s=`${s}($0)`,i=r.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,l=`(${e.chainable?c.i18n.translate("timelion.expressionSuggestions.func.description.chainableHelpText",{defaultMessage:"Chainable"}):c.i18n.translate("timelion.expressionSuggestions.func.description.dataSourceHelpText",{defaultMessage:"Data source"})})`;break;case m.ARGUMENT_VALUE:const t=e.insertText;t&&(s=`${t},`),a={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"},o=r.monaco.languages.CompletionItemKind.Property,l=e.help||""}return{detail:l,insertText:s,insertTextRules:i,kind:o,label:e.name,documentation:e.help,command:a,range:n}}(e,s.type,o))):[]}}),[d]),g=Object(i.useCallback)((async(e,t)=>{const i=await f(e.getValue(),n.current,t.column-1,d);return{contents:i?i.list.map((e=>({value:e.help}))):[]}}),[d]);return Object(i.useEffect)((()=>{const e=new AbortController;return u.services.http&&u.services.http.get("../internal/timelion/functions",{signal:e.signal}).then((e=>{n.current=e})),()=>{e.abort()}}),[u.services.http]),Object(x.jsx)("div",{className:"timExpressionInput"},Object(x.jsx)(a.EuiFormLabel,null,Object(x.jsx)(s.FormattedMessage,{id:"timelion.vis.expressionLabel",defaultMessage:"Timelion expression"})),Object(x.jsx)("div",{className:"timExpressionInput__editor"},Object(x.jsx)("div",{className:"timExpressionInput__absolute","data-test-subj":"timelionCodeEditor"},Object(x.jsx)(l.CodeEditor,{languageId:h,value:e,onChange:t,suggestionProvider:{triggerCharacters:[".",",","(","=",":"],provideCompletionItems:p},hoverProvider:{provideHover:g},options:{fixedOverflowWidgets:!0,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"indent"},languageConfiguration:{autoClosingPairs:[{open:"(",close:")"}]}}))))}r.monaco.languages.register({id:h});var y=n(3),j=n(16);const{isValidEsInterval:_}=y.search.aggs,E=[{label:c.i18n.translate("timelion.vis.interval.auto",{defaultMessage:"Auto"}),value:"auto"},{label:c.i18n.translate("timelion.vis.interval.second",{defaultMessage:"1 second"}),value:"1s"},{label:c.i18n.translate("timelion.vis.interval.minute",{defaultMessage:"1 minute"}),value:"1m"},{label:c.i18n.translate("timelion.vis.interval.hour",{defaultMessage:"1 hour"}),value:"1h"},{label:c.i18n.translate("timelion.vis.interval.day",{defaultMessage:"1 day"}),value:"1d"},{label:c.i18n.translate("timelion.vis.interval.week",{defaultMessage:"1 week"}),value:"1w"},{label:c.i18n.translate("timelion.vis.interval.month",{defaultMessage:"1 month"}),value:"1M"},{label:c.i18n.translate("timelion.vis.interval.year",{defaultMessage:"1 year"}),value:"1y"}];function w({value:e,setValue:t,setValidity:n}){const o=Object(i.useCallback)((e=>{t(e.trim())}),[t]),s=Object(i.useCallback)((e=>{t(e[0]&&e[0].value||"")}),[t]),r=Object(i.useMemo)((()=>[E.find((t=>t.value===e))||{label:e,value:e}]),[e]),l=E.some((t=>t.value===e))||_(e);return Object(j.useValidation)(n,l),Object(x.jsx)(a.EuiFormRow,{display:"rowCompressed",fullWidth:!0,helpText:c.i18n.translate("timelion.vis.selectIntervalHelpText",{defaultMessage:"Select an option or create a custom value. Examples: 30s, 20m, 24h, 2d, 1w, 1M"}),isInvalid:!l,error:!l&&c.i18n.translate("timelion.vis.invalidIntervalErrorMessage",{defaultMessage:"Invalid interval format."}),label:c.i18n.translate("timelion.vis.intervalLabel",{defaultMessage:"Interval"})},Object(x.jsx)(a.EuiComboBox,{compressed:!0,fullWidth:!0,isInvalid:!l,onChange:s,onCreateOption:o,options:E,selectedOptions:r,singleSelection:{asPlainText:!0},placeholder:c.i18n.translate("timelion.vis.selectIntervalPlaceholder",{defaultMessage:"Select an interval"}),"data-test-subj":"timelionIntervalComboBox"}))}function C({services:e,stateParams:t,setValue:n,setValidity:s}){const r=Object(i.useCallback)((e=>n("interval",e)),[n]),l=Object(i.useCallback)((e=>n("expression",e)),[n]);return Object(x.jsx)(o.KibanaContextProvider,{services:e},Object(x.jsx)(a.EuiPanel,{className:"visEditorSidebar__timelionOptions",paddingSize:"s"},Object(x.jsx)(w,{value:t.interval,setValue:r,setValidity:s}),Object(x.jsx)(b,{value:t.expression,setValue:l})))}n(46)}}]);