/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.logsShared_bundle_jsonpfunction=window.logsShared_bundle_jsonpfunction||[]).push([[8,2],{117:function(e,t,r){"use strict";r.r(t),r.d(t,"LogAIAssistant",(function(){return u}));var s=r(1),o=r(94),n=r(95);const a=n.i18n.translate("xpack.logsShared.logFlyout.explainLogMessageTitle",{defaultMessage:"What's this message?"}),i=n.i18n.translate("xpack.logsShared.logFlyout.similarLogMessagesTitle",{defaultMessage:"How do I find similar log messages?"});var l=r(17);const u=({doc:e,observabilityAIAssistant:{ObservabilityAIAssistantContextualInsight:t,getContextualInsightMessages:r}})=>{const n=Object(s.useMemo)((()=>{if(e)return r({message:"Can you explain what this log message means? Where it could be coming from, whether it is expected and whether it is an issue.",instructions:JSON.stringify({logEntry:{fields:e.fields}})})}),[e,r]),u=Object(s.useMemo)((()=>{var t;if(!e)return;const s=null===(t=e.fields.find((e=>"message"===e.field)))||void 0===t?void 0:t.value[0];return r({message:"I'm looking at a log entry. Can you construct a Kibana KQL query that I can enter in the search bar that gives me similar log entries, based on the message field?",instructions:JSON.stringify({message:s})})}),[r,e]);return Object(l.jsx)(o.EuiFlexGroup,{direction:"column",gutterSize:"m"},t&&n?Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(t,{title:a,messages:n,dataTestSubj:"obsAiAssistantInsightButtonExplainLogMessage"})):null,t&&u?Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(t,{title:i,messages:u,dataTestSubj:"obsAiAssistantInsightButtonSimilarLogMessage"})):null)};t.default=u},118:function(e,t,r){"use strict";r.r(t),r.d(t,"useLogEntryFlyout",(function(){return W})),r.d(t,"LogEntryFlyout",(function(){return H}));var s=r(94),o=r(95),n=r(96),a=r(31),i=r(1),l=r.n(i),u=r(26),c=r(6),d=r(0),g=r(7),b=r(3),j=r(59);const m=d.type({logView:b.o,logEntryId:d.string}),f=d.type({id:d.string,index:d.string,fields:d.array(g.h),cursor:g.g}),h=d.intersection([d.type({data:d.union([f,d.null])}),d.partial({errors:d.array(j.a)})]);var y=r(12);const p=Object(y.b)(null,Object(c.b)(h));var O=r(15);const x=Object(O.euiStyled)(s.EuiFlyoutBody)`
  & .euiFlyoutBody__overflow {
    display: flex;
    flex-direction: column;
  }

  & .euiFlyoutBody__overflowContent {
    align-items: center;
    align-self: stretch;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    justify-content: center;
    overflow: hidden;
  }
`;var E=r(17);const v=({errors:e,onRetry:t,title:r})=>{const o=e.some((e=>"aborted"!==e.type))?"danger":"warning";return Object(E.jsx)(s.EuiCallOut,{color:o,iconType:"warning",title:r},null==e?void 0:e.map(((e,t)=>Object(E.jsx)(S,{key:t,error:e}))),t?Object(E.jsx)(s.EuiButton,{"data-test-subj":"infraDataSearchErrorCalloutRetryButton",color:o,size:"s",onClick:t},Object(E.jsx)(n.FormattedMessage,{id:"xpack.logsShared.dataSearch.loadingErrorRetryButtonLabel",defaultMessage:"Retry"})):null)},S=({error:e})=>"aborted"===e.type?Object(E.jsx)(M,{error:e}):"shardFailure"===e.type?Object(E.jsx)(I,{error:e}):Object(E.jsx)(F,{error:e}),M=({})=>Object(E.jsx)(n.FormattedMessage,{tagName:"p",id:"xpack.logsShared.dataSearch.abortedRequestErrorMessage",defaultMessage:"The request was aborted."}),F=({error:e})=>{var t;return Object(E.jsx)("p",null,null!==(t=e.message)&&void 0!==t?t:`${e}`)},I=({error:e})=>Object(E.jsx)(n.FormattedMessage,{tagName:"p",id:"xpack.logsShared.dataSearch.shardFailureErrorMessage",defaultMessage:"Index {indexName}: {errorMessage}",values:{indexName:e.shardInfo.index,errorMessage:e.message}}),w=({label:e,maxValue:t,onCancel:r,value:o})=>{const n=Object(i.useMemo)((()=>Number.isFinite(t)&&Number.isFinite(o)?`${o} / ${t}`:void 0),[o,t]);return Object(E.jsx)(s.EuiFlexGroup,{alignItems:"center"},Object(E.jsx)(s.EuiFlexItem,null,Object(E.jsx)(s.EuiProgress,{label:e,size:"s",max:t,value:o,valueText:n})),r?Object(E.jsx)(s.EuiFlexItem,{grow:!1},Object(E.jsx)(s.EuiButtonIcon,{"data-test-subj":"logsSharedDataSearchProgressButton",color:"danger",iconType:"cross",onClick:r,title:k,"aria-label":k})):null)},k=o.i18n.translate("xpack.logsShared.dataSearch.cancelButtonLabel",{defaultMessage:"Cancel request"});var C=r(117),L=r(56),R=r.n(L),T=r(41),A=r(97);const _=({logEntry:e})=>{const{services:{share:{url:{locators:t}}}}=Object(u.a)(),{hide:r,isVisible:o,toggle:a}=(e=>{const[t,r]=Object(i.useState)(!1),s=Object(i.useCallback)((()=>r(!1)),[]),o=Object(i.useCallback)((()=>r(!0)),[]),n=Object(i.useCallback)((()=>r((e=>!e))),[]);return Object(i.useMemo)((()=>({hide:s,isVisible:t,show:o,toggle:n})),[s,t,o,n])})(),l=Object(i.useMemo)((()=>V(e)),[e]),c=N({locators:t})(e),d=Object(A.useLinkProps)({app:"apm",...l||{}}),g=Object(i.useMemo)((()=>[Object(E.jsx)(s.EuiContextMenuItem,R()({"data-test-subj":"logEntryActionsMenuItem uptimeLogEntryActionsMenuItem",disabled:!c,icon:"uptimeApp",key:"uptimeLink"},c),Object(E.jsx)(n.FormattedMessage,{id:"xpack.logsShared.logEntryActionsMenu.uptimeActionLabel",defaultMessage:"View status in Uptime"})),Object(E.jsx)(s.EuiContextMenuItem,R()({"data-test-subj":"logEntryActionsMenuItem apmLogEntryActionsMenuItem",disabled:!l,icon:"apmApp",key:"apmLink"},d),Object(E.jsx)(n.FormattedMessage,{id:"xpack.logsShared.logEntryActionsMenu.apmActionLabel",defaultMessage:"View in APM"}))]),[l,d,c]),b=Object(i.useMemo)((()=>g.length>0),[g]);return Object(E.jsx)(s.EuiPopover,{anchorPosition:"downRight",button:Object(E.jsx)(s.EuiButton,{"data-test-subj":"logEntryActionsMenuButton",disabled:!b,iconSide:"right",iconType:"arrowDown",onClick:a},Object(E.jsx)(n.FormattedMessage,{id:"xpack.logsShared.logEntryActionsMenu.buttonLabel",defaultMessage:"Investigate"})),closePopover:r,id:"logEntryActionsMenu",isOpen:o,panelPaddingSize:"none"},Object(E.jsx)(s.EuiContextMenuPanel,{items:g}))},N=({locators:e})=>t=>{var r,s,o,n,a,i,l,u;const c=e.get(T.b);if(!c)return;const d=null===(r=t.fields.find((({field:e})=>"host.ip"===e)))||void 0===r||null===(s=r.value)||void 0===s?void 0:s[0],g=null===(o=t.fields.find((({field:e})=>"container.id"===e)))||void 0===o||null===(n=o.value)||void 0===n?void 0:n[0],b=null===(a=t.fields.find((({field:e})=>"kubernetes.pod.uid"===e)))||void 0===a||null===(i=a.value)||void 0===i?void 0:i[0],j=null===(l=t.fields.find((({field:e})=>"host.name"===e)))||void 0===l||null===(u=l.value)||void 0===u?void 0:u[0],m={..."string"==typeof d&&{ip:d},..."string"==typeof g&&{container:g},..."string"==typeof b&&{pod:b},..."string"==typeof j&&{host:j}};return 0!==Object.keys(m).length?(({href:e,onClick:t})=>({href:e,onClick:e=>{e.defaultPrevented||!(e=>!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey))(e)&&(e=>0===e.button)(e)&&(e.preventDefault(),t())}}))({href:c.getRedirectUrl(m),onClick:()=>c.navigate(m)}):void 0},V=e=>{var t,r;const s=null===(t=e.fields.find((({field:e,value:t})=>"string"==typeof t[0]&&"trace.id"===e)))||void 0===t||null===(r=t.value)||void 0===r?void 0:r[0];if("string"!=typeof s)return;const o=e.fields.find((({field:e})=>"@timestamp"===e)),n=o?o.value[0]:null,{rangeFrom:a,rangeTo:i}="number"==typeof n?(()=>{const e=new Date(n),t=new Date(n);return e.setMinutes(e.getMinutes()-10),t.setMinutes(t.getMinutes()+10),{rangeFrom:e.toISOString(),rangeTo:t.toISOString()}})():{rangeFrom:"now-1y",rangeTo:"now"};return{app:"apm",pathname:D({traceId:s,rangeFrom:a,rangeTo:i})}};function D({traceId:e,rangeFrom:t,rangeTo:r}){return`/link-to/trace/${e}?`+new URLSearchParams({rangeFrom:t,rangeTo:r}).toString()}var B=r(29),q=r(102);const P=({logEntry:e,onSetFieldFilter:t})=>{const r=Object(i.useMemo)((()=>t?r=>()=>{d.array(B.c).is(r.value)&&(null==t||t({language:"kuery",query:`${Q(r.field)}:${r.value.map(Q).join(" OR ")}`},e.id,e.cursor))}:void 0),[e,t]),n=Object(i.useMemo)((()=>[{field:"field",name:o.i18n.translate("xpack.logsShared.logFlyout.fieldColumnLabel",{defaultMessage:"Field"}),sortable:!0},{actions:[{type:"icon",icon:"filter",name:G,description:z,available:()=>!!r,onClick:e=>null==r?void 0:r(e)()}]},{field:"value",name:o.i18n.translate("xpack.logsShared.logFlyout.valueColumnLabel",{defaultMessage:"Value"}),render:(e,t)=>Object(E.jsx)(q.a,{highlightTerms:U,isActiveHighlight:!1,value:t.value})}]),[r]);return Object(E.jsx)(s.EuiInMemoryTable,{columns:n,items:e.fields,search:K,sorting:$})},U=[],$={sort:{field:"field",direction:"asc"}},K={box:{incremental:!0,schema:!0}},G=o.i18n.translate("xpack.logsShared.logFlyout.filterAriaLabel",{defaultMessage:"Filter"}),z=o.i18n.translate("xpack.logsShared.logFlyout.setFilterTooltip",{defaultMessage:"View event with filter"}),Q=e=>"string"==typeof e?`"${e.replace(/"/g,'\\"')}"`:e,W=e=>{const t=Object(i.useRef)(),{services:{http:r,data:s,share:o,uiSettings:n,application:l,observabilityAIAssistant:c},overlays:{openFlyout:d}}=Object(u.a)(),g=Object(i.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.close()}),[]),b=Object(i.useCallback)((i=>{const{Provider:u}=Object(a.createKibanaReactContext)({http:r,data:s,share:o,uiSettings:n,application:l,observabilityAIAssistant:c});t.current=d(Object(E.jsx)(u,null,Object(E.jsx)(H,{logEntryId:i,onCloseFlyout:g,logViewReference:e})))}),[l,g,s,r,e,c,d,o,n]);return Object(i.useEffect)((()=>()=>{g()}),[g]),{openLogEntryFlyout:b,closeLogEntryFlyout:g}},H=({logEntryId:e,onCloseFlyout:t,onSetFieldFilter:r,logViewReference:o})=>{var a;const{cancelRequest:c,errors:d,fetchLogEntry:g,isRequestRunning:b,loaded:j,logEntry:f,total:h}=(({logViewReference:e,logEntryId:t})=>{const{search:r,requests$:s}=Object(y.c)({getRequest:Object(i.useCallback)((()=>t&&e?{request:{params:m.encode({logView:e,logEntryId:t})},options:{strategy:"infra-log-entry"}}:null),[e,t]),parseResponses:p}),{cancelRequest:o,isRequestRunning:n,isResponsePartial:a,latestResponseData:l,latestResponseErrors:u,loaded:c,total:d}=Object(y.e)(s);return{cancelRequest:o,errors:u,fetchLogEntry:r,isRequestRunning:n,isResponsePartial:a,loaded:c,logEntry:null!=l?l:null,total:d}})({logViewReference:o,logEntryId:e}),{observabilityAIAssistant:O}=Object(u.a)().services;return Object(i.useEffect)((()=>{o&&e&&g()}),[g,o,e]),Object(E.jsx)(s.EuiFlyout,{onClose:t,size:"m"},Object(E.jsx)(s.EuiFlyoutHeader,{hasBorder:!0},Object(E.jsx)(s.EuiFlexGroup,{alignItems:"center"},Object(E.jsx)(s.EuiFlexItem,null,Object(E.jsx)(s.EuiTitle,{size:"s"},Object(E.jsx)("h3",{id:"flyoutTitle"},Object(E.jsx)(n.FormattedMessage,{defaultMessage:"Details for log entry {logEntryId}",id:"xpack.logsShared.logFlyout.flyoutTitle",values:{logEntryId:e?Object(E.jsx)("code",null,e):""}}))),f?Object(E.jsx)(l.a.Fragment,null,Object(E.jsx)(s.EuiSpacer,{size:"s"}),Object(E.jsx)(s.EuiTextColor,{color:"subdued"},Object(E.jsx)(n.FormattedMessage,{id:"xpack.logsShared.logFlyout.flyoutSubTitle",defaultMessage:"From index {indexName}",values:{indexName:Object(E.jsx)("code",null,f.index)}}))):null),Object(E.jsx)(s.EuiFlexItem,{style:{padding:8},grow:!1},f?Object(E.jsx)(_,{logEntry:f}):null))),b?Object(E.jsx)(x,null,Object(E.jsx)("div",{style:{width:"75%"}},Object(E.jsx)(w,{label:J,maxValue:h,onCancel:c,value:j}))):f?Object(E.jsx)(s.EuiFlyoutBody,{banner:(null!==(a=null==d?void 0:d.length)&&void 0!==a?a:0)>0?Object(E.jsx)(v,{title:Y,errors:null!=d?d:[],onRetry:g}):void 0},Object(E.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"m"},O&&Object(E.jsx)(s.EuiFlexItem,{grow:!1},Object(E.jsx)(C.default,{observabilityAIAssistant:O,doc:f})),Object(E.jsx)(s.EuiFlexItem,{grow:!1},Object(E.jsx)(P,{logEntry:f,onSetFieldFilter:r})))):Object(E.jsx)(x,null,Object(E.jsx)("div",{style:{width:"75%"}},Object(E.jsx)(v,{title:Y,errors:null!=d?d:[],onRetry:g}))))};t.default=H;const J=o.i18n.translate("xpack.logsShared.logFlyout.loadingMessage",{defaultMessage:"Searching log entry in shards"}),Y=o.i18n.translate("xpack.logsShared.logFlyout.loadingErrorCalloutTitle",{defaultMessage:"Error while searching the log entry"})},126:function(e,t,r){"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var s,o,n;if(Array.isArray(t)){if((s=t.length)!=r.length)return!1;for(o=s;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((s=(n=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=s;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,n[o]))return!1;for(o=s;0!=o--;){var a=n[o];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},127:function(e,t,r){"use strict";r.r(t),r.d(t,"LogStream",(function(){return w})),r.d(t,"LogStreamContent",(function(){return k}));var s=r(98),o=r(15),n=r(31),a=r(20),i=r(1),l=r.n(i),u=r(53),c=r.n(u),d=r(3),g=r(47),b=r(37),j=r(70),m=r(99),f=r(118),h=(r(110),r(108),r(46),r(112),r(113),r(114),r(115),r(116),r(119)),y=r(94),p=r(96),O=r(10),x=r.n(O),E=r(126),v=r.n(E);class resettable_error_boundary_ResettableErrorBoundary extends l.a.Component{constructor(...e){super(...e),x()(this,"state",{latestError:void 0}),x()(this,"resetError",(()=>{this.setState((e=>({...e,latestError:void 0})))}))}componentDidUpdate({resetOnChange:e}){const{resetOnChange:t}=this.props,{latestError:r}=this.state;null==r||v()(t,e)||this.resetError()}static getDerivedStateFromError(e){return{latestError:e}}render(){const{children:e,renderError:t}=this.props,{latestError:r}=this.state;return null!=r?t({latestError:r,resetError:this.resetError}):e}}var S=r(17);const M=({children:e,resetOnChange:t=null})=>Object(S.jsx)(resettable_error_boundary_ResettableErrorBoundary,{renderError:I,resetOnChange:t},e),F=({error:e})=>e instanceof s.KQLSyntaxError?Object(S.jsx)(y.EuiEmptyPrompt,{title:Object(S.jsx)(p.FormattedMessage,{id:"xpack.logsShared.logStream.kqlErrorTitle",defaultMessage:"Invalid KQL expression",tagName:"h2"}),body:Object(S.jsx)(y.EuiCodeBlock,{className:"eui-textLeft"},e.message)}):Object(S.jsx)(y.EuiEmptyPrompt,{title:Object(S.jsx)(p.FormattedMessage,{id:"xpack.logsShared.logStream.unknownErrorTitle",defaultMessage:"An error occurred",tagName:"h2"}),body:Object(S.jsx)(y.EuiCodeBlock,{className:"eui-textLeft"},e.message)}),I=({latestError:e})=>Object(S.jsx)(F,{error:e}),w=({height:e=400,...t})=>Object(S.jsx)(C,{style:{height:e}},Object(S.jsx)(M,{resetOnChange:[t.query]},Object(S.jsx)(k,t))),k=({logView:e,startTimestamp:t,endTimestamp:r,query:o,filters:l,center:u,highlight:y,columns:p,startDateExpression:O="",endDateExpression:x="",showFlyoutAction:E=!1,isStreaming:v=!1})=>{const M=Object(i.useMemo)((()=>p?function(e){return e.map((e=>{switch(e.type){case"timestamp":{const{width:t,header:r,render:s}=e;return{timestampColumn:{id:"___#timestamp",width:t,header:r,render:s}}}case"message":{const{width:t,header:r,render:s}=e;return{messageColumn:{id:"___#message",width:t,header:r,render:s}}}case"field":{const{width:t,header:r,render:s}=e;return{fieldColumn:{id:`___#${e.field}`,field:e.field,width:t,header:r,render:s}}}}}))}(p):void 0),[p]),{services:{http:F,data:I,share:w}}=Object(n.useKibana)();if(null==F||null==I||null==w)throw new Error("<LogStream /> cannot access kibana core services.\n\nEnsure the component is mounted within kibana-react's <KibanaContextProvider> hierarchy.\nRead more at https://github.com/elastic/kibana/blob/main/src/plugins/kibana_react/README.md\"\n");const{openLogEntryFlyout:k}=Object(f.useLogEntryFlyout)(e),C=(()=>{const[e]=Object(n.useUiSetting$)(m.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS),[t]=Object(n.useUiSetting$)(m.UI_SETTINGS.QUERY_STRING_OPTIONS),[r]=Object(n.useUiSetting$)(m.UI_SETTINGS.DATEFORMAT_TZ),[s]=Object(n.useUiSetting$)(m.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX);return Object(i.useMemo)((()=>({allowLeadingWildcards:e,queryStringOptions:t,dateFormatTZ:r,ignoreFilterIfFieldNotInIndex:s})),[e,r,s,t])})(),T=Object(i.useMemo)((()=>new j.a(I.dataViews,F,I.search.search,d.h)),[I.dataViews,I.search.search,F]),{derivedDataView:A,isLoading:_,load:N,resolvedLogView:V}=Object(b.b)({initialLogViewReference:e,logViews:T}),D=Object(i.useMemo)((()=>"object"==typeof o&&"bool"in o?L(o,Object(s.buildEsQuery)(A,[],null!=l?l:[],C)):Object(s.buildEsQuery)(A,R(o),null!=l?l:[],C)),[A,l,C,o]),{entries:B,fetchEntries:q,fetchNewestEntries:P,fetchNextEntries:U,fetchPreviousEntries:$,hasMoreAfter:K,hasMoreBefore:G,lastLoadedTime:z,isLoadingMore:Q,isReloading:W}=Object(g.b)({logViewReference:e,startTimestamp:t,endTimestamp:r,query:D,center:u,columns:M}),H=Object(i.useMemo)((()=>_||W),[W,_]),J=Object(i.useMemo)((()=>V?null!=M?M:V.columns:[]),[V,M]),Y=Object(i.useMemo)((()=>H?[]:B.map((e=>({kind:"logEntry",logEntry:e,highlights:[]})))),[B,H]),Z=c()(t),X=c()(r),ee=c()(D);Object(i.useEffect)((()=>{N()}),[N]),Object(i.useEffect)((()=>{const e=Z!==t||X!==r;(!Z||!X||D!==ee)&&q(),e&&(v?P():q())}),[r,q,P,v,D,X,ee,Z,t]);const te=Object(i.useCallback)((({fromScroll:e,pagesBeforeStart:t,pagesAfterEnd:r})=>{e&&(Q||(t<2?$():r<2&&U()))}),[Q,$,U]);return Object(S.jsx)(h.ScrollableLogTextStreamView,{target:u||(B.length?B[B.length-1].cursor:null),columnConfigurations:J,items:Y,scale:"medium",wrap:!0,isReloading:H,isLoadingMore:Q,isStreaming:v,hasMoreBeforeStart:G,hasMoreAfterEnd:K,lastLoadedTime:z,jumpToTarget:a.noop,reportVisibleInterval:te,reloadItems:q,onOpenLogEntryFlyout:E?k:void 0,highlightedItem:null!=y?y:null,currentHighlightKey:null,startDateExpression:O,endDateExpression:x,updateDateRange:a.noop,startLiveStreaming:a.noop,hideScrollbar:!1})},C=o.euiStyled.div`
  display: flex;
  background-color: ${e=>e.theme.eui.euiColorEmptyShade};
`,L=(e,t)=>({bool:{must:[...e.bool.must,...t.bool.must],filter:[...e.bool.filter,...t.bool.filter],should:[...e.bool.should,...t.bool.should],must_not:[...e.bool.must_not,...t.bool.must_not]}}),R=e=>null==e?[]:"string"==typeof e?[{language:"kuery",query:e}]:"language"in e&&"query"in e?[e]:[];t.default=w}}]);