/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(e){function t(t){for(var n,i,o=t[0],s=t[1],a=0,u=[];a<o.length;a++)i=o[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);u.length;)u.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise((function(t,i){n=r[e]=[t,i]}));t.push(n[2]=o);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.src=function(e){return i.p+"fileUpload.chunk."+e+".js"}(e);var c=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(u);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+o+")",c.name="ChunkLoadError",c.type=i,c.request=o,n[1](c)}r[e]=void 0}};var u=setTimeout((function(){s({type:"timeout",target:a})}),12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var o=window.fileUpload_bundle_jsonpfunction=window.fileUpload_bundle_jsonpfunction||[],s=o.push.bind(o);o.push=t,o=o.slice();for(var a=0;a<o.length;a++)t(o[a]);var c=s;i(i.s=16)}([function(e,t,n){e.exports=n(15)(2)},function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u}));const r="fileUpload:maxFileSize",i=Math.pow(2,20),o="100MB",s=104857600,a=1073741274,c="0,0.[0] b",u={DELIMITED:"delimited",NDJSON:"ndjson",SEMI_STRUCTURED_TEXT:"semi_structured_text"}},function(e,t,n){"use strict";let r,i;function o(e,t){r=e,i=t}n.d(t,"g",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l}));const s=()=>r.docLinks,a=()=>i.data.dataViews,c=()=>r.http,u=()=>r.settings.client,d=()=>r.settings,l=()=>r.theme},function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f})),n.d(t,"g",(function(){return _})),n.d(t,"c",(function(){return h})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return g})),n.d(t,"e",(function(){return y}));var r=n(2);let i;async function o(){return void 0!==i||(i=new Promise((async(e,t)=>{try{const{GeoUploadWizard:t,importerFactory:i,IndexNameForm:o}=await n.e(1).then(n.bind(null,222));e({GeoUploadWizard:t,importerFactory:i,getHttp:r.c,IndexNameForm:o})}catch(e){t(e)}}))),i}var s=n(0),a=n.n(s),c=n(7),u=n.n(c),d=n(8),l=n(5);class geo_upload_wizard_async_wrapper_GeoUploadWizardAsyncWrapper extends u.a.Component{constructor(...e){super(...e),a()(this,"state",{GeoUploadWizard:null}),a()(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,o().then((e=>{this._isMounted&&this.setState({GeoUploadWizard:e.GeoUploadWizard})}))}componentWillUnmount(){this._isMounted=!1}render(){const{GeoUploadWizard:e}=this.state;return e?Object(l.jsx)(e,this.props):Object(l.jsx)(d.EuiSkeletonText,{lines:3})}}class index_name_form_async_wrapper_IndexNameFormAsyncWrapper extends u.a.Component{constructor(...e){super(...e),a()(this,"state",{IndexNameForm:null}),a()(this,"_isMounted",!1)}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0,o().then((e=>{this._isMounted&&this.setState({IndexNameForm:e.IndexNameForm})}))}render(){const{IndexNameForm:e}=this.state;return e?Object(l.jsx)(e,this.props):Object(l.jsx)(d.EuiSkeletonText,{lines:3})}}const p=geo_upload_wizard_async_wrapper_GeoUploadWizardAsyncWrapper,f=index_name_form_async_wrapper_IndexNameFormAsyncWrapper;async function _(e,t){return(await o()).importerFactory(e,t)}async function h(e,t={}){const{getHttp:n}=await o(),r=JSON.stringify(e);return await n().fetch({path:"/internal/file_upload/analyze_file",method:"POST",version:"1",body:r,query:t})}async function m(e){const t=await o();try{return(await t.getHttp().fetch({path:"/internal/file_upload/has_import_permission",method:"GET",version:"1",query:{...e}})).hasImportPermission}catch(e){return!1}}async function g(e,t={}){const n=JSON.stringify({index:e}),r=await o();try{const{exists:e}=await r.getHttp().fetch({path:"/internal/file_upload/index_exists",method:"POST",version:"1",body:n,query:t});return e}catch(e){return!1}}async function y(e,t,n){const r=JSON.stringify({index:e,timeFieldName:n,query:t}),i=await o();return await i.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",version:"1",body:r})}},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c}));var r=n(11),i=n.n(r),o=n(1),s=n(2);function a(){const e=Object(s.f)().get(o.g,o.d),t=i()(e.toUpperCase()).value();return t<o.e?o.e:t<=o.a?t:o.a}function c(){return i()(a()).format(o.c)}},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t,n){"use strict";n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return importer_Importer})),n.d(t,"d",(function(){return m}));var r=n(0),i=n.n(r),o=n(10),s=n(14),a=n.n(s),c=n(4);const u=(e,t=[])=>"object"==typeof e&&null!==e&&Object.keys(e).length>0&&(0===t.length||t.every((t=>({}.hasOwnProperty.call(e,t)))));var d=n(2),l=n(1);const p=1e6,f=5,_="@timestamp";class importer_Importer{constructor(){i()(this,"_docArray",[]),i()(this,"_chunkSize",5e3),i()(this,"_index",void 0),i()(this,"_pipeline",void 0),i()(this,"_timeFieldName",void 0),i()(this,"_initialized",!1)}initialized(){return this._initialized}getIndex(){return this._index}getTimeField(){return this._timeFieldName}read(e){const t=new TextDecoder,n=100*l.f,r=Math.ceil(e.byteLength/n);let i=0;for(let o=0;o<r;o++){const s=t.decode(e.slice(o*n-i,(o+1)*n)),{success:a,docs:c,remainder:u}=this._createDocs(s,o===r-1);if(!a)return{success:!1};this._docArray=this._docArray.concat(c),i=u}return{success:!0}}async initializeImport(e,t,n,r){!function(e){if(void 0!==e&&e.processors&&e.processors){const t=e.processors.find((e=>void 0!==e.date&&"{{ event.timezone }}"===e.date.timezone));t&&(t.date.timezone=a.a.tz.guess())}}(r),function(e){const t=e=>{const n=[];return Object.entries(e).forEach((([e,r])=>{n.push(e),u(r)&&n.push(...t(r))})),n},n=t(e);return 0!==Object(o.intersection)(["inference","enrich"],n).length}(r)&&(this._chunkSize=100);const i=void 0!==r?{id:`${e}-pipeline`,pipeline:r}:{};return this._index=e,this._pipeline=r,this._timeFieldName=u(n.properties,[_])?_:void 0,this._initialized=!0,await m({id:void 0,index:e,data:[],settings:t,mappings:n,ingestPipeline:i})}async import(e,t,n,r){if(!e||!t)return{success:!1,error:c.i18n.translate("xpack.fileUpload.import.noIdOrIndexSuppliedErrorMessage",{defaultMessage:"no ID or index supplied"})};const i=function(e,t){const n=[],r=Object(o.chunk)(e,t);for(let e=0;e<r.length;e++){const t=r[e],i=t.length,s=JSON.stringify(t).length;if(s>p){const e=Math.floor(p/s*i),r=Object(o.chunk)(t,e);n.push(...r)}else n.push(t)}return n}(this._docArray,this._chunkSize),s={id:n};let a=!0;const u=[];let d;for(let n=0;n<i.length;n++){let o=f,c={success:!1,failures:[],docCount:0,id:"",index:"",pipelineId:""};for(;!1===c.success&&o>0;)try{c=await m({id:e,index:t,data:i[n],settings:{},mappings:{},ingestPipeline:s}),o<f&&console.log("Retrying import "+(f-o)),o--}catch(e){c.success=!1,c.error=e,o=0}if(!c.success){console.error(c),a=!1,d=c.error,h(c,u,n,this._chunkSize);break}r((n+1)/i.length*100),h(c,u,n,this._chunkSize)}const l={success:a,failures:u,docCount:this._docArray.length};return a?r(100):l.error=d,l}_getFirstReadDocs(e=1){return this._docArray.slice(0,e).map((e=>"string"==typeof e?JSON.parse(e):e))}_getLastReadDocs(e=1){return this._docArray.slice(-e).map((e=>"string"==typeof e?JSON.parse(e):e))}async previewIndexTimeRange(){if(!1===this._initialized||void 0===this._pipeline)throw new Error("Import has not been initialized");const e=this._getFirstReadDocs(10),t=this._getLastReadDocs(10),n=JSON.stringify({docs:e.concat(t),pipeline:this._pipeline,timeField:this._timeFieldName});return await Object(d.c)().fetch({path:"/internal/file_upload/preview_index_time_range",method:"POST",version:"1",body:n})}}function h(e,t,n,r){if(e.failures&&e.failures.length){for(let t=0;t<e.failures.length;t++){const i=e.failures[t];i.item=i.item+r*n}t.push(...e.failures)}}function m({id:e,index:t,data:n,settings:r,mappings:i,ingestPipeline:o}){const s=void 0!==e?{id:e}:{},a=JSON.stringify({index:t,data:n,settings:r,mappings:i,ingestPipeline:o});return Object(d.c)().fetch({path:"/internal/file_upload/import",method:"POST",version:"1",query:s,body:a})}},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t){e.exports=__kbnSharedDeps__.ElasticNumeral},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return message_importer_MessageImporter}));var r=n(0),i=n.n(r),o=n(9);class message_importer_MessageImporter extends o.b{constructor(e){super(),i()(this,"_excludeLinesRegex",void 0),i()(this,"_multilineStartRegex",void 0),this._excludeLinesRegex=void 0===e.excludeLinesPattern?null:new RegExp(e.excludeLinesPattern),this._multilineStartRegex=void 0===e.multilineStartPattern?null:new RegExp(e.multilineStartPattern)}_createDocs(e,t,n){let r=0;try{const i=[];let o="",s="";for(let r=0;r<e.length;r++){const a=e[r],c=r===e.length-1;if("\n"===a?(o=this._processLine(i,o,s),s=""):t&&c?(s+=a,o=this._processLine(i,o,s),s=""):s+=a,void 0!==n&&i.length>=n)break}return r=s.length,""!==o&&this._addMessage(i,o),i[0]&&""===i[0].message&&i.shift(),{success:!0,docs:i,remainder:r}}catch(e){return{success:!1,docs:[],remainder:r,error:e}}}_processLine(e,t,n){if(null===this._excludeLinesRegex||null===n.match(this._excludeLinesRegex)){if(null===this._multilineStartRegex||null!==n.match(this._multilineStartRegex))this._addMessage(e,t),t="";else{if(0===e.length)return"";t+="\n"}t+=n}return t}_addMessage(e,t){t=t.replace(/\r$/,""),e.push({message:t})}}class ndjson_importer_NdjsonImporter extends o.b{constructor(){super()}_createDocs(e,t){let n=0;try{const t=e.split(/}\s*\n/),r=null===e.match(/}\s*\n?$/),i=[];if(t.length){for(let e=0;e<t.length-1;e++)""!==t[e]&&i.push(`${t[e]}}`);const e=t[t.length-1];e&&(!0===r?n=e.length:i.push(`${e}}`))}return{success:!0,docs:i,remainder:n}}catch(e){return{success:!1,docs:[],remainder:n,error:e}}}}var s=n(1);function a(e,t){switch(e){case s.b.DELIMITED:case s.b.SEMI_STRUCTURED_TEXT:return new message_importer_MessageImporter(t);case s.b.NDJSON:return new ndjson_importer_NdjsonImporter;default:return}}n(13)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(4),i=n(6);function o(e){return"."+e.name.split(".").pop()}function s(e,t,n){if(e.size>Object(i.a)()&&null!=n&&n.checkSizeLimit)throw new Error(r.i18n.translate("xpack.fileUpload.fileSizeError",{defaultMessage:"File size {fileSize} exceeds maximum file size of {maxFileSize}",values:{fileSize:a(e.size),maxFileSize:Object(i.b)()}}));if(!e.name)throw new Error(r.i18n.translate("xpack.fileUpload.noFileNameError",{defaultMessage:"File name not provided"}));if(!t.includes(o(e)))throw new Error(r.i18n.translate("xpack.fileUpload.fileTypeError",{defaultMessage:"File is not one of acceptable types: {types}",values:{types:t.join(", ")}}))}function a(e){if(0===e)return"n/a";const t=["Bytes","KB","MB","GB","TB"],n=Math.round(Math.floor(Math.log(e)/Math.log(1024)));return 0===n?`${e} ${t[n]})`:`${(e/1024**n).toFixed(1)} ${t[n]}`}},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,n){n(17),__kbnBundles__.define("plugin/fileUpload/public",n,19),__kbnBundles__.define("plugin/fileUpload/common",n,18)},function(e,t,n){n.p=window.__kbnPublicPath__.fileUpload},function(e,t,n){"use strict";n.r(t)},function(e,t,n){"use strict";n.r(t),n.d(t,"plugin",(function(){return a})),n.d(t,"MessageImporter",(function(){return s.a}));var r=n(3),i=n(2),o=n(6);class plugin_FileUploadPlugin{setup(){}start(e,t){return Object(i.g)(e,t),{FileUploadComponent:r.a,IndexNameFormComponent:r.b,importerFactory:r.g,getMaxBytes:o.a,getMaxBytesFormatted:o.b,hasImportPermission:r.f,checkIndexExists:r.d,getTimeFieldRange:r.e,analyzeFile:r.c}}}var s=n(12);function a(){return new plugin_FileUploadPlugin}},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t,n){n.r(t);var r=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},function(e,t){e.exports=__kbnSharedDeps__.KbnCodeEditor}]);