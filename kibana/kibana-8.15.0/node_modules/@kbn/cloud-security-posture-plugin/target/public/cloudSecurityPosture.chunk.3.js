/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.cloudSecurityPosture_bundle_jsonpfunction=window.cloudSecurityPosture_bundle_jsonpfunction||[]).push([[3],Array(59).concat([function(e,t,a){const s=a(80);e.exports=(e,t)=>{const a=s(e,t);return a?a.version:null}},,,,,,,function(e,t,a){const s=a(70);e.exports=(e,t,a)=>new s(e,a).compare(new s(t,a))},function(e,t,a){const s=a(70),n=a(80),{safeRe:i,t:o}=a(79);e.exports=(e,t)=>{if(e instanceof s)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let a=null;if((t=t||{}).rtl){const s=t.includePrerelease?i[o.COERCERTLFULL]:i[o.COERCERTL];let n;for(;(n=s.exec(e))&&(!a||a.index+a[0].length!==e.length);)a&&n.index+n[0].length===a.index+a[0].length||(a=n),s.lastIndex=n.index+n[1].length+n[2].length;s.lastIndex=-1}else a=e.match(t.includePrerelease?i[o.COERCEFULL]:i[o.COERCE]);if(null===a)return null;const l=a[2],r=a[3]||"0",c=a[4]||"0",u=t.includePrerelease&&a[5]?`-${a[5]}`:"",d=t.includePrerelease&&a[6]?`+${a[6]}`:"";return n(`${l}.${r}.${c}${u}${d}`,t)}},function(e,t,a){const s=a(66);e.exports=(e,t,a)=>s(e,t,a)<0},,function(e,t,a){const s=a(77),{MAX_LENGTH:n,MAX_SAFE_INTEGER:i}=a(78),{safeRe:o,t:l}=a(79),r=a(107),{compareIdentifiers:c}=a(108);class SemVer{constructor(e,t){if(t=r(t),e instanceof SemVer){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw new TypeError(`version is longer than ${n} characters`);s("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const a=e.trim().match(t.loose?o[l.LOOSE]:o[l.FULL]);if(!a)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+a[1],this.minor=+a[2],this.patch=+a[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");a[4]?this.prerelease=a[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=a[5]?a[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(s("SemVer.compare",this.version,this.options,e),!(e instanceof SemVer)){if("string"==typeof e&&e===this.version)return 0;e=new SemVer(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof SemVer||(e=new SemVer(e,this.options)),c(this.major,e.major)||c(this.minor,e.minor)||c(this.patch,e.patch)}comparePre(e){if(e instanceof SemVer||(e=new SemVer(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const a=this.prerelease[t],n=e.prerelease[t];if(s("prerelease compare",t,a,n),void 0===a&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===a)return-1;if(a!==n)return c(a,n)}while(++t)}compareBuild(e){e instanceof SemVer||(e=new SemVer(e,this.options));let t=0;do{const a=this.build[t],n=e.build[t];if(s("build compare",t,a,n),void 0===a&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===a)return-1;if(a!==n)return c(a,n)}while(++t)}inc(e,t,a){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,a);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,a);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,a),this.inc("pre",t,a);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,a),this.inc("pre",t,a);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(a)?1:0;if(!t&&!1===a)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let s=this.prerelease.length;for(;--s>=0;)"number"==typeof this.prerelease[s]&&(this.prerelease[s]++,s=-2);if(-1===s){if(t===this.prerelease.join(".")&&!1===a)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let s=[t,e];!1===a&&(s=[t]),0===c(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=SemVer},,,,,,,function(e,t,a){(function(t){const a="object"==typeof t&&Object({IS_KIBANA_DISTRIBUTABLE:"true"})&&Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG&&/\bsemver\b/i.test(Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=a}).call(this,a(106))},function(e,t){const a=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:a,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},function(e,t,a){const{MAX_SAFE_COMPONENT_LENGTH:s,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=a(78),o=a(77),l=(t=e.exports={}).re=[],r=t.safeRe=[],c=t.src=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",g=[["\\s",1],["\\d",i],[p,n]],j=(e,t,a)=>{const s=(e=>{for(const[t,a]of g)e=e.split(`${t}*`).join(`${t}{0,${a}}`).split(`${t}+`).join(`${t}{1,${a}}`);return e})(t),n=d++;o(e,n,t),u[e]=n,c[n]=t,l[n]=new RegExp(t,a?"g":void 0),r[n]=new RegExp(s,a?"g":void 0)};j("NUMERICIDENTIFIER","0|[1-9]\\d*"),j("NUMERICIDENTIFIERLOOSE","\\d+"),j("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),j("MAINVERSION",`(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})\\.(${c[u.NUMERICIDENTIFIER]})`),j("MAINVERSIONLOOSE",`(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})\\.(${c[u.NUMERICIDENTIFIERLOOSE]})`),j("PRERELEASEIDENTIFIER",`(?:${c[u.NUMERICIDENTIFIER]}|${c[u.NONNUMERICIDENTIFIER]})`),j("PRERELEASEIDENTIFIERLOOSE",`(?:${c[u.NUMERICIDENTIFIERLOOSE]}|${c[u.NONNUMERICIDENTIFIER]})`),j("PRERELEASE",`(?:-(${c[u.PRERELEASEIDENTIFIER]}(?:\\.${c[u.PRERELEASEIDENTIFIER]})*))`),j("PRERELEASELOOSE",`(?:-?(${c[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[u.PRERELEASEIDENTIFIERLOOSE]})*))`),j("BUILDIDENTIFIER",`${p}+`),j("BUILD",`(?:\\+(${c[u.BUILDIDENTIFIER]}(?:\\.${c[u.BUILDIDENTIFIER]})*))`),j("FULLPLAIN",`v?${c[u.MAINVERSION]}${c[u.PRERELEASE]}?${c[u.BUILD]}?`),j("FULL",`^${c[u.FULLPLAIN]}$`),j("LOOSEPLAIN",`[v=\\s]*${c[u.MAINVERSIONLOOSE]}${c[u.PRERELEASELOOSE]}?${c[u.BUILD]}?`),j("LOOSE",`^${c[u.LOOSEPLAIN]}$`),j("GTLT","((?:<|>)?=?)"),j("XRANGEIDENTIFIERLOOSE",`${c[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),j("XRANGEIDENTIFIER",`${c[u.NUMERICIDENTIFIER]}|x|X|\\*`),j("XRANGEPLAIN",`[v=\\s]*(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:\\.(${c[u.XRANGEIDENTIFIER]})(?:${c[u.PRERELEASE]})?${c[u.BUILD]}?)?)?`),j("XRANGEPLAINLOOSE",`[v=\\s]*(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[u.XRANGEIDENTIFIERLOOSE]})(?:${c[u.PRERELEASELOOSE]})?${c[u.BUILD]}?)?)?`),j("XRANGE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAIN]}$`),j("XRANGELOOSE",`^${c[u.GTLT]}\\s*${c[u.XRANGEPLAINLOOSE]}$`),j("COERCEPLAIN",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?`),j("COERCE",`${c[u.COERCEPLAIN]}(?:$|[^\\d])`),j("COERCEFULL",c[u.COERCEPLAIN]+`(?:${c[u.PRERELEASE]})?`+`(?:${c[u.BUILD]})?(?:$|[^\\d])`),j("COERCERTL",c[u.COERCE],!0),j("COERCERTLFULL",c[u.COERCEFULL],!0),j("LONETILDE","(?:~>?)"),j("TILDETRIM",`(\\s*)${c[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",j("TILDE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAIN]}$`),j("TILDELOOSE",`^${c[u.LONETILDE]}${c[u.XRANGEPLAINLOOSE]}$`),j("LONECARET","(?:\\^)"),j("CARETTRIM",`(\\s*)${c[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",j("CARET",`^${c[u.LONECARET]}${c[u.XRANGEPLAIN]}$`),j("CARETLOOSE",`^${c[u.LONECARET]}${c[u.XRANGEPLAINLOOSE]}$`),j("COMPARATORLOOSE",`^${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]})$|^$`),j("COMPARATOR",`^${c[u.GTLT]}\\s*(${c[u.FULLPLAIN]})$|^$`),j("COMPARATORTRIM",`(\\s*)${c[u.GTLT]}\\s*(${c[u.LOOSEPLAIN]}|${c[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",j("HYPHENRANGE",`^\\s*(${c[u.XRANGEPLAIN]})\\s+-\\s+(${c[u.XRANGEPLAIN]})\\s*$`),j("HYPHENRANGELOOSE",`^\\s*(${c[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[u.XRANGEPLAINLOOSE]})\\s*$`),j("STAR","(<|>)?=?\\s*\\*"),j("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),j("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},function(e,t,a){const s=a(70);e.exports=(e,t,a=!1)=>{if(e instanceof s)return e;try{return new s(e,t)}catch(e){if(!a)return null;throw e}}},function(e,t,a){var s=a(112),n=a(113);e.exports=function(e,t,a){(void 0!==a&&!n(e[t],a)||void 0===a&&!(t in e))&&s(e,t,a)}},function(e,t,a){e.exports=a(7)(361)},function(e,t){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},function(e,t,a){e.exports=a(7)(1198)},,,,,,,,,,,,,,,,,,,,,,function(e,t,a){e.exports=a(7)(675)},function(e,t){const a=Object.freeze({loose:!0}),s=Object.freeze({});e.exports=e=>e?"object"!=typeof e?a:e:s},function(e,t){const a=/^[0-9]+$/,s=(e,t)=>{const s=a.test(e),n=a.test(t);return s&&n&&(e=+e,t=+t),e===t?0:s&&!n?-1:n&&!s?1:e<t?-1:1};e.exports={compareIdentifiers:s,rcompareIdentifiers:(e,t)=>s(t,e)}},function(e,t,a){var s=a(110),n=a(132)((function(e,t,a){s(e,t,a)}));e.exports=n},function(e,t,a){var s=a(111),n=a(81),i=a(114),o=a(116),l=a(82),r=a(84),c=a(83);e.exports=function e(t,a,u,d,p){t!==a&&i(a,(function(i,r){if(p||(p=new s),l(i))o(t,a,r,u,e,d,p);else{var g=d?d(c(t,r),i,r+"",t,a,p):void 0;void 0===g&&(g=i),n(t,r,g)}}),r)}},function(e,t,a){e.exports=a(7)(1600)},function(e,t,a){e.exports=a(7)(1618)},function(e,t,a){e.exports=a(7)(833)},function(e,t,a){var s=a(115)();e.exports=s},function(e,t){e.exports=function(e){return function(t,a,s){for(var n=-1,i=Object(t),o=s(t),l=o.length;l--;){var r=o[e?l:++n];if(!1===a(i[r],r,i))break}return t}}},function(e,t,a){var s=a(81),n=a(117),i=a(118),o=a(119),l=a(120),r=a(121),c=a(122),u=a(123),d=a(126),p=a(127),g=a(82),j=a(128),b=a(129),f=a(83),x=a(130);e.exports=function(e,t,a,m,O,E,h){var I=f(e,a),y=f(t,a),v=h.get(y);if(v)s(e,a,v);else{var S=E?E(I,y,a+"",e,t,h):void 0,T=void 0===S;if(T){var A=c(y),_=!A&&d(y),C=!A&&!_&&b(y);S=y,A||_||C?c(I)?S=I:u(I)?S=o(I):_?(T=!1,S=n(y,!0)):C?(T=!1,S=i(y,!0)):S=[]:j(y)||r(y)?(S=I,r(I)?S=x(I):g(I)&&!p(I)||(S=l(y))):T=!1}T&&(h.set(y,S),O(S,y,m,E,h),h.delete(y)),s(e,a,S)}}},function(e,t,a){e.exports=a(7)(3509)},function(e,t,a){e.exports=a(7)(3518)},function(e,t,a){e.exports=a(7)(3510)},function(e,t,a){e.exports=a(7)(3519)},function(e,t,a){e.exports=a(7)(1608)},function(e,t,a){e.exports=a(7)(296)},function(e,t,a){var s=a(124),n=a(125);e.exports=function(e){return n(e)&&s(e)}},function(e,t,a){e.exports=a(7)(1196)},function(e,t,a){e.exports=a(7)(294)},function(e,t,a){e.exports=a(7)(1192)},function(e,t,a){e.exports=a(7)(887)},function(e,t,a){e.exports=a(7)(3530)},function(e,t,a){e.exports=a(7)(1610)},function(e,t,a){var s=a(131),n=a(84);e.exports=function(e){return s(e,n(e))}},function(e,t,a){e.exports=a(7)(692)},function(e,t,a){var s=a(133),n=a(137);e.exports=function(e){return s((function(t,a){var s=-1,i=a.length,o=i>1?a[i-1]:void 0,l=i>2?a[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,l&&n(a[0],a[1],l)&&(o=i<3?void 0:o,i=1),t=Object(t);++s<i;){var r=a[s];r&&e(t,r,s,o)}return t}))}},function(e,t,a){var s=a(134),n=a(135),i=a(136);e.exports=function(e,t){return i(n(e,t,s),e+"")}},function(e,t,a){e.exports=a(7)(3540)},function(e,t,a){e.exports=a(7)(3535)},function(e,t,a){e.exports=a(7)(3537)},function(e,t,a){e.exports=a(7)(3821)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"AWS_SINGLE_ACCOUNT",(function(){return mt})),a.d(t,"AWS_ORGANIZATION_ACCOUNT",(function(){return Ot})),a.d(t,"GCP_SINGLE_ACCOUNT",(function(){return Et})),a.d(t,"GCP_ORGANIZATION_ACCOUNT",(function(){return ht})),a.d(t,"AZURE_SINGLE_ACCOUNT",(function(){return It})),a.d(t,"AZURE_ORGANIZATION_ACCOUNT",(function(){return yt})),a.d(t,"CspPolicyTemplateForm",(function(){return Lt})),a.d(t,"default",(function(){return Lt}));var s=a(1),n=a.n(s),i=a(66),o=a.n(i),l=a(59),r=a.n(l),c=a(67),u=a.n(c),d=a(68),p=a.n(d),g=a(6),j=a(25),b=a(20),f=a(22),x=a(3),m=a(0),O={name:"y1f223",styles:"margin:auto"};const E=({idSelected:e,size:t,options:a,disabled:s,onChange:n})=>{const{euiTheme:i}=Object(g.useEuiTheme)();return Object(m.jsx)("div",{css:Object(m.css)("display:flex;flex-flow:row wrap;gap:",i.size.s,";@media only screen and (max-width: ",i.breakpoint.m,"px){.euiToolTipAnchor{min-width:100%;}}","")},a.map((a=>{const o=a.id===e;return Object(m.jsx)(g.EuiToolTip,{key:a.id,content:a.tooltip,anchorProps:{style:{flex:"1 1 0"}}},Object(m.jsx)(g.EuiButton,{disabled:a.disabled||s,style:{border:`1px solid ${o?i.colors.primary:i.colors.lightShade}`},color:o?"primary":"",onClick:()=>n(a.id),iconType:a.icon,iconSide:"right",contentProps:{style:{justifyContent:"flex-start"}},css:Object(m.css)("width:100%;height:","s"===t?i.size.xxl:i.size.xxxl,";svg,img{margin-left:auto;}&&,&&:hover{text-decoration:none;}&:disabled{svg,img{filter:grayscale(1);}}","")},Object(m.jsx)(g.EuiRadio,{"data-test-subj":a.testId,label:a.label,id:a.id,checked:o,onChange:()=>{}}),a.isBeta&&Object(m.jsx)("div",{css:O},Object(m.jsx)(g.EuiBetaBadge,{label:"Beta",alignment:"middle"}))))})))};var h=a(56),I=a(2),y=a(109),v=a.n(y),S=a(53),T={name:"165tmv5",styles:"width:100%;.euiFormControlLayout,.euiFormControlLayout__childrenWrapper,.euiFormRow,input{max-width:100%;width:100%;}"};const A=({fields:e,onChange:t,packageInfo:a})=>Object(m.jsx)("div",null,e.map((e=>Object(m.jsx)(n.a.Fragment,null,"password"===e.type&&!0===e.isSecret&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)("div",{css:T},Object(m.jsx)(s.Suspense,{fallback:Object(m.jsx)(g.EuiLoadingSpinner,{size:"l"})},Object(m.jsx)(j.LazyPackagePolicyInputVarField,{varDef:{...et(a,e.id),required:!0,type:"password"},value:e.value||"",onChange:a=>{t(e.id,a)},errors:[],forceShowErrors:!1,isEditPage:!0,"data-test-subj":e.dataTestSubj}))),Object(m.jsx)(g.EuiSpacer,{size:"m"})),"text"===e.type&&Object(m.jsx)(g.EuiFormRow,{key:e.id,label:e.label,fullWidth:!0,hasChildLabel:!0,id:e.id},Object(m.jsx)(g.EuiFieldText,{id:e.id,fullWidth:!0,value:e.value||"",onChange:a=>t(e.id,a.target.value),"data-test-subj":e.dataTestSubj})))))),_=()=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiHorizontalRule,{margin:"xl"}),Object(m.jsx)(g.EuiTitle,{size:"xs"},Object(m.jsx)("h2",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.setupInfoContentTitle",defaultMessage:"Setup Access"}))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.setupInfoContent",defaultMessage:"The integration will need elevated access to run some CIS benchmark rules. Select your preferred method of providing the AWS credentials this integration will use. You can follow these step-by-step instructions to generate the necessary credentials."}))),C=Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.docsLink",defaultMessage:"Read the {docs} for more details",values:{docs:Object(m.jsx)(g.EuiLink,{href:"https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html",external:!0},"documentation")}})),M=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.assumeRoleDescription",defaultMessage:"An IAM role Amazon Resource Name (ARN) is an IAM identity that you can create in your AWS account. When creating an IAM role, users can define the role’s permissions. Roles do not have standard long-term credentials such as passwords or access keys."}))),L=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.directAccessKeysDescription",defaultMessage:"Access keys are long-term credentials for an IAM user or the AWS account root user."}))),k=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.temporaryKeysDescription",defaultMessage:"You can configure temporary security credentials in AWS to last for a specified duration. They consist of an access key ID, a secret access key, and a security token, which is typically found using GetSessionToken."}))),R=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.eksIntegration.sharedCredentialsDescription",defaultMessage:"If you use different AWS credentials for different tools or applications, you can use profiles to define multiple access keys in the same configuration file."}))),N={access_key_id:x.i18n.translate("xpack.csp.eksIntegration.accessKeyIdLabel",{defaultMessage:"Access Key ID"}),secret_access_key:x.i18n.translate("xpack.csp.eksIntegration.secretAccessKeyLabel",{defaultMessage:"Secret Access Key"})},F={assume_role:{label:x.i18n.translate("xpack.csp.eksIntegration.assumeRoleLabel",{defaultMessage:"Assume role"}),info:M,fields:{role_arn:{label:x.i18n.translate("xpack.csp.eksIntegration.roleArnLabel",{defaultMessage:"Role ARN"}),dataTestSubj:"roleArnInput"}},testId:"assumeRoleTestId"},direct_access_keys:{label:x.i18n.translate("xpack.csp.eksIntegration.directAccessKeyLabel",{defaultMessage:"Direct access keys"}),info:L,fields:{access_key_id:{label:N.access_key_id,dataTestSubj:"directAccessKeyId"},secret_access_key:{label:N.secret_access_key,type:"password",dataTestSubj:"directAccessSecretKey",isSecret:!0}},testId:"directAccessKeyTestId"},temporary_keys:{info:k,label:x.i18n.translate("xpack.csp.eksIntegration.temporaryKeysLabel",{defaultMessage:"Temporary keys"}),fields:{access_key_id:{label:N.access_key_id,dataTestSubj:"temporaryKeysAccessKeyId"},secret_access_key:{label:N.secret_access_key,type:"password",dataTestSubj:"temporaryKeysSecretAccessKey",isSecret:!0},session_token:{label:x.i18n.translate("xpack.csp.eksIntegration.sessionTokenLabel",{defaultMessage:"Session Token"}),dataTestSubj:"temporaryKeysSessionToken"}},testId:"temporaryKeyTestId"},shared_credentials:{label:x.i18n.translate("xpack.csp.eksIntegration.sharedCredentialLabel",{defaultMessage:"Shared credentials"}),info:R,fields:{shared_credential_file:{label:x.i18n.translate("xpack.csp.eksIntegration.sharedCredentialFileLabel",{defaultMessage:"Shared Credential File"}),dataTestSubj:"sharedCredentialFile"},credential_profile_name:{label:x.i18n.translate("xpack.csp.eksIntegration.credentialProfileNameLabel",{defaultMessage:"Credential Profile Name"}),dataTestSubj:"credentialProfileName"}},testId:"sharedCredentialsTestId"}},w=Object.keys(F).map((e=>({id:e,label:F[e].label,testId:F[e].testId}))),z=({input:e,newPolicy:t,packageInfo:a,updatePolicy:s})=>{const i=(e=>{var t;return null===(t=e.streams[0].vars)||void 0===t?void 0:t["aws.credentials.type"].value})(e)||w[0].id,o=F[i],l=((e,t)=>Object.entries(e.streams[0].vars||{}).filter((([e])=>e in t)).map((([e,a])=>{const s=t[e];return{id:e,label:s.label,type:s.type||"text",dataTestSubj:s.dataTestSubj,value:a.value,isSecret:null==s?void 0:s.isSecret}})))(e,o.fields);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(_,null),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(P,{type:i,onChange:a=>s(Be(t,e.type,{"aws.credentials.type":{value:a}}))}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),o.info,Object(m.jsx)(g.EuiSpacer,{size:"s"}),C,Object(m.jsx)(g.EuiSpacer,null),Object(m.jsx)(A,{fields:l,packageInfo:a,onChange:(a,n)=>s(Be(t,e.type,{[a]:{value:n}}))}),Object(m.jsx)(g.EuiSpacer,null))},P=({type:e,onChange:t})=>Object(m.jsx)(E,{size:"s",options:[...w],idSelected:e,onChange:e=>t(e)});var D=a(4);const $=(e,t,a)=>{null==t||t({...e,inputs:e.inputs.map((e=>e.type===I.j?{...e,config:{cloud_formation_template_url:{value:a}}}:e))})},U=({packageInfo:e,newPolicy:t,updatePolicy:a,setupFormat:n})=>{var i;Object(s.useEffect)((()=>{const s=(e=>{var t,a,s,n;return(null==e||null===(t=e.inputs)||void 0===t||null===(a=t.find((e=>e.type===I.j)))||void 0===a||null===(s=a.config)||void 0===s||null===(n=s.cloud_formation_template_url)||void 0===n?void 0:n.value)||void 0})(t);if(n===W.MANUAL)return void(s&&$(t,a,void 0));const i=He(e);""!==i&&s!==i&&$(t,a,i)}),[null==t||null===(i=t.vars)||void 0===i?void 0:i.cloud_formation_template_url,t,e,n])};var G=a(55);const W={CLOUD_FORMATION:"cloud_formation",MANUAL:"manual"},V={ASSUME_ROLE:"assume_role",DIRECT_ACCESS_KEYS:"direct_access_keys",TEMPORARY_KEYS:"temporary_keys",SHARED_CREDENTIALS:"shared_credentials",CLOUD_FORMATION:"cloud_formation"},K=({info:e})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiHorizontalRule,{margin:"xl"}),Object(m.jsx)(g.EuiTitle,{size:"xs"},Object(m.jsx)("h2",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.setupInfoContentTitle",defaultMessage:"Setup Access"}))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},e));var B={name:"qdust2",styles:"list-style:auto"};const X=({hasCloudFormationTemplate:e,input:t})=>{var a,s,i,o;if(!e)return Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.notSupported",defaultMessage:"CloudFormation is not supported on the current Integration version, please upgrade your integration to the latest version to use CloudFormation"}));const l=null===(a=t.streams)||void 0===a||null===(s=a[0])||void 0===s||null===(i=s.vars)||void 0===i||null===(o=i["aws.account_type"])||void 0===o?void 0:o.value;return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)("ol",{css:B},Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.hostRequirement",defaultMessage:'Ensure "New hosts" is selected in the "Where to add this integration?" section below'})),l===Ot?Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.organizationLogin",defaultMessage:"Log in as an admin in your organization's AWS management account"})):Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.login",defaultMessage:"Log in as an admin to the AWS Account you want to onboard"})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.save",defaultMessage:"Click the Save and continue button on the bottom right of this page"})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupStep.launch",defaultMessage:"On the subsequent pop-up modal, click the Launch CloudFormation button."})))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(q,{url:H}))},H="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-whatis-howdoesitwork.html",Y=({children:e,url:t})=>Object(m.jsx)(g.EuiLink,{href:t,target:"_blank",rel:"noopener nofollow noreferrer","data-test-subj":"externalLink"},e),q=({url:e})=>Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.cloudFormationSetupNote",defaultMessage:"Read the {documentation} for more details",values:{documentation:Object(m.jsx)(Y,{url:e},x.i18n.translate("xpack.csp.awsIntegration.documentationLinkText",{defaultMessage:"documentation"}))}})),Z=({input:e,newPolicy:t,updatePolicy:a,packageInfo:i,onChange:o,setIsValid:l,disabled:r})=>{const{awsCredentialsType:c,setupFormat:u,group:d,fields:p,integrationLink:j,hasCloudFormationTemplate:f,onSetupFormatChange:O}=(({newPolicy:e,input:t,packageInfo:a,onChange:n,setIsValid:i,updatePolicy:o})=>{const l=Qe(t)||re,r=ue(),c=!!He(a),u=((e,t)=>{const a=Qe(e);return!a&&t?W.CLOUD_FORMATION:a!==V.CLOUD_FORMATION?W.MANUAL:W.CLOUD_FORMATION})(t,c),d=r[l],p=ne(t,d.fields),g=Object(s.useRef)({}),j=Object(s.useRef)(void 0);Object(s.useEffect)((()=>{const t=u===W.CLOUD_FORMATION&&!c;i(!t),n({isValid:!t,updatedPolicy:e})}),[u,t.type]);const b=D.d.cspm.getStartedPath;return U({packageInfo:a,newPolicy:e,updatePolicy:o,setupFormat:u}),{awsCredentialsType:l,setupFormat:u,group:d,fields:p,integrationLink:b,hasCloudFormationTemplate:c,onSetupFormatChange:a=>{a===W.CLOUD_FORMATION?(g.current=Object.fromEntries(p.map((e=>[e.id,{value:e.value}]))),j.current=Qe(t),o(Be(e,t.type,{"aws.credentials.type":{value:V.CLOUD_FORMATION,type:"text"},...Object.fromEntries(p.map((e=>[e.id,{value:void 0}])))}))):o(Be(e,t.type,{"aws.credentials.type":{value:j.current||re,type:"text"},...g.current}))}}})({newPolicy:t,input:e,packageInfo:i,onChange:o,setIsValid:l,updatePolicy:a});return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(K,{info:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.gettingStarted.setupInfoContent",defaultMessage:"Utilize AWS CloudFormation (a built-in AWS tool) or a series of manual steps to set up and deploy CSPM for assessing your AWS environment's security posture. Refer to our {gettingStartedLink} guide for details.",values:{gettingStartedLink:Object(m.jsx)(g.EuiLink,{href:j,target:"_blank"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.gettingStarted.setupInfoContentLink",defaultMessage:"Getting Started"}))}})}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(E,{disabled:r,size:"m",options:[{id:W.CLOUD_FORMATION,label:"CloudFormation",testId:G.a.CLOUDFORMATION},{id:W.MANUAL,label:x.i18n.translate("xpack.csp.awsIntegration.setupFormatOptions.manual",{defaultMessage:"Manual"}),testId:G.a.MANUAL}],idSelected:u,onChange:e=>e!==u&&O(e)}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),u===W.CLOUD_FORMATION&&Object(m.jsx)(X,{hasCloudFormationTemplate:f,input:e}),u===W.MANUAL&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(J,{label:x.i18n.translate("xpack.csp.awsIntegration.awsCredentialTypeSelectorLabel",{defaultMessage:"Preferred manual method"}),options:oe(),type:c,onChange:s=>{a(Be(t,e.type,{"aws.credentials.type":{value:s}}))}}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),d.info,Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(q,{url:j}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(A,{fields:p,packageInfo:i,onChange:(s,n)=>{a(Be(t,e.type,{[s]:{value:n}}))}})),Object(m.jsx)(g.EuiSpacer,null))},J=({type:e,onChange:t,label:a,options:s})=>Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:a},Object(m.jsx)(g.EuiSelect,{fullWidth:!0,options:s,value:e,onChange:e=>{t(e.target.value)},"data-test-subj":G.b})),Q=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.assumeRoleDescription",defaultMessage:"An IAM role Amazon Resource Name (ARN) is an IAM identity that you can create in your AWS account. When creating an IAM role, users can define the role’s permissions. Roles do not have standard long-term credentials such as passwords or access keys."}))),ee=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.directAccessKeysDescription",defaultMessage:"Access keys are long-term credentials for an IAM user or the AWS account root user."}))),te=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.temporaryKeysDescription",defaultMessage:"You can configure temporary security credentials in AWS to last for a specified duration. They consist of an access key ID, a secret access key, and a security token, which is typically found using GetSessionToken."}))),ae=Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.sharedCredentialsDescription",defaultMessage:"If you use different AWS credentials for different tools or applications, you can use profiles to define multiple access keys in the same configuration file."}))),se={access_key_id:x.i18n.translate("xpack.csp.awsIntegration.accessKeyIdLabel",{defaultMessage:"Access Key ID"}),secret_access_key:x.i18n.translate("xpack.csp.awsIntegration.secretAccessKeyLabel",{defaultMessage:"Secret Access Key"})},ne=(e,t)=>Object.entries(e.streams[0].vars||{}).filter((([e])=>e in t)).map((([e,a])=>{const s=t[e];return{id:e,label:s.label,type:s.type||"text",value:a.value,dataTestSubj:s.dataTestSubj,isSecret:s.isSecret}})),ie=e=>Object.entries(ue()).map((([e,t])=>({value:e,text:t.label}))).filter(e),oe=()=>ie((({value:e})=>e!==V.CLOUD_FORMATION)),le=V.CLOUD_FORMATION,re=V.ASSUME_ROLE,ce=V.DIRECT_ACCESS_KEYS,ue=()=>({[V.ASSUME_ROLE]:{label:x.i18n.translate("xpack.csp.awsIntegration.assumeRoleLabel",{defaultMessage:"Assume role"}),info:Q,fields:{role_arn:{label:x.i18n.translate("xpack.csp.awsIntegration.roleArnLabel",{defaultMessage:"Role ARN"}),dataTestSubj:"awsRoleArnInput"}}},[V.DIRECT_ACCESS_KEYS]:{label:x.i18n.translate("xpack.csp.awsIntegration.directAccessKeyLabel",{defaultMessage:"Direct access keys"}),info:ee,fields:{access_key_id:{label:se.access_key_id,dataTestSubj:"awsDirectAccessKeyId"},secret_access_key:{label:se.secret_access_key,type:"password",dataTestSubj:"awsDirectAccessSecretKey",isSecret:!0}}},[V.TEMPORARY_KEYS]:{info:te,label:x.i18n.translate("xpack.csp.awsIntegration.temporaryKeysLabel",{defaultMessage:"Temporary keys"}),fields:{access_key_id:{label:se.access_key_id,dataTestSubj:"awsTemporaryKeysAccessKeyId"},secret_access_key:{label:se.secret_access_key,type:"password",dataTestSubj:"awsTemporaryKeysSecretAccessKey",isSecret:!0},session_token:{label:x.i18n.translate("xpack.csp.awsIntegration.sessionTokenLabel",{defaultMessage:"Session Token"}),dataTestSubj:"awsTemporaryKeysSessionToken"}}},[V.SHARED_CREDENTIALS]:{label:x.i18n.translate("xpack.csp.awsIntegration.sharedCredentialLabel",{defaultMessage:"Shared credentials"}),info:ae,fields:{shared_credential_file:{label:x.i18n.translate("xpack.csp.awsIntegration.sharedCredentialFileLabel",{defaultMessage:"Shared Credential File"}),dataTestSubj:"awsSharedCredentialFile"},credential_profile_name:{label:x.i18n.translate("xpack.csp.awsIntegration.credentialProfileNameLabel",{defaultMessage:"Credential Profile Name"}),dataTestSubj:"awsCredentialProfileName"}}},[V.CLOUD_FORMATION]:{label:"CloudFormation",info:[],fields:{}}}),de="google_cloud_shell",pe="manual",ge="credentials-file",je="credentials-json",be="credentials-none",fe=()=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiHorizontalRule,{margin:"xl"}),Object(m.jsx)(g.EuiTitle,{size:"xs"},Object(m.jsx)("h2",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.setupInfoContentTitle",defaultMessage:"Setup Access"}))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.setupInfoContent",defaultMessage:"The integration will need elevated access to run some CIS benchmark rules. Select your preferred method of providing the GCP credentials this integration will use. You can follow these step-by-step instructions to generate the necessary credentials."})));var xe={name:"qdust2",styles:"list-style:auto"};const me=({fields:e,onChange:t,input:a,disabled:s})=>{var i,o,l,r;const c=null===(i=a.streams)||void 0===i||null===(o=i[0])||void 0===o||null===(l=o.vars)||void 0===l||null===(r=l["gcp.account_type"])||void 0===r?void 0:r.value,u=t=>e.find((e=>e.id===t)),d=u("gcp.project_id"),p=u("gcp.organization_id");return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s","data-test-subj":G.g.GOOGLE_CLOUD_SHELL_SETUP},Object(m.jsx)("ol",{css:xe},Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.cloudShellSetupStep.hostRequirement",defaultMessage:'Ensure "New hosts" is selected in the "Where to add this integration?" section below'})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.cloudShellSetupStep.login",defaultMessage:"Log into your Google Cloud Console"})),c===ht?Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.organizationCloudShellSetupStep.save",defaultMessage:"Note down the GCP organization ID of the organization you wish to monitor and project ID where you want to provision resources for monitoring purposes and provide them in the input boxes below"})):Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.cloudShellSetupStep.save",defaultMessage:"Note down the GCP project ID of the project you wish to monitor"})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.cloudShellSetupStep.launch",defaultMessage:'Click "Save and Continue" at the bottom right of the page. Then, on the pop-up modal, click "Launch Google Cloud Shell"'})))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiForm,{component:"form"},p&&c===ht&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.organization_id"].label},Object(m.jsx)(g.EuiFieldText,{disabled:s,"data-test-subj":G.g.ORGANIZATION_ID,id:p.id,fullWidth:!0,value:p.value||"",onChange:e=>t(p.id,e.target.value)})),d&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.project_id"].label},Object(m.jsx)(g.EuiFieldText,{disabled:s,"data-test-subj":G.g.PROJECT_ID,id:d.id,fullWidth:!0,value:d.value||"",onChange:e=>t(d.id,e.target.value)}))),Object(m.jsx)(g.EuiSpacer,{size:"m"}))},Oe=[{text:x.i18n.translate("xpack.csp.gcpIntegration.credentialsFileOption",{defaultMessage:"Credentials File"}),value:ge,"data-test-subj":"credentials_file_option_test_id"},{text:x.i18n.translate("xpack.csp.gcpIntegration.credentialsJsonOption",{defaultMessage:"Credentials JSON"}),value:je,"data-test-subj":"credentials_json_option_test_id"}],Ee={fields:{"gcp.organization_id":{label:x.i18n.translate("xpack.csp.gcpIntegration.organizationIdFieldLabel",{defaultMessage:"Organization ID"}),type:"text"},"gcp.project_id":{label:x.i18n.translate("xpack.csp.gcpIntegration.projectidFieldLabel",{defaultMessage:"Project ID"}),type:"text"},"gcp.credentials.file":{label:x.i18n.translate("xpack.csp.findings.gcpIntegration.gcpInputText.credentialFileText",{defaultMessage:"Path to JSON file containing the credentials and key used to subscribe"}),type:"text"},"gcp.credentials.json":{label:x.i18n.translate("xpack.csp.findings.gcpIntegration.gcpInputText.credentialJSONText",{defaultMessage:"JSON blob containing the credentials and key used to subscribe"}),type:"text"},"gcp.credentials.type":{label:x.i18n.translate("xpack.csp.findings.gcpIntegration.gcpInputText.credentialSelectBoxTitle",{defaultMessage:"Credential"}),type:"text"}}},he=(e,t)=>Object.entries(e.streams[0].vars||{}).filter((([e])=>e in t)).map((([e,a])=>{const s=t[e];return{id:e,label:s.label,type:s.type||"text",value:a.value}})),Ie=(e,t,a)=>{null==t||t({...e,inputs:e.inputs.map((e=>e.type===I.m?{...e,config:{cloud_shell_url:{value:a}}}:e))})},ye=({input:e,newPolicy:t,updatePolicy:a,packageInfo:i,setIsValid:o,onChange:l,disabled:c})=>{var d,j,f,O;const h=(({"gcp.credentials.file":e,"gcp.credentials.json":t})=>({"gcp.credentials.file":e,"gcp.credentials.json":t}))(Ee.fields),y=he(e,h),v=he(e,Ee.fields),T=r()(i.version),A=u()(T)||"",_=p()(A,S.q),C=Object(s.useRef)({}),M=Object(s.useRef)(void 0),L=(e=>{var t,a;const s=null===(t=e.streams[0].vars)||void 0===t||null===(a=t.setup_access)||void 0===a?void 0:a.value;return s&&s!==de?pe:de})(e),k="organization-account"===(null===(d=e.streams)||void 0===d||null===(j=d[0])||void 0===j||null===(f=j.vars)||void 0===f||null===(O=f["gcp.account_type"])||void 0===O?void 0:O.value);return Object(s.useEffect)((()=>{const e=_;o(!e),l({isValid:!e,updatedPolicy:t})}),[L,e.type]),(({packageInfo:e,newPolicy:t,updatePolicy:a,setupFormat:n})=>{var i;Object(s.useEffect)((()=>{const s=(e=>{var t,a,s,n;return(null==e||null===(t=e.inputs)||void 0===t||null===(a=t.find((e=>e.type===I.m)))||void 0===a||null===(s=a.config)||void 0===s||null===(n=s.cloud_shell_url)||void 0===n?void 0:n.value)||void 0})(t);if(n===pe)return void(s&&Ie(t,a,void 0));const i=Je(e);""!==i&&s!==i&&Ie(t,a,i)}),[null==t||null===(i=t.vars)||void 0===i?void 0:i.cloud_shell_url,t,e,n])})({packageInfo:i,newPolicy:t,updatePolicy:a,setupFormat:L}),_?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.gcpIntegration.gcpNotSupportedMessage",defaultMessage:"CIS GCP is not supported on the current Integration version, please upgrade your integration to the latest version to use CIS GCP"}))):Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(fe,null),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(E,{disabled:c,size:"s",options:[{id:de,label:x.i18n.translate("xpack.csp.gcpIntegration.setupFormatOptions.googleCloudShell",{defaultMessage:"Google Cloud Shell"}),disabled:!1,testId:G.s.CLOUD_SHELL},{id:pe,label:x.i18n.translate("xpack.csp.gcpIntegration.setupFormatOptions.manual",{defaultMessage:"Manual"}),disabled:!1,testId:G.s.MANUAL}],idSelected:L,onChange:s=>s!==L&&void(s===de?(C.current=Object.fromEntries(y.map((e=>[e.id,{value:e.value}]))),M.current=(e=>{var t;return null===(t=e.streams[0].vars)||void 0===t?void 0:t["gcp.credentials.type"].value})(e),a(Be(t,e.type,{setup_access:{value:de,type:"text"},"gcp.credentials.type":{value:be,type:"text"},...Object.fromEntries(y.map((e=>[e.id,{value:void 0}])))}))):a(Be(t,e.type,{setup_access:{value:pe,type:"text"},"gcp.credentials.type":{value:M.current||ge,type:"text"},...C.current})))}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),L===de?Object(m.jsx)(me,{disabled:c,fields:v,onChange:(s,n)=>a(Be(t,e.type,{[s]:{value:n}})),input:e}):Object(m.jsx)(ve,{disabled:c,fields:v,onChange:(s,n)=>a(Be(t,e.type,{[s]:{value:n}})),isOrganization:k}),Object(m.jsx)(g.EuiSpacer,{size:"s"}),Object(m.jsx)(q,{url:D.d.cspm.getStartedPath}),Object(m.jsx)(g.EuiSpacer,null))},ve=({fields:e,onChange:t,isOrganization:a,disabled:s})=>{const n=t=>e.find((e=>e.id===t)),i=n("gcp.organization_id"),o=n("gcp.project_id"),l=n("gcp.credentials.type"),r=n("gcp.credentials.file"),c=n("gcp.credentials.json"),u=Oe[0].value,d=Oe[1].value,p=(null==l?void 0:l.value)||r&&u||c&&d;return Object(m.jsx)("div",null,Object(m.jsx)(g.EuiForm,{component:"form"},i&&a&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.organization_id"].label},Object(m.jsx)(g.EuiFieldText,{disabled:s,"data-test-subj":G.g.ORGANIZATION_ID,id:i.id,fullWidth:!0,value:i.value||"",onChange:e=>t(i.id,e.target.value)})),o&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.project_id"].label},Object(m.jsx)(g.EuiFieldText,{disabled:s,"data-test-subj":G.g.PROJECT_ID,id:o.id,fullWidth:!0,value:o.value||"",onChange:e=>t(o.id,e.target.value)})),l&&r&&c&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.credentials.type"].label},Object(m.jsx)(g.EuiSelect,{"data-test-subj":G.g.CREDENTIALS_TYPE,fullWidth:!0,options:Oe,value:(null==l?void 0:l.value)||Oe[0].value,onChange:e=>{t(null==l?void 0:l.id,e.target.value)}})),p===u&&r&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.credentials.file"].label},Object(m.jsx)(g.EuiFieldText,{"data-test-subj":G.g.CREDENTIALS_FILE,id:r.id,fullWidth:!0,value:r.value||"",onChange:e=>t(r.id,e.target.value)})),p===d&&c&&Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Ee.fields["gcp.credentials.json"].label},Object(m.jsx)(g.EuiTextArea,{"data-test-subj":G.g.CREDENTIALS_JSON,id:c.id,fullWidth:!0,value:c.value||"",onChange:e=>t(c.id,e.target.value)}))))},Se=(e,t)=>Object.entries(e.streams[0].vars||{}).filter((([e])=>e in t)).map((([e,a])=>{const s=t[e];return{id:e,label:s.label,type:s.type||"text",testSubj:s.testSubj,value:a.value,isSecret:null==s?void 0:s.isSecret}})),Te=x.i18n.translate("xpack.csp.azureIntegration.tenantIdLabel",{defaultMessage:"Tenant ID"}),Ae=x.i18n.translate("xpack.csp.azureIntegration.clientIdLabel",{defaultMessage:"Client ID"}),_e=()=>({[Re.MANAGED_IDENTITY]:{label:x.i18n.translate("xpack.csp.azureIntegration.credentialType.managedIdentityLabel",{defaultMessage:"Managed Identity"}),info:Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.credentialType.managedIdentityInfo",defaultMessage:"Ensure the agent is deployed on a resource that supports managed identities (e.g., Azure Virtual Machines). No explicit credentials need to be provided; Azure handles the authentication."})),fields:{}},[Re.ARM_TEMPLATE]:{label:"ARM Template",info:[],fields:{}},[Re.MANUAL]:{label:"Manual",info:[],fields:{}},[Re.SERVICE_PRINCIPAL_WITH_CLIENT_SECRET]:{label:x.i18n.translate("xpack.csp.azureIntegration.servicePrincipalWithClientSecretLabel",{defaultMessage:"Service principal with Client Secret"}),fields:{"azure.credentials.tenant_id":{label:Te,testSubj:G.e.TENANT_ID},"azure.credentials.client_id":{label:Ae,testSubj:G.e.CLIENT_ID},"azure.credentials.client_secret":{type:"password",isSecret:!0,label:x.i18n.translate("xpack.csp.azureIntegration.clientSecretLabel",{defaultMessage:"Client Secret"}),testSubj:G.e.CLIENT_SECRET}}},[Re.SERVICE_PRINCIPAL_WITH_CLIENT_CERTIFICATE]:{label:x.i18n.translate("xpack.csp.azureIntegration.servicePrincipalWithClientCertificateLabel",{defaultMessage:"Service principal with Client Certificate"}),fields:{"azure.credentials.tenant_id":{label:Te,testSubj:G.e.TENANT_ID},"azure.credentials.client_id":{label:Ae,testSubj:G.e.CLIENT_ID},"azure.credentials.client_certificate_path":{label:x.i18n.translate("xpack.csp.azureIntegration.clientCertificatePathLabel",{defaultMessage:"Client Certificate Path"}),testSubj:G.e.CLIENT_CERTIFICATE_PATH},"azure.credentials.client_certificate_password":{type:"password",isSecret:!0,label:x.i18n.translate("xpack.csp.azureIntegration.clientCertificatePasswordLabel",{defaultMessage:"Client Certificate Password"}),testSubj:G.e.CLIENT_CERTIFICATE_PASSWORD}}},[Re.SERVICE_PRINCIPAL_WITH_CLIENT_USERNAME_AND_PASSWORD]:{label:x.i18n.translate("xpack.csp.azureIntegration.servicePrincipalWithClientUsernameAndPasswordLabel",{defaultMessage:"Service principal with Client Username and Password"}),fields:{"azure.credentials.tenant_id":{label:Te,testSubj:G.e.TENANT_ID},"azure.credentials.client_id":{label:Ae,testSubj:G.e.CLIENT_ID},"azure.credentials.client_username":{label:x.i18n.translate("xpack.csp.azureIntegration.clientUsernameLabel",{defaultMessage:"Client Username"}),testSubj:G.e.CLIENT_USERNAME},"azure.credentials.client_password":{type:"password",isSecret:!0,label:x.i18n.translate("xpack.csp.azureIntegration.clientPasswordLabel",{defaultMessage:"Client Password"}),testSubj:G.e.CLIENT_PASSWORD}}}}),Ce=e=>{var t,a;return null===(t=e.streams[0].vars)||void 0===t||null===(a=t["azure.credentials.type"])||void 0===a?void 0:a.value},Me=(e,t,a)=>{null==t||t({...e,inputs:e.inputs.map((e=>e.type===I.k?{...e,config:{arm_template_url:{value:a}}}:e))})},Le=({newPolicy:e,input:t,packageInfo:a,onChange:n,setIsValid:i,updatePolicy:o})=>{const l=Ce(t)||Re.ARM_TEMPLATE,r=_e(),c=!!Ye(a),u=((e,t)=>{const a=Ce(e);return!a&&t?ke.ARM_TEMPLATE:a!==Re.ARM_TEMPLATE?ke.MANUAL:ke.ARM_TEMPLATE})(t,c),d=r[l],p=Se(t,d.fields),g=Object(s.useRef)({}),j=Object(s.useRef)(void 0);Object(s.useEffect)((()=>{const t=u===ke.ARM_TEMPLATE&&!c;i(!t),n({isValid:!t,updatedPolicy:e})}),[u,t.type]);const b=D.d.cspm.getStartedPath;(({packageInfo:e,newPolicy:t,updatePolicy:a,setupFormat:n})=>{var i;Object(s.useEffect)((()=>{const s=(e=>{var t,a,s,n;return(null==e||null===(t=e.inputs)||void 0===t||null===(a=t.find((e=>e.type===I.k)))||void 0===a||null===(s=a.config)||void 0===s||null===(n=s.arm_template_url)||void 0===n?void 0:n.value)||void 0})(t);if(n===ke.MANUAL)return void(s&&Me(t,a,void 0));const i=Ye(e);""!==i&&s!==i&&Me(t,a,i)}),[null==t||null===(i=t.vars)||void 0===i?void 0:i.arm_template_url,t,e,n])})({packageInfo:a,newPolicy:e,updatePolicy:o,setupFormat:u});const f=Re.MANAGED_IDENTITY;return{azureCredentialsType:l,setupFormat:u,group:d,fields:p,integrationLink:b,hasArmTemplateUrl:c,onSetupFormatChange:a=>{a===ke.ARM_TEMPLATE?(g.current=Object.fromEntries(null==p?void 0:p.map((e=>[e.id,{value:e.value}]))),j.current=Ce(t),o(Be(e,t.type,{"azure.credentials.type":{value:Re.ARM_TEMPLATE,type:"text"},...Object.fromEntries(null==p?void 0:p.map((e=>[e.id,{value:void 0}])))}))):o(Be(e,t.type,{"azure.credentials.type":{value:j.current||f,type:"text"},...g.current}))}}},ke={ARM_TEMPLATE:"arm_template",MANUAL:"manual"},Re={ARM_TEMPLATE:"arm_template",MANUAL:"manual",SERVICE_PRINCIPAL_WITH_CLIENT_SECRET:"service_principal_with_client_secret",SERVICE_PRINCIPAL_WITH_CLIENT_CERTIFICATE:"service_principal_with_client_certificate",SERVICE_PRINCIPAL_WITH_CLIENT_USERNAME_AND_PASSWORD:"service_principal_with_client_username_and_password",MANAGED_IDENTITY:"managed_identity"},Ne=({integrationLink:e})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiHorizontalRule,{margin:"xl"}),Object(m.jsx)(g.EuiTitle,{size:"xs"},Object(m.jsx)("h2",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.setupInfoContentTitle",defaultMessage:"Setup Access"}))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.gettingStarted.setupInfoContent",defaultMessage:"Utilize an Azure Resource Manager (ARM) template (a built-in Azure IaC tool) or a series of manual steps to set up and deploy CSPM for assessing your Azure environment's security posture. Refer to our {gettingStartedLink} for details.",values:{gettingStartedLink:Object(m.jsx)(g.EuiLink,{href:e,target:"_blank"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.gettingStarted.setupInfoContentLink",defaultMessage:"Getting Started guide"}))}}))),Fe="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/";var we={name:"qdust2",styles:"list-style:auto"};const ze=({hasArmTemplateUrl:e,input:t})=>e?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)("ol",{css:we},Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupStep.hostRequirement",defaultMessage:'Ensure "New hosts" is selected in the "Where to add this integration?" section below'})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupStep.login",defaultMessage:"Log in to your Azure portal."})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupStep.save",defaultMessage:"Click the Save and continue button on the bottom right of this page."})),Object(m.jsx)("li",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupStep.launch",defaultMessage:"On the subsequent pop-up modal, copy the relevant Bash command, then click on the Launch ARM Template button."})))),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupNote",defaultMessage:"Read the {documentation} for more details",values:{documentation:Object(m.jsx)(g.EuiLink,{href:Fe,target:"_blank",rel:"noopener nofollow noreferrer","data-test-subj":"externalLink"},x.i18n.translate("xpack.csp.azureIntegration.documentationLinkText",{defaultMessage:"documentation"}))}}))):Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupStep.notSupported",defaultMessage:"ARM Template is not supported on the current Integration version, please upgrade your integration to the latest version to use ARM Template"})),Pe=({type:e,onChange:t})=>Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:x.i18n.translate("xpack.csp.azureIntegration.azureCredentialTypeSelectorLabel",{defaultMessage:"Preferred manual method"})},Object(m.jsx)(g.EuiSelect,{fullWidth:!0,options:Object.entries(_e()).map((([e,t])=>({value:e,text:t.label}))).filter((({value:e})=>e!==Re.ARM_TEMPLATE&&e!==Re.MANUAL&&e!==Re.SERVICE_PRINCIPAL_WITH_CLIENT_USERNAME_AND_PASSWORD)),value:e,onChange:e=>{t(e.target.value)},"data-test-subj":G.c})),De=({integrationLink:e})=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.manualCredentialType.instructions",defaultMessage:"Ensure the agent is deployed on a resource that supports managed identities (e.g., Azure Virtual Machines). No explicit credentials need to be provided; Azure handles the authentication. Refer to our {gettingStartedLink} for details.",values:{gettingStartedLink:Object(m.jsx)(g.EuiLink,{href:e,target:"_blank"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.gettingStarted.setupInfoContentLink",defaultMessage:"Getting Started guide"}))}})),Object(m.jsx)(g.EuiSpacer,null),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.manualCredentialType.documentaion",defaultMessage:"Read the {documentation} for more details",values:{documentation:Object(m.jsx)(g.EuiLink,{href:Fe,target:"_blank",rel:"noopener nofollow noreferrer","data-test-subj":"externalLink"},x.i18n.translate("xpack.csp.azureIntegration.documentationLinkText",{defaultMessage:"documentation"}))}})));var $e={name:"165tmv5",styles:"width:100%;.euiFormControlLayout,.euiFormControlLayout__childrenWrapper,.euiFormRow,input{max-width:100%;width:100%;}"};const Ue=({fields:e,packageInfo:t,onChange:a})=>Object(m.jsx)("div",null,e.map((e=>Object(m.jsx)(n.a.Fragment,null,"password"===e.type&&!0===e.isSecret&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)("div",{css:$e},Object(m.jsx)(s.Suspense,{fallback:Object(m.jsx)(g.EuiLoadingSpinner,{size:"l"})},Object(m.jsx)(j.LazyPackagePolicyInputVarField,{varDef:{...et(t,e.id),required:!0,type:"password"},value:e.value||"",onChange:t=>{a(e.id,t)},errors:[],forceShowErrors:!1,isEditPage:!0})))),"text"===e.type&&Object(m.jsx)(g.EuiFormRow,{key:e.id,label:e.label,fullWidth:!0,hasChildLabel:!0,id:e.id},Object(m.jsx)(g.EuiFieldText,{id:e.id,fullWidth:!0,value:e.value||"",onChange:t=>a(e.id,t.target.value),"data-test-subj":e.testSubj})))))),Ge=({input:e,newPolicy:t,updatePolicy:a,packageInfo:i,onChange:o,setIsValid:l,disabled:c})=>{const{group:d,fields:j,azureCredentialsType:f,setupFormat:O,onSetupFormatChange:h,integrationLink:I,hasArmTemplateUrl:y}=Le({newPolicy:t,input:e,packageInfo:i,onChange:o,setIsValid:l,updatePolicy:a});Object(s.useEffect)((()=>{O||h(ke.ARM_TEMPLATE)}),[O,h]);const v=r()(i.version),S=u()(v)||"",T=!p()(S,"1.6.0"),A=!p()(S,"1.7.0");return Object(s.useEffect)((()=>{l(T),o({isValid:T,updatedPolicy:t})}),[e,i,O]),T?Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(Ne,{integrationLink:I}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(E,{disabled:c,size:"m",options:[{id:ke.ARM_TEMPLATE,label:"ARM Template",testId:G.f.ARM_TEMPLATE},{id:ke.MANUAL,label:x.i18n.translate("xpack.csp.azureIntegration.setupFormatOptions.manual",{defaultMessage:"Manual"}),testId:G.f.MANUAL}],idSelected:O,onChange:e=>e!==O&&h(e)}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),O===ke.ARM_TEMPLATE&&Object(m.jsx)(ze,{hasArmTemplateUrl:y,input:e}),O===ke.MANUAL&&!A&&Object(m.jsx)(De,{integrationLink:I}),O===ke.MANUAL&&A&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(Pe,{type:f,onChange:s=>{a(Be(t,e.type,{"azure.credentials.type":{value:s}}))}}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(Ue,{fields:j,packageInfo:i,onChange:(s,n)=>{a(Be(t,e.type,{[s]:{value:n}}))}}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),d.info,Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.manualCredentialType.documentation",defaultMessage:"Read the {documentation} for more details",values:{documentation:Object(m.jsx)(g.EuiLink,{href:Fe,target:"_blank",rel:"noopener nofollow noreferrer","data-test-subj":"externalLink"},x.i18n.translate("xpack.csp.azureIntegration.documentationLinkText",{defaultMessage:"documentation"}))}}))),Object(m.jsx)(g.EuiSpacer,null)):Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.azureNotSupportedMessage",defaultMessage:"CIS Azure is not supported on the current Integration version, please upgrade your integration to the latest version to use CIS Azure"})))},We="default",Ve=e=>{switch(e){case I.j:case I.k:case I.m:return"cspm";case I.o:case I.l:return"kspm";case I.p:return"vuln_mgmt";default:return"n/a"}},Ke=e=>{switch(e){case I.j:case I.p:return"aws";case I.k:return"azure";case I.m:return"gcp";case I.o:return"self_managed";case I.l:return"eks";default:return"n/a"}},Be=(e,t,a)=>({...e,namespace:We,inputs:e.inputs.map((e=>((e,t,a)=>{const s=e.type===t;return{...e,enabled:s,streams:e.streams.map((e=>({...e,enabled:s,...s&&a&&{vars:{...e.vars,...a}}})))}})(e,t,a))),vars:v()({},e.vars,{deployment:{value:Ke(t)},posture:{value:Ve(t)}})}),Xe=e=>e.hasOwnProperty("inputs"),He=e=>{if(!e.policy_templates)return"";const t=e.policy_templates.find((e=>e.name===I.v));if(!t)return"";const a=Xe(t)&&t.inputs;return a?a.reduce(((e,t)=>{var a;if(!t.vars)return e;const s=null===(a=t.vars.find((e=>"cloud_formation_template"===e.name)))||void 0===a?void 0:a.default;return s?String(s):e}),""):""},Ye=e=>{if(!e.policy_templates)return"";const t=e.policy_templates.find((e=>e.name===I.v));if(!t)return"";const a=Xe(t)&&t.inputs;return a?a.reduce(((e,t)=>{var a;if(!t.vars)return e;const s=null===(a=t.vars.find((e=>"arm_template_url"===e.name)))||void 0===a?void 0:a.default;return s?String(s):e}),""):""},qe=(e,t)=>t&&t===j.SetupTechnology.AGENTLESS?ce:He(e)?le:re,Ze=(e,t)=>t&&t===j.SetupTechnology.AGENTLESS?Re.SERVICE_PRINCIPAL_WITH_CLIENT_SECRET:Ye(e)?Re.ARM_TEMPLATE:Re.MANAGED_IDENTITY,Je=e=>{if(!e.policy_templates)return"";const t=e.policy_templates.find((e=>e.name===I.v));if(!t)return"";const a=Xe(t)&&t.inputs;return a?a.reduce(((e,t)=>{var a;if(!t.vars)return e;const s=null===(a=t.vars.find((e=>"cloud_shell_url"===e.name)))||void 0===a?void 0:a.default;return s?String(s):e}),""):""},Qe=e=>{var t;return null===(t=e.streams[0].vars)||void 0===t?void 0:t["aws.credentials.type"].value},et=(e,t)=>{var a;return null==e||null===(a=e.data_streams)||void 0===a?void 0:a.filter((e=>void 0!==e)).map((e=>e.streams)).filter((e=>void 0!==e)).flat().filter((e=>void 0!==(null==e?void 0:e.vars))).map((e=>null==e?void 0:e.vars)).flat().find((e=>(null==e?void 0:e.name)===t))};var tt=a(5),at=a.n(tt);const st=({input:e,newPolicy:t,updatePolicy:a,packageInfo:s})=>{const i=D.d.cspm.getStartedPath,o=_e()[Re.SERVICE_PRINCIPAL_WITH_CLIENT_SECRET],l=Se(e,o.fields);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(Ne,{integrationLink:i}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(Ue,{packageInfo:s,fields:l,onChange:(s,n)=>{a(Be(t,e.type,{[s]:{value:n}}))}}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.azureIntegration.armTemplateSetupNote",defaultMessage:"Read the {documentation} for more details",values:{documentation:Object(m.jsx)(g.EuiLink,{href:Fe,target:"_blank",rel:"noopener nofollow noreferrer","data-test-subj":"externalLink"},x.i18n.translate("xpack.csp.azureIntegration.documentationLinkText",{defaultMessage:"documentation"}))}})))},nt=(e,t,a)=>{if(null==e||!e.policy_templates)return;const s=e.policy_templates.find((e=>e.name===t));if(s&&"inputs"in s){var n;const e=null===(n=s.inputs)||void 0===n?void 0:n.reduce(((e,t)=>{var s;if(!t.vars)return e;const n=null===(s=t.vars.find((e=>e.name===a)))||void 0===s?void 0:s.default;return n?String(n):e}),"");return""!==e?e:void 0}},it=({input:e,newPolicy:t,packageInfo:a,updatePolicy:s})=>{var i,l,c,u,d;const p=Qe(e)||ce,j=ue()[p],f=ne(e,j.fields),O=D.d.cspm.getStartedPath,E=null!==(i=null==e||null===(l=e.streams)||void 0===l||null===(c=l[0].vars)||void 0===c||null===(u=c["aws.account_type"])||void 0===u?void 0:u.value)&&void 0!==i?i:I.T,h=!!r()(a.version)&&o()(a.version,I.s)>=0,y=null===(d=nt(a,e.policy_template,"cloud_formation_credentials_template"))||void 0===d?void 0:d.replace(I.Z,E);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(K,{info:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.gettingStarted.setupInfoContentAgentless",defaultMessage:"Utilize AWS Access Keys to set up and deploy CSPM for assessing your AWS environment's security posture. Refer to our {gettingStartedLink} guide for details.",values:{gettingStartedLink:Object(m.jsx)(g.EuiLink,{href:O,target:"_blank"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.awsIntegration.gettingStarted.setupInfoContentLink",defaultMessage:"Getting Started"}))}})}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(J,{label:x.i18n.translate("xpack.csp.awsIntegration.awsCredentialTypeSelectorLabelAgentless",{defaultMessage:"Preferred method"}),type:p,options:ie((({value:e})=>e===V.DIRECT_ACCESS_KEYS||e===V.TEMPORARY_KEYS)),onChange:a=>{s(Be(t,e.type,{"aws.credentials.type":{value:a}}))}}),Object(m.jsx)(g.EuiSpacer,{size:"m"}),!h&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.awsCloudCredentials.cloudFormationSupportedMessage",defaultMessage:"Launch Cloud Formation for Automated Credentials not supported in current integration version. Please upgrade to the latest version to enable Launch CloudFormation for automated credentials."})),Object(m.jsx)(g.EuiSpacer,{size:"m"})),p===ce&&h&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(g.EuiButton,{"data-test-subj":"launchCloudFormationAgentlessButton",target:"_blank",iconSide:"left",iconType:"launch",href:y},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.agentlessForm.agentlessAWSCredentialsForm.cloudFormation.launchButton",defaultMessage:"Launch CloudFormation"})),Object(m.jsx)(g.EuiSpacer,{size:"m"})),Object(m.jsx)(A,{fields:f,packageInfo:a,onChange:(a,n)=>{s(Be(t,e.type,{[a]:{value:n}}))}}))},ot=({input:e,newPolicy:t,updatePolicy:a,packageInfo:s,disabled:i})=>{var l,c,u,d,p;const j=null===(l=e.streams)||void 0===l||null===(c=l[0])||void 0===c||null===(u=c.vars)||void 0===u||null===(d=u["gcp.account_type"])||void 0===d?void 0:d.value,f=j===I.P,x=["gcp.organization_id","gcp.credentials.json"],O=["gcp.project_id","gcp.credentials.json"],E=!!r()(s.version)&&o()(s.version,I.s)>=0,h=he(e,Ee.fields).filter((e=>f?x.includes(e.id):O.includes(e.id))),y=null===(p=nt(s,e.policy_template,"cloud_shell_url"))||void 0===p?void 0:p.replace(I.Z,j);return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"m"}),!E&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.gcpCloudCredentials.cloudFormationSupportedMessage",defaultMessage:"Launch Cloud Shell for automated credentials not supported in current integration version. Please upgrade to the latest version to enable Launch Cloud Shell for automated credentials."})),Object(m.jsx)(g.EuiSpacer,{size:"m"})),E&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiButton,{"data-test-subj":"launchGoogleCloudShellAgentlessButton",target:"_blank",iconSide:"left",iconType:"launch",href:y},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.agentlessForm.googleCloudShell.cloudCredentials.button",defaultMessage:"Launch Google Cloud Shell"})),Object(m.jsx)(g.EuiSpacer,{size:"l"})),Object(m.jsx)(ve,{disabled:i,fields:h,onChange:(s,n)=>a(Be(t,e.type,{[s]:{value:n}})),isOrganization:f}),Object(m.jsx)(g.EuiSpacer,{size:"s"}),Object(m.jsx)(q,{url:D.d.cspm.getStartedPath}),Object(m.jsx)(g.EuiSpacer,null))},lt=({policy:e,selectedTemplate:t,setPolicyTemplate:a,disabled:s})=>{const n=new Set(e.inputs.map((e=>e.policy_template)));return Object(m.jsx)("div",null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.selectIntegrationTypeTitle",defaultMessage:"Select the type of security posture management integration you want to configure"})),Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(E,{options:Array.from(n,(e=>{return{id:e,label:(t=e,t===I.eb?I.u.toUpperCase():t.toUpperCase())};var t})),idSelected:t,onChange:e=>a(e),disabled:s}))},rt=({input:e,setupTechnology:t,...a})=>{const s=t===j.SetupTechnology.AGENTLESS;switch(e.type){case"cloudbeat/cis_eks":return Object(m.jsx)(z,at()({},a,{input:e}));case"cloudbeat/cis_aws":return s?Object(m.jsx)(it,at()({},a,{input:e})):Object(m.jsx)(Z,at()({},a,{input:e}));case"cloudbeat/cis_gcp":return s?Object(m.jsx)(ot,at()({},a,{input:e})):Object(m.jsx)(ye,at()({},a,{input:e}));case"cloudbeat/cis_azure":return s?Object(m.jsx)(st,at()({},a,{input:e})):Object(m.jsx)(Ge,at()({},a,{input:e}));default:return null}},ct=({postureType:e})=>Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},e===I.J&&Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.configureKspmIntegrationDescription",defaultMessage:"Select the Kubernetes cluster type you want to monitor and then fill in the name and description to help identify this integration"}),e===I.v&&Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.configureCspmIntegrationDescription",defaultMessage:"Select the cloud service provider (CSP) you want to monitor and then fill in the name and description to help identify this integration"}),e===I.eb&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{iconType:"iInCircle",color:"primary","data-test-subj":"additionalChargeCalloutTestSubj",title:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.cnvm.additionalChargesCalloutTitle",defaultMessage:"Additional charges on cloud provider billing account."})},Object(m.jsx)(g.EuiText,{size:"s"},Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.cnvm.additionalChargesCalloutDescription",defaultMessage:"Please note that using this service may result in additional charges on your next cloud provider billing statement due to increased usage."})))),Object(m.jsx)(g.EuiSpacer,{size:"m"}),Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.cnvm.configureIntegrationDescription",defaultMessage:"Select the cloud service provider (CSP) you want to monitor and then fill in the name and description to help identify this integration"}))),ut=({input:e,disabled:t,setInput:a})=>{var s;const n=(s=e.policy_template,S.v[s].options.map((e=>({tooltip:e.tooltip,value:e.type,id:e.type,label:e.name,icon:e.icon,disabled:e.disabled,isBeta:e.isBeta,testId:e.testId})))).map((e=>({...e,disabled:e.disabled||t,label:e.label,icon:e.icon})));return Object(m.jsx)(E,{disabled:t,idSelected:e.type,options:n,onChange:e=>a(e),size:"m"})};var dt=a(31),pt=a(21),gt=a(8);const jt=["packagePolicyList"],bt=({disabled:e,setupTechnology:t,onSetupTechnologyChange:a})=>{const s=[{value:j.SetupTechnology.AGENTLESS,inputDisplay:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentlessInputDisplay",defaultMessage:"Agentless"}),dropdownDisplay:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)("strong",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentlessDrowpownDisplay",defaultMessage:"Agentless"})),Object(m.jsx)(g.EuiText,{size:"s",color:"subdued"},Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentlessDrowpownDescription",defaultMessage:"Set up the integration without an agent"}))))},{value:j.SetupTechnology.AGENT_BASED,inputDisplay:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentbasedInputDisplay",defaultMessage:"Agent-based"}),dropdownDisplay:Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)("strong",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentbasedDrowpownDisplay",defaultMessage:"Agent-based"})),Object(m.jsx)(g.EuiText,{size:"s",color:"subdued"},Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.agentbasedDrowpownDescription",defaultMessage:"Set up the integration with an agent"}))))}];return Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiAccordion,{isDisabled:e,initialIsOpen:e,id:Object(g.useGeneratedHtmlId)({prefix:"setup-type"}),buttonContent:Object(m.jsx)(g.EuiLink,{disabled:e},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.advancedOptionsLabel",defaultMessage:"Advanced options"})),"data-test-subj":G.w},Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiFormRow,{fullWidth:!0,label:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.setupTechnologyLabel",defaultMessage:"Setup technology"})},Object(m.jsx)(g.EuiSuperSelect,{disabled:e,options:s,valueOfSelected:t,placeholder:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.setupTechnology.setupTechnologyPlaceholder",defaultMessage:"Select the setup technology"}),onChange:a,itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0,"data-test-subj":G.x}))))},ft={kspm:I.o,cspm:I.j,vuln_mgmt:I.p},xt=()=>Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiTitle,{size:"s"},Object(m.jsx)("h4",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.integrationSettingsTitle",defaultMessage:"Integration Settings"}))),Object(m.jsx)(g.EuiSpacer,null)),mt="single-account",Ot="organization-account",Et="single-account",ht="organization-account",It="single-account",yt="organization-account",vt=e=>{var t,a;return null===(t=e.streams[0].vars)||void 0===t||null===(a=t["aws.account_type"])||void 0===a?void 0:a.value},St=({input:e,newPolicy:t,updatePolicy:a,packageInfo:i,disabled:l})=>{const c=!r()(i.version)||o()(i.version,"1.5.0-preview20")<0,u=Object(s.useMemo)((()=>(e=>[{id:Ot,label:x.i18n.translate("xpack.csp.fleetIntegration.awsAccountType.awsOrganizationLabel",{defaultMessage:"AWS Organization"}),disabled:e,tooltip:e?x.i18n.translate("xpack.csp.fleetIntegration.awsAccountType.awsOrganizationDisabledTooltip",{defaultMessage:"Supported from integration version 1.5.0 and above"}):void 0,testId:"awsOrganizationTestId"},{id:mt,label:x.i18n.translate("xpack.csp.fleetIntegration.awsAccountType.singleAccountLabel",{defaultMessage:"Single Account"}),testId:"awsSingleTestId"}])(c)),[c]);return Object(s.useEffect)((()=>{vt(e)||a(Be(t,e.type,{"aws.account_type":{value:c?mt:Ot,type:"text"}}))}),[e,a]),Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.awsAccountTypeDescriptionLabel",defaultMessage:"Select between single account or organization, and then fill in the name and description to help identify this integration."})),Object(m.jsx)(g.EuiSpacer,{size:"l"}),c&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.awsAccountType.awsOrganizationNotSupportedMessage",defaultMessage:"AWS Organization not supported in current integration version. Please upgrade to the latest version to enable AWS Organizations integration."})),Object(m.jsx)(g.EuiSpacer,{size:"l"})),Object(m.jsx)(E,{disabled:l,idSelected:vt(e)||"",options:u,onChange:s=>{a(Be(t,e.type,{"aws.account_type":{value:s,type:"text"}}))},size:"m"}),vt(e)===Ot&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.awsAccountType.awsOrganizationDescription",defaultMessage:"Connect Elastic to every AWS Account (current and future) in your environment by providing Elastic with read-only (configuration) access to your AWS organization."}))),vt(e)===mt&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.awsAccountType.singleAccountDescription",defaultMessage:"Deploying to a single account is suitable for an initial POC. To ensure complete coverage, it is strongly recommended to deploy CSPM at the organization-level, which automatically connects all accounts (both current and future)."}))))},Tt=e=>{var t,a;return null===(t=e.streams[0].vars)||void 0===t||null===(a=t["gcp.account_type"])||void 0===a?void 0:a.value},At=({input:e,newPolicy:t,updatePolicy:a,packageInfo:i,disabled:o})=>{const l=r()(i.version),c=u()(l)||"",d=p()(c,"1.6.0"),j=Object(s.useMemo)((()=>(e=>[{id:ht,label:x.i18n.translate("xpack.csp.fleetIntegration.gcpAccountType.gcpOrganizationLabel",{defaultMessage:"GCP Organization"}),disabled:e,tooltip:e?x.i18n.translate("xpack.csp.fleetIntegration.gcpAccountType.gcpOrganizationDisabledTooltip",{defaultMessage:"Supported from integration version 1.6.0 and above"}):void 0,testId:"gcpOrganizationAccountTestId"},{id:Et,label:x.i18n.translate("xpack.csp.fleetIntegration.gcpAccountType.gcpSingleAccountLabel",{defaultMessage:"Single Account"}),testId:"gcpSingleAccountTestId"}])(d)),[d]),f=(({"gcp.organization_id":e})=>({"gcp.organization_id":e}))(Ee.fields),O=he(e,f),h=Object(s.useRef)({}),I=Object(s.useRef)(void 0);return Object(s.useEffect)((()=>{Tt(e)||a(Be(t,e.type,{"gcp.account_type":{value:d?Et:ht,type:"text"}}))}),[e,a]),Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.gcpAccountTypeDescriptionLabel",defaultMessage:"Select between single account or organization, and then fill in the name and description to help identify this integration."})),Object(m.jsx)(g.EuiSpacer,{size:"l"}),d&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{color:"warning"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.gcpAccountType.gcpOrganizationNotSupportedMessage",defaultMessage:"GCP Organization not supported in current integration version. Please upgrade to the latest version to enable GCP Organizations integration."})),Object(m.jsx)(g.EuiSpacer,{size:"l"})),Object(m.jsx)(E,{disabled:o,idSelected:Tt(e)||"",options:j,onChange:s=>{return s!==Tt(e)&&void("single-account"===s?(h.current=Object.fromEntries(O.map((e=>[e.id,{value:e.value}]))),I.current=null===(n=e.streams[0].vars)||void 0===n?void 0:n["gcp.account_type"].value,a(Be(t,e.type,{"gcp.account_type":{value:"single-account",type:"text"},...Object.fromEntries(O.map((e=>[e.id,{value:void 0}])))}))):a(Be(t,e.type,{"gcp.account_type":{value:I.current||"organization-account",type:"text"},...h.current})));var n},size:"m"}),Tt(e)===ht&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.gcpAccountType.gcpOrganizationDescription",defaultMessage:"Connect Elastic to every GCP Project (current and future) in your environment by providing Elastic with read-only (configuration) access to your GCP organization"}))),Tt(e)===Et&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.gcpAccountType.gcpSingleAccountDescription",defaultMessage:"Deploying to a single project is suitable for an initial POC. To ensure compete coverage, it is strongly recommended to deploy CSPM at the organization-level, which automatically connects all projects (both current and future)."}))))},_t=e=>{var t,a;return null===(t=e.streams[0].vars)||void 0===t||null===(a=t["azure.account_type"])||void 0===a?void 0:a.value},Ct=({input:e,newPolicy:t,updatePolicy:a,disabled:i,packageInfo:o,setupTechnology:l})=>{const c=((e,t)=>{const a=r()(e),s=u()(a)||"";return p()(s,"1.7.0")})(o.version),d=(e=>[{id:yt,label:x.i18n.translate("xpack.csp.fleetIntegration.azureAccountType.azureOrganizationLabel",{defaultMessage:"Azure Organization"}),testId:"azureOrganizationAccountTestId",disabled:e,tooltip:e?x.i18n.translate("xpack.csp.fleetIntegration.azureAccountType.azureOrganizationDisabledTooltip",{defaultMessage:"Coming Soon"}):void 0},{id:It,label:x.i18n.translate("xpack.csp.fleetIntegration.azureAccountType.singleAccountLabel",{defaultMessage:"Single Subscription"}),testId:"azureSingleAccountTestId"}])(c),f=l===j.SetupTechnology.AGENTLESS;return Object(s.useEffect)((()=>{_t(e)||a(Be(t,e.type,{"azure.account_type":{value:c?It:yt,type:"text"},"azure.credentials.type":{value:f?Re.SERVICE_PRINCIPAL_WITH_CLIENT_SECRET:Re.ARM_TEMPLATE,type:"text"}}))}),[e,a]),Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.azureAccountTypeDescriptionLabel",defaultMessage:"Select between onboarding an Azure Organization (tenant root group) or a single Azure subscription, and then fill in the name and description to help identify this integration."})),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(E,{disabled:i,idSelected:_t(e)||"",options:d,onChange:s=>{a(Be(t,e.type,{"azure.account_type":{value:s,type:"text"}}))},size:"m"}),_t(e)===yt&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.azureAccountType.azureOrganizationDescription",defaultMessage:"Connect Elastic to every Azure Subscription (current and future) in your environment by providing Elastic with read-only (configuration) access to your Azure Organization (tenant root group)."}))),_t(e)===It&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(g.EuiText,{color:"subdued",size:"s"},Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.azureAccountType.singleAccountDescription",defaultMessage:"Deploying to a single subscription is suitable for an initial POC. To ensure compete coverage, it is strongly recommended to deploy CSPM at the organization (tenant root group) level, which automatically connects all subscriptions (both current and future)."}))))},Mt=({onChange:e,fields:t})=>Object(m.jsx)("div",null,t.map((({value:t,id:a,label:s,error:n})=>Object(m.jsx)(g.EuiFormRow,{key:a,id:a,fullWidth:!0,label:s,isInvalid:!!n,error:n},Object(m.jsx)(g.EuiFieldText,{isInvalid:!!n,fullWidth:!0,value:t,onChange:t=>e(a,t.target.value)}))))),Lt=Object(s.memo)((({agentPolicies:e,newPolicy:t,onChange:a,validationResults:i,isEditPage:o,packageInfo:l,handleSetupTechnologyChange:r,agentlessPolicy:c})=>{const u=Object(f.useParams)().integration,d=I.Y.includes(u)?u:void 0,[p,O]=Object(s.useState)(!0),E=Nt(t.inputs,d),{isAgentlessAvailable:h,setupTechnology:y,updateSetupTechnology:v}=(({input:e,agentPolicies:t,agentlessPolicy:a,handleSetupTechnologyChange:n,isEditPage:i})=>{const o=e.type===I.j,l=e.type===I.m,r=e.type===I.k,c=Boolean((o||l||r)&&a),u=(t||[]).map((e=>e.id)),d=null==a?void 0:a.id,[p,g]=Object(s.useState)((()=>i&&u.includes(j.SetupTechnology.AGENTLESS)?j.SetupTechnology.AGENTLESS:j.SetupTechnology.AGENT_BASED)),[b,f]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{if(i||b)return;const e=u.length>0,t=!d||!u.includes(d);g(e&&t?j.SetupTechnology.AGENT_BASED:c?j.SetupTechnology.AGENTLESS:j.SetupTechnology.AGENT_BASED)}),[u,d,c,b,i]),Object(s.useEffect)((()=>{i||n&&n(p)}),[n,i,p]),{isAgentlessAvailable:c,setupTechnology:p,setSetupTechnology:g,updateSetupTechnology:e=>{g(e),f(!0)}}})({input:E,agentPolicies:e,agentlessPolicy:c,handleSetupTechnologyChange:r,isEditPage:o}),S=!o&&h||o&&y===j.SetupTechnology.AGENTLESS,T=Object(s.useCallback)((e=>{a({isValid:p,updatedPolicy:e})}),[a,p]),A=Object(s.useCallback)((e=>{const a=((e,t,a)=>{switch(e){case"cloudbeat/cis_aws":return{"aws.credentials.type":{value:qe(t,a),type:"text"}};case"cloudbeat/cis_azure":return{"azure.credentials.type":{value:Ze(t,a),type:"text"}};case"cloudbeat/cis_gcp":return((e,t)=>t&&t===j.SetupTechnology.AGENTLESS?{"gcp.credentials.type":{value:je,type:"text"},setup_access:{value:pe,type:"text"}}:Je(e)?{"gcp.credentials.type":{value:be,type:"text"},setup_access:{value:de,type:"text"}}:{"gcp.credentials.type":{value:ge,type:"text"},setup_access:{value:pe,type:"text"}})(t,a);case"cloudbeat/cis_eks":return{"aws.credentials.type":{value:"assume_role",type:"text"}};default:return}})(e,l,y),s=Be(t,e,a);T(s)}),[y,l,t,T]),_=Object.keys((null==i?void 0:i.vars)||{}).filter((e=>null!==((null==i?void 0:i.vars)||{})[e])),[C,M]=Object(s.useState)(_.length>0),[L,k]=Object(s.useState)(!0);Object(s.useEffect)((()=>{_.length>0&&M(!0),setTimeout((()=>M(!1)),200)}),[_]);const{data:R,refetch:N}=((e,{enabled:t=!0})=>{const{http:a}=Object(gt.useKibana)().services;return Object(pt.useQuery)(jt,(async()=>{try{return await a.get(dt.packagePolicyRouteService.getListPath(),{version:I.C,query:{perPage:dt.SO_SEARCH_LIMIT,page:1,kuery:`${dt.PACKAGE_POLICY_SAVED_OBJECT_TYPE}.package.name:${e}`}})}catch(e){throw new Error(`Failed to fetch package policy list: ${e.message}`)}}),{enabled:t,refetchOnMount:!1,refetchOnWindowFocus:!1})})(l.name,{enabled:L});if(Object(s.useEffect)((()=>{o||C||(A(ft[E.policy_template]),N())}),[C,E.policy_template,o]),Object(s.useEffect)((()=>{o||A(E.type)}),[y]),kt({newPolicy:t,input:E,updatePolicy:T}),Ft({packageInfo:l,updatePolicy:T,newPolicy:t}),Rt({packagePolicyList:null==R?void 0:R.items,isEditPage:o,isLoading:C,integration:d,newPolicy:t,updatePolicy:T,setCanFetchIntegration:k}),C)return Object(m.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(m.jsx)(g.EuiFlexItem,{grow:!1},Object(m.jsx)(g.EuiLoadingSpinner,{size:"xl"})));const F=[{id:"name",value:t.name,error:(null==i?void 0:i.name)||null,label:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.integrationNameLabel",defaultMessage:"Name"})},{id:"description",value:t.description||"",error:(null==i?void 0:i.description)||null,label:Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.integrationDescriptionLabel",defaultMessage:"Description"})}];return Object(m.jsx)(n.a.Fragment,null,o&&Object(m.jsx)(xt,null),!d&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(lt,{selectedTemplate:E.policy_template,policy:t,setPolicyTemplate:e=>A(ft[e]),disabled:o}),Object(m.jsx)(g.EuiSpacer,{size:"l"})),o&&Object(m.jsx)(n.a.Fragment,null,Object(m.jsx)(g.EuiCallOut,{title:x.i18n.translate("xpack.csp.fleetIntegration.editWarning.calloutTitle",{defaultMessage:"Modifying Integration Details"}),color:"warning",iconType:"warning"},Object(m.jsx)("p",null,Object(m.jsx)(b.FormattedMessage,{id:"xpack.csp.fleetIntegration.editWarning.calloutDescription",defaultMessage:"In order to change the cloud service provider (CSP) you want to monitor, add more accounts, or change where CSPM is deployed (Organization vs Single Account), please add a new CSPM integration."}))),Object(m.jsx)(g.EuiSpacer,{size:"l"})),Object(m.jsx)(ct,{postureType:E.policy_template}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(ut,{input:E,setInput:A,disabled:o}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),"cloudbeat/cis_aws"===E.type&&Object(m.jsx)(St,{input:E,newPolicy:t,updatePolicy:T,packageInfo:l,disabled:o}),"cloudbeat/cis_gcp"===E.type&&Object(m.jsx)(At,{input:E,newPolicy:t,updatePolicy:T,packageInfo:l,disabled:o}),"cloudbeat/cis_azure"===E.type&&Object(m.jsx)(Ct,{input:E,newPolicy:t,updatePolicy:T,packageInfo:l,disabled:o,setupTechnology:y}),Object(m.jsx)(g.EuiSpacer,{size:"l"}),Object(m.jsx)(Mt,{fields:F,onChange:(e,a)=>T({...t,[e]:a})}),S&&Object(m.jsx)(bt,{disabled:o,setupTechnology:y,onSetupTechnologyChange:v}),Object(m.jsx)(rt,{input:E,newPolicy:t,updatePolicy:T,packageInfo:l,onChange:a,setIsValid:O,disabled:o,setupTechnology:y}),Object(m.jsx)(g.EuiSpacer,null))}));Lt.displayName="CspPolicyTemplateForm";const kt=({newPolicy:e,input:t,updatePolicy:a})=>{Object(s.useEffect)((()=>{if(e.namespace===We)return;const s={...Be(e,t.type),namespace:We};a(s)}),[e,t,a])},Rt=({isEditPage:e,isLoading:t,integration:a,newPolicy:n,packagePolicyList:i,updatePolicy:o,setCanFetchIntegration:l})=>{Object(s.useEffect)((()=>{if(!a)return;if(e)return;if(t)return;const s=null==i?void 0:i.filter((e=>{var t,s;return(null==e||null===(t=e.vars)||void 0===t||null===(s=t.posture)||void 0===s?void 0:s.value)===a})),r=((e,t)=>{const a=new RegExp(`${e}-(\\d+)`);return`${e}-${Math.max(...(null!=t?t:[]).filter((e=>Boolean(e.name.match(a)))).map((e=>parseInt(e.name.match(a)[1],10))),0)+1}`})(a,s);n.name!==r&&(o({...n,name:r}),l(!1))}),[t,a,e,i])},Nt=(e,t=I.v)=>{const a=e.find((e=>e.enabled))||e.find((e=>e.policy_template===t))||e[0];var s;return Object(h.b)(a,"Failed to determine selected option"),Object(h.b)((s=a,I.Y.includes(s.policy_template)&&I.X.includes(s.type)),"Unknown option: "+a.type),a},Ft=({packageInfo:e,newPolicy:t,updatePolicy:a})=>{var n;Object(s.useEffect)((()=>{var s,n,i,o;const l=(e=>{if(!e.policy_templates)return"";const t=e.policy_templates.find((e=>e.name===I.eb));if(!t)return"";const a=Xe(t)&&t.inputs;return a?a.reduce(((e,t)=>{var a;if(!t.vars)return e;const s=null===(a=t.vars.find((e=>"cloud_formation_template"===e.name)))||void 0===a?void 0:a.default;return s?String(s):e}),""):""})(e);""!==l&&(null==t||null===(s=t.inputs)||void 0===s||null===(n=s.find((e=>e.type===I.p)))||void 0===n||null===(i=n.config)||void 0===i||null===(o=i.cloud_formation_template_url)||void 0===o?void 0:o.value)!==l&&(null==a||a({...t,inputs:t.inputs.map((e=>e.type===I.p?{...e,config:{cloud_formation_template_url:{value:l}}}:e))}))}),[null==t||null===(n=t.vars)||void 0===n?void 0:n.cloud_formation_template_url,t,e])}}])]);