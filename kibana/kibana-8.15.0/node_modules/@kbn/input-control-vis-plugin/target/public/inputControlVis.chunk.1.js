(window.inputControlVis_bundle_jsonpfunction=window.inputControlVis_bundle_jsonpfunction||[]).push([[1],{24:function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"g",(function(){return n})),r.d(e,"b",(function(){return s})),r.d(e,"d",(function(){return a})),r.d(e,"f",(function(){return o})),r.d(e,"e",(function(){return c})),r.d(e,"c",(function(){return u}));const i={LIST:"list",RANGE:"range"},n=(t,e,r)=>[...t.slice(0,e),r,...t.slice(e+1)],s=(t,e)=>[...t,e],a=(t,e,r)=>{let i;if(i=r>=0?e+1:e-1,i<0)return[...t.slice(1),t[0]];if(i>=t.length){const e=t.length-1;return[t[e],...t.slice(0,e)]}{const r=t.slice(),n=r[i];return r[i]=r[e],r[e]=n,r}},o=(t,e)=>[...t.slice(0,e),...t.slice(e+1)],l=t=>{const e={};switch(t){case i.RANGE:e.decimalPlaces=0,e.step=1;break;case i.LIST:e.type="terms",e.multiselect=!0,e.dynamicOptions=!0,e.size=5,e.order="desc"}return e},c=t=>({id:(new Date).getTime().toString(),indexPattern:"",fieldName:"",parent:"",label:"",type:t,options:l(t)}),u=(t,e)=>{let r=`${t.type}: ${e}`;return t.label?r=`${t.label}`:t.fieldName&&(r=`${t.fieldName}`),r}},25:function(t,e,r){"use strict";var i,n=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}(),s=[];function a(t){for(var e=-1,r=0;r<s.length;r++)if(s[r].identifier===t){e=r;break}return e}function o(t,e){for(var r={},i=[],n=0;n<t.length;n++){var o=t[n],l=e.base?o[0]+e.base:o[0],c=r[l]||0,u="".concat(l," ").concat(c);r[l]=c+1;var d=a(u),h={css:o[1],media:o[2],sourceMap:o[3]};-1!==d?(s[d].references++,s[d].updater(h)):s.push({identifier:u,updater:g(h,e),references:1}),i.push(u)}return i}function l(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=r.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=n(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function d(t,e,r,i){var n=r?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,n);else{var s=document.createTextNode(n),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(s,a[e]):t.appendChild(s)}}function h(t,e,r){var i=r.css,n=r.media,s=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var p=null,f=0;function g(t,e){var r,i,n;if(e.singleton){var s=f++;r=p||(p=l(e)),i=d.bind(null,r,s,!1),n=d.bind(null,r,s,!0)}else r=l(e),i=h.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var r=o(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<r.length;i++){var n=a(r[i]);s[n].references--}for(var l=o(t,e),c=0;c<r.length;c++){var u=a(r[c]);0===s[u].references&&(s[u].updater(),s.splice(u,1))}r=l}}}},26:function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r,i,n,s=t[1]||"",a=t[3];if(!a)return s;if(e&&"function"==typeof btoa){var o=(r=a,i=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(n," */")),l=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[s].concat(l).concat([o]).join("\n")}return[s].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,i){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(i)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(n[a]=!0)}for(var o=0;o<t.length;o++){var l=[].concat(t[o]);i&&n[l[0]]||(r&&(l[2]?l[2]="".concat(r," and ").concat(l[2]):l[2]=r),e.push(l))}},e}},27:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(14),n=r.n(i);function s(t){const e=new Map;return t.forEach((r=>{const i=[r.id],s=e=>{if(n.a.has(e,"parent")&&""!==e.parent&&!i.includes(e.parent)){i.push(e.parent);const n=(r=e.parent,t.find((t=>t.id===r)));n&&s(n)}var r};s(r),e.set(r.id,i)})),e}var a=r(24);function o(t,e,r){return t.filter((t=>{if(!t.indexPattern||!t.fieldName)return!1;const i=r.get(t.id);return null==i||!i.includes(e)})).map(((t,e)=>({value:t.id,text:Object(a.c)(t,e)})))}},28:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(21),n=r(1),s=i.__importDefault(r(29));e.default=function(t,e){var r=n.useState(e),i=r[0],a=r[1];return s.default((function(){var e=t.subscribe(a);return function(){return e.unsubscribe()}}),[t]),i}},29:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n="undefined"!=typeof window?i.useLayoutEffect:i.useEffect;e.default=n},30:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setEuiDevProviderWarning=e.getEuiDevProviderWarning=e.emitEuiProviderWarning=void 0;var i=void 0;e.setEuiDevProviderWarning=function(t){return i=t},e.getEuiDevProviderWarning=function(){return i},e.emitEuiProviderWarning=function(t){if("function"==typeof i)return i(t);switch(i){case"log":console.log(t);break;case"warn":console.warn(t);break;case"error":throw new Error(t)}}},31:function(t,e,r){switch(window.__kbnThemeTag__){case"v8dark":return r(32);case"v8light":return r(34)}},32:function(t,e,r){var i=r(25),n=r(33);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);i(n,{insert:"head",singleton:!1}),t.exports=n.locals||{}},33:function(t,e,r){(e=r(26)(!1)).push([t.i,".icvContainer__wrapper{display:flex;flex:1 1 0;min-height:0;overflow:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.icvContainer__wrapper::-webkit-scrollbar{height:16px;width:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:#0000}.icvContainer{margin:0 4px;padding:8px;width:100%}",""]),t.exports=e},34:function(t,e,r){var i=r(25),n=r(35);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);i(n,{insert:"head",singleton:!1}),t.exports=n.locals||{}},35:function(t,e,r){(e=r(26)(!1)).push([t.i,".icvContainer__wrapper{display:flex;flex:1 1 0;min-height:0;overflow:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.icvContainer__wrapper::-webkit-scrollbar{height:16px;width:16px}.icvContainer__wrapper::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.icvContainer__wrapper::-webkit-scrollbar-corner,.icvContainer__wrapper::-webkit-scrollbar-track{background-color:#0000}.icvContainer{margin:0 4px;padding:8px;width:100%}",""]),t.exports=e},42:function(t,e,r){"use strict";r.r(e),r.d(e,"createInputControlVisController",(function(){return G}));var i=r(3),n=r.n(i),s=r(1),a=r.n(s),o=r(14),l=r.n(o),c=r(18),u=r(8),d=r.n(u),h=r(19),p=r(30),f=r(28),g=r.n(f),b=r(20),m=r.n(b),v=r(15);const C="eui-global",x="eui-utilities",y={darkMode:!1};var F=r(6);const w=[v.euiStylisPrefixer],j=m()({key:"css",stylisPlugins:w,container:document.querySelector('meta[name="emotion"]')}),M=m()({key:C,stylisPlugins:w,container:document.querySelector(`meta[name="${C}"]`)}),_=m()({key:x,stylisPlugins:w,container:document.querySelector(`meta[name="${x}"]`)});j.compat=!0,M.compat=!0,_.compat=!0;const O={default:j,global:M,utility:_},P=({theme:{theme$:t},globalStyles:e,colorMode:r,modify:i,children:n})=>{const a=g()(t,y),o=Object(s.useMemo)((()=>(t=>t.darkMode?v.COLOR_MODES_STANDARD.dark:v.COLOR_MODES_STANDARD.light)(a)),[a]),l=r||o,c=!1!==e&&void 0;return Object(F.jsx)(v.EuiProvider,{cache:O,modify:i,colorMode:l,globalStyles:c,utilityClasses:c},n)},S=({children:t,i18n:e,...r})=>Object(h.useIsNestedEuiProvider)()?(Object(p.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(F.jsx)(e.Context,null,t)):Object(F.jsx)(P,r,Object(F.jsx)(e.Context,null,t));var E=r(22);const k=({children:t,...e})=>Object(F.jsx)(S,d()({globalStyles:!1},e),Object(F.jsx)(E.KibanaErrorBoundaryProvider,{analytics:e.analytics},Object(F.jsx)(E.KibanaErrorBoundary,null,t)));var I=r(4),N=r(16),A=r(24),R=r(2);function V(t){let e=t.children;t.disableMsg&&(e=Object(F.jsx)(v.EuiToolTip,{position:"top",content:t.disableMsg,anchorClassName:"eui-displayBlock"},e));const r=t.warningMsg?Object(F.jsx)(a.a.Fragment,null,Object(F.jsx)(v.EuiToolTip,{position:"top",content:t.warningMsg},Object(F.jsx)(v.EuiIcon,{type:"warning"})),t.label):t.label;return Object(F.jsx)(v.EuiFormRow,{label:r,id:t.id,"data-test-subj":"inputControl"+t.controlIndex},e)}class list_control_ListControlUi extends s.PureComponent{constructor(t){super(t),n()(this,"isMounted",!1),n()(this,"state",{isLoading:!1}),n()(this,"textInput",void 0),n()(this,"componentDidMount",(()=>{this.textInput&&this.textInput.setAttribute("focusable","false"),this.isMounted=!0})),n()(this,"componentWillUnmount",(()=>{this.isMounted=!1})),n()(this,"setTextInputRef",(t=>{this.textInput=t})),n()(this,"handleOnChange",(t=>{const e=t.map((({value:t})=>t));this.props.stageFilter(this.props.controlIndex,e)})),n()(this,"debouncedFetch",l.a.debounce((async t=>{this.props.fetchOptions&&await this.props.fetchOptions(t),this.isMounted&&this.setState({isLoading:!1})}),300)),n()(this,"onSearchChange",(t=>{this.setState({isLoading:!0},this.debouncedFetch.bind(null,t))})),this.textInput=null}renderControl(){var t;const{intl:e}=this.props;if(this.props.disableMsg)return Object(F.jsx)(v.EuiFieldText,{"aria-label":e.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),placeholder:e.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),disabled:!0});const r=null===(t=this.props.options)||void 0===t?void 0:t.map((t=>({label:this.props.formatOptionLabel(t).toString(),value:t,"data-test-subj":`option_${t.toString().replace(" ","_")}`}))).sort(((t,e)=>t.label.toLowerCase().localeCompare(e.label.toLowerCase()))),i=this.props.selectedOptions.map((t=>({label:this.props.formatOptionLabel(t).toString(),value:t})));return Object(F.jsx)(v.EuiComboBox,{placeholder:e.formatMessage({id:"inputControl.vis.listControl.selectPlaceholder",defaultMessage:"Select..."}),options:r,isLoading:this.state.isLoading,async:this.props.dynamicOptions,onSearchChange:this.props.dynamicOptions?this.onSearchChange:void 0,selectedOptions:i,onChange:this.handleOnChange,singleSelection:!this.props.multiselect,"data-test-subj":`listControlSelect${this.props.controlIndex}`,inputRef:this.setTextInputRef})}render(){const t=R.i18n.translate("inputControl.vis.listControl.partialResultsWarningMessage",{defaultMessage:"Terms list might be incomplete because the request is taking too long. Adjust the autocomplete settings in kibana.yml for complete results."});return Object(F.jsx)(v.EuiThemeProvider,{colorMode:this.props.isDarkMode?"dark":"light"},Object(F.jsx)(V,{id:this.props.id,label:this.props.label,warningMsg:this.props.partialResults?t:void 0,controlIndex:this.props.controlIndex,disableMsg:this.props.disableMsg},this.renderControl()))}}n()(list_control_ListControlUi,"defaultProps",{dynamicOptions:!1,multiselect:!0,selectedOptions:[],options:[]});const T=Object(N.injectI18n)(list_control_ListControlUi);var B=r(23);function q(t,e,r){if(e<=0)return r(t);let i=t;return i*=Math.pow(10,e),i=r(i),i/=Math.pow(10,e),i}class range_control_RangeControl extends s.PureComponent{constructor(...t){super(...t),n()(this,"state",{}),n()(this,"onChangeComplete",l.a.debounce((t=>{const e={min:t[0],max:t[1]};this.props.stageFilter(this.props.controlIndex,e)}),200))}static getDerivedStateFromProps(t,e){const r=t.control.hasValue()?[t.control.value.min,t.control.value.max]:["",""];return t.control.hasValue()&&null==t.control.value.min&&(r[0]=""),t.control.hasValue()&&null==t.control.value.max&&(r[1]=""),r!==e.prevValue?{value:r,prevValue:r}:null}renderControl(){if(!this.props.control.isEnabled())return Object(F.jsx)(B.ValidatedDualRange,{disabled:!0,showInput:!0,min:0,max:100});const t=l.a.get(this.props,"control.options.decimalPlaces",0),e=function(t,e){return q(t,e,Math.floor)}(this.props.control.min,t),r=function(t,e){return q(t,e,Math.ceil)}(this.props.control.max,t),i=[{value:e,label:e},{value:r,label:r}];return Object(F.jsx)(B.ValidatedDualRange,{id:this.props.control.id,min:e,max:r,value:this.state.value,onChange:this.onChangeComplete,showInput:!0,showRange:!0,showTicks:!0,ticks:i})}render(){return Object(F.jsx)(V,{id:this.props.control.id,label:this.props.control.label,controlIndex:this.props.controlIndex,disableMsg:this.props.control.isEnabled()?void 0:this.props.control.disabledReason},this.renderControl())}}r(31);class input_control_vis_InputControlVis extends s.Component{constructor(t){super(t),this.handleSubmit=this.handleSubmit.bind(this),this.handleReset=this.handleReset.bind(this),this.handleClearAll=this.handleClearAll.bind(this)}handleSubmit(){this.props.submitFilters()}handleReset(){this.props.resetControls()}handleClearAll(){this.props.clearControls()}renderControls(){return this.props.controls.map(((t,e)=>{let r=null;if(function(t){return t.type===A.a.LIST}(t))r=Object(F.jsx)(T,{id:t.id,label:t.label,options:t.selectOptions,selectedOptions:t.value,formatOptionLabel:t.format,disableMsg:t.isEnabled()?void 0:t.disabledReason,multiselect:t.options.multiselect,partialResults:t.partialResults,dynamicOptions:t.options.dynamicOptions,controlIndex:e,stageFilter:this.props.stageFilter,fetchOptions:t=>{this.props.refreshControl(e,t)},isDarkMode:this.props.isDarkMode});else{if(!function(t){return t.type===A.a.RANGE}(t))throw new Error(`Unhandled control type ${t.type}`);r=Object(F.jsx)(range_control_RangeControl,{control:t,controlIndex:e,stageFilter:this.props.stageFilter})}return Object(F.jsx)(v.EuiFlexItem,{key:t.id,style:{minWidth:"250px"},"data-test-subj":"inputControlItem"},r)}))}renderStagingButtons(){return Object(F.jsx)(v.EuiFlexGroup,{wrap:!0},Object(F.jsx)(v.EuiFlexItem,{grow:!1},Object(F.jsx)(v.EuiButton,{fill:!0,onClick:this.handleSubmit,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlSubmitBtn"},Object(F.jsx)(N.FormattedMessage,{id:"inputControl.vis.inputControlVis.applyChangesButtonLabel",defaultMessage:"Apply changes"}))),Object(F.jsx)(v.EuiFlexItem,{grow:!1},Object(F.jsx)(v.EuiButtonEmpty,{onClick:this.handleReset,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlCancelBtn"},Object(F.jsx)(N.FormattedMessage,{id:"inputControl.vis.inputControlVis.cancelChangesButtonLabel",defaultMessage:"Cancel changes"}))),Object(F.jsx)(v.EuiFlexItem,{grow:!1},Object(F.jsx)(v.EuiButtonEmpty,{onClick:this.handleClearAll,disabled:!this.props.hasValues(),"data-test-subj":"inputControlClearBtn"},Object(F.jsx)(N.FormattedMessage,{id:"inputControl.vis.inputControlVis.clearFormButtonLabel",defaultMessage:"Clear form"}))))}render(){let t;return this.props.controls.length>0&&!this.props.updateFiltersOnChange&&(t=this.renderStagingButtons()),Object(F.jsx)("div",{className:"icvContainer__wrapper"},Object(F.jsx)("div",{className:"icvContainer"},Object(F.jsx)(v.EuiFlexGroup,{wrap:!0},this.renderControls()),t))}}function L(t,e){return R.i18n.translate("inputControl.control.noValuesDisableTooltip",{defaultMessage:'Filtering occurs on the "{fieldName}" field, which doesn\'t exist on any documents in the "{indexPatternName}" index pattern. Choose a different field or index documents that contain values for this field.',values:{fieldName:t,indexPatternName:e}})}function D(t){return R.i18n.translate("inputControl.control.noIndexPatternTooltip",{defaultMessage:"Could not locate index-pattern id: {indexPatternId}.",values:{indexPatternId:t}})}class control_Control{constructor(t,e,r){n()(this,"kbnFilter",null),n()(this,"enable",!1),n()(this,"disabledReason",""),n()(this,"value",void 0),n()(this,"id",void 0),n()(this,"options",void 0),n()(this,"type",void 0),n()(this,"label",void 0),n()(this,"ancestors",[]),n()(this,"format",(t=>{const e=this.filterManager.getIndexPattern(),r=this.filterManager.getField();return r&&e?e.getFormatterForField(r).convert(t):t})),this.controlParams=t,this.filterManager=e,this.useTimeFilter=r,this.id=t.id,this.controlParams=t,this.options=t.options,this.type=t.type,this.label=t.label?t.label:t.fieldName,this.reset(),this.disable(R.i18n.translate("inputControl.control.notInitializedTooltip",{defaultMessage:"Control has not been initialized"}))}setAncestors(t){this.ancestors=t}hasAncestors(){return this.ancestors&&this.ancestors.length>0}hasUnsetAncestor(){return this.ancestors.reduce(((t,e)=>t||!e.hasValue()),!1)}getAncestorValues(){return this.ancestors.map((t=>t.value))}getAncestorFilters(){return this.ancestors.map((t=>t.filterManager.createFilter(t.value)))}isEnabled(){return this.enable}disable(t){this.enable=!1,this.disabledReason=t}set(t){this.value=t,this.hasValue()?this.kbnFilter=this.filterManager.createFilter(this.value):this.kbnFilter=null}reset(){this.kbnFilter=null,this.value=this.filterManager.getValueFromFilterBar()}clear(){this.value=void 0}hasChanged(){return!l.a.isEqual(this.value,this.filterManager.getValueFromFilterBar())}hasKbnFilter(){return!!this.kbnFilter}getKbnFilter(){return this.kbnFilter}hasValue(){return void 0!==this.value}}var U=r(17);class filter_manager_FilterManager{constructor(t,e,r,i,s){n()(this,"indexPattern",void 0),this.controlId=t,this.fieldName=e,this.indexPatternId=r,this.indexPatternsService=i,this.queryFilter=s}async init(){try{this.indexPattern||(this.indexPattern=await this.indexPatternsService.get(this.indexPatternId))}catch(t){}}getIndexPattern(){return this.indexPattern}getField(){var t;return null===(t=this.indexPattern)||void 0===t?void 0:t.fields.getByName(this.fieldName)}findFilters(){return l.a.flatten([this.queryFilter.getAppFilters(),this.queryFilter.getGlobalFilters()]).filter((t=>l.a.get(t,"meta.controlledBy")===this.controlId))}}class range_filter_manager_RangeFilterManager extends filter_manager_FilterManager{createFilter(t){const e=this.getIndexPattern(),r=Object(U.buildRangeFilter)(e.fields.getByName(this.fieldName),{gte:(i=t).min,lte:i.max},e);var i;return r.meta.key=this.fieldName,r.meta.controlledBy=this.controlId,r}getValueFromFilterBar(){const t=this.findFilters();if(0===t.length)return;let e;return e=l.a.has(t[0],"query.script")?l.a.get(t[0],"query.script.script.params"):l.a.get(t[0],["query","range",this.fieldName]),e?function(t){const e={};return l.a.has(t,"gte")&&(e.min=l.a.get(t,"gte")),l.a.has(t,"gt")&&(e.min=l.a.get(t,"gt")),l.a.has(t,"lte")&&(e.max=l.a.get(t,"lte")),l.a.has(t,"lt")&&(e.max=l.a.get(t,"lt")),e}(e):void 0}}async function $({create:t},e,r,i,n,s=[],a){const o=await t(e||{});return o.setParent(void 0),o.setField("filter",(()=>{const t=[...s];if(n){const e=a.createFilter(r);e&&t.push(e)}return t})),o.setField("size",0),o.setField("index",r),o.setField("aggs",i),o}class range_control_factory_RangeControl extends control_Control{constructor(t,e,r,i,s){super(t,e,r),n()(this,"searchSource",void 0),n()(this,"timefilter",void 0),n()(this,"abortController",void 0),n()(this,"min",void 0),n()(this,"max",void 0),this.timefilter=s.data.query.timefilter.timefilter,this.searchSource=i}async fetch(){this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const t=this.filterManager.getIndexPattern();if(!t)return void this.disable(D(this.controlParams.indexPattern));const e=this.filterManager.fieldName,r=(t=>{const e={};return t&&(t.scripted?e.script={source:t.script,lang:t.lang}:e.field=t.name),{maxAgg:{max:e},minAgg:{min:e}}})(t.fields.getByName(e)),i=await $(this.searchSource,null,t,r,this.useTimeFilter,[],this.timefilter),n=this.abortController.signal;let s;try{s=await i.fetch({abortSignal:n})}catch(t){if("AbortError"===t.name)return;return void this.disable(R.i18n.translate("inputControl.rangeControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch range min and max, error: {errorMessage}",values:{errorMessage:t.message}}))}const a=l.a.get(s,"aggregations.minAgg.value",null),o=l.a.get(s,"aggregations.maxAgg.value",null);null!==a&&null!==o?(this.min=a,this.max=o,this.enable=!0):this.disable(L(e,t.title))}destroy(){this.abortController&&this.abortController.abort()}}async function K(t,e,r){const[,{data:i}]=await r.core.getStartServices(),n=new range_control_factory_RangeControl(t,new range_filter_manager_RangeFilterManager(t.id,t.fieldName,t.indexPattern,i.indexPatterns,r.data.query.filterManager),e,i.search.searchSource,r);return await n.filterManager.init(),n}class phrase_filter_manager_PhraseFilterManager extends filter_manager_FilterManager{constructor(t,e,r,i,n){super(t,e,r,i,n)}createFilter(t){const e=this.getIndexPattern();let r;const i=e.fields.getByName(this.fieldName);if(!i)throw new Error(`Unable to find field with name: ${this.fieldName} on indexPattern`);return r=1===t.length?Object(U.buildPhraseFilter)(i,t[0],e):Object(U.buildPhrasesFilter)(i,t,e),r.meta.key=this.fieldName,r.meta.controlledBy=this.controlId,r}getValueFromFilterBar(){const t=this.findFilters();if(0===t.length)return;const e=t.map((t=>this.getValueFromFilter(t))).filter((t=>null!=t));return 0!==e.length?e.reduce(((t,e)=>t.concat(e)),[]):void 0}getValueFromFilter(t){if(l.a.has(t,"query.bool.should"))return l.a.get(t,"query.bool.should").map((t=>this.getValueFromFilter(t))).filter((t=>!!t));if(l.a.has(t,"query.script"))return l.a.get(t,"query.script.script.params.value");if(Object(U.isPhraseFilter)(t)){if(Object(U.getPhraseFilterField)(t)!==this.fieldName)return;return Object(U.getPhraseFilterValue)(t)}return l.a.has(t,["match_phrase",this.fieldName])?l.a.get(t,["match_phrase",this.fieldName]):void 0}}class list_control_factory_ListControl extends control_Control{constructor(t,e,r,i,s){super(t,e,r),n()(this,"getSettings",void 0),n()(this,"timefilter",void 0),n()(this,"searchSource",void 0),n()(this,"abortController",void 0),n()(this,"lastAncestorValues",void 0),n()(this,"lastQuery",void 0),n()(this,"partialResults",void 0),n()(this,"selectOptions",void 0),n()(this,"fetch",(async t=>{this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const e=this.filterManager.getIndexPattern();if(!e)return void this.disable(D(this.controlParams.indexPattern));let r;if(this.hasAncestors()){if(this.hasUnsetAncestor())return this.disable(R.i18n.translate("inputControl.listControl.disableTooltip",{defaultMessage:"Disabled until ''{label}'' is set.",values:{label:this.ancestors[0].label}})),void(this.lastAncestorValues=void 0);const e=this.getAncestorValues();if(l.a.isEqual(e,this.lastAncestorValues)&&l.a.isEqual(t,this.lastQuery))return;this.lastAncestorValues=e,this.lastQuery=t,r=this.getAncestorFilters()}const i=this.filterManager.fieldName,n=await this.getSettings(),s={timeout:`${n.autocompleteTimeout}ms`,terminate_after:Number(n.autocompleteTerminateAfter)},a=null==e?void 0:e.fields.getAll().find((({name:t})=>t===this.controlParams.fieldName));a&&"string"!==a.type&&(this.options.dynamicOptions=!1);const o=(({field:t,size:e,direction:r,query:i})=>{const n={order:{_count:r}};return e&&(n.size=e<1?1:e),null!=t&&t.scripted?(n.script={source:t.script,lang:t.lang},n.value_type="number"===t.type?"float":t.type):n.field=null==t?void 0:t.name,i&&(n.include=`.*${function(t=""){return t.replace(/[.?+*|{}[\]()"\\#@&<>~]/g,(t=>`\\${t}`))}(i)}.*`),{termsAgg:{terms:n}}})({field:e.fields.getByName(i),size:this.options.dynamicOptions?null:l.a.get(this.options,"size",5),direction:"desc",query:t}),c=await $(this.searchSource,s,e,o,this.useTimeFilter,r,this.timefilter),u=this.abortController.signal;let d;this.lastQuery=t;try{d=await c.fetch({abortSignal:u})}catch(t){if("AbortError"===t.name)return;return void this.disable(R.i18n.translate("inputControl.listControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch terms, error: {errorMessage}",values:{errorMessage:t.message}}))}if(t&&this.lastQuery!==t)return;const h=l.a.get(d,"aggregations.termsAgg.buckets",[]).map((t=>null==t?void 0:t.key));0!==h.length||t?(this.partialResults=d.terminated_early||d.timed_out,this.selectOptions=h,this.enable=!0,this.disabledReason=""):this.disable(L(i,e.title))})),this.getSettings=s.getSettings,this.timefilter=s.data.query.timefilter.timefilter,this.searchSource=i}destroy(){this.abortController&&this.abortController.abort()}hasValue(){return void 0!==this.value&&this.value.length>0}}async function W(t,e,r){const[,{data:i}]=await r.core.getStartServices(),n=new list_control_factory_ListControl(t,new phrase_filter_manager_PhraseFilterManager(t.id,t.fieldName,t.indexPattern,i.indexPatterns,r.data.query.filterManager),e,i.search.searchSource,r);return await n.filterManager.init(),n}var z=r(27);const G=(t,e,r,i)=>{let s=!1;return new class InputControlVisController{constructor(){n()(this,"controls",void 0),n()(this,"queryBarUpdateHandler",void 0),n()(this,"filterManager",void 0),n()(this,"updateSubsciption",void 0),n()(this,"timeFilterSubscription",void 0),n()(this,"visParams",void 0),n()(this,"isDarkMode",void 0),n()(this,"drawVis",(()=>{var e;Object(c.render)(Object(F.jsx)(k,t,Object(F.jsx)(I.VisualizationContainer,{handlers:r},Object(F.jsx)(input_control_vis_InputControlVis,{updateFiltersOnChange:null===(e=this.visParams)||void 0===e?void 0:e.updateFiltersOnChange,controls:this.controls,stageFilter:this.stageFilter,submitFilters:this.submitFilters,resetControls:this.updateControlsFromKbn,clearControls:this.clearControls,hasChanges:this.hasChanges,hasValues:this.hasValues,refreshControl:this.refreshControl,isDarkMode:this.isDarkMode}))),i)})),n()(this,"stageFilter",(async(t,e)=>{var r;this.controls[t].set(e),null!==(r=this.visParams)&&void 0!==r&&r.updateFiltersOnChange?this.submitFilters():(await this.updateNestedControls(),this.drawVis())})),n()(this,"submitFilters",(()=>{var t;const e=this.controls.filter((t=>t.hasChanged())),r=e.map((t=>t.getKbnFilter())).filter((t=>null!==t));e.forEach((t=>{t.filterManager.findFilters().forEach((t=>{this.filterManager.removeFilter(t)}))})),this.controls.map((t=>{t.hasAncestors()&&t.hasUnsetAncestor()&&t.filterManager.findFilters().forEach((t=>{this.filterManager.removeFilter(t)}))})),this.filterManager.addFilters(r,null===(t=this.visParams)||void 0===t?void 0:t.pinFilters)})),n()(this,"clearControls",(async()=>{this.controls.forEach((t=>{t.clear()})),await this.updateNestedControls(),this.drawVis()})),n()(this,"updateControlsFromKbn",(async()=>{this.controls.forEach((t=>{t.reset()})),await this.updateNestedControls(),this.drawVis()})),n()(this,"hasChanges",(()=>this.controls.map((t=>t.hasChanged())).some((t=>t)))),n()(this,"hasValues",(()=>this.controls.map((t=>t.hasValue())).reduce(((t,e)=>t||e)))),n()(this,"refreshControl",(async(t,e)=>{await this.controls[t].fetch(e),this.drawVis()})),this.controls=[],this.queryBarUpdateHandler=this.updateControlsFromKbn.bind(this),this.filterManager=e.data.query.filterManager,this.updateSubsciption=this.filterManager.getUpdates$().subscribe(this.queryBarUpdateHandler),this.timeFilterSubscription=e.data.query.timefilter.timefilter.getTimeUpdate$().subscribe((()=>{var t;null!==(t=this.visParams)&&void 0!==t&&t.useTimeFilter&&(s=!1)})),this.isDarkMode=e.core.theme.getTheme().darkMode}async render(t){s&&Object(o.isEqual)(t,this.visParams)||(this.visParams=t,this.controls=[],this.controls=await this.initControls(t),s=!0),this.drawVis()}destroy(){this.updateSubsciption.unsubscribe(),this.timeFilterSubscription.unsubscribe(),Object(c.unmountComponentAtNode)(i),this.controls.forEach((t=>t.destroy()))}async initControls(t){const r=t.controls.filter((t=>t.indexPattern&&t.fieldName)),i=r.map((r=>{const i=function(t){let e=null;switch(t.type){case A.a.RANGE:e=K;break;case A.a.LIST:e=W;break;default:throw new Error(`Unhandled control type ${t.type}`)}return e}(r);return i(r,t.useTimeFilter,e)})),n=await Promise.all(i),s=t=>n.find((({id:e})=>e===t)),a=[];return Object(z.a)(r).forEach(((t,e)=>{t.shift();const r=[];t.forEach((t=>{const e=s(t);e&&r.push(e)}));const i=s(e);i&&(i.setAncestors(r),a.push(i.fetch()))})),await Promise.all(a),n}async updateNestedControls(){const t=this.controls.map((async t=>{t.hasAncestors()&&await t.fetch()}));return await Promise.all(t)}}}}}]);