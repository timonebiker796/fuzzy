/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observabilityAIAssistant_bundle_jsonpfunction=window.observabilityAIAssistant_bundle_jsonpfunction||[]).push([[1],{63:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(46),i=s(2),a=n.__importDefault(s(64));e.default=function(t,e){var s=i.useState(e),n=s[0],o=s[1];return a.default((function(){var e=t.subscribe(o);return function(){return e.unsubscribe()}}),[t]),n}},64:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(2),i="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;e.default=i},65:function(t,e,s){"use strict";s.r(e),s.d(e,"Insight",(function(){return q}));var n=s(1),i=s(3),a=s(10),o=s(2),l=s.n(o),c=s(63),r=s.n(c),u=s(14),b=s(23),j=s(30),d=s(22),g=s(20),x=s(15),p=s(34),O=s(36),m=s(35),f=s.n(m),A=function(t){return t.PUSH="push",t.OVERLAY="overlay",t}(A||{});const E={flyoutPositionMode:A.OVERLAY,isOpen:!1},v="observabilityAIAssistant_flyoutState";function h(t){return t.basePath.prepend("/app/management/insightsAndAlerting/triggersActionsConnectors/connectors")}var y=s(42),S=s(9),C=s.n(S),I=s(0);function k(t){return Object(I.jsx)(n.EuiButton,C()({"data-test-subj":"observabilityAiAssistantStartChatButton",fill:!0,iconType:"discuss",size:"s"},t),i.i18n.translate("xpack.observabilityAiAssistant.insight.response.startChat",{defaultMessage:"Start chat"}))}var F=s(41),P=s(21),T=s(31);function M(t){return Object(I.jsx)(l.a.Fragment,null,t.body,t.error?Object(I.jsx)(l.a.Fragment,null,t.body?Object(I.jsx)(n.EuiSpacer,{size:"xs"}):null,Object(I.jsx)(T.a,null)):null,t.controls?Object(I.jsx)(l.a.Fragment,null,Object(I.jsx)(n.EuiSpacer,{size:"m"}),Object(I.jsx)(n.EuiHorizontalRule,{margin:"none"}),Object(I.jsx)(n.EuiSpacer,{size:"s"}),t.controls):null)}var z=s(32);function w(t){return Object(I.jsx)(n.EuiCallOut,{title:i.i18n.translate("xpack.observabilityAiAssistant.missingCredentialsCallout.title",{defaultMessage:"Missing credentials"}),color:"primary",iconType:"iInCircle"},i.i18n.translate("xpack.observabilityAiAssistant.missingCredentialsCallout.description",{defaultMessage:"You havenâ€™t authorised OpenAI in order to generate responses from the Elastic Assistant. Authorise the model in order to proceed."}),Object(I.jsx)(n.EuiSpacer,{size:"m"}),Object(I.jsx)(n.EuiButton,{"data-test-subj":"observabilityAiAssistantMissingCredentialsCalloutConnectAssistantButton",fill:!0,color:"primary",href:t.connectorsManagementHref},i.i18n.translate("xpack.observabilityAiAssistant.missingCredentialsCallout.buttonLabel",{defaultMessage:"Connect Assistant"})))}var B=s(28),L={name:"1lztzw8",styles:"margin-top:2px;margin-bottom:1px"},_={name:"xyzkeb",styles:"align-self:flex-start"};function R({title:t,description:e=i.i18n.translate("xpack.observabilityAiAssistant.insight.defaultDescription",{defaultMessage:"Get helpful insights from our Elastic AI Assistant."}),controls:s,children:a,actions:l,onToggle:c,loading:r,isOpen:u,dataTestSubj:b="obsAiAssistantInsightButton"}){const{euiTheme:j}=Object(n.useEuiTheme)(),[d,g]=Object(o.useState)(!1),x=()=>{g(!d)};return Object(I.jsx)(n.EuiPanel,{hasBorder:!0,hasShadow:!1},Object(I.jsx)(n.EuiAccordion,{id:"obsAiAssistantInsightContainer",arrowProps:{css:{alignSelf:"flex-start"}},buttonContent:Object(I.jsx)(n.EuiFlexGroup,{wrap:!0,responsive:!1,gutterSize:"m","data-test-subj":b},Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(n.EuiSpacer,{size:"xs"}),Object(I.jsx)(B.a,{size:"xs"})),Object(I.jsx)(n.EuiFlexItem,null,Object(I.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(I.jsx)(n.EuiText,{css:L},Object(I.jsx)("h5",null,t)),Object(I.jsx)(n.EuiIconTip,{content:i.i18n.translate("xpack.observabilityAiAssistant.insight.iconTooltip",{defaultMessage:"Every contextual insight can be changed with a custom prompt defined by the user. You can always reset it to the default."}),position:"right"})),Object(I.jsx)(n.EuiText,{size:"s",css:Object(I.css)({color:j.colors.subduedText},"","")},Object(I.jsx)("span",null,e)))),isLoading:r,isDisabled:r,forceState:u?"open":"closed",extraAction:null!=l&&l.length||s?Object(I.jsx)(n.EuiFlexGroup,{direction:"row",gutterSize:"s",responsive:!1},s&&Object(I.jsx)(n.EuiFlexItem,{grow:!1},s),null!=l&&l.length?Object(I.jsx)(n.EuiFlexItem,null,Object(I.jsx)(n.EuiPopover,{anchorPosition:"downLeft",button:Object(I.jsx)(n.EuiButtonIcon,{"aria-label":i.i18n.translate("xpack.observabilityAiAssistant.insight.actions",{defaultMessage:"Actions"}),color:"text",css:_,"data-test-subj":"observabilityAiAssistantInsightBaseButtonIcon",disabled:0===(null==l?void 0:l.length),display:"empty",iconType:"boxesHorizontal",size:"s",onClick:x}),panelPaddingSize:"s",closePopover:x,isOpen:d},Object(I.jsx)(n.EuiContextMenuPanel,{size:"s",items:null==l?void 0:l.map((({id:t,icon:e,label:s,handler:i})=>Object(I.jsx)(n.EuiContextMenuItem,{key:t,icon:e,onClick:i},s)))}))):null):null,onToggle:c},Object(I.jsx)(n.EuiSpacer,{size:"m"}),Object(I.jsx)(n.EuiPanel,{hasBorder:!1,hasShadow:!1,color:"subdued","data-test-subj":"obsAiAssistantInsightResponse"},a)))}var U=s(29);function D({connectors:t,onEditPrompt:e}){var s,a;const[l,c]=Object(o.useState)(!1),r=()=>{c(!1)},u=[{id:0,title:"Actions",items:[{name:Object(I.jsx)("div",{className:"eui-textTruncate"},i.i18n.translate("xpack.observabilityAiAssistant.insight.actions.connector",{defaultMessage:"Connector"})," ",Object(I.jsx)("strong",null,null===(s=t.connectors)||void 0===s||null===(a=s.find((({id:e})=>e===t.selectedConnector)))||void 0===a?void 0:a.name)),icon:"wrench",panel:1},{name:i.i18n.translate("xpack.observabilityAiAssistant.insight.actions.editPrompt",{defaultMessage:"Edit prompt"}),icon:"documentEdit",onClick:()=>{e(),r()}}]},{id:1,title:i.i18n.translate("xpack.observabilityAiAssistant.insight.actions.connector",{defaultMessage:"Connector"}),content:Object(I.jsx)(n.EuiPanel,null,Object(I.jsx)(U.a,t))}],b=Object(I.jsx)(n.EuiButtonIcon,{"aria-label":i.i18n.translate("xpack.observabilityAiAssistant.insight.openActions",{defaultMessage:"Open insight actions"}),"data-test-subj":"observabilityAiAssistantInsightActionsButtonIcon",iconType:"boxesHorizontal",onClick:()=>{c(!l)}});return Object(I.jsx)(n.EuiPopover,{button:b,isOpen:l,closePopover:r,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(I.jsx)(n.EuiContextMenu,{initialPanelId:0,panels:u}))}var G=s(12);function N(t,e){return Object(a.last)(t.filter((t=>t.message.role===e)))}function H({title:t,initialMessages:e,connectorId:s}){var i;const a=Object(p.a)(),c=Object(O.a)(),r=Object(o.useRef)(e),{flyoutState:b}=function(){const[t=E,e,s]=f()(v,E);return{flyoutState:t,setFlyoutState:e,removeFlyoutState:s}}(),{messages:j,next:g,state:x,stop:m}=Object(d.c)({service:a,chatService:c,connectorId:s,initialMessages:e,persist:!1,disableFunctions:!0}),A=N(j.slice(r.current.length+1),u.b.Assistant);return Object(o.useEffect)((()=>{g(r.current)}),[g]),Object(I.jsx)(l.a.Fragment,null,Object(I.jsx)(M,{body:Object(I.jsx)(z.a,{content:null!==(i=null==A?void 0:A.message.content)&&void 0!==i?i:"",loading:x===d.a.Loading,onActionClick:async()=>{}}),error:x===d.a.Error,controls:x===d.a.Loading?Object(I.jsx)(F.a,{onClick:()=>{m()}}):Object(I.jsx)(n.EuiFlexGroup,{direction:"row"},Object(I.jsx)(P.a,{onClickFeedback:t=>{A&&c.sendAnalyticsEvent({type:G.a.InsightFeedback,payload:{feedback:t,message:A}})}}),Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(y.a,{onClick:()=>{g(e)}})),Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(k,{disabled:b.isOpen,onClick:()=>{a.conversations.openNewConversation({messages:j,title:t})}})))}))}function Y({initialPrompt:t,onSend:e,onCancel:s}){const[a,l]=Object(o.useState)(t);return Object(I.jsx)(n.EuiFlexGroup,{alignItems:"center"},Object(I.jsx)(n.EuiFlexItem,{grow:!0},Object(I.jsx)(n.EuiTextArea,{"data-test-subj":"observabilityAiAssistantInsightEditPromptTextArea",inputRef:t=>{t&&setTimeout((()=>t.focus()))},fullWidth:!0,defaultValue:a,onChange:t=>{l(t.target.value)}})),Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(n.EuiButtonIcon,{"aria-label":i.i18n.translate("xpack.observabilityAiAssistant.insight.cancelPromptEdit",{defaultMessage:"Cancel"}),"data-test-subj":"observabilityAiAssistantInsightCancelEditPromptButtonIcon",iconType:"cross",display:"base",color:"danger",size:"m",onClick:s})),Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(n.EuiButtonIcon,{"aria-label":i.i18n.translate("xpack.observabilityAiAssistant.insight.sendPromptEdit",{defaultMessage:"Send prompt"}),"data-test-subj":"observabilityAiAssistantInsightSendEditPromptButtonIcon",iconType:"kqlFunction",display:"fill",size:"m",onClick:()=>e(a)})))}var V=function(t){return t.LOADING="loading",t.SUCCESS="success",t.FAILURE="failure",t.NOT_INITIATED="not_initiated",t}(V||{});function q({messages:t,title:e,dataTestSubj:s}){var c;const[d,O]=Object(o.useState)({messages:[],status:V.NOT_INITIATED}),[m,f]=Object(o.useState)(!1),[A,E]=Object(o.useState)(!1),[v,y]=Object(o.useState)(!1),[S,C]=Object(o.useState)(!1),k=Object(o.useCallback)((async()=>{if(Object(a.isArray)(t))O({messages:t,status:V.SUCCESS});else{O({messages:[],status:V.LOADING});try{const e=await t();O({messages:null!=e?e:[],status:V.SUCCESS})}catch(t){O({messages:[],status:V.FAILURE}),console.log("could not load insight messages",t)}}}),[t]),F=Object(o.useMemo)((()=>Object(a.once)(k)),[k]);Object(o.useEffect)((()=>{A&&F()}),[F,A]);const P=Object(g.a)(),T=Object(p.a)(),M=Object(j.a)((({signal:t})=>T.start({signal:t})),[T]),z=t=>{const e=Object(a.cloneDeep)(d.messages),s=N(e,u.b.User);return!!s&&(s.message.content=t,C(!0),O({messages:e,status:V.SUCCESS}),f(!1),!0)},B=()=>{f(!1),E(!1),y(!1)},{services:{http:L,plugins:{start:{licensing:_}}}}=Object(x.a)(),U=r()(_.license$),G=null==U?void 0:U.hasAtLeast("enterprise");if(Object(a.isEmpty)(P.connectors)||!G)return null;let q=null;if(P.selectedConnector&&(!A&&v||A&&!m&&d.status===V.SUCCESS))q=Object(I.jsx)(l.a.Fragment,null,S?Object(I.jsx)(l.a.Fragment,null,Object(I.jsx)(n.EuiFlexGroup,{alignItems:"center",gutterSize:"none"},Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(n.EuiText,{size:"xs"},i.i18n.translate("xpack.observabilityAiAssistant.insightModifiedPrompt",{defaultMessage:"This insight has been modified."}))),Object(I.jsx)(n.EuiFlexItem,{grow:!1},Object(I.jsx)(n.EuiButtonEmpty,{"data-test-subj":"observabilityAiAssistantInsightResetDefaultPrompt",onClick:()=>{C(!1),y(!1),E(!1),k()}},Object(I.jsx)(n.EuiText,{size:"xs"},i.i18n.translate("xpack.observabilityAiAssistant.resetDefaultPrompt",{defaultMessage:"Reset to default"}))))),Object(I.jsx)(n.EuiHorizontalRule,{size:"full",margin:"none"}),Object(I.jsx)(n.EuiSpacer,{size:"m"})):null,Object(I.jsx)(H,{title:e,initialMessages:d.messages,connectorId:P.selectedConnector}));else if(m){var W;q=Object(I.jsx)(Y,{initialPrompt:(null===(W=N(d.messages,u.b.User))||void 0===W?void 0:W.message.content)||"",onSend:z,onCancel:B})}else P.loading||null!==(c=P.connectors)&&void 0!==c&&c.length?d.status===V.FAILURE&&(q=Object(I.jsx)(n.EuiCallOut,{size:"s",title:i.i18n.translate("xpack.observabilityAiAssistant.insight.div.errorFetchingMessagesLabel",{defaultMessage:"Could not fetch prompt messages"}),color:"danger",iconType:"error"})):q=Object(I.jsx)(w,{connectorsManagementHref:h(L)});return Object(I.jsx)(R,{title:e,onToggle:t=>{y((e=>!m&&(e||t))),E(t)},controls:Object(I.jsx)(D,{connectors:P,onEditPrompt:()=>{f(!0),E(!0)}}),loading:P.loading||M.loading,dataTestSubj:s,isOpen:A},M.value?Object(I.jsx)(b.a.Provider,{value:M.value},q):null)}}}]);