/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.profiling_bundle_jsonpfunction=window.profiling_bundle_jsonpfunction||[]).push([[0],{116:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));let n=function(e){return e.Timestamp="@timestamp",e.ContainerName="container.name",e.ProcessThreadName="process.thread.name",e.StacktraceCount="Stacktrace.count",e.HostID="host.id",e.HostName="host.name",e.HostIP="host.ip",e.OrchestratorResourceName="orchestrator.resource.name",e.ServiceName="service.name",e.StacktraceID="Stacktrace.id",e.StacktraceFrameIDs="Stacktrace.frame.ids",e.StacktraceFrameTypes="Stacktrace.frame.types",e.StackframeFileName="Stackframe.file.name",e.StackframeFunctionName="Stackframe.function.name",e.StackframeLineNumber="Stackframe.line.number",e.StackframeFunctionOffset="Stackframe.function.offset",e.ExecutableBuildID="Executable.build.id",e.ExecutableFileName="Executable.file.name",e}({})},128:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return i}));var n=a(116);a(6),a(8);let r=function(e){return e.StackTraces="stackTraces",e.Percentage="percentage",e}({}),s=function(e){return e.Containers="containers",e.Deployments="deployments",e.Threads="threads",e.Hosts="hosts",e.Traces="traces",e}({});function i(e){return{[s.Containers]:n.a.ContainerName,[s.Deployments]:n.a.OrchestratorResourceName,[s.Threads]:n.a.ProcessThreadName,[s.Hosts]:n.a.HostID,[s.Traces]:n.a.StacktraceID}[e]}},40:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1),r=a(47);function s(){const e=Object(n.useContext)(r.a);if(!e)throw new Error("ProfilingDependenciesContext not found");return e}},45:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l}));var n=a(35),r=a(1),s=a(3),i=a(40),o=a(76);let c=function(e){return e.Loading="loading",e.Init="init",e.Settled="settled",e}({});const l=(e,t)=>{const{start:{core:{notifications:a}}}=Object(i.a)(),[l,u]=Object(r.useState)(0),j=Object(r.useCallback)((()=>{u((e=>e+1))}),[]),[m,d]=Object(r.useState)({status:c.Init,refresh:j}),{data:b,error:x}=m,g=Object(o.a)(t);return Object(r.useEffect)((()=>{const t=e({http:g});void 0!==t?(d({status:c.Loading,data:b,error:x,refresh:j}),t.then((e=>{d({status:c.Settled,data:e,refresh:j})})),t.catch((e=>{if(!(e instanceof n.AbortError))throw d({status:c.Settled,error:e,refresh:j}),e}))):d({status:c.Init,data:void 0,error:void 0,refresh:j})}),[g,l,...t]),Object(r.useEffect)((()=>{const e=setTimeout((()=>{m.status===c.Loading&&a.toasts.addWarning({title:s.i18n.translate("xpack.profiling.fetch.toast.title",{defaultMessage:"Data Retrieval in Progress"}),text:s.i18n.translate("xpack.profiling.fetch.toast.describe",{defaultMessage:"If necessary, retrieving requested data from the warm storage tier may take longer than expected."})},{toastLifeTimeMs:3e5})}),15e3);return()=>{clearTimeout(e)}}),[m.status,a.toasts]),m}},47:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return s}));var n=a(1);const r=Object(n.createContext)(void 0),s=r.Provider},50:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(17),r=a(3),s=(a(1),a(45)),i=a(0);function o({children:e,status:t,error:a,mono:o,size:c,style:l,alignTop:u}){return t!==s.a.Settled||a?Object(i.jsx)(n.EuiFlexGroup,{alignItems:u?"flexStart":"center",justifyContent:"center",direction:"row",style:l,gutterSize:"none"},Object(i.jsx)(n.EuiFlexItem,{grow:!1,style:{alignContent:"center"}},a&&t===s.a.Settled?Object(i.jsx)(n.EuiFlexGroup,{direction:"row",gutterSize:"xs",alignItems:"center"},Object(i.jsx)(n.EuiFlexItem,null,Object(i.jsx)(n.EuiIcon,{type:"warning",color:"warning"})),Object(i.jsx)(n.EuiFlexItem,null,Object(i.jsx)(n.EuiText,{style:{whiteSpace:"nowrap"}},r.i18n.translate("xpack.profiling.asyncComponent.errorLoadingData",{defaultMessage:"Could not load data"})))):Object(i.jsx)(n.EuiLoadingChart,{mono:o,size:c}))):e}},51:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(54);function r(e){return`${Object(n.a)(100*e)}%`}},54:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(11);function r(e){return isNaN(e)?n.b:0===e?"0":(e=Math.round(100*e)/100,Math.abs(e)<.01?"~0.00":Math.abs(e)<1e3?e.toString():Math.abs(e)<1e6?`${r(e/1e3)}k`:Math.abs(e)<1e9?`${r(e/1e6)}m`:`${r(e/1e9)}b`)}},65:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(40);const r={barSeriesStyle:{rectBorder:{strokeOpacity:1,strokeWidth:1,visible:!0},rect:{opacity:.6}},scales:{barsPadding:0,histogramPadding:0},partition:{fillLabel:{textColor:"white"},emptySizeRatio:.3,sectorLineWidth:0}};function s(){const{start:{charts:e}}=Object(n.a)();return{chartsBaseTheme:e.theme.useChartsBaseTheme(),chartsTheme:r}}},70:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(22),r=a(29);function s(){const[e]=Object(n.useUiSetting$)(r.UI_SETTINGS.DATEFORMAT_TZ);return e&&"Browser"!==e?e:"local"}},75:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return c}));var n=a(17),r=a(3),s=a(10);a(116);const i=r.i18n.translate("xpack.profiling.topn.otherBucketLabel",{defaultMessage:"Other"});function o({category:e,subChartSize:t,colors:a}){return a[(e=>{let a=0;for(let t=0;t<e.length;t++)a=(a<<5)-a+e.charCodeAt(t),a&=2147483647;return a%t})(e)]}function c(e){const{TotalCount:t,TopN:a,Metadata:r,Labels:i}=e,c=new Map;for(let e=0;e<a.length;e++){const t=a[e];c.has(t.Category)||c.set(t.Category,[]),c.get(t.Category).push({Percentage:t.Percentage,Timestamp:t.Timestamp,Count:t.Count})}const l=[];for(const[e,a]of c){var u;const n=a.reduce(((e,{Count:t})=>e+(null!=t?t:0)),0);l.push({Category:e,Label:i[e]||e,Percentage:n/t*100,Series:a,Metadata:null!==(u=r[e])&&void 0!==u?u:[]})}const j=Object(n.euiPaletteColorBlind)({rotations:Math.ceil(l.length/10)});return{charts:Object(s.orderBy)(l,["Percentage","Category"],["desc","asc"]).map(((e,t)=>({...e,Color:o({category:e.Category,colors:j,subChartSize:l.length}),Index:t+1,Series:e.Series.map((t=>({...t,Category:e.Category})))})))}}},76:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1),r=a(40);const s=["fetch","get","post","put","delete","patch"];function i(e){const t=Object(n.useRef)(new AbortController),{start:{core:{http:a}}}=Object(r.a)(),i=Object(n.useMemo)((()=>{t.current.abort(),t.current=new AbortController;const e={};for(const n of s)e[n]=(e,r)=>a[n](e,{...r,signal:t.current.signal}).catch((e=>{if("AbortError"===e.name)return new Promise((()=>{}));throw e}));return{...a,...e}}),[a,...e]);return Object(n.useEffect)((()=>()=>{t.current.abort()}),[]),i}},82:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(17),r=(a(1),a(6)),s=a(0);function i({calleeFunctionName:e}){return Object(s.jsx)(n.EuiText,{size:"s",style:{fontWeight:"bold",overflowWrap:"anywhere"}},e)}function o({frame:e,onFrameClick:t}){const a=Object(r.h)(e);return Object(s.jsx)(n.EuiFlexGroup,{direction:"column",gutterSize:"xs"},Object(s.jsx)(n.EuiFlexItem,null,Object(s.jsx)("div",null,t?Object(s.jsx)(n.EuiLink,{"data-test-subj":"profilingStackFrameSummaryLink",onClick:function(){t&&t(a)}},Object(s.jsx)(i,{calleeFunctionName:a})):Object(s.jsx)(i,{calleeFunctionName:a}))),Object(s.jsx)(n.EuiFlexItem,{style:{overflowWrap:"anywhere"}},Object(s.jsx)(n.EuiText,{size:"s"},Object(r.j)(e)||"â€Ž")))}},87:function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));var n=a(2),r=a.n(n),s=a(17),i=a(3),o=a(1),c=a.n(o),l=a(128),u=a(24),j=a(10),m=a(70),d=a(65),b=a(51),x=a(0),g=a(75),h=a(54),f=a(82);const p=5;function O(e,t){return Object(x.jsx)(s.EuiFlexItem,{grow:!1,key:e.FrameID},Object(x.jsx)(s.EuiFlexGroup,{direction:"row",alignItems:"center"},Object(x.jsx)(s.EuiFlexItem,{grow:!1},t),Object(x.jsx)(s.EuiFlexItem,{grow:!0},Object(x.jsx)(f.a,{frame:e}))))}var y={name:"r8cgp9",styles:"display:flex;flex-direction:column-reverse;.css-bknxw4-euiButtonIcon-xs-empty-text-euiAccordion__arrow-left-isOpen{transform:rotate(-90deg)!important;}"};function T({index:e,color:t,category:a,label:n,percentage:r,height:l,data:f,width:T,showAxes:S,metadata:k=[],onClick:C,style:E,showFrames:w,padTitle:F,sample:v}){const I=Object(s.useEuiTheme)(),[M,z]=Object(o.useState)({}),L=Object(m.a)(),{chartsTheme:A,chartsBaseTheme:B}=Object(d.a)(),P=!!C,D=k.filter((e=>!1===e.Inline)),N=P?D.concat().reverse().slice(0,p):D.concat().reverse(),G=Object(o.useMemo)((()=>{const e=Object(j.groupBy)(k,"AddressOrLine");return Object.keys(e).reduce(((t,a)=>{const[n,...r]=e[a];return t[a]=r,t}),{})}),[k]),H=N.length<k.length;let V;return V=k.length>0?Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)(s.EuiFlexItem,{style:{backgroundColor:I.euiTheme.colors.lightestShade,padding:I.euiTheme.size.m}},Object(x.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"none"},N.map(((e,t)=>{const a=D.indexOf(e)+1,n=G[e.AddressOrLine].concat().reverse(),r=[t,e.FrameID].join("|"),c=M[r];return Object(x.jsx)(o.Fragment,{key:r},n.length>0?Object(x.jsx)(s.EuiAccordion,{forceState:c||"closed",onToggle:e=>{z((t=>({...t,[r]:e?"open":"closed"})))},css:y,id:`accordion_${e.AddressOrLine}`,buttonContent:O(e,a),paddingSize:"s",extraAction:Object(x.jsx)(s.EuiToolTip,{content:i.i18n.translate("xpack.profiling.traces.subChart.inlineDescription",{defaultMessage:"This frame has {numberOfChildren} inline {numberOfChildren, plural, one {frame} other {frames}} inside, this allows for optimised processes.",values:{numberOfChildren:n.length}})},Object(x.jsx)(s.EuiBadge,{color:"primary"},`-> ${n.length}`))},"open"===c?Object(x.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"s",style:{marginLeft:"12px"}},n.map(((e,t)=>Object(x.jsx)(o.Fragment,{key:[r,t].join("|")},O(e,`${a}.${n.length-t} ->`))))):null):O(e,a),t<N.length-1||H?Object(x.jsx)(s.EuiFlexItem,{grow:!1},Object(x.jsx)(s.EuiHorizontalRule,{size:"full",margin:"s"})):null)}))),H&&!!C&&Object(x.jsx)(s.EuiButton,{"data-test-subj":"profilingSubChartShowMoreButton",onClick:C},i.i18n.translate("xpack.profiling.stackTracesView.showMoreTracesButton",{defaultMessage:"Show more"})))):a===g.a&&w?Object(x.jsx)(s.EuiFlexItem,{grow:!0,style:{padding:I.euiTheme.size.m}},Object(x.jsx)(s.EuiFlexGroup,{direction:"row",alignItems:"center",justifyContent:"center"},Object(x.jsx)(s.EuiFlexItem,{grow:!1},i.i18n.translate("xpack.profiling.stackTracesView.otherTraces",{defaultMessage:"[This summarizes all traces that are too small to display]"})))):Object(x.jsx)(s.EuiSpacer,{size:"s"}),Object(x.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"s",style:{...E,height:"100%"}},Object(x.jsx)(s.EuiFlexItem,{grow:!1,style:{...F?{padding:I.euiTheme.size.l,paddingBottom:I.euiTheme.size.s}:{}}},Object(x.jsx)(s.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center",style:{overflowWrap:"anywhere"}},Object(x.jsx)(s.EuiFlexItem,{grow:!1},Object(x.jsx)(s.EuiBadge,{color:t},Object(x.jsx)(s.EuiText,{color:I.euiTheme.colors.lightestShade,size:"xs"},e))),Object(x.jsx)(s.EuiFlexItem,{grow:!0,style:{alignItems:"flex-start"}},a===g.a||void 0===C?Object(x.jsx)(s.EuiText,{size:"s"},n):Object(x.jsx)(s.EuiLink,{"data-test-subj":"profilingSubChartLink",onClick:C},Object(x.jsx)(s.EuiText,{size:"s"},n))),Object(x.jsx)(s.EuiFlexItem,{grow:!1},Object(x.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"xs",alignItems:"flexEnd"},v?Object(x.jsx)(s.EuiFlexItem,null,Object(x.jsx)(s.EuiText,{size:"m"},Object(b.a)(v.Percentage/100))):null,Object(x.jsx)(s.EuiFlexItem,null,Object(x.jsx)(s.EuiText,{size:v?"xs":"s"},v?i.i18n.translate("xpack.profiling.stackFrames.subChart.avg",{defaultMessage:"avg. {percentage}",values:{percentage:Object(b.a)(r/100)}}):Object(b.a)(r/100))))))),Object(x.jsx)(s.EuiFlexItem,{grow:!1,style:{position:"relative"}},Object(x.jsx)(u.Chart,{size:{height:l,width:T}},Object(x.jsx)(u.Tooltip,{showNullValues:!1}),Object(x.jsx)(u.Settings,{showLegend:!1,baseTheme:B,theme:A,locale:i.i18n.getLocale()}),Object(x.jsx)(u.AreaSeries,{id:a,name:a,data:f,xAccessor:"Timestamp",yAccessors:["Count"],xScaleType:u.ScaleType.Time,timeZone:L,yScaleType:u.ScaleType.Linear,curve:u.CurveType.CURVE_STEP_AFTER,color:t}),v?Object(x.jsx)(u.LineAnnotation,{id:"highlighted_sample",domainType:u.AnnotationDomainType.XDomain,dataValues:[{dataValue:v.Timestamp}],style:{line:{strokeWidth:2,dash:[4,4],opacity:.5}},marker:Object(x.jsx)(s.EuiIcon,{type:"dot"}),markerPosition:u.Position.Top,hideTooltips:!0}):null,S?Object(x.jsx)(u.Axis,{id:"bottom-axis",position:"bottom",tickFormat:Object(u.timeFormatter)("YYYY-MM-DD HH:mm:ss")}):null,Object(x.jsx)(u.Axis,{id:"left-axis",position:"left",gridLine:{visible:!0},tickFormat:e=>S?Number(e).toFixed(0):"",style:S?{}:{tickLine:{visible:!1},tickLabel:{visible:!1},axisTitle:{visible:!1}}})),S?null:Object(x.jsx)("div",{style:{position:"absolute",top:0,left:0,backgroundColor:"rgba(255, 255, 255, 0.75)"}},v?Object(h.a)(v.Count):i.i18n.translate("xpack.profiling.maxValue",{defaultMessage:"Max: {max}",values:{max:Object(h.a)(Math.max(...f.map((e=>{var t;return null!==(t=e.Count)&&void 0!==t?t:0}))))}}))),V)}const S=224;function k({height:e,asPercentages:t,onBrushEnd:a,charts:n,showFrames:r,onClick:c}){const l=Object(o.useMemo)((()=>Object(j.keyBy)(n,"Category")),[n]),g=Object(m.a)(),[h,f]=Object(o.useState)(),{chartsBaseTheme:p,chartsTheme:O}=Object(d.a)();return Object(x.jsx)(u.Chart,{size:{height:e}},Object(x.jsx)(u.Settings,{showLegend:!1,brushAxis:u.BrushAxis.X,onBrushEnd:e=>{const t=new Date(e.x[0]).toISOString(),n=new Date(e.x[1]).toISOString();a({rangeFrom:t,rangeTo:n})},baseTheme:p,theme:O,onElementOver:e=>{const[t]=e[0];f(t.datum)},onElementClick:c?e=>{const[t]=e[0],a=t.datum;c(l[a.Category])}:void 0,onElementOut:()=>{f(void 0)},locale:i.i18n.getLocale()}),Object(x.jsx)(u.Tooltip,{customTooltip:function(){if(!h)return null;const e=l[h.Category];return e?Object(x.jsx)(u.TooltipContainer,null,Object(x.jsx)(s.EuiPanel,null,Object(x.jsx)(T,{index:e.Index,color:e.Color,category:e.Category,label:e.Label,data:e.Series,percentage:e.Percentage,sample:h,showFrames:r,height:128,width:S,showAxes:!1,padTitle:!1,onClick:c?()=>c(e):void 0}))):null}}),n.map((e=>Object(x.jsx)(u.HistogramBarSeries,{key:e.Category,id:e.Category,name:e.Label,data:e.Series,color:e.Color,xAccessor:"Timestamp",yAccessors:["Count"],stackAccessors:["true"],stackMode:t?u.StackMode.Percentage:void 0,xScaleType:u.ScaleType.Time,timeZone:g}))),Object(x.jsx)(u.Axis,{id:"bottom-axis",position:"bottom",tickFormat:Object(u.timeFormatter)("YYYY-MM-DD HH:mm:ss")}),Object(x.jsx)(u.Axis,{id:"left-axis",position:"left",gridLine:{visible:!0},tickFormat:e=>t?Object(b.a)(e):e.toFixed(0)}))}function C({limit:e,charts:t,showFrames:a,onChartClick:n}){var r;const i=Math.min(e,null!==(r=t.length)&&void 0!==r?r:0),l=Math.min(i,t.length),u=Object(o.useMemo)((()=>Object(j.take)(t,l).map((e=>Object(x.jsx)(s.EuiFlexItem,{key:e.Category},Object(x.jsx)(s.EuiPanel,{paddingSize:"none"},Object(x.jsx)(T,{index:e.Index,color:e.Color,category:e.Category,label:e.Label,percentage:e.Percentage,metadata:e.Metadata,height:200,data:e.Series,sample:null,showAxes:!0,onClick:n?()=>n(e):void 0,showFrames:a,padTitle:!0})))))),[t,l,n,a]);return Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)(s.EuiSpacer,null),Object(x.jsx)(s.EuiFlexGrid,{columns:2,gutterSize:"m"},u))}var E=a(50);const w=[{id:l.a.StackTraces,iconType:"visLine",label:i.i18n.translate("xpack.profiling.stackTracesView.stackTracesCountButton",{defaultMessage:"Stack traces"})},{id:l.a.Percentage,iconType:"percent",label:i.i18n.translate("xpack.profiling.stackTracesView.percentagesButton",{defaultMessage:"Percentages"})}];function F({type:e,state:t,displayOption:a,onChangeDisplayOption:n,onStackedBarChartBrushEnd:u,limit:j,onShowMoreClick:m,onChartClick:d}){var b,g;const h=null!==(b=null===(g=t.data)||void 0===g?void 0:g.charts)&&void 0!==b?b:[],f=e===l.b.Traces,[p,O]=Object(o.useState)(void 0);function y(t){e===l.b.Traces?O(t):d(t.Category)}return Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)(s.EuiFlexGroup,{direction:"column"},Object(x.jsx)(s.EuiFlexItem,{grow:!0},Object(x.jsx)(s.EuiPanel,null,Object(x.jsx)(s.EuiFlexGroup,{direction:"column",gutterSize:"m"},Object(x.jsx)(s.EuiFlexItem,null,Object(x.jsx)(s.EuiButtonGroup,{idSelected:a,type:"single",onChange:e=>{n(e)},options:w,legend:i.i18n.translate("xpack.profiling.stackTracesView.displayOptionLegend",{defaultMessage:"Display option"})})),Object(x.jsx)(s.EuiFlexItem,{style:{alignContent:"center"}},Object(x.jsx)(E.a,r()({size:"xl"},t,{style:{height:400}}),Object(x.jsx)(k,{height:400,charts:h,asPercentages:a===l.a.Percentage,onBrushEnd:u,showFrames:f,onClick:y})))))),Object(x.jsx)(s.EuiFlexItem,{grow:!0},Object(x.jsx)(E.a,r()({size:"m",mono:!0},t,{style:{minHeight:200}}),Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)(s.EuiSpacer,null),Object(x.jsx)(s.EuiTitle,{size:"s"},Object(x.jsx)("h1",null,i.i18n.translate("xpack.profiling.chartGrid.h1.topLabel",{defaultMessage:"Top {size}",values:{size:m?h.length:Math.min(j,h.length)}}))),Object(x.jsx)(C,{charts:h,limit:j,showFrames:f,onChartClick:y})))),m&&h.length>j?Object(x.jsx)(s.EuiFlexItem,null,Object(x.jsx)(s.EuiButton,{"data-test-subj":"profilingStackTracesViewShowMoreButton",onClick:()=>m(j+10)},i.i18n.translate("xpack.profiling.stackTracesView.showMoreButton",{defaultMessage:"Show more"}))):null),p&&Object(x.jsx)(s.EuiFlyout,{onClose:()=>{O(void 0)}},Object(x.jsx)(T,{style:{overflow:"auto"},index:p.Index,color:p.Color,category:p.Category,label:p.Label,percentage:p.Percentage,metadata:p.Metadata,height:200,data:p.Series,sample:null,showAxes:!0,showFrames:f,padTitle:!0})))}}}]);