!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,r){t.exports=r(9)(2)},function(t,e){t.exports=__kbnSharedDeps__.React},function(t,e){t.exports=__kbnSharedDeps__.Rxjs},function(t,e){t.exports=__kbnSharedDeps__.EmotionReact},function(t,e){t.exports=__kbnSharedDeps__.KbnAnalytics},function(t,e,r){r.r(e);var n=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(e,Object.getOwnPropertyDescriptors(n))},function(t,e){t.exports=__kbnSharedDeps__.ReactDom},function(t,e,r){r(8),__kbnBundles__.define("plugin/usageCollection/public",r,10)},function(t,e,r){r.p=window.__kbnPublicPath__.usageCollection},function(t,e){t.exports=__kbnSharedDeps_npm__},function(t,e,r){"use strict";r.r(e),r.d(e,"TrackApplicationView",(function(){return b})),r.d(e,"plugin",(function(){return k}));var n=r(0),i=r.n(n),o=r(4),a=r(1),c=r.n(a),s=r(5),p=r(2);const u="main",l=["kibana"];var d=r(6),g=r.n(d);class track_application_view_component_TrackApplicationViewComponent extends c.a.Component{constructor(...t){super(...t),i()(this,"parentNode",void 0),i()(this,"onClick",(t=>{var e,r;const{applicationUsageTracker:n,viewId:i}=this.props;this.parentNode=this.parentNode||(null===(e=g.a.findDOMNode(this))||void 0===e?void 0:e.parentNode),(this.parentNode===t.target||null!==(r=this.parentNode)&&void 0!==r&&r.contains(t.target))&&(null==n||n.updateViewClickCounter(i))}))}componentDidMount(){const{applicationUsageTracker:t,viewId:e}=this.props;t&&(t.trackApplicationViewUsage(e),document.addEventListener("click",this.onClick))}componentWillUnmount(){const{applicationUsageTracker:t,viewId:e}=this.props;t&&t.flushTrackedView(e),document.removeEventListener("click",this.onClick)}render(){return this.props.children}}var h=r(3);const f=Object(a.createContext)(void 0),b=t=>Object(h.jsx)(f.Consumer,null,(e=>{const r={...t,applicationUsageTracker:e};return Object(h.jsx)(track_application_view_component_TrackApplicationViewComponent,r)}));class plugin_UsageCollectionPlugin{constructor(t){i()(this,"applicationUsageTracker",void 0),i()(this,"subscriptions",[]),i()(this,"reporter",void 0),i()(this,"config",void 0),this.initContext=t,this.config=t.config.get()}setup({http:t}){const e=new s.Storage(window.localStorage);this.reporter=function(t){const{localStorage:e,logger:r,fetch:n}=t;return new o.Reporter({logger:r,storage:e,async http(t){const e=await n.post("/api/ui_counters/_report",{body:JSON.stringify({report:t}),asSystemRequest:!0}),r=e.status;if(e.status!==r)throw Error("Unable to store report.");return e}})}({localStorage:e,logger:this.initContext.logger.get("reporter"),fetch:t}),this.applicationUsageTracker=new o.ApplicationUsageTracker(this.reporter);const r=this.getPublicApplicationUsageTracker();return{components:{ApplicationUsageTrackingProvider:t=>Object(h.jsx)(f.Provider,{value:r},t.children)},reportUiCounter:this.reporter.reportUiCounter}}start({http:t,application:e},{screenshotMode:r}){if(!this.reporter||!this.applicationUsageTracker)throw new Error("Usage collection reporter not set up correctly");var n,i;return!this.config.uiCounters.enabled||function(t){const{anonymousPaths:e}=t;return e.isAnonymous(window.location.pathname)}(t)||r.isScreenshotMode()||window.navigator.userAgent.includes("Elastic/Synthetics")||(this.reporter.start(),this.applicationUsageTracker.start(),this.subscriptions=(n=e.currentAppId$,i=this.applicationUsageTracker,[Object(p.fromEvent)(window,"click").subscribe((()=>{i.updateViewClickCounter(u)})),n.pipe(Object(p.filter)((t=>"string"==typeof t&&!l.includes(t))),Object(p.distinctUntilChanged)()).subscribe((t=>{t&&(i.setCurrentAppId(t),i.trackApplicationViewUsage(u))}))])),this.reporter.reportUserAgent("kibana"),{reportUiCounter:this.reporter.reportUiCounter}}stop(){this.applicationUsageTracker&&(this.applicationUsageTracker.stop(),this.subscriptions.forEach((t=>t.unsubscribe())))}getPublicApplicationUsageTracker(){return{trackApplicationViewUsage:this.applicationUsageTracker.trackApplicationViewUsage.bind(this.applicationUsageTracker),flushTrackedView:this.applicationUsageTracker.flushTrackedView.bind(this.applicationUsageTracker),updateViewClickCounter:this.applicationUsageTracker.updateViewClickCounter.bind(this.applicationUsageTracker)}}}function k(t){return new plugin_UsageCollectionPlugin(t)}}]);