/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[11],{122:function(e,t,n){"use strict";function a(e,t){return t?u(e):e.aggregatable&&s(e,t)||(!e.aggregatable||"geo_point"===e.type||"geo_shape"===e.type)&&r(e,t)}function s(e,t){return!t&&!("document"===e.type||e.type.includes("range")||"geo_point"===e.type||"geo_shape"===e.type||"murmur3"===e.type||"attachment"===e.type)}function o(e,t){return!t&&"counter"===e.timeSeriesMetric}function r(e,t){return t?"string"===e.type&&!i(e)||["geo_point","geo_shape"].includes(e.type):"_score"!==e.name&&["string","text","keyword","version","ip","number","geo_point","geo_shape"].includes(e.type)}function i(e){var t;if("_id"===e.name)return!1;const n=null===(t=e.esTypes)||void 0===t?void 0:t[0];return Boolean("string"===e.type&&n&&["keyword","version"].includes(n))||["keyword","version","ip","number","boolean"].includes(e.type)}function u(e){return i(e)||r(e,!0)}n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return u}))},123:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return i}));const a=5e3,s=10,o=100,r=10,i=1e4},627:function(e,t,n){"use strict";n.r(t),n.d(t,"loadFieldStats",(function(){return f}));var a=n(2),s=n(72),o=n.n(s),r=n(630),i=n(122),u=n(123);function l({dataViewPattern:e,timeFieldName:t,fromDate:n,toDate:a,dslQuery:s,runtimeMappings:o,aggs:r,fields:i,size:u}){const l=t?[{range:{[t]:{gte:n,lte:a,format:"strict_date_optional_time"}}},s]:[s];return 1===(null==i?void 0:i.length)&&l.push({exists:i[0]}),{index:e,body:{query:{bool:{filter:l}},aggs:r,fields:i,runtime_mappings:o,_source:(null==i||!i.length)&&void 0},track_total_hits:!0,size:null!=u?u:0}}async function c(e,t,n=!0){const a=m(t),s={min_value:{min:{field:t.name}},max_value:{max:{field:t.name}},sample_count:{value_count:{...a}}},o={sample:{sampler:{shard_size:u.d},aggs:{...s}}},r={sample:{sampler:{shard_size:u.d},aggs:{...s,top_values:{terms:{...a,size:u.b}}}}},i=await e({aggs:n?r:o}),l=i.aggregations.sample.min_value.value,c=i.aggregations.sample.max_value.value,d="top_values"in i.aggregations.sample?i.aggregations.sample.top_values:{buckets:[],sum_other_doc_count:0},f={buckets:d.buckets.map((e=>({count:e.doc_count,key:e.key})))};let _=(c-l)/10;if(Number.isInteger(l)&&Number.isInteger(c)&&(_=Math.ceil(_)),0===_)return{totalDocuments:g(i),sampledValues:p(f,d.sum_other_doc_count)||i.aggregations.sample.sample_count.value,sampledDocuments:i.aggregations.sample.doc_count,topValues:f,histogram:n?{buckets:[]}:{buckets:[{count:i.aggregations.sample.doc_count,key:l}]}};const y={sample:{sampler:{shard_size:u.d},aggs:{histo:{histogram:{field:t.name,interval:_}}}}},v=await e({aggs:y});return{totalDocuments:g(i),sampledDocuments:i.aggregations.sample.doc_count,sampledValues:p(f,d.sum_other_doc_count)||i.aggregations.sample.sample_count.value,histogram:{buckets:v.aggregations.sample.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))},topValues:f}}async function d(e,t,n,a){try{const s=m(t),o={size:u.e,fields:[s]},i=await e(o),l=Object(r.a)({values:Object(r.b)(i.hits.hits,t,n),field:t,count:u.a,isTextBased:!1},a);return{totalDocuments:g(i),sampledDocuments:l.sampledDocuments,sampledValues:l.sampledValues,topValues:{buckets:l.buckets,areExamples:!0}}}catch(e){return console.error(e),{}}}function m(e){return e.scripted?{script:{lang:e.lang,source:e.script}}:{field:e.name}}const g=e=>{var t,n;return null!==(t=null!==(n=e.hits.total.value)&&void 0!==n?n:e.hits.total)&&void 0!==t?t:0};function p(e,t){var n;return((null==e||null===(n=e.buckets)||void 0===n?void 0:n.reduce(((e,t)=>t.count+e),0))||0)+(t||0)}const f=async({services:e,dataView:t,field:n,fromDate:s,toDate:r,dslQuery:f,size:_,abortController:y})=>{const{data:v}=e;try{if(null==t||!t.id||null==n||!n.type)return{};const e=async e=>(await Object(a.lastValueFrom)(v.search.search({params:l({dataViewPattern:t.title,timeFieldName:t.timeFieldName,fromDate:s,toDate:r,dslQuery:f,runtimeMappings:t.getRuntimeMappings(),...e})},{abortSignal:null==y?void 0:y.signal}))).rawResponse;return await async function({searchHandler:e,dataView:t,field:n,fromDate:a,toDate:s,size:r}){return n.aggregatable?"geo_point"===n.type||"geo_shape"===n.type?await async function(e,t,n){try{const a=n.getFormatterForField(t);return await d(e,t,n,a)}catch(e){return console.error(e),{}}}(e,n,t):Object(i.a)(n,!1)?"histogram"===n.type?await c(e,n,!1):Object(i.c)(n,!1)?await async function(e,t){const n={sample:{sampler:{shard_size:u.d},aggs:{min_max_summary:{filter:{exists:{field:t.name}},aggs:{min:{min:{field:t.name}},max:{max:{field:t.name}}}}}}},a=await e({aggs:n}),s=a.aggregations.sample.min_max_summary.min.value,o=a.aggregations.sample.min_max_summary.max.value,r=a.aggregations.sample.doc_count;return{totalDocuments:g(a),sampledDocuments:r,sampledValues:r,numberSummary:{minValue:s,maxValue:o}}}(e,n):"number"===n.type?await c(e,n):"date"===n.type?await async function(e,t,n){const a=o.a.parse(n.fromDate),s=o.a.parse(n.toDate);if(!a)throw Error("Invalid fromDate value");if(!s)throw Error("Invalid toDate value");const r=Math.round((s.valueOf()-a.valueOf())/10);if(r<1)return{totalDocuments:0,histogram:{buckets:[]}};const i=`${r}ms`,u={histo:{date_histogram:{...m(t),fixed_interval:i}}},l=await e({aggs:u});return{totalDocuments:g(l),histogram:{buckets:l.aggregations.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))}}}(e,n,{fromDate:a,toDate:s}):await async function(e,t,n=u.b){const a=m(t),s={sample:{sampler:{shard_size:u.d},aggs:{sample_count:{value_count:{...a}},top_values:{terms:{...a,size:n,shard_size:n<=10?25:void 0}}}}},o=await e({aggs:s}),r={buckets:o.aggregations.sample.top_values.buckets.map((e=>({count:e.doc_count,key:e.key})))};return{totalDocuments:g(o),sampledDocuments:o.aggregations.sample.doc_count,sampledValues:p(r,o.aggregations.sample.top_values.sum_other_doc_count)||o.aggregations.sample.sample_count.value,topValues:r}}(e,n,r):{}:Object(i.b)(n,!1)?await d(e,n,t):{}}({searchHandler:e,dataView:t,field:n,fromDate:s,toDate:r,size:_})}catch(e){throw new Error("Could not provide field stats",{cause:e})}}},630:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l}));var a=n(44);const s=["_type","_source"];function o(e,t,n,s,r){for(const i in t){if(!t.hasOwnProperty(i))continue;const u=t[i],l=n+i,c=null==s?void 0:s.fields.getByName(l);if(!1===(null==r?void 0:r.shallow)){const t="nested"===(null==c?void 0:c.type);if(Array.isArray(u)&&!t){for(let t=0;t<u.length;t++){const n=u[t];Object(a.isPlainObject)(n)&&o(e,n,l+".",s,r)}continue}}else if(void 0!==e[l])continue;const d=c&&"conflict"!==c.type,m=!Object(a.isPlainObject)(u);d||m?e[l]?Array.isArray(e[l])?e[l].push(u):e[l]=[e[l],u]:e[l]=u:o(e,u,l+".",s,r)}}var r=n(122),i=n(123);function u(e,t){if(e=Object(a.defaults)(e,{count:i.a}),!Object(r.b)(e.field,e.isTextBased))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const n=e.values,{groups:s,sampledValues:o}=function(e,t){const n={};let s=0;return e.forEach((function(e){if(Object(a.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let o,r=0;const i={};o=Array.isArray(e)?e:null==e?[]:[e],o.forEach((e=>{const a=t?t.convert(e):e;i[a]||(n.hasOwnProperty(a)?n[a].count++:n[a]={key:a,count:1,order:r++},i[a]=!0,s++)}))})),{groups:n,sampledValues:s}}(n,t);return{buckets:Object(a.sortBy)(s,["count","order"]).reverse().slice(0,e.count).map((e=>Object(a.pick)(e,["key","count"]))),sampledValues:o,sampledDocuments:e.values.length}}function l(e,t,n){return null!=t&&t.name?Object(a.map)(e,(function(e){return function(e,t,n){const a={};if(o(a,e.fields||{},"",t,n),!1!==(null==n?void 0:n.source)&&e._source)o(a,e._source,"",t,n);else if(null!=n&&n.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!e.ignored_field_values.hasOwnProperty(t))continue;const n=e.ignored_field_values[t];a[t]?Array.isArray(a[t])?a[t]=[...a[t],...n]:a[t]=[a[t],...n]:a[t]=n}if(null!=t&&t.metaFields)for(let n=0;n<(null==t?void 0:t.metaFields.length);n++){const o=null==t?void 0:t.metaFields[n];s.includes(o)||"_"!==o.charAt(0)||(a[o]=e[o])}return function(e,t){function n(e,n){var a,s;const o=null==t||null===(a=t.metaFields)||void 0===a?void 0:a.includes(String(e)),r=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(n));return o&&r?String(e).localeCompare(String(n)):o?1:r?-1:String(e).localeCompare(String(n))}return new Proxy(e,{ownKeys:e=>Reflect.ownKeys(e).sort(n)})}(a,t)}(e,n,{includeIgnoredValues:!0})[t.name]})):[]}}}]);