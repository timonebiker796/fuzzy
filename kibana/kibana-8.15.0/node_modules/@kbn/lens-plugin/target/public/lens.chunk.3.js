/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[3],Array(96).concat([function(e,t,a){e.exports=a(25)(1784)},,function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return r}));const n="---",i="â€º";function s(e,t){return`${e}${n}${t}`}function l(e){if(e.includes(n)){const t=e.split(n);return t[t.length-1]}return e}function r(e,t,a){e.columns.filter((e=>e.isTransposed)).reverse().forEach((({columnId:n})=>{const l=t.columns.findIndex((e=>e.id===n)),r=t.columns[l],o=a[r.id],{uniqueValues:u,uniqueRawValues:c}=function(e,t,a){const n=new Map;e.rows.forEach((e=>{const i=e[a];n.set(t.convert(e[a]),i)}));return{uniqueValues:[...n.keys()],uniqueRawValues:[...n.values()]}}(t,o,n),d=e.columns.filter((e=>e.transposable)),p=e.columns.filter((e=>!e.transposable&&e.columnId!==n));t.columns.splice(l,1),function(e,t,a,n,l,r,o){!function(e,t,a){var n;e.columns=[...t],null===(n=a[0])||void 0===n||n.forEach(((t,n)=>{a.forEach((t=>{e.columns.push(t[n])}))}))}(e,t,a.map((e=>{const t=n.columns.find((t=>t.id===e.columnId)),a=l.map((a=>({...t,id:s(a,e.columnId),name:`${a} ${i} ${t.name}`})));return n.columns.splice(n.columns.findIndex((t=>t.id===e.columnId)),1,...a),l.map(((a,n)=>({...e,columnId:s(a,e.columnId),originalColumnId:e.originalColumnId||e.columnId,originalName:e.originalName||t.name,bucketValues:[...e.bucketValues||[],{originalBucketColumn:o,value:r[n]}]})))})))}(e,p,d,t,u,c,r),function(e,t,a,n,i,l){const r=function(e,t,a){const n={};return e.rows.forEach((e=>{const i=t.map((t=>a[t.columnId].convert(e[t.columnId]))).join(",");n[i]||(n[i]=[]),n[i].push(e)})),n}(e,t,a);e.rows=function(e,t,a,n,i){return Object.values(e).map((e=>{const l={};return t.forEach((t=>{l[t.columnId]=e[0][t.columnId]})),e.forEach((e=>{const t=a.convert(e[n]);i.forEach((a=>{l[s(t,a.columnId)]=e[a.columnId]}))})),l}))}(r,t,n,i,l)}(t,p,a,o,n,d)}))}},,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(98);function i(e,t){const a=null==e?void 0:e.columns.find((e=>e.id===t||Object(n.a)(e.id)===t));return"number"===(null==a?void 0:a.meta.type)}},function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"g",(function(){return r})),a.d(t,"e",(function(){return o})),a.d(t,"f",(function(){return u})),a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return m}));var n=a(45),i=a(0);const s=n.euiLightVars.euiColorAccent,l="#F04E981A",r=e=>Boolean(e&&"range"===(null==e?void 0:e.key.type)),o=e=>Boolean(e&&"timestamp"in(null==e?void 0:e.key)),u=e=>Boolean(e&&"query"===e.type),c=(e,t,a)=>a?{...a,id:e}:p(e,t),d=i.i18n.translate("eventAnnotationCommon.manualAnnotation.defaultAnnotationLabel",{defaultMessage:"Event"}),p=(e,t)=>({label:d,type:"manual",key:{type:"point_in_time",timestamp:t},icon:"triangle",id:e}),m=(e,t,a)=>({filter:{type:"kibana_query",query:`${t}: *`,language:"kuery"},timeField:a,type:"query",key:{type:"point_in_time"},id:e,label:`${t}: *`})},,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return s}));var n=a(1),i=a.n(n);let s=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),l=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class kbn_field_type_KbnFieldType{constructor(e={}){i()(this,"name",void 0),i()(this,"sortable",void 0),i()(this,"filterable",void 0),i()(this,"esTypes",void 0),this.name=e.name||l.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const r=new kbn_field_type_KbnFieldType({name:l.UNKNOWN}),o=[new kbn_field_type_KbnFieldType({name:l.STRING,sortable:!0,filterable:!0,esTypes:[s.STRING,s.TEXT,s.MATCH_ONLY_TEXT,s.KEYWORD,s.VERSION,s._TYPE,s._ID]}),new kbn_field_type_KbnFieldType({name:l.NUMBER,sortable:!0,filterable:!0,esTypes:[s.FLOAT,s.HALF_FLOAT,s.SCALED_FLOAT,s.DOUBLE,s.INTEGER,s.LONG,s.UNSIGNED_LONG,s.SHORT,s.BYTE,s.TOKEN_COUNT,s.AGGREGATE_METRIC_DOUBLE]}),new kbn_field_type_KbnFieldType({name:l.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[s.FLOAT_RANGE,s.DOUBLE_RANGE,s.INTEGER_RANGE,s.LONG_RANGE]}),new kbn_field_type_KbnFieldType({name:l.DATE,sortable:!0,filterable:!0,esTypes:[s.DATE,s.DATE_NANOS]}),new kbn_field_type_KbnFieldType({name:l.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[s.DATE_RANGE]}),new kbn_field_type_KbnFieldType({name:l.IP,sortable:!0,filterable:!0,esTypes:[s.IP]}),new kbn_field_type_KbnFieldType({name:l.IP_RANGE,sortable:!0,filterable:!0,esTypes:[s.IP_RANGE]}),new kbn_field_type_KbnFieldType({name:l.BOOLEAN,sortable:!0,filterable:!0,esTypes:[s.BOOLEAN]}),new kbn_field_type_KbnFieldType({name:l.OBJECT,esTypes:[s.OBJECT]}),new kbn_field_type_KbnFieldType({name:l.NESTED,esTypes:[s.NESTED]}),new kbn_field_type_KbnFieldType({name:l.GEO_POINT,esTypes:[s.GEO_POINT]}),new kbn_field_type_KbnFieldType({name:l.GEO_SHAPE,esTypes:[s.GEO_SHAPE]}),new kbn_field_type_KbnFieldType({name:l.ATTACHMENT,esTypes:[s.ATTACHMENT]}),new kbn_field_type_KbnFieldType({name:l.MURMUR3,esTypes:[s.MURMUR3]}),new kbn_field_type_KbnFieldType({name:l._SOURCE,esTypes:[s._SOURCE]}),new kbn_field_type_KbnFieldType({name:l.HISTOGRAM,filterable:!0,esTypes:[s.HISTOGRAM]}),new kbn_field_type_KbnFieldType({name:l.CONFLICT}),r],u=e=>{const t=o.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:l.UNKNOWN};function c(e){switch(e){case s._INDEX:return l.STRING;case"_version":return l.NUMBER;case"datetime":return l.DATE;default:return u(e)}}},,,,,,function(e,t,a){e.exports=a(25)(455)},function(e,t){(function(t){e.exports=t}).call(this,{})},,,,,,,,function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return u}));var n=a(0),i=a(98),s=a(100);function l(e,t,a){var n;const i=Object(s.a)(a,e)&&(null==t?void 0:t.summaryRow)||"none";return{summaryRow:i,summaryLabel:null!==(n=null==t?void 0:t.summaryLabel)&&void 0!==n?n:r(i)}}function r(e){return o().find((({value:t})=>e===t)).label}function o(){return[{value:"none",label:n.i18n.translate("xpack.lens.table.summaryRow.none",{defaultMessage:"None"}),"data-test-subj":"lns-datatable-summary-none"},{value:"count",label:n.i18n.translate("xpack.lens.table.summaryRow.count",{defaultMessage:"Value count"}),"data-test-subj":"lns-datatable-summary-count"},{value:"sum",label:n.i18n.translate("xpack.lens.table.summaryRow.sum",{defaultMessage:"Sum"}),"data-test-subj":"lns-datatable-summary-sum"},{value:"avg",label:n.i18n.translate("xpack.lens.table.summaryRow.average",{defaultMessage:"Average"}),"data-test-subj":"lns-datatable-summary-avg"},{value:"min",label:n.i18n.translate("xpack.lens.table.summaryRow.minimum",{defaultMessage:"Minimum"}),"data-test-subj":"lns-datatable-summary-min"},{value:"max",label:n.i18n.translate("xpack.lens.table.summaryRow.maximum",{defaultMessage:"Maximum"}),"data-test-subj":"lns-datatable-summary-max"}]}function u(e,t,a,n){const s=function(e,t,a){const n=a.filter((e=>null!=e[t])).flatMap((e=>e[t])),i=n.length,s=n.reduce(((e,t)=>e+t),0);switch(e){case"sum":return s;case"count":return i;case"avg":return s/i;case"min":return Math.min(...n);case"max":return Math.max(...n);default:throw Error("No summary function found")}}(e.summaryRow,e.columnId,t.rows);return"count"===e.summaryRow?n.convert(s):a[Object(i.a)(e.columnId)].convert(s)}},,,,,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return s}));let n=function(e){return e.DOCUMENT="document",e.BINARY="binary",e.BOOLEAN="boolean",e.CONFLICT="conflict",e.COUNTER="counter",e.DATE="date",e.DATE_RANGE="date_range",e.DENSE_VECTOR="dense_vector",e.GAUGE="gauge",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.HISTOGRAM="histogram",e.IP="ip",e.IP_RANGE="ip_range",e.FLATTENED="flattened",e.KEYWORD="keyword",e.MURMUR3="murmur3",e.NUMBER="number",e.NESTED="nested",e.RANK_FEATURE="rank_feature",e.RANK_FEATURES="rank_features",e.POINT="point",e.SHAPE="shape",e.SPARSE_VECTOR="sparse_vector",e.SEMANTIC_TEXT="semantic_text",e.STRING="string",e.TEXT="text",e.VERSION="version",e}({});const i=Object.values(n),s=e=>!!e&&i.includes(e)},,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(0),i=a(15),s=a.n(i),l=(a(3),a(4));const r=[{value:"asterisk",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"circle",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.circleIconLabel",{defaultMessage:"Circle"}),icon:({title:e,titleId:t,...a})=>Object(l.jsx)("svg",s()({width:16,height:16,viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M7.427.522c-.813.081-1.398.21-2.039.45a7.318 7.318 0 0 0-2.67 1.72A7.045 7.045 0 0 0 1.28 4.68 7.241 7.241 0 0 0 .507 8c0 1.196.243 2.24.773 3.32a7.047 7.047 0 0 0 1.425 1.975A7.047 7.047 0 0 0 4.68 14.72a7.254 7.254 0 0 0 3.32.773 7.254 7.254 0 0 0 3.32-.773 7.047 7.047 0 0 0 1.975-1.425 7.047 7.047 0 0 0 1.425-1.975A7.254 7.254 0 0 0 15.493 8a7.254 7.254 0 0 0-.773-3.32 7.045 7.045 0 0 0-1.438-1.988C12.111 1.524 10.695.818 9.027.571 8.773.533 7.659.499 7.427.522m1.426 1.041a6.519 6.519 0 0 1 3.091 1.271c.329.246.976.893 1.222 1.222.561.751.976 1.634 1.164 2.479a6.766 6.766 0 0 1 0 2.93c-.414 1.861-1.725 3.513-3.463 4.363a6.76 6.76 0 0 1-1.987.616c-.424.065-1.336.065-1.76 0-1.948-.296-3.592-1.359-4.627-2.993a7.502 7.502 0 0 1-.634-1.332A6.158 6.158 0 0 1 1.514 8c0-1.039.201-1.925.646-2.84.34-.698.686-1.18 1.253-1.747A5.956 5.956 0 0 1 5.16 2.16a6.452 6.452 0 0 1 3.693-.597"}))},{value:"editorComment",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pinFilled",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"starFilled",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.starFilledLabel",{defaultMessage:"Star filled"})},{value:"tag",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})},{value:"triangle",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.triangleIconLabel",{defaultMessage:"Triangle"}),icon:({title:e,titleId:t,...a})=>Object(l.jsx)("svg",s()({width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M3.373 3.079c-.391.062-.637.158-.88.342-.545.415-.577 1.146-.087 1.979.174.296 3.984 6.347 4.164 6.613.32.474.755.838 1.117.937a1.7 1.7 0 0 0 .596.021c.138-.032.341-.126.49-.226.202-.135.523-.478.713-.762.378-.563 4.084-6.475 4.211-6.716.385-.733.368-1.339-.051-1.757-.168-.168-.437-.307-.767-.395l-.226-.06L8.12 3.05c-3.567-.004-4.579.002-4.747.029m9.267 1.004c.208.058.317.121.335.194.022.086-.029.259-.141.482-.129.258-4.174 6.679-4.327 6.87-.264.328-.441.419-.63.323-.116-.059-.33-.275-.454-.459-.276-.405-4.148-6.585-4.234-6.758a.93.93 0 0 1-.117-.364l-.011-.153.103-.053c.094-.048.288-.095.503-.121.044-.006 2.048-.008 4.453-.006 3.853.003 4.391.009 4.52.045"})),shouldRotate:!0}]},function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return f}));var n=a(3),i=a(6),s=a(2),l=a(661),r=a(179),o=a(168);const u=Object(i.htmlIdGenerator)(),c=[],d={fetchStatus:o.a.unknown,existingFieldsByFieldNameMap:{},numberOfFetches:0},p=new s.BehaviorSubject({});let m="";const g=e=>{const t=Object(n.useRef)(!0),[i,s]=Object(n.useState)(0),c=i>0,g=Object(n.useCallback)((async({dataViewId:e,query:n,filters:i,fromDate:r,toDate:u,services:{dataViews:c,data:g,core:f},onNoData:h,fetchId:v})=>{var y,x,j,O,I;if(!(e&&n&&r&&u))return;const M=null===(y=p.getValue())||void 0===y?void 0:y[e];if(!t.current)return;const T=(null!==(x=null==M?void 0:M.numberOfFetches)&&void 0!==x?x:0)+1;let w=null;try{w=await c.get(e,!1)}catch(e){}if(null===(j=w)||void 0===j||!j.title)return;s((e=>e+1));const k=Boolean(null===(O=(I=w).getAggregationRestrictions)||void 0===O?void 0:O.call(I)),E={...d,numberOfFetches:T};if(k)E.fetchStatus=o.a.succeeded,E.hasDataViewRestrictions=!0;else try{const t=await(async e=>{const{loadFieldExisting:t}=await a.e(20).then(a.bind(null,692));return await t(e)})({dslQuery:await b(w,n,i||[],Object(l.a)(f.uiSettings)),fromDate:r,toDate:u,timeFieldName:w.timeFieldName,data:g,uiSettingsClient:f.uiSettings,dataViewsService:c,dataView:w}),s=(null==t?void 0:t.existingFieldNames)||[];h&&1===T&&!s.filter((e=>{var t,a;return!(null!==(t=w)&&void 0!==t&&null!==(a=t.metaFields)&&void 0!==a&&a.includes(e))})).length&&h(e),E.existingFieldsByFieldNameMap=s.reduce(((e,t)=>(e[t]=!0,e)),{}),E.newFields=t.newFields,E.fetchStatus=o.a.succeeded}catch(e){E.fetchStatus=o.a.failed}t.current&&v===m&&p.next({...p.getValue(),[e]:E}),s((e=>e-1))}),[t,s]),f=e.dataViews.map((e=>{var t,a;return`${e.id}:${e.title}:${e.timeFieldName||"no-timefield"}:${null!==(t=null===(a=e.fields)||void 0===a?void 0:a.length)&&void 0!==t?t:0}`})).join(","),h=Object(n.useCallback)((async t=>{const a=window.performance.now(),n="fetchFieldsExistenceInfo",i=u();m=i;const s={fetchId:i,dataViewId:t,...e};if(t)return await g({...s,dataViewId:t}),void Object(r.a)(e.services.core.analytics,{eventName:n,duration:window.performance.now()-a,meta:{dataViewsCount:1}});await Promise.all(e.dataViews.map((e=>g({...s,dataViewId:e.id})))),Object(r.a)(e.services.core.analytics,{eventName:n,duration:window.performance.now()-a,meta:{dataViewsCount:e.dataViews.length}})}),[g,f,e.query,e.filters,e.fromDate,e.toDate,e.services.core]);return Object(n.useEffect)((()=>{e.disableAutoFetching||h()}),[h,e.disableAutoFetching]),Object(n.useEffect)((()=>()=>{t.current=!1,p.next({})}),[t]),Object(n.useMemo)((()=>({refetchFieldsExistenceInfo:h,isProcessing:c})),[h,c])},f=()=>{const e=Object(n.useRef)(!0),[t,a]=Object(n.useState)(p.getValue());Object(n.useEffect)((()=>{const t=p.subscribe((t=>{e.current&&Object.keys(t).length>0&&a((e=>({...e,...t})))}));return()=>{t.unsubscribe()}}),[a,e]);const i=Object(n.useCallback)(((e,a)=>{const n=t[e];return(null==n?void 0:n.fetchStatus)!==o.a.succeeded||(null==n?void 0:n.hasDataViewRestrictions)||Boolean(null==n?void 0:n.existingFieldsByFieldNameMap[a])}),[t]),s=Object(n.useCallback)((e=>{const a=t[e];var n;return(null==a?void 0:a.fetchStatus)===o.a.succeeded&&null!==(n=null==a?void 0:a.newFields)&&void 0!==n?n:c}),[t]),l=Object(n.useCallback)((e=>e?t[e]:d),[t]),r=Object(n.useCallback)((e=>{var t;return(null===(t=l(e))||void 0===t?void 0:t.fetchStatus)||o.a.unknown}),[l]),u=Object(n.useCallback)((e=>{const t=l(e);return Boolean((null==t?void 0:t.fetchStatus)===o.a.failed||(null==t?void 0:t.hasDataViewRestrictions))}),[l]);return Object(n.useEffect)((()=>()=>{e.current=!1}),[e]),Object(n.useMemo)((()=>({hasFieldData:i,getFieldsExistenceStatus:r,isFieldsExistenceInfoUnavailable:u,getNewFields:s})),[i,r,u,s])};async function b(e,t,n,i){const s=await(async()=>(await Promise.resolve().then(a.t.bind(null,38,7))).buildEsQuery)();try{return s(e,t,n,i)}catch(e){return{bool:{must_not:{match_all:{}}}}}}},,,,,,,,,,function(e,t,a){e.exports=a(25)(675)},,,,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");return Array.isArray(e)?e.map((e=>Math.pow(e,t))):Math.pow(e,t)}}},function(e,t){e.exports={eq:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e===t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e===t[a]))}return e===t}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));let n=function(e){return e.failed="failed",e.succeeded="succeeded",e.unknown="unknown",e}({}),i=function(e){return e.SpecialFields="SpecialFields",e.SelectedFields="SelectedFields",e.PopularFields="PopularFields",e.AvailableFields="AvailableFields",e.EmptyFields="EmptyFields",e.MetaFields="MetaFields",e.UnmappedFields="UnmappedFields",e.SmartFields="SmartFields",e}({})},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(55);const i={number:{formatId:"number",decimalsToPattern:(e=2,t)=>0===e?"0,0"+(t?"a":""):`0,0.${"0".repeat(e)}${t?"a":""}`},percent:{formatId:"percent",decimalsToPattern:(e=2,t)=>0===e?`0,0${t?"a":""}%`:`0,0.${"0".repeat(e)}${t?"a":""}%`},bytes:{formatId:"bytes",decimalsToPattern:(e=2,t)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`},bits:{formatId:"bytes",decimalsToPattern:(e=2,t)=>0===e?"0,0bitd":`0,0.${"0".repeat(e)}bitd`},duration:{formatId:"duration",decimalsToPattern:()=>"",translateToFormatParams:e=>({inputFormat:e.fromUnit||n.DEFAULT_DURATION_INPUT_FORMAT.kind,outputFormat:e.toUnit||n.DEFAULT_DURATION_OUTPUT_FORMAT.method,outputPrecision:e.decimals,useShortSuffix:Boolean(e.compact),showSuffix:!0,includeSpaceWithSuffix:!0})},custom:{formatId:"custom",decimalsToPattern:()=>""}}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(489);case"v8light":return a(491)}},,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n="cellAction-filter"},function(e,t,a){(function(t){const a="object"==typeof t&&Object({IS_KIBANA_DISTRIBUTABLE:"true"})&&Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG&&/\bsemver\b/i.test(Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=a}).call(this,a(158))},function(e,t){const a=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:a,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),i=a(191),s=n.__importDefault(a(192));t.default=function(e,t){s.default(e,t,i.isDeepEqual)}},,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(297);case"v8light":return a(299)}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(307);case"v8light":return a(309)}},,,,,,,,,function(e,t,a){const{get:n}=a(44),i=a(102),{functions:s}=a(394),{parse:l}=a(431),r=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return l(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,a){const i=Object.assign({},s,a);return function e(a){if("number"==typeof a)return a;if("function"===a.type)return function(t){const{name:a,args:n}=t,s=i[a];if(!s)throw new Error(`No such function: ${a}`);const l=n.map(e);return s.skipNumberValidation||u(l)?s(...l):NaN}(a);if("variable"===a.type){const e=function(e,t){const a=n(e,t);return void 0!==a?a:e[t]}(t,a.value);if(void 0===e)throw new Error(`Unknown variable: ${a.value}`);return e}if("namedArgument"===a.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${a.name}`)}(e)}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:r,evaluate:function(e,t={},a={}){return t=t||{},o(r(e),t,a)},interpret:o}},function(e,t){e.exports={add:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e+t[a]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function a(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}a.skipNumberValidation=!0,e.exports={size:a}},function(e,t){const a=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return a(e,t)}));if(e<0)throw new Error("Must be greater than 0");return a(e,t)}}},function(e,t){e.exports={max:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.max(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const a=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==a)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.min(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e-t[a]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},function(e,t){e.exports={lt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e<t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e<t[a]))}return e<t}}},function(e,t){e.exports={gt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e>t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e>t[a]))}return e>t}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={META_FIELDS:"metaFields",DOC_HIGHLIGHT:"doc_table:highlight",QUERY_STRING_OPTIONS:"query:queryString:options",QUERY_ALLOW_LEADING_WILDCARDS:"query:allowLeadingWildcards",SEARCH_QUERY_LANGUAGE:"search:queryLanguage",SORT_OPTIONS:"sort:options",COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX:"courier:ignoreFilterIfFieldNotInIndex",COURIER_SET_REQUEST_PREFERENCE:"courier:setRequestPreference",COURIER_CUSTOM_REQUEST_PREFERENCE:"courier:customRequestPreference",COURIER_MAX_CONCURRENT_SHARD_REQUESTS:"courier:maxConcurrentShardRequests",SEARCH_INCLUDE_FROZEN:"search:includeFrozen",SEARCH_TIMEOUT:"search:timeout",HISTOGRAM_BAR_TARGET:"histogram:barTarget",HISTOGRAM_MAX_BARS:"histogram:maxBars",HISTORY_LIMIT:"history:limit",TIMEPICKER_REFRESH_INTERVAL_DEFAULTS:"timepicker:refreshIntervalDefaults",TIMEPICKER_QUICK_RANGES:"timepicker:quickRanges",TIMEPICKER_TIME_DEFAULTS:"timepicker:timeDefaults",FILTERS_PINNED_BY_DEFAULT:"filters:pinnedByDefault",FILTERS_EDITOR_SUGGEST_VALUES:"filterEditor:suggestValues",AUTOCOMPLETE_USE_TIMERANGE:"autocomplete:useTimeRange",AUTOCOMPLETE_VALUE_SUGGESTION_METHOD:"autocomplete:valueSuggestionMethod",DATE_FORMAT:"dateFormat",DATEFORMAT_TZ:"dateFormat:tz"}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=async e=>{const{loadFieldStats:t}=await a.e(11).then(a.bind(null,627));return await t(e)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(628);function i(e){return{type:Object(n.a)(e),scripted:e.scripted}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(251);case"v8light":return a(253)}},function(e,t,a){var n=a(81),i=a(252);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(254);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(256);case"v8light":return a(258)}},function(e,t,a){var n=a(81),i=a(257);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.embPanel__content:hover .lnsEmbeddablePanelFeatureList_button{background:#1d1e24;color:#dfe5ef;transition:color .35s,background .35s}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(259);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.embPanel__content:hover .lnsEmbeddablePanelFeatureList_button{background:#fff;color:#343741;transition:color .35s,background .35s}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,function(e,t,a){var n,i;void 0===(i="function"==typeof(n=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function t(e){var t,a,n=e.replace(/^v/,"").replace(/\+.*$/,""),i=(a="-",-1===(t=n).indexOf(a)?t.length:t.indexOf(a)),s=n.substring(0,i).split(".");return s.push(n.substring(i+1)),s}function a(e){return isNaN(Number(e))?e:Number(e)}function n(t){if("string"!=typeof t)throw new TypeError("Invalid argument expected string");if(!e.test(t))throw new Error("Invalid argument not valid semver ('"+t+"' received)")}function i(e,i){[e,i].forEach(n);for(var s=t(e),l=t(i),r=0;r<Math.max(s.length-1,l.length-1);r++){var o=parseInt(s[r]||0,10),u=parseInt(l[r]||0,10);if(o>u)return 1;if(u>o)return-1}var c=s[s.length-1],d=l[l.length-1];if(c&&d){var p=c.split(".").map(a),m=d.split(".").map(a);for(r=0;r<Math.max(p.length,m.length);r++){if(void 0===p[r]||"string"==typeof m[r]&&"number"==typeof p[r])return-1;if(void 0===m[r]||"string"==typeof p[r]&&"number"==typeof m[r])return 1;if(p[r]>m[r])return 1;if(m[r]>p[r])return-1}}else if(c||d)return c?-1:1;return 0}var s=[">",">=","=","<","<="],l={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.compare=function(e,t,a){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===s.indexOf(e))throw new TypeError("Invalid operator, expected one of "+s.join("|"))}(a);var n=i(e,t);return l[a].indexOf(n)>-1},i})?n.apply(t,[]):n)||(e.exports=i)},function(e,t,a){const n=a(280);e.exports=(e,t)=>{const a=n(e,t);return a?a.version:null}},function(e,t,a){const n=a(281);e.exports=(e,t,a=!1)=>{if(e instanceof n)return e;try{return new n(e,t)}catch(e){if(!a)return null;throw e}}},function(e,t,a){const n=a(188),{MAX_LENGTH:i,MAX_SAFE_INTEGER:s}=a(189),{safeRe:l,t:r}=a(282),o=a(283),{compareIdentifiers:u}=a(284);class SemVer{constructor(e,t){if(t=o(t),e instanceof SemVer){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw new TypeError(`version is longer than ${i} characters`);n("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const a=e.trim().match(t.loose?l[r.LOOSE]:l[r.FULL]);if(!a)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+a[1],this.minor=+a[2],this.patch=+a[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");a[4]?this.prerelease=a[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s)return t}return e})):this.prerelease=[],this.build=a[5]?a[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(n("SemVer.compare",this.version,this.options,e),!(e instanceof SemVer)){if("string"==typeof e&&e===this.version)return 0;e=new SemVer(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof SemVer||(e=new SemVer(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof SemVer||(e=new SemVer(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const a=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,a,i),void 0===a&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===a)return-1;if(a!==i)return u(a,i)}while(++t)}compareBuild(e){e instanceof SemVer||(e=new SemVer(e,this.options));let t=0;do{const a=this.build[t],i=e.build[t];if(n("build compare",t,a,i),void 0===a&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===a)return-1;if(a!==i)return u(a,i)}while(++t)}inc(e,t,a){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,a);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,a);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,a),this.inc("pre",t,a);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,a),this.inc("pre",t,a);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(a)?1:0;if(!t&&!1===a)throw new Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let n=this.prerelease.length;for(;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);if(-1===n){if(t===this.prerelease.join(".")&&!1===a)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let n=[t,e];!1===a&&(n=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=n):this.prerelease=n}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=SemVer},function(e,t,a){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:s}=a(189),l=a(188),r=(t=e.exports={}).re=[],o=t.safeRe=[],u=t.src=[],c=t.t={};let d=0;const p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[p,i]],g=(e,t,a)=>{const n=(e=>{for(const[t,a]of m)e=e.split(`${t}*`).join(`${t}{0,${a}}`).split(`${t}+`).join(`${t}{1,${a}}`);return e})(t),i=d++;l(e,i,t),c[e]=i,u[i]=t,r[i]=new RegExp(t,a?"g":void 0),o[i]=new RegExp(n,a?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),g("FULL",`^${u[c.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),g("LOOSE",`^${u[c.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),g("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),g("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",u[c.COERCE],!0),g("COERCERTLFULL",u[c.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},function(e,t){const a=Object.freeze({loose:!0}),n=Object.freeze({});e.exports=e=>e?"object"!=typeof e?a:e:n},function(e,t){const a=/^[0-9]+$/,n=(e,t)=>{const n=a.test(e),i=a.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1};e.exports={compareIdentifiers:n,rcompareIdentifiers:(e,t)=>n(t,e)}},function(e,t,a){!function(t){"use strict";const a="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${a}\\.${a}\\.${a}\\.${a}$`,"i"),threeOctet:new RegExp(`^${a}\\.${a}\\.${a}$`,"i"),twoOctet:new RegExp(`^${a}\\.${a}$`,"i"),longValue:new RegExp(`^${a}$`,"i")},i=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),l="%[0-9a-z]{1,}",r="(?:[0-9a-f]+::?)+",o={zoneIndex:new RegExp(l,"i"),native:new RegExp(`^(::)?(${r})?([0-9a-f]+)?(::)?(${l})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${a}\\.${a}\\.${a}\\.${a}(${l})?)$`,"i"),transitional:new RegExp(`^((?:${r})|(?:::)(?:${r})?)${a}\\.${a}\\.${a}\\.${a}(${l})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let a,n,i=0,s=-1,l=(e.match(o.zoneIndex)||[])[0];for(l&&(l=l.substring(1),e=e.replace(/%.+$/,""));(s=e.indexOf(":",s+1))>=0;)i++;if("::"===e.substr(0,2)&&i--,"::"===e.substr(-2,2)&&i--,i>t)return null;for(n=t-i,a=":";n--;)a+="0:";return":"===(e=e.replace("::",a))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),a=[];for(let e=0;e<t.length;e++)a.push(parseInt(t[e],16));return a}(),zoneId:l}}function c(e,t,a,n){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,s=0;for(;n>0;){if(i=a-n,i<0&&(i=0),e[s]>>i!=t[s]>>i)return!1;n-=a,s+=1}return!0}function d(e){if(s.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(i.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function p(e,t){for(;e.length<t;)e=`0${e}`;return e}const m={};m.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,a;for(t=0;t<e.length;t++)if(a=e[t],!(0<=a&&a<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return c(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,i,s;for(n=3;n>=0;n-=1){if(i=this.octets[n],!(i in a))return null;if(s=a[i],t&&0!==s)return null;8!==s&&(t=!0),e+=s}return 32-e},e.prototype.range=function(){return m.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return m.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),m.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),a=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<4;)i.push(parseInt(a[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},m.IPv4.isIPv4=function(e){return null!==this.parser(e)},m.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},m.IPv4.isValidFourPartDecimal=function(e){return!(!m.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},m.IPv4.networkAddressFromCIDR=function(e){let t,a,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],a=0;a<4;)i.push(parseInt(n[a],10)&parseInt(s[a],10)),a++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},m.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},m.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const a=[this.parse(t[1]),e];return Object.defineProperty(a,"toString",{value:function(){return this.join("/")}}),a}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},m.IPv4.parser=function(e){let t,a,i;if(t=e.match(n.fourOctet))return function(){const e=t.slice(1,6),n=[];for(let t=0;t<e.length;t++)a=e[t],n.push(d(a));return n}();if(t=e.match(n.longValue)){if(i=d(t[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(i>>t&255);return e}().reverse()}return(t=e.match(n.twoOctet))?function(){const e=t.slice(1,4),a=[];if(i=d(e[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(i>>16&255),a.push(i>>8&255),a.push(255&i),a}():(t=e.match(n.threeOctet))?function(){const e=t.slice(1,5),a=[];if(i=d(e[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return a.push(d(e[0])),a.push(d(e[1])),a.push(i>>8&255),a.push(255&i),a}():null},m.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let a=0;const n=Math.floor(e/8);for(;a<n;)t[a]=255,a++;return n<4&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},m.IPv6=function(){function e(e,t){let a,n;if(16===e.length)for(this.parts=[],a=0;a<=14;a+=2)this.parts.push(e[a]<<8|e[a+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(a=0;a<this.parts.length;a++)if(n=this.parts[a],!(0<=n&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return c(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,i;for(let s=7;s>=0;s-=1){if(n=this.parts[s],!(n in a))return null;if(i=a[n],t&&0!==i)return null;16!==i&&(t=!0),e+=i}return 128-e},e.prototype.range=function(){return m.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],a=this.parts;for(let n=0;n<a.length;n++)e=a[n],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(p(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],a=e[1];return new m.IPv4([t>>8,255&t,a>>8,255&a])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let a,n=0,i=-1;for(;a=e.exec(t);)a[0].length>i&&(n=a.index,i=a[0].length);return i<0?t:`${t.substring(0,n)}::${t.substring(n+i)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),m.IPv6.isIPv6=function(e){return null!==this.parser(e)},m.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},m.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},m.IPv6.parseCIDR=function(e){let t,a,n;if((a=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(a[2]),t>=0&&t<=128))return n=[this.parse(a[1]),t],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},m.IPv6.parser=function(e){let t,a,n,i,s,l;if(n=e.match(o.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(o.native.test(e))return u(e,8);if((n=e.match(o.transitional))&&(l=n[6]||"",t=u(n[1].slice(0,-1)+l,6),t.parts)){for(s=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],a=0;a<s.length;a++)if(i=s[a],!(0<=i&&i<=255))return null;return t.parts.push(s[0]<<8|s[1]),t.parts.push(s[2]<<8|s[3]),{parts:t.parts,zoneId:t.zoneId}}return null},m.fromByteArray=function(e){const t=e.length;if(4===t)return new m.IPv4(e);if(16===t)return new m.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},m.isValid=function(e){return m.IPv6.isValid(e)||m.IPv4.isValid(e)},m.parse=function(e){if(m.IPv6.isValid(e))return m.IPv6.parse(e);if(m.IPv4.isValid(e))return m.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},m.parseCIDR=function(e){try{return m.IPv6.parseCIDR(e)}catch(t){try{return m.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},m.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},m.subnetMatch=function(e,t,a){let n,i,s,l;for(i in null==a&&(a="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,i))for(s=t[i],!s[0]||s[0]instanceof Array||(s=[s]),n=0;n<s.length;n++)if(l=s[n],e.kind()===l[0].kind()&&e.match.apply(e,l))return i;return a},e.exports?e.exports=m:t.ipaddr=m}(this)},,,,,,,,,,,,function(e,t,a){var n=a(81),i=a(298);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(300);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(302);case"v8light":return a(304)}},function(e,t,a){var n=a(81),i=a(303);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(305);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(15),i=a.n(n),s=(a(3),a(6)),l=a(183),r=a(4);const o=({onChange:e,value:t,defaultValue:a,allowFalsyValue:n,...o})=>{const{inputValue:u,handleInputChange:c,initialValue:d}=Object(l.a)({onChange:e,value:t,defaultValue:a},{allowFalsyValue:n});return Object(r.jsx)(s.EuiFieldText,i()({},o,{value:u,onChange:e=>{c(e.target.value)},placeholder:d}))},u=e=>Object(r.jsx)(o,i()({},e,{key:e.defaultValue}))},function(e,t,a){var n=a(81),i=a(308);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(310);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(312);case"v8light":return a(314)}},function(e,t,a){var n=a(81),i=a(313);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(315);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(323);case"v8light":return a(325)}},function(e,t,a){var n=a(81),i=a(324);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(326);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(328);case"v8light":return a(330)}},function(e,t,a){var n=a(81),i=a(329);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(331);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(333);case"v8light":return a(335)}},function(e,t,a){var n=a(81),i=a(334);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(336);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(338);case"v8light":return a(340)}},function(e,t,a){var n=a(81),i=a(339);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(341);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){const{abs:n}=a(395),{add:i}=a(206),{cbrt:s}=a(396),{ceil:l}=a(397),{clamp:r}=a(398),{cos:o}=a(399),{count:u}=a(400),{cube:c}=a(401),{defaults:d}=a(402),{degtorad:p}=a(403),{divide:m}=a(404),{exp:g}=a(405),{first:f}=a(406),{fix:b}=a(407),{floor:h}=a(408),{last:v}=a(409),{log:y}=a(208),{log10:x}=a(410),{max:j}=a(209),{mean:O}=a(411),{median:I}=a(412),{min:M}=a(211),{mod:T}=a(413),{mode:w}=a(414),{multiply:k}=a(415),{pi:E}=a(416),{pow:C}=a(166),{radtodeg:F}=a(417),{random:S}=a(418),{range:A}=a(419),{round:P}=a(420),{sin:_}=a(421),{size:L}=a(207),{sqrt:D}=a(422),{square:R}=a(423),{subtract:N}=a(212),{sum:B}=a(424),{tan:z}=a(425),{unique:V}=a(426),{eq:G,lt:q,gt:$,lte:H,gte:U,ifelse:W}=a(427);e.exports={functions:{abs:n,add:i,cbrt:s,ceil:l,clamp:r,cos:o,count:u,cube:c,degtorad:p,defaults:d,divide:m,exp:g,first:f,fix:b,floor:h,ifelse:W,last:v,log:y,log10:x,max:j,mean:O,median:I,min:M,mod:T,mode:w,multiply:k,pi:E,pow:C,radtodeg:F,random:S,range:A,round:P,sin:_,size:L,sqrt:D,square:R,subtract:N,sum:B,tan:z,unique:V,eq:G,lt:q,gt:$,lte:H,gte:U}}},function(e,t){e.exports={abs:function(e){return Array.isArray(e)?e.map((e=>Math.abs(e))):Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){return Array.isArray(e)?e.map((e=>Math.cbrt(e))):Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){return Array.isArray(e)?e.map((e=>Math.ceil(e))):Math.ceil(e)}}},function(e,t){const a=(e,t,a)=>{if(t>a)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),a)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t[i],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e,t[i],n)))}return n.map((n=>a(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>a(e,t[n])))}return Array.isArray(e)?e.map((e=>a(e,t,n))):Array.isArray(t)?t.map((t=>a(e,t,n))):a(e,t,n)}}},function(e,t){e.exports={cos:function(e){return Array.isArray(e)?e.map((e=>Math.cos(e))):Math.cos(e)}}},function(e,t,a){const{size:n}=a(207);function i(e){return n(e)}i.skipNumberValidation=!0,e.exports={count:i}},function(e,t,a){const{pow:n}=a(166);e.exports={cube:function(e){return n(e,3)}}},function(e,t){function a(e,t){return Array.isArray(e)?e.map((e=>null==e?t:e)):null==e?t:e}e.exports={defaults:a},a.skipNumberValidation=!0},function(e,t){e.exports={degtorad:function(e){return Array.isArray(e)?e.map((e=>e*Math.PI/180)):e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e/t[a]}))}if(Array.isArray(t))return t.map((t=>{if(0===t)throw new Error("Cannot divide by 0");return e/t}));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){return Array.isArray(e)?e.map((e=>Math.exp(e))):Math.exp(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[0]:e}a.skipNumberValidation=!0,e.exports={first:a}},function(e,t){const a=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){return Array.isArray(e)?e.map((e=>a(e))):a(e)}}},function(e,t){e.exports={floor:function(e){return Array.isArray(e)?e.map((e=>Math.floor(e))):Math.floor(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[e.length-1]:e}a.skipNumberValidation=!0,e.exports={last:a}},function(e,t,a){const{log:n}=a(208);e.exports={log10:function(e){return n(e,10)}}},function(e,t,a){const{add:n}=a(206);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);return Array.isArray(t)?t.map((t=>t/e.length)):t/e.length}}},function(e,t,a){const{transpose:n}=a(210),i=e=>{const t=e.length,a=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[a]+e[a-1])/2:e[a]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e%t[a]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,a){const{transpose:n}=a(210),i=e=>{let t=0;const a={};return e.map((e=>{void 0===a[e]&&(a[e]=0),a[e]+=1,a[e]>t&&(t=a[e])})),Object.keys(a).filter((e=>a[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e*t[a]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){return Array.isArray(e)?e.map((e=>180*e/Math.PI)):180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,a){const{max:n}=a(209),{min:i}=a(211),{subtract:s}=a(212);e.exports={range:function(...e){return s(n(...e),i(...e))}}},function(e,t){const a=(e,t=0)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t){return Array.isArray(e)?e.map((e=>a(e,t))):a(e,t)}}},function(e,t){e.exports={sin:function(e){return Array.isArray(e)?e.map((e=>Math.sin(e))):Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,a){const{pow:n}=a(166);e.exports={square:function(e){return n(e,2)}}},function(e,t){const a=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(a,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){return Array.isArray(e)?e.map((e=>Math.tan(e))):Math.tan(e)}}},function(e,t){function a(e){return Array.isArray(e)?e.filter(((t,a)=>e.indexOf(t)===a)).length:1}a.skipNumberValidation=!0,e.exports={unique:a}},function(e,t,a){const{eq:n}=a(167),{lt:i}=a(213),{gt:s}=a(214),{lte:l}=a(428),{gte:r}=a(429),{ifelse:o}=a(430);e.exports={eq:n,lt:i,gt:s,lte:l,gte:r,ifelse:o}},function(e,t,a){const{eq:n}=a(167),{lt:i}=a(213);e.exports={lte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t,a){const{eq:n}=a(167),{gt:i}=a(214);e.exports={gte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t){function a(e,t,a){if("boolean"!=typeof e)throw Error("Condition clause is of the wrong type");if(null==t)throw new Error("Missing a value");if(null==a)throw new Error("Missing b value");return e?t:a}a.skipNumberValidation=!0,e.exports={ifelse:a}},function(e,t,a){"use strict";function n(e,t,a,i){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,n.prototype),s.expected=t,s.found=a,s.location=i,s.name="SyntaxError",s}function i(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}function s(e,t){var a,i={},s=(t=void 0!==t?t:{}).grammarSource,l={start:ze},r=ze,o='"',u='\\"',c="'",d="\\'",p=">",m="<",g="=",f="+",b="-",h="*",v="/",y="(",x=")",j=",",O=".",I="0",M=/^[ \t\n\r]/,T=/^[0-9A-Za-z._@[\]\-]/,w=/^[^"]/,k=/^[^']/,E=/^[a-zA-Z_]/,C=/^[a-zA-Z_\-]/,F=/^[eE]/,S=/^[1-9]/,A=/^[0-9]/,P=De("whitespace"),_=Le([" ","\t","\n","\r"],!1,!1),L=(Le([" "],!1,!1),Le(['"',"'"],!1,!1),Le([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),Le([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),D=De("literal"),R=_e('"',!1),N=_e('\\"',!1),B=Le(['"'],!0,!1),z=_e("'",!1),V=_e("\\'",!1),G=Le(["'"],!0,!1),q=_e(">",!1),$=_e("<",!1),H=_e("=",!1),U=_e("+",!1),W=_e("-",!1),X=_e("*",!1),Y=_e("/",!1),Q=_e("(",!1),K=_e(")",!1),Z=De("arguments"),J=_e(",",!1),ee=Le([["a","z"],["A","Z"],"_"],!1,!1),te=De("function"),ae=Le([["a","z"],["A","Z"],"_","-"],!1,!1),ne=De("number"),ie=Le(["e","E"],!1,!1),se=De("exponent"),le=_e(".",!1),re=_e("0",!1),oe=Le([["1","9"]],!1,!1),ue=Le([["0","9"]],!1,!1),ce=function(e){return e},de=function(){return'"'},pe=function(e){return{type:"variable",value:e.join(""),location:Qe(Pe()),text:Ae()}},me=function(){return"'"},ge=function(e){return{type:"variable",value:e.join(""),location:Qe(Pe()),text:Ae()}},fe=function(e){return{type:"variable",value:e.join(""),location:Qe(Pe()),text:Ae()}},be=function(e,t,a){return{type:"function",name:Je(t),args:[e,a],location:Qe(Pe()),text:Ae()}},he=function(e,t){return Ze(e,t)},ve=function(e,t){return Ze(e,t)},ye=function(e){return e},xe=function(e,t){return t},je=function(e,t){return[e].concat(t)},Oe=function(e){return e.join("")},Ie=function(e,t){return{type:"namedArgument",name:e.join(""),value:t,location:Qe(Pe()),text:Ae()}},Me=function(e,t){return{type:"function",name:e.join(""),args:t||[],location:Qe(Pe()),text:Ae()}},Te=function(){return parseFloat(Ae())},we=0,ke=0,Ee=[{line:1,column:1}],Ce=0,Fe=[],Se=0;if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=l[t.startRule]}function Ae(){return e.substring(ke,we)}function Pe(){return Ne(ke,we)}function _e(e,t){return{type:"literal",text:e,ignoreCase:t}}function Le(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function De(e){return{type:"other",description:e}}function Re(t){var a,n=Ee[t];if(n)return n;for(a=t-1;!Ee[a];)a--;for(n={line:(n=Ee[a]).line,column:n.column};a<t;)10===e.charCodeAt(a)?(n.line++,n.column=1):n.column++,a++;return Ee[t]=n,n}function Ne(e,t){var a=Re(e),n=Re(t);return{source:s,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:n.line,column:n.column}}}function Be(e){we<Ce||(we>Ce&&(Ce=we,Fe=[]),Fe.push(e))}function ze(){return qe()}function Ve(){var t,a;for(Se++,t=[],M.test(e.charAt(we))?(a=e.charAt(we),we++):(a=i,0===Se&&Be(_));a!==i;)t.push(a),M.test(e.charAt(we))?(a=e.charAt(we),we++):(a=i,0===Se&&Be(_));return Se--,a=i,0===Se&&Be(P),t}function Ge(){var t;return T.test(e.charAt(we))?(t=e.charAt(we),we++):(t=i,0===Se&&Be(L)),t}function qe(){var t;return(t=function(){var t,a,n,s,l;return t=we,Ve(),(a=$e())!==i?(n=we,62===e.charCodeAt(we)?(s=p,we++):(s=i,0===Se&&Be(q)),s===i&&(60===e.charCodeAt(we)?(s=m,we++):(s=i,0===Se&&Be($))),s!==i?(61===e.charCodeAt(we)?(l=g,we++):(l=i,0===Se&&Be(H)),l===i&&(l=null),n=s=[s,l]):(we=n,n=i),n===i&&(n=we,61===e.charCodeAt(we)?(s=g,we++):(s=i,0===Se&&Be(H)),s!==i?(61===e.charCodeAt(we)?(l=g,we++):(l=i,0===Se&&Be(H)),l!==i?n=s=[s,l]:(we=n,n=i)):(we=n,n=i)),n!==i&&(s=$e())!==i?(l=Ve(),ke=t,t=be(a,n,s)):(we=t,t=i)):(we=t,t=i),t}())===i&&(t=$e())===i&&(t=function(){var t,a,n,s;return t=we,Ve(),40===e.charCodeAt(we)?(a=y,we++):(a=i,0===Se&&Be(Q)),a!==i?(Ve(),(n=qe())!==i?(Ve(),41===e.charCodeAt(we)?(s=x,we++):(s=i,0===Se&&Be(K)),s!==i?(Ve(),ke=t,t=ye(n)):(we=t,t=i)):(we=t,t=i)):(we=t,t=i),t}()),t}function $e(){var t;return(t=function(){var t,a,n,s,l,r;if(t=we,Ve(),(a=He())!==i){if(n=[],s=we,43===e.charCodeAt(we)?(l=f,we++):(l=i,0===Se&&Be(U)),l===i&&(45===e.charCodeAt(we)?(l=b,we++):(l=i,0===Se&&Be(W))),l!==i&&(r=He())!==i?s=l=[l,r]:(we=s,s=i),s!==i)for(;s!==i;)n.push(s),s=we,43===e.charCodeAt(we)?(l=f,we++):(l=i,0===Se&&Be(U)),l===i&&(45===e.charCodeAt(we)?(l=b,we++):(l=i,0===Se&&Be(W))),l!==i&&(r=He())!==i?s=l=[l,r]:(we=s,s=i);else n=i;n!==i?(s=Ve(),ke=t,t=he(a,n)):(we=t,t=i)}else we=t,t=i;return t}())===i&&(t=He())===i&&(t=Ue()),t}function He(){var t,a,n,s,l,r;if(t=we,Ve(),(a=Ue())!==i){for(n=[],s=we,42===e.charCodeAt(we)?(l=h,we++):(l=i,0===Se&&Be(X)),l===i&&(47===e.charCodeAt(we)?(l=v,we++):(l=i,0===Se&&Be(Y))),l!==i&&(r=Ue())!==i?s=l=[l,r]:(we=s,s=i);s!==i;)n.push(s),s=we,42===e.charCodeAt(we)?(l=h,we++):(l=i,0===Se&&Be(X)),l===i&&(47===e.charCodeAt(we)?(l=v,we++):(l=i,0===Se&&Be(Y))),l!==i&&(r=Ue())!==i?s=l=[l,r]:(we=s,s=i);s=Ve(),ke=t,t=ve(a,n)}else we=t,t=i;return t}function Ue(){var t;return(t=function(){var t,a,n,s;return t=we,Ve(),40===e.charCodeAt(we)?(a=y,we++):(a=i,0===Se&&Be(Q)),a!==i?(Ve(),(n=$e())!==i?(Ve(),41===e.charCodeAt(we)?(s=x,we++):(s=i,0===Se&&Be(K)),s!==i?(Ve(),ke=t,t=ye(n)):(we=t,t=i)):(we=t,t=i)):(we=t,t=i),t}())===i&&(t=function(){var t,a,n,s,l;if(Se++,t=we,Ve(),a=[],C.test(e.charAt(we))?(n=e.charAt(we),we++):(n=i,0===Se&&Be(ae)),n!==i)for(;n!==i;)a.push(n),C.test(e.charAt(we))?(n=e.charAt(we),we++):(n=i,0===Se&&Be(ae));else a=i;return a!==i?(40===e.charCodeAt(we)?(n=y,we++):(n=i,0===Se&&Be(Q)),n!==i?(Ve(),s=function(){var t,a,n,s,l,r,o;if(Se++,t=we,(a=We())!==i){for(n=[],s=we,l=Ve(),44===e.charCodeAt(we)?(r=j,we++):(r=i,0===Se&&Be(J)),r!==i?(Ve(),(o=We())!==i?(ke=s,s=xe(a,o)):(we=s,s=i)):(we=s,s=i);s!==i;)n.push(s),s=we,l=Ve(),44===e.charCodeAt(we)?(r=j,we++):(r=i,0===Se&&Be(J)),r!==i?(Ve(),(o=We())!==i?(ke=s,s=xe(a,o)):(we=s,s=i)):(we=s,s=i);s=Ve(),44===e.charCodeAt(we)?(l=j,we++):(l=i,0===Se&&Be(J)),l===i&&(l=null),ke=t,t=je(a,n)}else we=t,t=i;return Se--,t===i&&(a=i,0===Se&&Be(Z)),t}(),s===i&&(s=null),Ve(),41===e.charCodeAt(we)?(l=x,we++):(l=i,0===Se&&Be(K)),l!==i?(Ve(),ke=t,t=Me(a,s)):(we=t,t=i)):(we=t,t=i)):(we=t,t=i),Se--,t===i&&0===Se&&Be(te),t}())===i&&(t=function(){var t,a;return Se++,t=we,Ve(),(a=Xe())===i&&(a=function(){var t,a,n,s,l;if(t=we,Ve(),34===e.charCodeAt(we)?(a=o,we++):(a=i,0===Se&&Be(R)),a!==i){for(n=[],s=we,e.substr(we,2)===u?(l=u,we+=2):(l=i,0===Se&&Be(N)),l!==i&&(ke=s,l=de()),(s=l)===i&&(w.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(B)));s!==i;)n.push(s),s=we,e.substr(we,2)===u?(l=u,we+=2):(l=i,0===Se&&Be(N)),l!==i&&(ke=s,l=de()),(s=l)===i&&(w.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(B)));34===e.charCodeAt(we)?(s=o,we++):(s=i,0===Se&&Be(R)),s!==i?(l=Ve(),ke=t,t=pe(n)):(we=t,t=i)}else we=t,t=i;if(t===i){if(t=we,Ve(),39===e.charCodeAt(we)?(a=c,we++):(a=i,0===Se&&Be(z)),a!==i){for(n=[],s=we,e.substr(we,2)===d?(l=d,we+=2):(l=i,0===Se&&Be(V)),l!==i&&(ke=s,l=me()),(s=l)===i&&(k.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(G)));s!==i;)n.push(s),s=we,e.substr(we,2)===d?(l=d,we+=2):(l=i,0===Se&&Be(V)),l!==i&&(ke=s,l=me()),(s=l)===i&&(k.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(G)));39===e.charCodeAt(we)?(s=c,we++):(s=i,0===Se&&Be(z)),s!==i?(l=Ve(),ke=t,t=ge(n)):(we=t,t=i)}else we=t,t=i;if(t===i){if(t=we,Ve(),a=[],(n=Ge())!==i)for(;n!==i;)a.push(n),n=Ge();else a=i;a!==i?(n=Ve(),ke=t,t=fe(a)):(we=t,t=i)}}return t}()),a!==i?(Ve(),ke=t,t=ce(a)):(we=t,t=i),Se--,t===i&&0===Se&&Be(D),t}()),t}function We(){var t,a,n,s,l;if(t=we,a=[],E.test(e.charAt(we))?(n=e.charAt(we),we++):(n=i,0===Se&&Be(ee)),n!==i)for(;n!==i;)a.push(n),E.test(e.charAt(we))?(n=e.charAt(we),we++):(n=i,0===Se&&Be(ee));else a=i;return a!==i?(n=Ve(),61===e.charCodeAt(we)?(s=g,we++):(s=i,0===Se&&Be(H)),s!==i?(Ve(),(l=Xe())===i&&(l=function(){var t,a,n,s,l;if(t=we,34===e.charCodeAt(we)?(a=o,we++):(a=i,0===Se&&Be(R)),a!==i){for(n=[],s=we,e.substr(we,2)===u?(l=u,we+=2):(l=i,0===Se&&Be(N)),l!==i&&(ke=s,l=de()),(s=l)===i&&(w.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(B)));s!==i;)n.push(s),s=we,e.substr(we,2)===u?(l=u,we+=2):(l=i,0===Se&&Be(N)),l!==i&&(ke=s,l=de()),(s=l)===i&&(w.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(B)));34===e.charCodeAt(we)?(s=o,we++):(s=i,0===Se&&Be(R)),s!==i?(ke=t,t=Oe(n)):(we=t,t=i)}else we=t,t=i;if(t===i){if(t=we,39===e.charCodeAt(we)?(a=c,we++):(a=i,0===Se&&Be(z)),a!==i){for(n=[],s=we,e.substr(we,2)===d?(l=d,we+=2):(l=i,0===Se&&Be(V)),l!==i&&(ke=s,l=me()),(s=l)===i&&(k.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(G)));s!==i;)n.push(s),s=we,e.substr(we,2)===d?(l=d,we+=2):(l=i,0===Se&&Be(V)),l!==i&&(ke=s,l=me()),(s=l)===i&&(k.test(e.charAt(we))?(s=e.charAt(we),we++):(s=i,0===Se&&Be(G)));39===e.charCodeAt(we)?(s=c,we++):(s=i,0===Se&&Be(z)),s!==i?(ke=t,t=Oe(n)):(we=t,t=i)}else we=t,t=i;if(t===i){if(t=we,a=[],(n=Ge())!==i)for(;n!==i;)a.push(n),n=Ge();else a=i;a!==i&&(ke=t,a=Oe(a)),t=a}}return t}()),l!==i?(Ve(),ke=t,t=Ie(a,l)):(we=t,t=i)):(we=t,t=i)):(we=t,t=i),t===i&&(t=qe()),t}function Xe(){var t,a,n,s,l;return Se++,t=we,45===e.charCodeAt(we)?(a=b,we++):(a=i,0===Se&&Be(W)),a===i&&(a=null),n=function(){var t,a,n,s;if(48===e.charCodeAt(we)?(t=I,we++):(t=i,0===Se&&Be(re)),t===i)if(t=we,S.test(e.charAt(we))?(a=e.charAt(we),we++):(a=i,0===Se&&Be(oe)),a!==i){for(n=[],s=Ye();s!==i;)n.push(s),s=Ye();t=a=[a,n]}else we=t,t=i;return t}(),n!==i?(s=function(){var t,a,n,s;if(t=we,46===e.charCodeAt(we)?(a=O,we++):(a=i,0===Se&&Be(le)),a!==i){if(n=[],(s=Ye())!==i)for(;s!==i;)n.push(s),s=Ye();else n=i;n!==i?t=a=[a,n]:(we=t,t=i)}else we=t,t=i;return t}(),s===i&&(s=null),l=function(){var t,a,n,s,l;if(Se++,t=we,a=function(){var t;return F.test(e.charAt(we))?(t=e.charAt(we),we++):(t=i,0===Se&&Be(ie)),t}(),a!==i){if(45===e.charCodeAt(we)?(n=b,we++):(n=i,0===Se&&Be(W)),n===i&&(n=null),s=[],(l=Ye())!==i)for(;l!==i;)s.push(l),l=Ye();else s=i;s!==i?t=a=[a,n,s]:(we=t,t=i)}else we=t,t=i;return Se--,t===i&&(a=i,0===Se&&Be(se)),t}(),l===i&&(l=null),ke=t,t=Te()):(we=t,t=i),Se--,t===i&&(a=i,0===Se&&Be(ne)),t}function Ye(){var t;return A.test(e.charAt(we))?(t=e.charAt(we),we++):(t=i,0===Se&&Be(ue)),t}function Qe(e){return{min:e.start.offset,max:e.end.offset}}const Ke={"+":"add","-":"subtract","*":"multiply","/":"divide","<":"lt",">":"gt","==":"eq","<=":"lte",">=":"gte"};function Ze(e,t){const a=t.reduce(((e,[t,a])=>({type:"function",name:Ke[t],args:[e,a]})),e);return"object"==typeof a&&(a.location=Qe(Pe()),a.text=Ae()),a}function Je([e,t]){return Ke[e+(t||"")]}if((a=r())!==i&&we===e.length)return a;throw a!==i&&we<e.length&&Be({type:"end"}),function(e,t,a){return new n(n.buildMessage(e,t),e,t,a)}(Fe,Ce<e.length?e.charAt(Ce):null,Ce<e.length?Ne(Ce,Ce+1):Ne(Ce,Ce))}a.r(t),a.d(t,"SyntaxError",(function(){return n})),a.d(t,"parse",(function(){return s})),function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,n=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){n=e[a].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,l=this.location.source+":"+s.line+":"+s.column;if(n){var r=this.location.end,o=i("",s.line.toString().length),u=n[s.line-1],c=s.line===r.line?r.column:u.length+1;t+="\n --\x3e "+l+"\n"+o+" |\n"+s.line+" | "+u+"\n"+o+" | "+i("",s.column-1)+i("",c-s.column,"^")}else t+="\n at "+l}return t},n.buildMessage=function(e,t){var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function l(e){return a[e.type](e)}return"Expected "+function(e){var t,a,n=e.map(l);if(n.sort(),n.length>0){for(t=1,a=1;t<n.length;t++)n[t-1]!==n[t]&&(n[a]=n[t],a++);n.length=a}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(433);case"v8light":return a(435)}},function(e,t,a){var n=a(81),i=a(434);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#25262e;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#7a7f89;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #343741;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1d1e24}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(436);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #d3dae6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #d3dae6}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#f5f7fa;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#69707d;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #d3dae6;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),i=a(3),s=n.__importDefault(a(438));t.default=function(e){var t=i.useRef(e);t.current=e,s.default((function(){return function(){return t.current()}}))}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(3);t.default=function(e){n.useEffect(e,[])}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(440);case"v8light":return a(442)}},function(e,t,a){var n=a(81),i=a(441);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.documentation__docs{background:#1d1e24}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #343741}.documentation__docsSidebar{background:#25262e}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #343741}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #343741}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){var n=a(81),i=a(443);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.documentation__docs{background:#fff}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #d3dae6}.documentation__docsSidebar{background:#f5f7fa}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #d3dae6}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #d3dae6}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #d3dae6;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(445);case"v8light":return a(447)}},function(e,t,a){var n=a(81),i=a(446);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(448);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#d3dae6}.lnFieldSelect__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(450);case"v8light":return a(452)}},function(e,t,a){var n=a(81),i=a(451);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnFieldPicker__option--incompatible{color:#343741}.lnFieldPicker__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(453);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnFieldPicker__option--incompatible{color:#d3dae6}.lnFieldPicker__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(3),i=a.n(n),s=a(4);const l=()=>Object(s.jsx)(n.Fragment,null),r=i.a.lazy((()=>a.e(15).then(a.bind(null,629)))),o=function(e){return Object(s.jsx)(i.a.Suspense,{fallback:Object(s.jsx)(l,null)},Object(s.jsx)(r,e))}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(456);case"v8light":return a(458)}},function(e,t,a){var n=a(81),i=a(457);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(459);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(461);case"v8light":return a(463)}},function(e,t,a){var n=a(81),i=a(462);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(464);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(466);case"v8light":return a(468)}},function(e,t,a){var n=a(81),i=a(467);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(469);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(471);case"v8light":return a(473)}},function(e,t,a){var n=a(81),i=a(472);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(474);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(476);case"v8light":return a(478)}},function(e,t,a){var n=a(81),i=a(477);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsHelpPopover__panel{max-inline-size:480px!important}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(81),i=a(479);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsHelpPopover__panel{max-inline-size:480px!important}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(481),i=a(482),s=a(483),l=a(484),r=a(485),o=a(486),u=a(487);u.alea=n,u.xor128=i,u.xorwow=s,u.xorshift7=l,u.xor4096=r,u.tychei=o,e.exports=u},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t,a=this,n=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var n=.02519603282416938*(t+=e.charCodeAt(a));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=n(" "),a.s1=n(" "),a.s2=n(" "),a.s0-=n(e),a.s0<0&&(a.s0+=1),a.s1-=n(e),a.s1<0&&(a.s1+=1),a.s2-=n(e),a.s2<0&&(a.s2+=1),n=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var a=new l(e),n=t&&t.state,i=a.next;return i.int32=function(){return 4294967296*a.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.alea=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor128=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),n==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorwow=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.x,i=t.i;return e=n[i],a=(e^=e>>>7)^e<<24,a^=(e=n[i+1&7])^e>>>10,a^=(e=n[i+3&7])^e>>>3,a^=(e=n[i+4&7])^e<<7,e=n[i+7&7],a^=(e^=e<<13)^e<<9,n[i]=a,t.i=i+1&7,a},function(e,t){var a,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,a=0;a<t.length;++a)n[7&a]=n[7&a]<<15^t.charCodeAt(a)+n[a+1&7]<<13;for(;n.length<8;)n.push(0);for(a=0;a<8&&0===n[a];++a);for(8==a?n[7]=-1:n[a],e.x=n,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.x&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorshift7=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.w,i=t.X,s=t.i;return t.w=n=n+1640531527|0,a=i[s+34&127],e=i[s=s+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=i[s]=a^e,t.i=s,a+(n^n>>>16)|0},function(e,t){var a,n,i,s,l,r=[],o=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,o=Math.max(o,t.length)),i=0,s=-32;s<o;++s)t&&(n^=t.charCodeAt((s+32)%t.length)),0===s&&(l=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(l=l+1640531527|0,i=0==(a=r[127&s]^=n+l)?i+1:0);for(i>=128&&(r[127&(t&&t.length||0)]=-1),i=127,s=512;s>0;--s)n=r[i+34&127],a=r[i=i+1&127],n^=n<<13,a^=a<<17,n^=n>>>15,a^=a>>>12,r[i]=n^a;e.w=l,e.X=r,e.i=i}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.X&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor4096=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,n=t.d,i=t.a;return e=e<<25^e>>>7^a,a=a-n|0,n=n<<24^n>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-n|0,t.d=n<<16^a>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var n=0;n<a.length+20;n++)t.b^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(96)&&a(119)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.tychei=o}(0,e,a(96))}).call(this,a(118)(e))},function(e,t,a){var n;!function(i,s,l){var r,o=256,u=l.pow(o,6),c=l.pow(2,52),d=2*c,p=o-1;function m(e,t,a){var n=[],p=h(b((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(s)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),v(e)}catch(e){var t=i.navigator,a=t&&t.plugins;return[+new Date,i,a,i.screen,v(s)]}}():e,3),n),m=new g(n),y=function(){for(var e=m.g(6),t=u,a=0;e<c;)e=(e+a)*o,t*=o,a=m.g(1);for(;e>=d;)e/=2,t/=2,a>>>=1;return(e+a)/t};return y.int32=function(){return 0|m.g(4)},y.quick=function(){return m.g(4)/4294967296},y.double=y,h(v(m.S),s),(t.pass||a||function(e,t,a,n){return n&&(n.S&&f(n,m),e.state=function(){return f(m,{})}),a?(l.random=e,t):e})(y,p,"global"in t?t.global:this==l,t.state)}function g(e){var t,a=e.length,n=this,i=0,s=n.i=n.j=0,l=n.S=[];for(a||(e=[a++]);i<o;)l[i]=i++;for(i=0;i<o;i++)l[i]=l[s=p&s+e[i%a]+(t=l[i])],l[s]=t;(n.g=function(e){for(var t,a=0,i=n.i,s=n.j,l=n.S;e--;)t=l[i=p&i+1],a=a*o+l[p&(l[i]=l[s=p&s+t])+(l[s]=t)];return n.i=i,n.j=s,a})(o)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function b(e,t){var a,n=[],i=typeof e;if(t&&"object"==i)for(a in e)try{n.push(b(e[a],t-1))}catch(e){}return n.length?n:"string"==i?e:e+"\0"}function h(e,t){for(var a,n=e+"",i=0;i<n.length;)t[p&i]=p&(a^=19*t[p&i])+n.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(h(l.random(),s),e.exports){e.exports=m;try{r=a(488)}catch(e){}}else void 0===(n=function(){return m}.call(t,a,t,e))||(e.exports=n)}("undefined"!=typeof self?self:this,[],Math)},function(e,t){},function(e,t,a){var n=a(81),i=a(490);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#1d1e24;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #343741;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#25262e;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px;display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{min-block-size:24px;padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#36a2ef;text-decoration-color:#36a2ef}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(492);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#fff;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #d3dae6;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#f5f7fa;border-bottom:1px solid #d3dae6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px;display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{min-block-size:24px;padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#07c;text-decoration-color:#07c}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(494);case"v8light":return a(496)}},function(e,t,a){var n=a(81),i=a(495);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".filterQueryInput__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.filterQueryInput__popover{width:960px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(497);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".filterQueryInput__popoverButton{font-size:14px;font-size:1rem;line-height:1.7142857143rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.filterQueryInput__popover{width:960px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(499);case"v8light":return a(501)}},function(e,t,a){var n=a(81),i=a(500);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(502);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(504);case"v8light":return a(506)}},function(e,t,a){var n=a(81),i=a(505);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(507);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(509);case"v8light":return a(511)}},function(e,t,a){var n=a(81),i=a(510);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(512);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(514);case"v8light":return a(516)}},function(e,t,a){var n=a(81),i=a(515);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".unifiedFieldListItemButton__action{opacity:0}.unifiedFieldListItemButton__action--always,.unifiedFieldListItemButton__action:focus{opacity:1}.unifiedFieldListItemButton{background:#1d1e24;border-radius:6px;box-shadow:0 .8px .8px #0000001a,0 2.3px 2px rgba(0,0,0,.075);width:100%}.unifiedFieldListItemButton.kbnFieldButton-isActive,.unifiedFieldListItemButton.kbnFieldButton:focus-within{outline:none}.unifiedFieldListItemButton.kbnFieldButton-isActive:focus-visible,.unifiedFieldListItemButton.kbnFieldButton:focus-within:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus{outline:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus .kbnFieldButton__nameInner{outline:2px solid currentColor}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__nameInner{outline-style:auto}.unifiedFieldListItemButton .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__nameInner{outline:none}.unifiedFieldListItemButton button .kbnFieldButton__nameInner:hover{text-decoration:underline}.unifiedFieldListItemButton:hover .unifiedFieldListItemButton__action,.unifiedFieldListItemButton[class*=-isActive] .unifiedFieldListItemButton__action{opacity:1}.unifiedFieldList__fieldPopover__fieldPopoverPanel .unifiedFieldListItemButton{background:none;box-shadow:none}.unifiedFieldListItemButton--missing{background:#1d1e24;color:#98a2b3}.unifiedFieldListItemButton__fieldIconContainer{position:relative}.unifiedFieldListItemButton__fieldIcon{transition:opacity .25s ease-in-out}.unifiedFieldListItemButton__fieldIconDrag{left:0;position:absolute;top:0;transition:opacity .25s ease-in-out;visibility:hidden}.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIconDrag{opacity:0;visibility:visible}.domDraggable__keyboardHandler:focus+.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIcon,.unifiedFieldListItemButton--withDragIcon:hover .unifiedFieldListItemButton__fieldIcon,.unifiedFieldListItemButton--withDragIcon[class*=-isActive] .unifiedFieldListItemButton__fieldIcon{opacity:0}.domDraggable__keyboardHandler:focus+.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIconDrag,.unifiedFieldListItemButton--withDragIcon:hover .unifiedFieldListItemButton__fieldIconDrag,.unifiedFieldListItemButton--withDragIcon[class*=-isActive] .unifiedFieldListItemButton__fieldIconDrag{opacity:1}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(517);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".unifiedFieldListItemButton__action{opacity:0}.unifiedFieldListItemButton__action--always,.unifiedFieldListItemButton__action:focus{opacity:1}.unifiedFieldListItemButton{background:#fff;border-radius:6px;box-shadow:0 .8px .8px #0000000a,0 2.3px 2px #00000008;width:100%}.unifiedFieldListItemButton.kbnFieldButton-isActive,.unifiedFieldListItemButton.kbnFieldButton:focus-within{outline:none}.unifiedFieldListItemButton.kbnFieldButton-isActive:focus-visible,.unifiedFieldListItemButton.kbnFieldButton:focus-within:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus{outline:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus .kbnFieldButton__nameInner{outline:2px solid currentColor}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__nameInner{outline-style:auto}.unifiedFieldListItemButton .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__nameInner{outline:none}.unifiedFieldListItemButton button .kbnFieldButton__nameInner:hover{text-decoration:underline}.unifiedFieldListItemButton:hover .unifiedFieldListItemButton__action,.unifiedFieldListItemButton[class*=-isActive] .unifiedFieldListItemButton__action{opacity:1}.unifiedFieldList__fieldPopover__fieldPopoverPanel .unifiedFieldListItemButton{background:none;box-shadow:none}.unifiedFieldListItemButton--missing{background:#98a2b31a;color:#69707d}.unifiedFieldListItemButton__fieldIconContainer{position:relative}.unifiedFieldListItemButton__fieldIcon{transition:opacity .25s ease-in-out}.unifiedFieldListItemButton__fieldIconDrag{left:0;position:absolute;top:0;transition:opacity .25s ease-in-out;visibility:hidden}.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIconDrag{opacity:0;visibility:visible}.domDraggable__keyboardHandler:focus+.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIcon,.unifiedFieldListItemButton--withDragIcon:hover .unifiedFieldListItemButton__fieldIcon,.unifiedFieldListItemButton--withDragIcon[class*=-isActive] .unifiedFieldListItemButton__fieldIcon{opacity:0}.domDraggable__keyboardHandler:focus+.unifiedFieldListItemButton--withDragIcon .unifiedFieldListItemButton__fieldIconDrag,.unifiedFieldListItemButton--withDragIcon:hover .unifiedFieldListItemButton__fieldIconDrag,.unifiedFieldListItemButton--withDragIcon[class*=-isActive] .unifiedFieldListItemButton__fieldIconDrag{opacity:1}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(519);case"v8light":return a(521)}},function(e,t,a){var n=a(81),i=a(520);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".kbnFieldButton{align-items:flex-start;border-radius:6px;display:flex;font-size:14px;font-size:1rem;line-height:1.7142857143rem;margin-bottom:4px;padding:0 8px;transition:box-shadow .15s cubic-bezier(.694,.0482,.335,1),background-color .15s cubic-bezier(.694,.0482,.335,1)}.kbnFieldButton-isActive,.kbnFieldButton:focus-within{outline:2px solid currentColor}.kbnFieldButton-isActive:focus-visible,.kbnFieldButton:focus-within:focus-visible{outline-style:auto}.kbnFieldButton-isActive:not(:focus-visible),.kbnFieldButton:focus-within:not(:focus-visible){outline:none}.kbnFieldButton__button{align-items:flex-start;display:flex;flex-grow:1;line-height:normal;padding:8px 0;text-align:left}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0}.kbnFieldButton__name{flex-grow:1;padding:0 8px}.kbnFieldButton__infoIcon{align-items:center;display:flex;flex-shrink:0;justify-content:center;line-height:0;min-height:16px}.kbnFieldButton__fieldAction{margin-left:8px}.kbnFieldButton__dragHandle{margin-right:8px}.kbnFieldButton__dragHandle,.kbnFieldButton__fieldAction{line-height:32px}.kbnFieldButton--xs{font-size:12px}.kbnFieldButton--xs .kbnFieldButton__button{padding:4px 0}.kbnFieldButton--xs .kbnFieldButton__fieldAction{margin-left:4px}.kbnFieldButton--xs .kbnFieldButton__dragHandle,.kbnFieldButton--xs .kbnFieldButton__fieldAction{line-height:24px}.kbnFieldButton--flushBoth{padding-left:0;padding-right:0}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(522);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".kbnFieldButton{align-items:flex-start;border-radius:6px;display:flex;font-size:14px;font-size:1rem;line-height:1.7142857143rem;margin-bottom:4px;padding:0 8px;transition:box-shadow .15s cubic-bezier(.694,.0482,.335,1),background-color .15s cubic-bezier(.694,.0482,.335,1)}.kbnFieldButton-isActive,.kbnFieldButton:focus-within{outline:2px solid currentColor}.kbnFieldButton-isActive:focus-visible,.kbnFieldButton:focus-within:focus-visible{outline-style:auto}.kbnFieldButton-isActive:not(:focus-visible),.kbnFieldButton:focus-within:not(:focus-visible){outline:none}.kbnFieldButton__button{align-items:flex-start;display:flex;flex-grow:1;line-height:normal;padding:8px 0;text-align:left}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0}.kbnFieldButton__name{flex-grow:1;padding:0 8px}.kbnFieldButton__infoIcon{align-items:center;display:flex;flex-shrink:0;justify-content:center;line-height:0;min-height:16px}.kbnFieldButton__fieldAction{margin-left:8px}.kbnFieldButton__dragHandle{margin-right:8px}.kbnFieldButton__dragHandle,.kbnFieldButton__fieldAction{line-height:32px}.kbnFieldButton--xs{font-size:12px}.kbnFieldButton--xs .kbnFieldButton__button{padding:4px 0}.kbnFieldButton--xs .kbnFieldButton__fieldAction{margin-left:4px}.kbnFieldButton--xs .kbnFieldButton__dragHandle,.kbnFieldButton--xs .kbnFieldButton__fieldAction{line-height:24px}.kbnFieldButton--flushBoth{padding-left:0;padding-right:0}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(3);t.default=function(e){var t=n.useRef(e);return t.current=e,t}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(525);case"v8light":return a(527)}},function(e,t,a){var n=a(81),i=a(526);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #343741;border-radius:6px;padding:40px 64px}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(528);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #d3dae6;border-radius:6px;padding:40px 64px}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(3);t.default=function(e){var t=n.useRef();return n.useEffect((function(){t.current=e})),t.current}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(531);case"v8light":return a(533)}},function(e,t,a){var n=a(81),i=a(532);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsEmbeddablePanelFeatureList{height:100%;max-height:320px;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar{height:16px;width:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-corner,.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-track{background-color:#0000}.lnsEmbeddablePanelFeatureList:focus{outline:none}.lnsEmbeddablePanelFeatureList[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},function(e,t,a){var n=a(81),i=a(534);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsEmbeddablePanelFeatureList{height:100%;max-height:320px;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar{height:16px;width:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-corner,.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-track{background-color:#0000}.lnsEmbeddablePanelFeatureList:focus{outline:none}.lnsEmbeddablePanelFeatureList[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(536);case"v8light":return a(538)}},function(e,t,a){var n=a(81),i=a(537);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}@media only screen and (min-width:768px)and (max-width:991px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:992px)and (max-width:1199px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:768px)and (max-width:991px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px)and (max-width:1199px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},function(e,t,a){var n=a(81),i=a(539);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}@media only screen and (min-width:768px)and (max-width:991px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:992px)and (max-width:1199px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:768px)and (max-width:991px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px)and (max-width:1199px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(541);case"v8light":return a(543)}},function(e,t,a){var n=a(81),i=a(542);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsConfigPanel__overlay{background:#25262e;-webkit-clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%);clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%)}@media only screen and (max-width:574px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}@media only screen and (min-width:575px)and (max-width:767px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}@media only screen and (min-width:768px)and (max-width:991px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}.lnsConfigPanel__overlay .kbnOverlayMountWrapper{margin-left:-400px;padding-left:400px;pointer-events:none}.lnsConfigPanel__overlay .kbnOverlayMountWrapper .euiFlyoutFooter{pointer-events:auto}",""]),e.exports=t},function(e,t,a){var n=a(81),i=a(544);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(82)(!1)).push([e.i,".lnsConfigPanel__overlay{background:#f5f7fa;-webkit-clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%);clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%)}@media only screen and (max-width:574px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}@media only screen and (min-width:575px)and (max-width:767px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}@media only screen and (min-width:768px)and (max-width:991px){.lnsConfigPanel__overlay{-webkit-clip-path:none;clip-path:none}}.lnsConfigPanel__overlay .kbnOverlayMountWrapper{margin-left:-400px;padding-left:400px;pointer-events:none}.lnsConfigPanel__overlay .kbnOverlayMountWrapper .euiFlyoutFooter{pointer-events:auto}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(141);function i(e,t){var a;const i=t?t(e):function(e){var t;return e.timeSeriesMetric||(null!==(t=e.type)&&void 0!==t?t:"string")}(e),s=(null===(a=e.esTypes)||void 0===a?void 0:a[0])||null;return s&&["_id","_index","_ignored"].includes(s)&&"string"===i?"keyword":"unknown"===i&&s&&Object(n.c)(s)||"string"===i&&s?s:i}},,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(15),i=a.n(n),s=a(3),l=a.n(s),r=a(6),o=a(4);const u=({children:e,condition:t,tooltipContent:a,...n})=>Object(o.jsx)(l.a.Fragment,null,t?Object(o.jsx)(r.EuiToolTip,i()({content:a,delay:"long"},n),Object(o.jsx)(l.a.Fragment,null,e)):e)},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return o})),a(3);var n=a(6),i=a(0),s=a(4);const l=e=>{var t;return e.value?Object(s.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(s.jsx)(n.EuiFlexItem,{grow:!1},Object(s.jsx)(n.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:e.value})),Object(s.jsx)(n.EuiFlexItem,null,e.label)):null};function r({value:e,onChange:t,customIconSet:a,defaultIcon:i="empty"}){var r;const o=a.find((t=>e===t.value))||a.find((e=>e.value===i));return Object(s.jsx)(n.EuiComboBox,{fullWidth:!0,"data-test-subj":"lns-icon-select",isClearable:!1,options:a,selectedOptions:[{label:o.label,value:o.value}],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:l,compressed:!0,prepend:(u=o.value,null!=u&&"empty"!==u?Object(s.jsx)(n.EuiIcon,{type:null!==(r=o.icon)&&void 0!==r?r:o.value}):void 0)});var u}function o({currentIcon:e,setIcon:t,customIconSet:a,defaultIcon:l="empty"}){return Object(s.jsx)(n.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:i.i18n.translate("visualizationUiComponents.iconSelect.label",{defaultMessage:"Icon decoration"})},Object(s.jsx)(r,{defaultIcon:l,customIconSet:a,value:e,onChange:t}))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(3),i=a.n(n),s=a(0),l=a(648),r=a(6),o=a(186),u=a(4);const c={auto:s.i18n.translate("visualizationUiComponents.colorPicker.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:s.i18n.translate("visualizationUiComponents.colorPicker.tooltip.custom",{defaultMessage:"Clear the custom color to return to â€œAutoâ€ mode."})},d=({overwriteColor:e,defaultColor:t,isClearable:a,setConfig:d,label:p,disableHelpTooltip:m,disabledMessage:g,showAlpha:f})=>{const[b,h]=Object(n.useState)(e||t),[v,y]=Object(n.useState)(e||t),[x,j]=Object(n.useState)(Object(o.b)(b)),O=Object(n.useRef)(!1),I=Boolean(g);Object(n.useEffect)((()=>{O.current||e&&v&&e.toUpperCase()!==v.toUpperCase()&&(h(e),y(e.toUpperCase()),j(Object(o.b)(e))),O.current=!1}),[v,e,t]);const M=null!=p?p:s.i18n.translate("visualizationUiComponents.colorPicker.seriesColor.label",{defaultMessage:"Series color"}),T=Object(u.jsx)(r.EuiColorPicker,{fullWidth:!0,"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:void 0!==a?a:Boolean(e),onChange:(e,t)=>{h(e),O.current=!0,t.isValid&&(y(t.hex.toUpperCase()),j(Object(o.b)(t.hex)),d({color:t.hex})),""===e&&d({color:void 0})},color:I?"":b,disabled:I,placeholder:" ",onBlur:()=>{b||h(null!=v?v:t)},"aria-label":M,showAlpha:f,swatches:1===x?Object(r.euiPaletteColorBlind)():Object(r.euiPaletteColorBlind)().map((e=>Object(o.d)(e,x).hex()))});return Object(u.jsx)(r.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(u.jsx)(l.a,{delay:"long",position:"top",tooltipContent:b&&!I?c.custom:c.auto,condition:!m},Object(u.jsx)("span",null,M,!m&&Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(r.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},I?Object(u.jsx)(r.EuiToolTip,{position:"top",content:g,delay:"long",anchorClassName:"eui-displayBlock"},T):T)}},,,function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return s}));var n=a(38);const i=(e,t)=>{let a,i=!0;try{e&&("kuery"===e.language?Object(n.toElasticsearchQuery)(Object(n.fromKueryExpression)(e.query),t):Object(n.luceneStringToDsl)(e.query))}catch(e){i=!1,a=e.message}return{isValid:i,error:a}},s=(e,t)=>i(e,t).isValid},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(6),i=a(0),s=a(3),l=a(4);function r({idPrefix:e,currentConfig:t,setConfig:a,isQueryBased:r,children:o}){const[u,c]=Object(s.useState)(function({textField:e,textVisibility:t}={},a){return t?a&&e?"field":"name":"none"}(t,r)),d=[{id:`${e}none`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_textVisibility_none"},{id:`${e}name`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.name",{defaultMessage:"Name"}),"data-test-subj":"lnsXY_textVisibility_name"}];return r&&d.push({id:`${e}field`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.field",{defaultMessage:"Field"}),"data-test-subj":"lnsXY_textVisibility_field"}),Object(l.jsx)(n.EuiFormRow,{label:i.i18n.translate("visualizationUiComponents.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),display:"columnCompressed",fullWidth:!0},Object(l.jsx)("div",null,Object(l.jsx)(n.EuiButtonGroup,{legend:i.i18n.translate("visualizationUiComponents.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),"data-test-subj":"lns-lineMarker-text-visibility",name:"textVisibilityStyle",buttonSize:"compressed",options:d,idSelected:u?`${e}${u}`:`${e}none`,onChange:n=>{const i=n.replace(e,"");"none"===i?a({textVisibility:!1,textField:void 0}):"name"===i?a({textVisibility:!0,textField:void 0}):"field"===i&&a({textVisibility:Boolean(null==t?void 0:t.textField)}),c(i)},isFullWidth:!0}),null==o?void 0:o(u)))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(3),i=a.n(n),s=a(0),l=a(6),r=a(4);const o=({currentConfig:e,setConfig:t,idPrefix:a})=>Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(l.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.label",{defaultMessage:"Line"})},Object(r.jsx)(l.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(r.jsx)(l.EuiFlexItem,null,Object(r.jsx)(c,{value:(null==e?void 0:e.lineWidth)||1,onChange:e=>{t({lineWidth:e})}})),Object(r.jsx)(l.EuiFlexItem,{grow:!1},Object(r.jsx)(l.EuiButtonGroup,{legend:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.label",{defaultMessage:"Line"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${a}solid`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid",iconType:"lineSolid"},{id:`${a}dashed`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed",iconType:"lineDashed"},{id:`${a}dotted`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted",iconType:"lineDotted"}],idSelected:`${a}${(null==e?void 0:e.lineStyle)||"solid"}`,onChange:e=>{const n=e.replace(a,"");t({lineStyle:n})},isIconOnly:!0})))));function u(e,t,a,n){return""===e?t:Math.max(1,Math.min(e,10))}const c=Object(n.memo)((({value:e,onChange:t})=>{const[a,i]=Object(n.useState)(String(e));return Object(r.jsx)(l.EuiFieldNumber,{"data-test-subj":"lnsXYThickness",value:a,fullWidth:!0,min:1,max:10,step:1,append:"px",compressed:!0,onChange:({currentTarget:{value:e}})=>{i(e);const a=""===e?"":Number(e),n=u(Number(e),Number(e));a===n&&t(n)},onBlur:()=>{if(a!==String(e)){const n=u(""===a?a:Number(a),e);t(n),i(String(n))}}})}))},,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return r}));var n=a(0),i=a(112),s=a(2);async function l({esqlQuery:e,search:t,signal:a}){try{var l;const r=await async function({esqlQuery:e,search:t,signal:a}){try{var i;return null!==(i=(await Object(s.lastValueFrom)(t({params:{query:`${e} | limit 0`}},{abortSignal:a,strategy:"esql_async"}))).rawResponse.columns)&&void 0!==i?i:[]}catch(e){throw new Error(n.i18n.translate("esqlUtils.columnsErrorMsg",{defaultMessage:"Unable to load columns. {errorMessage}",values:{errorMessage:e.message}}))}}({esqlQuery:e,search:t,signal:a});return null!==(l=r.map((({name:e,type:t})=>({id:e,name:e,meta:{type:Object(i.c)(t),esType:t}}))))&&void 0!==l?l:[]}catch(e){throw new Error(n.i18n.translate("esqlUtils.columnsErrorMsg",{defaultMessage:"Unable to load columns. {errorMessage}",values:{errorMessage:e.message}}))}}async function r({esqlQuery:e,search:t,signal:a,filter:n,dropNullColumns:i}){const l=await Object(s.lastValueFrom)(t({params:{...n?{filter:n}:{},query:e,...i?{dropNullColumns:!0}:{}}},{abortSignal:a,strategy:"esql_async"}));return{response:l.rawResponse,params:l.requestParams}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(215);function i(e){return{allowLeadingWildcards:e.get(n.a.QUERY_ALLOW_LEADING_WILDCARDS),queryStringOptions:e.get(n.a.QUERY_STRING_OPTIONS),ignoreFilterIfFieldNotInIndex:e.get(n.a.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX),dateFormatTZ:e.get("dateFormat:tz")}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(15),i=a.n(n),s=(a(449),a(3)),l=a.n(s),r=a(0),o=a(46),u=a.n(o),c=a(663),d=a(6),p=a(454),m=a(271),g=a(4);const f={truncation:"middle"},b={asPlainText:!0};function h(e){const{activeField:t,options:a,onChoose:n,onDelete:s,fieldIsInvalid:o,"data-test-subj":h,...v}=e,[y,x]=l.a.useState(t);let j=0;const O=null==a?void 0:a.map((({compatible:e,exists:t,...a})=>a.options?{...a,options:a.options.map((({exists:e,...t})=>(t.label.length>j&&(j=t.label.length),{...t,prepend:t.value.dataType?Object(g.jsx)(p.a,{type:t.value.dataType,fill:"none",className:"eui-alignMiddle"}):null,className:u()({"lnFieldPicker__option--incompatible":!t.compatible,"lnFieldPicker__option--nonExistant":!e})})))}:{...a,compatible:e,prepend:a.value.dataType?Object(g.jsx)(p.a,{type:a.value.dataType,fill:"none",className:"eui-alignMiddle"}):null,className:u()({"lnFieldPicker__option--incompatible":!e,"lnFieldPicker__option--nonExistant":!t})}));return Object(g.jsx)(d.EuiComboBox,i()({fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":null!=h?h:"indexPattern-dimension-field",placeholder:r.i18n.translate("visualizationUiComponents.fieldPicker.fieldPlaceholder",{defaultMessage:"Select a field"}),optionMatcher:c.a,options:O,isInvalid:o,selectedOptions:y?[y]:[],singleSelection:b,truncationProps:f,inputPopoverProps:{panelMinWidth:Object(m.a)(j),anchorPosition:"downRight"},onBlur:()=>{y||x(t)},onChange:e=>{const a=e.at(0);if(!a)return x(void 0),void(null==s||s());a.value!==(null==t?void 0:t.value)&&x({label:a.label,value:a.value}),n(a.value)}},v))}},function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return r}));var n=a(44);const i=Object(n.memoize)((function(e){const t=e.trim();let a=t.split(/[* ]+/).map(n.escapeRegExp).join(".*");return t.includes(" ")&&(a=".*"+a+".*"),new RegExp(a.includes("*")?`^${a}$`:a,"i")})),s=(e,t)=>{if(null==t||!t.trim())return!1;const a=i(t);return!!e.displayName&&a.test(e.displayName)||a.test(e.name)},l=({option:{name:e,label:t},searchValue:a})=>s({name:e||t,displayName:t},a);function r(e,t){const a=(t||"").trim();return(a.includes("*")||a.includes(" "))&&s({name:e},a)?e:a}},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(15),i=a.n(n),s=(a(3),a(0)),l=a(6),r=a(648),o=a(4);const u=({idx:e,onRemoveClick:t,removeTitle:a,children:n,draggableProvided:u,isNotRemovable:c,isNotDraggable:d,isDragging:p,"data-test-subj":m="lns-fieldsBucketContainer"})=>{var g;const{euiTheme:f}=Object(l.useEuiTheme)();return Object(o.jsx)(l.EuiPanel,{paddingSize:"xs",hasShadow:p,color:p?"plain":"transparent","data-test-subj":m},Object(o.jsx)(l.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center",responsive:!1},Object(o.jsx)(l.EuiFlexItem,i()({grow:!1},null!==(g=null==u?void 0:u.dragHandleProps)&&void 0!==g?g:{}),Object(o.jsx)(r.a,{tooltipContent:s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragHandleDisabled",{defaultMessage:"Reordering requires more than one item."}),condition:null==d||d},Object(o.jsx)(l.EuiIcon,{size:"s",color:f.colors[d?"disabled":"text"],type:"grab","aria-label":s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`${m}-dragToReorder-${e}`}))),Object(o.jsx)(l.EuiFlexItem,{grow:!0,style:{minWidth:0}},n),Object(o.jsx)(l.EuiFlexItem,{grow:!1},Object(o.jsx)(r.a,{tooltipContent:s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.deleteButtonDisabled",{defaultMessage:"A minimum of one item is required."}),condition:null!=c&&c},Object(o.jsx)(l.EuiButtonIcon,{iconType:"trash",color:"danger","aria-label":a,onClick:t,"data-test-subj":`${m}-removeField-${e}`,isDisabled:c})))))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a(3);var n=a(6),i=a(4);const s=({label:e,onClick:t,isDisabled:a,className:s,"data-test-subj":l="lns-newBucket-add"})=>Object(i.jsx)(n.EuiButtonEmpty,{"data-test-subj":l,size:"xs",iconType:"plusInCircle",onClick:t,isDisabled:a,flush:"left",className:s},e)},function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a(3);var n=a(0),i=a(44),s=a(54),l=a(183),r=a(4);const o=({value:e,onChange:t,dataView:a,isInvalid:o,onSubmit:u,disableAutoFocus:c,"data-test-subj":d,placeholder:p,appName:m,services:{data:g,uiSettings:f,http:b,notifications:h,docLinks:v,storage:y,unifiedSearch:x,dataViews:j}})=>{const{inputValue:O,handleInputChange:I}=Object(l.a)({value:e,onChange:t});return Object(r.jsx)(s.QueryStringInput,{dataTestSubj:null!=d?d:"indexPattern-filters-queryStringInput",size:"s",disableAutoFocus:c,isInvalid:o,bubbleSubmitEvent:!1,indexPatterns:[a],query:O,onChange:e=>{Object(i.isEqual)(e,O)||I(e)},onSubmit:()=>{O.query&&u()},placeholder:null!=p?p:"kuery"===O.language?n.i18n.translate("visualizationUiComponents.queryInput.queryPlaceholderKql",{defaultMessage:"{example}",values:{example:'method : "GET" or status : "404"'}}):n.i18n.translate("visualizationUiComponents.queryInput.queryPlaceholderLucene",{defaultMessage:"{example}",values:{example:"method:GET OR status:404"}}),languageSwitcherPopoverAnchorPosition:"rightDown",appName:m,deps:{unifiedSearch:x,notifications:h,http:b,docLinks:v,uiSettings:f,data:g,storage:y,dataViews:j}})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(3),i=a.n(n),s=a(0),l=a(6),r=a(653),o=a(666),u=(a(493),a(4));const c=s.i18n.translate("visualizationUiComponents.filterQueryInput.label",{defaultMessage:"Filter by"}),d={query:"",language:"kuery"};function p({inputFilter:e,onChange:t,dataView:a,helpMessage:p,label:m=c,initiallyOpen:g,"data-test-subj":f,queryInputServices:b,appName:h}){const[v,y]=Object(n.useState)(Boolean(g)),x=Object(n.useCallback)((()=>{y(!1)}),[]),{isValid:j}=Object(r.b)(e,a),{isValid:O,error:I}=Object(r.b)(e,a);return Object(u.jsx)(l.EuiFormRow,{display:"rowCompressed",label:p?Object(u.jsx)(i.a.Fragment,null,m," ",Object(u.jsx)(l.EuiIconTip,{color:"subdued",content:p,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):m,fullWidth:!0,isInvalid:!j},Object(u.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(u.jsx)(l.EuiFlexItem,null,Object(u.jsx)(l.EuiPopover,{isOpen:v,closePopover:x,display:"block",panelClassName:"filterQueryInput__popover",initialFocus:f?`textarea[data-test-subj='${f}']`:void 0,button:Object(u.jsx)(l.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0},Object(u.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(u.jsx)(l.EuiFlexItem,{grow:!1}),Object(u.jsx)(l.EuiFlexItem,{grow:!0},Object(u.jsx)(l.EuiLink,{className:"filterQueryInput__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>{y(!v)},color:j?"text":"danger",title:s.i18n.translate("visualizationUiComponents.filterQueryInput.clickToEdit",{defaultMessage:"Click to edit"})},(null==e?void 0:e.query)||s.i18n.translate("visualizationUiComponents.filterQueryInput.emptyFilterQuery",{defaultMessage:"(empty)"})))))},Object(u.jsx)(l.EuiFormRow,{label:m,isInvalid:!O,error:I,fullWidth:!0,"data-test-subj":"indexPattern-filter-by-input"},Object(u.jsx)(o.a,{dataView:a.id?{type:"id",value:a.id}:{type:"title",value:a.title},disableAutoFocus:!0,value:null!=e?e:d,onChange:t,isInvalid:!O,onSubmit:()=>{},"data-test-subj":f,appName:h,services:b}))))))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a(3);var n=a(0),i=a(6),s=a(306),l=a(4);const r=({value:e,onChange:t,defaultValue:a})=>Object(l.jsx)(i.EuiFormRow,{label:n.i18n.translate("visualizationUiComponents.nameInput.columnLabel",{defaultMessage:"Name",description:"Name of a column of data"}),display:"columnCompressed",fullWidth:!0},Object(l.jsx)(s.a,{fullWidth:!0,compressed:!0,"data-test-subj":"name-input",value:e,onChange:t,defaultValue:a}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return ErrorBoundary}));var n=a(3),i=a.n(n);class ErrorBoundary extends i.a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?null:this.props.children}}},,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"getColumnsFilterable",(function(){return se})),a.d(t,"getColumnCellValueActions",(function(){return le})),a.d(t,"getDatatableRenderer",(function(){return re})),a.d(t,"getDatatableVisualization",(function(){return Fe})),a.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),a.d(t,"legacyMetricSupportedTypes",(function(){return Ze})),a.d(t,"getLegacyMetricVisualization",(function(){return tt})),a.d(t,"LegacyMetricVisualization",(function(){return LegacyMetricVisualization})),a.d(t,"DEFAULT_MAX_COLUMNS",(function(){return St})),a.d(t,"showingBar",(function(){return At})),a.d(t,"getDefaultColor",(function(){return Pt})),a.d(t,"supportedDataTypes",(function(){return _t})),a.d(t,"metricLabel",(function(){return Rt})),a.d(t,"getMetricVisualization",(function(){return qt})),a.d(t,"MetricVisualization",(function(){return MetricVisualization})),a.d(t,"isCollapsed",(function(){return ti})),a.d(t,"hasNonCollapsedSliceBy",(function(){return ai})),a.d(t,"getDefaultColorForMultiMetricDimension",(function(){return ni})),a.d(t,"getPieVisualization",(function(){return ii})),a.d(t,"PieVisualization",(function(){return PieVisualization})),a.d(t,"YAxisModes",(function(){return si.YAxisModes})),a.d(t,"SeriesTypes",(function(){return si.SeriesTypes})),a.d(t,"visualizationTypes",(function(){return si.visualizationTypes})),a.d(t,"getXyVisualization",(function(){return nr})),a.d(t,"XyVisualization",(function(){return xy_XyVisualization})),a.d(t,"isBucketed",(function(){return Mr})),a.d(t,"filterOperationsAxis",(function(){return Tr})),a.d(t,"isCellValueSupported",(function(){return wr})),a.d(t,"getHeatmapVisualization",(function(){return Er})),a.d(t,"HeatmapVisualization",(function(){return HeatmapVisualization})),a.d(t,"isNumericMetric",(function(){return Hr})),a.d(t,"isNumericDynamicMetric",(function(){return Ur})),a.d(t,"CHART_NAMES",(function(){return Wr})),a.d(t,"getGaugeVisualization",(function(){return Yr})),a.d(t,"GaugeVisualization",(function(){return gauge_GaugeVisualization})),a.d(t,"getTagcloudVisualization",(function(){return oo})),a.d(t,"TagcloudVisualization",(function(){return TagcloudVisualization})),a.d(t,"getEditLensConfiguration",(function(){return eu})),a.d(t,"deleteColumn",(function(){return Rp})),a.d(t,"removeColumn",(function(){return ny})),a.d(t,"columnToOperation",(function(){return iy})),a.d(t,"getSuffixFormatter",(function(){return tg})),a.d(t,"unitSuffixesLong",(function(){return Jm})),a.d(t,"suffixFormatterId",(function(){return eg})),a.d(t,"getFormBasedDatasource",(function(){return sy})),a.d(t,"getTextBasedDatasource",(function(){return jy})),a.d(t,"createFormulaPublicApi",(function(){return Iy})),a.d(t,"ChartType",(function(){return qo})),a.d(t,"suggestionsApi",(function(){return $o})),a.d(t,"TextBasedDatasource",(function(){return text_based_TextBasedDatasource})),a.d(t,"FormBasedDatasource",(function(){return form_based_FormBasedDatasource})),a.d(t,"setUsageCollectionStart",(function(){return d.c})),a.d(t,"getUsageCollectionStart",(function(){return d.b})),a.d(t,"trackUiCounterEvents",(function(){return d.d})),a.d(t,"getExecutionContextEvents",(function(){return d.a})),a.d(t,"ErrorBoundary",(function(){return fv.a})),a.d(t,"initMemoizedErrorNotification",(function(){return fv.b})),a.d(t,"showMemoizedErrorNotification",(function(){return fv.c})),a.d(t,"EditorFrame",(function(){return My.a})),a.d(t,"initializeDataViews",(function(){return My.c})),a.d(t,"initializeSources",(function(){return My.e})),a.d(t,"initializeVisualization",(function(){return My.f})),a.d(t,"initializeDatasources",(function(){return My.d})),a.d(t,"persistedStateToExpression",(function(){return My.g})),a.d(t,"getMissingIndexPattern",(function(){return My.b})),a.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),a.d(t,"Embeddable",(function(){return embeddable_Embeddable})),a.d(t,"isLensApi",(function(){return qy.a})),a.d(t,"getLensServices",(function(){return px})),a.d(t,"mountApp",(function(){return mx})),a.d(t,"savedObjectToEmbeddableAttributes",(function(){return gx.b})),a.d(t,"getLensAttributeService",(function(){return gx.a})),a.d(t,"SaveModalContainer",(function(){return rx.SaveModalContainer})),a.d(t,"runSaveLensVisualization",(function(){return rx.runSaveLensVisualization})),a.d(t,"removePinnedFilters",(function(){return rx.removePinnedFilters})),a.d(t,"createChartInfoApi",(function(){return fx})),a.d(t,"isCompatible",(function(){return bx})),a.d(t,"getHref",(function(){return vx})),a.d(t,"getLocation",(function(){return yx})),a.d(t,"execute",(function(){return xx})),a.d(t,"isEditActionCompatible",(function(){return Ox})),a.d(t,"executeEditAction",(function(){return Ix})),a.d(t,"getVisualizationMap",(function(){return Tx})),a.d(t,"setVisualizationMap",(function(){return wx})),a.d(t,"getDatasourceMap",(function(){return kx})),a.d(t,"setDatasourceMap",(function(){return Ex})),a.d(t,"isCreateActionCompatible",(function(){return Cx})),a.d(t,"executeCreateAction",(function(){return Fx})),a.d(t,"isEmbeddableEditActionCompatible",(function(){return Sx})),a.d(t,"executeEditEmbeddableAction",(function(){return Ax}));var n=a(15),i=a.n(n),s=a(3),l=a.n(s),r=a(14),o=a.n(r),u=a(0),c=a(27),d=a(95),p=(a(250),a(265)),m=a(190),g=a.n(m),f=a(6),b=a(73),h=a(87),v=a(4);const y=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M11 18a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V7a1 1 0 011-1h10zm18-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h28z",className:h.a.subdued}),Object(v.jsx)("path",{d:"M20 18a1 1 0 011 1v2a1 1 0 01-.883.993L20 22h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 16h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 10h-5a1 1 0 01-1-1V7a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1V7a1 1 0 011-1h5z",className:h.a.accent}));var x=a(108),j=(a(255),a(46)),O=a.n(j);function I({children:e,className:t,...a}){return Object(v.jsx)("div",i()({"data-test-subj":"lnsVisualizationContainer",className:O()(t,"lnsVisualizationContainer")},a),e)}var M=a(85),T=a(187),w=a(102),k=a.n(w);const E=k()((function(e){return e.columns.reduce(((e,{id:t,name:a,meta:n},i)=>(e[t]={name:a,index:i,meta:n},e)),{})}));var C=a(125);var F=a(26),S=a.n(F),A=a(98),P=a(157),_=a(278),L=a.n(_),D=a(279),R=a.n(D),N=a(285),B=a.n(N),z=a(20),V=a.n(z);const G=e=>null==e||"number"==typeof e&&Number.isNaN(e),q=(e,t)=>G(e)?G(t)?0:-1:G(t)?1:void 0,$=(e,t)=>{var a;return null!==(a=q(e,t))&&void 0!==a?a:e-t},H=(e,t)=>{const a=V()(e),n=V()(t);return!a.isValid()||G(e)?!n.isValid()||G(t)?0:-1:!n.isValid()||G(t)?1:a.isSame(n)?0:a.isBefore(n)?-1:1},U=(e,t,a,n)=>{var i;const s=n.convert(e),l=n.convert(t);return null!==(i=q(e,t))&&void 0!==i?i:s.localeCompare(l)},W=(e,t,a)=>{const n=X(e,a),i=X(t,a);let s=0,l=n.parts[s]-i.parts[s];for(;!l&&s<7;)s++,l=n.parts[s]-i.parts[s];return 0===l?(e?e.length:40)-(t?t.length:40):l};function X(e,t){if(G(e)||!B.a.isValid(e)){const a=null==e?-1:t;return{parts:Array(8).fill(a*(1/0))}}const a=B.a.parse(e);return function(e){return"ipv6"===e.kind()}(a)?a:a.toIPv4MappedAddress()}const Y=(e,t,a)=>{const n=String(null==e?"":e),i=String(null==t?"":t),s=!n||!R()(n),l=!i||!R()(i);return s&&l?null==e&&e!==t?-1*a:null==t&&e!==t?1*a:0:s?1*a:l?-1*a:L()(n,i)},Q={gte:-1/0,lt:1/0},K=(e,t)=>{const a={...Q,...e},n={...Q,...t},i=a.gte-n.gte,s=a.lt-n.lt;return i||s||0};function Z(e,t){return(a,n,i)=>{const s=null==a?void 0:a[e],l=null==n?void 0:n[e];return null==s||Number.isNaN(s)?null==l||Number.isNaN(l)?0:1:null==l||Number.isNaN(l)?-1:t(a,n,i)}}const J=(e,t,a,n)=>{const i=E(a);return e.map((e=>{const s=function({columnConfig:e,columnId:t,lookup:a}){var n,i,s,l;const r=null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.sortingHint;return null!=r?r:"range"===(null==(o=null===(i=a[t])||void 0===i?void 0:i.meta)||null===(u=o.params)||void 0===u?void 0:u.id)?"range":null===(s=a[t])||void 0===s||null===(l=s.meta)||void 0===l?void 0:l.type;var o,u}({columnConfig:t,columnId:e.id,lookup:i}),l=function(e,t,a){const n=function(e,t){return function(a){return(n,i,s)=>{const l="asc"===s?1:-1,r=null==n?n:n[e],o=null==i?i:i[e];return Array.isArray(r)||Array.isArray(o)?l*function(e,t,a,n,i){const s=Math.max(e.length,t.length);for(let l=0;l<s;l++){const s=i(e[l],t[l],a,n);if(0!==s)return s}return 0}(Array.isArray(r)?r:[r],Array.isArray(o)?o:[o],l,t,a):l*a(r,o,l,t)}}}(t,a);return"date"===e?Z(t,n(H)):"number"===e?Z(t,n($)):"range"===e?Z(t,n(K)):"ip"===e?Z(t,n(W)):"version"===e?n(Y):Z(t,n(U))}(s,e.id,null==n?void 0:n[e.id]);return{sortTextAsc:u.i18n.translate("xpack.lens.datatable.sortTextAsc",{defaultMessage:"Sort Ascending"}),sortTextDesc:u.i18n.translate("xpack.lens.datatable.sortTextDesc",{defaultMessage:"Sort Descending"}),icon:"",type:e.id,detector:()=>1,comparator:(e,t,n,{aIndex:i,bIndex:s})=>l(a.rows[i],a.rows[s],n),defaultSortDirection:t.sortingColumnId===e.id&&"none"!==t.sortingDirection?t.sortingDirection:void 0}}))};var ee=a(127);const te=l.a.createContext({}),ae={border:"horizontal",header:"underline"},ne=[10,20,30,50,100],ie=e=>{var t,a,n;const i=Object(s.useRef)(null),l=e.interactive,[r,o]=Object(s.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[c,d]=Object(s.useState)(e.data),[m,h]=Object(s.useState)(void 0);Object(s.useLayoutEffect)((()=>{setTimeout((()=>{e.renderComplete()}),300)}),[e]),Object(s.useEffect)((()=>{var t;h(e.args.pageSize?{pageIndex:0,pageSize:null!==(t=e.args.pageSize)&&void 0!==t?t:10}:void 0)}),[e.args.pageSize]),g()((()=>{o({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),g()((()=>{d(e.data)}),[e.data]);const j=Object(s.useRef)(c);j.current=c,Object(s.useEffect)((()=>{if(!(null!=m&&m.pageIndex||null!=m&&m.pageSize))return;const e=c.rows.length?Math.ceil(c.rows.length/m.pageSize)-1:0;h((t=>t?{pageIndex:t.pageIndex>e?e:t.pageIndex,pageSize:t.pageSize}:t))}),[null==m?void 0:m.pageIndex,null==m?void 0:m.pageSize,c.rows.length]);const w=Object(s.useRef)(e.untransposedData);w.current=e.untransposedData;const k=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:F,dispatchEvent:_,renderMode:L,formatFactory:D}=e,R=Object(s.useMemo)((()=>c.columns.reduce(((e,t)=>{var a;return{...e,[t.id]:D(null===(a=t.meta)||void 0===a?void 0:a.params)}}),{})),[c,D]),N=Object(s.useCallback)((e=>{_({name:"filter",data:e})}),[_]),B=Object(s.useCallback)((e=>{_({name:"edit",data:e})}),[_]),z=Object(s.useCallback)((e=>B({action:"pagesize",size:e})),[B]),V=Object(s.useCallback)((e=>{h((t=>{if(t)return{pageSize:null==t?void 0:t.pageSize,pageIndex:e}}))}),[h]),G=Object(s.useCallback)((e=>{_({name:"tableRowContextMenuClick",data:e})}),[_]),q=Object(s.useMemo)((()=>l?((e,t)=>(a,n,i,s,l=!1)=>{const r={negate:l,data:[{row:s,column:i,value:n,table:e.current}]};t(r)})(j,N):void 0),[j,N,l]),$=Object(s.useMemo)((()=>l?e.columnCellValueActions:void 0),[e.columnCellValueActions,l]),H=Object(s.useMemo)((()=>l?((e,t)=>(a,n=!1)=>{if(!t.current)return;const i=t.current,s={negate:n,data:a.map((({originalBucketColumn:e,value:t})=>{const a=i.columns.findIndex((t=>t.id===e.id));return{row:i.rows.findIndex((a=>a[e.id]===t)),column:a,value:t,table:i}}))};e(s)})(N,w):void 0),[N,w,l]),U=Object(s.useMemo)((()=>r.columns.filter(((e,t)=>{var a,n,i;const s=j.current.columns[t];return(null==s||null===(a=s.meta)||void 0===a||null===(n=a.sourceParams)||void 0===n?void 0:n.type)&&"buckets"===(null===(i=F(s.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[j,r,F]),W=0===c.rows.length||U.length&&e.data.rows.every((e=>U.every((t=>null==e[t])))),X=Object(s.useMemo)((()=>r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[r]),Y="edit"!==L,Q=Object(s.useMemo)((()=>((e,t,a)=>n=>{const i=Object(A.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,width:n.width}:e))}),a({action:"resize",columnId:i,width:n.width})})(r,o,B)),[B,o,r]),K=Object(s.useMemo)((()=>l?((e,t,a)=>n=>{const i=Object(A.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),a({action:"toggle",columnId:i})})(r,o,B):void 0),[B,o,r,l]),Z=Object(s.useMemo)((()=>c.columns.reduce(((e,t)=>({...e,[t.id]:"number"===t.meta.type})),{})),[c]),ie=Object(s.useMemo)((()=>{const e={};return r.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=Z[t.columnId]?"right":"left"})),e}),[r,Z]),se=Object(s.useMemo)((()=>Object(M.q)(r.columns.filter((({columnId:e})=>Z[e])).map((({columnId:e})=>e)),e.data,A.a)),[e.data,Z,r]),le=null!==(a=e.args.headerRowHeight)&&void 0!==a?a:C.a,re=null!==(n=e.args.headerRowHeightLines)&&void 0!==n?n:C.b,oe=Object(s.useMemo)((()=>{var t;return((e,t,a,n,i,s,l,r,o,c,d,p,m,g,f,b)=>{const h=E(t),y=({rowIndex:e,columnId:a})=>{var n,i;const s=null===(n=t.rows[e])||void 0===n?void 0:n[a],l=null==h?void 0:h[a];return{rowValue:s,contentsIsDefined:null!=s,cellContent:r(null==l||null===(i=l.meta)||void 0===i?void 0:i.params).convert(s)}};return l.map((e=>{var r;const{name:j,index:O}=h[e],I=(null==b?void 0:b[O])||!1,M=s.columns.find((({columnId:t})=>t===e)),w=[],k=null!==(r=null==g?void 0:g[O])&&void 0!==r?r:[];k.some((({type:e})=>e===T.a))||!I||!a||null!=M&&M.oneClickFilter||w.push((({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:r}=y({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for: {cellContent}",values:{cellContent:r}});return l?Object(v.jsx)(i,{"aria-label":c,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{a(e,s,O,t),null==f||f()},iconType:"plusInCircle"},o):null}),(({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:r}=y({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out: {cellContent}",values:{cellContent:r}});return l?Object(v.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":c,onClick:()=>{a(e,s,O,t,!0),null==f||f()},iconType:"minusInCircle"},o):null})),k.forEach((e=>{w.push((({rowIndex:a,columnId:n,Component:i})=>{const s=t.rows[a][n],l={value:s,columnMeta:h[n].meta};return null==s?null:Object(v.jsx)(i,{"aria-label":e.displayName,"data-test-subj":`lensDatatableCellAction-${e.id}`,onClick:()=>{e.execute([l]),null==f||f()},iconType:e.iconType},e.displayName)}))}));const E=Boolean(null==M?void 0:M.originalColumnId),F=null==M?void 0:M.width,S=null==M?void 0:M.hidden,A=null==M?void 0:M.originalColumnId,P=[];if(P.push({color:"text",size:"xs",onClick:()=>o({columnId:A||e,width:void 0}),iconType:"empty",label:u.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==F}),!E&&c&&P.push({color:"text",size:"xs",onClick:()=>c({columnId:A||e}),iconType:"eyeClosed",label:u.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!S&&l.length<=1}),!i&&E&&null!=M&&M.bucketValues&&n){const e=null==M?void 0:M.bucketValues;P.push({color:"text",size:"xs",onClick:()=>n(e,!1),iconType:"plusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for"}),"data-test-subj":"lensDatatableHide"}),P.push({color:"text",size:"xs",onClick:()=>n(e,!0),iconType:"minusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out"}),"data-test-subj":"lensDatatableHide"})}const _=d&&d[e],L=[x.b.auto,x.b.custom,void 0].includes(p),D=Object(v.css)({...(p===C.a||void 0===p)&&{WebkitLineClamp:m},...L&&{whiteSpace:"normal",display:"-webkit-box",WebkitBoxOrient:"vertical"},textAlign:_},"",""),R={id:e,cellActions:w,visibleCellActions:5,display:Object(v.jsx)("div",{css:D},j),displayAsText:j,schema:e,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:{label:u.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:{label:u.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:P}};return F&&(R.initialWidth=F),R}))})(0,c,q,H,Y,r,X,D,Q,K,ie,le,re,$,null===(t=i.current)||void 0===t?void 0:t.closeCellPopover,e.columnFilterable)}),[U,c,q,H,Y,r,X,D,Q,K,ie,le,re,$,e.columnFilterable]),ue=Object(s.useMemo)((()=>J(oe,r,c,R)),[oe,c,r,R]),ce=Object(s.useMemo)((()=>k&&G&&l?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(s.useContext)(te);return Object(v.jsx)(f.EuiButtonIcon,{"aria-label":u.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{G({rowIndex:e,table:j.current,columns:r.columns.map((e=>e.columnId))})}})}}]:[]),[j,G,r,k,l]),de=Object(s.useMemo)((()=>((e,t,a,n,i)=>({rowIndex:l,columnId:r,setCellProps:o})=>{var u,c;const{table:d,alignments:p,minMaxByColumnId:m,getColorForValue:g,handleFilterClick:b}=Object(s.useContext)(a),h=S()(n.theme$,{darkMode:!1}).darkMode,y=null==d||null===(u=d.rows[l])||void 0===u?void 0:u[r],x=t.columns.findIndex((({columnId:e})=>e===r)),{colorMode:j,palette:I,oneClickFilter:M}=t.columns[x]||{},T=M&&b,w=null===(c=e[r])||void 0===c?void 0:c.convert(y,T?"text":"html"),k=p&&p[r];return Object(s.useEffect)((()=>{const e=Object(A.a)(r);if(null!=m&&m[e]&&"none"!==j&&null!=I&&I.params&&g){const t=g(Object(P.d)(y),I.params,m[e]);if(t){const e={["cell"===j?"backgroundColor":"color"]:t};"cell"===j&&t&&(e.color=Object(P.c)(t,h)),o({style:e})}}return()=>{null!=m&&m[e]&&o({style:{backgroundColor:void 0,color:void 0}})}}),[y,r,o,j,I,m,g,h]),T?Object(v.jsx)("div",{"data-test-subj":"lnsTableCellContent",className:O()({"lnsTableCell--multiline":i,[`lnsTableCell--${k}`]:!0})},Object(v.jsx)(f.EuiLink,{onClick:()=>{null==b||b(r,y,x,l)}},w)):Object(v.jsx)("div",{dangerouslySetInnerHTML:{__html:w},"data-test-subj":"lnsTableCellContent",className:O()({"lnsTableCell--multiline":i,[`lnsTableCell--${k}`]:!0})})})(R,r,te,e.theme,e.args.fitRowToContent)),[R,r,e.theme,e.args.fitRowToContent]),pe=Object(s.useMemo)((()=>({visibleColumns:X,setVisibleColumns:()=>{}})),[X]),me=Object(s.useMemo)((()=>((e,t,a)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const n=t.length<=1?t[0]:t[1],i=e!==((null==n?void 0:n.id)||""),s=n?n.direction:"none";return a({action:"sort",columnId:"none"!==s||i?null==n?void 0:n.id:void 0,direction:s})}}))(r.sortingColumnId,r.sortingDirection,B)),[B,r]),ge=Object(s.useMemo)((()=>{const t=r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((t=>({columnId:t.columnId,summaryRowValue:t.summaryRowValue,...Object(ee.c)(t.columnId,t,e.data)}))).filter((({summaryRow:e})=>"none"!==e));if(t.length){const e=Object.fromEntries(t.map((({summaryRowValue:e,summaryLabel:t,columnId:a})=>[a,""===t?`${e}`:`${t}: ${e}`])));return({columnId:t})=>{var a,n;const i=`lnsTableCell--${ie&&ie[t]}`,s=(null===(a=oe.find((({id:e})=>e===t)))||void 0===a||null===(n=a.displayAsText)||void 0===n?void 0:n.replace(/ /g,"-"))||t;return null!=e[t]?Object(v.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${s}`},e[t]):null}}}),[r.columns,ie,e.data,oe]);if(W)return Object(v.jsx)(I,{className:"lnsDataTableContainer"},Object(v.jsx)(b.EmptyPlaceholder,{icon:y}));const fe=e.args.title||u.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(v.jsx)(I,{className:"lnsDataTableContainer"},Object(v.jsx)(te.Provider,{value:{table:c,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:ie,minMaxByColumnId:se,getColorForValue:e.paletteService.get(p.b).getColorForValue,handleFilterClick:q}},Object(v.jsx)(f.EuiDataGrid,{"aria-label":fe,"data-test-subj":"lnsDataTable",rowHeightsOptions:{defaultHeight:e.args.fitRowToContent?x.b.auto:e.args.rowHeightLines&&1!==e.args.rowHeightLines?{lineCount:e.args.rowHeightLines}:void 0},inMemory:{level:"sorting"},columns:oe,columnVisibility:pe,trailingControlColumns:ce,rowCount:c.rows.length,renderCellValue:de,gridStyle:ae,schemaDetectors:ue,sorting:me,pagination:m&&{...m,pageSizeOptions:ne,onChangeItemsPerPage:z,onChangePage:V},onColumnResize:Q,toolbarVisibility:!1,renderFooterCellValue:ge,ref:i})))};async function se(e,t){if(!e.rows.length)return;const a=e.columns.map(((t,a)=>{const n=e.rows.findIndex((e=>null!=e[t.id]));return[n>-1?n:0,a]}));return Promise.all(a.map((async([a,n])=>{var i;return Boolean(await(null===(i=t.hasCompatibleActions)||void 0===i?void 0:i.call(t,{name:"filter",data:{data:[{table:e,column:n,row:a}]}})))})))}async function le(e,t){return e.data&&t?Promise.all(e.data.columns.map((({meta:e})=>{try{return t([{columnMeta:e}])}catch{return[]}}))):[]}const re=e=>({name:"lens_datatable_renderer",displayName:u.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,a,n)=>{n.onDestroy((()=>o.a.unmountComponentAtNode(t)));const s=await e.getType,{hasCompatibleActions:l,isInteractive:r,getCompatibleCellValueActions:u}=n;n.event({name:"chartSize",data:{maxDimensions:{x:{value:100,unit:"percentage"},y:{value:100,unit:"percentage"}}}});let p=[];l&&a.data&&(p=await Promise.all(a.data.rows.map((async(e,t)=>{try{return await l({name:"tableRowContextMenuClick",data:{rowIndex:t,table:a.data,columns:a.args.columns.map((e=>e.columnId))}})}catch{return!1}}))));const[m]=await e.core.getStartServices(),[g,f]=await Promise.all([le(a,u),se(a.data,n)]);o.a.render(Object(v.jsx)(c.a,m,Object(v.jsx)(ie,i()({},a,{formatFactory:e.formatFactory,dispatchEvent:n.event,renderMode:n.getRenderMode(),paletteService:e.paletteService,getType:s,rowHasRowClickTriggerActions:p,columnCellValueActions:g,columnFilterable:f,interactive:r(),theme:e.core.theme,renderComplete:()=>{Object(d.d)("table",n.getExecutionContext()),n.done()}}))),t)}});var oe=a(8),ue=a(47),ce=a(51),de=a(100),pe=a(689);const me=l.a.lazy((()=>a.e(13).then(a.bind(null,684)))),ge=Object(pe.a)(me);a(195);const fe=[{text:u.i18n.translate("xpack.lens.collapse.none",{defaultMessage:"None"}),value:""},{text:u.i18n.translate("xpack.lens.collapse.sum",{defaultMessage:"Sum"}),value:"sum"},{text:u.i18n.translate("xpack.lens.collapse.min",{defaultMessage:"Min"}),value:"min"},{text:u.i18n.translate("xpack.lens.collapse.max",{defaultMessage:"Max"}),value:"max"},{text:u.i18n.translate("xpack.lens.collapse.avg",{defaultMessage:"Average"}),value:"avg"}];function be({value:e,onChange:t}){return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{id:"lns-indexPattern-collapse-by",label:Object(v.jsx)(f.EuiToolTip,{delay:"long",position:"top",content:u.i18n.translate("xpack.lens.collapse.infoIcon",{defaultMessage:"Do not show this dimension in the visualization and aggregate all metric values which have the same value for this dimension into a single number."})},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.collapse.label",{defaultMessage:"Collapse by"}),"",Object(v.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))),display:"rowCompressed",fullWidth:!0},Object(v.jsx)(f.EuiSelect,{fullWidth:!0,compressed:!0,"data-test-subj":"indexPattern-collapse-by",options:fe,value:e,onChange:e=>{t(e.target.value)}})))}const he=Object(f.htmlIdGenerator)()();function ve(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function ye(e){var t,a;const{state:n,setState:i,frame:s,accessor:r,isInlineEditing:o}=e,c=n.columns.find((({columnId:e})=>r===e));if(!c)return null;if(c.isTransposed)return null;const d=null===(t=s.activeData)||void 0===t?void 0:t[n.layerId],p=Object(de.a)(d,r),m=(null==c?void 0:c.alignment)||(p?"right":"left"),g=(null==c?void 0:c.colorMode)||"none",b="none"!==g,h=s.datasourceLayers[n.layerId],y=Boolean(p&&!(null!=h&&null!==(a=h.getOperationForColumnId(r))&&void 0!==a&&a.isBucketed)),x=n.columns.filter((e=>!e.hidden)).length,j=n.columns.some((({isTransposed:e})=>e))?(null==d?void 0:d.columns.filter((({id:e})=>Object(A.a)(e)===r)).map((({id:e})=>e)))||[]:[r],O=Object(M.q)(j,d,A.a)[r],I=(null==c?void 0:c.palette)||{type:"palette",name:M.o.name},T=Object(M.m)(e.paletteService,I,O);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",buttonSize:"compressed",options:[{id:`${he}left`,label:u.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${he}center`,label:u.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${he}right`,label:u.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${he}${m}`,onChange:e=>{const t=e.replace(he,"");i({...n,columns:ve(n,r,{alignment:t})})}})),y&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",buttonSize:"compressed",options:[{id:`${he}none`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${he}cell`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${he}text`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${he}${g}`,onChange:e=>{const t=e.replace(he,""),a={colorMode:t};null!=c&&c.palette||"none"===t||(a.palette={...I,params:{...I.params,stops:T}}),null!=c&&c.palette&&"none"===t&&(a.palette=void 0),i({...n,columns:ve(n,r,a)})}})),b&&Object(v.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(v.jsx)(M.f,{palette:T.map((({color:e})=>e)),siblingRef:e.panelRef,isInlineEditing:o},Object(v.jsx)(ge,{palettes:e.paletteService,activePalette:I,dataBounds:O,setPalette:e=>{i({...n,columns:ve(n,r,{palette:e})})}})))),!c.isTransposed&&Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(v.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==c?void 0:c.hidden),disabled:!c.hidden&&x<=1,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===r?{...e,hidden:!c.hidden}:e))};i(e)}})),"rows"===e.groupId&&Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),display:"columnCompressedSwitch"},Object(v.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),showLabel:!1,"data-test-subj":"lns-table-column-one-click-filter",checked:Boolean(null==c?void 0:c.oneClickFilter),disabled:c.hidden,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===r?{...e,oneClickFilter:!c.oneClickFilter}:e))};i(e)}})))}function xe(e){const{state:t,setState:a,accessor:n}=e,i=t.columns.find((({columnId:e})=>n===e));return i?i.isTransposed?null:Object(v.jsx)(l.a.Fragment,null,"rows"===e.groupId&&Object(v.jsx)(be,{value:i.collapseFn||"",onChange:e=>{a({...t,columns:ve(t,n,{collapseFn:e})})}})):null}var je=a(183);function Oe(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function Ie(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,o=a.columns.find((({columnId:e})=>r===e)),c=Object(s.useCallback)((e=>{n({...a,columns:Oe(a,r,{summaryLabel:e})})}),[r,n,a]),{inputValue:d,handleInputChange:p}=Object(je.a)({onChange:c,value:null==o?void 0:o.summaryLabel},{allowFalsyValue:!0}),{euiTheme:m}=Object(f.useEuiTheme)();if(!o)return null;if(o.isTransposed)return null;const g=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],b=Object(de.a)(g,r),{summaryRow:h,summaryLabel:y}=Object(ee.c)(r,o,g);return Object(v.jsx)(l.a.Fragment,null,b&&Object(v.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(v.jsx)(f.EuiText,{size:"s",css:Object(v.css)("margin-bottom:",m.size.base,";","")},Object(v.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingSummary",{defaultMessage:"Summary"}))),Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(v.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(ee.d)(),selectedOptions:[{label:Object(ee.b)(h),value:h}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;n({...a,columns:Oe(a,r,{summaryRow:t})})}})),"none"!==h&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(v.jsx)(f.EuiFieldText,{fullWidth:!0,compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=d?d:y,onChange:e=>{p(e.target.value)}})))))}var Me=a(45);let Te=function(e){return e.auto="auto",e.single="single",e.custom="custom",e}({});const we=Object(f.htmlIdGenerator)()();function ke({label:e,rowHeight:t,rowHeightLines:a,compressed:n,onChangeRowHeight:i,onChangeRowHeightLines:s,maxRowHeight:r,"data-test-subj":o}){const c=[{id:`${we}${Te.single}`,label:u.i18n.translate("unifiedDataTable.rowHeight.single",{defaultMessage:"Single"}),"data-test-subj":`${o}_rowHeight_${Te.single}`},{id:`${we}${Te.auto}`,label:u.i18n.translate("unifiedDataTable.rowHeight.auto",{defaultMessage:"Auto fit"}),"data-test-subj":`${o}_rowHeight_${Te.auto}`},{id:`${we}${Te.custom}`,label:u.i18n.translate("unifiedDataTable.rowHeight.custom",{defaultMessage:"Custom"}),"data-test-subj":`${o}_rowHeight_${Te.custom}`}];return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{label:e,display:"columnCompressed","data-test-subj":o},Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:e,buttonSize:"compressed",options:c,idSelected:`${we}${null!=t?t:Te.single}`,onChange:e=>{const t=e.replace(we,"");i(t)},"data-test-subj":`${o}_rowHeightButtonGroup`}),t===Te.custom?Object(v.jsx)(f.EuiRange,{compressed:!0,fullWidth:!0,showInput:!0,min:1,max:null!=r?r:20,step:1,value:null!=a?a:2,onChange:e=>{const t=Number(e.currentTarget.value);s(t)},"data-test-subj":`${o}_lineCountNumber`,css:Object(v.css)({marginTop:n?Me.euiThemeVars.euiSizeXS:Me.euiThemeVars.euiSizeM},"","")}):null)))}function Ee(e){var t,a,n;const{state:i,setState:l}=e,r=Object(s.useCallback)(((e,t,a,n=C.d)=>{const s=e===x.b.single?1:e!==x.b.auto?n:void 0;l({...i,[t]:e,[a]:s})}),[l,i]),o=Object(s.useCallback)(((e,t)=>{l({...i,[t]:e})}),[l,i]),c=Object(s.useCallback)((()=>{var e;const t=null!==(e=i.paging)&&void 0!==e?e:{size:10,enabled:!1};l({...i,paging:{...t,enabled:!t.enabled}})}),[l,i]);return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.table.valuesVisualOptions",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(v.jsx)(ke,{rowHeight:null!==(t=i.headerRowHeight)&&void 0!==t?t:C.a,rowHeightLines:null!==(a=i.headerRowHeightLines)&&void 0!==a?a:C.b,label:u.i18n.translate("xpack.lens.table.visualOptionsHeaderRowHeightLabel",{defaultMessage:"Header row height"}),onChangeRowHeight:e=>r(e,"headerRowHeight","headerRowHeightLines",C.b),onChangeRowHeightLines:e=>{o(e,"headerRowHeightLines")},"data-test-subj":"lnsHeaderHeightSettings",maxRowHeight:5,compressed:!0}),Object(v.jsx)(ke,{rowHeight:i.rowHeight,rowHeightLines:i.rowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsFitRowToContentLabel",{defaultMessage:"Cell row height"}),onChangeRowHeight:e=>r(e,"rowHeight","rowHeightLines"),onChangeRowHeightLines:e=>{o(e,"rowHeightLines")},"data-test-subj":"lnsRowHeightSettings",compressed:!0}),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTable",{defaultMessage:"Paginate table"}),display:"columnCompressedSwitch"},Object(v.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTableTooltip",{defaultMessage:"Pagination is hidden if there are less than 10 items"}),position:"right"},Object(v.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":"lens-table-pagination-switch",label:"",showLabel:!1,checked:Boolean(null===(n=i.paging)||void 0===n?void 0:n.enabled),onChange:c})))))}const Ce=u.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),Fe=({paletteService:e,theme:t})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:y,label:Ce,groupLabel:u.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular"}),sortPriority:5}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:y,label:Ce}),switchVisualizationType:(e,t)=>t,triggers:[oe.VIS_EVENT_TO_TRIGGER.filter,oe.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick],initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:ue.LayerTypes.DATA},getSuggestions({table:e,state:t,keptLayerIds:a}){if(a.length>1||a.length&&e.layerId!==a[0]||t&&"unchanged"===e.changeType||e.columns.some((e=>e.operation.isStaticValue)))return[];const n={};t&&t.columns.forEach((e=>{n[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!(!n[e.columnId]||null!==(t=n[e.columnId])&&void 0!==t&&t.isTransposed)})),s=null==t?void 0:t.columns.some((e=>e.isTransposed)),l="unchanged"===e.changeType?u.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):u.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),r=e.changeType,o="reduced"===r||"layers"===r?.3:"unchanged"===r?.5:1;return[{title:l,score:Boolean(null==e?void 0:e.notAssignedMetrics)?1:Math.min(e.columns.length,10)/10*.4*o,state:{...t||{},layerId:e.layerId,layerType:ue.LayerTypes.DATA,columns:e.columns.map(((e,t)=>({...n[e.columnId]||{},isTransposed:s&&t<i,columnId:e.columnId})))},previewIcon:y,hide:!0}]},getConfiguration({state:e,frame:t,layerId:a}){const{sortedColumns:n,datasource:i}=Se(e,t.datasourceLayers)||{},s={};if(e.columns.forEach((e=>{s[e.columnId]=e})),!n)return{groups:[]};const l=null==i?void 0:i.isTextBasedLanguage();return{groups:[{groupId:"rows",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:n.filter((t=>{var a;const n=e.columns.find((e=>e.columnId===t));var s;return l?!(null!==(s=i.getOperationForColumnId(t))&&void 0!==s&&s.inMetricDimension||null!=n&&n.isMetric||null!=n&&n.isTransposed):(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&!(null!=n&&n.isTransposed)})).map((e=>({columnId:e,triggerIconType:s[e].hidden?"invisible":s[e].collapseFn?"aggregate":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumn",{defaultMessage:"Split metrics by"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n,s;return l?null===(s=e.columns.find((e=>e.columnId===t)))||void 0===s?void 0:s.isTransposed:(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:u.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.datatable.headingLabel",{defaultMessage:"Value"})},layerId:e.layerId,accessors:n.filter((t=>{const a=i.getOperationForColumnId(t);var n;return l?(null==a?void 0:a.inMetricDimension)||(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isMetric):!(null!=a&&a.isBucketed)})).map((a=>{var n,i,l;const r=s[a],o=null==r||null===(n=r.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops,u=Boolean(a&&Object(de.a)(null===(l=t.activeData)||void 0===l?void 0:l[e.layerId],a)),c=Boolean("none"!==(null==r?void 0:r.colorMode)&&o);return{columnId:a,triggerIconType:null!=r&&r.hidden?"invisible":c&&u?"colorBy":void 0,palette:c&&u&&o?o.map((({color:e})=>e)):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,isMetricDimension:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}},setDimension:({prevState:e,columnId:t,groupId:a,previousColumn:n})=>e.columns.some((e=>e.columnId===t||n&&e.columnId===n))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===n?{...e,columnId:t,isTransposed:"columns"===a,isMetric:"metrics"===a}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===a,isMetric:"metrics"===a}]},removeDimension({prevState:e,columnId:t}){var a;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(a=e.sorting)||void 0===a?void 0:a.columnId)===t?void 0:e.sorting}},DimensionEditorComponent:t=>Object(v.jsx)(ye,i()({},t,{paletteService:e})),DimensionEditorAdditionalSectionComponent:t=>Object(v.jsx)(Ie,i()({},t,{paletteService:e})),DimensionEditorDataExtraComponent:t=>Object(v.jsx)(xe,i()({},t,{paletteService:e})),getSupportedLayers:()=>[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,{title:n,description:i}={},s={}){var l,r,o,u,c,d,m;const{sortedColumns:g,datasource:f}=Se(t,a,t.layerId)||{},b=null==f?void 0:f.isTextBasedLanguage();if(null!=g&&g.length&&!b&&0===g.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;if(!s||0===Object.keys(s).length)return null;const h={};t.columns.forEach((e=>{h[e.columnId]=e}));const v=g.filter((e=>f.getOperationForColumnId(e))).map((e=>h[e])),y=s[t.layerId],j=v.filter((e=>e.collapseFn)).map((e=>Object(ce.buildExpressionFunction)("lens_collapse",{by:v.filter((t=>{var a;return t.columnId!==e.columnId&&(null===(a=f.getOperationForColumnId(t.columnId))||void 0===a?void 0:a.isBucketed)})).map((e=>e.columnId)),metric:v.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e.columnId))&&void 0!==t&&t.isBucketed)})).map((e=>e.columnId)),fn:[e.collapseFn]}).toAst())),O=Object(ce.buildExpressionFunction)("lens_datatable",{title:n||"",description:i||"",columns:v.filter((e=>!e.collapseFn)).map((t=>{var a,n,i,s,l,r,o,u,c,d;const m={...null===(a=t.palette)||void 0===a?void 0:a.params,colors:((null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.name)===x.b.custom?((null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=f.getOperationForColumnId(t.columnId).sortingHint,h=null==t.summaryRow||"none"===t.summaryRow,v="number"===(null===(u=f.getOperationForColumnId(t.columnId))||void 0===u?void 0:u.dataType);let y=!(b||null!==(c=f.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed);if(b){const e=f.getOperationForColumnId(t.columnId);y=Boolean((null==t?void 0:t.isMetric)||(null==e?void 0:e.inMetricDimension))}const j=Object(ce.buildExpressionFunction)("lens_datatable_column",{columnId:t.columnId,hidden:t.hidden,oneClickFilter:t.oneClickFilter,width:t.width,isTransposed:t.isTransposed,transposable:y,alignment:t.alignment,colorMode:v&&t.colorMode?t.colorMode:"none",palette:e.get(p.b).toExpression(m),summaryRow:h?void 0:t.summaryRow,summaryLabel:h?void 0:null!==(d=t.summaryLabel)&&void 0!==d?d:Object(ee.b)(t.summaryRow),sortingHint:g});return Object(ce.buildExpression)([j]).toAst()})),sortingColumnId:(null===(l=t.sorting)||void 0===l?void 0:l.columnId)||"",sortingDirection:(null===(r=t.sorting)||void 0===r?void 0:r.direction)||"none",fitRowToContent:t.rowHeight===x.b.auto,headerRowHeight:null!==(o=t.headerRowHeight)&&void 0!==o?o:C.a,rowHeightLines:t.rowHeight&&t.rowHeight!==C.c?null!==(u=t.rowHeightLines)&&void 0!==u?u:2:1,headerRowHeightLines:t.headerRowHeight===x.b.single?1:null!==(c=t.headerRowHeightLines)&&void 0!==c?c:C.b,pageSize:null!==(d=t.paging)&&void 0!==d&&d.enabled?t.paging.size:void 0}).toAst();return{type:"expression",chain:[...null!==(m=null==y?void 0:y.chain)&&void 0!==m?m:[],...j,O]}},getRenderEventCounters(e){const t={color_by_value:!1,summary_row:!1};return e.columns.forEach((e=>{e.summaryRow&&"none"!==e.summaryRow&&(t.summary_row=!0),e.colorMode&&"none"!==e.colorMode&&(t.color_by_value=!0)})),Object.entries(t).reduce(((e,[t,a])=>(a&&e.push(`dimension_${t}`),e)),[])},ToolbarComponent:e=>Object(v.jsx)(Ee,e),onEditAction(e,t){var a;switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":const n=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===n?{...e,hidden:!e.hidden}:e))};case"resize":const i=t.data.width,s=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===s?{...e,width:i}:e))};case"pagesize":return{...e,paging:{enabled:(null===(a=e.paging)||void 0===a?void 0:a.enabled)||!1,size:t.data.size}};default:return e}},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getSortedColumns(e,t){const{sortedColumns:a}=Se(e,t||{},e.layerId)||{};return a},getVisualizationInfo(e){var t,a,n,i;const s=e.columns.filter((e=>!e.hidden&&e.colorMode&&"none"!==e.colorMode));return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"table",...this.getDescription(e),palette:s.length>1||null===(t=s[0])||void 0===t||null===(a=t.palette)||void 0===a||null===(n=a.params)||void 0===n||null===(i=n.stops)||void 0===i?void 0:i.map((({color:e})=>e)),dimensions:e.columns.map((e=>{let t=u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"}),a="Metric";return e.transposable||(e.isTransposed?(t=u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}),a="split_metrics"):(t=u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"}),a="split_rows")),{dimensionType:a,id:e.columnId,name:t}}))}]}}});function Se(e,t,a){const n=t[e.layerId],i=null==n?void 0:n.getTableSpec().map((({columnId:e})=>e));return{datasource:n,sortedColumns:Array.from(new Set(null==i?void 0:i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:n,editorFrame:i,charts:s}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:l}=await Promise.resolve().then(a.bind(null,682)),r=await s.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:n,core:e,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:r,uiSettings:e.uiSettings}))),l({paletteService:r,theme:e.theme})}))}}var Ae=a(647),Pe=a(59);const _e=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M25 0a1 1 0 011 1v14a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h20zm-9.878 3c-1.887 0-3.265 1.107-3.26 2.61-.005 1.054.67 1.938 1.672 2.157v.067l-.155.03a2.453 2.453 0 00-1.879 2.394C11.495 11.84 12.997 13 15.122 13c2.105 0 3.612-1.16 3.617-2.742-.005-1.217-.903-2.234-2.035-2.424v-.067l.162-.042c.896-.275 1.507-1.12 1.511-2.116C18.373 4.112 16.994 3 15.122 3zm0 5.542c1.036 0 1.796.665 1.806 1.592-.01.898-.718 1.507-1.806 1.507-1.103 0-1.816-.609-1.806-1.507-.01-.932.755-1.592 1.806-1.592zm0-4.164c.908 0 1.53.561 1.54 1.398-.01.85-.651 1.43-1.54 1.43-.903 0-1.55-.584-1.54-1.43-.01-.837.618-1.398 1.54-1.398z",className:h.a.accent}),Object(v.jsx)("path",{d:"M1 18h28a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1z",className:h.a.subdued}));function Le({table:e,state:t,keptLayerIds:a,datasourceId:n}){return e.isMultiRow||a.length>1||a.length&&e.layerId!==a[0]||1!==e.columns.length||e.columns[0].operation.isBucketed||!Ze.has(e.columns[0].operation.dataType)||e.columns[0].operation.isStaticValue||t&&"unchanged"===e.changeType?[]:[De(e,n)]}function De(e,t){const a=e.columns[0];return{title:e.label||a.operation.label,hide:"textBased"===t,score:.1,previewIcon:_e,state:{layerId:e.layerId,accessor:a.columnId,layerType:ue.LayerTypes.DATA}}}const Re={...M.o,maxSteps:5,name:"status",continuity:"all",rangeType:"number",steps:3};a(301);const Ne=Object(f.htmlIdGenerator)()();function Be(e){var t;const{state:a,setState:n,frame:i,accessor:s,isInlineEditing:r}=e,o=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[c]=(null==o?void 0:o.rows)||[];if(null==s||null==c||!Object(de.a)(o,s))return null;const d=(null==a?void 0:a.colorMode)||Pe.ColorMode.None,m=d!==Pe.ColorMode.None,g={min:Math.min(2*c[s],0===c[s]?-50:0),max:Math.max(2*c[s],0===c[s]?100:0)},b=(null==a?void 0:a.palette)||{type:"palette",name:Re.name,params:{...Re,stops:void 0,colorStops:void 0,rangeMin:g.min,rangeMax:3*g.max/4}},h=Object(M.m)(e.paletteService,b,g);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups",buttonSize:"compressed",options:[{id:`${Ne}None`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_none"},{id:`${Ne}Background`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.background",{defaultMessage:"Fill"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_background"},{id:`${Ne}Labels`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_labels"}],idSelected:`${Ne}${d}`,onChange:e=>{const t=e.replace(Ne,""),i={colorMode:t};null!=a&&a.palette||t===Pe.ColorMode.None||(i.palette={...b,params:{...b.params,stops:h.map(((e,t,a)=>({...e,stop:g.min+(0===t?0:a[t-1].stop)})))}}),null!=a&&a.palette&&t===Pe.ColorMode.None&&(i.palette=void 0),n({...a,...i})}})),m&&Object(v.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(v.jsx)(M.f,{palette:h.map((({color:e})=>e)),siblingRef:e.panelRef,isInlineEditing:r},Object(v.jsx)(ge,{palettes:e.paletteService,activePalette:b,dataBounds:g,setPalette:e=>{e.name!==p.b&&e.params&&e.params.rangeMin!==g.min&&(e.params.rangeMin=g.min),n({...a,palette:e})},showRangeTypeSelector:!1}))))}var ze=a(648);const Ve=[{id:"top",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.top",{defaultMessage:"Top"})},{id:"bottom",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.bottom",{defaultMessage:"Bottom"})}],Ge=({state:e,setState:t})=>{var a;return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.titlePositionLabel",{defaultMessage:"Title position"}))},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,"data-test-subj":"lnsMissingValuesSelect",legend:"This is a basic group",options:Ve,idSelected:null!==(a=e.titlePosition)&&void 0!==a?a:"top",onChange:a=>{t({...e,titlePosition:a})},buttonSize:"compressed"}))},qe="m",$e=[{id:"xs",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraSmall",{defaultMessage:"XS"})},{id:"s",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.small",{defaultMessage:"S"})},{id:"m",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.medium",{defaultMessage:"M"})},{id:"l",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.large",{defaultMessage:"L"})},{id:"xl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraLarge",{defaultMessage:"XL"})},{id:"xxl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.xxl",{defaultMessage:"XXL"})}],He=({state:e,setState:t})=>{var a;const n=$e.findIndex((t=>t.id===(e.size||qe))),i=a=>{t({...e,size:$e[n+a].id})};return Object(v.jsx)(f.EuiSuperSelect,{append:Object(v.jsx)(f.EuiButtonIcon,{iconType:"plus",onClick:()=>i(1),isDisabled:n===$e.length-1}),prepend:Object(v.jsx)(f.EuiButtonIcon,{iconType:"minus",onClick:()=>i(-1),isDisabled:0===n}),"data-test-subj":"lnsLegacyMetricSizeSelect",compressed:!0,options:$e.map((e=>({value:e.id,dropdownDisplay:e.label,inputDisplay:e.label}))),valueOfSelected:null!==(a=e.size)&&void 0!==a?a:qe,onChange:a=>{t({...e,size:a})},itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0})},Ue="left",We=[{id:"left",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.left",{defaultMessage:"Align left"}),iconType:"editorAlignLeft"},{id:"center",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.center",{defaultMessage:"Align center"}),iconType:"editorAlignCenter"},{id:"right",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.right",{defaultMessage:"Align right"}),iconType:"editorAlignRight"}],Xe=({state:e,setState:t})=>{var a;return Object(v.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.legacyMetric.titleAlignLabel",{defaultMessage:"Align"}),options:We,idSelected:null!==(a=e.textAlign)&&void 0!==a?a:Ue,onChange:a=>{t({...e,textAlign:a})},isIconOnly:!0,buttonSize:"compressed"})},Ye=({state:e,setState:t})=>Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.textFormattingLabel",{defaultMessage:"Text formatting"}))},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(He,{state:e,setState:t})),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(Xe,{state:e,setState:t})))),Qe=({state:e,setState:t})=>Object(v.jsx)(ze.a,{tooltipContent:u.i18n.translate("xpack.lens.shared.AppearanceLabel",{defaultMessage:"Appearance"}),condition:!0},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.shared.metric.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsLegacyMetricAppearanceButton"},Object(v.jsx)(Ye,{state:e,setState:t}),Object(v.jsx)(Ge,{state:e,setState:t}))),Ke=Object(s.memo)((function(e){const{state:t,setState:a,frame:n}=e;return Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(v.jsx)(Qe,{state:t,setState:a,datasourceLayers:n.datasourceLayers}))))})),Ze=(Object(f.htmlIdGenerator)()(),new Set(["string","boolean","number","ip","date"])),Je=e=>{const[t,a]=e.split(/(\d+)/).filter(Boolean);return{size:Number(t),sizeUnit:a}},et=(e,t,a,n,i={})=>{var s,l,r,o,u,c,d,m,g,f;if(!t.accessor)return null;const[b]=Object.values(a),h=i[t.layerId],v=b&&b.getOperationForColumnId(t.accessor),y=(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.stops)||[],x=(null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.name)===p.b,j="number"===(null==v?void 0:v.dataType),O={...null===(u=t.palette)||void 0===u?void 0:u.params,colors:y.map((({color:e})=>e)),stops:x||null==(null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d?void 0:d.rangeMax)?y.map((({stop:e})=>e)):Object(Ae.j)(y,Math.max(null===(m=t.palette)||void 0===m||null===(g=m.params)||void 0===g?void 0:g.rangeMax,...y.map((({stop:e})=>e)))).map((({stop:e})=>e)),reverse:!1},I={xs:Je(Me.euiThemeVars.euiFontSizeXS),s:Je(Me.euiThemeVars.euiFontSizeS),m:Je(Me.euiThemeVars.euiFontSizeM),l:Je(Me.euiThemeVars.euiFontSizeL),xl:Je(Me.euiThemeVars.euiFontSizeXL),xxl:Je(Me.euiThemeVars.euiFontSizeXXL)},M=I[(null==t?void 0:t.size)||qe],T={xs:2*I.xs.size,s:2.5*I.m.size,m:2.5*I.l.size,l:2.5*I.xl.size,xl:2.5*I.xxl.size,xxl:3*I.xxl.size}[(null==t?void 0:t.size)||qe],w=Object(ce.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||Ue,size:T,weight:"600",lHeight:1.5*T,sizeUnit:M.sizeUnit}),k=Object(ce.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||Ue,size:M.size,lHeight:1.5*M.size,sizeUnit:M.sizeUnit}),E=Object(ce.buildExpressionFunction)("visdimension",{accessor:t.accessor}),C=Object(ce.buildExpressionFunction)("legacyMetricVis",{autoScaleMetricAlignment:null==t?void 0:t.autoScaleMetricAlignment,labelPosition:(null==t?void 0:t.titlePosition)||"top",font:Object(ce.buildExpression)([w]),labelFont:Object(ce.buildExpression)([k]),metric:Object(ce.buildExpression)([E]),showLabels:!(null!=n&&n.mode)||"full"===(null==n?void 0:n.mode),colorMode:j&&(null==t?void 0:t.colorMode)||Pe.ColorMode.None,autoScale:!0,colorFullBackground:!0,palette:null!=t&&t.colorMode&&(null==t?void 0:t.colorMode)!==Pe.ColorMode.None?e.get(p.b).toExpression(O):void 0,percentageMode:!1});return{type:"expression",chain:[...null!==(f=null==h?void 0:h.chain)&&void 0!==f?f:[],C.toAst()]}},tt=({paletteService:e,theme:t})=>({id:"lnsLegacyMetric",visualizationTypes:[{id:"lnsLegacyMetric",icon:_e,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"}),groupLabel:u.i18n.translate("xpack.lens.legacyMetric.groupLabel",{defaultMessage:"Goal and single value"})}],hideFromChartSwitch:e=>Object.values(e.datasourceLayers).some((e=>e&&"textBased"===e.datasourceId)),getVisualizationTypeId:()=>"lnsLegacyMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:_e,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"})}),getSuggestions:Le,initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:ue.LayerTypes.DATA},triggers:[oe.VIS_EVENT_TO_TRIGGER.filter],getConfiguration(e){var t,a;const n=null!=e.state.palette,i=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{groups:[{groupId:"metric",dataTestSubj:"lnsLegacyMetric_metricDimensionPanel",paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.metric.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,groupLabel:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor,triggerIconType:n?"colorBy":void 0,palette:n?i.map((({color:e})=>e)):void 0}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&Ze.has(e.dataType),enableDimensionEditor:!0,requiredMinDimensionCount:1}]}},getSupportedLayers:()=>[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.legacyMetric.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i)=>et(e,t,a,{...n},i),toPreviewExpression:(t,a,n)=>et(e,t,a,{mode:"reduced"},n),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0,colorMode:Pe.ColorMode.None,palette:void 0}),ToolbarComponent:e=>Object(v.jsx)(Ke,{state:e.state,setState:e.setState,frame:e.frame}),DimensionEditorComponent:t=>Object(v.jsx)(Be,i()({},t,{paletteService:e})),getVisualizationInfo(e){var t,a;const n=[];e.accessor&&n.push({id:e.accessor,name:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),dimensionType:"metric"});const i=null!=e.palette,s=(null===(t=e.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:n,palette:i?s.map((({color:e})=>e)):void 0}]}}});class LegacyMetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getLegacyMetricVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var at=a(31);const nt=({table:e,state:t,keptLayerIds:a})=>{var n,i;const s=Boolean(t),l=e.columns.filter((({operation:e})=>_t.has(e.dataType)&&!e.isBucketed)),r=e.columns.filter((({operation:e})=>e.isBucketed)),o=e.columns.filter((({operation:e})=>!_t.has(e.dataType)&&!e.isBucketed)).length||r.length>1||l.length>2;if(!e.columns.length||((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||o||s&&"initial"===e.changeType&&l.length&&r.length||s&&"unchanged"===e.changeType)return[];const u={state:{...t,layerId:e.layerId,layerType:ue.LayerTypes.DATA},title:Rt,previewIcon:_e,score:.5,hide:!0},c={metricAccessor:null===(n=l[0])||void 0===n?void 0:n.columnId,breakdownByAccessor:null===(i=r[0])||void 0===i?void 0:i.columnId};return u.score+=.01*Object.values(c).filter(Boolean).length,[{...u,state:{...u.state,...c,secondaryMetricAccessor:void 0,maxAccessor:void 0}}]},it="lnsMetric",st="metric",lt="secondaryMetric",rt="breakdownBy",ot="trendMetric",ut="trendSecondaryMetric",ct="trendTime",dt="trendBreakdownBy";var pt=a(75),mt=a(64),gt=a(306),ft=a(649);const bt={...M.o,name:"status",rangeType:"percent",steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]},ht={...M.o,name:"status",rangeType:"number",rangeMin:-1/0,rangeMax:1/0,steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]},vt=[{value:"empty",label:u.i18n.translate("xpack.lens.metric.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"sortUp",label:u.i18n.translate("xpack.lens.metric.iconSelect.sortUpLabel",{defaultMessage:"Sort up"})},{value:"sortDown",label:u.i18n.translate("xpack.lens.metric.iconSelect.sortDownLabel",{defaultMessage:"Sort down"})},{value:"compute",label:u.i18n.translate("xpack.lens.metric.iconSelect.computeLabel",{defaultMessage:"Compute"})},{value:"globe",label:u.i18n.translate("xpack.lens.metric.iconSelect.globeLabel",{defaultMessage:"Globe"})},{value:"temperature",label:u.i18n.translate("xpack.lens.metric.iconSelect.temperatureLabel",{defaultMessage:"Temperature"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.metric.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:u.i18n.translate("xpack.lens.metric.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:u.i18n.translate("xpack.lens.metric.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.metric.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.metric.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.metric.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:u.i18n.translate("xpack.lens.metric.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:u.i18n.translate("xpack.lens.metric.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:u.i18n.translate("xpack.lens.metric.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pin",label:u.i18n.translate("xpack.lens.metric.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:u.i18n.translate("xpack.lens.metric.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"tag",label:u.i18n.translate("xpack.lens.metric.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}];function yt(e){const{state:t,accessor:a}=e,n=Object(f.htmlIdGenerator)()();switch(a){case null==t?void 0:t.metricAccessor:return Object(v.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_primary_metric"},Object(v.jsx)(It,i()({},e,{idPrefix:n})));case t.secondaryMetricAccessor:return Object(v.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_secondary_metric"},Object(v.jsx)(Ot,i()({},e,{idPrefix:n})));case t.maxAccessor:return Object(v.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_maximum"},Object(v.jsx)(jt,i()({},e,{idPrefix:n})));case t.breakdownByAccessor:return Object(v.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_breakdown"},Object(v.jsx)(xt,i()({},e,{idPrefix:n})));default:return null}}function xt({setState:e,state:t}){var a;const n=Object(s.useCallback)((a=>{e({...t,maxCols:parseInt(a,10)})}),[e,t]),{inputValue:i,handleInputChange:r}=Object(je.a)({onChange:n,value:String(null!==(a=t.maxCols)&&void 0!==a?a:St)});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.maxColumns",{defaultMessage:"Layout columns"}),fullWidth:!0,display:"columnCompressed"},Object(v.jsx)(f.EuiFieldNumber,{compressed:!0,min:1,"data-test-subj":"lnsMetric_max_cols",value:i,onChange:({target:{value:e}})=>r(e)})),Object(v.jsx)(be,{value:t.collapseFn||"",onChange:a=>{e({...t,collapseFn:a})}}))}function jt({setState:e,state:t,idPrefix:a}){return null}function Ot({accessor:e,idPrefix:t,frame:a,layerId:n,setState:i,state:s}){var r,o,c;const d=(null===(r=Object(mt.getColumnByAccessor)(e,null===(o=a.activeData)||void 0===o||null===(c=o[n])||void 0===c?void 0:c.columns))||void 0===r?void 0:r.name)||"";return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.prefixText.label",{defaultMessage:"Prefix"})},Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.prefix.label",{defaultMessage:"Prefix"}),"data-test-subj":"lnsMetric_prefix_buttons",options:[{id:`${t}auto`,label:u.i18n.translate("xpack.lens.metric.prefix.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsMetric_prefix_auto",value:void 0},{id:`${t}custom`,label:u.i18n.translate("xpack.lens.metric.prefix.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsMetric_prefix_custom",value:d},{id:`${t}none`,label:u.i18n.translate("xpack.lens.metric.prefix.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_prefix_none",value:""}],idSelected:`${t}${void 0===s.secondaryPrefix?"auto":""===s.secondaryPrefix?"none":"custom"}`,onChange:(e,t)=>{i({...s,secondaryPrefix:t})}}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),s.secondaryPrefix&&Object(v.jsx)(gt.a,{"data-test-subj":"lnsMetric_prefix_custom_input",compressed:!0,value:s.secondaryPrefix,onChange:e=>{i({...s,secondaryPrefix:e})}})))}function It(e){var t,a,n,i,s,r;const{state:o,setState:c,frame:d,accessor:m,idPrefix:g,isInlineEditing:b}=e,h=null===(t=d.activeData)||void 0===t?void 0:t[o.layerId],y=Object(de.a)(h,m);if(null==m)return null;const x=Boolean(y&&(null==o?void 0:o.palette)),j=Boolean(o.maxAccessor||o.breakdownByAccessor&&!o.collapseFn||"percent"===(null==o||null===(a=o.palette)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.rangeType)),O=(null==o?void 0:o.palette)||{type:"palette",name:(j?bt:ht).name,params:{...j?bt:ht}},I=Object(pt.getDataBoundsForPalette)({metric:o.metricAccessor,max:o.maxAccessor,breakdownBy:o.collapseFn?void 0:o.breakdownByAccessor},null===(i=d.activeData)||void 0===i?void 0:i[o.layerId]),T=Object(M.m)(e.paletteService,O,{min:null!==(s=I.min)&&void 0!==s?s:p.g,max:null!==(r=I.max)&&void 0!==r?r:p.f});return Object(v.jsx)(l.a.Fragment,null,y&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color mode"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.colorMode.label",{defaultMessage:"Color mode"}),"data-test-subj":"lnsMetric_color_mode_buttons",options:[{id:`${g}static`,label:u.i18n.translate("xpack.lens.metric.colorMode.static",{defaultMessage:"Static"}),"data-test-subj":"lnsMetric_color_mode_static"},{id:`${g}dynamic`,label:u.i18n.translate("xpack.lens.metric.colorMode.dynamic",{defaultMessage:"Dynamic"}),"data-test-subj":"lnsMetric_color_mode_dynamic"}],idSelected:`${g}${o.palette?"dynamic":"static"}`,onChange:e=>{const t="dynamic"===e.replace(g,"")?{palette:{...O,params:{...O.params,stops:T}},color:void 0}:{palette:void 0,color:void 0};c({...o,...t})}})),!x&&Object(v.jsx)(Mt,e),x&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(v.jsx)(M.f,{palette:T.map((({color:e})=>e)),siblingRef:e.panelRef,isInlineEditing:b},Object(v.jsx)(ge,{palettes:e.paletteService,activePalette:O,dataBounds:I,showRangeTypeSelector:j,setPalette:e=>{c({...o,palette:e})}}))),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.icon",{defaultMessage:"Icon decoration"})},Object(v.jsx)(ft.a,{customIconSet:vt,value:null==o?void 0:o.icon,onChange:e=>{c({...o,icon:e})}})))}function Mt({state:e,setState:t,frame:a}){var n;const i=u.i18n.translate("xpack.lens.metric.color",{defaultMessage:"Color"}),l=null===(n=a.activeData)||void 0===n?void 0:n[e.layerId],r=Boolean(e.metricAccessor&&Object(de.a)(l,e.metricAccessor)),o=Object(s.useCallback)((a=>{t({...e,color:""===a?void 0:a})}),[t,e]),{inputValue:c,handleInputChange:d}=Object(je.a)({onChange:o,value:e.color||Pt(e,r)},{allowFalsyValue:!0});return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:i},Object(v.jsx)(f.EuiColorPicker,{fullWidth:!0,compressed:!0,isClearable:!1,onChange:e=>d(e),color:c,"aria-label":i,showAlpha:!0,swatches:Object(f.euiPaletteColorBlind)()}))}function Tt({state:e,datasource:t,setState:a,addLayer:n,removeLayer:i,accessor:s,frame:r}){var o,c,d,p;const{euiTheme:m}=Object(f.useEuiTheme)(),g=null===(o=r.activeData)||void 0===o?void 0:o[e.layerId];if(s!==e.metricAccessor||!Object(de.a)(g,s))return null;const b=Object(f.htmlIdGenerator)()(),h=null==t?void 0:t.hasDefaultTimeField(),y=Boolean(e.metricAccessor&&(null==t||null===(c=t.getOperationForColumnId(e.metricAccessor))||void 0===c?void 0:c.hasReducedTimeRange)),x=Boolean(e.secondaryMetricAccessor&&(null==t||null===(d=t.getOperationForColumnId(e.secondaryMetricAccessor))||void 0===d?void 0:d.hasReducedTimeRange)),j=[],O=h&&!y&&!x;O||j.push(h?y?u.i18n.translate("xpack.lens.metric.supportingVis.metricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the primary metric."}):x?u.i18n.translate("xpack.lens.metric.supportingVis.secondaryMetricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the secondary metric."}):"":u.i18n.translate("xpack.lens.metric.supportingVis.needDefaultTimeField",{defaultMessage:"Line visualizations require use of a data view with a default time field."})),e.maxAccessor||j.push(u.i18n.translate("xpack.lens.metric.summportingVis.needMaxDimension",{defaultMessage:"Bar visualizations require a maximum value to be defined."}));const I=`${b}--`;return Object(v.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(v.jsx)(f.EuiText,{size:"s",css:Object(v.css)("margin-bottom:",m.size.base,";","")},Object(v.jsx)("h4",null,u.i18n.translate("xpack.lens.metric.supportingVis.label",{defaultMessage:"Supporting visualization"}))),Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),helpText:j.map((e=>Object(v.jsx)("p",null,e)))},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),"data-test-subj":"lnsMetric_supporting_visualization_buttons",options:[{id:`${I}none`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_supporting_visualization_none"},{id:`${I}trendline`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.trendline",{defaultMessage:"Line"}),isDisabled:!O,"data-test-subj":"lnsMetric_supporting_visualization_trendline"},{id:`${I}bar`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.bar",{defaultMessage:"Bar"}),isDisabled:!e.maxAccessor,"data-test-subj":"lnsMetric_supporting_visualization_bar"}],idSelected:`${I}${e.trendlineLayerId?"trendline":At(e)?"bar":"none"}`,onChange:t=>{switch(t.split("--")[1]){case"trendline":a({...e,showBar:!1}),n("metricTrendline");break;case"bar":a({...e,showBar:!0}),e.trendlineLayerId&&i(e.trendlineLayerId);break;case"none":a({...e,showBar:!1}),e.trendlineLayerId&&i(e.trendlineLayerId)}}})),At(e)&&Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),fullWidth:!0,display:"columnCompressed"},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),"data-test-subj":"lnsMetric_progress_direction_buttons",options:[{id:`${b}vertical`,label:u.i18n.translate("xpack.lens.metric.progressDirection.vertical",{defaultMessage:"Vertical"}),"data-test-subj":"lnsMetric_progress_bar_vertical"},{id:`${b}horizontal`,label:u.i18n.translate("xpack.lens.metric.progressDirection.horizontal",{defaultMessage:"Horizontal"}),"data-test-subj":"lnsMetric_progress_bar_horizontal"}],idSelected:`${b}${null!==(p=e.progressDirection)&&void 0!==p?p:"vertical"}`,onChange:t=>{const n=t.replace(b,"");a({...e,progressDirection:n})}}))))}function wt(e){const{state:t,setState:a}=e,n=Object(s.useCallback)((e=>a({...t,subtitle:e})),[a,t]),{inputValue:i,handleInputChange:l}=Object(je.a)({onChange:n,value:t.subtitle||""},{allowFalsyValue:!0}),r=Boolean(t.breakdownByAccessor);return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},!r&&Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.metric.labels",{defaultMessage:"Labels"}),type:"labels",groupPosition:"none",buttonDataTestSubj:"lnsLabelsButton"},Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.subtitleLabel",{defaultMessage:"Subtitle"}),fullWidth:!0,display:"columnCompressed"},Object(v.jsx)(f.EuiFieldText,{value:i,onChange:({target:{value:e}})=>l(e)}))))}var kt=a(94),Et=a(48);var Ct=a(83),Ft=a(91);const St=3,At=e=>Boolean(e.showBar&&e.maxAccessor),Pt=(e,t)=>At(e)&&t?Me.euiLightVars.euiColorPrimary:Me.euiThemeVars.euiColorEmptyShade,_t=new Set(["string","boolean","number","ip","date"]),Lt=e=>!e.isBucketed&&_t.has(e.dataType),Dt=e=>!e.isBucketed&&_t.has(e.dataType)&&!e.isStaticValue,Rt=u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),Nt=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),Bt=e=>{delete e.metricAccessor,delete e.palette,delete e.color},zt=e=>{delete e.secondaryMetricAccessor,delete e.secondaryPrefix},Vt=e=>{delete e.maxAccessor,delete e.progressDirection,delete e.showBar},Gt=e=>{delete e.breakdownByAccessor,delete e.collapseFn,delete e.maxCols},qt=({paletteService:e,theme:t})=>({id:it,visualizationTypes:[{id:it,icon:_e,label:Rt,groupLabel:Nt,showExperimentalBadge:!0,sortPriority:3}],getVisualizationTypeId:()=>it,clearLayer(e){const t={...e};return delete t.subtitle,Bt(t),zt(t),Vt(t),Gt(t),t},getLayerIds:e=>e.trendlineLayerId?[e.layerId,e.trendlineLayerId]:[e.layerId],getDescription:()=>({icon:_e,label:Rt}),getSuggestions:nt,initialize:(e,t,a)=>null!=t?t:{layerId:e(),layerType:at.a.DATA,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0},triggers:[oe.VIS_EVENT_TO_TRIGGER.filter],getConfiguration:e=>e.layerId===e.state.layerId?(e=>{var t;const a=null===(t=e.frame.activeData)||void 0===t?void 0:t[e.state.layerId],n=Boolean(e.state.metricAccessor&&Object(de.a)(a,e.state.metricAccessor));return{groups:[{groupId:st,dataTestSubj:"lnsMetric_primaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.metricAccessor?[{columnId:e.state.metricAccessor,...(()=>{var t,a,i;const s=Boolean(n&&e.state.palette),l=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return s?{triggerIconType:"colorBy",palette:l.map((({color:e})=>e))}:{triggerIconType:"color",color:null!==(i=e.state.color)&&void 0!==i?i:Pt(e.state,n)}})()}]:[],supportsMoreColumns:!e.state.metricAccessor,filterOperations:Dt,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0,requiredMinDimensionCount:1},{groupId:lt,dataTestSubj:"lnsMetric_secondaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.secondaryMetricAccessor?[{columnId:e.state.secondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.secondaryMetricAccessor,filterOperations:Dt,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0},{groupId:"max",dataTestSubj:"lnsMetric_maxDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.maxAccessor?[{columnId:e.state.maxAccessor}]:[],isHidden:!e.state.maxAccessor&&!n,supportsMoreColumns:!e.state.maxAccessor,filterOperations:Lt,enableDimensionEditor:!0,enableFormatSelector:!1,supportStaticValue:!0,prioritizedOperation:"max",groupTooltip:u.i18n.translate("xpack.lens.metric.maxTooltip",{defaultMessage:"If the maximum value is specified, the minimum value is fixed at zero."})},{groupId:rt,dataTestSubj:"lnsMetric_breakdownByDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.breakdownByAccessor?[{columnId:e.state.breakdownByAccessor,triggerIconType:e.state.collapseFn?"aggregate":void 0}]:[],supportsMoreColumns:!e.state.breakdownByAccessor,filterOperations:e=>e.isBucketed,enableDimensionEditor:!0,enableFormatSelector:!0}]}})(e):(e=>({hidden:!0,groups:[{groupId:ot,groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),accessors:e.state.trendlineMetricAccessor?[{columnId:e.state.trendlineMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:3},{groupId:ut,groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),accessors:e.state.trendlineSecondaryMetricAccessor?[{columnId:e.state.trendlineSecondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineSecondaryMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:2},{groupId:ct,groupLabel:u.i18n.translate("xpack.lens.metric.timeField",{defaultMessage:"Time field"}),accessors:e.state.trendlineTimeAccessor?[{columnId:e.state.trendlineTimeAccessor}]:[],supportsMoreColumns:!e.state.trendlineTimeAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:1},{groupId:dt,groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.trendlineBreakdownByAccessor?[{columnId:e.state.trendlineBreakdownByAccessor}]:[],supportsMoreColumns:!e.state.trendlineBreakdownByAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:0}]}))(e),getLayerType:(e,t)=>(null==t?void 0:t.layerId)===e?t.layerType:(null==t?void 0:t.trendlineLayerId)===e?t.trendlineLayerType:void 0,getSupportedLayers:e=>[{type:at.a.DATA,label:u.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"max",columnId:Object(kt.a)(),staticValue:0}]:void 0,disabled:!0},{type:at.a.METRIC_TRENDLINE,label:u.i18n.translate("xpack.lens.metric.layerType.trendLine",{defaultMessage:"Trendline"}),initialDimensions:[{groupId:ct,columnId:Object(kt.a)(),autoTimeField:!0}],disabled:Boolean(null==e?void 0:e.trendlineLayerId)}],appendLayer(e,t,a){if(a!==at.a.METRIC_TRENDLINE)throw new Error(`Metric vis only supports layers of type ${at.a.METRIC_TRENDLINE}!`);return{...e,trendlineLayerId:t,trendlineLayerType:a}},removeLayer:(e,t)=>({...e,...e.layerId===t&&{metricAccessor:void 0},trendlineLayerId:void 0,trendlineLayerType:void 0,trendlineMetricAccessor:void 0,trendlineTimeAccessor:void 0,trendlineBreakdownByAccessor:void 0}),getRemoveOperation:(e,t)=>t===e.trendlineLayerId?"remove":"clear",getLayersToLinkTo:(e,t)=>t===e.trendlineLayerId?[e.layerId]:[],getLinkedDimensions(e){if(!e.trendlineLayerId)return[];const t=[];return e.metricAccessor&&t.push({from:{columnId:e.metricAccessor,groupId:st,layerId:e.layerId},to:{columnId:e.trendlineMetricAccessor,groupId:ot,layerId:e.trendlineLayerId}}),e.secondaryMetricAccessor&&t.push({from:{columnId:e.secondaryMetricAccessor,groupId:lt,layerId:e.layerId},to:{columnId:e.trendlineSecondaryMetricAccessor,groupId:ut,layerId:e.trendlineLayerId}}),e.breakdownByAccessor&&t.push({from:{columnId:e.breakdownByAccessor,groupId:rt,layerId:e.layerId},to:{columnId:e.trendlineBreakdownByAccessor,groupId:dt,layerId:e.trendlineLayerId}}),t},getLayersToRemoveOnIndexPatternChange:e=>e.trendlineLayerId?[e.trendlineLayerId]:[],toExpression:(t,a,n,i)=>((e,t,a,n={})=>{var i,s,l,r,o;if(!t.metricAccessor)return null;const u=a[t.layerId],c=n[t.layerId],d=Boolean(t.metricAccessor&&"number"===(null==u||null===(i=u.getOperationForColumnId(t.metricAccessor))||void 0===i?void 0:i.dataType)),m=t.breakdownByAccessor&&!t.collapseFn?null==u?void 0:u.getMaxPossibleNumValues(t.breakdownByAccessor):null,g=t.collapseFn?Object(ce.buildExpressionFunction)("lens_collapse",(()=>{const e=[t.metricAccessor,t.secondaryMetricAccessor,t.maxAccessor].filter(Boolean),a=t.collapseFn,n=e.map((e=>{return e!==t.maxAccessor?a:Boolean(null==u||null===(n=u.getOperationForColumnId(t.maxAccessor))||void 0===n?void 0:n.isStaticValue)?"max":a;var n}));return{by:[],metric:e,fn:n}})()).toAst():void 0,f=((e,t)=>{const{trendlineLayerId:a,trendlineMetricAccessor:n,trendlineTimeAccessor:i}=e;if(!a||!n||!i)return;const s=t[a];if(!s)return;const l=Object(ce.buildExpressionFunction)("metricTrendline",{metric:n,timeField:i,breakdownBy:e.trendlineBreakdownByAccessor&&!e.collapseFn?e.trendlineBreakdownByAccessor:void 0,inspectorTableId:a,table:[{...s,chain:[...s.chain,...e.collapseFn?[Object(ce.buildExpressionFunction)("lens_collapse",{by:[i],metric:[n],fn:[e.collapseFn]}).toAst()]:[]]}]});return Object(ce.buildExpression)([l]).toAst()})(t,n),b=Object(ce.buildExpressionFunction)("metricVis",{metric:t.metricAccessor,secondaryMetric:t.secondaryMetricAccessor,secondaryPrefix:t.secondaryPrefix,max:t.maxAccessor,breakdownBy:t.breakdownByAccessor&&!t.collapseFn?t.breakdownByAccessor:void 0,trendline:f?[f]:[],subtitle:null!==(s=t.subtitle)&&void 0!==s?s:void 0,progressDirection:At(t)?t.progressDirection||Et.LayoutDirection.Vertical:void 0,color:t.color||Pt(t,d),icon:t.icon,palette:d&&null!==(l=t.palette)&&void 0!==l&&l.params?[e.get(p.b).toExpression((h=t.palette.params,{...h,colors:((null==h?void 0:h.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==h?void 0:h.name)?((null==h?void 0:h.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}))]:[],maxCols:null!==(r=t.maxCols)&&void 0!==r?r:St,minTiles:null!=m?m:void 0,inspectorTableId:t.layerId});var h;return{type:"expression",chain:[...null!==(o=null==c?void 0:c.chain)&&void 0!==o?o:[],...g?[g]:[],b.toAst()]}})(e,t,a,i),setDimension({prevState:e,columnId:t,groupId:a}){const n={...e};switch(a){case st:n.metricAccessor=t;break;case lt:n.secondaryMetricAccessor=t;break;case"max":n.maxAccessor=t,e.trendlineLayerId||(n.showBar=!0);break;case rt:n.breakdownByAccessor=t;break;case ct:n.trendlineTimeAccessor=t;break;case ot:n.trendlineMetricAccessor=t;break;case ut:n.trendlineSecondaryMetricAccessor=t;break;case dt:n.trendlineBreakdownByAccessor=t}return n},removeDimension({prevState:e,columnId:t}){const a={...e};return e.metricAccessor===t&&Bt(a),e.secondaryMetricAccessor===t&&zt(a),e.maxAccessor===t&&Vt(a),e.breakdownByAccessor===t&&Gt(a),e.trendlineTimeAccessor===t&&delete a.trendlineTimeAccessor,e.trendlineMetricAccessor===t&&delete a.trendlineMetricAccessor,e.trendlineSecondaryMetricAccessor===t&&delete a.trendlineSecondaryMetricAccessor,e.trendlineBreakdownByAccessor===t&&delete a.trendlineBreakdownByAccessor,a},ToolbarComponent:e=>Object(v.jsx)(wt,e),DimensionEditorComponent:t=>Object(v.jsx)(yt,i()({},t,{paletteService:e})),DimensionEditorAdditionalSectionComponent:e=>Object(v.jsx)(Tt,e),getDisplayOptions:()=>({noPanelTitle:!1,noPadding:!0}),getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e,t){var a,n,i;const s=[];e.metricAccessor&&s.push({id:e.metricAccessor,name:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),dimensionType:"primary_metric"}),e.secondaryMetricAccessor&&s.push({id:e.secondaryMetricAccessor,name:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),dimensionType:"secondary_metric"}),e.maxAccessor&&s.push({id:e.maxAccessor,name:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"}),dimensionType:"max"}),e.breakdownByAccessor&&s.push({id:e.breakdownByAccessor,name:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),dimensionType:"breakdown"});const l=(null===(a=e.palette)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.stops)||[],r=!!e.color,o=!!e.palette,c=null==t||null===(i=t.activeData)||void 0===i?void 0:i[e.layerId],d=Boolean(e.metricAccessor&&Object(de.a)(c,e.metricAccessor));return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:s,palette:(o?l.map((({color:e})=>e)):r?[e.color]:[Pt(e,d)]).filter(Ct.nonNullable)}]}},getUserMessages(e,{frame:t}){var a;const n=null===(a=t.activeData)||void 0===a?void 0:a[e.layerId],i=[];return e.maxAccessor&&Boolean(e.metricAccessor&&!Object(de.a)(n,e.metricAccessor))&&i.push({uniqueId:Ft.I,severity:"error",fixableInEditor:!0,displayLocations:[{id:"dimensionButton",dimensionId:e.maxAccessor}],shortMessage:u.i18n.translate("xpack.lens.lnsMetric_maxDimensionPanel.nonNumericError",{defaultMessage:"Primary metric must be numeric to set a maximum value."}),longMessage:""}),i}});class MetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getMetricVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var $t=a(11),Ht=a(152),Ut=a(50),Wt=a(5);const Xt=u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),Yt=[{value:Wt.CategoryDisplay.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:Wt.CategoryDisplay.INSIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:Wt.CategoryDisplay.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],Qt=[{value:Wt.CategoryDisplay.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:Wt.CategoryDisplay.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],Kt=[{value:Wt.NumberDisplay.HIDDEN,inputDisplay:u.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:Wt.NumberDisplay.PERCENT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:Wt.NumberDisplay.VALUE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],Zt=[{id:"emptySizeRatioOption-small",value:x.a.SMALL,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.small",{defaultMessage:"Small"})},{id:"emptySizeRatioOption-medium",value:x.a.MEDIUM,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.medium",{defaultMessage:"Medium"})},{id:"emptySizeRatioOption-large",value:x.a.LARGE,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.large",{defaultMessage:"Large"})}],Jt={donut:{icon:({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:h.a.subdued}),Object(v.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:h.a.accent})),label:u.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:Xt,maxBuckets:3,toolbarPopover:{categoryOptions:Yt,numberOptions:Kt,emptySizeRatioOptions:Zt},legend:{getShowLegendDefault:e=>e.length>1}},pie:{icon:({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:h.a.subdued}),Object(v.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:h.a.accent})),label:u.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:Xt,maxBuckets:3,toolbarPopover:{categoryOptions:Yt,numberOptions:Kt},legend:{getShowLegendDefault:e=>e.length>1}},treemap:{icon:({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:h.a.subdued}),Object(v.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:h.a.accent}),Object(v.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:h.a.subdued})),label:u.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:Xt,maxBuckets:2,toolbarPopover:{categoryOptions:Qt,numberOptions:Kt},legend:{getShowLegendDefault:()=>!1}},mosaic:{icon:({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t}):null,Object(v.jsx)("path",{className:h.a.subdued,d:"M2 0a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1H2zM2 14a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1H2zM11 13a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-6a1 1 0 01-1-1v-8zM12 0a1 1 0 100 2h6a1 1 0 100-2h-6zM21 15a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1h-6a1 1 0 01-1-1v-6zM22 0a1 1 0 00-1 1v4a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1h-6z"}),Object(v.jsx)("path",{className:h.a.accent,d:"M11 5a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V5zM1 7a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1H2a1 1 0 01-1-1V7zM22 8a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 00-1-1h-6z"})),label:u.i18n.translate("xpack.lens.pie.mosaiclabel",{defaultMessage:"Mosaic"}),groupLabel:Xt,maxBuckets:2,toolbarPopover:{categoryOptions:[],numberOptions:Kt},legend:{getShowLegendDefault:()=>!1}},waffle:{icon:({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t}):null,Object(v.jsx)("path",{className:h.a.accent,d:"M16 1a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V1zM4 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM17 6a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V7a1 1 0 00-1-1h-2zM23 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM5 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1H5zM4 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V7zM11 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM10 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zM11 12a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM22 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7z"}),Object(v.jsx)("path",{className:h.a.subdued,d:"M22 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM4 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM16 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM11 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM23 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM16 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"})),label:u.i18n.translate("xpack.lens.pie.wafflelabel",{defaultMessage:"Waffle"}),groupLabel:Xt,maxBuckets:1,toolbarPopover:{isDisabled:!0,categoryOptions:[],numberOptions:[]},legend:{flat:!0,defaultLegendStats:[Et.LegendValue.Value],hideNestedLegendSwitch:!0,getShowLegendDefault:()=>!0}}},ea=(e,t)=>{var a,n,i;if("defaultLegendStats"in(null===(a=Jt[t])||void 0===a?void 0:a.legend))return null!==(n=null!==(i=e.legendStats)&&void 0!==i?i:Jt[t].legend.defaultLegendStats)&&void 0!==n?n:[Et.LegendValue.Value]},ta=(e,t,a)=>{const n=e.rows.reduce(((e,a)=>Number(a[t])+e),0);return e.rows.some((e=>e[t]/n*100<a))};function aa(e,t,a){return 0===a?{...e,...t}:{...t,...e}}function na(e,t){const a={truncateText:!0};return e?function(e){return"layerId"in e}(e)?Object.values((null===(n=t[e.layerId])||void 0===n?void 0:n.getVisualDefaults())||{}).reduce(aa,a):e.layers.flatMap((({layerId:e})=>{var a;return Object.values((null===(a=t[e])||void 0===a?void 0:a.getVisualDefaults())||{})})).reduce(aa,a):a;var n}const ia=(e,t)=>{const a={};return e.forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},sa=(e,t,a)=>{var n;const i=null==e?void 0:e.getTableSpec().map((({columnId:e})=>e)).filter((e=>{var n;return null===(n=t[a])||void 0===n?void 0:n.includes(e)}));return Array.from(new Set(null==i?void 0:i.concat(null!==(n=t[a])&&void 0!==n?n:[])))},la=e=>Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("visdimension",{accessor:e})]).toAst(),ra=(e,t,a,n)=>{var i;const s=!t.isPreview&&a.categoryDisplay!==Wt.CategoryDisplay.HIDE,l=a.categoryDisplay!==Wt.CategoryDisplay.HIDE?a.categoryDisplay:[],r=a.numberDisplay!==Wt.NumberDisplay.HIDDEN,o=a.numberDisplay!==Wt.NumberDisplay.HIDDEN?a.numberDisplay:[],u=null!==(i=a.percentDecimals)&&void 0!==i?i:2,c=a.allowMultipleMetrics&&!ai(a)?Object.entries(n).reduce(((e,[t,n])=>{var i;const s=null===(i=a.colorsByDimension)||void 0===i?void 0:i[t];return s&&(e[n]=s),e}),{}):{},d=Object(Ut.buildExpressionFunction)("partitionLabels",{show:s,position:l,values:r,valuesFormat:o,percentDecimals:u,colorOverrides:JSON.stringify(c)});return[Object(Ut.buildExpression)([d]).toAst()]},oa=(...e)=>{const[t]=ra(...e),[a]=t.chain;return[{...t,chain:[{...a,percentDecimals:2}]}]},ua=(e,t)=>t?[Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("theme",{variable:"palette",default:e.get(t.name).toExpression(t.params)})]).toAst()]:[e.get("default").toExpression()],ca=(e,t,a,n,i,s)=>{var l,r,o,u;const c=i[n.layerId],d=ia(n.metrics,c),p=sa(c,n,"metrics");return{labels:ra(0,t,n,d),buckets:a.filter((({columnId:e})=>!ti(e,n))).map((({columnId:e})=>e)).map(la),metrics:(n.allowMultipleMetrics?p:[p[0]]).map(la),metricsToLabels:JSON.stringify(d),legendDisplay:t.isPreview?Wt.LegendDisplay.HIDE:n.legendDisplay,legendPosition:n.legendPosition||Et.Position.Right,maxLegendLines:null!==(l=n.legendMaxLines)&&void 0!==l?l:1,legendSize:n.legendSize,nestedLegend:n.primaryGroups.length+(null!==(r=null===(o=n.secondaryGroups)||void 0===o?void 0:o.length)&&void 0!==r?r:0)>1&&Boolean(n.nestedLegend),truncateLegend:null!==(u=n.truncateLegend)&&void 0!==u?u:na(e,i).truncateText,palette:ua(s,e.palette),addTooltip:!0,colorMapping:n.colorMapping?JSON.stringify(n.colorMapping):void 0}};function da(e,t,a,n={isPreview:!1},i){const s=e.layers[0],l=t[s.layerId],r=Array.from(new Set([sa(l,s,"primaryGroups"),s.secondaryGroups?sa(l,s,"secondaryGroups"):[]].flat())),o=r.map((e=>({columnId:e,operation:null==l?void 0:l.getOperationForColumnId(e)}))).filter((e=>!!e.operation));if(!s.metrics.length)return null;const u=((e,...t)=>({[Wt.PieChartTypes.PIE]:()=>((...e)=>Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("pieVis",{...ca(...e),respectSourceOrder:!1,startFromSecondLargestSlice:!0,isDonut:!1})]).toAst())(e,...t),[Wt.PieChartTypes.DONUT]:()=>((...e)=>{var t;const[,,,a]=e;return Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("pieVis",{...ca(...e),respectSourceOrder:!1,isDonut:!0,startFromSecondLargestSlice:!0,emptySizeRatio:null!==(t=a.emptySizeRatio)&&void 0!==t?t:x.a.SMALL})]).toAst()})(e,...t),[Wt.PieChartTypes.TREEMAP]:()=>((...e)=>{const[,,,t]=e;return Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("treemapVis",{...ca(...e),nestedLegend:!!t.nestedLegend})]).toAst()})(e,...t),[Wt.PieChartTypes.MOSAIC]:()=>((...e)=>{const{metrics:t,...a}=ca(...e);return Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("mosaicVis",{...{...a,metricsToLabels:void 0},metric:t,buckets:e[2].filter((({columnId:t})=>!ti(t,e[3]))).reverse().map((e=>e.columnId)).map(la)})]).toAst()})(e,...t),[Wt.PieChartTypes.WAFFLE]:()=>((...e)=>{const{buckets:t,nestedLegend:a,...n}=ca(...e),[i,s,,l,r]=e;return Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("waffleVis",{...n,bucket:t,labels:oa(i,s,l,ia(l.metrics,r[l.layerId])),legendStats:ea(l,i.shape)})]).toAst()})(e,...t)}[e.shape]()))(e,n,o,s,t,a),c=i[s.layerId];return{type:"expression",chain:[...c?c.chain:[],...r.filter((e=>{var t;return null===(t=s.collapseFns)||void 0===t?void 0:t[e]})).map((e=>Object(Ut.buildExpressionFunction)("lens_collapse",{by:r.filter((t=>t!==e)),metric:s.metrics,fn:[s.collapseFns[e]]}).toAst())),...u?u.chain:[]]}}var pa=a(44),ma=a(40);function ga(e){return e.some((e=>"interval"===e.operation.scale))}function fa(e){const t=[Wt.PieChartTypes.TREEMAP,Wt.PieChartTypes.WAFFLE,Wt.PieChartTypes.MOSAIC];return!!e&&t.includes(e)}const ba=Math.max(...Object.values(Jt).map((({maxBuckets:e})=>e)));function ha({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(function({table:e,keptLayerIds:t,state:a}){return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||e.columns.some((e=>e.operation.isStaticValue))}({table:e,state:t,keptLayerIds:a}))return[];const s=Boolean(t),[l,r]=Object(pa.partition)(e.columns.filter((e=>e.operation.isBucketed||"number"===e.operation.dataType)),(e=>e.operation.isBucketed));if(0===l.length&&0===r.length)return[];if(r.length>1&&!s||l.length>ba)return[];if(r.length>1&&(null==t||!t.layers[0].allowMultipleMetrics))return[];const o=0===r.length||0===l.length;if(o&&t&&!i)return[];const c=r.map((({columnId:e})=>e)),d=[],p=(null==t||!t.shape||(m=t.shape,!["donut","pie","treemap","mosaic","waffle"].includes(m)))&&ga(e.columns);var m;if(l.length<=Jt.pie.maxBuckets&&!fa(i)){const a=function(e,t){var a;if(t)return t;let n;return 1===e.length||t||(n=Wt.PieChartTypes.PIE),null!==(a=n)&&void 0!==a?a:Wt.PieChartTypes.DONUT}(l,i),s={title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"{chartName}",values:{chartName:Jt[a].label},description:"chartName is already translated"}),score:t&&!fa(t.shape)?.6:.4,state:{shape:a,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,layerType:ma.layerTypes.DATA,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping:Object(Ct.getColorMappingDefaults)()}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:Wt.NumberDisplay.PERCENT,categoryDisplay:Wt.CategoryDisplay.DEFAULT,legendDisplay:Wt.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:ma.layerTypes.DATA,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:void 0:Object(Ct.getColorMappingDefaults)()}]},previewIcon:Jt[a].icon,hide:"reduced"===e.changeType||ga(l)||t&&!fa(t.shape)};d.push(s),d.push({...s,title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"{chartName}",values:{chartName:Jt[a===Wt.PieChartTypes.PIE?Wt.PieChartTypes.DONUT:Wt.PieChartTypes.PIE].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:a===Wt.PieChartTypes.PIE?Wt.PieChartTypes.DONUT:Wt.PieChartTypes.PIE},hide:!0})}return l.length<=Jt.treemap.maxBuckets&&(!i||i===Wt.PieChartTypes.TREEMAP)&&d.push({title:u.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"Treemap"}),score:(null==t?void 0:t.shape)===Wt.PieChartTypes.TREEMAP?.7:.5,state:{shape:Wt.PieChartTypes.TREEMAP,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,categoryDisplay:t.layers[0].categoryDisplay===Wt.CategoryDisplay.INSIDE?Wt.CategoryDisplay.DEFAULT:t.layers[0].categoryDisplay,layerType:ma.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:Wt.NumberDisplay.PERCENT,categoryDisplay:Wt.CategoryDisplay.DEFAULT,legendDisplay:Wt.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:ma.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Jt.treemap.icon,hide:"reduced"===e.changeType||ga(l)}),l.length<=Jt.mosaic.maxBuckets&&(!i||i===Wt.PieChartTypes.MOSAIC)&&d.push({title:u.i18n.translate("xpack.lens.pie.mosaicSuggestionLabel",{defaultMessage:"Mosaic"}),score:(null==t?void 0:t.shape)===Wt.PieChartTypes.MOSAIC?.7:.5,state:{shape:Wt.PieChartTypes.MOSAIC,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,categoryDisplay:Wt.CategoryDisplay.DEFAULT,layerType:ma.layerTypes.DATA,allowMultipleMetrics:!1,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,numberDisplay:Wt.NumberDisplay.PERCENT,categoryDisplay:Wt.CategoryDisplay.DEFAULT,legendDisplay:Wt.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:ma.layerTypes.DATA,allowMultipleMetrics:!1,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Jt.mosaic.icon,hide:2!==l.length||"reduced"===e.changeType||ga(l)}),l.length<=Jt.waffle.maxBuckets&&(!i||i===Wt.PieChartTypes.WAFFLE)&&d.push({title:u.i18n.translate("xpack.lens.pie.waffleSuggestionLabel",{defaultMessage:"Waffle"}),score:(null==t?void 0:t.shape)===Wt.PieChartTypes.WAFFLE?.7:.4,state:{shape:Wt.PieChartTypes.WAFFLE,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,secondaryGroups:[],categoryDisplay:Wt.CategoryDisplay.DEFAULT,layerType:ma.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:Wt.NumberDisplay.PERCENT,categoryDisplay:Wt.CategoryDisplay.DEFAULT,legendDisplay:Wt.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:ma.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Jt.waffle.icon,hide:1!==l.length||"reduced"===e.changeType||ga(l)}),[...d].map((e=>({...e,score:p?0:e.score+.05*l.length+.01*c.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:t&&t.shape===e.state.shape||p||o||e.hide,incomplete:o})))}a(196);const va=[{value:Et.LegendValue.Value,label:u.i18n.translate("xpack.lens.shared.legendValues.value",{defaultMessage:"Value"})}],ya=[{id:"pieLegendDisplay-default",value:Wt.LegendDisplay.DEFAULT,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:Wt.LegendDisplay.SHOW,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:Wt.LegendDisplay.HIDE,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}],xa=u.i18n.translate("xpack.lens.pieChart.emptySizeRatioLabel",{defaultMessage:"Inner area size"});function ja(e){var t,a,n,i,l,r,o,c;const{state:d,setState:p,frame:m}=e,g=d.layers[0],{categoryOptions:b,numberOptions:h,emptySizeRatioOptions:y,isDisabled:x}=Jt[d.shape].toolbarPopover,j=g.legendSize,[O]=Object(s.useState)((()=>j===oe.LegendSize.AUTO)),I=Object(s.useCallback)((e=>{p({...d,layers:[{...g,...e}]})}),[g,d,p]),T=Object(s.useCallback)((e=>I({categoryDisplay:e})),[I]),w=Object(s.useCallback)((e=>I({numberDisplay:e})),[I]),k=Object(s.useCallback)((e=>{I({percentDecimals:e})}),[I]),E=Object(s.useCallback)((e=>{I({legendDisplay:ya.find((({id:t})=>t===e)).value})}),[I]),C=Object(s.useCallback)((e=>I({legendPosition:e})),[I]),F=Object(s.useCallback)((e=>I({nestedLegend:!g.nestedLegend})),[g,I]),S=Object(s.useCallback)((()=>{var e;const t=null===(e=g.truncateLegend)||void 0===e||e;I({truncateLegend:!t})}),[g,I]),A=Object(s.useCallback)((e=>I({legendMaxLines:e})),[I]),P=Object(s.useCallback)((e=>I({legendSize:e})),[I]),_=Object(s.useCallback)((e=>{I({legendStats:e})}),[I]),L=Object(s.useCallback)((e=>{var t;const a=null==y||null===(t=y.find((({id:t})=>t===e)))||void 0===t?void 0:t.value;I({emptySizeRatio:a})}),[y,I]);if(!g)return null;const D=na(d,m.datasourceLayers).truncateText;return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),isDisabled:Boolean(x),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},b.length?Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(v.jsx)(f.EuiSuperSelect,{compressed:!0,valueOfSelected:g.categoryDisplay,options:b,onChange:T})):null,h.length&&"hide"!==g.categoryDisplay?Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(v.jsx)(f.EuiSuperSelect,{compressed:!0,valueOfSelected:g.numberDisplay,options:h,onChange:w})):null,h.length+b.length?Object(v.jsx)(f.EuiHorizontalRule,{margin:"s"}):null,Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(v.jsx)(Oa,{value:null!==(t=g.percentDecimals)&&void 0!==t?t:2,setValue:k}))),null!=y&&y.length?Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.pieChart.visualOptionsLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"center",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(v.jsx)(f.EuiFormRow,{label:xa,display:"columnCompressed",fullWidth:!0},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:xa,options:y,idSelected:null!==(a=null===(n=y.find((({value:e})=>e===g.emptySizeRatio)))||void 0===n?void 0:n.id)&&void 0!==a?a:"emptySizeRatioOption-small",onChange:L,"data-test-subj":"lnsEmptySizeRatioButtonGroup"}))):null,Object(v.jsx)(M.e,{legendOptions:ya,mode:g.legendDisplay,onDisplayChange:E,legendStats:ea(g,d.shape),allowedLegendStats:null!==(i=Jt[d.shape])&&void 0!==i&&i.legend.defaultLegendStats?va:void 0,onLegendStatsChange:_,position:g.legendPosition,onPositionChange:C,renderNestedLegendSwitch:!(null!==(l=Jt[d.shape])&&void 0!==l&&l.legend.hideNestedLegendSwitch)&&g.primaryGroups.length+(null!==(r=null===(o=g.secondaryGroups)||void 0===o?void 0:o.length)&&void 0!==r?r:0)>1,nestedLegend:Boolean(g.nestedLegend),onNestedLegendChange:F,shouldTruncate:null!==(c=g.truncateLegend)&&void 0!==c?c:D,onTruncateLegendChange:S,maxLines:null==g?void 0:g.legendMaxLines,onMaxLinesChange:A,legendSize:j,onLegendSizeChange:P,showAutoLegendSizeOption:O}))}const Oa=({value:e,setValue:t})=>{const{inputValue:a,handleInputChange:n}=Object(je.a)({value:e,onChange:t},{allowFalsyValue:!0});return Object(v.jsx)(f.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:a,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{n(Number(e.currentTarget.value))}})};var Ia=a(1),Ma=a.n(Ia),Ta=a(49),wa=a(53);const ka=Object(wa.createSlice)({name:"colorMapping",initialState:{assignments:[],specialAssignments:[],paletteId:"eui",colorMode:{type:"categorical"}},reducers:{updateModel:(e,t)=>{e.assignments=[...t.payload.assignments],e.specialAssignments=[...t.payload.specialAssignments],e.paletteId=t.payload.paletteId,e.colorMode={...t.payload.colorMode}},updatePalette:(e,t)=>{e.paletteId=t.payload.paletteId,e.assignments=[...t.payload.assignments],e.colorMode={...t.payload.colorMode}},assignStatically:(e,t)=>{e.assignments=[...t.payload]},assignAutomatically:e=>{e.assignments=[]},addNewAssignment:(e,t)=>{e.assignments.push({...t.payload})},addNewAssignments:(e,t)=>{e.assignments.push(...t.payload)},updateAssignment:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...t.payload.assignment,touched:!0}},updateAssignmentRule:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...e.assignments[t.payload.assignmentIndex],rule:t.payload.rule}},updateAssignmentColor:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...e.assignments[t.payload.assignmentIndex],color:t.payload.color,touched:!0}},updateSpecialAssignmentColor:(e,t)=>{e.specialAssignments[t.payload.assignmentIndex]={...e.specialAssignments[t.payload.assignmentIndex],color:t.payload.color,touched:!0}},removeAssignment:(e,t)=>{e.assignments.splice(t.payload,1),0===e.assignments.length&&(e.specialAssignments[Ht.c]={...e.specialAssignments[Ht.c],color:{type:"loop"},touched:!0})},removeAllAssignments:e=>{e.assignments=[],e.specialAssignments[Ht.c]={...e.specialAssignments[Ht.c],color:{type:"loop"},touched:!0}},changeColorMode:(e,t)=>{e.colorMode={...t.payload}},updateGradientColorStep:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,steps:e.colorMode.steps.map(((e,a)=>a===t.payload.index?{...t.payload.color,touched:!0}:{...e,touched:!1}))})},removeGradientColorStep:(e,t)=>{if("gradient"!==e.colorMode.type)return;const a=[...e.colorMode.steps];a.splice(t.payload,1);const n=2===e.colorMode.steps.length?"desc"===e.colorMode.sort?0===t.payload?"asc":"desc":0===t.payload?"desc":"asc":e.colorMode.sort;e.colorMode={...e.colorMode,steps:[...a],sort:n}},addGradientColorStep:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,steps:[...e.colorMode.steps.slice(0,t.payload.at),{...t.payload.color,touched:!1},...e.colorMode.steps.slice(t.payload.at)]})},changeGradientSortOrder:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,sort:t.payload})}}}),{updatePalette:Ea,assignStatically:Ca,assignAutomatically:Fa,addNewAssignment:Sa,addNewAssignments:Aa,updateAssignment:Pa,updateAssignmentColor:_a,updateSpecialAssignmentColor:La,updateAssignmentRule:Da,removeAssignment:Ra,removeAllAssignments:Na,changeColorMode:Ba,updateGradientColorStep:za,removeGradientColorStep:Va,addGradientColorStep:Ga,changeGradientSortOrder:qa,updateModel:$a}=ka.actions,Ha=ka.reducer;function Ua(e,t,a,n,i){const s=n(a);return e.map((({rule:e,color:n,touched:l},r)=>i&&l?{rule:e,color:n,touched:l}:{rule:e,color:"categorical"===t.type?{type:"categorical",paletteId:a,colorIndex:r%s.colorCount}:{type:"gradient"},touched:!1}))}function Wa(e,t,a){return"categorical"===e.type?e:{type:"gradient",steps:e.steps.map(((e,n)=>a?e:{type:"categorical",paletteId:t,colorIndex:n,touched:!1})),sort:e.sort}}function Xa({palettes:e,getPaletteFn:t,isDarkMode:a}){const n=Object(Ta.useDispatch)(),i=Object(Ta.useSelector)((e=>e.colorMapping)),r=Object(s.useCallback)(((e,a)=>{n(Ea({paletteId:e,assignments:Ua(i.assignments,i.colorMode,e,t,a),colorMode:Wa(i.colorMode,e,a)}))}),[t,i,n]),[o,c]=Object(s.useState)(null),d=null!==o?Object(v.jsx)(f.EuiConfirmModal,{title:u.i18n.translate("coloring.colorMapping.colorChangesModal.title",{defaultMessage:"Color changes detected"}),onCancel:()=>{o&&r(o,!0),c(null)},onConfirm:()=>{o&&r(o,!1),c(null)},confirmButtonText:u.i18n.translate("coloring.colorMapping.colorChangesModal.discardButton",{defaultMessage:"Discard changes"}),cancelButtonText:u.i18n.translate("coloring.colorMapping.colorChangesModal.preserveButton",{defaultMessage:"Preserve changes"}),buttonColor:"danger",defaultFocusedButton:"confirm"},Object(v.jsx)("p",null,u.i18n.translate("coloring.colorMapping.colorChangesModal.switchPaletteDescription",{defaultMessage:"Switching palette will discard all your custom color changes"}))):null;return Object(v.jsx)(l.a.Fragment,null,d,Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("coloring.colorMapping.paletteSelector.paletteLabel",{defaultMessage:"Color palette"})},Object(v.jsx)(f.EuiColorPalettePicker,{"data-test-subj":"kbnColoring_ColorMapping_PalettePicker",fullWidth:!0,palettes:[...e.values()].filter((e=>"Neutral"!==e.name)).map((e=>({"data-test-subj":`kbnColoring_ColorMapping_Palette-${e.id}`,value:e.id,title:e.name,palette:Array.from({length:e.colorCount},((t,n)=>e.getColor(n,a,!1))),type:"fixed"}))),onChange:e=>{const t=i.assignments.some((e=>e.touched)),a="gradient"===i.colorMode.type&&i.colorMode.steps.some((e=>e.touched));t||a?c(e):r(e,!1)},valueOfSelected:i.paletteId,selectionDisplay:"palette",compressed:!0})))}var Ya=a(131);function Qa(e){return t=>e(t.colorMapping.paletteId)}function Ka(e){return e.colorMapping.colorMode}function Za(e){return e.colorMapping.specialAssignments}function Ja(e){return e.ui.colorPicker}function en(e){return e.colorMapping.assignments}var tn=a(126),an=a(153);const nn=Object(wa.createSlice)({name:"colorMapping",initialState:{colorPicker:{index:0,visibile:!1,type:"assignment"}},reducers:{colorPickerVisibility:(e,t)=>{e.colorPicker.visibile=t.payload.visible,e.colorPicker.index=t.payload.index,e.colorPicker.type=t.payload.type},switchColorPickerVisibility:e=>{e.colorPicker.visibile=!e.colorPicker.visibile},showColorPickerVisibility:e=>{e.colorPicker.visibile=!0},hideColorPickerVisibility:e=>{e.colorPicker.visibile=!1}}}),{colorPickerVisibility:sn,switchColorPickerVisibility:ln,showColorPickerVisibility:rn,hideColorPickerVisibility:on}=nn.actions,un=nn.reducer;var cn={name:"1euhu58",styles:"position:absolute;top:0;left:0;width:16px;height:16px"};function dn({colorMode:e,currentPalette:t,at:a}){const n=Object(f.useEuiTheme)(),i=Object(Ta.useDispatch)();return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiToolTip,{position:"top",content:u.i18n.translate("coloring.colorMapping.container.addGradientStopButtonLabel",{defaultMessage:"Add gradient stop"})},Object(v.jsx)("button",{id:"lnsColorMappingGradientAddButton",css:Object(v.css)("position:relative;border-radius:50%;width:16px;height:16px;padding:0;",Object(f.euiFocusRing)(n),";opacity:0;",f.euiCanAnimate,"{transition:opacity ",n.euiTheme.animation.fast," ease-in;}",""),onClick:()=>{i(Ga({color:{type:"categorical",colorIndex:e.steps.length,paletteId:t.id},at:a})),i(sn({index:a,type:"gradient",visible:!0}))}},Object(v.jsx)("div",{css:Object(v.css)("width:16px;height:16px;border-radius:50%;background-color:",n.euiTheme.colors.emptyShade,";transform-origin:center;transition:transform ",n.euiTheme.animation.fast," ease-in;&:hover{transform:scale(1.2);}",Object(f.euiShadowSmall)(n),";","")},Object(v.jsx)(f.EuiIcon,{type:"plus",height:16,width:16,css:cn,color:n.euiTheme.colors.text})))))}var pn=a(109);function mn({palette:e,isDarkMode:t,color:a,getPaletteFn:n,selectColor:i}){const s=Array.from({length:e.colorCount},((a,n)=>e.getColor(n,t,!1))),r=Array.from({length:pn.a.colorCount},((e,a)=>pn.a.getColor(a,t,!1))),o="categorical"===a.type?a.paletteId===pn.a.id?pn.a.getColor(a.colorIndex,t,!1):n(a.paletteId).getColor(a.colorIndex,t,!1):a.colorCode;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFlexGroup,{direction:"column",style:{padding:8}},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiText,{size:"s"},Object(v.jsx)("strong",null,u.i18n.translate("coloring.colorMapping.colorPicker.paletteColorsLabel",{defaultMessage:"Palette colors"}))),Object(v.jsx)(f.EuiFlexGroup,{direction:"row",gutterSize:"s",wrap:!0,alignItems:"center",justifyContent:"flexStart"},s.map(((t,a)=>Object(v.jsx)(f.EuiFlexItem,{key:t,grow:0},Object(v.jsx)(f.EuiColorPickerSwatch,{"data-test-subj":`lns-colorMapping-colorPicker-staticColor-${a}`,style:{border:Object(tn.e)(t,o)?"2px solid black":"transparent"},color:t,onClick:()=>i({type:"categorical",paletteId:e.id,colorIndex:a})}))))))),Object(v.jsx)(f.EuiHorizontalRule,{margin:"xs"}),Object(v.jsx)(f.EuiFlexGroup,{style:{padding:8,paddingTop:0}},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiText,{size:"s"},Object(v.jsx)("strong",null,u.i18n.translate("coloring.colorMapping.colorPicker.themeAwareColorsLabel",{defaultMessage:"Neutral colors"})),Object(v.jsx)(f.EuiToolTip,{position:"bottom",content:u.i18n.translate("coloring.colorMapping.colorPicker.themeAwareColorsTooltip",{defaultMessage:"The provided neutral colors are theme-aware and will change appropriately when switching between light and dark themes."})},Object(v.jsx)(f.EuiIcon,{tabIndex:0,type:"questionInCircle"}))),Object(v.jsx)(f.EuiFlexGroup,{direction:"row",gutterSize:"s",wrap:!0,alignItems:"center",justifyContent:"flexStart"},r.map(((e,t)=>Object(v.jsx)(f.EuiFlexItem,{key:e,grow:0},Object(v.jsx)(f.EuiColorPickerSwatch,{style:{border:Object(tn.e)(e,o)?"2px solid black":"transparent"},"data-test-subj":`lns-colorMapping-colorPicker-neutralColor-${t}`,color:e,onClick:()=>i({type:"categorical",paletteId:pn.a.id,colorIndex:t})}))))))))}var gn=a(135),fn=a.n(gn),bn=a(114),hn=a.n(bn),vn={name:"10a8jpa",styles:"position:absolute;right:8px;top:6px"},yn={name:"bjn8wh",styles:"position:relative"};function xn({isDarkMode:e,color:t,getPaletteFn:a,selectColor:n,close:i}){const[l,r]=Object(s.useState)(t),o="categorical"===l.type?a(l.paletteId).getColor(l.colorIndex,e,!1):l.colorCode,[c,d]=Object(s.useState)(o),p=Object(tn.d)(o,!1,3),m=Object(tn.d)(o,!0,3),g=[!1===p?"light":void 0,!1===m?"dark":void 0].filter(Boolean),b=!hn.a.valid(c),h=!p||!m;fn()((()=>{t!==l&&n(l)}),500,[t,l]);const y=b?Me.euiThemeVars.euiColorDanger:h?Me.euiThemeVars.euiColorWarning:"",x=b?Me.euiThemeVars.euiColorDangerText:h?Me.euiThemeVars.euiColorWarningText:"";return Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"s",style:{padding:8}},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiColorPicker,{onChange:e=>{r({type:"colorCode",colorCode:e}),d(e)},color:o,display:"inline",swatches:[]})),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)("div",{css:b||h?Object(v.css)("input{background-image:linear-gradient(\n                      to top,\n                      ",y,",\n                      ",y," 2px,\n                      transparent 2px,\n                      transparent 100%\n                    )!important;background-size:100%;padding-right:32px;}.euiFormErrorText{color:",x,"!important;}",""):void 0},Object(v.jsx)(f.EuiFormRow,null,Object(v.jsx)(f.EuiFlexGroup,{css:yn},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFieldText,{placeholder:"#FF00FF",value:c,compressed:!0,onChange:e=>{const t=e.currentTarget.value;d(t),hn.a.valid(t)&&r({type:"colorCode",colorCode:t})},"aria-label":u.i18n.translate("coloring.colorMapping.colorPicker.hexColorinputAriaLabel",{defaultMessage:"hex color input"})})),(b||h)&&Object(v.jsx)("div",{css:vn},Object(v.jsx)(f.EuiToolTip,{position:"bottom",content:b?u.i18n.translate("coloring.colorMapping.colorPicker.invalidColorHex",{defaultMessage:"Please use a valid color hex code"}):h?u.i18n.translate("coloring.colorMapping.colorPicker.lowContrastColor",{defaultMessage:"This color has a low contrast in {themes} {errorModes, plural, one {mode} other {# modes}}",values:{themes:g.join(","),errorModes:g.length}}):void 0},Object(v.jsx)(f.EuiIcon,{tabIndex:0,type:"warning",color:b?Me.euiThemeVars.euiColorDangerText:h?Me.euiThemeVars.euiColorWarningText:Me.euiThemeVars.euiColorPrimary}))))))))}function jn({palette:e,getPaletteFn:t,color:a,close:n,selectColor:i,isDarkMode:r,deleteStep:o}){const[c,d]=Object(s.useState)("categorical"!==a.type||a.paletteId!==e.id&&a.paletteId!==pn.a.id?"custom":"palette");return Object(v.jsx)("div",{style:{width:168}},Object(v.jsx)(f.EuiPopoverTitle,{paddingSize:"none",style:{borderBottom:"none"}},Object(v.jsx)(f.EuiTabs,{size:"m",expand:!0},Object(v.jsx)(f.EuiTab,{onClick:()=>d("palette"),isSelected:"palette"===c},Object(v.jsx)(f.EuiTitle,{size:"xxxs"},Object(v.jsx)("span",null,u.i18n.translate("coloring.colorMapping.colorPicker.paletteTabLabel",{defaultMessage:"Colors"})))),Object(v.jsx)(f.EuiTab,{onClick:()=>d("custom"),isSelected:"custom"===c},Object(v.jsx)(f.EuiTitle,{size:"xxxs"},Object(v.jsx)("span",null,u.i18n.translate("coloring.colorMapping.colorPicker.customTabLabel",{defaultMessage:"Custom"})))))),"palette"===c?Object(v.jsx)(mn,{color:a,getPaletteFn:t,palette:e,selectColor:i,isDarkMode:r}):Object(v.jsx)(xn,{color:a,getPaletteFn:t,isDarkMode:r,selectColor:i,palette:e,close:n}),o?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiHorizontalRule,{margin:"xs"}),Object(v.jsx)(f.EuiButtonEmpty,{color:"danger",size:"xs",iconType:"trash",onClick:()=>{n(),o()},style:{paddingBottom:8}},u.i18n.translate("coloring.colorMapping.colorPicker.removeGradientColorButtonLabel",{defaultMessage:"Remove color stop"}))):null)}const On=({colorMode:e,assignmentColor:t,getPaletteFn:a,index:n,total:i,palette:s,onColorChange:l,swatchShape:r,isDarkMode:o,forType:c})=>{const d=Object(Ta.useSelector)(Ja),p=Object(Ta.useDispatch)(),m=d.index===n&&d.type===c&&d.visibile,g=Object(an.a)(e,t,a,o,n,i),b=Object(f.isColorDark)(...Object(tn.c)(g).rgb()),h=Object(f.useEuiTheme)();return"gradient"!==t.type?Object(v.jsx)(f.EuiPopover,{panelPaddingSize:"none",isOpen:m,repositionOnScroll:!0,closePopover:()=>p(on()),anchorPosition:"upLeft",button:"round"===r?Object(v.jsx)("button",{"aria-label":u.i18n.translate("coloring.colorMapping.colorPicker.pickAColorAriaLabel",{defaultMessage:"Pick a color"}),"data-test-subj":`lns-colorMapping-colorSwatch-${n}`,onClick:()=>p(m?on():sn({index:n,visible:!0,type:c})),css:Object(v.css)("background:",g,";width:16px;height:16px;border-radius:50%;top:8px;border:3px solid ",h.euiTheme.colors.emptyShade,";",Object(f.euiShadowSmall)(h),";backgroundcolor:",g,";cursor:pointer;","")}):Object(v.jsx)(f.EuiColorPickerSwatch,{color:g,"aria-label":u.i18n.translate("coloring.colorMapping.colorPicker.pickAColorAriaLabel",{defaultMessage:"Pick a color"}),"data-test-subj":`lns-colorMapping-colorSwatch-${n}`,onClick:()=>p(m?on():sn({index:n,visible:!0,type:c})),style:{backgroundColor:g,cursor:"pointer",width:32,height:32},css:Object(v.css)("&::after{content:'';width:0;height:0;border-left:3px solid transparent;border-right:3px solid transparent;border-top:4px solid ",b?"white":"black",";margin:0;bottom:2px;position:absolute;right:2px;}","")})},Object(v.jsx)(jn,{key:"categorical"===t.type?`${t.colorIndex}-${t.paletteId}`:t.colorCode,color:t,palette:s,getPaletteFn:a,close:()=>p(on()),isDarkMode:o,selectColor:e=>{l(e)},deleteStep:"gradient"===e.type&&i>1?()=>p(Va(n)):void 0})):Object(v.jsx)(f.EuiColorPickerSwatch,{color:g,"aria-label":u.i18n.translate("coloring.colorMapping.colorPicker.newColorAriaLabel",{defaultMessage:"Select a new color"}),disabled:!0,style:{backgroundColor:g,cursor:"not-allowed",width:32,height:32}})};var In={name:"k1klf8",styles:"position:absolute;width:16px;height:16px;top:8px;right:0"},Mn={name:"vkp89y",styles:"position:absolute;width:16px;height:16px;left:50%;top:8px"},Tn={name:"7tu4fy",styles:"position:absolute;left:0;top:6px"},wn={name:"1gfj639",styles:"position:relative;height:24px;&:hover{button{opacity:1;}}"};function kn({paletteId:e,colorMode:t,getPaletteFn:a,isDarkMode:n}){const i=Object(Ta.useDispatch)();if("categorical"===t.type)return null;const s=a(e),l=Object(an.c)(t,a,n),r="asc"===t.sort?1===t.steps.length?void 0:t.steps.at(-1):t.steps.at(0),o="asc"===t.sort?1===t.steps.length?NaN:t.steps.length-1:0,u="asc"===t.sort?t.steps.at(0):1===t.steps.length?void 0:t.steps.at(-1),c="asc"===t.sort?0:1===t.steps.length?NaN:t.steps.length-1,d=3===t.steps.length?t.steps[1]:void 0,p=3===t.steps.length?1:NaN;return Object(v.jsx)("div",{css:wn},Object(v.jsx)("div",{css:Object(v.css)("position:absolute;left:6px;right:6px;height:8px;top:12px;border-radius:6px;background-origin:border-box;background-image:linear-gradient(\n            to right,\n            ",[l(0),l(.5),l(1)].join(","),"\n          );border:1px solid ",Object(tn.a)(Me.euiThemeVars.euiColorDarkestShade,.2),";","")}),Object(v.jsx)("div",{css:Tn},r?Object(v.jsx)(On,{forType:"gradient",colorMode:t,assignmentColor:r,getPaletteFn:a,index:o,palette:s,total:t.steps.length,swatchShape:"round",isDarkMode:n,onColorChange:e=>{i(za({index:o,color:e}))}}):Object(v.jsx)(dn,{colorMode:t,currentPalette:s,at:1})),Object(v.jsx)("div",{css:Mn},d?Object(v.jsx)(On,{forType:"gradient",colorMode:t,assignmentColor:d,getPaletteFn:a,index:p,palette:s,total:t.steps.length,swatchShape:"round",isDarkMode:n,onColorChange:e=>{i(za({index:p,color:e}))}}):2===t.steps.length?Object(v.jsx)(dn,{colorMode:t,currentPalette:s,at:1}):void 0),Object(v.jsx)("div",{css:In},u?Object(v.jsx)(On,{forType:"gradient",colorMode:t,assignmentColor:u,getPaletteFn:a,index:c,palette:s,total:t.steps.length,swatchShape:"round",isDarkMode:n,onColorChange:e=>{i(za({index:c,color:e}))}}):Object(v.jsx)(dn,{colorMode:t,currentPalette:s,at:1})))}function En({getPaletteFn:e}){const t=Object(Ta.useDispatch)(),a=Object(Ta.useSelector)((e=>e.colorMapping.colorMode)),n=Object(Ta.useSelector)((e=>e.colorMapping)),{paletteId:i}=n,r=Object(s.useCallback)(((a,s)=>{const l="gradient"===a?{type:"gradient",steps:[{type:"categorical",paletteId:i,colorIndex:0,touched:!1}],sort:"desc"}:{type:"categorical"},r=Ua(n.assignments,l,i,e,s);t(Ea({paletteId:i,assignments:r,colorMode:l}))}),[e,n,t,i]),[o,c]=Object(s.useState)(null),d=null!==o?Object(v.jsx)(f.EuiConfirmModal,{title:u.i18n.translate("coloring.colorMapping.colorChangesModal.modalTitle",{defaultMessage:"Color changes detected"}),onCancel:()=>{c(null)},onConfirm:()=>{o&&r(o,!1),c(null)},cancelButtonText:u.i18n.translate("coloring.colorMapping.colorChangesModal.goBackButtonLabel",{defaultMessage:"Go back"}),confirmButtonText:u.i18n.translate("coloring.colorMapping.colorChangesModal.discardButtonLabel",{defaultMessage:"Discard changes"}),defaultFocusedButton:"confirm",buttonColor:"danger"},Object(v.jsx)("p",null,"categorical"===o?u.i18n.translate("coloring.colorMapping.colorChangesModal.categoricalModeDescription",{defaultMessage:"Switching to a categorical mode will discard all your custom color changes"}):u.i18n.translate("coloring.colorMapping.colorChangesModal.sequentialModeDescription",{defaultMessage:"Switching to a gradient mode will discard all your custom color changes"}))):null;return Object(v.jsx)(l.a.Fragment,null,d,Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("coloring.colorMapping.paletteSelector.scaleLabel",{defaultMessage:"Mode"})},Object(v.jsx)(f.EuiButtonGroup,{legend:"Mode","data-test-subj":"lns_colorMapping_scaleSwitch",options:[{id:"categorical",label:u.i18n.translate("coloring.colorMapping.paletteSelector.categoricalLabel",{defaultMessage:"Categorical"}),iconType:"palette"},{id:"gradient",label:u.i18n.translate("coloring.colorMapping.paletteSelector.gradientLabel",{defaultMessage:"Gradient"}),iconType:"gradient"}],isIconOnly:!0,idSelected:a.type,onChange:e=>{const t=n.assignments.some((e=>e.touched)),a="gradient"===n.colorMode.type&&n.colorMode.steps.some((e=>e.touched));t||a?c(e):r(e,!1)}})))}function Cn({assignmentColor:e,index:t,palette:a,getPaletteFn:n,isDarkMode:i,total:s}){const l=Object(Ta.useDispatch)();return Object(v.jsx)(On,{forType:"specialAssignment",colorMode:{type:"categorical"},assignmentColor:e,getPaletteFn:n,index:t,palette:a,total:s,swatchShape:"square",isDarkMode:i,onColorChange:e=>{l(La({assignmentIndex:t,color:e}))}})}function Fn({palettes:e,data:t,isDarkMode:a}){const n=Object(Ta.useDispatch)(),i=Object(Ya.b)(e,pn.a),s=Object(Ta.useSelector)(Qa(i)),l=Object(Ta.useSelector)(Ka),r=Object(Ta.useSelector)(Za),o=r[Ht.c],c=[{id:"loop",label:"gradient"===l.type?u.i18n.translate("coloring.colorMapping.container.unassignedTermsMode.ReuseGradientLabel",{defaultMessage:"Gradient"}):u.i18n.translate("coloring.colorMapping.container.unassignedTermsMode.ReuseColorsLabel",{defaultMessage:"Color palette"})},{id:"static",label:u.i18n.translate("coloring.colorMapping.container.unassignedTermsMode.SingleColorLabel",{defaultMessage:"Single color"})}];return Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("coloring.colorMapping.container.unassignedTermsModeHeader",{defaultMessage:"Color for unassigned terms"})},Object(v.jsx)(f.EuiFlexGroup,{direction:"row",gutterSize:"s",justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiButtonGroup,{legend:"Color mode",options:c,idSelected:"loop"===o.color.type?"loop":"static",onChange:e=>{n(La({assignmentIndex:0,color:"loop"===e?{type:"loop"}:{type:"categorical",colorIndex:Ht.b,paletteId:pn.a.id}}))},buttonSize:"compressed",isFullWidth:!0})),Object(v.jsx)(f.EuiFlexItem,{grow:0},Object(v.jsx)("div",{css:Object(v.css)("visibility:","loop"===o.color.type?"hidden":"visible",";width:32px;height:32px;","")},"categories"===t.type&&"loop"!==o.color.type&&Object(v.jsx)(Cn,{index:0,palette:s,isDarkMode:a,getPaletteFn:i,assignmentColor:o.color,total:r.length})))))}const Sn=({rule:e,updateValue:t})=>{const a=e.min<=e.max,n=e.max>=e.min;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFieldNumber,{compressed:!0,prepend:Object(v.jsx)(f.EuiButtonEmpty,{size:"xs",onClick:()=>t(e.min,e.max,!e.minInclusive,e.maxInclusive)},e.minInclusive?"GTE":"GT"),placeholder:"min",value:e.min,isInvalid:!a,onChange:a=>t(+a.currentTarget.value,e.max,e.minInclusive,e.maxInclusive),"aria-label":"The min value"})),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFieldNumber,{compressed:!0,isInvalid:!n,prepend:Object(v.jsx)(f.EuiButtonEmpty,{size:"xs",onClick:()=>t(e.min,e.max,e.minInclusive,!e.maxInclusive)},e.maxInclusive?"LTE":"LT"),placeholder:"max",value:e.max,onChange:a=>t(e.min,+a.currentTarget.value,e.minInclusive,e.maxInclusive),"aria-label":"The max value"})))};var An=a(12);const Pn=({index:e,rule:t,updateValue:a,options:n,specialTokens:i,assignmentValuesCounter:s})=>{var l;const r=u.i18n.translate("coloring.colorMapping.assignments.duplicateCategoryWarning",{defaultMessage:"This category has already been assigned a different color. Only the first matching assignment will be used."}),o="auto"===t.type?[]:"string"==typeof t.values?[{label:t.values,value:t.values,append:(null!==(l=s.get(t.values))&&void 0!==l?l:0)>1?Object(v.jsx)(f.EuiToolTip,{position:"bottom",content:r},Object(v.jsx)(f.EuiIcon,{size:"s",type:"warning",color:Me.euiThemeVars.euiColorWarningText})):void 0}]:t.values.map((e=>{var t;return{label:(Array.isArray(e)?e:[e]).map((e=>{var t;return null!==(t=i.get(e))&&void 0!==t?t:e})).join(An.MULTI_FIELD_KEY_SEPARATOR),value:e,append:(null!==(t=s.get(e))&&void 0!==t?t:0)>1?Object(v.jsx)(f.EuiToolTip,{position:"bottom",content:r},Object(v.jsx)(f.EuiIcon,{size:"s",type:"warning",color:Me.euiThemeVars.euiColorWarningText})):void 0}})),c=n.map((e=>({label:(Array.isArray(e)?e:[e]).map((e=>{var t;return null!==(t=i.get(e))&&void 0!==t?t:e})).join(An.MULTI_FIELD_KEY_SEPARATOR),value:e})));return Object(v.jsx)(f.EuiFlexItem,{style:{minWidth:1,width:1}},Object(v.jsx)(f.EuiComboBox,{"data-test-subj":`lns-colorMapping-assignmentsItem${e}`,fullWidth:!0,"aria-label":u.i18n.translate("coloring.colorMapping.assignments.autoAssignedTermAriaLabel",{defaultMessage:"This color will be automatically assigned to the first term that doesn't match with all the other assignments"}),placeholder:u.i18n.translate("coloring.colorMapping.assignments.autoAssignedTermPlaceholder",{defaultMessage:"Auto assigned"}),options:c,selectedOptions:o,onChange:e=>{a(e.reduce(((e,t)=>(void 0!==t.value&&e.push(t.value),e)),[]))},onCreateOption:e=>{-1===o.findIndex((t=>t.label===e))&&a([...o,{label:e,value:e}].map((e=>e.value)))},isCaseSensitive:!0,isClearable:!1,compressed:!0}))};function _n({data:e,assignment:t,disableDelete:a,index:n,total:i,palette:s,colorMode:l,getPaletteFn:r,isDarkMode:o,specialTokens:c,assignmentValuesCounter:d}){const p=Object(Ta.useDispatch)();return Object(v.jsx)(f.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center",justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,{grow:0},Object(v.jsx)(On,{forType:"assignment",isDarkMode:o,swatchShape:"square",colorMode:l,assignmentColor:t.color,getPaletteFn:r,index:n,palette:s,total:i,onColorChange:e=>{p(_a({assignmentIndex:n,color:e}))}})),"auto"===t.rule.type||"matchExactly"===t.rule.type||"matchExactlyCI"===t.rule.type?Object(v.jsx)(Pn,{index:n,rule:t.rule,options:"categories"===e.type?e.categories:[],specialTokens:c,updateValue:e=>{p(Da({assignmentIndex:n,rule:0===e.length?{type:"auto"}:{type:"matchExactly",values:e}}))},assignmentValuesCounter:d}):"range"===t.rule.type?Object(v.jsx)(Sn,{rule:t.rule,updateValue:(e,t,a,i)=>{p(Da({assignmentIndex:n,rule:{type:"range",min:e,max:t,minInclusive:a,maxInclusive:i}}))}}):null,Object(v.jsx)(f.EuiFlexItem,{grow:0},Object(v.jsx)(f.EuiButtonIcon,{iconType:"trash",size:"xs",disabled:a,onClick:()=>p(Ra(n)),"aria-label":u.i18n.translate("coloring.colorMapping.assignments.deleteAssignmentButtonLabel",{defaultMessage:"Delete this assignment"}),color:"danger",css:a?void 0:Object(v.css)("color:",Me.euiThemeVars.euiTextSubduedColor,";transition:",Me.euiThemeVars.euiAnimSpeedFast," ease-in-out;transition-property:color;&:hover,&:focus{color:",Me.euiThemeVars.euiColorDangerText,";}","")})))}var Ln=a(185),Dn={name:"d3v9zr",styles:"overflow:hidden"};function Rn({data:e,palettes:t,isDarkMode:a,specialTokens:n}){const[i,l]=Object(s.useState)(!1),r=Object(Ta.useDispatch)(),o=Object(Ya.b)(t,pn.a),c=Object(Ta.useSelector)(Qa(o)),d=Object(Ta.useSelector)(Ka),p=Object(Ta.useSelector)(en),m=Object(s.useMemo)((()=>"categories"===e.type?e.categories.filter((e=>!p.some((({rule:t})=>Object(Ln.b)(t,e))))):[]),[e,p]),g=p.reduce(((e,t)=>(("matchExactly"===t.rule.type?t.rule.values:[]).forEach((t=>{var a;e.set(t,(null!==(a=e.get(t))&&void 0!==a?a:0)+1)})),e)),new Map),b=Object(s.useCallback)((()=>{const t=Object(pa.findLast)(p,(e=>"categorical"===e.color.type)),a="categorical"===(null==t?void 0:t.color.type)?t.color.colorIndex+1:0;r(Sa({rule:"categories"===e.type?{type:"matchExactly",values:[]}:{type:"range",min:0,max:0,minInclusive:!0,maxInclusive:!0},color:"categorical"===d.type?{type:"categorical",paletteId:c.id,colorIndex:a%c.colorCount}:{type:"gradient"},touched:!1}))}),[p,d.type,e.type,r,c.colorCount,c.id]),h=Object(s.useCallback)((()=>{if("categories"===e.type){const e=Object(pa.findLast)(p,(e=>"categorical"===e.color.type)),t="categorical"===(null==e?void 0:e.color.type)?e.color.colorIndex+1:0,a=m.map(((e,a)=>({rule:{type:"matchExactly",values:[e]},color:"categorical"===d.type?{type:"categorical",paletteId:c.id,colorIndex:(t+a)%c.colorCount}:{type:"gradient"},touched:!1})));r(Aa(a))}}),[r,p,d.type,e.type,c.colorCount,c.id,m]);return Object(v.jsx)(f.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1,paddingSize:"none",css:Dn},Object(v.jsx)("div",{css:Object(v.css)("padding:",Me.euiThemeVars.euiPanelPaddingModifiers.paddingSmall,";","")},Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"s","data-test-subj":"lns-colorMapping-assignmentsList"},p.map(((t,i)=>Object(v.jsx)(_n,{key:i,data:e,index:i,total:p.length,colorMode:d,palette:c,isDarkMode:a,getPaletteFn:o,assignment:t,disableDelete:!1,specialTokens:n,assignmentValuesCounter:g}))),0===p.length&&Object(v.jsx)(f.EuiEmptyPrompt,{paddingSize:"s","data-test-subj":"lns-colorMapping-assignmentsPrompt",body:Object(v.jsx)(f.EuiText,{size:"s"},Object(v.jsx)("p",null,u.i18n.translate("coloring.colorMapping.container.mapValuesPromptDescription.mapValuesPromptDetail",{defaultMessage:"Add new assignments to begin associating terms in your data with specified colors."}))),actions:[Object(v.jsx)(f.EuiButton,{color:"primary",size:"s",onClick:b,iconType:"plus"},u.i18n.translate("coloring.colorMapping.container.AddAssignmentButtonLabel",{defaultMessage:"Add assignment"})),Object(v.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lns-colorMapping-assignmentsPromptAddAll",color:"primary",size:"xs",onClick:h},u.i18n.translate("coloring.colorMapping.container.mapValueButtonLabel",{defaultMessage:"Add all unassigned terms"}))]}))),p.length>0&&Object(v.jsx)(f.EuiHorizontalRule,{margin:"none"}),Object(v.jsx)("div",{css:Object(v.css)("padding:",Me.euiThemeVars.euiPanelPaddingModifiers.paddingSmall,";overflow:hidden;","")},p.length>0&&Object(v.jsx)(f.EuiFlexGroup,{direction:"row",alignItems:"center",justifyContent:"spaceBetween",gutterSize:"none"},Object(v.jsx)(f.EuiButton,{color:"text",size:"s",onClick:b,iconType:"plus"},u.i18n.translate("coloring.colorMapping.container.AddAssignmentButtonLabel",{defaultMessage:"Add assignment"})),"categories"===e.type&&Object(v.jsx)(f.EuiPopover,{button:Object(v.jsx)(f.EuiButtonIcon,{iconType:"boxesVertical","aria-label":u.i18n.translate("coloring.colorMapping.container.OpenAdditionalActionsButtonLabel",{defaultMessage:"Open additional assignments actions"}),onClick:()=>l(!0)}),isOpen:i,closePopover:()=>l(!1),panelPaddingSize:"xs",anchorPosition:"downRight",ownFocus:!0},Object(v.jsx)(f.EuiContextMenuPanel,{size:"s",items:[Object(v.jsx)(f.EuiContextMenuItem,{"data-test-subj":"lns-colorMapping-addAllAssignments",key:"item-1",icon:"listAdd",size:"s",onClick:()=>{l(!1),requestAnimationFrame((()=>{h()}))},disabled:0===m.length},Object(v.jsx)(f.EuiFlexGroup,null,Object(v.jsx)(f.EuiFlexItem,null,u.i18n.translate("coloring.colorMapping.container.mapCurrentValuesButtonLabel",{defaultMessage:"Add all unsassigned terms"})),m.length>0&&Object(v.jsx)(f.EuiFlexItem,{grow:0},Object(v.jsx)(f.EuiNotificationBadge,{color:"subdued"},m.length)))),Object(v.jsx)(f.EuiContextMenuItem,{"data-test-subj":"lns-colorMapping-clearAllAssignments",size:"s",icon:Object(v.jsx)(f.EuiIcon,{type:"eraser",size:"m",color:"danger"}),onClick:()=>{l(!1),r(Na())},color:"danger"},u.i18n.translate("coloring.colorMapping.container.clearAllAssignmentsButtonLabel",{defaultMessage:"Clear all assignments"}))]})))))}var Nn={name:"154v9b4",styles:"position:absolute;right:0"};function Bn({data:e,palettes:t,isDarkMode:a,specialTokens:n}){const i=Object(Ta.useDispatch)(),s=Object(Ya.b)(t,pn.a),l=Object(Ta.useSelector)(Qa(s)),r=Object(Ta.useSelector)(Ka),o=Object(Ta.useSelector)(en);return Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"m",justifyContent:"flexStart"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFlexGroup,{direction:"row",alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(Xa,{palettes:t,getPaletteFn:s,isDarkMode:a})),Object(v.jsx)(f.EuiFlexItem,{grow:0},Object(v.jsx)(En,{getPaletteFn:s})))),"gradient"===r.type&&Object(v.jsx)(f.EuiFlexItem,{style:{position:"relative"}},Object(v.jsx)("div",{css:Nn},Object(v.jsx)(f.EuiToolTip,{position:"top",content:u.i18n.translate("coloring.colorMapping.container.invertGradientButtonLabel",{defaultMessage:"Invert gradient"})},Object(v.jsx)(f.EuiButtonIcon,{"data-test-subj":"lns-colorMapping-invertGradient",iconType:"merge",size:"xs","aria-label":u.i18n.translate("coloring.colorMapping.container.invertGradientButtonLabel",{defaultMessage:"Invert gradient"}),onClick:()=>{i(qa("asc"===r.sort?"desc":"asc"))}}))),Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("coloring.colorMapping.container.gradientHeader",{defaultMessage:"Gradient"})},Object(v.jsx)(kn,{colorMode:r,getPaletteFn:s,isDarkMode:a,paletteId:l.id}))),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("coloring.colorMapping.container.mappingAssignmentHeader",{defaultMessage:"Color assignments"})},Object(v.jsx)(Rn,{isDarkMode:a,data:e,palettes:t,specialTokens:n}))),o.length>0&&Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(Fn,{data:e,isDarkMode:a,palettes:t})))}class categorical_color_mapping_CategoricalColorMapping extends l.a.Component{constructor(e){super(e),Ma()(this,"store",void 0),Ma()(this,"unsubscribe",void 0),this.store=Object(wa.configureStore)({preloadedState:{colorMapping:e.model},reducer:{colorMapping:Ha,ui:un}}),this.unsubscribe=this.store.subscribe((()=>{this.props.onModelUpdate(this.store.getState().colorMapping)}))}componentWillUnmount(){this.unsubscribe()}componentDidUpdate(e){Object(pa.isEqual)(e.model,this.props.model)||this.store.dispatch($a(this.props.model))}render(){const{palettes:e,data:t,isDarkMode:a,specialTokens:n}=this.props;return Object(v.jsx)(Ta.Provider,{store:this.store},Object(v.jsx)(Bn,{palettes:e,data:t,isDarkMode:a,specialTokens:n}))}}var zn=a(650),Vn=a(146);function Gn(e){var t,a,n,r;const{inputValue:o,handleInputChange:c}=Object(je.a)({value:e.state,onChange:e.setState}),p=o.layers.find((t=>t.layerId===e.layerId)),m=!(!p||!p.colorMapping),[g,b]=Object(s.useState)(m),h=Object(s.useCallback)((({color:t})=>{if(!p)return;const a={...p.colorsByDimension};t?a[e.accessor]=t:delete a[e.accessor],c({...o,layers:o.layers.map((e=>e.layerId===p.layerId?{...e,colorsByDimension:a}:e))})}),[p,o,e.accessor,c]),y=Object(s.useCallback)((e=>{c({...o,layers:o.layers.map((t=>t.layerId===(null==p?void 0:p.layerId)?{...t,colorMapping:e}:t))})}),[o,p,c]);if(!p)return null;const x=p.primaryGroups.find((e=>!ti(e,p))),j=p.metrics.includes(e.accessor)&&p.allowMultipleMetrics,O=ai(p)?["pie","donut"].includes(e.state.shape)?u.i18n.translate("xpack.lens.pieChart.colorPicker.disabledBecauseSliceBy",{defaultMessage:'You are unable to apply custom colors to individual slices when the layer includes one or more "Slice by" dimensions.'}):u.i18n.translate("xpack.lens.pieChart.colorPicker.disabledBecauseGroupBy",{defaultMessage:'You are unable to apply custom colors to individual slices when the layer includes one or more "Group by" dimensions.'}):void 0,I=Object(Ht.d)(e.isDarkMode,p.colorMapping),T=null===(t=e.frame.activeData)||void 0===t?void 0:t[p.layerId],w=Object(Vn.a)(null!==(a=null==T?void 0:T.rows)&&void 0!==a?a:[],e.accessor);return Object(v.jsx)(l.a.Fragment,null,e.accessor===x&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"},fullWidth:!0},Object(v.jsx)(M.f,{palette:I,siblingRef:e.panelRef,title:g?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:e.isInlineEditing},Object(v.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(v.jsx)(f.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:g,onChange:({target:{checked:e}})=>{Object(d.d)("color_mapping_switch_"+(e?"enabled":"disabled")),y(e?{...Ht.a}:void 0),b(e)}})),Object(v.jsx)(f.EuiFlexItem,null,m||g?Object(v.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:e.isDarkMode,model:null!==(n=p.colorMapping)&&void 0!==n?n:{...Ht.a},onModelUpdate:e=>y(e),palettes:Ya.a,data:{type:"categories",categories:w},specialTokens:Ln.a}):Object(v.jsx)(M.g,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{c({...e.state,palette:t})}})))))),j&&Object(v.jsx)(zn.a,i()({},e,{overwriteColor:null===(r=p.colorsByDimension)||void 0===r?void 0:r[e.accessor],defaultColor:ni({layer:p,columnId:e.accessor,paletteService:e.paletteService,datasource:e.datasource,palette:e.state.palette}),disabledMessage:O,setConfig:h})))}function qn(e){var t,a;const n=e.state.layers.find((t=>t.layerId===e.layerId));return n?Object(v.jsx)(l.a.Fragment,null,[...n.primaryGroups,...null!==(t=n.secondaryGroups)&&void 0!==t?t:[]].includes(e.accessor)&&Object(v.jsx)(be,{value:(null==n||null===(a=n.collapseFns)||void 0===a?void 0:a[e.accessor])||"",onChange:t=>{e.setState({...e.state,layers:e.state.layers.map((a=>a.layerId!==e.layerId?a:{...a,collapseFns:{...a.collapseFns,[e.accessor]:t}}))})}})):null}function $n(e){if("appearance"===e.section)return null;if(e.state.shape===Wt.PieChartTypes.MOSAIC)return null;const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.pieChart.multipleMetrics",{defaultMessage:"Multiple metrics"})},Object(v.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.pieChart.multipleMetrics",{defaultMessage:"Multiple metrics"}),compressed:!0,showLabel:!1,checked:Boolean(t.allowMultipleMetrics),onChange:()=>{e.setState({...e.state,layers:e.state.layers.map((t=>t.layerId!==e.layerId?t:{...t,allowMultipleMetrics:!t.allowMultipleMetrics}))})}})):null}const Hn=(e,t)=>{if(!e||Object(pa.isEqual)(e,t))return[];const{assignments:a,specialAssignments:n,colorMode:i,paletteId:s}=e,{assignments:l,specialAssignments:r,colorMode:o,paletteId:u}=t||{},c=u!==s?`palette_${s}`:void 0,d=["gradient"===i.type&&"gradient"!==(null==o?void 0:o.type)?"gradient":void 0,c,Xn(n,r)].filter(Ct.nonNullable);if(a.length>0){const e=a.length&&!Object(pa.isEqual)(a,l)?`colors_${Wn(a.length)}`:void 0,t=null==l?void 0:l.filter((e=>"colorCode"===e.color.type)),n=a.filter((e=>"colorCode"===e.color.type)),i=n.length&&!Object(pa.isEqual)(t,n)?`custom_colors_${Wn(n.length,1)}`:void 0,s=Qn(a,l);d.push(...[e,i,s].filter(Ct.nonNullable))}return d.map(Un)},Un=e=>`lens_color_mapping_${e}`;function Wn(e,t=2,a=16){if(e>=t&&(1===e||2===e))return String(e);if(e<=t)return`up_to_${t}`;if(e>a)return`above_${a}`;const n=Math.pow(2,Math.ceil(Math.log2(e)));return`${n/2}_to_${n}`}const Xn=(e,t)=>{var a,n,i;return Object(pa.isEqual)(t,e)?void 0:`unassigned_terms_${"colorCode"===(null===(a=e[Ht.c])||void 0===a?void 0:a.color.type)?"custom":"loop"===(null===(n=e[Ht.c])||void 0===n?void 0:n.color.type)?"loop":(null===(i=e[Ht.c])||void 0===i?void 0:i.color.paletteId)===pn.a.id?pn.a.id:"palette"}`},Yn=e=>e.reduce(((e,t)=>"values"in t.rule?e+t.rule.values.length:e+1),0),Qn=(e,t)=>{const a=t&&Yn(t),n=e&&Yn(e);return n&&a!==n?`avg_count_terms_per_color_${Wn(n/e.length,1,4)}`:void 0};const Kn=u.i18n.translate("xpack.lens.pie.groupMetricLabelSingular",{defaultMessage:"Metric"});function Zn(e,t){return{layerId:e,primaryGroups:[],secondaryGroups:void 0,metrics:[],numberDisplay:Wt.NumberDisplay.PERCENT,categoryDisplay:Wt.CategoryDisplay.DEFAULT,legendDisplay:Wt.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:ue.LayerTypes.DATA,colorMapping:t}}const Jn=e=>e.isBucketed,ei=e=>!e.isBucketed&&"number"===e.dataType&&!e.isStaticValue,ti=(e,t)=>{var a;return Boolean(null===(a=t.collapseFns)||void 0===a?void 0:a[e])},ai=e=>{var t;return e.primaryGroups.length-(null!==(t=e.collapseFns&&Object.values(e.collapseFns).filter(Boolean).length)&&void 0!==t?t:0)>0},ni=({layer:e,columnId:t,paletteService:a,datasource:n,palette:i})=>{const s=n?ia(e.metrics,n):{},l=sa(n,e,"metrics");return a.get((null==i?void 0:i.name)||"default").getCategoricalColor([{name:s[t],rankAtDepth:l.indexOf(t),totalSeriesAtDepth:l.length}])},ii=({paletteService:e,kibanaTheme:t})=>({id:"lnsPie",visualizationTypes:Object.entries(Jt).map((([e,t])=>({id:e,icon:t.icon,label:t.label,groupLabel:t.groupLabel,showExperimentalBadge:t.isExperimental}))),getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>Zn(e.layerId,{...Ht.a})))}),getDescription(e){var t;return null!==(t=Jt[e.shape])&&void 0!==t?t:Jt.pie},switchVisualizationType:(e,t)=>({...t,shape:e}),triggers:[oe.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t?function(e){let t=Object(pa.cloneDeep)(e);return t=function(e){return e.layers.forEach((e=>{"showValuesInLegend"in e&&(e.legendStats=[...new Set([...e.showValuesInLegend?[Et.LegendValue.Value]:[],...e.legendStats||[]])]),delete e.showValuesInLegend})),e}(t),t}(t):{shape:Wt.PieChartTypes.DONUT,layers:[Zn(e(),"colorMapping"===(null==a?void 0:a.type)?a.value:Object(Ct.getColorMappingDefaults)())],palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0},getMainPalette:e=>{if(e)return e.layers.length>0&&e.layers[0].colorMapping?{type:"colorMapping",value:e.layers[0].colorMapping}:e.palette?{type:"legacyPalette",value:e.palette}:void 0},getSuggestions:ha,getConfiguration({state:a,frame:n,layerId:i}){const s=a.layers.find((e=>e.layerId===i));if(!s)return{groups:[]};const l=n.datasourceLayers[s.layerId];let r=[];return t.theme$.subscribe({next(t){var n,i,s;r=null!==(n=a.layers[0])&&void 0!==n&&n.colorMapping?Object(Ht.d)(t.darkMode,a.layers[0].colorMapping):e.get((null===(i=a.palette)||void 0===i?void 0:i.name)||"default").getCategoricalColors(10,null===(s=a.palette)||void 0===s?void 0:s.params)}}).unsubscribe(),{groups:[(()=>{const e=sa(l,s,"primaryGroups").map((e=>({columnId:e,triggerIconType:ti(e,s)?"aggregate":void 0}))),t=s.primaryGroups.find((e=>!ti(e,s)));e.forEach((e=>{t===e.columnId&&(e.triggerIconType="colorBy",e.palette=r)}));const n={groupId:"primaryGroups",accessors:e,enableDimensionEditor:!0,filterOperations:Jn},i=s.metrics.length>1&&a.shape!==Wt.PieChartTypes.MOSAIC?1:0,o=e.reduce(((e,{columnId:t})=>e+(ti(t,s)?0:1)),0)+i,c=s.metrics.length>1&&s.allowMultipleMetrics?{label:u.i18n.translate("xpack.lens.pie.multiMetricAccessorLabel",{defaultMessage:"{number} metrics",values:{number:s.metrics.length}})}:void 0;switch(a.shape){case Wt.PieChartTypes.DONUT:case Wt.PieChartTypes.PIE:return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.sliceDimensionGroupLabel",{defaultMessage:"Slice"}),fakeFinalAccessor:c,supportsMoreColumns:o<Jt.pie.maxBuckets,dimensionsTooMany:o-Jt.pie.maxBuckets,dataTestSubj:"lnsPie_sliceByDimensionPanel",hideGrouping:!0};case Wt.PieChartTypes.MOSAIC:return{...n,requiredMinDimensionCount:1,groupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisDimensionLabel",{defaultMessage:"Vertical axis"}),supportsMoreColumns:0===o,dimensionsTooMany:o-1,dataTestSubj:"lnsPie_verticalAxisDimensionPanel"};default:return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.treemapDimensionGroupLabel",{defaultMessage:"Group"}),fakeFinalAccessor:c,supportsMoreColumns:o<Jt[a.shape].maxBuckets,dimensionsTooMany:o-Jt[a.shape].maxBuckets,dataTestSubj:"lnsPie_groupByDimensionPanel",hideGrouping:a.shape===Wt.PieChartTypes.TREEMAP}}})(),(()=>{const e=sa(l,s,"secondaryGroups").map((e=>({columnId:e,triggerIconType:ti(e,s)?"aggregate":void 0}))),t={required:!0,groupId:"secondaryGroups",accessors:e,enableDimensionEditor:!0,filterOperations:Jn},n=e.reduce(((e,{columnId:t})=>e+(ti(t,s)?0:1)),0);if(a.shape===Wt.PieChartTypes.MOSAIC)return{...t,groupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisDimensionLabel",{defaultMessage:"Horizontal axis"}),supportsMoreColumns:0===n,dimensionsTooMany:n-1,dataTestSubj:"lnsPie_horizontalAxisDimensionPanel"}})(),(()=>{const t=sa(l,s,"metrics").map((t=>{var n,i,r;return{columnId:t,...s.allowMultipleMetrics?ai(s)?{triggerIconType:"disabled"}:{triggerIconType:"color",color:null!==(n=null!==(i=null===(r=s.colorsByDimension)||void 0===r?void 0:r[t])&&void 0!==i?i:ni({layer:s,columnId:t,paletteService:e,datasource:l,palette:a.palette}))&&void 0!==n?n:void 0}:{}}})),n=s.allowMultipleMetrics?u.i18n.translate("xpack.lens.pie.groupMetricLabel",{defaultMessage:"Metrics"}):Kn;return{groupId:"metric",groupLabel:n,dimensionEditorGroupLabel:n,paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.pie.headingLabel",{defaultMessage:"Value"})},accessors:t,supportsMoreColumns:0===s.metrics.length||Boolean(s.allowMultipleMetrics),filterOperations:ei,isMetricDimension:!0,requiredMinDimensionCount:1,dimensionsTooMany:s.allowMultipleMetrics?0:s.metrics.length-1,dataTestSubj:"lnsPie_sizeByDimensionPanel",enableDimensionEditor:!0}})()].filter(Ct.nonNullable)}},setDimension:({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>({...e,layers:e.layers.map((e=>{if(e.layerId!==t)return e;if("primaryGroups"===n)return{...e,primaryGroups:[...e.primaryGroups.filter((e=>e!==a)),a]};var i;if("secondaryGroups"===n)return{...e,secondaryGroups:[...(null===(i=e.secondaryGroups)||void 0===i?void 0:i.filter((e=>e!==a)))||[],a]};const s=[...e.metrics.filter((e=>e!==a)),a];return{...e,metrics:s}}))}),removeDimension({prevState:e,layerId:t,columnId:a}){var n,i,s,l;const r={...e},o=e.layers.find((e=>e.layerId===t));if(!o)return e;o.primaryGroups.includes(a)&&1===o.primaryGroups.length&&o.allowMultipleMetrics&&o.metrics.length&&delete r.palette;let u={...o};return null!==(n=o.collapseFns)&&void 0!==n&&n[a]&&(u.collapseFns={...o.collapseFns},delete u.collapseFns[a]),null!==(i=o.colorsByDimension)&&void 0!==i&&i[a]&&(u.colorsByDimension={...o.colorsByDimension},delete u.colorsByDimension[a]),u={...u,primaryGroups:u.primaryGroups.filter((e=>e!==a)),secondaryGroups:null!==(s=null===(l=u.secondaryGroups)||void 0===l?void 0:l.filter((e=>e!==a)))&&void 0!==s?s:void 0,metrics:u.metrics.filter((e=>e!==a))},{...r,layers:r.layers.map((e=>e.layerId===t?u:e))}},DimensionEditorComponent(a){const n=S()(t.theme$,{darkMode:!1}).darkMode;return Object(v.jsx)(Gn,i()({},a,{paletteService:e,isDarkMode:n}))},DimensionEditorDataExtraComponent:t=>Object(v.jsx)(qn,i()({},t,{paletteService:e})),getSupportedLayers:()=>[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},toExpression:(t,a,n,i)=>function(e,t,a,n={},i={}){return da(e,t,a,{...n,isPreview:!1},i)}(t,a,e,n,i),toPreviewExpression:(t,a,n)=>function(e,t,a,n={}){return da(e,t,a,{isPreview:!0},n)}(t,a,e,n),ToolbarComponent:e=>Object(v.jsx)(ja,e),hasLayerSettings:e=>({data:e.state.shape!==Wt.PieChartTypes.MOSAIC,appearance:!1}),LayerSettingsComponent:e=>Object(v.jsx)($n,e),getSuggestionFromConvertToLensContext(e){const t=e.context;if(!function(e){return"lnsPie"===e.type}(t))return;if(!e.suggestions.length)return;const a=e.suggestions.find((e=>e.visualizationState.shape===t.configuration.shape));return a?{...a,visualizationState:{...a.visualizationState,...t.configuration}}:void 0},getUserMessages(e,{frame:t}){const a=e.layers.map((t=>{var a;return Array.from(new Set([...t.primaryGroups,...null!==(a=t.secondaryGroups)&&void 0!==a?a:[]])).filter((e=>!ti(e,t))).length+(t.metrics.length>1?1:0)>Jt[e.shape].maxBuckets})).some(Boolean)?[{uniqueId:Ft.K,severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.pie.tooManyDimensions",{defaultMessage:"Your visualization has too many dimensions."}),longMessage:Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.pie.tooManyDimensionsLong",{defaultMessage:"Your visualization has too many dimensions. Please follow the instructions in the layer panel."}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),u.i18n.translate("xpack.lens.pie.collapsedDimensionsDontCount",{defaultMessage:"(Collapsed dimensions don't count toward this limit.)"}))}]:[],n=[];if((null==e?void 0:e.layers.length)>0&&t.activeData)for(const a of e.layers){var i,s;const{layerId:l,metrics:r}=a,o=null===(i=t.activeData[l])||void 0===i?void 0:i.rows,u=null===(s=t.activeData[l])||void 0===s?void 0:s.columns.find((({meta:e})=>"number"===(null==e?void 0:e.type)));if(!o||!r.length)break;u&&e.shape===Wt.PieChartTypes.WAFFLE&&a.primaryGroups.length&&ta(t.activeData[l],u.id,1)&&n.push({uniqueId:Ft.bb,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.pie.smallValuesWarningMessage",defaultMessage:"Waffle charts are unable to effectively display small field values. To display all field values, use the Data table or Treemap."})});const c=r.map((e=>{if(o.some((t=>Array.isArray(t[e]))))return e})).filter(Ct.nonNullable);if(c.length){const e=c.map((e=>{var a,n;return(null===(a=t.datasourceLayers[l])||void 0===a||null===(n=a.getOperationForColumnId(e))||void 0===n?void 0:n.label)||e}));n.push({uniqueId:Ft.J,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{key:e.join(","),id:"xpack.lens.pie.arrayValues",defaultMessage:"The following dimensions contain array values: {label}. Your visualization may not render as expected.",values:{label:Object(v.jsx)("strong",null,e.join(", "))}})})}}return[...a,...n]},getVisualizationInfo(t,a){var n,i,s;const l=t.layers[0],r=[],o=null==a?void 0:a.datasourceLayers[l.layerId],c=l.primaryGroups.length+((null===(n=l.secondaryGroups)||void 0===n?void 0:n.length)||0),d=l.allowMultipleMetrics,p=[];if(!c&&o)if(d)p.push(...l.metrics.map((a=>{var n,i;return null!==(n=null===(i=l.colorsByDimension)||void 0===i?void 0:i[a])&&void 0!==n?n:ni({layer:l,columnId:a,paletteService:e,datasource:o,palette:t.palette})})));else if(!ai(l)){var m;p.push(...e.get((null===(m=t.palette)||void 0===m?void 0:m.name)||"default").getCategoricalColors(Math.max(10,l.metrics.length)).slice(0,l.metrics.length))}if(l.metrics.forEach((e=>{r.push({id:e,name:Kn,dimensionType:"metric"})})),t.shape===Wt.PieChartTypes.MOSAIC&&null!==(i=l.secondaryGroups)&&void 0!==i&&i.length&&l.secondaryGroups.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),dimensionType:"horizontal_axis",id:e})})),null!==(s=l.primaryGroups)&&void 0!==s&&s.length){let a=u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),n="group_by";var g,f;t.shape===Wt.PieChartTypes.MOSAIC&&(a=u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n="vertical_axis"),t.shape!==Wt.PieChartTypes.DONUT&&t.shape!==Wt.PieChartTypes.PIE||(a=u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),n="slice_by"),l.primaryGroups.forEach((e=>{r.push({name:a,dimensionType:n,id:e})})),ai(l)&&p.push(...e.get((null===(g=t.palette)||void 0===g?void 0:g.name)||"default").getCategoricalColors(10,null===(f=t.palette)||void 0===f?void 0:f.params))}const b=p.filter(Ct.nonNullable);return{layers:[{layerId:l.layerId,layerType:l.layerType,chartType:t.shape,...this.getDescription(t),dimensions:r,palette:b.length?b:void 0}]}},getTelemetryEventsOnSave(e,t){var a,n;return Hn(null==e||null===(a=e.layers[0])||void 0===a?void 0:a.colorMapping,null==t||null===(n=t.layers[0])||void 0===n?void 0:n.colorMapping)}});class PieVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getPieVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var si=a(111);const li=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 16 12",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("g",null,Object(v.jsx)("path",{className:h.a.subdued,d:"M3.2 4.79997C3.2 4.50542 2.96122 4.26663 2.66667 4.26663H0.533333C0.238784 4.26663 0 4.50542 0 4.79997V6.39997H3.2V4.79997ZM3.2 9.59997H0V13.3333C0 13.6279 0.238784 13.8666 0.533333 13.8666H2.66667C2.96122 13.8666 3.2 13.6279 3.2 13.3333V9.59997ZM8.53333 9.59997H11.7333V13.3333C11.7333 13.6279 11.4946 13.8666 11.2 13.8666H9.06667C8.77211 13.8666 8.53333 13.6279 8.53333 13.3333V9.59997ZM11.7333 6.39997H8.53333V2.66663C8.53333 2.37208 8.77211 2.1333 9.06667 2.1333H11.2C11.4946 2.1333 11.7333 2.37208 11.7333 2.66663V6.39997ZM12.8 9.59997V13.3333C12.8 13.6279 13.0388 13.8666 13.3333 13.8666H15.4667C15.7612 13.8666 16 13.6279 16 13.3333V9.59997H12.8ZM16 6.39997V5.86663C16 5.57208 15.7612 5.3333 15.4667 5.3333H13.3333C13.0388 5.3333 12.8 5.57208 12.8 5.86663V6.39997H16ZM7.46667 11.2C7.46667 10.9054 7.22789 10.6666 6.93333 10.6666H4.8C4.50544 10.6666 4.26667 10.9054 4.26667 11.2V13.3333C4.26667 13.6279 4.50544 13.8666 4.8 13.8666H6.93333C7.22789 13.8666 7.46667 13.6279 7.46667 13.3333V11.2Z"}),Object(v.jsx)("rect",{y:"7.4668",width:"16",height:"1.06667",rx:"0.533334",className:h.a.accent}))),ri=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("g",null,Object(v.jsx)("path",{className:h.a.subdued,d:"M16 8a1 1 0 011-1h4a1 1 0 011 1v13a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zM1 9a1 1 0 00-1 1v11a1 1 0 001 1h4a1 1 0 001-1V10a1 1 0 00-1-1H1zM9 16a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zM25 11a1 1 0 00-1 1v9a1 1 0 001 1h4a1 1 0 001-1v-9a1 1 0 00-1-1h-4z"}),Object(v.jsx)("path",{className:h.a.accent,d:"M10 1a1 1 0 011-1h3a1 1 0 011 1h3v4h-3a1 1 0 01-1-1h-2v9a1 1 0 11-2 0V1z"})));var oi=a(101),ui=a(147);const ci=e=>{var t;const a=Object(oi.g)(e)?void 0:ui.a.find((t=>t.value===(null==e?void 0:e.icon)))||ui.a.find((e=>"triangle"===e.value)),n=null!==(t=null==a?void 0:a.icon)&&void 0!==t?t:null==a?void 0:a.value;return{columnId:e.id,triggerIconType:e.isHidden?"invisible":n?"custom":"color",customIcon:n,color:(null==e?void 0:e.color)||(Object(oi.g)(e)?oi.c:oi.b)}};var di=a(321),pi=a(29),mi=a.n(pi),gi=a(653),fi=a(651);const bi=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M24 16l.186-.002.345-.02.266-.03.334-.058.193-.043.25-.067.223-.07.215-.074.209-.079.305-.124c.166-.07.34-.148.524-.234l.285-.135 1.202-.588c.428-.203.728-.326.966-.396.146-.044.27-.067.384-.076L30 14v7a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-7.994 5.865-7.997L19.032 10l.541 1.205.272.595.29.612c.517 1.069.955 1.842 1.391 2.391.08.1.16.194.241.28.095.101.189.191.283.272l.143.114c.218.164.446.284.69.368.207.071.426.116.662.14l.14.012.154.008L24 16zm6-12v6l-.186.002-.345.02-.266.03-.331.057-.196.044-.25.067-.304.097-.134.047a9.492 9.492 0 00-.386.15l-.128.053c-.166.07-.34.148-.524.234l-.285.135-1.264.618-.352.159-.187.078-.256.095-.178.054a13.872 13.872 0 01-.38-.687l-.16-.311-.233-.47-.016-.472H24c1 0 3-6 6-6z",className:h.a.accent}),Object(v.jsx)("path",{d:"M30 13c-.507 0-.988.146-1.89.571l-1.209.592C25.621 14.78 24.924 15 24 15c-1.384 0-2.003-.865-3.516-4.206l-.637-1.42-.346-.749-.213-.445C18.572 6.698 18.127 6 18 6c-.466 0-.967.252-1.99.997l-.891.659-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.384 0 2.003.865 3.516 4.206l.637 1.42.346.749.213.445C23.428 12.302 23.873 13 24 13c.507 0 .988-.146 1.89-.571l1.209-.592C28.379 11.22 29.076 11 30 11v2z",className:h.a.subdued}),Object(v.jsx)("path",{d:"M6 13v7.889C6 21.503 5.552 22 5 22H1c-.552 0-1-.497-1-1.111V13a1 1 0 011-1h4a1 1 0 011 1zm8-1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4a1 1 0 011 1zm8 5v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4a1 1 0 011 1zm8 2v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2a1 1 0 011-1h4a1 1 0 011 1z",className:h.a.subdued}));var hi=a(652);function vi(e,{isHorizontal:t}){const a=u.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=u.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?a:n;if("y"===e)return t?n:a;const i=u.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),s=u.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),l=u.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),r=u.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?r:i:t?l:s}function yi(e,t,a){return n=>{const i=a[n.layerId];if(!n.xAccessor)return!1;const s=null==i?void 0:i.getOperationForColumnId(n.xAccessor);return Boolean(s&&(!t||s.dataType===t)&&s.scale===e)}}const xi=e=>e.layerType===ma.layerTypes.DATA||!e.layerType,ji=e=>(e||[]).filter((e=>xi(e))),Oi=e=>e.layerType===ma.layerTypes.REFERENCELINE,Ii=e=>(e||[]).filter((e=>Oi(e))),Mi=e=>e.layerType===ma.layerTypes.ANNOTATIONS&&"indexPatternId"in e,Ti=e=>"annotationGroupId"in e&&"__lastSaved"in e,wi=e=>(e||[]).filter((e=>Mi(e))),ki=e=>{if(e.cachedMetadata)return e.cachedMetadata;if(Ti(e)){const{title:t,description:a,tags:n}=e.__lastSaved;return{title:t,description:a,tags:n}}return{title:"",description:"",tags:[]}},Ei=e=>ki(e).title;function Ci(e,t){var a;if(!e.layers.length)return null!==(a=si.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==a?a:si.visualizationTypes[0];const n=ji(null==e?void 0:e.layers);if(t){var i;const e=t?null===(i=n.find((e=>e.layerId===t)))||void 0===i?void 0:i.seriesType:n[0].seriesType;return si.visualizationTypes.find((t=>t.id===e))||"mixed"}const s=si.visualizationTypes.find((e=>e.id===n[0].seriesType)),l=Object(pa.uniq)(n.map((e=>e.seriesType)));return s&&1===l.length?s:"mixed"}function Fi(e,t){if(!e)return{icon:Si,label:u.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const a=Ci(e,t);return"mixed"===a&&$i(e.layers)?{icon:fi.a,label:u.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===a?{icon:bi,label:u.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:a.icon||Si,label:a.fullLabel||a.label}}const Si=hi.a,Ai="bar_stacked",Pi={type:ma.layerTypes.DATA,label:u.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Visualization"}),icon:bi};function _i(e,t,a){const n=t.map((e=>e+1)).join(", ");switch(e){case"break_down":return{severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],uniqueId:Ft.cb,shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:"Break down by axis"}})};case"y":return{severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],uniqueId:Ft.hb,shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:vi("y",{isHorizontal:a})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:vi("y",{isHorizontal:a})}})}}}const Li={[ma.layerTypes.DATA]:({layerId:e,seriesType:t})=>({layerId:e,layerType:ma.layerTypes.DATA,accessors:[],seriesType:t}),[ma.layerTypes.REFERENCELINE]:({layerId:e})=>({layerId:e,layerType:ma.layerTypes.REFERENCELINE,accessors:[]}),[ma.layerTypes.ANNOTATIONS]:({layerId:e,indexPatternId:t,extraArg:a})=>{if(a){const{annotationGroupId:t,...n}=a;return{layerId:e,layerType:ma.layerTypes.ANNOTATIONS,annotationGroupId:t,annotations:Object(pa.cloneDeep)(n.annotations),indexPatternId:n.indexPatternId,ignoreGlobalFilters:n.ignoreGlobalFilters,__lastSaved:n}}return{layerId:e,layerType:ma.layerTypes.ANNOTATIONS,annotations:[],indexPatternId:t,ignoreGlobalFilters:!0}}};function Di({layerId:e,layerType:t=ma.layerTypes.DATA,seriesType:a,indexPatternId:n,extraArg:i}){return Li[t]({layerId:e,seriesType:a,indexPatternId:n,extraArg:i})}function Ri(e,t){return e.layers.filter((({layerType:e=ma.layerTypes.DATA})=>!t||e===t))}function Ni(e,t,a){const n=t.map(((e,t)=>({layer:e,originalIndex:t}))).filter((({layer:e})=>xi(e))),i=n.filter((({layer:{accessors:e,xAccessor:t,splitAccessor:a}})=>e.length>0||null!=t||null!=a));return i.every((({layer:e})=>a(e)))||!i.some((({layer:e})=>a(e)))?{valid:!0}:{valid:!1,error:_i(e,i.reduce(((e,{layer:t,originalIndex:n})=>(a(t)&&e.push(n),e)),[]),$i(n.map((({layer:e})=>e))))}}const Bi=e=>!e.isBucketed&&"number"===e.dataType,zi=e=>Bi(e)&&!e.isStaticValue,Vi=e=>e.isBucketed,Gi=(e,t)=>Boolean(e.length&&e.every((e=>e.xAccessor&&yi("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e))));function qi(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function $i(e){return ji(e).every((e=>qi(e.seriesType)))}function Hi(e){const t=si.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const Ui=(e,t)=>{const a={};return e.accessors.concat(xi(e)&&e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},Wi=e=>{if(!Ti(e))return!1;const t={annotations:e.annotations,ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:e.indexPatternId},a={annotations:e.__lastSaved.annotations,ignoreGlobalFilters:e.__lastSaved.ignoreGlobalFilters,indexPatternId:e.__lastSaved.indexPatternId};return!mi()(t,a)};function Xi(e,t,a,n){return{uniqueId:e,severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"},{id:"dimensionButton",dimensionId:a}],shortMessage:t,longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyChart.annotationError",defaultMessage:"Annotation {annotationName} has an error: {errorMessage}",values:{annotationName:n,errorMessage:t}})}}const Yi={document:0,date:1,string:2,ip:3,boolean:4,number:5,gauge:6,counter:7,histogram:8,geo_point:9,geo_shape:10,murmur3:11};function Qi({table:e,state:t,keptLayerIds:a,subVisualizationId:n,mainPalette:i,isFromContext:s,allowMixed:l}){if((!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!Yi.hasOwnProperty(e.operation.dataType))))&&t&&!n||e.columns.some((e=>e.operation.isStaticValue&&!s))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];const r=function(e,t,a,n,i,s){const[l,r]=Object(pa.partition)(e.columns,(e=>e.operation.isBucketed));if(1===l.length||2===l.length){const[l,o]=function(e,t){const a=t&&ji(t.layers).find((({layerId:t})=>t===e.layerId)),n=e.columns.filter((e=>e.operation.isBucketed)),i=Zi([...n].reverse());if(!a||"initial"===e.changeType)return i;if("reorder"===e.changeType)return n;const s=i.findIndex((({columnId:e})=>e===a.xAccessor)),l=s>-1&&i[s].operation.scale;if(l&&("interval"===l||"interval"!==i[0].operation.scale)){const[e]=i.splice(s,1);i.unshift(e)}const r=i.findIndex((({columnId:e})=>e===a.splitAccessor));if(r>-1){const[e]=i.splice(r,1);i.push(e)}return i}(e,a);return Ji({layerId:e.layerId,changeType:e.changeType,xValue:l,yValues:r,splitBy:o,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i,allowMixed:s})}if(0===l.length){const[l,[o,u]]=Object(pa.partition)(Zi(r),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return Ji({layerId:e.layerId,changeType:e.changeType,xValue:o,yValues:l,splitBy:u,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i,allowMixed:s})}}(e,a,t,n,i,l);return Array.isArray(r)?r:r?[r]:[]}function Ki(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function Zi(e){return[...e].sort(((e,t)=>Yi[e.operation.dataType]-Yi[t.operation.dataType]))}function Ji({layerId:e,changeType:t,xValue:a,yValues:n,splitBy:i,currentState:s,tableLabel:l,keptLayerIds:r,requestedSeriesType:o,mainPalette:c,allowMixed:d}){const p=function(e,t,a){const n=e.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||u.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"});return a||("date"===(null==t?void 0:t.operation.dataType)?u.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:n}}):u.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:n}}))}(n,a,l),m=o||function(e,t,a){const n="bar_stacked",i=ns(e,t),s=!(!i||!xi(i))&&i.seriesType||e&&e.preferredSeriesType||n;return a&&a.operation.scale&&"ordinal"===a.operation.scale?s.startsWith("bar")?s:n:s}(s,e,a),g={currentState:s,seriesType:m,layerId:e,title:p,yValues:n,splitBy:i,changeType:t,xValue:a,keptLayerIds:r,mainPalette:i?c:void 0,allowMixed:d};if(!s&&"unchanged"===t)return si.visualizationTypes.map((e=>({...ts({...g,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!s||"unchanged"!==t)return ts(g);const f=[];if(!m.includes("bar")||a&&"ordinal"!==a.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(m);f.push(ts({...g,seriesType:e,title:es(e)}))}else f.push(ts({...g,title:u.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:Ki(m)}));if("line"!==m&&i&&!m.includes("percentage")){const e=function(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}(m);f.push(ts({...g,seriesType:e,title:es(e)}))}if("line"!==m&&m.includes("stacked")&&!m.includes("percentage")){var b;const e={...g};"ordinal"!==(null===(b=e.xValue)||void 0===b?void 0:b.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue);const t=function(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}(m);f.push(ts({...g,hide:!e.splitBy,seriesType:t,title:es(t)}))}return f.concat(si.visualizationTypes.filter((e=>!f.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...ts({...g,seriesType:e.id}),hide:!0}))))}function es(e){switch(e){case"line":return u.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"});case"area":return u.i18n.translate("xpack.lens.xySuggestions.areaChartTitle",{defaultMessage:"Area chart"});case"area_stacked":return u.i18n.translate("xpack.lens.xySuggestions.areaStackedChartTitle",{defaultMessage:"Area stacked"});case"area_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.areaPercentageStackedChartTitle",{defaultMessage:"Area percentage"});case"bar":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarChartTitle",{defaultMessage:"Bar vertical"});case"bar_horizontal":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarChartTitle",{defaultMessage:"Bar horizontal"});case"bar_stacked":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarStackedChartTitle",{defaultMessage:"Bar vertical stacked"});case"bar_horizontal_stacked":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarStackedChartTitle",{defaultMessage:"Bar horizontal stacked"});case"bar_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarPercentageChartTitle",{defaultMessage:"Bar percentage"});case"bar_horizontal_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarPercentageChartTitle",{defaultMessage:"Bar horizontal percentage"});default:return e}}function ts({currentState:e,seriesType:t,layerId:a,title:n,yValues:i,splitBy:s,changeType:l,xValue:r,keptLayerIds:o,hide:u,mainPalette:c,allowMixed:d}){var p,m,g,f;t.includes("percentage")&&"ordinal"===(null===(p=r)||void 0===p?void 0:p.operation.scale)&&!s&&(s=r,r=void 0);const b=ns(e,a)||null,h=i.map((e=>e.columnId)),v={...b||{},palette:"legacyPalette"===(null==c?void 0:c.type)?c.value:b&&"palette"in b?b.palette:void 0,layerId:a,seriesType:t,xAccessor:null===(m=r)||void 0===m?void 0:m.columnId,splitAccessor:null===(g=s)||void 0===g?void 0:g.columnId,accessors:h,yConfig:b&&"yConfig"in b&&b.yConfig?b.yConfig.filter((({forAccessor:e})=>-1!==h.indexOf(e))):void 0,layerType:ue.LayerTypes.DATA,colorMapping:c?"colorMapping"===(null==c?void 0:c.type)?c.value:void 0:Object(Ct.getColorMappingDefaults)()},y="date"===(null===(f=r)||void 0===f?void 0:f.operation.dataType)&&"interval"===r.operation.scale,x=e?e.layers.filter((e=>o.includes(e.layerId)||y&&e.layerType===ue.LayerTypes.ANNOTATIONS)).map((e=>e.layerId===a?v:e)).map((e=>d?e:{...e,seriesType:t})):[],j={legend:e?e.legend:{isVisible:!0,position:Et.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,showCurrentTimeMarker:null==e?void 0:e.showCurrentTimeMarker,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,yLeftScale:null==e?void 0:e.yLeftScale,yRightScale:null==e?void 0:e.yRightScale,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:b&&Object.keys(b).length?x:[...x,v]},O=0===i.length;return{title:n,score:as(i,s,l),hide:null!=u?u:!e&&"unchanged"!==l&&"extended"!==l||e&&"reduced"===l||O||!r&&!s,state:j,incomplete:O,previewIcon:Hi(t)}}function as(e,t,a){const n="reduced"===a||"layers"===a?.3:"unchanged"===a?.5:1;return((e.length>1?2:1)+(t?1:0))/3*n}function ns(e,t){return e&&e.layers.find((e=>e.layerId===t))}var is=a(66);const ss=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M5 1.5a.5.5 0 111 0v7a.5.5 0 01-1 0v-7zM15.39 11.39a1.5 1.5 0 010 2.12l-2.122 2.122a.5.5 0 11-.707-.707l2.121-2.122a.5.5 0 000-.707l-2.121-2.12a.5.5 0 11.707-.708l2.121 2.121zM3.439 9.269a.5.5 0 010 .707l-2.122 2.121a.5.5 0 000 .707l2.122 2.121a.5.5 0 01-.707.708L.61 13.51a1.5 1.5 0 010-2.121l2.122-2.121a.5.5 0 01.707 0zM8 3a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 3zM11 5.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"}),Object(v.jsx)("path",{d:"M3.5 12a.5.5 0 000 1h9a.5.5 0 000-1h-9z"})),ls=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M7.378 3.585a.5.5 0 00.353-.854L5.61.611a1.5 1.5 0 00-2.121 0L1.367 2.73a.5.5 0 00.708.707l2.12-2.12a.5.5 0 01.708 0l2.121 2.12a.5.5 0 00.354.147z"}),Object(v.jsx)("path",{d:"M5.046 3.088v4.129l.005.04v5.658a.5.5 0 01-.992.09l-.01-.09V8.786l-.004-.04V3.087a.5.5 0 01.992-.09l.01.09z"}),Object(v.jsx)("path",{d:"M4.55 15.829a1.5 1.5 0 001.06-.44l2.122-2.121a.5.5 0 10-.707-.707l-2.121 2.121a.5.5 0 01-.708 0l-2.12-2.121a.5.5 0 00-.708.707l2.121 2.121a1.5 1.5 0 001.061.44zM13.5 4a.5.5 0 01.5.5v7a.5.5 0 11-1 0v-7a.5.5 0 01.5-.5zM10.5 6.5a.5.5 0 011 0v5a.5.5 0 11-1 0v-5zM8.5 8a.5.5 0 00-.5.5v3a.5.5 0 101 0v-3a.5.5 0 00-.5-.5z"})),rs=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M4.99991 7.49999C4.99991 7.22384 5.22376 6.99999 5.49991 6.99999C5.77605 6.99999 5.99991 7.22384 5.99991 7.49999V14.5C5.99991 14.7761 5.77605 15 5.49991 15C5.22376 15 4.99991 14.7761 4.99991 14.5V7.49999Z"}),Object(v.jsx)("path",{d:"M15.3893 2.38929C15.6706 2.67059 15.8287 3.05212 15.8287 3.44995C15.8287 3.84777 15.6706 4.2293 15.3893 4.51061L13.268 6.63193C13.1742 6.7257 13.0471 6.77838 12.9145 6.77838C12.7818 6.77838 12.6547 6.7257 12.5609 6.63193C12.4671 6.53816 12.4145 6.41098 12.4145 6.27838C12.4145 6.14577 12.4671 6.01859 12.5609 5.92482L14.6822 3.8035C14.776 3.70973 14.8287 3.58256 14.8287 3.44995C14.8287 3.31734 14.776 3.19016 14.6822 3.09639L12.5609 0.975075C12.4671 0.881307 12.4145 0.754129 12.4145 0.621522C12.4145 0.488914 12.4671 0.361736 12.5609 0.267968C12.6547 0.1742 12.7819 0.121521 12.9145 0.121521C13.0471 0.121521 13.1742 0.1742 13.268 0.267968L15.3893 2.38929Z"}),Object(v.jsx)("path",{d:"M3.43867 0.26864C3.53243 0.362408 3.58511 0.489585 3.58511 0.622193C3.58511 0.754801 3.53243 0.881978 3.43867 0.975746L1.31735 3.09707C1.22358 3.19083 1.1709 3.31801 1.1709 3.45062C1.1709 3.58323 1.22358 3.71041 1.31735 3.80417L3.43867 5.92549C3.53243 6.01926 3.58511 6.14644 3.58511 6.27905C3.58511 6.41166 3.53243 6.53883 3.43867 6.6326C3.3449 6.72637 3.21772 6.77905 3.08511 6.77905C2.9525 6.77905 2.82533 6.72637 2.73156 6.6326L0.610239 4.51128C0.328934 4.22998 0.170898 3.84844 0.170898 3.45062C0.170898 3.0528 0.328934 2.67126 0.610238 2.38996L2.73156 0.26864C2.82533 0.174871 2.9525 0.122192 3.08511 0.122192C3.21772 0.122192 3.3449 0.174871 3.43867 0.26864Z"}),Object(v.jsx)("path",{d:"M7.99991 6.99999C8.27605 6.99999 8.49991 7.22384 8.49991 7.49999V12.5C8.49991 12.7761 8.27605 13 7.99991 13C7.72377 13 7.49991 12.7761 7.49991 12.5V7.49999C7.49991 7.22384 7.72377 6.99999 7.99991 6.99999Z"}),Object(v.jsx)("path",{d:"M10.9999 7.49999C10.9999 7.22384 10.776 6.99999 10.4999 6.99999C10.2238 6.99999 9.99991 7.22384 9.99991 7.49999V10.5C9.99991 10.7761 10.2238 11 10.4999 11C10.776 11 10.9999 10.7761 10.9999 10.5V7.49999Z"}),Object(v.jsx)("path",{d:"M3.50015 2.99999C3.22401 2.99999 3.00015 3.22384 3.00015 3.49999C3.00015 3.77613 3.22401 3.99999 3.50015 3.99999H12.5002C12.7763 3.99999 13.0002 3.77613 13.0002 3.49999C13.0002 3.22384 12.7763 2.99999 12.5002 2.99999H3.50015Z"})),os=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M8.622 3.585a.5.5 0 01-.353-.854L10.39.611a1.5 1.5 0 012.121 0l2.122 2.12a.5.5 0 11-.707.707l-2.122-2.12a.5.5 0 00-.707 0l-2.121 2.12a.5.5 0 01-.354.147z"}),Object(v.jsx)("path",{d:"M11.95 12.915V8.786l.005-.04V3.087a.5.5 0 00-.992-.09l-.01.09v4.129l-.004.04v5.658a.5.5 0 00.992.09l.01-.09z"}),Object(v.jsx)("path",{d:"M11.45 15.829a1.5 1.5 0 01-1.06-.44l-2.122-2.121a.5.5 0 11.707-.707l2.121 2.121a.5.5 0 00.707 0l2.122-2.121a.5.5 0 01.707.707l-2.121 2.121a1.5 1.5 0 01-1.061.44zM2.5 4a.5.5 0 00-.5.5v7a.5.5 0 101 0v-7a.5.5 0 00-.5-.5zM5.5 6.5a.5.5 0 00-1 0v5a.5.5 0 101 0v-5zM7.5 8a.5.5 0 01.5.5v3a.5.5 0 11-1 0v-3a.5.5 0 01.5-.5z"}));a(311);var us=a(110),cs=a(156);const ds=[{id:"xy_axis_orientation_horizontal",value:0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],ps=({layers:e,axis:t,axisTitle:a,updateTitleState:n,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:l,isDisabled:r,areTickLabelsVisible:o,areGridlinesVisible:c,isTitleVisible:d,orientation:p,setOrientation:m,setEndzoneVisibility:g,endzonesVisible:b,setCurrentTimeMarkerVisibility:h,currentTimeMarkerVisible:y,extent:x,setExtent:j,hasBarOrAreaOnAxis:O,hasPercentageAxis:I,dataBounds:T,useMultilayerTimeAxis:w,scale:k,setScale:E,setScaleWithExtent:C})=>{const F=!(null==e||!e.length)&&$i(e),S=((e,t)=>{switch(e){case"yLeft":return{icon:t?ss:ls,groupPosition:"left",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?rs:os,groupPosition:"right",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):u.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?ls:ss,groupPosition:"center",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,F),A=Object(s.useCallback)((e=>{if(j&&e&&!Object(pa.isEqual)(e,x)){const{errorMsg:a}=Object(us.c)(O,e,k);"x"!==t&&"custom"===e.mode&&a||j(e)}}),[j,x,O,k,t]),{inputValue:P,handleInputChange:_}=Object(je.a)({value:x,onChange:A});return Object(v.jsx)(M.i,{title:S.popoverTitle,type:S.icon,groupPosition:S.groupPosition,isDisabled:r,buttonDataTestSubj:S.buttonDataTestSubj,panelClassName:"lnsVisToolbarAxis__popover"},Object(v.jsx)(M.j,{settingId:t,title:a,updateTitleState:e=>n(e,t),isTitleVisible:d}),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),fullWidth:!0},Object(v.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>l(t),checked:c,showLabel:!1})),Object(v.jsx)(M.b,{axis:t,updateTicksVisibilityState:e=>{i(t)},isAxisLabelVisible:o}),!w&&o&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",buttonSize:"compressed",options:ds,idSelected:ds.find((({value:e})=>e===p)).id,onChange:e=>{const a=ds.find((({id:t})=>t===e)).value;m(t,a)}})),g&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),fullWidth:!0},Object(v.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>g(!Boolean(b)),checked:Boolean(b),showLabel:!1})),h&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),fullWidth:!0},Object(v.jsx)(f.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowCurrentTimeMarker",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),onChange:()=>h(!Boolean(y)),checked:Boolean(y),showLabel:!1})),E&&Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),fullWidth:!0},Object(v.jsx)(f.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"lnsScaleSelect","aria-label":u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),options:[{text:u.i18n.translate("xpack.lens.xyChart.scaleLinear",{defaultMessage:"Linear"}),value:"linear"},{text:u.i18n.translate("xpack.lens.xyChart.scaleLog",{defaultMessage:"Logarithmic"}),value:"log"},{text:u.i18n.translate("xpack.lens.xyChart.scaleSquare",{defaultMessage:"Square root"}),value:"sqrt"}],onChange:({target:e})=>{if(!C||!x)return;const t=e.value;C({...x,...Object(cs.b)(x.mode,t,T)},t)},value:k})),P&&_&&Object(v.jsx)(M.a,{type:"x"!==t?"metric":"bucket",extent:P,scaleType:k,setExtent:_,dataBounds:T,hasBarOrArea:O,disableCustomRange:I,testSubjPrefix:"lnsXY",canHaveNiceValues:"x"!==t||Boolean(x)}))};function ms(e,t){return e.id===t.id}function gs(e,t){const a={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const n=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,s,l,r;const o=(null===(i=e.yConfig)||void 0===i||null===(s=i.find((e=>e.forAccessor===t)))||void 0===s?void 0:s.axisMode)||"auto";let u=(null==n||null===(l=n.columns.find((e=>e.id===t)))||void 0===l||null===(r=l.meta)||void 0===r?void 0:r.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),a[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),a.auto.forEach((e=>{0===a.left.length||t&&a.left.every((t=>ms(t.fieldFormat,e.fieldFormat)))?a.left.push(e):0===a.right.length||t&&a.left.every((t=>ms(t.fieldFormat,e.fieldFormat)))?a.right.push(e):a.right.length>=a.left.length?a.left.push(e):a.right.push(e)})),a}function fs(e,t,a,n){const i=gs(e,a),s=[];return i.left.length>0&&s.push({groupId:"left",position:t?"bottom":"left",formatter:null==n?void 0:n(i.left[0].fieldFormat),series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&s.push({groupId:"right",position:t?"top":"right",formatter:null==n?void 0:n(i.right[0].fieldFormat),series:i.right.map((({fieldFormat:e,...t})=>t))}),s}const bs=[{id:"None",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.none",{defaultMessage:"Do not fill gaps"})},{id:"Zero",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.zero",{defaultMessage:"Fill gaps with zeros"})},{id:"Linear",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.linear",{defaultMessage:"Linear"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.linear",{defaultMessage:"Fill gaps with a line"})},{id:"Carry",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.carry",{defaultMessage:"Last"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.carry",{defaultMessage:"Fill gaps with the last value"})},{id:"Lookahead",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.lookahead",{defaultMessage:"Next"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.lookahead",{defaultMessage:"Fill gaps with the next value"})}],hs=[{id:"None",title:u.i18n.translate("xpack.lens.endValue.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.endValueDescription.none",{defaultMessage:"Do not extend series to the edge of the chart"})},{id:"Zero",title:u.i18n.translate("xpack.lens.endValue.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.endValueDescription.zero",{defaultMessage:"Extend series as zero to the edge of the chart"})},{id:"Nearest",title:u.i18n.translate("xpack.lens.endValue.nearest",{defaultMessage:"Nearest"}),description:u.i18n.translate("xpack.lens.endValueDescription.nearest",{defaultMessage:"Extend series with the first/last value to the edge of the chart"})}],vs=({onFittingFnChange:e,fittingFunction:t,emphasizeFitting:a,onEmphasizeFittingChange:n,onEndValueChange:i,endValue:s,isFittingEnabled:r=!0})=>Object(v.jsx)(l.a.Fragment,null,r&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(v.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, area and line charts hide the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(v.jsx)(f.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:bs.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("strong",null,t),Object(v.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(v.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t||"None",onChange:t=>e(t),itemLayoutAlign:"top",hasDividers:!0})),t&&"None"!==t&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.endValuesLabel",{defaultMessage:"End values"})},Object(v.jsx)(f.EuiSuperSelect,{"data-test-subj":"lnsEndValuesSelect",compressed:!0,options:hs.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("strong",null,t),Object(v.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(v.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:s||"None",onChange:e=>i(e),itemLayoutAlign:"top",hasDividers:!0})),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),display:"columnCompressedSwitch"},Object(v.jsx)(f.EuiSwitch,{showLabel:!1,label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),checked:!a,onChange:()=>{n(!a)},compressed:!0}))))),ys=[{type:ue.XYCurveTypes.LINEAR,title:u.i18n.translate("xpack.lens.lineCurve.straight",{defaultMessage:"Straight"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.straight",{defaultMessage:"Straight line between points"})},{type:ue.XYCurveTypes.CURVE_MONOTONE_X,title:u.i18n.translate("xpack.lens.lineCurve.smooth",{defaultMessage:"Smooth"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.smooth",{defaultMessage:"Smoothed line between points"})},{type:ue.XYCurveTypes.CURVE_STEP_AFTER,title:u.i18n.translate("xpack.lens.lineCurve.step",{defaultMessage:"Step"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.step",{defaultMessage:"Stepped line between points"})}],xs=({onChange:e,value:t=ue.XYCurveTypes.LINEAR,enabled:a=!0})=>a?Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.lineInterpolationLabel",{defaultMessage:"Line interpolation"})},Object(v.jsx)(f.EuiSuperSelect,{"data-test-subj":"lnsCurveStyleSelect",compressed:!0,options:ys.map((({type:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("strong",null,t),Object(v.jsx)(f.EuiText,{size:"xs",color:"subdued"},Object(v.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t,onChange:e,itemLayoutAlign:"top",hasDividers:!0})):null,js=({onChange:e,value:t,isFillOpacityEnabled:a=!0})=>{const{inputValue:n,handleInputChange:i}=Object(je.a)({value:t,onChange:e});return a?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(v.jsx)(f.EuiRange,{"data-test-subj":"lnsFillOpacity",value:n,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null},Os=({state:e,setState:t,datasourceLayers:a})=>{var n,i;const s=ji(e.layers),l=s.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=s.some((({seriesType:e})=>["area_stacked","area","line","area_percentage_stacked"].includes(e))),o=s.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),c=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:a})=>{var n;if(!a)return!1;const i=null===(n=t[e])||void 0===n?void 0:n.getOperationForColumnId(a);return i&&i.isBucketed&&i.scale&&"ordinal"!==i.scale}))}(s,a)),d=!r,p=r&&!l,m=r||l,g=function({isAreaPercentage:e,isHistogramSeries:t}){return t?u.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?u.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):u.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:l,isHistogramSeries:c}),f=!d&&!p&&!m;return Object(v.jsx)(ze.a,{tooltipContent:g,condition:f},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:f},Object(v.jsx)(xs,{enabled:m,value:null==e?void 0:e.curveType,onChange:a=>{t({...e,curveType:a})}}),Object(v.jsx)(M.k,{isVisible:d,valueLabels:null!==(n=null==e?void 0:e.valueLabels)&&void 0!==n?n:"hide",onValueLabelChange:a=>{t({...e,valueLabels:a})}}),Object(v.jsx)(vs,{isFittingEnabled:p,fittingFunction:null==e?void 0:e.fittingFunction,emphasizeFitting:null==e?void 0:e.emphasizeFitting,endValue:null==e?void 0:e.endValue,onFittingFnChange:a=>{t({...e,fittingFunction:a})},onEmphasizeFittingChange:a=>{t({...e,emphasizeFitting:a})},onEndValueChange:a=>{t({...e,endValue:a})}}),Object(v.jsx)(js,{isFillOpacityEnabled:o,value:null!==(i=null==e?void 0:e.fillOpacity)&&void 0!==i?i:.3,onChange:a=>{t({...e,fillOpacity:a})}})))},Is=u.i18n.translate("xpack.lens.xyChart.defaultAnnotationLabel",{defaultMessage:"Event"});function Ms(e,t){const a=e.map((({layerId:e})=>e)),{activeData:n,absDateRange:i}=t,s=V()(i.fromDate).valueOf(),l=V()(i.toDate).valueOf(),r=V()((s+l)/2).toISOString();if(!n||Object.entries(n).filter((([e])=>a.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const o=(a.reduce(((t,a)=>{var i,s,l,r;const o=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,u=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[0])||void 0===r?void 0:r[o];return u&&u<t?u:t}),864e13)+a.reduce(((t,a)=>{var i,s,l,r,o,u;const c=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,d=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[(null==n||null===(o=n[a])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)-1])||void 0===r?void 0:r[c];return d&&d>t?d:t}),-864e13))/2;return s<o&&l>o?V()(o).toISOString():r}u.i18n.translate("xpack.lens.xyChart.defaultRangeAnnotationLabel",{defaultMessage:"Event range"});const Ts=(e,t)=>{const a=ji((null==e?void 0:e.layers)||[]),n=Gi(a,t),i=e&&n?[{groupId:"xAnnotations",columnId:Object(kt.a)()}]:void 0;return{type:ue.LayerTypes.ANNOTATIONS,label:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabel",{defaultMessage:"Annotations"}),icon:ri,disabled:!n,toolTipContent:n?void 0:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),initialDimensions:i,noDatasource:!0}},ws=({prevState:e,frame:t,source:a,target:n,dropType:i})=>{const s=e.layers.find((e=>e.layerId===n.layerId));if(!s||!Mi(s))return e;const l=s.annotations.find((({id:e})=>e===n.columnId)),r=t.dataViews.indexPatterns[s.indexPatternId];if(Object(Ct.isDraggedDataViewField)(a)){const t=r.timeFieldName;switch(i){case"field_add":return l||!t?e:{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations,Object(oi.d)(n.columnId,a.field.name,t)]}:e))};case"field_replace":return l&&t?{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?{...l,...Object(oi.d)(n.columnId,a.field.name,t)}:e))]}:e))}:e}return e}const o=e.layers.find((e=>e.layerId===a.layerId));if(!o||!Mi(o))return e;const u=o.annotations.find((({id:e})=>e===a.columnId));if(t.dataViews.indexPatterns[o.indexPatternId]!==r&&Object(oi.f)(u))return e;switch(i){case"reorder":if(!l||!u||a.layerId!==n.layerId)return e;const i=s.annotations.filter((e=>e.id!==u.id)),r=i.findIndex((e=>e.id===l.id)),c=s.annotations.indexOf(u),d=s.annotations.indexOf(l);return i.splice(c<d?r+1:r,0,u),{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:i}:e))};case"swap_compatible":return l&&u?{...e,layers:e.layers.map((e=>Mi(e)&&Mi(s)?e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e.layerId===a.layerId?{...o,annotations:[...o.annotations.map((e=>e===u?l:e))]}:e:e))}:e;case"replace_compatible":return l&&u?{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e))}:e;case"duplicate_compatible":return l?e:{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations,Object(oi.a)(n.columnId,Ms(ji(e.layers),t),u)]}:a))};case"replace_duplicate_compatible":return l?{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations.map((a=>a===l?Object(oi.a)(n.columnId,Ms(ji(e.layers),t),u):a))]}:a))}:e;case"move_compatible":return l||!u?e:{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations,u]}:e))};default:return e}},ks=e=>e.annotations.map((e=>ci(e))),Es=e=>{const t=wi(e),a={},n=Object(Ct.getUniqueLabelGenerator)();return t.forEach((e=>{e.annotations&&e.annotations.forEach((e=>{a[e.id]=n(e.label)}))})),a};function Cs(e,t,a){const n=e.some(yi("interval","number",t)),{right:i,left:s}=gs(e,a);return{x:e.some((({xAccessor:e})=>null!=e))&&n,yLeft:s.length>0,yRight:i.length>0}}function Fs(e,t,{activeData:a},n){if(!a)return 100;const{dataLayers:i,untouchedDataLayers:s,accessors:l}=function(e,t,a){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...a})=>({...a,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const n="yLeft"===e?"left":"right",{[n]:i}=gs(t,a),s=new Set(i.map((({layer:e})=>e))),l=t.filter((({layerId:e})=>s.has(e)));return{dataLayers:l,untouchedDataLayers:l,accessors:i.map((({accessor:e})=>e))}}}}(t,e,a);if("x"===t&&i.length&&!s.some(n))return 100;const r=function(e,t,a,n=!0,i=!0){if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return.75;const{min:s,max:l}=function(e,t,a,n=!0){const i=new Set(t);let s,l;const[r,o]=Object(pa.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&n));for(const{layerId:e,accessors:t}of o){const n=a[e];if(n)for(const e of t)if(i.has(e))for(const t of n.rows){const a=t[e];"number"==typeof a&&(l=null!=l?Math.max(a,l):a,s=null!=s?Math.min(a,s):a)}}const u={};for(const{layerId:e,accessors:t,xAccessor:n}of r){const s=a[e];if(s)for(const e of t)if(i.has(e))for(const t of s.rows){const a=t[e];let i="shared";var c;n&&(i=t[n]),"number"==typeof a&&(u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=a)}}for(const e of Object.values(u))l=Math.max(e,l||0,0),s=Math.min(e,s||0,0);return{min:s,max:l}}(e,t,a,i);if(null!=s&&null!=l&&isFinite(s)&&isFinite(l)){const e=n?Math.min(0,s):s;return Number((e+.75*(l-e)).toFixed(2))}}}(i,l,a,"x"!==t,"x"!==t);return null!=r?r:100}const Ss=(e,t)=>{const a=function(e,t,a,n){if(!t)return[];const i=Cs(ji(t.layers),a,n);return[{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}].filter((({label:e})=>i[e]))}(0,e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData),n=(null==e?void 0:e.layers)||[],i=ji(n),s=i.filter((({accessors:e,xAccessor:t})=>e.length||t)),l=yi("interval","number",(null==t?void 0:t.datasourceLayers)||{}),r=e?a.map((({id:e,label:a})=>({groupId:e,columnId:Object(kt.a)(),dataType:"number",label:vi(a,{isHorizontal:$i(n)}),staticValue:Fs(i,a,{activeData:null==t?void 0:t.activeData},l)}))):void 0;return{type:ue.LayerTypes.REFERENCELINE,label:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Reference lines"}),icon:li,disabled:!s.length||!i.some(l)&&i.every((({accessors:e})=>!e.length)),toolTipContent:s.length?void 0:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:r}},As=(e,t=Ls,a)=>({columnId:e,triggerIconType:a&&"empty"!==a?"custom":"color",color:t,customIcon:a}),Ps=({state:e,frame:t,layer:a,sortedAccessors:n})=>{const i=n.reduce(((e,t,a)=>(e[t]=a,e)),{}),{bottom:s,left:l,right:r}=Object(pa.groupBy)([...a.yConfig||[]].sort((({forAccessor:e},{forAccessor:t})=>i[e]-i[t])),(({axisMode:e})=>e)),o=function(e,t,a,n){if(!t)return[];const i=Cs(ji(t.layers),a,n);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:l,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:s,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],e,t.datasourceLayers,t.activeData),c=$i(e.layers);return{groups:o.map((({config:e=[],id:t,label:a,dataTestSubj:n,valid:i})=>({groupId:t,groupLabel:vi(a,{isHorizontal:c}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.referenceLineDimensionEditorLabel",{defaultMessage:"{groupLabel} reference line",values:{groupLabel:vi(a,{isHorizontal:c})}}),accessors:e.map((({forAccessor:e,color:t,icon:a})=>As(e,t,a))),filterOperations:Bi,supportsMoreColumns:!0,requiredMinDimensionCount:0,enableDimensionEditor:!0,supportStaticValue:!0,paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})],headingLabel:u.i18n.translate("xpack.lens.staticValue.headingLabel",{defaultMessage:"Placement"})},supportFieldFormat:!1,dataTestSubj:n,invalid:!i,invalidMessage:"x"===a?u.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):u.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}},_s=e=>null!=e&&"object"!=typeof e,Ls=Me.euiLightVars.euiColorDarkShade;function Ds(e,t,a){const n={};return e.filter(xi).forEach((e=>{var t;const a=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";n[a]||(n[a]=[]),n[a].push(e)})),Object(pa.mapValues)(n,(e=>{const n=e.map(((e,n)=>{var i;if(e.collapseFn||!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const s=e.splitAccessor,l=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===s)),r=l&&a(l.meta.params),o=l&&t.tables[e.layerId]?Object(pa.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[s];var a;return t=t&&!_s(t)?null!==(a=null==r?void 0:r.convert(t))&&void 0!==a?a:t:String(t),t}))):[];return{numberOfSeries:(o.length||1)*e.accessors.length,splits:o}}));return{totalSeriesCount:n.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,a,i){const s=e.findIndex((e=>t.layerId===e.layerId)),l=n[s].splits.indexOf(a);return(0===s?0:n.slice(0,s).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==l?l*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function Rs(e){return{columnId:e,triggerIconType:"disabled"}}function Ns(e,t,a,n,i){var s;if(Oi(e))return As(t);if(Mi(e)){const a=e.annotations.find((e=>e.id===t));return{columnId:t,triggerIconType:null!=a&&a.isHidden?"invisible":"color",color:Object(oi.g)(a)?oi.c:oi.b}}const l=xi(e)&&!e.collapseFn&&e.splitAccessor,r=e.palette||{type:"palette",name:"default"},o=null===(s=a[r.name])||void 0===s?void 0:s.totalSeriesCount;if(l)return Rs(t);const u=Ui(e,n.datasourceLayers[e.layerId]),c=a[r.name].getRank(e,u[t]||t,t),d=null!=o?i.get(r.name).getCategoricalColor([{name:u[t]||t,rankAtDepth:c,totalSeriesAtDepth:o}],{maxDepth:1,totalSeries:o},r.params):void 0;return{columnId:t,triggerIconType:d?"color":"disabled",color:null!=d?d:void 0}}function Bs(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const zs=Object(f.htmlIdGenerator)()();function Vs(e){var t,a,n,r;const{state:o,layerId:c,accessor:p,darkMode:m,isInlineEditing:g}=e,b=o.layers.findIndex((e=>e.layerId===c)),h=o.layers[b],y=!!h.colorMapping,[x,j]=Object(s.useState)(y),{inputValue:O,handleInputChange:I}=Object(je.a)({value:e.state,onChange:e.setState}),T=null==h||null===(t=h.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===p)),w=(null==T?void 0:T.axisMode)||"auto",k=Object(s.useCallback)((e=>{if(null==e)return;const t=[...h.yConfig||[]],a=t.findIndex((e=>e.forAccessor===p));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:p,...e}),I(Bs(O,{...h,yConfig:t},b))}),[p,b,O,h,I]),E=Object(s.useCallback)((e=>{I(Bs(O,{...h,colorMapping:e},b))}),[b,O,h,I]),C=Object(s.useCallback)((e=>{I(Bs(O,{...h,palette:e},b))}),[b,O,h,I]),F=((e,t)=>{var a,n,i,s;return Mi(e)?(null==e||null===(i=e.annotations)||void 0===i||null===(s=i.find((e=>e.id===t)))||void 0===s?void 0:s.color)||null:xi(e)&&e.splitAccessor&&!e.collapseFn?null:(null==e||null===(a=e.yConfig)||void 0===a||null===(n=a.find((e=>e.forAccessor===t)))||void 0===n?void 0:n.color)||null})(h,p),S=Object(s.useMemo)((()=>{var t;const a=Qs(e.frame.datasourceLayers[h.layerId],h),n=Ds(ji(o.layers),{tables:null!==(t=e.frame.activeData)&&void 0!==t?t:{}},e.formatFactory);return Ns({...h,accessors:a.filter((e=>h.accessors.includes(e)))},p,n,e.frame,e.paletteService).color}),[e.frame,e.paletteService,o.layers,p,e.formatFactory,h]),A=h,P=h.colorMapping?Object(Ht.d)(e.darkMode,h.colorMapping):e.paletteService.get((null===(a=h.palette)||void 0===a?void 0:a.name)||"default").getCategoricalColors(10,h.palette),_=null===(n=e.frame.activeData)||void 0===n?void 0:n[h.layerId],{splitAccessor:L}=h,D=Object(Vn.a)(null!==(r=null==_?void 0:_.rows)&&void 0!==r?r:[],L);var R;if("breakdown"===e.groupId&&!h.collapseFn)return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"},fullWidth:!0},Object(v.jsx)(M.f,{palette:P,siblingRef:e.panelRef,title:x?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:g},Object(v.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(v.jsx)(f.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:x,onChange:({target:{checked:e}})=>{Object(d.d)("color_mapping_switch_"+(e?"enabled":"disabled")),E(e?{...Ht.a}:void 0),j(e)}}),Object(v.jsx)(f.EuiSpacer,{size:"s"})),Object(v.jsx)(f.EuiFlexItem,null,y||x?Object(v.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:m,model:null!==(R=h.colorMapping)&&void 0!==R?R:{...Ht.a},onModelUpdate:e=>E(e),palettes:Ya.a,data:{type:"categories",categories:D},specialTokens:Ln.a}):Object(v.jsx)(M.g,{palettes:e.paletteService,activePalette:null==A?void 0:A.palette,setPalette:e=>{C(e)}}))))));const N=$i(o.layers),B=Boolean(!A.collapseFn&&A.splitAccessor)?u.i18n.translate("xpack.lens.xyChart.colorPicker.tooltip.disabled",{defaultMessage:'You are unable to apply custom colors to individual series when the layer includes a "Break down by" field.'}):void 0;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(zn.a,i()({},e,{overwriteColor:F,defaultColor:S,disabledMessage:B,setConfig:k})),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",buttonSize:"compressed",options:[{id:`${zs}left`,label:N?u.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):u.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${zs}auto`,label:u.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${zs}right`,label:N?u.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):u.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${zs}${w}`,onChange:e=>{const t=e.replace(zs,"");k({axisMode:t})}})))}function Gs(e){const{state:t,layerId:a}=e,n=t.layers.findIndex((e=>e.layerId===a)),i=t.layers[n],{inputValue:s,handleInputChange:r}=Object(je.a)({value:e.state,onChange:e.setState});return"breakdown"===e.groupId?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(be,{value:i.collapseFn||"",onChange:e=>{r(Bs(s,{...i,collapseFn:e},n))}})):null}function qs(e){return null!=e&&"empty"!==e}const $s=u.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),Hs=u.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),Us=u.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),Ws=u.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});function Xs({isHorizontal:e,axisMode:t}){const a={id:`${zs}auto`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_markerPosition_auto"};return"bottom"===t?[{id:`${zs}below`,label:e?Us:Hs,"data-test-subj":"lnsXY_markerPosition_below"},a,{id:`${zs}above`,label:e?Ws:$s,"data-test-subj":"lnsXY_markerPosition_above"}]:[{id:`${zs}left`,label:e?Hs:Us,"data-test-subj":"lnsXY_markerPosition_left"},a,{id:`${zs}right`,label:e?$s:Ws,"data-test-subj":"lnsXY_markerPosition_right"}]}function Ys({currentConfig:e,setConfig:t,isHorizontal:a}){return Object(v.jsx)(l.a.Fragment,null,qs(null==e?void 0:e.icon)||null!=e&&e.textVisibility?Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(qs(null==e?void 0:e.icon)||null!=e&&e.textVisibility),label:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"})},Object(v.jsx)(ze.a,{tooltipContent:u.i18n.translate("xpack.lens.lineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the name in order to alter its position"}),condition:!(qs(null==e?void 0:e.icon)||null!=e&&e.textVisibility),position:"top",delay:"regular",display:"block"},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition",isDisabled:!(qs(null==e?void 0:e.icon)||null!=e&&e.textVisibility),buttonSize:"compressed",options:Xs({isHorizontal:a,axisMode:e.axisMode}),idSelected:`${zs}${(null==e?void 0:e.iconPosition)||"auto"}`,onChange:e=>{const a=e.replace(zs,"");t({iconPosition:a})}}))):null)}const Qs=(e,t)=>{const a=e?e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e))):t.accessors;return Array.from(new Set(a.concat(t.accessors)))},Ks=(e,t,a,n,i)=>{if(!e||!e.layers.length)return null;const s={};return e.layers.forEach((e=>{s[e.layerId]={};const a=t[e.layerId];a&&a.getTableSpec().forEach((a=>{var n,i;const l=null!==(n=null===(i=t[e.layerId])||void 0===i?void 0:i.getOperationForColumnId(a.columnId))&&void 0!==n?n:null;s[e.layerId][a.columnId]=l}))})),el(e,s,t,a,n,i)},Zs={[ue.LayerTypes.DATA]:e=>({...e,simpleView:!0}),[ue.LayerTypes.REFERENCELINE]:e=>{var t;return{...e,simpleView:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({...e})=>({...e,lineWidth:1,icon:void 0,textVisibility:!1})))}},[ue.LayerTypes.ANNOTATIONS]:e=>({...e,simpleView:!0})};function Js(e,t){if(!e)return t;if("ordinal"===e.scale)return Et.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?Et.ScaleType.Time:Et.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return Et.ScaleType.Ordinal;case"date":return Et.ScaleType.Time;default:return Et.ScaleType.Linear}}const el=(e,t,a,n,i,s)=>{var l,r,o,u,c,d,p,m,g,f,b,h,v,y,x,j,O,I,T,w,k,E,C,F,S,A,P,_,L,D,R,N,B,z,V,G,q,$,H;const U=ji(e.layers).filter((e=>Boolean(e.accessors.length))).map((e=>({...e,accessors:Qs(a[e.layerId],e)}))),W=Ii(e.layers).filter((e=>Boolean(e.accessors.length))),X=Es(e.layers),Y=wi(e.layers).filter((e=>Boolean(e.annotations.length))).map((e=>({...e,ignoreGlobalFilters:e.ignoreGlobalFilters,annotations:e.annotations.map((e=>({...e,label:X[e.id]})))})));if(!U.length)return null;const Q=U.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===Et.Position.Left)))),K=U.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===Et.Position.Right)))),Z=[{position:Et.Position.Left,extent:null==e?void 0:e.yLeftExtent,showTitle:null===(l=null==e||null===(r=e.axisTitlesVisibilitySettings)||void 0===r?void 0:r.yLeft)||void 0===l||l,title:e.yTitle||"",showLabels:null===(o=null==e||null===(u=e.tickLabelsVisibilitySettings)||void 0===u?void 0:u.yLeft)||void 0===o||o,showGridLines:null===(c=null==e||null===(d=e.gridlinesVisibilitySettings)||void 0===d?void 0:d.yLeft)||void 0===c||c,labelsOrientation:null!==(p=null==e||null===(m=e.labelsOrientation)||void 0===m?void 0:m.yLeft)&&void 0!==p?p:0,scaleType:e.yLeftScale||"linear"},{position:Et.Position.Right,extent:null==e?void 0:e.yRightExtent,showTitle:null===(g=null==e||null===(f=e.axisTitlesVisibilitySettings)||void 0===f?void 0:f.yRight)||void 0===g||g,title:e.yRightTitle||"",showLabels:null===(b=null==e||null===(h=e.tickLabelsVisibilitySettings)||void 0===h?void 0:h.yRight)||void 0===b||b,showGridLines:null===(v=null==e||null===(y=e.gridlinesVisibilitySettings)||void 0===y?void 0:y.yRight)||void 0===v||v,labelsOrientation:null!==(x=null==e||null===(j=e.labelsOrientation)||void 0===j?void 0:j.yRight)&&void 0!==x?x:0,scaleType:e.yRightScale||"linear"}];Q&&Z.push({id:Et.Position.Left,position:Et.Position.Left,...Z[0]}),K&&Z.push({id:Et.Position.Right,position:Et.Position.Right,...Z[1]});const J=e=>{var t;return Object(oi.e)(e)||Object(oi.g)(e)||e.filter&&""!==(null===(t=e.filter)||void 0===t?void 0:t.query)},ee=Object(ce.buildExpressionFunction)("legendConfig",{isVisible:e.legend.isVisible,showSingleSeries:e.legend.showSingleSeries,position:e.legend.isInside?[]:e.legend.position,isInside:e.legend.isInside?e.legend.isInside:void 0,legendSize:e.legend.isInside?void 0:e.legend.position===Et.Position.Top||e.legend.position===Et.Position.Bottom?oe.LegendSize.AUTO:e.legend.legendSize?e.legend.legendSize:void 0,layout:e.legend.layout,horizontalAlignment:e.legend.horizontalAlignment&&e.legend.isInside?e.legend.horizontalAlignment:void 0,verticalAlignment:e.legend.verticalAlignment&&e.legend.isInside?e.legend.verticalAlignment:void 0,floatingColumns:e.legend.floatingColumns&&e.legend.isInside?Math.min(5,e.legend.floatingColumns):[],maxLines:e.legend.maxLines,legendStats:e.legend.legendStats,title:e.legend.title,isTitleVisible:e.legend.isTitleVisible,shouldTruncate:null!==(O=e.legend.shouldTruncate)&&void 0!==O?O:na(e,a).truncateText}),te=Object(ce.buildExpressionFunction)("xAxisConfig",{id:"x",position:"bottom",title:e.xTitle||"",showTitle:null===(I=null==e||null===(T=e.axisTitlesVisibilitySettings)||void 0===T?void 0:T.x)||void 0===I||I,showLabels:null===(w=null==e||null===(k=e.tickLabelsVisibilitySettings)||void 0===k?void 0:k.x)||void 0===w||w,showGridLines:null===(E=null==e||null===(C=e.gridlinesVisibilitySettings)||void 0===C?void 0:C.x)||void 0===E||E,labelsOrientation:null!==(F=null==e||null===(S=e.labelsOrientation)||void 0===S?void 0:S.x)&&void 0!==F?F:0,extent:e.xExtent||U.some((e=>Object(M.s)(a[e.layerId],e.xAccessor)))?[Object(M.n)(null!==(A=e.xExtent)&&void 0!==A?A:{mode:"dataBounds",niceValues:!0})]:void 0}),ae=Object(ce.buildExpressionFunction)("layeredXyVis",{legend:Object(ce.buildExpression)([ee]).toAst(),fittingFunction:null!==(P=e.fittingFunction)&&void 0!==P?P:"None",endValue:null!==(_=e.endValue)&&void 0!==_?_:"None",emphasizeFitting:null!==(L=e.emphasizeFitting)&&void 0!==L&&L,minBarHeight:null!==(D=e.minBarHeight)&&void 0!==D?D:1,fillOpacity:null!==(R=e.fillOpacity)&&void 0!==R?R:.3,valueLabels:null!==(N=e.valueLabels)&&void 0!==N?N:"hide",hideEndzones:null!==(B=e.hideEndzones)&&void 0!==B&&B,addTimeMarker:null!==(z=Gi(U,{datasourceLayers:a})&&e.showCurrentTimeMarker)&&void 0!==z&&z,yAxisConfigs:[...tl(Z)],xAxisConfig:Object(ce.buildExpression)([te]).toAst(),showTooltip:[],layers:[...U.map((s=>il(s,Z,a[s.layerId],t,n,i[s.layerId],e.curveType||"LINEAR"))),...W.map((e=>al(e,a[e.layerId],i[e.layerId])))],annotations:Y.length&&Y.flatMap((e=>e.annotations.filter(J))).length?[Object(ce.buildExpression)([Object(ce.buildExpressionFunction)("event_annotations_result",{layers:Y.map((e=>nl(e,s))),datatable:s.toFetchExpression({interval:(null===(V=U[0])||void 0===V?void 0:V.xAccessor)&&(null===(G=t[null===($=U[0])||void 0===$?void 0:$.layerId])||void 0===G||null===(q=G[null===(H=U[0])||void 0===H?void 0:H.xAccessor])||void 0===q?void 0:q.interval)||"auto",groups:Y.map((e=>({ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:e.indexPatternId,annotations:e.annotations.filter(J)})))})})]).toAst()]:[]});return Object(ce.buildExpression)([ae]).toAst()},tl=e=>e.map((e=>{var t,a,n,i;return Object(ce.buildExpression)([Object(ce.buildExpressionFunction)("yAxisConfig",{id:e.id,position:e.position,extent:Object(M.n)(null!==(t=e.extent)&&void 0!==t?t:{mode:"full",niceValues:!0}),showTitle:null===(a=e.showTitle)||void 0===a||a,title:e.title,showLabels:null===(n=e.showLabels)||void 0===n||n,showGridLines:null===(i=e.showGridLines)||void 0===i||i,labelsOrientation:e.labelsOrientation,scaleType:e.scaleType})]).toAst()})),al=(e,t,a)=>{const n=Object(ce.buildExpressionFunction)("referenceLineLayer",{layerId:e.layerId,decorations:e.yConfig?e.yConfig.map((e=>ll(e,Ls))):[],accessors:e.accessors,columnToLabel:JSON.stringify(Ui(e,t)),...a&&a.chain.length?{table:a}:{}});return Object(ce.buildExpression)([n]).toAst()},nl=(e,t)=>{const a=Object(ce.buildExpressionFunction)("extendedAnnotationLayer",{simpleView:Boolean(e.simpleView),layerId:e.layerId,annotations:t.toExpression(e.annotations||[])});return Object(ce.buildExpression)([a]).toAst()},il=(e,t,a,n,i,s,l)=>{const r=Ui(e,a),o=null==a?void 0:a.getOperationForColumnId(e.xAccessor),u=Boolean(o&&o.isBucketed&&o.scale&&"ordinal"!==o.scale),c=e.seriesType.split("_"),d=c[0],p=c.includes("percentage"),m=c.includes("stacked"),g=c.includes("horizontal"),f=Object(ce.buildExpressionFunction)("lens_collapse",{by:e.xAccessor?[e.xAccessor]:[],metric:e.accessors,fn:[e.collapseFn]}),b=Object(ce.buildExpressionFunction)("extendedDataLayer",{layerId:e.layerId,simpleView:Boolean(e.simpleView),xAccessor:e.xAccessor,xScaleType:Js(n[e.layerId][e.xAccessor],Et.ScaleType.Linear),isHistogram:u,isPercentage:p,isStacked:m,isHorizontal:g,splitAccessors:e.collapseFn||!e.splitAccessor?void 0:[e.splitAccessor],decorations:e.yConfig?e.yConfig.map((e=>sl(e,t))):void 0,curveType:l,seriesType:d,showLines:"line"===d||"area"===d,accessors:e.accessors,columnToLabel:JSON.stringify(r),palette:Object(ce.buildExpression)([e.palette?Object(ce.buildExpressionFunction)("theme",{variable:"palette",default:[i.get(e.palette.name).toExpression(e.palette.params)]}):Object(ce.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),colorMapping:e.colorMapping?JSON.stringify(e.colorMapping):void 0});return{type:"expression",chain:[...s?[...s.chain,...e.collapseFn?[f.toAst()]:[]]:[],b.toAst()]}},sl=(e,t,a)=>{var n,i;const s=null===(n=t.find((t=>t.id&&t.position===e.axisMode)))||void 0===n?void 0:n.id,l=Object(ce.buildExpressionFunction)("dataDecorationConfig",{axisId:s,forAccessor:e.forAccessor,color:null!==(i=e.color)&&void 0!==i?i:a});return Object(ce.buildExpression)([l]).toAst()},ll=(e,t)=>{var a;const n=Object(ce.buildExpressionFunction)("referenceLineDecorationConfig",{forAccessor:e.forAccessor,position:e.axisMode,color:null!==(a=e.color)&&void 0!==a?a:t,lineStyle:e.lineStyle||"solid",lineWidth:e.lineWidth||1,fill:e.fill||"none",icon:qs(e.icon)?e.icon:void 0,iconPosition:(qs(e.icon)||e.textVisibility)&&e.iconPosition||"auto",textVisibility:e.textVisibility||!1});return Object(ce.buildExpression)([n]).toAst()};function rl(e,t,a){return{...e,layers:e.layers.map(((e,n)=>n===a?t:e))}}const ol=[{id:"xy_legend_auto",value:"auto",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function ul(e,t,a){var n;return Boolean(null===(n=e.find((e=>e.groupId===t)))||void 0===n?void 0:n.series.some((({layer:e})=>ji(null==a?void 0:a.layers).find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const cl={x:"xTitle",yLeft:"yTitle",yRight:"yRightTitle"},dl=[{value:Et.LegendValue.Average,label:u.i18n.translate("xpack.lens.shared.legendValues.average",{defaultMessage:"Average"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.averageDesc",{defaultMessage:"Average of all values in the series."})},{value:Et.LegendValue.Median,label:u.i18n.translate("xpack.lens.shared.legendValues.median",{defaultMessage:"Median"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.medianDesc",{defaultMessage:"Median value in the series."})},{value:Et.LegendValue.Min,label:u.i18n.translate("xpack.lens.shared.legendValues.min",{defaultMessage:"Minimum"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.minDesc",{defaultMessage:"Minimum value in the series."})},{value:Et.LegendValue.Max,label:u.i18n.translate("xpack.lens.shared.legendValues.max",{defaultMessage:"Maximum"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.maxDesc",{defaultMessage:"Maximum value in the series."})},{value:Et.LegendValue.Range,label:u.i18n.translate("xpack.lens.shared.legendValues.range",{defaultMessage:"Range"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.rangeDesc",{defaultMessage:"Difference between the min and the max in the series."})},{value:Et.LegendValue.LastValue,label:u.i18n.translate("xpack.lens.shared.legendValues.lastValue",{defaultMessage:"Last value"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.lastValueDesc",{defaultMessage:"Last value in the series."})},{value:Et.LegendValue.LastNonNullValue,label:u.i18n.translate("xpack.lens.shared.legendValues.lastNonNullValue",{defaultMessage:"Last non-null value"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.lastNonNullValueDesc",{defaultMessage:"Last non-null value in the series."})},{value:Et.LegendValue.FirstValue,label:u.i18n.translate("xpack.lens.shared.legendValues.firstValue",{defaultMessage:"First value"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.firstValueDesc",{defaultMessage:"First value in the series."})},{value:Et.LegendValue.FirstNonNullValue,label:u.i18n.translate("xpack.lens.shared.legendValues.firstNonNullValue",{defaultMessage:"First non-null value"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.firstNonNullValueDesc",{defaultMessage:"First non-null value in the series."})},{value:Et.LegendValue.Difference,label:u.i18n.translate("xpack.lens.shared.legendValues.diff",{defaultMessage:"Difference"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.diffDesc",{defaultMessage:"Difference between first and last value in the series."})},{value:Et.LegendValue.DifferencePercent,label:u.i18n.translate("xpack.lens.shared.legendValues.diffPercent",{defaultMessage:"Difference %"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.diffPercentDesc",{defaultMessage:"Difference in percent between first and last value in the series."})},{value:Et.LegendValue.Total,label:u.i18n.translate("xpack.lens.shared.legendValues.total",{defaultMessage:"Sum"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.totalDesc",{defaultMessage:"The sum of all values in the series."})},{value:Et.LegendValue.Count,label:u.i18n.translate("xpack.lens.shared.legendValues.count",{defaultMessage:"Count"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.countDesc",{defaultMessage:"Count of all the values in the series."})},{value:Et.LegendValue.DistinctCount,label:u.i18n.translate("xpack.lens.shared.legendValues.distinctCount",{defaultMessage:"Distinct count"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.distinctCountDesc",{defaultMessage:"Count of distinct values in the series."})},{value:Et.LegendValue.Variance,label:u.i18n.translate("xpack.lens.shared.legendValues.variance",{defaultMessage:"Variance"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.varianceDesc",{defaultMessage:"Variance of all the values in the series."})},{value:Et.LegendValue.StdDeviation,label:u.i18n.translate("xpack.lens.shared.legendValues.stdDev",{defaultMessage:"Std deviation"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.stdDevDesc",{defaultMessage:"Standard deviation of all the values in the series."})},{value:Et.LegendValue.CurrentAndLastValue,label:u.i18n.translate("xpack.lens.shared.legendValues.currentValue",{defaultMessage:"Current or last value"}),toolTipContent:u.i18n.translate("xpack.lens.shared.legendValues.currentValueDesc",{defaultMessage:"Value of the bucket being hovered or the last bucket value when not hovering."})}],pl=u.i18n.translate("xpack.lens.xyChart.legendTitle",{defaultMessage:"Legend"}),ml=Object(s.memo)((function(e){var t,a,n,i,l,r,o,c,d,p,m,g,b,h,y,x,j,O,I,T,w,k,E,C,F,S,A,P,_,L;const{state:D,setState:R,frame:N,useLegacyTimeAxis:B}=e,z=ji(null==D?void 0:D.layers),V=!(null==D||!D.layers.length)&&$i(D.layers),G=fs(z,V,N.activeData),q=function(e,t){const a={};return t.forEach((t=>{let n=Number.MAX_SAFE_INTEGER,i=-Number.MAX_SAFE_INTEGER;t.series.forEach((t=>{var a;null==e||null===(a=e[t.layer])||void 0===a||a.rows.forEach((e=>{const a=e[t.accessor];null!==a&&Number.isFinite(a)&&(a<n&&(n=a),a>i&&(i=a))}))})),n!==Number.MAX_SAFE_INTEGER&&i!==-Number.MAX_SAFE_INTEGER&&(a[t.groupId]={min:Math.round(100*(n+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),a}(N.activeData,G),$=function(e=[],t){const a=e.reduce(((e,a)=>{const n=Object(M.r)(a.layerId,t,a.xAccessor);return n?{min:Math.min(e.min,n.min),max:Math.max(e.max,n.max)}:e}),{min:1/0,max:-1/0});if(isFinite(a.min)&&isFinite(a.max))return a}(z,N.activeData),H={x:null===(t=null==D||null===(a=D.tickLabelsVisibilitySettings)||void 0===a?void 0:a.x)||void 0===t||t,yLeft:null===(n=null==D||null===(i=D.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===n||n,yRight:null===(l=null==D||null===(r=D.tickLabelsVisibilitySettings)||void 0===r?void 0:r.yRight)||void 0===l||l},U=e=>{const t={...H,[e]:!H[e]};R({...D,tickLabelsVisibilitySettings:t})},W={x:null===(o=null==D||null===(c=D.gridlinesVisibilitySettings)||void 0===c?void 0:c.x)||void 0===o||o,yLeft:null===(d=null==D||null===(p=D.gridlinesVisibilitySettings)||void 0===p?void 0:p.yLeft)||void 0===d||d,yRight:null===(m=null==D||null===(g=D.gridlinesVisibilitySettings)||void 0===g?void 0:g.yRight)||void 0===m||m},X=e=>{const t={...W,[e]:!W[e]};R({...D,gridlinesVisibilitySettings:t})},Y={x:null!==(b=null==D||null===(h=D.labelsOrientation)||void 0===h?void 0:h.x)&&void 0!==b?b:0,yLeft:null!==(y=null==D||null===(x=D.labelsOrientation)||void 0===x?void 0:x.yLeft)&&void 0!==y?y:0,yRight:null!==(j=null==D||null===(O=D.labelsOrientation)||void 0===O?void 0:O.yRight)&&void 0!==j?j:0},Q=(e,t)=>{const a={...Y,[e]:t};R({...D,labelsOrientation:a})},K=Object(s.useMemo)((()=>{var e,t,a,n,i,s;return{x:null===(e=null==D||null===(t=D.axisTitlesVisibilitySettings)||void 0===t?void 0:t.x)||void 0===e||e,yLeft:null===(a=null==D||null===(n=D.axisTitlesVisibilitySettings)||void 0===n?void 0:n.yLeft)||void 0===a||a,yRight:null===(i=null==D||null===(s=D.axisTitlesVisibilitySettings)||void 0===s?void 0:s.yRight)||void 0===i||i}}),[null==D||null===(I=D.axisTitlesVisibilitySettings)||void 0===I?void 0:I.x,null==D||null===(T=D.axisTitlesVisibilitySettings)||void 0===T?void 0:T.yLeft,null==D||null===(w=D.axisTitlesVisibilitySettings)||void 0===w?void 0:w.yRight]),Z=Object(s.useCallback)((({title:e,visible:t},a)=>R({...D,[cl[a]]:e,axisTitlesVisibilitySettings:{...K,[a]:t}})),[K,R,D]),J=z.every((t=>{var a,n;return t.xAccessor&&"ordinal"!==Js(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,Et.ScaleType.Linear)})),ee=z.every((t=>{var a,n;return t.xAccessor&&Js(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,Et.ScaleType.Linear)===Et.ScaleType.Time})),te=ee?e=>{R({...D,hideEndzones:!e})}:void 0,ae=ee?e=>{R({...D,showCurrentTimeMarker:e})}:void 0,ne=null==D||!D.legend.isVisible||null!=D&&D.legend.showSingleSeries?null!=D&&D.legend.isVisible?"show":"hide":"auto",ie=Boolean(null===(k=G.find((e=>"left"===e.groupId)))||void 0===k||null===(E=k.series)||void 0===E?void 0:E.some((e=>{var t;const a=null===(t=z.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),se=Object(s.useCallback)(((e,t)=>(a,n)=>{R({...D,[e]:a,[t]:n})}),[R,D]),le=Object(s.useCallback)((e=>t=>{R({...D,[e]:t})}),[R,D]),re=Object(s.useCallback)((e=>t=>{R({...D,[e]:t})}),[R,D]),oe=Boolean(null===(C=G.find((e=>"right"===e.groupId)))||void 0===C||null===(F=C.series)||void 0===F?void 0:F.some((e=>{var t;const a=null===(t=z.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),ue=z.filter((e=>e.seriesType.includes("bar"))),ce=ue.length>1||ue.some((e=>e.accessors.length>1||e.splitAccessor)),de=z.some((({xAccessor:t,layerId:a,seriesType:n,splitAccessor:i})=>{var s,l;if(!t)return!1;const r=null!==(s=null===(l=e.frame.datasourceLayers[a])||void 0===l?void 0:l.getOperationForColumnId(t))&&void 0!==s?s:null;return Js(r,Et.ScaleType.Linear)===Et.ScaleType.Time&&(null==r?void 0:r.isBucketed)&&(n.includes("stacked")||!i)&&(n.includes("stacked")||!n.includes("bar")||!ce)})),pe=z.some((({layerId:t,xAccessor:a})=>Object(M.s)(e.frame.datasourceLayers[t],a))),me=na(D,e.frame.datasourceLayers).truncateText,ge=D.legend.legendSize;return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(Os,{state:D,setState:R,datasourceLayers:N.datasourceLayers}),Object(v.jsx)(M.e,{legendOptions:ol,mode:ne,location:null!=D&&D.legend.isInside?"inside":"outside",onLocationChange:e=>{R({...D,legend:{...D.legend,isInside:"inside"===e}})},titlePlaceholder:null!==(S=null===(A=N.activeData)||void 0===A||null===(P=A[z[0].layerId])||void 0===P||null===(_=P.columns.find((e=>e.id===z[0].splitAccessor)))||void 0===_?void 0:_.name)&&void 0!==S?S:pl,legendTitle:null==D?void 0:D.legend.title,onLegendTitleChange:({title:e,visible:t})=>{R({...D,legend:{...D.legend,title:e,isTitleVisible:t}})},isTitleVisible:null==D?void 0:D.legend.isTitleVisible,onDisplayChange:e=>{const t=ol.find((({id:t})=>t===e)).value;"auto"===t?R({...D,legend:{...D.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?R({...D,legend:{...D.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&R({...D,legend:{...D.legend,isVisible:!1,showSingleSeries:!1}})},position:null==D?void 0:D.legend.position,horizontalAlignment:null==D?void 0:D.legend.horizontalAlignment,verticalAlignment:null==D?void 0:D.legend.verticalAlignment,floatingColumns:null==D?void 0:D.legend.floatingColumns,onFloatingColumnsChange:e=>{R({...D,legend:{...D.legend,floatingColumns:e}})},maxLines:null==D?void 0:D.legend.maxLines,onMaxLinesChange:e=>{R({...D,legend:{...D.legend,maxLines:e}})},shouldTruncate:null!==(L=null==D?void 0:D.legend.shouldTruncate)&&void 0!==L?L:me,onTruncateLegendChange:()=>{var e;const t=null!==(e=null==D?void 0:D.legend.shouldTruncate)&&void 0!==e?e:me;R({...D,legend:{...D.legend,shouldTruncate:!t}})},onPositionChange:e=>{R({...D,legend:{...D.legend,position:e}})},onAlignmentChange:e=>{const[t,a]=e.split("_"),n=t,i=a;R({...D,legend:{...D.legend,verticalAlignment:n,horizontalAlignment:i}})},allowedLegendStats:J?dl:void 0,legendStats:null==D?void 0:D.legend.legendStats,onLegendStatsChange:(e,t)=>{R(t?{...D,legend:{...D.legend,legendStats:e,legendSize:is.LegendSize.AUTO,isVisible:!0,showSingleSeries:!0}}:{...D,legend:{...D.legend,legendStats:e,isVisible:!0,showSingleSeries:!0}})},legendSize:ge,onLegendSizeChange:e=>{R({...D,legend:{...D.legend,legendSize:e}})},showAutoLegendSizeOption:!0}))),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(ze.a,{tooltipContent:V?u.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(G.find((e=>"left"===e.groupId))||{}).length},Object(v.jsx)(ps,{axis:"yLeft",layers:null==D?void 0:D.layers,axisTitle:null==D?void 0:D.yTitle,updateTitleState:Z,areTickLabelsVisible:H.yLeft,toggleTickLabelsVisibility:U,areGridlinesVisible:W.yLeft,toggleGridlinesVisibility:X,isDisabled:0===Object.keys(G.find((e=>"left"===e.groupId))||{}).length,orientation:Y.yLeft,setOrientation:Q,isTitleVisible:K.yLeft,extent:(null==D?void 0:D.yLeftExtent)||{mode:"full"},setExtent:le("yLeftExtent"),hasBarOrAreaOnAxis:ie,dataBounds:q.left,hasPercentageAxis:ul(G,"left",D),scale:null==D?void 0:D.yLeftScale,setScale:re("yLeftScale"),setScaleWithExtent:se("yLeftExtent","yLeftScale")})),Object(v.jsx)(ps,{axis:"x",layers:null==D?void 0:D.layers,axisTitle:null==D?void 0:D.xTitle,updateTitleState:Z,areTickLabelsVisible:H.x,toggleTickLabelsVisibility:U,areGridlinesVisible:W.x,toggleGridlinesVisibility:X,orientation:Y.x,setOrientation:Q,isTitleVisible:K.x,endzonesVisible:!(null!=D&&D.hideEndzones),setEndzoneVisibility:te,currentTimeMarkerVisible:null==D?void 0:D.showCurrentTimeMarker,setCurrentTimeMarkerVisibility:ae,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1,useMultilayerTimeAxis:de&&!B&&!V,extent:pe?(null==D?void 0:D.xExtent)||{mode:"dataBounds"}:void 0,setExtent:le("xExtent"),dataBounds:$}),Object(v.jsx)(ze.a,{tooltipContent:V?u.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(G.find((e=>"right"===e.groupId))||{}).length},Object(v.jsx)(ps,{axis:"yRight",layers:null==D?void 0:D.layers,axisTitle:null==D?void 0:D.yRightTitle,updateTitleState:Z,areTickLabelsVisible:H.yRight,toggleTickLabelsVisibility:U,areGridlinesVisible:W.yRight,toggleGridlinesVisibility:X,isDisabled:0===Object.keys(G.find((e=>"right"===e.groupId))||{}).length,orientation:Y.yRight,setOrientation:Q,hasPercentageAxis:ul(G,"right",D),isTitleVisible:K.yRight,extent:(null==D?void 0:D.yRightExtent)||{mode:"full"},setExtent:le("yRightExtent"),hasBarOrAreaOnAxis:oe,dataBounds:q.right,scale:null==D?void 0:D.yRightScale,setScale:re("yRightScale"),setScaleWithExtent:se("yRightExtent","yRightScale")})))))}));var gl={name:"1gammwy",styles:"margin-top:5px"};const fl=({color:e,dataTestSubj:t})=>({component:Object(v.jsx)(f.EuiIcon,{type:"filterIgnore",color:e,css:gl}),tooltipValue:u.i18n.translate("xpack.lens.layerPanel.ignoreGlobalFilters",{defaultMessage:"Ignore global filters"}),"data-test-subj":t});function bl(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t&&Mi(t)?Object(v.jsx)(xl,e):null}function hl(){return Object(v.jsx)(M.h,{icon:li,label:u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})})}var vl={name:"1hbav5g",styles:"padding-bottom:3px;padding-left:4px"};function yl({title:e,hasUnsavedChanges:t}){return Object(v.jsx)(M.h,{icon:ri,label:e||u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"}),indicator:t&&Object(v.jsx)("div",{css:vl},Object(v.jsx)(f.EuiIconTip,{content:u.i18n.translate("xpack.lens.xyChart.unsavedChanges",{defaultMessage:"Unsaved changes"}),type:"dot",color:Me.euiThemeVars.euiColorSuccess}))})}function xl({frame:e,state:t,layerId:a,onChangeIndexPattern:n}){const{euiTheme:i}=Object(f.useEuiTheme)(),s=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),l=t.layers.findIndex((e=>e.layerId===a)),r=t.layers[l],o=e.dataViews.indexPatterns[r.indexPatternId];return Object(v.jsx)(M.c,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==o?void 0:o.name)||s,title:(null==o?void 0:o.title)||s,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal",extraIcons:r.ignoreGlobalFilters?[fl({color:i.colors.disabledText,dataTestSubj:"lnsChangeIndexPatternIgnoringFilters"})]:void 0},indexPatternId:r.indexPatternId,indexPatternRefs:e.dataViews.indexPatternRefs,isMissingCurrent:!o,onChangeIndexPattern:n})}var jl=a(654),Ol=a(655);const Il=[{value:"empty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}],Ml=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=$i(a.layers),d=a.layers.findIndex((e=>e.layerId===r)),{inputValue:p,handleInputChange:m}=Object(je.a)({value:a,onChange:n}),g=p.layers.find((e=>e.layerId===r)),f=null==g||null===(t=g.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=Object(s.useCallback)((e=>{if(null==e)return;const t=[...g.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(rl(p,{...g,yConfig:t},d))}),[o,d,p,g,m]);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(jl.a,{idPrefix:zs,setConfig:b,currentConfig:f}),Object(v.jsx)(ft.b,{setIcon:e=>b({icon:e}),currentIcon:null==f?void 0:f.icon,customIconSet:Il}),Object(v.jsx)(Ys,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(v.jsx)(Ol.a,{idPrefix:zs,setConfig:b,currentConfig:f}),Object(v.jsx)(wl,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(v.jsx)(zn.a,i()({},e,{overwriteColor:null==f?void 0:f.color,defaultColor:Ls,setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})))};function Tl({isHorizontal:e,axisMode:t}){const a=u.i18n.translate("xpack.lens.xyChart.fill.above",{defaultMessage:"Above"}),n=u.i18n.translate("xpack.lens.xyChart.fill.below",{defaultMessage:"Below"}),i=u.i18n.translate("xpack.lens.xyChart.fill.before",{defaultMessage:"Before"}),s=u.i18n.translate("xpack.lens.xyChart.fill.after",{defaultMessage:"After"}),l="bottom"===t||e?s:a,r="bottom"===t||e?i:n;return[{id:`${zs}none`,label:u.i18n.translate("xpack.lens.xyChart.fill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_fill_none"},{id:`${zs}above`,label:l,"data-test-subj":"lnsXY_fill_above"},{id:`${zs}below`,label:r,"data-test-subj":"lnsXY_fill_below"}]}const wl=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"})},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_fill",buttonSize:"compressed",options:Tl({isHorizontal:a,axisMode:null==e?void 0:e.axisMode}),idSelected:`${zs}${(null==e?void 0:e.fill)||"none"}`,onChange:e=>{const a=e.replace(zs,"");t({fill:a})}})),kl=Object(s.lazy)((()=>a.e(8).then(a.bind(null,686)))),El=e=>Object(v.jsx)(s.Suspense,{fallback:null},Object(v.jsx)(kl,e));var Cl=a(52),Fl=a(13);const Sl=e=>{var t;const{state:a,setState:n,layerId:i,accessor:l,frame:r}=e,[o,u]=Object(s.useState)(a),c=o.layers.findIndex((e=>e.layerId===i)),d=o.layers.find((e=>e.layerId===i)),p=null===(t=d.annotations)||void 0===t?void 0:t.find((e=>e.id===l)),m=Object(s.useCallback)((e=>{if(null==e)return;const t=[...d.annotations||[]],a=t.findIndex((e=>e.id===l));if(-1===a)throw new Error("should never happen because annotation is created before config panel is opened");t[a]=e;const i=rl(o,{...d,annotations:t},c);u(i),n(i)}),[d,o,c,n,l]),[g,f]=Object(s.useState)();Object(s.useEffect)((()=>{(async()=>{let t;t=(await e.dataViewsService.getIds()).includes(d.indexPatternId)?await e.dataViewsService.get(d.indexPatternId):await e.dataViewsService.create(r.dataViews.indexPatterns[d.indexPatternId].spec),f(t)})()}),[r.dataViews.indexPatterns,d.indexPatternId,e.dataViewsService]);const b=Object(Cl.useKibana)().services;if(!p)throw new Error("Annotation not found... this should never happen!");return g?Object(v.jsx)(El,{annotation:p,onAnnotationChange:e=>m(e),dataView:g,getDefaultRangeEnd:t=>Al(e.datatableUtilities,t,r,o.layers.filter(xi)),queryInputServices:b,calendarClassName:Ct.DONT_CLOSE_DIMENSION_CONTAINER_ON_CLICK_CLASS,appName:Wt.LENS_APP_NAME}):null},Al=(e,t,{activeData:a,absDateRange:n},i)=>{var s;const l=V()(t).valueOf(),r=.1*(V()(n.toDate).valueOf()-V()(n.fromDate).valueOf()),o=V()(l+r).toISOString(),u=i.map((({layerId:e})=>e));if(!u.length||!a||Object.entries(a).filter((([e])=>u.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return o;const c=null==a?void 0:a[u[0]].columns.find((e=>e.id===i[0].xAccessor));if(!c)return o;const d=null===(s=e.getDateHistogramMeta(c))||void 0===s?void 0:s.interval;if(!d)return o;const p=Fl.search.aggs.parseInterval(d);return p?V()(l+3*p.as("milliseconds")).toISOString():o};var Pl=a(197),_l=a(76),Ll=a(67);const Dl=({domElement:e,savedObjectsTagging:t,onSave:a,title:n,description:i,tags:o,showCopyOnSave:c})=>{const[d,p]=Object(s.useState)(o),m=()=>Object(r.unmountComponentAtNode)(e);return Object(v.jsx)(Ll.SavedObjectSaveModal,{onSave:async e=>a({...e,closeModal:m,newTags:d}),onClose:m,title:n,description:i,showCopyOnSave:c,objectType:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.objectType",{defaultMessage:"group"}),customModalTitle:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.modalTitle",{defaultMessage:"Save annotation group to library"}),showDescription:!0,confirmButtonLabel:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("div",null,Object(v.jsx)(f.EuiIcon,{type:"save"})),Object(v.jsx)("div",null,u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.confirmButton",{defaultMessage:"Save group"}))),options:t?Object(v.jsx)(t.ui.components.SavedObjectSaveModalTagSelector,{initialSelection:d,onTagsSelected:p,markOptional:!0}):void 0})};var Rl=a(28);const Nl=({modalTitle:e,onConfirm:t,onCancel:a})=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiModalHeader,null,Object(v.jsx)(f.EuiModalHeaderTitle,null,e)),Object(v.jsx)(f.EuiModalBody,null,Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.layer.revertModal.revertAnnotationGroupDescription",{defaultMessage:"This action will remove all unsaved changes that you've made and restore the most recent saved version of this annotation group to you visualization. Any lost unsaved changes cannot be restored."}))),Object(v.jsx)(f.EuiModalFooter,null,Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiButtonEmpty,{onClick:a},u.i18n.translate("xpack.lens.layer.cancelDelete",{defaultMessage:"Cancel"}))),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiButton,{"data-test-subj":"lnsLayerRevertChangesButton",onClick:t,color:"warning",iconType:"returnKey",fill:!0},u.i18n.translate("xpack.lens.layer.unlinkConfirm",{defaultMessage:"Revert changes"})))))))),Bl=({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,core:s,isSaveable:l,eventAnnotationService:o,savedObjectsTagging:d,dataViews:p,startServices:m})=>{const g=[];return Boolean(s.application.capabilities.visualize.save&&l)&&g.push((({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:s,toasts:l,savedObjectsTagging:o,dataViews:d,goToAnnotationLibrary:p,startServices:m})=>{const g=!Ti(t);return{displayName:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary",{defaultMessage:"Save to library"}),description:u.i18n.translate("xpack.lens.xyChart.annotations.addAnnotationGroupToLibraryDescription",{defaultMessage:"Saves annotation group as separate saved object"}),execute:async b=>{if(b){const h=ki(t);Object(r.render)(Object(v.jsx)(c.a,m,Object(v.jsx)(Dl,i()({domElement:b,savedObjectsTagging:o,onSave:async i=>{await(async({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:i,toasts:s,modalOnSaveProps:{newTitle:l,newDescription:o,newTags:d,closeModal:p,newCopyOnSave:m,onTitleDuplicate:g,isTitleDuplicateConfirmed:b},dataViews:h,goToAnnotationLibrary:y,startServices:x})=>{const j=await(async(e,t,a,n,i,s)=>!(i||e===t&&!a||!await s.groupExistsWithTitle(e)||(n(),0)))(l,Ei(t),m,g,b,i);if(j)return;let O;try{O=await(async(e,{newTitle:t,newDescription:a,newTags:n,newCopyOnSave:i},s,l)=>{let r;const o=await l.get(e.indexPatternId),u=!Ti(e)||i,c={annotations:e.annotations,indexPatternId:e.indexPatternId,ignoreGlobalFilters:e.ignoreGlobalFilters,title:t,description:a,tags:n,dataViewSpec:o.isPersisted()?void 0:o.toSpec(!1)};if(u){const{id:e}=await s.createAnnotationGroup(c);r=e}else await s.updateAnnotationGroup(c,e.annotationGroupId),r=e.annotationGroupId;return{id:r,config:c}})(t,{newTitle:l,newDescription:o,newTags:d,newCopyOnSave:m},i,h),n({id:O.id,group:O.config})}catch(e){return void s.addError(e,{title:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.errorToastTitle",{defaultMessage:'Failed to save "{title}"',values:{title:l}})})}const I={...t,annotationGroupId:O.id,__lastSaved:O.config};a({...e,layers:e.layers.map((e=>e.layerId===I.layerId?I:e))}),p(),s.addSuccess({title:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.successToastTitle",{defaultMessage:'Saved "{title}"',values:{title:l}}),text:e=>Object(r.render)(Object(v.jsx)(c.a,x,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.successToastBody",defaultMessage:"View or manage in the {link}.",values:{link:Object(v.jsx)(f.EuiLink,{"data-test-subj":"lnsAnnotationLibraryLink",onClick:()=>y()},u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.annotationLibrary",{defaultMessage:"annotation library"}))}})),e)})})({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:s,toasts:l,modalOnSaveProps:i,dataViews:d,goToAnnotationLibrary:p,startServices:m})}},h,{showCopyOnSave:!g}))),b)}},icon:"save",isCompatible:!0,"data-test-subj":"lnsXY_annotationLayer_saveToLibrary",order:100,showOutsideList:!0}})({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:o,toasts:s.notifications.toasts,savedObjectsTagging:d,dataViews:p,goToAnnotationLibrary:()=>s.application.navigateToApp(is.VISUALIZE_APP_NAME,{path:`#/${_l.ANNOTATIONS_LISTING_VIEW_ID}`}),startServices:m})),Ti(t)&&(g.push((({state:e,layer:t,setState:a,toasts:n})=>({execute:()=>{const i={layerId:t.layerId,layerType:t.layerType,indexPatternId:t.indexPatternId,ignoreGlobalFilters:t.ignoreGlobalFilters,annotations:t.annotations};a({...e,layers:e.layers.map((e=>e.layerId===t.layerId?i:e))}),n.addSuccess(u.i18n.translate("xpack.lens.xyChart.annotations.notificationUnlinked",{defaultMessage:'Unlinked "{title}"',values:{title:Ei(t)}}))},description:u.i18n.translate("xpack.lens.xyChart.annotations.unlinksFromLibrary",{defaultMessage:"Saves the annotation group as a part of the Lens Saved Object"}),displayName:u.i18n.translate("xpack.lens.xyChart.annotations.unlinkFromLibrary",{defaultMessage:"Unlink from library"}),isCompatible:!0,icon:"unlink","data-test-subj":"lnsXY_annotationLayer_unlinkFromLibrary",order:300}))({state:e,layer:t,setState:a,toasts:s.notifications.toasts})),g.push((({state:e,layer:t,setState:a,core:n})=>({displayName:u.i18n.translate("xpack.lens.xyChart.annotations.revertChanges",{defaultMessage:"Revert changes"}),description:u.i18n.translate("xpack.lens.xyChart.annotations.revertChangesDescription",{defaultMessage:"Restores annotation group to the last saved state."}),execute:async()=>{const i=n.overlays.openModal(Object(Rl.a)(Object(v.jsx)(Nl,{modalTitle:u.i18n.translate("xpack.lens.modalTitle.revertAnnotationGroupTitle",{defaultMessage:'Revert "{title}" changes?',values:{title:Ei(t)}}),onCancel:()=>i.close(),onConfirm:()=>{(({setState:e,layer:t,state:a,modal:n,toasts:i})=>{const s={layerId:t.layerId,layerType:t.layerType,annotationGroupId:t.annotationGroupId,indexPatternId:t.__lastSaved.indexPatternId,ignoreGlobalFilters:t.__lastSaved.ignoreGlobalFilters,annotations:Object(pa.cloneDeep)(t.__lastSaved.annotations),__lastSaved:t.__lastSaved};e({...a,layers:a.layers.map((e=>e.layerId===t.layerId?s:e))}),n.close(),i.addSuccess({title:u.i18n.translate("xpack.lens.xyChart.annotations.notificationReverted",{defaultMessage:'Reverted "{title}"',values:{title:Ei(t)}}),text:u.i18n.translate("xpack.lens.xyChart.annotations.notificationRevertedExplanation",{defaultMessage:"The most recently saved version of this annotation group has been restored."})})})({setState:a,layer:t,state:e,modal:i,toasts:n.notifications.toasts})}}),n),{"data-test-subj":"lnsAnnotationLayerRevertModal",maxWidth:600});await i.onClose},icon:"editorUndo",isCompatible:!0,disabled:!Wi(t),"data-test-subj":"lnsXY_annotationLayer_revertChanges",order:200}))({state:e,layer:t,setState:a,core:s}))),g};var zl=a(161);function Vl({eventAnnotationService:e,isLoadLibraryVisible:t,setLoadLibraryFlyoutVisible:a,addLayer:n,isInlineEditing:i}){const{renderEventAnnotationGroupSavedObjectFinder:s,loadAnnotationGroup:l}=e||{};return Object(v.jsx)(zl.a,{customFooter:Object(v.jsx)(f.EuiFlyoutFooter,{className:"lnsDimensionContainer__footer"},Object(v.jsx)(f.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center",justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiButtonEmpty,{flush:"left",size:"s",iconType:"cross",onClick:()=>{a(!1)},"data-test-subj":"lns-indexPattern-loadLibraryCancel"},u.i18n.translate("xpack.lens.loadAnnotationsLibrary.cancel",{defaultMessage:"Cancel"}))))),isOpen:Boolean(t),label:u.i18n.translate("xpack.lens.editorFrame.loadFromLibrary",{defaultMessage:"Select annotations from library"}),handleClose:()=>{a(!1)},isInlineEditing:i},Object(v.jsx)("div",{css:Object(v.css)("padding:",Me.euiThemeVars.euiSize,";height:100%;","")},Object(v.jsx)(s,{onChoose:({id:e})=>{l(e).then((t=>{n({...t,annotationGroupId:e}),a(!1)}))},onCreateNew:()=>{n(),a(!1)}})))}let Gl=function(e){return e.main="main",e.selectAnnotationMethod="selectAnnotationMethod",e.selectVisualizationType="selectVisualizationType",e}({});function ql({state:e,supportedLayers:t,addLayer:a,eventAnnotationService:n,isInlineEditing:i}){const[r,o]=Object(s.useState)(!1),[c,d]=Object(s.useState)(!1),p=$i(e.layers),m=si.visualizationTypes.filter((e=>qi(e.id)===p)),g=m.findIndex((t=>{var a,n;return t.id===(null===(a=ji(e.layers))||void 0===a||null===(n=a[0])||void 0===n?void 0:n.seriesType)}))||0;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiPopover,{display:"block","data-test-subj":"lnsConfigPanel__addLayerPopover",button:Object(v.jsx)(f.EuiButton,{fullWidth:!0,"data-test-subj":"lnsLayerAddButton","aria-label":u.i18n.translate("xpack.lens.configPanel.addLayerButton",{defaultMessage:"Add layer"}),fill:!0,color:"text",onClick:()=>o(!r),iconType:"layers"},u.i18n.translate("xpack.lens.configPanel.addLayerButton",{defaultMessage:"Add layer"})),isOpen:r,closePopover:()=>o(!1),panelPaddingSize:"none"},Object(v.jsx)(f.EuiContextMenu,{initialPanelId:Gl.main,size:"s",panels:[{id:Gl.main,title:u.i18n.translate("xpack.lens.configPanel.selectLayerType",{defaultMessage:"Select layer type"}),width:300,items:t.map((e=>{const{type:t,label:n,icon:i,disabled:s,toolTipContent:l}=e;return t===ue.LayerTypes.ANNOTATIONS?(({type:e,label:t,icon:a,disabled:n,toolTipContent:i})=>({panel:Gl.selectAnnotationMethod,toolTipContent:i,disabled:n,name:Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)("span",{className:"lnsLayerAddButton__label"},t)),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(M.d,{color:n?"subdued":void 0}))),className:"lnsLayerAddButton",icon:a&&Object(v.jsx)(f.EuiIcon,{size:"m",type:a}),"data-test-subj":`lnsLayerAddButton-${e}`}))(e):t===ue.LayerTypes.DATA?(({type:e,label:t,icon:a,disabled:n,toolTipContent:i})=>({panel:Gl.selectVisualizationType,toolTipContent:i,disabled:n,name:Object(v.jsx)("span",{className:"lnsLayerAddButtonLabel"},t),className:"lnsLayerAddButton",icon:a&&Object(v.jsx)(f.EuiIcon,{size:"m",type:a}),"data-test-subj":`lnsLayerAddButton-${e}`}))(e):{toolTipContent:l,disabled:s,name:Object(v.jsx)("span",{className:"lnsLayerAddButtonLabel"},n),className:"lnsLayerAddButton",icon:i&&Object(v.jsx)(f.EuiIcon,{size:"m",type:i}),"data-test-subj":`lnsLayerAddButton-${t}`,onClick:()=>{a(t),o(!1)}}}))},{id:Gl.selectAnnotationMethod,initialFocusedItemIndex:0,title:u.i18n.translate("xpack.lens.configPanel.selectAnnotationMethod",{defaultMessage:"Select annotation method"}),items:[{name:u.i18n.translate("xpack.lens.configPanel.newAnnotation",{defaultMessage:"New annotation"}),icon:"plusInCircle",onClick:()=>{a(ue.LayerTypes.ANNOTATIONS),o(!1)},"data-test-subj":"lnsAnnotationLayer_new"},{name:u.i18n.translate("xpack.lens.configPanel.loadFromLibrary",{defaultMessage:"Load from library"}),icon:"folderOpen",onClick:()=>{d(!0),o(!1)},"data-test-subj":"lnsAnnotationLayer_addFromLibrary"}]},{id:Gl.selectVisualizationType,initialFocusedItemIndex:g,title:u.i18n.translate("xpack.lens.layerPanel.selectVisualizationType",{defaultMessage:"Select visualization type"}),items:m.map((e=>({name:e.fullLabel||e.label,icon:e.icon&&Object(v.jsx)(f.EuiIcon,{size:"m",type:e.icon}),onClick:()=>{a(ue.LayerTypes.DATA,void 0,void 0,e.id),o(!1)},"data-test-subj":`lnsXY_seriesType-${e.id}`})))}]})),c&&Object(v.jsx)(Vl,{isLoadLibraryVisible:c,setLoadLibraryFlyoutVisible:d,eventAnnotationService:n,isInlineEditing:i,addLayer:e=>{a(ue.LayerTypes.ANNOTATIONS,e)}}))}function $l({title:e,dataView:t,index:a,palette:n,children:i,"data-test-subj-prefix":s}){const{euiTheme:l}=Object(f.useEuiTheme)(),r=Boolean(n),o=n&&1===n.length,u=n&&n.length>1,c=o?"stopFilled":"color";return Object(v.jsx)("li",{key:`${e}-${t}-${a}`,"data-test-subj":`${s}-${a}`,css:Object(v.css)("margin:",l.size.base," 0 0;","")},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},r?Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiIcon,{color:o?n[0]:void 0,type:c,"data-test-subj":`${s}-${a}-icon`})):null,Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiText,{size:"s","data-test-subj":`${s}-${a}-title`},e)),Object(v.jsx)(f.EuiFlexItem,{grow:!1},i)),u?Object(v.jsx)("div",{css:Object(v.css)("margin-top:",l.size.xs,";overflow-y:hidden;height:",l.size.xs,";margin-left:",l.size.l,";","")},Object(v.jsx)(f.EuiColorPaletteDisplay,{size:"xs",palette:n,"data-test-subj":`${s}-${a}-palette`})):null)}function Hl({layers:e,visualizationInfo:t,dataViews:a}){return Object(v.jsx)(l.a.Fragment,null,e.map(((e,n)=>{const i=a.indexPatterns[e.indexPatternId],s=t.layers.find((({layerId:t})=>t===e.layerId)),l=(null==s?void 0:s.label)||u.i18n.translate("xpack.lens.layerTitle.fallbackLabel",{defaultMessage:"Layer"}),r=null==s?void 0:s.palette;return Object(v.jsx)($l,{title:l,index:n,dataView:i.id,palette:r,"data-test-subj-prefix":"lns-feature-badges-ignoreGlobalFilters"})})))}function Ul({checked:e,onChange:t}){return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.layerSettings.ignoreGlobalFilters",{defaultMessage:"Use global filters"})},Object(v.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.layerSettings.ignoreGlobalFilters",{defaultMessage:"Use global filters"}),showLabel:!1,checked:e,"data-test-subj":"lns-layerSettings-ignoreGlobalFilters",onChange:()=>t(!e),compressed:!0}))}function Wl({state:e,setState:t,section:a,layerId:n}){if("appearance"===a)return null;const i=e.layers.find((e=>e.layerId===n));return i&&Mi(i)?Object(v.jsx)(Ul,{checked:!i.ignoreGlobalFilters,onChange:()=>{const a=e.layers.findIndex((e=>e===i)),n={...i,ignoreGlobalFilters:!i.ignoreGlobalFilters},s=[...e.layers];s[a]=n,Object(d.d)(n.ignoreGlobalFilters?"ignore_global_filters":"use_global_filters"),t({...e,layers:s})}}):null}var Xl=a(145);const Yl="lens_legend_stats",Ql=e=>`${Yl}${e}`;var Kl=a(65),Zl=a(115);function Jl(e,t,a){let n=Object(pa.cloneDeep)(function(e,t,a){if(!a||!a.length)return e;if(!function(e){return e.layers.some(er)}(e))return e;if(!t)throw new Error("xy visualization: injecting references relies on annotation groups but they were not provided");const n=e=>{var t;const n=a.find((({type:e})=>"index-pattern"===e)).id;return(null===(t=a.find((({name:t})=>t===ar(e))))||void 0===t?void 0:t.id)||n};return{...e,layers:e.layers.map((e=>{if(!er(e))return e;let i;if(tr(e))i={...e,indexPatternId:n(e.layerId)};else{var s;const r=null==a||null===(s=a.find((({name:t})=>t===e.annotationGroupRef)))||void 0===s?void 0:s.id,o=r?t[r]:void 0;if(!r||!o)return;const u={layerId:e.layerId,layerType:e.layerType,annotationGroupId:r,__lastSaved:o};i=er(l=e)&&"byReference"===l.persistanceType?{...u,ignoreGlobalFilters:o.ignoreGlobalFilters,indexPatternId:o.indexPatternId,annotations:Object(pa.cloneDeep)(o.annotations)}:{...u,ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:n(e.layerId),annotations:Object(pa.cloneDeep)(e.annotations),cachedMetadata:e.cachedMetadata}}var l;return i})).filter(Ct.nonNullable)}}(e,t,a));return n=function(e){if("valuesInLegend"in e){const t=e.valuesInLegend;return delete e.valuesInLegend,{...e,legend:{...e.legend,legendStats:[...new Set([...t?[Et.LegendValue.CurrentAndLastValue]:[],...e.legend.legendStats||[]])]}}}return e}(n),n}const er=e=>e.layerType===at.a.ANNOTATIONS&&!("indexPatternId"in e),tr=e=>er(e)&&("byValue"===e.persistanceType||!e.persistanceType);function ar(e){return`xy-visualization-layer-${e}`}const nr=({core:e,storage:t,data:a,paletteService:n,fieldFormats:s,useLegacyTimeAxis:l,kibanaTheme:r,eventAnnotationService:o,unifiedSearch:c,dataViewsService:d,savedObjectsTagging:p})=>({id:"lnsXY",visualizationTypes:si.visualizationTypes,getVisualizationTypeId(e){const t=Ci(e);return"mixed"===t?t:t.id},getLayerIds:e=>Ri(e).map((e=>e.layerId)),getRemoveOperation(e,t){const a=Ri(e,ue.LayerTypes.DATA).map((e=>e.layerId));return a.includes(t)&&1===a.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),cloneLayer(e,t,a,n){const i=e.layers.find((e=>e.layerId===t));if(i){Mi(i)&&i.annotations.forEach((e=>n.set(e.id,Object(kt.a)())));let t=Object(Ct.renewIDs)(i,[...n.keys()],(e=>n.get(e)));return t.layerId=a,Mi(t)&&Ti(t)&&(t={annotations:t.annotations,ignoreGlobalFilters:t.ignoreGlobalFilters,layerId:t.layerId,layerType:t.layerType,indexPatternId:t.indexPatternId}),{...e,layers:[...e.layers,t]}}return e},appendLayer(e,t,a,n,i,s){var l,r;return"metricTrendline"===a?e:{...e,layers:[...e.layers,Di({layerId:t,layerType:a,seriesType:s||(null===(l=ji(e.layers))||void 0===l||null===(r=l[0])||void 0===r?void 0:r.seriesType)||e.preferredSeriesType,indexPatternId:n,extraArg:i})]}},clearLayer:(e,t,a)=>({...e,layers:e.layers.map((n=>n.layerId!==t?n:Di({seriesType:e.preferredSeriesType,layerId:t,indexPatternId:a})))}),getPersistableState:e=>function(e){const t=e,a=[],n=[];return t.layers.forEach((e=>{if(Mi(e))if(Ti(e)){const t=`ref-${Object(Kl.v4)()}`;if(a.push({type:Zl.a,id:e.annotationGroupId,name:t}),Wi(e)){const i={persistanceType:"linked",cachedMetadata:e.cachedMetadata||{title:e.__lastSaved.title,description:e.__lastSaved.description,tags:e.__lastSaved.tags},layerId:e.layerId,layerType:e.layerType,annotationGroupRef:t,annotations:e.annotations,ignoreGlobalFilters:e.ignoreGlobalFilters};n.push(i),a.push({type:"index-pattern",id:e.indexPatternId,name:ar(e.layerId)})}else{const a={persistanceType:"byReference",layerId:e.layerId,layerType:e.layerType,annotationGroupRef:t};n.push(a)}}else{const{indexPatternId:t,...i}=e;a.push({type:"index-pattern",id:t,name:ar(e.layerId)}),n.push({...i,persistanceType:"byValue"})}else n.push(e)})),{savedObjectReferences:a,state:{...t,layers:n}}}(e),getDescription:Fi,switchVisualizationType:(e,t,a)=>({...t,preferredSeriesType:e,layers:a?t.layers.map((t=>t.layerId===a?{...t,seriesType:e}:t)):t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:Qi,triggers:[oe.VIS_EVENT_TO_TRIGGER.filter,oe.VIS_EVENT_TO_TRIGGER.brush],initialize:(e,t,a,n,i)=>t?Jl(t,n,i):{title:"Empty XY chart",legend:{isVisible:!0,position:Et.Position.Right},valueLabels:"hide",preferredSeriesType:Ai,layers:[{layerId:e(),accessors:[],position:Et.Position.Top,seriesType:Ai,showGridlines:!1,layerType:ue.LayerTypes.DATA,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0,colorMapping:"colorMapping"===(null==a?void 0:a.type)?a.value:Object(Ct.getColorMappingDefaults)()}]},getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},getSupportedLayers:(e,t)=>[Pi,Ts(e,t),Ss(e,t)],getSupportedActionsForLayer(t,n,i,s,l){const r=n.layers.findIndex((e=>e.layerId===t)),u=n.layers[r],c=[];return Mi(u)&&c.push(...Bl({state:n,layer:u,setState:i,registerLibraryAnnotationGroup:s,core:e,isSaveable:l,eventAnnotationService:o,savedObjectsTagging:p,dataViews:a.dataViews,startServices:e})),c},getCustomRemoveLayerText(e,t){const a=t.layers.findIndex((t=>t.layerId===e)),n=t.layers[a];if(n&&Ti(n))return{title:`Delete "${Ei(n)}"`}},hasLayerSettings({state:e,layerId:t}){var a;const n=null===(a=e.layers)||void 0===a?void 0:a.find((({layerId:e})=>e===t));return{data:Boolean(n&&Mi(n)),appearance:!1}},LayerSettingsComponent:e=>Object(v.jsx)(Wl,e),onIndexPatternChange(e,t,a){const n=e.layers.findIndex((e=>e.layerId===a)),i=e.layers[n];if(!i||!Mi(i))return e;const s=[...e.layers];return s[n]={...i,indexPatternId:t},{...e,layers:s}},getConfiguration({state:e,frame:t,layerId:a}){const i=e.layers.find((e=>e.layerId===a));if(!i)return{groups:[]};if(Mi(i))return(({state:e,frame:t,layer:a})=>{const n=vi("x",{isHorizontal:$i(e.layers)});return{groups:[{groupId:"xAnnotations",groupLabel:n,dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.annotationsDimensionEditorLabel",{defaultMessage:"{groupLabel} annotation",values:{groupLabel:n}}),accessors:ks(a),dataTestSubj:"lnsXY_xAnnotationsPanel",requiredMinDimensionCount:0,supportsMoreColumns:!0,supportFieldFormat:!1,enableDimensionEditor:!0,filterOperations:()=>!1}]}})({state:e,frame:t,layer:i});const l=Qs(t.datasourceLayers[i.layerId],i);if(Oi(i))return Ps({state:e,frame:t,layer:i,sortedAccessors:l});const o=ir({state:e,frame:t,layer:i,fieldFormats:s,paletteService:n,accessors:l}),c=i,d=ji(e.layers),p=$i(e.layers),{left:m,right:g}=gs([i],t.activeData),f=Boolean(c.accessors.length<2||m.length&&m.length<2||g.length&&g.length<2)&&d.filter((e=>{if(xi(e)&&e.seriesType===c.seriesType&&Boolean(e.xAccessor)===Boolean(c.xAccessor)&&Boolean(e.splitAccessor)===Boolean(c.splitAccessor)){const{left:a,right:n}=gs([e],t.activeData);return e.accessors.length&&(Boolean(a.length)===Boolean(m.length)||Boolean(n.length)===Boolean(g.length))}return!1})).length<2,b=!!i.colorMapping;let h=[];var v,y;return b?r.theme$.subscribe({next(e){h=Object(Ht.d)(e.darkMode,i.colorMapping)}}).unsubscribe():h=n.get((null===(v=c.palette)||void 0===v?void 0:v.name)||"default").getCategoricalColors(10,null===(y=c.palette)||void 0===y?void 0:y.params),{groups:[{groupId:"x",groupLabel:vi("x",{isHorizontal:p}),accessors:c.xAccessor?[{columnId:c.xAccessor}]:[],filterOperations:Vi,supportsMoreColumns:!c.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:vi("y",{isHorizontal:p}),accessors:o,filterOperations:zi,isMetricDimension:!0,supportsMoreColumns:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),accessors:c.splitAccessor?[{columnId:c.splitAccessor,triggerIconType:c.collapseFn?"aggregate":"colorBy",palette:c.collapseFn?void 0:h}]:[],filterOperations:Vi,supportsMoreColumns:!c.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",requiredMinDimensionCount:c.seriesType.includes("percentage")&&f?1:0,enableDimensionEditor:!0,isBreakdownDimension:!0}]}},getMainPalette:e=>{if(!e||0===e.layers.length)return;const t=(e.layers||[]).find((e=>xi(e)));return null!=t&&t.colorMapping?{type:"colorMapping",value:t.colorMapping}:null!=t&&t.palette?{type:"legacyPalette",value:t.palette}:void 0},getDropProps(e){if(!e.source)return;const t=e.source.indexPatternId,a=e.target.indexPatternId;if(a&&t===a){if(Object(Ct.isDraggedDataViewField)(e.source)){if("document"===e.source.field.type)return;return e.target.isNewColumn?{dropTypes:["field_add"]}:{dropTypes:["field_replace"]}}return Object(Ct.isOperationFromTheSameGroup)(e.source,e.target)?e.target.isNewColumn?{dropTypes:["duplicate_compatible"]}:{dropTypes:["reorder"]}:Object(Ct.isOperationFromCompatibleGroup)(e.source,e.target)?{dropTypes:e.target.isNewColumn?["move_compatible","duplicate_compatible"]:["replace_compatible","replace_duplicate_compatible","swap_compatible"]}:void 0}},onDrop(e){const t=e.prevState.layers.find((t=>t.layerId===e.target.layerId));if(!t)throw new Error("target layer should exist");return Mi(t)?(null==ws?void 0:ws(e))||e.prevState:Object(Pl.a)(e,this)},setDimension(e){const{prevState:t,layerId:a,columnId:n,groupId:i}=e,s=t.layers.find((e=>e.layerId===a));if(!s)return t;if(Oi(s))return(({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>{var s,l;const r=e.layers.find((e=>e.layerId===t));if(!r||!Oi(r))return e;const o={...r};o.accessors=[...o.accessors.filter((e=>e!==a)),a];const u=null===(s=o.yConfig)||void 0===s?void 0:s.some((({forAccessor:e})=>e===a)),c=!!i&&(null===(l=Ii(e.layers).map((({yConfig:e})=>e)).flat())||void 0===l?void 0:l.find((e=>(null==e?void 0:e.forAccessor)===i)));if(!u){const e="xReferenceLine"===n?"bottom":"yReferenceLineRight"===n?"right":"left";o.yConfig=[...o.yConfig||[],{...c,forAccessor:a,axisMode:e}]}return{...e,layers:e.layers.map((e=>e.layerId===t?o:e))}})(e);if(Mi(s))return(({prevState:e,layerId:t,columnId:a,previousColumn:n,frame:i})=>{var s;const l=e.layers.find((e=>e.layerId===t));if(!l||!Mi(l))return e;const r=n?null===(s=l.annotations)||void 0===s?void 0:s.find((({id:e})=>e===n)):void 0;return{...e,layers:e.layers.map((n=>n.layerId===t?{...l,annotations:[...l.annotations,Object(oi.a)(a,Ms(ji(e.layers),i),r)]}:n))}})(e);const l=Object.assign({},s);return"x"===i&&(l.xAccessor=n),"y"===i&&(l.accessors=[...l.accessors.filter((e=>e!==n)),n]),"breakdown"===i&&(l.splitAccessor=n),{...t,layers:t.layers.map((e=>e.layerId===a?l:e))}},removeDimension({prevState:e,layerId:t,columnId:a,frame:n}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;if(Mi(i)){const n={...i,annotations:i.annotations.filter((({id:e})=>e!==a))},s=e.layers.map((e=>e.layerId===t?n:e));return{...e,layers:s}}const s={...i};var l;xi(s)&&(s.xAccessor===a?delete s.xAccessor:s.splitAccessor===a&&(delete s.splitAccessor,delete s.palette)),s.accessors.includes(a)&&(s.accessors=s.accessors.filter((e=>e!==a))),"yConfig"in s&&(s.yConfig=null===(l=s.yConfig)||void 0===l?void 0:l.filter((({forAccessor:e})=>e!==a)));let r=e.layers.map((e=>e.layerId===t?s:e));const o=Cs(ji(e.layers),n.datasourceLayers,n.activeData);return Object.keys(o).every((e=>!o[e]))&&(r=r.filter((e=>xi(e)||"accessors"in e&&e.accessors.length))),{...e,layers:r}},LayerPanelComponent(e){const{onChangeIndexPattern:t,...a}=e;return Object(v.jsx)(bl,i()({},a,{onChangeIndexPattern:e=>{t(e)}}))},isSubtypeCompatible:(e,t)=>qi(e)&&qi(t)||!qi(e)&&!qi(t),getCustomLayerHeader(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));if(t)return Oi(t)?Object(v.jsx)(hl,null):Mi(t)?Object(v.jsx)(yl,{title:Ei(t),hasUnsavedChanges:Wi(t)}):void 0},ToolbarComponent:e=>Object(v.jsx)(ml,i()({},e,{useLegacyTimeAxis:l})),DimensionEditorComponent(e){const t={...e,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},l=S()(r.theme$,{darkMode:!1}).darkMode,o=e.state.layers.find((t=>t.layerId===e.layerId));return Oi(o)?Object(v.jsx)(Ml,t):Mi(o)?Object(v.jsx)(Sl,i()({},t,{dataViewsService:d})):Object(v.jsx)(Vs,i()({},t,{darkMode:l}))},DimensionEditorDataExtraComponent(e){const t={...e,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},i=e.state.layers.find((t=>t.layerId===e.layerId));return Oi(i)||Mi(i)?null:Object(v.jsx)(Gs,t)},getAddLayerButtonComponent:e=>Object(v.jsx)(ql,i()({},e,{eventAnnotationService:o,addLayer:async(t,a,n,i)=>{var s;t===ue.LayerTypes.ANNOTATIONS&&a&&(await e.ensureIndexPattern(null!==(s=a.dataViewSpec)&&void 0!==s?s:a.indexPatternId),e.registerLibraryAnnotationGroup({id:a.annotationGroupId,group:a})),e.addLayer(t,a,!!a,i)}})),toExpression:(e,t,a,i={})=>Ks(e,t,n,i,o),toPreviewExpression:(e,t,a={})=>function(e,t,a,n,i){return Ks({...e,layers:e.layers.map((e=>((e,t)=>xi(e)?t[ma.layerTypes.DATA](e):Oi(e)?t[ma.layerTypes.REFERENCELINE](e):t[ma.layerTypes.ANNOTATIONS](e))(e,Zs))),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,a,n,i)}(e,t,n,a,o),getUserMessages(e,{frame:t}){const{datasourceLayers:a,dataViews:i,activeData:l}=t,r=wi(e.layers),o=[],c=Gi(ji(e.layers),t);if(r.forEach((e=>{e.annotations.forEach((t=>{c||o.push({uniqueId:Ft.b,severity:"error",fixableInEditor:!0,displayLocations:[{id:"dimensionButton",dimensionId:t.id}],shortMessage:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),longMessage:""});const a=function(e,t,a){var n;if(!e)return[];const i=e.annotations.find((({id:e})=>e===t));if(!i||!Object(oi.f)(i))return[];const s=a.indexPatterns[e.indexPatternId],l=[];null!=i.timeField&&""!==i.timeField||l.push(Xi(Ft.c,u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldEmpty",{defaultMessage:"Time field is missing"}),i.id,i.label)),i.timeField&&!Boolean(s.getFieldByName(i.timeField))&&l.push(Xi(Ft.f,u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldNotFound",{defaultMessage:"Time field {timeField} not found in data view {dataView}",values:{timeField:i.timeField,dataView:s.title}}),i.id,i.label));const{isValid:r,error:o}=Object(gi.b)(null==i?void 0:i.filter,s);if(!r&&o&&l.push(Xi(Ft.a,o,i.id,i.label)),i.textField&&!Boolean(s.getFieldByName(i.textField))&&l.push(Xi(Ft.e,u.i18n.translate("xpack.lens.xyChart.annotationError.textFieldNotFound",{defaultMessage:"Text field {textField} not found in data view {dataView}",values:{textField:i.textField,dataView:s.title}}),i.id,i.label)),null!==(n=i.extraFields)&&void 0!==n&&n.length){const e=[];for(const t of i.extraFields)Boolean(s.getFieldByName(t))||e.push(t);e.length&&l.push(Xi(Ft.d,u.i18n.translate("xpack.lens.xyChart.annotationError.tooltipFieldNotFound",{defaultMessage:"Tooltip {missingFields, plural, one {field} other {fields}} {missingTooltipFields} not found in data view {dataView}",values:{missingTooltipFields:e.join(", "),missingFields:e.length,dataView:s.title}}),i.id,i.label))}return l}(e,t.id,i);o.push(...a)}))})),e&&e.layers.length>1){const t=Ni("y",e.layers,(({accessors:e})=>null==e||0===e.length));t.valid||o.push(t.error);const a=Ni("break_down",e.layers,(({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e));a.valid||o.push(a.error)}o.push(...function(e,t){const a=ji(e.layers),n=[],i=a.findIndex(yi("interval","date",t)),s=a.findIndex(yi("interval","number",t)),l=a.findIndex(yi("ordinal",void 0,t));if(e.layers.length>1){const t=[i,s,l].filter((e=>e>=0)).sort(((e,t)=>e-t));if(t.length>1){const[a,...i]=t,s=vi("x",{isHorizontal:$i(e.layers)});for(const e of i)n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:s}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"The {axis} data in layer {firstLayer} is incompatible with the data in layer {secondLayer}. Select a new function for the {axis}.",values:{axis:s,firstLayer:a+1,secondLayer:e+1}})})}}return n}(e,a).map((({shortMessage:e,longMessage:t})=>({severity:"error",uniqueId:Ft.gb,fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:e,longMessage:t}))));for(const t of ji(e.layers)){const n=a[t.layerId];if(n)for(const a of t.accessors){const t=n.getOperationForColumnId(a);t&&"number"!==t.dataType&&o.push({uniqueId:Ft.ib,severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:vi("y",{isHorizontal:$i(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:t.label,dataType:t.dataType,axis:vi("y",{isHorizontal:$i(e.layers)})}})})}}const d=[];if((null==e?void 0:e.layers.length)>0&&l){const t=[...ji(e.layers),...Ii(e.layers)].filter((({accessors:e})=>e.length>0)),n=[];for(const e of t){const{layerId:t,accessors:i}=e,s=(null==l?void 0:l[t])&&l[t].rows;if(!s)break;const r=Ui(e,a[t]);for(const e of i)s.some((t=>Array.isArray(t[e])))&&n.push(r[e])}n.forEach((e=>d.push({uniqueId:Ft.fb,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(v.jsx)("strong",null,e)}})})))}const p=!(null==e||!e.layers.length)&&$i(e.layers),m=fs(ji(e.layers),p,t.activeData).filter((({groupId:t})=>"left"===t&&"log"===e.yLeftScale||"right"===t&&"log"===e.yRightScale));m.length>0&&m.map((e=>{const t=e.series.filter((e=>{var t,a;let n=!1,i=!1;const s=null!==(t=null==l||null===(a=l[e.layer])||void 0===a?void 0:a.rows)&&void 0!==t?t:[];for(let t=0;t<s.length;t++)if(s[t][e.accessor]<0?n=!0:i=!0,n&&i)return!0;return!1}));return{...e,mixedDomainSeries:t}})).forEach((e=>{if(0===e.mixedDomainSeries.length)return;const{groupId:t}=e;d.push({uniqueId:`${Ft.db}${t}`,severity:"warning",shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyVisualization.mixedLogScaleWarning",defaultMessage:"When the {axisName} axis is set to logarithmic scale, the dataset should not contain positive and negative data.",values:{axisName:"left"===t?Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyVisualization.mixedLogScaleWarningLeft",defaultMessage:"left"}):Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyVisualization.mixedLogScaleWarningRight",defaultMessage:"right"})}}),displayLocations:[{id:"toolbar"}],fixableInEditor:!0}),e.mixedDomainSeries.forEach((({accessor:e})=>{d.push({uniqueId:`${Ft.eb}${e}`,severity:"warning",shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.xyVisualization.mixedLogScaleDimensionWarning",defaultMessage:"This metric is using logarithmic scale and should not contain positive and negative data."}),displayLocations:[{id:"dimensionButton",dimensionId:e}],fixableInEditor:!0})}))}));const g=function(e,t,a,n){const i=wi(e.layers).filter((e=>e.ignoreGlobalFilters&&e.annotations.some((e=>"manual"!==e.type))));if(!i.length)return[];const s=sr(e,t,a,n);return[{uniqueId:Ft.G,severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsIgnoreTitle",{defaultMessage:"Layers ignoring global filters"}),longMessage:Object(v.jsx)(Hl,{layers:i.map((({layerId:e,indexPatternId:t})=>({layerId:e,indexPatternId:t}))),visualizationInfo:s,dataViews:t.dataViews}),displayLocations:[{id:"embeddableBadge"}]}]}(e,t,n,s);return o.concat(d,g)},getUniqueLabels:e=>Es(e.layers),getUsedDataView(e,t){var a;return null===(a=wi(e.layers).find((e=>e.layerId===t)))||void 0===a?void 0:a.indexPatternId},getUsedDataViews(e){var t;return null!==(t=null==e?void 0:e.layers.filter(Mi).map((({indexPatternId:e})=>e)))&&void 0!==t?t:[]},DimensionTriggerComponent:({columnId:e,label:t})=>t?Object(v.jsx)(di.a,{id:e,label:t||Is}):null,getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},isEqual(e,t,a,n,i){const s=Jl(e,i,t),l=Jl(a,i,n);return Object(pa.isEqual)(s,l)},getVisualizationInfo:(e,t)=>sr(e,t,n,s),getTelemetryEventsOnSave(e,t){const a=ji(e.layers),n=t?ji(t.layers):void 0,i=a.flatMap((e=>{const t=null==n?void 0:n.find((t=>t.layerId===e.layerId));return Hn(e.colorMapping,null==t?void 0:t.colorMapping)})),s=((e,t)=>{if(!e||!e.length||Object(pa.isEqual)(e,t))return[];if(!Object(Xl.b)(e))return[];const a=Yl,n=e.map((e=>Ql(`_${e}`))),i=function(e){if(!(e<1))return e<4?`_amount_${String(e)}`:e>=4&&e<=7?"_amount_4_to_7":e>=8?"_amount_above_8":void 0}(e.length);return[a,...n,i?Ql(i):void 0].filter(Ct.nonNullable)})(e.legend.legendStats,t?t.legend.legendStats:void 0);return i.concat(s)},getRenderEventCounters(e){var t;return Object(Xl.b)(null!==(t=e.legend.legendStats)&&void 0!==t?t:[])?["legend_stats"]:[]}}),ir=({accessors:e,frame:t,fieldFormats:a,paletteService:n,state:i,layer:s})=>{let l=e.map((e=>({columnId:e})));return t.activeData&&(l=function(e,t,a,n){if(Oi(a))return(e=>e.accessors.map((t=>{var a;const n=null===(a=e.yConfig)||void 0===a?void 0:a.find((e=>e.forAccessor===t));return As(t,null==n?void 0:n.color)})))(a);if(Mi(a))return ks(a);const i=!a.collapseFn&&a.splitAccessor;return a.accessors.map((s=>{var l;if(i)return Rs(s);const r=null===(l=a.yConfig)||void 0===l?void 0:l.find((e=>e.forAccessor===s));return null!=r&&r.color?{columnId:s,triggerIconType:"color",color:r.color}:Ns(a,s,e,t,n)}))}(Ds(ji(i.layers),{tables:t.activeData},a.deserialize),t,{...s,accessors:e.filter((e=>s.accessors.includes(e)))},n)),l};function sr(e,t,a,n){const i=$i(e.layers);return{layers:e.layers.map((s=>{const l=[],r=[];let o,c,d;if(xi(s)){o=s.seriesType;const g=si.visualizationTypes.find((e=>e.id===o));if(c=null==g?void 0:g.icon,d=(null==g?void 0:g.fullLabel)||(null==g?void 0:g.label),s.xAccessor&&r.push({name:vi("x",{isHorizontal:i}),id:s.xAccessor,dimensionType:"x"}),s.accessors&&s.accessors.length&&(s.accessors.forEach((e=>{r.push({name:vi("y",{isHorizontal:i}),id:e,dimensionType:"y"})})),null!=t&&t.datasourceLayers&&t.activeData)){const i=Qs(t.datasourceLayers[s.layerId],s),r=ir({state:e,frame:t,layer:s,fieldFormats:n,paletteService:a,accessors:i});l.push(...r.flatMap((({color:e})=>e)))}var p,m;s.splitAccessor&&(r.push({name:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),dimensionType:"breakdown",id:s.splitAccessor}),s.collapseFn||l.push(...a.get((null===(p=s.palette)||void 0===p?void 0:p.name)||"default").getCategoricalColors(10,null===(m=s.palette)||void 0===m?void 0:m.params)))}if(Oi(s)&&s.accessors&&s.accessors.length&&(s.accessors.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.xyChart.layerReferenceLine",{defaultMessage:"Reference line"}),dimensionType:"reference_line",id:e})})),d=u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"}),c=li,null!=t&&t.datasourceLayers&&t.activeData)){const a=Qs(t.datasourceLayers[s.layerId],s);l.push(...Ps({state:e,frame:t,layer:s,sortedAccessors:a}).groups.flatMap((({accessors:e})=>e.map((({color:e})=>e)))))}Mi(s)&&s.annotations&&s.annotations.length&&(s.annotations.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.xyChart.layerAnnotation",{defaultMessage:"Annotation"}),dimensionType:"annotation",id:e.id})})),d=u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"}),c=ri,l.push(...s.annotations.filter((({isHidden:e})=>!e)).map((e=>ci(e).color))));const g=null==l?void 0:l.filter(Ct.nonNullable);return{layerId:s.layerId,layerType:s.layerType,chartType:o,icon:c,label:d,dimensions:r,palette:g.length?g:void 0}}))}}var lr=a(16);class xy_XyVisualization{setup(e,{editorFrame:t}){t.registerVisualization((async()=>{const{getXyVisualization:t}=await Promise.resolve().then(a.bind(null,682)),[n,{charts:i,data:s,fieldFormats:l,eventAnnotation:r,unifiedSearch:o,savedObjectsTagging:u,dataViews:c}]=await e.getStartServices(),[d,p]=await Promise.all([i.palettes.getPalettes(),r.getService()]),m=e.uiSettings.get(Pe.LEGACY_TIME_AXIS);return t({core:n,data:s,storage:new lr.Storage(localStorage),paletteService:d,eventAnnotationService:p,fieldFormats:l,useLegacyTimeAxis:m,kibanaTheme:e.theme,unifiedSearch:o,dataViewsService:c,savedObjectsTagging:u})}))}}const rr=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:30,height:22,viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.subdued,d:"M16 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V1zM0 17a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4zm17-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V9a1 1 0 00-1-1h-4zm-1 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4zm9-17a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1h-4z"}),Object(v.jsx)("path",{className:h.a.accent,d:"M0 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1zm0 8a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9zm9-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1H9zM8 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H9a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zm15-7a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1h-4z"})),or="temperature",ur=u.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),cr="heatmap",dr={heatmap:{shapeType:cr,icon:rr,label:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:ur}},pr="x",mr="y",gr="cell",fr="heatmap_legend",br="heatmap_grid",hr=({table:e,state:t,keptLayerIds:a})=>{var n,i,s,l,r,o,c,d,p,m,g,f,b,h,v;if((null==t?void 0:t.shape)===cr&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType||e.columns.some((e=>e.operation.isStaticValue))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];let y=0;const[x,j]=Object(pa.partition)(e.columns,(e=>e.operation.isBucketed));if(0===x.length&&0===j.length)return[];if(x.length>=3)return[];if(j.length>1)return[];const O=1===x.length&&0===j.length,I=0===x.length&&1===j.length,M=x.length>0&&0===j.length,T=1===j.length&&x.length>0&&x.every((e=>"date"===e.operation.dataType)),w="reduced"===e.changeType||"reorder"===e.changeType||O||T||M||I,k={shape:cr,layerId:e.layerId,layerType:ue.LayerTypes.DATA,legend:{isVisible:null===(n=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===n||n,position:null!==(s=null==t||null===(l=t.legend)||void 0===l?void 0:l.position)&&void 0!==s?s:Et.Position.Right,type:fr},gridConfig:{type:br,isCellLabelVisible:!1,isYAxisLabelVisible:null===(r=null==t||null===(o=t.gridConfig)||void 0===o?void 0:o.isYAxisLabelVisible)||void 0===r||r,isXAxisLabelVisible:null===(c=null==t||null===(d=t.gridConfig)||void 0===d?void 0:d.isXAxisLabelVisible)||void 0===c||c,isYAxisTitleVisible:null!==(p=null==t||null===(m=t.gridConfig)||void 0===m?void 0:m.isYAxisTitleVisible)&&void 0!==p&&p,isXAxisTitleVisible:null!==(g=null==t||null===(f=t.gridConfig)||void 0===f?void 0:f.isXAxisTitleVisible)&&void 0!==g&&g}},E=j.find((e=>"number"===e.operation.dataType));E&&(y+=.3,k.valueAccessor=E.columnId);const[C,F]=Object(pa.partition)(x,(e=>"interval"===e.operation.scale));return k.xAccessor=(null===(b=C[0])||void 0===b?void 0:b.columnId)||(null===(h=F[0])||void 0===h?void 0:h.columnId),k.yAccessor=null===(v=x.find((e=>e.columnId!==k.xAccessor)))||void 0===v?void 0:v.columnId,x.some((e=>"date"===e.operation.dataType))||(k.xAccessor&&(y+=.3),k.yAccessor&&(y+=.3)),[{state:k,title:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),hide:w,previewIcon:rr,score:Number(y.toFixed(1)),incomplete:O||I||M}]};a(322);const vr=[{id:"heatmap_legend_show",value:"show",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],yr=Object(s.memo)((e=>{var t;const{state:a,setState:n,frame:i}=e,l=a.legend.isVisible?"show":"hide",r=na(a,i.datasourceLayers).truncateText,o=null==a?void 0:a.legend.legendSize,[c]=Object(s.useState)((()=>o===oe.LegendSize.AUTO));return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(v.jsx)(M.k,{valueLabels:null!=a&&a.gridConfig.isCellLabelVisible?"show":"hide",onValueLabelChange:e=>{n({...a,gridConfig:{...a.gridConfig,isCellLabelVisible:"show"===e}})}})),Object(v.jsx)(M.e,{groupPosition:"right",legendOptions:vr,mode:l,onDisplayChange:e=>{const t=vr.find((({id:t})=>t===e)).value;"show"===t?n({...a,legend:{...a.legend,isVisible:!0}}):"hide"===t&&n({...a,legend:{...a.legend,isVisible:!1}})},position:null==a?void 0:a.legend.position,onPositionChange:e=>{n({...a,legend:{...a.legend,position:e}})},maxLines:null==a?void 0:a.legend.maxLines,onMaxLinesChange:e=>{n({...a,legend:{...a.legend,maxLines:e}})},shouldTruncate:null!==(t=null==a?void 0:a.legend.shouldTruncate)&&void 0!==t?t:r,onTruncateLegendChange:()=>{var e;const t=null!==(e=a.legend.shouldTruncate)&&void 0!==e?e:r;n({...a,legend:{...a.legend,shouldTruncate:!t}})},legendSize:o,onLegendSizeChange:e=>{n({...a,legend:{...a.legend,legendSize:e}})},showAutoLegendSizeOption:c}))),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(ze.a,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.verticalAxisDisabledHelpText",{defaultMessage:"This setting only applies when vertical axis is enabled."}),condition:!Boolean(null==a?void 0:a.yAccessor)},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),type:ls,groupPosition:"left",isDisabled:!Boolean(null==a?void 0:a.yAccessor),buttonDataTestSubj:"lnsHeatmapVerticalAxisButton",panelClassName:"lnsVisToolbarAxis__popover"},Object(v.jsx)(M.j,{settingId:"yLeft",title:null==a?void 0:a.gridConfig.yTitle,updateTitleState:({title:e,visible:t})=>{n({...a,gridConfig:{...a.gridConfig,yTitle:e,isYAxisTitleVisible:t}})},isTitleVisible:null==a?void 0:a.gridConfig.isYAxisTitleVisible}),Object(v.jsx)(M.b,{axis:"yLeft",updateTicksVisibilityState:e=>{n({...a,gridConfig:{...a.gridConfig,isYAxisLabelVisible:e}})},isAxisLabelVisible:null==a?void 0:a.gridConfig.isYAxisLabelVisible}))),Object(v.jsx)(ze.a,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.horizontalAxisDisabledHelpText",{defaultMessage:"This setting only applies when horizontal axis is enabled."}),condition:!Boolean(null==a?void 0:a.xAccessor)},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),type:ss,groupPosition:"center",isDisabled:!Boolean(null==a?void 0:a.xAccessor),buttonDataTestSubj:"lnsHeatmapHorizontalAxisButton"},Object(v.jsx)(M.j,{settingId:"x",title:null==a?void 0:a.gridConfig.xTitle,updateTitleState:({title:e,visible:t})=>n({...a,gridConfig:{...a.gridConfig,xTitle:e,isXAxisTitleVisible:t}}),isTitleVisible:null==a?void 0:a.gridConfig.isXAxisTitleVisible}),Object(v.jsx)(M.b,{axis:"x",updateTicksVisibilityState:e=>{n({...a,gridConfig:{...a.gridConfig,isXAxisLabelVisible:e}})},isAxisLabelVisible:null==a?void 0:a.gridConfig.isXAxisLabelVisible}))))))}));function xr(e,t,a,n){if(null==t||null==a)return{displayStops:[],activePalette:n};const i=null!=n?n:{type:"palette",name:or,accessor:a},s=Object(M.q)([a],t)[a];return{displayStops:Object(M.m)(e,i,s),currentMinMax:s,activePalette:i}}function jr(e){var t;const{state:a,setState:n,frame:i,accessor:s,isInlineEditing:r}=e;if((null==a?void 0:a.valueAccessor)!==s)return null;const o=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:c,activePalette:d,currentMinMax:p}=xr(e.paletteService,o,s,null!=a&&a.palette&&a.palette.accessor===s?a.palette:void 0);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(v.jsx)(M.f,{palette:c.map((({color:e})=>e)),siblingRef:e.panelRef,isInlineEditing:r},d&&Object(v.jsx)(ge,{palettes:e.paletteService,activePalette:d,dataBounds:p,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=c),e.accessor=s,n({...a,palette:e})}}))))}a(327);const Or=u.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Magnitude"});function Ir(e){const t=u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?a:t}const Mr=e=>e.isBucketed&&"ordinal"===e.scale,Tr=e=>Mr(e)||"interval"===e.scale,wr=e=>!Mr(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType&&!e.isStaticValue)(e);function kr(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const Er=({paletteService:e,theme:t})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:rr,label:u.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:Or,showExperimentalBadge:!1,sortPriority:1}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>dr.heatmap,initialize:(e,t,a)=>t||{layerId:e(),layerType:ue.LayerTypes.DATA,title:"Empty Heatmap chart",shape:cr,legend:{isVisible:!0,position:Et.Position.Right,maxLines:1,type:fr},gridConfig:{type:br,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0,isYAxisTitleVisible:!0,isXAxisTitleVisible:!0}},getSuggestions:hr,triggers:[oe.VIS_EVENT_TO_TRIGGER.filter,oe.VIS_EVENT_TO_TRIGGER.brush],getConfiguration({state:t,frame:a,layerId:n}){var i,s;const l=a.datasourceLayers[n];if(!(null==l?void 0:l.getTableSpec().map((({columnId:e})=>e))))return{groups:[]};const{displayStops:r,activePalette:o}=xr(e,null===(i=a.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:pr,groupLabel:Ir(pr),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:Tr,supportsMoreColumns:!t.xAccessor,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:mr,groupLabel:Ir(mr),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:Tr,supportsMoreColumns:!t.yAccessor,requiredMinDimensionCount:0,isBreakdownDimension:!0,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:gr,groupLabel:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.heatmap.headingLabel",{defaultMessage:"Value"})},accessors:t.valueAccessor?[r.length&&(a.activeData||"number"!==(null==o||null===(s=o.params)||void 0===s?void 0:s.rangeType))?{columnId:t.valueAccessor,triggerIconType:"colorBy",palette:r.map((({color:e})=>e))}:{columnId:t.valueAccessor,triggerIconType:"none"}]:[],filterOperations:wr,isMetricDimension:!0,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return n===pr&&(s.xAccessor=a),n===mr&&(s.yAccessor=a),n===gr&&(s.valueAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.valueAccessor===a&&delete n.valueAccessor,e.xAccessor===a&&delete n.xAccessor,e.yAccessor===a&&delete n.yAccessor,n},DimensionEditorComponent:t=>Object(v.jsx)(jr,i()({},t,{paletteService:e})),ToolbarComponent:e=>Object(v.jsx)(yr,e),getSupportedLayers:()=>[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,n,i={}){var s,l,r,o,u,c,d,m,g,f;const b=a[t.layerId],h=i[t.layerId];if(!(null==b?void 0:b.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const v=Object(ce.buildExpressionFunction)("heatmap_legend",{isVisible:t.legend.isVisible,position:t.legend.position,legendSize:t.legend.legendSize}),y=Object(ce.buildExpressionFunction)("heatmap_grid",{strokeWidth:t.gridConfig.strokeWidth,strokeColor:t.gridConfig.strokeColor,isCellLabelVisible:t.gridConfig.isCellLabelVisible,isYAxisLabelVisible:t.gridConfig.isYAxisLabelVisible,isYAxisTitleVisible:null!==(s=t.gridConfig.isYAxisTitleVisible)&&void 0!==s&&s,yTitle:t.gridConfig.yTitle,isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible,isXAxisTitleVisible:null!==(l=t.gridConfig.isXAxisTitleVisible)&&void 0!==l&&l,xTitle:t.gridConfig.xTitle}),x=Object(ce.buildExpressionFunction)("heatmap",{xAccessor:null!==(r=t.xAccessor)&&void 0!==r?r:"",yAccessor:null!==(o=t.yAccessor)&&void 0!==o?o:"",valueAccessor:null!==(u=t.valueAccessor)&&void 0!==u?u:"",lastRangeIsRightOpen:null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d||!d.continuity||["above","all"].includes(t.palette.params.continuity),palette:null!==(m=t.palette)&&void 0!==m&&m.params?e.get(p.b).toExpression(kr(null===(g=t.palette)||void 0===g?void 0:g.params)):e.get(or).toExpression(),legend:Object(ce.buildExpression)([v]),gridConfig:Object(ce.buildExpression)([y])});return{type:"expression",chain:[...null!==(f=null==h?void 0:h.chain)&&void 0!==f?f:[],x.toAst()]}},toPreviewExpression(t,a,n={}){var i,s,l,r,o,u;const c=a[t.layerId],d=n[t.layerId];if(!(null==c?void 0:c.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const m=Object(ce.buildExpressionFunction)("heatmap_legend",{isVisible:!1,position:"right"}),g=Object(ce.buildExpressionFunction)("heatmap_grid",{strokeWidth:1,isCellLabelVisible:!1,isYAxisLabelVisible:!1,isYAxisTitleVisible:!1,yTitle:t.gridConfig.yTitle,isXAxisLabelVisible:!1,isXAxisTitleVisible:!1,xTitle:t.gridConfig.xTitle}),f=Object(ce.buildExpressionFunction)("heatmap",{xAccessor:null!==(i=t.xAccessor)&&void 0!==i?i:"",yAccessor:null!==(s=t.yAccessor)&&void 0!==s?s:"",valueAccessor:null!==(l=t.valueAccessor)&&void 0!==l?l:"",legend:Object(ce.buildExpression)([m]),gridConfig:Object(ce.buildExpression)([g]),palette:null!==(r=t.palette)&&void 0!==r&&r.params?e.get(p.b).toExpression(kr(null===(o=t.palette)||void 0===o?void 0:o.params)):e.get(or).toExpression()});return{type:"expression",chain:[...null!==(u=null==d?void 0:d.chain)&&void 0!==u?u:[],f.toAst()]}},getUserMessages(e,{frame:t}){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return[];const a=[];e.xAccessor||a.push({uniqueId:Ft.z,severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})});let n=[];if(null!=e&&e.layerId&&t.activeData&&e.valueAccessor){const a=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(a){const i=a.some((t=>Array.isArray(t[e.valueAccessor]))),s=t.datasourceLayers[e.layerId],l=null==s?void 0:s.getOperationForColumnId(e.valueAccessor);n=i?[{uniqueId:Ft.y,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(v.jsx)("strong",null,null==l?void 0:l.label)}})}]:[]}}return[...a,...n]},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(t,a){var n,i;const s=[];t.xAccessor&&s.push({id:t.xAccessor,name:Ir(pr),dimensionType:"x"}),t.yAccessor&&s.push({id:t.yAccessor,name:Ir(mr),dimensionType:"y"}),t.valueAccessor&&s.push({id:t.valueAccessor,name:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),dimensionType:"value"});const{displayStops:l}=xr(e,(null==a||null===(n=a.activeData)||void 0===n?void 0:n[t.layerId])||(null==a||null===(i=a.activeData)||void 0===i?void 0:i.default),t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{layers:[{layerId:t.layerId,layerType:t.layerType,chartType:t.shape,...this.getDescription(t),dimensions:s,palette:l.length?l.map((({color:e})=>e)):void 0}]}}});class HeatmapVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getHeatmapVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var Cr=a(56),Fr=a(68);const Sr=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.subdued,d:"M1 13a1 1 0 00-1 1v2a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-2a1 1 0 00-1-1H1z"}),Object(v.jsx)("path",{className:h.a.accent,d:"M0 6a1 1 0 011-1h24a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V6z"})),Ar=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.accent,d:"M16 22a1 1 0 01-1-1V4a1 1 0 011-1h4a1 1 0 011 1v17a1 1 0 01-1 1h-4z"}),Object(v.jsx)("path",{className:h.a.subdued,d:"M10 0h2a1 1 0 011 1v20a1 1 0 01-1 1h-2a1 1 0 110-2h1v-3h-1a1 1 0 110-2h1v-3h-1a1 1 0 110-2h1V7h-1a1 1 0 010-2h1V2h-1a1 1 0 010-2z"})),Pr=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.accent,d:"M3 17.9c-.8 0-1.5-.7-1.5-1.5 0-3.1 1.1-6.1 3-8.5 2.6-3.2 6.5-5 10.6-5 3.4 0 6.7 1.3 9.2 3.6.6.6.7 1.5.1 2.1-.6.6-1.5.6-2.1.1-2-1.8-4.5-2.8-7.2-2.8-3.2 0-6.2 1.4-8.2 3.9-1.5 1.9-2.3 4.2-2.3 6.6-.1.9-.7 1.5-1.6 1.5z"}),Object(v.jsx)("g",{className:h.a.subdued},Object(v.jsx)("path",{d:"M24.3 16.7h-2c0-4-3.3-7.3-7.3-7.3-2.2 0-4.3 1-5.7 2.7-1.1 1.3-1.6 2.9-1.6 4.6h-2c0-2.1.7-4.2 2.1-5.8 1.8-2.2 4.4-3.5 7.3-3.5 5-.1 9.2 4.1 9.2 9.3z"}),Object(v.jsx)("path",{d:"M7.5 17.6h1c.6 0 1-.4 1-1s-.4-1-1-1h-1m6.7-6.8v1c0 .6.4 1 1 1s1-.4 1-1v-1m-7.3 3.1.7.7c.4.4 1 .4 1.4 0 .4-.4.4-1 0-1.4l-.7-.7m9.3 0-.7.7c-.4.4-.4 1 0 1.4.4.4 1 .4 1.4 0l.7-.7m1.55 3.7h-1c-.6 0-1 .4-1 1s.4 1 1 1h1"}),Object(v.jsx)("path",{d:"M6.6 17.6h1v-1H5.7c0 .5.4 1 .9 1zm15.8 0h1c.5 0 1-.4 1-1h-1.9v1z"}))),_r=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.accent,d:"M5.9 20.7c-.5 0-1-.2-1.3-.7-1.2-1.9-1.9-4.2-1.9-6.5C2.8 6.8 8.3 1.3 15 1.3c5.3 0 10.2 3.6 11.7 8.7.2.8-.2 1.6-1 1.9-.8.2-1.6-.2-1.9-1C22.7 7 19 4.3 15 4.3c-5.1 0-9.2 4.1-9.2 9.2 0 1.7.5 3.4 1.4 4.9.4.7.2 1.6-.5 2.1-.2.1-.5.2-.8.2z"}),Object(v.jsx)("g",{className:h.a.subdued},Object(v.jsx)("path",{d:"m10 18.6.8-.6-.6-.8-1.5 1.2v.1c.3.4.9.4 1.3.1zm9.2-.6.8.6c.4.3 1 .3 1.3-.2l-1.5-1.2-.6.8z"}),Object(v.jsx)("path",{d:"m21.3 18.5-1.6-1.2c.9-1.1 1.3-2.4 1.3-3.8 0-3.3-2.7-6-6-6s-6 2.7-6 6c0 1.3.4 2.6 1.3 3.7l-1.6 1.2C7.5 17 7 15.3 7 13.5c0-4.4 3.6-8 8-8s8 3.6 8 8c0 1.8-.6 3.6-1.7 5z"}),Object(v.jsx)("path",{d:"m10.7 18.1.7-.5c.4-.3.4-.9.1-1.2-.3-.4-.9-.4-1.2-.1l-.7.5M8.7 13l.9.2c.5.1.9-.2 1-.7s-.2-.9-.7-1l-.9-.2m2.5-3 .4.8c.2.4.7.6 1.2.4.4-.2.6-.7.4-1.2l-.4-.8m3.8 0-.4.8c-.2.4 0 1 .4 1.2s1 0 1.2-.4l.4-.8m2.4 3-.9.2c-.5.1-.8.6-.7 1s.6.8 1 .7l.9-.2m-.8 3.7-.7-.5c-.4-.3-.9-.2-1.2.1-.3.4-.2.9.1 1.2l.7.5"}))),Lr=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{className:h.a.accent,d:"M5.9 20.3c-.5 0-1-.2-1.3-.7-1.2-1.9-1.9-4.2-1.9-6.5C2.8 6.4 8.3.9 15 .9c5.3 0 10.2 3.6 11.7 8.7.2.8-.2 1.6-1 1.9-.8.2-1.6-.2-1.9-1C22.7 6.6 19 3.9 15 3.9c-5.1 0-9.2 4.1-9.2 9.2 0 1.7.5 3.4 1.4 4.9.4.7.2 1.6-.5 2.1-.2.1-.5.2-.8.2z"}),Object(v.jsx)("g",{className:h.a.subdued},Object(v.jsx)("path",{d:"M15 21.1c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm0-14c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6z"}),Object(v.jsx)("path",{d:"M15.9 19.3v-.9c0-.5-.4-.9-.9-.9s-.9.4-.9.9v.9m-3.4-1.7.7-.5c.4-.3.4-.9.1-1.2-.3-.4-.9-.4-1.2-.1l-.7.5m-.9-3.7.9.2c.5.1.9-.2 1-.7s-.2-.9-.7-1l-.9-.2m2.5-3 .4.8c.2.4.7.6 1.2.4.4-.2.6-.7.4-1.2l-.4-.8m3.8 0-.4.8c-.2.4 0 1 .4 1.2s1 0 1.2-.4l.4-.8m2.4 3-.9.1c-.5.1-.8.6-.7 1s.6.8 1 .7l.9-.2m-.8 3.8-.7-.5c-.4-.3-.9-.2-1.2.1-.3.4-.2.9.1 1.2l.7.5"}))),Dr="metric",Rr="goal",Nr={[Cr.GaugeShapes.HORIZONTAL_BULLET]:u.i18n.translate("xpack.lens.gaugeHorizontal.gaugeLabel",{defaultMessage:"Horizontal Bullet"}),[Cr.GaugeShapes.VERTICAL_BULLET]:u.i18n.translate("xpack.lens.gaugeVertical.gaugeLabel",{defaultMessage:"Vertical Bullet"}),[Cr.GaugeShapes.SEMI_CIRCLE]:u.i18n.translate("xpack.lens.gaugeSemiCircle.gaugeLabel",{defaultMessage:"Semi-circular Gauge"}),[Cr.GaugeShapes.ARC]:u.i18n.translate("xpack.lens.gaugeArc.gaugeLabel",{defaultMessage:"Arc Gauge"}),[Cr.GaugeShapes.CIRCLE]:u.i18n.translate("xpack.lens.gaugeCircle.gaugeLabel",{defaultMessage:"Circular Gauge"})},Br=({table:e,state:t,keptLayerIds:a})=>{var n;const i=Boolean(t&&(t.minAccessor||t.maxAccessor||t.goalAccessor||t.metricAccessor)),s=t&&[t.minAccessor,t.maxAccessor,t.goalAccessor,t.metricAccessor].filter(Boolean).length;if(((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||(e=>{var t,a;return"number"!==(null===(t=e.columns)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.operation.dataType)||e.columns.some((e=>e.operation.isBucketed))})(e)||t&&!i&&e.columns.length>1||i&&(s!==e.columns.length||"initial"===e.changeType))return[];const l={state:{...t,shape:null!==(n=null==t?void 0:t.shape)&&void 0!==n?n:Cr.GaugeShapes.HORIZONTAL_BULLET,layerId:e.layerId,layerType:ue.LayerTypes.DATA,ticksPosition:Cr.GaugeTicksPositions.AUTO,labelMajorMode:Cr.GaugeLabelMajorModes.AUTO},title:u.i18n.translate("xpack.lens.gauge.gaugeLabel",{defaultMessage:"Gauge"}),previewIcon:Sr,score:.5,hide:!i||void 0===(null==t?void 0:t.metricAccessor),incomplete:void 0===(null==t?void 0:t.metricAccessor)};return i?[{...l,title:Nr.verticalBullet,previewIcon:Ar,state:{...l.state,...t,shape:Cr.GaugeShapes.VERTICAL_BULLET},score:1},{...l,title:Nr.horizontalBullet,previewIcon:Sr,state:{...l.state,...t,shape:Cr.GaugeShapes.HORIZONTAL_BULLET},score:1},{...l,title:Nr.semiCircle,previewIcon:Pr,state:{...l.state,...t,shape:Cr.GaugeShapes.SEMI_CIRCLE},score:.1},{...l,title:Nr.arc,previewIcon:_r,state:{...l.state,...t,shape:Cr.GaugeShapes.ARC}},{...l,title:Nr.circle,previewIcon:Lr,state:{...l.state,...t,shape:Cr.GaugeShapes.CIRCLE},score:.1}].filter((e=>e.state.shape!==(null==t?void 0:t.shape))):[{...l,state:{...l.state,metricAccessor:e.columns[0].columnId}},{...l,previewIcon:(null==t?void 0:t.shape)===Cr.GaugeShapes.VERTICAL_BULLET?Sr:Ar,state:{...l.state,metricAccessor:e.columns[0].columnId,shape:(null==t?void 0:t.shape)===Cr.GaugeShapes.VERTICAL_BULLET?Cr.GaugeShapes.HORIZONTAL_BULLET:Cr.GaugeShapes.VERTICAL_BULLET}}]};a(332);const zr=Object(s.memo)((e=>{var t,a,n;const{state:i,setState:l,frame:r}=e,o=i.layerId&&(null===(t=r.activeData)||void 0===t||null===(a=t[i.layerId])||void 0===a||null===(n=a.columns.find((e=>e.id===i.metricAccessor)))||void 0===n?void 0:n.name),[c,d]=Object(s.useState)((()=>i.labelMinor?"custom":"none")),{inputValue:p,handleInputChange:m}=Object(je.a)({onChange:l,value:i});return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(M.i,{handleClose:()=>{d(p.labelMinor?"custom":"none")},title:u.i18n.translate("xpack.lens.gauge.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton",panelClassName:"lnsGaugeToolbar__popover"},Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),fullWidth:!0},Object(v.jsx)(M.l,{header:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),dataTestSubj:"lnsToolbarGaugeLabelMajor",label:p.labelMajor||"",mode:p.labelMajorMode,placeholder:o||"",hasAutoOption:!0,handleChange:e=>{m({...p,labelMajor:e.label,labelMajorMode:e.mode})}})),Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"})},Object(v.jsx)(M.l,{header:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"}),dataTestSubj:"lnsToolbarGaugeLabelMinor",label:p.labelMinor||"",mode:c,handleChange:e=>{m({...p,labelMinor:"none"===e.mode?"":e.label}),d(e.mode)}}))))))})),Vr={...M.o,rangeMin:0,rangeMax:100,name:"gray",steps:4,maxSteps:5},Gr=e=>{const{minAccessor:t,maxAccessor:a,goalAccessor:n,metricAccessor:i}=null!=e?e:{};if(i||a||n||i)return{min:t,max:a,goal:n,metric:i}};function qr(e){var t;const{state:a,setState:n,frame:i,accessor:s,isInlineEditing:r}=e;if((null==a?void 0:a.metricAccessor)!==s)return null;const o=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[c]=(null==o?void 0:o.rows)||[];if(null==s||null==c||!Object(de.a)(o,s))return null;const d=Gr(a),m="palette"===(null==a?void 0:a.colorMode),g={min:Object(Fr.getMinValue)(c,d),max:Object(Fr.getMaxValue)(c,d)},b=(null==a?void 0:a.palette)||{type:"palette",name:Vr.name,params:{...Vr,continuity:"all",colorStops:void 0,stops:void 0,rangeMin:g.min,rangeMax:3*g.max/4}},h=Object(M.m)(e.paletteService,b,g);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.gauge.dynamicColoring.label",{defaultMessage:"Band colors"}),className:"lnsDynamicColoringRow"},Object(v.jsx)(f.EuiSwitch,{"data-test-subj":"lnsDynamicColoringGaugeSwitch",compressed:!0,label:"",showLabel:!1,checked:m,onChange:e=>{const{checked:t}=e.target,i=t?{palette:{...b,params:{...b.params,stops:h}},ticksPosition:Cr.GaugeTicksPositions.BANDS,colorMode:Cr.GaugeColorModes.PALETTE}:{ticksPosition:Cr.GaugeTicksPositions.AUTO,colorMode:Cr.GaugeColorModes.NONE};n({...a,...i})}})),m&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(v.jsx)(M.f,{palette:h.map((({color:e})=>e)),siblingRef:e.panelRef,isInlineEditing:r},Object(v.jsx)(ge,{palettes:e.paletteService,activePalette:b,dataBounds:g,setPalette:e=>{e.name!==p.b&&e.params&&e.params.rangeMin!==g.min&&(e.params.rangeMin=g.min),n({...a,palette:e})}}))),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressedSwitch",fullWidth:!0,label:Object(v.jsx)(ze.a,{position:"top",tooltipContent:u.i18n.translate("xpack.lens.shared.ticksPositionOptionsTooltip",{defaultMessage:"Places ticks on each band border instead of distributing them evenly"}),condition:!0,delay:"regular"},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),Object(v.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(v.jsx)(f.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),"data-test-subj":"lens-toolbar-gauge-ticks-position-switch",showLabel:!1,checked:a.ticksPosition===Cr.GaugeTicksPositions.BANDS,onChange:()=>{n({...a,ticksPosition:a.ticksPosition===Cr.GaugeTicksPositions.BANDS?Cr.GaugeTicksPositions.AUTO:Cr.GaugeTicksPositions.BANDS})}}))))}a(337);const $r=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),Hr=e=>!e.isBucketed&&"number"===e.dataType,Ur=e=>Hr(e)&&!e.isStaticValue,Wr={[Cr.GaugeShapes.HORIZONTAL_BULLET]:{id:Cr.GaugeShapes.HORIZONTAL_BULLET,icon:Sr,label:Nr.horizontalBullet,groupLabel:$r,showExperimentalBadge:!0,sortOrder:10},[Cr.GaugeShapes.VERTICAL_BULLET]:{id:Cr.GaugeShapes.VERTICAL_BULLET,icon:Ar,label:Nr.verticalBullet,groupLabel:$r,showExperimentalBadge:!0,sortOrder:10},[Cr.GaugeShapes.SEMI_CIRCLE]:{id:Cr.GaugeShapes.SEMI_CIRCLE,icon:Pr,label:Nr.semiCircle,groupLabel:$r,showExperimentalBadge:!0,sortOrder:9},[Cr.GaugeShapes.ARC]:{id:Cr.GaugeShapes.ARC,icon:_r,label:Nr.arc,groupLabel:$r,showExperimentalBadge:!0,sortOrder:8},[Cr.GaugeShapes.CIRCLE]:{id:Cr.GaugeShapes.CIRCLE,icon:Lr,label:Nr.circle,groupLabel:$r,showExperimentalBadge:!0,sortOrder:7}},Xr=(e,t,a,n,i={})=>{var s,l,r,o,u,c;const d=a[t.layerId],m=i[t.layerId];if(!(null==d?void 0:d.getTableSpec().map((({columnId:e})=>e)))||!t.metricAccessor)return null;const g=Object(ce.buildExpressionFunction)("gauge",{metric:t.metricAccessor,min:t.minAccessor,max:t.maxAccessor,goal:t.goalAccessor,shape:null!==(s=t.shape)&&void 0!==s?s:Cr.GaugeShapes.HORIZONTAL_BULLET,colorMode:null!==(l=null==t?void 0:t.colorMode)&&void 0!==l?l:"none",palette:null!==(r=t.palette)&&void 0!==r&&r.params?e.get(p.b).toExpression((f=t.palette.params,{...f,colors:((null==f?void 0:f.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==f?void 0:f.name)?((null==f?void 0:f.stops)||[]).map((({stop:e})=>e)):[],reverse:!1})):void 0,ticksPosition:null!==(o=t.ticksPosition)&&void 0!==o?o:"auto",labelMinor:t.labelMinor,labelMajor:t.labelMajor,labelMajorMode:null!==(u=t.labelMajorMode)&&void 0!==u?u:"auto"});var f;return{type:"expression",chain:[...null!==(c=null==m?void 0:m.chain)&&void 0!==c?c:[],g.toAst()]}},Yr=({paletteService:e})=>({id:"lnsGauge",visualizationTypes:[Wr[Cr.GaugeShapes.HORIZONTAL_BULLET],Wr[Cr.GaugeShapes.VERTICAL_BULLET],Wr[Cr.GaugeShapes.SEMI_CIRCLE],Wr[Cr.GaugeShapes.ARC],Wr[Cr.GaugeShapes.CIRCLE]],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.metricAccessor,delete t.minAccessor,delete t.maxAccessor,delete t.goalAccessor,delete t.palette,delete t.colorMode,t},getDescription:e=>Wr[e.shape],switchVisualizationType:(e,t)=>({...t,shape:e}),initialize:(e,t,a)=>t||{layerId:e(),layerType:ue.LayerTypes.DATA,shape:Cr.GaugeShapes.HORIZONTAL_BULLET,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0,ticksPosition:"auto",labelMajorMode:"auto"},getSuggestions:Br,getConfiguration({state:t,frame:a}){var n,i,s;const l=null!=t&&t.layerId?null==a||null===(n=a.activeData)||void 0===n||null===(i=n[null==t?void 0:t.layerId])||void 0===i||null===(s=i.rows)||void 0===s?void 0:s[0]:void 0,{palette:r,metricAccessor:o,accessors:c}=Qr(t,e,a.activeData);return{groups:[{enableFormatSelector:!0,layerId:t.layerId,groupId:Dr,groupLabel:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:o?[r?{columnId:o,triggerIconType:"colorBy",palette:r}:{columnId:o,triggerIconType:"none"}]:[],filterOperations:Ur,supportsMoreColumns:!o,requiredMinDimensionCount:1,dataTestSubj:"lnsGauge_metricDimensionPanel",enableDimensionEditor:!0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"min",groupLabel:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.minAccessor?[{columnId:t.minAccessor}]:[],filterOperations:Hr,supportsMoreColumns:!t.minAccessor,dataTestSubj:"lnsGauge_minDimensionPanel",prioritizedOperation:"min",suggestedValue:()=>t.metricAccessor?Object(Fr.getMinValue)(l,c):void 0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"max",groupLabel:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.maxAccessor?[{columnId:t.maxAccessor}]:[],filterOperations:Hr,supportsMoreColumns:!t.maxAccessor,dataTestSubj:"lnsGauge_maxDimensionPanel",prioritizedOperation:"max",suggestedValue:()=>t.metricAccessor?Object(Fr.getMaxValue)(l,c):void 0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:Rr,groupLabel:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.goalAccessor?[{columnId:t.goalAccessor}]:[],filterOperations:Hr,supportsMoreColumns:!t.goalAccessor,requiredMinDimensionCount:0,dataTestSubj:"lnsGauge_goalDimensionPanel"}]}},getDisplayOptions:()=>({noPadding:!0}),setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return"min"===n&&(s.minAccessor=a),"max"===n&&(s.maxAccessor=a),n===Rr&&(s.goalAccessor=a),n===Dr&&(s.metricAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.goalAccessor===a&&delete n.goalAccessor,e.minAccessor===a&&delete n.minAccessor,e.maxAccessor===a&&delete n.maxAccessor,e.metricAccessor===a&&(delete n.metricAccessor,delete n.palette,delete n.colorMode,n.ticksPosition="auto"),n},DimensionEditorComponent:t=>Object(v.jsx)(qr,i()({},t,{paletteService:e})),ToolbarComponent:e=>Object(v.jsx)(zr,e),getSupportedLayers(e,t){var a,n,i;const s=null!=e&&e.layerId?null==t||null===(a=t.activeData)||void 0===a||null===(n=a[null==e?void 0:e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0]:void 0,l=Gr(e),r=Object(Fr.getMinValue)(s,l),o=Object(Fr.getMaxValue)(s,l),c=Object(Fr.getGoalValue)(s,l);return[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.gauge.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"min",columnId:Object(kt.a)(),staticValue:r},{groupId:"max",columnId:Object(kt.a)(),staticValue:o},{groupId:"goal",columnId:Object(kt.a)(),staticValue:c}]:void 0}]},getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i={})=>Xr(e,t,a,0,i),toPreviewExpression:(t,a,n={})=>Xr(e,t,a,0,n),getUserMessages(e,{frame:t}){var a,n,i;const{maxAccessor:s,minAccessor:l,goalAccessor:r,metricAccessor:o}=e;if(!(s||l||r||o))return[];if(!o)return[];const c=null===(a=t.activeData)||void 0===a||null===(n=a[e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0];if(!c)return[];const d=((e,t)=>{if(!e||!t)return[];const a=[],n=null==t?void 0:t.minAccessor,i=null==t?void 0:t.maxAccessor,s=n?Object(Fr.getValueFromAccessor)(n,e):void 0,l=i?Object(Fr.getValueFromAccessor)(i,e):void 0;return null!=l&&null!=s&&void 0!==s&&(l<s&&a.push({uniqueId:Ft.v,severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:n},{id:"dimensionButton",dimensionId:i}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderMinGreaterMax",{defaultMessage:"Minimum value may not be greater than maximum value"}),longMessage:""}),l===s&&a.push({uniqueId:Ft.x,severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:n},{id:"dimensionButton",dimensionId:i}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderEqual",{defaultMessage:"Minimum and maximum values may not be equal"}),longMessage:""})),a})(c,e);if(d.length)return d;const p=c[o],m=s&&c[s],g=l&&c[l],f=r&&c[r],b=[];return"number"==typeof g&&(g>p&&b.push({uniqueId:Ft.w,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minValueGreaterMetricShortMessage",defaultMessage:"Minimum value is greater than metric value."})}),g>f&&b.push({uniqueId:Ft.u,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minimumValueGreaterGoalShortMessage",defaultMessage:"Minimum value is greater than goal value."})})),"number"==typeof m&&(p>m&&b.push({uniqueId:Ft.t,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.gaugeVisualization.metricValueGreaterMaximumShortMessage",defaultMessage:"Metric value is greater than maximum value."})}),"number"==typeof f&&f>m&&b.push({uniqueId:Ft.s,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.gaugeVisualization.goalValueGreaterMaximumShortMessage",defaultMessage:"Goal value is greater than maximum value."})})),b},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(t,a){const{palette:n,accessors:i}=Qr(t,e,null==a?void 0:a.activeData),s=[];return null!=i&&i.metric&&s.push({id:i.metric,name:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),dimensionType:"metric"}),null!=i&&i.max&&s.push({id:i.max,name:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),dimensionType:"max"}),null!=i&&i.min&&s.push({id:i.min,name:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),dimensionType:"min"}),null!=i&&i.goal&&s.push({id:i.goal,name:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),dimensionType:"goal"}),{layers:[{layerId:t.layerId,layerType:t.layerType,chartType:t.shape,...this.getDescription(t),dimensions:s,palette:n}]}}});function Qr(e,t,a){var n,i,s,l;const r=Boolean("none"!==e.colorMode&&(null===(n=e.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)),o=null===(s=function(e,t){if(t&&e)return t[e]||t.default}(null==e?void 0:e.layerId,a))||void 0===s||null===(l=s.rows)||void 0===l?void 0:l[0],{metricAccessor:u}=null!=e?e:{},c=Gr(e);let d;if(null!=o&&null!=u&&null!=(null==e?void 0:e.palette)&&r){const a={min:Object(Fr.getMinValue)(o,c),max:Object(Fr.getMaxValue)(o,c)};d=Object(M.m)(t,null==e?void 0:e.palette,a).map((({color:e})=>e))}return{metricAccessor:u,accessors:c,palette:d}}class gauge_GaugeVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getGaugeVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:(e=>{const t=e=>(e?hn()(e).hex()+"80":"000000").toUpperCase(),a=e=>({...e,getCategoricalColor:(a,n,i)=>t(e.getCategoricalColor(a,n,i)),getCategoricalColors:(a,n)=>e.getCategoricalColors(a,n).map(t)});return{...e,get:t=>a(e.get(t)),getAll:()=>e.getAll().map((e=>a(e)))}})(await n.palettes.getPalettes()),theme:e.theme})}))}}const Kr=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",i()({xmlns:"http://www.w3.org/2000/svg",width:"30",height:"22",viewBox:"0 0 30 22"},a),e?Object(v.jsx)("title",{id:t}):null,Object(v.jsx)("path",{d:"M19 5a2 2 0 0 1 2-2h4a2 2 0 1 1 0 4h-4a2 2 0 0 1-2-2ZM2 11a2 2 0 0 1 2-2h8a2 2 0 1 1 0 4H4a2 2 0 0 1-2-2Zm15 4a2 2 0 1 0 0 4h6a2 2 0 1 0 0-4h-6Z",className:h.a.accent}),Object(v.jsx)("path",{d:"M6 4a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2H6Zm8 0a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2Zm2 7a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H17a1 1 0 0 1-1-1Zm-8 5a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2H8Z",className:h.a.subdued}));var Zr=a(69);const Jr=u.i18n.translate("xpack.lens.tagcloud.label",{defaultMessage:"Tag cloud"}),eo={maxFontSize:72,minFontSize:18,orientation:Zr.Orientation.SINGLE,showLabel:!0};function to({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];const[s,l]=Object(pa.partition)(e.columns,(e=>e.operation.isBucketed));return 1!==s.length||1!==l.length?[]:s.filter((e=>"date"!==e.operation.dataType)).map((t=>({previewIcon:Kr,title:Jr,score:"string"===t.operation.dataType?.4:.2,state:{layerId:e.layerId,tagAccessor:t.columnId,valueAccessor:l[0].columnId,...eo,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:void 0:Object(Ct.getColorMappingDefaults)()}})))}function ao(e){const[t,a]=Object(s.useState)([e.minFontSize,e.maxFontSize]),[,n]=fn()((()=>{e.onChange(t[0],t[1])}),150,[t]);return Object(s.useEffect)((()=>()=>{n()}),[n]),Object(v.jsx)(f.EuiDualRange,{id:"tagCloudFontSizeSlider",min:1,max:120,step:1,value:t,onChange:e=>{a(e)},showLabels:!0,compressed:!0,"aria-label":u.i18n.translate("xpack.lens.label.tagcloud.fontSizeLabel",{defaultMessage:"Font size"})})}const no=[{value:Zr.Orientation.SINGLE,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.single",{defaultMessage:"Single"})},{value:Zr.Orientation.RIGHT_ANGLED,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.rightAngled",{defaultMessage:"Right angled"})},{value:Zr.Orientation.MULTIPLE,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.multiple",{defaultMessage:"Multiple"})}];function io(e){return Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(v.jsx)(M.i,{title:u.i18n.translate("xpack.lens.tagcloud.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.fontSizeLabel",{defaultMessage:"Font size"})},Object(v.jsx)(ao,{minFontSize:e.state.minFontSize,maxFontSize:e.state.maxFontSize,onChange:(t,a)=>{e.setState({...e.state,minFontSize:t,maxFontSize:a})}})),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.orientationLabel",{defaultMessage:"Orientation"})},Object(v.jsx)(f.EuiSelect,{options:no,value:e.state.orientation,onChange:t=>{e.setState({...e.state,orientation:t.target.value})},compressed:!0})),Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.showLabel",{defaultMessage:"Show label"})},Object(v.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.label.tagcloud.showLabel",{defaultMessage:"Show label"}),showLabel:!1,checked:e.state.showLabel,onChange:t=>{e.setState({...e.state,showLabel:t.target.checked})},compressed:!0}))))))}function so({state:e,frame:t,setState:a,panelRef:n,isDarkMode:i,paletteService:l,isInlineEditing:r}){var o,c,p;const{inputValue:m,handleInputChange:g}=Object(je.a)({value:e,onChange:a}),[b,h]=Object(s.useState)(!!e.colorMapping),y=Object(Ht.d)(i,e.colorMapping),x=null===(o=t.activeData)||void 0===o?void 0:o[e.layerId],j=Object(Vn.a)(null!==(c=null==x?void 0:x.rows)&&void 0!==c?c:[],e.tagAccessor),O=Object(s.useCallback)((e=>{g({...m,colorMapping:e})}),[m,g]),I=Object(s.useCallback)((e=>{g({...m,palette:e,colorMapping:void 0})}),[m,g]),T=e.colorMapping;return Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"},fullWidth:!0},Object(v.jsx)(M.f,{palette:y,siblingRef:n,title:b?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:r},Object(v.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(v.jsx)(f.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(v.jsx)(f.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:b,onChange:({target:{checked:e}})=>{Object(d.d)("color_mapping_switch_"+(e?"enabled":"disabled")),O(e?{...Ht.a}:void 0),h(e)}})),Object(v.jsx)(f.EuiFlexItem,null,T||b?Object(v.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:i,model:null!==(p=e.colorMapping)&&void 0!==p?p:{...Ht.a},onModelUpdate:e=>O(e),palettes:Ya.a,data:{type:"categories",categories:j},specialTokens:Ln.a}):Object(v.jsx)(M.g,{palettes:l,activePalette:e.palette,setPalette:e=>{I(e)}}))))))}const lo="tags",ro="metric",oo=({paletteService:e,kibanaTheme:t})=>({id:"lnsTagcloud",visualizationTypes:[{id:"lnsTagcloud",icon:Kr,label:Jr,groupLabel:u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"})}],getVisualizationTypeId:()=>"lnsTagcloud",clearLayer(e){const t={...e,...eo};return delete t.tagAccessor,delete t.valueAccessor,delete t.palette,t},getLayerIds:e=>[e.layerId],getDescription:()=>({icon:Kr,label:Jr}),getSuggestions:to,getSuggestionFromConvertToLensContext:({suggestions:e,context:t})=>e.length?{...e[0],visualizationState:{...e[0].visualizationState,...t.configuration}}:void 0,getMainPalette:e=>{if(e)return e.colorMapping?{type:"colorMapping",value:e.colorMapping}:e.palette?{type:"legacyPalette",value:e.palette}:void 0},triggers:[oe.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{layerId:e(),layerType:ue.LayerTypes.DATA,...eo,colorMapping:"colorMapping"===(null==a?void 0:a.type)?a.value:Object(Ct.getColorMappingDefaults)()},getConfiguration({state:a}){const n=!!a.colorMapping;let i=[];var s,l;return n?t.theme$.subscribe({next(e){i=Object(Ht.d)(e.darkMode,a.colorMapping)}}).unsubscribe():i=e.get((null===(s=a.palette)||void 0===s?void 0:s.name)||"default").getCategoricalColors(10,null===(l=a.palette)||void 0===l?void 0:l.params),{groups:[{groupId:lo,groupLabel:u.i18n.translate("xpack.lens.tagcloud.tagLabel",{defaultMessage:"Tags"}),layerId:a.layerId,accessors:a.tagAccessor?[{columnId:a.tagAccessor,triggerIconType:"colorBy",palette:i}]:[],supportsMoreColumns:!a.tagAccessor,filterOperations:e=>e.isBucketed,enableDimensionEditor:!0,required:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsTagcloud_tagDimensionPanel"},{groupId:ro,groupLabel:u.i18n.translate("xpack.lens.tagcloud.metricValueLabel",{defaultMessage:"Metric"}),isMetricDimension:!0,layerId:a.layerId,accessors:a.valueAccessor?[{columnId:a.valueAccessor}]:[],supportsMoreColumns:!a.valueAccessor,filterOperations:e=>!e.isBucketed&&"number"===e.dataType,enableDimensionEditor:!0,required:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsTagcloud_valueDimensionPanel"}]}},getSupportedLayers:()=>[{type:ue.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.tagcloud.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return ue.LayerTypes.DATA},toExpression:(t,a,n,i={})=>{if(!t.tagAccessor||!t.valueAccessor)return null;const s=i[t.layerId];return{type:"expression",chain:[...s?s.chain:[],Object(ce.buildExpressionFunction)("tagcloud",{bucket:t.tagAccessor,metric:t.valueAccessor,maxFontSize:t.maxFontSize,minFontSize:t.minFontSize,orientation:t.orientation,palette:Object(ce.buildExpression)([t.palette?Object(ce.buildExpressionFunction)("theme",{variable:"palette",default:[e.get(t.palette.name).toExpression(t.palette.params)]}):Object(ce.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),showLabel:t.showLabel,colorMapping:t.colorMapping?JSON.stringify(t.colorMapping):void 0}).toAst()]}},toPreviewExpression:(t,a,n={})=>{if(!t.tagAccessor||!t.valueAccessor)return null;const i=n[t.layerId];return{type:"expression",chain:[...i?i.chain:[],Object(ce.buildExpressionFunction)("tagcloud",{bucket:t.tagAccessor,isPreview:!0,metric:t.valueAccessor,maxFontSize:18,minFontSize:4,orientation:t.orientation,palette:Object(ce.buildExpression)([t.palette?Object(ce.buildExpressionFunction)("theme",{variable:"palette",default:[e.get(t.palette.name).toExpression(t.palette.params)]}):Object(ce.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),showLabel:!1,colorMapping:t.colorMapping?JSON.stringify(t.colorMapping):void 0}).toAst()]}},setDimension({columnId:e,groupId:t,prevState:a}){const n={};return t===lo?n.tagAccessor=e:t===ro&&(n.valueAccessor=e),{...a,...n}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.tagAccessor===a?delete n.tagAccessor:e.valueAccessor===a&&delete n.valueAccessor,n},DimensionEditorComponent(a){const n=S()(t.theme$,{darkMode:!1}).darkMode;return a.groupId===lo?Object(v.jsx)(so,{isDarkMode:n,paletteService:e,state:a.state,setState:a.setState,frame:a.frame,panelRef:a.panelRef,isInlineEditing:a.isInlineEditing}):null},ToolbarComponent:e=>Object(v.jsx)(io,e),getTelemetryEventsOnSave:(e,t)=>Hn(null==e?void 0:e.colorMapping,null==t?void 0:t.colorMapping)});class TagcloudVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getTagcloudVisualization:t}=await Promise.resolve().then(a.bind(null,682));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var uo=a(691),co=a(92),po=a(38),mo=a(78),go=a(138);const fo="esql";async function bo(e){if(crypto.subtle){const t=new TextEncoder,a=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("")}{const{sha256:t}=await a.e(14).then(a.bind(null,679));return t(e)}}async function ho(e,t){var a,n,i;const s=await t.create({title:e,type:fo,id:await bo(`esql-${e}`)});return e&&"date"===(null==s||null===(a=s.fields)||void 0===a||null===(n=a.getByName)||void 0===n||null===(i=n.call(a,"@timestamp"))||void 0===i?void 0:i.type)&&(s.timeFieldName="@timestamp"),s}var vo=a(60);function yo(e){var t;const{ast:a}=Object(vo.getAstAndSyntaxErrors)(e),n=a.find((({name:e})=>["from","metrics"].includes(e))),i=(null!==(t=null==n?void 0:n.args)&&void 0!==t?t:[]).filter((e=>"index"===e.sourceType));return null==i?void 0:i.map((e=>e.text)).join(",")}var xo=a(2);const jo=new Map,Oo=e=>e[Object(po.getAggregateQueryMode)(e)].replaceAll("\n","").trim(),Io=(e,t)=>{const a=Oo(e);jo.set(a,t)},Mo=e=>{var t;const a=Oo(e);return null!==(t=jo.get(a))&&void 0!==t?t:[]},To=(e,t)=>{const a=t?Mo(t):[];return ko(e,a)},wo=5,ko=(e,t)=>{const a=[...e.filter((e=>{if(null==t?void 0:t.some((t=>t.name===(null==e?void 0:e.fieldName))))return e})),...t.map((e=>({columnId:e.id,fieldName:e.id,meta:e.meta})))],n=[];return a.filter((e=>!n.includes(e.columnId)&&(n.push(e.columnId),!0)))};const Eo=e=>{var t;return"number"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)},Co=e=>!Eo(e);function Fo(e,t){const a=null==e?void 0:e.some(Eo);return!a||a&&"number"===t}function So(e,t){const a=null==e?void 0:e.some(Eo);return!a||e.length>=wo||a&&"number"===t}var Ao=a(235),Po=a(177),_o=a(54),Lo=a(139);const Do=({core:e,dataViews:t,updateIndexPatterns:a,replaceIndexPattern:n,uiActions:i,contextDataViewSpec:s})=>{const l=t=>e.notifications.toasts.addError(t,{title:u.i18n.translate("xpack.lens.indexPattern.dataViewLoadError",{defaultMessage:"Error loading data view"})});return{updateDataViewsState:a,loadIndexPatterns:e=>Object(Lo.e)({dataViews:t,...e}),replaceDataViewId:async e=>{const a=await t.create({...e.toSpec(),id:Object(kt.a)()});s&&s.id!==e.id&&t.clearInstanceCache(e.id);const l=await Object(Lo.e)({dataViews:t,patterns:[a.id],cache:{}});n(l[a.id],e.id,{applyImmediately:!0});const r=i.getTrigger(_o.UPDATE_FILTER_REFERENCES_TRIGGER),o=i.getAction(_o.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:e.id,toDataView:a.id,usedDataViews:[]})},ensureIndexPattern:e=>Object(Lo.c)({onError:l,dataViews:t,...e}),getDefaultIndex:()=>e.uiSettings.get("defaultIndex")}};var Ro=a(99);function No({attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:l,framePublicAPI:r,hasPadding:o,setIsInlineFlyoutVisible:u,getUserMessages:c,onlyAllowSwitchToSubtypes:d}){var p;const m=Object(co.W)(),{euiTheme:g}=Object(f.useEuiTheme)(),{visualization:b}=Object(co.X)((e=>e.lens)),h=n[null!==(p=b.activeId)&&void 0!==p?p:e.visualizationType],y=Object(s.useMemo)((()=>Do({dataViews:a.dataViews,uiActions:a.uiActions,core:t,updateIndexPatterns:(e,t)=>{m(Object(co.U)(e))},replaceIndexPattern:(e,t,a)=>{m(Object(Ro.i)({newIndexPattern:e,oldId:t}))}})),[t,m,a.dataViews,a.uiActions]),x={framePublicAPI:r,datasourceMap:i,visualizationMap:n,core:t,dataViews:a.dataViews,uiActions:a.uiActions,hideLayerHeader:"textBased"===l,onlyAllowSwitchToSubtypes:d,indexPatternService:y,setIsInlineFlyoutVisible:u,getUserMessages:c};return Object(v.jsx)("div",{css:Object(v.css)("padding:",o?g.size.s:0,";","")},Object(v.jsx)(f.EuiSpacer,{size:"xs"}),Object(v.jsx)(Ao.a,{activeVisualization:h,framePublicAPI:r}),Object(v.jsx)(f.EuiSpacer,{size:"m"}),Object(v.jsx)(Po.a,x))}const Bo=({children:e,isInlineFlyoutVisible:t,isScrollable:a,displayFlyoutHeader:n,language:i,isNewPanel:s,isSaveable:r,onCancel:o,navigateToLensEditor:c,onApply:d})=>Object(v.jsx)(l.a.Fragment,null,t&&n&&Object(v.jsx)(f.EuiFlyoutHeader,{hasBorder:!0,css:Object(v.css)("pointer-events:auto;background-color:",Me.euiThemeVars.euiColorEmptyShade,";",""),"data-test-subj":"editFlyoutHeader"},Object(v.jsx)(f.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiTitle,{size:"xs","data-test-subj":"inlineEditingFlyoutLabel"},Object(v.jsx)("h2",null,s?u.i18n.translate("xpack.lens.config.createVisualizationLabel",{defaultMessage:"Create {lang} visualization",values:{lang:i}}):u.i18n.translate("xpack.lens.config.editVisualizationLabel",{defaultMessage:"Edit {lang} visualization",values:{lang:i}}),Object(v.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.config.experimentalLabelDataview",{defaultMessage:"Technical preview, inline editing currently offers limited configuration options"})},Object(v.jsx)(f.EuiBetaBadge,{label:"Lab",iconType:"beaker",size:"s",css:Object(v.css)("margin-left:",Me.euiThemeVars.euiSizeXS,";","")}))))),c&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiLink,{onClick:c,"data-test-subj":"navigateToLensEditorLink"},u.i18n.translate("xpack.lens.config.editLinkLabel",{defaultMessage:"Edit in Lens"}))))),Object(v.jsx)(f.EuiFlyoutBody,{className:"lnsEditFlyoutBody",css:Object(v.css)("overflow-y:auto;padding-left:",Me.euiThemeVars.euiFormMaxWidth,";margin-left:-",Me.euiThemeVars.euiFormMaxWidth,";pointer-events:none;.euiFlyoutBody__overflow{-webkit-mask-image:none;padding-left:inherit;margin-left:inherit;",!a&&"\n                overflow-y: hidden;\n              ",">*{pointer-events:auto;}}.euiFlyoutBody__overflowContent{padding:0;block-size:100%;}","")},e),t&&Object(v.jsx)(f.EuiFlyoutFooter,null,Object(v.jsx)(f.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiButtonEmpty,{id:"lnsCancelEditOnFlyFlyout",onClick:o,flush:"left","aria-label":u.i18n.translate("xpack.lens.config.cancelFlyoutAriaLabel",{defaultMessage:"Cancel applied changes"}),"data-test-subj":"cancelFlyoutButton"},Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.config.cancelFlyoutLabel",defaultMessage:"Cancel"}))),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiButton,{onClick:d,fill:!0,"aria-label":u.i18n.translate("xpack.lens.config.applyFlyoutAriaLabel",{defaultMessage:"Apply changes"}),disabled:!Boolean(s)&&!r,iconType:"check","data-test-subj":"applyFlyoutButton"},Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.config.applyFlyoutLabel",defaultMessage:"Apply and close"}))))));var zo=a(660);const Vo=({filters:e,query:t,suggestion:a,dataView:n})=>{var i;const s=Object.assign({},null==a?void 0:a.datasourceState),l=Object.assign({},null==a?void 0:a.visualizationState),r=a&&a.datasourceState?{[a.datasourceId]:{...s}}:{formBased:{}},o=l;return{title:null!==(i=null==a?void 0:a.title)&&void 0!==i?i:u.i18n.translate("visualizationUtils.config.suggestion.title",{defaultMessage:"New suggestion"}),references:[],state:{datasourceStates:r,filters:e,query:t,visualization:o,...n&&n.id&&!n.isPersisted()&&{adHocDataViews:{[n.id]:n.toMinimalSpec()}}},visualizationType:a?a.visualizationId:"lnsXY"}};var Go=a(116);let qo=function(e){return e.XY="XY",e.Bar="Bar",e.Line="Line",e.Area="Area",e.Donut="Donut",e.Heatmap="Heat map",e.Treemap="Treemap",e.Tagcloud="Tag cloud",e.Waffle="Waffle",e.Table="Table",e}({});const $o=({context:e,dataView:t,datasourceMap:a,visualizationMap:n,excludedVisualizations:i,preferredChartType:s})=>{const l=e;if(!a||!n||!t.id)return;const r={formBased:{isLoading:!1,state:{layers:{}}},textBased:{isLoading:!1,state:{layers:{},indexPatternRefs:[],initialContext:l}}},o=t.id,u={indexPatterns:{[o]:t},indexPatternRefs:[]},c=(null==n?void 0:n[Object.keys(n)[0]])||null,d=Object(Go.a)({datasourceMap:a,datasourceStates:r,visualizationMap:n,activeVisualization:c,visualizationState:void 0,visualizeTriggerFieldContext:e,dataViews:u});if(!d.length)return[];const p=null==s?void 0:s.toLowerCase(),m=d.find((e=>"lnsXY"===e.visualizationId));if(m&&p&&["area","line"].includes(p)){var g,f;const e=null===(g=n[m.visualizationId])||void 0===g||null===(f=g.switchVisualizationType)||void 0===f?void 0:f.call(g,p,null==m?void 0:m.visualizationState);return[{...m,visualizationState:e}]}if(d.length>1&&s){const e=d.find((e=>e.title.includes(s)||e.visualizationId.includes(s)));if(e)return[e]}const b=d[0];return b.incomplete||null!=i&&i.includes(b.visualizationId)?[]:[b,...Object(Go.a)({datasourceMap:a,datasourceStates:{textBased:{isLoading:!1,state:b.datasourceState}},visualizationMap:n,activeVisualization:n[b.visualizationId],visualizationState:b.visualizationState,dataViews:u}).filter((e=>!e.hide&&"lnsLegacyMetric"!==e.visualizationId))].sort(((e,t)=>"lnsXY"===e.visualizationId?-1:1))},Ho=async(e,t,a,n,i,s,l)=>{try{var r;const s=yo(e.esql),o=i.find((e=>e.name===s)),u=o?await t.dataViews.create(o):await ho(s,t.dataViews),c=await Object(zo.a)({esqlQuery:"esql"in e?e.esql:"",search:t.data.search.search,signal:null==l?void 0:l.signal}),d={dataViewSpec:null==u?void 0:u.toSpec(!1),fieldName:"",textBasedColumns:c,query:e},p=null!==(r=$o({context:d,dataView:u,datasourceMap:a,visualizationMap:n}))&&void 0!==r?r:[];if(!p.length)return;const m=p[0];return Vo({filters:[],query:e,suggestion:m,dataView:u})}catch(e){s([e])}};var Uo=a(200),Wo=a(132),Xo={name:"eeu0j5",styles:"padding:2px"};function Yo({attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,updatePanelState:o,updateSuggestion:c,setCurrentAttributes:p,closeFlyout:m,saveByRef:g,savedObjectId:b,updateByRefInput:h,output$:y,lensAdapters:x,navigateToLensEditor:j,displayFlyoutHeader:O,canEditTextBasedQuery:I,isNewPanel:M,deletePanel:T,hidesSuggestions:w,onApplyCb:k,onCancelCb:E,hideTimeFilterInfo:C}){var F,S,A;const P=Object(f.useEuiTheme)(),_=Object(s.useRef)(e),L=Object(s.useRef)(x),D=Object(s.useRef)(e.state.query),[R,N]=Object(s.useState)(e.state.query),[B,z]=Object(s.useState)(),[V,G]=Object(s.useState)(!0),[q,$]=Object(s.useState)(!0),[H,U]=Object(s.useState)(!1),[W,X]=Object(s.useState)(!1),[Y,Q]=Object(s.useState)(!1),K=e.state.datasourceStates[r],Z=i[r],{datasourceStates:J,visualization:ee,isLoading:te,annotationGroups:ae,searchSessionId:ne}=Object(co.X)((e=>e.lens)),ie=n[null!==(F=ee.activeId)&&void 0!==F?F:e.visualizationType],se=Object(co.X)((e=>Object(co.B)(e,i)));se.absDateRange=Object(Ct.getAbsoluteDateRange)(a.data.query.timefilter.timefilter);const le=Object(s.useMemo)((()=>Z.getLayers(K)),[Z,K]),re=Object(co.W)();Object(s.useEffect)((()=>{const e=null==y?void 0:y.subscribe((()=>{var e,t;const a={},n=null===(e=L.current)||void 0===e||null===(t=e.tables)||void 0===t?void 0:t.tables,[i]=Object.values(n||{});i&&(U(i.columns.length>=wo),le.forEach((e=>{a[e]=i})),re(Object(co.m)({activeData:a})))}));return()=>null==e?void 0:e.unsubscribe()}),[re,y,le]);const oe=Object(s.useMemo)((()=>{var t;const a=_.current,s=!(!J[r].state||!a.state.datasourceStates[r])&&i[r].isEqual(a.state.datasourceStates[r],a.references,J[r].state,e.references),l=ee.state,o=null===(t=n[a.visualizationType])||void 0===t?void 0:t.isEqual;return!(o?(()=>{try{return o(a.state.visualization,a.references,l,e.references,ae)}catch(e){return!1}})():Object(pa.isEqual)(l,a.state.visualization))||!s}),[e.references,r,i,J,n,ae,ee.state]),ue=Object(s.useCallback)((()=>{const e=_.current;if(oe){if(e.visualizationType===ee.activeId){var t,a;const n=i[r].injectReferencesToLayers?null===(t=i[r])||void 0===t||null===(a=t.injectReferencesToLayers)||void 0===a?void 0:a.call(t,e.state.datasourceStates[r],e.references):e.state.datasourceStates[r];null==o||o(n,e.state.visualization)}else null==c||c(e);b&&(null==h||h(b))}M&&T&&T(),null==E||E(),null==m||m()}),[oe,M,T,m,ee.activeId,b,i,r,o,c,h,E]),ce=Object(s.useCallback)((()=>{var t;const a=Object.fromEntries(Object.entries(J).map((([e,t])=>[e,t.state]))),n=Object(Ct.extractReferencesFromState)({activeDatasources:Object.keys(J).reduce(((e,t)=>({...e,[t]:i[t]})),{}),datasourceStates:J,visualizationState:ee.state,activeVisualization:ie}),s={...e,state:{...e.state,visualization:ee.state,datasourceStates:a},references:n,visualizationType:ee.activeId};b&&(null==g||g(s),null==h||h(b));const l=_.current.visualizationType===ee.activeId?_.current.state.visualization:void 0,r=null===(t=ie.getTelemetryEventsOnSave)||void 0===t?void 0:t.call(ie,ee.state,l);r&&r.length&&Object(d.d)(r),null==k||k(s),null==m||m()}),[ee.activeId,b,m,k,J,ee.state,ie,e,i,g,h]),{getUserMessages:de}=Object(Wo.c)({coreStart:t,framePublicAPI:se,activeDatasourceId:r,datasourceState:J[r],datasource:i[r],dispatch:re,visualization:ie,visualizationType:ee.activeId,visualizationState:ee}),pe=Object.values(null!==(S=e.state.adHocDataViews)&&void 0!==S?S:{}),me=Object(s.useCallback)((async(e,t)=>{const s=await Ho(e,a,i,n,pe,z,t);s&&(null==p||p(s),z([]),null==c||c(s)),Q(!1)}),[a,i,n,pe,p,c]),ge=Object(s.useMemo)((()=>!!oe&&(!(!ee.state||!ee.activeId)&&(de(["visualization"],{severity:"error"}).every((e=>e.uniqueId===Ct.EXPRESSION_BUILD_ERROR_ID))?Boolean(Object(go.a)({visualization:ie,visualizationState:ee.state,datasourceMap:i,datasourceStates:J,datasourceLayers:se.datasourceLayers,indexPatterns:se.dataViews.indexPatterns,dateRange:se.dateRange,nowInstant:a.data.nowProvider.get(),searchSessionId:ne})):void 0))),[oe,ie,i,J,se.dataViews.indexPatterns,se.dateRange,se.datasourceLayers,ne,a.data.nowProvider,ee.activeId,ee.state,de]),fe=Object(po.isOfAggregateQueryType)(R)?Object(po.getAggregateQueryMode)(R):void 0;return te?null:!I&&w?Object(v.jsx)(Bo,{isInlineFlyoutVisible:V,displayFlyoutHeader:O,onCancel:ue,navigateToLensEditor:j,onApply:ce,isScrollable:!0,isNewPanel:M,isSaveable:ge},Object(v.jsx)(No,{onlyAllowSwitchToSubtypes:!0,getUserMessages:de,attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,hasPadding:!0,framePublicAPI:se,setIsInlineFlyoutVisible:G})):Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Bo,{isInlineFlyoutVisible:V,displayFlyoutHeader:O,onCancel:ue,navigateToLensEditor:j,onApply:ce,language:fe?Object(po.getLanguageDisplayName)(fe):"",isSaveable:ge,isScrollable:!1,isNewPanel:M},Object(v.jsx)(f.EuiFlexGroup,{css:Object(v.css)("block-size:100%;.euiFlexItem,.euiAccordion,.euiAccordion__triggerWrapper,.euiAccordion__childWrapper{min-block-size:0;}.euiAccordion{display:flex;flex:1;flex-direction:column;}.euiAccordion__childWrapper{",Object(f.euiScrollBarStyles)(P)," overflow-y:auto!important;pointer-events:none;padding-left:",Me.euiThemeVars.euiFormMaxWidth,";margin-left:-",Me.euiThemeVars.euiFormMaxWidth,";>*{pointer-events:auto;}.euiAccordion-isOpen &{block-size:auto!important;flex:1;}}.lnsIndexPatternDimensionEditor-advancedOptions{.euiAccordion__childWrapper{flex:none;overflow:hidden!important;}}",""),direction:"column",gutterSize:"none"},Object(po.isOfAggregateQueryType)(R)&&I&&Object(v.jsx)(f.EuiFlexItem,{grow:!1,"data-test-subj":"InlineEditingESQLEditor"},Object(v.jsx)(mo.TextBasedLangEditor,{query:R,onTextLangQueryChange:e=>{N(e),D.current=e},expandCodeEditor:e=>{},isCodeEditorExpanded:!0,detectTimestamp:Boolean(null==pe||null===(A=pe[0])||void 0===A?void 0:A.timeFieldName),hideTimeFilterInfo:C,errors:B,warning:H?u.i18n.translate("xpack.lens.config.configFlyoutCallout",{defaultMessage:"Displaying a limited portion of the available fields. Add more from the configuration panel."}):void 0,hideMinimizeButton:!0,editorIsInline:!0,hideRunQueryText:!0,onTextLangQuerySubmit:async(e,t)=>{e&&(Q(!0),await me(e,t))},isDisabled:!1,allowQueryCancellation:!0,isLoading:Y})),Object(v.jsx)(f.EuiFlexItem,{grow:!!q&&1,css:Object(v.css)(".euiAccordion__childWrapper{flex:",q?1:"none",";}padding:0 ",Me.euiThemeVars.euiSize,";","")},Object(v.jsx)(f.EuiAccordion,{id:"layer-configuration",buttonContent:Object(v.jsx)(f.EuiTitle,{size:"xxs",css:Xo},Object(v.jsx)("h5",null,u.i18n.translate("xpack.lens.config.visualizationConfigurationLabel",{defaultMessage:"Visualization configuration"}))),buttonProps:{paddingSize:"m"},initialIsOpen:q,forceState:q?"open":"closed",onToggle:e=>{e&&W&&X(!e),$(!q)}},Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(No,{attributes:e,getUserMessages:de,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,framePublicAPI:se,setIsInlineFlyoutVisible:G}),Object(v.jsx)(f.EuiSpacer,null)))),Object(v.jsx)(f.EuiFlexItem,{grow:!!W&&1,"data-test-subj":"InlineEditingSuggestions",css:Object(v.css)("border-top:",Me.euiThemeVars.euiBorderThin,";border-bottom:",Me.euiThemeVars.euiBorderThin,";padding-left:",Me.euiThemeVars.euiSize,";padding-right:",Me.euiThemeVars.euiSize,";.euiAccordion__childWrapper{flex:",W?1:"none",";}","")},Object(v.jsx)(Uo.a,{ExpressionRenderer:a.expressions.ReactExpressionRenderer,datasourceMap:i,visualizationMap:n,frame:se,core:t,nowProvider:a.data.nowProvider,showOnlyIcons:!0,wrapSuggestions:!0,isAccordionOpen:W,toggleAccordionCb:e=>{!e&&q&&$(e),X(!W)}})))))}var Qo=a(21);function Ko(){return Object(v.jsx)(f.EuiOverlayMask,null,Object(v.jsx)(f.EuiLoadingSpinner,null))}const Zo=e=>t=>a=>n=>{const{datasourceStates:i,visualization:s,activeDatasourceId:l}=t.getState().lens;a(n);const{datasourceStates:r,visualization:o,activeDatasourceId:u}=t.getState().lens;if(l!==u||!Object(pa.isEqual)(i[l].state,r[u].state)||!Object(pa.isEqual)(s,o)){if(co.h.match(n)||co.g.match(n))return;e(r[u].state,o.state,o.activeId)}};var Jo={name:"1hi3csz",styles:"clip-path:polygon(-100% 0, 100% 0, 100% 100%, -100% 100%)"};async function eu(e,t,n,i){const{getLensServices:l,getLensAttributeService:r}=await Promise.resolve().then(a.bind(null,682)),o=await l(e,t,r(e,t));return({attributes:a,updatePanelState:l,updateSuggestion:r,closeFlyout:d,wrapInFlyout:p,datasourceId:m,panelId:g,savedObjectId:b,output$:h,lensAdapters:y,updateByRefInput:x,navigateToLensEditor:j,displayFlyoutHeader:O,canEditTextBasedQuery:I,isNewPanel:M,deletePanel:T,hidesSuggestions:w,onApplyCb:k,onCancelCb:E,hideTimeFilterInfo:C})=>{if(!o||!i||!n)return Object(v.jsx)(Ko,null);const[F,S]=Object(s.useState)(a),A=Object(s.useCallback)((async e=>{const t=new Qo.a(o.contentManagement);await t.save({...e,savedObjectId:b,type:Wt.DOC_TYPE})}),[b]),P=F.state.datasourceStates[m],_={lensServices:o,datasourceMap:i,visualizationMap:n,initialContext:P&&"initialContext"in P?P.initialContext:void 0},L=Object(co.k)(_,void 0,Zo(l));L.dispatch(Object(co.j)({initialInput:{attributes:F,id:null!=g?g:Object(kt.a)()},inlineEditing:!0}));const D={attributes:F,updatePanelState:l,updateSuggestion:r,closeFlyout:d,datasourceId:m,coreStart:e,startDependencies:t,visualizationMap:n,output$:h,lensAdapters:y,datasourceMap:i,saveByRef:A,savedObjectId:b,updateByRefInput:x,navigateToLensEditor:j,displayFlyoutHeader:O,canEditTextBasedQuery:I,hidesSuggestions:w,setCurrentAttributes:S,isNewPanel:M,deletePanel:T,onApplyCb:k,onCancelCb:E,hideTimeFilterInfo:C};return R=Object(v.jsx)(Ta.Provider,{store:L},Object(v.jsx)(c.a,e,Object(v.jsx)(Cl.KibanaContextProvider,{services:o},Object(v.jsx)(uo.a,null,Object(v.jsx)(Yo,D))))),p?Object(v.jsx)(f.EuiFlyout,{"data-test-subj":"lnsEditOnFlyFlyout",type:"push",ownFocus:!0,paddingSize:"m",onClose:()=>{null==d||d()},"aria-labelledby":u.i18n.translate("xpack.lens.config.editLabel",{defaultMessage:"Edit configuration"}),size:"s",hideCloseButton:!0,css:Jo},R):R;var R}}var tu=a(205);function au(e){return"number"===e?u.i18n.translate("lensFormulaDocs.number",{defaultMessage:"number"}):"string"===e?u.i18n.translate("lensFormulaDocs.string",{defaultMessage:"string"}):"boolean"===e?u.i18n.translate("lensFormulaDocs.boolean",{defaultMessage:"boolean"}):""}const nu={add:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with `+` symbol.\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol.\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.min",{defaultMessage:"min"}),type:au("number"),alternativeWhenMissing:"pick_max"},{name:u.i18n.translate("lensFormulaDocs.tinymath.max",{defaultMessage:"max"}),type:au("number"),alternativeWhenMissing:"pick_min"}],help:u.i18n.translate("lensFormulaDocs.tinymath.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.base",{defaultMessage:"base"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.base",{defaultMessage:"base"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})},pick_max:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.maxFunction.markdown",{defaultMessage:"\nFinds the maximum value between two numbers.\n\nExample: Find the maximum between two fields averages\n`pick_max(average(bytes), average(memory))`\n        "})},pick_min:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.minFunction.markdown",{defaultMessage:"\nFinds the minimum value between two numbers.\n\nExample: Find the minimum between two fields averages\n`pick_min(average(bytes), average(memory))`\n    "})},defaults:{section:"math",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.value",{defaultMessage:"value"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.defaultValue",{defaultMessage:"default"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.defaultFunction.markdown",{defaultMessage:"\nReturns a default numeric value when value is null.\n\nExample: Return -1 when a field has no data\n`defaults(average(bytes), -1)`\n"})},lt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],outputType:au("boolean"),help:u.i18n.translate("lensFormulaDocs.tinymath.ltFunction.markdown",{defaultMessage:"\nPerforms a lower than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<` symbol.\n\nExample: Returns true if the average of bytes is lower than the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lt(average(bytes), 1000)`\n    "})},gt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],outputType:au("boolean"),help:u.i18n.translate("lensFormulaDocs.tinymath.gtFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>` symbol.\n\nExample: Returns true if the average of bytes is greater than the average amount of memory\n`average(bytes) > average(memory)`\n\nExample: `gt(average(bytes), 1000)`\n    "})},eq:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],outputType:au("boolean"),help:u.i18n.translate("lensFormulaDocs.tinymath.eqFunction.markdown",{defaultMessage:"\nPerforms an equality comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `==` symbol.\n\nExample: Returns true if the average of bytes is exactly the same amount of average memory\n`average(bytes) == average(memory)`\n\nExample: `eq(sum(bytes), 1000000)`\n    "})},lte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],outputType:au("boolean"),help:u.i18n.translate("lensFormulaDocs.tinymath.lteFunction.markdown",{defaultMessage:"\nPerforms a lower than or equal comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<=` symbol.\n\nExample: Returns true if the average of bytes is lower than or equal to the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lte(average(bytes), 1000)`\n    "})},gte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],outputType:au("boolean"),help:u.i18n.translate("lensFormulaDocs.tinymath.gteFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>=` symbol.\n\nExample: Returns true if the average of bytes is greater than or equal to the average amount of memory\n`average(bytes) >= average(memory)`\n\nExample: `gte(average(bytes), 1000)`\n    "})},ifelse:{section:"comparison",positionalArguments:[{name:u.i18n.translate("lensFormulaDocs.tinymath.condition",{defaultMessage:"condition"}),type:au("boolean")},{name:u.i18n.translate("lensFormulaDocs.tinymath.left",{defaultMessage:"left"}),type:au("number")},{name:u.i18n.translate("lensFormulaDocs.tinymath.right",{defaultMessage:"right"}),type:au("number")}],help:u.i18n.translate("lensFormulaDocs.tinymath.ifElseFunction.markdown",{defaultMessage:"\nReturns a value depending on whether the element of condition is true or false.\n\nExample: Average revenue per customer but in some cases customer id is not provided which counts as additional customer\n`sum(total)/(unique_count(customer_id) + ifelse( count() > count(kql='customer_id:*'), 1, 0))`\n    "})}},iu=/[^0-9A-Za-z._@\[\]/]/;function su(e){const{namedArgument:t,variable:a,function:n}=Object(pa.groupBy)(e,(e=>Object(pa.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:a||[],functions:n||[]}}function lu(e){return Object(pa.isObject)(e)?"function"!==e.type?e.value:e.name:e}function ru(e,t,a,n){if(a&&e.filterable){const e="kql"in t?"kql":"lucene";t[e]?a.query&&(t[e]=`(${a.query}) AND (${t[e]})`):t["kuery"===a.language?"kql":a.language]=a.query}return n&&e.canReduceTimeRange&&!t.reducedTimeRange&&(t.reducedTimeRange=n),t}function ou(e,t=[]){const a=(e.operationParams||[]).reduce(((e,{name:t,type:a})=>(e[t]=a,e)),{});return t.reduce(((t,{name:n,value:i})=>(a[n]&&(t[n]=i),!e.filterable||"kql"!==n&&"lucene"!==n||(t[n]=i),e.shiftable&&"shift"===n&&(t[n]=i),e.canReduceTimeRange&&"reducedTimeRange"===n&&(t.reducedTimeRange=i),t)),{})}function uu(e){return Object(pa.isObject)(e)&&"function"===e.type&&nu[e.name]}function cu(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(cu)}function du(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}const pu=au("number");function mu(e){return[e.location].filter(Ct.nonNullable)}function gu(e,t){if(!Object(pa.isObject)(e))return au(typeof e);if("function"===e.type){var a;if(nu[e.name])return null!==(a=nu[e.name].outputType)&&void 0!==a?a:pu;if(t[e.name])return pu}}const fu=(e,t)=>{const a=e.split("\n").join(""),n=/(kql|lucene)/,i=a.split(",").filter((e=>n.test(e))),s=Object.keys(t).some((e=>a.includes(e)));if(0===i.length||!s)return;const l=i.flatMap((e=>e.split("count").filter((e=>n.test(e))))),[r,o]=Object(pa.partition)(l,(e=>/kql/.test(e)));for(const e of r){const t=bu(e,"kql");if(t)return{id:"invalidQuery",meta:{language:"kql"},message:t}}for(const e of o){const t=bu(e,"lucene");if(t)return{id:"invalidQuery",meta:{language:"lucene"},message:t}}},bu=(e,t)=>{const[,...a]=e.split("="),n=(a||[""]).join(""),i=n.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(n))&&"''"!==i)return u.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})},hu=({value:e,name:t,text:a},n)=>{if("kql"!==t&&"lucene"!==t)return;const i=bu(a,t);if(i)return i;try{return void("kql"===t?Object(po.toElasticsearchQuery)(Object(po.fromKueryExpression)(e),n):Object(po.luceneStringToDsl)(e))}catch(e){return e.message}};function vu({id:e,meta:t},a){switch(e){case"invalidQuery":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.invalidQuery",{defaultMessage:"Invalid {language} query, please check the syntax and retry",values:{language:t.language}})};case"wrongFirstArgument":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:t.operation,type:t.type,argument:t.argument}})};case"shouldNotHaveField":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:t.operation}})};case"cannotAcceptParameter":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:t.operation}})};case"missingParameter":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:t.operation,params:t.params}})};case"wrongTypeParameter":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:t.operation,params:t.params}})};case"wrongTypeArgument":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongTypeArgument",{defaultMessage:"The {name} argument for the operation {operation} in the Formula is of the wrong type: {type} instead of {expectedType}",values:{operation:t.operation,name:t.name,type:t.type,expectedType:t.expectedType}})};case"duplicateArgument":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:t.operation,params:t.params}})};case"missingField":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{missingFieldCount, plural, one {Field} other {Fields}} {missingFieldList} not found",values:{missingFieldCount:t.fieldList.length,missingFieldList:t.fieldList.join(", ")}})};case"missingOperation":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:t.operationLength,operationsList:t.operationsList}})};case"fieldWithNoOperation":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:t.field}})};case"failedParsing":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:t.expression}})};case"tooManyArguments":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:t.operation}})};case"missingMathArgument":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:t.operation,count:t.count,params:t.params}})};case"tooManyQueries":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"})};case"tooManyFirstArguments":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:t.operation,text:t.text,type:t.type,supported:t.supported||1}})};case"wrongArgument":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:t.operation,text:t.text,type:t.type}})};case"wrongReturnedType":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula",values:{text:t.text}})};case"filtersTypeConflict":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaOperationFiltersTypeConflicts",{defaultMessage:'The Formula filter of type "{outerType}" is not compatible with the inner filter of type "{innerType}" from the {operation} operation',values:{operation:t.operation,outerType:t.outerType,innerType:t.innerType}})};case"useAlternativeFunction":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.formulaUseAlternative",{defaultMessage:"The operation {operation} in the Formula is missing the {params} argument: use the {alternativeFn} operation instead",values:{operation:t.operation,params:t.params,alternativeFn:t.alternativeFn}})};case An.REASON_IDS.missingTimerange:return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.absoluteMissingTimeRange",{defaultMessage:"Invalid time shift. No time range found as reference"})};case An.REASON_IDS.invalidDate:return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.absoluteInvalidDate",{defaultMessage:"Invalid time shift. The date is not of the correct format"})};case An.REASON_IDS.shiftAfterTimeRange:return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.absoluteAfterTimeRange",{defaultMessage:"Invalid time shift. The provided date is after the current time range"})};case An.REASON_IDS.notAbsoluteTimeShift:return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.notAbsoluteTimeShift",{defaultMessage:"Invalid time shift."})};case"invalidTimeShift":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"})};case"invalidReducedTimeRange":return{id:e,meta:t,locations:a,message:u.i18n.translate("xpack.lens.indexPattern.invalidReducedTimeRange",{defaultMessage:"Invalid reduced time range. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"})}}}function yu(e,t){let a;try{a=Object(tu.parse)(e)}catch(a){const n=fu(e,t);return n?{error:{...n,locations:[]}}:{error:vu({id:"failedParsing",meta:{expression:e}},[])}}return{root:a}}function xu(e,t,a,n,i,s){return[...ju(e,t,a,n),...Mu(e),...Tu(e,t,a,n,s,i)]}function ju(e,t,a,n){const i=[],s=function(e,t){const a=(n=e,function e(t){return Object(pa.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(Ct.nonNullable):[]}(n)).filter((e=>!uu(e)&&!t[e.name]));var n;return{names:Array.from(new Set(a.map((({name:e})=>e)))),locations:a.map((({location:e})=>e)).filter(Ct.nonNullable)}}(e,n);s.names.length&&i.push(vu({id:"missingOperation",meta:{operationLength:s.names.length,operationsList:s.names.join(", ")}},s.locations));const l=cu(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e]));l.length&&i.push({...vu({id:"missingField",meta:{fieldList:[...new Set(l.map((({value:e})=>e)))]}},l.map((({location:e})=>e)))});const r=function(e,t){const a=[];return Object(pa.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&a.push(vu({id:"fieldWithNoOperation",meta:{field:e.value}},[e.location])),a}(e,new Set(l.map((({value:e})=>e))));return[...i,...r]}function Ou(e,t,a,n){const i=[],{conflicts:s,innerType:l,outerType:r}=function(e,t=[],a){const n=ou(e,t);if(!e.filterable||!a||!n.kql&&!n.lucene)return{conflicts:!1};const i="kuery"===a.language?"kql":a.language;return{conflicts:!(i in n),innerType:n.lucene?"lucene":"kql",outerType:i}}(t,a,n);return s&&l&&r&&i.push(vu({id:"filtersTypeConflict",meta:{operation:e.name,innerType:l,outerType:r}},mu(e))),i}function Iu(e,t,a,n,i){const s=[],l=function(e,t=[]){return Eu(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,a);l.length&&s.push(vu({id:"missingParameter",meta:{operation:e.name,params:l.map((({name:e})=>e)).join(", ")}},mu(e)));const r=function(e,t=[]){return Eu(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,a);r.length&&s.push(vu({id:"wrongTypeParameter",meta:{operation:e.name,params:r.map((({name:e})=>e)).join(", ")}},mu(e)));const o=function(e=[]){const t=Object.create(null);for(const{name:a}of e){const e=t[a]||0;t[a]=e+1}const a=Object.keys(t);return e.length>a.length?a.filter((e=>t[e]>1)):[]}(a);o.length&&s.push(vu({id:"duplicateArgument",meta:{operation:e.name,params:o.join(", ")}},mu(e)));const u=function(e,t,a){const n=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const a=hu(e,t);a&&n.push({id:"invalidQuery",message:a,meta:{language:e.name},locations:[e.location]})}if("shift"===e.name&&"invalid"===Object(An.parseTimeShift)(e.value))if(Object(An.isAbsoluteTimeShift)(e.value)){const t=Object(An.validateAbsoluteTimeShift)(e.value,a?{from:a.fromDate,to:a.toDate}:void 0);t&&n.push(vu({id:t},[e.location]))}else n.push(vu({id:"invalidTimeShift"},[e.location]));if("reducedTimeRange"===e.name){const t=Object(An.parseTimeShift)(e.value||"");"invalid"!==t&&"previous"!==t||n.push(vu({id:"invalidReducedTimeRange"},[e.location]))}})),n}(a,n,i);s.push(...u);const c=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(a);return c&&s.push(vu({id:"tooManyQueries"},mu(e))),s}function Mu(e){var t;return Object(pa.isObject)(e)&&"function"===e.type&&e.text&&((null===(t=nu[e.name])||void 0===t?void 0:t.outputType)||pu)!==pu?[vu({id:"wrongReturnedType",meta:{text:e.text}},mu(e))]:[]}function Tu(e,t,a,n,i,s){const l=cu(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e])),r=new Set(l.map((({value:e})=>e))),o=null==s?void 0:s.filter;return function e(t){if(!Object(pa.isObject)(t)||"function"!==t.type)return[];const s=n[t.name],l=[],{namedArguments:c,functions:d,variables:p}=su(t.args),[m]=(null==t?void 0:t.args)||[];if(s){if("field"===s.input){if(Su(m,"variable")){const e=Pu(t,p,{isFieldOperation:!0,firstArg:m,returnedType:ku(s,a,m)});e.length&&l.push(...e)}else uu(m)?l.push(vu({id:"wrongFirstArgument",meta:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"}},mu(t))):Cu(t)&&l.push(vu({id:"wrongFirstArgument",meta:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:lu(m)||u.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})}},mu(t)));const e=_u(t,d,0,{isFieldOperation:!0,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});if(e.length&&l.push(...e),!wu(s)&&c.length)l.push(vu({id:"cannotAcceptParameter",meta:{operation:t.name}},mu(t)));else{const e=Iu(t,s,c,a,i),n=Ou(t,s,c,o);l.push(...e,...n)}return l}if("fullReference"===s.input){const e=Boolean(!Su(m,"function")||uu(m)&&Au(m,r,n).length);e&&l.push(vu({id:"wrongFirstArgument",meta:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:lu(m)||u.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})}},mu(t)));const g=_u(t,d,s.requiredReferences?s.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(g.length&&l.push(...g),!wu(s)&&c.length)l.push(vu({id:"cannotAcceptParameter",meta:{operation:t.name}},mu(t)));else{const e=Pu(t,p,{isFieldOperation:!1,firstArg:m,returnedType:void 0}),n=Iu(t,s,c,a,i),r=Ou(t,s,c,o);l.push(...e,...n,...r)}}return l.concat(e(d[0]))}return l.push(...Au(t,r,n)),null!=d&&d.length?l.concat(d.flatMap((t=>e(t)))):l}(e)}function wu(e){return Boolean((e.operationParams||[]).length)||e.filterable}function ku(e,t,a){var n;const i=cu(a);if(1!==i.length)return;const s=t.getFieldByName(lu(i[0]));return s?null===(n=e.getPossibleOperationForField(s))||void 0===n?void 0:n.scale:void 0}function Eu(e,t=[]){var a;const n=ou(e,t),i=[...null!==(a=e.operationParams)&&void 0!==a?a:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:a})=>({name:e,isMissing:!(e in n),isCorrectType:typeof n[e]===t,isRequired:a})))}function Cu(e){return Fu(e.name)}function Fu(e){return!["count"].includes(e)}function Su(e,t){return Object(pa.isObject)(e)&&e.type===t}function Au(e,t,a){const n=function(e){return function e(t){return Object(pa.isObject)(t)&&"function"===t.type&&uu(t)?[t,...t.args.flatMap(e)].filter(Ct.nonNullable):[]}(e)}(e),i=[];return n.forEach((e=>{const{positionalArguments:n}=nu[e.name],s=n.filter((({optional:e})=>!e));if(!e.args.length)return i.push(vu({id:"missingMathArgument",meta:{operation:e.name,count:s.length,params:s.map((({name:e})=>e)).join(", ")}},mu(e)));if(e.args.length>n.length&&i.push(vu({id:"tooManyArguments",meta:{operation:e.name}},mu(e))),n.some(((a,n)=>{const i=e.args[n];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&i.push(vu({id:"shouldNotHaveField",meta:{operation:e.name}},mu(e))),s.length>1&&e.args.length<s.length){const t=s.filter(((t,a)=>null==e.args[a])),[a,n]=Object(pa.partition)(t,(e=>null!=e.alternativeWhenMissing));if(n.length&&i.push(vu({id:"missingMathArgument",meta:{operation:e.name,count:s.length-e.args.length,params:n.map((({name:e})=>e)).join(", ")}},mu(e))),a.length){const[t]=a;i.push(vu({id:"useAlternativeFunction",meta:{operation:e.name,params:t.name,alternativeFn:t.alternativeWhenMissing}},mu(e)))}}const l=n.map((({type:t},n)=>{const i=e.args[n];if(null!=i){const e=gu(i,a);if(e&&e!==t)return n}})).filter(Ct.nonNullable);for(const t of l){const s=e.args[t];i.push(vu({id:"wrongTypeArgument",meta:{operation:e.name,name:n[t].name,type:gu(s,a)||pu,expectedType:n[t].type||""}},mu(e)))}})),i}function Pu(e,t,{isFieldOperation:a,firstArg:n,returnedType:i}){const s=t.filter((e=>Su(e,"variable")&&!uu(e))),l=[];var r;return a&&(s.length>1||1===s.length&&s[0]!==n)&&l.push(vu({id:"tooManyFirstArguments",meta:{operation:e.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:s.map((({text:e})=>e)).join(", ")}},mu(e))),a&&1===s.length&&s[0]===n&&"ordinal"===i&&l.push(vu({id:"wrongReturnedType",meta:{text:null!==(r=e.text)&&void 0!==r?r:`${e.name}(${lu(n)})`}},mu(e))),!a&&s.length&&l.push(vu({id:"wrongArgument",meta:{operation:e.name,text:s.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})}},mu(e))),l}function _u(e,t,a=0,{isFieldOperation:n,firstArgValidation:i,type:s}){const l=[],[r,o]=Object(pa.partition)(t,(e=>!uu(e)));return r.length>a&&(n?l.push(vu({id:"wrongArgument",meta:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})}},mu(e))):l.push(vu({id:"tooManyFirstArguments",meta:{operation:e.name,type:s,supported:a,text:r.map((({text:e})=>e)).join(", ")}},mu(e)))),n&&(!i&&o.length||o.length>1)&&l.push(vu({id:"wrongArgument",meta:{operation:e.name,type:s,text:o.map((({text:e})=>e)).join(", ")}},mu(e))),l}function Lu(e){return null!=e}function Du(e){if(!e)return"";const t=e.props;return t&&"markdownContent"in t?String(t.markdownContent):t&&"children"in t&&Array.isArray(t.children)?t.children.reduce(((e,t)=>{const a=l.a.Children.toArray(t).filter(Lu);return Object(s.isValidElement)(t)&&a.length>0?e.concat(Du(t)):e}),""):""}function Ru({language:e,sections:t,searchInDescription:a,linkToDocumentation:n}){const[i,r]=Object(s.useState)(),o=Object(s.useRef)({});Object(s.useEffect)((()=>{i&&o.current[i]&&o.current[i].scrollIntoView()}),[i]);const[c,d]=Object(s.useState)(""),p=c.trim().toLocaleLowerCase(),m=null==t?void 0:t.groups.map((e=>{const t=e.items.filter((e=>{var t;return!p||e.label.toLocaleLowerCase().includes(p)||a&&(null===(t=Du(e.description))||void 0===t?void 0:t.toLocaleLowerCase().includes(p))}));return{...e,items:t}})).filter((e=>e.items.length>0||!p||e.label.toLocaleLowerCase().includes(p)));return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiPopoverTitle,{className:"documentation__docsHeader",paddingSize:"m","data-test-subj":"language-documentation-title"},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none",responsive:!1,alignItems:"center",justifyContent:"spaceBetween"},Object(v.jsx)(f.EuiFlexItem,{grow:!1},u.i18n.translate("languageDocumentationPopover.header",{defaultMessage:"{language} reference",values:{language:e}})),n&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiLink,{external:!0,href:n,target:"_blank"},u.i18n.translate("languageDocumentationPopover.documentationLinkLabel",{defaultMessage:"View full documentation"}))))),Object(v.jsx)(f.EuiFlexGroup,{className:"documentation__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(v.jsx)(f.EuiFlexItem,{className:"documentation__docsSidebar",grow:1},Object(v.jsx)(f.EuiFlexGroup,{className:"documentation__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{className:"documentation__docsSearch",grow:!1},Object(v.jsx)(f.EuiFieldSearch,{value:c,onChange:e=>{d(e.target.value)},"data-test-subj":"language-documentation-navigation-search",placeholder:u.i18n.translate("languageDocumentationPopover.searchPlaceholder",{defaultMessage:"Search"})})),Object(v.jsx)(f.EuiFlexItem,{className:"documentation__docsNav"},null==m?void 0:m.map(((e,t)=>Object(v.jsx)("nav",{className:"documentation__docsNavGroup",key:e.label},Object(v.jsx)(f.EuiTitle,{size:"xxs","data-test-subj":"language-documentation-navigation-title"},Object(v.jsx)("h6",null,Object(v.jsx)(f.EuiLink,{className:"documentation__docsNavGroupLink",color:"text",onClick:()=>{r(e.label)}},Object(v.jsx)(f.EuiHighlight,{search:c},e.label)))),e.items.length?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiListGroup,{gutterSize:"none"},e.items.map((e=>Object(v.jsx)(f.EuiListGroupItem,{key:e.label,label:Object(v.jsx)(f.EuiHighlight,{search:c},e.label),size:"s",onClick:()=>{r(e.label)}}))))):null)))))),Object(v.jsx)(f.EuiFlexItem,{className:"documentation__docsText",grow:2},Object(v.jsx)(f.EuiText,{size:"s"},Object(v.jsx)("section",{className:"documentation__docsTextIntro",ref:e=>{var a;e&&null!=t&&null!==(a=t.groups)&&void 0!==a&&a.length&&(o.current[t.groups[0].label]=e)}},null==t?void 0:t.initialSection),null==t?void 0:t.groups.slice(1).map(((e,a)=>Object(v.jsx)("section",{className:"documentation__docsTextGroup",key:e.label,ref:t=>{t&&(o.current[e.label]=t)}},Object(v.jsx)("h2",null,e.label),Object(v.jsx)("p",null,e.description),null==t?void 0:t.groups[a+1].items.map((e=>Object(v.jsx)("article",{className:"documentation__docsTextItem",key:e.label,ref:t=>{t&&(o.current[e.label]=t)}},e.description))))))))))}a(439);const Nu=l.a.memo(Ru);function Bu({language:e,sections:t,buttonProps:a,searchInDescription:n,linkToDocumentation:l}){const[r,o]=Object(s.useState)(!1),c=Object(s.useCallback)((()=>{o(!r)}),[r]);return Object(v.jsx)(f.EuiOutsideClickDetector,{onOutsideClick:()=>{o(!1)}},Object(v.jsx)(f.EuiPopover,{panelClassName:"documentation__docs--overlay",panelPaddingSize:"none",isOpen:r,closePopover:()=>o(!1),button:Object(v.jsx)(f.EuiToolTip,{position:"top",content:u.i18n.translate("languageDocumentationPopover.tooltip",{defaultMessage:"{lang} reference",values:{lang:e}})},Object(v.jsx)(f.EuiButtonIcon,i()({iconType:"iInCircle",onClick:c},a)))},Object(v.jsx)(Nu,{language:e,sections:t,searchInDescription:n,linkToDocumentation:l})))}const zu=l.a.memo(Bu);var Vu=a(437),Gu=a.n(Vu),qu=a(61),$u=a(79);const Hu=({ariaLabelContent:e,markdownContent:t,children:a,className:n,onRender:l,openLinksInNewTab:r=!0,defaultValue:o="",placeholder:u="",height:c="full",readOnly:d=!1,enableTooltipSupport:p=!1,validateLinks:m=!1,enableSoftLineBreaks:g=!1,...b})=>{const[h,y]=Object(s.useState)(o);Object(s.useEffect)((()=>{null==l||l()}),[l]);const x=Array();p||x.push("tooltip"),m||x.push("linkValidator"),g&&x.push("lineBreaks");const{parsingPlugins:j,processingPlugins:O,uiPlugins:I}=Object(f.getDefaultEuiMarkdownPlugins)({exclude:x});var M;return O[1][1].components.a=e=>Object(v.jsx)(f.EuiLink,i()({},e,{target:"_blank"})),d?Object(v.jsx)(f.EuiMarkdownFormat,{textSize:"relative",color:"inherit",className:n,"aria-label":null!=e?e:"markdown component",parsingPluginList:j,processingPluginList:r?O:void 0,"data-test-subj":b["data-test-subj"],style:b.style},null!==(M=null!=a?a:t)&&void 0!==M?M:""):Object(v.jsx)(f.EuiMarkdownEditor,{className:n,"aria-label":null!=e?e:"markdown component",placeholder:u,value:h,onChange:y,height:c,uiPlugins:I,parsingPluginList:j,processingPluginList:r?O:void 0,"data-test-subj":b["data-test-subj"]})};function Uu({id:e,name:t,documentation:a,signature:n,section:i}){return{id:e,name:t,documentation:{section:i,signature:n,description:a}}}function Wu({id:e,name:t,documentation:a}){return Uu({id:e,name:t,documentation:a||u.i18n.translate("lensFormulaDocs.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:  \n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:  \n`{metric}(price, kql='location:UK')`\n            ",values:{metric:e}}),section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.metric.signature",{defaultMessage:"field: string"})})}function Xu({id:e,name:t,documentation:a}){return Uu({id:e,name:t,documentation:a,section:"constants",signature:""})}const Yu="average",Qu=u.i18n.translate("lensFormulaDocs.avg",{defaultMessage:"Average"}),Ku=Wu({id:Yu,name:Qu}),Zu="count",Ju=u.i18n.translate("lensFormulaDocs.count",{defaultMessage:"Count"}),ec={id:Zu,name:Ju,documentation:{section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.count.signature",{defaultMessage:"[field: string]"}),description:u.i18n.translate("lensFormulaDocs.count.documentation.markdown",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n\n#### Examples\n\nTo calculate the total number of documents, use `count()`.\n\nTo calculate the number of products in all orders, use `count(products.id)`.\n\nTo calculate the number of documents that match a specific filter, use `count(kql='price > 500')`.\n"})}},tc="unique_count",ac=u.i18n.translate("lensFormulaDocs.cardinality",{defaultMessage:"Unique Count"}),nc={id:tc,name:ac,documentation:{section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.cardinality.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("lensFormulaDocs.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:  \n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:  \n`unique_count(product.name, kql='product.group=clothes')`\n      "})}},ic="counter_rate",sc=u.i18n.translate("lensFormulaDocs.counterRate",{defaultMessage:"Counter rate"}),lc={id:ic,name:sc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.counterRate.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:  \n`counter_rate(max(memcached.stats.read.bytes))`\n      "})}},rc="cumulative_sum",oc=u.i18n.translate("lensFormulaDocs.cumulativeSum",{defaultMessage:"Cumulative sum"}),uc={id:rc,name:oc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:  \n`cumulative_sum(sum(bytes))`\n"})}},cc="differences",dc=u.i18n.translate("lensFormulaDocs.derivative",{defaultMessage:"Differences"}),pc={id:cc,name:dc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.differences.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:  \n`differences(sum(bytes))`\n"})}},mc=Xu({id:"interval",name:u.i18n.translate("lensFormulaDocs.interval",{defaultMessage:"Date histogram interval"}),documentation:u.i18n.translate("lensFormulaDocs.interval.help",{defaultMessage:"\nThe specified minimum interval for the date histogram, in milliseconds (ms).\n\nExample: Dynamically normalize the metric based on bucket interval size:  \n`sum(bytes) / interval()`\n"})}),gc="last_value",fc=u.i18n.translate("lensFormulaDocs.lastValue",{defaultMessage:"Last value"}),bc={id:gc,name:fc,documentation:{section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.lastValue.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("lensFormulaDocs.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the data view.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:  \n`last_value(server.status, kql='server.name=\"A\"')`\n"})}},hc="max",vc=u.i18n.translate("lensFormulaDocs.max",{defaultMessage:"Maximum"}),yc=Wu({id:hc,name:vc}),xc="median",jc=u.i18n.translate("lensFormulaDocs.median",{defaultMessage:"Median"}),Oc=Wu({id:xc,name:jc}),Ic="min",Mc=u.i18n.translate("lensFormulaDocs.min",{defaultMessage:"Minimum"}),Tc=Wu({id:Ic,name:Mc}),wc="moving_average",kc=u.i18n.translate("lensFormulaDocs.movingAverage",{defaultMessage:"Moving average"}),Ec={id:wc,name:kc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:u.i18n.translate("lensFormulaDocs.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:  \n`moving_average(sum(bytes), window=5)`\n",values:{defaultValue:5}})}},Cc="normalize_by_unit",Fc=u.i18n.translate("lensFormulaDocs.timeScale",{defaultMessage:"Normalize by unit"}),Sc={id:Cc,name:Fc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.time_scale",{defaultMessage:"metric: number, unit: s|m|h|d|w|M|y"}),description:u.i18n.translate("lensFormulaDocs.time_scale.documentation.markdown",{defaultMessage:"\nThis advanced function is useful for normalizing counts and sums to a specific time interval. It allows for integration with metrics that are stored already normalized to a specific time interval.\n\nThis function can only be used if there's a date histogram function used in the current chart.\n\nExample: A ratio comparing an already normalized metric to another metric that needs to be normalized.  \n`normalize_by_unit(counter_rate(max(system.diskio.write.bytes)), unit='s') / last_value(apache.status.bytes_per_second)`\n"})}},Ac=Xu({id:"now",name:u.i18n.translate("lensFormulaDocs.now",{defaultMessage:"Current now"}),documentation:u.i18n.translate("lensFormulaDocs.now.help",{defaultMessage:"\nThe current now moment used in Kibana expressed in milliseconds (ms).\n\nExample: How long (in ms) has been the server running since the last restart? \n`now() - last_value(start_time)`\n"})}),Pc="overall_average",_c=u.i18n.translate("lensFormulaDocs.overallAverage",{defaultMessage:"Overall average"}),Lc={id:Pc,name:_c,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.overall_metric",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:  \n`sum(bytes) - overall_average(sum(bytes))`\n"})}},Dc="overall_max",Rc=u.i18n.translate("lensFormulaDocs.overallMax",{defaultMessage:"Overall max"}),Nc={id:Dc,name:Rc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.overall_metric",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range:  \n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n"})}},Bc="overall_min",zc=u.i18n.translate("lensFormulaDocs.overallMin",{defaultMessage:"Overall min"}),Vc={id:Bc,name:zc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.overall_metric",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range:  \n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n"})}},Gc="overall_sum",qc=u.i18n.translate("lensFormulaDocs.overallSum",{defaultMessage:"Overall sum"}),$c={id:Gc,name:qc,documentation:{section:"calculation",signature:u.i18n.translate("lensFormulaDocs.overall_metric",{defaultMessage:"metric: number"}),description:u.i18n.translate("lensFormulaDocs.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total:  \n`sum(bytes) / overall_sum(sum(bytes))`\n"})}},Hc="percentile_rank",Uc=u.i18n.translate("lensFormulaDocs.percentileRank",{defaultMessage:"Percentile rank"}),Wc={id:Hc,name:Uc,documentation:{section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.percentileRanks.signature",{defaultMessage:"field: string, [value]: number"}),description:u.i18n.translate("lensFormulaDocs.percentileRanks.documentation.markdown",{defaultMessage:"\nReturns the percentage of values which are below a certain value. For example, if a value is greater than or equal to 95% of the observed values it is said to be at the 95th percentile rank\n\nExample: Get the percentage of values which are below of 100:  \n`percentile_rank(bytes, value=100)`\n"})}},Xc="percentile",Yc=u.i18n.translate("lensFormulaDocs.percentile",{defaultMessage:"Percentile"}),Qc={id:Xc,name:Yc,documentation:{section:"elasticsearch",signature:u.i18n.translate("lensFormulaDocs.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:u.i18n.translate("lensFormulaDocs.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:  \n`percentile(bytes, percentile=95)`\n"})}},Kc="standard_deviation",Zc=u.i18n.translate("lensFormulaDocs.standardDeviation",{defaultMessage:"Standard deviation"}),Jc=Wu({id:Kc,name:Zc,documentation:u.i18n.translate("lensFormulaDocs.standardDeviation.documentation.markdown",{defaultMessage:"\nReturns the amount of variation or dispersion of the field. The function works only for number fields.\n\n#### Examples\n\nTo get the standard deviation of price, use `standard_deviation(price)`.\n\nTo get the variance of price for orders from the UK, use `square(standard_deviation(price, kql='location:UK'))`.\n"})}),ed="sum",td=u.i18n.translate("lensFormulaDocs.sum",{defaultMessage:"Sum"}),ad=[Ku,ec,nc,lc,uc,pc,mc,bc,yc,Oc,Tc,Ec,Sc,Ac,Lc,Nc,Vc,$c,Wc,Qc,Jc,Wu({id:ed,name:td}),Xu({id:"time_range",name:u.i18n.translate("lensFormulaDocs.time_range",{defaultMessage:"Time range"}),documentation:u.i18n.translate("lensFormulaDocs.timeRange.help",{defaultMessage:"\nThe specified time range, in milliseconds (ms).\n\nExample: How long is the current time range in (ms)?\n`time_range()`\n\nExample: A static average per minute computed with the current time range:\n`(sum(bytes) / time_range()) * 1000 * 60`\n"})})].reduce(((e,t)=>(e[t.id]=t,e)),{}),nd={label:u.i18n.translate("lensFormulaDocs.documentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),description:u.i18n.translate("lensFormulaDocs.documentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."})},id={label:u.i18n.translate("lensFormulaDocs.frequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:u.i18n.translate("lensFormulaDocs.CommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:u.i18n.translate("lensFormulaDocs.documentation.filterRatio",{defaultMessage:"Filter ratio"}),description:u.i18n.translate("lensFormulaDocs.documentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n  ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})},{label:u.i18n.translate("lensFormulaDocs.documentation.weekOverWeek",{defaultMessage:"Week over week"}),description:u.i18n.translate("lensFormulaDocs.documentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n      ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})},{label:u.i18n.translate("lensFormulaDocs.documentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:u.i18n.translate("lensFormulaDocs.documentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n      ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})},{label:u.i18n.translate("lensFormulaDocs.documentation.recentChange",{defaultMessage:"Recent change"}),description:u.i18n.translate("lensFormulaDocs.documentation.recentChangeDescription.markdown",{defaultMessage:'### Recent change\n\nUse `reducedTimeRange=\'30m\'` to add an additional filter on the time range of a metric aligned with the end of the global time range. This can be used to calculate how much a value changed recently.\n\n```\nmax(system.network.in.bytes, reducedTimeRange="30m")\n- min(system.network.in.bytes, reducedTimeRange="30m")\n```\n  ',description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})}]},sd={label:u.i18n.translate("lensFormulaDocs.documentation.comparisonSection",{defaultMessage:"Comparison"}),description:u.i18n.translate("lensFormulaDocs.documentation.comparisonSectionDescription",{defaultMessage:"These functions are used to perform value comparison."})},ld={label:u.i18n.translate("lensFormulaDocs.documentation.mathSection",{defaultMessage:"Math"}),description:u.i18n.translate("lensFormulaDocs.documentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."})},rd={label:u.i18n.translate("lensFormulaDocs.documentation.columnCalculationSection",{defaultMessage:"Column calculations"}),description:u.i18n.translate("lensFormulaDocs.documentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."})},od={label:u.i18n.translate("lensFormulaDocs.documentation.constantsSection",{defaultMessage:"Kibana context"}),description:u.i18n.translate("lensFormulaDocs.documentation.constantsSectionDescription",{defaultMessage:"These functions are used to retrieve Kibana context variables, which are the date histogram `interval`, the current `now` and the selected `time_range` and help you to compute date math operations."})},ud={howTo:u.i18n.translate("lensFormulaDocs.documentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\naverage(cpu.load.pct),\nwindow=10,\nkql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"}),elasticsearch:nd,common:id,comparison:sd,math:ld,calculations:rd,context:od};function cd(e,t,a,n){return{label:e,description:t,items:a.sort().map((e=>{const t=function(e){var t;if(nu[e]){const[t,a]=nu[e].help.split("```");return`${t.replace(/\n/g,"\n\n")}${a?`\`\`\`${a}\`\`\``:""}`}return null===(t=ad[e].documentation)||void 0===t?void 0:t.description}(e);return{label:e,description:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("h3",null,dd(e,n,!1)),t?Object(v.jsx)(Hu,{readOnly:!0},t):null)}}))}}function dd(e,t,a=!0){if(nu[e])return`${e}(${nu[e].positionalArguments.map((({name:e,optional:t,type:a})=>`[${e}]${t?"?":""}: ${a}`)).join(", ")})`;if(t[e]){var n;const i=t[e],s=[];a&&(i.filterable&&s.push(u.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),i.shiftable&&s.push(u.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),i.canReduceTimeRange&&s.push(u.i18n.translate("xpack.lens.formula.reducedTimeRangeExtraArguments",{defaultMessage:"[reducedTimeRange]?: string"})));const l=s.length?", ":"";return`${e}(${null===(n=ad[e].documentation)||void 0===n?void 0:n.signature}${l}${s.join(", ")})`}return""}function pd(e){return e.map((({name:e,type:t,defaultValue:a=5})=>`${e}=${"string"===t?`"${a}"`:a}`)).join(", ")}const md=[{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.none",{defaultMessage:"None"}),value:""},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.previous",{defaultMessage:"Previous time range"}),value:"previous"}],gd=md.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function fd(e,t,a,n,i){const s=t.columnOrder.find((e=>"date_histogram"===t.columns[e].operationType));if(!s&&!a.timeFieldName)return{canShift:!1,hasDateHistogram:!1};if(s&&n&&n[i]&&n[i]){const t=n[i].columns.find((e=>e.id===s));if(t){var l;const a=(null===(l=e.getDateHistogramMeta(t))||void 0===l?void 0:l.interval)||"";return{interval:Fl.search.aggs.parseInterval(a),expression:a,canShift:!0,hasDateHistogram:!0}}}return{canShift:!0,hasDateHistogram:Boolean(s)}}function bd({interval:e,canShift:t}){return{canShift:t,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds()),isInvalid:e=>Boolean("invalid"===e)}}function hd(e,t){const{isValueTooSmall:a,isValueNotMultiple:n}=bd(e),i=[];if(Object(An.isAbsoluteTimeShift)(t))return[];const s=t&&Object(An.parseTimeShift)(t),l=s&&a(s),r=s&&n(s);return l?i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):r&&i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}function vd(e,t,a){const n=Object(An.calcAutoIntervalNear)(a,V()(t.toDate).diff(V()(t.fromDate))),i=function(e,t){return Object(An.isAbsoluteTimeShift)(e.trim())?Object(An.parseAbsoluteTimeShift)(e,{from:t.fromDate,to:t.toDate}).value:Object(An.parseTimeShift)(e)}(e,t);if("string"!=typeof i){const t=e.startsWith("end")?n.asMilliseconds():0;return(function(e,t){return e%t==0?e:Math.ceil(e/t)*t}(i.asMilliseconds(),n.asMilliseconds())-t)/1e3+"s"}}function yd(e,t,a,n=!1){return e&&Object(An.isAbsoluteTimeShift)(e)?vd(e,t,a):e&&n&&"previous"===e?vd(`endAt(${t.fromDate})`,t,a):e}const xd=[{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.30s",{defaultMessage:"30 seconds (30s)"}),value:"30s"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1m",{defaultMessage:"1 minute (1m)"}),value:"1m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.5m",{defaultMessage:"5 minutes (5m)"}),value:"5m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.15m",{defaultMessage:"15 minutes (15m)"}),value:"15m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1h",{defaultMessage:"1 hour (1h)"}),value:"1h"}],jd=xd.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function Od(e,t,a){const n=e.columns[t];if(!n.reducedTimeRange)return[];const i=Object.values(e.columns).some((e=>"date_histogram"===e.operationType)),s=Boolean(a.timeFieldName),l=[];return i&&l.push({uniqueId:Ft.P,message:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithDateHistogram",{defaultMessage:"Reduced time range can only be used without a date histogram. Either remove the date histogram dimension or remove the reduced time range from {column}.",values:{column:n.label}})}),s||l.push({uniqueId:Ft.O,message:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithoutTimefield",{defaultMessage:"Reduced time range can only be used with a specified default time field on the data view. Either use a different data view with default time field or remove the reduced time range from {column}.",values:{column:n.label}})}),l}let Id=function(e){return e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts",e.REDUCED_TIME_RANGES="reducedTimeRanges",e}({});const Md="LENS_MATH_MARKER";function Td(e,t,a){if("number"!=typeof e&&(!e.location||(n=t)>=(i=e.location).min&&n<i.max)){var n,i;if("function"===e.type){const[a]=e.args.map((a=>Td(a,t,e))).filter(Ct.nonNullable);return a||(e.location?{ast:e}:void 0)}return{ast:e,parent:a}}}function wd(e,t,a=0,n=1){return{range:{...t,startColumn:t.startColumn+a,endColumn:t.startColumn+n},text:e}}function kd(e,t){const a=e.split(/\n/);let n=t,i=1;for(const e of a){if(e.length>=n)return new qu.monaco.Position(i,n+1);n-=e.length+1,i++}throw new Error("Algorithm failure")}function Ed(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,a,n)=>e+(n===t.lineNumber-1?t.column-1:a.length+1)),0)}async function Cd({expression:e,zeroIndexedOffset:t,context:a,indexPattern:n,operationDefinitionMap:i,dataViews:s,unifiedSearch:l,dateHistogramInterval:r,timefilter:o}){const u=e.substr(0,t)+Md+e.substr(t);try{const e=Td(Object(tu.parse)(u),t),c=null==e?void 0:e.ast,d=Object(Ct.getAbsoluteDateRange)(o),p=(null==e?void 0:e.parent)&&"number"!=typeof c&&c&&"type"in c&&"namedArgument"===c.type;if(null!=e&&e.parent&&("="===a.triggerCharacter||p))return await async function({ast:e,unifiedSearch:t,dataViews:a,indexPattern:n,dateHistogramInterval:i,dateRange:s}){if("shift"===e.name){const t=md.filter((({value:e})=>{if(null==i)return!0;const t=Object(An.parseTimeShift)(e);return"previous"===t||"invalid"===t||Number.isInteger(t.asMilliseconds()/i)})).map((({value:e})=>e)),a=e.value.split(Md)[0];if(Sd.test(a))return{list:t.map((e=>`${Ad(s,a,e)})`)),type:Id.SHIFTS};const n=["startAt","endAt"].map((e=>`${e}(${Ad(s,e,t[0])})`));return{list:t.concat(n),type:Id.SHIFTS}}if("reducedTimeRange"===e.name)return{list:xd.map((({value:e})=>e)),type:Id.REDUCED_TIME_RANGES};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:Id.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:Id.KQL};const l=e.value.split(Md)[0],r=e.value.indexOf(Md)+1,o=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:l,selectionStart:r,selectionEnd:r,indexPatterns:[await a.get(n.id)],boolFilter:[]});return{list:null!=o?o:[],type:Id.KQL}}({ast:c,unifiedSearch:l,dataViews:s,indexPattern:n,dateHistogramInterval:r,dateRange:d});if(null!=e&&e.parent)return function(e,t,a,n,i){const{name:s}=e,l=i[s];if(!l&&!nu[s])return{list:[],type:Id.FIELD};const r=nu[s];if(r)return r.positionalArguments[t]?{list:Fd(n,i).map((e=>({type:"math",label:e}))),type:Id.FUNCTIONS}:{list:[],type:Id.FIELD};if(t>0||!Fu(l.type)){const{namedArguments:t}=su(e.args),a=[];return l.filterable&&(t.find((e=>"kql"===e.name||"lucene"===e.name))||(a.push("kql"),a.push("lucene"))),l.shiftable&&(t.find((e=>"shift"===e.name))||a.push("shift")),l.canReduceTimeRange&&(t.find((e=>"reducedTimeRange"===e.name))||a.push("reducedTimeRange")),"operationParams"in l&&a.push(...l.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:a,type:Id.NAMED_ARGUMENT}}if("field"===l.input&&0===t){const t=Hf(n,i).filter((({operationMetaData:e})=>("number"===e.dataType||"date"===e.dataType)&&!e.isBucketed));if(t.length){const n=t.flatMap((e=>e.operations)).filter((e=>e.operationType===l.type)).map((e=>"field"in e?e.field:void 0)).filter(Ct.nonNullable),i=e.args[0],s="string"!=typeof i&&i.location;let r;if(s){const e=kd(a,s.min),t=kd(a,s.max-Md.length);r=qu.monaco.Range.fromPositions(e,t)}return{list:n,type:Id.FIELD,range:r}}return{list:[],type:Id.FIELD}}if("fullReference"===l.input){const e=Hf(n,i),t=[];return e.forEach((e=>{l.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>l.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(pa.uniq)(t).map((e=>({label:e,type:"operation"}))),type:Id.FUNCTIONS}}return{list:[],type:Id.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===c)),u,n,i);if("object"==typeof c&&Boolean("variable"===c.type||"function"===c.type))return function(e,t,a){return{list:Object(pa.uniq)(Fd(t,a).filter((t=>Object(pa.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:Id.FUNCTIONS}}(("function"===c.type?c.name:c.value).split(Md)[0],n,i)}catch(e){}return{list:[],type:Id.FIELD}}function Fd(e,t){const a=Hf(e,t),n=new Set;for(const e of a)if("number"===e.operationMetaData.dataType&&!e.operationMetaData.isBucketed)for(const t of e.operations)("managedReference"!==t.type||t.usedInMath)&&n.add(t.operationType);return Array.from(n.keys()).concat(Object.keys(nu))}const Sd=/^(start|end)At\(/;function Ad(e,t,a){const n=t.startsWith("s")?e.fromDate:e.toDate;return V()(n).subtract(Object(An.parseTimeShift)(a),"ms").toISOString()}const Pd={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function _d(e,t){if(nu[e])return[{label:dd(e,t),documentation:{value:nu[e].help.replace(/\n/g,"\n\n")},parameters:nu[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?u.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}];if(t[e]){const a=t[e],n=Fu(e)?{label:"field"===a.input?"field":"fullReference"===a.input?"function":""}:null,i=dd(e,t),s=function(e,t){const{description:a,examples:n}=function(e,t){var a,n;const i=t[e],s=null!==(a=null===(n=ad[e].documentation)||void 0===n?void 0:n.description)&&void 0!==a?a:"",l=[];if(!/Example/.test(s)){if(!Fu(e))return l.push(`${e}()`),{description:s,examples:l};if("field"===i.input){var r;const t=(null===(r=i.operationParams)||void 0===r?void 0:r.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(bytes)`),t.length){const a=pd(t);l.push(`${e}(bytes, ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=pd(i.operationParams);l.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(sum(bytes))`),t.length){const a=pd(t);l.push(`${e}(sum(bytes), ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=pd(i.operationParams);l.push(`${e}(sum(bytes), ${t})`)}}}return{description:s,examples:l}}(e,t);return{value:`${a}${n.length?`\n\n**${u.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${n.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}(e,t);return"operationParams"in a&&a.operationParams?[{label:i,parameters:[...n?[n]:[],...a.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?u.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:s}]:[{label:i,parameters:n?[n]:[],documentation:s}]}return[]}function Ld(e,t){const a=e.substr(0,t)+Md+e.substr(t);try{return Td(Object(tu.parse)(a),t)}catch(e){return}}const Dd="lens_math";qu.monaco.languages.register({id:Dd});const Rd={wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]},Nd={defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}};qu.monaco.languages.onLanguage(Dd,(()=>{qu.monaco.languages.setMonarchTokensProvider(Dd,Nd),qu.monaco.languages.setLanguageConfiguration(Dd,Rd)})),a(432);const Bd={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t,a)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[a.label],expression:[Vd(a.params.tinymathAst)],onError:["null"],castColumns:a.references}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})},zd={add:"+",subtract:"-",multiply:"*",divide:"/",lt:"<",gt:">",eq:"==",lte:"<=",gte:">="};function Vd(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:zd[e.name]?`(${e.args.map(Vd).join(` ${zd[e.name]} `)})`:`${t=e.name,Gd.reduce(((e,t)=>e.replace(t,"")),t)}(${e.args.map(Vd).join(",")})`;var t}const Gd=["pick_"];var qd=a(117);function $d(e,t){return`${e}X${t}`}const Hd=()=>({columns:{},meta:{locations:{}}});function Ud(e,t,a,n){const i={...a,columns:{...a.columns,[e]:{...t}}},{columns:s,meta:l}=Object.entries(i.columns).reduce(((t,[a,s])=>{if(a.startsWith(e)){if(a===e&&function(e){return"params"in e&&"formula"in e.params}(s)){const e=function(e,t,a,{indexPattern:n,operations:i=Rf,dateRange:s}){const{columns:l,meta:r}=Hd(),o=t.params.formula||"",{extracted:c,isValid:d}=function(e,t,a,n,i,s,l){const r=yu(e,i);if("error"in r)return{extracted:[],isValid:!1};if(xu(r.root,t,n,i,t.columns[a],s).length)return{extracted:[],isValid:!1};const o=function(e,t,a,n,i,s,l){const r=[],{filter:o,reducedTimeRange:u}=n.columns[e],c=function a(l){if("number"==typeof l||"function"!==l.type)return l;const c=t[l.name];if(!c){const e=l.args.map(a).filter(Ct.nonNullable);return{...l,args:e}}const{namedArguments:d,variables:p,functions:m}=su(l.args);if("field"===c.input){const[t]=p.filter((e=>Object(pa.isObject)(e)));let a=t?i.getFieldByName(t.value):void 0;Cu(l)||a||(a=qd.a);const m={...ru(c,ou(c,d||[]),o,u),usedInMath:!0},g=c.buildColumn({layer:n,indexPattern:i,field:a},m),f=$d(e,r.length);return g.customLabel=!0,g.label=s,r.push({column:g,location:l.location}),f}if("fullReference"===c.input){const[t]=m,p=a(t),g="string"!=typeof p;if(g){const e=p?cu(p):[],t=Bd.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=p,r.push({column:t}),t.customLabel=!0,t.label=s}const f=ru(c,ou(c,d||[]),o,u),b=c.buildColumn({layer:n,indexPattern:i,referenceIds:[g?$d(e,r.length-1):p]},f),h=$d(e,r.length);return b.customLabel=!0,b.label=s,r.push({column:b,location:l.location}),h}if("managedReference"===c.input&&c.usedInMath){const t=c.buildColumn({layer:n,indexPattern:i}),a=$d(e,r.length);return t.customLabel=!0,t.label=s,r.push({column:t,location:l.location}),a}}(a);if(void 0===c)return[];if("string"!=typeof c){const e=cu(c),t=Bd.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=c,t.customLabel=!0,t.label=s,r.push({column:t})}return r}(a,i,r.root,t,n,u.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:l||e}}));return{extracted:o,isValid:!0}}(o,a,e,n,du(i),s,t.customLabel?t.label:void 0);return c.forEach((({column:t,location:a},n)=>{const i=$d(e,n);l[i]=t,a&&(r.locations[i]=a)})),l[e]={...t,label:t.customLabel?t.label:null!=o?o:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),references:d?[$d(e,c.length-1)]:[],params:{...t.params,formula:o,isFormulaBroken:!d}},{columns:l,meta:r}}(a,s,i,n);t.columns={...t.columns,...e.columns},t.meta={...t.meta,...e.meta}}}else t.columns[a]={...s};return t}),Hd());return{layer:{...i,columns:s,columnOrder:Np({...i,columns:s})},meta:l}}function Wd(e,t,a){const n=null==e?void 0:e[t];return!(!n||0===n.rows.length)&&n.rows.some((e=>null!=e[a]))}const Xd=l.a.memo(Kd),Yd=new Set(["kql","lucene","shift","reducedTimeRange"]);var Qd={name:"1y0ex1",styles:"max-width:400px"};function Kd({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,unifiedSearch:c,dataViews:d,toggleFullscreen:p,isFullscreen:m,dateHistogramInterval:g,hasData:b,dateRange:h,uiSettings:y,data:x}){var j;const[I,T]=Object(s.useState)(a.params.formula),[w,k]=Object(s.useState)([]),[E,C]=Object(s.useState)(m),[F,S]=Object(s.useState)(!1),[A,P]=Object(s.useState)(!0),_=l.a.useRef(),L=l.a.useRef(),D=l.a.useRef([]),R=l.a.useRef(),{euiTheme:N}=Object(f.useEuiTheme)(),B=Object(s.useMemo)((()=>du(o)),[o]),z=Object(s.useMemo)((()=>function({indexPattern:e,operationDefinitionMap:t}){const a=[];a.push({label:u.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),a.push({label:ud.common.label,description:ud.common.description,items:ud.common.items.map((({label:e,description:t})=>({label:e,description:Object(v.jsx)(Hu,{readOnly:!0},t)})))});const{elasticsearch:n,calculation:i,math:s,comparison:l,constants:r}=Object(pa.groupBy)(Fd(e),(e=>{var a;return e in t?null===(a=ad[e].documentation)||void 0===a?void 0:a.section:e in nu?nu[e].section:void 0}));return a.push(cd(ud.elasticsearch.label,ud.elasticsearch.description,n,t)),a.push(cd(ud.calculations.label,ud.calculations.description,i,t)),a.push(cd(ud.math.label,ud.math.description,s,t)),a.push(cd(ud.comparison.label,ud.comparison.description,l,t)),a.push(cd(ud.context.label,ud.context.description,r,t)),{groups:a,initialSection:Object(v.jsx)(Hu,{readOnly:!0},ud.howTo)}}({indexPattern:r,operationDefinitionMap:B})),[r,B]),V="interval"in g?null===(j=g.interval)||void 0===j?void 0:j.asMilliseconds():void 0,G=Object(s.useRef)(V);if(G.current=V,null==L||!L.current){const e=L.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(s.useEffect)((()=>{const e=_,t=D,a=R;return()=>{var n,i,s,l,r;null===(n=e.current)||void 0===n||n.dispose(),null===(i=L.current)||void 0===i||null===(s=i.parentNode)||void 0===s||s.removeChild(L.current),null===(l=a.current)||void 0===l||l.dispose(),null===(r=t.current)||void 0===r||r.forEach((e=>e.dispose()))}}),[]),Gu()((()=>{I!==a.params.formula&&t((e=>Ud(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer))})),Object(M.t)((()=>{if(!_.current)return;if(!I)return k([]),qu.monaco.editor.setModelMarkers(_.current,"LENS",[]),void(a.params.formula&&t(Ud(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer));let i=[];const s=yu(I,B);if("error"in s)i=[s.error];else{const t=xu(s.root,e,r,B,a,h);t.length&&(i=t)}if(i.length){const s=a.params.isFormulaBroken,l=!a.params.isFormulaBroken&&!b;(s||l)&&a.params.formula!==I&&t(Ud(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer);const u=i.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const a=kd(I,t.min),n=kd(I,t.max);return{message:e.message,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?qu.monaco.MarkerSeverity.Warning:qu.monaco.MarkerSeverity.Error}}));{const t=kd(I,0),a=kd(I,I.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?qu.monaco.MarkerSeverity.Warning:qu.monaco.MarkerSeverity.Error}]}}));qu.monaco.editor.setModelMarkers(_.current,"LENS",u),k(u.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{qu.monaco.editor.setModelMarkers(_.current,"LENS",[]);const{layer:i,meta:{locations:s}}=Ud(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h});t(i);const l=Kp(n,i.columns).flatMap((([e,t])=>{const a=[];if(s[e]){const n=B[t.operationType];if(n.getErrorMessage){const t=n.getErrorMessage(i,e,r,h,B,y.get(Fl.UI_SETTINGS.HISTOGRAM_BAR_TARGET));if(t.length){const n=kd(I,s[e].min),i=kd(I,s[e].max);a.push({message:t.map((e=>e.message)).join(", "),startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:qu.monaco.MarkerSeverity.Warning})}}if(n.shiftable&&t.timeShift){const n=kd(I,s[e].min),i=kd(I,s[e].max);a.push(...hd(g,t.timeShift).map((e=>({message:e,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:qu.monaco.MarkerSeverity.Warning}))))}}return a})).filter(Ct.nonNullable);k(l.map((({severity:e,message:t})=>({severity:e,message:t})))),qu.monaco.editor.setModelMarkers(_.current,"LENS",l)}}),{skipFirstRender:!1},256,[I,a.filter]);const q=w.filter((e=>e.severity===qu.monaco.MarkerSeverity.Error)).length,$=w.filter((e=>e.severity===qu.monaco.MarkerSeverity.Warning)).length,H=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue();let i={list:[],type:Id.FIELD};const s=Ed(n,t);return"("===a.triggerCharacter?("()"===n.slice(s-1,s+1)&&(t=t.delta(0,-1)),e.getWordAtPosition(t.delta(0,-3))&&(i=await Cd({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:B,unifiedSearch:c,dataViews:d,dateHistogramInterval:G.current,timefilter:x.query.timefilter.timefilter}))):i=await Cd({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:B,unifiedSearch:c,dataViews:d,dateHistogramInterval:G.current,timefilter:x.query.timefilter.timefilter}),{suggestions:i.list.map((e=>function(e,t,a,n,i){var s;let l,r,o,u=qu.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case Id.SHIFTS:p=String(gd[c]).padStart(4,"0");break;case Id.REDUCED_TIME_RANGES:p=String(jd[c]).padStart(4,"0");break;case Id.FIELD:u=qu.monaco.languages.CompletionItemKind.Value,iu.test(c)&&(l=`'${c.replaceAll("'","\\'")}'`);break;case Id.FUNCTIONS:if(l=`${c}($0)`,r=qu.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=dd(e.label,a),nu[e.label]?(d="TinyMath",u=qu.monaco.languages.CompletionItemKind.Method):(u=qu.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=Pd)}break;case Id.NAMED_ARGUMENT:u=qu.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c&&"reducedTimeRange"!==c||(o=Pd,l=`${c}='$0'`,r=qu.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case Id.KQL:":"===n?l=`${n} ${c}`:o=Pd,c.includes("'")&&(l=(l||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(s=l)&&void 0!==s?s:c,insertTextRules:r,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,i.type,B,a.triggerCharacter,i.range)))}}),[r,B,c,d,x.query.timefilter.timefilter]),U=Object(s.useCallback)((async(e,t,a,n)=>{const i=e.getValue(),s=e.getFullModelRange(),l=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:s.endLineNumber,endColumn:s.endColumn});return function(e,t,a){const n=e.substr(0,t)+Md+e.substr(t);try{const e=Td(Object(tu.parse)(n),t);let i=[],s=0;if(null!=e&&e.parent){const t=e.parent.name;s=e.parent.args.findIndex((t=>t===e.ast)),i=_d(t,a)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=_d(e.ast.name,a));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:s,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-l,B)}),[B]),W=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue(),i=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,a){try{const n=Td(Object(tu.parse)(e),t);if(!n||"number"==typeof n.ast||!("name"in n.ast))return{contents:[]};const i=_d(n.ast.name,a);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),n.length-s,B)}),[B]),X=Object(s.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const n=e.changes[0].text;if("="!==n&&"'"!==n)return;const i=e.changes[0].range;if(i){var a;const e=t.getValue(),s=Ed(e,new qu.monaco.Position(i.startLineNumber,i.startColumn));let l=Ld(e,s+1);if(!l&&"'"===n){const t=e;l=Ld(t.substring(0,s)+"\\'"+t.substring(s+1),s+2)}const r=/'LENS_MATH_MARKER/;if(l&&("number"==typeof l.ast||"namedArgument"!==l.ast.type||!Yd.has(l.ast.name)||l.ast.value!==Md&&!r.test(l.ast.value)))return;let o=null;const u=2;if("="===n&&(l||"="===e.charAt(s-1)||(o=wd("=",i,1)),l&&(o=wd("''",i,1))),!l&&!o)return;"'"===n&&null!==(a=l)&&void 0!==a&&a.ast&&"number"!=typeof l.ast&&"name"in l.ast&&"shift"!==l.ast.name&&"reducedTimeRange"!==l.ast.name&&(o=wd("\\'",i)),o&&setTimeout((()=>{var e;t.executeEdits("LENS",[o],[new qu.monaco.Selection(i.startLineNumber,i.startColumn+u,i.startLineNumber,i.startColumn+u)]),t.setPosition({column:i.startColumn+u,lineNumber:i.startLineNumber}),"="!==(null===(e=o)||void 0===e?void 0:e.text)&&t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),Y={languageId:Dd,value:null!=I?I:"",onChange:T,options:{automaticLayout:!0,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:A?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(s.useEffect)((()=>{const{dispose:e}=qu.monaco.languages.registerCompletionItemProvider(Dd,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:H}),{dispose:t}=qu.monaco.languages.registerSignatureHelpProvider(Dd,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:U}),{dispose:a}=qu.monaco.languages.registerHoverProvider(Dd,{provideHover:W});return()=>{e(),t(),a()}}),[H,U,W]),Object(v.jsx)("div",{className:O()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":m})},!m&&Object(v.jsx)(f.EuiFormLabel,{css:Object(v.css)("margin-top:",N.size.base,";margin-bottom:",N.size.xs,";","")},u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingFormula",{defaultMessage:"Formula"})),Object(v.jsx)("div",{className:"lnsIndexPatternDimensionEditor--shaded",css:Object(v.css)("border:",m?"none":N.border.thin,";border-radius:",m?0:N.border.radius.medium,";height:",m?"100%":"auto",";","")},Object(v.jsx)("div",{className:"lnsFormula"},Object(v.jsx)("div",{className:"lnsFormula__editor"},Object(v.jsx)("div",{className:"lnsFormula__editorHeader"},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(v.jsx)(f.EuiToolTip,{content:A?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(v.jsx)(f.EuiButtonIcon,{iconType:A?"wordWrap":"wordWrapDisabled",display:A?void 0:"fill",color:"text","aria-label":A?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!A,onClick:()=>{var e;null===(e=R.current)||void 0===e||e.updateOptions({wordWrap:A?"off":"on"}),P(!A)}}))),Object(v.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(v.jsx)(f.EuiButtonEmpty,{onClick:()=>{p(),C(!m)},iconType:m?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},m?u.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):u.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(v.jsx)("div",{className:"lnsFormula__editorContent"},Object(v.jsx)($u.CodeEditor,i()({},Y,{options:{...Y.options,overflowWidgetsDomNode:L.current},editorDidMount:e=>{R.current=e;const t=e.getModel();t&&(_.current=t),D.current.push(e.onDidChangeModelContent((t=>{X(t,e)})))}})),I?null:Object(v.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(v.jsx)(f.EuiText,{color:"subdued",size:"s"},u.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)("pre",null,"count() + 1"))),Object(v.jsx)("div",{className:"lnsFormula__editorFooter"},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},m?Object(v.jsx)(f.EuiToolTip,{content:E?u.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(v.jsx)(f.EuiLink,{"aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>C(!E)},Object(v.jsx)(f.EuiIcon,{type:"documentation"}),Object(v.jsx)(f.EuiIcon,{type:E?"arrowDown":"arrowUp"}))):Object(v.jsx)(zu,{language:"Formula",sections:z,buttonProps:{color:"text",className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay","data-test-subj":"TextBasedLangEditor-documentation","aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})}})),q||$?Object(v.jsx)(f.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(v.jsx)(f.EuiPopover,{ownFocus:!1,isOpen:F,closePopover:()=>S(!1),button:Object(v.jsx)(f.EuiButtonEmpty,{color:q?"danger":"warning",className:"lnsFormula__editorError",iconType:"warning",size:"xs",flush:"right",onClick:()=>{S(!F)}},q?u.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:q}}):null,$?u.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:$}}):null)},Object(v.jsx)("div",{css:Qd},w.map((({message:e,severity:t},a)=>Object(v.jsx)("div",{key:a,className:"lnsFormula__warningText"},Object(v.jsx)(f.EuiText,{size:"s",color:t===qu.monaco.MarkerSeverity.Warning?"warning":"danger"},e))))))):null))),m&&E?Object(v.jsx)("div",{className:"lnsFormula__docs documentation__docs--inline"},Object(v.jsx)(Nu,{language:"Formula",sections:z})):null)))}function Zd(e){return"sourceField"in e}function Jd(e,t,a,n){var i;return Boolean((null===(i=n.find((({groupId:e})=>a===e)))||void 0===i?void 0:i.isBreakdownDimension)&&function(e,t){return Object.values(e.columns).some((e=>{var a;return Zd(e)&&(null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.timeSeriesMetric)}))}(e,t))}function ep(e,t,a){var n,i;if(!a)return[];const s=e.columns[t],{operationType:l}=s,r=l?Rf[l]:void 0,o=Zd(s)&&r?null!==(n=null==r||null===(i=r.getCurrentFields)||void 0===i?void 0:i.call(r,s))&&void 0!==n?n:[s.sourceField]:[],c=o.map((e=>a.getFieldByName(e))),d=c.filter(Boolean),p=Boolean(c.length>d.length||!("field"===(null==r?void 0:r.input)&&d.every((e=>null!=r.getPossibleOperationForField(e))))),m=Boolean(d.length&&!(null!=r&&r.isTransferable(s,a,Rf)));if(p){const e=c.map(((e,t)=>e?null:o[t])).filter(Boolean);if(e.length)return[tp(e,t)];if(m){var g,f;const e=null!==(g=null==r||null===(f=r.getNonTransferableFields)||void 0===f?void 0:f.call(r,s,a))&&void 0!==g?g:o;return[{uniqueId:Ft.q,message:u.i18n.translate("xpack.lens.indexPattern.fieldsWrongType",{defaultMessage:"{count, plural, one {Field} other {Fields}} {invalidFields} {count, plural, one {is} other {are}} of the wrong type",values:{count:e.length,invalidFields:e.join(", ")}})}]}}return[]}const tp=(e,t)=>({uniqueId:Ft.p,message:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.fieldsNotFound",defaultMessage:"{count, plural, one {Field} other {Fields}} {missingFields} {count, plural, one {was} other {were}} not found.",values:{count:e.length,missingFields:Object(v.jsx)(l.a.Fragment,null,e.map(((t,a)=>Object(v.jsx)(s.Fragment,{key:t},Object(v.jsx)("strong",null,t),a+1===e.length?"":", "))))}}),displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t},{id:"embeddableBadge"}]});function ap(e,t){const a=null==t?void 0:t.getFieldByName(e);return a?a.displayName:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function np(e,t,a,n,i=2){const s=Number(e);return""!==e&&null!=e&&!Number.isNaN(s)&&Number.isFinite(s)&&(!t||Number.isInteger(s))&&(void 0===a||s<=a)&&(void 0===n||s>=n)&&function(e,t){const[,a=""]=`${e}`.split(".");return a.length<=t}(e,t?0:i)}function ip(e,t){return t.operationType===e}const sp=e=>"operationType"in e;function lp(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function rp(e){return"number"===(null==e?void 0:e.dataType)&&lp(e)&&e.params?{format:e.params.format}:void 0}function op(e,t=!0){return{query:t?`"${e}": *`:`${e}: *`,language:"kuery"}}function up(e,t){return Object(pa.isEqual)(e,op(t))||Object(pa.isEqual)(e,op(t,!1))}function cp(e,t){let a=null==e?void 0:e.filter;if(!(e&&ip("last_value",e)&&up(a,e.sourceField))){var n;if(t)if("kql"in t)a={query:null!==(n=t.kql)&&void 0!==n?n:"",language:"kuery"};else if("lucene"in t){var i;a={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return a}}function dp({sourceField:e,operationType:t}){return!e||"count"===t&&e===Wt.DOCUMENT_FIELD_NAME?"":iu.test(e)?`'${e.replaceAll("'","\\'")}'`:e}const pp=u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),mp={type:"formula",displayName:pp,getDefaultLabel:e=>{var t;return null!==(t=e.params.formula)&&void 0!==t?t:pp},input:"managedReference",hidden:!0,filterable:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaFilterableHelpText",{defaultMessage:"The provided filter will be applied to the entire formula."})},canReduceTimeRange:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaCanReduceTimeRangeHelpText",{defaultMessage:"Applies to the entire formula."})},getDisabledStatus(e){},getErrorMessage(e,t,a,n,i,s){const l=e.columns[t];if(!l.params.formula||!i)return[];const r=du(i),o=yu(l.params.formula,r);if("error"in o)return[{uniqueId:o.error.id,message:o.error.message}];const c=xu(o.root,e,a,r,l,n);if(c.length)return Object(pa.uniqBy)(c,(({message:e})=>e)).map((({id:e,message:a,meta:n})=>"missingField"===e&&n.fieldList.length>0?tp(n.fieldList,t):{uniqueId:e,message:a}));const d=Kp(t,e.columns),p=[...d.flatMap((([t,i])=>{var l,o;const u=r[i.operationType];return null!==(l=null==u||null===(o=u.getErrorMessage)||void 0===o?void 0:o.call(u,e,t,a,n,r,s))&&void 0!==l?l:[]})).reduce(((e,t)=>(e.add(t),e)),new Set)],m=e.columnOrder.some((t=>e.columns[t].isBucketed)),g=e.columnOrder.some((t=>{const a=e.columns[t];return!a.isBucketed&&!a.isStaticValue&&"math"!==a.operationType&&"formula"!==a.operationType})),f=!c.length&&d.length;return m&&!g&&f&&p.push({uniqueId:Ft.r,message:u.i18n.translate("xpack.lens.indexPattern.noRealMetricError",{defaultMessage:"A layer with only static values will not show results, use at least one dynamic metric"})}),p},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==pp?n.label:null!==(a=null==i?void 0:i.formula)&&void 0!==a?a:pp;return[{type:"function",function:n.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[s||pp],...n.references.length?{castColumns:[n.references[0]]}:{},expression:[n.references.length?`"${n.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){let s="";e&&(s=function(e,t,a,n){if(ip("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const n=t.columns[e.references[0]];if(n&&"sourceField"in n&&"number"===n.dataType){const t=dp(n);a+=`${e.operationType}(${n.operationType}(${t})`}}else{if(!e||!("sourceField"in e)||"number"!==e.dataType&&"date"!==e.dataType)return"";a+=`${e.operationType}(${dp(e)}`}const i=function(e,t){if(!t)return[];const a=t[e.operationType];return"operationParams"in a&&(n=e,Boolean("params"in n&&n.params))?(a.operationParams||[]).flatMap((({name:t,required:a})=>{const n=e.params[t];return Object(pa.isObject)(n)?Object.keys(n).map((e=>({name:`${t}-${e}`,value:n[e],required:a}))):{name:t,value:n,required:a}})):[];var n}(e,n);return i.length&&(a+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==Wt.DOCUMENT_FIELD_NAME)&&(a+=", "),a+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==Wt.DOCUMENT_FIELD_NAME||e.filter)&&(a+=", "),a+=`shift='${e.timeShift}'`),e.reducedTimeRange&&(("count"!==e.operationType||e.filter||e.timeShift)&&(a+=", "),a+=`reducedTimeRange='${e.reducedTimeRange}'`),a&&(a+=")"),a}(e,t,s,i));let l={};var r;e&&lp(e)&&(l={format:null===(r=e.params)||void 0===r?void 0:r.format}),null!=n&&n.format&&(l={format:n.format});const o="formula"===(null==e?void 0:e.operationType);return{label:s||pp,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:s?{formula:s,isFormulaBroken:!1,...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}}:{...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}},references:[],filter:o?cp(e,n):void 0,reducedTimeRange:o?e.reducedTimeRange:void 0,timeScale:null==e?void 0:e.timeScale}},isTransferable:()=>!0,createCopy(e,t,a,n){const i=e[t.layerId].columns[t.columnId],s=Ud(a.columnId,i,e[a.layerId],{indexPattern:a.dataView,operations:n});return{...e,[a.layerId]:s.layer}},timeScalingMode:"optional",paramEditor:({activeData:e,...t})=>{const a=fd(t.data.datatableUtilities,t.layer,t.indexPattern,e,t.layerId);return Object(v.jsx)(Xd,i()({},t,{dateHistogramInterval:a,hasData:Wd(e,t.layerId,t.columnId)}))}};function gp(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(pa.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}const fp=vp({type:"time_range",label:"Time range",description:u.i18n.translate("xpack.lens.formula.timeRange.help",{defaultMessage:"The specified time range, in milliseconds (ms)."}),getExpressionFunction:e=>Object(ce.buildExpressionFunction)("formula_time_range",{}),getErrorMessage:function(e,t,a,n){const i=[];return a.timeFieldName||i.push({uniqueId:Ft.U,message:u.i18n.translate("xpack.lens.indexPattern.dateRange.dataViewNoTimeBased",{defaultMessage:"The current dataView is not time based"})}),n||i.push({uniqueId:Ft.V,message:u.i18n.translate("xpack.lens.indexPattern.dateRange.noTimeRange",{defaultMessage:"The current time range interval is not available"})}),i}}),bp=vp({type:"now",label:"Current now",description:u.i18n.translate("xpack.lens.formula.now.help",{defaultMessage:"The current now moment used in Kibana expressed in milliseconds (ms)."}),getExpressionFunction:e=>Object(ce.buildExpressionFunction)("formula_now",{}),getErrorMessage:function(){return[]}}),hp=vp({type:"interval",label:"Date histogram interval",description:u.i18n.translate("xpack.lens.formula.interval.help",{defaultMessage:"The specified minimum interval for the date histogram, in milliseconds (ms)."}),getExpressionFunction:({targetBars:e})=>Object(ce.buildExpressionFunction)("formula_interval",{targetBars:e}),getErrorMessage:function(e,t,a,n,i,s){const l=[];return s||l.push({uniqueId:Ft.D,message:u.i18n.translate("xpack.lens.indexPattern.interval.noTargetBars",{defaultMessage:'Missing "{uiSettingVar}" value',values:{uiSettingVar:An.UI_SETTINGS.HISTOGRAM_BAR_TARGET}})}),n||l.push({uniqueId:Ft.C,message:u.i18n.translate("xpack.lens.indexPattern.interval.noTimeRange",{defaultMessage:"The current time range interval is not available"})}),Object.values(e.columns).some((e=>function(e,t){return"date_histogram"===t.operationType}(0,e)))||l.push({uniqueId:Ft.B,message:u.i18n.translate("xpack.lens.indexPattern.interval.noDateHistogramColumn",{defaultMessage:"Cannot compute an interval without a date histogram column configured"})}),l}});function vp({label:e,type:t,getExpressionFunction:a,getErrorMessage:n,description:i}){return{type:t,displayName:e,input:"managedReference",selectionStyle:"hidden",usedInMath:!0,getDefaultLabel:()=>e,isTransferable:()=>!0,getDisabledStatus(){},getErrorMessage:n,getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),buildColumn:()=>({label:e,dataType:"number",operationType:t,isBucketed:!1,scale:"ratio",references:[]}),toExpression:(e,t,n,i={})=>{const s=e.columns[t];return[Object(ce.buildExpressionFunction)("mathColumn",{id:t,name:s.label,expression:Object(ce.buildExpression)([a(i)])}).toAst()]},createCopy(e,t,a){const n=e[t.layerId].columns[t.columnId],i=e[a.layerId],s={...i.columns,[a.columnId]:{...n}};return{...e,[a.layerId]:{...i,columns:s,columnOrder:gp({...i,columns:s})}}}}}function yp({layers:e,source:t,target:a}){return function(e,t,a){const n=e[a.layerId],i=n.columns[a.columnId],s=e[t.layerId];let l={...s.columns};if("references"in i){const s=Rf[i.operationType];if("createCopy"in s)return s.createCopy(e,a,t,Rf);const r=i.references.reduce(((e,t)=>{const a=Object(kt.a)();return{...e,[a]:{...n.columns[t]}}}),{});l={...l,...r,[t.columnId]:{...i,references:Object.keys(r)}}}else l={...l,[t.columnId]:{...i}};return{...e,[t.layerId]:Lp({...s,columns:l,columnOrder:Np({...s,columns:l})})}}(e,a,t)}function xp(e){return e.layer.columns[e.columnId]?wp(e):Mp(e)}function jp(e,t,a){const n={...e};return t.filterable&&(n.filter=a.filter),t.shiftable&&(n.timeShift=a.timeShift),"disabled"!==t.timeScalingMode&&(n.timeScale=a.timeScale),n}const Op=({layer:e,references:t,requiredReferences:a,indexPattern:n,visualizationGroups:i,targetGroup:s})=>{t.forEach((e=>{if(!a.filter((t=>Wp({validation:t,operationType:e.op,indexPattern:n}))).length)throw new Error(`Can't create reference, ${e.op} has a validation function which doesn't allow any operations`)}));const l=[];return t.forEach((t=>{const a=Rf[t.op];if("none"===a.input)return e=Mp({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,columnParams:{...t.columnParams},incompleteParams:t.incompleteParams,initialParams:t.initialParams,...t.references?{references:t.references}:{},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId);const r="field"===a.input&&t.field&&a.getPossibleOperationForField(t.field)?t.field:void 0;return r?(e=Mp({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,field:r,incompleteParams:t.incompleteParams,initialParams:t.initialParams,columnParams:{...t.columnParams},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId)):void 0})),{layer:e,referenceIds:l}},Ip=({op:e,incompleteFieldOperation:t,incompleteFieldName:a,columnParams:n,layer:i,requiredReferences:s,indexPattern:l,visualizationGroups:r,targetGroup:o})=>{const u=s.map((s=>{const u=Object.values(Rf).filter((({type:e})=>Wp({validation:s,operationType:e,indexPattern:l})));if(!u.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const c=Object(kt.a)();if(t&&a){var d;const e=l.fields.filter((e=>e.name===a));i=Mp({layer:i,columnId:c,op:t,indexPattern:l,field:null!==(d=e[0])&&void 0!==d?d:qd.a,visualizationGroups:r,columnParams:n,targetGroup:o})}if(1===u.length){const e=u[0];let t="field"===e.input?l.fields.filter(e.getPossibleOperationForField):[];a&&(t=t.filter((e=>e.name===a))),i="none"===e.input?Mp({layer:i,columnId:c,op:e.type,indexPattern:l,visualizationGroups:r,targetGroup:o}):1===t.length?Mp({layer:i,columnId:c,op:e.type,indexPattern:l,field:t[0],visualizationGroups:r,targetGroup:o}):{...i,incompleteColumns:{...i.incompleteColumns,[c]:{operationType:e.type}}}}return c}));return{layer:i,referenceIds:u}};function Mp({op:e,layer:t,columnId:a,field:n,indexPattern:i,visualizationGroups:s,targetGroup:l,incompleteParams:r,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,initialParams:d,references:p,respectOrder:m}){var g,f;const b=Rf[e];if(!b)throw new Error("No suitable operation found for given parameters");if(t.columns[a])throw new Error("Can't insert a column with an ID that is already in use");const h={indexPattern:i,previousColumn:{...r,...d,...t.columns[a]}};if("none"===b.input||"managedReference"===b.input){if(n)throw new Error(`Can't create operation ${e} with the provided field ${n.name}`);b.input;const r=b.getPossibleOperation(i);return Xp((Boolean(null==r?void 0:r.isBucketed)?Fp:Ap)(t,c?b.buildColumn({...h,layer:t},c):b.buildColumn({...h,layer:t}),a,s,l,m),i)}if("fullReference"===b.input){if(n)throw new Error("Reference-based operations can't take a field as input when creating");let r={...t},d=[];if(p){const e=Op({layer:r,references:p,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[e.layer,e.referenceIds]}else{const t=Ip({op:e,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,layer:r,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[t.layer,t.referenceIds]}const g=b.getPossibleOperation(i);if(!g)throw new Error(`Can't create operation ${e} because it's incompatible with the data view`);return Xp((Boolean(g.isBucketed)?Fp:Ap)(r,c?b.buildColumn({...h,layer:r,referenceIds:d},c):b.buildColumn({...h,layer:r,referenceIds:d}),a,s,l,m),i)}const v=null===(g=(null!==(f=t.incompleteColumns)&&void 0!==f?f:{})[a])||void 0===g?void 0:g.sourceField,y=v?i.getFieldByName(v):void 0;if(!n&&y){const e=b.getPossibleOperationForField(y);if(!e)throw new Error(`Tried to create an invalid operation ${b.type} using previously selected field ${y.name}`);return Xp(Boolean(e.isBucketed)?Fp(t,b.buildColumn({...h,layer:t,field:y}),a,s,l,m):Ap(t,b.buildColumn({...h,layer:t,field:y}),a),i)}var x;if(!n)return{...t,incompleteColumns:{...null!==(x=t.incompleteColumns)&&void 0!==x?x:{},[a]:{operationType:e}}};const j=b.getPossibleOperationForField(n);var O;if(!j)return{...t,incompleteColumns:{...null!==(O=t.incompleteColumns)&&void 0!==O?O:{},[a]:{operationType:e,sourceField:n.name}}};const I=b.buildColumn({...h,layer:t,field:n},c);return Xp((Boolean(j.isBucketed)?Fp:Ap)(t,I,a,s,l,m),i)}function Tp({operationDefinition:e,layer:t,previousColumn:a,indexPattern:n,previousDefinition:i,columnId:s},{shouldResetLabel:l}){const r={columns:t.columns,previousColumn:a,indexPattern:n};let o=t;const u=e.buildColumn({...r,layer:o},"params"in a?a.params:void 0,Rf);"fullReference"===i.input&&a.references.forEach((e=>{o=Rp({layer:o,columnId:e,indexPattern:n})}));const c={...o,columns:{...o.columns,[s]:u}};let d;try{d=u.params.formula?Ud(s,u,c,{indexPattern:n}).layer:c}catch(e){d=c}const p=d.columns[s];return!l&&a.customLabel&&(p.customLabel=!0,p.label=a.label),Xp(Dp({...o,columnOrder:Np(d),columns:d.columns},s),n)}function wp({layer:e,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,initialParams:l,shouldResetLabel:r,shouldCombineField:o}){const u=e.columns[t];if(!u)throw new Error("Can't replace column because there is no prior column");const c=n!==u.operationType,d=Rf[n],p=Rf[u.operationType];if(!d)throw new Error("No suitable operation found for given parameters");const m={columns:e.columns,indexPattern:a,previousColumn:u};if(c){let l={...e};if(l=Yp(l,t),"managedReference"===p.input&&d.input!==p.input){l=kp(p,u,l,a);const o=Mp({layer:l,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,incompleteParams:u});return!r&&u.customLabel&&o.columns[t]&&u.label!==p.getDefaultLabel(u,l.columns,a)&&(o.columns[t].customLabel=!0,o.columns[t].label=u.label),o.incompleteColumns&&o.incompleteColumns[t]?{...e,incompleteColumns:o.incompleteColumns}:o}if("fullReference"===d.input)return function({layer:e,columnId:t,previousColumn:a,op:n,indexPattern:i,visualizationGroups:s}){const l=Rf[n];if("fullReference"!==l.input)throw new Error("Requirements for transitioning are not met");let r=!1,o=!1;const u="references"in a?[...a.references]:[],c=l.requiredReferences.map((t=>{const n=Object(kt.a)();if(u.length){const a=e.columns[u[0]];if(Qp({validation:t,column:a}))return u.shift()}if(!r&&Qp({validation:t,column:a})){r=!0;const t={...e,columns:{...e.columns,[n]:{...a,filter:l.filterable?void 0:a.filter,timeShift:l.shiftable?void 0:a.timeShift}}};return e=Xp(Dp({...t,columnOrder:Np(t)},n),i),n}if(t.input.includes("none")){const a=Df.filter((e=>{if("none"===e.input)return Wp({validation:t,operationType:e.type,indexPattern:i})}));if(1===a.length)return e=Mp({layer:e,columnId:n,op:a[0].type,indexPattern:i,visualizationGroups:s}),n}if(!o&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField),r=Df.filter((e=>"field"===e.input&&Wp({validation:t,operationType:e.type,indexPattern:i}))).sort(zf(l)),u=r.filter((e=>{if(l)return Wp({validation:t,operationType:e.type,field:l,indexPattern:i})}));if(u.length>0)return o=!0,e=Mp({layer:e,columnId:n,op:u[0].type,indexPattern:i,field:i.getFieldByName(a.sourceField),visualizationGroups:s}),n;if(1===r.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[n]:{operationType:r[0].type}}},n}if(u.length){const a=e.columns[u[0]];if(a&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField);if(l){const a=Df.filter((e=>"field"===e.input&&Wp({validation:t,operationType:e.type,field:l,indexPattern:i}))).sort(zf(l));if(a.length>0)return e=Mp({layer:e,columnId:n,op:a[0].type,indexPattern:i,field:l,visualizationGroups:s}),n}}}return n}));return u.length&&u.forEach((t=>{e=Rp({layer:e,columnId:t,indexPattern:i})})),e={...e,columns:{...e.columns,[t]:l.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:a})}},Xp(Dp({...e,columnOrder:Np(e)},t),i)}({layer:l,columnId:t,previousColumn:u,op:n,indexPattern:a,visualizationGroups:s});if("fullReference"===p.input&&1===u.references.length){const s=u.references[0],r=e.columns[s];if(r){const e=Rf[r.operationType];if(e.type===n){l=Rp({layer:l,columnId:s,indexPattern:a});const n=jp(Cp({...r},u),e,u);return l={...l,columnOrder:Np(l),columns:{...l.columns,[t]:n}},Xp(Dp(l,t),a)}if(!i&&"sourceField"in r&&"field"===e.input&&"field"===d.input){const e=a.getFieldByName(r.sourceField);e&&d.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===d.input)return Tp({operationDefinition:d,layer:l,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});if("none"===d.input){let e=d.buildColumn({...m,layer:l});e=Cp(e,u),l=kp(p,u,l,a);const n={...l,columns:{...l.columns,[t]:e}};return Xp(Dp({...n,columnOrder:Np(n)},t),a)}if(!i){var g;let a={operationType:n};if("fullReference"===p.input){const t=u.references[0],n=e.columns[t];n&&(a=jp(a,Rf[n.operationType],u))}return{...l,incompleteColumns:{...null!==(g=l.incompleteColumns)&&void 0!==g?g:{},[t]:a}}}var f;if(!d.getPossibleOperationForField(i))return{...l,incompleteColumns:{...null!==(f=l.incompleteColumns)&&void 0!==f?f:{},[t]:{operationType:n}}};l=kp(p,u,l,a);let o=d.buildColumn({...m,layer:l,field:i});r||(o=Cp(o,u));const c={...l,columns:{...l.columns,[t]:o}};return Xp(Dp({...c,columnOrder:Np(c)},t),a)}if("field"===d.input&&i&&"sourceField"in u&&(u.sourceField!==i.name||null!=d&&d.getParamsForMultipleFields)){let n=d.onFieldChange(u,i,o?null==l?void 0:l.params:void 0);r||(n=Cp(n,u));const s=Yp({...e,columns:{...e.columns,[t]:n}},t);return Xp(Dp({...s,columnOrder:Np(s)},t),a)}if("managedReference"===d.input)return Tp({operationDefinition:d,layer:e,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});throw new Error("nothing changed")}function kp(e,t,a,n){let i=a;if("managedReference"===e.input){const[e]=Object.entries(a.columns).find((([e,a])=>a===t))||[];null!=e&&(i=Rp({layer:a,columnId:e,indexPattern:n}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=Rp({layer:a,columnId:e,indexPattern:n})})),i}function Ep({layer:e,columnId:t,op:a,field:n,indexPattern:i,filterOperations:s,visualizationGroups:l,dateRange:r}){const o=e.columns[t];if(!o)return!0;if(o.operationType===a)return!0;try{var u,c,d;const o=wp({layer:e,columnId:t,op:a,field:n,indexPattern:i,visualizationGroups:l}),p=Rf[a],m=o.columns[t];return Boolean(m)&&!(null!==(u=o.incompleteColumns)&&void 0!==u&&u[t])&&s(m)&&!(null!==(c=p.getErrorMessage)&&void 0!==c&&null!==(d=c.call(p,o,t,i,r))&&void 0!==d&&d.length)}catch(e){return!1}}function Cp(e,t){const a={...e},n=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||n&&i||(a.customLabel=!0,a.label=t.label),a}function Fp(e,t,a,n,i,s){const[l,r]=Object(pa.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),o=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let u=[];u=o>-1&&"terms"===t.operationType&&!s?[...l.slice(0,o),a,...l.slice(o,l.length),...r]:[...l,a,...r],u=Sp(n,u,i,a);const c={...Yp(e,a),columns:{...e.columns,[a]:t},columnOrder:u};return Dp({...c,columnOrder:Np(c)},a)}function Sp(e,t,a,n){var i;if(a&&(null===(i=e.find((e=>e.groupId===a)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const s={};return t.forEach((e=>{const l=i.findIndex((t=>e===n&&t.groupId===a||t.accessors.some((t=>t.columnId===e))));s[e]=-1!==l?l:t.length})),[...t].sort(((e,t)=>s[e]-s[t]))}return t}function Ap(e,t,a){const n={...Yp(e,a),columns:{...e.columns,[a]:t}};return Dp({...n,columnOrder:Np(n)},a)}function Pp(e){return Df.sort(zf(e)).filter((t=>{if("field"!==t.input)return;const a=t.getPossibleOperationForField(e);return a&&!a.isBucketed&&"number"===a.dataType}))}function _p({layer:e,columnId:t,paramName:a,value:n}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[a]:n}}}}}function Lp(e){const t={...e.columns};return Object.keys(t).forEach((a=>{const n=t[a];if(null!=n&&n.operationType){const i=Rf[n.operationType];t[a]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:t},a):n}})),{...e,columns:t}}function Dp(e,t){const a={...e.columns};return Object.keys(a).forEach((n=>{if(n!==t){const t=a[n],i=Rf[t.operationType];a[n]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:a},n):t}})),{...e,columns:a}}function Rp({layer:e,columnId:t,indexPattern:a}){const n=e.columns[t];if(!n){const a={...e.incompleteColumns||{}};return delete a[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:a}}const i="references"in n?n.references:[],s={...e.columns};delete s[t];let l=Dp({...e,columns:s},t);i.forEach((e=>{l=Rp({layer:l,columnId:e,indexPattern:a})}));const r={...l.incompleteColumns||{}};return delete r[t],Xp({...l,columnOrder:Np(l),incompleteColumns:r},a)}function Np(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(pa.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}function Bp(e){const[t,a]=Object(pa.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(pa.partition)(t,(t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.isBucketed})),a]}function zp(e,t,a){return Rf[e.operationType].isTransferable(e,t,Rf)&&(!("references"in e)||e.references.every((e=>zp(a.columns[e],t,a))))}function Vp(e,t){const a=Object(pa.pickBy)(e.columns,(a=>zp(a,t,e))),n=Object(pa.mapValues)(a,(e=>{const a=Rf[e.operationType];return a.transfer?a.transfer(e,t):e})),i=e.columnOrder.filter((e=>n[e]));return{...e,indexPatternId:t.id,columns:n,columnOrder:i}}function Gp(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}const qp=k()((e=>{const t={};for(const[a,n]of Object.entries(e.columns))if("references"in n)for(const e of n.references)t[e]=a;return t}));function $p(e,t){const a=qp(e);let n=t;for(;Gp(e,n);)n=a[n];return n}function Hp(e,t){const a=[];return function t(n){const i=e.columns[n];if(i&&"references"in i){const n=i.references.filter((t=>Boolean(e.columns[t])));a.push(...n),n.forEach(t)}}(t),a}function Up(e){return e.columnOrder.some((t=>{const a=e.columns[t];if(a)return ip("terms",a)&&a.params.size>5}))}function Wp({operationType:e,validation:t,field:a,indexPattern:n}){const i=Rf[e];let s=!0;if(a&&"field"===i.input){const n=i.getPossibleOperationForField(a);s=Boolean(n)&&t.validateMetadata(n,e,a.name)}else if("none"===i.input){const a=i.getPossibleOperation(n);s=Boolean(a)&&t.validateMetadata(a,e)}else if("fullReference"===i.input){const a=i.getPossibleOperation(n);s=Boolean(a)&&t.validateMetadata(a,e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&s}function Xp(e,t){const a={...e.columns};return e.columnOrder.forEach((e=>{const n=a[e];n.customLabel||(a[e]={...n,label:Rf[n.operationType].getDefaultLabel(n,a,t)})})),{...e,columns:a}}function Yp(e,t){var a;const n={...null!==(a=e.incompleteColumns)&&void 0!==a?a:{}};return delete n[t],{...e,incompleteColumns:n}}function Qp({column:e,validation:t}){if(!e)return!1;const a=e.operationType,n=Rf[a];if(!n)throw new Error("No suitable operation definition found for "+a);return t.input.includes(n.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===Rf[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e,a,"sourceField"in e?e.sourceField:void 0)}function Kp(e,t){const a={};Object.entries(t).forEach((([e,t])=>{a[e]="references"in t?[...t.references]:[]}));const n=a[e],i=[];for(;n.length>0;){const e=n.shift();i.push([e,t[e]]),n.push(...a[e])}return i.filter((([,e])=>e))}const Zp=({value:e,onChange:t,minValue:a=1,maxValue:n=1e4,label:i=u.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),disabled:l})=>{const[r,o]=Object(s.useState)(String(e));Object(M.t)((()=>{if(""===r)return;const e=Number(r);t(Math.min(n,Math.max(e,a)))}),{skipFirstRender:!0},256,[r]);const c=""===r,d=!c&&Number(r)>n,p=!c&&Number(r)<a;return Object(v.jsx)(f.EuiFormRow,{label:i,display:"rowCompressed",fullWidth:!0,isInvalid:d||p,error:d?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:p?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:a}})]:null},Object(v.jsx)(f.EuiFieldNumber,{fullWidth:!0,min:a,max:n,step:1,value:r,compressed:!0,isInvalid:d||p,disabled:l,onChange:({currentTarget:e})=>o(e.value),"aria-label":i,onBlur:()=>{if(""===r)return o(String(e));const t=Number(r);o(String(Math.min(n,Math.max(t,a))))},"data-test-subj":"indexPattern-terms-values"}))};var Jp=a(690),em=a(664),tm=a(665),am=(a(444),a(148)),nm=a(662),im=a(628);function sm({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:a,selectedField:n,operationByField:i,onChoose:l,onDeleteColumn:r,fieldIsInvalid:o,markAllFieldsCompatible:c,"data-test-subj":d,showTimeSeriesDimensions:p}){var m,g;const{hasFieldData:f}=Object(am.b)(),b=Object(s.useMemo)((()=>{const n=[...i.keys()].sort(),s=null!=t?t:a;function l(e){return!s||i.get(e).has(s)}const[r,o]=Object(pa.partition)(n,(t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)}));function d(t){return Object(M.p)(t,e,f)}function m(t){return t.filter((t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName})).map((t=>{var a,n;const r=c||l(t)?1:0,o=d(t),u=e.getFieldByName(t);return{label:null!==(a=null===(n=e.getFieldByName(t))||void 0===n?void 0:n.displayName)&&void 0!==a?a:t,value:{type:"field",field:t,dataType:u?Object(im.a)(u):void 0,operationType:s&&l(t)?s:i.get(t).values().next().value},exists:o,compatible:r,"data-test-subj":`lns-fieldOption${r?"":"Incompatible"}-${t}`}})).sort(((e,t)=>t.compatible-e.compatible))}const[g,b]=Object(pa.partition)(o,(t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.meta})),[h,v]=Object(pa.partition)(b,d),y=(e,t)=>e.length>0&&{label:t,options:m(e)},x=t=>{var a;return p&&(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.timeSeriesDimension)},[j,O]=Object(pa.partition)(h,x),[I,T]=Object(pa.partition)(v,x),w=y(j.concat(I),u.i18n.translate("xpack.lens.indexPattern.timeSeriesFieldsLabel",{defaultMessage:"Time series dimensions"})),k=y(O,u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),E=y(T,u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),C=y(g,u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...m(r),w,k,E,C].filter(Boolean)}),[i,t,a,e,f,c,p]);return Object(v.jsx)(nm.a,{activeField:a&&n?{label:null!==(m=a&&n&&(null===(g=e.getFieldByName(n))||void 0===g?void 0:g.displayName))&&void 0!==m?m:n,value:{type:"field",field:n}}:void 0,options:b,onChoose:e=>{e&&e.field!==n&&l(e)},onDelete:r,fieldIsInvalid:Boolean(t||o),"data-test-subj":null!=d?d:"indexPattern-dimension-field"})}const lm=1,rm=new Set(["string","boolean","number","ip"]),om=1e3,um=Object(f.htmlIdGenerator)();function cm(e){return null!=e.value}function dm({column:e,onChange:t,indexPattern:a,operationSupportMatrix:n,invalidFields:i,showTimeSeriesDimensions:r}){const o=Object(s.useCallback)((e=>t(e.filter(cm).map((({value:e})=>e)))),[t]),{wrappedValues:c,rawValuesLookup:d}=Object(s.useMemo)((()=>{var t;const a=e?[e.sourceField,...(null===(t=e.params)||void 0===t?void 0:t.secondaryFields)||[]]:[];return{wrappedValues:a.map((e=>({id:um(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:p,handleInputChange:m}=Object(je.a)({onChange:o,value:c}),g=Object(s.useCallback)(((e,t=0)=>{const n=[...p];a.getFieldByName(e.field)&&(n[t]={id:um(),value:e.field},m(n))}),[p,a,m]),f=1===p.length||p.filter((({isNew:e})=>!e)).length<2,b=p.filter((({isNew:e})=>!e));return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Jp.a,{onDragEnd:e=>{m(e)},droppableId:"TOP_TERMS_DROPPABLE_AREA",items:p,bgColor:"subdued"},p.map((({id:t,value:s,isNew:l},o,c)=>{var h;const y=[...n.operationByField.keys()].filter((e=>{if(e===s)return!0;const t=a.getFieldByName(e);return 0===o?!d.has(e)&&t&&rm.has(t.type):!d.has(e)&&t&&!t.scripted&&rm.has(t.type)})).reduce(((e,t)=>{const a=n.operationByField.get(t);return a&&e.set(t,a),e}),new Map),x=Boolean(s&&((null===(h=a.getFieldByName(s))||void 0===h?void 0:h.scripted)&&b.length>1||(null==i?void 0:i.includes(s)))),j=(null!=s?s:"newField")+t;return Object(v.jsx)(Jp.b,{id:j,key:j,idx:o,onRemoveClick:()=>{m(c.filter(((e,t)=>t!==o)))},removeTitle:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonLabel",{defaultMessage:"Delete"}),isNotRemovable:f&&!l,isNotDraggable:c.length<2,"data-test-subj":"indexPattern-terms",Container:em.a,isInsidePanel:!0},Object(v.jsx)(sm,{fieldIsInvalid:x,currentIndexPattern:a,operationByField:y,selectedOperationType:e.operationType,selectedField:s,autoFocus:l,onChoose:e=>{g(e,o)},isInvalid:x,"data-test-subj":1!==p.length?`indexPattern-dimension-field-${o}`:void 0,showTimeSeriesDimensions:p.length<2&&r}))}))),Object(v.jsx)(tm.a,{onClick:()=>{m([...p,{id:um(),value:void 0,isNew:!0}])},"data-test-subj":"indexPattern-terms-add-field",label:u.i18n.translate("xpack.lens.indexPattern.terms.addaFilter",{defaultMessage:"Add field"}),isDisabled:"rare"===e.params.orderBy.type||"significant"===e.params.orderBy.type||p.length>3}))}function pm(e,t){return e?u.i18n.translate("xpack.lens.indexPattern.terms.scriptedFieldErrorShort",{defaultMessage:"Scripted fields are not supported when using multiple fields"}):t.length?u.i18n.translate("xpack.lens.indexPattern.terms.invalidFieldsErrorShort",{defaultMessage:"Invalid {invalidFieldsCount, plural, one {field} other {fields}}: {invalidFields}. Check your data view or pick another field.",values:{invalidFieldsCount:t.length,invalidFields:t.map((e=>`"${e}"`)).join(", ")}}):void 0}function mm({layer:e,selectedColumn:t,columnId:a,indexPattern:n,operationSupportMatrix:i,updateLayer:s,onDeleteColumn:l,incompleteField:r,incompleteOperation:o,incompleteParams:c,currentFieldIsInvalid:d,helpMessage:p,groupId:m,dimensionGroups:g,operationDefinitionMap:b}){const h=t&&b[t.operationType],y=("fullReference"!==(null==h?void 0:h.input)&&"managedReference"!==(null==h?void 0:h.input)||o&&"field"===b[o].input)&&gm(t,Boolean(o),null==h?void 0:h.input,d);return Object(v.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:Boolean(o||d),error:y,labelAppend:!y&&p},Object(v.jsx)(sm,{fieldIsInvalid:d,currentIndexPattern:n,operationByField:i.operationByField,selectedOperationType:t?t.operationType:o,selectedField:null!=r?r:null==t?void 0:t.sourceField,incompleteOperation:o,onDeleteColumn:l,onChoose:t=>s(xp({layer:e,columnId:a,indexPattern:n,op:t.operationType,field:n.getFieldByName(t.field),visualizationGroups:g,targetGroup:m,incompleteParams:c})),showTimeSeriesDimensions:Jd(e,n,m,g)}))}function gm(e,t,a,n){return e&&t?"field"===a?u.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):u.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):n?u.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your data view or pick another field."}):void 0}var fm=a(216),bm=(a(455),a(460),a(666));const hm=({value:e,onChange:t,placeholder:a,inputRef:n,onSubmit:i,dataTestSubj:l,compressed:r})=>{const{inputValue:o,handleInputChange:c}=Object(je.a)({value:e,onChange:t},{allowFalsyValue:!0}),d=Object(s.useRef)(!1);return Object(v.jsx)(f.EuiFieldText,{"data-test-subj":l||"lens-labelInput",value:o,onChange:e=>c(e.target.value),fullWidth:!0,placeholder:a||"",inputRef:e=>{n&&e&&(n.current=e)},onKeyDown:()=>{d.current=!0},onKeyUp:({key:e})=>{d.current&&f.keys.ENTER===e&&i&&i(),d.current=!1},prepend:u.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:r})};a(465);const vm=({children:e,label:t,isInline:a,...n})=>a?Object(v.jsx)("div",{"data-test-subj":n["data-test-subj"]},l.a.cloneElement(e,{prepend:Object(v.jsx)(f.EuiFormLabel,{className:"lnsIndexPatternDimensionEditor__labelCustomRank"},t)})):Object(v.jsx)(f.EuiFormRow,i()({},n,{label:t}),e),ym=({filter:e,setFilter:t,indexPattern:a,button:n,isOpen:i,triggerClose:r})=>{const o=l.a.useRef(),[u,c]=Object(s.useState)((()=>e)),d=()=>{c({...u,input:e.input}),r()};return Object(v.jsx)(f.EuiPopover,{"data-test-subj":"indexPattern-filters-existingFilterContainer",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:i,ownFocus:!0,closePopover:d,button:n},Object(v.jsx)(bm.a,{isInvalid:!Object(gi.a)(u.input,a),value:u.input,dataView:a.id?{type:"id",value:a.id}:{type:"title",value:a.title},disableAutoFocus:!0,onChange:n=>{c({...u,input:n}),Object(gi.a)(n,a)&&t({...e,input:n})},onSubmit:()=>{o.current&&o.current.focus()},appName:Wt.LENS_APP_NAME,services:Object(Cl.useKibana)().services}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(hm,{value:u.label||"",onChange:a=>{c({...u,label:a}),t({...e,label:a})},placeholder:(p=u.input.query,""===p?Im:"object"===p?JSON.stringify(p):String(p)),inputRef:o,onSubmit:d,dataTestSubj:"indexPattern-filters-label"}));var p},xm=Object(f.htmlIdGenerator)(),jm="filters",Om=u.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),Im=u.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),Mm={input:{query:"",language:"kuery"},label:""},Tm={type:jm,displayName:Om,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>Om,buildColumn({previousColumn:e},t){var a;let n={filters:null!==(a=null==t?void 0:t.filters)&&void 0!==a?a:[Mm]};var i,s,l,r;return e&&ip("terms",e)&&(n={filters:null!==(i=null==t?void 0:t.filters)&&void 0!==i?i:[{label:"",input:{query:`"${e.sourceField}" : *`,language:"kuery"}},...null!==(s=null===(l=e.params)||void 0===l||null===(r=l.secondaryFields)||void 0===r?void 0:r.map((e=>({label:"",input:{query:`"${e}" : *`,language:"kuery"}}))))&&void 0!==s?s:[]]}),{label:Om,dataType:"string",operationType:jm,scale:"ordinal",isBucketed:!0,params:n}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,a)=>{var n;const i=null===(n=e.params.filters)||void 0===n?void 0:n.filter((e=>Object(gi.a)(e.input,a)));return Object(Ut.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[Mm]).map(An.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,indexPattern:n,paramEditorUpdater:i})=>{const s=a.params.filters;return Object(v.jsx)(f.EuiFormRow,{fullWidth:!0},Object(v.jsx)(wm,{filters:s,setFilters:a=>i(_p({layer:e,columnId:t,paramName:jm,value:a})),indexPattern:n,defaultQuery:Mm}))},getMaxPossibleNumValues:e=>e.params.filters.length,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.filters.documentation.quick",{defaultMessage:"\n    Divides values into predefined subsets.\n      "})},wm=({filters:e,setFilters:t,indexPattern:a,defaultQuery:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:xm()}))))),d=e=>{t(e.map((e=>Object(pa.omit)(e,"id")))),c(e)},p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Jp.a,{onDragEnd:d,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:o},null==o?void 0:o.map(((e,t,n)=>{const s=!Object(gi.a)(e.input,a),l=e.id;return Object(v.jsx)(Jp.b,{id:l,key:l,idx:t,isInvalid:s,invalidMessage:u.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>(e=>d(o.filter((t=>t.id!==e))))(e.id),removeTitle:u.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===n.length,isNotDraggable:1===n.length},Object(v.jsx)(ym,{"data-test-subj":"indexPattern-filters-existingFilterContainer",isOpen:e.id===i,triggerClose:()=>p(""),indexPattern:a,filter:e,setFilter:e=>{((e,t,a)=>{d(o.map((n=>n.id===e?{...n,input:t,label:a}:n)))})(e.id,e.input,e.label)},button:Object(v.jsx)(f.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>p(e.id),color:s?"danger":"text",title:u.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||Im)}))}))),Object(v.jsx)(tm.a,{onClick:()=>{(()=>{const e=xm();d([...o,{...n,id:e}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))},km=" â€º ";function Em(e,t,a){var n;const i=e.columns[t],s=[i.sourceField,...null!==(n=i.params.secondaryFields)&&void 0!==n?n:[]],l=s.filter((e=>{var t;return null===(t=a.getFieldByName(e))||void 0===t?void 0:t.scripted}));return s.length<2||!l.length?[]:[{uniqueId:Ft.R,message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleTermsAndScriptedFields",{defaultMessage:"Scripted fields are not supported when using multiple fields, found {fields}",values:{fields:l.join(", ")}})}]}function Cm(e,t){const a=t.split(km);return e.map(((e,t)=>`${e}: ${"*"!==a[t]?`"${a[t]}"`:a[t]}`)).join(" AND ")}function Fm(e,t){return 1===e.length?t:t.split(km).map(((t,a)=>null==t?u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}):`${e[a]}: ${t}`)).join(km)}function Sm(e){return"object"==typeof e&&null!=e&&"keys"in e&&Array.isArray(e.keys)}function Am(e,t,a){const n=new Set;return Object.entries(e.columns).forEach((([e,t])=>{"references"in t&&t.references.forEach((e=>{n.add(e)}))})),Object(pa.uniq)(Object.entries(e.columns).filter((([t,a])=>Rf[a.operationType].shiftable&&(!Gp(e,t)||a.timeShift))).map((([e,t])=>t.timeShift||""))).length>1?[{uniqueId:Ft.S,message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(n,i,s,l)=>{var r,o,c,d,p;const m=e.columns[t],g=[m.sourceField,...null!==(r=null===(o=m.params)||void 0===o?void 0:o.secondaryFields)&&void 0!==r?r:[]],f=(null===(c=s.activeData)||void 0===c||null===(d=c[l].columns.find((({id:e})=>e===t)))||void 0===d?void 0:d.meta.field)===g[0];let b=Object(pa.uniq)((null===(p=s.activeData)||void 0===p?void 0:p[l].rows.map((e=>e[t])).filter((e=>g.length>1?Sm(e)&&"__other__"!==e.keys[0]:"string"==typeof e&&"__other__"!==e)).map((e=>Sm(e)?e.keys.join(km):e)))||[]);if((!f||0===b.length)&&1===g.length){var h;const e=await n.dataViews.get(a.id);b=(null===(h=(await Object(fm.a)({services:{data:n},dataView:e,field:a.getFieldByName(g[0]),dslQuery:Object(po.buildEsQuery)(a,s.query,s.filters,Object(Fl.getEsQueryConfig)(i.uiSettings)),fromDate:s.dateRange.fromDate,toDate:s.dateRange.toDate,size:m.params.size})).topValues)||void 0===h?void 0:h.buckets.map((({key:e})=>String(e))))||[]}return g.length>1&&0===b.length&&(b=[Array(g.length).fill("*").join(km)]),{...e,columns:{...e.columns,[t]:{label:u.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:g.length>1?g.join(km):g[0]}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:b.length>0?b.map((e=>({input:{query:1===g.length?`${g[0]}: "${e}"`:Cm(g,e),language:"kuery"},label:Fm(g,e)}))):[{input:{query:"*",language:"kuery"},label:Im}]}}}}}}}]:[]}function Pm(e){const t=ip("percentile",e);return!t||t&&Number.isInteger(e.params.percentile)}function _m(e){const t=ip("percentile_rank",e);return!t||t&&Number.isInteger(e.params.value)}function Lm(e,t){const a=e.columns[t];return a&&!a.isBucketed&&function(e){return"last_value"!==e.operationType||["number","date"].includes(e.dataType)&&!e.params.showArrayValues}(a)&&_m(a)&&Pm(a)&&!("references"in a)&&!Gp(e,t)}function Dm(e,t){if("string"==typeof e){const a=null==t?void 0:t.getFieldByName(e);return a&&a.scripted}return e.scripted}function Rm(e,t,a){const n=[];var i,s;t&&"sourceField"in t&&(t.sourceField&&n.push(t.sourceField),ip("terms",t)&&n.push(...null!==(i=null===(s=t.params)||void 0===s?void 0:s.secondaryFields)&&void 0!==i?i:[])),a&&n.push("string"==typeof a?a:a.name||a.displayName);const l=n.map((t=>e.getFieldByName(t))),r=[],o=[],u=Boolean(t&&1===l.length);return n.forEach(((e,t)=>{const a=l[t];(!(a&&rm.has(a.type)&&a.aggregatable&&"counter"!==a.timeSeriesMetric)||a.aggregationRestrictions&&!a.aggregationRestrictions.terms||!u&&Dm(a)?o:r).push(e)})),{allFields:l,validFields:r,invalidFields:o}}function Nm(e,t){const a=e.params.otherBucket;return(a||void 0===a)&&t<om}const Bm=(e,t)=>{const a=null==e?void 0:e.map((e=>({label:String(e)}))),n=null==t?void 0:t.map((e=>({label:String(e)})));return{...(null==a?void 0:a.length)&&{include:a},...(null==n?void 0:n.length)&&{exclude:n}}},zm=({include:e,exclude:t,tableRows:a,columnId:n,isNumberField:i,includeIsRegex:r,excludeIsRegex:o,updateParams:c})=>{const[d,p]=Object(s.useState)(Bm(e,t)),[m,g]=Object(s.useState)(void 0),[b,h]=Object(s.useState)({include:r,exclude:o}),[y,x]=Object(s.useState)({include:r?null==e?void 0:e[0]:"",exclude:o?null==t?void 0:t[0]:""});Object(s.useEffect)((()=>{i&&h({include:!1,exclude:!1})}),[i]),Object(s.useEffect)((()=>{var e;if(null!=d&&null!==(e=d.include)&&void 0!==e&&e.length)return;const t=Object(pa.uniq)(null==a?void 0:a.map((e=>e[n]))).filter((e=>"__other__"!==e)),i=null==t?void 0:t.map((e=>({label:String(e)})));g(i)}),[a]);const j=(e,t)=>{const a={...d,[t]:e};p(a);const n=e.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(t,n,`${t}IsRegex`,!1)},O=(e,t=[],a)=>{var n;const i={label:e};let s=[];s=[...null!==(n=d[a])&&void 0!==n?n:[],i];const l={...d,[a]:s};p(l);const r=s.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(a,r,`${a}IsRegex`,!1)},I=Object(s.useCallback)((e=>{x({...y,include:e}),c("include",[null!=e?e:""],"includeIsRegex",!0)}),[y,c]),M=Object(s.useCallback)((e=>{x({...y,exclude:e}),c("exclude",[null!=e?e:""],"excludeIsRegex",!0)}),[y,c]),{inputValue:T,handleInputChange:w}=Object(je.a)({onChange:I,value:y.include}),{inputValue:k,handleInputChange:E}=Object(je.a)({onChange:M,value:y.exclude});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"m"}),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),"data-test-subj":"lens-include-terms-regex-switch",compressed:!0,checked:b.include,onChange:e=>{const a=e.target.checked;h({...b,include:a}),x({...y,include:""}),p(Bm([],t)),c("include",[],"includeIsRegex",a)}})},b.include?Object(v.jsx)(f.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),"data-test-subj":"lens-include-terms-regex-input",value:T,onChange:e=>{w(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(v.jsx)(f.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.include,onChange:e=>j(e,"include"),onCreateOption:(e,t)=>O(e,t,"include"),isClearable:!0,"data-test-subj":"lens-include-terms-combobox",autoFocus:!0})),Object(v.jsx)(f.EuiSpacer,{size:"m"}),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),compressed:!0,checked:b.exclude,onChange:t=>{const a=t.target.checked;h({...b,exclude:a}),x({...y,exclude:""}),p(Bm(e,[])),c("exclude",[],"excludeIsRegex",a)}})},b.exclude?Object(v.jsx)(f.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),value:k,onChange:e=>{E(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(v.jsx)(f.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.exclude,onChange:e=>j(e,"exclude"),onCreateOption:(e,t)=>O(e,t,"exclude"),isClearable:!0,"data-test-subj":"lens-exclude-terms-combobox",autoFocus:!0})))};function Vm(e){var t;return!(null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>["double","float","half_float","scaled_float"].includes(e))))}function Gm(e){var t;return null==e||null===(t=e.esTypes)||void 0===t?void 0:t.some((e=>"keyword"===e))}function qm(e){return"rare"===e.type||"significant"===e.type}const $m=u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"});function Hm(e,t=0,a=!1,n=!1,i=0){return a?u.i18n.translate("xpack.lens.indexPattern.rareTermsOf",{defaultMessage:"Rare values of {name}",values:{name:null!=e?e:$m}}):n?u.i18n.translate("xpack.lens.indexPattern.significantTermsOf",{defaultMessage:"Significant values of {name}",values:{name:null!=e?e:$m}}):t?u.i18n.translate("xpack.lens.indexPattern.multipleTermsOf",{defaultMessage:"Top values of {name} + {count} {count, plural, one {other} other {others}}",values:{name:null!=e?e:$m,count:t}}):u.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top {numberOfTermsLabel}{termsCount, plural, one {value} other {values}} of {name}",values:{name:null!=e?e:$m,termsCount:i,numberOfTermsLabel:i>1?`${i} `:""}})}function Um(e){var t;return{id:null!==(t=e.secondaryFields)&&void 0!==t&&t.length?"multi_terms":"terms"}}const Wm=Object(f.htmlIdGenerator)()(),Xm={type:"terms",displayName:u.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getCurrentFields:e=>{var t,a;return[e.sourceField,...null!==(t=null==e||null===(a=e.params)||void 0===a?void 0:a.secondaryFields)&&void 0!==t?t:[]]},getParamsForMultipleFields:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{const i=new Set(Rm(n,e).validFields),s=Rm(n,t,a).validFields;for(const e of s)i.add(e);i.delete(e.sourceField);const l=[...i];return{secondaryFields:l,parentFormat:Um({...e.params,secondaryFields:l})}},canAddNewField:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{var i,s,l;if(qm(e.params.orderBy))return!1;const r=new Set(Rm(n,e).validFields),{validFields:o}=Rm(n,t,a),u=o.filter((e=>!r.has(e))).length;return!!u&&u+(null!==(i=null===(s=e.params)||void 0===s||null===(l=s.secondaryFields)||void 0===l?void 0:l.length)&&void 0!==i?i:0)<=3},getDefaultVisualSettings:e=>{var t,a;return{truncateText:Boolean(!(null!==(t=e.params)&&void 0!==t&&null!==(a=t.secondaryFields)&&void 0!==a&&a.length))}},getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(rm.has(a)&&t&&"counter"!==n&&(!e||e.terms))return{dataType:a,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Am(e,t,a),...Em(e,t,a)],getNonTransferableFields:(e,t)=>Rm(t,e).invalidFields,isTransferable:(e,t)=>{const{allFields:a,invalidFields:n}=Rm(t,e);return Boolean(a.length&&0===n.length&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:a},n){var i,s,l,r,o,u,c,d,p,m;const g=Object.entries(e.columns).filter((([t])=>Lm(e,t))).map((([e])=>e))[0],f=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:Hm(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:null!==(i=null==n?void 0:n.size)&&void 0!==i?i:0===f?5:3,orderBy:null!==(s=null==n?void 0:n.orderBy)&&void 0!==s?s:g?{type:"column",columnId:g}:{type:"alphabetical",fallback:!0},orderAgg:"custom"===(null==n?void 0:n.orderBy.type)?null==n?void 0:n.orderAgg:void 0,orderDirection:null!==(l=null==n?void 0:n.orderDirection)&&void 0!==l?l:g?"desc":"asc",otherBucket:(null===(r=null==n?void 0:n.otherBucket)||void 0===r||r)&&!a.hasRestrictions,missingBucket:null!==(o=null==n?void 0:n.missingBucket)&&void 0!==o&&o,parentFormat:null!==(u=null==n?void 0:n.parentFormat)&&void 0!==u?u:{id:"terms"},include:null!==(c=null==n?void 0:n.include)&&void 0!==c?c:[],exclude:null!==(d=null==n?void 0:n.exclude)&&void 0!==d?d:[],includeIsRegex:null!==(p=null==n?void 0:n.includeIsRegex)&&void 0!==p&&p,excludeIsRegex:null!==(m=null==n?void 0:n.excludeIsRegex)&&void 0!==m&&m,secondaryFields:null==n?void 0:n.secondaryFields}}},toEsAggsFn:(e,t,a,n,i,s,l)=>{var r,o,c,d,p,m,g;if("rare"===(null===(r=e.params)||void 0===r?void 0:r.orderBy.type))return Object(Ut.buildExpressionFunction)("aggRareTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,max_doc_count:e.params.orderBy.maxDocCount}).toAst();const f=e.params.accuracyMode?Math.max(1e3,1.5*e.params.size+10):void 0;var b,h;if("significant"===(null===(o=e.params)||void 0===o?void 0:o.orderBy.type))return Object(Ut.buildExpressionFunction)("aggSignificantTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,size:e.params.size,shardSize:f,...(null===(b=e.params.include)||void 0===b?void 0:b.length)&&{include:e.params.include},...(null===(h=e.params.exclude)||void 0===h?void 0:h.length)&&{exclude:e.params.exclude}}).toAst();let v="_key";if("column"===(null===(c=e.params)||void 0===c?void 0:c.orderBy.type)){const t=n.columns[e.params.orderBy.columnId];v=String(s.indexOf(e.params.orderBy.columnId)),t&&_m(t)&&Pm(t)||(v="_key")}const y=e.params.orderAgg;let x;if(y){v="custom";const e=null==l?void 0:l[null==y?void 0:y.operationType];e&&"toEsAggsFn"in e&&(x=[{type:"expression",chain:[e.toEsAggsFn(y,`${t}-orderAgg`,a,n,i,s)]}])}return null!==(d=e.params)&&void 0!==d&&null!==(p=d.secondaryFields)&&void 0!==p&&p.length?Object(Ut.buildExpressionFunction)("aggMultiTerms",{id:t,enabled:!0,schema:"segment",fields:[e.sourceField,...e.params.secondaryFields],orderBy:v,order:e.params.orderDirection,orderAgg:x,size:e.params.size,shardSize:f,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"})}).toAst():Object(Ut.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:v,order:e.params.orderDirection,orderAgg:x,size:e.params.size,shardSize:f,...(null===(m=e.params.include)||void 0===m?void 0:m.length)&&{include:e.params.include},...(null===(g=e.params.exclude)||void 0===g?void 0:g.length)&&{exclude:e.params.exclude},includeIsRegex:Boolean(e.params.includeIsRegex),excludeIsRegex:Boolean(e.params.excludeIsRegex),otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst()},getDefaultLabel:(e,t,a)=>{var n,i;return Hm(null==a||null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName,null===(i=e.params.secondaryFields)||void 0===i?void 0:i.length,"rare"===e.params.orderBy.type,"significant"===e.params.orderBy.type,e.params.size)},onFieldChange:(e,t,a)=>{var n;const i={...e.params,secondaryFields:void 0,...a};return"format"in i&&"number"!==t.type&&delete i.format,i.parentFormat=Um(i),(!Vm(t)&&"rare"===i.orderBy.type||!Gm(t)&&"significant"===i.orderBy.type)&&(i.orderBy={type:"alphabetical"}),{...e,dataType:t.type,label:e.customLabel?e.label:Hm(t.displayName,null===(n=i.secondaryFields)||void 0===n?void 0:n.length,"rare"===i.orderBy.type,"significant"===i.orderBy.type,i.size),sourceField:t.name,params:i}},onOtherColumnChanged:(e,t)=>{const a=e.columns,n=a[t];if(("column"===n.params.orderBy.type||"alphabetical"===n.params.orderBy.type&&n.params.orderBy.fallback)&&(!("column"===n.params.orderBy.type?a[n.params.orderBy.columnId]:void 0)||"column"===n.params.orderBy.type&&!Lm(e,n.params.orderBy.columnId))){const t=Object.entries(e.columns).filter((([t])=>Lm(e,t))).map((([e])=>e))[0];return{...n,params:{...n.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}return n},renderFieldInput:function(e){var t,a,n,i;const{layer:l,selectedColumn:r,columnId:o,indexPattern:c,operationSupportMatrix:d,updateLayer:p,dimensionGroups:m,groupId:g,incompleteParams:b}=e,h=Object(s.useCallback)((e=>{const t=l.columns[o],[a,...n]=e,i=Object(pa.uniq)(e.map((e=>{var t;return null===(t=c.getFieldByName(e))||void 0===t?void 0:t.type}))),s=(1===i.length?i[0]:"string")||t.dataType,r={...t.params};"format"in r&&"number"!==s&&delete r.format;const u=c.getFieldByName(a);if((!Vm(u)&&"rare"===r.orderBy.type||!Gm(u)&&"significant"===r.orderBy.type)&&(r.orderBy={type:"alphabetical"}),1===e.length){const e=d.operationByField.get(a);if(!(null==e?void 0:e.has("terms"))){const t=null==e?void 0:e.values().next().value;return p(xp({layer:l,columnId:o,indexPattern:c,op:t,field:u,visualizationGroups:m,targetGroup:g,incompleteParams:b}))}}p({...l,columns:{...l.columns,[o]:{...t,dataType:s,sourceField:a,label:t.customLabel?t.label:Hm(null==u?void 0:u.displayName,e.length-1,"rare"===r.orderBy.type,"significant"===r.orderBy.type,r.size),params:{...r,secondaryFields:n,parentFormat:Um({...r,secondaryFields:n})}}}})}),[o,m,g,b,c,l,d.operationByField,p]),y=l.columns[o],x=gm(r,Boolean(e.incompleteOperation),"field",e.currentFieldIsInvalid);if(!y||!r||e.incompleteOperation||x&&(null===(t=r.params)||void 0===t||null===(a=t.secondaryFields)||void 0===a||!a.length))return Object(v.jsx)(mm,e);const j=Em(l,o,c).length>0,{invalidFields:O}=Rm(c,r);return Object(v.jsx)(f.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.terms.chooseFields",{defaultMessage:"{count, plural, zero {Field} other {Fields}}",values:{count:(null===(n=r.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.length)||0}}),fullWidth:!0,isInvalid:Boolean(j||O.length),error:pm(j,O)},Object(v.jsx)(dm,{column:r,indexPattern:c,operationSupportMatrix:d,onChange:h,invalidFields:O,showTimeSeriesDimensions:Jd(l,c,g,m)}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.terms.documentation.quick",{defaultMessage:"\nThe top values of a specified field ranked by the chosen metric.\n      "}),handleDataSectionExtra:!0,paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,ReferenceEditor:c,paramEditorCustomProps:d,activeData:p,dataSectionExtra:m,...g}){var b,h,y,x,j;const[O,I]=Object(s.useState)(void 0),M=r.hasRestrictions;function T(e){return"column"!==e.type?e.type:`${e.type}$$$${e.columnId}`}const w=Object.entries(e.columns).filter((([t])=>Lm(e,t))).map((([e,t])=>({value:T({type:"column",columnId:e}),text:t.label})));w.push({value:T({type:"alphabetical"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),null!==(b=a.params.secondaryFields)&&void 0!==b&&b.length||!Vm(r.getFieldByName(a.sourceField))||w.push({value:T({type:"rare",maxDocCount:lm}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderRare",{defaultMessage:"Rarity"})}),null!==(h=a.params.secondaryFields)&&void 0!==h&&h.length||!Gm(r.getFieldByName(a.sourceField))||w.push({value:T({type:"significant"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderSignificant",{defaultMessage:"Significance"})}),w.push({value:T({type:"custom"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderCustomMetric",{defaultMessage:"Custom"})});const k=a.params.secondaryFields?a.params.secondaryFields.length:0,{euiTheme:E}=Object(f.useEuiTheme)();return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Zp,{value:a.params.size,disabled:"rare"===a.params.orderBy.type,onChange:i=>{var s;t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:Hm(null===(s=r.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName,k,"rare"===a.params.orderBy.type,"significant"===a.params.orderBy.type,i),params:{...a.params,size:i,otherBucket:Nm(a,i)}}}})}}),"rare"===a.params.orderBy.type&&Object(v.jsx)(Zp,{value:a.params.orderBy.maxDocCount,label:u.i18n.translate("xpack.lens.indexPattern.terms.maxDocCount",{defaultMessage:"Max doc count per term"}),maxValue:100,onChange:i=>{t(_p({layer:e,columnId:n,paramName:"orderBy",value:{...a.params.orderBy,maxDocCount:i}}))}}),Object(v.jsx)(f.EuiFormRow,{label:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(v.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"rowCompressed",fullWidth:!0},Object(v.jsx)(f.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"indexPattern-terms-orderBy",options:w,value:T(a.params.orderBy),onChange:a=>{const i="alphabetical"===(s=a.target.value)?{type:"alphabetical",fallback:!1}:"rare"===s?{type:"rare",maxDocCount:lm}:"significant"===s?{type:"significant"}:"custom"===s?{type:"custom"}:{type:"column",columnId:s.split("$$$")[1]};var s;let l=Xp(_p({layer:e,columnId:n,paramName:"orderBy",value:i}),r);if("custom"===i.type){const t=o.count.buildColumn({layer:e,indexPattern:r,field:r.getFieldByName(Wt.DOCUMENT_FIELD_NAME)});l=_p({layer:l,columnId:n,paramName:"orderAgg",value:t})}else l=_p({layer:l,columnId:n,paramName:"orderAgg",value:void 0});I(void 0),t(_p({layer:l,columnId:n,paramName:"orderDirection",value:"alphabetical"===i.type?"asc":"desc"}))},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),a.params.orderAgg&&c&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(c,i()({operationDefinitionMap:o,functionLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankFunction",{defaultMessage:"Rank function"}),fieldLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankField",{defaultMessage:"Rank field"}),isInline:!0,paramEditorCustomProps:{...d,isInline:!0,labels:Ym(a.params.orderAgg.operationType)},layer:e,selectionStyle:"full",columnId:`${n}-orderAgg`,currentIndexPattern:r,paramEditorUpdater:a=>{if(!sp(a))throw new Error("Setter should always be a column when ran here.");t(_p({layer:e,columnId:n,paramName:"orderAgg",value:a}))},column:a.params.orderAgg,incompleteColumn:O,onResetIncomplete:()=>I(void 0),onDeleteColumn:()=>{throw new Error("Should not be called")},onChooseField:i=>{const s=i.field&&r.getFieldByName(i.field);if(s){const l=o[i.operationType].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});I(void 0),t(_p({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else I({sourceField:i.field,operationType:i.operationType})},onChooseFunction:(i,s)=>{if(s){const l=o[i].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});I(void 0),t(_p({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else I({operationType:i})},validation:{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}},g)),Object(v.jsx)(f.EuiSpacer,{size:"m"})),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"rowCompressed",fullWidth:!0},Object(v.jsx)(f.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),"data-test-subj":"indexPattern-terms-orderDirection-groups",buttonSize:"compressed","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),isDisabled:qm(a.params.orderBy),options:[{id:`${Wm}asc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-asc",value:"asc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{id:`${Wm}desc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-desc",value:"desc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],idSelected:`${Wm}${a.params.orderDirection}`,onChange:a=>{const i=a.replace(Wm,"");t(_p({layer:e,columnId:n,paramName:"orderDirection",value:i}))}})),m&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"m"}),m),!M&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"m"}),Object(v.jsx)(f.EuiAccordion,{id:"lnsTermsAdvanced",arrowProps:{color:"primary"},buttonContent:Object(v.jsx)(f.EuiTitle,{size:"xxs"},Object(v.jsx)("h5",null,Object(v.jsx)(f.EuiTextColor,{color:E.colors.primary},u.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"})))),"data-test-subj":"indexPattern-terms-advanced",className:"lnsIndexPatternDimensionEditor-advancedOptions"},Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without the selected field"})),compressed:!0,disabled:!a.params.otherBucket||"string"!==(null===(y=r.getFieldByName(a.sourceField))||void 0===y?void 0:y.type)||qm(a.params.orderBy),"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(a.params.missingBucket),onChange:a=>t(_p({layer:e,columnId:n,paramName:"missingBucket",value:a.target.checked}))}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group remaining values as "Other"'})),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(a.params.otherBucket),disabled:qm(a.params.orderBy),onChange:a=>t(_p({layer:e,columnId:n,paramName:"otherBucket",value:a.target.checked}))}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeDescription",{defaultMessage:"Enable accuracy mode"})," ",Object(v.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeHelp",{defaultMessage:"Improves results for high-cardinality data, but increases the load on the Elasticsearch cluster."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),compressed:!0,disabled:"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-accuracy-mode",checked:Boolean(a.params.accuracyMode&&"rare"!==a.params.orderBy.type),onChange:a=>t(_p({layer:e,columnId:n,paramName:"accuracyMode",value:a.target.checked}))}),("number"===a.dataType||"string"===a.dataType)&&!(null!==(x=a.params.secondaryFields)&&void 0!==x&&x.length)&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(zm,{include:a.params.include,exclude:a.params.exclude,includeIsRegex:Boolean(a.params.includeIsRegex),excludeIsRegex:Boolean(a.params.excludeIsRegex),tableRows:null==p||null===(j=p[g.layerId])||void 0===j?void 0:j.rows,columnId:n,isNumberField:Boolean("number"===a.dataType),updateParams:(i,s,l,r)=>t({...e,columns:{...e.columns,[n]:{...a,params:{...a.params,[i]:s,[l]:r}}}})})))))},getMaxPossibleNumValues:e=>e.params.size+(e.params.otherBucket?1:0)};function Ym(e){switch(e){case"last_value":return[u.i18n.translate("xpack.lens.indexPattern.terms.lastValue.sortRankBy",{defaultMessage:"Sort rank by"})];case"percentile_rank":return[u.i18n.translate("xpack.lens.indexPattern.terms.percentile.",{defaultMessage:"Percentile ranks"})];default:return}}var Qm=a(112),Km=a(55);const Zm={s:u.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:u.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:u.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:u.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},Jm={s:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},eg="suffix";function tg(e){var t;return t=class SuffixFormatter extends Km.FieldFormat{constructor(...t){super(...t),Ma()(this,"allowsNumericalAggregations",!0),Ma()(this,"textConvert",(t=>{const a=this.param("unit"),n=a?Zm[a]:this.param("suffixString"),i=this.param("id"),s=this.param("params"),l=e()({id:i,params:s}).convert(t);return""===l?"":n?`${l}${n}`:l}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},Ma()(t,"id",eg),Ma()(t,"hidden",!0),Ma()(t,"title",u.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),Ma()(t,"fieldType",Qm.b.NUMBER),t}function ag(e,t,a){return(t||e?" ":"")+(e?Jm[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")+(a?" ":"")+(a?u.i18n.translate("xpack.lens.reducedTimeRangeSuffix",{defaultMessage:"last {reducedTimeRange}",values:{reducedTimeRange:a}}):"")}function ng(e,t,a,n,i,s,l){let r=e;if(t||n||s){const a=ag(t,n,s),i=e.lastIndexOf(a);-1!==i&&(r=e.substring(0,i))}return a||i||l?`${r}${ag(a,i,l)}`:r}function ig(e,t){const a={};return e.forEach((e=>{const n=t(e);n&&(n in a||(a[n]=[]),a[n].push(e))})),a}const sg=(e,t,a)=>{const{functions:[n]}=e,i=[];var s;if(t.includes(n.name)&&(i.push(n.name),a.forEach((({name:e,transformer:t})=>{var a;const s=null===(a=n.getArgument(e))||void 0===a?void 0:a[0];i.push(t?t(s):s)})),i.push(null===(s=n.getArgument("timeShift"))||void 0===s?void 0:s[0])),"aggFilteredMetric"===n.name){var l;const e=null===(l=n.getArgument("customMetric"))||void 0===l?void 0:l[0].functions[0];if(e&&t.includes(e.name)){var r,o;i.push(e.name),i.push("filtered");const t=(null===(r=n.getArgument("customBucket"))||void 0===r?void 0:r[0]).functions[0];a.forEach((({name:t,transformer:a})=>{var n;const s=null===(n=e.getArgument(t))||void 0===n?void 0:n[0];i.push(a?a(s):s)})),i.push(t.getArgument("timeWindow")),i.push(n.getArgument("timeShift"));const s=null===(o=t.getArgument("filter"))||void 0===o?void 0:o[0];if(s){var u;const e=s.functions[0];i.push(null==e?void 0:e.name,null==e||null===(u=e.getArgument("q"))||void 0===u?void 0:u[0])}}}return i.length?i.map(String).join("-"):void 0},lg=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]),rg="ratio",og=!1;function ug(e,t,a){return ng(u.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const cg={type:tc,displayName:ac,allowAsReference:!0,input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(lg.has(a)&&t&&"counter"!==n&&(!e||e.cardinality))return{dataType:"number",isBucketed:og,scale:rg}},getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Od(e,t,a)],isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&lg.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,canReduceTimeRange:!0,getDefaultLabel:(e,t,a)=>ug(ap(e.sourceField,a),e.timeShift,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:ug(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:tc,scale:rg,sourceField:e.name,isBucketed:og,filter:cp(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...rp(t),emptyAsNull:t&&ip("unique_count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Me.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(_p({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t)=>{var a;return Object(Ut.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},getGroupByKey:e=>sg(e,["aggCardinality"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),onFieldChange:(e,t)=>({...e,label:ug(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.quick",{defaultMessage:"\nThe number of unique values for a specified number, string, date, or boolean field.\n      "})};function dg(e,t,a,n){return ng(u.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,a,void 0,n)}function pg(e,t,a,n){return!t&&np(e,!1,a,n,15)?u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessageTooManyDigits",{defaultMessage:"Only {digits} numbers allowed after the decimal point.",values:{digits:4}}):u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between {min} and {max}",values:{min:n,max:a}})}const mg=["number","histogram"],gg={type:Xc,allowAsReference:!0,displayName:Yc,input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(mg.includes(a)&&t&&"counter"!==n&&(!e||e.percentiles))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&mg.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentiles))},getDefaultLabel:(e,t,a)=>dg(ap(e.sourceField,a),e.params.percentile,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&ip(Xc,t)&&t.params.percentile,l=null!==(i=null==n?void 0:n.percentile)&&void 0!==i?i:s||95;return{label:dg(ap(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:Xc,sourceField:e.name,isBucketed:!1,scale:"ratio",filter:cp(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{percentile:l,...rp(t)}}},onFieldChange:(e,t)=>({...e,label:dg(t.displayName,e.params.percentile,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(Ut.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),getGroupByKey:e=>sg(e,["aggSinglePercentile"],[{name:"field"},{name:"percentile"}]),optimizeEsAggs:(e,t,a)=>{let n=[...e];const i={...t},s=ig(n,(e=>sg(e,["aggSinglePercentile"],[{name:"field"}]))),l=n.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(s).forEach((e=>{var t,s,r,o;if(e.length<=1)return;const{functions:[u]}=e[0];if("aggFilteredMetric"===u.name)return;n=n.filter((t=>!e.includes(t)));const{functions:[c]}=e[0],d=c.getArgument("id")[0],p={id:d,enabled:null===(t=c.getArgument("enabled"))||void 0===t?void 0:t[0],schema:null===(s=c.getArgument("schema"))||void 0===s?void 0:s[0],field:null===(r=c.getArgument("field"))||void 0===r?void 0:r[0],percents:[],timeShift:null===(o=c.getArgument("timeShift"))||void 0===o?void 0:o[0]};for(const t of e){const e=t.functions[0].getArgument("percentile")[0];p.percents.push(e),l.forEach((a=>{var n,i;(null===(n=a.getArgument("orderBy"))||void 0===n?void 0:n[0])===(null===(i=t.functions[0].getArgument("id"))||void 0===i?void 0:i[0])&&a.replaceArgument("orderBy",[`${d}.${e}`])}))}const m=Object(Ut.buildExpressionFunction)("aggPercentiles",p).toAst();n.push(Object(Ut.buildExpression)({type:"expression",chain:[m]})),e.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for percentile agg expression builder");const n=`col-?-${d}.${e.functions[0].getArgument("percentile")[0]}`;i[n]=i[t],delete i[t]}))})),{esAggsIdMap:i,aggs:n}},getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Od(e,t,a)],paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),o=l?1:1e-4,c=l?99:99.9999,d=Object(s.useCallback)((n=>{var i;np(n,l,c,o,4)&&Number(n)!==t.params.percentile&&e({...t,label:t.customLabel?t.label:dg((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,percentile:Number(n)}})}),[l,c,o,t,e,a]),{inputValue:p,handleInputChange:m}=Object(je.a)({onChange:d,value:String(t.params.percentile)}),g=np(p,l,c,o,4),b=Object(s.useCallback)((e=>m(String(e.currentTarget.value))),[m]);return Object(v.jsx)(vm,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile-form",display:"rowCompressed",fullWidth:!0,isInvalid:!g,error:!g&&pg(p,l,c,o)},l?Object(v.jsx)(f.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=p?p:"",min:o,max:c,step:o,onChange:b,"aria-label":r}):Object(v.jsx)(f.EuiRange,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=p?p:"",min:o,max:c,step:o,onChange:b,showInput:!0,"aria-label":r}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.quick",{defaultMessage:"\n      The largest value that is smaller than n percent of the values that occur in all documents.\n      "})};function fg(e,t,a,n){return ng(u.i18n.translate("xpack.lens.indexPattern.percentileRanksOf",{defaultMessage:"Percentile rank ({value}) of {name}",values:{name:e,value:t}}),void 0,void 0,void 0,a,void 0,n)}const bg=["number","histogram"],hg={type:Hc,allowAsReference:!0,displayName:Uc,input:"field",operationParams:[{name:"value",type:"number",required:!1,defaultValue:0}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(bg.includes(a)&&t&&"counter"!==n&&(!e||!e.percentile_ranks))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&bg.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentile_ranks))},getDefaultLabel:(e,t,a)=>fg(ap(e.sourceField,a),e.params.value,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&ip("percentile_rank",t)&&t.params.value,l=null!==(i=null==n?void 0:n.value)&&void 0!==i?i:s||0;return{label:fg(ap(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"percentile_rank",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:cp(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{value:l,...rp(t)}}},onFieldChange:(e,t)=>({...e,label:fg(t.displayName,e.params.value,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(Ut.buildExpressionFunction)("aggSinglePercentileRank",{id:t,enabled:!0,schema:"metric",field:e.sourceField,value:e.params.value,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Od(e,t,a)],paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileRanksValue",{defaultMessage:"Percentile ranks value"}),o=Object(s.useCallback)((n=>{var i;np(n,l)&&Number(n)!==t.params.value&&e({...t,label:t.customLabel?t.label:fg((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,value:Number(n)}})}),[l,t,e,a]),{inputValue:c,handleInputChange:d}=Object(je.a)({onChange:o,value:String(t.params.value)},{allowFalsyValue:!0}),p=np(c,l),m=Object(s.useCallback)((e=>{d(e.currentTarget.value)}),[d]);return Object(v.jsx)(vm,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile_ranks-form",display:"rowCompressed",fullWidth:!0,isInvalid:!p,error:!p&&u.i18n.translate("xpack.lens.indexPattern.percentileRanks.errorMessage",{defaultMessage:"Percentile ranks value must be a number"})},Object(v.jsx)(f.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile_ranks-input",compressed:!0,value:null!=c?c:"",onChange:m,step:l?1:"any","aria-label":r}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.documentation.quick",{defaultMessage:"\nThe percentage of values that are below a specific value. For example, when a value is greater than or equal to 95% of the calculated values, the value is the 95th percentile rank.\n      "})},vg={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian",standard_deviation:"aggStdDeviation"},yg=["number","histogram"];function xg({type:e,displayName:t,description:a,ofName:n,priority:i,optionalTimeScaling:s,supportsDate:l,hideZeroOption:r,aggConfigParams:o,quickFunctionDocumentation:c,unsupportedSettings:d}){const p=(e,t)=>ng(n(e),void 0,s?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift,void 0,null==t?void 0:t.reducedTimeRange);return{type:e,allowAsReference:!0,priority:i,displayName:t,description:a,input:"field",timeScalingMode:s?"optional":void 0,getUnsupportedSettings:()=>d,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:a,type:n,timeSeriesMetric:i})=>{if((yg.includes(n)||l&&"date"===n)&&a&&function(e,t){return"counter"!==t||["min","max"].includes(e)}(e,i)&&(!t||t[e]))return{dataType:"date"===n?"date":"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,a)=>{const n=a.getFieldByName(t.sourceField);return Boolean(n&&yg.includes(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions[e]))},getDefaultLabel:(e,t,a)=>p(ap(e.sourceField,a),e),buildColumn:({field:t,previousColumn:a},n)=>{var i;return{label:p(t.displayName,a),dataType:l&&"date"===t.type?"date":"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:s?null==a?void 0:a.timeScale:void 0,filter:cp(a,n),timeShift:(null==n?void 0:n.shift)||(null==a?void 0:a.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==a?void 0:a.reducedTimeRange),params:{...rp(a),emptyAsNull:r&&a&&ip(e,a)?null===(i=a.params)||void 0===i?void 0:i.emptyAsNull:!(null!=n&&n.usedInMath)}}},onFieldChange:(e,t)=>({...e,label:p(t.displayName,e),dataType:t.type,sourceField:t.name}),getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return r?[{dataTestSubj:"hide-zero-values",inlineElement:Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Me.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(_p({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]:[]},toEsAggsFn:(t,a,n)=>{var i;return Object(Ut.buildExpressionFunction)(vg[e],{id:a,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift,emptyAsNull:r?null===(i=t.params)||void 0===i?void 0:i.emptyAsNull:void 0,...o}).toAst()},getGroupByKey:t=>sg(t,[vg[e]],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Od(e,t,a)],filterable:!0,canReduceTimeRange:!0,quickFunctionDocumentation:c,shiftable:!0}}const jg=xg({type:Ic,displayName:Mc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.min.quickFunctionDescription",{defaultMessage:"The minimum value of a number field."}),supportsDate:!0,unsupportedSettings:{sampling:!1}}),Og=xg({type:hc,displayName:vc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.max.quickFunctionDescription",{defaultMessage:"The maximum value of a number field."}),supportsDate:!0,unsupportedSettings:{sampling:!1}}),Ig=xg({type:Yu,priority:2,displayName:Qu,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.avg.quickFunctionDescription",{defaultMessage:"The mean value of a set of number fields."})}),Mg=xg({type:Kc,displayName:Zc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.standardDeviationOf",{defaultMessage:"Standard deviation of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.description",{defaultMessage:"A single-value metric aggregation that computes the standard deviation of numeric values that are extracted from the aggregated documents"}),aggConfigParams:{showBounds:!1},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.quickFunctionDescription",{defaultMessage:"The standard deviation of the values of a number field which is the amount of variation of the fields values."})}),Tg=xg({type:ed,priority:1,displayName:td,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:u.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."}),hideZeroOption:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.sum.quickFunctionDescription",{defaultMessage:"The total amount of the values of a number field."})}),wg=xg({type:xc,priority:3,displayName:jc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.median.quickFunctionDescription",{defaultMessage:"The median value of a number field."})}),{isValidInterval:kg}=Fl.search.aggs,Eg="auto",Cg=new Set(["w","M","q","y"]);function Fg(e,t){return Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift))?e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?[]:[{uniqueId:Ft.Y,message:u.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}]:[]}const Sg={type:"date_histogram",displayName:u.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Fg(e,t)],getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(("date"===a||"date_range"===a)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t,a)=>ap(e.sourceField,a),buildColumn({field:e},t){var a,n;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(a=null==t?void 0:t.interval)&&void 0!==a?a:Eg,includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,dropPartials:Boolean(null==t?void 0:t.dropPartials)}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"date"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,a)=>{var n,i,s,l,r,o,u;const c=a.getFieldByName(e.sourceField);let d,p=null!==(n=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==n?n:Eg;const m=Boolean((null===(s=e.params)||void 0===s?void 0:s.dropPartials)&&(a.timeFieldName===(null==c?void 0:c.name)||!(null!==(l=e.params)&&void 0!==l&&l.ignoreTimeRange)));return c&&c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram&&(p=Pg(c.aggregationRestrictions),d=c.aggregationRestrictions.date_histogram.time_zone),Object(Ut.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:d,useNormalizedEsInterval:!(null!=c&&null!==(r=c.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:p,drop_partials:m,min_doc_count:null!==(o=e.params)&&void 0!==o&&o.includeEmptyRows?0:1,extended_bounds:Object(An.extendedBoundsToAst)({}),extendToTimeRange:null===(u=e.params)||void 0===u?void 0:u.includeEmptyRows}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,dateRange:i,data:r,indexPattern:o}){const c=a&&o.getFieldByName(a.sourceField),d=c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram,[p,m]=Object(s.useState)(a.params.interval),g=p===Eg?Eg:Ag(p),b=!a.params.ignoreTimeRange&&p===Eg||g!==Eg&&""!==p&&kg(`${""===g.value?"1":g.value}${g.unit}`,Pg(c.aggregationRestrictions)),h=Object(s.useCallback)((e=>{const a=e.target.checked;n((e=>_p({layer:e,columnId:t,paramName:"dropPartials",value:a})))}),[t,n]),y=Object(s.useCallback)((e=>{const a=e!==Eg&&Cg.has(e.unit),i=e===Eg?Eg:`${a?"1":e.value}${e.unit||"d"}`;n((e=>_p({layer:e,columnId:t,paramName:"interval",value:i})))}),[t,n]),x=(An.intervalOptions||[]).filter((e=>e.val!==Eg)).map((e=>({label:e.display,key:e.val})),[]);x.unshift({label:u.i18n.translate("xpack.lens.indexPattern.autoIntervalLabel",{defaultMessage:"Auto ({interval})",values:{interval:r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h"}}),key:Eg});const j=x.find((e=>e.key===p)),O=j?[j]:[{label:p,key:p}];Object(s.useEffect)((()=>{b&&p!==a.params.interval&&y(Ag(p))}),[p,b,a.params.interval,y]);const I=o.timeFieldName===(null==c?void 0:c.name)||!a.params.ignoreTimeRange;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(a.params.includeEmptyRows),"data-test-subj":"indexPattern-include-empty-rows",onChange:()=>{n(_p({layer:e,columnId:t,paramName:"includeEmptyRows",value:!a.params.includeEmptyRows}))},compressed:!0})),o.timeFieldName!==(null==c?void 0:c.name)&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.bindToGlobalTimePicker",{defaultMessage:"Bind to global time picker"})," ",Object(v.jsx)(f.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.globalTimePickerHelp",{defaultMessage:"Filter the selected field by the global time picker in the top right. This setting can't be turned off for the default time field of the current data view."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),disabled:o.timeFieldName===(null==c?void 0:c.name),checked:I,onChange:()=>{let s=_p({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!a.params.ignoreTimeRange});if(!a.params.ignoreTimeRange&&a.params.interval===Eg){const e=r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h";s=_p({layer:s,columnId:t,paramName:"interval",value:e}),m(e)}n(s)},compressed:!0}))),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed",helpText:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionHelpText",{defaultMessage:"Select an option or create a custom value."}),Object(v.jsx)("br",null),u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionExamplesHelpText",{defaultMessage:"Examples: 30s, 20m, 24h, 2d, 1w, 1M"})),isInvalid:!b,error:!b&&u.i18n.translate("xpack.lens.indexPattern.dateHistogram.invalidInterval",{defaultMessage:"Please pick a valid interval. It's not possible to use multiple weeks, months or years as interval."})},d?Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:Pg(c.aggregationRestrictions)}}):Object(v.jsx)(f.EuiComboBox,{compressed:!0,fullWidth:!0,"data-test-subj":"lensDateHistogramInterval",isInvalid:!b,onChange:i=>{const s=i.length?i[0].key:"";m(s),s===Eg&&a.params.ignoreTimeRange&&n(_p({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!1}))},onCreateOption:e=>m(e.trim()),options:x,selectedOptions:O,singleSelection:{asPlainText:!0},placeholder:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectIntervalPlaceholder",{defaultMessage:"Select an interval"})})),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(v.jsx)(ze.a,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBucketsHelp",{defaultMessage:"Drop partial intervals is disabled as these can be computed only for a time field bound to global time picker in the top right."}),condition:!I},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBuckets",{defaultMessage:"Drop partial intervals"})),"data-test-subj":"lensDropPartialIntervals",checked:Boolean(a.params.dropPartials),onChange:h,compressed:!0,disabled:!I}))))},helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How Date histogram works"}),helpComponent(){const e=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),t=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"Date histogram splits data into time intervals."})),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} Advanced Setting and calculates the best interval for your data. For example, when the time range is 4 days, the data is divided into hourly buckets. To configure the maximum number of bars, use the {maxBarSetting} Advanced Setting.",values:{maxBarSetting:Object(v.jsx)(f.EuiCode,null,Fl.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(v.jsx)(f.EuiCode,null,Fl.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(v.jsx)(f.EuiBasicTable,{items:Fl.search.aggs.boundsDescendingRaw.map((({bound:a,boundLabel:n,intervalLabel:i})=>({bound:"number"==typeof a?e:`${t} ${n}`,interval:i}))),columns:[{field:"bound",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.documentation.quick",{defaultMessage:"\nThe date or date range values distributed into intervals.\n      "})};function Ag(e){const t=e||"",a=t.match(/[\d]+/)||[],n=t.match(/[\D]+/)||[],i=parseInt(a[0]||"",10);return{value:isNaN(i)?"":i,unit:n[0]||"h"}}function Pg(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const _g=e=>(t,a,n)=>ng(e(t),void 0,a,void 0,n,void 0,void 0);function Lg(e,t){if(e===ue.LayerTypes.REFERENCELINE)return[u.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function Dg(e,t){return e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType))?[]:[{uniqueId:Ft.g,message:u.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})}]}const Rg=k()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([a,n])=>{"references"in n&&"managedReference"===Rf[n.operationType].input&&(t.add(a),Kp(a,e.columns).map((([e])=>{t.add(e)})))})),t}));function Ng(e,t,a){const n=Dg(e,a),i=function(e,t){const a=e.columns[t],n=[];return a.references.forEach(((i,s)=>{if(e.columns[i]){const l=e.columns[i],r=Rf[a.operationType];if("fullReference"!==r.input)throw new Error("inconsistent state - column is not a reference operation");Qp({validation:r.requiredReferences[s],column:l})||Rg(e).has(t)||n.push({uniqueId:Ft.i,message:u.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:a.label}})})}else n.push({uniqueId:Ft.h,message:u.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:a.label}})})})),n}(e,t);return n.concat(i)}function Bg(e){return e.fields.some((e=>"date"===e.type))}function zg(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.findIndex((t=>"date_histogram"===e.columns[t].operationType));return s.splice(l,1),[{type:"function",function:a,arguments:{by:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}const Vg=_g((e=>u.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Gg={type:ic,priority:1,displayName:sc,input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getUnsupportedSettings:()=>({sampling:!1}),getPossibleOperation:e=>{if(Bg(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=t[e.references[0]];return Vg(i&&"sourceField"in i?null==a||null===(n=a.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>zg(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]],r=i,o=(null==t?void 0:t.timeScale)||(null==r?void 0:r.timeScale)||"s";return{label:Vg(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,o,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:o,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:cp(t,i),params:rp(t)}},isTransferable:(e,t)=>Bg(t),getErrorMessage:(e,t)=>Ng(e,t,u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),getDisabledStatus(e,t,a){const n=u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(a){const e=Lg(a,n);if(e)return e.join(", ")}return Dg(t,n).map((e=>e.message)).join(", ")},timeScalingMode:"mandatory",filterable:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.quick",{defaultMessage:"\n      The rate of change over time for an ever growing time series metric.\n      "}),shiftable:!0},qg=_g((e=>u.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),$g={type:rc,priority:1,displayName:oc,input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:(e,t,a)=>!("number"!==e.dataType||e.isBucketed||"count"===t&&a!==Wt.DOCUMENT_FIELD_NAME)}],getPossibleOperation:e=>{if(Bg(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=t[e.references[0]];return qg(i&&"sourceField"in i?null==a||null===(n=a.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>zg(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]];return{label:qg(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:cp(t,i),references:e,params:rp(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>Ng(e,t,u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),getDisabledStatus(e,t,a){const n=u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(a){const e=Lg(a,n);if(e)return e.join(", ")}return Dg(t,n).map((e=>e.message)).join(", ")},filterable:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.quick",{defaultMessage:"\n      The sum of all values as they grow over time.\n      "}),shiftable:!0},Hg=_g((e=>u.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Ug={type:cc,priority:1,displayName:dc,input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(Bg(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Hg(null===(n=t[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>zg(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.timeScale)&&void 0!==i?i:null==t?void 0:t.timeScale;return{label:Hg(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:cc,isBucketed:!1,scale:"ratio",references:e,timeScale:l,filter:cp(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:rp(t)}},isTransferable:(e,t)=>Bg(t),getErrorMessage:(e,t)=>Ng(e,t,u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),getDisabledStatus(e,t,a){const n=u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(a){const e=Lg(a,n);if(e)return e.join(", ")}return Dg(t,n).map((e=>e.message)).join(", ")},timeScalingMode:"optional",filterable:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.quick",{defaultMessage:"\n      The change between the values in subsequent intervals.\n      "}),shiftable:!0},Wg=_g((e=>u.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Xg={type:wc,priority:1,displayName:kc,input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:5}],getPossibleOperation:e=>{if(Bg(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Wg(null===(n=t[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>zg(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.window)&&void 0!==i?i:5;return{label:Wg(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),filter:cp(t,n),timeScale:null==t?void 0:t.timeScale,params:{window:l,...rp(t)}}},paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n}){const[i,l]=Object(s.useState)(String(a.params.window));return Object(M.t)((()=>{if(!np(i,!0,void 0,1))return;const a=parseInt(i,10);t(_p({layer:e,columnId:n,paramName:"window",value:a}))}),{skipFirstRender:!0},256,[i]),Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"rowCompressed",fullWidth:!0,isInvalid:!np(i)},Object(v.jsx)(f.EuiFieldNumber,{fullWidth:!0,compressed:!0,value:i,onChange:e=>l(e.target.value),min:1,step:1,isInvalid:!np(i)}))},isTransferable:(e,t)=>Bg(t),getErrorMessage:(e,t)=>Ng(e,t,u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),helpComponent:()=>Object(v.jsx)(Yg,null),helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"}),getDisabledStatus(e,t,a){const n=u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(a){const e=Lg(a,n);if(e)return e.join(", ")}return Dg(t,n).map((e=>e.message)).join(", ")},timeScalingMode:"optional",filterable:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.quick",{defaultMessage:"\n      The average of a moving window of values over time.\n      "}),shiftable:!0},Yg=()=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(v.jsx)("ul",null,Object(v.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(v.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(v.jsx)("li",null,"..."),Object(v.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(v.jsx)("ul",null,Object(v.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(v.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(v.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(v.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})));function Qg({type:e,displayName:t,ofName:a,metric:n}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,n)=>{var i;const s=t[e.references[0]];return a(s&&"sourceField"in s?null==n||null===(i=n.getFieldByName(s.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:a,arguments:{by:l.length===s.length?[]:l,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}(e,t,"overall_metric",{metric:[n]}),buildColumn:({referenceIds:e,previousColumn:t,layer:i,indexPattern:s},l)=>{var r;const o=i.columns[e[0]];return{label:a(o&&"sourceField"in o?null===(r=s.getFieldByName(o.sourceField))||void 0===r?void 0:r.displayName:void 0),dataType:"number",operationType:`overall_${n}`,isBucketed:!1,scale:"ratio",references:e,params:rp(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1}}const Kg=Qg({type:Gc,displayName:qc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:ed}),Zg=Qg({type:Bc,displayName:zc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:Ic}),Jg=Qg({type:Dc,displayName:Rc,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:hc}),ef=Qg({type:Pc,displayName:_c,ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:Yu}),tf={type:Cc,priority:1,displayName:Fc,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"unit",type:"string",required:!0}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>Cc,toExpression:(e,t)=>{const a=e.columns[t],n=e.columnOrder.filter((t=>e.columns[t].isBucketed)).find((t=>"date_histogram"===e.columns[t].operationType));return[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:n?[n]:[],inputColumnId:[a.references[0]],outputColumnId:[t],outputColumnName:[a.label],targetUnit:[a.params.unit],reducedTimeRange:a.reducedTimeRange?[a.reducedTimeRange]:[]}}]},buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>({label:Fc,dataType:"number",operationType:Cc,isBucketed:!1,scale:"ratio",references:e,params:{...rp(t),unit:null==i?void 0:i.unit}}),isTransferable:()=>!0,getErrorMessage:(e,t)=>{var a;const n=Ng(e,t,Fc);return e.columns[t].params.unit||n.push({uniqueId:"",message:u.i18n.translate("xpack.lens.indexPattern.timeScale.missingUnit",{defaultMessage:"No unit specified for normalize by unit."})}),-1===["s","m","h","d"].indexOf(null!==(a=e.columns[t].params.unit)&&void 0!==a?a:"s")&&n.push({uniqueId:"",message:u.i18n.translate("xpack.lens.indexPattern.timeScale.wrongUnit",{defaultMessage:"Unknown unit specified: use s, m, h or d."})}),n},filterable:!1,shiftable:!1},af=u.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),nf=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]);function sf(e,t,a,n){return null!=e&&e.customLabel&&"document"!==(null==e?void 0:e.type)?e.customLabel:ng("document"!==(null==e?void 0:e.type)?u.i18n.translate("xpack.lens.indexPattern.valueCountOf",{defaultMessage:"Count of {name}",values:{name:(null==e?void 0:e.displayName)||"-"}}):af,void 0,a,void 0,t,void 0,n)}const lf={type:Zu,displayName:Ju,input:"field",getErrorMessage:(e,t,a)=>[...ep(e,t,a),...Od(e,t,a)],allowAsReference:!0,onFieldChange:(e,t)=>({...e,label:sf(t,e.timeShift,e.timeShift,e.reducedTimeRange),sourceField:t.name}),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if("document"===a||t&&"counter"!==n&&(!e||e.value_count)&&nf.has(a))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>sf(null==a?void 0:a.getFieldByName(e.sourceField),e.timeShift,e.timeScale,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:sf(e,null==t?void 0:t.timeShift,null==t?void 0:t.timeScale,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:Zu,isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:cp(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...rp(t),emptyAsNull:t&&ip(Zu,t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:Me.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(_p({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t,a)=>{const n=a.getFieldByName(e.sourceField);var i,s;return"document"===(null==n?void 0:n.type)?Object(Ut.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(i=e.params)||void 0===i?void 0:i.emptyAsNull}).toAst():Object(Ut.buildExpressionFunction)("aggValueCount",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(s=e.params)||void 0===s?void 0:s.emptyAsNull}).toAst()},getGroupByKey:e=>sg(e,["aggCount","aggValueCount"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&("document"===a.type||nf.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality)))},timeScalingMode:"optional",filterable:!0,canReduceTimeRange:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.count.documentation.quick",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n      "}),shiftable:!0},rf=u.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function of(e){return function(e){return null==e||""===e}(e)?rf:u.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const uf={type:"static_value",displayName:rf,getDefaultLabel:e=>of(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const a=e.columns[t],n=np(a.params.value,!1,void 0,void 0,15);return null==a.params.value||n?[]:[{uniqueId:Ft.Q,message:u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:a.params.value}})}]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio",isStaticValue:!0}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==rf,l=np(i.value,!1,void 0,void 0,15);return[{type:"function",function:l?"mathColumn":"mapColumn",arguments:{id:[t],name:[(l?s?n.label:null!==(a=null==i?void 0:i.value)&&void 0!==a?a:rf:rf)||rf],expression:[String(l?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){var s,l;const r={value:e&&(l=e,Boolean("params"in l&&l.params&&"value"in l.params))&&np(e.params.value)?e.params.value:void 0,...rp(e),...n};return{label:of(r.value),dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:{...r,value:String(null!==(s=r.value)&&void 0!==s?s:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,a){const n=e[t.layerId].columns[t.columnId],i=e[a.layerId],s={...i.columns,[a.columnId]:{...n}};return{...e,[a.layerId]:{...i,columns:s,columnOrder:Np({...i,columns:s})}}},paramEditor:function({paramEditorUpdater:e,currentColumn:t,columnId:a,activeData:n,layerId:i,paramEditorCustomProps:l}){var r,o,c,d,p;const m=Object(s.useCallback)((n=>{t.params.value!==n&&np(n,!1,void 0,void 0,15)&&e((e=>{const t=e.columns[a];return{...e,columns:{...e.columns,[a]:{...t,label:null!=t&&t.customLabel?t.label:of(n),params:{...t.params,value:n}}}}}))}),[a,e,null==t||null===(r=t.params)||void 0===r?void 0:r.value]),g=1===(null==n||null===(o=n[i])||void 0===o||null===(c=o.rows)||void 0===c?void 0:c.length)&&n[i].rows[0][a],b="static_value"!==(null==t?void 0:t.operationType)&&null!=g?g:String(100),{inputValue:h,handleInputChange:y}=Object(je.a)({value:(null==t||null===(d=t.params)||void 0===d?void 0:d.value)||b,onChange:m},{allowFalsyValue:!0}),x=Object(s.useCallback)((e=>{const t=e.currentTarget.value;y(t)}),[y]),j=np(h,!1,void 0,void 0,15);return Object(v.jsx)(f.EuiFormRow,{label:(null==l||null===(p=l.labels)||void 0===p?void 0:p[0])||rf,fullWidth:!0,isInvalid:!j,error:!j&&u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:null!=h?h:"''"}})},Object(v.jsx)(f.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=h?h:"",onChange:x,step:"any"}))}};function cf(e,t,a){return ng(u.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const df=new Set(["string","boolean","number","ip","date","ip_range","number_range","date_range"]);function pf(e,t,a){if(!a)return[];const n=a.getFieldByName(e);return n?"date"!==n.type?[{uniqueId:Ft.E,message:u.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}})}]:[]:[{uniqueId:Ft.F,message:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.lastValue.sortFieldNotFound",defaultMessage:"Sort field {sortField} was not found.",values:{sortField:Object(v.jsx)("strong",null,e)}}),displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t},{id:"embeddableBadge"}]}]}function mf(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function gf(e){const t=e.fields.filter((e=>"date"===e.type));return mf(e)&&t.sort((({name:t},{name:a})=>t===e.timeFieldName?-1:a===e.timeFieldName?1:0)),t}function ff(e,t){return Dm(e)||function(e){return Boolean(e.runtime)}(e)&&"number"!==e.type||(null==t?void 0:t.showArrayValues)}function bf(e){return"string"===e||"ip"===e||"ip_range"===e||"date_range"===e||"number_range"===e?"ordinal":"ratio"}const hf={type:gc,displayName:fc,getDefaultLabel:(e,t,a)=>cf(ap(e.sourceField,a),e.timeShift,e.reducedTimeRange),input:"field",onFieldChange:(e,t)=>{const a={...e.params};return a.showArrayValues=ff(t,e.params),"format"in a&&"number"!==t.type&&delete a.format,{...e,dataType:t.type,label:cf(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name,params:a,scale:bf(t.type),filter:e.filter&&up(e.filter,e.sourceField)?op(t.name):e.filter}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(df.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:bf(t)}},getDisabledStatus(e){if(!e||!gf(e).length)return u.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your data view"})},getErrorMessage(e,t,a){const n=e.columns[t];return[...ep(e,t,a),...pf(n.params.sortField,t,a),...Od(e,t,a)]},buildColumn({field:e,previousColumn:t,indexPattern:a},n){var i;const s=n,l=mf(a)?a.timeFieldName:null===(i=a.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!l)throw new Error(u.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This data view does not contain any date fields"}));const r=ff(e,s);return{label:cf(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:e.type,operationType:gc,isBucketed:!1,scale:bf(e.type),sourceField:e.name,filter:cp(t,n)||op(e.name),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{showArrayValues:r,sortField:(null==s?void 0:s.sortField)||l,...rp(t)}}},filterable:!0,canReduceTimeRange:!0,shiftable:!0,toEsAggsFn:(e,t,a)=>{var n;const i={id:t,enabled:!0,schema:"metric",field:e.sourceField,size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift},s="counter"===(null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.timeSeriesMetric);return(e.params.showArrayValues&&!s?Object(Ut.buildExpressionFunction)("aggTopHit",{...i,aggregate:"concat"}):Object(Ut.buildExpressionFunction)("aggTopMetrics",i)).toAst()},getGroupByKey:e=>sg(e,["aggTopHit","aggTopMetrics"],[{name:"field"},{name:"sortField"}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField),n=t.getFieldByName(e.params.sortField);return Boolean(a&&a.type===e.dataType&&!a.aggregationRestrictions&&"date"===(null==n?void 0:n.type)&&df.has(a.type))},allowAsReference:!0,paramEditor:({layer:e,paramEditorUpdater:t,currentColumn:a,indexPattern:n,isReferenced:i,paramEditorCustomProps:s})=>{var r,o;const{labels:c,isInline:d}=s||{},p=(null==c?void 0:c[0])||u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),m=gf(n),g=pf(a.params.sortField,"",n).length>0,b=Object.keys(e.columns).some((t=>"terms"===e.columns[t].operationType));return Object(v.jsx)(l.a.Fragment,null,!i&&Object(v.jsx)(f.EuiFormRow,{error:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesWithTopValuesWarning",{defaultMessage:"When you show array values, you are unable to use this field to rank top values."}),isInvalid:a.params.showArrayValues&&b,display:"rowCompressed",fullWidth:!0,"data-test-subj":"lns-indexPattern-lastValue-showArrayValues"},Object(v.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesExplanation",{defaultMessage:"Displays all values associated with this field in each last document."}),position:"left"},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValues",{defaultMessage:"Show array values"})),compressed:!0,checked:Boolean(a.params.showArrayValues),disabled:Dm(a.sourceField,n),onChange:()=>{return e=!a.params.showArrayValues,t({...a,params:{...a.params,showArrayValues:e}});var e}}))),Object(v.jsx)(vm,{isInline:d,label:p,display:"rowCompressed",fullWidth:!0,error:u.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your data view or pick another field."}),isInvalid:g},Object(v.jsx)(f.EuiComboBox,{placeholder:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:g,singleSelection:{asPlainText:!0},"aria-label":p,options:null==m?void 0:m.map((e=>({value:e.name,label:e.displayName}))),onChange:e=>{if(0!==e.length)return t({...a,params:{...a.params,sortField:e[0].value}})},selectedOptions:null!==(r=a.params)&&void 0!==r&&r.sortField?[{label:(null===(o=n.getFieldByName(a.params.sortField))||void 0===o?void 0:o.displayName)||a.params.sortField,value:a.params.sortField}]:[]})))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.quick",{defaultMessage:"\nThe value of a field from the last document, ordered by the default time field of the data view.\n      "})};a(470);const vf="auto",yf="range",xf="histogram",jf=Object(f.htmlIdGenerator)(),Of=(e,t)=>e.label||t.convert({gte:np(e.from)?e.from:-1/0,lt:np(e.to)?e.to:1/0}),If=({range:e,setRange:t,button:a,triggerClose:n,isOpen:i})=>{const[r,o]=Object(s.useState)(e),c=l.a.useRef(),d=l.a.useRef(),p=(a,n=!1)=>{n&&o(e),t(a)},{from:m,to:g,label:b}=r,h=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:"â‰¤"}),y=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),x=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),j=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"});return Object(v.jsx)(f.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:()=>n(),button:a,"data-test-subj":"indexPattern-ranges-popover"},Object(v.jsx)(f.EuiFormRow,null,Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:np(m)?Number(m):"",onChange:({target:e})=>{const t={...r,from:""!==e.value?Number(e.value):-1/0};o(t),p(t)},append:Object(v.jsx)(f.EuiToolTip,{content:y},Object(v.jsx)(f.EuiText,{size:"s"},h)),onKeyDown:({key:e})=>{f.keys.ENTER===e&&d.current&&d.current.focus()},compressed:!0,placeholder:"âˆ’âˆž",isInvalid:!Pf(r),step:1})),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiIcon,{type:"sortRight",color:"subdued"})),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:np(g)?Number(g):"",inputRef:e=>{d&&e&&(d.current=e)},onChange:({target:e})=>{const t={...r,to:""!==e.value?Number(e.value):1/0};o(t),p(t)},prepend:Object(v.jsx)(f.EuiToolTip,{content:j},Object(v.jsx)(f.EuiText,{size:"s"},x)),compressed:!0,placeholder:"+âˆž",isInvalid:!Pf(r),onKeyDown:({key:e})=>{f.keys.ENTER===e&&c.current&&c.current.focus()},step:1})))),Object(v.jsx)(f.EuiFormRow,null,Object(v.jsx)(hm,{inputRef:c,value:b||"",onChange:e=>{const t={...r,label:e};o(t),p(t)},placeholder:u.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:()=>{n()},compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},Mf=({ranges:e,setRanges:t,onToggleEditor:a,formatter:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:jf()})))));Object(M.t)((()=>{t(o.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[o]);const d=Object(s.useCallback)((()=>{const e=jf();c([...o,{id:e,from:o[o.length-1].to,to:Number.POSITIVE_INFINITY,label:""}]),r(e)}),[o]),p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(v.jsx)(f.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(v.jsx)(f.EuiText,{size:"xs"},Object(v.jsx)(f.EuiLink,{color:"danger",onClick:a},Object(v.jsx)(f.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",u.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Jp.a,{onDragEnd:c,droppableId:"RANGES_DROPPABLE_AREA",items:o},o.map(((e,t,a)=>Object(v.jsx)(Jp.b,{key:e.id,idx:t,id:e.id,isInvalid:!Pf(e),invalidMessage:u.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=a.filter(((e,a)=>a!==t));c(e)},removeTitle:u.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===a.length,isNotDraggable:a.length<2},Object(v.jsx)(If,{range:e,isOpen:e.id===i,triggerClose:()=>p(""),setRange:e=>{const n=[...a];e.id===n[t].id?n[t]=e:n.push(e),c(n)},button:Object(v.jsx)(f.EuiLink,{color:"text",onClick:()=>p(e.id),className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(v.jsx)(f.EuiText,{size:"s",textAlign:"left",color:Pf(e)?"default":"danger"},Of(e,n)))}))))),Object(v.jsx)(tm.a,{onClick:d,label:u.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))};a(475);const Tf=({children:e,onClick:t})=>Object(v.jsx)(f.EuiText,{size:"xs"},Object(v.jsx)(f.EuiLink,{onClick:t},Object(v.jsx)(f.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),wf=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>Object(v.jsx)(f.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(v.jsx)(f.EuiPopoverTitle,{paddingSize:"m"},s),Object(v.jsx)(f.EuiText,{className:"lnsHelpPopover__content",size:"s"},a)),kf=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s,startServices:l})=>Object(v.jsx)(c.a,l,Object(v.jsx)(f.EuiWrappingPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(v.jsx)(f.EuiPopoverTitle,{paddingSize:"m"},s),Object(v.jsx)(f.EuiText,{className:"lnsHelpPopover__content",size:"s"},a))),Ef=()=>{const[e,t]=Object(s.useState)(!1);return Object(v.jsx)(wf,{anchorPosition:"upCenter",button:Object(v.jsx)(Tf,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the â€œniceâ€ interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(v.jsx)(f.EuiCode,null,Fl.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},Cf=({maxBars:e,step:t,maxHistogramBars:a,onToggleEditor:n,onMaxBarsChange:i,includeEmptyRows:r,onChangeIncludeEmptyRows:o})=>{const[c,d]=Object(s.useState)(String(e));Object(M.t)((()=>{i(Number(c))}),{skipFirstRender:!0},256,[c]);const p=u.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),m=u.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),g=u.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.ranges.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(r),onChange:()=>{o(!r)},compressed:!0})),Object(v.jsx)(f.EuiFormRow,{label:p,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(v.jsx)(Ef,null)},Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiToolTip,{content:m,delay:"long"},Object(v.jsx)(f.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>d(""+Math.max(Number(c)-t,1)),"aria-label":m}))),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":p,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:a,step:t,value:c,onChange:({currentTarget:e})=>d(e.value)})),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiToolTip,{content:g,delay:"long"},Object(v.jsx)(f.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>d(""+Math.min(Number(c)+t,a)),"aria-label":g}))))),Object(v.jsx)(f.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>n()},u.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})))},Ff=({setParam:e,params:t,maxHistogramBars:a,maxBars:n,granularityStep:i,onChangeMode:l,rangeFormatter:r})=>{const[o,u]=Object(s.useState)(t.type===yf);return o?Object(v.jsx)(Mf,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{l(xf),u(!1)},formatter:r}):Object(v.jsx)(Cf,{includeEmptyRows:t.includeEmptyRows,maxBars:n,step:i,maxHistogramBars:a,onMaxBarsChange:t=>{e("maxBars",t)},onChangeIncludeEmptyRows:t=>{e("includeEmptyRows",t)},onToggleEditor:()=>{l(yf),u(!0)}})};var Sf=a(169);const Af=e=>np(e.from)&&np(e.to),Pf=e=>!Af(e)||(e=>e.from<=e.to)(e);function _f(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const Lf=[Tm,Xm,Sg,jg,Og,Ig,cg,Tg,Mg,wg,gg,hg,hf,lf,{type:"range",displayName:u.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,a)=>ep(e,t,a),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("number"===a&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t,a)=>{var n,i;return null!==(n=null==a||null===(i=a.getFieldByName(e.sourceField))||void 0===i?void 0:i.displayName)&&void 0!==n?n:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn({field:e},t){var a,n,i,s,l;const r=null!==(a=null==t?void 0:t.type)&&void 0!==a?a:xf;return{label:e.displayName,dataType:r===xf?"number":"string",operationType:"range",sourceField:e.name,isBucketed:!0,scale:r===xf?"interval":"ordinal",params:{includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,type:null!==(i=null==t?void 0:t.type)&&void 0!==i?i:xf,ranges:null!==(s=null==t?void 0:t.ranges)&&void 0!==s?s:[{from:0,to:1e3,label:""}],maxBars:null!==(l=null==t?void 0:t.maxBars)&&void 0!==l?l:vf,format:null==t?void 0:t.format,parentFormat:null==t?void 0:t.parentFormat}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"number"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,a,n,i)=>{const{sourceField:s,params:l}=e;if(l.type===yf)return Object(Ut.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:s,ranges:l.ranges.filter(Pf).map((e=>{if(Af(e))return e;const t={label:e.label};return np(e.from)&&(t.from=Number(e.from)),np(e.to)&&(t.to=Number(e.to)),t})).map(An.numericalRangeToAst)}).toAst();const r=(i.get(Fl.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(Ut.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:s,maxBars:l.maxBars===vf?r:l.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:Boolean(l.includeEmptyRows),autoExtendBounds:Boolean(l.includeEmptyRows),extended_bounds:Object(An.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,indexPattern:i,uiSettings:s,fieldFormats:l})=>{var r,o;const u=i.getFieldByName(a.sourceField),c=a.params.format,d=c&&Sf.a[c.id]&&Sf.a[c.id].decimalsToPattern((null===(r=c.params)||void 0===r?void 0:r.decimals)||0),p=c&&Sf.a[c.id].formatId,m=l.deserialize({...a.params.parentFormat||{id:"range"},params:{...null===(o=a.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:p,params:{pattern:d}}:_f(i,u)}}),g=s.get(Fl.UI_SETTINGS.HISTOGRAM_MAX_BARS),f=(g-1)/6,b=(g-1)/2;return Object(v.jsx)(Ff,{setParam:(a,i)=>{n(_p({layer:e,columnId:t,paramName:a,value:i}))},maxBars:a.params.maxBars===vf?b:a.params.maxBars,granularityStep:f,params:a.params,onChangeMode:i=>{const s=i===yf?"ordinal":"interval",l=i===yf?"string":"number",r=i===yf?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;n({...e,columns:{...e.columns,[t]:{...a,scale:s,dataType:l,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:b,format:a.params.format,parentFormat:r}}}})},maxHistogramBars:s.get(Fl.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:m})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.ranges.documentation.quick",{defaultMessage:"\n    Buckets values along defined numeric ranges.\n      "})},$g,Gg,Ug,Xg,Bd,mp,Kg,Zg,Jg,ef,uf,tf,fp,bp,hp],Df=Lf,Rf=Lf.reduce(((e,t)=>({...e,[t.type]:t})),{}),Nf=Object(pa.memoize)((()=>{const e={};return Df.forEach((({type:t,displayName:a})=>{e[t]={type:t,displayName:a}})),e}));function Bf(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}const zf=e=>(t,a)=>{var n,i,s;return(null==e||null===(n=e.partiallyApplicableFunctions)||void 0===n?void 0:n[t.type])!==(null==e||null===(i=e.partiallyApplicableFunctions)||void 0===i?void 0:i[a.type])?null!=e&&null!==(s=e.partiallyApplicableFunctions)&&void 0!==s&&s[t.type]?1:-1:(a.priority||Number.NEGATIVE_INFINITY)-(t.priority||Number.NEGATIVE_INFINITY)};function Vf(e){var t,a,n;return Zd(e)?null!==(t=null===(a=Rf[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))&&void 0!==t?t:[e.sourceField]:[]}function Gf(e){var t;return null===(t=Rf[e])||void 0===t?void 0:t.getParamsForMultipleFields}function qf(e,t,a,n){var i,s;return Boolean(null===(i=Rf[t.operationType])||void 0===i||null===(s=i.canAddNewField)||void 0===s?void 0:s.call(i,{targetColumn:t,sourceColumn:a,field:n,indexPattern:e}))}function $f(e,t,a){return Df.filter((a=>{if("field"!==a.input)return!1;const n=a.getPossibleOperationForField(e);return t?n&&t(n):n})).sort(zf(e)).sort(((e,t)=>{if(!a)return 0;const n=a.has(e.type);return n===a.has(t.type)?0:n?1:-1})).map((({type:e})=>e))}const Hf=Object(pa.memoize)((function(e,t){const a={},n=(e,t)=>{if(!t)return;const n=JSON.stringify(t);a[n]?a[n].operations.push(e):a[n]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):Df).sort(Bf).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{n({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"none",operationType:t.type},a)}else if("fullReference"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"fullReference",operationType:t.type},a)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&n({type:"managedReference",operationType:t.type,usedInMath:t.usedInMath},e)}})),Object.values(a)}));var Uf=a(129);function Wf(){Hf.cache.clear&&Hf.cache.clear()}const Xf=(e,t)=>{var a;const n=Object(Uf.b)(e,"indexPatternId");return n&&(null===(a=t.find((e=>e.id===n)))||void 0===a?void 0:a.id)},Yf=(e,t)=>{Object(Uf.c)(e,"indexPatternId",t)};function Qf(e){return`indexpattern-datasource-layer-${e}`}function Kf(e,t){const a={};return Object.entries(e.layers).forEach((([e,n])=>{var i;const s=null===(i=t.find((({name:t})=>t===Qf(e))))||void 0===i?void 0:i.id;s&&(a[e]={...n,indexPatternId:s})})),{layers:a}}function Zf(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}var Jf=a(480),eb=a.n(Jf);const tb=u.i18n.translate("searchResponseWarnings.viewDetailsButtonLabel",{defaultMessage:"View details",description:"View warning details button label"});function ab(e){const t=new Set;return e.forEach((e=>{Object.keys(e.clusters).forEach((a=>{"successful"!==e.clusters[a].status&&t.add(a)}))})),t}function nb(e){const t=ab(e),a=u.i18n.translate("searchResponseWarnings.title.clustersClause",{defaultMessage:"Problem with {nonSuccessfulClustersCount} {nonSuccessfulClustersCount, plural, one {cluster} other {clusters}}",values:{nonSuccessfulClustersCount:t.size}});return e.length<=1?a:u.i18n.translate("searchResponseWarnings.title.clustersClauseAndRequestsClause",{defaultMessage:"{clustersClause} in {requestsCount} requests",values:{clustersClause:a,requestsCount:e.length}})}const ib=e=>{const[t,a]=Object(s.useState)(0),n=new Map;return Object(v.jsx)("div",{className:"euiContextMenu"},1===t?Object(v.jsx)(f.EuiContextMenuPanel,{items:e.warnings.map((t=>{const a=n.has(t.requestName)?n.get(t.requestName)+1:1,i=a>1?`${t.requestName} (${a})`:t.requestName;return n.set(t.requestName,a),Object(v.jsx)(f.EuiContextMenuItem,{key:i,onClick:()=>{var a;null===(a=e.onViewDetailsClick)||void 0===a||a.call(e),t.openInInspector()}},i)})),onClose:()=>{a(0)},title:tb}):Object(v.jsx)(f.EuiContextMenuPanel,{title:nb(e.warnings)},Object(v.jsx)(f.EuiPanel,{color:"transparent",paddingSize:"s"},Object(v.jsx)(f.EuiText,{size:"s"},ab(e.warnings).size<=1?u.i18n.translate("searchResponseWarnings.description.singleCluster",{defaultMessage:"This cluster had issues returning data and results might be incomplete."}):u.i18n.translate("searchResponseWarnings.description.multipleClusters",{defaultMessage:"These clusters had issues returning data and results might be incomplete."})),Object(v.jsx)(f.EuiButtonEmpty,{color:"primary",flush:"left",iconSide:e.warnings.length>1?"right":void 0,iconType:e.warnings.length>1?"arrowRight":void 0,onClick:()=>{var t;e.warnings.length>1?a(1):(null===(t=e.onViewDetailsClick)||void 0===t||t.call(e),e.warnings[0].openInInspector())}},tb))))};function sb({state:e,layerId:t,newLayer:a}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...a}}}}function lb({state:e,newLayers:t}){return{...e,layers:{...e.layers,...t}}}function rb({layers:e,visualizationInfo:t,dataViews:a}){return Object(v.jsx)(l.a.Fragment,null,e.map((([e,n],i)=>{const s=a.indexPatterns[n.indexPatternId],l=t.layers.find((({layerId:t,label:a})=>t===e)),r=(null==l?void 0:l.label)||u.i18n.translate("xpack.lens.indexPattern.samplingPerLayer.fallbackLayerName",{defaultMessage:"Data layer"}),o=null==l?void 0:l.palette;return Object(v.jsx)($l,{title:r,index:i,dataView:s.id,palette:o,"data-test-subj-prefix":"lns-feature-badges-reducedSampling"},Object(v.jsx)(f.EuiText,{size:"s"},100*Number(cb(n))+"%"))})))}function ob(e){return!!e&&(ip("max",e)||ip("min",e))}function ub(e){return!Object.values(e.columns).some((t=>ob(t)||function(e){return"references"in e}(t)&&ob(e.columns[t.references[0]])))}function cb(e){var t;return ub(e)&&null!==(t=e.sampling)&&void 0!==t?t:1}const db=(e,t,a)=>({uniqueId:Ft.L,severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled.shortMessage",{defaultMessage:"This might be an approximation. For more precise results, you can enable accuracy mode, but it increases the load on the Elasticsearch cluster."}),longMessage:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled",defaultMessage:"{name} might be an approximation. You can enable accuracy mode for more precise results, but note that it increases the load on the Elasticsearch cluster.",values:{name:Object(v.jsx)("strong",null,e)}}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiLink,{"data-test-subj":"lnsPrecisionWarningEnableAccuracy",onClick:a},u.i18n.translate("xpack.lens.indexPattern.enableAccuracyMode",{defaultMessage:"Enable accuracy mode"})))}),pb=(e,t,a)=>({uniqueId:Ft.M,severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled.shortMessage",{defaultMessage:"This might be an approximation. For more precise results, use Filters or increase the number of Top Values."}),longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled",defaultMessage:"{name} might be an approximation. For more precise results, try increasing the number of {topValues} or using {filters} instead. {learnMoreLink}",values:{name:Object(v.jsx)("strong",null,e),topValues:Object(v.jsx)("strong",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.topValues",defaultMessage:"Top Values"})),filters:Object(v.jsx)("strong",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.filters",defaultMessage:"Filters"})),learnMoreLink:Object(v.jsx)(f.EuiLink,{href:a,target:"_blank",external:!0},Object(v.jsx)($t.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}})});function mb(e){return null==e?void 0:e.map((({input:e})=>e)).filter((({query:e})=>(null==e?void 0:e.trim())&&"*"!==e))}function gb(e){return e.params.ranges.map((({from:t,to:a})=>{let n="";return null!=t&&isFinite(t)&&(n+=`${e.sourceField} >= ${t}`),null!=a&&isFinite(a)&&(n.length&&(n+=" AND "),n+=`${e.sourceField} <= ${a}`),{query:n,language:"kuery"}})).filter((({query:e})=>null==e?void 0:e.trim()))}function fb(e,t){return[{language:"kuery",query:`"${e.sourceField}" >= "${t.from}" AND "${e.sourceField}" <= "${t.to}"`}]}function bb(e,t,a){const n=[e.sourceField].concat(e.params.secondaryFields||[]).filter(Boolean),i=a.rows.map((({[t]:a})=>{if(null!=a)return"string"!=typeof a&&Array.isArray(a.keys)?a.keys.map(((e,t)=>`${n[t]}: "${""===e?Object(pa.escape)(e):e}"`)).join(" AND "):`${e.sourceField}: "${""===a?Object(pa.escape)(a):a}"`})).filter(Boolean);return[...new Set(i)].map((e=>({language:"kuery",query:e})))}function hb(e,t,a){return[e[a],...t.map((({[a]:e})=>e))].filter((e=>null==e?void 0:e.length))}const vb=(e,t,a,n)=>{var i,s;return e[t]?{...e,[a]:Object(Ct.renewIDs)(e[t],Object.keys(null!==(i=null===(s=e[t])||void 0===s?void 0:s.columns)&&void 0!==i?i:{}),n)}:e},yb=e=>e.split(".")[0].split("-")[2],xb=(e,t)=>{const[a,n,i]=e.split("."),s=a.split("-");return s[1]=String(t),s.join("-")+function(e,t){return e||t?t?`['${e}.${t}']`:`.${e}`:""}(n,i)};function jb(e){const t={};e.forEach((([e,a])=>{t[e]="references"in a?a.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const a=[];for(;a.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(a.push(e),delete t[e],Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t!==e))})))}));return a}a(170);var Ob=a(668);function Ib(e,t,a){const n=e.filter((e=>e!==a)),i=n.indexOf(t);return n.splice(i+1,0,a),n}function Mb(e,t){var a;return Zd(e)?(null===(a=t(e.sourceField))||void 0===a?void 0:a.displayName)||e.sourceField:""}function Tb({columnId:e,layer:t,setColumns:a,getFieldByName:n}){const i=t.columns[e],s=Object.entries(t.columns).filter((([t,a])=>t!==e&&a.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:Mb(t,n),operationType:t.operationType})));if(!i||!i.isBucketed||!s.length)return null;const r=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===s.length){const[n]=s,i=u.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Aggregate by this dimension first"});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(v.jsx)(f.EuiSwitch,{label:Object(v.jsx)(f.EuiText,{size:"xs"},i),"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!r,onChange:()=>{a(r?Ib(t.columnOrder,e,n.value):Ib(t.columnOrder,n.value,e))},compressed:!0})))}return Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(v.jsx)(f.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:u.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...s.map((({value:e,text:t})=>({value:e,text:t})))],value:r,onChange:n=>a(Ib(t.columnOrder,n.target.value,e))}))}const wb=Object(s.createContext)({minWidth:0,onResize:()=>{}}),kb=({children:e})=>{const[t,a]=Object(s.useState)(0);return Object(v.jsx)(wb.Provider,{value:{minWidth:t,onResize:({width:e})=>{e>t&&a(e)}}},e)},Eb=({children:e})=>{const{minWidth:t,onResize:a}=Object(s.useContext)(wb),[n,i]=Object(s.useState)(null),l=Object(f.useResizeObserver)(n,"width").width,{euiTheme:r}=Object(f.useEuiTheme)(),o=2*parseInt(r.size.m,10);return Object(s.useEffect)((()=>{a({width:l,height:0})}),[l,a]),Object(v.jsx)(f.EuiFormLabel,{css:Object(v.css)({minWidth:Math.round(t)+o},"","")},Object(v.jsx)("span",{style:{display:"inline-block"},ref:i},e))},Cb=Km.DURATION_OUTPUT_FORMATS.map((function({text:e,method:t}){return"humanize"===t?{label:u.i18n.translate("xpack.lens.indexPattern.duration.humanizeLabel",{defaultMessage:"Friendly (approximate)"}),value:t}:"humanizePrecise"===t?{label:u.i18n.translate("xpack.lens.indexPattern.duration.humanizePreciseLabel",{defaultMessage:"Friendly (precise)"}),value:t}:{label:e,value:t}})),Fb=Km.DURATION_INPUT_FORMATS.map((({text:e,kind:t})=>({label:e,value:t})));function Sb(e,t){const a=t.find((({value:t})=>e===t));return a?[a]:[]}const Ab=({testSubjLayout:e,testSubjStart:t,testSubjEnd:a,startValue:n="milliseconds",endValue:i="seconds",onStartChange:s,onEndChange:r})=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiComboBox,{prepend:Object(v.jsx)(Eb,null,u.i18n.translate("xpack.lens.indexPattern.duration.fromLabel",{defaultMessage:"Convert"})),isClearable:!1,options:Fb,selectedOptions:Sb(n,Fb),onChange:([e])=>s(e.value),singleSelection:{asPlainText:!0},"data-test-subj":t,compressed:!0}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiComboBox,{prepend:Object(v.jsx)(Eb,null,u.i18n.translate("xpack.lens.indexPattern.custom.toLabel",{defaultMessage:"To"})),isClearable:!1,options:Cb,selectedOptions:Sb(i,Cb),onChange:([e])=>r(e.value),singleSelection:{asPlainText:!0},"data-test-subj":a,compressed:!0})),Pb={number:{title:u.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},percent:{title:u.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},bytes:{title:u.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!1},bits:{title:u.i18n.translate("xpack.lens.indexPattern.bitsFormatLabel",{defaultMessage:"Bits (1000)"}),defaultDecimals:0,supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!1},duration:{title:u.i18n.translate("xpack.lens.indexPattern.durationLabel",{defaultMessage:"Duration"}),defaultDecimals:0,supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},custom:{title:u.i18n.translate("xpack.lens.indexPattern.customFormatLabel",{defaultMessage:"Custom format"}),defaultDecimals:0,supportsDecimals:!1,supportsSuffix:!1,supportsCompact:!1}},_b={value:"",label:u.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},Lb={asPlainText:!0},Db=u.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),Rb=u.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),Nb=u.i18n.translate("xpack.lens.indexPattern.suffixLabel",{defaultMessage:"Suffix"}),Bb=u.i18n.translate("xpack.lens.indexPattern.compactLabel",{defaultMessage:"Compact values"}),zb=0,Vb=15;function Gb(e,t,a,n){var i;const l=Object(s.useCallback)((t=>{a&&n({id:a.id,params:{...a.params,[e]:t}})}),[a,e,n]),{handleInputChange:r,inputValue:o}=Object(je.a)({onChange:l,value:(null==a||null===(i=a.params)||void 0===i?void 0:i[e])||t},{allowFalsyValue:!0});return{setter:r,value:o}}function qb(e){var t,a,n;const{uiSettings:i}=Object(Cl.useKibana)().services,{euiTheme:r}=Object(f.useEuiTheme)(),{selectedColumn:o,onChange:c,docLinks:d}=e,p=lp(o)?null===(t=o.params)||void 0===t?void 0:t.format:void 0,[m,g]=Object(s.useState)(null!==(a=null==p||null===(n=p.params)||void 0===n?void 0:n.decimals)&&void 0!==a?a:2),{setter:b,value:h}=Gb("suffix","",p,c),{setter:y,value:x}=Gb("compact",!1,p,c),j=i.get(Km.FORMATS_UI_SETTINGS.FORMAT_NUMBER_DEFAULT_PATTERN),{setter:O,value:I}=Gb("pattern",j,p,c),{setter:M,value:T}=Gb("fromUnit",Km.DEFAULT_DURATION_INPUT_FORMAT.kind,p,c),{setter:w,value:k}=Gb("toUnit",Km.DEFAULT_DURATION_OUTPUT_FORMAT.method,p,c),E=null!=p&&p.id?Pb[p.id]:void 0,C=Object(s.useMemo)((()=>[_b,...Object.entries(Pb).map((([e,t])=>{var a;return{value:e,label:null!==(a=t.title)&&void 0!==a?a:e}}))]),[]),F=Object(s.useCallback)((e=>{if(0===e.length)return;if(!e[0].value)return void c();const t=e[0].value,a=Pb[t].defaultDecimals;c({id:e[0].value,params:{decimals:null!=a?a:m}}),g(null!=a?a:m)}),[c,m]),S=Object(s.useMemo)((()=>{var e;return p?[{value:p.id,label:null!==(e=null==E?void 0:E.title)&&void 0!==e?e:p.id}]:[_b]}),[p,null==E?void 0:E.title]),A="duration"===(null==p?void 0:p.id)&&"humanize"===k;return Object(v.jsx)(kb,null,Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{label:Db,display:"columnCompressed",fullWidth:!0},Object(v.jsx)("div",null,Object(v.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":Db,singleSelection:Lb,options:C,selectedOptions:S,onChange:F}),p&&E?Object(v.jsx)(l.a.Fragment,null,"duration"===(null==p?void 0:p.id)?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(Ab,{onStartChange:M,onEndChange:w,startValue:T,endValue:k,testSubjEnd:"indexPattern-dimension-duration-end",testSubjStart:"indexPattern-dimension-duration-start"})):null,E.supportsDecimals&&!A?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiRange,{showInput:"inputWithPopover",value:m,min:zb,max:Vb,onChange:e=>{const t=Number(e.currentTarget.value);g(t);const a=Math.min(Vb,Math.max(zb,t));c({id:p.id,params:{...p.params,decimals:a}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:Object(v.jsx)(Eb,null,Rb),"aria-label":Rb,disabled:A})):null,E.supportsSuffix?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiFieldText,{value:h,onChange:e=>{b(e.currentTarget.value)},"data-test-subj":"indexPattern-dimension-formatSuffix",compressed:!0,fullWidth:!0,prepend:Object(v.jsx)(Eb,null,Nb),"aria-label":Nb})):null,E.supportsCompact&&!A?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiSwitch,{compressed:!0,label:Object(v.jsx)(f.EuiFormLabel,{css:Object(v.css)("font-weight:",r.font.weight.regular,";","")},Bb),checked:Boolean(x),onChange:()=>y(!x),"data-test-subj":"lns-indexpattern-dimension-formatCompact"})):null):null)),"custom"===(null==p?void 0:p.id)?Object(v.jsx)(f.EuiFormRow,{display:"columnCompressed",hasEmptyLabelSpace:!0,label:" ",helpText:Object(v.jsx)(f.EuiLink,{href:d.links.indexPatterns.fieldFormattersNumber,target:"_blank",external:!0},u.i18n.translate("xpack.lens.indexPattern.custom.externalDoc",{defaultMessage:"Numeral formatting syntax"}))},Object(v.jsx)(f.EuiFieldText,{"data-test-subj":"numberEditorFormatPattern",compressed:!0,prepend:Object(v.jsx)(Eb,null,u.i18n.translate("xpack.lens.indexPattern.custom.patternLabel",{defaultMessage:"Format"})),value:I,placeholder:j,onChange:e=>{O(e.target.value)}})):null))}const $b=Nf(),Hb=e=>{var t;const{currentIndexPattern:a,validation:n,selectionStyle:r,labelAppend:o,column:c,incompleteColumn:d,functionLabel:p,onChooseField:m,onDeleteColumn:g,onResetIncomplete:b,onChooseFunction:h,fieldLabel:y,operationDefinitionMap:x,isInline:j}=e,O=c&&x[c.operationType],I=Object(s.useMemo)((()=>{const e=new Set,t=new Set,i=new Map,s=new Map;return Object.values(x).filter((({hidden:e,allowAsReference:t})=>!e&&t)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((l=>{if("field"===l.input){const t=a.fields.filter((e=>Wp({operationType:l.type,validation:n,field:e,indexPattern:a})));t.length&&(e.add(l.type),s.set(l.type,new Set(t.map((({name:e})=>e)))),t.forEach((e=>{var t;const a=null!==(t=i.get(e.name))&&void 0!==t?t:new Set;a.add(l.type),i.set(e.name,a)})))}else Wp({operationType:l.type,validation:n,indexPattern:a})&&(e.add(l.type),t.add(l.type))})),{operationTypes:e,operationWithoutField:t,operationByField:i,fieldByOperation:s}}),[a,n,x]);if("hidden"===r)return null;const M=null==d?void 0:d.operationType,T=null!==(t=null==d?void 0:d.sourceField)&&void 0!==t?t:null,w=((e,t,a)=>Array.from(e.operationTypes).map((n=>{var i;const s=t[n];return{label:$b[n].displayName,value:n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${n}${!a||a&&Zd(a)&&"field"===s.input&&(null===(i=e.fieldByOperation.get(n))||void 0===i?void 0:i.has(a.sourceField))||a&&!Zd(a)&&"field"!==s.input?"":" incompatible"}`}})))(I,x,c),k=M?[null==w?void 0:w.find((({value:e})=>e===M))]:c?[null==w?void 0:w.find((({value:e})=>e===c.operationType))]:[],E=Boolean(k.length&&null==k[0]);if(E){const e=M||(null==c?void 0:c.operationType),t={label:e&&$b[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};null==w||w.push(t),k[0]=t}const C=!c&&!Boolean(M),F=Boolean(M)||"field"===r&&!c,S=!a.getFieldByName(null!=T?T:null==c?void 0:c.sourceField),A=null==O?void 0:O.paramEditor;return Object(v.jsx)("div",null,"field"!==r?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(vm,{isInline:j,"data-test-subj":"indexPattern-subFunction-selection-row",label:p||u.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:C||E},Object(v.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:p||u.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:w,isInvalid:C||E,selectedOptions:k,singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return g();const t=e[0].value;if(d&&b(),(null==c?void 0:c.operationType)===t)return;const n=I.fieldByOperation.get(t),i=c&&"sourceField"in c&&null!=n&&n.has(c.sourceField)?a.getFieldByName(c.sourceField):1===(null==n?void 0:n.size)?a.getFieldByName(n.values().next().value):void 0;h(t,i)}})),Object(v.jsx)(f.EuiSpacer,{size:"s"})):null,c&&"field"!==(null==O?void 0:O.input)?null:Object(v.jsx)(vm,{isInline:j,"data-test-subj":"indexPattern-reference-field-selection-row",label:y||u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:F||S,labelAppend:o},Object(v.jsx)(sm,{fieldIsInvalid:F||S,currentIndexPattern:a,operationByField:I.operationByField,selectedOperationType:c?c.operationType:M,selectedField:null!=T?T:null==c?void 0:c.sourceField,incompleteOperation:M,markAllFieldsCompatible:"field"===r,onDeleteColumn:g,onChoose:m,showTimeSeriesDimensions:!1})),c&&!d&&A&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(A,i()({},e,{isReferenced:!0,operationDefinitionMap:x,currentColumn:c,indexPattern:e.currentIndexPattern}))))};function Ub({selectedColumn:e,columnId:t,layer:a,updateLayer:n}){var i;const s=Rf[e.operationType];return s.timeScalingMode&&"disabled"!==s.timeScalingMode?Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Object(v.jsx)(f.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(v.jsx)("span",null,u.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(v.jsx)(f.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiSelect,{fullWidth:!0,compressed:!0,options:[{value:"",text:u.i18n.translate("xpack.lens.timeScale.normalizeNone",{defaultMessage:"None"})},...Object.entries(Jm).map((([e,t])=>({value:e,text:t})))],"data-test-subj":"indexPattern-time-scaling-unit",value:null!==(i=e.timeScale)&&void 0!==i?i:"",onChange:e=>{const i=e.target.value||void 0;n(function(e,t,a){const n=t.columns[e],i=n.customLabel?n.label:ng(n.label,n.timeScale,a,n.timeShift,n.timeShift,n.reducedTimeRange,n.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:a}}}}(t,a,i))}})))):null}var Wb=a(667);function Xb({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:l}){const r=e.filter,o=Object(s.useCallback)((e=>{const{isValid:s}=Object(gi.b)(e,i);s&&!Object(pa.isEqual)(r,e)&&n(function(e,t,a){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:a}}}}(t,a,e))}),[t,i,r,a,n]),u=Object(Cl.useKibana)().services;return Rf[e.operationType].filterable?Object(v.jsx)(Wb.a,{helpMessage:l,onChange:o,dataView:i,inputFilter:r,queryInputServices:u,appName:Wt.LENS_APP_NAME}):null}function Yb(e,t,a,n){const i=null==a?void 0:a.trim(),s=t.columns[e],l=s.customLabel||n?s.label:ng(s.label,s.timeScale,s.timeScale,s.timeShift,s.timeShift,s.reducedTimeRange,i);return{...t,columns:{...t.columns,[e]:{...t.columns[e],reducedTimeRange:i,label:l}}}}function Qb(e){return"previous"===e||"invalid"===e}function Kb({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:r,skipLabelUpdate:o}){const[c,d]=Object(s.useState)(e.reducedTimeRange);Object(s.useEffect)((()=>{d(e.reducedTimeRange)}),[e.reducedTimeRange]);const p=Rf[e.operationType],m=Object.values(a.columns).some((e=>"date_histogram"===e.operationType));if(!p.canReduceTimeRange||!e.reducedTimeRange&&(m||!i.timeFieldName))return null;const g=c&&Object(An.parseTimeShift)(c),b=Boolean(g&&Qb(g)),h=Boolean(m||!i.timeFieldName),y=u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.label",{defaultMessage:"Reduced time range"});return Object(v.jsx)("div",null,Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange-row",label:r?Object(v.jsx)(l.a.Fragment,null,y," ",Object(v.jsx)(f.EuiIconTip,{color:"subdued",content:r,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):y,helpText:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.help",{defaultMessage:"Reduces the time range specified in the global time filter from the end of the global time filter."}),error:h?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.notApplicableHelp",{defaultMessage:"Additional time range filter can not be used together with date histogram or without a default time field specified on the data view"}):b?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.genericInvalidHelp",{defaultMessage:"Time range value is not valid."}):void 0,isInvalid:b||h},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange",placeholder:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangePlaceholder",{defaultMessage:"Type custom values (e.g. 12m)"}),options:xd,selectedOptions:function(){if(!c)return[];const e=xd.filter((({value:e})=>e===c));return e.length>0?e:[{value:c,label:c}]}(),singleSelection:{asPlainText:!0},isInvalid:b,onCreateOption:e=>{Qb(Object(An.parseTimeShift)(e))?d(e):n(Yb(t,a,e,o))},onChange:e=>{if(0===e.length)return n(Yb(t,a,"",o)),void d("");const i=e[0].value;Qb(Object(An.parseTimeShift)(i))?d(i):n(Yb(t,a,i,o))}})))))}function Zb(e){const{euiTheme:t}=Object(f.useEuiTheme)();return Object(v.jsx)(f.EuiAccordion,{id:"advancedOptionsAccordion",arrowProps:{color:"primary"},"data-test-subj":"indexPattern-advanced-accordion",className:"lnsIndexPatternDimensionEditor-advancedOptions",buttonContent:Object(v.jsx)(f.EuiTitle,{size:"xxs"},Object(v.jsx)("h5",null,Object(v.jsx)(f.EuiTextColor,{color:t.colors.primary},u.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Advanced"})))),css:Object(v.css)("padding:0 ",t.size.base," ",t.size.base,";","")},e.options.map((({dataTestSubj:e,inlineElement:t})=>Object(v.jsx)("div",{key:e,"data-test-subj":e},Object(v.jsx)(f.EuiSpacer,{size:"s"}),t))))}function Jb(e,t,a){const n=null==a?void 0:a.trim(),i=t.columns[e],s=i.customLabel?i.label:ng(i.label,i.timeScale,i.timeScale,i.timeShift,n,i.reducedTimeRange,i.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:s,timeShift:n}}}}function eh({datatableUtilities:e,selectedColumn:t,columnId:a,layer:n,updateLayer:i,indexPattern:l,activeData:r,layerId:o}){var c;const[d,p]=Object(s.useState)(t.timeShift);if(Object(s.useEffect)((()=>{p(t.timeShift)}),[t.timeShift]),!Rf[t.operationType].shiftable)return null;const m=fd(e,n,l,r,o),{canShift:g,isValueTooSmall:b,isValueNotMultiple:h,isInvalid:y}=bd(m);if(!g)return null;const x=d&&Object(An.parseTimeShift)(d),j=Boolean(x&&y(x)),O=hd(m,d);return Object(v.jsx)("div",null,Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-time-shift-row",label:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:u.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:null!==(c=O[0])&&void 0!==c?c:j&&u.i18n.translate("xpack.lens.indexPattern.timeShift.genericInvalidHelp",{defaultMessage:"Time shift value is not valid."}),isInvalid:Boolean(j||O.length)},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:u.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:md.filter((({value:e})=>{const t=Object(An.parseTimeShift)(e);return t&&!b(t)&&!h(t)})),selectedOptions:function(){const e=md.filter((({value:e})=>e===d));return e.length>0?e:[{value:null!=d?d:"",label:null!=d?d:u.i18n.translate("xpack.lens.timeShift.none",{defaultMessage:"None"})}]}(),singleSelection:{asPlainText:!1},isInvalid:j,onCreateOption:e=>{const t=Object(An.parseTimeShift)(e);y(t)?p(e):i(Jb(a,n,e))},onChange:e=>{if(0===e.length||e.length&&""===e[0].value)return i(Jb(a,n,"")),void p("");const t=e[0].value,s=Object(An.parseTimeShift)(t);y(s)?p(t):i(Jb(a,n,t))}})))))}const th="formula",ah="static_value",nh="quickFunctions",ih=new Set([th,ah]);function sh(e){return!ih.has(e)}const lh=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&sh(e)?null:e===ah&&"quickFunctions"===t?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"warning",color:"warning"},Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"warning",color:"warning"},"quickFunctions"!==t?Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),rh=({options:e,onMethodChange:t,selectedMethod:a})=>{const n=e.filter((({enabled:e})=>e)).map((({id:e,label:t})=>({id:e,label:t,"data-test-subj":`lens-dimensionTabs-${e}`})));return Object(v.jsx)(f.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingMethod",{defaultMessage:"Method"}),fullWidth:!0},Object(v.jsx)(f.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.indexPattern.dimensionEditorModes",{defaultMessage:"Dimension editor configuration modes"}),buttonSize:"compressed",isFullWidth:!0,options:n,idSelected:a,onChange:a=>(a=>{t(a);const n=e.find((({id:e})=>e===a));null==n||n.onClick()})(a)}))},oh=Nf();function uh(e){return e&&"boolean"!=typeof e?e.helpMessage:null}var ch={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};function dh(e){var t,a,n,r,c,d;const{selectedColumn:p,operationSupportMatrix:m,state:g,columnId:b,setState:h,layerId:y,currentIndexPattern:x,hideGrouping:j,dateRange:O,dimensionGroups:I,toggleFullscreen:M,isFullscreen:T,supportStaticValue:w,enableFormatSelector:k=!0,layerType:E,paramEditorCustomProps:C}=e,F={data:e.data,fieldFormats:e.fieldFormats,uiSettings:e.uiSettings,http:e.http,storage:e.storage,unifiedSearch:e.unifiedSearch,dataViews:e.dataViews},{fieldByOperation:S,operationWithoutField:A}=m,P=p&&Rf[p.operationType],[_,L]=Object(s.useState)("none"),[D,R]=Object(s.useState)(!1),[N,B]=Object(s.useState)(!ub(g.layers[y])),[z,V]=Object(s.useState)(!1),[G,q]=Object(s.useState)(!1),$=Boolean(_===nh),H=Boolean(_===ah),{euiTheme:U}=Object(f.useEuiTheme)(),W=Object(s.useCallback)((e=>h((t=>sb({state:t,layerId:y,newLayer:e})))),[y,h]),X=Object(s.useCallback)((t=>{(function(e,t){return Object.entries(e.columns).map((([e,t])=>{if(ip("terms",t))return{id:e,otherBucket:t.params.otherBucket,termsSize:t.params.size}})).filter(Ct.nonNullable).some((({id:e,otherBucket:a,termsSize:n})=>{const i=t.columns[e];return!!ip("terms",i)&&i.params.otherBucket!==a&&!i.params.otherBucket&&i.params.size>=om&&n<om}))})(g.layers[y],t)&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.otherBucketChangeTitle",{defaultMessage:"â€œGroup remaining values as Otherâ€ disabled"}),text:u.i18n.translate("xpack.lens.uiInfo.otherBucketDisabled",{defaultMessage:"Values >= 1000 may slow performance. Re-enable the setting in â€œAdvancedâ€ options."})}),q(!G)}),[y,e.notifications.toasts,g.layers,G]),Y=Object(s.useCallback)((t=>{ub(g.layers[y])&&!ub(t)&&null!=t.sampling&&t.sampling<1&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.samplingDisabledTitle",{defaultMessage:"Layer sampling changed to 100%"}),text:u.i18n.translate("xpack.lens.uiInfo.samplingDisabledMessage",{defaultMessage:"The use of a maximum or minimum function on a layer requires all documents to be sampled in order to function properly."})}),B(!N)}),[N,y,e.notifications.toasts,g.layers]),Q=Object(s.useCallback)((t=>{(function(e,t){return Object.entries(e.columns).map((([t,a])=>{var n;if(ip("terms",a)&&"column"===(null===(n=a.params)||void 0===n?void 0:n.orderBy.type)&&null!=a.params.orderBy.columnId){const n=e.columns[a.params.orderBy.columnId];if(ip("percentile",n)&&Number.isInteger(n.params.percentile))return{id:t,rankId:a.params.orderBy.columnId};if(ip("percentile_rank",n)&&Number.isInteger(n.params.value))return{id:t,rankId:a.params.orderBy.columnId}}})).filter(Ct.nonNullable).some((({id:e,rankId:a})=>{const n=t.columns[e];if(!ip("terms",n))return!1;if("alphabetical"===n.params.orderBy.type){const e=t.columns[a];if(ip("percentile",e))return!Number.isInteger(e.params.percentile);if(ip("percentile_rank",e))return!Number.isInteger(e.params.value)}}))})(g.layers[y],t)&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.rankingResetTitle",{defaultMessage:"Ranking changed to alphabetical"}),text:u.i18n.translate("xpack.lens.uiInfo.rankingResetToAlphabetical",{defaultMessage:"To rank by percentile, use whole numbers only."})}),V(!z)}),[z,y,e.notifications.toasts,g.layers]),K=Object(s.useCallback)((e=>{Y(e),Q(e),X(e)}),[Y,Q,X]),Z=Object(s.useCallback)(((e,t={})=>{const a=g.layers[y];let n;n=sp(e)?{...a,columns:{...a.columns,[b]:e}}:"function"==typeof e?e(g.layers[y]):e;const i=Boolean(n.columns[b]);h((t=>{let a;const n=t.layers[y];a=sp(e)?{...n,columns:{...n.columns,[b]:e}}:"function"==typeof e?e(t.layers[y]):e;const i=Dp(a,b);return K(i),sb({state:t,layerId:y,newLayer:i})}),{isDimensionComplete:i,...t})}),[b,K,y,h,g.layers]),J=(null!==(t=g.layers[y].incompleteColumns)&&void 0!==t?t:{})[b],{operationType:ee,sourceField:te=null,...ae}=J||{},ne=Boolean(w?P&&sh(P.type):!P||sh(P.type)),ie=$||ne,se=H||"none"===_&&w&&(!p||(null==p?void 0:p.operationType)===ah),le=(t=e.state.layers[e.layerId])=>{if((null==p?void 0:p.operationType)!==ah){var a,n,i;const o=xp({layer:t,indexPattern:x,columnId:b,op:ah,visualizationGroups:I});var s,l,r;return null!=(null===(a=e.activeData)||void 0===a||null===(n=a[y])||void 0===n||null===(i=n.rows[0])||void 0===i?void 0:i[b])?Xp(_p({layer:o,columnId:b,paramName:"value",value:null===(s=e.activeData)||void 0===s||null===(l=s[y])||void 0===l||null===(r=l.rows[0])||void 0===r?void 0:r[b]}),x):o}return t},re=function(e,t,a){return e?Rf[ah].paramEditor:null!=t&&t.paramEditor?t.paramEditor:a?Rf[ah].paramEditor:null}(H,P,w&&!ie),oe=Object(s.useMemo)((()=>Object.values(Rf).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=S.get(e))||void 0===t?void 0:t.size)||A.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[S,A]),ue=Object(s.useRef)(null);Object(s.useEffect)((()=>()=>{ue.current&&(o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current))}),[]);const ce=p&&Zd(p)&&x.getFieldByName(p.sourceField),de=ce||function(e,t,a){if(!e)return;if(!("references"in e))return;const n=a.columns[e.references[0]];return n&&Zd(n)?t.getFieldByName(n.sourceField):void 0}(p,x,g.layers[y]),pe=oe.map((t=>{var a,n,i;const s=Rf[t];return{operationType:t,compatibleWithCurrentField:Ep({layer:g.layers[y],columnId:b,op:t,indexPattern:x,field:ce||void 0,filterOperations:e.filterOperations,visualizationGroups:I,dateRange:O}),disabledStatus:s.getDisabledStatus&&s.getDisabledStatus(e.indexPatterns[g.currentIndexPatternId],g.layers[y],E),compatibleWithSampling:1===cb(g.layers[y])||null===(a=null===(n=s.getUnsupportedSettings)||void 0===n||null===(i=n.call(s))||void 0===i?void 0:i.sampling)||void 0===a||a}})),me=Object(s.useMemo)((()=>function(e,t,a){const n=e.columns[t];return!(!n||!Zd(n))&&ep(e,t,a).length>0}(g.layers[y],b,x)),[g.layers,y,b,x]),ge="none"===_||null!=(null==p?void 0:p.operationType)&&sh(null==p?void 0:p.operationType),fe=pe.map((({operationType:t,compatibleWithCurrentField:a,disabledStatus:n,compatibleWithSampling:i})=>{var s;const r=Boolean(ee===t||!ee&&p&&p.operationType===t),c=a&&(null==de||null===(s=de.partiallyApplicableFunctions)||void 0===s?void 0:s[t])&&Object(v.jsx)("span",{"data-test-subj":`${t}-partial-warning`}," ",Object(v.jsx)(f.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpPartiallyApplicableFunctionLabel",{defaultMessage:"This function may only return partial results, as it is unable to support the full time range of rolled-up historical data."}),position:"left",size:"s",type:"partial",color:"warning"}));let d=Object(v.jsx)(l.a.Fragment,null,oh[t].displayName,c);return r&&n?d=Object(v.jsx)(f.EuiToolTip,{content:n,display:"block",position:"left"},Object(v.jsx)(f.EuiText,{color:"danger",size:"s"},Object(v.jsx)("strong",null,d))):n?d=Object(v.jsx)(f.EuiToolTip,{content:n,display:"block",position:"left"},Object(v.jsx)("span",null,oh[t].displayName)):a?i||(d=Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1,style:{marginRight:U.size.xs}},d),ge&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.settingsSamplingUnsupported",{defaultMessage:"Selecting this function will change this layer's sampling to 100% in order to function properly."}),size:"s",type:"dot",color:"warning"})))):d=Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1,style:{marginRight:U.size.xs,minWidth:0}},Object(v.jsx)("span",{css:ch},d)),ge&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpIncompatibleFieldDotLabel",{defaultMessage:"This function is not compatible with the current selected field"}),position:"left",size:"s",type:"dot",color:"warning"}))),{id:t,label:d,isActive:r,size:"s",isDisabled:!!n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${a?"":" incompatible"}`,"aria-pressed":r,extraAction:Rf[t].helpComponent?{color:"primary",onClick:a=>{if(ue.current)o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current),ue.current=null;else{const n=document.createElement("div");ue.current=n,document.body.appendChild(n);const i=Rf[t].helpComponent,s=Object(v.jsx)(kf,{button:a.target,isOpen:!0,title:Rf[t].helpComponentTitle,closePopover:()=>{ue.current&&(o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current),ue.current=null)},startServices:e.core},Object(v.jsx)(i,null));o.a.render(s,ue.current)}},iconType:"documentation",iconSize:"s","aria-label":u.i18n.translate("xpack.lens.indexPattern.helpLabel",{defaultMessage:"Function help"})}:void 0,onClick(){if(["none","fullReference","managedReference"].includes(Rf[t].input)){if((null==p?void 0:p.operationType)===t)return void(J&&Z(Yp(g.layers[y],b)));const a=xp({layer:e.state.layers[e.layerId],indexPattern:x,columnId:b,op:t,visualizationGroups:I,targetGroup:e.groupId});return $&&sh(a.columns[b].operationType)&&L("none"),void Z(a)}if(!p||!a){var n;const a=null!==(n=S.get(t))&&void 0!==n?n:new Set;let i;return i=1===a.size?xp({layer:e.state.layers[e.layerId],indexPattern:x,columnId:b,op:t,field:x.getFieldByName(a.values().next().value),visualizationGroups:I,targetGroup:e.groupId}):xp({layer:e.state.layers[e.layerId],indexPattern:x,columnId:b,op:t,field:a.has(Wt.DOCUMENT_FIELD_NAME)?qd.a:void 0,visualizationGroups:I,targetGroup:e.groupId}),$&&sh(i.columns[b].operationType)&&L("none"),void Z(i)}if(p.operationType===t)return void(J&&Z(Yp(g.layers[y],b)));$&&L("none");const i=wp({layer:e.state.layers[e.layerId],indexPattern:x,columnId:b,op:t,field:Zd(p)?x.getFieldByName(p.sourceField):void 0,visualizationGroups:I});Z(i)}}})),be=!me&&!J&&p&&sh(p.operationType)&&re,he=!J&&p&&"references"in p&&"fullReference"===(null==P?void 0:P.input),ve=!p||"field"===(null==P?void 0:P.input)||ee&&"field"===(null===(a=Rf[ee])||void 0===a?void 0:a.input)||$,ye=(null==P?void 0:P.renderFieldInput)||mm,xe={layer:g.layers[y],layerId:y,activeData:e.activeData,paramEditorUpdater:e=>{$&&L("none"),Z(e,{forceRender:$})},columnId:b,currentColumn:g.layers[y].columns[b],dateRange:O,indexPattern:x,operationDefinitionMap:Rf,toggleFullscreen:M,isFullscreen:T,paramEditorCustomProps:C,ReferenceEditor:Hb,dataSectionExtra:e.dataSectionExtra,...F},je=Object(v.jsx)(f.EuiButtonIcon,{onClick:()=>R((e=>!e)),iconType:"documentation","aria-label":u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"})}),Oe=[{field:"function",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.functionHeader",{defaultMessage:"Function"}),width:"150px"},{field:"description",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.descriptionHeader",{defaultMessage:"Description"})}],Ie=fe.filter((e=>Rf[e.id].quickFunctionDocumentation)).map((e=>{const t=Rf[e.id];return{id:e.id,function:t.displayName,description:t.quickFunctionDocumentation}})),Me=Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{label:Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!1},u.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Functions"})),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiPopover,{anchorPosition:"rightUp",button:je,isOpen:D,display:"inlineBlock",panelPaddingSize:"none",closePopover:()=>R(!1),initialFocus:"#functionsHelpBasicTableId"},Object(v.jsx)(f.EuiPopoverTitle,{paddingSize:"s"},u.i18n.translate("xpack.lens.indexPattern.quickFunctions.popoverTitle",{defaultMessage:"Quick functions"})),Object(v.jsx)(f.EuiPanel,{className:"eui-yScroll",style:{maxHeight:"40vh"},color:"transparent",paddingSize:"s"},Object(v.jsx)(f.EuiBasicTable,{id:"functionsHelpBasicTableId",style:{width:350},tableCaption:u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"}),items:Ie,compressed:!0,rowHeader:"firstName",columns:Oe,responsiveBreakpoint:!1}))))),fullWidth:!0},Object(v.jsx)(f.EuiListGroup,{className:fe.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",color:"primary",listItems:fe.length%2==1?[...fe,{label:"Â "}]:fe,maxWidth:!1})),he?Object(v.jsx)(l.a.Fragment,null,p.references.map(((t,a)=>{var n;const s=P.requiredReferences[a],l=g.layers[y];return Object(v.jsx)(Hb,i()({operationDefinitionMap:Rf,key:a,layer:l,layerId:y,activeData:e.activeData,columnId:t,column:l.columns[t],incompleteColumn:l.incompleteColumns?l.incompleteColumns[t]:void 0,onResetIncomplete:()=>{W({...l,incompleteColumns:{...l.incompleteColumns,[t]:null}})},onDeleteColumn:()=>{W(Rp({layer:l,columnId:t,indexPattern:x}))},onChooseFunction:(e,a)=>{const n=xp({layer:l,columnId:t,op:e,indexPattern:x,field:a,visualizationGroups:I});K(n),W(n)},onChooseField:e=>{W(xp({layer:l,columnId:t,indexPattern:x,op:e.operationType,field:x.getFieldByName(e.field),visualizationGroups:I}))},paramEditorUpdater:e=>{let a;return a="function"==typeof e?e(l):sp(e)?{...l,columns:{...l.columns,[t]:e}}:e,K(a),W(Dp(a,t))},validation:s,currentIndexPattern:x,selectionStyle:P.selectionStyle,dateRange:O,labelAppend:null==P||null===(n=P.getHelpMessage)||void 0===n?void 0:n.call(P,{data:e.data,uiSettings:e.uiSettings,currentColumn:l.columns[b]}),isFullscreen:T,toggleFullscreen:M,paramEditorCustomProps:C},F))})),"field"!==P.selectionStyle?Object(v.jsx)(f.EuiSpacer,{size:"s"}):null):null,ve?Object(v.jsx)(ye,{layer:g.layers[y],selectedColumn:p,columnId:b,indexPattern:x,operationSupportMatrix:m,updateLayer:e=>{$&&L("none"),Z(e,{forceRender:$})},incompleteField:te,incompleteOperation:ee,incompleteParams:ae,currentFieldIsInvalid:me,helpMessage:null==P||null===(n=P.getHelpMessage)||void 0===n?void 0:n.call(P,{data:e.data,uiSettings:e.uiSettings,currentColumn:g.layers[y].columns[b]}),dimensionGroups:I,groupId:e.groupId,operationDefinitionMap:Rf}):null,!T&&!J&&!j&&"none"===_&&Object(v.jsx)(Tb,{layer:g.layers[e.layerId],columnId:e.columnId,setColumns:e=>W({columnOrder:e}),getFieldByName:x.getFieldByName}),be&&Object(v.jsx)(re,xe),!(null!=P&&P.handleDataSectionExtra)&&Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"m"}),e.dataSectionExtra)),Te=re?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(re,i()({layer:g.layers[y],activeData:e.activeData,paramEditorUpdater:H?e=>{if(H&&L("none"),"function"==typeof e)return h((t=>{const a=e(le(t.layers[y]));return sb({state:t,layerId:y,newLayer:a})}),{isDimensionComplete:!0,forceRender:!0});if(sp(e))throw new Error("static value should only be updated by the whole layer")}:Z,columnId:b,currentColumn:g.layers[y].columns[b],operationDefinitionMap:Rf,layerId:y,paramEditorCustomProps:C,dateRange:O,isFullscreen:T,indexPattern:x,toggleFullscreen:M,ReferenceEditor:Hb},F))):null,we=ie?Me:Te,ke=Object(s.useCallback)((e=>{W(_p({layer:g.layers[y],columnId:b,paramName:"format",value:e}))}),[b,y,g.layers,W]),Ee=!T&&m.operationWithoutField.has(th),Ce=!T&&(Ee||w),Fe=Object(s.useMemo)((()=>{let e="";return se?e=ah:ie?e=nh:"none"===_&&(null==p?void 0:p.operationType)===th&&(e=th),e}),[null==p?void 0:p.operationType,ie,se,_]),[Se,Ae]=Object(s.useState)(Fe),Pe=[{id:ah,enabled:Boolean(w),state:se,onClick:()=>{if((null==p?void 0:p.operationType)===th)return L(ah);L("none"),Z(le())},label:u.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})},{id:nh,enabled:!0,state:ie,onClick:()=>{!p||sh(p.operationType)||L(nh)},label:u.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick function"})},{id:th,enabled:Ee,state:"none"===_&&(null==p?void 0:p.operationType)===th,onClick:()=>{if(L("none"),(null==p?void 0:p.operationType)!==th){const t=xp({layer:e.state.layers[e.layerId],indexPattern:x,columnId:b,op:th,visualizationGroups:I});Z(t)}},label:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})}],_e=Object(s.useMemo)((()=>String(p&&Rf[p.operationType].getDefaultLabel(p,g.layers[y].columns,e.indexPatterns[g.layers[y].indexPatternId]))),[y,p,e.indexPatterns,g.layers]),Le=Object(s.useCallback)((e=>{p&&Z(p.operationType===th?xp({op:p.operationType,layer:e,columnId:b,indexPattern:x,visualizationGroups:I}):e)}),[b,x,I,p,Z]),De=!T&&!me&&!J&&p&&"none"===_&&P&&(P.timeScalingMode||P.filterable||P.shiftable);return Object(v.jsx)("div",{id:b},Object(v.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded"},Object(v.jsx)(f.EuiText,{size:"s",css:Object(v.css)("margin-bottom:",U.size.base,";","")},Object(v.jsx)("h4",null,null!==(r=null==C?void 0:C.headingLabel)&&void 0!==r?r:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingData",{defaultMessage:"Data"}))),Object(v.jsx)(l.a.Fragment,null,Ce?Object(v.jsx)(rh,{options:Pe,onMethodChange:e=>{Ae(e)},selectedMethod:Se}):null,Object(v.jsx)(lh,{currentOperationType:null==p?void 0:p.operationType,temporaryStateType:_}),we)),De&&Object(v.jsx)(Zb,{options:[{dataTestSubj:"indexPattern-time-scaling-enable",inlineElement:P.timeScalingMode?Object(v.jsx)(Ub,{selectedColumn:p,columnId:b,layer:g.layers[y],updateLayer:Le}):null},{dataTestSubj:"indexPattern-filter-by-enable",inlineElement:P.filterable?Object(v.jsx)(Xb,{indexPattern:x,selectedColumn:p,columnId:b,layer:g.layers[y],updateLayer:Le,helpMessage:uh(P.filterable)}):null},{dataTestSubj:"indexPattern-reducedTimeRange-enable",inlineElement:P.canReduceTimeRange?Object(v.jsx)(Kb,{selectedColumn:p,columnId:b,indexPattern:x,layer:g.layers[y],updateLayer:Le,skipLabelUpdate:Ee,helpMessage:uh(P.canReduceTimeRange)}):null},{dataTestSubj:"indexPattern-time-shift-enable",inlineElement:Boolean(P.shiftable&&(x.timeFieldName||Object.values(g.layers[y].columns).some((e=>"date_histogram"===e.operationType))))?Object(v.jsx)(eh,{datatableUtilities:F.data.datatableUtilities,indexPattern:x,selectedColumn:p,columnId:b,layer:g.layers[y],updateLayer:Le,activeData:e.activeData,layerId:y}):null},...(null===(c=(d=Rf[p.operationType]).getAdvancedOptions)||void 0===c?void 0:c.call(d,xe))||[]]}),!T&&!me&&Object(v.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},!J&&"none"===_&&p&&Object(v.jsx)(f.EuiText,{size:"s",css:Object(v.css)("margin-bottom:",U.size.base,";","")},Object(v.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingAppearance",{defaultMessage:"Appearance"}))),Object(v.jsx)(l.a.Fragment,null,!J&&p&&"none"===_&&Object(v.jsx)(Ob.a,{value:p.label,defaultValue:_e,onChange:t=>{W({columns:{...g.layers[y].columns,[b]:{...p,label:t,customLabel:Rf[p.operationType].getDefaultLabel(p,g.layers[y].columns,e.indexPatterns[g.layers[y].indexPatternId])!==t}}})}}),!k||T||!p||"number"!==p.dataType&&"range"!==p.operationType?null:Object(v.jsx)(qb,{selectedColumn:p,onChange:ke,docLinks:e.core.docLinks}))))}const ph=k()((function(e,t){return e.reduce(((e,{operationMetaData:a,operations:n})=>t(a)?[...e,...n]:e),[]).reduce(((e,t)=>{if("field"===t.type){var a,n;const i=null!==(a=e.operationByField.get(t.field))&&void 0!==a?a:new Set;i.add(t.operationType),e.operationByField.set(t.field,i);const s=null!==(n=e.fieldByOperation.get(t.operationType))&&void 0!==n?n:new Set;s.add(t.field),e.fieldByOperation.set(t.operationType,s)}else e.operationWithoutField.add(t.operationType);return e}),{operationByField:new Map,operationWithoutField:new Set,fieldByOperation:new Map})})),mh=function(e){var t;const a=e.layerId,n=e.indexPatterns[null===(t=e.state.layers[a])||void 0===t?void 0:t.indexPatternId];if(!n)return null;const s=(e=>{const t=e.layerId,a=e.indexPatterns[e.state.layers[t].indexPatternId],n=Hf(a);return ph(n,e.filterOperations)})(e),l=e.state.layers[a].columns[e.columnId]||null;return Object(v.jsx)(dh,i()({},e,{layerType:e.layerType||ue.LayerTypes.DATA,currentIndexPattern:n,selectedColumn:l,operationSupportMatrix:s}))},gh=Object(s.memo)(mh);var fh=a(97);const bh=Nf();function hh(e,t,a,n,i){if(!e)return;const s=$f(e,t,i);return s.length?a&&s.includes(a.operationType)?a.operationType:n&&s.includes(n)?n:s[0]:void 0}function vh(e,t){if(e)return Zd(e)&&t.getFieldByName(e.sourceField)||void 0}function yh(e){const{state:t,source:a,target:n,indexPatterns:i}=e;if(!a)return;const s={...n,column:t.layers[n.layerId].columns[n.columnId],dataView:i[t.layers[n.layerId].indexPatternId]};if(Object(Ct.isDraggedDataViewField)(a))return function({state:e,source:t,target:a,indexPatterns:n}){const i=e.layers[a.layerId].columns[a.columnId],s=e.layers[a.layerId].indexPatternId===t.indexPatternId,l=hh(t.field,a.filterOperations,i);if(s&&l){const s=bh[l].displayName;if(!i)return{dropTypes:["field_add"],nextLabel:s};if(Zd(i)&&i.sourceField!==t.field.name||!Zd(i)){const l=n[e.layers[a.layerId].indexPatternId];return Zd(i)&&l&&qf(l,i,void 0,t.field)?{dropTypes:["field_replace","field_combine"]}:{dropTypes:["field_replace"],nextLabel:s}}}}({...e,source:a,target:s});if(Object(fh.f)(a)){var l,r;const e={...a,column:null===(l=t.layers[a.layerId])||void 0===l?void 0:l.columns[a.columnId],dataView:i[null===(r=t.layers[a.layerId])||void 0===r?void 0:r.indexPatternId]};if(!e.column)return;var o;if(n.columnId!==a.columnId&&s.dataView===e.dataView)return Object(Ct.isOperationFromTheSameGroup)(a,n)?s.column?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]}:null!==(o=s.filterOperations)&&void 0!==o&&o.call(s,null==e?void 0:e.column)?function(e,t){var a;if(!t.column)return{dropTypes:["move_compatible","duplicate_compatible"]};const n=["replace_compatible","replace_duplicate_compatible",...(null===(a=e.filterOperations)||void 0===a?void 0:a.call(e,t.column))?["swap_compatible"]:[]];return t.dataView&&Zd(t.column)?(qf(t.dataView,t.column,e.column)&&n.push("combine_compatible"),{dropTypes:n}):{dropTypes:n}}(e,s):function(e,t){const a=t?Vf(t):[],n=new Set(Vf(e));return a.length===n.size&&a.every((e=>n.has(e)))}(e.column,s.column)?void 0:function(e,t){if(!t.dataView||!e.column)return;const a=hh(vh(e.column,e.dataView),t.filterOperations,t.column);if(a){const n=vh(t.column,t.dataView),i=Boolean(hh(n,e.filterOperations,e.column)),s=[];return t.column?(s.push("replace_incompatible","replace_duplicate_incompatible"),i&&s.push("swap_incompatible"),qf(t.dataView,t.column,e.column)&&s.push("combine_incompatible")):s.push("move_incompatible","duplicate_incompatible"),{dropTypes:s,nextLabel:bh[a].displayName}}}(e,s)}}function xh(e){const{target:t,source:a,dropType:n,state:i,indexPatterns:s}=e;if(Object(Ct.isDraggedDataViewField)(a)&&jh(n))return function(e,t){var a,n;const{state:i,source:s,target:l,targetLayerDimensionGroups:r,indexPatterns:o}=e,u=null===(a=r.find((e=>e.groupId===l.groupId)))||void 0===a?void 0:a.prioritizedOperation,c=i.layers[l.layerId],d=o[c.indexPatternId],p=c.columns[l.columnId],m=new Set(Object.values(c.columns).filter((e=>"sourceField"in e&&e.sourceField===s.field.name)).map((e=>e.operationType))),g=t?p.operationType:hh(s.field,l.filterOperations,p,u,m);if(!Object(Ct.isDraggedDataViewField)(s)||!g||t&&!qf(d,p,void 0,s.field))return;const f=t?vh(p,d):s.field,b=t?{params:(null===(n=Gf(p.operationType))||void 0===n?void 0:n({targetColumn:p,field:s.field,indexPattern:d}))||{}}:void 0,h=xp({layer:c,columnId:l.columnId,indexPattern:d,op:g,field:f,visualizationGroups:r,targetGroup:l.groupId,shouldCombineField:t,initialParams:b});return sb({state:i,layerId:l.layerId,newLayer:h})}({...e,target:{...t,dataView:s[i.layers[t.layerId].indexPatternId]},source:a,indexPatterns:s},"field_combine"===n);if(!Object(fh.f)(a))return;const l=s[i.layers[a.layerId].indexPatternId],r=s[i.layers[t.layerId].indexPatternId];if(l!==r)return;const o={...e,target:{...t,dataView:r},source:{...a,dataView:l},indexPatterns:s};return"reorder"===n?function({state:e,source:t,target:a}){return sb({state:e,layerId:a.layerId,newLayer:{columnOrder:Object(Ct.reorderElements)(e.layers[a.layerId].columnOrder,a.columnId,t.columnId)}})}(o):["duplicate_compatible","replace_duplicate_compatible","move_compatible","replace_compatible"].includes(n)?function({state:e,source:t,target:a,targetLayerDimensionGroups:n,indexPatterns:i},s){let l=yp({layers:e.layers,target:a,source:t});const r=Sp(n,Np(l[a.layerId]),a.groupId,a.columnId);l={...l,[a.layerId]:{...l[a.layerId],columnOrder:r,columns:l[a.layerId].columns}};const o=lb({state:e,newLayers:l});return s?ny({layerId:t.layerId,columnId:t.columnId,prevState:o,indexPatterns:i}):o}(o,Object(Ct.shouldRemoveSource)(a,n)):["duplicate_incompatible","replace_duplicate_incompatible","move_incompatible","replace_incompatible"].includes(n)?function({state:e,source:t,targetLayerDimensionGroups:a,target:n,indexPatterns:i},s){const l=e.layers[n.layerId],r=l.columns[n.columnId]||null,o=e.layers[t.layerId],u=i[o.indexPatternId],c=vh(o.columns[t.columnId],u),d=hh(c,n.filterOperations,r);if(!d)return;let p;if(n.layerId===t.layerId){const t=xp({layer:o,columnId:n.columnId,indexPattern:u,op:d,field:c,visualizationGroups:a,targetGroup:n.groupId,shouldResetLabel:!0});p=sb({state:e,layerId:n.layerId,newLayer:t})}else{const i=xp({layer:l,columnId:n.columnId,indexPattern:u,op:d,field:c,visualizationGroups:a,targetGroup:n.groupId,shouldResetLabel:!0});p=lb({state:e,newLayers:{[t.layerId]:o,[n.layerId]:i}})}return s?ny({layerId:t.layerId,columnId:t.columnId,prevState:p,indexPatterns:i}):p}(o,Object(Ct.shouldRemoveSource)(a,n)):"swap_compatible"===n?function({state:e,source:t,targetLayerDimensionGroups:a,target:n}){if(n.layerId===t.layerId){const i=e.layers[n.layerId],s={...i.columns,[n.columnId]:{...i.columns[t.columnId]},[t.columnId]:{...i.columns[n.columnId]}};let l=Oh(i.columnOrder,t.columnId,n.columnId);return l=Sp(a,l,n.groupId,n.columnId),sb({state:e,layerId:n.layerId,newLayer:{columnOrder:l,columns:s}})}{const a=yp({layers:e.layers,target:n,source:t,shouldDeleteSource:!0})[n.layerId],i=yp({layers:e.layers,target:t,source:n,shouldDeleteSource:!0})[t.layerId];return lb({state:e,newLayers:{[t.layerId]:i,[n.layerId]:a}})}}(o):"swap_incompatible"===n?function({state:e,source:t,targetLayerDimensionGroups:a,target:n,indexPatterns:i}){const s=e.layers[n.layerId],l=e.layers[t.layerId],r=i[s.indexPatternId],o=l.columns[t.columnId],u=s.columns[n.columnId],c=vh(o,r),d=vh(u,r),p=hh(c,n.filterOperations,u),m=hh(d,t.filterOperations,o);if(!p||!m)return;const g=xp({layer:s,columnId:n.columnId,targetGroup:n.groupId,indexPattern:r,op:p,field:c,visualizationGroups:a,shouldResetLabel:!0});if(t.layerId===n.layerId){const i=xp({layer:g,columnId:t.columnId,indexPattern:r,op:m,field:d,visualizationGroups:a,targetGroup:t.groupId,shouldResetLabel:!0});return sb({state:e,layerId:n.layerId,newLayer:i})}{const i=xp({layer:l,columnId:t.columnId,indexPattern:r,op:m,field:d,visualizationGroups:a,targetGroup:t.groupId,shouldResetLabel:!0});return lb({state:e,newLayers:{[t.layerId]:i,[n.layerId]:g}})}}(o):["combine_incompatible","combine_compatible"].includes(n)?function({state:e,source:t,target:a,targetLayerDimensionGroups:n,indexPatterns:i},s){var l,r;const o=e.layers[a.layerId],u=o.columns[a.columnId],c=vh(u,a.dataView),d=i[o.indexPatternId],p=e.layers[t.layerId].columns[t.columnId];if(!vh(p,d)||!c)return;const m={params:null!==(l=null===(r=Gf(u.operationType))||void 0===r?void 0:r({targetColumn:u,sourceColumn:p,indexPattern:d}))&&void 0!==l?l:{}},g=wp({layer:o,columnId:a.columnId,indexPattern:d,op:u.operationType,field:c,visualizationGroups:n,targetGroup:a.groupId,initialParams:m,shouldCombineField:!0}),f=lb({state:e,newLayers:{...e.layers,[a.layerId]:g}});return s?ny({layerId:t.layerId,columnId:t.columnId,prevState:f,indexPatterns:i}):f}(o,Object(Ct.shouldRemoveSource)(a,n)):void 0}const jh=e=>["field_add","field_replace","field_combine"].includes(e),Oh=(e,t,a)=>{const n=e.findIndex((e=>e===t)),i=e.findIndex((e=>e===a)),s=[...e];return s[n]=a,s[i]=t,s};a(498);var Ih=a(7),Mh=a(168),Th=a(663);const wh=Object(f.htmlIdGenerator)("fieldList");function kh({dataViewId:e,allFields:t,services:a,isAffectedByGlobalFilter:n=!1,popularFieldsLimit:i,sortedSelectedFields:l,getCustomFieldType:r,onOverrideFieldGroupDetails:o,onSupportedFieldFilter:c,onSelectedFieldFilter:d,getNewFieldsBySpec:p,additionalFieldGroups:m}){const g=Object(am.b)(),f=function({allFields:e,getCustomFieldType:t,onSupportedFieldFilter:a,services:n}){const[i,l]=Object(s.useState)([]),[r,o]=Object(s.useState)(""),u=Object(s.useMemo)((()=>wh()),[]),c=n.core.docLinks;return Object(s.useMemo)((()=>{const n=r.trim().toLowerCase();return{fieldSearchHighlight:n,fieldListFiltersProps:{docLinks:c,selectedFieldTypes:i,allFields:e,getCustomFieldType:t,onSupportedFieldFilter:a,onChangeFieldTypes:l,nameFilter:r,onChangeNameFilter:o,screenReaderDescriptionId:u},onFilterField:null!=n&&n.length||i.length>0?e=>!(n&&!Object(Th.b)(e,n))&&(!(i.length>0)||i.includes(Object(im.a)(e,t))):void 0}}),[c,i,e,t,a,l,r,o,u])}({allFields:t,services:a,getCustomFieldType:r,onSupportedFieldFilter:c}),b=f.onFilterField,[h,v]=Object(s.useState)(null),y=Boolean(null==h?void 0:h.timeFieldName),x=!e||g.isFieldsExistenceInfoUnavailable(e),j=e?g.hasFieldData:Fh;Object(s.useEffect)((()=>{(async()=>{if(e){let t=null;try{t=await a.dataViews.get(e,!1)}catch(e){}v(t||null)}else v(null)})()}),[e,a.dataViews,v,j]);const{allFieldsModified:O,hasNewFields:I}=function({dataView:e,allFields:t,getNewFieldsBySpec:a,fieldsExistenceReader:n}){const i=null==e?void 0:e.id,l=Object(s.useMemo)((()=>{const i=t&&null!=e&&e.id&&a?a(n.getNewFields(null==e?void 0:e.id),e):null;return null!=i&&i.length?i:null}),[t,e,n,a]),r=Boolean(t&&l&&l.length>0);return{allFieldsModified:Object(s.useMemo)((()=>t&&null!=l&&l.length&&i?[...t.filter((e=>!l.some((t=>t.name===e.name)))),...l]:t),[l,t,i]),hasNewFields:r}}({dataView:h,allFields:t,getNewFieldsBySpec:p,fieldsExistenceReader:g});Object(s.useEffect)((()=>{h&&!e&&v(null)}),[h,v,e]);const M=Object(s.useMemo)((()=>Date.now()),[e,b]),T=Object(s.useMemo)((()=>{const t=l||[],a=[...O||[]].sort(Ch),s={specialFields:[],availableFields:[],emptyFields:[],metaFields:[],unmappedFields:[],skippedFields:[],...Object(pa.groupBy)(a,(a=>{var n;return!l&&d&&d(a)&&t.push(a),c&&!c(a)?"skippedFields":"document"===a.type?"specialFields":null!=h&&null!==(n=h.metaFields)&&void 0!==n&&n.includes(a.name)?"metaFields":"nested"===a.type?"availableFields":null!=a&&a.isNull?"emptyFields":null!=h&&h.getFieldByName&&!h.getFieldByName(a.name)?"unmappedFields":(t=>!e||j(e,t.name))(a)||x?"availableFields":"emptyFields"}))},r=i?a.filter((e=>e.count&&"_source"!==e.type&&(!c||c(e)))).sort(((e,t)=>(t.count||0)-(e.count||0))).slice(0,i):[],p=(null==m?void 0:m.smartFields)||[];let g={SpecialFields:{fields:s.specialFields,fieldCount:s.specialFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!1,title:"",hideDetails:!0},SelectedFields:{fields:t,fieldCount:t.length,isInitiallyOpen:!0,showInAccordion:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.selectedFieldsLabel",{defaultMessage:"Selected fields"}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:y,hideDetails:!1,hideIfEmpty:!0},PopularFields:{fields:r,fieldCount:r.length,isInitiallyOpen:!0,showInAccordion:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.popularFieldsLabel",{defaultMessage:"Popular fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.popularFieldsLabelHelp",{defaultMessage:"Fields that your organization frequently uses, from most to least popular."}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:y,hideDetails:!1,hideIfEmpty:!0},AvailableFields:{fields:s.availableFields,fieldCount:s.availableFields.length,isInitiallyOpen:!0,showInAccordion:!0,title:e&&x?u.i18n.translate("unifiedFieldList.useGroupedFields.allFieldsLabel",{defaultMessage:"All fields"}):u.i18n.translate("unifiedFieldList.useGroupedFields.availableFieldsLabel",{defaultMessage:"Available fields"}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:y,hideDetails:x,defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noAvailableDataLabel",{defaultMessage:"There are no available fields that contain data."})},UnmappedFields:{fields:s.unmappedFields,fieldCount:s.unmappedFields.length,isAffectedByGlobalFilter:n,isAffectedByTimeFilter:y,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.unmappedFieldsLabel",{defaultMessage:"Unmapped fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.unmappedFieldsLabelHelp",{defaultMessage:"Fields that aren't explicitly mapped to a field data type."})},EmptyFields:{fields:s.emptyFields,fieldCount:s.emptyFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.emptyFieldsLabel",{defaultMessage:"Empty fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.emptyFieldsLabelHelp",{defaultMessage:"Fields that don't have any values based on your filters."}),defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noEmptyDataLabel",{defaultMessage:"There are no empty fields."})},MetaFields:{fields:s.metaFields,fieldCount:s.metaFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!e,title:u.i18n.translate("unifiedFieldList.useGroupedFields.metaFieldsLabel",{defaultMessage:"Meta fields"}),defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noMetaDataLabel",{defaultMessage:"There are no meta fields."})},SmartFields:{fields:p,fieldCount:p.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!0,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.smartFieldsLabel",{defaultMessage:"Smart fields"})}};const f=e&&x,b=!e&&!s.emptyFields.length;return(f||b)&&delete g.EmptyFields,o&&(g=Object.keys(g).reduce(((e,t)=>{const a=t,n=g[a];return n&&(e[a]={...n,...o(a)||{}}),e}),{})),g}),[O,c,d,o,h,e,j,x,n,y,i,l,m]),w=Object(s.useMemo)((()=>b?Object.fromEntries(Object.entries(T).map((([e,t])=>[e,{...t,fieldSearchHighlight:f.fieldSearchHighlight,fields:t.fields.filter(b)}]))):T),[T,b,f.fieldSearchHighlight]),k=Boolean(t),E=null==t?void 0:t.length,C=Object(s.useMemo)((()=>!e||Boolean(E)),[e,E]),F=Object(s.useMemo)((()=>k?e&&g?g.getFieldsExistenceStatus(e):Mh.a.succeeded:Mh.a.unknown),[e,k,g]),S=f.fieldListFiltersProps.screenReaderDescriptionId;return{fieldListGroupedProps:Object(s.useMemo)((()=>({fieldGroups:w,scrollToTopResetCounter:M,fieldsExistInIndex:C,fieldsExistenceStatus:F,screenReaderDescriptionId:S})),[w,M,C,F,S]),fieldListFiltersProps:f.fieldListFiltersProps,allFieldsModified:O,hasNewFields:I}}const Eh=new Intl.Collator(void 0,{sensitivity:"base"});function Ch(e,t){return Eh.compare(e.displayName||e.name,t.displayName||t.name)}function Fh(){return!0}const Sh={name:"zxsb69",styles:"position:relative;width:100%;height:100%"},Ah=({"data-test-subj":e="fieldList",isProcessing:t,prepend:a,append:n,className:i,children:s})=>Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none",direction:"column",responsive:!1,"data-test-subj":e,css:Sh,className:i},t&&Object(v.jsx)(f.EuiProgress,{size:"xs",color:"accent",position:"absolute","data-test-subj":`${e}Loading`}),!!a&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},a),Object(v.jsx)(f.EuiFlexItem,{className:"unifiedFieldListSidebar__accordionContainer",grow:!0},s),!!n&&Object(v.jsx)(f.EuiFlexItem,{grow:!1},n)),Ph=()=>Object(v.jsx)(s.Fragment,null),_h=l.a.lazy((()=>a.e(16).then(a.bind(null,687)))),Lh=function(e){return Object(v.jsx)(l.a.Suspense,{fallback:Object(v.jsx)(Ph,null)},Object(v.jsx)(_h,e))},Dh=()=>Object(v.jsx)(s.Fragment,null),Rh=l.a.lazy((()=>a.e(9).then(a.bind(null,688)))),Nh=function(e){return Object(v.jsx)(l.a.Suspense,{fallback:Object(v.jsx)(Dh,null)},Object(v.jsx)(Rh,e))};var Bh=a(523),zh=a.n(Bh),Vh=a(656),Gh=(a(503),a(57));a(508);const qh=({isOpen:e,closePopover:t,renderHeader:a,renderContent:n,...s})=>{let r=null,o=null;if(e){try{r=(null==a?void 0:a())||null}catch(e){console.error(e)}try{o=(null==n?void 0:n())||null}catch(e){console.error(e)}}return Object(v.jsx)(f.EuiPopover,i()({ownFocus:!0,isOpen:e,closePopover:t,display:"block",anchorPosition:"rightUp","data-test-subj":"fieldPopover",panelClassName:"unifiedFieldList__fieldPopover__fieldPopoverPanel"},s),e&&Object(v.jsx)(l.a.Fragment,null,o&&r?Object(v.jsx)(f.EuiPopoverTitle,null,r):r,o))};a(518);const $h={xs:"kbnFieldButton--xs",s:"kbnFieldButton--s"};function Hh({size:e,isActive:t=!1,fieldIcon:a,fieldName:n,fieldInfoIcon:s,fieldAction:r,flush:o,className:u,dragHandle:c,onClick:d,dataTestSubj:p,buttonProps:m,...g}){const f=O()("kbnFieldButton",e?$h[e]:null,{"kbnFieldButton-isActive":t,"kbnFieldButton--flushBoth":"both"===o},u),b=O()("kbn-resetFocusState","kbnFieldButton__button"),h=Object(v.jsx)(l.a.Fragment,null,a&&Object(v.jsx)("span",{className:"kbnFieldButton__fieldIcon"},a),n&&Object(v.jsx)("span",{className:"kbnFieldButton__name eui-textBreakAll"},Object(v.jsx)("span",{className:"kbnFieldButton__nameInner"},n)),s&&Object(v.jsx)("div",{className:"kbnFieldButton__infoIcon"},s));return Object(v.jsx)("div",i()({className:f},g),c&&Object(v.jsx)("div",{className:"kbnFieldButton__dragHandle"},c),d?Object(v.jsx)("button",i()({onClick:e=>{"click"===e.type&&e.currentTarget.focus(),d()},"data-test-subj":p,className:b},m),h):Object(v.jsx)("div",{className:b,"data-test-subj":p},h),r&&Object(v.jsx)("div",{className:"kbnFieldButton__fieldAction"},r))}Object.keys($h);var Uh=a(217),Wh=a(454);a(513);const Xh=Object(v.jsx)(f.EuiIcon,{type:"grabOmnidirectional",size:"m"});function Yh({field:e,fieldSearchHighlight:t,isSelected:a,isActive:n,isEmpty:s,infoIcon:l,className:r,getCustomFieldType:o,dataTestSubj:c,size:d,withDragIcon:p,onClick:m,shouldAlwaysShowAction:g,buttonAddFieldToWorkspaceProps:b,buttonRemoveFieldFromWorkspaceProps:h,onAddFieldToWorkspace:y,onRemoveFieldFromWorkspace:x,...j}){var I,M;const T=e.displayName||e.name,w=T!==e.name&&"___records___"!==e.name?u.i18n.translate("unifiedFieldList.fieldItemButton.fieldTitle",{defaultMessage:"{fieldDisplayName} ({fieldName})",values:{fieldName:e.name,fieldDisplayName:T}}):T,k=o?{type:o(e)}:Object(Uh.a)(e),E=k.type,C=O()("unifiedFieldListItemButton",{[`unifiedFieldListItemButton--${E}`]:E,"unifiedFieldListItemButton--exists":!s,"unifiedFieldListItemButton--missing":s,"unifiedFieldListItemButton--withDragIcon":Boolean(p)},r),F=null!==(I=null==b?void 0:b["aria-label"])&&void 0!==I?I:u.i18n.translate("unifiedFieldList.fieldItemButton.addFieldToWorkspaceLabel",{defaultMessage:'Add "{field}" field',values:{field:e.displayName}}),S=null!==(M=null==h?void 0:h["aria-label"])&&void 0!==M?M:u.i18n.translate("unifiedFieldList.fieldItemButton.removeFieldToWorkspaceLabel",{defaultMessage:'Remove "{field}" field',values:{field:e.displayName}}),A=O()("unifiedFieldListItemButton__action",{"unifiedFieldListItemButton__action--always":g}),P=a?x&&Object(v.jsx)(f.EuiToolTip,{key:`selected-to-remove-${e.name}-${S}`,content:S},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldToggle-${e.name}`,"aria-label":S},h||{},{className:O()(A,null==h?void 0:h.className),color:"danger",iconType:"cross",onClick:t=>{t.preventDefault(),t.stopPropagation(),x(e)}}))):y&&Object(v.jsx)(f.EuiToolTip,{key:`deselected-to-add-${e.name}-${F}`,content:F},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldToggle-${e.name}`,"aria-label":F},b||{},{className:O()(A,null==b?void 0:b.className),color:"text",iconType:"plusInCircle",onClick:t=>{t.preventDefault(),t.stopPropagation(),y(e)}}))),_="conflict"===e.type?Object(v.jsx)(Qh,{conflictDescriptions:e.conflictDescriptions}):null;return Object(v.jsx)(Hh,i()({key:`field-item-button-${e.name}`,dataTestSubj:c||`field-${e.name}-showDetails`,size:d||"s",className:C,isActive:n,buttonProps:{"aria-label":u.i18n.translate("unifiedFieldList.fieldItemButton.ariaLabel",{defaultMessage:"Preview {fieldDisplayName}: {fieldType}",values:{fieldDisplayName:T,fieldType:o?o(e):e.type}})},fieldIcon:Object(v.jsx)("div",{className:"unifiedFieldListItemButton__fieldIconContainer"},Object(v.jsx)("div",{className:"unifiedFieldListItemButton__fieldIcon"},Object(v.jsx)(Wh.a,k)),p&&Object(v.jsx)("div",{className:"unifiedFieldListItemButton__fieldIconDrag"},Xh)),fieldName:Object(v.jsx)(f.EuiHighlight,{search:Object(Th.c)(T,t),title:w,"data-test-subj":`field-${e.name}`},T),fieldAction:P,fieldInfoIcon:_||l,onClick:m},j))}function Qh({conflictDescriptions:e}){const t=e?Object.keys(e):[];return Object(v.jsx)(f.EuiToolTip,{position:"bottom",title:u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictTitle",{defaultMessage:"Mapping Conflict"}),content:t.length?u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictWithTypesDescription",{defaultMessage:"This field is defined as several types ({types}) across the indices that match this pattern. You may still be able to use this conflicting field, but it will be unavailable for functions that require Kibana to know their type. Correcting this issue will require reindexing your data.",values:{types:t.join(", ")}}):u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictDescription",{defaultMessage:"This field is defined as several types (string, integer, etc) across the indices that match this pattern.You may still be able to use this conflicting field, but it will be unavailable for functions that require Kibana to know their type. Correcting this issue will require reindexing your data."})},Object(v.jsx)(f.EuiIcon,{tabIndex:0,type:"warning",size:"s"}))}const Kh=({field:e,color:t,truncate:a=!0})=>{const{euiTheme:n}=Object(f.useEuiTheme)(),i=((null==e?void 0:e.customDescription)||"").trim(),r=Boolean(a&&i.length>110),[o,c]=Object(s.useState)(r);return i?Object(v.jsx)("div",{"data-test-subj":`fieldDescription-${e.name}`},o?Object(v.jsx)(f.EuiText,{color:t,size:"xs",className:"eui-textBreakWord eui-textLeft"},Object(v.jsx)("button",{"data-test-subj":`toggleFieldDescription-${e.name}`,title:u.i18n.translate("fieldUtils.fieldDescription.viewMoreButton",{defaultMessage:"View full field description"}),className:"eui-textBreakWord eui-textLeft",onClick:()=>c(!1),css:Object(v.css)("padding:0;margin:0;color:","subdued"===t?n.colors.subduedText:n.colors.text,";line-height:inherit;font-size:inherit;&:hover,&:active,&:focus{color:",n.colors.link,";}","")},Object(v.jsx)(f.EuiTextBlockTruncate,{lines:2},i))):Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiText,{color:t,size:"xs",className:"eui-textBreakWord eui-textLeft"},i),r&&Object(v.jsx)(f.EuiButtonEmpty,{size:"xs",flush:"both","data-test-subj":`toggleFieldDescription-${e.name}`,onClick:()=>c(!0)},u.i18n.translate("fieldUtils.fieldDescription.viewLessButton",{defaultMessage:"View less"})))):null},Zh=({field:e,closePopover:t,buttonAddFieldToWorkspaceProps:a,buttonAddFilterProps:n,buttonEditFieldProps:s,buttonDeleteFieldProps:r,onAddFieldToWorkspace:o,onAddFilter:c,onEditField:d,onDeleteField:p})=>{var m,g,b,h;if(!e)return null;const y=u.i18n.translate("unifiedFieldList.fieldPopover.addFieldToWorkspaceLabel",{defaultMessage:'Add "{field}" field',values:{field:e.displayName}}),x=u.i18n.translate("unifiedFieldList.fieldPopover.addExistsFilterLabel",{defaultMessage:"Filter for field present"}),j=u.i18n.translate("unifiedFieldList.fieldPopover.editFieldLabel",{defaultMessage:"Edit data view field"}),O=u.i18n.translate("unifiedFieldList.fieldPopover.deleteFieldLabel",{defaultMessage:"Delete data view field"});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:!0},Object(v.jsx)(f.EuiTitle,{size:"xxs","data-test-subj":"fieldPopoverHeader_fieldDisplayName"},Object(v.jsx)("h5",{className:"eui-textBreakWord"},e.displayName))),o&&Object(v.jsx)(f.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addField"},Object(v.jsx)(f.EuiToolTip,{content:null!==(m=null==a?void 0:a["aria-label"])&&void 0!==m?m:y},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_addField-${e.name}`,"aria-label":y},a||{},{iconType:"plusInCircle",onClick:()=>{t(),o(e)}})))),c&&e.filterable&&!e.scripted&&Object(v.jsx)(f.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addExistsFilter"},Object(v.jsx)(f.EuiToolTip,{content:null!==(g=null==n?void 0:n["aria-label"])&&void 0!==g?g:x},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_addExistsFilter-${e.name}`,"aria-label":x},n||{},{iconType:"filter",onClick:()=>{t(),c("_exists_",e.name,"+")}})))),d&&(e.isRuntimeField||!["unknown","unknown_selected"].includes(e.type))&&Object(v.jsx)(f.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_editField"},Object(v.jsx)(f.EuiToolTip,{content:null!==(b=null==s?void 0:s["aria-label"])&&void 0!==b?b:j},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_editField-${e.name}`,"aria-label":j},s||{},{iconType:"pencil",onClick:()=>{t(),d(e.name)}})))),p&&e.isRuntimeField&&Object(v.jsx)(f.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_deleteField"},Object(v.jsx)(f.EuiToolTip,{content:null!==(h=null==r?void 0:r["aria-label"])&&void 0!==h?h:O},Object(v.jsx)(f.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_deleteField-${e.name}`,"aria-label":O},r||{},{color:"danger",iconType:"trash",onClick:()=>{t(),p(e.name)}}))))),e.customDescription?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"xs"}),Object(v.jsx)(Kh,{field:e})):null)},Jh=()=>Object(v.jsx)(s.Fragment,null),ev=l.a.lazy((()=>Promise.all([a.e(4),a.e(10)]).then(a.bind(null,685)))),tv=e=>Object(v.jsx)(l.a.Suspense,{fallback:Object(v.jsx)(Jh,null)},Object(v.jsx)(ev,e));var av=a(62);const nv=({field:e,visualizeInfo:t,handleVisualizeLinkClick:a,buttonProps:n})=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiButton,i()({fullWidth:!0,size:"s","data-test-subj":`fieldVisualize-${e.name}`},n||{},{href:t.href,onClick:a}),Object(v.jsx)($t.FormattedMessage,{id:"unifiedFieldList.fieldVisualizeButton.label",defaultMessage:"Visualize"}))),iv=(u.i18n.translate("uiActions.triggers.rowClickTitle",{defaultMessage:"Table row click"}),u.i18n.translate("uiActions.triggers.rowClickkDescription",{defaultMessage:"A click on a table row"}),"VISUALIZE_FIELD_TRIGGER"),sv={id:iv,title:"Visualize field",description:"Triggered when user wants to visualize a field."},lv="VISUALIZE_GEO_FIELD_TRIGGER",rv={id:lv,title:"Visualize Geo field",description:"Triggered when user wants to visualize a geo field."};function ov(e){return e===Qm.b.GEO_POINT||e===Qm.b.GEO_SHAPE?lv:iv}async function uv(e,t,a,n=[],i){return await e.getTriggerCompatibleActions(i,{dataViewSpec:a.toSpec(!1),fieldName:t,contextualFields:n})}u.i18n.translate("uiActions.triggers.dashboard.addPanelMenu.title",{defaultMessage:"Add panel menu"}),u.i18n.translate("uiActions.triggers.dashboard.addPanelMenu.description",{defaultMessage:"A new action will appear to the dashboard's add panel menu"});const cv=l.a.memo((({field:e,dataView:t,contextualFields:a,trackUiMetric:n,multiFields:i,originatingApp:s,uiActions:l,buttonProps:r,visualizeInfo:o})=>o?Object(v.jsx)(nv,{field:e,visualizeInfo:o,handleVisualizeLinkClick:async e=>{var i;e.preventDefault(),i=t,null==n||n(av.METRIC_TYPE.CLICK,"visualize_link_click"),function(e,t,a=[],n,i){if(!i)return;const s=ov(t.type),l={dataViewSpec:i.toSpec(!1),fieldName:t.name,contextualFields:a,originatingApp:n};e.getTrigger(s).exec(l)}(l,o.field,a,s,i)},buttonProps:r}):null));var dv=a(669);const pv=e=>{const[t,a]=Object(s.useState)(null);return Object(s.useEffect)((()=>{(async function(e){const t=await async function(e,t,a,n=[],i=[]){var s;if("_id"!==t.name&&null!=a&&a.id)for(const o of[t,...i]){if(!o.visualizable)continue;const t=await uv(e,o.name,a,n,ov(o.type));if(t.length>0){var l,r;const e={dataViewSpec:null==a?void 0:a.toSpec(!1),fieldName:o.name,contextualFields:n,trigger:(s=o.type,s===Qm.b.GEO_POINT||s===Qm.b.GEO_SHAPE?rv:sv)};return{field:o,href:await(null===(l=(r=t[0]).getHref)||void 0===l?void 0:l.call(r,e))}}}}(e.uiActions,e.field,e.dataView,e.contextualFields,e.multiFields);return t?Object(v.jsx)(cv,i()({},e,{visualizeInfo:t})):null})(e).then(a).catch((e=>{console.error(e)}))}),[e]),t?Object(v.jsx)(f.EuiPopoverFooter,null,t):null},mv=e=>Object(v.jsx)(dv.a,null,Object(v.jsx)(pv,e));var gv=a(659),fv=a(124);function bv(e){if(1===e.length&&1===e[0].length)return e[0][0].query;const t=e.filter((e=>e.length)).map((e=>e.length>1?`( ${e.map((({query:e})=>`( ${e} )`)).join(" OR ")} )`:`( ${e[0].query} )`)).join(" AND ");return e.length>1?`( ${t} )`:t}function hv(e,t,a,n,i,s,l,r){var o,c;const d=Boolean((null===(o=r.navLinks)||void 0===o?void 0:o.discover)&&(null===(c=r.discover)||void 0===c?void 0:c.show));if(!(Object.values(i||{}).length&&e&&t&&a&&Object.keys(s).length))return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataNoData",{defaultMessage:"Visualization has no data available to show"}),isVisible:d};let p;try{const i=e.getLayers(t).filter((e=>function(e,t,a){return e.getLayerType(a,t)||ue.LayerTypes.DATA}(a,n,e)===ue.LayerTypes.DATA));if(i.length>1)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataMultipleLayers",{defaultMessage:"Cannot show underlying data for visualizations with multiple layers"}),isVisible:d};p=e.getPublicAPI({layerId:i[0],state:t,indexPatterns:s})}catch(e){return Object(fv.c)(e),{meta:void 0,error:e.message,isVisible:d}}const m=p.getTableSpec(),g=m.filter((({columnId:e})=>{var t;return!(null!==(t=p.getOperationForColumnId(e))&&void 0!==t&&t.hasTimeShift)}));if(g.length<m.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataTimeShifts",{defaultMessage:"Cannot show underlying data when there's a time shift configured"}),isVisible:d};const f=p.getFilters(i,l);if("error"in f)return{meta:void 0,error:f.error,isVisible:d};const b=[...new Set(g.map((({fields:e})=>e)).flat())],h=((e,t,a)=>{const n=e.getSourceId();if(n)return t.reduce(((e,t)=>{var i;const s=null===(i=a[n])||void 0===i?void 0:i.getFieldByName(t);return"date"===(null==s?void 0:s.type)?[t,...e]:[...e,t]}),[])})(p,b,s);return{meta:{id:p.getSourceId(),columns:null!=h?h:b,filters:f},error:void 0,isVisible:d}}function vv(e,t,a,n,i){var s,l;const r={kuery:[],lucene:[]},o=(Array.isArray(e)?e:e&&Object(po.isOfQueryType)(e)?[e]:[]).filter((e=>Boolean("string"==typeof e.query?e.query.trim():e.query)));[r.lucene,r.kuery]=Object(pa.partition)(o,(e=>"lucene"===e.language));const c=(null===(s=o[0])||void 0===s?void 0:s.language)||"kuery",d={language:c,query:bv([...r[c].map((e=>[e])),...a.filters.enabled[c]||[]])},p="lucene"===c?"kuery":"lucene",m=[...t],g=null==n?void 0:n.find((({id:e})=>e===a.id));if(Boolean((null===(l=a.filters.enabled[p])||void 0===l?void 0:l.length)||r[p].length)){const e=bv([...r[p].map((e=>[e])),...a.filters.enabled[p]||[]]);m.push(Object(po.buildCustomFilter)(a.id,Object(po.buildEsQuery)(g,{language:p,query:e},[],i),!1,!1,u.i18n.translate("xpack.lens.app.lensContext",{defaultMessage:"Lens context ({language})",values:{language:p}}),po.FilterStateStore.APP_STATE))}for(const e of["lucene","kuery"]){const[t]=a.filters.disabled[e]||[];for(const n of t||[]){let t=n.query;"lucene"===e&&(t+=` (${e})`),m.push(Object(po.buildCustomFilter)(a.id,Object(po.buildEsQuery)(g,n,[],i),!0,!1,t,po.FilterStateStore.APP_STATE))}}return{filters:m,query:d}}function yv(e){return!("type"in e)&&Boolean(null==e?void 0:e.meta.type)}function xv(e){var t,a;const{field:n,indexPattern:l,highlight:r,exists:o,hideDetails:c,itemIndex:d,groupIndex:p,dropOntoWorkspace:m,hasSuggestionForField:g,editField:f,removeField:b,getCustomFieldType:h}=e,y=Object(s.useMemo)((()=>{var e,t;return yv(n)?new Gh.DataViewField({name:n.name,type:null!==(e=null===(t=n.meta)||void 0===t?void 0:t.type)&&void 0!==e?e:"unknown",searchable:!0,aggregatable:!0}):new Gh.DataViewField(n)}),[n]),x=Object(Cl.useKibana)().services,j=null==x||null===(t=x.data)||void 0===t||null===(a=t.query)||void 0===a?void 0:a.filterManager,[O,I]=Object(s.useState)(!1),M=Object(s.useCallback)((()=>{I((e=>!e))}),[I]),T=Object(s.useCallback)((()=>{I(!1)}),[I]),w=Object(s.useMemo)((()=>j&&l?(e,t,a)=>{T();const n=Object(Fl.generateFilters)(j,e,t,a,l);j.addFilters(n)}:void 0),[l,j,T]),k=Object(s.useMemo)((()=>f&&y.name!==Wt.DOCUMENT_FIELD_NAME?e=>{T(),f(e)}:void 0),[f,T,y.name]),E=Object(s.useMemo)((()=>b?e=>{T(),b(e)}:void 0),[b,T]),C=null==l?void 0:l.id,F=Object(s.useMemo)((()=>yv(n)?{field:n.name,id:n.id,humanData:{label:n.name}}:{field:n,indexPatternId:C,id:n.name,humanData:{label:n.displayName,position:d+1}}),[n,C,d]),S=Object(s.useMemo)((()=>[0,p,d]),[p,d]),{buttonAddFieldToWorkspaceProps:A,onAddFieldToWorkspace:P}=function({value:e,hasSuggestionForField:t,dropOntoWorkspace:a,closeFieldPopover:n}){const i=t(e);return{buttonAddFieldToWorkspaceProps:{isDisabled:!i,"aria-label":i?u.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:e.humanData.label}}):u.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceNotAvailable",{defaultMessage:"To visualize this field, please add it directly to the desired layer. Adding this field to the workspace is not supported based on your current configuration."})},onAddFieldToWorkspace:()=>{null==n||n(),a(e)}}}({value:F,hasSuggestionForField:g,dropOntoWorkspace:m,closeFieldPopover:T}),_={isSelected:!1,isEmpty:!o,isActive:O,withDragIcon:!0,fieldSearchHighlight:r,onClick:M,buttonAddFieldToWorkspaceProps:A,onAddFieldToWorkspace:P};return Object(v.jsx)("li",null,Object(v.jsx)(qh,{isOpen:O,closePopover:T,panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel","data-test-subj":"lnsFieldListPanelField",panelProps:{"data-test-subj":"lnsFieldListPanelFieldContent"},container:document.querySelector(".application")||void 0,button:Object(v.jsx)(gv.a,{dragType:"copy",value:F,order:S,onDragStart:T,dataTestSubj:`lnsFieldListPanelField-${n.name}`},yv(n)?Object(v.jsx)(Yh,i()({field:n,getCustomFieldType:h},_)):Object(v.jsx)(Yh,i()({field:n},_))),renderHeader:()=>Object(v.jsx)(Zh,{field:y,closePopover:T,buttonAddFieldToWorkspaceProps:A,onAddFieldToWorkspace:P,onAddFilter:w,onEditField:k,onDeleteField:E}),renderContent:c?void 0:()=>Object(v.jsx)(Ov,i()({},e,{dataViewField:y,onAddFilter:w}))}))}const jv=l.a.memo(xv);function Ov(e){const{query:t,filters:a,indexPattern:n,dataViewField:i,dateRange:r,onAddFilter:o}=e,c=Object(Cl.useKibana)().services,d=Object(s.useMemo)((()=>{var e;if(!n)return null;const s={id:n.id,columns:[i.name],filters:{enabled:{lucene:[],kuery:[]},disabled:{lucene:[],kuery:[]}}},{filters:l,query:r}=vv(t,a,s,[n],Object(Fl.getEsQueryConfig)(c.uiSettings)),o=null===(e=c.share)||void 0===e?void 0:e.url.locators.get("DISCOVER_APP_LOCATOR");return o&&c.application.capabilities.discover.show?o.getRedirectUrl({dataViewSpec:null==n?void 0:n.spec,timeRange:c.data.query.timefilter.timefilter.getTime(),filters:l,query:r,columns:s.columns}):void 0}),[i.name,a,n,t,c]);return n?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(tv,{services:c,query:t,filters:a,fromDate:r.fromDate,toDate:r.toDate,dataViewOrDataViewId:n.id,onAddFilter:o,field:i,"data-test-subj":"lnsFieldListPanel",overrideMissingContent:e=>"no-data"===e.reason?Object(v.jsx)(f.EuiText,{size:"s","data-test-subj":"lnsFieldListPanel-missingFieldStats"},u.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data. To create a visualization, drag and drop a different field."})):"unsupported"===e.reason?Object(v.jsx)(f.EuiText,{"data-test-subj":"lnsFieldListPanel-missingFieldStats"},e.element):e.element}),"geo_point"===i.type||"geo_shape"===i.type?Object(v.jsx)(mv,{field:i,dataView:{...n,toSpec:()=>n.spec},originatingApp:Wt.APP_ID,uiActions:c.uiActions,buttonProps:{"data-test-subj":`lensVisualize-GeoField-${i.name}`}}):d?Object(v.jsx)(f.EuiPopoverFooter,null,Object(v.jsx)(f.EuiButton,{fullWidth:!0,size:"s",href:d,target:"_blank","data-test-subj":`lnsFieldListPanel-exploreInDiscover-${i.name}`},u.i18n.translate("xpack.lens.indexPattern.fieldExploreInDiscover",{defaultMessage:"Explore in Discover"}))):null):null}const Iv=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape","murmur3"]);function Mv(e){return Iv.has(e.type)}function Tv({state:e,core:t,data:a,dataViews:n,fieldFormats:i,query:r,filters:o,dateRange:c,charts:d,indexPatternFieldEditor:p,showNoDataPopover:m,dropOntoWorkspace:g,hasSuggestionForField:b,uiActions:h,indexPatternService:y,frame:x,onIndexPatternRefresh:j,usedIndexPatterns:O,layerFields:I}){const{indexPatterns:M,indexPatternRefs:T}=x.dataViews,{currentIndexPatternId:w}=e,k=Object(s.useMemo)((()=>Object(pa.uniq)((null!=O?O:Object.values(e.layers).map((({indexPatternId:e})=>e))).concat(w)).filter((e=>!!M[e])).sort().map((e=>M[e]))),[O,M,e.layers,w]);return Object(v.jsx)(l.a.Fragment,null,0===Object.keys(M).length&&0===T.length?Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(v.jsx)(f.EuiFlexItem,{grow:null},Object(v.jsx)(f.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:u.i18n.translate("xpack.lens.indexPattern.noDataViewsLabel",{defaultMessage:"No data views"}),color:"warning",iconType:"warning"},Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.noDataViewDescription",defaultMessage:"Please create a data view or switch to another data source"}))))):Object(v.jsx)(Ev,{currentIndexPatternId:w,query:r,dateRange:c,filters:o,core:t,data:a,dataViews:n,fieldFormats:i,charts:d,indexPatternFieldEditor:p,dropOntoWorkspace:g,hasSuggestionForField:b,uiActions:h,indexPatternService:y,onIndexPatternRefresh:j,frame:x,layerFields:I,showNoDataPopover:m,activeIndexPatterns:k}))}const wv=function({currentIndexPatternId:e,query:t,dateRange:a,filters:n,core:l,data:r,dataViews:o,indexPatternFieldEditor:c,dropOntoWorkspace:d,hasSuggestionForField:p,uiActions:m,indexPatternService:g,frame:f,onIndexPatternRefresh:b,layerFields:h,showNoDataPopover:y,activeIndexPatterns:x}){const{indexPatterns:j}=f.dataViews,O=j[e],{refetchFieldsExistenceInfo:I,isProcessing:M}=Object(am.a)({dataViews:x,query:t,filters:n,fromDate:a.fromDate,toDate:a.toDate,services:{data:r,dataViews:o,core:l},onNoData:t=>{t===e&&y()}}),T=m.getTrigger(Ih.VISUALIZE_GEO_FIELD_TRIGGER),w=Object(s.useMemo)((()=>O?T?O.fields:O.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)):[]),[O,T]),k=c.userPermissions.editIndexPattern()||!O.isPersisted,E=Object(s.useCallback)((e=>Boolean(null==h?void 0:h.includes(e.name))),[h]),C=Object(s.useCallback)((e=>{if(e===Mh.b.AvailableFields)return{helpText:u.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, select a different data view, edit your queries, or use a different time range. Some field types cannot be visualized in Lens, including full text and geographic fields."})}}),[]),{fieldListFiltersProps:F,fieldListGroupedProps:S,hasNewFields:A}=kh({dataViewId:e,allFields:w,services:{dataViews:o,core:l},isAffectedByGlobalFilter:Boolean(n.length),onSupportedFieldFilter:Mv,onSelectedFieldFilter:E,onOverrideFieldGroupDetails:C,getNewFieldsBySpec:kv}),P=Object(s.useRef)();Object(s.useEffect)((()=>()=>{P.current&&P.current()}),[]);const _=zh()((async()=>{if(O){const e=await g.loadIndexPatterns({patterns:[O.id],cache:{},onIndexPatternRefresh:b});g.updateDataViewsState({indexPatterns:{...f.dataViews.indexPatterns,[O.id]:e[O.id]}})}r.search.session.start()}));Object(s.useEffect)((()=>{A&&_.current()}),[A,_]);const L=Object(s.useMemo)((()=>k?async(e,t="edit")=>{const a=await o.get(null==O?void 0:O.id);P.current=await c.openEditor({ctx:{dataView:a},fieldName:e,onSave:()=>{a.isPersisted()?(_.current(),I(a.id)):g.replaceDataViewId(a)}})}:void 0),[k,o,null==O?void 0:O.id,c,_,g,I]),D=Object(s.useMemo)((()=>k?async e=>{const t=await o.get(null==O?void 0:O.id);P.current=c.openDeleteModal({ctx:{dataView:t},fieldName:e,onDelete:()=>{t.isPersisted()?(_.current(),I(t.id)):g.replaceDataViewId(t)}})}:void 0),[null==O?void 0:O.id,o,k,c,g,_,I]),R=Object(s.useCallback)((({field:e,itemIndex:i,groupIndex:s,groupName:l,hideDetails:r,fieldSearchHighlight:o})=>Object(v.jsx)(jv,{field:e,exists:l!==Mh.b.EmptyFields,hideDetails:r||"document"===e.type,itemIndex:i,groupIndex:s,dropOntoWorkspace:d,hasSuggestionForField:p,editField:L,removeField:D,indexPattern:O,highlight:o,dateRange:a,query:t,filters:n})),[O,a,t,n,d,p,L,D]);return Object(v.jsx)(Ah,{className:"lnsInnerIndexPatternDataPanel",isProcessing:M,prepend:Object(v.jsx)(Lh,i()({},F,{"data-test-subj":"lnsIndexPattern"}))},Object(v.jsx)(Nh,i()({},S,{renderFieldItem:R,"data-test-subj":"lnsIndexPattern",localStorageKeyPrefix:"lens"})))};function kv(e,t){const a=t?new Set(t.metaFields):void 0;return e.reduce(((e,t)=>{const n=new An.DataViewField(t);return Object(Vh.a)(n)&&e.push(Object(Lo.a)(n,a)),e}),[])}const Ev=Object(s.memo)(wv);function Cv({state:e,updatedLayer:t,layerId:a,label:n,changeType:i}){const s=t?{...e,layers:{...e.layers,[a]:t}}:e,l=Object(pa.mapValues)(s.layers,(e=>({...e,columns:Object(pa.pick)(e.columns,e.columnOrder)}))),r=l[a].columnOrder,o=l[a].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...s,layers:l},table:{columns:r.filter((e=>!Gp(l[a],e))).map((e=>({columnId:e,operation:iy(o[e])}))),isMultiRow:u,layerId:a,changeType:i,label:n},keptLayerIds:Object.keys(e.layers)}}function Fv(e,t,a){return function(e,t,a){const n=[];return t.forEach((t=>{const i=a[t.indexPatternId];if(!i)return[];const s=function(e,t){const a=function(e,t){return e.reduce(((a,n)=>{if(!e.some((e=>Sv(e)&&n.columnId===e.references[0]))){const s=Lv(n,t);if(Sv(n)){const a=e.find((e=>e.columnId===n.references[0]));s.references=[Lv(a,t)]}if(function(e){return"terms"===e.operationType}(n)&&n.params.orderAgg&&s.columnParams&&!e.some((e=>{var t;return e.columnId===(null===(t=n.params.orderAgg)||void 0===t?void 0:t.columnId)}))){var i;const e=n.params.orderAgg,a=Rf[e.operationType],l={indexPatternId:t.id,columns:{},columnOrder:[]};s.columnParams.orderAgg=a.buildColumn({previousColumn:{...n.params.orderAgg,label:(null===(i=n.params.orderAgg)||void 0===i?void 0:i.label)||""},indexPattern:t,layer:l,referenceIds:[],field:_v(n.params.orderAgg,t)},n.params)}a.push(s)}return a}),[])}(t.columns,e);let n={ignoreGlobalFilters:t.ignoreGlobalFilters,indexPatternId:e.id,columns:{},columnOrder:[]};a.forEach((a=>{if("formula"===a.op){var i;const s=Rf.formula,l=t.columns.find((e=>e.columnId===a.columnId)),r=s.buildColumn({previousColumn:{...l,label:(null==l?void 0:l.label)||(null===(i=a.columnParams)||void 0===i?void 0:i.formula)||""},indexPattern:e,layer:n},a.columnParams);n=Ud(a.columnId,r,n,{indexPattern:e}).layer}else n=Mp({...a,layer:n,respectOrder:!0})}));let i=n;return t.columns.forEach((({columnId:e,label:t})=>{t&&(i=function({layer:e,columnId:t,customLabel:a}){const n=e.columns[t];return{...e,columns:{...e.columns,[t]:{...n,label:void 0!==a?a:n.label,customLabel:Boolean(a)}}}}({layer:i,columnId:e,customLabel:Gp(i,e)?"":t}))})),i}(i,t),l=Cv({state:e,updatedLayer:s,layerId:t.layerId,changeType:"initial"});n.push(l)})),n}(e,t,a)}function Sv(e){return"references"in e&&e.references.length>0}function Av(e){return{...e.params}}function Pv(e){return{filter:e.filter,timeShift:e.timeShift,timeScale:e.timeScale,dataType:e.dataType,...e.reducedTimeRange&&{reducedTimeRange:e.reducedTimeRange}}}function _v(e,t){const a=function(e,t){return function(e){return"sourceField"in e}(e)?"document"===e.sourceField?qd.a:t.getFieldByName(e.sourceField):void 0}(e,t);return a&&e.label?{...a,customLabel:e.label}:a}function Lv(e,t){return{op:e.operationType,columnId:e.columnId,field:_v(e,t),indexPattern:t,visualizationGroups:[],incompleteParams:Pv(e),initialParams:{params:Av(e)},columnParams:Av(e)}}function Dv(e,t,a,n){const i=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t)),s=n[t],l=null==s?void 0:s.getFieldByName(a);if(0!==i.length||!l)return[];const r=Object(kt.a)();return Nv(e,r,t,l,n).concat(Nv({...e,layers:{}},r,t,l,n))}function Rv(e){if("number"!==e.type)return $f(e).find((e=>"date_histogram"===e||"terms"===e))}function Nv(e,t,a,n,i){const s=i[a];let l;const r=Rv(n);var o,u;r?l=function(e,t,a){return Mp({op:a,layer:Mp({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(kt.a)(),field:qd.a,indexPattern:e,visualizationGroups:[]}),columnId:Object(kt.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(s,n,r):s.timeFieldName&&$f(n).length>0&&(l=function(e,t){const a=e.getFieldByName(e.timeFieldName),[n]=Pp(t);if(n)return Mp({op:"date_histogram",layer:Mp({op:n.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(kt.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(kt.a)(),field:a,indexPattern:e,visualizationGroups:[]})}(s,n)),l&&(l.sampling=null!==(o=null===(u=e.layers[t])||void 0===u?void 0:u.sampling)&&void 0!==o?o:1);const c=l?[Cv({state:e,updatedLayer:l,layerId:t,changeType:"initial"})]:[],d=zv(s,t,e,n);return d?c.concat(d):c}function Bv(e,t,a=(()=>!0)){if(!t)return[];const n=Object.entries(e.layers||{}).filter((([e])=>a(e)));return n.length>1?n.map((([a,i],s)=>{const l=n.some((([e,t])=>e!==a&&t.indexPatternId===i.indexPatternId))?u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:s+1}}):u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:t[i.indexPatternId].title}});return Cv({state:{...e,layers:{[a]:i}},layerId:a,changeType:"layers",label:l})})).concat([Cv({state:e,layerId:n[0][0],changeType:"unchanged"})]):Object(pa.flatten)(n.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([a,n])=>{const i=t[n.indexPatternId],[s,l,r]=Bp(n),o=n.columnOrder.find((e=>n.columns[e].isBucketed&&"date"===n.columns[e].dataType)),u=(null==i?void 0:i.timeFieldName)&&i.getFieldByName(i.timeFieldName),c=1===s.length&&s.some((e=>"number"===n.columns[e].dataType)),d=[];return d.push(Cv({state:e,layerId:a,changeType:"unchanged"})),!r.length&&l.length&&0===s.length?(u&&s.length<1&&!Up(n)&&d.push(Gv(e,a,u,t)),i&&d.push(...function(e,t,a){const n=a.layers[t],i=[];return n.columnOrder.filter((e=>!Gp(n,e))).forEach((s=>{const l=n.columns[s];if(!Zd(l))return;const r=e.getFieldByName(l.sourceField);if(!r)return;const o=Pp(r).filter((({type:e})=>e!==l.operationType));if(o.length){const l=wp({layer:n,indexPattern:e,field:r,columnId:s,op:o[0].type,visualizationGroups:[]});l&&i.push(Cv({state:a,layerId:t,updatedLayer:l,changeType:"initial"}))}})),i}(i,a,e))):(d.push(...function(e,t){const a=e.layers[t],[n,i]=Object(pa.partition)(a.columnOrder,(e=>a.columns[e].isBucketed)),s=i.filter((e=>!Gp(a,e)));return Object(pa.flatten)(n.map(((e,t)=>{const l=n.slice(0,t+1),r={...a,columnOrder:[...l,...i],noBuckets:!1};return l.length>0&&s.length>1?[{...a,columnOrder:[...l,s[0],...Hp(a,s[0])],noBuckets:!1}]:n.length>1?r:[]}))).concat(n.length>0||s.length>1?s.map((e=>({...a,columnOrder:[e,...Hp(a,e)],noBuckets:!0}))):[]).map((({noBuckets:a,...n})=>Cv({state:e,layerId:t,updatedLayer:n,changeType:"reduced",label:a?qv(n,1===i.length):void 0})))}(e,a)),!o&&u&&s.length<2&&!c&&!Up(n)&&d.push(Gv(e,a,u,t)),2===s.length&&d.push(function(e,t,a){var n,i;const s=e.layers[t],[l,r,...o]=s.columnOrder,u={...s,columnOrder:[r,l,...o]},c=a[e.currentIndexPatternId],d=s.columns[l],p=Zd(d)&&(null===(n=c.getFieldByName(d.sourceField))||void 0===n?void 0:n.displayName)||"",m=s.columns[r];return Cv({state:e,layerId:t,updatedLayer:u,label:Vv([Zd(m)&&(null===(i=c.getFieldByName(m.sourceField))||void 0===i?void 0:i.displayName)||"",p]),changeType:"reorder"})}(e,a,t))),d})))}function zv(e,t,a,n){const[i]=Pp(n);if(i)return Cv({layerId:t,state:a,changeType:"initial",updatedLayer:Mp({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(kt.a)(),op:i.type,field:"count"===i.type?qd.a:n,indexPattern:e,visualizationGroups:[]})})}function Vv([e,t]){return u.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function Gv(e,t,a,n){const i=e.layers[t];return Cv({state:e,layerId:t,updatedLayer:Mp({layer:i,indexPattern:n[i.indexPatternId],field:a,op:"date_histogram",columnId:Object(kt.a)(),visualizationGroups:[]}),label:u.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function qv(e,t){const{operationType:a,label:n}=e.columns[e.columnOrder[0]];return u.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?Rf[a].displayName:n},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}function $v({title:e,titleId:t,...a}){return Object(v.jsx)("svg",i()({width:"15",height:"16",viewBox:"0 0 15 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(v.jsx)("title",{id:t},e):null,Object(v.jsx)("path",{d:"M1 0C0.447715 0 0 0.447715 0 1V14C0 14.5523 0.447715 15 1 15H7.67099C7.54918 14.9013 7.43133 14.7953 7.31802 14.682C7.10539 14.4693 6.91848 14.2407 6.75731 14H1V1H8V4.5C8 4.77614 8.22386 5 8.5 5H12V7.25625C12.3483 7.3791 12.6846 7.54612 13 7.75731V4C13 3.73478 12.8946 3.48043 12.7071 3.29289L9.70711 0.292893C9.51957 0.105357 9.26522 0 9 0H1Z"}),Object(v.jsx)("path",{d:"M10.5 13C11.3284 13 12 12.3284 12 11.5C12 10.6716 11.3284 10 10.5 10C9.67157 10 9 10.6716 9 11.5C9 12.3284 9.67157 13 10.5 13Z"}),Object(v.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.1465 15.8536L12.5962 14.3033C11.9771 14.7674 11.2393 14.9997 10.5013 15H10.4987C9.61445 14.9997 8.7303 14.6663 8.05051 14L8.02517 13.9749C6.65833 12.608 6.65833 10.392 8.02517 9.02513C9.392 7.65829 11.6081 7.65829 12.9749 9.02513C14.2217 10.2719 14.3312 12.2253 13.3034 13.5963L14.8536 15.1464C15.0489 15.3417 15.0489 15.6583 14.8536 15.8535C14.6584 16.0488 14.3418 16.0488 14.1465 15.8536ZM12.2678 13.9749L12.5962 14.3033C11.9805 14.7648 11.2474 14.997 10.5135 14.9998C10.7834 14.9927 11.0001 14.7716 11.0001 14.5C11.0001 14.2239 10.7762 14 10.5001 14C9.85948 14 9.22053 13.756 8.73227 13.2678C7.75596 12.2915 7.75596 10.7085 8.73227 9.73223C9.70858 8.75592 11.2915 8.75592 12.2678 9.73223C13.2441 10.7085 13.2441 12.2915 12.2678 13.2678C12.174 13.3615 12.1214 13.4887 12.1214 13.6213C12.1214 13.7539 12.174 13.8811 12.2678 13.9749Z"}),Object(v.jsx)("path",{d:"M3 2.5C3 2.77614 2.77614 3 2.5 3C2.22386 3 2 2.77614 2 2.5C2 2.22386 2.22386 2 2.5 2C2.77614 2 3 2.22386 3 2.5Z"}),Object(v.jsx)("path",{d:"M2.5 5C2.77614 5 3 4.77614 3 4.5C3 4.22386 2.77614 4 2.5 4C2.22386 4 2 4.22386 2 4.5C2 4.77614 2.22386 5 2.5 5Z"}),Object(v.jsx)("path",{d:"M3 6.5C3 6.77614 2.77614 7 2.5 7C2.22386 7 2 6.77614 2 6.5C2 6.22386 2.22386 6 2.5 6C2.77614 6 3 6.22386 3 6.5Z"}),Object(v.jsx)("path",{d:"M2.5 9C2.77614 9 3 8.77614 3 8.5C3 8.22386 2.77614 8 2.5 8C2.22386 8 2 8.22386 2 8.5C2 8.77614 2.22386 9 2.5 9Z"}),Object(v.jsx)("path",{d:"M3 10.5C3 10.7761 2.77614 11 2.5 11C2.22386 11 2 10.7761 2 10.5C2 10.2239 2.22386 10 2.5 10C2.77614 10 3 10.2239 3 10.5Z"}),Object(v.jsx)("path",{d:"M3 12.5C3 12.7761 2.77614 13 2.5 13C2.22386 13 2 12.7761 2 12.5C2 12.2239 2.22386 12 2.5 12C2.77614 12 3 12.2239 3 12.5Z"}),Object(v.jsx)("path",{d:"M4.5 9C4.77614 9 5 8.77614 5 8.5C5 8.22386 4.77614 8 4.5 8C4.22386 8 4 8.22386 4 8.5C4 8.77614 4.22386 9 4.5 9Z"}),Object(v.jsx)("path",{d:"M5 6.5C5 6.77614 4.77614 7 4.5 7C4.22386 7 4 6.77614 4 6.5C4 6.22386 4.22386 6 4.5 6C4.77614 6 5 6.22386 5 6.5Z"}),Object(v.jsx)("path",{d:"M4.5 5C4.77614 5 5 4.77614 5 4.5C5 4.22386 4.77614 4 4.5 4C4.22386 4 4 4.22386 4 4.5C4 4.77614 4.22386 5 4.5 5Z"}),Object(v.jsx)("path",{d:"M5 2.5C5 2.77614 4.77614 3 4.5 3C4.22386 3 4 2.77614 4 2.5C4 2.22386 4.22386 2 4.5 2C4.77614 2 5 2.22386 5 2.5Z"}),Object(v.jsx)("path",{d:"M6.5 5C6.77614 5 7 4.77614 7 4.5C7 4.22386 6.77614 4 6.5 4C6.22386 4 6 4.22386 6 4.5C6 4.77614 6.22386 5 6.5 5Z"}),Object(v.jsx)("path",{d:"M7 2.5C7 2.77614 6.77614 3 6.5 3C6.22386 3 6 2.77614 6 2.5C6 2.22386 6.22386 2 6.5 2C6.77614 2 7 2.22386 7 2.5Z"}),Object(v.jsx)("path",{d:"M6.5 7C6.77614 7 7 6.77614 7 6.5C7 6.22386 6.77614 6 6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7Z"}),Object(v.jsx)("path",{d:"M9 6.5C9 6.77614 8.77614 7 8.5 7C8.22386 7 8 6.77614 8 6.5C8 6.22386 8.22386 6 8.5 6C8.77614 6 9 6.22386 9 6.5Z"}),Object(v.jsx)("path",{d:"M10.5 7C10.7761 7 11 6.77614 11 6.5C11 6.22386 10.7761 6 10.5 6C10.2239 6 10 6.22386 10 6.5C10 6.77614 10.2239 7 10.5 7Z"}),Object(v.jsx)("path",{d:"M7 8.5C7 8.77614 6.77614 9 6.5 9C6.22386 9 6 8.77614 6 8.5C6 8.22386 6.22386 8 6.5 8C6.77614 8 7 8.22386 7 8.5Z"}),Object(v.jsx)("path",{d:"M4.5 11C4.77614 11 5 10.7761 5 10.5C5 10.2239 4.77614 10 4.5 10C4.22386 10 4 10.2239 4 10.5C4 10.7761 4.22386 11 4.5 11Z"}),Object(v.jsx)("path",{d:"M5 12.5C5 12.7761 4.77614 13 4.5 13C4.22386 13 4 12.7761 4 12.5C4 12.2239 4.22386 12 4.5 12C4.77614 12 5 12.2239 5 12.5Z"}))}function Hv({values:e,currentValue:t,disabled:a=!1,disabledReason:n="",onChange:i,"data-test-subj":s}){const{euiTheme:l}=Object(f.useEuiTheme)(),r=e.findIndex((e=>e===t)),o=r>-1?r:e.length-1;return Object(v.jsx)(ze.a,{tooltipContent:n,condition:a,delay:"regular",display:"block"},Object(v.jsx)(f.EuiFlexGroup,{gutterSize:"none"},Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiText,{color:a?l.colors.disabledText:l.colors.subduedText,size:"xs"},Object(v.jsx)($t.FormattedMessage,{id:"randomSampling.ui.sliderControl.performanceLabel",defaultMessage:"Performance"}))),Object(v.jsx)(f.EuiFlexItem,null,Object(v.jsx)(f.EuiRange,{"data-test-subj":s,value:o,disabled:a,fullWidth:!0,onChange:t=>{i(e[Number(t.currentTarget.value)])},showInput:!1,showRange:!1,showTicks:!0,step:1,min:0,max:e.length-1,ticks:e.map(((e,t)=>({label:(100*e+"%").slice(Number.isInteger(100*e)?0:1),value:t})))})),Object(v.jsx)(f.EuiFlexItem,{grow:!1},Object(v.jsx)(f.EuiText,{color:a?l.colors.disabledText:l.colors.subduedText,size:"xs"},Object(v.jsx)($t.FormattedMessage,{id:"randomSampling.ui.sliderControl.accuracyLabel",defaultMessage:"Accuracy"})))))}var Uv=a(180);function Wv({state:e,layerId:t,onChangeIndexPattern:a,dataViews:n}){const i=e.layers[t],{euiTheme:s}=Object(f.useEuiTheme)(),l=n.indexPatterns[i.indexPatternId],r=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),o=n.indexPatternRefs.map((e=>{var t,a;const i=null===(t=null===(a=n.indexPatterns[e.id])||void 0===a?void 0:a.isPersisted)||void 0===t||t;return{...e,isAdhoc:!i}})),c=cb(i),d=[];return i.ignoreGlobalFilters&&d.push(fl({color:s.colors.disabledText,dataTestSubj:"lnsChangeIndexPatternIgnoringFilters"})),1!==c&&d.push({component:Object(v.jsx)($v,{color:s.colors.disabledText,fill:"currentColor"}),value:100*c+"%",tooltipValue:u.i18n.translate("xpack.lens.indexPattern.randomSamplingInfo",{defaultMessage:"{value}% sampling",values:{value:100*c}}),"data-test-subj":"lnsChangeIndexPatternSamplingInfo"}),Object(v.jsx)(Uv.a,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==l?void 0:l.name)||r,title:(null==l?void 0:l.title)||r,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal",extraIcons:d},indexPatternId:i.indexPatternId,indexPatternRefs:o,isMissingCurrent:!l,onChangeIndexPattern:a})}const Xv=({title:e,titleId:t,...a})=>Object(v.jsx)("svg",{width:"176",height:"176",viewBox:"0 0 176 176",xmlns:"http://www.w3.org/2000/svg"},Object(v.jsx)("path",{d:"M88 152c35.346 0 64-28.654 64-64 0-13.35-4.087-25.745-11.079-36.002L51.998 140.92C62.255 147.913 74.65 152 88 152zm-58.277-.083l-5.64-5.64 15.93-15.929C30.047 119.064 24 104.238 24 88c0-35.346 28.654-64 64-64 16.238 0 31.064 6.047 42.348 16.013l15.929-15.93 5.64 5.64L29.723 151.917z",fill:"#F9B110"}),Object(v.jsx)("path",{d:"M87.992 151.961h-2.248a76.025 76.025 0 01-.679-.027v-36.978h-7.102l5.87-5.869h1.232v-1.233L90.92 102v7.087h28.52a121.923 121.923 0 001.806-21.048 122.722 122.722 0 00-.951-15.414l10.102-10.102H146.7a67.977 67.977 0 012.211 5.869h-23.228a132.499 132.499 0 011.432 19.647 132.001 132.001 0 01-1.65 21.048h22.963a64.832 64.832 0 01-2.366 5.838h-21.687c-2.957 13.793-8.126 25.36-14.758 33.315a63.132 63.132 0 01-4.943 1.567 63.66 63.66 0 01-7.399 1.526c9.248-5.54 16.955-19.087 20.982-36.377H90.919v36.979c-.22.01-.442.018-.663.026h-2.264zm35.642-93.956l-10.387 10.387 10.387-10.386zM90.919 90.721l-5.854 5.853 5.854-5.854zm0-11.28l-5.854 5.854V68.392h-28.77a122.988 122.988 0 00.25 40.695h4.728l-8.941 8.941a111.251 111.251 0 01-.707-3.072H29.94l-.22-.509c-.755-1.75-1.523-3.529-2.162-5.36H50.52a132.014 132.014 0 01-1.65-21.017 134.648 134.648 0 011.432-19.647H27.09a67.9 67.9 0 012.21-5.869h21.967c2.88-14.4 8.173-26.497 15.039-34.732a64.165 64.165 0 0112.454-3.114c-9.527 5.683-17.42 19.834-21.344 37.815h27.68V24.117c.966-.078 1.93-.078 2.912-.078.492 0 .98.02 1.467.039.483.02.963.039 1.444.039v38.375h16.949l-5.9 5.9h-11.05v11.049zm25.363-25.363l4.804-4.804c-2.947-8.592-6.862-15.903-11.486-21.483a64.417 64.417 0 00-12.454-3.114c7.985 4.762 14.822 15.473 19.136 29.401zM54.881 126.76l4.74-4.74-4.74 4.74zm11.802-11.803l5.87-5.869-5.87 5.869zm-4.036 15.316l-4.551 4.551c2.385 5.173 5.168 9.702 8.271 13.429a63.532 63.532 0 0012.27 3.068c-6.257-3.801-11.806-11.256-15.99-21.048z",fill:"#FEC514"}),Object(v.jsx)("path",{d:"M115.909 138.807c.444-.825.878-1.669 1.299-2.534a1.56 1.56 0 011.223.823c.156.498-.732 1.868-1.401 2.055a1.381 1.381 0 01-1.121-.344zm-5.488-2.505c-.226.416-.455.826-.687 1.23a5.47 5.47 0 01-1.048.171 1.03 1.03 0 01-.826-.342 1.284 1.284 0 010-1.043c.172-.249.701-.514.919-.421.439.311.975.454 1.51.405h.132zm3.41-7.241l-.084.207c-.191.429-.39.896-.578 1.352a.959.959 0 01-.293-.295.958.958 0 01-.143-.39.764.764 0 01.623-.872c.156-.038.319-.039.475-.002zm-28.766 20.867v2.004c-.352-.013-.705-.044-1.057-.074-.464-.04-.928-.08-1.392-.081l-.02-.002c.377-.244.81-.388 1.259-.419a1.83 1.83 0 01.902.125.99.99 0 01-.124-.296 1.715 1.715 0 01.432-1.257zm0-4.223v3.069a1.278 1.278 0 01-.12-.578v-.654a2.033 2.033 0 01-2.149.28 8.458 8.458 0 01-1.697-1.463 1.323 1.323 0 01.39-2.179 2.57 2.57 0 01-1.075-.779 2.03 2.03 0 01-.234.67c-.128.235-.31.437-.529.591-.273.225-.6.376-.95.436.078.027.15.064.219.109a1.402 1.402 0 01.155 1.884 1.438 1.438 0 01-.94.79 1.424 1.424 0 01-1.208-.23 1.415 1.415 0 01-.639-1.79 2.202 2.202 0 011.557-.825l-.249-.109a2.45 2.45 0 01-1.183-1.464c-.327-.327-.576-.685-.483-.856.183-.217.42-.383.685-.482.67-1.075 1.293-1.23 2.647-.576.431.189.79.511 1.028.918a2.477 2.477 0 011.043-1.728 14.152 14.152 0 011.946-.483c-.032-.669.373-1.058 1.198-1.058h.094a.682.682 0 01.494-.11v1.56a.449.449 0 01-.541-.002c-.348.373-.329.766-.307 1.21.005.112.011.227.011.346a2.085 2.085 0 01-1.043 2.024c.717.367 1.355.87 1.88 1.479zm0-3.296v.909a1.091 1.091 0 01-.136-.259.718.718 0 01.136-.65zm0-7.629v2.477a1.282 1.282 0 01-.875.557 1.276 1.276 0 01-1.005-.282 1.247 1.247 0 01-.545-1.759 2.208 2.208 0 012.289-.856l.136-.137zM65.94 147.731c.142.176.284.349.427.521a67.88 67.88 0 01-.447-.163v-.22c0-.037.011-.096.02-.138zm-5.292-7.889c.449.801.908 1.582 1.378 2.341a1.427 1.427 0 01-.325-.105 1.154 1.154 0 01-.81-.42.86.86 0 010-.296 1.87 1.87 0 01-.243-1.52zm-1.22-2.279c.247.485.5.963.755 1.435a.851.851 0 01-.413.569.85.85 0 01-.746.051 5.625 5.625 0 00-.7-.171 2.195 2.195 0 01-1.309 2.335 2.055 2.055 0 01-2.382-1.074v-.234a1.551 1.551 0 01-.778-.155 1.871 1.871 0 01-.716 1.323 62.51 62.51 0 01-1.112-.75l4.416-4.417a1.727 1.727 0 011.18.294 1.786 1.786 0 001.804.794zm-1.184-2.421c.125.269.251.535.379.8a1.056 1.056 0 01-.379-.8zm-13.376-9.65l-.904.904a.94.94 0 01.255-.54.76.76 0 01.65-.364zm2.423-2.423l-.1.099a.38.38 0 00-.077-.099h.177zm-16.669-8.113h4.681a.946.946 0 01-.005.127c-.23.447-.597.517-.97.588a5.091 5.091 0 00-.244.05l-.436.109h.109a2.026 2.026 0 011.557 1.464h.187a1.076 1.076 0 011.276.794 1.119 1.119 0 01-.685 1.354.981.981 0 01-1.152-.56 2.466 2.466 0 01-1.946.934 1.738 1.738 0 01-.723-.324 62.044 62.044 0 01-.78-1.42 3.119 3.119 0 01.009-.701 1.56 1.56 0 01.56-1.152 1.992 1.992 0 01-1.438-1.263zm48.905 35.918c.048.187.048.383.001.57a15.906 15.906 0 01-.217-.029l-.656-.105c-.292-.175-.584-.377-.876-.578l-.107-.074-.185-.127c.129-.249.323-.459.56-.607a1.017 1.017 0 010-.763 1.424 1.424 0 011.044-.716 1.082 1.082 0 011.122.95 1.09 1.09 0 01-.064.529 1.23 1.23 0 01-.653.561c.031.127.042.258.03.389zm-17.312-4.437c.01.053.014.108.012.162a63.978 63.978 0 01-6.015-3.039c.159-.192.366-.339.601-.423a3.55 3.55 0 011.059-.576c.421-.141.763.021 1.118.188.275.13.557.263.89.263a2.281 2.281 0 011.76.841c.309.4.468.895.45 1.401a4.07 4.07 0 010 .747c.055.141.097.287.125.436zm29.171 5.475a64.518 64.518 0 003.223-.249 1.388 1.388 0 00-1.133-.618 5.86 5.86 0 00-1.277.016c.228-.447.294-.959.187-1.448a1.852 1.852 0 00-1.463-1.355v3.659c.154 0 .309-.002.463-.005zm25.699-6.887c.331-.17.661-.342.989-.517l.139-.079c.074-.174.121-.358.14-.545a1.67 1.67 0 00-.576-1.479 4.637 4.637 0 01-.44-.319h-.001c-.337-.265-.656-.516-1.007-.428a1.035 1.035 0 00-.747.544c-.041.066-.09.127-.141.19-.143.177-.299.369-.31.713a2.223 2.223 0 00.747 1.806c.229.17.496.282.778.327l.228-.113.201-.1zm-72.85-92.93a1.65 1.65 0 00-1.558-2.896 1.697 1.697 0 00-.654 2.304 1.76 1.76 0 002.211.592zM38.77 55.8a2.07 2.07 0 00.98-2.522 1.977 1.977 0 00-2.428-1.12 2.008 2.008 0 00-1.417 2.303 2.6 2.6 0 002.865 1.34zm4.24-2.034c.115-.084.245-.144.383-.176a1.557 1.557 0 011.915.716 1.23 1.23 0 01-.7 1.556 1.774 1.774 0 01-1.993-.965 1.06 1.06 0 01.395-1.13zm-5.813 4.39a1.09 1.09 0 01.747-.13c.883.073.878.723.873 1.377v.149c1.82.14 2.226.42 2.226 1.323a2.322 2.322 0 01-1.106 1.635h-1.292a2.429 2.429 0 01-.7-2.008 13.872 13.872 0 00-.46-.39c-.275-.23-.539-.449-.77-.7a.825.825 0 010-.67 1.09 1.09 0 01.482-.586zm-6.4 13.32a.903.903 0 01.31-.311.951.951 0 011.292.685.638.638 0 010 .265c.087-.11.186-.21.296-.296a.606.606 0 01.856.171c.438.015.864.15 1.23.39a1.246 1.246 0 01.374 1.556 1.853 1.853 0 01-1.868.654 1.853 1.853 0 01-.748-1.37 1.168 1.168 0 01-.498-.607.778.778 0 01-.84.109 1.12 1.12 0 01-.53-.825.904.904 0 01.127-.42zm9.3 11.502c.233 0 .529-.265.575-.498.047-.234-.155-.608-.435-.623a.544.544 0 00-.577.39.81.81 0 00.436.73zm-.05 14.544c.186-.389.824-.436 1.65-.124a.795.795 0 01.576 1.105c-.28.483-1.168.919-1.557.732a1.774 1.774 0 01-.67-1.713zm2.163 8.672c.42-.281.903.015 1.043.529.11.374.14.732-.327.919a1.057 1.057 0 01-1.166-.312 1.073 1.073 0 01-.204-.373 3.21 3.21 0 01.654-.763zm31.225 18.686a1.095 1.095 0 01-.494.073.751.751 0 01-.434-.522.765.765 0 01.154-.661c.218-.187.888-.576 1.183-.358.296.218.156.965 0 1.183a1.093 1.093 0 01-.409.285zm.705 8.106a1.695 1.695 0 00-.514-2.024.948.948 0 00-1.338.343 1.462 1.462 0 00.218 1.915 1.18 1.18 0 001.634-.234zm.39-1.93a1.425 1.425 0 001.147.149 1.417 1.417 0 00.876-.756 1.714 1.714 0 00-.296-2.18 2.056 2.056 0 00-2.241.638 1.419 1.419 0 00.513 2.149zm-34.748-25.407c-.094.031-.327.062-.42-.125a.31.31 0 01.077-.42c.09-.045.164.015.245.082a.93.93 0 00.098.074c.124.077.093.358 0 .389zm.794-3.425c-.748-.561-1.261-.436-1.869.42-.607.856-.529 1.557 0 1.868a2.453 2.453 0 002.335-.342 1.387 1.387 0 00-.466-1.946zm26.805 26.793a2 2 0 01-.028 1.229c-.312.561-1.417.576-2.382-.062a1.353 1.353 0 01-.28-1.557 1.871 1.871 0 011.992-.623c.334.256.578.61.698 1.013zm4.33-2.196a1.56 1.56 0 00-.856-.171c.14-.257.183-.555.125-.841a1.886 1.886 0 00-2.024-1.183c-.592.14-1.043 1.214-.856 2.024a1.381 1.381 0 001.074 1.074 1.56 1.56 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.165 1.165 0 00-.186-1.728zm2.602 8.123c-.066.169-.134.346-.235.346-.203.031-.732.031-.794-.233-.062-.265.327-.592.451-.592.234.059.456.159.654.296-.026.052-.05.117-.076.183zM37.789 94.876c.156-.607.498-1.121 1.23-.934.733.198.657.846.58 1.502l-.004.039c-.27.135-.572.19-.872.156.031.31-.047 1.074-.374 1.183-.326.109-.871-.436-.965-.685a1.058 1.058 0 01.218-.934.56.56 0 01.327-.125c-.054-.062-.1-.13-.14-.202zm.47-5.461a.902.902 0 00.171 1.354 1.106 1.106 0 001.557-.124 1.043 1.043 0 00-.327-1.464.935.935 0 00-1.4.234zm45.032 41.572a.693.693 0 01.252-.258.628.628 0 01.607.264c.041.124-.026.281-.108.472a3.526 3.526 0 00-.125.322c-.106-.06-.219-.111-.322-.158-.216-.097-.394-.177-.394-.293a.698.698 0 01.09-.349zm.377-5.24a.704.704 0 00-.847-.192.704.704 0 00-.243.192c-.327.405-.311 1.199.125 1.339.435.14 1.23.327 1.556-.14.29-.414-.204-.853-.493-1.11l-.064-.058a.704.704 0 01-.034-.031zm9.512 1.51c.607-.202 1.666.218 1.448 1.074a2.55 2.55 0 01-3.083 1.51 2.92 2.92 0 01-.623-.467v-2.802a1.265 1.265 0 011.34.311c.148.115.234.214.3.29.15.17.198.224.618.084zm.218 5.075c-.218-.887-1.168-1.556-1.853-1.385a1.735 1.735 0 00-.623.389v2.273c.423.231.911.313 1.386.233a1.266 1.266 0 001.084-.992c.037-.17.04-.346.006-.518zm-1.775 2.6c.483.125.607.67.327 1.137-.265.404-.514.591-.965.404v-1.541c.21-.039.427-.039.638 0zm-11.645.841a1.559 1.559 0 001.915 0c-.202-1.043-.53-1.557-1.074-1.401-.545.155-.903.716-.84 1.401zm-2.989-2.491a2.33 2.33 0 01.343-1.09 2.006 2.006 0 012.475-.607 1.434 1.434 0 011.417-.95 1.798 1.798 0 011.385 1.37 1.417 1.417 0 01-1.09 1.542.947.947 0 01-.716-.281 2.64 2.64 0 01-.358.857 1.82 1.82 0 01-1.759 1.043v.109a2.008 2.008 0 010 2.101.378.378 0 01.171.094 1.066 1.066 0 01.49.713 1.072 1.072 0 01-.194.844 1.137 1.137 0 01-1.463.404.963.963 0 01-.374-1.214 2.446 2.446 0 01-2.008-.716.844.844 0 01-.078-.125.606.606 0 01-.498.234 1.058 1.058 0 01-.794-.529c-.078-.234.156-1.059.342-1.137.187-.078.514.125.763.358a2.649 2.649 0 01.996-1.557 1.552 1.552 0 011.215-.373 1.822 1.822 0 01-.267-1.047c-.028.248-.425.595-.605.595a.727.727 0 01-.623-.358c-.046-.202.25-.56.42-.607.172-.047.81.078.81.327zm3.503-15.615a.343.343 0 00-.14-.404c-.094 0-.327 0-.374.14a.652.652 0 00-.008.29c.004.033.008.061.008.083a.311.311 0 00.514-.109zm2.11 5.675a1.57 1.57 0 01-1.176-.241c-.716-.374-1.12-1.37-.763-1.9a2.105 2.105 0 012.522-.7 1.569 1.569 0 01-.582 2.841zm22.332 14.688a.82.82 0 00.593-.312.816.816 0 00.154-.653c0-.887-.405-1.432-.825-1.432a1.787 1.787 0 00-1.246 1.354c0 .467.794 1.043 1.324 1.043zm2.257-5.262c.234.919-.124 1.868-.763 2.009-.467.14-1.416-.592-1.557-1.153-.14-.56.483-1.307 1.246-1.463a.786.786 0 01.682.048.788.788 0 01.392.559zm.576-5.635c.134-.208-.076-.645-.263-1.034a9.273 9.273 0 01-.142-.305c0-.082-.128-.124-.295-.178a2.951 2.951 0 01-.281-.102c-.063.15-.176.308-.292.47-.256.357-.524.733-.299 1.086a.963.963 0 001.572.063zm-6.679.965c.032.218.016.809-.249.809-.264.047-.576-.358-.576-.482a2.01 2.01 0 01.312-.639c.062.037.137.059.21.081.145.044.283.086.303.231zm-4.763 11.489c.035.209.109.41.218.592a.947.947 0 00-.53.264c-.22.272-.325.618-.296.965.11.623.576.794 1.744.717a5.12 5.12 0 00.327-.888c.332.146.7.195 1.059.14a2.426 2.426 0 001.556-2.537 1.552 1.552 0 00-.513-.81 2.41 2.41 0 00.186-1.261 1.372 1.372 0 001.697.81 1.717 1.717 0 001.436-1.507 1.713 1.713 0 00-.081-.735 1.807 1.807 0 00-1.993-1.401c-.809.14-1.37 1.292-1.214 2.366a1.401 1.401 0 00-.607-.778 2.99 2.99 0 00-3.114.731 1.964 1.964 0 00.311 2.242 1.838 1.838 0 00-.186 1.09zm-.623-6.414c-.203.389-.452.607-.903.389a1.06 1.06 0 01-.579-1.111c.023-.148.077-.289.159-.414.33-.049.665-.049.996 0a.708.708 0 01.463.481.718.718 0 01-.136.655zm2.942.483a2.199 2.199 0 001.339-2.367 1.602 1.602 0 00-2.962-.028 1.605 1.605 0 00-.011 1.227c.249.872 1.027 1.37 1.634 1.168zm1.03-7.534a.744.744 0 01-.267.263c-.202.047-.545-.264-.592-.436-.046-.171.094-.809.343-.809.249 0 .623.436.623.623a.745.745 0 01-.106.359zm-21.61 14.197c0 .638 1.245 1.245 1.68.918.437-.327 0-1.759-.606-1.806a1.077 1.077 0 00-1.075.888zm-41.707-35.246c-.153.45-.455.835-.856 1.09a.983.983 0 01-.841-.234 1.794 1.794 0 01-1.464-.202 1.557 1.557 0 01-.186-1.822c.12-.376.162-.774.124-1.167a2.348 2.348 0 010-.327h-.109a2.043 2.043 0 01-.87-2.218c.07-.275.197-.533.372-.756.178-.24.421-.424.7-.53a1.338 1.338 0 011.168-1.867c.191-.029.385-.029.576 0 .507.177.722.483.928.777.281.401.546.78 1.516.78a.935.935 0 01.53.731c.342-.373 1.152-.638 1.556 0a2.553 2.553 0 01-.996 3.269 2.575 2.575 0 01-1.806 0 1.787 1.787 0 01-1.448 0l-.186-.155a.67.67 0 010 .171c.082.157.154.318.218.483a1.169 1.169 0 011.058.591c.163.447.169.936.016 1.386zm-2.74 2.382a1.748 1.748 0 00-1.977.06 1.742 1.742 0 00-.468.516 1.401 1.401 0 00-.155 1.043h3.69c.046-.623-.359-.981-1.09-1.619zm5.65-.218c.179.195.307.43.374.685.08.379.122.765.125 1.152h-2.942a1.448 1.448 0 01-.312-.981 1.556 1.556 0 01.748-1.105.952.952 0 01.825-.934 1.01 1.01 0 011.183.731c.03.149.03.303 0 .452zm29.206 25.749a2.209 2.209 0 002.413 1.277 1.595 1.595 0 10-1.198-2.958c.123-.109.224-.241.296-.389a.873.873 0 00-.405-1.277 1.152 1.152 0 00-1.463.405 1.12 1.12 0 00.466 1.432.93.93 0 00.576 0 1.323 1.323 0 00-.685 1.51zm7.771 8.671c-.383.198-.808.418-1.014.296a.976.976 0 01-.382-.806.978.978 0 01.429-.782c.323-.229.687.016 1.043.254.175.118.349.235.513.291-.043.098-.075.2-.104.291-.053.169-.095.301-.176.301-.096.044-.2.098-.308.154v.001zm29.141-.887c-.171-.405.218-.903 1.012-1.308a.793.793 0 011.168.39 1.56 1.56 0 01-.452 1.556 1.769 1.769 0 01-1.728-.638zm-22.48 7.146c-.98-.592-1.868-.576-2.258 0a1.932 1.932 0 00.436 2.039 1.988 1.988 0 002.087-.763.877.877 0 00.147-.696.885.885 0 00-.412-.58zm-12.75-7.566c.133.054.266.095.382.13.184.056.327.099.365.166.017.03-.025.139-.086.302-.163.429-.465 1.227-.194 1.893a2.384 2.384 0 003.118.885c.354-.181.658-.448.883-.776a1.963 1.963 0 00-.172-2.164c-.286-.286-.75-.45-1.13-.584-.323-.113-.586-.206-.629-.335-.031-.094.045-.269.143-.494.192-.444.468-1.081.169-1.67a1.555 1.555 0 00-1.247-.869c.15.013.302.012.453-.003a1 1 0 00.812-.909.996.996 0 00-.065-.429 1.37 1.37 0 00-1.557-1.028 1.356 1.356 0 00-.98 1.557 1.229 1.229 0 001.151.841c-.27.001-.539.048-.793.14a2.951 2.951 0 00-1.308 2.444.959.959 0 00-.779-.218c-.38.15-.698.424-.903.778a24.62 24.62 0 001.09 1.557c.237.037.479.037.716 0a.824.824 0 00.592-1.09.125.125 0 01-.031-.124zm-2.058-3.606a1.82 1.82 0 01-1.056.757 2.143 2.143 0 01-.591.062 65.347 65.347 0 01-3.379-6.772 1.744 1.744 0 011.557 1.355c.1.446.1.908 0 1.354a2.224 2.224 0 012.74-.498 2.1 2.1 0 01.872 2.133.73.73 0 01.14.342 1.82 1.82 0 01-.283 1.267zm25.659 7.513a1.135 1.135 0 00-.436-.918 1.292 1.292 0 001.276-1.199c0-.682-.381-1.081-.606-1.316-.11-.114-.182-.19-.156-.241l.014-.027c.113-.222.594-1.159-.014-1.529a1.558 1.558 0 00-1.043-.25 1.716 1.716 0 00-.857-1.307 1.273 1.273 0 00-.871-.249v3.923c.196.214.216.417.236.627.032.322.065.661.744 1.085.194.117.404.206.623.265-.278.067-.518.24-.67.483a1.098 1.098 0 00-.215.823 1.098 1.098 0 00.433.733h.187c-.16.307-.204.66-.124.997a.58.58 0 00.14.218 1.32 1.32 0 00-.576 1.432 1.108 1.108 0 001.36.57c.17-.059.323-.158.446-.29a1.463 1.463 0 00.233-1.23h.203a1.37 1.37 0 001.183-1.479 1.82 1.82 0 00-1.51-1.121zm-21.375 1.744a2.711 2.711 0 011.557-1.339 1.571 1.571 0 011.219.229 1.564 1.564 0 01.665 1.048 1.929 1.929 0 01-.654 2.039 1.284 1.284 0 01-.094.327c-.047.066-.1.129-.156.187a34.636 34.636 0 01-2.537-2.491zm39.807-.887a.573.573 0 000 .7.79.79 0 00.825.156c.218-.125.141-.561 0-.763a.608.608 0 00-.825-.093zm14.121-10.309a.99.99 0 01.404.516c.203.545-.373 1.293-1.261 1.744a4.745 4.745 0 01-.08.425c-.046.213-.091.421-.091.618-.552.444-1.17.398-1.759.353-.175-.013-.347-.026-.514-.026a.717.717 0 01-.389-1.261 20.077 20.077 0 011.697-1.152c.202-1.043.467-1.37 1.354-1.37a.994.994 0 01.639.153zm-5.558-1.57s-.327.389-.28.514c.046.125.389.576.653.529.265-.046.312-.622.249-.716a1.055 1.055 0 00-.622-.327zm-25.084 18.02c0-.097.029-.191.082-.272.186-.312.731-.14.794-.031a.873.873 0 01.217.451l-1.011.125a.5.5 0 01-.081-.273zm28.244-19.374c.374-.498-.592-1.557-1.277-1.557-.685 0-1.276.887-1.058 1.386.218.498 1.977.669 2.335.171zm-14.163.217c.122-.254.339-.449.603-.544a1.556 1.556 0 011.604.856c.124.389-.483 1.246-.981 1.37a1.202 1.202 0 01-1.277-.872 1.074 1.074 0 01.051-.81zm-10.434 12.159a1.806 1.806 0 00-2.367.639 2.116 2.116 0 00-.296 1.074 1.674 1.674 0 00-1.005.805 1.664 1.664 0 00-.131 1.281 2.102 2.102 0 002.366 1.557 2.225 2.225 0 001.557-1.9 1.29 1.29 0 00.358-.358 2.46 2.46 0 00-.483-3.098zm-1.448 6.663c-.25-.28-.405-.622-.25-.825a2.573 2.573 0 011.806-.28c-.499.396-1.018.765-1.556 1.105zm2.475-8.936a.964.964 0 00-.607.432.946.946 0 00-.11.736.899.899 0 00.738.792.905.905 0 00.384-.014 1.087 1.087 0 00.903-1.229 1.035 1.035 0 00-.504-.633 1.058 1.058 0 00-.804-.084zm1.885 4.474c.233-.382.582-.678.995-.846a2.119 2.119 0 011.588-1.65c.19-.04.386-.04.576 0a36.783 36.783 0 01-3.456 3.767c-.039-.445.065-.89.297-1.271zm1.275-6.669c-.404-.529-.84-1.043-1.556-.591-.717.451-.468 1.012-.125 1.557a1.204 1.204 0 001.681-.966zm-1.276 3.441c-.031-.218.233-.95.623-.856a.882.882 0 01.591.762.842.842 0 01-.576.592.789.789 0 01-.638-.498zM48.469 56.236c.124.078.093.39 0 .39a.358.358 0 01-.514-.11.311.311 0 01.171-.42c.093-.047.17.011.254.076.028.022.057.045.089.064zm-5.154 5.511c-.34.133-.617.389-.778.716h3.27a2.382 2.382 0 00-2.492-.716zm5.574.467c-.42.125-.7-.311-.7-.467a.794.794 0 01.342-.607c.062-.062.467.031.514.233.006.028.015.06.026.098.067.237.181.635-.182.743zm-14.89 57.962c.329-.39.793-.641 1.299-.703a1.933 1.933 0 011.557 1.915 3.114 3.114 0 01-.965 1.728c.28.244.494.554.622.903.12.557.03 1.138-.249 1.635a60.352 60.352 0 01-2.74-4.079 2.025 2.025 0 01.476-1.399zm-6.5-19.898c-.016-.218.015-.81.295-.81.327-.062.607.405.607.561a.748.748 0 01-.436.56c-.202.062-.451-.093-.466-.311zM39.5 126.759a1.12 1.12 0 00.56 2.148 1.337 1.337 0 00.701-1.556 1.045 1.045 0 00-1.261-.592zm-9.496-65.806c.294.122.576.274.84.452a1.417 1.417 0 01.608 1.105h-2.117l.15-.354c.168-.401.339-.807.519-1.203zm1.728-1.277c.623.265 1.059-.077 1.37-.7l-.066-.126c-.24-.465-.49-.947-1.133-.761a1.169 1.169 0 00-.576.84.872.872 0 00.405.747zm8.593 62.907a1.703 1.703 0 01-.218-.592 1.838 1.838 0 01.187-1.09 1.963 1.963 0 01-.311-2.242 2.995 2.995 0 013.114-.731c.29.177.505.454.607.778-.156-1.074.404-2.226 1.214-2.366a1.804 1.804 0 011.993 1.401 1.71 1.71 0 01-.666 1.971 1.718 1.718 0 01-.689.271 1.372 1.372 0 01-1.697-.81c.052.43-.012.865-.186 1.261.252.209.431.493.513.81a2.428 2.428 0 01-1.556 2.537 1.913 1.913 0 01-1.06-.14 5.15 5.15 0 01-.326.888c-1.168.077-1.635-.094-1.744-.717-.03-.347.077-.693.296-.965a.947.947 0 01.53-.264zM32.784 83.58a1.698 1.698 0 00-.514-2.024.951.951 0 00-1.339.343 1.464 1.464 0 00.218 1.914 1.183 1.183 0 001.635-.233zm.947-1.733a1.418 1.418 0 01-.558-.198 1.416 1.416 0 01-.514-2.148 2.055 2.055 0 012.242-.638 1.712 1.712 0 01.296 2.18 1.418 1.418 0 01-1.466.804zm-3.376-4.432a1.556 1.556 0 00-.856-.171c.139-.257.183-.555.125-.841A1.884 1.884 0 0027.6 75.22c-.592.14-1.043 1.214-.856 2.024a1.386 1.386 0 001.074 1.074 1.556 1.556 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.168 1.168 0 00-.187-1.728zm.537 10.57c.022-.385.14-.76.343-1.09a2.008 2.008 0 012.475-.606 1.432 1.432 0 011.417-.95 1.79 1.79 0 011.385 1.37 1.416 1.416 0 01-1.09 1.541.949.949 0 01-.716-.28 2.644 2.644 0 01-.358.856 1.821 1.821 0 01-1.759 1.043v.11a2.008 2.008 0 010 2.101.373.373 0 01.171.093 1.072 1.072 0 01.296 1.557 1.137 1.137 0 01-1.463.405.965.965 0 01-.374-1.214 2.444 2.444 0 01-2.008-.717.871.871 0 01-.078-.124.607.607 0 01-.498.234 1.06 1.06 0 01-.794-.53c-.078-.233.156-1.058.342-1.136.187-.078.514.124.763.358a2.646 2.646 0 01.997-1.557 1.554 1.554 0 011.214-.374 1.82 1.82 0 01-.266-1.046c-.03.248-.426.595-.606.595a.732.732 0 01-.623-.358c-.046-.203.25-.56.42-.607.172-.047.81.078.81.327zm9.178-14.29a1.57 1.57 0 001.759-2.6 2.102 2.102 0 00-2.522.7c-.358.53.047 1.526.763 1.9z",fill:"#EA9600"}));var Yv=a(657);a(524);const Qv={id:"lnsGeoFieldWorkspace",humanData:{label:u.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},Kv=[1,0,0,0];function Zv(e){return Object(v.jsx)("div",{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(v.jsx)(f.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(v.jsx)("div",null,Object(v.jsx)("h2",null,Object(v.jsx)("strong",null,Object(Ct.getVisualizeGeoFieldMessage)(e.fieldType))),Object(v.jsx)(Xv,{"aria-hidden":!0,className:"lnsWorkspacePanel__promptIllustration"}),Object(v.jsx)(Yv.a,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",dropTypes:["field_add"],order:Kv,value:Qv,onDrop:function(){e.uiActions.getTrigger(Ih.VISUALIZE_GEO_FIELD_TRIGGER).exec({dataViewSpec:e.indexPattern.spec,fieldName:e.fieldName,originatingApp:Wt.APP_ID})}},Object(v.jsx)("p",null,Object(v.jsx)("strong",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"})))))))}const Jv=[1e-5,1e-4,.001,.01,.1,1];function ey({state:e,setState:t,layerId:a}){const n=!ub(e.layers[a]),i=n?Jv[Jv.length-1]:e.layers[a].sampling;return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{display:"rowCompressed","data-test-subj":"lns-indexPattern-random-sampling-row",fullWidth:!0,helpText:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.randomSampling.help",defaultMessage:"Lower sampling percentages increases the performance, but lowers the accuracy. Lower sampling percentages are best for large datasets. {link}",values:{link:Object(v.jsx)(f.EuiLink,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/master/search-aggregations-random-sampler-aggregation.html",target:"_blank",external:!0},Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.randomSampling.learnMore",defaultMessage:"View documentation"}))}}))),label:Object(v.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.randomSampling.label",{defaultMessage:"Sampling"})," ",Object(v.jsx)(M.d,null))},Object(v.jsx)(Hv,{disabled:n,disabledReason:u.i18n.translate("xpack.lens.indexPattern.randomSampling.disabledMessage",{defaultMessage:"In order to select a reduced sampling percentage, you must remove any maximum or minimum functions applied on this layer."}),values:Jv,currentValue:i,"data-test-subj":"lns-indexPattern-random-sampling-slider",onChange:n=>{n<1&&Object(d.d)("apply_random_sampling"),t({...e,layers:{...e.layers,[a]:{...e.layers[a],sampling:n}}})}})),Object(v.jsx)(Ul,{checked:!e.layers[a].ignoreGlobalFilters,onChange:()=>{const n={...e.layers[a],ignoreGlobalFilters:!e.layers[a].ignoreGlobalFilters},i={...e.layers};i[a]=n,Object(d.d)(n.ignoreGlobalFilters?"ignore_global_filters":"use_global_filters"),t({...e,layers:i})}}))}const ty=k()((e=>e.flatMap((e=>{var t,a,n;return null!==(t=Rf[e.operationType])&&void 0!==t&&t.getCurrentFields?(null===(a=Rf[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))||[]:"sourceField"in e?e.sourceField:void 0})).filter(Ct.nonNullable)),pa.isEqual);function ay(e,t){if("string"===e.dataType){var a;const n="sourceField"in e?null==t||null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.esTypes:void 0;return(null==n?void 0:n[0])||void 0}if(ip("last_value",e))return e.dataType}const ny=({prevState:e,layerId:t,columnId:a,indexPatterns:n})=>{var i;const s=null==n?void 0:n[null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId];if(!s)throw new Error("indexPatterns is not passed to the function");return sb({state:e,layerId:t,newLayer:Rp({layer:e.layers[t],columnId:a,indexPattern:s})})};function iy(e,t,a){const{dataType:n,label:i,isBucketed:s,scale:l,operationType:r,timeShift:o,reducedTimeRange:u}=e;return{dataType:(c=n,"histogram"===c||"document"===c?"number":c),isBucketed:s,scale:l,label:t||i,isStaticValue:"static_value"===r,sortingHint:ay(e,a),hasTimeShift:Boolean(o),hasReducedTimeRange:Boolean(u),interval:ip("date_histogram",e)?e.params.interval:void 0};var c}function sy({core:e,storage:t,data:a,unifiedSearch:n,share:s,dataViews:r,fieldFormats:o,charts:c,dataViewFieldEditor:d,uiActions:p}){const{uiSettings:m}=e,g="formBased",b=["indexpattern"],h={id:g,alias:b,initialize:(e,a,n,i,s)=>function({persistedState:e,references:t,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s=[],indexPatterns:l={}}){const r=function({persistedState:e,references:t}){return e&&t?Kf(e,t):void 0}({persistedState:e,references:t}),{usedPatterns:o,allIndexPatternIds:u}=function({state:e,indexPatternRefs:t,storage:a,initialContext:n,defaultIndexPatternId:i}){var s;const l=Xf(a,t)||i||(null===(s=t[0])||void 0===s?void 0:s.id),r=[];return n&&("isVisualizeAction"in n?r.push(...n.indexPatternIds):r.push(n.dataViewSpec.id)),{usedPatterns:(n?r:Object(pa.uniq)(e?Object.values(e.layers).map((e=>e.indexPatternId)):[l])).filter(Boolean),allIndexPatternIds:r}}({state:r,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s}),c=new Set(s.map((({id:e})=>e))),d=Object(pa.difference)([...c],o),p=[...u,...o,...d].find((e=>null!=e&&c.has(e)&&l[e]));return p&&Yf(n,p),{layers:{},...r,currentIndexPatternId:p}}({persistedState:e,references:a,defaultIndexPatternId:m.get("defaultIndex"),storage:t,initialContext:n,indexPatternRefs:i,indexPatterns:s}),getPersistableState:e=>function({layers:e}){const t=[],a={layers:{}};return Object.entries(e).forEach((([e,{indexPatternId:n,...i}])=>{a.layers[e]=i,t.push({type:"index-pattern",id:n,name:Qf(e)})})),{savedObjectReferences:t,state:a}}(e),insertLayer:(e,t,a)=>({...e,layers:{...e.layers,[t]:ly(e.currentIndexPatternId,a)}}),createEmptyLayer:e=>({currentIndexPatternId:e,layers:{}}),cloneLayer:(e,t,a,n)=>({...e,layers:vb(e.layers,t,a,n)}),removeLayer(e,t){const a={...e.layers};delete a[t];const n=[t];return Object.keys(a).forEach((e=>{var i;const s=null===(i=a[e])||void 0===i?void 0:i.linkToLayers;s&&s.includes(t)&&(delete a[e],n.push(e))})),{removedLayerIds:n,newState:{...e,layers:a}}},clearLayer(e,t){var a;const n={...e.layers},i=[];return Object.keys(n).forEach((e=>{var a;const s=null===(a=n[e])||void 0===a?void 0:a.linkToLayers;s&&s.includes(t)&&(delete n[e],i.push(e))})),{removedLayerIds:i,newState:{...e,layers:{...n,[t]:ly(e.currentIndexPatternId,null===(a=e.layers[t])||void 0===a?void 0:a.linkToLayers)}}}},getLayers:e=>Object.keys(null==e?void 0:e.layers),removeColumn:ny,initializeDimension(e,t,a,{columnId:n,groupId:i,staticValue:s,autoTimeField:l,visualizationGroups:r}){var o;const u=a[null===(o=e.layers[t])||void 0===o?void 0:o.indexPatternId];let c=e;return null!=s&&(c=sb({state:e,layerId:t,newLayer:Mp({layer:e.layers[t],op:"static_value",columnId:n,field:void 0,indexPattern:u,visualizationGroups:r,initialParams:{params:{value:s}},targetGroup:i})})),l&&u.timeFieldName&&(c=sb({state:e,layerId:t,newLayer:Mp({layer:e.layers[t],op:"date_histogram",columnId:n,field:u.fields.find((e=>e.name===u.timeFieldName)),indexPattern:u,visualizationGroups:r,targetGroup:i})})),c},syncColumns({state:e,links:t,indexPatterns:a,getDimensionGroups:n}){let i=e.layers;t.forEach((e=>{var t,s;const l={...e.from,dataView:a[null===(t=i[e.from.layerId])||void 0===t?void 0:t.indexPatternId],filterOperations:()=>!0},r={...e.to,dataView:a[null===(s=i[e.to.layerId])||void 0===s?void 0:s.indexPatternId],filterOperations:()=>!0};i=yp({layers:i,target:r,source:l});const o=Sp(n(r.layerId),Np(i[r.layerId]),r.groupId,r.columnId);i={...i,[r.layerId]:{...i[r.layerId],columnOrder:o,columns:i[r.layerId].columns}}}));const s=lb({state:e,newLayers:i});return t.filter((e=>ip("terms",s.layers[e.from.layerId].columns[e.from.columnId]))).forEach((({from:e,to:a})=>{const n=s.layers[e.layerId].columns[e.columnId];if("column"===n.params.orderBy.type){const e=n.params.orderBy.columnId,i=t.find((({from:{columnId:t}})=>t===e));i&&(s.layers[a.layerId].columns[a.columnId].params.orderBy={type:"column",columnId:i.to.columnId})}})),s},getSelectedFields(e){var t;return ty(null===(t=Object.values(null==e?void 0:e.layers))||void 0===t?void 0:t.flatMap((e=>Object.values(e.columns))))},toExpression:(e,t,a,n,i,s)=>function(e,t,a,n,i,s,l){return e.layers[t]?function(e,t,a,n,i,s){const{columnOrder:l}=e;if(0===l.length||!t)return null;const r={...e.columns};jb(l.map((e=>[e,r[e]]))).forEach((e=>{const t=r[e],a=Rf[t.operationType];if("references"in t&&a.filterable&&t.filter){function n(e){"references"in e&&e.references.forEach((e=>{let a=r[e];const i=a.filter;Rf[t.operationType].filterable&&!i&&(a={...a,filter:t.filter},r[e]=a),i||n(a)}))}n(t)}if("references"in t&&a.shiftable&&t.timeShift){function i(e){"references"in e&&e.references.forEach((e=>{let a=r[e];const n=a.timeShift;Rf[t.operationType].shiftable&&!n&&(a={...a,timeShift:t.timeShift},r[e]=a),n||i(a)}))}i(t)}}));const o=l.map((e=>[e,r[e]])),[u,c]=Object(pa.partition)(o,(([,e])=>{var t,a;return"fullReference"===(null===(t=Rf[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(a=Rf[e.operationType])||void 0===a?void 0:a.input)})),d=o.find((([,e])=>"date_histogram"===e.operationType)),p=Boolean(d);if(u.length||c.length){let l=[];const m=[],g=a.get(Fl.UI_SETTINGS.HISTOGRAM_BAR_TARGET);jb(u).forEach((a=>{const s=r[a],l=Rf[s.operationType];"fullReference"!==l.input&&"managedReference"!==l.input||m.push(...l.toExpression(e,a,t,{dateRange:n,now:i,targetBars:g}))}));const f=c.map((([e])=>e));let b={};const h=Object(Ct.convertToAbsoluteDateRange)(n,i),v=new Map;c.forEach((([n,i],s)=>{const r=Rf[i.operationType];if("fullReference"!==r.input&&"managedReference"!==r.input){var o;const u=String(s),c=Boolean(r.filterable&&(null===(o=i.filter)||void 0===o?void 0:o.query)),d=r.canReduceTimeRange&&!p&&i.reducedTimeRange&&t.timeFieldName;let m=r.toEsAggsFn({...i,timeShift:yd(i.timeShift,h,g,p)},c||d?`${u}-metric`:u,t,e,a,f,Rf);(c||d)&&(m=Object(Ut.buildExpressionFunction)("aggFilteredMetric",{id:String(s),enabled:!0,schema:"metric",customBucket:Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("aggFilter",{id:`${s}-filter`,enabled:!0,schema:"bucket",filter:i.filter&&Object(An.queryToAst)(i.filter),timeWindow:d?i.reducedTimeRange:void 0,timeShift:yd(i.timeShift,h,g,p)})]),customMetric:Object(Ut.buildExpression)({type:"expression",chain:[m]}),timeShift:yd(i.timeShift,h,g,p)}).toAst());const y=Object(Ut.buildExpression)({type:"expression",chain:[m]});l.push(y);const x=window.ELASTIC_LENS_DELAY_SECONDS?`col-${s+(i.isBucketed?0:1)}-${u}`:`col-${s}-${u}`;b[x]=[{...i,id:n,label:i.customLabel?i.label:Rf[i.operationType].getDefaultLabel(i,e.columns,t)}],v.set(y,x)}})),window.ELASTIC_LENS_DELAY_SECONDS&&l.push(Object(Ut.buildExpression)({type:"expression",chain:[Object(Ut.buildExpressionFunction)("aggShardDelay",{id:"the-delay",enabled:!0,schema:"metric",delay:`${window.ELASTIC_LENS_DELAY_SECONDS}s`}).toAst()]}));const y=Object(pa.uniq)(c.map((([e,t])=>Rf[t.operationType]))),x=function(e,t,a,n){let i=[...e];const s={...t},l=ig(i,(e=>{for(const a of n){var t;const n=null===(t=a.getGroupByKey)||void 0===t?void 0:t.call(a,e);if(n)return`${a.type}-${n}`}})),r=i.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(l).forEach((e=>{if(e.length<=1)return;const[t,...n]=e;i=i.filter((e=>!n.includes(e)));const l=a.get(t);if(void 0===l)throw new Error("Could not find current column ID for expression builder");n.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for expression builder");s[l].push(...s[t]),delete s[t],r.forEach((e=>{var a;(null===(a=e.getArgument("orderBy"))||void 0===a?void 0:a[0])===yb(t)&&e.replaceArgument("orderBy",[yb(l)])}))}))})),{aggs:i,esAggsIdMap:s}}(l,b,v,y);l=x.aggs,b=x.esAggsIdMap,y.forEach((e=>{var t;const a=null===(t=e.optimizeEsAggs)||void 0===t?void 0:t.bind(e);if(a){const{aggs:e,esAggsIdMap:t}=a(l,b,v);l=e,b=t}}));const j={};let O=0;const I=Object.keys(b);l.forEach((e=>{var t;const a=null===(t=e.functions[0].getArgument("id"))||void 0===t?void 0:t[0];I.filter((e=>yb(e)===a)).forEach((e=>{const t=b[e][0],a=window.ELASTIC_LENS_DELAY_SECONDS?O+(t.isBucketed?0:1):O,n=xb(e,a);j[n]=b[e],O++}))}));const M=o.filter((([,e])=>{var t,a;return ip("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||lp(e)&&(null===(a=e.params)||void 0===a?void 0:a.format)})).map((([e,t])=>{var a;const n="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(a=i.params)||void 0===a?void 0:a.decimals)?[i.params.decimals]:[],suffix:null!=i&&i.params&&"suffix"in i.params&&i.params.suffix?[i.params.suffix]:[],compact:null!=i&&i.params&&"compact"in i.params&&i.params.compact?[i.params.compact]:[],pattern:null!=i&&i.params&&"pattern"in i.params&&i.params.pattern?[i.params.pattern]:[],fromUnit:null!=i&&i.params&&"fromUnit"in i.params&&i.params.fromUnit?[i.params.fromUnit]:[],toUnit:null!=i&&i.params&&"toUnit"in i.params&&i.params.toUnit?[i.params.toUnit]:[],parentFormat:n?[JSON.stringify(n)]:[]}}})),T=o.filter((([,e])=>e.timeScale&&Rf[e.operationType].timeScalingMode&&"disabled"!==Rf[e.operationType].timeScalingMode)).flatMap((([a,n])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:null!=d&&d.length?[d[0]]:[],inputColumnId:[a],outputColumnId:[a],outputColumnName:[n.customLabel?n.label:Rf[n.operationType].getDefaultLabel(n,e.columns,t)],targetUnit:[n.timeScale],reducedTimeRange:n.reducedTimeRange?[n.reducedTimeRange]:[]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[a],parentFormat:[JSON.stringify({id:"suffix",params:{unit:n.timeScale}})]}}]));if(0===c.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...m,...M,...T]};const w=Object.values(r).map((e=>ip("date_histogram",e)&&!e.params.ignoreTimeRange?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[{type:"function",function:"kibana",arguments:{}},Object(Ut.buildExpressionFunction)("esaggs",{index:Object(Ut.buildExpression)([Object(Ut.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:l,metricsAtAllLevels:!1,partialRows:!1,timeFields:w,probability:cb(e),samplerSeed:eb()(s).int32(),ignoreGlobalFilters:Boolean(e.ignoreGlobalFilters)}).toAst(),{type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(j)]}},...m,...M,...T]}}return null}(e.layers[t],a[e.layers[t].indexPatternId],n,i,s,l):null}(e,t,a,m,n,i,s),LayerSettingsComponent:e=>Object(v.jsx)(ey,e),DataPanelComponent(t){var n;const{onChangeIndexPattern:s,...l}=t,u=null==h||null===(n=h.getSelectedFields)||void 0===n?void 0:n.call(h,t.state);return Object(v.jsx)(Tv,i()({data:a,dataViews:r,fieldFormats:o,charts:c,indexPatternFieldEditor:d},l,{core:e,uiActions:p,onIndexPatternRefresh:Wf,layerFields:u}))},uniqueLabels(e,t){const a=e.layers,n={},i=Object(Ct.getUniqueLabelGenerator)();return Object.values(a).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([a,s])=>{n[a]=i(s.customLabel?s.label:Rf[s.operationType].getDefaultLabel(s,e.columns,t[e.indexPatternId]))}))})),n},DimensionTriggerComponent:e=>{const t=(a=h.uniqueLabels(e.state,e.indexPatterns)[e.columnId])?a.replace(/\./g,".â€‹"):"";var a;return Object(v.jsx)(di.a,{id:e.columnId,label:t})},DimensionEditorComponent:s=>{const l=h.uniqueLabels(s.state,s.indexPatterns);return Object(v.jsx)(gh,i()({uiSettings:m,storage:t,fieldFormats:o,http:e.http,data:a,unifiedSearch:n,dataViews:r,uniqueLabel:l[s.columnId],notifications:e.notifications},s))},LayerPanelComponent:e=>{const{onChangeIndexPattern:t,...a}=e;return Object(v.jsx)(Wv,i()({onChangeIndexPattern:a=>{!function({state:e,layerId:t,uiActions:a,indexPatternId:n}){var i;const s=null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId;if(!s)return;const l=n,r=a.getTrigger(_o.UPDATE_FILTER_REFERENCES_TRIGGER),o=a.getAction(_o.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:s,toDataView:l,defaultDataView:l,usedDataViews:Object.values(Object.values(e.layers).map((e=>e.indexPatternId)))})}({indexPatternId:a,state:e.state,layerId:e.layerId,uiActions:p}),t(a,g,e.layerId)}},a))},getDropProps:yh,onDrop:xh,getCustomWorkspaceRenderer:(e,t,a)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const n=a[t.indexPatternId],i=t,s=i.field.esTypes&&i.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return s?()=>Object(v.jsx)(Zv,{uiActions:p,fieldType:s,indexPattern:n,fieldName:i.field.name}):void 0},updateCurrentIndexPatternId:({state:e,indexPatternId:t,setState:a})=>{a({...e,currentIndexPatternId:t})},onRefreshIndexPattern:Wf,onIndexPatternChange:(e,a,n,i)=>i?function({indexPatternId:e,indexPatterns:t,layerIds:a,state:n,replaceIfPossible:i,storage:s}){Yf(s,e);const l={...n.layers};return a.forEach((a=>{l[a]=Vp(n.layers[a],t[e])})),{...n,layers:l,currentIndexPatternId:i?e:n.currentIndexPatternId}}({indexPatternId:n,layerIds:[i,...Object.entries(e.layers).map((([e,t])=>{var a;return null!==(a=t.linkToLayers)&&void 0!==a&&a.includes(i)?e:""})).filter(Boolean)],state:e,replaceIfPossible:!0,storage:t,indexPatterns:a}):function({indexPatternId:e,state:t,storage:a,indexPatterns:n}){return Yf(a,e),{...t,layers:Zf(t.layers)?Object(pa.mapValues)(t.layers,(t=>Vp(t,n[e]))):t.layers,currentIndexPatternId:e}}({indexPatternId:n,state:e,storage:t,indexPatterns:a}),onIndexPatternRename:(e,t,a)=>function({oldIndexPatternId:e,newIndexPatternId:t,state:a}){return{...a,layers:Object(pa.mapValues)(a.layers,(a=>a.indexPatternId===e?{...a,indexPatternId:t}:a)),currentIndexPatternId:a.currentIndexPatternId===e?t:e}}({state:e,oldIndexPatternId:t,newIndexPatternId:a}),getRenderEventCounters(e){var t;const a={time_shift:!1,filter:!1};return[...Object(pa.flatten)(Object.values(null!==(t=null==e?void 0:e.layers)&&void 0!==t?t:{}).map((e=>Object.values(e.columns).map((e=>(e.timeShift&&(a.time_shift=!0),e.filter&&(a.filter=!0),e.operationType)))))),...Object.entries(a).reduce(((e,[t,a])=>(a&&e.push(t),e)),[])].map((e=>`dimension_${e}`))},updateStateOnCloseDimension:({state:e,layerId:t})=>{const a=e.layers[t];if(Object.values(a.incompleteColumns||{}).length)return sb({state:e,layerId:t,newLayer:{...a,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t,indexPatterns:a}){const n=h.uniqueLabels(e,a),i=e.layers[t],s=i.columnOrder.filter((e=>!Gp(i,e)));return{datasourceId:g,datasourceAliasIds:b,getTableSpec:()=>{const e={};return Object.keys(i.columns).forEach((t=>{const a=$p(i,t);e[a]=e[a]||[];const n=i.columns[t];var s;ip("terms",n)&&e[a].push(...[n.sourceField].concat(null!==(s=n.params.secondaryFields)&&void 0!==s?s:[])),"sourceField"in n&&n.sourceField!==Wt.DOCUMENT_FIELD_NAME&&e[a].push(n.sourceField)})),s.map(((t,a)=>({columnId:t,fields:[...new Set(e[t]||[])]})))},isTextBasedLanguage:()=>!1,getOperationForColumnId:e=>i&&i.columns[e]&&!Gp(i,e)?iy(i.columns[e],n[e],a[i.indexPatternId]):null,getSourceId:()=>i.indexPatternId,getFilters:(e,n)=>function(e,t,a,n,i){const s=function(e,t){const a=Object.keys(e.columns).filter((t=>{const a=e.columns[t],n=Rf[null==a?void 0:a.operationType];return!(null!=a&&a.isBucketed)&&!ip("formula",a)&&(null==n?void 0:n.filterable)})),{filtered:n=[],unfiltered:i=[]}=Object(pa.groupBy)(a,(t=>{var a;return null!==(a=e.columns[t])&&void 0!==a&&a.filter?"filtered":"unfiltered"})),s=n.map((t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.filter})).filter((e=>{var t;return null==e||null===(t=e.query)||void 0===t?void 0:t.trim()}));return{enabled:i.length?[]:s,disabled:i.length?s:[]}}(e),[l,r]=["enabled","disabled"].map((e=>Object(pa.groupBy)(s[e],"language"))),o=t.map((t=>{const s=e.columns[t];if(ip("filters",s)){const e=Object(pa.groupBy)(s.params.filters,(({input:e})=>e.language));return{kuery:mb(e.kuery),lucene:mb(e.lucene)}}return ip("range",s)&&s.sourceField?{kuery:gb(s)}:ip("date_histogram",s)&&i&&s.sourceField&&!s.params.ignoreTimeRange&&n.timeFieldName!==s.sourceField?n.timeFieldName?{error:u.i18n.translate("xpack.lens.indexPattern.nonDefaultTimeFieldError",{defaultMessage:'"Explore data in Discover" does not support date histograms on non-default time fields if time field is set on the data view'})}:{kuery:fb(s,i)}:!ip("terms",s)||s.params.otherBucket||s.params.missingBucket?void 0:!a||function(e,t){var a;const n=null==e||null===(a=e.columns.find((({id:e})=>Object(A.a)(e)===t)))||void 0===a?void 0:a.id;return!n||n!==t}(a,t)?{kuery:Rf[s.operationType].getCurrentFields(s).map((e=>({query:`"${e}": *`,language:"kuery"})))}:{kuery:bb(s,t,a)}})).filter(Boolean),c=o.filter((e=>e&&"error"in e));if(c.length)return{error:c.map((({error:e})=>e)).join(", ")};const d=o;return{enabled:{kuery:hb(l,d,"kuery"),lucene:hb(l,d,"lucene")},disabled:{kuery:[r.kuery||[]].filter((e=>e.length)),lucene:[r.lucene||[]].filter((e=>e.length))}}}(i,s,null==e?void 0:e[t],a[i.indexPatternId],n),getVisualDefaults:()=>function(e){return Object.keys(e.columns).reduce(((t,a)=>{const n=e.columns[a];if(null!=n&&n.operationType){var i;const e=Rf[n.operationType],s=null===(i=e.getDefaultVisualSettings)||void 0===i?void 0:i.call(e,n);s&&(t[a]=s)}return t}),{})}(i),getMaxPossibleNumValues:e=>{if(i&&i.columns[e]){var t,a,n;const s=i.columns[e];return null!==(t=null===(a=(n=Rf[s.operationType]).getMaxPossibleNumValues)||void 0===a?void 0:a.call(n,s))&&void 0!==t?t:null}return null},hasDefaultTimeField:()=>Boolean(a[i.indexPatternId].timeFieldName)}},getDatasourceSuggestionsForField:(e,t,a,n)=>Object(Ct.isDraggedDataViewField)(t)?function(e,t,a,n,i){let s=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t));if(i&&(s=s.filter(i)),0===s.length){const i=Object(kt.a)();return Nv(e,i,t,a,n).concat(Nv({...e,layers:{}},i,t,a,n))}{const i=Object(pa.minBy)(s,(t=>e.layers[t].columnOrder.length));return 0===e.layers[i].columnOrder.length?Nv(e,i,t,a,n):function(e,t,a,n){const i=e.layers[t],s=n[i.indexPatternId],l=$f(a),r=Rv(a),o=Object.values(i.columns).some((e=>Zd(e)&&e.sourceField===a.name)),u=[];if(r&&!o)if("date_histogram"===r&&i.columnOrder.some((e=>"date_histogram"===i.columns[e].operationType))){const n=i.columnOrder.find((e=>"date_histogram"===i.columns[e].operationType));u.push(Cv({state:e,updatedLayer:wp({layer:i,indexPattern:s,field:a,op:r,columnId:n,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else u.push(Cv({state:e,updatedLayer:Mp({layer:i,indexPattern:s,field:a,op:r,columnId:Object(kt.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!r&&l.length>0&&!o){const[n]=Pp(a);if(n){const l=Mp({layer:i,indexPattern:s,field:a,columnId:Object(kt.a)(),op:n.type,visualizationGroups:[]});l&&u.push(Cv({state:e,layerId:t,updatedLayer:l,changeType:"extended"}));const[,r,o]=Bp(i);if(1===r.length&&0===o.length){const l=wp({layer:i,indexPattern:s,field:a,columnId:r[0],op:n.type,visualizationGroups:[]});l&&u.push(Cv({state:e,layerId:t,updatedLayer:l,changeType:"extended"}))}}}if(!o){const n=zv(s,t,e,a);n&&u.push(n)}return u}(e,i,a,n)}}(e,t.indexPatternId,t.field,n,a):[],getDatasourceSuggestionsFromCurrentState:Bv,getDatasourceSuggestionsForVisualizeField:Dv,getDatasourceSuggestionsForVisualizeCharts:Fv,getUserMessages(t,{frame:n,setState:i,visualizationInfo:s}){if(!t)return[];const r=function(e,t,a,n,i){const s=t.dataViews.indexPatterns,r=Object.entries(e.layers).filter((([e,t])=>!!s[t.indexPatternId])).map((([r,o])=>{var u;return(null!==(u=function(e,t,a,n,i,s){const l=Object.entries(e.columns),r=l.filter((([t,a])=>!Gp(e,t)&&"managedReference"===Rf[a.operationType].input)).flatMap((([t])=>Kp(t,e.columns).map((([e])=>e)))),o=l.flatMap((([a,n])=>{if(r.includes(a))return;const l=Rf[n.operationType];if(l.getErrorMessage){const n=s.query.timefilter.timefilter.getAbsoluteTime();return l.getErrorMessage(e,a,t,{fromDate:n.from,toDate:n.to},Rf,i.uiSettings.get(Fl.UI_SETTINGS.HISTOGRAM_BAR_TARGET))}})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...a,layers:{...a.layers,[n]:await e.fixAction.newState(s,i,t,n)}})}:void 0})).filter((e=>null!=e));return o.length?o:void 0}(o,s[o.indexPatternId],e,r,n,i))&&void 0!==u?u:[]).map((e=>{var n;return{uniqueId:"string"==typeof e?e:e.uniqueId,severity:"error",fixableInEditor:!0,displayLocations:"string"!=typeof e&&e.displayLocations?e.displayLocations:[{id:"visualization"}],shortMessage:"",longMessage:"string"==typeof e?e:Object(v.jsx)(l.a.Fragment,null,e.message,e.fixAction&&Object(v.jsx)(f.EuiButton,{"data-test-subj":"errorFixAction",onClick:async()=>{var n;const i=await(null===(n=e.fixAction)||void 0===n?void 0:n.newState(t));i&&a(i)}},null===(n=e.fixAction)||void 0===n?void 0:n.label))}}))}));let o;var c;return o=r.length<=1?null!==(c=r[0])&&void 0!==c&&c.length?r[0]:[]:r.flatMap(((e,t)=>e.map((e=>e.displayLocations.find((e=>"visualization"===e.id))?{...e,shortMessage:u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:e.shortMessage}}),longMessage:Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.layerErrorWrapper",defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:Object(v.jsx)(l.a.Fragment,null,e.longMessage)}})}:e)))),o}(t,n,i,e,a),o=function(e,t,a){return Object.keys(e.layers).map((n=>{const i=[];for(const s of Object.keys(e.layers[n].columns))Object(Wo.a)(t,"dimensionButton",{dimensionId:s}).length>0||a(n,s)&&i.push({uniqueId:Ft.j,severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:s}],fixableInEditor:!0,shortMessage:"",longMessage:Object(v.jsx)("p",null,u.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(v.jsx)("br",null),u.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."}))});return i})).flat()}(t,r,((e,a)=>{const i=t.layers[e],s=i.columns[a],l=n.dataViews.indexPatterns[i.indexPatternId];return!(!s||!l)&&function(e,t,a,n,i,s){var l,r,o;const u="references"in t&&function(e,t,a,n,i){var s;return null===(s=t.references)||void 0===s?void 0:s.some((t=>{var s,l,r;const o=null===(s=e.columns[t])||void 0===s?void 0:s.operationType,u=Rf[o];return(null!==(l=null==u||null===(r=u.getErrorMessage)||void 0===r?void 0:r.call(u,e,t,a,n,Rf,i))&&void 0!==l?l:[]).length>0}))}(e,t,n,i,s),c=(null!==(l=null===(r=Rf[t.operationType])||void 0===r||null===(o=r.getErrorMessage)||void 0===o?void 0:o.call(r,e,a,n,i,Rf,s))&&void 0!==l?l:[]).length>0,d=!!t.filter&&!Object(gi.a)(t.filter,n);return c||u||d}(i,s,a,l,n.dateRange,m.get(Fl.UI_SETTINGS.HISTOGRAM_BAR_TARGET))})),c=function(e,t,{activeData:a,dataViews:n}){if(!t)return[];const i=[];return Object.entries(t.layers).forEach((([t,s])=>{const l=n.indexPatterns[s.indexPatternId];if(!l)return;const r=fd(e,s,l,a,t);if(!r.interval)return;const o=r.expression,u=r.interval.asMilliseconds(),c=new Set,d={};Object.entries(s.columns).forEach((([e,t])=>{if(t.isBucketed)return;let a=0;if(t.timeShift&&!Object(An.isAbsoluteTimeShift)(t.timeShift)){const e=Object(An.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;a=e.asMilliseconds()}c.add(a),d[a]||(d[a]=[]),d[a].push(e)})),c.size<2||c.forEach((e=>{0!==e&&(e<u?d[e].forEach((e=>{i.push({uniqueId:Ft.W,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(v.jsx)("strong",null,s.columns[e].label),interval:Object(v.jsx)("strong",null,o),columnTimeShift:Object(v.jsx)("strong",null,s.columns[e].timeShift)}})})})):Number.isInteger(e/u)||d[e].forEach((e=>{i.push({uniqueId:Ft.X,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(v.jsx)($t.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(v.jsx)("strong",null,s.columns[e].label),interval:Object(v.jsx)("strong",null,o),columnTimeShift:Object(v.jsx)("strong",null,s.columns[e].timeShift)}})})})))}))})),i}(a.datatableUtilities,t,n),d=function(e,t,{activeData:a,dataViews:n},i,s){const r=[];return t&&a&&Object.entries(a).reduce(((e,[t,{columns:a}])=>(e.push(...a.map((e=>({layerId:t,column:e})))),e)),[]).forEach((({layerId:a,column:o})=>{const c=t.layers[a],d=null==c?void 0:c.columns[o.id];if(c&&d&&e.hasPrecisionError(o)){const e=n.indexPatterns[c.indexPatternId];if(!e)return;const t=ip("terms",d),p=t&&"column"===d.params.orderBy.type&&"asc"===d.params.orderDirection&&ip("count",c.columns[d.params.orderBy.columnId]),m=t&&!Vm(e.getFieldByName(d.sourceField)),g=t&&(d.params.secondaryFields||[]).length>0;t&&(!p||m||g)?r.push(d.params.accuracyMode?pb(o.name,o.id,i.links.aggs.terms_doc_count_error):db(o.name,o.id,(()=>{s((t=>sb({state:t,layerId:a,newLayer:Xp(_p({layer:c,columnId:o.id,paramName:"accuracyMode",value:!0}),e)})))}))):r.push({uniqueId:Ft.N,severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:o.id}],shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.ascendingCountPrecisionErrorWarning.shortMessage",{defaultMessage:"This may be approximate depending on how the data is indexed. For more precise results, sort by rarity."}),longMessage:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try sorting by rarity instead of ascending count of records. To learn more about this limit, {link}.",values:{name:Object(v.jsx)("strong",null,o.name),link:Object(v.jsx)(f.EuiLink,{href:i.links.aggs.rare_terms,target:"_blank",external:!0},Object(v.jsx)($t.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning.link"}))}}),Object(v.jsx)(f.EuiSpacer,{size:"s"}),Object(v.jsx)(f.EuiLink,{onClick:()=>{s((t=>sb({state:t,layerId:a,newLayer:Xp(_p({layer:c,columnId:o.id,paramName:"orderBy",value:{type:"rare",maxDocCount:lm}}),e)})))}},u.i18n.translate("xpack.lens.indexPattern.switchToRare",{defaultMessage:"Rank by rarity"}))),fixableInEditor:!0})}})),r}(a.datatableUtilities,t,n,e.docLinks,i),p=function(e,{dataViews:t},a){const n=[],i=Object.values(e.layers).filter((({indexPatternId:e})=>t.indexPatterns[e])).flatMap((e=>{const a=t.indexPatterns[e.indexPatternId];return Object.entries(e.columns).filter((([e,t])=>{var n;const i=Rf[t.operationType];if(!i.getPossibleOperationForField||!Zd(t))return!1;const s=a.getFieldByName(t.sourceField);return!(!s||null!==(n=i.getPossibleOperationForField)&&void 0!==n&&n.call(i,s)||"counter"!==(null==s?void 0:s.timeSeriesMetric))})).map((([t,a])=>[a,e.columns[$p(e,t)]]))}));if(i.length){const e=Object.values(Object(pa.groupBy)(i,(([e])=>e.sourceField))).map((e=>Object(pa.uniqBy)(e,(([e,t])=>null!=t?t:e))));for(const t of e){const e=t[0][0].sourceField;n.push({uniqueId:Ft.Z,severity:"warning",fixableInEditor:!1,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:u.i18n.translate("xpack.lens.indexPattern.tsdbErrorWarning.unsupportedCounterOperationErrorWarning.shortMessage",{defaultMessage:"The result of {count} {count, plural, one {operation} other {operations}} might be meaningless for {field}: {operations}",values:{count:t.length,operations:t.map((([e,t])=>(null!=t?t:e).label)).join(", "),field:e}}),longMessage:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.indexPattern.unsupportedCounterOperationErrorWarning",defaultMessage:"While {count} {count, plural, one {operation} other {operations}} for {field} {count, plural, one {is} other {are}} allowed the result might be meaningless: {operations}. To learn more about this, {link}.",values:{count:t.length,operations:Object(v.jsx)(l.a.Fragment,null,t.map((([e,a],n)=>Object(v.jsx)(l.a.Fragment,{key:(null!=a?a:e).label},Object(v.jsx)("strong",null,(null!=a?a:e).label),n<t.length-1?", ":"")))),field:e,link:Object(v.jsx)(f.EuiLink,{href:a.links.fleet.datastreamsTSDSMetrics,target:"_blank",external:!0},Object(v.jsx)($t.FormattedMessage,{defaultMessage:"visit the Time series documentation",id:"xpack.lens.indexPattern.unsupportedCounterOperationErrorWarning.link"}))}}))})}}return n}(t,n,e.docLinks),g=function(e,t,a){if(!a)return[];const n=[],i=Object.entries(e.layers),s=i.filter((([,e])=>1!==cb(e)));s.length&&n.push({uniqueId:Ft.H,severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.indexPattern.samplingPerLayer",{defaultMessage:"Sampling probability by layer"}),longMessage:Object(v.jsx)(rb,{layers:s,dataViews:t.dataViews,visualizationInfo:a}),displayLocations:[{id:"embeddableBadge"}]});const l=i.filter((([,e])=>e.ignoreGlobalFilters));return l.length&&n.push({uniqueId:Ft.G,severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsIgnoreTitle",{defaultMessage:"Layers ignoring global filters"}),longMessage:Object(v.jsx)(Hl,{layers:l.map((([e,{indexPatternId:t}])=>({layerId:e,indexPatternId:t}))),visualizationInfo:a,dataViews:t.dataViews}),displayLocations:[{id:"embeddableBadge"}]}),n}(t,n,s);return r.concat(o,c,d,p,g)},getSearchWarningMessages:(t,a,n,i)=>function(e,t,a,n,i){return e&&"incomplete"===t.type?function(e){return"incomplete"===e.type&&Object.values(e.clusters).some((e=>!!e.failures&&e.failures.some((e=>{var t;return"unsupported_aggregation_on_downsampled_index"===(null===(t=e.reason)||void 0===t?void 0:t.type)}))))}(t)?Object.values(e.layers).flatMap((e=>Object(pa.uniq)(Object.values(e.columns).filter((e=>["median","percentile","percentile_rank","last_value","unique_count","standard_deviation"].includes(e.operationType))).map((e=>e.label))).map((e=>({uniqueId:`${Ft.ab}--${e}`,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:"",longMessage:u.i18n.translate("xpack.lens.indexPattern.tsdbRollupWarning",{defaultMessage:"{label} uses a function that is unsupported by rolled up data. Select a different function or change the time range.",values:{label:e}})}))))):[{uniqueId:Ft.A,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:"",longMessage:e=>Object(v.jsx)(ib,{onViewDetailsClick:e,warnings:[t]})}]:[]}(t,a,0,0,e.theme),checkIntegrity:(e,t)=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((e=>!t[e])),isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return Boolean(null===(a=t[e.indexPatternId])||void 0===a?void 0:a.timeFieldName)||e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>{const a=e.columns[t];return ip("date_histogram",a)&&!a.params.ignoreTimeRange}))}))},isEqual:(e,t,a,n)=>Object(pa.isEqual)(Kf(e,t),Kf(a,n)),getUsedDataView:(e,t)=>t?e.layers[t].indexPatternId:e.currentIndexPatternId,getUsedDataViews:e=>Object.values(e.layers).map((({indexPatternId:e})=>e)),injectReferencesToLayers:(e,t)=>{const a=t&&e?Kf(e,t).layers:null==e?void 0:e.layers;return{...e,layers:a}},getDatasourceInfo:async(e,t,a)=>{const n=t?Kf(e,t).layers:e.layers,i=[];for(const{indexPatternId:e}of Object.values(n)){const t=await(null==a?void 0:a.get(e));t&&i.push(t)}return Object.entries(n).reduce(((e,[t,a])=>{const n=null==i?void 0:i.find((e=>e.id===a.indexPatternId)),s=Object.entries(a.columns).map((([e,t])=>{const a=Zd(t)?Vf(t):void 0;return{id:e,role:t.isBucketed?"split":"metric",operation:{...iy(t,void 0,n),type:t.operationType,fields:a,filter:t.filter}}}));return e.push({layerId:t,columns:s,dataView:n}),e}),[])}};return h}function ly(e,t){return{indexPatternId:e,linkToLayers:t,columns:{},columnOrder:[],sampling:1,ignoreGlobalFilters:!1}}var ry=a(529),oy=a.n(ry);const uy=e=>null==e?void 0:e.meta.type;function cy({setState:e,state:t,core:a,data:n,query:r,frame:o,filters:c,dateRange:d,expressions:p,dataViews:m,layerFields:g,hasSuggestionForField:f,dropOntoWorkspace:b}){const h=oy()(r),[y,x]=Object(s.useState)(!1);Object(s.useEffect)((()=>{!async function(){if(r&&Object(po.isOfAggregateQueryType)(r)&&!Object(pa.isEqual)(r,h)){const a=o.dataViews,i=await async function(e,t,a,n,i,s){var l,r,o;let u=null!=s&&s.indexPatternRefs.length?s.indexPatternRefs:await async function(e){const t=await e.getIdsWithTitle(),a=await Promise.all(t.map((t=>e.get(t.id).then((e=>e.timeFieldName)))));return t.map(((e,t)=>({...e,timeField:a[t]}))).sort(((e,t)=>e.title.localeCompare(t.title)))}(a);const c=[],d=Object.keys(e.layers),p=e.initialContext,m=d.length>0?d[0]:Object(kt.a)(),g=function(e){return yo(e.esql)}(t);let f,b=null!==(l=null===(r=u.find((e=>e.title===g)))||void 0===r?void 0:r.id)&&void 0!==l?l:"",h=[];try{var v;const e=await ho(g,a);e&&e.id&&(b=null==e?void 0:e.id,u=[...u,{id:e.id,title:e.name,timeField:e.timeFieldName}]),f=e.timeFieldName;const s=await function(e,t,a,n,i,s){const l=a.query.timefilter.timefilter.getTime();return Object(An.textBasedQueryStateToAstWithValidation)({filters:void 0,query:e,time:l,dataView:t,inputQuery:void 0}).then((e=>{if(e){const t=n.run(e,null);let a,i;return t.pipe(Object(xo.pluck)("result")).subscribe((e=>{const t=e;"error"===t.type?i=t.error.message:a=t})),Object(xo.lastValueFrom)(t).then((()=>{if(i)throw new Error(i);return a}))}})).catch((e=>{throw new Error(e.message)}))}(t,e,n,i);h=null!==(v=null==s?void 0:s.columns)&&void 0!==v?v:[],Io(t,h)}catch(e){c.push(e)}return{layers:{[m]:{index:b,query:t,columns:null!==(o=e.layers[m].columns)&&void 0!==o?o:[],timeField:f,errors:c}},indexPatternRefs:u,initialContext:p}}(t,r,m,n,p,a);x(!0),e(i)}}()}),[n,m,p,h,r,e,t,o.dataViews]);const j=Object(po.isOfAggregateQueryType)(r)?Mo(r):[],O=Object(s.useCallback)((e=>Boolean(null==g?void 0:g.includes(e.name))),[g]),I=Object(s.useCallback)((e=>{if(e===Mh.b.AvailableFields)return{helpText:u.i18n.translate("xpack.lens.indexPattern.allFieldsForTextBasedLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, edit your query."})}}),[]),{fieldListFiltersProps:M,fieldListGroupedProps:T}=kh({dataViewId:null,allFields:y?null!=j?j:[]:null,services:{dataViews:m,core:a},getCustomFieldType:uy,onSelectedFieldFilter:O,onOverrideFieldGroupDetails:I}),w=Object(s.useCallback)((({field:e,groupIndex:t,itemIndex:a,fieldSearchHighlight:n,groupName:i})=>e?Object(v.jsx)(jv,{field:e,exists:!0,hideDetails:!0,itemIndex:a,groupIndex:t,dropOntoWorkspace:b,hasSuggestionForField:f,highlight:n,getCustomFieldType:uy}):Object(v.jsx)(l.a.Fragment,null)),[f,b]);return Object(v.jsx)(Cl.KibanaContextProvider,{services:{...a}},Object(v.jsx)(Ah,{className:"lnsInnerIndexPatternDataPanel",isProcessing:!y,prepend:Object(v.jsx)(Lh,i()({},M,{"data-test-subj":"lnsTextBasedLanguages"}))},Object(v.jsx)(Nh,i()({},T,{renderFieldItem:w,"data-test-subj":"lnsTextBasedLanguages",localStorageKeyPrefix:"lens"}))))}function dy({selectedField:e,onChoose:t,existingFields:a,"data-test-subj":n}){var i;const l=Object(s.useMemo)((()=>{const e=a.map((e=>{var t;const a=null==e||null===(t=e.meta)||void 0===t?void 0:t.type;return{compatible:e.compatible?1:0,exists:!0,label:e.name,value:{type:"field",field:e.name,dataType:a}}})).sort(((e,t)=>t.compatible-e.compatible));return[{label:u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),options:e}]}),[a]);return Object(v.jsx)(nm.a,{activeField:e?{label:e.fieldName,value:{type:"field",field:e.fieldName,dataType:null==e||null===(i=e.meta)||void 0===i?void 0:i.type}}:void 0,options:l,onChoose:a=>{a&&a.field!==(null==e?void 0:e.fieldName)&&t(a)},fieldIsInvalid:!1,"data-test-subj":null!=n?n:"text-based-dimension-field"})}function py(e){var t;const[a,n]=Object(s.useState)([]),i=null===(t=e.state.layers[e.layerId])||void 0===t?void 0:t.query;Object(s.useEffect)((()=>{!async function(){if(i){const a=await function(e,t,a,n,i){return Object(An.textBasedQueryStateToAstWithValidation)({query:e,time:void 0,dataView:void 0}).then((e=>{if(e){const a=t.execute(e,null),n=a.getData();let i,s;return n.pipe(Object(xo.pluck)("result")).subscribe((e=>{const t=e;"error"===t.type?s=t.error.message:i=t})),Object(xo.lastValueFrom)(n).then((()=>{if(s)throw new Error(s);return i}))}})).catch((e=>{throw new Error(e.message)}))}({esql:`${i.esql} | limit 0`},e.expressions);if(a){var t;const i=null===(t=a.columns)||void 0===t?void 0:t.some(Eo),s=a.columns.map((t=>{var a,n;return{id:t.id,name:t.name,meta:null!==(a=null==t?void 0:t.meta)&&void 0!==a?a:{type:"number"},compatible:!e.isMetricDimension||!i||e.filterOperations({dataType:null==t||null===(n=t.meta)||void 0===n?void 0:n.type,isBucketed:Boolean(Co(t)),scale:"ordinal"})}}));n(s)}}}()}),[e,e.expressions,i]);const r=Object(s.useMemo)((()=>{const t=e.state.layers[e.layerId].columns;return null==t?void 0:t.find((t=>t.columnId===e.columnId))}),[e.columnId,e.layerId,e.state.layers]);return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(f.EuiFormRow,{"data-test-subj":"text-based-languages-field-selection-row",label:u.i18n.translate("xpack.lens.textBasedLanguages.chooseField",{defaultMessage:"Field"}),fullWidth:!0,className:"lnsIndexPatternDimensionEditor--padded"},Object(v.jsx)(dy,{existingFields:null!=a?a:[],selectedField:r,onChoose:t=>{var n;const i=null==a||null===(n=a.find((e=>e.name===t.field)))||void 0===n?void 0:n.meta,s={columnId:e.columnId,fieldName:t.field,meta:i};return e.setState(r?{...e.state,layers:{...e.state.layers,[e.layerId]:{...e.state.layers[e.layerId],columns:e.state.layers[e.layerId].columns.map((a=>a.columnId!==e.columnId?a:{...a,fieldName:t.field,meta:i}))}}}:{...e.state,layers:{...e.state.layers,[e.layerId]:{...e.state.layers[e.layerId],columns:[...e.state.layers[e.layerId].columns,s]}}})}})),e.dataSectionExtra&&Object(v.jsx)("div",{style:{paddingLeft:Me.euiThemeVars.euiSize,paddingRight:Me.euiThemeVars.euiSize}},e.dataSectionExtra))}function my(e){const t=e.columnLabelMap[e.columnId];return Object(v.jsx)(di.a,{id:e.columnId,color:t?"primary":"danger",dataTestSubj:"lns-dimensionTrigger-textBased",label:null!=t?t:u.i18n.translate("xpack.lens.textBasedLanguages.missingField",{defaultMessage:"Missing field"})})}const gy=e=>{const{source:t,target:a,state:n}=e;if(!t||t.id===a.columnId)return;const i=n.layers[a.layerId],s=To(i.columns,i.query),l=i.columns.find((e=>e.columnId===a.columnId)),r=s.find((e=>e.columnId===a.columnId)),o=s.find((e=>e.columnId===t.id));if(Object(Ct.isDraggedField)(t)){const e=t.humanData.label;if(null!=a&&a.isMetricDimension&&o&&Co(o))return;return{dropTypes:[l?"field_replace":"field_add"],nextLabel:e}}if(Object(fh.f)(t)){var u,c;if(t.layerId!==a.layerId)return;const e=t.humanData.label;if(Object(Ct.isOperationFromTheSameGroup)(t,a))return l?{dropTypes:["reorder"],nextLabel:e}:{dropTypes:["duplicate_compatible"],nextLabel:e};const n=Fo(s,null==o||null===(u=o.meta)||void 0===u?void 0:u.type),i=Fo(s,null==r||null===(c=r.meta)||void 0===c?void 0:c.type),d=!(null!=a&&a.isMetricDimension)||a.isMetricDimension&&n;if(l){const a=d&&!(null!=t&&t.isMetricDimension)||t.isMetricDimension&&i;if(d)return a?{dropTypes:["replace_compatible","replace_duplicate_compatible","swap_compatible"],nextLabel:e}:{dropTypes:["replace_compatible","replace_duplicate_compatible"],nextLabel:e}}else if(d)return{dropTypes:["move_compatible","duplicate_compatible"],nextLabel:e}}},fy=({prevState:e,layerId:t,columnId:a})=>({...e,layers:{...e.layers,[t]:{...e.layers[t],columns:e.layers[t].columns.filter((e=>e.columnId!==a))}}}),by=e=>{var t;const{dropType:a,state:n,source:i,target:s}=e;if(!["field_add","field_replace","duplicate_compatible","replace_duplicate_compatible","replace_compatible","move_compatible","swap_compatible","reorder"].includes(a))return;const l=n.layers[s.layerId],r=To(l.columns,l.query),o=r.find((e=>e.columnId===i.id)),u=r.find((e=>e.columnId===s.columnId)),c={columnId:s.columnId,fieldName:null!==(t=null==o?void 0:o.fieldName)&&void 0!==t?t:"",meta:null==o?void 0:o.meta};let d;switch(a){case"field_add":case"duplicate_compatible":case"replace_duplicate_compatible":d=[...l.columns.filter((e=>e.columnId!==s.columnId)),c];break;case"field_replace":case"replace_compatible":d=l.columns.map((e=>e.columnId===s.columnId?c:e));break;case"move_compatible":d=[...l.columns,c];break;case"swap_compatible":const e=e=>{var t;return e.columnId===s.columnId?c:e.columnId===i.columnId?{columnId:i.columnId,fieldName:null!==(t=null==u?void 0:u.fieldName)&&void 0!==t?t:"",meta:null==u?void 0:u.meta}:e};d=l.columns.map(e);break;case"reorder":const t=l.columns.find((e=>e.columnId===s.columnId)),a=l.columns.find((e=>e.columnId===i.id));if(!t||!a)return;d=Object(Ct.reorderElements)(l.columns,t,a)}if(!d)return;const p={...e.state,layers:{...e.state.layers,[s.layerId]:{...l,columns:d,allColumns:r}}};return Object(fh.f)(i)&&["replace_compatible","move_compatible"].includes(a)?fy({prevState:p,columnId:i.columnId,layerId:i.layerId}):p};function hy(e){return`textBasedLanguages-datasource-layer-${e}`}const vy=k()((e=>e.map((e=>{if("fieldName"in e)return e.fieldName})).filter(Ct.nonNullable)),pa.isEqual),yy=(e,t,a)=>{var n,i;return{state:{...e},table:{changeType:"unchanged",isMultiRow:!1,layerId:a,columns:null!==(n=null===(i=e.layers[a].columns)||void 0===i?void 0:i.map((e=>{var a,n;const i=So(t,null==e||null===(a=e.meta)||void 0===a?void 0:a.type);return{columnId:e.columnId,operation:{dataType:null==e||null===(n=e.meta)||void 0===n?void 0:n.type,label:e.fieldName,isBucketed:Boolean(Co(e)),...i&&{inMetricDimension:i}}}})))&&void 0!==n?n:[]},keptLayerIds:[a]}},xy=(e,t,a,n)=>{var i;const s=n.reduce(((t,n)=>{var i;const s=n.isBucketed?Co:Eo;let l=null===(i=e.layers[a].columns)||void 0===i?void 0:i.find((e=>s(e)&&!t.some((t=>t.columnId===e.columnId))));var r;return!l&&n.allowAll&&(l=null===(r=e.layers[a].columns)||void 0===r?void 0:r.find((e=>!t.some((t=>t.columnId===e.columnId))))),l?[...t,l]:t}),[]);if(s.length&&s.length===n.length)return{state:{...e,layers:{[a]:{...e.layers[a],columns:s}}},table:{changeType:"reduced",isMultiRow:!1,layerId:a,columns:null!==(i=null==s?void 0:s.map(((e,a)=>{var i,s;const l=So(t,null==e||null===(i=e.meta)||void 0===i?void 0:i.type);return{columnId:e.columnId,operation:{dataType:null==e||null===(s=e.meta)||void 0===s?void 0:s.type,label:e.fieldName,isBucketed:!!n[a].isBucketed,...l&&{inMetricDimension:l}}}})))&&void 0!==i?i:[]},keptLayerIds:[a]}};function jy({core:e,storage:t,data:a,expressions:n,dataViews:s}){const l=e=>{var t;return null===(t=Object.entries(e.layers))||void 0===t?void 0:t.flatMap((([t,a])=>{const n=To(a.columns,a.query);if(!n.length&&a.query){const e=a.columns.map((e=>({id:e.columnId,name:e.fieldName,meta:e.meta})));Io(a.query,e)}const i=yy(e,n,t),s=xy(e,n,t,[{isBucketed:!1}]),l=xy(e,n,t,[{isBucketed:!1},{isBucketed:!0,allowAll:!0}]);return[i,xy(e,n,t,[{isBucketed:!1},{isBucketed:!0,allowAll:!0},{isBucketed:!0,allowAll:!0}]),l,s].filter(Ct.nonNullable).reduce(((e,t)=>e.find((({table:e})=>Object(pa.isEqual)(e.columns,t.table.columns)))?e:[...e,t]),[])}))},r={id:"textBased",checkIntegrity:()=>[],getUserMessages:e=>{const t=[];return Object.values(e.layers).forEach((e=>{e.errors&&e.errors.length>0&&t.push(...e.errors)})),t.map((e=>({uniqueId:Ft.T,severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"},{id:"textBasedLanguagesQueryInput"}],shortMessage:e.message,longMessage:e.message})))},initialize:(e,t,a,n,i)=>({...e||{layers:{}},indexPatternRefs:(i?Object.values(i):[]).map((e=>({id:e.id,title:e.title,timeField:e.timeFieldName}))),initialContext:a}),syncColumns:({state:e})=>e,onRefreshIndexPattern(){},getUsedDataViews:e=>Object.values(e.layers).map((({index:e})=>e)).filter((e=>void 0!==e)),getPersistableState({layers:e}){const t=[];return Object.entries(e).forEach((([e,{index:a,...n}])=>{a&&t.push({type:"index-pattern",id:a,name:hy(e)})})),{state:{layers:e},savedObjectReferences:t}},insertLayer(e,t){var a,n;const i=null===(a=Object.values(null==e?void 0:e.layers))||void 0===a?void 0:a[0],s=null==i?void 0:i.query,l=null!==(n=null==i?void 0:i.index)&&void 0!==n?n:JSON.parse(localStorage.getItem("lens-settings")||"{}").indexPatternId||e.indexPatternRefs[0].id;return{...e,layers:{...e.layers,[t]:Oy(l,s)}}},createEmptyLayer:()=>({indexPatternRefs:[],layers:{}}),cloneLayer:(e,t,a,n)=>({...e}),removeLayer(e,t){const a={...e.layers,[t]:{...e.layers[t],columns:[]}};return{removedLayerIds:[t],newState:{...e,layers:a}}},clearLayer:(e,t)=>({removedLayerIds:[],newState:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[]}}}}),getLayers:e=>e&&e.layers?Object.keys(null==e?void 0:e.layers):[],isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return e.index&&Boolean(null===(a=t[e.index])||void 0===a?void 0:a.timeFieldName)}))},getUsedDataView:(e,t)=>{if(!t||!e.layers[t].index){var a;const t=Object.values(e.layers);return null==t||null===(a=t[0])||void 0===a?void 0:a.index}return e.layers[t].index},removeColumn:fy,toExpression:(e,t,a,n,i)=>function(e,t){return e.layers[t]?function(e,t,a){var n,i;if(!e.columns||0===(null===(n=e.columns)||void 0===n?void 0:n.length))return null;let s={};e.columns.forEach((e=>{s[e.fieldName]?s[e.fieldName].push({id:e.columnId,label:e.fieldName}):s={...s,[e.fieldName]:[{id:e.columnId,label:e.fieldName}]}}));const l=null!==(i=e.timeField)&&void 0!==i?i:void 0;if(e.table)return{type:"expression",chain:[{type:"function",function:"var",arguments:{name:[t]}},{type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(s)]}}]};{const t=Object(An.textBasedQueryStateToExpressionAst)({query:e.query,timeFieldName:l,titleForInspector:u.i18n.translate("xpack.lens.inspectorTextBasedRequestDataTitle",{defaultMessage:"Visualization"}),descriptionForInspector:u.i18n.translate("xpack.lens.inspectorTextBasedRequestDescription",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});return t.chain.push({type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(s)],isTextBased:[!0]}}),t}}(e.layers[t],t,e.indexPatternRefs):null}(e,t),getSelectedFields(e){var t;return vy(null===(t=Object.values(null==e?void 0:e.layers))||void 0===t?void 0:t.flatMap((e=>Object.values(e.columns))))},DataPanelComponent(e){var t;const l=null==r||null===(t=r.getSelectedFields)||void 0===t?void 0:t.call(r,e.state);return Object(v.jsx)(cy,i()({data:a,dataViews:s,expressions:n,layerFields:l},e))},DimensionTriggerComponent:e=>{const t=r.uniqueLabels(e.state,e.indexPatterns);return Object(v.jsx)(my,i()({},e,{expressions:n,columnLabelMap:t}))},getRenderEventCounters(e){const t=null==e?void 0:e.initialContext;return t&&"query"in t&&t.query&&Object(po.isOfAggregateQueryType)(t.query)?[`${Object(po.getAggregateQueryMode)(t.query)}_chart`]:[]},DimensionEditorComponent:e=>Object(v.jsx)(py,i()({},e,{expressions:n})),LayerPanelComponent:e=>null,uniqueLabels(e){const t=e.layers,a={},n=Object(Ct.getUniqueLabelGenerator)();return Object.values(t).forEach((e=>{e.columns&&Object.values(e.columns).forEach((e=>{a[e.columnId]=n(e.fieldName)}))})),a},getDropProps:gy,onDrop:by,getPublicAPI:({state:e,layerId:t,indexPatterns:a})=>({datasourceId:"textBased",getTableSpec:()=>{var a;return(null===(a=e.layers[t])||void 0===a?void 0:a.columns.map((e=>({columnId:e.columnId,fields:[e.fieldName]}))))||[]},getOperationForColumnId:n=>{var i,s;const l=e.layers[t],o=null==l||null===(i=l.columns)||void 0===i?void 0:i.find((e=>e.columnId===n)),u=r.uniqueLabels(e,a);let c="ordinal";switch(null==o||null===(s=o.meta)||void 0===s?void 0:s.type){case"date":c="interval";break;case"number":c="ratio";break;default:c="ordinal"}var d,p;return o?{dataType:null==o||null===(d=o.meta)||void 0===d?void 0:d.type,label:null!==(p=u[n])&&void 0!==p?p:null==o?void 0:o.fieldName,isBucketed:Boolean(Co(o)),inMetricDimension:o.inMetricDimension,hasTimeShift:!1,hasReducedTimeRange:!1,scale:c}:null},getVisualDefaults:()=>({}),isTextBasedLanguage:()=>!0,getMaxPossibleNumValues:e=>null,getSourceId:()=>e.layers[t].index,getFilters:()=>({enabled:{kuery:[],lucene:[]},disabled:{kuery:[],lucene:[]}}),hasDefaultTimeField:()=>!1}),getDatasourceSuggestionsForField(e,t){var a,n;const i=Object.values(e.layers),s=null==i||null===(a=i[0])||void 0===a?void 0:a.query,l=s?Mo(s):[],r=null==l?void 0:l.find((e=>e.id===t.id));return r?null===(n=Object.entries(e.layers))||void 0===n?void 0:n.map((([t,a])=>{var n,i,s,l;const o=Object(kt.a)(),u={columnId:o,fieldName:null!==(n=null==r?void 0:r.name)&&void 0!==n?n:"",meta:null==r?void 0:r.meta};return{state:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[...a.columns,u]}}},table:{changeType:"initial",isMultiRow:!1,layerId:t,columns:[...null===(i=a.columns)||void 0===i?void 0:i.map((e=>{var t;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean(Co(e))}}})),{columnId:o,operation:{dataType:null==r||null===(s=r.meta)||void 0===s?void 0:s.type,label:null!==(l=null==r?void 0:r.name)&&void 0!==l?l:"",isBucketed:Boolean(Co(r))}}]},keptLayerIds:[t]}})):[]},getDatasourceSuggestionsForVisualizeField:(e,t,a)=>{const n=e.initialContext;if(a)return[];if(n&&"dataViewSpec"in n&&n.dataViewSpec.title&&n.query){var i,s,l,r;const t=Object(kt.a)(),a=null!==(i=null===(s=n.textBasedColumns)||void 0===s?void 0:s.slice(0,wo))&&void 0!==i?i:[],o=null==a?void 0:a.some(Eo),u=a.map((e=>{var t;const n=So(a,null==e||null===(t=e.meta)||void 0===t?void 0:t.type);return{columnId:e.id,fieldName:e.name,meta:e.meta,...n&&{inMetricDimension:n}}}));Io(n.query,a);const c=null!==(l=n.dataViewSpec.id)&&void 0!==l?l:n.dataViewSpec.title,d=n.query;return[{state:{...{...e,initialContext:void 0,...n.dataViewSpec.id?{indexPatternRefs:[{id:n.dataViewSpec.id,title:n.dataViewSpec.title,timeField:n.dataViewSpec.timeFieldName}]}:{},layers:{...e.layers,[t]:{index:c,query:d,columns:null!=u?u:[],timeField:n.dataViewSpec.timeFieldName}}}},table:{changeType:"initial",isMultiRow:!1,notAssignedMetrics:!o,layerId:t,columns:null!==(r=null==u?void 0:u.map((e=>{var t;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean(Co(e))}}})))&&void 0!==r?r:[]},keptLayerIds:[t]}]}return[]},getDatasourceSuggestionsFromCurrentState:l,getDatasourceSuggestionsForVisualizeCharts:l,isEqual:(e,t,a,n)=>Object(pa.isEqual)(e,a),getDatasourceInfo:async(e,t,a)=>{const n=[];for(const{index:t}of Object.values(e.layers))if(t){const e=await(null==a?void 0:a.get(t));e&&n.push(e)}return Object.entries(e.layers).reduce(((e,[t,a])=>{const i=Object.entries(a.columns).map((([e,t])=>{var a,n;return{id:e,role:Co(t)?"split":"metric",operation:{dataType:null==t||null===(a=t.meta)||void 0===a?void 0:a.type,label:t.fieldName,isBucketed:Boolean(Co(t)),hasTimeShift:!1,hasReducedTimeRange:!1,fields:[t.fieldName],type:(null===(n=t.meta)||void 0===n?void 0:n.type)||"unknown",filter:void 0}}}));return e.push({layerId:t,columns:i,dataView:null==n?void 0:n.find((e=>e.id===a.index))}),e}),[])}};return r}function Oy(e,t){return{index:e,query:t,columns:[]}}const Iy=()=>{const e=new WeakMap;return{insertOrReplaceFormulaColumn:(t,{formula:a,label:n,format:i,filter:s,reducedTimeRange:l,timeScale:r},o,u,c)=>{const d=(t=>{const a=e.get(t);if(a)return a;const n=Object(Lo.b)(t);return e.set(t,n),n})(u);return Ud(t,{label:null!=n?n:a,customLabel:Boolean(n),operationType:"formula",dataType:"number",references:[],isBucketed:!1,filter:s,reducedTimeRange:l,timeScale:r,params:{formula:a,format:i}},{...o,indexPatternId:d.id},{indexPattern:d,dateRange:c}).layer}}};class text_based_TextBasedDatasource{constructor(){}setup(e,{editorFrame:t}){t.registerDatasource((async()=>{const{getTextBasedDatasource:t}=await Promise.resolve().then(a.bind(null,682)),[n,{data:i,dataViews:s,expressions:l}]=await e.getStartServices();return t({core:n,storage:new lr.Storage(localStorage),data:i,dataViews:s,expressions:l})}))}}class form_based_FormBasedDatasource{setup(e,{fieldFormats:t,expressions:n,editorFrame:i,charts:s}){i.registerDatasource((async()=>{const{getFormBasedDatasource:n,getSuffixFormatter:i,suffixFormatterId:l}=await Promise.resolve().then(a.bind(null,682));if(!t.has(l)){const a=Object(lr.createStartServicesGetter)(e.getStartServices),n=i((()=>a().plugins.fieldFormats.deserialize));t.register([n])}const[r,{dataViewFieldEditor:o,uiActions:u,data:c,fieldFormats:d,dataViews:p,unifiedSearch:m,share:g}]=await e.getStartServices();return n({core:r,fieldFormats:d,storage:new lr.Storage(localStorage),data:c,unifiedSearch:m,share:g,dataViews:p,charts:s,dataViewFieldEditor:o,uiActions:u})}))}}var My=a(178);async function Ty(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),a={};return t.forEach((e=>{if(a[e.id]=e,e.alias)for(const t of e.alias)a[t]=e})),a}class service_EditorFrameService{constructor(){Ma()(this,"datasources",[]),Ma()(this,"visualizations",[]),Ma()(this,"loadDatasources",(()=>Ty(this.datasources))),Ma()(this,"loadVisualizations",(()=>Ty(this.visualizations))),Ma()(this,"documentToExpression",(async(e,t)=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{persistedStateToExpression:s}=await Promise.resolve().then(a.bind(null,682));return s(n,i,e,t)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{EditorFrame:s}=await Promise.resolve().then(a.bind(null,682));return{EditorFrameContainer:({showNoDataPopover:a,lensInspector:l,indexPatternService:r,getUserMessages:o,addUserMessages:u})=>Object(v.jsx)("div",{className:"lnsApp__frame"},Object(v.jsx)(s,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:l,showNoDataPopover:a,getUserMessages:o,addUserMessages:u,indexPatternService:r,datasourceMap:n,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:n,visualizationMap:i}}}}}const wy="enableESQL";var ky=a(143),Ey=a(9),Cy=a(22),Fy=a(204);function Sy({ExpressionRenderer:e,expression:t,searchContext:a,variables:n,handleEvent:i,interactive:s,searchSessionId:r,onData$:o,onRender$:u,renderMode:c,syncColors:d,syncTooltips:p,syncCursor:m,hasCompatibleActions:g,getCompatibleCellValueActions:f,style:b,className:h,onRuntimeError:y,addUserMessages:x,executionContext:j,lensInspector:I,noPadding:M,abortController:T}){return t?Object(v.jsx)("div",{className:O()("lnsExpressionRenderer",h),style:b},Object(v.jsx)(e,{className:"lnsExpressionRenderer__component",padding:M?void 0:"s",variables:n,allowCache:!0,expression:t,interactive:s,searchContext:a,searchSessionId:r,onData$:o,onRender$:u,inspectorAdapters:I.adapters,renderMode:c,syncColors:d,syncTooltips:p,syncCursor:m,executionContext:j,abortController:T,renderError:(e,t)=>{const a=Object(Fy.a)(t||null);return x(a),null!=t&&t.original?y(t.original):y(new Error(e||"")),Object(v.jsx)(l.a.Fragment,null)},onEvent:i,hasCompatibleActions:g,getCompatibleCellValueActions:f})):null}const Ay=e=>{const t=Object(Ut.createDefaultInspectorAdapters)();let a;return{adapters:t,inspect:n=>(a=e.open(t,n),a.onClose.then((()=>{a&&(a=void 0)})),a),close:()=>{var e;return null===(e=a)||void 0===e?void 0:e.close()}}};var Py=a(203);a(530);var _y={name:"upo3sz",styles:"max-width:280px"};const Ly=({messages:e})=>{const{euiTheme:t}=Object(f.useEuiTheme)(),a=Object(f.useEuiFontSize)("xs").fontSize,[n,i]=Object(s.useState)(!1);if(!e.length)return null;const l=u.i18n.translate("xpack.lens.embeddable.featureBadge.iconDescription",{defaultMessage:"{count} visualization {count, plural, one {modifier} other {modifiers}}",values:{count:e.length}}),r=new Map;for(const t of e){var o;const e=null!==(o=r.get(t.uniqueId))&&void 0!==o?o:[];e.push(t),r.set(t.uniqueId,e)}return Object(v.jsx)(f.EuiPopover,{panelPaddingSize:"none",button:Object(v.jsx)(f.EuiToolTip,{content:l},Object(v.jsx)(f.EuiButtonEmpty,{"data-test-subj":"lns-feature-badges-trigger",className:"lnsEmbeddablePanelFeatureList_button",color:"text",onClick:()=>i((e=>!e)),title:l,size:"s",css:Object(v.css)("color:transparent;font-size:",a,";height:",t.size.l,"!important;padding-inline:",t.size.xs,";.euiButtonEmpty__content{gap:",t.size.xs,";}",""),iconType:"wrench"},r.size)),isOpen:n,closePopover:()=>i(!1)},Object(v.jsx)("div",{css:_y,"data-test-subj":"lns-feature-badges-panel"},[...r.entries()].map((([e,a],n)=>{const[{shortMessage:i}]=a;return Object(v.jsx)(s.Fragment,{key:e},n>0&&Object(v.jsx)(f.EuiHorizontalRule,{margin:"none","data-test-subj":"lns-feature-badges-horizontal-rule"}),Object(v.jsx)("aside",{css:Object(v.css)("padding:",t.size.base,";","")},Object(v.jsx)(f.EuiTitle,{size:"xxs",css:Object(v.css)("color=",t.colors.title,";","")},Object(v.jsx)("h3",null,i)),Object(v.jsx)("ul",{className:"lnsEmbeddablePanelFeatureList"},a.map((({longMessage:t},a)=>Object(v.jsx)(s.Fragment,{key:`${e}-${a}`},t))))))}))))};var Dy=a(137);function Ry({errors:e,canEdit:t}){const a=e.length>1,n=t&&e.some((({fixableInEditor:e})=>e));return Object(v.jsx)("div",{className:"lnsEmbeddedError"},Object(v.jsx)(f.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(v.jsx)(l.a.Fragment,null,e.length?Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("p",null,e[0].longMessage),a&&!n?Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,n?Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(v.jsx)("p",null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}const Ny=async(e,t)=>{const{ast:a,indexPatterns:n,indexPatternRefs:i,activeVisualizationState:s}=await t(e);return{ast:a?Object(ky.b)(a):null,indexPatterns:n,indexPatternRefs:i,activeVisualizationState:s}},By=({messages:e})=>{const{euiTheme:t}=Object(f.useEuiTheme)(),a=Object(f.useEuiFontSize)("xs").fontSize;return e.length?Object(v.jsx)(Py.a,{messages:e,customButtonStyles:Object(v.css)("block-size:",t.size.l,";font-size:",a,";padding:0 ",t.size.xs,";&>*{gap:",t.size.xs,";}","")}):null},zy=["visualization","visualizationOnEmbeddable"];var Vy={name:"1n2yqb3",styles:"position:absolute;z-index:2;left:0;bottom:0"};const Gy=({onMount:e})=>Object(v.jsx)("div",{css:Vy,ref:t=>{t&&e(t)}});class embeddable_Embeddable extends Ey.Embeddable{logError(e){Object(d.d)("runtime"===e?"embeddable_runtime_error":"embeddable_validation_error",this.getExecutionContext())}constructor(e,t,a){super(t,{editApp:"lens"},a),Ma()(this,"type",Wt.DOC_TYPE),Ma()(this,"deferEmbeddableLoad",!0),Ma()(this,"expressionRenderer",void 0),Ma()(this,"savedVis",void 0),Ma()(this,"expression",void 0),Ma()(this,"domNode",void 0),Ma()(this,"isInitialized",!1),Ma()(this,"inputReloadSubscriptions",void 0),Ma()(this,"isDestroyed",void 0),Ma()(this,"lensInspector",void 0),Ma()(this,"activeData",void 0),Ma()(this,"internalDataViews",[]),Ma()(this,"viewUnderlyingDataArgs",void 0),Ma()(this,"activeVisualizationState",void 0),Ma()(this,"indexPatterns",{}),Ma()(this,"indexPatternRefs",[]),Ma()(this,"fullAttributes",void 0),Ma()(this,"getUserMessages",((e,t)=>{var a,n,i,s,l,r,o,u,c,d,p,m,g,f,b,h,v;const y=[];if(y.push(...Object(Wo.b)({visualizationType:null===(a=this.savedVis)||void 0===a?void 0:a.visualizationType,visualizationState:{state:this.activeVisualizationState,activeId:this.activeVisualizationId},visualization:this.activeVisualizationId&&this.deps.visualizationMap[this.activeVisualizationId]?this.deps.visualizationMap[this.activeVisualizationId]:void 0,activeDatasource:this.activeDatasource,activeDatasourceState:{isLoading:!this.activeDatasourceState,state:this.activeDatasourceState},dataViews:{indexPatterns:this.indexPatterns,indexPatternRefs:this.indexPatternRefs},core:this.deps.coreStart})),!this.savedVis)return y;const x=this.getMergedSearchContext(),j={dataViews:{indexPatterns:this.indexPatterns,indexPatternRefs:this.indexPatternRefs},datasourceLayers:Object(Dy.a)({[this.activeDatasourceId]:{isLoading:!this.activeDatasourceState,state:this.activeDatasourceState}},this.deps.datasourceMap,this.indexPatterns),query:this.savedVis.state.query,filters:null!==(n=x.filters)&&void 0!==n?n:[],dateRange:{fromDate:null!==(i=null===(s=x.timeRange)||void 0===s?void 0:s.from)&&void 0!==i?i:"",toDate:null!==(l=null===(r=x.timeRange)||void 0===r?void 0:r.to)&&void 0!==l?l:""},absDateRange:{fromDate:null!==(o=null===(u=x.timeRange)||void 0===u?void 0:u.from)&&void 0!==o?o:"",toDate:null!==(c=null===(d=x.timeRange)||void 0===d?void 0:d.to)&&void 0!==c?c:""},activeData:this.activeData};return y.push(...null!==(p=null===(m=this.activeDatasource)||void 0===m?void 0:m.getUserMessages(this.activeDatasourceState,{setState:()=>{},frame:j,visualizationInfo:null===(g=this.activeVisualization)||void 0===g||null===(f=g.getVisualizationInfo)||void 0===f?void 0:f.call(g,this.activeVisualizationState,j)}))&&void 0!==p?p:[],...null!==(b=null===(h=this.activeVisualization)||void 0===h||null===(v=h.getUserMessages)||void 0===v?void 0:v.call(h,this.activeVisualizationState,{frame:j}))&&void 0!==b?b:[]),Object(Wo.a)([...y,...Object.values(this.additionalUserMessages)],e,null!=t?t:{})})),Ma()(this,"additionalUserMessages",{}),Ma()(this,"addUserMessages",(e=>{const t={...this.additionalUserMessages},a=[];return e.forEach((e=>{t[e.uniqueId]||(a.push(e.uniqueId),t[e.uniqueId]=e)})),a.length&&(this.additionalUserMessages=t,this.renderUserMessages()),()=>{e.forEach((({uniqueId:e})=>{delete this.additionalUserMessages[e]}))}})),Ma()(this,"removeActiveDataWarningMessages",(()=>{})),Ma()(this,"updateActiveData",((e,t)=>{var a;this.input.onLoad&&this.input.onLoad(!1,t,this.getOutput$());const{type:n,error:i}=e;this.updateOutput({loading:!1,error:"error"===n?i:void 0});const s=null==t||null===(a=t.tables)||void 0===a?void 0:a.tables;this.removeActiveDataWarningMessages();const l=this.getSearchWarningMessages(t);this.removeActiveDataWarningMessages=this.addUserMessages(l),this.activeData=s,this.renderUserMessages()})),Ma()(this,"onRender",(()=>{var e;let t=[],a=[];var n,i,s;this.savedVis&&(t=Object.values(this.deps.datasourceMap).reduce(((e,t)=>{var a,n;return[...e,...null!==(a=null===(n=t.getRenderEventCounters)||void 0===n?void 0:n.call(t,this.savedVis.state.datasourceStates[t.id]))&&void 0!==a?a:[]]}),[]),this.savedVis.visualizationType&&(a=null!==(n=null===(i=(s=this.deps.visualizationMap[this.savedVis.visualizationType]).getRenderEventCounters)||void 0===i?void 0:i.call(s,this.savedVis.state.visualization))&&void 0!==n?n:[]));const l=this.getExecutionContext(),r=[...t,...a,...Object(d.a)(l)];Object.values((null===(e=this.savedVis)||void 0===e?void 0:e.state.adHocDataViews)||{}).forEach((()=>{r.push("ad_hoc_data_view")})),Object(d.d)(r,l),this.trackContentfulRender(),this.renderComplete.dispatchComplete(),this.updateOutput({...this.getOutput(),rendered:!0})})),Ma()(this,"badgeDomNode",void 0),Ma()(this,"renderBadgeMessages",(()=>{const e=this.getUserMessages("embeddableBadge"),[t,a]=Object(pa.partition)(e,(({severity:e})=>"info"!==e));this.badgeDomNode&&Object(r.render)(Object(v.jsx)(c.a,this.deps.coreStart,Object(v.jsx)(By,{messages:t}),Object(v.jsx)(Ly,{messages:a})),this.badgeDomNode)})),Ma()(this,"hasCompatibleActions",(async e=>{if(Object(fh.e)(e)||Object(fh.d)(e)||Object(fh.c)(e)){const{getTriggerCompatibleActions:t}=this.deps;return!!t&&(await t(oe.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),Ma()(this,"getCompatibleCellValueActions",(async e=>{const{getTriggerCompatibleActions:t}=this.deps;if(t){const a=this;return(await t(Ey.CELL_VALUE_TRIGGER,{data:e,embeddable:a})).sort(((e,t)=>{var a,n;return(null!==(a=e.order)&&void 0!==a?a:1/0)-(null!==(n=t.order)&&void 0!==n?n:1/0)})).map((t=>({id:t.id,type:t.type,iconType:t.getIconType({embeddable:a,data:e,trigger:Ey.cellValueTrigger}),displayName:t.getDisplayName({embeddable:a,data:e,trigger:Ey.cellValueTrigger}),execute:e=>t.execute({embeddable:a,data:e,trigger:Ey.cellValueTrigger})})))}return[]})),Ma()(this,"handleEvent",(async e=>{var t,a;if(!this.deps.getTrigger||this.input.disableTriggers)return;let n,i=!0;Object(fh.a)(e)?n=this.input.onBrushEnd:Object(fh.c)(e)||Object(fh.d)(e)?n=this.input.onFilter:Object(fh.e)(e)&&(n=this.input.onTableRowClick);const s=this.isTextBasedLanguage()?null===(t=this.savedVis)||void 0===t?void 0:t.state.query:void 0;if(null===(a=n)||void 0===a||a({...e.data,preventDefault:()=>{i=!1}}),(Object(fh.c)(e)||Object(fh.d)(e)||Object(fh.a)(e))&&i&&this.deps.getTrigger(oe.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(Ct.inferTimeField)(this.deps.data.datatableUtilities,e),query:s},embeddable:this}),Object(fh.e)(e)&&i&&this.deps.getTrigger(oe.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),Object(fh.b)(e)&&this.onEditAction){if(!this.savedVis)return;const t=JSON.parse(JSON.stringify(this.savedVis));t.state.visualization=this.onEditAction(t.state.visualization,e),this.savedVis=t;const{ast:a}=await Ny(this.savedVis,this.deps.documentToExpression);this.expression=a,this.reload()}})),Ma()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),Ma()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),Ma()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=Ay(e.inspector),this.expressionRenderer=e.expressionRenderer,this.initializeSavedVis(t).then((()=>{this.reload()})).catch((e=>this.onFatalError(e)));const n=this.getInput$();this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(n.pipe(Object(xo.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(xo.distinctUntilChanged)(((e,t)=>mi()(e,t))),Object(xo.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(xo.map)((e=>e.viewMode)),Object(xo.distinctUntilChanged)(),Object(xo.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()})));const i=e=>Object(xo.map)((t=>({trigger:e,input:t}))),s=n.pipe(Object(xo.distinctUntilChanged)(((e,t)=>mi()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId,"overrides"in e&&e.overrides,"disableTriggers"in e&&e.disableTriggers],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId,"overrides"in t&&t.overrides,"disableTriggers"in t&&t.disableTriggers]))),Object(xo.skip)(1),i("attributesOrSavedObjectId")),l=Object(Ey.shouldFetch$)(n,(()=>this.getInput())).pipe(i("searchContext"));this.inputReloadSubscriptions.push(Object(xo.merge)(l,s).pipe(Object(xo.debounceTime)(0),Object(xo.switchMap)((async({trigger:e,input:t})=>{"attributesOrSavedObjectId"===e&&await this.initializeSavedVis(t),this.additionalUserMessages={},this.reload()}))).subscribe())}get activeDatasourceId(){return Object(Ct.getActiveDatasourceIdFromDoc)(this.savedVis)}get activeDatasource(){if(this.activeDatasourceId)return this.deps.datasourceMap[this.activeDatasourceId]}get activeVisualizationId(){return Object(Ct.getActiveVisualizationIdFromDoc)(this.savedVis)}get activeVisualization(){if(this.activeVisualizationId)return this.deps.visualizationMap[this.activeVisualizationId]}get activeDatasourceState(){var e,t,a;if(!this.activeDatasourceId||!this.activeDatasource)return;const n=null===(e=this.savedVis)||void 0===e?void 0:e.state.datasourceStates[this.activeDatasourceId];return this.activeDatasource.initialize(n,[...(null===(t=this.savedVis)||void 0===t?void 0:t.references)||[],...(null===(a=this.savedVis)||void 0===a?void 0:a.state.internalReferences)||[]],void 0,void 0,this.indexPatterns)}reportsEmbeddableLoad(){return!0}supportedTriggers(){var e;return this.savedVis&&this.savedVis.visualizationType&&(null===(e=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===e?void 0:e.triggers)||[]}getInspectorAdapters(){return this.lensInspector.adapters}getFullAttributes(){return this.fullAttributes}isTextBasedLanguage(){if(!this.savedVis)return;const e=this.savedVis.state.query;return!Object(po.isOfQueryType)(e)}getTextBasedLanguage(){var e,t;if(!this.isTextBasedLanguage()||null===(e=this.savedVis)||void 0===e||!e.state.query)return;const a=null===(t=this.savedVis)||void 0===t?void 0:t.state.query,n=Object(po.getAggregateQueryMode)(a);return Object(po.getLanguageDisplayName)(n).toUpperCase()}async updateVisualization(e,t,a){var n;const i=this.savedVis,s=null!==(n=this.activeDatasourceId)&&void 0!==n?n:"formBased";if(null!=i&&i.state){const n={...i.state.datasourceStates,[s]:e},l=Object(Ct.extractReferencesFromState)({activeDatasources:Object.keys(n).reduce(((e,t)=>({...e,[t]:this.deps.datasourceMap[t]})),{}),datasourceStates:Object.fromEntries(Object.entries(n).map((([e,t])=>[e,{isLoading:!1,state:t}]))),visualizationState:t,activeVisualization:this.activeVisualizationId?this.deps.visualizationMap[null!=a?a:this.activeVisualizationId]:void 0}),r={...i,state:{...i.state,visualization:t,datasourceStates:n},references:l,visualizationType:null!=a?a:i.visualizationType};this.updateInput({attributes:r,savedObjectId:void 0}),this.renderUserMessages()}}async updateSuggestion(e){const t={...this.savedVis,...e};this.updateInput({attributes:t})}async navigateToLensEditor(){var e,t;const a=this.getAppContext(),n={originatingApp:null!==(e=null==a?void 0:a.currentAppId)&&void 0!==e?e:"dashboards",originatingPath:null==a||null===(t=a.getCurrentPath)||void 0===t?void 0:t.call(a),valueInput:this.getExplicitInput(),embeddableId:this.id,searchSessionId:this.getInput().searchSessionId},i=new Ey.EmbeddableStateTransfer(this.deps.coreStart.application.navigateToApp,this.deps.coreStart.application.currentAppId$);i&&await i.navigateToEditor(Wt.APP_ID,{path:this.output.editPath,state:n,skipAppLeave:!0})}updateByRefInput(e){const t=this.savedVis;this.updateInput({attributes:t,savedObjectId:e})}async openConfingPanel(e,t,n){var i;const{getEditLensConfiguration:s}=await Promise.resolve().then(a.bind(null,682)),l=await s(this.deps.coreStart,e,this.deps.visualizationMap,this.deps.datasourceMap),r=null!==(i=this.activeDatasourceId)&&void 0!==i?i:"formBased",o=this.savedVis;var u;return o?Object(v.jsx)(l,{attributes:o,updatePanelState:this.updateVisualization.bind(this),updateSuggestion:this.updateSuggestion.bind(this),datasourceId:r,lensAdapters:this.lensInspector.adapters,output$:this.getOutput$(),panelId:this.id,savedObjectId:null===(u=this.savedVis)||void 0===u?void 0:u.savedObjectId,updateByRefInput:this.updateByRefInput.bind(this),navigateToLensEditor:this.isTextBasedLanguage()?void 0:this.navigateToLensEditor.bind(this),displayFlyoutHeader:!0,canEditTextBasedQuery:this.isTextBasedLanguage(),isNewPanel:t,deletePanel:n}):null}async initializeSavedVis(e){var t;const a=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!a||this.isDestroyed)return;const{metaInfo:n,attributes:i}=a;this.fullAttributes=i,this.savedVis={...i,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId},this.isTextBasedLanguage()&&this.updateInput({disabledActions:["OPEN_FLYOUT_ADD_DRILLDOWN"]});try{const{ast:e,indexPatterns:t,indexPatternRefs:a,activeVisualizationState:n}=await Ny(this.savedVis,this.deps.documentToExpression);this.expression=e,this.indexPatterns=t,this.indexPatternRefs=a,this.activeVisualizationState=n}catch{}var s;"conflict"===(null==n||null===(t=n.sharingSavedObjectProps)||void 0===t?void 0:t.outcome)&&this.deps.spaces&&this.addUserMessages([{uniqueId:"url-conflict",severity:"error",displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(v.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:Wt.DOC_TYPE,sourceId:null==n||null===(s=n.sharingSavedObjectProps)||void 0===s?void 0:s.sourceId}),fixableInEditor:!1}]),await this.initializeOutput(),this.setInitializationFinished(),this.isInitialized=!0}getSearchWarningMessages(e){var t;if(!this.activeDatasource||!this.activeDatasourceId||null==e||!e.requests)return[];const a=null===(t=this.savedVis)||void 0===t?void 0:t.state.datasourceStates[this.activeDatasourceId];return Object(Ct.getSearchWarningMessages)(e.requests,this.activeDatasource,a,{searchService:this.deps.data.search})}getExecutionContext(){if(this.savedVis){var e,t;const a=(null===(e=this.parent)||void 0===e?void 0:e.getInput().executionContext)||this.input.executionContext,n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl};return a?{...a,child:n}:n}}render(e){if(this.domNode=e,!this.savedVis||!this.isInitialized||this.isDestroyed)return;super.render(e),this.input.onLoad&&this.input.onLoad(!0),this.domNode.setAttribute("data-shared-item","");const t=this.getUserMessages(zy,{severity:"error"});this.updateOutput({loading:!0,error:t.length?new Error("string"==typeof t[0].longMessage?t[0].longMessage:t[0].shortMessage):void 0}),t.length?this.renderComplete.dispatchError():this.renderComplete.dispatchInProgress();const a=this.getInput();this.expression&&!t.length&&Object(r.render)(Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(c.a,this.deps.coreStart,Object(v.jsx)(Sy,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:{embeddableTitle:this.getTitle(),...a.palette?{theme:{palette:a.palette}}:{},..."overrides"in a?{overrides:a.overrides}:{},...(e=>{const t={};if("textBased"in e){const a=e.textBased.layers;for(const e in a)a[e]&&a[e].table&&(t[e]=a[e].table)}return t})(this.savedVis.state.datasourceStates)},searchSessionId:this.getInput().searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,onRender$:this.onRender,interactive:!a.disableTriggers,renderMode:a.renderMode,syncColors:a.syncColors,syncTooltips:a.syncTooltips,syncCursor:a.syncCursor,hasCompatibleActions:this.hasCompatibleActions,getCompatibleCellValueActions:this.getCompatibleCellValueActions,className:a.className,style:a.style,executionContext:this.getExecutionContext(),abortController:this.input.abortController,addUserMessages:e=>this.addUserMessages(e),onRuntimeError:e=>{this.updateOutput({error:e}),this.logError("runtime")},noPadding:this.visDisplayOptions.noPadding})),Object(v.jsx)(Gy,{onMount:e=>{this.badgeDomNode=e,this.renderBadgeMessages()}})),e),this.renderUserMessages()}trackContentfulRender(){this.activeData&&Object(Cy.b)(this.parent)&&Object.values(this.activeData).some((e=>{var t,a;return null!=(null===(t=e.meta)||void 0===t||null===(a=t.statistics)||void 0===a?void 0:a.totalCount)?e.meta.statistics.totalCount>0:e.rows.length>0}))&&this.parent.trackContentfulRender()}renderUserMessages(){const e=this.getUserMessages(["visualization","visualizationOnEmbeddable"],{severity:"error"});e.length&&this.domNode&&Object(r.render)(Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(c.a,this.deps.coreStart,Object(v.jsx)(Ry,{errors:e,canEdit:this.getIsEditable()&&"edit"===this.input.viewMode})),Object(v.jsx)(Gy,{onMount:e=>{this.badgeDomNode=e,this.renderBadgeMessages()}})),this.domNode),this.renderBadgeMessages()}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t=this.getInput(),a={now:this.deps.data.nowProvider.get().getTime(),timeRange:void 0!==t.timeslice?{from:new Date(t.timeslice[0]).toISOString(),to:new Date(t.timeslice[1]).toISOString(),mode:"absolute"}:t.timeRange,query:[this.savedVis.state.query],filters:this.deps.injectFilterReferences(this.savedVis.state.filters,this.savedVis.references),disableWarningToasts:!0};return t.query&&(a.query=[t.query,...a.query]),null!==(e=t.filters)&&void 0!==e&&e.length&&(a.filters=[...t.filters.filter((e=>!e.meta.disabled)),...a.filters]),a}get onEditAction(){var e;const t=null===(e=this.savedVis)||void 0===e?void 0:e.visualizationType;if(t)return this.deps.visualizationMap[t].onEditAction}reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&this.domNode&&this.render(this.domNode)}async loadViewUnderlyingDataArgs(){if(!(this.savedVis&&this.activeData&&this.activeDatasource&&this.activeDatasourceState&&this.activeVisualization&&this.activeVisualizationState))return!1;const e=this.getMergedSearchContext();if(!e.timeRange)return!1;const t=function({activeDatasource:e,activeDatasourceState:t,activeVisualization:a,activeVisualizationState:n,activeData:i,dataViews:s,capabilities:l,query:r,filters:o,timeRange:u,esQueryConfig:c,indexPatternsCache:d}){const{error:p,meta:m}=hv(e,t,a,n,i,d,u,l);if(p||!m)return;const g=[],f=[];Array.isArray(r)&&r.forEach((e=>{Object(po.isOfQueryType)(e)?g.push(e):f.push(e)}));const{filters:b,query:h}=vv(g.length>0?g:r,o,m,s,c);return{dataViewSpec:d[m.id].spec,timeRange:u,filters:b,query:f.length>0?f[0]:h,columns:m.columns}}({activeDatasource:this.activeDatasource,activeDatasourceState:this.activeDatasourceState,activeVisualization:this.activeVisualization,activeVisualizationState:this.activeVisualizationState,activeData:this.activeData,dataViews:this.internalDataViews,capabilities:this.deps.capabilities,query:e.query,filters:e.filters||[],timeRange:e.timeRange,esQueryConfig:Object(Fl.getEsQueryConfig)(this.deps.uiSettings),indexPatternsCache:this.indexPatterns}),a=void 0!==t;return a&&(this.viewUnderlyingDataArgs=t),a}getViewUnderlyingDataArgs(){return this.viewUnderlyingDataArgs}canViewUnderlyingData(){return this.loadViewUnderlyingDataArgs()}async initializeOutput(){var e,t,a,n;if(!this.savedVis)return;const{indexPatterns:i}=await Object(Ct.getIndexPatternsObjects)((null===(e=this.savedVis)||void 0===e?void 0:e.references.map((({id:e})=>e)))||[],this.deps.dataViews);(await Promise.all(Object.values((null===(t=this.savedVis)||void 0===t?void 0:t.state.adHocDataViews)||{}).map((e=>this.deps.dataViews.create(e))))).forEach((e=>i.push(e))),this.internalDataViews=Object(pa.uniqBy)(i,"id");const s=this.getInput();!Boolean(this.isTextBasedLanguage())&&null==s.timeRange&&i.some((e=>e.isTimeBased()))&&this.addUserMessages([{uniqueId:"missing-time-range-on-embeddable",severity:"error",fixableInEditor:!1,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.shortMessage",{defaultMessage:"Missing timeRange property"}),longMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.longMessage",{defaultMessage:"The timeRange property is required for the given configuration"})}]),this.getUserMessages(zy,{severity:"error"}).length&&this.logError("validation");const l=s.hidePanelTitles?"":null!==(a=s.title)&&void 0!==a?a:this.savedVis.title,r=s.hidePanelTitles?"":null!==(n=s.description)&&void 0!==n?n:this.savedVis.description,o=s.savedObjectId;this.updateOutput({defaultTitle:this.savedVis.title,defaultDescription:this.savedVis.description,editable:this.getIsEditable(),inlineEditable:!0,title:l,description:r,editPath:Object(Wt.getEditPath)(o),editUrl:this.deps.basePath.prepend(`/app/lens${Object(Wt.getEditPath)(o)}`),indexPatterns:this.internalDataViews})}getIsEditable(){return!(Boolean(this.isTextBasedLanguage())&&!this.deps.uiSettings.get(wy))&&(this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards&&this.deps.capabilities.canOpenVisualizations)}getFilters(){try{var e,t,a,n;return Object(Fl.mapAndFlattenFilters)(this.deps.injectFilterReferences(null!==(e=null===(t=this.savedVis)||void 0===t?void 0:t.state.filters)&&void 0!==e?e:[],null!==(a=null===(n=this.savedVis)||void 0===n?void 0:n.references)&&void 0!==a?a:[]))}catch(e){return[]}}getQuery(){var e;return null===(e=this.savedVis)||void 0===e?void 0:e.state.query}getSavedVis(){if(!this.savedVis)return;const e={...this.savedVis};return delete e.type,delete e.savedObjectId,e}destroy(){this.isDestroyed=!0,super.destroy(),this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(r.unmountComponentAtNode)(this.domNode)}getSelfStyledOptions(){return{hideTitle:this.visDisplayOptions.noPanelTitle}}get visDisplayOptions(){var e,t,a,n;if(null===(e=this.savedVis)||void 0===e||!e.visualizationType)return{};let i=null!==(t=null===(a=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===a||null===(n=a.getDisplayOptions)||void 0===n?void 0:n.call(a))&&void 0!==t?t:{};return void 0!==this.input.noPadding&&(i={...i,noPadding:this.input.noPadding}),i}}var qy=a(30),$y=a(58),Hy=a(71);const Uy=({children:e,...t})=>Object(v.jsx)($y.HashRouter,t,Object(v.jsx)(Hy.CompatRouter,null,e)),Wy={services:{}},Xy=Object(s.createContext)(Wy),Yy=({children:e,component:t,render:a,...n})=>{const r=Object(s.useMemo)((()=>{if(t)return e=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Qy,null),Object(v.jsx)(t,e))}),[t]);if(r)return Object(v.jsx)($y.Route,i()({},n,{component:r}));if(a||"function"==typeof e){const t="function"==typeof e?e:a;return Object(v.jsx)($y.Route,i()({},n,{render:e=>Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Qy,null),t(e))}))}return Object(v.jsx)($y.Route,n,Object(v.jsx)(Qy,null),e)},Qy=()=>{const{executionContext:e}=Object(s.useContext)(Xy).services,t=Object($y.useRouteMatch)();return function(e,t){g()((()=>(null==e||e.set(t),()=>{null==e||e.clear()})),[t])}(e,{type:"application",page:t.path,id:Object.keys(t.params).length>0?JSON.stringify(t.params):void 0}),null},Ky=({legacySwitch:e=!0,children:t})=>{const a=Object($y.useRouteMatch)();return e?Object(v.jsx)($y.Switch,null,t):Object(v.jsx)(Hy.Routes,null,s.Children.map(t,(e=>{if(l.a.isValidElement(e)&&e.type===Yy){var n;const i=Object(pa.replace)(null==e?void 0:e.props.path,a.url+"/",""),s="function"==typeof(null==e?void 0:e.props.children)?null==e?void 0:e.props.children:null==e?void 0:e.props.render;return Object(v.jsx)(Hy.Route,{path:i,element:Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)(Qy,null),(null==e||null===(n=e.props)||void 0===n?void 0:n.component)&&Object(v.jsx)(e.props.component,null)||s&&s()||t)})}return e})))};a(535);var Zy=a(32),Jy=a(133);const ex=document.createElement("div");let tx=!1;function ax({anchorElement:e,isOpen:t,onClose:a}){const n=Object(co.X)(co.t),i=Object(co.W)(),l=Object(s.useCallback)((()=>{a(),Object(Uf.c)(new lr.Storage(localStorage),Jy.a,String(n)),i(n?Object(co.d)():Object(co.f)())}),[i,n,a]);return Object(v.jsx)(f.EuiWrappingPopover,{"data-test-subj":"lnsApp__settingsMenu",ownFocus:!0,button:e,closePopover:a,isOpen:!0},Object(v.jsx)(f.EuiPopoverTitle,null,Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.settings.title",defaultMessage:"Lens settings"})),Object(v.jsx)(f.EuiSwitch,{label:u.i18n.translate("xpack.lens.settings.autoApply",{defaultMessage:"Auto-apply visualization changes"}),checked:n,onChange:()=>l(),"data-test-subj":"lnsToggleAutoApply"}))}function nx(){o.a.unmountComponentAtNode(ex),document.body.removeChild(ex),tx=!1}const ix={width:1793,height:1086};function sx({application:e,data:t},a){return new URL(`${e.getUrlForApp("lens",{absolute:!0})}${null!=a&&a.savedObjectId?Object(Wt.getEditPath)(null==a?void 0:a.savedObjectId,t.query.timefilter.timefilter.getTime(),t.query.filterManager.getGlobalFilters(),t.query.timefilter.timefilter.getRefreshInterval()):""}`)}const lx=({setHeaderActionMenu:e,initialInput:t,indicateNoData:a,lensInspector:n,setIsSaveModalVisible:r,getIsByValueMode:d,runSave:p,onAppLeave:m,redirectToOrigin:g,datasourceMap:f,visualizationMap:b,title:h,goBackToOriginatingApp:y,contextOriginatingApp:x,initialContextIsEmbedded:j,topNavMenuEntryGenerators:O,initialContext:I,indexPatternService:M,currentDoc:T,onTextBasedSavedAndExit:w,getUserMessages:k,shortUrlService:E,isCurrentStateDirty:C,startServices:F})=>{var S,A;const{data:P,navigation:_,uiSettings:L,application:D,attributeService:R,share:N,dataViewFieldEditor:B,dataViewEditor:z,dataViews:G,notifications:q}=Object(Cl.useKibana)().services,{isSaveable:$,isLinkedToOriginatingApp:H,query:U,activeData:W,savedQuery:X,activeDatasourceId:Y,datasourceStates:Q,visualization:K,filters:Z,dataViews:J}=Object(co.X)((e=>e.lens)),ee=Object(co.W)(),te=l.a.useCallback((e=>ee(Object(co.O)(e))),[ee]),[ae,ne]=Object(s.useState)([]),[ie,se]=Object(s.useState)(),[le,re]=Object(s.useState)(!1),[oe,ue]=Object(s.useState)([]),ce=l.a.useCallback((async e=>{const t="string"==typeof e?e:e.id,a=await M.ensureIndexPattern({id:t,cache:J.indexPatterns});ee(Object(Ro.a)({dataViews:{indexPatterns:a},datasourceIds:Object.keys(Q),visualizationIds:K.activeId?[K.activeId]:[],indexPatternId:t}))}),[J.indexPatterns,Q,ee,M,K.activeId]),de=Boolean(null==z?void 0:z.userPermissions.editDataView())||!(null!=ie&&ie.isPersisted()),pe=Object(s.useRef)(),me=Object(s.useRef)(),ge=Object.values(Q).every((({isLoading:e})=>!1===e));Object(s.useEffect)((()=>{if(!(f&&Y&&!Q[Y].isLoading?f[Y]:void 0))return;const e=new Set(Object(Ct.getIndexPatternsIds)({activeDatasources:Object.keys(Q).reduce(((e,t)=>({...e,[t]:f[t]})),{}),datasourceStates:Q,visualizationState:K.state,activeVisualization:K.activeId?b[K.activeId]:void 0}));Object.values(J.indexPatterns).filter((e=>!e.isPersisted)).forEach((t=>{e.add(t.id)})),(ae.length+oe.length!==e.size||[...e].some((e=>![...ae.map((e=>e.id)),...oe].find((t=>t===e)))))&&Object(Ct.getIndexPatternsObjects)([...e],G).then((({indexPatterns:e,rejectedIds:t})=>{ne(e),ue(t)}))}),[Q,Y,oe,f,b,K,ae,G,J]),Object(s.useEffect)((()=>{(async()=>{if(Y&&Q[Y].state){const e=f[Y].getUsedDataView(Q[Y].state),t=e?await P.dataViews.get(e):void 0;se(null!=t?t:ae[0])}})()}),[Y,f,Q,ae,P.dataViews,le]),Object(s.useEffect)((()=>{"object"==typeof U&&null!==U&&Object(po.isOfAggregateQueryType)(U)&&re(!0)}),[U]),Object(s.useEffect)((()=>()=>{var e,t;null===(e=pe.current)||void 0===e||e.call(pe),null===(t=me.current)||void 0===t||t.call(me)}),[]);const{AggregateQueryTopNavMenu:fe}=_.ui,{from:be,to:he}=P.query.timefilter.timefilter.getTime(),ve=Boolean($&&D.capabilities.visualize.save),ye=Boolean($&&(null===(S=D.capabilities.dashboard)||void 0===S?void 0:S.showWriteControls)),xe=u.i18n.translate("xpack.lens.app.share.defaultDashboardTitle",{defaultMessage:"Lens Visualization [{date}]",values:{date:V()().toISOString(!0)}}),je=Object(s.useMemo)((()=>{if(!K.activeId)return;const e=K.activeId,t=O.flatMap((t=>{const a=t({datasourceStates:Q,visualizationId:e,visualizationState:K.state,query:U,filters:Z,initialContext:I,currentDoc:T});return a?[a]:[]}));return t.length>0?t:void 0}),[Q,O,K.activeId,K.state,U,Z,I,T]),Oe=null==N?void 0:N.url.locators.get("DISCOVER_APP_LOCATOR"),Ie=Object(s.useMemo)((()=>{if(Y&&Oe&&null!=K.activeId)return hv(f[Y],Q[Y].state,b[K.activeId],K.state,W,J.indexPatterns,P.query.timefilter.timefilter.getTime(),D.capabilities)}),[Y,Oe,K,f,Q,b,W,J.indexPatterns,P.query.timefilter.timefilter,D.capabilities]),Me=Object(Ta.useStore)(),Te=ae.filter((e=>!e.isPersisted())),we=Object(s.useMemo)((()=>{const e="dashboards"===(null==I?void 0:I.originatingApp)&&!(null!=t&&t.savedObjectId),a="canvas"===(null==I?void 0:I.originatingApp)&&!(null!=t&&t.savedObjectId),s=I&&"isEmbeddable"in I&&I.isEmbeddable,l=!(e||a)&&(H||Boolean(j)),O=Boolean(W&&Object.keys(W).length),M=Boolean($&&O),w=Boolean(D.capabilities.visualize.createShortUrl&&O),k=M||w,S=function(e){const{actions:t,savingToLibraryPermitted:a,savingToDashboardPermitted:n,contextOriginatingApp:i,showReplaceInDashboard:s,showReplaceInCanvas:l,contextFromEmbeddable:r,isByValueMode:o}=e,c=[],d=t.saveAndReturn.visible,p=a||n&&!o&&!d,m=o?u.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):t.saveAndReturn.visible?u.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):u.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});if(i&&!t.cancel.visible&&c.push({label:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:i}}),run:t.goBack.execute,className:"lnsNavItem__withDivider",testId:"lnsApp_goBackToAppButton",description:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:i}}),disableButton:!t.goBack.enabled}),t.getUnderlyingDataUrl.visible){var g,f;const e=u.i18n.translate("xpack.lens.app.exploreDataInDiscover",{defaultMessage:"Explore in Discover"});c.push({label:e,run:t.getUnderlyingDataUrl.execute,testId:"lnsApp_openInDiscover",className:"lnsNavItem__withDivider",description:e,disableButton:!t.getUnderlyingDataUrl.enabled,tooltip:t.getUnderlyingDataUrl.tooltip,target:"_blank",href:null===(g=(f=t.getUnderlyingDataUrl).getLink)||void 0===g?void 0:g.call(f)})}c.push({label:u.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect.execute,testId:"lnsApp_inspectButton",description:u.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),t.share.visible&&c.push({label:u.i18n.translate("xpack.lens.app.shareTitle",{defaultMessage:"Share"}),run:t.share.execute,testId:"lnsApp_shareButton",description:u.i18n.translate("xpack.lens.app.shareTitleAria",{defaultMessage:"Share visualization"}),disableButton:!t.share.enabled,tooltip:t.share.tooltip}),c.push({label:u.i18n.translate("xpack.lens.app.settings",{defaultMessage:"Settings"}),run:t.openSettings.execute,className:"lnsNavItem__withDivider",testId:"lnsApp_settingsButton",description:u.i18n.translate("xpack.lens.app.settingsAriaLabel",{defaultMessage:"Open the Lens settings menu"})}),t.cancel.visible&&c.push({label:u.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel.execute,testId:"lnsApp_cancelButton",description:u.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),c.push({label:m,iconType:s||l||d?void 0:"save",emphasize:!s&&!l&&!d,run:t.showSaveModal.execute,testId:"lnsApp_saveButton",description:u.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!p});const b=function({contextFromEmbeddable:e,showSaveAndReturn:t,showReplaceInDashboard:a,showReplaceInCanvas:n}){return t?{label:e?u.i18n.translate("xpack.lens.app.saveAndReplace",{defaultMessage:"Save and replace"}):u.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:e?"save":"checkInCircleFilled",testId:"lnsApp_saveAndReturnButton",description:u.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}:a?{label:u.i18n.translate("xpack.lens.app.replaceInDashboard",{defaultMessage:"Replace in dashboard"}),emphasize:!0,iconType:"merge",testId:"lnsApp_replaceInDashboardButton",description:u.i18n.translate("xpack.lens.app.replaceInDashboardButtonAriaLabel",{defaultMessage:"Replace legacy visualization with lens visualization and return to the dashboard"})}:n?{label:u.i18n.translate("xpack.lens.app.replaceInCanvas",{defaultMessage:"Replace in canvas"}),emphasize:!0,iconType:"merge",testId:"lnsApp_replaceInCanvasButton",description:u.i18n.translate("xpack.lens.app.replaceInCanvasButtonAriaLabel",{defaultMessage:"Replace legacy visualization with lens visualization and return to the canvas"})}:void 0}({showSaveAndReturn:d,showReplaceInDashboard:s,showReplaceInCanvas:l,contextFromEmbeddable:r});return b&&c.push({...b,run:t.saveAndReturn.execute,disableButton:!t.saveAndReturn.enabled}),c}({isByValueMode:d(),savingToLibraryPermitted:ve,savingToDashboardPermitted:ye,isSaveable:$,contextOriginatingApp:x,showReplaceInDashboard:e,showReplaceInCanvas:a,contextFromEmbeddable:s,actions:{inspect:{visible:!0,execute:()=>n.inspect({title:h})},share:{visible:!0,enabled:k,tooltip:()=>{if(!k)return u.i18n.translate("xpack.lens.app.shareButtonDisabledWarning",{defaultMessage:"The visualization has no data to share."})},execute:async e=>{var t,a,n,i,s;if(!N)return;if(null==K.activeId||!b[K.activeId])return;const{shareableUrl:l,savedObjectURL:r,reportingLocatorParams:o}=await async function(e,t,a,n,i){const{shareURL:s,reporting:l}=function(e,{filters:t,query:a,activeDatasourceId:n,datasourceStates:i,datasourceMap:s,visualizationMap:l,visualization:r,adHocDataViews:o,currentDoc:u},c){const d=Object(Ct.extractReferencesFromState)({activeDatasources:Object.keys(i).reduce(((e,t)=>({...e,[t]:s[t]})),{}),datasourceStates:i,visualizationState:r.state,activeVisualization:r.activeId?l[r.activeId]:void 0}),p=r,m=i,g={filters:t,query:a,resolvedDateRange:Object(Ct.getResolvedDateRange)(e.query.timefilter.timefilter),visualization:p,datasourceStates:m,activeDatasourceId:n,searchSessionId:e.search.session.getSessionId(),references:d,dataViewSpecs:o};return{shareURL:g,reporting:null!=u&&u.savedObjectId&&!c?{filters:t,query:a,resolvedDateRange:Object(Ct.getResolvedDateRange)(e.query.timefilter.timefilter),savedObjectId:null==u?void 0:u.savedObjectId}:g}}(t.data,a,i);return{shareableUrl:await(n?e(s):void 0),savedObjectURL:sx(t,a.currentDoc),reportingLocatorParams:l}}(E,{application:D,data:P},{filters:Z,query:U,activeDatasourceId:Y,datasourceStates:Q,datasourceMap:f,visualizationMap:b,visualization:K,currentDoc:T,adHocDataViews:Te.map((e=>e.toSpec()))},w,C),c={activeData:W,columnsSorting:null===(t=(a=b[K.activeId]).getSortedColumns)||void 0===t?void 0:t.call(a,K.state,Object(Dy.a)(Q,f,J.indexPatterns)),csvEnabled:M,reportingDisabled:!M,title:h||xe,locatorParams:{id:Zy.a,params:o},layout:{dimensions:null!==(n=null===(i=(s=b[K.activeId]).getReportingLayout)||void 0===i?void 0:i.call(s,K.state))&&void 0!==n?n:ix}};N.toggleShareContextMenu({anchorElement:e,allowEmbed:!1,allowShortUrl:!1,delegatedShareUrlHandler:()=>C||null==T||!T.savedObjectId?l:r.href,objectId:null==T?void 0:T.savedObjectId,objectType:"lens",objectTypeMeta:{title:u.i18n.translate("xpack.lens.app.shareModal.title",{defaultMessage:"Share this Lens visualization"})},sharingData:c,isDirty:C||!(null!=T&&T.savedObjectId),disabledShareUrl:Boolean(!(w||null!=T&&T.savedObjectId)),showPublicUrlSwitch:()=>!1,onClose:()=>{null==e||e.focus()},toasts:q.toasts})}},saveAndReturn:{visible:l,enabled:$,execute:()=>{var e;$&&(m((e=>e.default())),p({newTitle:h||(s?u.i18n.translate("xpack.lens.app.convertedLabel",{defaultMessage:"{title} (converted)",values:{title:I.title||`${I.visTypeTitle} visualization`}}):""),newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0,...s&&{newDescription:I.description},panelTimeRange:s?I.panelTimeRange:void 0},{saveToLibrary:null!==(e=t&&R.inputIsRefType(t))&&void 0!==e&&e}))}},showSaveModal:{visible:Boolean(ye||ve),execute:()=>{(ye||ve)&&r(!0)}},goBack:{visible:Boolean(x),enabled:Boolean(x),execute:()=>{x&&(null==y||y())}},cancel:{visible:Boolean(H),execute:()=>{g&&g()}},getUnderlyingDataUrl:{visible:Boolean(null==Ie?void 0:Ie.isVisible),enabled:!(null!=Ie&&Ie.error),tooltip:()=>null==Ie?void 0:Ie.error,execute:()=>{},getLink:()=>{var e;if(!Ie)return;const{error:t,meta:a}=Ie;if(t||!Oe||!a)return;const{filters:n,query:i}=vv(U,Z,a,ae,Object(Fl.getEsQueryConfig)(L));return Oe.getRedirectUrl({dataViewSpec:null===(e=J.indexPatterns[a.id])||void 0===e?void 0:e.spec,timeRange:P.query.timefilter.timefilter.getTime(),filters:n,query:le?U:i,columns:a.columns})}},openSettings:{visible:!0,execute:e=>function(e){if(tx)return void nx();tx=!0,document.body.appendChild(ex);const t=Object(v.jsx)(c.a,e.startServices,Object(v.jsx)(Ta.Provider,{store:e.lensStore},Object(v.jsx)(ax,i()({},e,{isOpen:tx,onClose:nx}))));o.a.render(t,ex)}({lensStore:Me,anchorElement:e,startServices:F})}}});return[...je||[],...S]}),[I,t,H,j,W,$,D,d,ve,ye,x,Ie,je,n,h,N,K,b,E,P,Z,U,Y,Q,f,T,Te,C,J.indexPatterns,xe,m,p,R,r,y,g,Oe,ae,L,le,Me,q.toasts,F]),ke=Object(s.useCallback)((e=>{const{dateRange:t,query:a}=e,n=P.query.timefilter.timefilter.getTime();t.from!==n.from||t.to!==n.to?P.query.timefilter.timefilter.setTime(t):te({searchSessionId:P.search.session.start(),resolvedDateRange:Object(Ct.getResolvedDateRange)(P.query.timefilter.timefilter)}),a&&(Object(pa.isEqual)(a,U)||(te({query:a}),Object(po.isOfAggregateQueryType)(a)&&!le&&(re(!0),ee(Object(co.R)({newDatasourceId:"textBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==ie?void 0:ie.id})))))}),[null==ie?void 0:ie.id,P.query.timefilter.timefilter,P.search.session,ee,te,le,U,null==K?void 0:K.activeId]),Ee=Object(s.useCallback)((e=>{te({savedQuery:e})}),[te]),Ce=Object(s.useCallback)((e=>{const t=Object(pa.cloneDeep)(e.attributes.filters||[]),a=P.query.filterManager.getGlobalFilters();P.query.filterManager.setFilters([...a,...t]),te({query:e.attributes.query,savedQuery:{...e}})}),[P.query.filterManager,te]),Fe=Object(s.useCallback)((()=>{P.query.filterManager.setFilters(P.query.filterManager.getGlobalFilters()),te({filters:P.query.filterManager.getGlobalFilters(),query:P.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[P.query.filterManager,P.query.queryString,te]),Se=Object(s.useCallback)((async()=>{null!=ie&&ie.id&&Object(Ct.refreshIndexPatternsList)({activeDatasources:Object.keys(Q).reduce(((e,t)=>({...e,[t]:f[t]})),{}),indexPatternId:ie.id,indexPatternService:M,indexPatternsCache:J.indexPatterns}),P.search.session.start()}),[ie,P.search.session,f,Q,M,J.indexPatterns]),Ae=Object(s.useMemo)((()=>de?async(e,t="edit")=>{if(null!=ie&&ie.id){const t=await P.dataViews.get(null==ie?void 0:ie.id);pe.current=await B.openEditor({ctx:{dataView:t},fieldName:e,onSave:()=>{t.isPersisted()?Se():M.replaceDataViewId(t)}})}}:void 0),[de,null==ie?void 0:ie.id,P.dataViews,B,M,Se]),Pe=Object(s.useMemo)((()=>de&&Ae?()=>Ae(void 0,"add"):void 0),[Ae,de]),_e=Object(s.useCallback)((()=>{me.current=z.openEditor({onSave:async e=>{e.id&&(le&&ee(Object(co.R)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==e?void 0:e.id})),ce(e),se(e))},allowAdHocDataView:!0})}),[z,ee,ce,le,null==K?void 0:K.activeId]),Le=Object(s.useCallback)((async e=>{var t;const a=await G.create(e);"date"===(null===(t=a.fields.getByName("@timestamp"))||void 0===t?void 0:t.type)&&(a.timeFieldName="@timestamp"),le&&ee(Object(co.R)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==a?void 0:a.id})),ce(a),se(a)}),[G,ee,ce,le,null==K?void 0:K.activeId]),De={trigger:{label:(null==ie||null===(A=ie.getName)||void 0===A?void 0:A.call(ie))||"","data-test-subj":"lns-dataView-switch-link",title:(null==ie?void 0:ie.title)||""},currentDataViewId:null==ie?void 0:ie.id,onAddField:Pe,onDataViewCreated:_e,onCreateDefaultAdHocDataView:Le,adHocDataViews:Te,onChangeDataView:async e=>{const t=await P.dataViews.get(e);se(t),ce(e),le&&(ee(Object(co.R)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:e})),re(!1))},onEditDataView:async e=>{if(ie)if(ie.isPersisted()){G.clearInstanceCache(ie.id);const e=await G.get(ie.id),t={...J.indexPatterns};delete t[ie.id];const a=await M.ensureIndexPattern({id:e.id,cache:t});ee(Object(Ro.a)({dataViews:{indexPatterns:a},indexPatternId:e.id})),te({searchSessionId:P.search.session.start(),resolvedDateRange:Object(Ct.getResolvedDateRange)(P.query.timefilter.timefilter)}),se(e)}else M.replaceDataViewId(e)}},Re=k("textBasedLanguagesQueryInput",{severity:"error"}).map((({shortMessage:e})=>new Error(e))),Ne=Object(co.X)(co.D);return Object(v.jsx)(fe,{setMenuMountPoint:e,config:we,saveQueryMenuVisibility:D.capabilities.visualize.saveQuery?"allowed_by_app_privilege":"globally_managed",badges:Ne?[(Be=u.i18n.translate("xpack.lens.managedBadgeTooltip",{defaultMessage:"This visualization is managed by Elastic. Changes made here must be saved in a new visualization."}),{"data-test-subj":"managedContentBadge",badgeText:u.i18n.translate("managedContentBadge.text",{defaultMessage:"Managed"}),title:u.i18n.translate("managedContentBadge.text",{defaultMessage:"Managed"}),color:"primary",iconType:"glasses",toolTipProps:{content:Be,position:"bottom"}})]:void 0,savedQuery:X,onQuerySubmit:ke,onSaved:Ee,onSavedQueryUpdated:Ce,onClearSavedQuery:Fe,indexPatterns:ae,query:U,dateRangeFrom:be,dateRangeTo:he,indicateNoData:a,showSearchBar:!0,dataViewPickerComponentProps:De,showDatePicker:ae.some((e=>e.isTimeBased()))||le||Boolean(ge&&Y&&f[Y].isTimeBased(Q[Y].state,J.indexPatterns)),textBasedLanguageModeErrors:Re,onTextBasedSavedAndExit:w,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:Wt.LENS_APP_NAME,displayStyle:"detached",className:"hide-for-sharing"});var Be};var rx=a(144);const ox=e=>JSON.parse(JSON.stringify(e)),ux=(e,t,a,n,i,s)=>{var l;if(void 0===e||void 0===t)return e===t;const r=ox(e),o=ox(t);if((null==r?void 0:r.visualizationType)!==(null==o?void 0:o.visualizationType))return!1;if(!Object(pa.isEqual)(r.state.query,o.state.query))return!1;const u=null===(l=i[r.visualizationType])||void 0===l?void 0:l.isEqual;if(!(u?(()=>{try{return u(r.state.visualization,r.references,o.state.visualization,o.references,s)}catch(e){return!1}})():Object(pa.isEqual)(r.state.visualization,o.state.visualization)))return!1;const c=Object.keys(r.state.datasourceStates),d=Object.keys(o.state.datasourceStates);let p=Object(pa.intersection)(c,d).length===Object(pa.union)(c,d).length;if(p&&(p=c.map((e=>n[e].isEqual(r.state.datasourceStates[e],[...r.references,...r.state.internalReferences||[]],o.state.datasourceStates[e],[...o.references,...o.state.internalReferences||[]]))).every((e=>e))),!p)return!1;const[m,g]=[r,o].map((e=>Object(rx.removePinnedFilters)(function(e,t){var a;return t?{...t,state:{...t.state,filters:e((null===(a=t.state)||void 0===a?void 0:a.filters)||[],t.references)}}:void 0}(a,e))));return!!Object(pa.isEqual)(null==m?void 0:m.state.filters,null==g?void 0:g.state.filters)};function cx({history:e,onAppLeave:t,redirectTo:a,editorFrame:n,initialInput:i,incomingState:r,redirectToOrigin:o,setHeaderActionMenu:c,datasourceMap:p,visualizationMap:m,contextOriginatingApp:g,topNavMenuEntryGenerators:b,initialContext:h,coreStart:y}){var x;const j=Object(Cl.useKibana)().services,{data:O,dataViews:I,uiActions:M,uiSettings:T,chrome:w,inspector:k,application:E,savedObjectsTagging:C,getOriginatingAppName:F,spaces:S,http:A,notifications:P,executionContext:_,locator:L,share:D,serverless:R}=j,N=Object(s.useRef)(),B=Object(co.W)(),z=Object(s.useCallback)((e=>B(Object(co.O)(e))),[B]),{persistedDoc:V,sharingSavedObjectProps:G,isLinkedToOriginatingApp:q,searchSessionId:$,datasourceStates:H,isLoading:U,isSaveable:W,visualization:X,annotationGroups:Y}=Object(co.X)((e=>e.lens)),Q=X.activeId?m[X.activeId]:void 0,K=Object(s.useMemo)((()=>({datasourceMap:p,visualizationMap:m,extractFilterReferences:O.query.filterManager.extract.bind(O.query.filterManager)})),[p,m,O.query.filterManager]),Z=Object(co.X)((e=>Object(co.F)(e,K))),J=Object(s.useMemo)((()=>null==D?void 0:D.url.shortUrls.get(null)),[D]),[ee,te]=Object(s.useState)(!1),[ae,ne]=Object(s.useState)(!1),[ie,se]=Object(s.useState)(void 0),[le,re]=Object(s.useState)(void 0),[oe,ue]=Object(s.useState)(!1),[ce,de]=Object(s.useState)(!1),pe=null==i?void 0:i.savedObjectId;Object(s.useEffect)((()=>{Z&&se(Z)}),[Z]);const me=Object(s.useCallback)((()=>{te(!0)}),[te]);Object(Cl.useExecutionContext)(_,{type:"application",id:pe||"new",page:"editor"}),Object(s.useEffect)((()=>{ee&&te(!1)}),[te,ee,$]);const ge=Object(s.useCallback)((()=>Boolean(q&&!pe)),[q,pe]);Object(s.useEffect)((()=>{t((e=>E.capabilities.visualize.save&&!ux(V,ie,O.query.filterManager.inject.bind(O.query.filterManager),p,m,Y)&&(W||V)?e.confirm(u.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave with unsaved changes?"}),u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),void 0,u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),"danger"):e.default()))}),[t,ie,W,V,E.capabilities.visualize.save,O.query.filterManager,p,m,Y]);const fe=Object(s.useCallback)((()=>{if(S&&"conflict"===(null==G?void 0:G.outcome)&&null!=V&&V.savedObjectId){const t=V.savedObjectId,a=null==G?void 0:G.aliasTargetId,n=A.basePath.prepend(`${Object(Wt.getEditPath)(a)}${e.location.search}`);return S.ui.components.getLegacyUrlConflict({objectNoun:u.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:a,otherObjectPath:n})}return null}),[V,G,S,A,e]);Object(s.useEffect)((()=>{const e=ge(),t=h&&"originatingApp"in h&&h.originatingApp,a=[];(q||t)&&F()&&o&&a.push({onClick:()=>{o()},text:F()}),e||a.push({href:E.getUrlForApp("visualize"),onClick:e=>{E.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:u.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=u.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});V&&(n=e?u.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):V.title),(null==V||!V.title)&&h&&"isEmbeddable"in h&&h.isEmbeddable&&(n=u.i18n.translate("xpack.lens.breadcrumbsEditInLensFromDashboard",{defaultMessage:"Converting {title} visualization",values:{title:h.title?`"${h.title}"`:h.visTypeTitle}}));const i={text:n};a.push(i),null!=R&&R.setBreadcrumbs?R.setBreadcrumbs(i):w.setBreadcrumbs(a)}),[F,o,ge,E,w,q,V,h,R]);const be=Object(s.useCallback)((()=>{N&&N.current&&N.current()}),[]),he=Object(s.useCallback)(((e,n)=>{var s;B(Object(co.b)());const l=(null==V?void 0:V.visualizationType)===X.activeId?null==V?void 0:V.state.visualization:void 0,u=null==Q||null===(s=Q.getTelemetryEventsOnSave)||void 0===s?void 0:s.call(Q,X.state,l);return u&&u.length&&Object(d.d)(u),Object(rx.runSaveLensVisualization)({lastKnownDoc:ie,getIsByValueMode:ge,savedObjectsTagging:C,initialInput:i,redirectToOrigin:o,persistedDoc:V,onAppLeave:t,redirectTo:a,switchDatasource:be,originatingApp:null==r?void 0:r.originatingApp,textBasedLanguageSave:ce,...j},e,n).then((e=>{e&&(z(e),ne(!1),de(!1))}),(()=>{}))}),[X.activeId,X.state,Q,B,ie,ge,C,i,o,V,t,a,be,null==r?void 0:r.originatingApp,ce,j,z]);Object(s.useEffect)((()=>{ie&&!le&&re(ie)}),[ie,le]);const ve=Object(s.useCallback)((()=>{if(h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl){const[e,a]=[le,V].map((e=>ux(e,ie,O.query.filterManager.inject,p,m,Y)));e||a?(t((e=>e.default())),E.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl})):ue(!0)}}),[Y,E,O.query.filterManager.inject,p,h,le,ie,t,V,m]),ye=Object(s.useCallback)((()=>{ue(!1),h&&"vizEditorOriginatingAppUrl"in h&&h.vizEditorOriginatingAppUrl&&(t((e=>e.default())),E.navigateToApp("visualize",{path:h.vizEditorOriginatingAppUrl}))}),[E,h,t]),xe=Object(s.useMemo)((()=>Boolean(h&&"originatingApp"in h&&h.originatingApp)),[h]),je=Object(s.useMemo)((()=>Do({dataViews:I,uiActions:M,core:{http:A,notifications:P,uiSettings:T},contextDataViewSpec:null==h?void 0:h.dataViewSpec,updateIndexPatterns:(e,t)=>{B(Object(co.U)(e)),null!=t&&t.applyImmediately&&B(Object(co.b)())},replaceIndexPattern:(e,t,a)=>{B(Object(Ro.i)({newIndexPattern:e,oldId:t})),null!=a&&a.applyImmediately&&B(Object(co.b)())}})),[I,M,A,P,T,h,B]),Oe=Object(s.useCallback)((async({onSave:e,onCancel:t})=>{ne(!0),de(!0),N.current=()=>{e()}}),[]),Ie=Object(s.useRef)({params:"",url:""}),Me=Object(s.useCallback)((async e=>{const t=JSON.stringify(e);if(Ie.current.params===t)return Ie.current.url;if(L&&J){const a=await J.createWithLocator({locator:L,params:e}),n=await a.locator.getUrl(a.params,{absolute:!0});return Ie.current={params:t,url:n},n}return""}),[L,J]),Te=Object(co.X)(co.D),we=h&&"isEmbeddable"in h&&h.isEmbeddable&&!V?u.i18n.translate("xpack.lens.app.replacePanel",{defaultMessage:"Replace panel on {originatingApp}",values:{originatingApp:null==h?void 0:h.originatingApp}}):void 0,ke=Object(co.X)(co.r),Ee=Object(co.X)((e=>Object(co.B)(e,p))),{getUserMessages:Ce,addUserMessages:Fe}=Object(Wo.c)({coreStart:y,framePublicAPI:Ee,activeDatasourceId:ke,datasourceState:ke&&H[ke]?H[ke]:null,datasource:ke&&p[ke]?p[ke]:null,dispatch:B,visualization:Q,visualizationType:X.activeId,visualizationState:X});return Object(v.jsx)(l.a.Fragment,null,Object(v.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp",role:"main"},Object(v.jsx)(lx,{initialInput:i,redirectToOrigin:o,getIsByValueMode:ge,onAppLeave:t,runSave:he,setIsSaveModalVisible:ne,setHeaderActionMenu:c,indicateNoData:ee,datasourceMap:p,visualizationMap:m,title:null==V?void 0:V.title,lensInspector:k,currentDoc:Z,isCurrentStateDirty:!ux(V,ie,O.query.filterManager.inject.bind(O.query.filterManager),p,m,Y),goBackToOriginatingApp:ve,contextOriginatingApp:g,initialContextIsEmbedded:xe,topNavMenuEntryGenerators:b,initialContext:h,indexPatternService:je,onTextBasedSavedAndExit:Oe,getUserMessages:Ce,shortUrlService:Me,startServices:y}),fe(),(!U||V)&&Object(v.jsx)(dx,{editorFrame:n,showNoDataPopover:me,lensInspector:k,indexPatternService:je,getUserMessages:Ce,addUserMessages:Fe})),ae&&Object(v.jsx)(rx.SaveModalContainer,{lensServices:j,originatingApp:q?null!==(x=null==r?void 0:r.originatingApp)&&void 0!==x?x:null==h?void 0:h.originatingApp:void 0,isSaveable:W,runSave:he,onClose:()=>{ne(!1)},getAppNameFromId:()=>F(),lastKnownDoc:ie,onAppLeave:t,persistedDoc:V,initialInput:i,redirectTo:a,redirectToOrigin:o,managed:Te,initialContext:h,returnToOriginSwitchLabel:null!=we?we:ge()&&i?u.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:F()}}):void 0}),oe&&Object(v.jsx)(f.EuiConfirmModal,{maxWidth:600,title:u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),onCancel:()=>ue(!1),onConfirm:ye,cancelButtonText:u.i18n.translate("xpack.lens.app.goBackModalCancelBtn",{defaultMessage:"Cancel"}),confirmButtonText:u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),buttonColor:"danger",defaultFocusedButton:"confirm","data-test-subj":"lnsApp_discardChangesModalOrigin"},u.i18n.translate("xpack.lens.app.goBackModalMessage",{defaultMessage:"Your changes here wonâ€™t work with your original {contextOriginatingApp} visualization. Leave with unsaved changes and return to {contextOriginatingApp}?",values:{contextOriginatingApp:g}})))}const dx=l.a.memo((function({editorFrame:e,showNoDataPopover:t,getUserMessages:a,addUserMessages:n,lensInspector:i,indexPatternService:s}){const{EditorFrameContainer:l}=e;return Object(v.jsx)(l,{showNoDataPopover:t,getUserMessages:a,addUserMessages:n,lensInspector:i,indexPatternService:s})}));async function px(e,t,a,n,i){const{data:s,inspector:l,navigation:r,embeddable:o,eventAnnotation:u,savedObjectsTagging:c,usageCollection:d,fieldFormats:p,spaces:m,share:g,unifiedSearch:f,serverless:b,contentManagement:h}=t,v=new lr.Storage(localStorage),y=null==o?void 0:o.getStateTransfer(),x=null==y?void 0:y.getIncomingEditorState(Wt.APP_ID),j=await u.getService();return{data:s,storage:v,inspector:Ay(l),navigation:r,contentManagement:h,fieldFormats:p,stateTransfer:y,usageCollection:d,savedObjectsTagging:c,attributeService:a,eventAnnotationService:j,uiActions:t.uiActions,savedObjectStore:new Qo.a(t.contentManagement),presentationUtil:t.presentationUtil,dataViewEditor:t.dataViewEditor,dataViewFieldEditor:t.dataViewFieldEditor,charts:t.charts,getOriginatingAppName:()=>{var e;const t=null!==(e=null==x?void 0:x.originatingApp)&&void 0!==e?e:null==n?void 0:n.originatingApp;return t?null==y?void 0:y.getAppNameFromId(t):void 0},dataViews:t.dataViews,spaces:m,share:g,unifiedSearch:f,locator:i,serverless:b,...e}}async function mx(e,t,n){const{createEditorFrame:o,attributeService:d,getPresentationUtilContext:p,topNavMenuEntryGenerators:m,locator:g}=n,[[b,h],y]=await Promise.all([e.getStartServices(),o()]),{contextType:x,initialContext:j,initialStateFromLocator:O,originatingApp:I}=function(e){const t=e.location.state;if(t){if(t.type===Zy.b)return{contextType:t.type,initialStateFromLocator:t.payload};if([Ih.ACTION_VISUALIZE_LENS_FIELD,oe.ACTION_CONVERT_TO_LENS].includes(t.type))return{contextType:t.type,initialContext:t.payload,originatingApp:t.originatingApp}}}(t.history)||{},M=await px(b,h,d,j,g),{stateTransfer:T,data:w,savedObjectStore:k,share:E}=M,C=null==T?void 0:T.getIncomingEditorState(Wt.APP_ID);var F,S;F=b.chrome,S=b.docLinks,F.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:S.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),M.application.capabilities.visualize.save||b.chrome.setBadge({text:u.i18n.translate("xpack.lens.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:u.i18n.translate("xpack.lens.badge.readOnly.tooltip",{defaultMessage:"Unable to save visualizations to the library"}),iconType:"glasses"}),b.chrome.docTitle.change(u.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"}));const A=e=>{var t;const a=j&&"originatingApp"in j?j.originatingApp:null,n=null!==(t=null==C?void 0:C.originatingApp)&&void 0!==t?t:a;if(!n)throw new Error("redirectToOrigin called without an originating app");let i=null==C?void 0:C.embeddableId;if(j&&"embeddableId"in j&&(i=j.embeddableId),T&&null!=e&&e.input){const{input:t,isCopied:a}=e;T.navigateToWithEmbeddablePackage(n,{path:null==C?void 0:C.originatingPath,state:{embeddableId:a?void 0:i,type:Wt.LENS_EMBEDDABLE_TYPE,input:t,searchSessionId:w.search.session.getSessionId()}})}else b.application.navigateToApp(n,{path:null==C?void 0:C.originatingPath})};x===Ih.ACTION_VISUALIZE_LENS_FIELD&&null!=j&&j.originatingApp&&delete j.originatingApp,null!=C&&C.searchSessionId&&w.search.session.continue(C.searchSessionId);const{datasourceMap:P,visualizationMap:_}=y,L={lensServices:M,datasourceMap:P,visualizationMap:_,embeddableEditorIncomingState:C,initialContext:j,initialStateFromLocator:O},D=Object(co.k)(L),R=l.a.memo((n=>{const[i,r]=Object(s.useState)("loading");Object(s.useEffect)((()=>{const e=Object(lr.createKbnUrlStateStorage)({history:n.history,useHash:M.uiSettings.get("state:storeInSessionStorage"),...Object(lr.withNotifyOnErrors)(M.notifications.toasts)}),{stop:t}=Object(Fl.syncGlobalQueryStateWithUrl)(w.query,e);return()=>{t()}}),[n.history]);const o=Object(s.useCallback)((e=>{var t,a;t=n.history,(a=e)?t.push({pathname:`/edit/${a}`,search:t.location.search}):t.push({pathname:"/",search:t.location.search})}),[n.history]),u=Object(s.useMemo)((()=>{return e=n.id,n.editByValue?null==C?void 0:C.valueInput:e?{savedObjectId:e}:void 0;var e}),[n.editByValue,n.id]),c=Object(s.useCallback)((()=>{j||w.query.filterManager.setAppFilters([]),j&&"isEmbeddable"in j&&j.isEmbeddable&&(w.query.filterManager.setAppFilters([]),w.query.queryString.clearQuery()),D.dispatch(Object(co.O)(Object(Ro.c)(L))),D.dispatch(Object(co.j)({redirectCallback:o,initialInput:u,history:n.history}))}),[u,n.history,o]);if(Object(s.useEffect)((()=>{(async()=>{await w.dataViews.hasData.hasUserDataView().catch((()=>!1))?(r("data"),c()):r("no_data")})()}),[c,u,n.history,o]),"loading"===i)return Object(v.jsx)(f.EuiLoadingSpinner,null);if("no_data"===i){const e={coreStart:b,dataViews:w.dataViews,dataViewEditor:h.dataViewEditor,share:E},t=a.e(7).then(a.bind(null,683)),n=Object(pe.a)(l.a.lazy((()=>t.then((({AnalyticsNoDataPageKibanaProvider:e})=>({default:e})))))),i=Object(pe.a)(l.a.lazy((()=>t.then((({AnalyticsNoDataPage:e})=>({default:e}))))));return Object(v.jsx)(n,e,Object(v.jsx)(i,{onDataViewCreated:()=>{r("data"),c()}}))}return Object(v.jsx)(Ta.Provider,{store:D},Object(v.jsx)(cx,{incomingState:C,editorFrame:y,initialInput:u,redirectTo:o,redirectToOrigin:A,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:n.history,datasourceMap:P,visualizationMap:_,initialContext:j,contextOriginatingApp:I,topNavMenuEntryGenerators:m,theme$:e.theme.theme$,coreStart:b,savedObjectStore:k}))})),N=e=>Object(v.jsx)(R,{id:e.match.params.id,history:e.history,editByValue:e.editByValue}),B=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const z=p();return Object(r.render)(Object(v.jsx)(c.a,b,Object(v.jsx)(Cl.KibanaContextProvider,{services:M},Object(v.jsx)(z,null,Object(v.jsx)(Uy,null,Object(v.jsx)(Ky,null,Object(v.jsx)(Yy,{exact:!0,path:"/edit/:id",component:N}),Object(v.jsx)(Yy,{exact:!0,path:`/${Wt.LENS_EDIT_BY_VALUE}`,render:e=>Object(v.jsx)(N,i()({},e,{editByValue:!0}))}),Object(v.jsx)(Yy,{exact:!0,path:"/",component:N}),Object(v.jsx)(Yy,{path:"/",component:function(){return Object(v.jsx)($t.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}})))))),t.element),()=>{var e;w.search.session.clear(),Object(r.unmountComponentAtNode)(t.element),M.inspector.close(),B(),D.dispatch(Object(co.l)()),null===(e=T.clearEditorState)||void 0===e||e.call(T,Wt.APP_ID)}}var gx=a(33);const fx=async(e,t)=>{const[a,n]=await Promise.all([t.loadVisualizations(),t.loadDatasources()]);return{async getChartInfo(t){var i,s;const l=t,r=Object(Ct.getActiveDatasourceIdFromDoc)(l);if(!r||null==l||!l.visualizationType)return;const o=null==l?void 0:l.state.datasourceStates[r],u=await n[r].getDatasourceInfo(o,null==l?void 0:l.references,e),c=null===(i=(s=a[l.visualizationType]).getVisualizationInfo)||void 0===i?void 0:i.call(s,null==l?void 0:l.state.visualization),d=null==c?void 0:c.layers.map((e=>{const t=u.find((t=>t.layerId===e.layerId)),a=e.dimensions.map((e=>({...e,...null==t?void 0:t.columns.find((t=>t.id===e.id))})));return{...e,dataView:null==t?void 0:t.dataView,dimensions:a}}));return d?{layers:d,visualizationType:l.visualizationType,filters:l.state.filters,query:l.state.query}:void 0}}};async function bx({hasDiscoverAccess:e,embeddable:t}){if(!e)return!1;try{return Object(qy.a)(t)&&await t.canViewUnderlyingData()}catch(e){return console.error(e),!1}}async function hx({embeddable:e,filters:t,dataViews:n,timeFieldName:i}){if(!Object(qy.a)(e))throw new Error("Can only be executed in the context of Lens visualization");const s=e.getViewUnderlyingDataArgs();if(!s)throw new Error("Underlying data is not ready");const l=await n.get(s.dataViewSpec.id);let r=[...t||[],...s.filters],o=s.timeRange;if(l.isTimeBased()&&l.timeFieldName===i){const{extractTimeRange:e}=await Promise.resolve().then(a.t.bind(null,38,7)),{restOfFilters:n,timeRange:s}=e(t||[],i);r=n,s&&(o=s)}return{...s,timeRange:o,filters:r}}async function vx({embeddable:e,locator:t,filters:a,dataViews:n,timeFieldName:i}){const s=await hx({embeddable:e,filters:a,dataViews:n,timeFieldName:i});return null==t?void 0:t.getRedirectUrl(s)}async function yx({embeddable:e,locator:t,filters:a,dataViews:n,timeFieldName:i}){const s=await hx({embeddable:e,filters:a,dataViews:n,timeFieldName:i}),l=null==t?void 0:t.getLocation(s);if(!l)throw new Error("Discover location not found");return l}async function xx({embeddable:e,locator:t,filters:a,openInSameTab:n,dataViews:i,timeFieldName:s,hasDiscoverAccess:l}){const r=await vx({embeddable:e,locator:t,filters:a,dataViews:i,timeFieldName:s,hasDiscoverAccess:l});window.open(r,n?"_self":"_blank")}a(540);var jx=a(34);async function Ox(e){if(null==e||!e.getInput)return!1;const t="edit"===e.getInput().viewMode;return Boolean(Object(jx.a)(e)&&e.getIsEditable()&&t)}async function Ix({embeddable:e,startDependencies:t,isNewPanel:a,deletePanel:n,...i}){if(!await Ox(e)||!Object(jx.a)(e))throw new Ih.IncompatibleActionError;const s=e.getRoot(),r=Object(Cy.c)(s)?s:void 0,o=await e.openConfingPanel(t,a,n);if(o){const t=i.overlays.openFlyout(Object(Rl.a)(l.a.cloneElement(o,{closeFlyout:()=>{r&&r.clearOverlays(),t.close()}}),i),{className:"lnsConfigPanel__overlay",size:"s","data-test-subj":"customizeLens",type:"push",paddingSize:"m",hideCloseButton:!0,onClose:e=>{r&&r.clearOverlays(),e.close()},outsideClickCloses:!0});null==r||r.openOverlay(t,{focusedPanelId:e.id})}}var Mx=a(70);const[Tx,wx]=Object(Mx.createGetterSetter)("VisualizationMap",!1),[kx,Ex]=Object(Mx.createGetterSetter)("DatasourceMap",!1);function Cx(e){return e.uiSettings.get(wy)}async function Fx({deps:e,core:t,api:a}){var n;const i=Cx(t),s=await(async()=>{const t=await async function(e){var t;const a=(await e.dataViews.getIndices({showAllIndices:!1,pattern:"*",isRollupIndex:()=>!1})).filter((e=>!e.name.startsWith("."))).map((e=>e.name));let n=a[0];return a.length>0&&a.find((e=>e.startsWith("logs")))&&(n="logs*"),null!==(t=n)&&void 0!==t?t:null}({dataViews:e.dataViews});return t?await ho(t,e.dataViews):null})();if(!i||!s)throw new Ih.IncompatibleActionError;const l=Tx(),r=kx(),o=s.getIndexPattern(),u={esql:`FROM ${o} | LIMIT 10`},c=new AbortController,d=await Object(zo.a)({esqlQuery:`from ${o}`,search:e.data.search.search,signal:c.signal}),p={dataViewSpec:s.toSpec(!1),fieldName:"",textBasedColumns:d,query:u},m=null!==(n=$o({context:p,dataView:s,datasourceMap:r,visualizationMap:l}))&&void 0!==n?n:[];if(!m.length)return;const[g]=m,f=Vo({filters:[],query:u,suggestion:g,dataView:s}),b=await a.addNewPanel({panelType:"lens",initialState:{attributes:f,id:Object(kt.a)()}});b&&Ix({embeddable:b,startDependencies:e,isNewPanel:!0,deletePanel:()=>{a.removePanel(b.id)},...t})}function Sx(e,t){const a=t.state.query;return!Object(po.isOfAggregateQueryType)(a)||e.uiSettings.get(wy)}async function Ax({deps:e,core:t,attributes:n,lensEvent:i,container:s,onUpdate:r,onApply:u,onCancel:c}){if(!Sx(t,n))throw new Ih.IncompatibleActionError;const{getEditLensConfiguration:d,getVisualizationMap:p,getDatasourceMap:m}=await Promise.resolve().then(a.bind(null,682)),g=p(),f=m(),b=n.state.query,h=Object(po.isOfAggregateQueryType)(b)?"textBased":"formBased",y=await d(t,e,g,f),x=Object(v.jsx)(y,{attributes:n,updatePanelState:(e,t,a)=>{if(n.state){const i={...n.state.datasourceStates,[h]:e},s=Object(Ct.extractReferencesFromState)({activeDatasources:Object.keys(i).reduce(((e,t)=>({...e,[t]:f[t]})),{}),datasourceStates:Object.fromEntries(Object.entries(i).map((([e,t])=>[e,{isLoading:!1,state:t}]))),visualizationState:t,activeVisualization:a?g[a]:void 0}),l={...n,state:{...n.state,visualization:t,datasourceStates:i},references:s,visualizationType:null!=a?a:n.visualizationType};r(l)}},lensAdapters:null==i?void 0:i.adapters,output$:null==i?void 0:i.embeddableOutput$,displayFlyoutHeader:!0,datasourceId:h,onApplyCb:u,onCancelCb:c,canEditTextBasedQuery:"textBased"===h,updateSuggestion:e=>{const t={...n,...e};r(t)},hideTimeFilterInfo:!0});if(s)o.a.render(x,s);else{const e=t.overlays.openFlyout(Object(Rl.a)(l.a.cloneElement(x,{closeFlyout:()=>{e.close()}}),t),{className:"lnsConfigPanel__overlay",size:"s","data-test-subj":"customizeLens",type:"push",paddingSize:"m",hideCloseButton:!0,onClose:e=>{e.close()},outsideClickCloses:!0})}}},,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(15),i=a.n(n),s=a(23),l=a(3),r=a.n(l),o=a(6),u=a(4),c={name:"1azakc",styles:"text-align:center"};const d=()=>{const e=c;return Object(u.jsx)("div",{css:e},Object(u.jsx)(o.EuiLoadingSpinner,null))},p=(e,t=Object(u.jsx)(d,null))=>r.a.forwardRef(((a,n)=>Object(u.jsx)(s.KibanaErrorBoundaryProvider,{analytics:a.analytics},Object(u.jsx)(s.KibanaErrorBoundary,null,Object(u.jsx)(l.Suspense,{fallback:t},Object(u.jsx)(e,i()({},a,{ref:n})))))))},function(e,t,a){"use strict";a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return p}));var n=a(15),i=a.n(n),s=a(3),l=a(6),r=a(0),o=a(648),u=a(4);const c=({idx:e,isInvalid:t,invalidMessage:a,onRemoveClick:n,removeTitle:s,children:c,draggableProvided:d,isNotRemovable:p,isNotDraggable:m,"data-test-subj":g="lns-customBucketContainer"})=>{var f;const{euiTheme:b}=Object(l.useEuiTheme)();return Object(u.jsx)(l.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0,"data-test-subj":g,style:{padding:"0 "+b.size.xs}},Object(u.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(u.jsx)(l.EuiFlexItem,i()({grow:!1},null!==(f=null==d?void 0:d.dragHandleProps)&&void 0!==f?f:{}),Object(u.jsx)(o.a,{tooltipContent:r.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragHandleDisabled",{defaultMessage:"Reordering requires more than one item."}),condition:null==m||m},Object(u.jsx)(l.EuiIcon,{size:"s",color:b.colors[t?"danger":m?"disabled":"subduedText"],type:t?"warning":"grab","aria-label":t?a:r.i18n.translate("visualizationUiComponents.customBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`${g}-dragToReorder-${e}`}))),Object(u.jsx)(l.EuiFlexItem,{grow:!0},c),Object(u.jsx)(l.EuiFlexItem,{grow:!1},Object(u.jsx)(o.a,{tooltipContent:r.i18n.translate("visualizationUiComponents.fieldsBucketContainer.deleteButtonDisabled",{defaultMessage:"A minimum of one item is required."}),condition:null!=p&&p},Object(u.jsx)(l.EuiButtonIcon,{iconSize:"s",iconType:"trash",color:"danger",onClick:n,"aria-label":s,disabled:p,"data-test-subj":`${g}-remove-${e}`})))))},d=({id:e,children:t,isInsidePanel:a,Container:n=c,...s})=>{const{euiTheme:r}=Object(l.useEuiTheme)();return Object(u.jsx)(l.EuiDraggable,{draggableId:e,customDragHandle:!0,index:s.idx,isDragDisabled:s.isNotDraggable,style:a?{}:{marginBottom:r.size.xs},spacing:"none",hasInteractiveChildren:!0,disableInteractiveElementBlocking:!0},((e,a)=>{var l;return Object(u.jsx)(n,i()({draggableProvided:e,isDragging:null!==(l=null==a?void 0:a.isDragging)&&void 0!==l&&l},s),t)}))};function p({items:e,onDragStart:t,onDragEnd:a,droppableId:n,children:i,bgColor:r}){const[o,c]=Object(s.useState)(!1),d=Object(s.useCallback)((({source:t,destination:n})=>{c(!1),t&&n&&(null==a||a(Object(l.euiDragDropReorder)(e,t.index,n.index)))}),[e,a]),p=Object(s.useCallback)((()=>{c(!0),null==t||t()}),[t]);return Object(u.jsx)(l.EuiDragDropContext,{onDragEnd:d,onDragStart:p},Object(u.jsx)(l.EuiPanel,{paddingSize:"none",color:o?"success":r,hasShadow:!1,hasBorder:!1},Object(u.jsx)(l.EuiDroppable,{droppableId:n,spacing:r?"m":"none",style:{backgroundColor:"transparent"}},i)))}}])]);