/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[10],{122:function(e,t,a){"use strict";function s(e,t){return t?o(e):e.aggregatable&&n(e,t)||(!e.aggregatable||"geo_point"===e.type||"geo_shape"===e.type)&&i(e,t)}function n(e,t){return!t&&!("document"===e.type||e.type.includes("range")||"geo_point"===e.type||"geo_shape"===e.type||"murmur3"===e.type||"attachment"===e.type)}function l(e,t){return!t&&"counter"===e.timeSeriesMetric}function i(e,t){return t?"string"===e.type&&!r(e)||["geo_point","geo_shape"].includes(e.type):"_score"!==e.name&&["string","text","keyword","version","ip","number","geo_point","geo_shape"].includes(e.type)}function r(e){var t;if("_id"===e.name)return!1;const a=null===(t=e.esTypes)||void 0===t?void 0:t[0];return Boolean("string"===e.type&&a&&["keyword","version"].includes(a))||["keyword","version","ip","number","boolean"].includes(e.type)}function o(e){return r(e)||i(e,!0)}a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return i})),a.d(t,"f",(function(){return r})),a.d(t,"e",(function(){return o}))},123:function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return n})),a.d(t,"e",(function(){return l})),a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return r}));const s=5e3,n=10,l=100,i=10,r=1e4},630:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return u}));var s=a(44);const n=["_type","_source"];function l(e,t,a,n,i){for(const r in t){if(!t.hasOwnProperty(r))continue;const o=t[r],u=a+r,c=null==n?void 0:n.fields.getByName(u);if(!1===(null==i?void 0:i.shallow)){const t="nested"===(null==c?void 0:c.type);if(Array.isArray(o)&&!t){for(let t=0;t<o.length;t++){const a=o[t];Object(s.isPlainObject)(a)&&l(e,a,u+".",n,i)}continue}}else if(void 0!==e[u])continue;const d=c&&"conflict"!==c.type,m=!Object(s.isPlainObject)(o);d||m?e[u]?Array.isArray(e[u])?e[u].push(o):e[u]=[e[u],o]:e[u]=o:l(e,o,u+".",n,i)}}var i=a(122),r=a(123);function o(e,t){if(e=Object(s.defaults)(e,{count:r.a}),!Object(i.b)(e.field,e.isTextBased))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=e.values,{groups:n,sampledValues:l}=function(e,t){const a={};let n=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let l,i=0;const r={};l=Array.isArray(e)?e:null==e?[]:[e],l.forEach((e=>{const s=t?t.convert(e):e;r[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:i++},r[s]=!0,n++)}))})),{groups:a,sampledValues:n}}(a,t);return{buckets:Object(s.sortBy)(n,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:l,sampledDocuments:e.values.length}}function u(e,t,a){return null!=t&&t.name?Object(s.map)(e,(function(e){return function(e,t,a){const s={};if(l(s,e.fields||{},"",t,a),!1!==(null==a?void 0:a.source)&&e._source)l(s,e._source,"",t,a);else if(null!=a&&a.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!e.ignored_field_values.hasOwnProperty(t))continue;const a=e.ignored_field_values[t];s[t]?Array.isArray(s[t])?s[t]=[...s[t],...a]:s[t]=[s[t],...a]:s[t]=a}if(null!=t&&t.metaFields)for(let a=0;a<(null==t?void 0:t.metaFields.length);a++){const l=null==t?void 0:t.metaFields[a];n.includes(l)||"_"!==l.charAt(0)||(s[l]=e[l])}return function(e,t){function a(e,a){var s,n;const l=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(e)),i=null==t||null===(n=t.metaFields)||void 0===n?void 0:n.includes(String(a));return l&&i?String(e).localeCompare(String(a)):l?1:i?-1:String(e).localeCompare(String(a))}return new Proxy(e,{ownKeys:e=>Reflect.ownKeys(e).sort(a)})}(s,t)}(e,a,{includeIgnoredValues:!0})[t.name]})):[]}},685:function(e,t,a){"use strict";a.r(t);var s=a(3),n=a.n(s),l=a(20),i=a.n(l);function r(e){return e.isDefault("dateFormat:tz")?i.a.tz.guess()||i()().format("Z"):e.get("dateFormat:tz","Browser")}var o=a(112),u=a(661),c=a(38),d=a(72),m=a.n(d),f=a(6),b=a(11),p=a(48),j=a(0),g=a(122),y=a(216),O=a(660),v=a(60);function x(e,t){const{ast:a}=Object(v.getAstAndSyntaxErrors)(e),s=a.find((({name:e})=>["from","metrics"].includes(e)));if(!s)return e;let n=-1;const l=a.find((({name:e},t)=>(n=t,"sort"===e)));if(!l||l&&1!==n){const a=e.substring(s.location.min,s.location.max+1);return e.replace(a,`${a} \n| LIMIT ${t}`)}const i=e.substring(s.location.min,l.location.max+1);return e.replace(i,`${i} \n| LIMIT ${t}`)}function F(e,t){return`${e}\n${t}`}var h=a(123),S=a(630);async function T(e,t=h.b){const{searchHandler:a,field:s,esqlBaseQuery:n}=e,l=D(s.name),i=D(`${s.name}_terms`),r=F(n,`| WHERE ${l} IS NOT NULL\n    | STATS ${i} = count(${l}) BY ${l}\n    | SORT ${i} DESC\n    | LIMIT ${t}`),o=await a({query:r}),u=null==o?void 0:o.values;if(null==u||!u.length)return{};const c=null==u?void 0:u.reduce(((e,t)=>e+t[0]),0);return{totalDocuments:c,sampledDocuments:c,sampledValues:c,topValues:{buckets:u.map((e=>({count:e[0],key:e[1]})))}}}function D(e){return`\`${e}\``}var V=a(598),E=a(4);const L=({areExamples:e,buckets:t,dataView:a,field:l,sampledValuesCount:i,color:r=w(),"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c})=>{if(null==t||!t.length)return null;const d=a.getFormatterForField(l),m=_(A(t),i),b=t.some((e=>!Number.isInteger(e.count/i)));return Object(E.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(E.jsx)("div",{"data-test-subj":`${o}-topValues`},t.map(((e,t)=>{const a=e.key,n=d.convert(a);return Object(E.jsx)(s.Fragment,{key:String(a)},t>0&&Object(E.jsx)(f.EuiSpacer,{size:"s"}),Object(E.jsx)(V.default,{field:l,fieldValue:a,formattedFieldValue:n,formattedPercentage:k(e.count,i,b),progressValue:M(e.count,i),count:e.count,color:r,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))})),m>0&&Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(f.EuiSpacer,{size:"s"}),Object(E.jsx)(V.default,{type:"other",field:l,fieldValue:void 0,formattedPercentage:k(m,i,b),progressValue:M(m,i),count:m,color:r,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))))},w=()=>Object(f.euiPaletteColorBlind)()[1],k=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",M=(e,t)=>t>0?e/t:0,A=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,_=(e,t)=>t&&e?t-e:0,B=({message:e})=>Object(E.jsx)(f.EuiText,{size:"s"},e),I=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!$(a))return null;const n=e.getFormatterForField(t),l=[{key:"min",label:j.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:n.convert(a.minValue,"text")},{key:"max",label:j.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:n.convert(a.maxValue,"text")}],i=[{field:"label",name:"",align:f.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(E.jsx)("strong",null,e),align:f.RIGHT_ALIGNMENT}],r=j.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(E.jsx)(f.EuiBasicTable,{compressed:!0,items:l,columns:i,tableCaption:r,"data-test-subj":`${s}-numberSummary`,responsiveBreakpoint:!1,css:Object(E.css)("& .euiTableHeaderCell{",Object(f.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function $(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}var C=a(669);const N=({services:e,query:t,dslQuery:a,filters:l,fromDate:i,toDate:d,dataViewOrDataViewId:v,field:V,color:k=w(),"data-test-subj":M="fieldStats",overrideMissingContent:C,overrideFooter:N,onAddFilter:R,overrideFieldTopValueBar:z,onStateChange:G})=>{const{fieldFormats:P,uiSettings:q,charts:Q,dataViews:H,data:U}=e,[K,W]=Object(s.useState)({isLoading:!1}),[Z,Y]=Object(s.useState)(null),J=Object(s.useRef)(null),X=Object(s.useRef)(!1),ee=!!t&&Object(c.isOfAggregateQueryType)(t),te=Object(s.useCallback)((e=>{X.current||W(e)}),[W,X]);Object(s.useEffect)((function(){G&&G(K)}),[G,K]);const ae=Object(s.useCallback)((e=>{X.current||Y(e)}),[Y,X]);async function se(){if(!X.current)try{var e;const s="string"==typeof v?await H.get(v):v;if(ae(s),K.isLoading)return;te((e=>({...e,isLoading:!0}))),null===(e=J.current)||void 0===e||e.abort(),J.current=new AbortController;const n=ee?await(async({services:e,dataView:t,field:a,fromDate:s,toDate:n,baseQuery:l,abortController:i})=>{const{data:r}=e;try{if(null==t||!t.id||null==a||!a.type)return{};const e=async({query:e})=>{const a=function({timeFieldName:e,fromDate:t,toDate:a}){return e?{range:{[e]:{gte:t,lte:a,format:"strict_date_optional_time"}}}:null}({timeFieldName:t.timeFieldName,fromDate:s,toDate:n});return(await Object(O.b)({esqlQuery:e,filter:a,search:r.search.search,signal:null==i?void 0:i.signal})).response};if(!("esql"in l))throw new Error("query must be of type AggregateQuery");return await async function(e){const{field:t}=e;return Object(g.e)(t)?"boolean"===t.type?await T(e,3):Object(g.f)(t)?await T(e):Object(g.b)(t,!0)?await async function(e){const{searchHandler:t,field:a,esqlBaseQuery:s}=e,n=D(a.name),l=F(s,`| WHERE ${n} IS NOT NULL\n    | KEEP ${n}\n    | LIMIT ${h.e}`),i=await t({query:l}),r=((null==i?void 0:i.values)||[]).map((e=>Array.isArray(e)&&1===e.length?e[0]:e));if(null==r||!r.length)return{};const o=null==r?void 0:r.length,u=Object(S.a)({values:r,field:a,count:h.a,isTextBased:!0});return{totalDocuments:o,sampledDocuments:u.sampledDocuments,sampledValues:u.sampledValues,topValues:{buckets:u.buckets,areExamples:!0}}}(e):{}:{}}({searchHandler:e,field:a,esqlBaseQuery:x(l.esql,h.c)})}catch(e){throw new Error("Could not provide field stats",{cause:e})}})({services:{data:U},dataView:s,field:V,fromDate:i,toDate:d,baseQuery:t,abortController:J.current}):await Object(y.a)({services:{data:U},dataView:s,field:V,fromDate:i,toDate:d,dslQuery:null!=a?a:Object(c.buildEsQuery)(s,null!=t?t:[],null!=l?l:[],Object(u.a)(q)),abortController:J.current});J.current=null,te((e=>({...e,isLoading:!1,totalDocuments:n.totalDocuments,sampledDocuments:n.sampledDocuments,sampledValues:n.sampledValues,histogram:n.histogram,topValues:n.topValues,numberSummary:n.numberSummary})))}catch(e){te((e=>({...e,isLoading:!1})))}}Object(s.useEffect)((()=>{se()}),[v,V,a,t,l,i,d,e]),Object(s.useEffect)((()=>()=>{var e;X.current=!0,null===(e=J.current)||void 0===e||e.abort()}),[]);const ne=Q.theme.useChartsBaseTheme(),le=Object(s.useMemo)((()=>k?{barSeriesStyle:{rect:{fill:k}}}:{}),[k]),{isLoading:ie,histogram:re,topValues:oe,numberSummary:ue,sampledValues:ce,sampledDocuments:de,totalDocuments:me}=K;let fe=!!K.histogram;const be=m.a.parse(i),pe=m.a.parse(d),je=A(null==oe?void 0:oe.buckets),ge=_(je,ce);je&&re&&re.buckets.length&&oe&&oe.buckets.length&&(fe=ge/je>.9);const[ye,Oe]=Object(s.useState)(fe);if(ie)return Object(E.jsx)(f.EuiLoadingSpinner,{"data-test-subj":`${M}-statsLoading`});if(!Z)return null;const ve=Z.getFormatterForField(V);let xe=Object(E.jsx)(n.a.Fragment,null);function Fe(t){const a=function(e,t,a,s){const l="unifiedFieldStats-statsFooter-docsCount",{fieldFormats:i}=t,{totalDocuments:r,sampledValues:u,sampledDocuments:c,topValues:d}=e;if(!r)return Object(E.jsx)(n.a.Fragment,null);let m;return m=a?null!=d&&d.areExamples?Object(E.jsx)(b.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":l},i.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(c))}}):Object(E.jsx)(b.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleValuesLabel",defaultMessage:"Calculated from {sampledValuesFormatted} sample {sampledValues, plural, one {value} other {values}}.",values:{sampledValues:u,sampledValuesFormatted:Object(E.jsx)("strong",{"data-test-subj":l},i.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(u))}}):c&&c<r?Object(E.jsx)(b.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:c,sampledDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":l},i.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(c))}}):Object(E.jsx)(b.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:r,totalDocumentsFormatted:Object(E.jsx)("strong",{"data-test-subj":l},i.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(r))}}),Object(E.jsx)(f.EuiText,{color:"subdued",size:"xs","data-test-subj":`${s}-statsFooter`},m)}(K,e,ee,M);return Object(E.jsx)(n.a.Fragment,null,xe?Object(E.jsx)("div",{"data-test-subj":`${M}-title`},xe):Object(E.jsx)(n.a.Fragment,null),Object(E.jsx)(f.EuiSpacer,{size:"s"}),t,N?null==N?void 0:N({element:a,totalDocuments:me,sampledDocuments:de}):Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(f.EuiSpacer,{size:"m"}),a))}if(!Object(g.d)(V,ee)){const e=Object(E.jsx)(B,{message:j.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return C?C({reason:"unsupported",element:e}):e}if(Object(g.c)(V,ee)&&$(ue))return xe=Object(E.jsx)(f.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,j.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),Fe(Object(E.jsx)(I,{dataView:Z,field:V,numberSummary:ue,"data-test-subj":M}));if(!(re&&0!==re.buckets.length||oe&&0!==oe.buckets.length)){const e=de&&me&&de<me?Object(E.jsx)(B,{message:j.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:de,sampledDocumentsFormatted:P.getDefaultInstance(o.b.NUMBER,[o.a.INTEGER]).convert(de)}})}):Object(E.jsx)(B,{message:j.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return C?C({reason:"no-data",element:e}):e}if(re&&re.buckets.length&&oe&&oe.buckets.length?xe=Object(E.jsx)(n.a.Fragment,null,Object(E.jsx)(f.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:j.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:j.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${M}-buttonGroup-topValuesButton`},{label:j.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${M}-buttonGroup-distributionButton`}],onChange:e=>{Oe("histogram"===e)},idSelected:ye?"histogram":"topValues"}),Object(E.jsx)(f.EuiSpacer,{size:"xs"})):"date"===V.type?xe=Object(E.jsx)(f.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,j.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):oe&&oe.buckets.length&&(xe=Object(E.jsx)(f.EuiTitle,{size:"xxxs"},Object(E.jsx)("h6",null,oe.areExamples?j.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):j.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),re&&re.buckets.length){const e=j.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===V.type)return Fe(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(E.jsx)("div",{"data-test-subj":`${M}-histogram`},Object(E.jsx)(p.Chart,{size:{height:200,width:268}},Object(E.jsx)(p.Tooltip,{type:p.TooltipType.None}),Object(E.jsx)(p.Settings,{locale:j.i18n.getLocale(),theme:le,baseTheme:ne,xDomain:be&&pe?{min:be.valueOf(),max:pe.valueOf(),minInterval:Math.round((pe.valueOf()-be.valueOf())/10)}:void 0}),Object(E.jsx)(p.Axis,{id:"key",position:p.Position.Bottom,tickFormat:be&&pe?Object(p.niceTimeFormatter)([be.valueOf(),pe.valueOf()]):void 0,showOverlappingTicks:!0}),Object(E.jsx)(p.HistogramBarSeries,{data:re.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:p.ScaleType.Time,yScaleType:p.ScaleType.Linear,timeZone:r(q)})))));if(ye||!oe||!oe.buckets.length)return Fe(Object(E.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(E.jsx)(p.Chart,{"data-test-subj":`${M}-histogram`,size:{height:200,width:"100%"}},Object(E.jsx)(p.Tooltip,{type:p.TooltipType.None}),Object(E.jsx)(p.Settings,{locale:j.i18n.getLocale(),rotation:90,theme:le,baseTheme:ne}),Object(E.jsx)(p.Axis,{id:"key",position:p.Position.Left,showOverlappingTicks:!0,tickFormat:e=>ve.convert(e)}),Object(E.jsx)(p.HistogramBarSeries,{data:re.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:p.ScaleType.Linear,yScaleType:p.ScaleType.Linear}))))}return oe&&oe.buckets.length?Fe(Object(E.jsx)(L,{areExamples:oe.areExamples,buckets:oe.buckets,dataView:Z,field:V,sampledValuesCount:ce,color:k,"data-test-subj":M,onAddFilter:R,overrideFieldTopValueBar:z})):null};t.default=e=>Object(E.jsx)(C.a,null,Object(E.jsx)(N,e))}}]);