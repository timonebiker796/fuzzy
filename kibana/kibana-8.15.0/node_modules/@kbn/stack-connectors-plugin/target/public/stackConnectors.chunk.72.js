/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[72],{152:function(e,n,t){"use strict";t.r(n),t.d(n,"SlackActionFieldsComponents",(function(){return f})),t.d(n,"simpleConnectorQueryClient",(function(){return g})),t.d(n,"default",(function(){return j}));var s=t(1),a=t(3),o=t(34),i=t(36),l=t(35),c=t(7),d=t(43),r=t(11),u=t(13);var b=t(2);const h=e=>[{id:"token",label:r.j,isPasswordField:!0,helpText:Object(b.jsx)(o.EuiLink,{href:e.links.alerting.slackApiAction,target:"_blank"},Object(b.jsx)(i.FormattedMessage,{id:"xpack.stackConnectors.components.slack_api.apiKeyDocumentation",defaultMessage:"Create a Slack Web API token"}))}],O=[],f=({readOnly:e,isEdit:n})=>{const{docLinks:t}=Object(a.useKibana)().services,o=Object(l.useFormContext)(),{setFieldValue:i}=o,[f]=Object(l.useFormData)({form:o}),[g,j]=Object(s.useState)(""),[C,p]=Object(s.useState)(""),{channels:v,isLoading:k,resetChannelsToValidate:m}=function(e){const{authToken:n,channelId:t}=e,[o,i]=Object(s.useState)([]),{http:l,notifications:{toasts:c}}=Object(a.useKibana)().services,b=o.some((e=>e.id===t))?"":t,{data:h,isLoading:O,isFetching:f}=Object(d.useQuery)({queryKey:["validChannels",n,b],queryFn:()=>(async(e,n,t)=>e.post(`${u.b}/_slack_api/channels/_valid`,{body:JSON.stringify({authToken:n,channelIds:[t]})}))(l,n,b),onError:()=>{c.addDanger(r.f)},enabled:(n||"").length>0&&(b||"").length>0,refetchOnWindowFocus:!1});return Object(s.useEffect)((()=>{var e,n,t;(null!==(e=null==h?void 0:h.invalidChannels)&&void 0!==e?e:[]).length>0&&c.addDanger(r.e(null!==(t=null==h?void 0:h.invalidChannels)&&void 0!==t?t:[])),(null!==(n=null==h?void 0:h.validChannels)&&void 0!==n?n:[]).length>0&&i((e=>{var n;return e.concat(null!==(n=null==h?void 0:h.validChannels)&&void 0!==n?n:[])}))}),[h,c]),{channels:o,resetChannelsToValidate:Object(s.useCallback)((e=>{0===e.length?i([]):i((n=>0===n.length?e:n.filter((n=>e.some((e=>e.id===n.id))))))}),[]),isLoading:O&&f}}({authToken:g,channelId:C}),y=Object(s.useCallback)(((e,n)=>{p(e)}),[]),F=Object(s.useCallback)((e=>{const n=e.map((e=>e.value));p(""),m(n)}),[m]),w=Object(s.useMemo)((()=>{const e=v.map((e=>({label:`${e.id} - ${e.name}`,value:e})));return(({options:e,isLoading:n,isDisabled:t,onChange:s,onCreateOption:a,selectedOptions:o})=>[{id:"allowedChannels",isRequired:!0,label:r.b,type:"COMBO_BOX",euiFieldProps:{noSuggestions:!0,isDisabled:t,isLoading:n,options:e,onChange:s,onCreateOption:a,selectedOptions:o}}])({options:e,isLoading:k,isDisabled:0===(g||"").length,onChange:F,onCreateOption:y,selectedOptions:e})}),[v,k,g,F,y]),E=Object(c.debounce)(j,250);Object(s.useEffect)((()=>{f.secrets&&f.secrets.token!==g&&E(f.secrets.token)}),[f.secrets]),Object(s.useEffect)((()=>{Object(c.isEmpty)(g)&&v.length>0&&i("config.allowedChannels",[])}),[g]),Object(s.useEffect)((()=>{var e;const n=(null==f||null===(e=f.config)||void 0===e?void 0:e.allowedChannels)||[];Object(c.isEqual)(n,v)||i("config.allowedChannels",v)}),[v]);const S=Object(s.useRef)(!1);return Object(s.useEffect)((()=>{var e;const n=(null==f||null===(e=f.config)||void 0===e?void 0:e.allowedChannels)||[];!S.current&&n.length>0&&!Object(c.isEqual)(n,v)&&(S.current=!0,m(f.config.allowedChannels))}),[f.config]),Object(b.jsx)(a.SimpleConnectorForm,{isEdit:n,readOnly:e,configFormSchema:O,secretsFormSchema:h(t),configFormSchemaAfterSecrets:w})},g=new d.QueryClient,j=e=>Object(b.jsx)(d.QueryClientProvider,{client:g},Object(b.jsx)(f,e))}}]);