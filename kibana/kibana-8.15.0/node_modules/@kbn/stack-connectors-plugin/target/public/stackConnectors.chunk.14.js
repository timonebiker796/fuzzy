/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[14,56],{49:function(e,n,t){"use strict";t.d(n,"a",(function(){return a}));const a=({connector_id:e,service_message:n,...t})=>({...t,actionId:e,...n&&{serviceMessage:n}})},50:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var a=t(1),r=t(3),o=t(23),s=t(4),c=t(49),i=t(0);const d=e=>i.i18n.translate("xpack.stackConnectors.components.genAi.error.dashboardApiError",{values:{apiProvider:e},defaultMessage:"Error finding {apiProvider} Token Usage Dashboard."}),u=({connectorId:e,selectedProvider:n})=>{const{dashboard:t,http:i,notifications:{toasts:u},spaces:A}=Object(r.useKibana)().services,[p,f]=Object(a.useState)(null);Object(a.useEffect)((()=>{let e=!1;return A&&A.getActiveSpace().then((n=>{e||f(n.id)})),()=>{e=!0}}),[A]);const[g,b]=Object(a.useState)(!1),[k,I]=Object(a.useState)(null),[v,O]=Object(a.useState)(!1),_=Object(a.useRef)(new AbortController),m=Object(a.useCallback)((n=>{var a;const r=null==t||null===(a=t.locator)||void 0===a?void 0:a.getRedirectUrl({query:{language:"kuery",query:`kibana.saved_objects: { id  : ${e} }`},dashboardId:n});I(null!=r?r:null)}),[e,null==t?void 0:t.locator]);return Object(a.useEffect)((()=>{let t=!1;return null!=p&&e.length>0&&!v&&(_.current.abort(),(async a=>{_.current=new AbortController,t||b(!0);try{const A=await async function({http:e,signal:n,dashboardId:t,connectorId:a}){const r=await e.post(`${o.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(a)}/_execute`,{body:JSON.stringify({params:{subAction:s.e.DASHBOARD,subActionParams:{dashboardId:t}}}),signal:n});return Object(c.a)(r)}({http:i,signal:_.current.signal,connectorId:e,dashboardId:a});var r,l;t||(O(!0),b(!1),null!==(r=A.data)&&void 0!==r&&r.available&&m(a),A.status&&"error"===A.status&&u.addDanger({title:d(n),text:`${null!==(l=A.serviceMessage)&&void 0!==l?l:A.message}`}))}catch(e){t||(O(!0),b(!1),u.addDanger({title:d(n),text:e.message}))}})(l(n,p))),()=>{t=!0,b(!1),_.current.abort()}}),[e,v,k,i,n,m,p,u]),{isLoading:g,dashboardUrl:k}},l=(e,n)=>{let t="openai";return e.toLowerCase().includes("bedrock")?t="bedrock":e.toLowerCase().includes("gemini")&&(t="gemini"),`generative-ai-token-usage-${t}-${n}`}},56:function(e,n,t){"use strict";t.r(n),t.d(n,"API_URL_LABEL",(function(){return r})),t.d(n,"API_KEY_LABEL",(function(){return o})),t.d(n,"DEFAULT_MODEL_LABEL",(function(){return s})),t.d(n,"DEFAULT_MODEL_TOOLTIP_CONTENT",(function(){return c})),t.d(n,"API_PROVIDER_LABEL",(function(){return i})),t.d(n,"OPENAI",(function(){return d})),t.d(n,"AZURE_AI",(function(){return u})),t.d(n,"DOCUMENTATION",(function(){return l})),t.d(n,"URL_LABEL",(function(){return A})),t.d(n,"BODY_REQUIRED",(function(){return p})),t.d(n,"BODY_INVALID",(function(){return f})),t.d(n,"ACTION_REQUIRED",(function(){return g})),t.d(n,"INVALID_ACTION",(function(){return b})),t.d(n,"API_PROVIDER_REQUIRED",(function(){return k})),t.d(n,"USAGE_DASHBOARD_LINK",(function(){return I}));var a=t(0);const r=a.i18n.translate("xpack.stackConnectors.components.genAi.apiUrlTextFieldLabel",{defaultMessage:"URL"}),o=a.i18n.translate("xpack.stackConnectors.components.genAi.apiKeySecret",{defaultMessage:"API key"}),s=a.i18n.translate("xpack.stackConnectors.components.genAi.defaultModelTextFieldLabel",{defaultMessage:"Default model"}),c=a.i18n.translate("xpack.stackConnectors.components.genAi.defaultModelTooltipContent",{defaultMessage:"If a request does not include a model, it uses the default."}),i=a.i18n.translate("xpack.stackConnectors.components.genAi.apiProviderLabel",{defaultMessage:"Select an OpenAI provider"}),d=a.i18n.translate("xpack.stackConnectors.components.genAi.openAi",{defaultMessage:"OpenAI"}),u=a.i18n.translate("xpack.stackConnectors.components.genAi.azureAi",{defaultMessage:"Azure OpenAI"}),l=a.i18n.translate("xpack.stackConnectors.components.genAi.documentation",{defaultMessage:"documentation"}),A=a.i18n.translate("xpack.stackConnectors.components.genAi.urlTextFieldLabel",{defaultMessage:"URL"}),p=a.i18n.translate("xpack.stackConnectors.components.genAi.error.requiredGenerativeAiBodyText",{defaultMessage:"Body is required."}),f=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.invalidBodyText",{defaultMessage:"Body does not have a valid JSON format."}),g=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.requiredActionText",{defaultMessage:"Action is required."}),b=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.invalidActionText",{defaultMessage:"Invalid action name."}),k=a.i18n.translate("xpack.stackConnectors.components.genAi.error.requiredApiProviderText",{defaultMessage:"API provider is required."}),I=(e,n)=>a.i18n.translate("xpack.stackConnectors.components.genAi.dashboardLink",{values:{apiProvider:e,connectorName:n},defaultMessage:'View {apiProvider} Usage Dashboard for "{ connectorName }" Connector'})},78:function(e,n,t){"use strict";t.r(n),t.d(n,"DashboardLink",(function(){return d})),t.d(n,"default",(function(){return d}));var a=t(1),r=t(34),o=t(3),s=t(56),c=t(50),i=t(2);const d=({connectorId:e,connectorName:n,selectedProvider:t="OpenAI"})=>{const{dashboardUrl:d}=Object(c.a)({connectorId:e,selectedProvider:t}),{services:{application:{navigateToUrl:u}}}=Object(o.useKibana)(),l=Object(a.useCallback)((e=>{e.preventDefault(),d&&u(d)}),[d,u]);return null!=d?Object(i.jsx)(r.EuiLink,{"data-test-subj":"link-gen-ai-token-dashboard",onClick:l,href:d},s.USAGE_DASHBOARD_LINK(t,n)):null}}}]);