/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[10,14,56],{49:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=({connector_id:e,service_message:t,...n})=>({...n,actionId:e,...t&&{serviceMessage:t}})},50:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1),o=n(3),r=n(23),s=n(4),i=n(49),c=n(0);const d=e=>c.i18n.translate("xpack.stackConnectors.components.genAi.error.dashboardApiError",{values:{apiProvider:e},defaultMessage:"Error finding {apiProvider} Token Usage Dashboard."}),u=({connectorId:e,selectedProvider:t})=>{const{dashboard:n,http:c,notifications:{toasts:u},spaces:A}=Object(o.useKibana)().services,[p,f]=Object(a.useState)(null);Object(a.useEffect)((()=>{let e=!1;return A&&A.getActiveSpace().then((t=>{e||f(t.id)})),()=>{e=!0}}),[A]);const[g,m]=Object(a.useState)(!1),[b,I]=Object(a.useState)(null),[O,k]=Object(a.useState)(!1),v=Object(a.useRef)(new AbortController),E=Object(a.useCallback)((t=>{var a;const o=null==n||null===(a=n.locator)||void 0===a?void 0:a.getRedirectUrl({query:{language:"kuery",query:`kibana.saved_objects: { id  : ${e} }`},dashboardId:t});I(null!=o?o:null)}),[e,null==n?void 0:n.locator]);return Object(a.useEffect)((()=>{let n=!1;return null!=p&&e.length>0&&!O&&(v.current.abort(),(async a=>{v.current=new AbortController,n||m(!0);try{const A=await async function({http:e,signal:t,dashboardId:n,connectorId:a}){const o=await e.post(`${r.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(a)}/_execute`,{body:JSON.stringify({params:{subAction:s.e.DASHBOARD,subActionParams:{dashboardId:n}}}),signal:t});return Object(i.a)(o)}({http:c,signal:v.current.signal,connectorId:e,dashboardId:a});var o,l;n||(k(!0),m(!1),null!==(o=A.data)&&void 0!==o&&o.available&&E(a),A.status&&"error"===A.status&&u.addDanger({title:d(t),text:`${null!==(l=A.serviceMessage)&&void 0!==l?l:A.message}`}))}catch(e){n||(k(!0),m(!1),u.addDanger({title:d(t),text:e.message}))}})(l(t,p))),()=>{n=!0,m(!1),v.current.abort()}}),[e,O,b,c,t,E,p,u]),{isLoading:g,dashboardUrl:b}},l=(e,t)=>{let n="openai";return e.toLowerCase().includes("bedrock")?n="bedrock":e.toLowerCase().includes("gemini")&&(n="gemini"),`generative-ai-token-usage-${n}-${t}`}},56:function(e,t,n){"use strict";n.r(t),n.d(t,"API_URL_LABEL",(function(){return o})),n.d(t,"API_KEY_LABEL",(function(){return r})),n.d(t,"DEFAULT_MODEL_LABEL",(function(){return s})),n.d(t,"DEFAULT_MODEL_TOOLTIP_CONTENT",(function(){return i})),n.d(t,"API_PROVIDER_LABEL",(function(){return c})),n.d(t,"OPENAI",(function(){return d})),n.d(t,"AZURE_AI",(function(){return u})),n.d(t,"DOCUMENTATION",(function(){return l})),n.d(t,"URL_LABEL",(function(){return A})),n.d(t,"BODY_REQUIRED",(function(){return p})),n.d(t,"BODY_INVALID",(function(){return f})),n.d(t,"ACTION_REQUIRED",(function(){return g})),n.d(t,"INVALID_ACTION",(function(){return m})),n.d(t,"API_PROVIDER_REQUIRED",(function(){return b})),n.d(t,"USAGE_DASHBOARD_LINK",(function(){return I}));var a=n(0);const o=a.i18n.translate("xpack.stackConnectors.components.genAi.apiUrlTextFieldLabel",{defaultMessage:"URL"}),r=a.i18n.translate("xpack.stackConnectors.components.genAi.apiKeySecret",{defaultMessage:"API key"}),s=a.i18n.translate("xpack.stackConnectors.components.genAi.defaultModelTextFieldLabel",{defaultMessage:"Default model"}),i=a.i18n.translate("xpack.stackConnectors.components.genAi.defaultModelTooltipContent",{defaultMessage:"If a request does not include a model, it uses the default."}),c=a.i18n.translate("xpack.stackConnectors.components.genAi.apiProviderLabel",{defaultMessage:"Select an OpenAI provider"}),d=a.i18n.translate("xpack.stackConnectors.components.genAi.openAi",{defaultMessage:"OpenAI"}),u=a.i18n.translate("xpack.stackConnectors.components.genAi.azureAi",{defaultMessage:"Azure OpenAI"}),l=a.i18n.translate("xpack.stackConnectors.components.genAi.documentation",{defaultMessage:"documentation"}),A=a.i18n.translate("xpack.stackConnectors.components.genAi.urlTextFieldLabel",{defaultMessage:"URL"}),p=a.i18n.translate("xpack.stackConnectors.components.genAi.error.requiredGenerativeAiBodyText",{defaultMessage:"Body is required."}),f=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.invalidBodyText",{defaultMessage:"Body does not have a valid JSON format."}),g=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.requiredActionText",{defaultMessage:"Action is required."}),m=a.i18n.translate("xpack.stackConnectors.security.genAi.params.error.invalidActionText",{defaultMessage:"Invalid action name."}),b=a.i18n.translate("xpack.stackConnectors.components.genAi.error.requiredApiProviderText",{defaultMessage:"API provider is required."}),I=(e,t)=>a.i18n.translate("xpack.stackConnectors.components.genAi.dashboardLink",{values:{apiProvider:e,connectorName:t},defaultMessage:'View {apiProvider} Usage Dashboard for "{ connectorName }" Connector'})},68:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return A})),n.d(t,"d",(function(){return p})),n.d(t,"g",(function(){return f})),n(1);var a=n(36),o=n(34),r=n(4),s=n(56),i=n(2);const c='{\n    "messages": [{\n        "role":"user",\n        "content":"Hello world"\n    }]\n}',d='{\n    "messages": [{\n        "role":"user",\n        "content":"Hello world"\n    }]\n}',u=[{id:"apiUrl",label:s.API_URL_LABEL,isUrlField:!0,defaultValue:"https://api.openai.com/v1/chat/completions",helpText:Object(i.jsx)(a.FormattedMessage,{defaultMessage:"The OpenAI API endpoint URL. For more information on the URL, refer to the {genAiAPIUrlDocs}.",id:"xpack.stackConnectors.components.genAi.openAiDocumentation",values:{genAiAPIUrlDocs:Object(i.jsx)(o.EuiLink,{"data-test-subj":"open-ai-api-doc",href:"https://platform.openai.com/docs/api-reference",target:"_blank"},`${s.OPENAI} ${s.DOCUMENTATION}`)}})},{id:"defaultModel",label:s.DEFAULT_MODEL_LABEL,helpText:Object(i.jsx)(a.FormattedMessage,{defaultMessage:"If a request does not include a model, it uses the default.",id:"xpack.stackConnectors.components.genAi.openAiDocumentationModel"}),defaultValue:r.a}],l=[{id:"apiUrl",label:s.API_URL_LABEL,isUrlField:!0,defaultValue:"https://{your-resource-name}.openai.azure.com/openai/deployments/{deployment-id}/chat/completions?api-version={api-version}",helpText:Object(i.jsx)(a.FormattedMessage,{defaultMessage:"The Azure OpenAI API endpoint URL. For more information on the URL, refer to the {genAiAPIUrlDocs}.",id:"xpack.stackConnectors.components.genAi.azureAiDocumentation",values:{genAiAPIUrlDocs:Object(i.jsx)(o.EuiLink,{"data-test-subj":"azure-ai-api-doc",href:"https://learn.microsoft.com/en-us/azure/cognitive-services/openai/reference",target:"_blank"},`${s.AZURE_AI} ${s.DOCUMENTATION}`)}})}],A=[{id:"apiKey",label:s.API_KEY_LABEL,isPasswordField:!0,helpText:Object(i.jsx)(a.FormattedMessage,{defaultMessage:"The OpenAI API authentication key for HTTP Basic authentication. For more details about generating OpenAI API keys, refer to the {genAiAPIKeyDocs}.",id:"xpack.stackConnectors.components.genAi.openAiApiKeyDocumentation",values:{genAiAPIKeyDocs:Object(i.jsx)(o.EuiLink,{"data-test-subj":"open-ai-api-keys-doc",href:"https://platform.openai.com/account/api-keys",target:"_blank"},`${s.OPENAI} ${s.DOCUMENTATION}`)}})}],p=[{id:"apiKey",label:s.API_KEY_LABEL,isPasswordField:!0,helpText:Object(i.jsx)(a.FormattedMessage,{defaultMessage:"The Azure API key for HTTP Basic authentication. For more details about generating Azure OpenAI API keys, refer to the {genAiAPIKeyDocs}.",id:"xpack.stackConnectors.components.genAi.azureAiApiKeyDocumentation",values:{genAiAPIKeyDocs:Object(i.jsx)(o.EuiLink,{"data-test-subj":"azure-ai-api-keys-doc",href:"https://learn.microsoft.com/en-us/azure/cognitive-services/openai/reference#authentication",target:"_blank"},`${s.AZURE_AI} ${s.DOCUMENTATION}`)}})}],f=[{value:r.d.OpenAi,text:s.OPENAI,label:s.OPENAI},{value:r.d.AzureAi,text:s.AZURE_AI,label:s.AZURE_AI}]},78:function(e,t,n){"use strict";n.r(t),n.d(t,"DashboardLink",(function(){return d})),n.d(t,"default",(function(){return d}));var a=n(1),o=n(34),r=n(3),s=n(56),i=n(50),c=n(2);const d=({connectorId:e,connectorName:t,selectedProvider:n="OpenAI"})=>{const{dashboardUrl:d}=Object(i.a)({connectorId:e,selectedProvider:n}),{services:{application:{navigateToUrl:u}}}=Object(r.useKibana)(),l=Object(a.useCallback)((e=>{e.preventDefault(),d&&u(d)}),[d,u]);return null!=d?Object(c.jsx)(o.EuiLink,{"data-test-subj":"link-gen-ai-token-dashboard",onClick:l,href:d},s.USAGE_DASHBOARD_LINK(n,t)):null}},96:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var a=n(1),o=n.n(a),r=n(3),s=n(37),i=n(34),c=n(35),d=n(38),u=n(78),l=n(4),A=n(56),p=n(68),f=n(2);const{emptyField:g}=d.fieldValidators,m=({readOnly:e,isEdit:t})=>{const{getFieldDefaultValue:n}=Object(c.useFormContext)(),[{config:d,id:m,name:b}]=Object(c.useFormData)({watch:["config.apiProvider"]}),I=Object(a.useMemo)((()=>{var e;return null!==(e=n("config.apiProvider"))&&void 0!==e?e:l.d.OpenAi}),[n]);return Object(f.jsx)(o.a.Fragment,null,Object(f.jsx)(c.UseField,{path:"config.apiProvider",component:s.SelectField,config:{label:A.API_PROVIDER_LABEL,defaultValue:I,validations:[{validator:g(A.API_PROVIDER_REQUIRED)}]},componentProps:{euiFieldProps:{"data-test-subj":"config.apiProvider-select",options:p.g,fullWidth:!0,hasNoInitialSelection:!0,disabled:e,readOnly:e}}}),Object(f.jsx)(i.EuiSpacer,{size:"s"}),null!=d&&d.apiProvider===l.d.OpenAi&&Object(f.jsx)(r.SimpleConnectorForm,{isEdit:t,readOnly:e,configFormSchema:p.e,secretsFormSchema:p.f}),null!=d&&d.apiProvider===l.d.AzureAi&&Object(f.jsx)(r.SimpleConnectorForm,{isEdit:t,readOnly:e,configFormSchema:p.c,secretsFormSchema:p.d}),t&&Object(f.jsx)(u.default,{connectorId:m,connectorName:b,selectedProvider:I}))}}}]);