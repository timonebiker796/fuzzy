/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[17,54],{145:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return j}));var a=s(1),n=s.n(a),i=s(0),o=s(34),r=s(3),c=s(23),l=s(49),u=s(55);var d=s(41);var b=s(2);const p=({selectedValue:e,http:t,toastNotifications:s,actionConnector:n,onChange:i})=>{const[r,p]=Object(a.useState)(null),[m,j]=Object(a.useState)([]),[g,O]=Object(a.useState)([]),{isLoading:f,issues:A}=(({http:e,actionConnector:t,toastNotifications:s,query:n})=>{const[i,o]=Object(a.useState)(!1),[r,b]=Object(a.useState)([]),p=Object(a.useRef)(new AbortController);return Object(a.useEffect)((()=>{let a=!1;const i=Object(d.debounce)(500,(async()=>{if(t&&!Object(d.isEmpty)(n)){p.current=new AbortController,o(!0);try{const d=await async function({http:e,signal:t,connectorId:s,title:a}){const n=await e.post(`${c.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(s)}/_execute`,{body:JSON.stringify({params:{subAction:"issues",subActionParams:{title:a}}}),signal:t});return Object(l.a)(n)}({http:e,signal:p.current.signal,connectorId:t.id,title:null!=n?n:""});var i,r;a||(o(!1),b(null!==(i=d.data)&&void 0!==i?i:[]),d.status&&"error"===d.status&&s.addDanger({title:u.ISSUES_API_ERROR,text:`${null!==(r=d.serviceMessage)&&void 0!==r?r:d.message}`}))}catch(e){a||(o(!1),s.addDanger({title:u.ISSUES_API_ERROR,text:e.message}))}}else o(!1)}));return p.current.abort(),i(),()=>{a=!0,o(!1),p.current.abort()}}),[e,t,s,n]),{issues:r,isLoading:i}})({http:t,toastNotifications:s,actionConnector:n,query:r}),{isLoading:E,issue:x}=(({http:e,toastNotifications:t,actionConnector:s,id:n})=>{const[i,o]=Object(a.useState)(!1),[r,d]=Object(a.useState)(null),b=Object(a.useRef)(new AbortController);return Object(a.useEffect)((()=>{let a=!1;return b.current.abort(),(async()=>{if(s&&n){b.current=new AbortController,o(!0);try{const p=await async function({http:e,signal:t,connectorId:s,id:a}){const n=await e.post(`${c.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(s)}/_execute`,{body:JSON.stringify({params:{subAction:"issue",subActionParams:{id:a}}}),signal:t});return Object(l.a)(n)}({http:e,signal:b.current.signal,connectorId:s.id,id:n});var i,r;a||(o(!1),d(null!==(i=p.data)&&void 0!==i?i:null),p.status&&"error"===p.status&&t.addDanger({title:u.GET_ISSUE_API_ERROR(n),text:`${null!==(r=p.serviceMessage)&&void 0!==r?r:p.message}`}))}catch(e){a||(o(!1),t.addDanger({title:u.GET_ISSUE_API_ERROR(n),text:e.message}))}}else o(!1)})(),()=>{a=!0,o(!1),b.current.abort()}}),[e,s,n,t]),{isLoading:i,issue:r}})({http:t,toastNotifications:s,actionConnector:n,id:e});Object(a.useEffect)((()=>O(A.map((e=>({label:e.title,value:e.key}))))),[A]),Object(a.useEffect)((()=>{if(E||null==x)return;const e=[{label:x.title,value:x.key}];O(e),j(e)}),[x,E]);const h=Object(a.useCallback)((e=>{p(e)}),[]),y=Object(a.useCallback)((e=>{j(e),i(e[0].value)}),[i]),S=Object(a.useMemo)((()=>f||E?u.SEARCH_ISSUES_LOADING:u.SEARCH_ISSUES_PLACEHOLDER),[f,E]);return Object(b.jsx)(o.EuiComboBox,{singleSelection:!0,fullWidth:!0,placeholder:S,"data-test-subj":"search-parent-issues","aria-label":u.SEARCH_ISSUES_COMBO_BOX_ARIA_LABEL,options:g,isLoading:f||E,onSearchChange:h,selectedOptions:m,onChange:y})},m=Object(a.memo)(p),j=({actionConnector:e,actionParams:t,editAction:s,errors:d,index:p,messageVariables:j})=>{var g,O,f,A,E,x,h,y;const{http:S,notifications:{toasts:_}}=Object(r.useKibana)().services,{incident:C,comments:I}=Object(a.useMemo)((()=>{var e;return null!==(e=t.subActionParams)&&void 0!==e?e:{incident:{},comments:[]}}),[t.subActionParams]),R=Object(a.useRef)(null!==(g=null==e?void 0:e.id)&&void 0!==g?g:""),{isLoading:v,issueTypes:P}=(({http:e,actionConnector:t,toastNotifications:s})=>{const[n,i]=Object(a.useState)(!0),[o,r]=Object(a.useState)([]),d=Object(a.useRef)(new AbortController);return Object(a.useEffect)((()=>{let a=!1;return d.current.abort(),(async()=>{if(t){d.current=new AbortController,i(!0);try{const b=await async function({http:e,signal:t,connectorId:s}){const a=await e.post(`${c.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(s)}/_execute`,{body:JSON.stringify({params:{subAction:"issueTypes",subActionParams:{}}}),signal:t});return Object(l.a)(a)}({http:e,signal:d.current.signal,connectorId:t.id});var n,o;a||(i(!1),r(null!==(n=b.data)&&void 0!==n?n:[]),b.status&&"error"===b.status&&s.addDanger({title:u.ISSUE_TYPES_API_ERROR,text:`${null!==(o=b.serviceMessage)&&void 0!==o?o:b.message}`}))}catch(e){a||(i(!1),s.addDanger({title:u.ISSUE_TYPES_API_ERROR,text:e.message}))}}else i(!1)})(),()=>{a=!0,i(!1),d.current.abort()}}),[e,t,s]),{issueTypes:o,isLoading:n}})({http:S,toastNotifications:_,actionConnector:e}),{isLoading:T,fields:k}=(({http:e,toastNotifications:t,actionConnector:s,issueType:n})=>{const[i,o]=Object(a.useState)(!0),[r,d]=Object(a.useState)({}),b=Object(a.useRef)(new AbortController);return Object(a.useEffect)((()=>{let a=!1;return b.current.abort(),(async()=>{if(s&&n){b.current=new AbortController,o(!0);try{const p=await async function({http:e,signal:t,connectorId:s,id:a}){const n=await e.post(`${c.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(s)}/_execute`,{body:JSON.stringify({params:{subAction:"fieldsByIssueType",subActionParams:{id:a}}}),signal:t});return Object(l.a)(n)}({http:e,signal:b.current.signal,connectorId:s.id,id:n});var i,r;a||(d(null!==(i=p.data)&&void 0!==i?i:{}),o(!1),p.status&&"error"===p.status&&t.addDanger({title:u.FIELDS_API_ERROR,text:`${null!==(r=p.serviceMessage)&&void 0!==r?r:p.message}`}))}catch(e){a||(o(!1),t.addDanger({title:u.FIELDS_API_ERROR,text:e.message}))}}else o(!1)})(),()=>{a=!0,o(!1),b.current.abort()}}),[e,s,n,t]),{isLoading:i,fields:r}})({http:S,toastNotifications:_,actionConnector:e,issueType:null!==(O=C.issueType)&&void 0!==O?O:""}),L=Object(a.useCallback)(((e,t)=>s("subActionParams","issueType"===e?{incident:{issueType:t},comments:I}:"comments"===e?{incident:C,comments:t}:{incident:{...C,[e]:t},comments:I},p)),[I,s,C,p]),M=Object(a.useCallback)(((e,t)=>{L(e,[{commentId:"1",comment:t}])}),[L]),{hasLabels:F,hasDescription:w,hasPriority:U,hasParent:N}=Object(a.useMemo)((()=>null!=k?{hasLabels:Object.prototype.hasOwnProperty.call(k,"labels"),hasDescription:Object.prototype.hasOwnProperty.call(k,"description"),hasPriority:Object.prototype.hasOwnProperty.call(k,"priority"),hasParent:Object.prototype.hasOwnProperty.call(k,"parent")}:{hasLabels:!1,hasDescription:!1,hasPriority:!1,hasParent:!1}),[k]),D=Object(a.useMemo)((()=>{const e=null==C.issueType||!P.length||P.some((e=>e.id===C.issueType));var t;return C.issueType&&e||!(P.length>0)||L("issueType",null!==(t=P[0].id)&&void 0!==t?t:""),P.map((e=>{var t,s;return{value:null!==(t=e.id)&&void 0!==t?t:"",text:null!==(s=e.name)&&void 0!==s?s:""}}))}),[L,C,P]),B=Object(a.useMemo)((()=>{if(null!=C.issueType&&null!=k){const t=null!=k.priority?k.priority.allowedValues:[],s=t.some((e=>e.name===C.priority));var e;return C.priority&&s||!(t.length>0)||L("priority",null!==(e=t[0].name)&&void 0!==e?e:""),t.map((e=>({value:e.name,text:e.name})))}return[]}),[L,k,C.issueType,C.priority]);Object(a.useEffect)((()=>{T||U||null==C.priority||L("priority",null)}),[U,T]);const H=Object(a.useMemo)((()=>C.labels?C.labels.map((e=>({label:e}))):[]),[C.labels]);Object(a.useEffect)((()=>{null!=e&&R.current!==e.id&&(R.current=e.id,s("subActionParams",{incident:{},comments:[]},p))}),[e]),Object(a.useEffect)((()=>{t.subAction||s("subAction","pushToService",p),t.subActionParams||s("subActionParams",{incident:{},comments:[]},p)}),[t]);const V=null!=d["subActionParams.incident.labels"]&&void 0!==d["subActionParams.incident.labels"]&&d["subActionParams.incident.labels"].length>0&&void 0!==C.labels;return Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiFormRow,{fullWidth:!0,label:i.i18n.translate("xpack.stackConnectors.components.jira.urgencySelectFieldLabel",{defaultMessage:"Issue type"})},Object(b.jsx)(o.EuiSelect,{fullWidth:!0,isLoading:v,disabled:v||T,"data-test-subj":"issueTypeSelect",options:D,value:null!==(f=C.issueType)&&void 0!==f?f:void 0,onChange:e=>L("issueType",e.target.value)})),Object(b.jsx)(o.EuiHorizontalRule,null),N&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiFlexGroup,null,Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiFormRow,{fullWidth:!0,label:i.i18n.translate("xpack.stackConnectors.components.jira.parentIssueSearchLabel",{defaultMessage:"Parent issue"})},Object(b.jsx)(m,{selectedValue:C.parent,http:S,toastNotifications:_,actionConnector:e,onChange:e=>{L("parent",e)}})))),Object(b.jsx)(o.EuiSpacer,{size:"m"})),Object(b.jsx)(n.a.Fragment,null,U&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiFlexGroup,{"data-test-subj":"priority-wrapper"},Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiFormRow,{fullWidth:!0,label:i.i18n.translate("xpack.stackConnectors.components.jira.severitySelectFieldLabel",{defaultMessage:"Priority"})},Object(b.jsx)(o.EuiSelect,{fullWidth:!0,isLoading:T,disabled:v||T,"data-test-subj":"prioritySelect",options:B,value:null!==(A=C.priority)&&void 0!==A?A:void 0,onChange:e=>{L("priority",e.target.value)}})))),Object(b.jsx)(o.EuiSpacer,{size:"m"})),Object(b.jsx)(o.EuiFormRow,{"data-test-subj":"summary-row",fullWidth:!0,error:d["subActionParams.incident.summary"],isInvalid:void 0!==d["subActionParams.incident.summary"]&&d["subActionParams.incident.summary"].length>0&&void 0!==C.summary,label:i.i18n.translate("xpack.stackConnectors.components.jira.summaryFieldLabel",{defaultMessage:"Summary"}),labelAppend:Object(b.jsx)(o.EuiText,{size:"xs",color:"subdued"},i.i18n.translate("xpack.stackConnectors.components.jira.summaryFieldRequiredLabel",{defaultMessage:"Required"}))},Object(b.jsx)(r.TextFieldWithMessageVariables,{index:p,editAction:L,messageVariables:j,paramsProperty:"summary",inputTargetValue:null!==(E=C.summary)&&void 0!==E?E:void 0,errors:d["subActionParams.incident.summary"]})),Object(b.jsx)(o.EuiSpacer,{size:"m"}),F&&Object(b.jsx)(n.a.Fragment,null,Object(b.jsx)(o.EuiFlexGroup,{"data-test-subj":"labels-wrapper"},Object(b.jsx)(o.EuiFlexItem,null,Object(b.jsx)(o.EuiFormRow,{fullWidth:!0,label:i.i18n.translate("xpack.stackConnectors.components.jira.impactSelectFieldLabel",{defaultMessage:"Labels"}),error:d["subActionParams.incident.labels"],isInvalid:V},Object(b.jsx)(o.EuiComboBox,{noSuggestions:!0,fullWidth:!0,isLoading:T,isDisabled:v||T,selectedOptions:H,onCreateOption:e=>{const t=[...H,{label:e}];L("labels",t.map((e=>e.label)))},onChange:e=>{L("labels",e.map((e=>e.label)))},onBlur:()=>{C.labels||L("labels",[])},isClearable:!0,"data-test-subj":"labelsComboBox",isInvalid:V})))),Object(b.jsx)(o.EuiSpacer,{size:"m"})),w&&Object(b.jsx)(r.TextAreaWithMessageVariables,{index:p,editAction:L,messageVariables:j,paramsProperty:"description",inputTargetValue:null!==(x=C.description)&&void 0!==x?x:void 0,label:i.i18n.translate("xpack.stackConnectors.components.jira.descriptionTextAreaFieldLabel",{defaultMessage:"Description"})}),Object(b.jsx)(r.TextAreaWithMessageVariables,{index:p,editAction:M,messageVariables:j,paramsProperty:"comments",inputTargetValue:I&&I.length>0?I[0].comment:void 0,label:i.i18n.translate("xpack.stackConnectors.components.jira.commentsTextAreaFieldLabel",{defaultMessage:"Additional comments"})}),Object(b.jsx)(o.EuiFormRow,{fullWidth:!0,error:d["subActionParams.incident.otherFields"],isInvalid:void 0!==d["subActionParams.incident.otherFields"]&&d["subActionParams.incident.otherFields"].length>0},Object(b.jsx)(r.JsonEditorWithMessageVariables,{messageVariables:j,paramsProperty:"otherFields",inputTargetValue:null===(h=t.subActionParams)||void 0===h||null===(y=h.incident)||void 0===y?void 0:y.otherFields,errors:d.otherFields,label:Object(b.jsx)(n.a.Fragment,null,i.i18n.translate("xpack.stackConnectors.components.jira.otherFieldsFieldLabel",{defaultMessage:"Additional fields"}),Object(b.jsx)(o.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop","data-test-subj":"otherFieldsHelpTooltip","aria-label":i.i18n.translate("xpack.stackConnectors.components.jira.otherFieldsHelpTooltip",{defaultMessage:"Additional fields help"}),content:i.i18n.translate("xpack.stackConnectors.components.jira.otherFieldsHelpText",{defaultMessage:"Additional fields are not validated by the connector. To avoid failed actions, ensure compliance with your Jira policies."})})),onDocumentsChange:e=>{L("otherFields",""===e?null:e)}}))))}},49:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a=({connector_id:e,service_message:t,...s})=>({...s,actionId:e,...t&&{serviceMessage:t}})},55:function(e,t,s){"use strict";s.r(t),s.d(t,"API_URL_LABEL",(function(){return n})),s.d(t,"JIRA_PROJECT_KEY_LABEL",(function(){return i})),s.d(t,"JIRA_EMAIL_LABEL",(function(){return o})),s.d(t,"JIRA_API_TOKEN_LABEL",(function(){return r})),s.d(t,"SUMMARY_REQUIRED",(function(){return c})),s.d(t,"ISSUE_TYPES_API_ERROR",(function(){return l})),s.d(t,"FIELDS_API_ERROR",(function(){return u})),s.d(t,"ISSUES_API_ERROR",(function(){return d})),s.d(t,"GET_ISSUE_API_ERROR",(function(){return b})),s.d(t,"SEARCH_ISSUES_COMBO_BOX_ARIA_LABEL",(function(){return p})),s.d(t,"SEARCH_ISSUES_PLACEHOLDER",(function(){return m})),s.d(t,"SEARCH_ISSUES_LOADING",(function(){return j})),s.d(t,"LABELS_WHITE_SPACES",(function(){return g})),s.d(t,"INVALID_JSON_FORMAT",(function(){return O})),s.d(t,"OTHER_FIELDS_LENGTH_ERROR",(function(){return f}));var a=s(0);const n=a.i18n.translate("xpack.stackConnectors.components.jira.apiUrlTextFieldLabel",{defaultMessage:"URL"}),i=a.i18n.translate("xpack.stackConnectors.components.jira.projectKey",{defaultMessage:"Project key"}),o=a.i18n.translate("xpack.stackConnectors.components.jira.emailTextFieldLabel",{defaultMessage:"Email address"}),r=a.i18n.translate("xpack.stackConnectors.components.jira.apiTokenTextFieldLabel",{defaultMessage:"API token"}),c=a.i18n.translate("xpack.stackConnectors.components.jira.requiredSummaryTextField",{defaultMessage:"Summary is required."}),l=a.i18n.translate("xpack.stackConnectors.components.jira.unableToGetIssueTypesMessage",{defaultMessage:"Unable to get issue types"}),u=a.i18n.translate("xpack.stackConnectors.components.jira.unableToGetFieldsMessage",{defaultMessage:"Unable to get fields"}),d=a.i18n.translate("xpack.stackConnectors.components.jira.unableToGetIssuesMessage",{defaultMessage:"Unable to get issues"}),b=e=>a.i18n.translate("xpack.stackConnectors.components.jira.unableToGetIssueMessage",{defaultMessage:"Unable to get issue with id {id}",values:{id:e}}),p=a.i18n.translate("xpack.stackConnectors.components.jira.searchIssuesComboBoxAriaLabel",{defaultMessage:"Type to search"}),m=a.i18n.translate("xpack.stackConnectors.components.jira.searchIssuesComboBoxPlaceholder",{defaultMessage:"Type to search"}),j=a.i18n.translate("xpack.stackConnectors.components.jira.searchIssuesLoading",{defaultMessage:"Loading..."}),g=a.i18n.translate("xpack.stackConnectors.components.jira.labelsSpacesErrorMessage",{defaultMessage:"Labels cannot contain spaces."}),O=a.i18n.translate("xpack.stackConnectors.components.jira.otherFieldsFormatErrorMessage",{defaultMessage:"Additional fields field must be a valid JSON object."}),f=e=>a.i18n.translate("xpack.stackConnectors.jira.schema.additionalFieldsLengthError",{values:{length:e},defaultMessage:"A maximum of {length} additional fields can be defined at a time."})}}]);