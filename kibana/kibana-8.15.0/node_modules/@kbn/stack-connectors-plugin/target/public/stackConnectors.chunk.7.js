/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[7,0],{150:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var a=n(1),s=n.n(a),o=n(34),i=n(3),r=n(48),c=n(63),l=n(8),u=n(2);const d=["severity"],p=[{label:r.SOURCE,fieldKey:"source"},{label:r.NODE,fieldKey:"node"},{label:r.TYPE,fieldKey:"type"},{label:r.RESOURCE,fieldKey:"resource"},{label:r.METRIC_NAME,fieldKey:"metric_name"},{label:r.EVENT_CLASS,fieldKey:"event_class"},{label:r.MESSAGE_KEY,fieldKey:"message_key"}],f=JSON.stringify({alert:{id:"{{alert.id}}",actionGroup:"{{alert.actionGroup}}",actionSubgroup:"{{alert.actionSubgroup}}",actionGroupName:"{{alert.actionGroupName}}"},rule:{id:"{{rule.id}}",name:"{{rule.name}}",type:"{{rule.type}}"},date:"{{date}}"},null,4),E=({actionConnector:e,actionParams:t,editAction:n,index:E,messageVariables:_,errors:I})=>{var T;const N=Object(a.useMemo)((()=>{var e;return null!==(e=t.subActionParams)&&void 0!==e?e:{}}),[t.subActionParams]),{description:k,severity:m,additional_info:v}=N,{http:A,notifications:{toasts:C}}=Object(i.useKibana)().services,b=Object(a.useRef)(null!==(T=null==e?void 0:e.id)&&void 0!==T?T:""),{choices:L,isLoading:g}=(({http:e,actionConnector:t,toastNotifications:n,fields:s})=>{const o=Object(a.useMemo)((()=>s.reduce(((e,t)=>({...e,[t]:[]})),{})),[s]),[i,r]=Object(a.useState)(o),l=Object(a.useCallback)((e=>{r(e.reduce(((e,t)=>{var n;return{...e,[t.element]:[...null!==(n=e[t.element])&&void 0!==n?n:[],t]}}),o))}),[o]),{isLoading:u}=Object(c.a)({http:e,toastNotifications:n,actionConnector:t,fields:s,onSuccess:l});return{choices:i,isLoading:u}})({http:A,toastNotifications:C,actionConnector:e,fields:d}),x=Object(a.useMemo)((()=>Object(l.c)(L.severity)),[L.severity]),O=Object(a.useCallback)(((e,t)=>{n("subActionParams",{...N,[e]:t},E)}),[n,E,N]);return Object(a.useEffect)((()=>{null!=e&&b.current!==e.id&&(b.current=e.id,n("subActionParams",{additional_info:f,message_key:"{{rule.id}}:{{alert.id}}"},E))}),[e]),Object(a.useEffect)((()=>{t.subAction||n("subAction","addEvent",E),t.subActionParams||n("subActionParams",{additional_info:f,message_key:"{{rule.id}}:{{alert.id}}"},E)}),[t]),Object(u.jsx)(s.a.Fragment,null,Object(u.jsx)(o.EuiTitle,{size:"s"},Object(u.jsx)("h3",null,r.EVENT)),Object(u.jsx)(o.EuiSpacer,{size:"m"}),p.map((e=>{var t;return Object(u.jsx)(s.a.Fragment,{key:e.fieldKey},Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,label:e.label},Object(u.jsx)(i.TextFieldWithMessageVariables,{index:E,editAction:O,messageVariables:_,paramsProperty:e.fieldKey,inputTargetValue:null!==(t=N[e.fieldKey])&&void 0!==t?t:void 0})),Object(u.jsx)(o.EuiSpacer,{size:"m"}))})),Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,label:r.SEVERITY_LABEL,labelAppend:Object(u.jsx)(o.EuiText,{size:"xs",color:"subdued"},r.REQUIRED_LABEL),error:I.severity,isInvalid:Object(l.f)(m,I.severity)},Object(u.jsx)(o.EuiSelect,{fullWidth:!0,hasNoInitialSelection:!0,"data-test-subj":"severitySelect",isLoading:g,disabled:g,options:x,value:null!=m?m:"",onChange:e=>O("severity",e.target.value),isInvalid:Object(l.f)(m,I.severity)})),Object(u.jsx)(i.TextAreaWithMessageVariables,{index:E,editAction:O,messageVariables:_,paramsProperty:"description",inputTargetValue:null!=k?k:void 0,label:r.DESCRIPTION_LABEL}),Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,error:I["subActionParams.additional_info"],isInvalid:void 0!==I["subActionParams.additional_info"]&&I["subActionParams.additional_info"].length>0},Object(u.jsx)(i.JsonEditorWithMessageVariables,{messageVariables:_,paramsProperty:"additional_info",inputTargetValue:null!=v?v:"",errors:I.additional_info,label:Object(u.jsx)(s.a.Fragment,null,r.ADDITIONAL_INFO,Object(u.jsx)(o.EuiIconTip,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop","data-test-subj":"otherFieldsHelpTooltip","aria-label":r.ADDITIONAL_INFO_HELP,content:r.ADDITIONAL_INFO_HELP_TEXT})),onDocumentsChange:e=>{O("additional_info",e)}})))}},48:function(e,t,n){"use strict";n.r(t),n.d(t,"API_URL_LABEL",(function(){return s})),n.d(t,"API_URL_INVALID",(function(){return o})),n.d(t,"AUTHENTICATION_LABEL",(function(){return i})),n.d(t,"USERNAME_LABEL",(function(){return r})),n.d(t,"USERNAME_REQUIRED",(function(){return c})),n.d(t,"PASSWORD_LABEL",(function(){return l})),n.d(t,"TITLE_REQUIRED",(function(){return u})),n.d(t,"CORRELATION_ID_REQUIRED",(function(){return d})),n.d(t,"INCIDENT",(function(){return p})),n.d(t,"SECURITY_INCIDENT",(function(){return f})),n.d(t,"SHORT_DESCRIPTION_LABEL",(function(){return E})),n.d(t,"DESCRIPTION_LABEL",(function(){return _})),n.d(t,"COMMENTS_LABEL",(function(){return I})),n.d(t,"CHOICES_API_ERROR",(function(){return T})),n.d(t,"CATEGORY_LABEL",(function(){return N})),n.d(t,"SUBCATEGORY_LABEL",(function(){return k})),n.d(t,"URGENCY_LABEL",(function(){return m})),n.d(t,"SEVERITY_LABEL",(function(){return v})),n.d(t,"IMPACT_LABEL",(function(){return A})),n.d(t,"PRIORITY_LABEL",(function(){return C})),n.d(t,"API_INFO_ERROR",(function(){return b})),n.d(t,"FETCH_ERROR",(function(){return L})),n.d(t,"INSTALLATION_CALLOUT_TITLE",(function(){return g})),n.d(t,"UPDATE_SUCCESS_TOAST_TITLE",(function(){return x})),n.d(t,"UPDATE_SUCCESS_TOAST_TEXT",(function(){return O})),n.d(t,"VISIT_SN_STORE",(function(){return S})),n.d(t,"SETUP_DEV_INSTANCE",(function(){return R})),n.d(t,"SN_INSTANCE_LABEL",(function(){return w})),n.d(t,"UNKNOWN",(function(){return M})),n.d(t,"CORRELATION_ID",(function(){return y})),n.d(t,"CORRELATION_DISPLAY",(function(){return D})),n.d(t,"EVENT",(function(){return h})),n.d(t,"SOURCE",(function(){return F})),n.d(t,"EVENT_CLASS",(function(){return P})),n.d(t,"RESOURCE",(function(){return j})),n.d(t,"NODE",(function(){return U})),n.d(t,"METRIC_NAME",(function(){return K})),n.d(t,"TYPE",(function(){return V})),n.d(t,"MESSAGE_KEY",(function(){return B})),n.d(t,"SEVERITY_REQUIRED",(function(){return q})),n.d(t,"CLIENTID_LABEL",(function(){return H})),n.d(t,"CLIENTSECRET_LABEL",(function(){return Y})),n.d(t,"KEY_ID_LABEL",(function(){return W})),n.d(t,"USER_IDENTIFIER_LABEL",(function(){return G})),n.d(t,"PRIVATE_KEY_LABEL",(function(){return J})),n.d(t,"PRIVATE_KEY_PASSWORD_LABEL",(function(){return Q})),n.d(t,"PRIVATE_KEY_PASSWORD_HELPER_TEXT",(function(){return $})),n.d(t,"CLIENTID_REQUIRED",(function(){return z})),n.d(t,"PRIVATE_KEY_REQUIRED",(function(){return X})),n.d(t,"KEYID_REQUIRED",(function(){return Z})),n.d(t,"USER_IDENTIFIER_REQUIRED",(function(){return ee})),n.d(t,"PASSWORD_REQUIRED",(function(){return te})),n.d(t,"CLIENTSECRET_REQUIRED",(function(){return ne})),n.d(t,"IS_OAUTH",(function(){return ae})),n.d(t,"OPTIONAL_LABEL",(function(){return se})),n.d(t,"REQUIRED_LABEL",(function(){return oe})),n.d(t,"EVENT_ACTION_TRIGGER",(function(){return ie})),n.d(t,"EVENT_ACTION_RESOLVE",(function(){return re})),n.d(t,"EVENT_ACTION_LABEL",(function(){return ce})),n.d(t,"ADDITIONAL_INFO",(function(){return le})),n.d(t,"ADDITIONAL_INFO_HELP",(function(){return ue})),n.d(t,"ADDITIONAL_INFO_HELP_TEXT",(function(){return de})),n.d(t,"ADDITIONAL_INFO_JSON_ERROR",(function(){return pe})),n.d(t,"ADDITIONAL_FIELDS",(function(){return fe})),n.d(t,"ADDITIONAL_FIELDS_HELP",(function(){return Ee})),n.d(t,"ADDITIONAL_FIELDS_HELP_TEXT",(function(){return _e})),n.d(t,"ADDITIONAL_FIELDS_JSON_ERROR",(function(){return Ie}));var a=n(0);const s=a.i18n.translate("xpack.stackConnectors.components.serviceNow.apiUrlTextFieldLabel",{defaultMessage:"ServiceNow instance URL"}),o=a.i18n.translate("xpack.stackConnectors.components.serviceNow.invalidApiUrlTextField",{defaultMessage:"URL is invalid."}),i=a.i18n.translate("xpack.stackConnectors.components.serviceNow.authenticationLabel",{defaultMessage:"Authentication"}),r=a.i18n.translate("xpack.stackConnectors.components.serviceNow.usernameTextFieldLabel",{defaultMessage:"Username"}),c=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredUsernameTextField",{defaultMessage:"Username is required."}),l=a.i18n.translate("xpack.stackConnectors.components.serviceNow.passwordTextFieldLabel",{defaultMessage:"Password"}),u=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredShortDescTextField",{defaultMessage:"Short description is required."}),d=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredCorrelationIdTextField",{defaultMessage:"Correlation id is required."}),p=a.i18n.translate("xpack.stackConnectors.components.serviceNow.title",{defaultMessage:"Incident"}),f=a.i18n.translate("xpack.stackConnectors.components.serviceNowSIR.title",{defaultMessage:"Security incident"}),E=a.i18n.translate("xpack.stackConnectors.components.serviceNow.titleFieldLabel",{defaultMessage:"Short description"}),_=a.i18n.translate("xpack.stackConnectors.components.serviceNow.descriptionTextAreaFieldLabel",{defaultMessage:"Description"}),I=a.i18n.translate("xpack.stackConnectors.components.serviceNow.commentsTextAreaFieldLabel",{defaultMessage:"Additional comments"}),T=a.i18n.translate("xpack.stackConnectors.components.serviceNow.unableToGetChoicesMessage",{defaultMessage:"Unable to get choices"}),N=a.i18n.translate("xpack.stackConnectors.components.serviceNow.categoryTitle",{defaultMessage:"Category"}),k=a.i18n.translate("xpack.stackConnectors.components.serviceNow.subcategoryTitle",{defaultMessage:"Subcategory"}),m=a.i18n.translate("xpack.stackConnectors.components.serviceNow.urgencySelectFieldLabel",{defaultMessage:"Urgency"}),v=a.i18n.translate("xpack.stackConnectors.components.serviceNow.severitySelectFieldLabel",{defaultMessage:"Severity"}),A=a.i18n.translate("xpack.stackConnectors.components.serviceNow.impactSelectFieldLabel",{defaultMessage:"Impact"}),C=a.i18n.translate("xpack.stackConnectors.components.serviceNow.prioritySelectFieldLabel",{defaultMessage:"Priority"}),b=e=>a.i18n.translate("xpack.stackConnectors.components.serviceNow.apiInfoError",{values:{status:e},defaultMessage:"Received status: {status} when attempting to get application information"}),L=a.i18n.translate("xpack.stackConnectors.components.serviceNow.fetchErrorMsg",{defaultMessage:"Failed to fetch. Check the URL or the CORS configuration of your ServiceNow instance."}),g=a.i18n.translate("xpack.stackConnectors.components.serviceNow.installationCalloutTitle",{defaultMessage:"To use this connector, first install the Elastic app from the ServiceNow app store."}),x=e=>a.i18n.translate("xpack.stackConnectors.components.serviceNow.updateSuccessToastTitle",{defaultMessage:"{connectorName} connector updated",values:{connectorName:e}}),O=a.i18n.translate("xpack.stackConnectors.components.serviceNow.updateCalloutText",{defaultMessage:"Connector has been updated."}),S=a.i18n.translate("xpack.stackConnectors.components.serviceNow.visitSNStore",{defaultMessage:"Visit ServiceNow app store"}),R=a.i18n.translate("xpack.stackConnectors.components.serviceNow.setupDevInstance",{defaultMessage:"setup a developer instance"}),w=a.i18n.translate("xpack.stackConnectors.components.serviceNow.snInstanceLabel",{defaultMessage:"ServiceNow instance"}),M=a.i18n.translate("xpack.stackConnectors.components.serviceNow.unknown",{defaultMessage:"UNKNOWN"}),y=a.i18n.translate("xpack.stackConnectors.components.serviceNow.correlationID",{defaultMessage:"Correlation ID"}),D=a.i18n.translate("xpack.stackConnectors.components.serviceNow.correlationDisplay",{defaultMessage:"Correlation display"}),h=a.i18n.translate("xpack.stackConnectors.components.serviceNowITOM.event",{defaultMessage:"Event"}),F=a.i18n.translate("xpack.stackConnectors.components.serviceNow.sourceTextAreaFieldLabel",{defaultMessage:"Source"}),P=a.i18n.translate("xpack.stackConnectors.components.serviceNow.eventClassTextAreaFieldLabel",{defaultMessage:"Source instance"}),j=a.i18n.translate("xpack.stackConnectors.components.serviceNow.resourceTextAreaFieldLabel",{defaultMessage:"Resource"}),U=a.i18n.translate("xpack.stackConnectors.components.serviceNow.nodeTextAreaFieldLabel",{defaultMessage:"Node"}),K=a.i18n.translate("xpack.stackConnectors.components.serviceNow.metricNameTextAreaFieldLabel",{defaultMessage:"Metric name"}),V=a.i18n.translate("xpack.stackConnectors.components.serviceNow.typeTextAreaFieldLabel",{defaultMessage:"Type"}),B=a.i18n.translate("xpack.stackConnectors.components.serviceNow.messageKeyTextAreaFieldLabel",{defaultMessage:"Message key"}),q=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredSeverityTextField",{defaultMessage:"Severity is required."}),H=a.i18n.translate("xpack.stackConnectors.components.serviceNow.clientIdTextFieldLabel",{defaultMessage:"Client ID"}),Y=a.i18n.translate("xpack.stackConnectors.components.serviceNow.clientSecretTextFieldLabel",{defaultMessage:"Client secret"}),W=a.i18n.translate("xpack.stackConnectors.components.serviceNow.keyIdTextFieldLabel",{defaultMessage:"JWT verifier key ID"}),G=a.i18n.translate("xpack.stackConnectors.components.serviceNow.userEmailTextFieldLabel",{defaultMessage:"User identifier"}),J=a.i18n.translate("xpack.stackConnectors.components.serviceNow.privateKeyTextFieldLabel",{defaultMessage:"Private key"}),Q=a.i18n.translate("xpack.stackConnectors.components.serviceNow.privateKeyPassTextFieldLabel",{defaultMessage:"Private key password"}),$=a.i18n.translate("xpack.stackConnectors.components.serviceNow.privateKeyPassLabelHelpText",{defaultMessage:"This is only required if you have set a password on your private key"}),z=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredClientIdTextField",{defaultMessage:"Client ID is required."}),X=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredPrivateKeyTextField",{defaultMessage:"Private key is required."}),Z=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredKeyIdTextField",{defaultMessage:"JWT verifier key ID is required."}),ee=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredUserIdentifierTextField",{defaultMessage:"User identifier is required."}),te=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredPasswordTextField",{defaultMessage:"Password is required."}),ne=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredClientSecretTextField",{defaultMessage:"Client secret is required."}),ae=a.i18n.translate("xpack.stackConnectors.components.serviceNow.useOAuth",{defaultMessage:"Use OAuth authentication"}),se=a.i18n.translate("xpack.stackConnectors.components.serviceNow.optionalLabel",{defaultMessage:"Optional"}),oe=a.i18n.translate("xpack.stackConnectors.components.serviceNow.requiredLabel",{defaultMessage:"Required"}),ie=a.i18n.translate("xpack.stackConnectors.components.serviceNow.eventActionTriggerOptionLabel",{defaultMessage:"Trigger"}),re=a.i18n.translate("xpack.stackConnectors.components.serviceNow.eventActionResolveOptionLabel",{defaultMessage:"Resolve"}),ce=a.i18n.translate("xpack.stackConnectors.components.serviceNowITSM.eventActionFieldLabel",{defaultMessage:"Event action"}),le=a.i18n.translate("xpack.stackConnectors.components.serviceNowITOM.additionalInfoLabel",{defaultMessage:"Additional info"}),ue=a.i18n.translate("xpack.stackConnectors.components.serviceNowITOM.additionalInfoHelpTooltip",{defaultMessage:"Additional info help"}),de=a.i18n.translate("xpack.stackConnectors.components.serviceNowITOM.additionalInfoHelpTooltipText",{defaultMessage:"The rule automatically generates information about each event. You can change or add more custom fields in JSON format."}),pe=a.i18n.translate("xpack.stackConnectors.components.serviceNowITOM.additionalInfoError",{defaultMessage:"The additional info field does not have a valid JSON format."}),fe=a.i18n.translate("xpack.stackConnectors.components.servicenow.additionalFieldsTooltip",{defaultMessage:"Additional fields"}),Ee=a.i18n.translate("xpack.stackConnectors.components.servicenow.additionalFieldsHelpTooltip",{defaultMessage:"Additional fields help"}),_e=a.i18n.translate("xpack.stackConnectors.components.servicenow.additionalFieldsHelpTooltipText",{defaultMessage:"Additional fields in JSON format as defined in the Elastic ServiceNow application"}),Ie=a.i18n.translate("xpack.stackConnectors.components.servicenow.additionalFieldsError",{defaultMessage:"No valid JSON."})},49:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=({connector_id:e,service_message:t,...n})=>({...n,actionId:e,...t&&{serviceMessage:t}})},54:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a={".servicenow":{importSetTable:"x_elas2_inc_int_elastic_incident",appScope:"x_elas2_inc_int",table:"incident",useImportAPI:!0,commentFieldKey:"work_notes",appId:"7148dbc91bf1f450ced060a7234bcb88"},".servicenow-sir":{importSetTable:"x_elas2_sir_int_elastic_si_incident",appScope:"x_elas2_sir_int",table:"sn_si_incident",useImportAPI:!0,commentFieldKey:"work_notes",appId:"2f0746801baeb01019ae54e4604bcb0f"},".servicenow-itom":{importSetTable:"x_elas2_inc_int_elastic_incident",appScope:"x_elas2_inc_int",table:"em_event",useImportAPI:!1,commentFieldKey:"work_notes"}}},59:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return l}));var a=n(23),s=n(54),o=n(48),i=n(49);async function r({http:e,signal:t,connectorId:n,fields:s}){const o=await e.post(`${a.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(n)}/_execute`,{body:JSON.stringify({params:{subAction:"getChoices",subActionParams:{fields:s}}}),signal:t});return Object(i.a)(o)}const c=(e,t)=>`${e}/api/${t}/elastic_api/health`;async function l({http:e,signal:t,connector:n,actionTypeId:i}){var r;const{secrets:{username:l,password:u,clientSecret:d,privateKey:p,privateKeyPassword:f},config:{isOAuth:E,apiUrl:_,clientId:I,userIdentifierValue:T,jwtKeyId:N}}=n,k=_.endsWith("/")?_.slice(0,-1):_;let m="Basic "+btoa(l+":"+u);if(E){const t=await e.post(`${a.INTERNAL_BASE_ACTION_API_PATH}/connector/_oauth_access_token`,{body:JSON.stringify({type:"jwt",options:{tokenUrl:`${k}/oauth_token.do`,config:{clientId:I,userIdentifierValue:T,jwtKeyId:N},secrets:{clientSecret:d,privateKey:p,...f&&{privateKeyPassword:f}}}})}),{accessToken:n}=t;m=n}const v=s.a[i],A=await fetch(c(k,null!==(r=v.appScope)&&void 0!==r?r:""),{method:"GET",signal:t,headers:{Authorization:m}});if(!A.ok)throw new Error(Object(o.API_INFO_ERROR)(A.status));return{...(await A.json()).result}}},63:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(1),s=n(59),o=n(48);const i=({http:e,actionConnector:t,toastNotifications:n,fields:i,onSuccess:r})=>{const[c,l]=Object(a.useState)(!1),[u,d]=Object(a.useState)([]),p=Object(a.useRef)(!1),f=Object(a.useRef)(new AbortController),E=Object(a.useCallback)((async()=>{if(t)try{p.current=!1,f.current.abort(),f.current=new AbortController,l(!0);const c=await Object(s.b)({http:e,signal:f.current.signal,connectorId:t.id,fields:i});if(!p.current){const e=Array.isArray(c.data)?c.data:[];var a;l(!1),d(e),c.status&&"error"===c.status?n.addDanger({title:o.CHOICES_API_ERROR,text:`${null!==(a=c.serviceMessage)&&void 0!==a?a:c.message}`}):r&&r(e)}}catch(e){p.current||(l(!1),n.addDanger({title:o.CHOICES_API_ERROR,text:e.message}))}else l(!1)}),[t,e,i,r,n]);return Object(a.useEffect)((()=>(E(),()=>{p.current=!0,f.current.abort(),l(!1)})),[]),{choices:u,isLoading:c}}}}]);