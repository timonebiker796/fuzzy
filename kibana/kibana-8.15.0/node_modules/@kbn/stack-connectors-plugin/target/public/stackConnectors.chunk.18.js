/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackConnectors_bundle_jsonpfunction=window.stackConnectors_bundle_jsonpfunction||[]).push([[18,63],{148:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return b}));var s=n(1),a=n.n(s),i=n(34),o=n(0),c=n(3),r=n(23),l=n(49),u=n(62);var d=n(2);const b=({actionConnector:e,actionParams:t,editAction:n,errors:b,index:m,messageVariables:p})=>{var g,j,f,A,O;const{http:v,notifications:{toasts:x}}=Object(c.useKibana)().services,E=Object(s.useRef)(null!==(g=null==e?void 0:e.id)&&void 0!==g?g:""),{incident:I,comments:y}=Object(s.useMemo)((()=>{var e;return null!==(e=t.subActionParams)&&void 0!==e?e:{incident:{},comments:[]}}),[t.subActionParams]),{isLoading:C,incidentTypes:T}=(({http:e,toastNotifications:t,actionConnector:n})=>{const[a,i]=Object(s.useState)(!0),[o,c]=Object(s.useState)([]),d=Object(s.useRef)(new AbortController);return Object(s.useEffect)((()=>{let s=!1;return d.current.abort(),(async()=>{if(n){d.current=new AbortController,i(!0);try{const b=await async function({http:e,signal:t,connectorId:n}){const s=await e.post(`${r.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(n)}/_execute`,{body:JSON.stringify({params:{subAction:"incidentTypes",subActionParams:{}}}),signal:t});return Object(l.a)(s)}({http:e,signal:d.current.signal,connectorId:n.id});var a,o;s||(i(!1),c(null!==(a=b.data)&&void 0!==a?a:[]),b.status&&"error"===b.status&&t.addDanger({title:u.INCIDENT_TYPES_API_ERROR,text:`${null!==(o=b.serviceMessage)&&void 0!==o?o:b.message}`}))}catch(e){s||(i(!1),t.addDanger({title:u.INCIDENT_TYPES_API_ERROR,text:e.message}))}}else i(!1)})(),()=>{s=!0,i(!1),d.current.abort()}}),[e,n,t]),{incidentTypes:o,isLoading:a}})({http:v,toastNotifications:x,actionConnector:e}),{isLoading:_,severity:R}=(({http:e,toastNotifications:t,actionConnector:n})=>{const[a,i]=Object(s.useState)(!0),[o,c]=Object(s.useState)([]),d=Object(s.useRef)(new AbortController);return Object(s.useEffect)((()=>{let s=!1;return d.current.abort(),(async()=>{if(n){d.current=new AbortController,i(!0);try{const b=await async function({http:e,signal:t,connectorId:n}){const s=await e.post(`${r.BASE_ACTION_API_PATH}/connector/${encodeURIComponent(n)}/_execute`,{body:JSON.stringify({params:{subAction:"severity",subActionParams:{}}}),signal:t});return Object(l.a)(s)}({http:e,signal:d.current.signal,connectorId:n.id});var a,o;s||(i(!1),c(null!==(a=b.data)&&void 0!==a?a:[]),b.status&&"error"===b.status&&t.addDanger({title:u.SEVERITY_API_ERROR,text:`${null!==(o=b.serviceMessage)&&void 0!==o?o:b.message}`}))}catch(e){s||(i(!1),t.addDanger({title:u.SEVERITY_API_ERROR,text:e.message}))}}else i(!1)})(),()=>{s=!0,i(!1),d.current.abort()}}),[e,n,t]),{severity:o,isLoading:a}})({http:v,toastNotifications:x,actionConnector:e}),P=Object(s.useMemo)((()=>R.map((e=>({value:e.id.toString(),text:e.name})))),[R]),k=Object(s.useMemo)((()=>T?T.map((e=>({label:e.name,value:e.id.toString()}))):[]),[T]),S=Object(s.useMemo)((()=>{const e=T.reduce(((e,t)=>({...e,[t.id.toString()]:t.name})),{});return I.incidentTypes?I.incidentTypes.map((t=>({label:e[t.toString()],value:t.toString()}))).filter((e=>null!=e.label)):[]}),[T,I.incidentTypes]),h=Object(s.useCallback)(((e,t)=>{const s="comments"!==e?{incident:{...I,[e]:t},comments:y}:{incident:I,[e]:t};n("subActionParams",s,m)}),[y,n,I,m]),M=Object(s.useCallback)(((e,t)=>{h(e,[{commentId:"1",comment:t}])}),[h]),L=Object(s.useCallback)((e=>{h("incidentTypes",e.map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:e.label})))}),[h]),N=Object(s.useCallback)((()=>{I.incidentTypes||h("incidentTypes",[])}),[h,I.incidentTypes]);return Object(s.useEffect)((()=>{null!=e&&E.current!==e.id&&(E.current=e.id,n("subActionParams",{incident:{},comments:[]},m))}),[e]),Object(s.useEffect)((()=>{t.subAction||n("subAction","pushToService",m),t.subActionParams||n("subActionParams",{incident:{},comments:[]},m)}),[t]),Object(d.jsx)(a.a.Fragment,null,Object(d.jsx)(i.EuiTitle,{size:"s"},Object(d.jsx)("h3",null,"Incident")),Object(d.jsx)(i.EuiSpacer,{size:"m"}),Object(d.jsx)(i.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.stackConnectors.components.resilient.urgencySelectFieldLabel",{defaultMessage:"Incident type"})},Object(d.jsx)(i.EuiComboBox,{fullWidth:!0,isLoading:C,isDisabled:C,"data-test-subj":"incidentTypeComboBox",options:k,selectedOptions:S,onChange:L,onBlur:N,isClearable:!0})),Object(d.jsx)(i.EuiSpacer,{size:"m"}),Object(d.jsx)(i.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.stackConnectors.components.resilient.severity",{defaultMessage:"Severity"})},Object(d.jsx)(i.EuiSelect,{"data-test-subj":"severitySelect",disabled:_,fullWidth:!0,hasNoInitialSelection:!0,isLoading:_,onChange:e=>h("severityCode",e.target.value),options:P,value:null!==(j=I.severityCode)&&void 0!==j?j:void 0})),Object(d.jsx)(i.EuiSpacer,{size:"m"}),Object(d.jsx)(i.EuiFormRow,{fullWidth:!0,error:b["subActionParams.incident.name"],isInvalid:void 0!==b["subActionParams.incident.name"]&&b["subActionParams.incident.name"].length>0&&void 0!==I.name,label:o.i18n.translate("xpack.stackConnectors.components.resilient.nameFieldLabel",{defaultMessage:"Name"}),labelAppend:Object(d.jsx)(i.EuiText,{size:"xs",color:"subdued"},"Required")},Object(d.jsx)(c.TextFieldWithMessageVariables,{index:m,editAction:h,messageVariables:p,paramsProperty:"name",inputTargetValue:null!==(f=I.name)&&void 0!==f?f:void 0,errors:null!==(A=b["subActionParams.incident.name"])&&void 0!==A?A:[]})),Object(d.jsx)(c.TextAreaWithMessageVariables,{index:m,editAction:h,messageVariables:p,paramsProperty:"description",inputTargetValue:null!==(O=I.description)&&void 0!==O?O:void 0,label:o.i18n.translate("xpack.stackConnectors.components.resilient.descriptionTextAreaFieldLabel",{defaultMessage:"Description"})}),Object(d.jsx)(c.TextAreaWithMessageVariables,{index:m,editAction:M,messageVariables:p,paramsProperty:"comments",inputTargetValue:y&&y.length>0?y[0].comment:void 0,label:o.i18n.translate("xpack.stackConnectors.components.resilient.commentsTextAreaFieldLabel",{defaultMessage:"Additional comments"})}))}},49:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));const s=({connector_id:e,service_message:t,...n})=>({...n,actionId:e,...t&&{serviceMessage:t}})},62:function(e,t,n){"use strict";n.r(t),n.d(t,"API_URL_LABEL",(function(){return a})),n.d(t,"ORG_ID_LABEL",(function(){return i})),n.d(t,"API_KEY_ID_LABEL",(function(){return o})),n.d(t,"API_KEY_SECRET_LABEL",(function(){return c})),n.d(t,"NAME_REQUIRED",(function(){return r})),n.d(t,"INCIDENT_TYPES_API_ERROR",(function(){return l})),n.d(t,"SEVERITY_API_ERROR",(function(){return u}));var s=n(0);const a=s.i18n.translate("xpack.stackConnectors.components.resilient.apiUrlTextFieldLabel",{defaultMessage:"URL"}),i=s.i18n.translate("xpack.stackConnectors.components.resilient.orgId",{defaultMessage:"Organization ID"}),o=s.i18n.translate("xpack.stackConnectors.components.resilient.apiKeyId",{defaultMessage:"API key ID"}),c=s.i18n.translate("xpack.stackConnectors.components.resilient.apiKeySecret",{defaultMessage:"API key secret"}),r=s.i18n.translate("xpack.stackConnectors.components.resilient.requiredNameTextField",{defaultMessage:"Name is required."}),l=s.i18n.translate("xpack.stackConnectors.components.resilient.unableToGetIncidentTypesMessage",{defaultMessage:"Unable to get incident types"}),u=s.i18n.translate("xpack.stackConnectors.components.resilient.unableToGetSeverityMessage",{defaultMessage:"Unable to get severity"})}}]);