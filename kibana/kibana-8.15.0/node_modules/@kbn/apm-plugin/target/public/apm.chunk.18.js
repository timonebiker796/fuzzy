/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.apm_bundle_jsonpfunction=window.apm_bundle_jsonpfunction||[]).push([[18],{113:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));let n=function(e){return e.CRITICAL="critical",e.MAJOR="major",e.MINOR="minor",e.WARNING="warning",e.LOW="low",e.UNKNOWN="unknown",e}({})},121:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(11),r=a(6),i=a(1),o=a.n(i),l=a(74);function s({customOptions:e,customOptionText:t,defaultValue:a,fieldName:s,start:c,end:u,onChange:d,placeholder:m,isInvalid:p,dataTestSubj:f,isClearable:v=!0,prepend:g,serviceName:h}){var b;let y;a&&(y={label:a,value:a});const[E,O]=Object(i.useState)(y?[y]:[]),[S,I]=Object(i.useState)(""),{data:N,status:T}=Object(l.d)((e=>e("GET /internal/apm/suggestions",{params:{query:{fieldName:s,fieldValue:S,start:c,end:u,serviceName:h}}})),[s,S,c,u,h],{preservePreviousData:!1}),x=Object(i.useCallback)((e=>{O(e),0===e.length&&d(""),1===e.length&&d(e[0].value?e[0].value.trim():e[0].value)}),[d]),A=Object(i.useCallback)((e=>{x([{label:e,value:e}])}),[x]),M=[...e||[],...(null!==(b=null==N?void 0:N.terms)&&void 0!==b?b:[]).map((e=>({label:e,value:e})))];return o.a.createElement(n.EuiComboBox,{async:!0,customOptionText:t,isClearable:v,isLoading:T===l.a.LOADING,onChange:x,onSearchChange:Object(r.throttle)(I,500),options:M,placeholder:m,selectedOptions:E,singleSelection:{asPlainText:!0},isInvalid:p,style:{minWidth:"256px"},onCreateOption:A,"data-test-subj":f,prepend:g})}},1250:function(e,t,a){"use strict";a.r(t),a.d(t,"AnomalyRuleType",(function(){return S}));var n=a(0),r=a(33),i=a(6),o=a(1),l=a.n(o),s=a(17),c=a(41),u=a(113),d=a(11),m=a(10),p=a(85),f=a(149),v=a(150),g=a(128),h=a(169),b=a(138);function y({type:e}){const t=b.a.find((t=>t.type===e));return l.a.createElement(d.EuiHealth,{color:Object(h.c)(t.threshold),style:{lineHeight:"inherit"}},t.label)}function E({onChange:e,value:t}){return l.a.createElement(d.EuiSuperSelect,{hasDividers:!0,style:{width:200},options:b.a.map((e=>({value:e.type,inputDisplay:l.a.createElement(y,{type:e.type}),dropdownDisplay:l.a.createElement(l.a.Fragment,null,l.a.createElement(y,{type:e.type}),l.a.createElement(d.EuiSpacer,{size:"xs"}),l.a.createElement(d.EuiText,{size:"xs",color:"subdued"},l.a.createElement("p",{"data-test-subj":"SelectAnomalySeverity option text"},l.a.createElement(r.FormattedMessage,{id:"xpack.apm.alerts.anomalySeverity.scoreDetailsDescription",defaultMessage:"score {value} {value, select, critical {} other {and above}}",values:{value:e.type}}))))}))),valueOfSelected:t,onChange:t=>{e(t)}})}function O({values:e,onChange:t}){const a=b.b.map((t=>({key:t.type,label:t.label,checked:e.includes(t.type)?"on":void 0}))),n=Object(o.useCallback)((e=>{const a=e.filter((({checked:e})=>"on"===e)).map((({key:e})=>e));t(a)}),[t]);return l.a.createElement(d.EuiSelectable,{options:a,onChange:n,style:{width:200}},(e=>e))}function S(e){const{services:t}=Object(s.useKibana)(),{ruleParams:a,metadata:h,setRuleParams:S,setRuleProperty:I}=e;Object(o.useEffect)((()=>{Object(p.createCallApmApi)(t)}),[t]);const N=Object(i.defaults)({...Object(i.omit)(h,["start","end"]),...a},{windowSize:30,windowUnit:c.TIME_UNITS.MINUTE,anomalySeverityType:u.a.CRITICAL,anomalyDetectorTypes:b.b.map((e=>e.type)),environment:m.a.value}),T=N.anomalyDetectorTypes.map((e=>Object(b.f)(e))),x=[l.a.createElement(f.d,{currentValue:N.serviceName,onChange:e=>{e!==N.serviceName&&(S("serviceName",e),S("transactionType",""),S("environment",m.a.value))}}),l.a.createElement(f.f,{currentValue:N.transactionType,onChange:e=>S("transactionType",e),serviceName:N.serviceName}),l.a.createElement(f.a,{currentValue:N.environment,onChange:e=>S("environment",e),serviceName:N.serviceName}),l.a.createElement(g.a,{value:T.join(", "),title:n.i18n.translate("xpack.apm.anomalyRuleType.anomalyDetector",{defaultMessage:"Detector types"}),color:e.errors.anomalyDetectorTypes?"danger":"success"},e.errors.anomalyDetectorTypes&&l.a.createElement(d.EuiText,{size:"xs",color:"danger"},l.a.createElement(r.FormattedMessage,{id:"xpack.apm.anomalyRuleType.anomalyDetector.infoLabel",defaultMessage:"At least one detector should be selected"})),l.a.createElement(O,{values:N.anomalyDetectorTypes,onChange:e=>{S("anomalyDetectorTypes",e)}})),l.a.createElement(g.a,{value:l.a.createElement(y,{type:N.anomalySeverityType}),title:n.i18n.translate("xpack.apm.transactionDurationAnomalyRuleType.anomalySeverity",{defaultMessage:"Has anomaly with severity"})},l.a.createElement(E,{value:N.anomalySeverityType,onChange:e=>{S("anomalySeverityType",e)}}))];return l.a.createElement(v.a,{fields:x,defaultParams:N,setRuleParams:S,setRuleProperty:I})}t.default=S},126:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));let n=function(e){return e[e.CRITICAL=75]="CRITICAL",e[e.MAJOR=50]="MAJOR",e[e.MINOR=25]="MINOR",e[e.WARNING=3]="WARNING",e[e.LOW=0]="LOW",e}({})},128:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(1),r=a.n(n),i=a(11);function o(e){const{title:t,value:a,children:o,color:l,dataTestSubj:s}=e,[c,u]=Object(n.useState)(!1);return r.a.createElement(i.EuiPopover,{isOpen:c,anchorPosition:"downLeft",closePopover:()=>u(!1),button:r.a.createElement(i.EuiExpression,{"data-test-subj":s,description:t,value:a,isActive:c,color:l,onClick:()=>u((e=>!e))}),repositionOnScroll:!0},o)}},132:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(1),r=a(155);function i(){return Object(n.useContext)(r.a)}},136:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));let n=function(e){return e.txLatency="txLatency",e.txThroughput="txThroughput",e.txFailureRate="txFailureRate",e}({});n.txLatency,n.txThroughput,n.txFailureRate},138:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return c})),a.d(t,"e",(function(){return m})),a.d(t,"a",(function(){return p})),a.d(t,"f",(function(){return f})),a.d(t,"b",(function(){return v}));var n=a(0),r=(a(15),a(113)),i=a(126),o=a(73),l=(a(14),a(10),a(136));const s="apm";let c=function(e){return e.Avg="avg",e.P95="95th",e.P99="99th",e}({});const u="threshold_met",d={id:u,name:n.i18n.translate("xpack.apm.a.thresholdMet",{defaultMessage:"Threshold met"})},m={[o.a.ErrorCount]:{name:n.i18n.translate("xpack.apm.errorCountAlert.name",{defaultMessage:"Error count threshold"}),actionGroups:[d],defaultActionGroupId:u,minimumLicenseRequired:"basic",producer:s,isExportable:!0},[o.a.TransactionDuration]:{name:n.i18n.translate("xpack.apm.transactionDurationAlert.name",{defaultMessage:"Latency threshold"}),actionGroups:[d],defaultActionGroupId:u,minimumLicenseRequired:"basic",producer:s,isExportable:!0},[o.a.Anomaly]:{name:n.i18n.translate("xpack.apm.anomalyAlert.name",{defaultMessage:"APM Anomaly"}),actionGroups:[d],defaultActionGroupId:u,minimumLicenseRequired:"basic",producer:s,isExportable:!0},[o.a.TransactionErrorRate]:{name:n.i18n.translate("xpack.apm.transactionErrorRateAlert.name",{defaultMessage:"Failed transaction rate threshold"}),actionGroups:[d],defaultActionGroupId:u,minimumLicenseRequired:"basic",producer:s,isExportable:!0}},p=[{type:r.a.CRITICAL,label:n.i18n.translate("xpack.apm.alerts.anomalySeverity.criticalLabel",{defaultMessage:"critical"}),threshold:i.a.CRITICAL},{type:r.a.MAJOR,label:n.i18n.translate("xpack.apm.alerts.anomalySeverity.majorLabel",{defaultMessage:"major"}),threshold:i.a.MAJOR},{type:r.a.MINOR,label:n.i18n.translate("xpack.apm.alerts.anomalySeverity.minor",{defaultMessage:"minor"}),threshold:i.a.MINOR},{type:r.a.WARNING,label:n.i18n.translate("xpack.apm.alerts.anomalySeverity.warningLabel",{defaultMessage:"warning"}),threshold:i.a.WARNING}];function f(e){switch(e){case l.a.txLatency:return n.i18n.translate("xpack.apm.alerts.anomalyDetector.latencyLabel",{defaultMessage:"latency"});case l.a.txThroughput:return n.i18n.translate("xpack.apm.alerts.anomalyDetector.throughputLabel",{defaultMessage:"throughput"});case l.a.txFailureRate:return n.i18n.translate("xpack.apm.alerts.anomalyDetector.failedTransactionRateLabel",{defaultMessage:"failed transaction rate"})}}const v=[l.a.txLatency,l.a.txThroughput,l.a.txFailureRate].map((e=>({type:e,label:f(e)})))},149:function(e,t,a){"use strict";a.d(t,"d",(function(){return p})),a.d(t,"a",(function(){return f})),a.d(t,"e",(function(){return v})),a.d(t,"f",(function(){return g})),a.d(t,"b",(function(){return h})),a.d(t,"c",(function(){return y}));var n=a(7),r=a.n(n),i=a(11),o=a(0),l=a(1),s=a.n(l),c=a(14),u=a(10),d=a(121),m=a(128);function p({allowAll:e=!0,currentValue:t,onChange:a}){return s.a.createElement(m.a,{dataTestSubj:"apmServiceField",value:t||u.c,title:o.i18n.translate("xpack.apm.alerting.fields.service",{defaultMessage:"Service"})},s.a.createElement(d.a,{customOptions:e?[{label:u.c,value:void 0}]:void 0,customOptionText:o.i18n.translate("xpack.apm.serviceNamesSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new service name"}),defaultValue:t,fieldName:c.x,onChange:a,placeholder:o.i18n.translate("xpack.apm.serviceNamesSelectPlaceholder",{defaultMessage:"Select service name"}),start:r()().subtract(24,"h").toISOString(),end:r()().toISOString()}))}function f({currentValue:e,onChange:t,serviceName:a}){return s.a.createElement(m.a,{dataTestSubj:"apmEnvironmentField",value:Object(u.e)(e),title:o.i18n.translate("xpack.apm.alerting.fields.environment",{defaultMessage:"Environment"})},s.a.createElement(d.a,{customOptions:[u.a],customOptionText:o.i18n.translate("xpack.apm.environmentsSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new environment"}),defaultValue:Object(u.e)(e),fieldName:c.v,onChange:t,placeholder:o.i18n.translate("xpack.apm.environmentsSelectPlaceholder",{defaultMessage:"Select environment"}),start:r()().subtract(24,"h").toISOString(),end:r()().toISOString(),serviceName:a}))}function v({currentValue:e,onChange:t,serviceName:a}){const n=o.i18n.translate("xpack.apm.alerting.fields.transaction.name",{defaultMessage:"Name"});return s.a.createElement(m.a,{dataTestSubj:"apmTransactionNameField",value:e||u.c,title:n},s.a.createElement(d.a,{customOptions:[{label:u.c,value:void 0}],customOptionText:o.i18n.translate("xpack.apm.alerting.transaction.name.custom.text",{defaultMessage:"Add \\{searchValue\\} as a new transaction name"}),defaultValue:e,fieldName:c.L,onChange:t,placeholder:o.i18n.translate("xpack.apm.transactionNamesSelectPlaceholder",{defaultMessage:"Select transaction name"}),start:r()().subtract(24,"h").toISOString(),end:r()().toISOString(),serviceName:a}))}function g({currentValue:e,onChange:t,serviceName:a}){const n=o.i18n.translate("xpack.apm.alerting.fields.type",{defaultMessage:"Type"});return s.a.createElement(m.a,{dataTestSubj:"apmTransactionTypeField",value:e||u.c,title:n},s.a.createElement(d.a,{customOptions:[{label:u.c,value:void 0}],customOptionText:o.i18n.translate("xpack.apm.transactionTypesSelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new transaction type"}),defaultValue:e,fieldName:c.M,onChange:t,placeholder:o.i18n.translate("xpack.apm.transactionTypesSelectPlaceholder",{defaultMessage:"Select transaction type"}),start:r()().subtract(24,"h").toISOString(),end:r()().toISOString(),serviceName:a}))}function h({currentValue:e,onChange:t,serviceName:a}){const n=o.i18n.translate("xpack.apm.alerting.fields.error.group.id",{defaultMessage:"Error grouping key"});return s.a.createElement(m.a,{dataTestSubj:"apmErrorGroupingKeyField",value:e||u.c,title:n},s.a.createElement(d.a,{customOptions:[{label:u.c,value:void 0}],customOptionText:o.i18n.translate("xpack.apm.errorKeySelectCustomOptionText",{defaultMessage:"Add \\{searchValue\\} as a new error grouping key"}),defaultValue:e,fieldName:c.l,onChange:t,placeholder:o.i18n.translate("xpack.apm.errorGroupingKeySelectPlaceholder",{defaultMessage:"Select error grouping key"}),start:r()().subtract(24,"h").toISOString(),end:r()().toISOString(),serviceName:a}))}function b(e){return!isNaN(Number(e))&&""!==e.trim()}function y({value:e,unit:t,onChange:a,step:n}){const[r,c]=Object(l.useState)(!1),[u,d]=Object(l.useState)(String(e));return s.a.createElement(i.EuiPopover,{isOpen:r,anchorPosition:"downLeft",ownFocus:!0,closePopover:()=>{c(!1)},button:s.a.createElement(i.EuiExpression,{value:`${e}${t}`,description:o.i18n.translate("xpack.apm.transactionErrorRateRuleType.isAbove",{defaultMessage:"is above"}),isInvalid:!b(u),isActive:r,onClick:()=>{c(!0)}})},s.a.createElement(i.EuiFormRow,{isInvalid:!b(u),error:o.i18n.translate("xpack.apm.transactionErrorRateRuleType.error.validThreshold",{defaultMessage:"Thresholds must contain a valid number."})},s.a.createElement(i.EuiFieldNumber,{"data-test-subj":"apmIsAboveFieldFieldNumber",min:0,value:u,onChange:e=>{const t=e.target.value;d(t),isNaN(Number(t))||a(Number(t))},append:t,isInvalid:!b(u),compressed:!0,step:n})))}},150:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(11),r=a(1),i=a.n(r),o=a(0),l=a(7),s=a.n(l),c=a(41);function u(e){const{fields:t,groupAlertsBy:a,kqlFilter:o,setRuleParams:l,defaultParams:c,chartPreview:u,minimumWindowSize:m}=e,p={...c},f=function({windowSize:e,windowUnit:t,minimumWindowSize:a}){const[n,i]=Object(r.useState)(!1);return Object(r.useEffect)((()=>{if(void 0===e||void 0===a)return;const n=s.a.duration(e,t).asMilliseconds(),r=s.a.duration(a.value,a.unit).asMilliseconds();i(n<r)}),[e,t,a]),n}({windowSize:p.windowSize,windowUnit:p.windowUnit,minimumWindowSize:m});return Object(r.useEffect)((()=>{Object.keys(p).forEach((e=>{l(e,p[e])}))}),[]),i.a.createElement(i.a.Fragment,null,f&&m&&i.a.createElement(d,{minimumWindowSize:m}),o,i.a.createElement(n.EuiFlexGrid,{gutterSize:"l",direction:"row",columns:2},t.map(((e,t)=>i.a.createElement(n.EuiFlexItem,{grow:!1,key:t},e)))),u,i.a.createElement(n.EuiSpacer,{size:"m"}),a)}function d({minimumWindowSize:e}){const t=o.i18n.translate("xpack.apm.alertTypes.minimumWindowSize.description",{defaultMessage:"The recommended minimum value is {sizeValue} {sizeUnit}. This is to ensure that the alert has enough data to evaluate. If you choose a value that is too low, the alert may not fire as expected.",values:{sizeValue:e.value,sizeUnit:Object(c.getTimeUnitLabel)(e.unit)}});return i.a.createElement(n.EuiCallOut,{title:`Please increase "For the last" to at least ${e.value} ${Object(c.getTimeUnitLabel)(e.unit)}`,color:"warning",iconType:"warning"},i.a.createElement("p",null,t))}},155:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return o}));var n=a(1),r=a.n(n);const i=Object(n.createContext)({incrementTimeRangeId:()=>{},timeRangeId:0});function o({children:e}){const[t,a]=Object(n.useState)(0),o=Object(n.useMemo)((()=>({incrementTimeRangeId:()=>a((e=>e+1)),timeRangeId:t})),[t,a]);return r.a.createElement(i.Provider,{value:o},e)}},169:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return c}));var n=a(0),r=a(113),i=a(126);const o={CRITICAL:"#fe5050",MAJOR:"#fba740",MINOR:"#fdec25",WARNING:"#8bc8fb",LOW:"#d2e9f7",BLANK:"#ffffff"};function l(e){return void 0===e?r.a.UNKNOWN:(t=e)>=75?r.a.CRITICAL:t>=50?r.a.MAJOR:t>=25?r.a.MINOR:t>=3?r.a.WARNING:t>=0?r.a.LOW:r.a.UNKNOWN;var t}function s(e){return(t=e)>=i.a.CRITICAL?o.CRITICAL:t>=i.a.MAJOR?o.MAJOR:t>=i.a.MINOR?o.MINOR:t>=i.a.WARNING?o.WARNING:t>=i.a.LOW?o.LOW:o.BLANK;var t}const c={INVALID_LICENSE:n.i18n.translate("xpack.apm.anomaly_detection.error.invalid_license",{defaultMessage:"To use anomaly detection, you must be subscribed to an Elastic Platinum license. With it, you'll be able to monitor your services with the aid of machine learning."}),MISSING_READ_PRIVILEGES:n.i18n.translate("xpack.apm.anomaly_detection.error.missing_read_privileges",{defaultMessage:'You must have "read" privileges to Machine Learning and APM in order to view Anomaly Detection jobs'}),MISSING_WRITE_PRIVILEGES:n.i18n.translate("xpack.apm.anomaly_detection.error.missing_write_privileges",{defaultMessage:'You must have "write" privileges to Machine Learning and APM in order to create Anomaly Detection jobs'}),ML_NOT_AVAILABLE:n.i18n.translate("xpack.apm.anomaly_detection.error.not_available",{defaultMessage:"Machine learning is not available"}),ML_NOT_AVAILABLE_IN_SPACE:n.i18n.translate("xpack.apm.anomaly_detection.error.not_available_in_space",{defaultMessage:"Machine learning is not available in the selected space"})}},74:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"b",(function(){return m})),a.d(t,"d",(function(){return f}));var n=a(0),r=a(1),i=a.n(r),o=a(17),l=a(18),s=a(132),c=a(85);let u=function(e){return e.LOADING="loading",e.SUCCESS="success",e.FAILURE="failure",e.NOT_INITIATED="not_initiated",e}({});const d=e=>e===u.LOADING||e===u.NOT_INITIATED,m=e=>e===u.FAILURE,p=(e,t)=>(a,n)=>Object(c.callApmApi)(a,{...n,signal:e}).catch((e=>{var a;throw t({status:u.FAILURE,data:null===(a=e.body)||void 0===a?void 0:a.attributes}),e})).then((e=>(t({data:e,status:u.SUCCESS}),e)));function f(e,t,a={}){const{notifications:c}=Object(o.useKibana)(),{preservePreviousData:d=!0,showToastOnError:m=!0}=a,[f,v]=Object(r.useState)({data:void 0,status:u.NOT_INITIATED}),[g,h]=Object(r.useState)(0),{timeRangeId:b}=Object(s.a)(),{addInspectorRequest:y}=Object(l.useInspectorContext)();return Object(r.useEffect)((()=>{let t=new AbortController;return async function(){t.abort(),t=new AbortController;const a=t.signal,r=e(p(a,y));if(r){v((e=>({data:d?e.data:void 0,status:u.LOADING,error:void 0})));try{const e=await r;a.aborted||v({data:e,status:u.SUCCESS,error:void 0})}catch(e){const t=e;if(!a.aborted){const a="response"in t?function(e){var t,a,r,o,l;const s=null!==(t=null===(a=e.body)||void 0===a?void 0:a.message)&&void 0!==t?t:null===(r=e.response)||void 0===r?void 0:r.statusText;return i.a.createElement(i.a.Fragment,null,s," (",null===(o=e.response)||void 0===o?void 0:o.status,")",i.a.createElement("h5",null,n.i18n.translate("xpack.apm.fetcher.error.url",{defaultMessage:"URL"})),null===(l=e.response)||void 0===l?void 0:l.url)}(t):t.message;m&&c.toasts.danger({title:n.i18n.translate("xpack.apm.fetcher.error.title",{defaultMessage:"Error while fetching resource"}),body:i.a.createElement("div",null,i.a.createElement("h5",null,n.i18n.translate("xpack.apm.fetcher.error.status",{defaultMessage:"Error"})),a)}),v({data:void 0,status:u.FAILURE,error:e})}}}}(),()=>{t.abort()}}),[g,d,b,m,...t]),Object(r.useMemo)((()=>({...f,refetch:()=>{h((e=>e+1))}})),[f])}}}]);