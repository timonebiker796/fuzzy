!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=16)}([function(e,t){e.exports=__kbnSharedDeps__.EmotionReact},function(e,t){e.exports=__kbnSharedDeps__.ElasticEui},function(e,t){e.exports=__kbnSharedDeps__.React},function(e,t){e.exports=__kbnSharedDeps__.Rxjs},function(e,t){e.exports=__kbnSharedDeps__.Moment},function(e,t,s){e.exports=s(13)(2)},function(e,t){e.exports=__kbnSharedDeps__.KbnI18nReact},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,s){e.exports=s(13)(4)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(18),r=s(2),i=n.__importDefault(s(19));t.default=function(e,t){var s=r.useState(t),n=s[0],a=s[1];return i.default((function(){var t=e.subscribe(a);return function(){return t.unsubscribe()}}),[e]),n}},function(e,t){e.exports=__kbnSharedDeps__.EmotionCache},function(e,t){e.exports=__kbnSharedDeps__.ReactDom},function(e,t){e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t){e.exports=__kbnSharedDeps__.ElasticEuiLibComponentsUseIsNestedEuiProvider},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setEuiDevProviderWarning=t.getEuiDevProviderWarning=t.emitEuiProviderWarning=void 0;var n=void 0;t.setEuiDevProviderWarning=function(e){return n=e},t.getEuiDevProviderWarning=function(){return n},t.emitEuiProviderWarning=function(e){if("function"==typeof n)return n(e);switch(n){case"log":console.log(e);break;case"warn":console.warn(e);break;case"error":throw new Error(e)}}},function(e,t,s){s(17),__kbnBundles__.define("plugin/newsfeed/public",s,20)},function(e,t,s){s.p=window.__kbnPublicPath__.newsfeed},function(e,t){e.exports=__kbnSharedDeps__.TsLib},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(2),r="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;t.default=r},function(e,t,s){"use strict";s.r(t),s.d(t,"NewsfeedApiEndpoint",(function(){return W})),s.d(t,"plugin",(function(){return Y}));var n=s(5),r=s.n(n),i=s(3),a=s(11),o=s.n(a),u=s(2),c=s.n(u),l=s(4),d=s.n(l),f=s(8),b=s.n(f),h=s(14),p=s(15),j=s(9),m=s.n(j),g=s(10),O=s.n(g),_=s(1);const x="eui-global",y="eui-utilities",v={darkMode:!1};var w=s(0);const S=[_.euiStylisPrefixer],k=O()({key:"css",stylisPlugins:S,container:document.querySelector('meta[name="emotion"]')}),E=O()({key:x,stylisPlugins:S,container:document.querySelector(`meta[name="${x}"]`)}),N=O()({key:y,stylisPlugins:S,container:document.querySelector(`meta[name="${y}"]`)});k.compat=!0,E.compat=!0,N.compat=!0;const P={default:k,global:E,utility:N},I=({theme:{theme$:e},globalStyles:t,colorMode:s,modify:n,children:r})=>{const i=m()(e,v),a=Object(u.useMemo)((()=>(e=>e.darkMode?_.COLOR_MODES_STANDARD.dark:_.COLOR_MODES_STANDARD.light)(i)),[i]),o=s||a,c=!1!==t&&void 0;return Object(w.jsx)(_.EuiProvider,{cache:P,modify:n,colorMode:o,globalStyles:c,utilityClasses:c},r)},R=({children:e,i18n:t,...s})=>Object(h.useIsNestedEuiProvider)()?(Object(p.emitEuiProviderWarning)("KibanaRootContextProvider has likely been nested in this React tree, either by direct reference or by KibanaRenderContextProvider.  The result of this nesting is a nesting of EuiProvider, which has negative effects.  Check your React tree for nested Kibana context providers."),Object(w.jsx)(t.Context,null,e)):Object(w.jsx)(I,s,Object(w.jsx)(t.Context,null,e));var M=s(12);const A=({children:e,...t})=>Object(w.jsx)(R,b()({globalStyles:!1},t),Object(w.jsx)(M.KibanaErrorBoundaryProvider,{analytics:t.analytics},Object(w.jsx)(M.KibanaErrorBoundary,null,e)));var F=s(7),D=s(6);const T=()=>Object(w.jsx)(_.EuiEmptyPrompt,{iconType:"documents",titleSize:"s","data-test-subj":"emptyNewsfeed",title:Object(w.jsx)("h2",null,Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsTitle",defaultMessage:"No news?"})),body:Object(w.jsx)("p",null,Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.emptyPrompt.noNewsText",defaultMessage:"If your Kibana instance doesn’t have internet access, ask your administrator to disable this feature. Otherwise, we’ll keep trying to fetch the news."}))}),$=({showPlainSpinner:e})=>Object(w.jsx)(_.EuiEmptyPrompt,{title:e?Object(w.jsx)(_.EuiLoadingSpinner,{size:"xl"}):Object(w.jsx)(_.EuiLoadingElastic,{size:"xl"}),body:Object(w.jsx)("p",null,Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.loadingPrompt.gettingNewsText",defaultMessage:"Getting the latest news..."}))}),C=e=>{const{newsFetchResult:t,setFlyoutVisible:s}=Object(u.useContext)(L),n=Object(u.useCallback)((()=>s(!1)),[s]),{showPlainSpinner:r,...i}=e;return Object(w.jsx)(_.EuiPortal,null,Object(w.jsx)(_.EuiFlyout,b()({},i,{onClose:n,size:"s","aria-labelledby":"flyoutSmallTitle",className:"kbnNews__flyout","data-test-subj":"NewsfeedFlyout"}),Object(w.jsx)(_.EuiFlyoutHeader,{hasBorder:!0},Object(w.jsx)(_.EuiTitle,{size:"s"},Object(w.jsx)("h2",{id:"flyoutSmallTitle"},Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.flyoutList.whatsNewTitle",defaultMessage:"What's new at Elastic"})))),Object(w.jsx)(_.EuiFlyoutBody,{className:"kbnNews__flyoutAlerts"},t?t.feedItems.length>0?t.feedItems.map((e=>Object(w.jsx)(_.EuiHeaderAlert,{key:e.hash,title:e.title,text:e.description,"data-test-subj":"newsHeadAlert",action:Object(w.jsx)(_.EuiLink,{target:"_blank",href:e.linkUrl,external:!0},e.linkText),date:e.publishOn.format("DD MMMM YYYY"),badge:e.badge?Object(w.jsx)(_.EuiBadge,{color:"hollow"},e.badge):void 0}))):Object(w.jsx)(T,null):Object(w.jsx)($,{showPlainSpinner:e.showPlainSpinner})),Object(w.jsx)(_.EuiFlyoutFooter,null,Object(w.jsx)(_.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},Object(w.jsx)(_.EuiFlexItem,{grow:!1},Object(w.jsx)(_.EuiButtonEmpty,{iconType:"cross",onClick:n,flush:"left"},Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.flyoutList.closeButtonLabel",defaultMessage:"Close"}))),Object(w.jsx)(_.EuiFlexItem,{grow:!1},t?Object(w.jsx)(_.EuiText,{color:"subdued",size:"s"},Object(w.jsx)("p",null,Object(w.jsx)(D.FormattedMessage,{id:"newsfeed.flyoutList.versionTextLabel",defaultMessage:"{version}",values:{version:`Version ${t.kibanaVersion}`}}))):null)))))},L=c.a.createContext({}),B=({newsfeedApi:e,hasCustomBranding$:t})=>{const[s,n]=Object(u.useState)(!1),[r,i]=Object(u.useState)(null),a=m()(t,!1),o=Object(u.useMemo)((()=>!!r&&r.hasNew),[r]),l=Object(u.useRef)(null);Object(u.useEffect)((()=>{const t=e.fetchResults$.subscribe((e=>{i(e)}));return()=>t.unsubscribe()}),[e]);const d=Object(u.useCallback)((()=>{r&&e.markAsRead(r.feedItems.map((e=>e.hash))),n(!s)}),[e,r,s]);return Object(w.jsx)(L.Provider,{value:{setFlyoutVisible:n,newsFetchResult:r}},Object(w.jsx)(c.a.Fragment,null,Object(w.jsx)(_.EuiHeaderSectionItemButton,{ref:e=>l.current=e,"data-test-subj":"newsfeed","aria-controls":"keyPadMenu","aria-expanded":s,"aria-haspopup":"true","aria-label":o?F.i18n.translate("newsfeed.headerButton.unreadAriaLabel",{defaultMessage:"Newsfeed menu - unread items available"}):F.i18n.translate("newsfeed.headerButton.readAriaLabel",{defaultMessage:"Newsfeed menu - all items read"}),notification:!!o||null,onClick:d},Object(w.jsx)(_.EuiIcon,{type:"cheer",size:"m"})),s?Object(w.jsx)(C,{focusTrapProps:{shards:[l]},showPlainSpinner:a}):null))},K=e=>!d()(e.expire_on).isBefore(Date.now())&&!d()(e.publish_on).isAfter(Date.now()),V=e=>![e.title,e.description,e.linkText,e.linkUrl,e.publishOn,e.hash].includes(void 0);class driver_NewsfeedApiDriver{constructor(e,t,s,n){r()(this,"kibanaVersion",void 0),r()(this,"loadedTime",d()().utc()),this.userLanguage=t,this.fetchInterval=s,this.storage=n,this.kibanaVersion=e.replace(/^(\d+\.\d+\.\d+).*/,"$1")}shouldFetch(){const e=this.storage.getLastFetchTime();if(!e)return!0;const t=d()(e);if(this.loadedTime.diff(t)>0)return!0;const s=d.a.utc();return d.a.duration(s.diff(t)).asMilliseconds()>this.fetchInterval}fetchNewsfeedItems(e){const t=e.pathTemplate.replace("{VERSION}",this.kibanaVersion),s=(e.urlRoot||"https://feeds.elastic.co")+t,n=new Request(s,{method:"GET"});return i.from(window.fetch(n).then((async e=>{const{items:t}=await e.json();return this.convertResponse(t)})))}convertResponse(e){const t=((e,t)=>e.filter(K).map((e=>((e,t)=>{const{expire_on:s,publish_on:n,languages:r,title:i,description:a,link_text:o,link_url:u,badge:c,hash:l}=e;let f=t;return r&&r.includes(f)||(f="en"),{title:i[f],description:a[f],linkText:null!=o?o[f]:null,linkUrl:u[f],badge:null!=c?c[f]:null,publishOn:d()(n),expireOn:d()(s),hash:l.slice(0,10)}})(e,t))).filter(V))(e,this.userLanguage),s=this.storage.setFetchedItems(t.map((e=>e.hash)));return{error:null,kibanaVersion:this.kibanaVersion,hasNew:s,feedItems:t}}}class NeverFetchNewsfeedApiDriver{shouldFetch(){return!1}fetchNewsfeedItems(){throw new Error("Not implemented!")}}class storage_NewsfeedStorage{constructor(e){r()(this,"lastFetchStorageKey",void 0),r()(this,"readStatusStorageKey",void 0),r()(this,"unreadStatus$",void 0),this.lastFetchStorageKey=z(e,"lastFetch"),this.readStatusStorageKey=z(e,"readStatus"),this.unreadStatus$=new i.BehaviorSubject(U(this.getReadStatus()))}getLastFetchTime(){const e=localStorage.getItem(this.lastFetchStorageKey);if(e)return d()(e,"x").toDate()}setLastFetchTime(e){localStorage.setItem(this.lastFetchStorageKey,JSON.stringify(e.getTime()))}setFetchedItems(e){const t=this.getReadStatus(),s={};return e.forEach((e=>{var n;s[e]=null!==(n=t[e])&&void 0!==n&&n})),this.setReadStatus(s)}markItemsAsRead(e){const t=this.getReadStatus();return e.forEach((e=>{t[e]=!0})),this.setReadStatus(t)}isAnyUnread(){return this.unreadStatus$.value}isAnyUnread$(){return this.unreadStatus$.asObservable()}getReadStatus(){try{return JSON.parse(localStorage.getItem(this.readStatusStorageKey)||"{}")}catch(e){return{}}}setReadStatus(e){const t=U(e);return this.unreadStatus$.next(U(e)),localStorage.setItem(this.readStatusStorageKey,JSON.stringify(e)),t}}const U=e=>Object.values(e).some((e=>!e)),z=(e,t)=>`newsfeed.${e}.${t}`;let W=function(e){return e.KIBANA="kibana",e.KIBANA_ANALYTICS="kibana-analytics",e.SECURITY_SOLUTION="security-solution",e.OBSERVABILITY="observability",e}({});class plugin_NewsfeedPublicPlugin{constructor(e){r()(this,"kibanaVersion",void 0),r()(this,"config",void 0),r()(this,"stop$",new i.ReplaySubject(1)),this.kibanaVersion=e.env.packageInfo.version;const t=e.config.get();this.config=Object.freeze({...t,mainInterval:d.a.duration(t.mainInterval),fetchInterval:d.a.duration(t.fetchInterval)})}setup(e){return{}}start(e,{screenshotMode:t}){const s=t.isScreenshotMode(),n=this.createNewsfeedApi(this.config,W.KIBANA,s);return e.chrome.navControls.registerRight({order:1e3,mount:t=>this.mount(n,t,e)}),{createNewsFeed$:e=>{const t=Object.assign({},this.config,{service:{...this.config.service,pathTemplate:`/${e}/v{VERSION}.json`}}),{fetchResults$:n}=this.createNewsfeedApi(t,e,s);return n}}}stop(){this.stop$.next()}createNewsfeedApi(e,t,s){const n=function(e,t,s,n){const r=new storage_NewsfeedStorage(s),a=e.mainInterval.asMilliseconds(),o=(()=>{if(n)return new NeverFetchNewsfeedApiDriver;const s=F.i18n.getLocale(),i=e.fetchInterval.asMilliseconds();return new driver_NewsfeedApiDriver(t,s,i,r)})(),u=Object(i.timer)(0,a).pipe(Object(i.filter)((()=>o.shouldFetch())),Object(i.mergeMap)((()=>o.fetchNewsfeedItems(e.service).pipe(Object(i.catchError)((e=>(window.console.error(e),Object(i.of)({error:e,kibanaVersion:t,hasNew:!1,feedItems:[]}))))))),Object(i.tap)((()=>r.setLastFetchTime(new Date))));return{fetchResults$:Object(i.combineLatest)([u,r.isAnyUnread$()]).pipe(Object(i.map)((([e,t])=>({...e,hasNew:!e.error&&t})))),markAsRead:e=>{r.markItemsAsRead(e)}}}(e,this.kibanaVersion,t,s);return{markAsRead:n.markAsRead,fetchResults$:n.fetchResults$.pipe(Object(i.takeUntil)(this.stop$),Object(i.catchError)((()=>i.of(null))))}}mount(e,t,s){const n=s.customBranding.hasCustomBranding$;return o.a.render(Object(w.jsx)(A,s,Object(w.jsx)(B,{newsfeedApi:e,hasCustomBranding$:n})),t),()=>o.a.unmountComponentAtNode(t)}}function Y(e){return new plugin_NewsfeedPublicPlugin(e)}}]);