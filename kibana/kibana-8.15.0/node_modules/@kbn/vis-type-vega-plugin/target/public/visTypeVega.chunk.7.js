(window.visTypeVega_bundle_jsonpfunction=window.visTypeVega_bundle_jsonpfunction||[]).push([[7],{237:function(e,a){e.exports=function(e){const[a,t]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:a,version:t}}},238:function(e,a,t){var s,i;void 0===(i="function"==typeof(s=function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function a(e){var a,t,s=e.replace(/^v/,"").replace(/\+.*$/,""),i=(t="-",-1===(a=s).indexOf(t)?a.length:a.indexOf(t)),r=s.substring(0,i).split(".");return r.push(s.substring(i+1)),r}function t(e){return isNaN(Number(e))?e:Number(e)}function s(a){if("string"!=typeof a)throw new TypeError("Invalid argument expected string");if(!e.test(a))throw new Error("Invalid argument not valid semver ('"+a+"' received)")}function i(e,i){[e,i].forEach(s);for(var r=a(e),n=a(i),o=0;o<Math.max(r.length-1,n.length-1);o++){var l=parseInt(r[o]||0,10),u=parseInt(n[o]||0,10);if(l>u)return 1;if(u>l)return-1}var c=r[r.length-1],g=n[n.length-1];if(c&&g){var h=c.split(".").map(t),f=g.split(".").map(t);for(o=0;o<Math.max(h.length,f.length);o++){if(void 0===h[o]||"string"==typeof f[o]&&"number"==typeof h[o])return-1;if(void 0===f[o]||"string"==typeof h[o]&&"number"==typeof f[o])return 1;if(h[o]>f[o])return 1;if(f[o]>h[o])return-1}}else if(c||g)return c?-1:1;return 0}var r=[">",">=","=","<","<="],n={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};return i.compare=function(e,a,t){!function(e){if("string"!=typeof e)throw new TypeError("Invalid operator type, expected string but got "+typeof e);if(-1===r.indexOf(e))throw new TypeError("Invalid operator, expected one of "+r.join("|"))}(t);var s=i(e,a);return n[t].indexOf(s)>-1},i})?s.apply(a,[]):s)||(e.exports=i)},258:function(e,a,t){"use strict";t.r(a),t.d(a,"VegaParser",(function(){return vega_parser_VegaParser}));var s=t(8),i=t.n(s),r=t(7),n=t.n(r),o=t(237),l=t.n(o),u=t(238),c=t.n(u),g=t(10),h=t.n(g),f=t(4),d=t(45),p=t(5),m=t(56),v=t(103),y=t(39),_=t.n(y),b=t(46);const P="%timefilter%",V="%autointerval%",w="%dashboard_context-must_clause%",M="%dashboard_context-must_not_clause%",T="%dashboard_context-filter_clause%",x="%context_query%",C="%context%",S="%timefield%",j=(e,a)=>e.dataObject.name||p.i18n.translate("visTypeVega.esQueryParser.unnamedRequest",{defaultMessage:"Unnamed request #{index}",values:{index:a}});class es_query_parser_EsQueryParser{constructor(e,a,t,s){i()(this,"_timeCache",void 0),i()(this,"_searchAPI",void 0),i()(this,"_filters",void 0),i()(this,"_onWarning",void 0),this._timeCache=e,this._searchAPI=a,this._filters=t,this._onWarning=s}parseUrl(e,a){let t=a.body,s=a[C];delete a[C];let i=a[S];delete a[S];let n=void 0!==s||void 0!==i;if(void 0===t)a.body=t={};else if(!Object(r.isPlainObject)(t))throw new Error(p.i18n.translate("visTypeVega.esQueryParser.urlBodyValueTypeErrorMessage",{defaultMessage:"{configName} must be an object",values:{configName:"url.body"}}));const o=a[x];if(delete a[x],void 0!==o){if(void 0!==t.query)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyAndBodyQueryValuesAtTheSameTimeErrorMessage",{defaultMessage:"{dataUrlParam} must not have legacy {legacyContext} and {bodyQueryConfigName} values at the same time",values:{legacyContext:`"${x}"`,bodyQueryConfigName:'"body.query"',dataUrlParam:'"data.url"'}}));if(n)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.dataUrlMustNotHaveLegacyContextTogetherWithContextOrTimefieldErrorMessage",{defaultMessage:"{dataUrlParam} must not have {legacyContext} together with {context} or {timefield}",values:{legacyContext:`"${x}"`,context:`"${C}"`,timefield:`"${S}"`,dataUrlParam:'"data.url"'}}));if(!0!==o&&("string"!=typeof o||0===o.length))throw new Error(p.i18n.translate("visTypeVega.esQueryParser.legacyContextCanBeTrueErrorMessage",{defaultMessage:"Legacy {legacyContext} can either be {trueValue} (ignores time range picker), or it can be the name of the time field, e.g. {timestampParam}",values:{legacyContext:`"${x}"`,trueValue:"true",timestampParam:'"@timestamp"'}}));n=!0,s=!0;let e=`"url": {"${C}": true`;"string"==typeof o&&(i=o,e+=`, "${S}": ${JSON.stringify(i)}`),e+="}",this._onWarning(p.i18n.translate("visTypeVega.esQueryParser.legacyUrlShouldChangeToWarningMessage",{defaultMessage:"Legacy {urlParam}: {legacyUrl} should change to {result}",values:{legacyUrl:`"${x}": ${JSON.stringify(o)}`,result:e,urlParam:'"url"'}}))}if(void 0!==t.query){if(n)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.urlContextAndUrlTimefieldMustNotBeUsedErrorMessage",{defaultMessage:"{urlContext} and {timefield} must not be used when {queryParam} is set",values:{timefield:`url.${S}`,urlContext:`url.${C}`,queryParam:"url.body.query"}}));this._injectContextVars(t.query,!0)}else if(n&&(i&&(t.query={range:{[i]:this._createRangeFilter({[P]:!0})}}),s)){const e=Object(r.cloneDeep)(this._filters);i&&e.bool.must.push(t.query),t.query=e}return this._injectContextVars(t.aggs,!1),{dataObject:e,url:a}}async populateData(e){const a=e.map(((e,a)=>({...e.url,name:j(e,a)}))),t=this._searchAPI.search(a);(await t.toPromise()).forEach(((a,t)=>{const s=e.find((e=>j(e,t)===a.name));s&&(s.dataObject.url=s.url,s.dataObject.values=a.rawResponse)}))}_injectContextVars(e,a,t){if(e&&"object"==typeof e)if(Array.isArray(e))for(let t=0;t<e.length;){const s=e[t];if(!a||s!==T&&s!==w&&s!==M)this._injectContextVars(s,a),t++;else{let a="";switch(s){case T:a="filter";break;case w:a="must";break;case M:a="must_not"}const i=Object(r.cloneDeep)(this._filters);i&&i.bool&&i.bool[a]?Array.isArray(i.bool[a])?(e.splice(t,1,...i.bool[a]),t+=i.bool[a].length):e[t++]=i.bool[a]:e.splice(t,1)}}else for(const s of Object.keys(e)){const i=e[s];if(i&&"object"==typeof e)if("interval"!==s||"date_histogram"!==t)switch(i[P]){case"min":case"max":e[s]=this._getTimeBound(i,i[P]);continue;case!0:this._createRangeFilter(i);continue;case void 0:this._injectContextVars(i,a,s);continue;default:throw new Error(p.i18n.translate("visTypeVega.esQueryParser.timefilterValueErrorMessage",{defaultMessage:"{timefilter} property must be set to {trueValue}, {minValue}, or {maxValue}",values:{timefilter:`"${P}"`,trueValue:"true",minValue:'"min"',maxValue:'"max"'}}))}else{let a;if("string"==typeof i)a=i;else if(i[V]){let e=i[V];if(!0===e)e=50;else if("number"!=typeof e)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.autointervalValueTypeErrorMessage",{defaultMessage:"{autointerval} must be either {trueValue} or a number",values:{autointerval:`"${V}"`,trueValue:"true"}}));const{max:t,min:s}=this._timeCache.getTimeBounds();a=es_query_parser_EsQueryParser._roundInterval((t-s)/e)}Object.assign(e,Object(b.dateHistogramInterval)(a)),delete e.interval}}}_createRangeFilter(e){return e.gte=_()(this._getTimeBound(e,"min")).toISOString(),e.lte=_()(this._getTimeBound(e,"max")).toISOString(),e.format="strict_date_optional_time",delete e[P],delete e.shift,delete e.unit,e}_getTimeBound(e,a){var t;let s=(null===(t=this._timeCache.getTimeBounds()[a])||void 0===t?void 0:t.valueOf())||0;if(e.shift){const a=e.shift;if("number"!=typeof a)throw new Error(p.i18n.translate("visTypeVega.esQueryParser.shiftMustValueTypeErrorMessage",{defaultMessage:"{shiftParam} must be a numeric value",values:{shiftParam:'"shift"'}}));let t;switch(e.unit||"d"){case"w":case"week":t=6048e5;break;case"d":case"day":t=864e5;break;case"h":case"hour":t=36e5;break;case"m":case"minute":t=6e4;break;case"s":case"second":t=1e3;break;default:throw new Error(p.i18n.translate("visTypeVega.esQueryParser.unknownUnitValueErrorMessage",{defaultMessage:"Unknown {unitParamName} value. Must be one of: [{unitParamValues}]",values:{unitParamName:'"unit"',unitParamValues:'"week", "day", "hour", "minute", "second"'}}))}s+=a*t}return s}static _roundInterval(e){switch(!0){case e<=500:return"100ms";case e<=5e3:return"1s";case e<=7500:return"5s";case e<=15e3:return"10s";case e<=45e3:return"30s";case e<=18e4:return"1m";case e<=45e4:return"5m";case e<=12e5:return"10m";case e<=27e5:return"30m";case e<=72e5:return"1h";case e<=216e5:return"3h";case e<=864e5:return"12h";case e<=6048e5:return"24h";case e<=18144e5:return"1w";case e<36288e5:return"30d";default:return"1y"}}}var E=t(104),O=t(69);class ems_file_parser_EmsFileParser{constructor(e){i()(this,"_serviceSettings",void 0),i()(this,"_fileLayersP",void 0),this._serviceSettings=e}parseUrl(e,a){if("string"!=typeof a.name)throw new Error(p.i18n.translate("visTypeVega.emsFileParser.missingNameOfFileErrorMessage",{defaultMessage:"{dataUrlParam} with {dataUrlParamValue} requires {nameParam} parameter (name of the file)",values:{dataUrlParam:'"data.url"',dataUrlParamValue:'{"%type%": "emsfile"}',nameParam:'"name"'}}));return this._fileLayersP||(this._fileLayersP=this._serviceSettings.getFileLayers()),{obj:e,name:a.name}}async populateData(e){if(0===e.length)return;const a=await this._fileLayersP;for(const{obj:t,name:s}of e){const e=null==a?void 0:a.find((e=>e.name===s));if(!e)throw new Error(p.i18n.translate("visTypeVega.emsFileParser.emsFileNameDoesNotExistErrorMessage",{defaultMessage:"{emsfile} {emsfileName} does not exist",values:{emsfileName:JSON.stringify(s),emsfile:"emsfile"}}));const i=await this._serviceSettings.getUrlForRegionLayer(e);t.url=Object(O.b)(i)}}}class url_parser_UrlParser{constructor(e){i()(this,"_onWarning",void 0),this._onWarning=e}parseUrl(e,a){let t=a.url;if(!t)throw new Error(p.i18n.translate("visTypeVega.urlParser.dataUrlRequiresUrlParameterInFormErrorMessage",{defaultMessage:'{dataUrlParam} requires a {urlParam} parameter in a form "{formLink}"',values:{dataUrlParam:'"data.url"',urlParam:'"url"',formLink:"https://example.org/path/subpath"}}));const s=a.query;if(s){const e=new URLSearchParams;for(const[a,t]of Object.entries(s))e.append(a,String(t));t+=(t.includes("?")?"&":"?")+e.toString()}else this._onWarning(p.i18n.translate("visTypeVega.urlParser.urlShouldHaveQuerySubObjectWarningMessage",{defaultMessage:"Using a {urlObject} should have a {subObjectName} sub-object",values:{urlObject:'"url": {"%type%": "url", "url": ...}',subObjectName:'"query"'}}));e.url=t}populateData(){}}const D=Object(f.euiPaletteColorBlind)()[0],k={left:"row-reverse",right:"row",top:"column-reverse",bottom:"column"};class vega_parser_VegaParser{constructor(e,a,t,s,r){i()(this,"spec",void 0),i()(this,"hideWarnings",void 0),i()(this,"restoreSignalValuesOnRefresh",void 0),i()(this,"error",void 0),i()(this,"warnings",void 0),i()(this,"_urlParsers",void 0),i()(this,"isVegaLite",void 0),i()(this,"useHover",void 0),i()(this,"_config",void 0),i()(this,"useMap",void 0),i()(this,"renderer",void 0),i()(this,"tooltips",void 0),i()(this,"mapConfig",void 0),i()(this,"vlspec",void 0),i()(this,"useResize",void 0),i()(this,"containerDir",void 0),i()(this,"controlsDir",void 0),i()(this,"searchAPI",void 0),i()(this,"getServiceSettings",void 0),i()(this,"filters",void 0),i()(this,"timeCache",void 0),this.spec=e,this.hideWarnings=!1,this.error=void 0,this.warnings=[],this.searchAPI=a,this.getServiceSettings=r,this.filters=s,this.timeCache=t}async parseAsync(){try{await this._parseAsync()}catch(e){this.error=E.a.formatErrorToStr(e)}return this}async _parseAsync(){if(void 0!==this.isVegaLite)throw new Error;if("string"==typeof this.spec){const e=h.a.parse(this.spec,{legacyRoot:!1});if(!e.$schema)throw new Error(p.i18n.translate("visTypeVega.vegaParser.inputSpecDoesNotSpecifySchemaErrorMessage",{defaultMessage:"Your specification requires a {schemaParam} field with a valid URL for\nVega (see {vegaSchemaUrl}) or\nVega-Lite (see {vegaLiteSchemaUrl}).\nThe URL is an identifier only. Kibana and your browser will never access this URL.",values:{schemaParam:'"$schema"',vegaLiteSchemaUrl:"https://vega.github.io/vega-lite/docs/spec.html#top-level",vegaSchemaUrl:"https://vega.github.io/vega/docs/specification/#top-level-specification-properties"}}));this.spec=e}if(!n.a.isPlainObject(this.spec))throw new Error(p.i18n.translate("visTypeVega.vegaParser.invalidVegaSpecErrorMessage",{defaultMessage:"Invalid Vega specification"}));this.isVegaLite=this.parseSchema(this.spec).isVegaLite,this.useHover=!this.isVegaLite,this._config=this._parseConfig(),this.hideWarnings=!!this._config.hideWarnings,this._parseBool("restoreSignalValuesOnRefresh",this._config,!1),this.restoreSignalValuesOnRefresh=this._config.restoreSignalValuesOnRefresh,this.useMap="map"===this._config.type,this.renderer="svg"===this._config.renderer?"svg":"canvas",this.tooltips=this._parseTooltips(),this._setDefaultColors(),this._parseControlPlacement(),this.useMap&&(this.mapConfig=this._parseMapConfig(),this.useResize=!1),await this._resolveDataUrls(),this.isVegaLite?this._compileVegaLite():this._compileWithAutosize()}_compileWithAutosize(){const e={type:"fit",contains:"padding"};let a=this.spec.autosize,t=!0;if(this.isVegaLite||!a||"object"!=typeof a||!("signal"in a)){if(a||void 0===a||this._onWarning(p.i18n.translate("visTypeVega.vegaParser.autoSizeDoesNotAllowFalse",{defaultMessage:"{autoSizeParam} is enabled, it can only be disabled by setting {autoSizeParam} to {noneParam}",values:{autoSizeParam:'"autosize"',noneParam:'"none"'}})),"string"==typeof a)t="none"!==a,a={...e,type:a};else if("object"==typeof a){var s,i;a={...e,...a},t=Boolean((null===(s=a)||void 0===s?void 0:s.type)&&"none"!==(null===(i=a)||void 0===i?void 0:i.type))}else a=e;t&&(this.spec.width&&"container"!==this.spec.width||this.spec.height&&"container"!==this.spec.height)&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.widthAndHeightParamsAreIgnored",{defaultMessage:"{widthParam} and {heightParam} params are ignored because {autoSizeParam} is enabled. Set {autoSizeParam}: {noneParam} to disable",values:{widthParam:'"width"',heightParam:'"height"',autoSizeParam:'"autosize"',noneParam:'"none"'}})),t&&(this.spec.width="container",this.spec.height="container"),this.spec.autosize=a,this.useResize=t}}_compileVegaLite(){if(!this.useMap){const e=Object(v.compile)(this.spec,{logger:Object(m.logger)(m.None)}).normalized;"mark"in e||"layer"in e?this._compileWithAutosize():(this.useResize=!1,e.autosize&&"string"!=typeof e.autosize&&"none"===e.autosize.type&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.widthAndHeightParamsAreRequired",{defaultMessage:"Nothing is rendered when {autoSizeParam} is set to {noneParam} while using faceted or repeated {vegaLiteParam} specs. To fix, remove {autoSizeParam} or use {vegaParam}.",values:{autoSizeParam:'"autosize"',noneParam:'"none"',vegaLiteParam:"Vega-Lite",vegaParam:"Vega"}})))}this.vlspec=this.spec;const e=Object(m.logger)(m.Warn);if(e.warn=this._onWarning.bind(this),this.spec=Object(v.compile)(this.vlspec,{logger:e}).spec,this.useMap){if(!this.spec||!this.vlspec)return;const e=n.a.isPlainObject(this.vlspec.config);if(void 0===this.vlspec.config||e&&!this.vlspec.config.projection){if(!Array.isArray(this.spec.projections)||1!==this.spec.projections.length||"projection"!==this.spec.projections[0].name)throw new Error(p.i18n.translate("visTypeVega.vegaParser.VLCompilerShouldHaveGeneratedSingleProtectionObjectErrorMessage",{defaultMessage:"Internal error: Vega-Lite compiler should have generated a single projection object"}));delete this.spec.projections}this.vlspec.width||delete this.spec.width,this.vlspec.height||delete this.spec.height,this.vlspec.padding||void 0!==this.vlspec.config&&(!e||this.vlspec.config.padding)||delete this.spec.padding,this.vlspec.autosize||void 0!==this.vlspec.config&&(!e||this.vlspec.config.autosize)||delete this.spec.autosize}}_parseControlPlacement(){var e,a;if(this.containerDir=null!==(e=this._config)&&void 0!==e&&e.controlsLocation?k[this._config.controlsLocation]:void 0,void 0===this.containerDir){if(!this._config||void 0!==this._config.controlsLocation)throw new Error(p.i18n.translate("visTypeVega.vegaParser.unrecognizedControlsLocationValueErrorMessage",{defaultMessage:"Unrecognized {controlsLocationParam} value. Expecting one of [{locToDirMap}]",values:{locToDirMap:`"${Object.keys(k).join('", "')}"`,controlsLocationParam:"controlsLocation"}}));this.containerDir="column"}const t=null===(a=this._config)||void 0===a?void 0:a.controlsDirection;if(void 0!==t&&"horizontal"!==t&&"vertical"!==t)throw new Error(p.i18n.translate("visTypeVega.vegaParser.unrecognizedDirValueErrorMessage",{defaultMessage:"Unrecognized {dirParam} value. Expecting one of [{expectedValues}]",values:{expectedValues:'"horizontal", "vertical"',dirParam:"dir"}}));this.controlsDir="horizontal"===t?"row":"column"}_parseConfig(){let e=null;if(this.spec){if(void 0!==this.spec._hostConfig){if(e=this.spec._hostConfig,delete this.spec._hostConfig,!n.a.isPlainObject(e))throw new Error(p.i18n.translate("visTypeVega.vegaParser.hostConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:'"_hostConfig"'}}));this._onWarning(p.i18n.translate("visTypeVega.vegaParser.hostConfigIsDeprecatedWarningMessage",{defaultMessage:"{deprecatedConfigName} has been deprecated. Use {newConfigName} instead.",values:{deprecatedConfigName:'"_hostConfig"',newConfigName:"config.kibana"}}))}if(n.a.isPlainObject(this.spec.config)&&void 0!==this.spec.config.kibana&&(e=this.spec.config.kibana,delete this.spec.config.kibana,!n.a.isPlainObject(e)))throw new Error(p.i18n.translate("visTypeVega.vegaParser.kibanaConfigValueTypeErrorMessage",{defaultMessage:"If present, {configName} must be an object",values:{configName:"config.kibana"}}))}return e||{}}_parseTooltips(){var e;if(this._config&&!1===this._config.tooltips)return!1;const a=(null===(e=this._config)||void 0===e?void 0:e.tooltips)||{};if(void 0===a.position)a.position="top";else if(-1===["top","right","bottom","left"].indexOf(a.position))throw new Error(p.i18n.translate("visTypeVega.vegaParser.unexpectedValueForPositionConfigurationErrorMessage",{defaultMessage:"Unexpected value for the {configurationName} configuration",values:{configurationName:"result.position"}}));if(void 0===a.padding)a.padding=16;else if("number"!=typeof a.padding)throw new Error(p.i18n.translate("visTypeVega.vegaParser.paddingConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a number",values:{configName:"config.kibana.result.padding"}}));if(void 0===a.textTruncate)a.textTruncate=!1;else if("boolean"!=typeof a.textTruncate)throw new Error(p.i18n.translate("visTypeVega.vegaParser.textTruncateConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be a boolean",values:{configName:"textTruncate"}}));if(void 0===a.centerOnMark)a.centerOnMark=50;else if("boolean"==typeof a.centerOnMark)a.centerOnMark=a.centerOnMark?Number.MAX_VALUE:-1;else if("number"!=typeof a.centerOnMark)throw new Error(p.i18n.translate("visTypeVega.vegaParser.centerOnMarkConfigValueTypeErrorMessage",{defaultMessage:"{configName} is expected to be {trueValue}, {falseValue}, or a number",values:{configName:"config.kibana.result.centerOnMark",trueValue:"true",falseValue:"false"}}));return a}_parseMapConfig(){var e,a;const t={delayRepaint:void 0===(null===(e=this._config)||void 0===e?void 0:e.delayRepaint)||this._config.delayRepaint},s=(e,a)=>{const s=this._config?this._config[e]:void 0;if(void 0!==s){const i=parseFloat(s);if(Number.isFinite(i)&&(!a||i>=0&&i<=30))return void(t[e]=i);this._onWarning(p.i18n.translate("visTypeVega.vegaParser.someKibanaConfigurationIsNoValidWarningMessage",{defaultMessage:"{configName} is not valid",values:{configName:`config.kibana.${e}`}}))}a||(t[e]=0)};var i;s("latitude",!1),s("longitude",!1),s("zoom",!0),s("minZoom",!0),s("maxZoom",!0),this._parseBool("mapStyle",t,!0),t.mapStyle&&(t.emsTileServiceId=null===(i=this._config)||void 0===i?void 0:i.emsTileServiceId),this._parseBool("zoomControl",t,!0),this._parseBool("scrollWheelZoom",t,!1);const r=null===(a=this._config)||void 0===a?void 0:a.maxBounds;return void 0!==r&&(Array.isArray(r)&&4===r.length&&r.every((e=>"number"==typeof e&&Number.isFinite(e)))?t.maxBounds=r:this._onWarning(p.i18n.translate("visTypeVega.vegaParser.maxBoundsValueTypeWarningMessage",{defaultMessage:"{maxBoundsConfigName} must be an array with four numbers",values:{maxBoundsConfigName:"config.kibana.maxBounds"}}))),t}_parseBool(e,a,t){const s=this._config?this._config[e]:void 0;void 0===s?a[e]=t:"boolean"!=typeof s?(this._onWarning(p.i18n.translate("visTypeVega.vegaParser.someKibanaParamValueTypeWarningMessage",{defaultMessage:"{configName} must be a boolean value",values:{configName:`config.kibana.${e}`}})),a[e]=t):a[e]=s}parseSchema(e){try{const a=l()(e.$schema),t="vega-lite"===a.library,s=t?v.version:m.version;return c()(a.version,s)>0&&this._onWarning(p.i18n.translate("visTypeVega.vegaParser.notValidLibraryVersionForInputSpecWarningMessage",{defaultMessage:"The input spec uses {schemaLibrary} {schemaVersion}, but current version of {schemaLibrary} is {libraryVersion}.",values:{schemaLibrary:a.library,schemaVersion:a.version,libraryVersion:s}})),{isVegaLite:t,libVersion:s}}catch(e){throw Error(p.i18n.translate("visTypeVega.vegaParser.notValidSchemaForInputSpec",{defaultMessage:'The URL for the JSON "$schema" is incorrect. Correct the URL, then click Update.'}))}}async _resolveDataUrls(){if(!this._urlParsers){const e=await this.getServiceSettings(),a=this._onWarning.bind(this);this._urlParsers={elasticsearch:new es_query_parser_EsQueryParser(this.timeCache,this.searchAPI,this.filters,a),emsfile:new ems_file_parser_EmsFileParser(e),url:new url_parser_UrlParser(a)}}const e={};this.searchAPI.resetSearchStats(),this._findObjectDataUrls(this.spec,(a=>{const t=a.url;delete a.url;let s=t["%type%"];delete t["%type%"],void 0===s&&(s="elasticsearch");const i=this._urlParsers[s];if(void 0===i)throw new Error(p.i18n.translate("visTypeVega.vegaParser.notSupportedUrlTypeErrorMessage",{defaultMessage:"{urlObject} is not supported",values:{urlObject:'url: {"%type%": "${type}"}'}}));let r=e[s];void 0===r&&(e[s]=r=[]),r.push(i.parseUrl(a,t))}));const a=Object.keys(e);a.length>0&&await Promise.all(a.map((a=>this._urlParsers[a].populateData(e[a]))))}_findObjectDataUrls(e,a,t){if(Array.isArray(e))for(const s of e)this._findObjectDataUrls(s,a,t);else if(n.a.isPlainObject(e))if("data"===t&&n.a.isPlainObject(e.url)){if(void 0!==e.values||void 0!==e.source)throw new Error(p.i18n.translate("visTypeVega.vegaParser.dataExceedsSomeParamsUseTimesLimitErrorMessage",{defaultMessage:"Data must not have more than one of {urlParam}, {valuesParam}, and {sourceParam}",values:{urlParam:'"url"',valuesParam:'"values"',sourceParam:'"source"'}}));a(e)}else if("data"===t&&"string"==typeof e.url){const a=this.timeCache.getTimeBounds();e.url=e.url.replaceAll("%timefilter_min%",a.min.toString()).replaceAll("%timefilter_max%",a.max.toString())}else for(const t of Object.keys(e))this._findObjectDataUrls(e[t],a,t)}_setDefaultColors(){var e;this._setDefaultValue({scheme:"elastic"},"config","range","category"),this.isVegaLite?this._setDefaultValue(D,"config","mark","color"):(null===(e=this.spec)||void 0===e||!e.config.mark||void 0===this.spec.config.mark.color&&void 0===this.spec.config.mark.fill)&&(this._setDefaultValue(D,"config","arc","fill"),this._setDefaultValue(D,"config","area","fill"),this._setDefaultValue(D,"config","line","stroke"),this._setDefaultValue(D,"config","path","stroke"),this._setDefaultValue(D,"config","rect","fill"),this._setDefaultValue(D,"config","rule","stroke"),this._setDefaultValue(D,"config","shape","stroke"),this._setDefaultValue(D,"config","symbol","fill"),this._setDefaultValue(D,"config","trail","fill")),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","title","color"),this._setDefaultValue(d.euiThemeVars.euiColorDarkShade,"config","style","guide-label","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","guide-title","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","group-title","fill"),this._setDefaultValue(d.euiThemeVars.euiColorDarkestShade,"config","style","group-subtitle","fill"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","tickColor"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","domainColor"),this._setDefaultValue(d.euiThemeVars.euiColorChartLines,"config","axis","gridColor"),this._setDefaultValue("transparent","config","background")}_setDefaultValue(e,...a){let t=this.spec;for(let e=0;e<a.length-1;e++){const s=a[e],i=t[s];if(void 0===i)t[s]={};else if(!n.a.isPlainObject(i))return;t=t[s]}const s=a[a.length-1];void 0===t[s]&&(t[s]=e)}_onWarning(...e){if(!this.hideWarnings)return this.warnings.push(E.a.formatWarningToStr(e)),E.a.formatWarningToStr(e)}}}}]);