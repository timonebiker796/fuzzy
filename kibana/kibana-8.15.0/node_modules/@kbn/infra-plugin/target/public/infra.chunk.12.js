/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[12],{128:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(80).__importDefault(a(142));t.default=function(e){r.default((function(){e()}))}},142:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(3);t.default=function(e){r.useEffect(e,[])}},149:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a(98),l=a.n(r),i=a(31),n=a(84);function o(){const[e]=Object(i.useUiSetting$)(n.UI_SETTINGS.DATEFORMAT_TZ);return e&&"Browser"!==e?e:l.a.tz.guess()}},156:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return u}));var r=a(3),l=a(212),i=a.n(l),n=a(128),o=a.n(n),s=a(30);const c=({from:e,to:t})=>{const{services:a}=Object(s.c)();return[Object(r.useCallback)((()=>{const r=a.data.query.timefilter.timefilter;return r.isTimeTouched()?r.getTime():{from:e,to:t}}),[a.data.query.timefilter.timefilter,e,t]),a.data.query.timefilter.timefilter.setTime]},u=(e,t,a)=>{const{services:l}=Object(s.c)(),[n,u]=c(e);o()((()=>{e.from===t.from&&e.to===t.to||u({from:t.from,to:t.to})})),i()((()=>{u({from:t.from,to:t.to})}),[t.from,t.to,u]),Object(r.useEffect)((()=>{const e=l.data.query.timefilter.timefilter.getTimeUpdate$().subscribe((()=>{if(a){const e=n();a(e)}}));return()=>e.unsubscribe()}),[n,a,l.data.query.timefilter.timefilter])}},212:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(3),l=a(213);t.default=function(e,t){var a=l.useFirstMountState();r.useEffect((function(){if(!a)return e()}),t)}},213:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var r=a(3);t.useFirstMountState=function(){var e=r.useRef(!0);return e.current?(e.current=!1,!0):e.current}},236:function(e,t,a){"use strict";a.d(t,"h",(function(){return p})),a.d(t,"d",(function(){return f})),a.d(t,"f",(function(){return b})),a.d(t,"i",(function(){return E})),a.d(t,"j",(function(){return g})),a.d(t,"g",(function(){return h})),a.d(t,"a",(function(){return x})),a.d(t,"e",(function(){return y})),a.d(t,"c",(function(){return T})),a.d(t,"b",(function(){return j}));var r=a(3),l=a.n(r),i=a(81),n=a(76),o=a.n(n),s=a(1),c=a(40),u=a(73),m=a(13),d=a(21);const p={headerFormatter:({value:e})=>o()(e).format("Y-MM-DD HH:mm:ss")},f=20,b={s:s.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:s.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:s.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:s.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},E=(e,t)=>Object(r.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(i.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),g=d.a,h=(e,t=!1)=>{let a=null,r=null;const l=e.reduce(((e,t)=>(t.points.forEach((t=>{const a=e[t.timestamp]||[];e[t.timestamp]=[...a,t.value]})),e)),{});Object.values(l).forEach((e=>{const l=t?Object(m.sum)(e):Object(m.max)(e),i=Object(m.min)(e);l&&(!r||l>r)&&(r=l),i&&(!a||i<a)&&(a=i)}));const i=Object.keys(l).map(Number),n=Object(m.min)(i)||0,o=Object(m.max)(i)||0;return{yMin:a||0,yMax:r||0,xMin:n,xMax:o}},v=({children:e})=>l.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),x=({children:e})=>l.a.createElement("div",{style:{width:"100%",height:150}},e),y=()=>l.a.createElement(v,null,l.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"noChartData"},l.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),T=()=>l.a.createElement(v,null,l.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"loadingData"},l.a.createElement(c.EuiLoadingChart,{size:"m"}))),j=()=>l.a.createElement(v,null,l.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},l.a.createElement(u.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},646:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultExpression",(function(){return Y})),a.d(t,"Expressions",(function(){return K})),a.d(t,"ExpressionRow",(function(){return te})),a.d(t,"nodeTypes",(function(){return le}));var r=a(77),l=a.n(r),i=a(40),n=a(1),o=a(41),s=a(73),c=a(88),u=a(13),m=a(3),d=a.n(m),p=a(152),f=a.n(p),b=a(18),E=a(28),g=a(83),h=a(121),v=a(17),x=a(200),y=a(116),T=a(174),j=a(175),O=a(81),w=a(76),M=a.n(w),C=a(151),k=a(22),S=a(198),F=a(199),R=a(196),I=a(231),L=a(197),z=a(138),A=a(236);const B=.3,_=({threshold:e,sortedThresholds:t,comparator:a,color:r,id:l,firstTimestamp:i,lastTimestamp:n,domain:o})=>{if(!a||!e)return null;const s=[E.a.GREATER_THAN,E.a.GREATER_THAN_OR_EQUALS].includes(a),c=[E.a.LESS_THAN,E.a.LESS_THAN_OR_EQUALS].includes(a);return d.a.createElement(d.a.Fragment,null,d.a.createElement(O.LineAnnotation,{id:`${l}-thresholds`,domainType:O.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:Object(k.b)(r),opacity:1}}}),2===t.length&&a===E.a.BETWEEN?d.a.createElement(d.a.Fragment,null,d.a.createElement(O.RectAnnotation,{id:`${l}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:Object(k.b)(r),opacity:B},dataValues:[{coordinates:{x0:i,x1:n,y0:Object(u.first)(e),y1:Object(u.last)(e)}}]})):null,2===t.length&&a===E.a.NOT_BETWEEN?d.a.createElement(d.a.Fragment,null,d.a.createElement(O.RectAnnotation,{id:`${l}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:Object(k.b)(r),opacity:B},dataValues:[{coordinates:{x0:i,x1:n,y0:o.min,y1:Object(u.first)(e)}}]}),d.a.createElement(O.RectAnnotation,{id:`${l}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:Object(k.b)(r),opacity:B},dataValues:[{coordinates:{x0:i,x1:n,y0:Object(u.last)(e),y1:o.max}}]})):null,c&&null!=Object(u.first)(e)?d.a.createElement(O.RectAnnotation,{id:`${l}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:Object(k.b)(r),opacity:B},dataValues:[{coordinates:{x0:i,x1:n,y0:o.min,y1:Object(u.first)(e)}}]}):null,s&&null!=Object(u.first)(e)?d.a.createElement(O.RectAnnotation,{id:`${l}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:Object(k.b)(r),opacity:B},dataValues:[{coordinates:{x0:i,x1:n,y0:Object(u.first)(e),y1:o.max}}]}):null)},P=({expression:e,filterQuery:t,nodeType:a,sourceId:r,accountId:l="",region:o=""})=>{var c,p,f,b,E;const h=Object(C.a)(),v=Object(m.useMemo)((()=>({interval:`${e.timeSize||1}${e.timeUnit}`,from:M()().subtract(20*(e.timeSize||1),e.timeUnit).valueOf(),to:M()().valueOf(),forceInterval:!0})),[e.timeSize,e.timeUnit]),x=e=>({...e,type:"custom"}),{loading:y,nodes:T}=Object(S.a)({filterQuery:t,metrics:"custom"===e.metric?[x(e.customMetric)]:[{type:e.metric}],groupBy:[],nodeType:a,sourceId:r,currentTime:0,accountId:l,region:o,timerange:v}),j={field:e.metric,aggregation:"avg",color:k.a.color0},w=Object(m.useMemo)((()=>{var e,t,a,r;const l=null===(e=T[0])||void 0===e||null===(t=e.metrics[0])||void 0===t?void 0:t.timeseries,i=null===(a=Object(u.first)(null==l?void 0:l.rows))||void 0===a?void 0:a.timestamp,n=null===(r=Object(u.last)(null==l?void 0:l.rows))||void 0===r?void 0:r.timestamp;return null==i||null==n?e=>`${e}`:Object(O.niceTimeFormatter)([i,n])}),[T]),B=Object(m.useCallback)(Object(F.a)("custom"===e.metric?x(e.customMetric):{type:e.metric}),[e.metric]);if(y||!T)return d.a.createElement(A.c,null);const P=t=>W(e.metric,t),D=e.threshold.map(P),N=null!==(c=null===(p=e.warningThreshold)||void 0===p?void 0:p.map(P))&&void 0!==c?c:[],$=D.slice().sort(),Q=N.slice().sort(),U=[...$,...Q].sort(),G=null===(f=T[0])||void 0===f||null===(b=f.metrics[0])||void 0===b?void 0:b.timeseries;if(!G||!G.rows||0===G.rows.length)return d.a.createElement(A.e,null);const V={...G,id:null===(E=T[0])||void 0===E?void 0:E.name,rows:G.rows.map((e=>{const t={...e};return U.forEach(((e,a)=>{t[Object(I.a)(j,`threshold_${a}`)]=e})),t}))},H=Object(u.first)(G.rows).timestamp,q=Object(u.last)(G.rows).timestamp,Y=Object(R.a)(V,[j],!1),K={max:1.1*Math.max(Y.max,Object(u.last)(U)||Y.max),min:.9*Math.min(Y.min,Object(u.first)(U)||Y.min)};K.min===Object(u.first)(D)&&(K.min=.9*K.min);const{timeSize:Z,timeUnit:J}=e,X=A.f[J];return d.a.createElement(d.a.Fragment,null,d.a.createElement(A.a,null,d.a.createElement(O.Chart,null,d.a.createElement(L.a,{type:z.a.bar,metric:j,id:"0",series:V,stack:!1}),d.a.createElement(_,{comparator:Object(g.convertToBuiltInComparators)(e.comparator),threshold:D,sortedThresholds:$,color:k.a.color1,id:"critical",firstTimestamp:H,lastTimestamp:q,domain:K}),e.warningComparator&&e.warningThreshold&&d.a.createElement(_,{comparator:Object(g.convertToBuiltInComparators)(e.warningComparator),threshold:N,sortedThresholds:Q,color:k.a.color5,id:"warning",firstTimestamp:H,lastTimestamp:q,domain:K}),d.a.createElement(O.Axis,{id:"timestamp",position:O.Position.Bottom,showOverlappingTicks:!0,tickFormat:w}),d.a.createElement(O.Axis,{id:"values",position:O.Position.Left,tickFormat:B,domain:K}),d.a.createElement(O.Settings,{baseTheme:h.baseTheme,locale:n.i18n.getLocale()}),d.a.createElement(O.Tooltip,A.h))),d.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==V.id?d.a.createElement(i.EuiText,{size:"xs",color:"subdued"},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:V.id,timeLabel:X,lookback:20*Z}})):d.a.createElement(i.EuiText,{size:"xs",color:"subdued"},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:X,lookback:20*Z}}))))},W=(e,t)=>D[e]?D[e](t):t,D={cpu:e=>Number(e)/100,memory:e=>Number(e)/100,tx:e=>Number(e)/8,rx:e=>Number(e)/8};var N=a(176),$=a(26);const Q={avg:n.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),max:n.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),min:n.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),rate:n.i18n.translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})},U=$.b.map((e=>({text:Q[e],value:e}))),G=({metric:e,metrics:t,customMetric:a,errors:r,onChange:l,onChangeCustom:o,popupPosition:c})=>{var p;const[f,b]=Object(m.useState)(!1),[E,g]=Object(m.useState)("custom"===(null==e?void 0:e.value)),[h,v]=Object(m.useState)(null==e?void 0:e.value),[x,T]=Object(m.useState)(null==a?void 0:a.label),{metricsView:j}=Object(y.c)(),O={text:n.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.selectFieldLabel",{defaultMessage:"Select a metric"}),value:""},w=Object(m.useMemo)((()=>{var e;return(null!==(e=null==j?void 0:j.fields)&&void 0!==e?e:[]).filter((e=>e.aggregatable&&"number"===e.type&&!((null==a?void 0:a.field)===e.name))).map((e=>({label:e.name})))}),[null==j?void 0:j.fields,null==a?void 0:a.field]),M=Object(m.useMemo)((()=>E?(null==a?void 0:a.field)&&Object(N.a)(a):(null==e?void 0:e.text)||O.text),[E,e,a,O]),C=Object(m.useCallback)((e=>{"metric-popover-custom"===e?(g(!0),l("custom")):(g(!1),l(h))}),[g,l,h]),k=Object(m.useCallback)((e=>{const t=e.target.value,r=$.c.is(t)?t:"avg",l={...a,aggregation:r};$.d.is(l)&&o(l)}),[a,o]),S=Object(m.useCallback)((e=>{const t={...a,field:e[0].label};$.d.is(t)&&o(t)}),[a,o]),F=Object(u.debounce)(o,500),R=Object(m.useCallback)((e=>{T(e.target.value);const t={...a,label:e.target.value};$.d.is(t)&&F(t)}),[a,F]),I=t.map((e=>({label:e.text,value:e.value})),[]);return d.a.createElement(i.EuiPopover,{id:"metricPopover",button:d.a.createElement(i.EuiExpression,{description:n.i18n.translate("xpack.infra.metrics.alertFlyout.expression.metric.whenLabel",{defaultMessage:"When"}),value:M,isActive:Boolean(f||r.metric&&r.metric.length>0),onClick:()=>{b(!0)},color:null!==(p=r.metric)&&void 0!==p&&p.length?"danger":"success"}),isOpen:f,closePopover:()=>{b(!1)},anchorPosition:null!=c?c:"downRight",zIndex:8e3},d.a.createElement("div",{style:{width:620}},d.a.createElement(V,{onClose:()=>b(!1)},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.metric.popoverTitle",defaultMessage:"Metric"})),d.a.createElement(i.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:"Metric type",options:[{id:"metric-popover-default",label:"Default metric"},{id:"metric-popover-custom",label:"Custom metric"}],idSelected:E?"metric-popover-custom":"metric-popover-default",onChange:C}),d.a.createElement(i.EuiSpacer,{size:"m"}),E?d.a.createElement(d.a.Fragment,null,d.a.createElement(i.EuiFormRow,{fullWidth:!0},d.a.createElement(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiSelect,{"data-test-subj":"infraMetricExpressionSelect",onChange:k,value:(null==a?void 0:a.aggregation)||"avg",options:U,fullWidth:!0})),d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiText,{color:"subdued"},d.a.createElement("span",null,n.i18n.translate("xpack.infra.waffle.customMetrics.of",{defaultMessage:"of"})))),d.a.createElement(i.EuiFlexItem,null,d.a.createElement(i.EuiComboBox,{fullWidth:!0,placeholder:n.i18n.translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:!0},selectedOptions:null!=a&&a.field?[{label:a.field}]:[],options:w,onChange:S,isClearable:!1,isInvalid:r.metric.length>0})))),d.a.createElement(i.EuiFormRow,{label:n.i18n.translate("xpack.infra.waffle.alerting.customMetrics.labelLabel",{defaultMessage:"Metric name (optional)"}),display:"rowCompressed",fullWidth:!0,helpText:n.i18n.translate("xpack.infra.waffle.alerting.customMetrics.helpText",{defaultMessage:'Choose a name to help identify your custom metric. Defaults to "<function> of <field name>".',ignoreTag:!0})},d.a.createElement(i.EuiFieldText,{"data-test-subj":"infraMetricExpressionFieldText",name:"label",placeholder:n.i18n.translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:x,fullWidth:!0,onChange:R}))):d.a.createElement(i.EuiFormRow,{fullWidth:!0},d.a.createElement(i.EuiFlexGroup,null,d.a.createElement(i.EuiFlexItem,{className:"actOf__metricContainer"},d.a.createElement(i.EuiComboBox,{fullWidth:!0,singleSelection:{asPlainText:!0},"data-test-subj":"availablefieldsOptionsComboBox",isInvalid:r.metric.length>0,placeholder:O.text,options:I,noSuggestions:!I.length,selectedOptions:e?I.filter((t=>t.value===e.value)):[],renderOption:e=>e.label,onChange:e=>{e.length>0?(l(e[0].value),v(e[0].value)):l()}}))))))},V=({children:e,onClose:t})=>d.a.createElement(i.EuiPopoverTitle,null,d.a.createElement(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},d.a.createElement(i.EuiFlexItem,null,e),d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiButtonIcon,{"data-test-subj":"infraClosablePopoverTitleButton",iconType:"cross",color:"danger","aria-label":n.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()})))),H=({value:e,options:t,onChange:a,popupPosition:r})=>{const[l,o]=Object(m.useState)(!1);return d.a.createElement(i.EuiPopover,{button:d.a.createElement(i.EuiExpression,{"data-test-subj":"nodeTypeExpression",description:n.i18n.translate("xpack.infra.metrics.alertFlyout.expression.for.descriptionLabel",{defaultMessage:"For"}),value:t[e].text,isActive:l,onClick:()=>{o(!0)}}),isOpen:l,closePopover:()=>{o(!1)},ownFocus:!0,anchorPosition:null!=r?r:"downLeft"},d.a.createElement("div",null,d.a.createElement(q,{onClose:()=>o(!1)},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.expression.for.popoverTitle",defaultMessage:"Node Type"})),d.a.createElement(i.EuiSelect,{"data-test-subj":"forExpressionSelect",value:e,fullWidth:!0,onChange:e=>{a(e.target.value),o(!1)},options:Object.values(t).map((e=>e))})))},q=({children:e,onClose:t})=>d.a.createElement(i.EuiPopoverTitle,null,d.a.createElement(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},d.a.createElement(i.EuiFlexItem,null,e),d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiButtonIcon,{"data-test-subj":"infraClosablePopoverTitleButton",iconType:"cross",color:"danger","aria-label":n.i18n.translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()})))),Y={metric:"cpu",comparator:E.a.GREATER_THAN,threshold:[],timeSize:1,timeUnit:"m",customMetric:{type:"custom",id:"alert-custom-metric",field:"",aggregation:"avg"}},K=e=>{const{setRuleParams:t,ruleParams:a,errors:r,metadata:l}=e,{source:o}=Object(y.d)(),[p,f]=Object(m.useState)(1),[b,E]=Object(m.useState)("m"),{metricsView:g}=Object(y.c)(),x=Object(m.useCallback)(((e,r)=>{const l=a.criteria?a.criteria.slice():[];l[e]=r,t("criteria",l)}),[t,a.criteria]),O=Object(m.useCallback)((()=>{var e;const r=(null===(e=a.criteria)||void 0===e?void 0:e.slice())||[];r.push({...Y,timeSize:null!=p?p:Y.timeSize,timeUnit:null!=b?b:Y.timeUnit}),t("criteria",r)}),[t,a.criteria,p,b]),w=Object(m.useCallback)((e=>{const r=a.criteria.slice();r.length>1&&(r.splice(e,1),t("criteria",r))}),[t,a.criteria]),M=Object(m.useCallback)((e=>{t("filterQueryText",null!=e?e:"");try{t("filterQuery",Object(j.a)(e,null==g?void 0:g.dataViewReference,!1)||"")}catch(e){t("filterQuery",v.d)}}),[null==g?void 0:g.dataViewReference,t]),C=Object(m.useCallback)(Object(u.debounce)(M,500),[M]),k=Object(m.useMemo)((()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]})),[]),S=Object(m.useCallback)((e=>{const r=a.criteria.map((t=>({...t,timeSize:e})));f(e||void 0),t("criteria",r)}),[a.criteria,t]),F=Object(m.useCallback)((e=>{const r=a.criteria.map((t=>({...t,timeUnit:e})));E(e),t("criteria",r)}),[a.criteria,t]),R=Object(m.useCallback)((e=>{t("nodeType",e)}),[t]),I=Object(m.useCallback)((e=>M(e.target.value)),[M]),L=Object(m.useCallback)((()=>{const e=l;e&&e.options?t("criteria",[{...Y,metric:e.options.metric.type,customMetric:h.n.is(e.options.metric)?e.options.metric:Y.customMetric}]):t("criteria",[Y])}),[l,t]),z=Object(m.useCallback)((()=>{const e=l;e&&e.filter&&(t("filterQueryText",e.filter),t("filterQuery",Object(j.a)(e.filter,null==g?void 0:g.dataViewReference)||""))}),[l,null==g?void 0:g.dataViewReference,t]);return Object(m.useEffect)((()=>{const e=l;a.nodeType||(e&&e.nodeType?t("nodeType",e.nodeType):t("nodeType","host")),a.criteria&&a.criteria.length?(f(a.criteria[0].timeSize),E(a.criteria[0].timeUnit)):L(),void 0===a.filterQuery&&z(),a.sourceId||t("sourceId",(null==o?void 0:o.id)||"default")}),[l,null==g?void 0:g.dataViewReference,Y,o]),d.a.createElement(d.a.Fragment,null,d.a.createElement(i.EuiSpacer,{size:"m"}),d.a.createElement(i.EuiText,{size:"xs"},d.a.createElement("h4",null,d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),d.a.createElement(ne,null,d.a.createElement(oe,null,d.a.createElement(se,null,d.a.createElement(H,{options:le,value:a.nodeType||"host",onChange:R})))),d.a.createElement(i.EuiSpacer,{size:"xs"}),a.criteria&&a.criteria.map(((e,t)=>d.a.createElement(te,{nodeType:a.nodeType,canDelete:a.criteria.length>1,remove:w,addExpression:O,key:t,expressionId:t,setRuleParams:x,errors:r[t]||k,expression:e||{}},d.a.createElement(P,{expression:e,filterQuery:a.filterQuery,nodeType:a.nodeType,sourceId:a.sourceId,accountId:a.accountId,region:a.region,"data-test-subj":"preview-chart"})))),d.a.createElement(ce,null,d.a.createElement(c.ForLastExpression,{timeWindowSize:p,timeWindowUnit:b,errors:k,onChangeWindowSize:S,onChangeWindowUnit:F})),d.a.createElement("div",null,d.a.createElement(i.EuiButtonEmpty,{"data-test-subj":"infraExpressionsAddConditionButton",color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:O},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),d.a.createElement(i.EuiSpacer,{size:"m"}),d.a.createElement(i.EuiCheckbox,{id:"metrics-alert-no-data-toggle",label:d.a.createElement(d.a.Fragment,null,n.i18n.translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",d.a.createElement(i.EuiIconTip,{type:"questionInCircle",color:"subdued",content:n.i18n.translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})})),checked:a.alertOnNoData,onChange:e=>t("alertOnNoData",e.target.checked)}),d.a.createElement(i.EuiSpacer,{size:"m"}),d.a.createElement(i.EuiFormRow,{label:n.i18n.translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:n.i18n.translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:!0,display:"rowCompressed"},l?d.a.createElement(T.a,{onSubmit:M,onChange:C,value:a.filterQueryText}):d.a.createElement(i.EuiFieldSearch,{"data-test-subj":"infraExpressionsFieldSearch",onChange:I,value:a.filterQueryText,fullWidth:!0})),d.a.createElement(i.EuiSpacer,{size:"m"}))};t.default=Object(y.e)(K)("default");const Z=o.css`
  margin-left: 28px;
`,J=o.css`
  display: flex;
  flex-wrap: wrap;
  margin: 0 -4px;
`,X=o.css`
  padding: 0 4px;
`,ee=o.css`
  margin-left: 4px;
`,te=e=>{var t,a,r;const[l,o]=f()(!0),{children:c,setRuleParams:p,expression:g,errors:v,expressionId:y,remove:T,canDelete:j}=e,{metric:O,comparator:w=E.a.GREATER_THAN,threshold:M=[],customMetric:C,warningThreshold:k=[],warningComparator:S}=g,[F,R]=Object(m.useState)(Boolean(null==k?void 0:k.length)),I=Object(m.useCallback)((e=>{const t=b.SnapshotMetricTypeRT.is(e)?e:Boolean(e)?"custom":void 0,a={...g,metric:t};p(y,a)}),[y,g,p]),L=Object(m.useCallback)((e=>{h.n.is(e)&&p(y,{...g,customMetric:e})}),[y,g,p]),z=Object(m.useCallback)((e=>{p(y,{...g,comparator:e})}),[y,g,p]),A=Object(m.useCallback)((e=>{p(y,{...g,warningComparator:e})}),[y,g,p]),B=Object(m.useCallback)((e=>{e.join()!==g.threshold.join()&&p(y,{...g,threshold:e})}),[y,g,p]),_=Object(m.useCallback)((e=>{var t;e.join()!==(null===(t=g.warningThreshold)||void 0===t?void 0:t.join())&&p(y,{...g,warningThreshold:e})}),[y,g,p]),P=Object(m.useCallback)((()=>{F?(R(!1),p(y,Object(u.omit)(g,"warningComparator","warningThreshold"))):(R(!0),p(y,{...g,warningComparator:w,warningThreshold:[]}))}),[F,R,p,w,g,y]),W=d.a.createElement(ae,{comparator:w,threshold:M,updateComparator:z,updateThreshold:B,errors:null!==(t=v.critical)&&void 0!==t?t:{},metric:O}),D=F&&d.a.createElement(ae,{comparator:S||w,threshold:k,updateComparator:A,updateThreshold:_,errors:null!==(a=v.warning)&&void 0!==a?a:{},metric:O}),N=Object(m.useMemo)((()=>{let t=b.hostSnapshotMetricTypes;switch(e.nodeType){case"awsEC2":t=b.awsEC2SnapshotMetricTypes;break;case"awsRDS":t=b.awsRDSSnapshotMetricTypes;break;case"awsS3":t=b.awsS3SnapshotMetricTypes;break;case"awsSQS":t=b.awsSQSSnapshotMetricTypes;break;case"host":t=b.hostSnapshotMetricTypes;break;case"pod":t=b.podSnapshotMetricTypes;break;case"container":t=b.containerSnapshotMetricTypes}return t.map(x.a)}),[e.nodeType]);return d.a.createElement(d.a.Fragment,null,d.a.createElement(i.EuiFlexGroup,{gutterSize:"xs"},d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiButtonIcon,{"data-test-subj":"infraExpressionRowButton",iconType:l?"arrowDown":"arrowRight",onClick:o,"aria-label":n.i18n.translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),d.a.createElement(i.EuiFlexItem,{grow:!0},d.a.createElement(ue,null,d.a.createElement(me,null,d.a.createElement(G,{metric:{value:O,text:(null===(r=N.find((e=>(null==e?void 0:e.value)===O)))||void 0===r?void 0:r.text)||""},metrics:N.filter((e=>void 0!==e&&void 0!==e.value)),onChange:I,onChangeCustom:L,errors:v,customMetric:C})),!F&&W),F&&d.a.createElement(d.a.Fragment,null,d.a.createElement(de,null,W,d.a.createElement(pe,{color:"danger"},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.criticalThreshold",defaultMessage:"Alert"}))),d.a.createElement(fe,null,D,d.a.createElement(be,{color:"warning"},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.warningThreshold",defaultMessage:"Warning"})),d.a.createElement(i.EuiButtonIcon,{"data-test-subj":"infraExpressionRowButton","aria-label":n.i18n.translate("xpack.infra.metrics.alertFlyout.removeWarningThreshold",{defaultMessage:"Remove warningThreshold"}),iconSize:"s",color:"text",iconType:"minusInCircleFilled",onClick:P}))),!F&&d.a.createElement(d.a.Fragment,null," ",d.a.createElement(i.EuiSpacer,{size:"xs"}),d.a.createElement(Ee,null,d.a.createElement(i.EuiButtonEmpty,{"data-test-subj":"infraExpressionRowAddWarningThresholdButton",color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:P},d.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alertFlyout.addWarningThreshold",defaultMessage:"Add warning threshold"}))))),j&&d.a.createElement(i.EuiFlexItem,{grow:!1},d.a.createElement(i.EuiButtonIcon,{"data-test-subj":"infraExpressionRowButton","aria-label":n.i18n.translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>T(y)}))),l?d.a.createElement(ge,null,c):null,d.a.createElement(i.EuiSpacer,{size:"s"}))},ae=({updateComparator:e,updateThreshold:t,threshold:a,metric:r,comparator:l,errors:n})=>{var o;return d.a.createElement(d.a.Fragment,null,d.a.createElement(he,null,d.a.createElement(c.ThresholdExpression,{thresholdComparator:Object(g.convertToBuiltInComparators)(l)||E.a.GREATER_THAN,threshold:a,onChangeSelectedThresholdComparator:e,onChangeSelectedThreshold:t,errors:n})),r&&d.a.createElement(ve,null,d.a.createElement(i.EuiText,{size:"s"},(null===(o=ie[r])||void 0===o?void 0:o.label)||"")))},re=e=>Object(b.findInventoryModel)(e).displayName,le={host:{text:re("host"),value:"host"},pod:{text:re("pod"),value:"pod"},container:{text:re("container"),value:"container"},awsEC2:{text:re("awsEC2"),value:"awsEC2"},awsS3:{text:re("awsS3"),value:"awsS3"},awsRDS:{text:re("awsRDS"),value:"awsRDS"},awsSQS:{text:re("awsSQS"),value:"awsSQS"}},ie={count:{label:""},cpu:{label:"%"},memory:{label:"%"},rx:{label:"bits/s"},tx:{label:"bits/s"},logRate:{label:"/s"},diskIOReadBytes:{label:"bytes/s"},diskIOWriteBytes:{label:"bytes/s"},s3BucketSize:{label:"bytes"},s3TotalRequests:{label:""},s3NumberOfObjects:{label:""},s3UploadBytes:{label:"bytes"},s3DownloadBytes:{label:"bytes"},sqsOldestMessage:{label:"seconds"},rdsLatency:{label:"ms"},custom:{label:""}};var ne=l()("div")`${X}`,oe=l()(i.EuiFlexGroup)`${J}`,se=l()("div")`${Z}`,ce=l()("div")`${Z}`,ue=l()(i.EuiFlexGroup)`${J}`,me=l()("div")`${X}`,de=l()(i.EuiFlexGroup)`${J}`,pe=l()(i.EuiHealth)`${ee}`,fe=l()(i.EuiFlexGroup)`${J}`,be=l()(i.EuiHealth)`${ee}`,Ee=l()(i.EuiFlexGroup)`${J}`,ge=l()("div")`
            padding: 0 0 0 28px;
          `,he=l()("div")`${X}`,ve=l()("div").withConfig({displayName:"_StyledDiv7",componentId:"sc-1jpo2mt-0"})(["align-self:center;"])}}]);