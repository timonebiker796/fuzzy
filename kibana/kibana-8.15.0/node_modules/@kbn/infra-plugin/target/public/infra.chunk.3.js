/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[3],{126:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s(3),r=s.n(a),n=s(1),i=s(31),o=s(90),c=s(119);function l(e,t,s,l=(e=>e),u,f,d=!1,m){var b;const p=Object(i.useKibana)(),g=u||(null===(b=p.services.http)||void 0===b?void 0:b.fetch),O=f||p.notifications.toasts.danger,[y,v]=Object(a.useState)(null),[x,k]=Object(a.useState)(null),j=Object(a.useRef)(new AbortController),M=Object(a.useCallback)((e=>{var t,s,a,i,l;const u=e;e&&(e instanceof c.a||e.name===o.AbortError.name)||(k(u),O({toastLifeTimeMs:3e3,title:n.i18n.translate("xpack.infra.useHTTPRequest.error.title",{defaultMessage:"Error while fetching resource"}),body:r.a.createElement("div",null,u.response?r.a.createElement(r.a.Fragment,null,r.a.createElement("h5",null,n.i18n.translate("xpack.infra.useHTTPRequest.error.status",{defaultMessage:"Error"})),null===(t=u.response)||void 0===t?void 0:t.statusText," (",null===(s=u.response)||void 0===s?void 0:s.status,")",r.a.createElement("h5",null,n.i18n.translate("xpack.infra.useHTTPRequest.error.url",{defaultMessage:"URL"})),null===(a=u.response)||void 0===a?void 0:a.url,r.a.createElement("h5",null,n.i18n.translate("xpack.infra.useHTTPRequest.error.body.message",{defaultMessage:"Message"})),(null===(i=u.body)||void 0===i?void 0:i.message)||u.message):r.a.createElement("h5",null,(null===(l=u.body)||void 0===l?void 0:l.message)||u.message))}))}),[O]);Object(a.useEffect)((()=>()=>{d&&j.current.abort()}),[d]);const[T,w,S]=Object(c.b)({cancelPreviousOn:"resolution",createPromise:()=>{if(!g)throw new Error("HTTP service is unavailable");return d&&j.current.abort(),j.current=new AbortController,g(e,{signal:j.current.signal,method:t,body:s,...m})},onResolve:e=>{try{v(l(e)),k(null)}catch(e){M(e)}},onReject:e=>{M(e)}},[e,s,t,u,O,M,m]);return{response:y,error:x,loading:"uninitialized"===T.state||"pending"===T.state,makeRequest:w,resetRequestState:S}}},138:function(e,t,s){"use strict";s.d(t,"b",(function(){return O})),s.d(t,"g",(function(){return y}));var a=s(82),r=s.n(a),n=s(0),i=s(117),o=s.n(i),c=s(3),l=s(8);s.d(t,"c",(function(){return l.d})),s.d(t,"a",(function(){return l.c})),s.d(t,"e",(function(){return l.g})),s.d(t,"d",(function(){return l.f})),s.d(t,"f",(function(){return l.h}));var u=s(166),f=s(22),d=s(156);n.type({fromTimestamp:n.number,toTimestamp:n.number,interval:n.string});const m=">=10s",b={type:l.c.line,yAxisMode:l.d.fromZero,stack:!1},p={aggregation:"avg",metrics:[{aggregation:"avg",field:"system.cpu.total.norm.pct",color:f.a.color0},{aggregation:"avg",field:"kubernetes.pod.cpu.usage.node.pct",color:f.a.color1},{aggregation:"avg",field:"docker.cpu.total.pct",color:f.a.color2}],source:"default"};function g(e,t){const s=localStorage.getItem(e),[a,r]=Object(c.useState)(function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}(s,t));return Object(c.useEffect)((()=>{localStorage.setItem(e,JSON.stringify(a))}),[e,a]),[a,r]}const[O,y]=o()((()=>{const e={from:"now-1h",to:"now"},[t]=Object(d.a)(e),{from:s,to:a}=t(),[n,i]=g("MetricsExplorerOptions",p),[o,l]=Object(c.useState)({from:s,to:a,interval:m}),[f,O]=Object(c.useState)((({from:e,to:t})=>({fromTimestamp:r.a.parse(e).valueOf(),toTimestamp:r.a.parse(t,{roundUp:!0}).valueOf(),interval:m}))({from:s,to:a}));Object(d.b)(e,{from:o.from,to:o.to});const[y,v]=g("MetricsExplorerChartOptions",b),[x,k]=Object(c.useState)(!1),{metricThresholdPrefill:j}=Object(u.b)(),M=Object(c.useMemo)((()=>j),[j]);return Object(c.useEffect)((()=>{if(M){const{setPrefillOptions:e}=M,{metrics:t,groupBy:s,filterQuery:a}=n;e({metrics:t,groupBy:s,filterQuery:a})}}),[n,M]),{defaultViewState:{options:p,chartOptions:b,currentTimerange:o},options:n,chartOptions:y,setChartOptions:v,timeRange:o,isAutoReloading:x,setOptions:i,setTimeRange:l,startAutoReload:()=>k(!0),stopAutoReload:()=>k(!1),timestamps:f,setTimestamps:O}}))},151:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(40),r=s(30);function n(){const{euiTheme:e}=Object(a.useEuiTheme)(),{services:{charts:t}}=Object(r.c)();return{baseTheme:t.theme.useChartsBaseTheme(),theme:{background:{color:"transparent"},crosshair:{band:{fill:e.colors.lightShade}},axes:{gridLine:{horizontal:{visible:!1},vertical:{dash:void 0}}}}}}},166:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return c}));var a=s(117),r=s.n(a),n=s(13),i=s(3);const[o,c]=r()((()=>({metricThresholdPrefill:(()=>{const[e,t]=Object(i.useState)({groupBy:void 0,filterQuery:void 0,metrics:[]}),{groupBy:s,filterQuery:a,metrics:r}=e;return{groupBy:s,filterQuery:a,metrics:r,setPrefillOptions(s){Object(n.isEqual)(s,e)||t(s)}}})(),inventoryPrefill:(()=>{const[e,t]=Object(i.useState)("host"),[s,a]=Object(i.useState)(),[r,n]=Object(i.useState)({type:"cpu"}),[o,c]=Object(i.useState)([]),[l,u]=Object(i.useState)(""),[f,d]=Object(i.useState)("");return{nodeType:e,filterQuery:s,metric:r,customMetrics:o,accountId:f,region:l,setAccountId:d,setNodeType:t,setFilterQuery:a,setMetric:n,setCustomMetrics:c,setRegion:u}})()})))},176:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(1);const r=e=>{const t={avg:a.i18n.translate("xpack.infra.waffle.aggregationNames.avg",{defaultMessage:"Avg of {field}",values:{field:e.field}}),max:a.i18n.translate("xpack.infra.waffle.aggregationNames.max",{defaultMessage:"Max of {field}",values:{field:e.field}}),min:a.i18n.translate("xpack.infra.waffle.aggregationNames.min",{defaultMessage:"Min of {field}",values:{field:e.field}}),rate:a.i18n.translate("xpack.infra.waffle.aggregationNames.rate",{defaultMessage:"Rate of {field}",values:{field:e.field}})};return e.label?e.label:t[e.aggregation]}},196:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(13),r=s(231);const n=e=>{const t=Object(a.min)(e);return Object(a.isNumber)(t)&&Number.isFinite(t)?t:void 0},i=e=>{const t=Object(a.max)(e);return Object(a.isNumber)(t)&&Number.isFinite(t)?t:void 0},o=(e,t,s=!1)=>{const o=e.rows.reduce(((e,o)=>{const c=t.map(((e,t)=>o[Object(r.a)(e,t)]||null)).filter((e=>Object(a.isNumber)(e))),l=n(c),u=s?1.1*Object(a.sum)(c):i(c);return e.concat([l||null,u||null])}),[]).filter((e=>Object(a.isNumber)(e)));return{min:n(o)||0,max:i(o)||0}}},197:function(e,t,s){"use strict";s.d(t,"a",(function(){return f}));var a=s(3),r=s.n(a),n=s(81),i=s(22),o=s(312),c=s(138),l=s(149),u=s(231);const f=e=>c.a.bar===e.type?r.a.createElement(m,e):r.a.createElement(d,e),d=({metric:e,id:t,series:s,type:a,stack:f,opacity:d})=>{const m=Object(l.a)(),b=e.color&&Object(i.b)(e.color)||Object(i.b)(i.a.color0),p=Array.isArray(t)?t.map((t=>Object(u.a)(e,t))).slice(t.length-1,t.length):[Object(u.a)(e,t)],g=Array.isArray(t)&&t.length>1?t.map((t=>Object(u.a)(e,t))).slice(0,1):void 0,O=`series-${s.id}-${p.join("-")}`,y={line:{strokeWidth:2,visible:!0},area:{opacity:d||.5,visible:a===c.a.area}};return r.a.createElement(n.AreaSeries,{id:O,key:O,name:Object(o.a)(e),xScaleType:n.ScaleType.Time,yScaleType:n.ScaleType.Linear,xAccessor:"timestamp",yAccessors:p,y0Accessors:g,data:s.rows,stackAccessors:f?["timestamp"]:void 0,areaSeriesStyle:y,color:b,timeZone:m})},m=({metric:e,id:t,series:s,stack:a})=>{const c=Object(l.a)(),f=e.color&&Object(i.b)(e.color)||Object(i.b)(i.a.color0),d=Array.isArray(t)?t.map((t=>Object(u.a)(e,t))).slice(t.length-1,t.length):[Object(u.a)(e,t)],m=`series-${s.id}-${d.join("-")}`,b={rectBorder:{stroke:f,strokeWidth:1,visible:!0},rect:{opacity:1}};return r.a.createElement(n.BarSeries,{id:m,key:m,name:Object(o.a)(e),xScaleType:n.ScaleType.Time,yScaleType:n.ScaleType.Linear,xAccessor:"timestamp",yAccessors:d,data:s.rows,stackAccessors:a?["timestamp"]:void 0,barSeriesStyle:b,color:f,timeZone:c})}},198:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var a=s(16),r=s(25),n=s(32),i=s(3),o=s(14),c=s(126),l=s(26);function u({timerange:e,currentTime:t,accountId:s="",region:u="",groupBy:f=null,sendRequestImmediately:d=!0,includeTimeseries:m=!0,dropPartialBuckets:b=!0,requestTs:p,...g},O){const y={...g,accountId:s,region:u,groupBy:f,timerange:null!=e?e:{interval:"1m",to:t,from:t-12e5,lookbackSize:5},includeTimeseries:m,dropPartialBuckets:b},{error:v,loading:x,response:k,makeRequest:j,resetRequestState:M}=Object(c.a)("/api/metrics/snapshot","POST",JSON.stringify(y),(e=>Object(n.pipe)(l.g.decode(e),Object(a.fold)(Object(o.d)(o.a),r.identity))),void 0,void 0,null==O?void 0:O.abortable);return Object(i.useEffect)((()=>(d&&j(),()=>{M()})),[j,d,M,p]),{error:v&&v.message||null,loading:x,nodes:k?k.nodes:[],interval:k?k.interval:"60s",reload:j}}},199:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s(13),r=s(43),n=s(26),i=s(232),o=s(45);const c={count:{formatter:r.b.number,template:"{{value}}"},cpu:{formatter:r.b.percent,template:"{{value}}"},diskIOReadBytes:{formatter:r.b.bytes,template:"{{value}}/s"},diskIOWriteBytes:{formatter:r.b.bytes,template:"{{value}}/s"},diskLatency:{formatter:r.b.number,template:"{{value}} ms"},diskSpaceUsage:{formatter:r.b.percent,template:"{{value}}"},memory:{formatter:r.b.percent,template:"{{value}}"},memoryFree:{formatter:r.b.bytes,template:"{{value}}"},memoryTotal:{formatter:r.b.bytes,template:"{{value}}"},normalizedLoad1m:{formatter:r.b.percent,template:"{{value}}"},rx:{formatter:r.b.bits,template:"{{value}}/s"},tx:{formatter:r.b.bits,template:"{{value}}/s"},logRate:{formatter:r.b.abbreviatedNumber,template:"{{value}}/s"},s3BucketSize:{formatter:r.b.bytes,template:"{{value}}"},s3TotalRequests:{formatter:r.b.abbreviatedNumber,template:"{{value}}"},s3NumberOfObjects:{formatter:r.b.abbreviatedNumber,template:"{{value}}"},s3UploadBytes:{formatter:r.b.bytes,template:"{{value}}"},s3DownloadBytes:{formatter:r.b.bytes,template:"{{value}}"},sqsOldestMessage:{formatter:r.b.number,template:"{{value}} seconds"},rdsLatency:{formatter:r.b.number,template:"{{value}} ms"}},l=e=>t=>{if(n.d.is(e)){const s=Object(i.a)(e);return Object(a.isNumber)(t)?s(t):t}const s=Object(a.get)(c,e.type,c.count);return null!=t&&s?Object(o.b)(s.formatter,s.template)(t):""}},200:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(1),r=s(13);const n={CPUUsage:a.i18n.translate("xpack.infra.waffle.metricOptions.cpuUsageText",{defaultMessage:"CPU usage"}),MemoryUsage:a.i18n.translate("xpack.infra.waffle.metricOptions.memoryUsageText",{defaultMessage:"memory usage"}),InboundTraffic:a.i18n.translate("xpack.infra.waffle.metricOptions.inboundTrafficText",{defaultMessage:"inbound traffic"}),OutboundTraffic:a.i18n.translate("xpack.infra.waffle.metricOptions.outboundTrafficText",{defaultMessage:"outbound traffic"}),LogRate:a.i18n.translate("xpack.infra.waffle.metricOptions.hostLogRateText",{defaultMessage:"log rate"}),Load:a.i18n.translate("xpack.infra.waffle.metricOptions.loadText",{defaultMessage:"load"}),Count:a.i18n.translate("xpack.infra.waffle.metricOptions.countText",{defaultMessage:"count"}),DiskIOReadBytes:a.i18n.translate("xpack.infra.waffle.metricOptions.diskIOReadBytes",{defaultMessage:"disk reads"}),DiskIOWriteBytes:a.i18n.translate("xpack.infra.waffle.metricOptions.diskIOWriteBytes",{defaultMessage:"disk writes"}),s3BucketSize:a.i18n.translate("xpack.infra.waffle.metricOptions.s3BucketSize",{defaultMessage:"bucket size"}),s3TotalRequests:a.i18n.translate("xpack.infra.waffle.metricOptions.s3TotalRequests",{defaultMessage:"total requests"}),s3NumberOfObjects:a.i18n.translate("xpack.infra.waffle.metricOptions.s3NumberOfObjects",{defaultMessage:"number of objects"}),s3DownloadBytes:a.i18n.translate("xpack.infra.waffle.metricOptions.s3DownloadBytes",{defaultMessage:"downloads (bytes)"}),s3UploadBytes:a.i18n.translate("xpack.infra.waffle.metricOptions.s3UploadBytes",{defaultMessage:"uploads (bytes)"}),rdsConnections:a.i18n.translate("xpack.infra.waffle.metricOptions.rdsConnections",{defaultMessage:"connections"}),rdsQueriesExecuted:a.i18n.translate("xpack.infra.waffle.metricOptions.rdsQueriesExecuted",{defaultMessage:"queries executed"}),rdsActiveTransactions:a.i18n.translate("xpack.infra.waffle.metricOptions.rdsActiveTransactions",{defaultMessage:"active transactions"}),rdsLatency:a.i18n.translate("xpack.infra.waffle.metricOptions.rdsLatency",{defaultMessage:"latency"}),sqsMessagesVisible:a.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesVisible",{defaultMessage:"messages available"}),sqsMessagesDelayed:a.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesDelayed",{defaultMessage:"messages delayed"}),sqsMessagesSent:a.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesSent",{defaultMessage:"messages added"}),sqsMessagesEmpty:a.i18n.translate("xpack.infra.waffle.metricOptions.sqsMessagesEmpty",{defaultMessage:"messages returned empty"}),sqsOldestMessage:a.i18n.translate("xpack.infra.waffle.metricOptions.sqsOldestMessage",{defaultMessage:"oldest message"})},i=Object(r.mapValues)(n,(e=>`${e[0].toUpperCase()}${e.slice(1)}`)),o=e=>{switch(e){case"cpu":return{text:i.CPUUsage,textLC:n.CPUUsage,value:"cpu"};case"memory":return{text:i.MemoryUsage,textLC:n.MemoryUsage,value:"memory"};case"rx":return{text:i.InboundTraffic,textLC:n.InboundTraffic,value:"rx"};case"tx":return{text:i.OutboundTraffic,textLC:n.OutboundTraffic,value:"tx"};case"logRate":return{text:i.LogRate,textLC:n.LogRate,value:"logRate"};case"load":return{text:i.Load,textLC:n.Load,value:"load"};case"count":return{text:i.Count,textLC:n.Count,value:"count"};case"diskIOReadBytes":return{text:i.DiskIOReadBytes,textLC:n.DiskIOReadBytes,value:"diskIOReadBytes"};case"diskIOWriteBytes":return{text:i.DiskIOWriteBytes,textLC:n.DiskIOWriteBytes,value:"diskIOWriteBytes"};case"s3BucketSize":return{text:i.s3BucketSize,textLC:n.s3BucketSize,value:"s3BucketSize"};case"s3TotalRequests":return{text:i.s3TotalRequests,textLC:n.s3TotalRequests,value:"s3TotalRequests"};case"s3NumberOfObjects":return{text:i.s3NumberOfObjects,textLC:n.s3NumberOfObjects,value:"s3NumberOfObjects"};case"s3DownloadBytes":return{text:i.s3DownloadBytes,textLC:n.s3DownloadBytes,value:"s3DownloadBytes"};case"s3UploadBytes":return{text:i.s3UploadBytes,textLC:n.s3UploadBytes,value:"s3UploadBytes"};case"rdsConnections":return{text:i.rdsConnections,textLC:n.rdsConnections,value:"rdsConnections"};case"rdsQueriesExecuted":return{text:i.rdsQueriesExecuted,textLC:n.rdsQueriesExecuted,value:"rdsQueriesExecuted"};case"rdsActiveTransactions":return{text:i.rdsActiveTransactions,textLC:n.rdsActiveTransactions,value:"rdsActiveTransactions"};case"rdsLatency":return{text:i.rdsLatency,textLC:n.rdsLatency,value:"rdsLatency"};case"sqsMessagesVisible":return{text:i.sqsMessagesVisible,textLC:n.sqsMessagesVisible,value:"sqsMessagesVisible"};case"sqsMessagesDelayed":return{text:i.sqsMessagesDelayed,textLC:n.sqsMessagesDelayed,value:"sqsMessagesDelayed"};case"sqsMessagesSent":return{text:i.sqsMessagesSent,textLC:n.sqsMessagesSent,value:"sqsMessagesSent"};case"sqsMessagesEmpty":return{text:i.sqsMessagesEmpty,textLC:n.sqsMessagesEmpty,value:"sqsMessagesEmpty"};case"sqsOldestMessage":return{text:i.sqsOldestMessage,textLC:n.sqsOldestMessage,value:"sqsOldestMessage"}}}},231:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a=(e,t)=>`metric_${t}`},232:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var a=s(91),r=s.n(a),n=s(45),i=s(43),o=s(311);const c=e=>{if("custom"===(null==e?void 0:e.aggregation))return e=>r()(e).format("0.[0000]");if(e&&e.field){const t=Object(o.a)(e);return t===i.b.bits&&"rate"===e.aggregation?Object(n.b)(i.b.bits,"{{value}}/s"):Object(n.b)(t)}return Object(n.b)(i.b.number)}},311:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(13),r=s(43);const n=e=>{if(e&&e.field){const t=Object(a.last)(e.field.split(/\./));if("pct"===t)return r.b.percent;if("bytes"===t&&"rate"===e.aggregation)return r.b.bits;if("bytes"===t)return r.b.bytes}return r.b.number}},312:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a=e=>e.label?e.label:`${e.aggregation}(${e.field||""})`}}]);