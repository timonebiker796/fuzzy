/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[0],{116:function(e,t,n){"use strict";n.d(t,"b",(function(){return h})),n.d(t,"d",(function(){return w})),n.d(t,"e",(function(){return S})),n.d(t,"a",(function(){return y})),n.d(t,"c",(function(){return v}));var r=n(117),i=n.n(r),s=n(3),a=n.n(s),o=n(30),u=n(119),c=n(1);const l=c.i18n.translate("xpack.infra.sourceConfiguration.missingHttp",{defaultMessage:"Failed to load source: No HTTP client available."});class MissingHttpClientException extends Error{constructor(){super(l),Object.setPrototypeOf(this,new.target.prototype),this.name="MissingHttpClientException"}}var d=n(31),p=n(148),f=n.n(p),g=n(15),m=n(173);const[y,v]=i()((()=>{const{services:{dataViews:e}}=Object(o.c)(),{source:t}=w(),[n,r]=f()((async()=>{const n=null==t?void 0:t.configuration.metricAlias;return n?Object(m.a)({dataViewsService:e,dataViewId:n,attributes:{name:g.b.name,timeFieldName:g.b.timeFieldName}}):Promise.resolve(void 0)}),[e,null==t?void 0:t.configuration.metricAlias]);Object(s.useEffect)((()=>{r()}),[r]);const{value:i,error:a,loading:u}=n;return{metricsView:i,loading:u,error:a,refetch:r}})),b="/api/metrics/source",[h,w]=i()((({sourceId:e})=>{var t;const{persistSourceConfiguration:n,source:r,error:i,isLoading:a,loadSource:l}=(({sourceId:e})=>{const[t,n]=Object(s.useState)(void 0),{services:{http:r,telemetry:i}}=Object(o.c)(),a=(()=>{const{notifications:e}=Object(d.useKibana)();return{updateFailure:t=>{e.toasts.danger({toastLifeTimeMs:3e3,title:c.i18n.translate("xpack.infra.sourceConfiguration.updateFailureTitle",{defaultMessage:"Configuration update failed"}),body:[c.i18n.translate("xpack.infra.sourceConfiguration.updateFailureBody",{defaultMessage:"We couldn't apply the changes to the Metrics configuration. Try again later."}),t].filter(Boolean).join(" ")})},updateSuccess:()=>{e.toasts.success({toastLifeTimeMs:3e3,title:c.i18n.translate("xpack.infra.sourceConfiguration.updateSuccessTitle",{defaultMessage:"Metrics settings successfully updated"})})}}})(),[l,p]=Object(u.b)({cancelPreviousOn:"resolution",createPromise:async()=>{if(!r)throw new MissingHttpClientException;const t=performance.now(),n=await r.fetch(`${b}/${e}`,{method:"GET"});return null==i||i.reportPerformanceMetricEvent("infra_source_load",performance.now()-t,{},{}),n},onResolve:e=>{e&&n(e.source)}},[r,e]),[f,g]=Object(u.b)({createPromise:async t=>{if(!r)throw new MissingHttpClientException;return await r.patch(`${b}/${e}`,{method:"PATCH",body:JSON.stringify(t)})},onResolve:e=>{e&&(a.updateSuccess(),n(e.source))},onReject:e=>{var t;a.updateFailure(null===(t=e.body)||void 0===t?void 0:t.message)}},[r,e]);Object(s.useEffect)((()=>{p()}),[p,e]);const m="rejected"===l.state?`${l.value}`:void 0,y="uninitialized"===l.state||"pending"===l.state||"pending"===f.state;return{error:m,loadSource:p,isLoading:y,source:t,persistSourceConfiguration:g}})({sourceId:e}),p=r?!!r.version:void 0;return{isLoading:a,error:i,loadSource:l,metricIndicesExist:Boolean(null==r||null===(t=r.status)||void 0===t?void 0:t.metricIndicesExist),source:r,sourceExists:p,sourceId:e,persistSourceConfiguration:n}})),S=e=>(t="default")=>function(n){return a.a.createElement(h,{sourceId:t},a.a.createElement(y,null,a.a.createElement(e,n)))}},117:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i={};t.default=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];var a=[],o=[],u=function(e){var t=r.createContext(i);a.push(t),o.push(function(e){return function(){var t=r.useContext(e);return t}}(t))};n.length?n.forEach((function(e){return u(e.name)})):u(e.name);var c=function(t){for(var i=t.children,s=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(t,["children"]),o=e(s),u=i,c=0;c<a.length;c+=1){var l=a[c],d=n[c]||function(e){return e};u=r.createElement(l.Provider,{value:d(o)},u)}return u};return[c].concat(o)}},119:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return CanceledPromiseError}));var r=n(6),i=n.n(r),s=n(3),a=n(127),o=n.n(a);const u=({createPromise:e,onResolve:t=c,onReject:n=c,cancelPreviousOn:r="never",triggerOrThrow:i="whenMounted"},a)=>{const u=o()(),l=Object(s.useCallback)((()=>{switch(i){case"always":return!0;case"whenMounted":return u()}}),[u,i]),d=Object(s.useRef)([]),[p,f]=Object(s.useState)({state:"uninitialized"}),g=Object(s.useCallback)((()=>{f({state:"uninitialized"})}),[]),m=Object(s.useMemo)((()=>(...i)=>{let s;const a=new Promise(((e,t)=>{s=t})),o=d.current,u=()=>{o.forEach((e=>e.cancel()))},p=e(...i),g=Promise.race([p,a]);f({state:"pending",promise:g}),"creation"===r&&u();const m={cancel:()=>{s(new CanceledPromiseError)},cancelSilently:()=>{s(new SilentCanceledPromiseError)},promise:g.then((e=>(["settlement","resolution"].includes(r)&&u(),d.current=d.current.filter((e=>e.promise!==m.promise)),t&&l()&&t(e),f((t=>"pending"===t.state&&t.promise===g?{state:"resolved",promise:m.promise,value:e}:t)),e)),(e=>{if(!(e instanceof SilentCanceledPromiseError)){if(["settlement","rejection"].includes(r)&&u(),d.current=d.current.filter((e=>e.promise!==m.promise)),l()){if(!n)throw e;n(e)}f((t=>"pending"===t.state&&t.promise===g?{state:"rejected",promise:g,value:e}:t))}}))};return d.current=[...d.current,m],m.promise.catch(c),m.promise}),a);return Object(s.useEffect)((()=>()=>{d.current.forEach((e=>e.cancelSilently()))}),[]),[p,m,g]};class CanceledPromiseError extends Error{constructor(e){super(e),i()(this,"isCanceled",!0),Object.setPrototypeOf(this,new.target.prototype)}}class SilentCanceledPromiseError extends CanceledPromiseError{}const c=()=>{}},121:function(e,t,n){"use strict";n.d(t,"k",(function(){return r.b})),n.d(t,"n",(function(){return i.d})),n.d(t,"m",(function(){return s.b})),n.d(t,"l",(function(){return s.a})),n.d(t,"a",(function(){return y.a})),n.d(t,"s",(function(){return y.u})),n.d(t,"q",(function(){return y.s})),n.d(t,"r",(function(){return y.t})),n.d(t,"e",(function(){return y.f})),n.d(t,"x",(function(){return y.B})),n.d(t,"y",(function(){return y.C})),n.d(t,"f",(function(){return y.g})),n.d(t,"z",(function(){return y.D})),n.d(t,"A",(function(){return y.E})),n.d(t,"b",(function(){return y.c})),n.d(t,"o",(function(){return y.q})),n.d(t,"p",(function(){return y.r})),n.d(t,"g",(function(){return y.h})),n.d(t,"B",(function(){return y.F})),n.d(t,"C",(function(){return y.G})),n.d(t,"h",(function(){return y.i})),n.d(t,"D",(function(){return y.H})),n.d(t,"E",(function(){return y.I})),n.d(t,"d",(function(){return y.e})),n.d(t,"w",(function(){return y.A})),n.d(t,"v",(function(){return y.z})),n.d(t,"c",(function(){return y.d})),n.d(t,"t",(function(){return y.x})),n.d(t,"u",(function(){return y.y})),n.d(t,"i",(function(){return y.j})),n.d(t,"F",(function(){return y.M})),n.d(t,"G",(function(){return y.N})),n.d(t,"j",(function(){return y.k})),n.d(t,"I",(function(){return y.P})),n.d(t,"H",(function(){return y.O})),n.d(t,"J",(function(){return y.Q})),n(134);var r=n(20),i=(n(44),n(26)),s=n(139),a=n(259),o=n(114),u=n(62),c=n(0);const l=c.keyof({cpu:null,normalizedLoad1m:null,diskSpaceUsage:null,memory:null,memoryFree:null,rx:null,tx:null}),d=c.type({from:a.a,to:a.a}),p=c.keyof({"cloud.provider":null,"host.ip":null,"host.os.name":null}),f=c.type({name:l,value:c.union([c.number,c.null])}),g=c.type({name:p,value:c.union([c.number,c.string,c.null])}),m=(c.intersection([c.partial({query:c.UnknownRecord}),c.type({type:c.literal("host"),limit:c.union([Object(o.b)(1,500),Object(u.a)(20)]),metrics:c.array(c.type({type:l})),sourceId:c.string,range:d})]),c.intersection([c.type({name:c.string,metrics:c.array(f),metadata:c.array(g)}),c.partial({alertsCount:c.number})]));c.type({type:c.literal("host"),nodes:c.array(m)});var y=n(7);n(47),n(50),n(46),n(49),n(48)},127:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.default=function(){var e=r.useRef(!1),t=r.useCallback((function(){return e.current}),[]);return r.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},134:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),i=n(18);r.type({nodeId:r.string,nodeType:i.ItemTypeRT,sourceId:r.string,timeRange:r.type({from:r.number,to:r.number})});const s=r.type({name:r.string,source:r.string}),a=r.partial({codename:r.string,family:r.string,kernel:r.string,name:r.string,platform:r.string,version:r.string,build:r.string}),o=r.partial({name:r.string,hostname:r.string,id:r.string,ip:r.union([r.array(r.string),r.string]),mac:r.union([r.array(r.string),r.string]),os:a,architecture:r.string,containerized:r.boolean}),u=r.partial({name:r.string,id:r.string,runtime:r.string,image:r.partial({name:r.string})}),c=r.partial({id:r.string,name:r.string}),l=r.partial({id:r.string,name:r.string}),d=r.partial({id:r.string}),p=r.partial({interface:r.string,type:r.string}),f=r.partial({instance:c,provider:r.string,account:l,availability_zone:r.string,project:d,machine:p,region:r.string,imageId:r.string}),g=r.partial({id:r.string,version:r.string,policy:r.string}),m=(r.partial({cloud:f,host:o,container:u,agent:g,"@timestamp":r.string}),r.partial({cloud:f,host:o,container:u,agent:g,timestamp:r.string})),y=r.type({id:r.string,name:r.string,features:r.array(s)}),v=r.partial({info:m}),b=r.intersection([y,v])},139:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return j}));var r=n(0),i=n(44);const s=r.type({value:r.number}),a=(r.type({hostTerm:r.record(r.string,r.string),indexPattern:r.string,to:r.number,sortBy:r.type({name:r.string,isAscending:r.boolean}),searchFilter:r.array(r.record(r.string,r.record(r.string,r.unknown)))}),r.type({summaryEvent:r.type({summary:r.type({hits:r.type({hits:r.array(r.type({_source:r.type({system:r.type({process:r.type({summary:r.record(r.string,r.number)})})})}))})})}),processes:r.type({filteredProcs:r.type({buckets:r.array(r.type({key:r.string,cpu:s,memory:s,startTime:r.type({value_as_string:r.string}),meta:r.type({hits:r.type({hits:r.array(r.type({_source:r.type({process:r.type({pid:r.number}),system:r.type({process:r.type({state:r.string})}),user:r.type({name:r.string})})}))})})}))})})}),r.union([r.number,r.string])),o=r.type({processList:r.array(r.type({cpu:r.union([r.null,r.number]),memory:r.union([r.null,r.number]),startTime:r.number,pid:r.number,state:r.string,user:r.string,command:r.string})),summary:r.exact(r.partial({total:a,running:a,sleeping:a,dead:a,stopped:a,idle:a,zombie:a,unknown:a}))}),u=(r.type({hostTerm:r.record(r.string,r.string),indexPattern:r.string,to:r.number,command:r.string}),r.type({process:r.type({filteredProc:r.type({buckets:r.array(r.type({timeseries:r.type({buckets:r.array(r.type({key:r.number,memory:s,cpu:s}))})}))})})}),r.type({cpu:i.a,memory:i.a}));var c=n(114),l=n(62),d=n(259),p=n(82),f=n.n(p),g=n(16),m=n(32);const y=new r.Type("datemath",r.string.is,((e,t)=>Object(m.pipe)(r.string.validate(e,t),Object(g.chain)((e=>(e=>{const t=f.a.parse(e);return!(!t||!t.isValid())})(e)?r.success(e):r.failure(e,t))))),String),v=r.union([Object(c.a)(1,100),Object(l.a)(10)]),b=r.union([d.a,y]),h=r.strict({"host.name":r.string}),w=(r.intersection([r.strict({from:b,to:b,filters:r.string}),r.partial({size:v,validatedFilters:h})]),r.union([r.string,r.null])),S=(r.type({services:r.type({buckets:r.array(r.type({key:r.string,latestAgent:r.type({top:r.array(r.type({sort:r.array(r.string),metrics:r.type({"agent.name":w})}))})}))})}),r.type({serviceName:r.string,agentName:w})),j=r.type({services:r.array(S)})},148:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80),i=n(3),s=r.__importDefault(n(127));t.default=function(e,t,n){void 0===t&&(t=[]),void 0===n&&(n={loading:!1});var a=i.useRef(0),o=s.default(),u=i.useState(n),c=u[0],l=u[1],d=i.useCallback((function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=++a.current;return l((function(e){return r.__assign(r.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&i===a.current&&l({value:e,loading:!1}),e}),(function(e){return o()&&i===a.current&&l({error:e,loading:!1}),e}))}),t);return[c,d]}},152:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(e,t){return"boolean"==typeof t?t:!e};t.default=function(e){return r.useReducer(i,e)}},173:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));var r=n(15);const i=({dataViewId:e,dataViewsService:t})=>{try{return s({dataViewsService:t,dataViewId:e})}catch{return a({dataViewsService:t,dataViewId:e,attributes:{timeFieldName:r.m}})}},s=async({dataViewsService:e,dataViewId:t})=>{var n,i;const s=await e.get(t,!1);return{indices:s.getIndexPattern(),timeFieldName:null!==(n=s.timeFieldName)&&void 0!==n?n:r.m,fields:null!==(i=s.fields)&&void 0!==i?i:[],dataViewReference:s}},a=async({dataViewsService:e,dataViewId:t,attributes:n})=>{const{name:r,timeFieldName:i}=n,s=await e.create({id:t,name:r,title:t,timeFieldName:i},!1,!1);return{indices:t,timeFieldName:i,fields:s.fields,dataViewReference:s}}},174:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(1),i=n(42),s=n(3),a=n.n(s),o=n(35),u=n(40),c=n(116),l=n(313);const d=({onSubmit:e,onChange:t,value:n,placeholder:d,curryLoadSuggestions:f=p,compressed:g})=>{const{metricsView:m}=Object(c.c)(),[y,v]=Object(s.useState)(n||""),[b,h]=Object(s.useState)(!0);Object(s.useEffect)((()=>{n&&v(n)}),[n]);const{euiTheme:w}=Object(u.useEuiTheme)(),S=e=>{h(function(e){try{Object(i.fromKueryExpression)(e)}catch(e){return!1}return!0}(e)),v(e),t&&t(e)},j=r.i18n.translate("xpack.infra.homePage.toolbar.kqlSearchFieldPlaceholder",{defaultMessage:"Search for infrastructure data… (e.g. host.name:host-1)"});return a.a.createElement(l.a,{dataView:null==m?void 0:m.dataViewReference},(({isLoadingSuggestions:t,loadSuggestions:n,suggestions:r})=>a.a.createElement(o.AutocompleteField,{compressed:g,"aria-label":d,isLoadingSuggestions:t,isValid:b,loadSuggestions:f(n),onChange:S,onSubmit:e,placeholder:d||j,suggestions:r,value:y,theme:w})))},p=e=>(...t)=>e(...t)},175:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(42);const i=(e,t,n=!0)=>{try{return e?JSON.stringify(Object(r.toElasticsearchQuery)(Object(r.fromKueryExpression)(e),t)):""}catch(e){if(n)return"";throw e}}},259:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(76),s=n.n(i);const a=r.brand(r.string,(e=>s()(e,!0).isValid()),"Date")},313:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(6),i=n.n(r),s=n(3),a=n.n(s),o=n(31);class WithKueryAutocompletionComponent extends a.a.Component{constructor(...e){super(...e),i()(this,"state",{currentRequest:null,suggestions:[]}),i()(this,"loadSuggestions",(async(e,t,n,r)=>{var i;const{dataView:s}=this.props,a="kuery";if(!this.props.kibana.services.unifiedSearch.autocomplete.hasQuerySuggestions(a))return;this.setState({currentRequest:{expression:e,cursorPosition:t},suggestions:[]});const o=s&&null!==(i=await this.props.kibana.services.unifiedSearch.autocomplete.getQuerySuggestions({language:a,query:e,selectionStart:t,selectionEnd:t,indexPatterns:[s],boolFilter:[]}))&&void 0!==i?i:[],u=r?r(o):o;this.setState((r=>r.currentRequest&&r.currentRequest.expression!==e&&r.currentRequest.cursorPosition!==t?r:{...r,currentRequest:null,suggestions:n?u.slice(0,n):u}))}))}render(){const{currentRequest:e,suggestions:t}=this.state;return this.props.children({isLoadingSuggestions:null!==e,loadSuggestions:this.loadSuggestions,suggestions:t})}}const u=Object(o.withKibana)(WithKueryAutocompletionComponent)}}]);