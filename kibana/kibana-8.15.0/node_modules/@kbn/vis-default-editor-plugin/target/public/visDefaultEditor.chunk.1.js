(window.visDefaultEditor_bundle_jsonpfunction=window.visDefaultEditor_bundle_jsonpfunction||[]).push([[1],{36:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(22).__importDefault(i(39));t.default=function(e){a.default((function(){e()}))}},37:function(e,t,i){"use strict";var a,r=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),n=[];function s(e){for(var t=-1,i=0;i<n.length;i++)if(n[i].identifier===e){t=i;break}return t}function o(e,t){for(var i={},a=[],r=0;r<e.length;r++){var o=e[r],l=t.base?o[0]+t.base:o[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var u=s(d),g={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(n[u].references++,n[u].updater(g)):n.push({identifier:d,updater:f(g,t),references:1}),a.push(d)}return a}function l(e){var t=document.createElement("style"),a=e.attributes||{};if(void 0===a.nonce){var n=i.nc;n&&(a.nonce=n)}if(Object.keys(a).forEach((function(e){t.setAttribute(e,a[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,i,a){var r=i?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(e.styleSheet)e.styleSheet.cssText=d(t,r);else{var n=document.createTextNode(r),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(n,s[t]):e.appendChild(n)}}function g(e,t,i){var a=i.css,r=i.media,n=i.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=a;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(a))}}var p=null,m=0;function f(e,t){var i,a,r;if(t.singleton){var n=m++;i=p||(p=l(t)),a=u.bind(null,i,n,!1),r=u.bind(null,i,n,!0)}else i=l(t),a=g.bind(null,i,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a));var i=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var a=0;a<i.length;a++){var r=s(i[a]);n[r].references--}for(var l=o(e,t),c=0;c<i.length;c++){var d=s(i[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}i=l}}}},38:function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,a,r,n=e[1]||"",s=e[3];if(!s)return n;if(t&&"function"==typeof btoa){var o=(i=s,a=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(r," */")),l=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,a){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(a)for(var n=0;n<this.length;n++){var s=this[n][0];null!=s&&(r[s]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);a&&r[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},39:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(2);t.default=function(e){a.useEffect(e,[])}},40:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(41);case"v8light":return i(43)}},41:function(e,t,i){var a=i(37),r=i(42);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);a(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},42:function(e,t,i){(t=i(38)(!1)).push([e.i,".visEditor--default{display:flex;flex:1 1 auto}.visEditor__collapsibleSidebar{flex-grow:1}.visEditor__collapsibleSidebar-isClosed{min-width:0;width:32px!important}.visEditor__collapsibleSidebar-isClosed .visEditorSidebar{display:none;padding-left:0}.visEditor__collapsibleSidebarButton{position:absolute;right:4px;top:8px}.visEditor__resizer{height:auto}.visEditor__resizer-isHidden{display:none}.visEditor__visualization__wrapper-expanded{width:100%!important}.visEditor__visualization{display:flex;flex:1 1 auto;overflow:hidden}.visEditor__canvas{background-color:#1d1e24;display:flex;flex-direction:row;overflow:auto}.visEditor__canvas,.visEditor__canvas.embedded{flex-basis:100%;flex-shrink:1}.visEditor__canvas .visChart{position:relative}@media only screen and (max-width:574px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}@media only screen and (min-width:575px)and (max-width:767px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}@media only screen and (min-width:768px)and (max-width:991px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}.visEditorSidebar{height:100%;padding-left:8px}@media only screen and (max-width:574px){.visEditorSidebar{padding-left:0}}@media only screen and (min-width:575px)and (max-width:767px){.visEditorSidebar{padding-left:0}}@media only screen and (min-width:768px)and (max-width:991px){.visEditorSidebar{padding-left:0}}.visEditorSidebar__form{display:flex;flex:1 1 auto;flex-direction:column;max-width:100%}.visEditorSidebar__form>*{flex-shrink:0}.visEditorSidebar__config{padding:8px}.visEditorSidebar__config>*{flex-grow:0}@media only screen and (min-width:992px)and (max-width:1199px){.visEditorSidebar__config{display:flex;flex:1 1 1px;flex-direction:column;overflow:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.visEditorSidebar__config>*{flex-shrink:0}.visEditorSidebar__config::-webkit-scrollbar{height:16px;width:16px}.visEditorSidebar__config::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.visEditorSidebar__config::-webkit-scrollbar-corner,.visEditorSidebar__config::-webkit-scrollbar-track{background-color:#0000}}@media only screen and (min-width:1200px){.visEditorSidebar__config{display:flex;flex:1 1 1px;flex-direction:column;overflow:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.visEditorSidebar__config>*{flex-shrink:0}.visEditorSidebar__config::-webkit-scrollbar{height:16px;width:16px}.visEditorSidebar__config::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.visEditorSidebar__config::-webkit-scrollbar-corner,.visEditorSidebar__config::-webkit-scrollbar-track{background-color:#0000}}.visEditorSidebar__config-isHidden{display:none}.visEditorSidebar__titleContainer{padding:8px 32px 8px 8px}.visEditorSidebar__indexPatternPlaceholder{border-bottom:1px solid #343741;min-height:40px}.visEditorSidebar__linkedSearch,.visEditorSidebar__nav{flex-grow:0}.visEditorSidebar__section{background-color:#1d1e24;border-radius:6px;padding:8px}.visEditorSidebar__section+.visEditorSidebar__section{margin-top:8px}.visEditorSidebar__collapsible{background-color:#25262e}.visEditorSidebar__collapsible--marginBottom{margin-bottom:12px}.visEditorSidebar__formRow{align-items:center;display:flex;margin-top:12px}.visEditorSidebar__formLabel{align-items:center;display:flex;flex:1 1 40%;padding-right:4px}.visEditorSidebar__formControl{align-items:center;display:flex;flex:1 1 60%}.visEditorSidebar__aggGroupAccordionButtonContent{font-size:14px}.visEditorSidebar__aggGroupAccordionButtonContent span{color:#98a2b3}.visEditorSidebar__controls{align-items:center;border-top:1px solid #343741;display:flex;justify-content:flex-end;padding:8px}.visEditorSidebar__controls .visEditorSidebar__autoApplyButton{margin-left:12px}.visEditorAgg__subAgg{background-color:#0000;border:2px solid #343741;border-radius:6px;padding:8px}.visEditorAgg__subAgg+.visEditorAggParam__string{margin-top:16px}.visEditorAggParam--half{display:inline-block;margin:16px 0;width:calc(50% - 4px)}.visEditorAggParam--half-size{margin-left:8px}",""]),e.exports=t},43:function(e,t,i){var a=i(37),r=i(44);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);a(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},44:function(e,t,i){(t=i(38)(!1)).push([e.i,".visEditor--default{display:flex;flex:1 1 auto}.visEditor__collapsibleSidebar{flex-grow:1}.visEditor__collapsibleSidebar-isClosed{min-width:0;width:32px!important}.visEditor__collapsibleSidebar-isClosed .visEditorSidebar{display:none;padding-left:0}.visEditor__collapsibleSidebarButton{position:absolute;right:4px;top:8px}.visEditor__resizer{height:auto}.visEditor__resizer-isHidden{display:none}.visEditor__visualization__wrapper-expanded{width:100%!important}.visEditor__visualization{display:flex;flex:1 1 auto;overflow:hidden}.visEditor__canvas{background-color:#fff;display:flex;flex-direction:row;overflow:auto}.visEditor__canvas,.visEditor__canvas.embedded{flex-basis:100%;flex-shrink:1}.visEditor__canvas .visChart{position:relative}@media only screen and (max-width:574px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}@media only screen and (min-width:575px)and (max-width:767px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}@media only screen and (min-width:768px)and (max-width:991px){.visEditor--default{flex-direction:column}.visEditor__collapsibleSidebar{flex-grow:0;width:100%!important}.visEditor__collapsibleSidebar-isClosed{height:40px!important}.visEditor__resizer{display:none}.visEditor__visualization__wrapper{display:flex;flex:1;flex-direction:column;width:100%!important}}.visEditorSidebar{height:100%;padding-left:8px}@media only screen and (max-width:574px){.visEditorSidebar{padding-left:0}}@media only screen and (min-width:575px)and (max-width:767px){.visEditorSidebar{padding-left:0}}@media only screen and (min-width:768px)and (max-width:991px){.visEditorSidebar{padding-left:0}}.visEditorSidebar__form{display:flex;flex:1 1 auto;flex-direction:column;max-width:100%}.visEditorSidebar__form>*{flex-shrink:0}.visEditorSidebar__config{padding:8px}.visEditorSidebar__config>*{flex-grow:0}@media only screen and (min-width:992px)and (max-width:1199px){.visEditorSidebar__config{display:flex;flex:1 1 1px;flex-direction:column;overflow:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.visEditorSidebar__config>*{flex-shrink:0}.visEditorSidebar__config::-webkit-scrollbar{height:16px;width:16px}.visEditorSidebar__config::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.visEditorSidebar__config::-webkit-scrollbar-corner,.visEditorSidebar__config::-webkit-scrollbar-track{background-color:#0000}}@media only screen and (min-width:1200px){.visEditorSidebar__config{display:flex;flex:1 1 1px;flex-direction:column;overflow:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.visEditorSidebar__config>*{flex-shrink:0}.visEditorSidebar__config::-webkit-scrollbar{height:16px;width:16px}.visEditorSidebar__config::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.visEditorSidebar__config::-webkit-scrollbar-corner,.visEditorSidebar__config::-webkit-scrollbar-track{background-color:#0000}}.visEditorSidebar__config-isHidden{display:none}.visEditorSidebar__titleContainer{padding:8px 32px 8px 8px}.visEditorSidebar__indexPatternPlaceholder{border-bottom:1px solid #d3dae6;min-height:40px}.visEditorSidebar__linkedSearch,.visEditorSidebar__nav{flex-grow:0}.visEditorSidebar__section{background-color:#fff;border-radius:6px;padding:8px}.visEditorSidebar__section+.visEditorSidebar__section{margin-top:8px}.visEditorSidebar__collapsible{background-color:#fafbfd}.visEditorSidebar__collapsible--marginBottom{margin-bottom:12px}.visEditorSidebar__formRow{align-items:center;display:flex;margin-top:12px}.visEditorSidebar__formLabel{align-items:center;display:flex;flex:1 1 40%;padding-right:4px}.visEditorSidebar__formControl{align-items:center;display:flex;flex:1 1 60%}.visEditorSidebar__aggGroupAccordionButtonContent{font-size:14px}.visEditorSidebar__aggGroupAccordionButtonContent span{color:#69707d}.visEditorSidebar__controls{align-items:center;border-top:1px solid #d3dae6;display:flex;justify-content:flex-end;padding:8px}.visEditorSidebar__controls .visEditorSidebar__autoApplyButton{margin-left:12px}.visEditorAgg__subAgg{background-color:#0000;border:2px solid #d3dae6;border-radius:6px;padding:8px}.visEditorAgg__subAgg+.visEditorAggParam__string{margin-top:16px}.visEditorAggParam--half{display:inline-block;margin:16px 0;width:calc(50% - 4px)}.visEditorAggParam--half-size{margin-left:8px}",""]),e.exports=t},45:function(e,t,i){ace.define("ace/mode/json_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(function(e,t,i){"use strict";var a=e("../lib/oop"),r=e("./text_highlight_rules").TextHighlightRules,n=function(){this.$rules={start:[{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"string",regex:'"',next:"string"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"text",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"comment",regex:"\\/\\/.*$"},{token:"comment.start",regex:"\\/\\*",next:"comment"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],string:[{token:"constant.language.escape",regex:/\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|["\\\/bfnrt])/},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],comment:[{token:"comment.end",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}};a.inherits(n,r),t.JsonHighlightRules=n})),ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],(function(e,t,i){"use strict";var a=e("../range").Range,r=function(){};(function(){this.checkOutdent=function(e,t){return!!/^\s+$/.test(e)&&/^\s*\}/.test(t)},this.autoOutdent=function(e,t){var i=e.getLine(t).match(/^(\s*\})/);if(!i)return 0;var r=i[1].length,n=e.findMatchingBracket({row:t,column:r});if(!n||n.row==t)return 0;var s=this.$getIndent(e.getLine(n.row));e.replace(new a(t,0,t,r-1),s)},this.$getIndent=function(e){return e.match(/^\s*/)[0]}}).call(r.prototype),t.MatchingBraceOutdent=r})),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],(function(e,t,i){"use strict";var a=e("../../lib/oop"),r=e("../../range").Range,n=e("./fold_mode").FoldMode,s=t.FoldMode=function(e){e&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+e.end)))};a.inherits(s,n),function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,i){var a=e.getLine(i);if(this.singleLineBlockCommentRe.test(a)&&!this.startRegionRe.test(a)&&!this.tripleStarBlockCommentRe.test(a))return"";var r=this._getFoldWidgetBase(e,t,i);return!r&&this.startRegionRe.test(a)?"start":r},this.getFoldWidgetRange=function(e,t,i,a){var r,n=e.getLine(i);if(this.startRegionRe.test(n))return this.getCommentRegionBlock(e,n,i);if(r=n.match(this.foldingStartMarker)){var s=r.index;if(r[1])return this.openingBracketBlock(e,r[1],i,s);var o=e.getCommentFoldRange(i,s+r[0].length,1);return o&&!o.isMultiLine()&&(a?o=this.getSectionRange(e,i):"all"!=t&&(o=null)),o}return"markbegin"!==t&&(r=n.match(this.foldingStopMarker))?(s=r.index+r[0].length,r[1]?this.closingBracketBlock(e,r[1],i,s):e.getCommentFoldRange(i,s,-1)):void 0},this.getSectionRange=function(e,t){for(var i=e.getLine(t),a=i.search(/\S/),n=t,s=i.length,o=t+=1,l=e.getLength();++t<l;){var c=(i=e.getLine(t)).search(/\S/);if(-1!==c){if(a>c)break;var d=this.getFoldWidgetRange(e,"all",t);if(d){if(d.start.row<=n)break;if(d.isMultiLine())t=d.end.row;else if(a==c)break}o=t}}return new r(n,s,o,e.getLine(o).length)},this.getCommentRegionBlock=function(e,t,i){for(var a=t.search(/\s*$/),n=e.getLength(),s=i,o=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,l=1;++i<n;){t=e.getLine(i);var c=o.exec(t);if(c&&(c[1]?l--:l++,!l))break}if(i>s)return new r(s,a,i,t.length)}}.call(s.prototype)})),ace.define("ace/mode/json",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/json_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle","ace/worker/worker_client"],(function(e,t,a){"use strict";var r=e("../lib/oop"),n=e("./text").Mode,s=e("./json_highlight_rules").JsonHighlightRules,o=e("./matching_brace_outdent").MatchingBraceOutdent,l=e("./behaviour/cstyle").CstyleBehaviour,c=e("./folding/cstyle").FoldMode,d=e("../worker/worker_client").WorkerClient,u=function(){this.HighlightRules=s,this.$outdent=new o,this.$behaviour=new l,this.foldingRules=new c};r.inherits(u,n),function(){this.getNextLineIndent=function(e,t,i){var a=this.$getIndent(t);return"start"==e&&t.match(/^.*[\{\(\[]\s*$/)&&(a+=i),a},this.checkOutdent=function(e,t,i){return this.$outdent.checkOutdent(t,i)},this.autoOutdent=function(e,t,i){this.$outdent.autoOutdent(t,i)},this.createWorker=function(e){var t=new d(["ace"],i(46),"JsonWorker");return t.attachToDocument(e.getDocument()),t.on("annotate",(function(t){e.setAnnotations(t.data)})),t.on("terminate",(function(){e.clearAnnotations()})),t},this.$id="ace/mode/json"}.call(u.prototype),t.Mode=u}))},46:function(e,t){e.exports.id="ace/mode/json_worker",e.exports.src='"no use strict";!function(window){function resolveModuleId(id,paths){for(var testPath=id,tail="";testPath;){var alias=paths[testPath];if("string"==typeof alias)return alias+tail;if(alias)return alias.location.replace(/\\/*$/,"/")+(tail||alias.main||alias.name);if(alias===!1)return"";var i=testPath.lastIndexOf("/");if(-1===i)break;tail=testPath.substr(i)+tail,testPath=testPath.slice(0,i)}return id}if(!(void 0!==window.window&&window.document||window.acequire&&window.define)){window.console||(window.console=function(){var msgs=Array.prototype.slice.call(arguments,0);postMessage({type:"log",data:msgs})},window.console.error=window.console.warn=window.console.log=window.console.trace=window.console),window.window=window,window.ace=window,window.onerror=function(message,file,line,col,err){postMessage({type:"error",data:{message:message,data:err.data,file:file,line:line,col:col,stack:err.stack}})},window.normalizeModule=function(parentId,moduleName){if(-1!==moduleName.indexOf("!")){var chunks=moduleName.split("!");return window.normalizeModule(parentId,chunks[0])+"!"+window.normalizeModule(parentId,chunks[1])}if("."==moduleName.charAt(0)){var base=parentId.split("/").slice(0,-1).join("/");for(moduleName=(base?base+"/":"")+moduleName;-1!==moduleName.indexOf(".")&&previous!=moduleName;){var previous=moduleName;moduleName=moduleName.replace(/^\\.\\//,"").replace(/\\/\\.\\//,"/").replace(/[^\\/]+\\/\\.\\.\\//,"")}}return moduleName},window.acequire=function acequire(parentId,id){if(id||(id=parentId,parentId=null),!id.charAt)throw Error("worker.js acequire() accepts only (parentId, id) as arguments");id=window.normalizeModule(parentId,id);var module=window.acequire.modules[id];if(module)return module.initialized||(module.initialized=!0,module.exports=module.factory().exports),module.exports;if(!window.acequire.tlns)return console.log("unable to load "+id);var path=resolveModuleId(id,window.acequire.tlns);return".js"!=path.slice(-3)&&(path+=".js"),window.acequire.id=id,window.acequire.modules[id]={},importScripts(path),window.acequire(parentId,id)},window.acequire.modules={},window.acequire.tlns={},window.define=function(id,deps,factory){if(2==arguments.length?(factory=deps,"string"!=typeof id&&(deps=id,id=window.acequire.id)):1==arguments.length&&(factory=id,deps=[],id=window.acequire.id),"function"!=typeof factory)return window.acequire.modules[id]={exports:factory,initialized:!0},void 0;deps.length||(deps=["require","exports","module"]);var req=function(childId){return window.acequire(id,childId)};window.acequire.modules[id]={exports:{},factory:function(){var module=this,returnExports=factory.apply(this,deps.map(function(dep){switch(dep){case"require":return req;case"exports":return module.exports;case"module":return module;default:return req(dep)}}));return returnExports&&(module.exports=returnExports),module}}},window.define.amd={},acequire.tlns={},window.initBaseUrls=function(topLevelNamespaces){for(var i in topLevelNamespaces)acequire.tlns[i]=topLevelNamespaces[i]},window.initSender=function(){var EventEmitter=window.acequire("ace/lib/event_emitter").EventEmitter,oop=window.acequire("ace/lib/oop"),Sender=function(){};return function(){oop.implement(this,EventEmitter),this.callback=function(data,callbackId){postMessage({type:"call",id:callbackId,data:data})},this.emit=function(name,data){postMessage({type:"event",name:name,data:data})}}.call(Sender.prototype),new Sender};var main=window.main=null,sender=window.sender=null;window.onmessage=function(e){var msg=e.data;if(msg.event&&sender)sender._signal(msg.event,msg.data);else if(msg.command)if(main[msg.command])main[msg.command].apply(main,msg.args);else{if(!window[msg.command])throw Error("Unknown command:"+msg.command);window[msg.command].apply(window,msg.args)}else if(msg.init){window.initBaseUrls(msg.tlns),acequire("ace/lib/es5-shim"),sender=window.sender=window.initSender();var clazz=acequire(msg.module)[msg.classname];main=window.main=new clazz(sender)}}}}(this),ace.define("ace/lib/oop",["require","exports","module"],function(acequire,exports){"use strict";exports.inherits=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})},exports.mixin=function(obj,mixin){for(var key in mixin)obj[key]=mixin[key];return obj},exports.implement=function(proto,mixin){exports.mixin(proto,mixin)}}),ace.define("ace/range",["require","exports","module"],function(acequire,exports){"use strict";var comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},Range=function(startRow,startColumn,endRow,endColumn){this.start={row:startRow,column:startColumn},this.end={row:endRow,column:endColumn}};(function(){this.isEqual=function(range){return this.start.row===range.start.row&&this.end.row===range.end.row&&this.start.column===range.start.column&&this.end.column===range.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(row,column){return 0==this.compare(row,column)},this.compareRange=function(range){var cmp,end=range.end,start=range.start;return cmp=this.compare(end.row,end.column),1==cmp?(cmp=this.compare(start.row,start.column),1==cmp?2:0==cmp?1:0):-1==cmp?-2:(cmp=this.compare(start.row,start.column),-1==cmp?-1:1==cmp?42:0)},this.comparePoint=function(p){return this.compare(p.row,p.column)},this.containsRange=function(range){return 0==this.comparePoint(range.start)&&0==this.comparePoint(range.end)},this.intersects=function(range){var cmp=this.compareRange(range);return-1==cmp||0==cmp||1==cmp},this.isEnd=function(row,column){return this.end.row==row&&this.end.column==column},this.isStart=function(row,column){return this.start.row==row&&this.start.column==column},this.setStart=function(row,column){"object"==typeof row?(this.start.column=row.column,this.start.row=row.row):(this.start.row=row,this.start.column=column)},this.setEnd=function(row,column){"object"==typeof row?(this.end.column=row.column,this.end.row=row.row):(this.end.row=row,this.end.column=column)},this.inside=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)||this.isStart(row,column)?!1:!0:!1},this.insideStart=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)?!1:!0:!1},this.insideEnd=function(row,column){return 0==this.compare(row,column)?this.isStart(row,column)?!1:!0:!1},this.compare=function(row,column){return this.isMultiLine()||row!==this.start.row?this.start.row>row?-1:row>this.end.row?1:this.start.row===row?column>=this.start.column?0:-1:this.end.row===row?this.end.column>=column?0:1:0:this.start.column>column?-1:column>this.end.column?1:0},this.compareStart=function(row,column){return this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.compareEnd=function(row,column){return this.end.row==row&&this.end.column==column?1:this.compare(row,column)},this.compareInside=function(row,column){return this.end.row==row&&this.end.column==column?1:this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.clipRows=function(firstRow,lastRow){if(this.end.row>lastRow)var end={row:lastRow+1,column:0};else if(firstRow>this.end.row)var end={row:firstRow,column:0};if(this.start.row>lastRow)var start={row:lastRow+1,column:0};else if(firstRow>this.start.row)var start={row:firstRow,column:0};return Range.fromPoints(start||this.start,end||this.end)},this.extend=function(row,column){var cmp=this.compare(row,column);if(0==cmp)return this;if(-1==cmp)var start={row:row,column:column};else var end={row:row,column:column};return Range.fromPoints(start||this.start,end||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return Range.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new Range(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new Range(this.start.row,0,this.end.row,0)},this.toScreenRange=function(session){var screenPosStart=session.documentToScreenPosition(this.start),screenPosEnd=session.documentToScreenPosition(this.end);return new Range(screenPosStart.row,screenPosStart.column,screenPosEnd.row,screenPosEnd.column)},this.moveBy=function(row,column){this.start.row+=row,this.start.column+=column,this.end.row+=row,this.end.column+=column}}).call(Range.prototype),Range.fromPoints=function(start,end){return new Range(start.row,start.column,end.row,end.column)},Range.comparePoints=comparePoints,Range.comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},exports.Range=Range}),ace.define("ace/apply_delta",["require","exports","module"],function(acequire,exports){"use strict";exports.applyDelta=function(docLines,delta){var row=delta.start.row,startColumn=delta.start.column,line=docLines[row]||"";switch(delta.action){case"insert":var lines=delta.lines;if(1===lines.length)docLines[row]=line.substring(0,startColumn)+delta.lines[0]+line.substring(startColumn);else{var args=[row,1].concat(delta.lines);docLines.splice.apply(docLines,args),docLines[row]=line.substring(0,startColumn)+docLines[row],docLines[row+delta.lines.length-1]+=line.substring(startColumn)}break;case"remove":var endColumn=delta.end.column,endRow=delta.end.row;row===endRow?docLines[row]=line.substring(0,startColumn)+line.substring(endColumn):docLines.splice(row,endRow-row+1,line.substring(0,startColumn)+docLines[endRow].substring(endColumn))}}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(acequire,exports){"use strict";var EventEmitter={},stopPropagation=function(){this.propagationStopped=!0},preventDefault=function(){this.defaultPrevented=!0};EventEmitter._emit=EventEmitter._dispatchEvent=function(eventName,e){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var listeners=this._eventRegistry[eventName]||[],defaultHandler=this._defaultHandlers[eventName];if(listeners.length||defaultHandler){"object"==typeof e&&e||(e={}),e.type||(e.type=eventName),e.stopPropagation||(e.stopPropagation=stopPropagation),e.preventDefault||(e.preventDefault=preventDefault),listeners=listeners.slice();for(var i=0;listeners.length>i&&(listeners[i](e,this),!e.propagationStopped);i++);return defaultHandler&&!e.defaultPrevented?defaultHandler(e,this):void 0}},EventEmitter._signal=function(eventName,e){var listeners=(this._eventRegistry||{})[eventName];if(listeners){listeners=listeners.slice();for(var i=0;listeners.length>i;i++)listeners[i](e,this)}},EventEmitter.once=function(eventName,callback){var _self=this;callback&&this.addEventListener(eventName,function newCallback(){_self.removeEventListener(eventName,newCallback),callback.apply(null,arguments)})},EventEmitter.setDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers||(handlers=this._defaultHandlers={_disabled_:{}}),handlers[eventName]){var old=handlers[eventName],disabled=handlers._disabled_[eventName];disabled||(handlers._disabled_[eventName]=disabled=[]),disabled.push(old);var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}handlers[eventName]=callback},EventEmitter.removeDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers){var disabled=handlers._disabled_[eventName];if(handlers[eventName]==callback)handlers[eventName],disabled&&this.setDefaultHandler(eventName,disabled.pop());else if(disabled){var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}}},EventEmitter.on=EventEmitter.addEventListener=function(eventName,callback,capturing){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];return listeners||(listeners=this._eventRegistry[eventName]=[]),-1==listeners.indexOf(callback)&&listeners[capturing?"unshift":"push"](callback),callback},EventEmitter.off=EventEmitter.removeListener=EventEmitter.removeEventListener=function(eventName,callback){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(listeners){var index=listeners.indexOf(callback);-1!==index&&listeners.splice(index,1)}},EventEmitter.removeAllListeners=function(eventName){this._eventRegistry&&(this._eventRegistry[eventName]=[])},exports.EventEmitter=EventEmitter}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),EventEmitter=acequire("./lib/event_emitter").EventEmitter,Anchor=exports.Anchor=function(doc,row,column){this.$onChange=this.onChange.bind(this),this.attach(doc),column===void 0?this.setPosition(row.row,row.column):this.setPosition(row,column)};(function(){function $pointsInOrder(point1,point2,equalPointsInOrder){var bColIsAfter=equalPointsInOrder?point1.column<=point2.column:point1.column<point2.column;return point1.row<point2.row||point1.row==point2.row&&bColIsAfter}function $getTransformedPoint(delta,point,moveIfEqual){var deltaIsInsert="insert"==delta.action,deltaRowShift=(deltaIsInsert?1:-1)*(delta.end.row-delta.start.row),deltaColShift=(deltaIsInsert?1:-1)*(delta.end.column-delta.start.column),deltaStart=delta.start,deltaEnd=deltaIsInsert?deltaStart:delta.end;return $pointsInOrder(point,deltaStart,moveIfEqual)?{row:point.row,column:point.column}:$pointsInOrder(deltaEnd,point,!moveIfEqual)?{row:point.row+deltaRowShift,column:point.column+(point.row==deltaEnd.row?deltaColShift:0)}:{row:deltaStart.row,column:deltaStart.column}}oop.implement(this,EventEmitter),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(delta){if(!(delta.start.row==delta.end.row&&delta.start.row!=this.row||delta.start.row>this.row)){var point=$getTransformedPoint(delta,{row:this.row,column:this.column},this.$insertRight);this.setPosition(point.row,point.column,!0)}},this.setPosition=function(row,column,noClip){var pos;if(pos=noClip?{row:row,column:column}:this.$clipPositionToDocument(row,column),this.row!=pos.row||this.column!=pos.column){var old={row:this.row,column:this.column};this.row=pos.row,this.column=pos.column,this._signal("change",{old:old,value:pos})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(doc){this.document=doc||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(row,column){var pos={};return row>=this.document.getLength()?(pos.row=Math.max(0,this.document.getLength()-1),pos.column=this.document.getLine(pos.row).length):0>row?(pos.row=0,pos.column=0):(pos.row=row,pos.column=Math.min(this.document.getLine(pos.row).length,Math.max(0,column))),0>column&&(pos.column=0),pos}}).call(Anchor.prototype)}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),applyDelta=acequire("./apply_delta").applyDelta,EventEmitter=acequire("./lib/event_emitter").EventEmitter,Range=acequire("./range").Range,Anchor=acequire("./anchor").Anchor,Document=function(textOrLines){this.$lines=[""],0===textOrLines.length?this.$lines=[""]:Array.isArray(textOrLines)?this.insertMergedLines({row:0,column:0},textOrLines):this.insert({row:0,column:0},textOrLines)};(function(){oop.implement(this,EventEmitter),this.setValue=function(text){var len=this.getLength()-1;this.remove(new Range(0,0,len,this.getLine(len).length)),this.insert({row:0,column:0},text)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(row,column){return new Anchor(this,row,column)},this.$split=0==="aaa".split(/a/).length?function(text){return text.replace(/\\r\\n|\\r/g,"\\n").split("\\n")}:function(text){return text.split(/\\r\\n|\\r|\\n/)},this.$detectNewLine=function(text){var match=text.match(/^.*?(\\r\\n|\\r|\\n)/m);this.$autoNewLine=match?match[1]:"\\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\\r\\n";case"unix":return"\\n";default:return this.$autoNewLine||"\\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(newLineMode){this.$newLineMode!==newLineMode&&(this.$newLineMode=newLineMode,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(text){return"\\r\\n"==text||"\\r"==text||"\\n"==text},this.getLine=function(row){return this.$lines[row]||""},this.getLines=function(firstRow,lastRow){return this.$lines.slice(firstRow,lastRow+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(range){return this.getLinesForRange(range).join(this.getNewLineCharacter())},this.getLinesForRange=function(range){var lines;if(range.start.row===range.end.row)lines=[this.getLine(range.start.row).substring(range.start.column,range.end.column)];else{lines=this.getLines(range.start.row,range.end.row),lines[0]=(lines[0]||"").substring(range.start.column);var l=lines.length-1;range.end.row-range.start.row==l&&(lines[l]=lines[l].substring(0,range.end.column))}return lines},this.insertLines=function(row,lines){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(row,lines)},this.removeLines=function(firstRow,lastRow){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(firstRow,lastRow)},this.insertNewLine=function(position){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, [\'\', \'\']) instead."),this.insertMergedLines(position,["",""])},this.insert=function(position,text){return 1>=this.getLength()&&this.$detectNewLine(text),this.insertMergedLines(position,this.$split(text))},this.insertInLine=function(position,text){var start=this.clippedPos(position.row,position.column),end=this.pos(position.row,position.column+text.length);return this.applyDelta({start:start,end:end,action:"insert",lines:[text]},!0),this.clonePos(end)},this.clippedPos=function(row,column){var length=this.getLength();void 0===row?row=length:0>row?row=0:row>=length&&(row=length-1,column=void 0);var line=this.getLine(row);return void 0==column&&(column=line.length),column=Math.min(Math.max(column,0),line.length),{row:row,column:column}},this.clonePos=function(pos){return{row:pos.row,column:pos.column}},this.pos=function(row,column){return{row:row,column:column}},this.$clipPosition=function(position){var length=this.getLength();return position.row>=length?(position.row=Math.max(0,length-1),position.column=this.getLine(length-1).length):(position.row=Math.max(0,position.row),position.column=Math.min(Math.max(position.column,0),this.getLine(position.row).length)),position},this.insertFullLines=function(row,lines){row=Math.min(Math.max(row,0),this.getLength());var column=0;this.getLength()>row?(lines=lines.concat([""]),column=0):(lines=[""].concat(lines),row--,column=this.$lines[row].length),this.insertMergedLines({row:row,column:column},lines)},this.insertMergedLines=function(position,lines){var start=this.clippedPos(position.row,position.column),end={row:start.row+lines.length-1,column:(1==lines.length?start.column:0)+lines[lines.length-1].length};return this.applyDelta({start:start,end:end,action:"insert",lines:lines}),this.clonePos(end)},this.remove=function(range){var start=this.clippedPos(range.start.row,range.start.column),end=this.clippedPos(range.end.row,range.end.column);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})}),this.clonePos(start)},this.removeInLine=function(row,startColumn,endColumn){var start=this.clippedPos(row,startColumn),end=this.clippedPos(row,endColumn);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})},!0),this.clonePos(start)},this.removeFullLines=function(firstRow,lastRow){firstRow=Math.min(Math.max(0,firstRow),this.getLength()-1),lastRow=Math.min(Math.max(0,lastRow),this.getLength()-1);var deleteFirstNewLine=lastRow==this.getLength()-1&&firstRow>0,deleteLastNewLine=this.getLength()-1>lastRow,startRow=deleteFirstNewLine?firstRow-1:firstRow,startCol=deleteFirstNewLine?this.getLine(startRow).length:0,endRow=deleteLastNewLine?lastRow+1:lastRow,endCol=deleteLastNewLine?0:this.getLine(endRow).length,range=new Range(startRow,startCol,endRow,endCol),deletedLines=this.$lines.slice(firstRow,lastRow+1);return this.applyDelta({start:range.start,end:range.end,action:"remove",lines:this.getLinesForRange(range)}),deletedLines},this.removeNewLine=function(row){this.getLength()-1>row&&row>=0&&this.applyDelta({start:this.pos(row,this.getLine(row).length),end:this.pos(row+1,0),action:"remove",lines:["",""]})},this.replace=function(range,text){if(range instanceof Range||(range=Range.fromPoints(range.start,range.end)),0===text.length&&range.isEmpty())return range.start;if(text==this.getTextRange(range))return range.end;this.remove(range);var end;return end=text?this.insert(range.start,text):range.start},this.applyDeltas=function(deltas){for(var i=0;deltas.length>i;i++)this.applyDelta(deltas[i])},this.revertDeltas=function(deltas){for(var i=deltas.length-1;i>=0;i--)this.revertDelta(deltas[i])},this.applyDelta=function(delta,doNotValidate){var isInsert="insert"==delta.action;(isInsert?1>=delta.lines.length&&!delta.lines[0]:!Range.comparePoints(delta.start,delta.end))||(isInsert&&delta.lines.length>2e4&&this.$splitAndapplyLargeDelta(delta,2e4),applyDelta(this.$lines,delta,doNotValidate),this._signal("change",delta))},this.$splitAndapplyLargeDelta=function(delta,MAX){for(var lines=delta.lines,l=lines.length,row=delta.start.row,column=delta.start.column,from=0,to=0;;){from=to,to+=MAX-1;var chunk=lines.slice(from,to);if(to>l){delta.lines=chunk,delta.start.row=row+from,delta.start.column=column;break}chunk.push(""),this.applyDelta({start:this.pos(row+from,column),end:this.pos(row+to,column=0),action:delta.action,lines:chunk},!0)}},this.revertDelta=function(delta){this.applyDelta({start:this.clonePos(delta.start),end:this.clonePos(delta.end),action:"insert"==delta.action?"remove":"insert",lines:delta.lines.slice()})},this.indexToPosition=function(index,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,i=startRow||0,l=lines.length;l>i;i++)if(index-=lines[i].length+newlineLength,0>index)return{row:i,column:index+lines[i].length+newlineLength};return{row:l-1,column:lines[l-1].length}},this.positionToIndex=function(pos,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,index=0,row=Math.min(pos.row,lines.length),i=startRow||0;row>i;++i)index+=lines[i].length+newlineLength;return index+pos.column}}).call(Document.prototype),exports.Document=Document}),ace.define("ace/lib/lang",["require","exports","module"],function(acequire,exports){"use strict";exports.last=function(a){return a[a.length-1]},exports.stringReverse=function(string){return string.split("").reverse().join("")},exports.stringRepeat=function(string,count){for(var result="";count>0;)1&count&&(result+=string),(count>>=1)&&(string+=string);return result};var trimBeginRegexp=/^\\s\\s*/,trimEndRegexp=/\\s\\s*$/;exports.stringTrimLeft=function(string){return string.replace(trimBeginRegexp,"")},exports.stringTrimRight=function(string){return string.replace(trimEndRegexp,"")},exports.copyObject=function(obj){var copy={};for(var key in obj)copy[key]=obj[key];return copy},exports.copyArray=function(array){for(var copy=[],i=0,l=array.length;l>i;i++)copy[i]=array[i]&&"object"==typeof array[i]?this.copyObject(array[i]):array[i];return copy},exports.deepCopy=function deepCopy(obj){if("object"!=typeof obj||!obj)return obj;var copy;if(Array.isArray(obj)){copy=[];for(var key=0;obj.length>key;key++)copy[key]=deepCopy(obj[key]);return copy}if("[object Object]"!==Object.prototype.toString.call(obj))return obj;copy={};for(var key in obj)copy[key]=deepCopy(obj[key]);return copy},exports.arrayToMap=function(arr){for(var map={},i=0;arr.length>i;i++)map[arr[i]]=1;return map},exports.createMap=function(props){var map=Object.create(null);for(var i in props)map[i]=props[i];return map},exports.arrayRemove=function(array,value){for(var i=0;array.length>=i;i++)value===array[i]&&array.splice(i,1)},exports.escapeRegExp=function(str){return str.replace(/([.*+?^${}()|[\\]\\/\\\\])/g,"\\\\$1")},exports.escapeHTML=function(str){return str.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/\'/g,"&#39;").replace(/</g,"&#60;")},exports.getMatchOffsets=function(string,regExp){var matches=[];return string.replace(regExp,function(str){matches.push({offset:arguments[arguments.length-2],length:str.length})}),matches},exports.deferredCall=function(fcn){var timer=null,callback=function(){timer=null,fcn()},deferred=function(timeout){return deferred.cancel(),timer=setTimeout(callback,timeout||0),deferred};return deferred.schedule=deferred,deferred.call=function(){return this.cancel(),fcn(),deferred},deferred.cancel=function(){return clearTimeout(timer),timer=null,deferred},deferred.isPending=function(){return timer},deferred},exports.delayedCall=function(fcn,defaultTimeout){var timer=null,callback=function(){timer=null,fcn()},_self=function(timeout){null==timer&&(timer=setTimeout(callback,timeout||defaultTimeout))};return _self.delay=function(timeout){timer&&clearTimeout(timer),timer=setTimeout(callback,timeout||defaultTimeout)},_self.schedule=_self,_self.call=function(){this.cancel(),fcn()},_self.cancel=function(){timer&&clearTimeout(timer),timer=null},_self.isPending=function(){return timer},_self}}),ace.define("ace/worker/mirror",["require","exports","module","ace/range","ace/document","ace/lib/lang"],function(acequire,exports){"use strict";acequire("../range").Range;var Document=acequire("../document").Document,lang=acequire("../lib/lang"),Mirror=exports.Mirror=function(sender){this.sender=sender;var doc=this.doc=new Document(""),deferredUpdate=this.deferredUpdate=lang.delayedCall(this.onUpdate.bind(this)),_self=this;sender.on("change",function(e){var data=e.data;if(data[0].start)doc.applyDeltas(data);else for(var i=0;data.length>i;i+=2){if(Array.isArray(data[i+1]))var d={action:"insert",start:data[i],lines:data[i+1]};else var d={action:"remove",start:data[i],end:data[i+1]};doc.applyDelta(d,!0)}return _self.$timeout?deferredUpdate.schedule(_self.$timeout):(_self.onUpdate(),void 0)})};(function(){this.$timeout=500,this.setTimeout=function(timeout){this.$timeout=timeout},this.setValue=function(value){this.doc.setValue(value),this.deferredUpdate.schedule(this.$timeout)},this.getValue=function(callbackId){this.sender.callback(this.doc.getValue(),callbackId)},this.onUpdate=function(){},this.isPending=function(){return this.deferredUpdate.isPending()}}).call(Mirror.prototype)}),ace.define("ace/mode/json/json_parse",["require","exports","module"],function(){"use strict";var at,ch,text,value,escapee={\'"\':\'"\',"\\\\":"\\\\","/":"/",b:"\\b",f:"\\f",n:"\\n",r:"\\r",t:"\t"},error=function(m){throw{name:"SyntaxError",message:m,at:at,text:text}},next=function(c){return c&&c!==ch&&error("Expected \'"+c+"\' instead of \'"+ch+"\'"),ch=text.charAt(at),at+=1,ch},number=function(){var number,string="";for("-"===ch&&(string="-",next("-"));ch>="0"&&"9">=ch;)string+=ch,next();if("."===ch)for(string+=".";next()&&ch>="0"&&"9">=ch;)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),("-"===ch||"+"===ch)&&(string+=ch,next());ch>="0"&&"9">=ch;)string+=ch,next();return number=+string,isNaN(number)?(error("Bad number"),void 0):number},string=function(){var hex,i,uffff,string="";if(\'"\'===ch)for(;next();){if(\'"\'===ch)return next(),string;if("\\\\"===ch)if(next(),"u"===ch){for(uffff=0,i=0;4>i&&(hex=parseInt(next(),16),isFinite(hex));i+=1)uffff=16*uffff+hex;string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error("Bad string")},white=function(){for(;ch&&" ">=ch;)next()},word=function(){switch(ch){case"t":return next("t"),next("r"),next("u"),next("e"),!0;case"f":return next("f"),next("a"),next("l"),next("s"),next("e"),!1;case"n":return next("n"),next("u"),next("l"),next("l"),null}error("Unexpected \'"+ch+"\'")},array=function(){var array=[];if("["===ch){if(next("["),white(),"]"===ch)return next("]"),array;for(;ch;){if(array.push(value()),white(),"]"===ch)return next("]"),array;next(","),white()}}error("Bad array")},object=function(){var key,object={};if("{"===ch){if(next("{"),white(),"}"===ch)return next("}"),object;for(;ch;){if(key=string(),white(),next(":"),Object.hasOwnProperty.call(object,key)&&error(\'Duplicate key "\'+key+\'"\'),object[key]=value(),white(),"}"===ch)return next("}"),object;next(","),white()}}error("Bad object")};return value=function(){switch(white(),ch){case"{":return object();case"[":return array();case\'"\':return string();case"-":return number();default:return ch>="0"&&"9">=ch?number():word()}},function(source,reviver){var result;return text=source,at=0,ch=" ",result=value(),white(),ch&&error("Syntax error"),"function"==typeof reviver?function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}({"":result},""):result}}),ace.define("ace/mode/json_worker",["require","exports","module","ace/lib/oop","ace/worker/mirror","ace/mode/json/json_parse"],function(acequire,exports){"use strict";var oop=acequire("../lib/oop"),Mirror=acequire("../worker/mirror").Mirror,parse=acequire("./json/json_parse"),JsonWorker=exports.JsonWorker=function(sender){Mirror.call(this,sender),this.setTimeout(200)};oop.inherits(JsonWorker,Mirror),function(){this.onUpdate=function(){var value=this.doc.getValue(),errors=[];try{value&&parse(value)}catch(e){var pos=this.doc.indexToPosition(e.at-1);errors.push({row:pos.row,column:pos.column,text:e.message,type:"error"})}this.sender.emit("annotate",errors)}}.call(JsonWorker.prototype)}),ace.define("ace/lib/es5-shim",["require","exports","module"],function(){function Empty(){}function doesDefinePropertyWork(object){try{return Object.defineProperty(object,"sentinel",{}),"sentinel"in object}catch(exception){}}function toInteger(n){return n=+n,n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n}Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError("Function.prototype.bind called on incompatible "+target);var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));return Object(result)===result?result:this}return target.apply(that,args.concat(slice.call(arguments)))};return target.prototype&&(Empty.prototype=target.prototype,bound.prototype=new Empty,Empty.prototype=null),bound});var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors,call=Function.prototype.call,prototypeOfArray=Array.prototype,prototypeOfObject=Object.prototype,slice=prototypeOfArray.slice,_toString=call.bind(prototypeOfObject.toString),owns=call.bind(prototypeOfObject.hasOwnProperty);if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))&&(defineGetter=call.bind(prototypeOfObject.__defineGetter__),defineSetter=call.bind(prototypeOfObject.__defineSetter__),lookupGetter=call.bind(prototypeOfObject.__lookupGetter__),lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)),2!=[1,2].splice(0).length)if(function(){function makeArray(l){var a=Array(l+2);return a[0]=a[1]=0,a}var lengthBefore,array=[];return array.splice.apply(array,makeArray(20)),array.splice.apply(array,makeArray(26)),lengthBefore=array.length,array.splice(5,0,"XXX"),lengthBefore+1==array.length,lengthBefore+1==array.length?!0:void 0\n}()){var array_splice=Array.prototype.splice;Array.prototype.splice=function(start,deleteCount){return arguments.length?array_splice.apply(this,[void 0===start?0:start,void 0===deleteCount?this.length-start:deleteCount].concat(slice.call(arguments,2))):[]}}else Array.prototype.splice=function(pos,removeCount){var length=this.length;pos>0?pos>length&&(pos=length):void 0==pos?pos=0:0>pos&&(pos=Math.max(length+pos,0)),length>pos+removeCount||(removeCount=length-pos);var removed=this.slice(pos,pos+removeCount),insert=slice.call(arguments,2),add=insert.length;if(pos===length)add&&this.push.apply(this,insert);else{var remove=Math.min(removeCount,length-pos),tailOldPos=pos+remove,tailNewPos=tailOldPos+add-remove,tailCount=length-tailOldPos,lengthAfterRemove=length-remove;if(tailOldPos>tailNewPos)for(var i=0;tailCount>i;++i)this[tailNewPos+i]=this[tailOldPos+i];else if(tailNewPos>tailOldPos)for(i=tailCount;i--;)this[tailNewPos+i]=this[tailOldPos+i];if(add&&pos===lengthAfterRemove)this.length=lengthAfterRemove,this.push.apply(this,insert);else for(this.length=lengthAfterRemove+add,i=0;add>i;++i)this[pos+i]=insert[i]}return removed};Array.isArray||(Array.isArray=function(obj){return"[object Array]"==_toString(obj)});var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString);if(Array.prototype.forEach||(Array.prototype.forEach=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,thisp=arguments[1],i=-1,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError;for(;length>++i;)i in self&&fun.call(thisp,self[i],i,object)}),Array.prototype.map||(Array.prototype.map=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(result[i]=fun.call(thisp,self[i],i,object));return result}),Array.prototype.filter||(Array.prototype.filter=function(fun){var value,object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=[],thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(value=self[i],fun.call(thisp,value,i,object)&&result.push(value));return result}),Array.prototype.every||(Array.prototype.every=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&!fun.call(thisp,self[i],i,object))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&fun.call(thisp,self[i],i,object))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var result,i=0;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i++];break}if(++i>=length)throw new TypeError("reduce of empty array with no initial value")}for(;length>i;i++)i in self&&(result=fun.call(void 0,result,self[i],i,object));return result}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var result,i=length-1;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i--];break}if(0>--i)throw new TypeError("reduceRight of empty array with no initial value")}do i in this&&(result=fun.call(void 0,result,self[i],i,object));while(i--);return result}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=0;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:Math.max(0,length+i);length>i;i++)if(i in self&&self[i]===sought)return i;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=length-1;for(arguments.length>1&&(i=Math.min(i,toInteger(arguments[1]))),i=i>=0?i:length-Math.abs(i);i>=0;i--)if(i in self&&sought===self[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}),!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(object,property){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT+object);if(owns(object,property)){var descriptor,getter,setter;if(descriptor={enumerable:!0,configurable:!0},supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property),setter=lookupSetter(object,property);if(object.__proto__=prototype,getter||setter)return getter&&(descriptor.get=getter),setter&&(descriptor.set=setter),descriptor}return descriptor.value=object[property],descriptor}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(object){return Object.keys(object)}),!Object.create){var createEmpty;createEmpty=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var empty={};for(var i in empty)empty[i]=null;return empty.constructor=empty.hasOwnProperty=empty.propertyIsEnumerable=empty.isPrototypeOf=empty.toLocaleString=empty.toString=empty.valueOf=empty.__proto__=null,empty},Object.create=function(prototype,properties){var object;if(null===prototype)object=createEmpty();else{if("object"!=typeof prototype)throw new TypeError("typeof prototype["+typeof prototype+"] != \'object\'");var Type=function(){};Type.prototype=prototype,object=new Type,object.__proto__=prototype}return void 0!==properties&&Object.defineProperties(object,properties),object}}if(Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({}),definePropertyWorksOnDom="undefined"==typeof document||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom)var definePropertyFallback=Object.defineProperty}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ",ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ",ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(object,property,descriptor){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if("object"!=typeof descriptor&&"function"!=typeof descriptor||null===descriptor)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback)try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}if(owns(descriptor,"value"))if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject,delete object[property],object[property]=descriptor.value,object.__proto__=prototype}else object[property]=descriptor.value;else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);owns(descriptor,"get")&&defineGetter(object,property,descriptor.get),owns(descriptor,"set")&&defineSetter(object,property,descriptor.set)}return object}}Object.defineProperties||(Object.defineProperties=function(object,properties){for(var property in properties)owns(properties,property)&&Object.defineProperty(object,property,properties[property]);return object}),Object.seal||(Object.seal=function(object){return object}),Object.freeze||(Object.freeze=function(object){return object});try{Object.freeze(function(){})}catch(exception){Object.freeze=function(freezeObject){return function(object){return"function"==typeof object?object:freezeObject(object)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(object){return object}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(object){if(Object(object)===object)throw new TypeError;for(var name="";owns(object,name);)name+="?";object[name]=!0;var returnValue=owns(object,name);return delete object[name],returnValue}),!Object.keys){var hasDontEnumBug=!0,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null})hasDontEnumBug=!1;Object.keys=function(object){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var name in object)owns(object,name)&&keys.push(name);if(hasDontEnumBug)for(var i=0,ii=dontEnumsLength;ii>i;i++){var dontEnum=dontEnums[i];owns(object,dontEnum)&&keys.push(dontEnum)}return keys}}Date.now||(Date.now=function(){return(new Date).getTime()});var ws="\t\\n\v\\f\\r \\u2028\\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=RegExp("^"+ws+ws+"*"),trimEndRegexp=RegExp(ws+ws+"*$");String.prototype.trim=function(){return(this+"").replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toObject=function(o){if(null==o)throw new TypeError("can\'t convert "+o+" to object");return Object(o)}});'},47:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(22),r=i(2),n=a.__importDefault(i(48));t.default=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=[]);var a=n.default(e,t),s=a[0],o=a[1],l=a[2];return r.useEffect(l,i),[s,o]}},48:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(2);t.default=function(e,t){void 0===t&&(t=0);var i=a.useRef(!1),r=a.useRef(),n=a.useRef(e),s=a.useCallback((function(){return i.current}),[]),o=a.useCallback((function(){i.current=!1,r.current&&clearTimeout(r.current),r.current=setTimeout((function(){i.current=!0,n.current()}),t)}),[t]),l=a.useCallback((function(){i.current=null,r.current&&clearTimeout(r.current)}),[]);return a.useEffect((function(){n.current=e}),[e]),a.useEffect((function(){return o(),l}),[t]),[s,l,o]}},49:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(22),r=i(2),n=a.__importDefault(i(39));t.default=function(e){var t=r.useRef(e);t.current=e,n.default((function(){return function(){return t.current()}}))}},50:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return Dt})),i(40),i(45);var a=i(2),r=i.n(a),n=i(1),s=i(17),o=i(14),l=i(29),c=i(7),d=i.n(c),u=i(6),g=i(3),p=i(0);function m({setSelectedTab:e,optionTabs:t}){return Object(p.jsx)(n.EuiTabs,{className:"visEditorSidebar__nav",size:"s"},t.map((({name:t,title:i,isSelected:a=!1})=>Object(p.jsx)(n.EuiTab,{key:t,isSelected:a,"data-test-subj":`visEditorTab__${t}`,onClick:()=>e(t)},i))))}var f=i(4),b=i(47),h=i.n(b),v=i(28);let j=function(e){return e.ADD_NEW_AGG="ADD_NEW_AGG",e.DISCARD_CHANGES="DISCARD_CHANGES",e.CHANGE_AGG_TYPE="CHANGE_AGG_TYPE",e.SET_AGG_PARAM_VALUE="SET_AGG_PARAM_VALUE",e.SET_STATE_PARAM_VALUE="SET_STATE_PARAM_VALUE",e.TOGGLE_ENABLED_AGG="TOGGLE_ENABLED_AGG",e.REMOVE_AGG="REMOVE_AGG",e.REORDER_AGGS="REORDER_AGGS",e.UPDATE_STATE_PARAMS="UPDATE_STATE_PARAMS",e}({});const x=(e,t)=>e.find((e=>e.name===t))||{},E=(e,t,i)=>{const a=x(i,e.schema);return t.reduce(((t,i)=>i.schema===e.schema?++t:t),0)>a.min},y=e=>e.reduce(((e,t)=>"metric"===t.schema&&t.enabled?++e:e),0),w=(e,t,i,a)=>{if(!x(a,e.schema).mustBeFirst)return!1;const r=Object(u.findIndex)(i,(t=>t.schema!==e.schema));return-1!==r&&t>r};function O(e){return{...e.clone()}}const _={validity:{},touched:!1,invalid:!1},S=e=>({type:j.DISCARD_CHANGES,payload:{vis:e}});function T({applyChanges:e,isDirty:t,isInvalid:i,isTouched:r,dispatch:s,vis:o}){const{enableAutoApply:l}=o.type.editorConfig,[c,d]=Object(a.useState)(!1),u=Object(a.useCallback)((e=>d(e)),[]),m=Object(a.useCallback)((()=>s(S(o))),[s,o]);return h()((()=>{c&&t&&e()}),300,[t,c,e]),Object(p.jsx)("div",{className:"visEditorSidebar__controls"},!c&&Object(p.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"none",responsive:!1},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButtonEmpty,{"data-test-subj":"visualizeEditorResetButton",disabled:!t,iconType:"cross",onClick:m,size:"s"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.discardChangesButtonLabel",defaultMessage:"Discard"}))),Object(p.jsx)(n.EuiFlexItem,{grow:!1},i&&r?Object(p.jsx)(n.EuiToolTip,{content:g.i18n.translate("visDefaultEditor.sidebar.errorButtonTooltip",{defaultMessage:"Errors in the highlighted fields need to be resolved."})},Object(p.jsx)(n.EuiButton,{color:"danger",iconType:"warning",size:"s",disabled:!0},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.updateChartButtonLabel",defaultMessage:"Update"}))):Object(p.jsx)(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiIconTip,{content:g.i18n.translate("visDefaultEditor.sidebar.updateInfoTooltip",{defaultMessage:"CTRL + Enter is a shortcut for Update."}),type:"keyboard",color:"subdued"})),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButton,{"data-test-subj":"visualizeEditorRenderButton",disabled:!t,fill:!0,iconType:"play",onClick:e,size:"s"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.updateChartButtonLabel",defaultMessage:"Update"})))))),l&&Object(p.jsx)(n.EuiToolTip,{title:c?g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesOnLabel",{defaultMessage:"Auto apply is on"}):g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesOffLabel",{defaultMessage:"Auto apply is off"}),content:g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesTooltip",{defaultMessage:"Auto updates the visualization on every change."})},Object(p.jsx)(n.EuiButton,{className:"visEditorSidebar__autoApplyButton","data-test-subj":"visualizeEditorAutoButton",iconType:"refresh",color:c?"primary":"text",fill:!0,onClick:()=>u(!c),size:"s",minWidth:80,"aria-label":c?g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesLabelOn",{defaultMessage:"Auto apply is on"}):g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesLabelOff",{defaultMessage:"Auto apply is off"})},c?g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesOn",{defaultMessage:"On"}):g.i18n.translate("visDefaultEditor.sidebar.autoApplyChangesOff",{defaultMessage:"Off"}))))}var k=i(30);function A({savedSearch:e,eventEmitter:t}){const[i,r]=Object(a.useState)(!1),{services:{application:s}}=Object(o.useKibana)(),l=Object(a.useCallback)((()=>r(!1)),[]),c=Object(a.useCallback)((()=>r((e=>!e))),[]),d=Object(a.useCallback)((()=>{r(!1),t.emit("unlinkFromSavedSearch")}),[t]),u=Object(a.useCallback)((()=>{s.navigateToApp("discover",{path:Object(k.getSavedSearchUrl)(e.id)})}),[s,e.id]),m=g.i18n.translate("visDefaultEditor.sidebar.savedSearch.linkButtonAriaLabel",{defaultMessage:"Link to saved search. Click to learn more or break link."});return Object(p.jsx)(n.EuiFlexGroup,{alignItems:"center",className:"visEditorSidebar__titleContainer visEditorSidebar__linkedSearch",gutterSize:"xs",responsive:!1},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiIcon,{type:"search"})),Object(p.jsx)(n.EuiFlexItem,{grow:!1,className:"eui-textTruncate"},Object(p.jsx)(n.EuiTitle,{size:"xs",className:"eui-textTruncate"},Object(p.jsx)("h2",{title:g.i18n.translate("visDefaultEditor.sidebar.savedSearch.titleAriaLabel",{defaultMessage:"Saved search: {title}",values:{title:e.title}})},e.title))),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiPopover,{anchorPosition:"downRight",button:Object(p.jsx)(n.EuiToolTip,{content:m},Object(p.jsx)(n.EuiButtonIcon,{"aria-label":m,"data-test-subj":"showUnlinkSavedSearchPopover",iconType:"link",onClick:c})),isOpen:i,closePopover:l,panelPaddingSize:"s"},Object(p.jsx)(n.EuiPopoverTitle,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.savedSearch.popoverTitle",defaultMessage:"Linked to saved search"})),Object(p.jsx)("div",{style:{width:260}},Object(p.jsx)(n.EuiText,{size:"s"},Object(p.jsx)("p",null,Object(p.jsx)(n.EuiButtonEmpty,{"data-test-subj":"viewSavedSearch",flush:"left",onClick:u,size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.savedSearch.goToDiscoverButtonText",defaultMessage:"View this search in Discover"}))),Object(p.jsx)("p",null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.savedSearch.popoverHelpText",defaultMessage:"Subsequent modifications to this saved search are reflected in the visualization. To disable automatic updates, remove the link."})),Object(p.jsx)("p",null,Object(p.jsx)(n.EuiButton,{color:"danger","data-test-subj":"unlinkSavedSearch",fullWidth:!0,onClick:d,size:"s"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.sidebar.savedSearch.unlinkSavedSearchButtonText",defaultMessage:"Remove link to saved search"}))))))))}function C({savedSearch:e,vis:t,isLinkedSearch:i,eventEmitter:a}){var r,s,o,l;return i&&e?Object(p.jsx)(A,{savedSearch:e,eventEmitter:a}):t.type.options.showIndexSelection?Object(p.jsx)(n.EuiTitle,{size:"xs",className:"visEditorSidebar__titleContainer eui-textTruncate"},Object(p.jsx)("h2",{title:g.i18n.translate("visDefaultEditor.sidebar.indexPatternAriaLabel",{defaultMessage:"Index pattern: {title}",values:{title:null===(r=t.data)||void 0===r||null===(s=r.indexPattern)||void 0===s?void 0:s.getName()}})},null===(o=t.data)||void 0===o||null===(l=o.indexPattern)||void 0===l?void 0:l.getName())):Object(p.jsx)("div",{className:"visEditorSidebar__indexPatternPlaceholder"})}var I=i(49),M=i.n(I);let R=function(e){return e.TOUCHED="aggTypeTouched",e.VALID="aggTypeValid",e}({});function L(e,t){switch(t.type){case R.TOUCHED:return{...e,touched:t.payload};case R.VALID:return{...e,valid:t.payload};default:throw new Error}}let P=function(e){return e.TOUCHED="aggParamsTouched",e.VALID="aggParamsValid",e.RESET="aggParamsReset",e}({});function D(e,{type:t,paramName:i="",payload:a}){const r=e[i]||{valid:!0,touched:!1};switch(t){case P.TOUCHED:return{...e,[i]:{...r,touched:a}};case P.VALID:return{...e,[i]:{...r,valid:a}};case P.RESET:return{};default:throw new Error}}function F(e){return e.reduce(((e,t)=>(e[t.aggParam.name]={valid:!0,touched:!1},e)),{})}function N({aggError:e,id:t,indexPattern:i,value:r,setValue:s,aggTypeOptions:l,showValidation:c,isSubAggregation:d,onChangeAggType:m}){const[b,h]=Object(a.useState)(!1),{services:v}=Object(o.useKibana)(),j=r?[{label:r.title,target:r}]:[],x=d?Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggSelect.subAggregationLabel",defaultMessage:"Sub aggregation"}):Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggSelect.aggregationLabel",defaultMessage:"Aggregation"});let E;Object(u.has)(r,"name")&&(E=v.docLinks.links.aggs[r.name]);const y=r&&E&&Object(p.jsx)(n.EuiText,{size:"xs"},Object(p.jsx)(n.EuiLink,{href:E,target:"_blank",rel:"noopener"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggSelect.helpLinkLabel",defaultMessage:"{aggTitle} help",values:{aggTitle:r?r.title:""}}))),w=e?[e]:[];l.length||w.push(g.i18n.translate("visDefaultEditor.aggSelect.noCompatibleAggsDescription",{defaultMessage:"The index pattern {indexPatternTitle} does not have any aggregatable fields.",values:{indexPatternTitle:i&&i.title}}));const O=!!r&&!w.length&&!b,_=Object(a.useCallback)((e=>{const t=Object(u.get)(e,"0.target");t&&s(t)}),[s]),S=Object(a.useCallback)((e=>h(Boolean(e))),[]),T=Object(a.useCallback)((()=>m({type:R.TOUCHED,payload:!0})),[m]),k=Object(a.useCallback)((e=>m({type:R.VALID,payload:e})),[m]);return Object(a.useEffect)((()=>{k(O)}),[O,k]),Object(a.useEffect)((()=>{w.length&&T()}),[w.length,T]),Object(p.jsx)(n.EuiFormRow,{label:x,labelAppend:y,error:w,isInvalid:!!c&&!O,fullWidth:!0,display:"rowCompressed"},Object(p.jsx)(n.EuiComboBox,{placeholder:g.i18n.translate("visDefaultEditor.aggSelect.selectAggPlaceholder",{defaultMessage:"Select an aggregation"}),id:`visDefaultEditorAggSelect${t}`,isDisabled:!l.length,options:l,selectedOptions:j,singleSelection:{asPlainText:!0},onBlur:T,onChange:_,onSearchChange:S,"data-test-subj":"defaultEditorAggSelect",isClearable:!1,isInvalid:!!c&&!O,fullWidth:!0,sortMatchesBy:"startsWith",compressed:!0}))}function B(e){const{agg:t,aggParam:i,paramEditor:r,setAggParamValue:n,onChangeParamsState:s,...o}=e,l=Object(a.useCallback)((e=>{s({type:P.VALID,paramName:i.name,payload:e})}),[s,i.name]),c=Object(a.useCallback)(((e=!0)=>{s({type:P.TOUCHED,paramName:i.name,payload:e})}),[s,i.name]),u=Object(a.useCallback)((a=>{e.value!==a&&n(t.id,i.name,a)}),[n,t.id,i.name,e.value]);return Object(a.useEffect)((()=>{i.shouldShow&&!i.shouldShow(t)&&l(!0)}),[t,t.params.field,i,l]),i.shouldShow&&!i.shouldShow(t)?null:Object(p.jsx)(r,d()({agg:t,aggParam:i,setValidity:l,setTouched:c,setValue:u},o))}const{propFilter:V}=v.search.aggs,z=V("name"),G=[(e,t,i,a)=>0!==z([e],a).length,(e,t,i,a)=>{const r=t.getAggregationRestrictions();if(!r)return!0;const n=e.name;return"count"===n||!!r&&Object.keys(r).includes(n)||!1}],$=[(e,t)=>{const i=t.getIndexPattern().getAggregationRestrictions();if(!i)return!0;const a=i[t.type&&t.type.name];return!!a&&!!a[e.name]}];var q=i(15),W=i(31),U=i.n(W),H=i(36),K=i.n(H);const J=Object(n.htmlIdGenerator)(),Y=(e="")=>{if(!e)return!0;const t=U.a.parse(e);return t&&t.isValid()};function X({value:e=!1,setValue:t,dataTestSubj:i,displayToolTip:a,displayLabel:r,disabled:s}){return Object(p.jsx)(n.EuiFormRow,{fullWidth:!0},Object(p.jsx)(n.EuiToolTip,{content:a,delay:"long",position:"right"},Object(p.jsx)(n.EuiSwitch,{compressed:!0,label:r,checked:e,disabled:s,"data-test-subj":i,onChange:e=>t(e.target.checked)})))}var Q=i(13);const Z=g.i18n.translate("visDefaultEditor.controls.field.fieldLabel",{defaultMessage:"Field"});function ee({agg:e,aggParam:t,customError:i,customLabel:r,indexedFields:s=[],showValidation:o,value:l,setTouched:c,setValidity:d,setValue:m}){const[f,b]=Object(a.useState)(!1),h=l?[{label:l.displayName,target:l,key:l.name}]:[],j=i?[i]:[];let x=!1;s.length||j.push(g.i18n.translate("visDefaultEditor.controls.field.noCompatibleFieldsDescription",{defaultMessage:"The index pattern {indexPatternTitle} does not contain any of the following compatible field types: {fieldTypes}",values:{indexPatternTitle:e.getIndexPattern&&e.getIndexPattern().title,fieldTypes:te(e)}})),l&&l.type===v.KBN_FIELD_TYPES.MISSING?(j.push(g.i18n.translate("visDefaultEditor.controls.field.fieldIsNotExists",{defaultMessage:'The field "{fieldParameter}" associated with this object no longer exists in the index pattern. Please use another field.',values:{fieldParameter:l.name}})),x=!0):l&&!ie(e).find((e=>e===l.type||"*"===e))&&(j.push(g.i18n.translate("visDefaultEditor.controls.field.invalidFieldForAggregation",{defaultMessage:'Saved field "{fieldParameter}" of index pattern "{indexPatternTitle}" is invalid for use with this aggregation. Please select a new field.',values:{fieldParameter:null==l?void 0:l.name,indexPatternTitle:e.getIndexPattern&&e.getIndexPattern().title}})),x=!0);const E=!!l&&!j.length&&!f,y=(o||!s.length||x)&&!E;Object(Q.g)(d,E),K()((()=>{if(1!==s.length)return;const e=s[0];"options"in e?1===e.options.length&&m(e.options[0].target):m(e.target)}));const w=Object(a.useCallback)((e=>b(Boolean(e))),[]);return Object(p.jsx)(n.EuiFormRow,{label:r||Z,isInvalid:y,fullWidth:!0,error:j,display:"rowCompressed"},Object(p.jsx)(n.EuiComboBox,{compressed:!0,placeholder:g.i18n.translate("visDefaultEditor.controls.field.selectFieldPlaceholder",{defaultMessage:"Select a field"}),options:s,isDisabled:!s.length,selectedOptions:h,singleSelection:{asPlainText:!0},isClearable:!1,isInvalid:y,onChange:i=>{const a=Object(u.get)(i,"0.target");t.required&&!a||m(a),t.onChange&&t.onChange(e)},onBlur:c,onSearchChange:w,sortMatchesBy:"startsWith","data-test-subj":"visDefaultEditorField",fullWidth:!0}))}function te(e){return Object(Q.a)(ie(e),{inclusive:!1})}function ie(e){const t=Object(u.get)(e,"type.params",[]).find((e=>"field"===e.name))||{};return Object(Q.c)(t.filterFieldTypes||[])}function ae({id:e,arrayIndex:t,customLabel:i,value:r,autoFocus:s,disableRemove:l,dataTestSubj:c,agg:d,onChangeValue:u,onRemoveFilter:m}){const{services:f}=Object(o.useKibana)(),{data:b,unifiedSearch:{ui:{QueryStringInput:h}},appName:v}=f,[j,x]=Object(a.useState)(!1),E=g.i18n.translate("visDefaultEditor.controls.filters.filterLabel",{defaultMessage:"Filter {index}",values:{index:t+1}}),y=Object(p.jsx)("div",null,Object(p.jsx)(n.EuiButtonIcon,{iconType:"tag","aria-label":g.i18n.translate("visDefaultEditor.controls.filters.toggleFilterButtonAriaLabel",{defaultMessage:"Toggle filter label"}),"aria-expanded":j,"aria-controls":`visEditorFilterLabel${t}`,onClick:()=>x(!j)}),Object(p.jsx)(n.EuiButtonIcon,{iconType:"trash",color:"danger",disabled:l,"aria-label":g.i18n.translate("visDefaultEditor.controls.filters.removeFilterButtonAriaLabel",{defaultMessage:"Remove this filter"}),onClick:()=>m(e)}));return Object(p.jsx)(n.EuiForm,null,Object(p.jsx)(n.EuiFormRow,{label:`${E}${i?` - ${i}`:""}`,labelAppend:y,fullWidth:!0},Object(p.jsx)(h,{query:r,indexPatterns:[d.getIndexPattern()],onChange:t=>u(e,t,i),onBlur:()=>{r.query.length>0&&b.query.addToQueryLog(v,r)},disableAutoFocus:!s,dataTestSubj:c,bubbleSubmitEvent:!0,languageSwitcherPopoverAnchorPosition:"leftDown",size:"s",appName:v})),j?Object(p.jsx)(n.EuiFormRow,{id:`visEditorFilterLabel${t}`,label:g.i18n.translate("visDefaultEditor.controls.filters.definiteFilterLabel",{defaultMessage:"Filter {index} label",description:"'Filter {index}' represents the name of the filter as a noun, similar to 'label for filter 1'.",values:{index:t+1}}),fullWidth:!0,display:"rowCompressed"},Object(p.jsx)(n.EuiFieldText,{value:i,placeholder:g.i18n.translate("visDefaultEditor.controls.filters.labelPlaceholder",{defaultMessage:"Label"}),onChange:t=>u(e,r,t.target.value),fullWidth:!0,compressed:!0})):null,Object(p.jsx)(n.EuiSpacer,{size:"m"}))}const re=Object(n.htmlIdGenerator)(),{isType:ne}=v.search.aggs;function se({agg:e,aggParam:t,showValidation:i,value:r,setValidity:s,setValue:o,setTouched:l}){const c=!t.required||!!r;Object(a.useEffect)((()=>{s(c)}),[c,s]);const d=Object(a.useCallback)((e=>o(e.target.value)),[o]);return Object(p.jsx)(n.EuiFormRow,{className:"visEditorAggParam__string",label:t.displayName||t.name,fullWidth:!0,display:"rowCompressed",isInvalid:!!i&&!c},Object(p.jsx)(n.EuiFieldText,{value:r||"","data-test-subj":`visEditorStringInput${e.id}${t.name}`,onChange:d,fullWidth:!0,compressed:!0,onBlur:l,isInvalid:!!i&&!c}))}const oe="(\\-?(?:\\d+(?:\\.\\d+)?|Infinity))",le=new RegExp("^\\s*([\\[|\\(])\\s*"+oe+"\\s*,\\s*"+oe+"\\s*([\\]|\\)])\\s*$");class NumberListRange{constructor(e,t,i,a){this.minInclusive=e,this.min=t,this.max=i,this.maxInclusive=a}within(e){return!(this.min===e&&!this.minInclusive||this.min>e||this.max===e&&!this.maxInclusive||this.max<e)}}function ce(e){const t=String(e).match(le);if(!t)throw new TypeError("expected input to be in interval notation e.g., (100, 200]");const i=["["===t[1],parseFloat(t[2]),parseFloat(t[3]),"]"===t[4]];i[1]>i[2]&&i.reverse();const[a,r,n,s]=i;return new NumberListRange(a,r,n,s)}const de="",ue=ce("[0,Infinity)"),ge=Object(n.htmlIdGenerator)(),pe={value:0,id:ge(),isInvalid:!1};function me(e){const t=parseFloat(e);return isNaN(t)?de:t}function fe(e){try{return e?ce(e):ue}catch(e){throw new TypeError("Unable to parse range: "+e.message)}}function be(e,t){const i=Object(u.last)(e).value;let a=Number(i)?Number(i)+1:1;return a>=t.max&&(a=t.max-1),{id:ge(),value:a,isInvalid:!1}}function he(e){return e.length?e.map((e=>({value:void 0===e?de:e,id:ge(),isInvalid:!1}))):[pe]}function ve({autoFocus:e,disableDelete:t,model:i,isInvalid:r,labelledbyId:s,range:o,onBlur:l,onDelete:c,onChange:d}){const u=g.i18n.translate("visDefaultEditor.controls.numberList.removeUnitButtonAriaLabel",{defaultMessage:"Remove the rank value of {value}",values:{value:i.value}}),m=Object(a.useCallback)((e=>d({value:e.target.value,id:i.id})),[d,i.id]),f=Object(a.useCallback)((()=>c(i.id)),[c,i.id]);return Object(p.jsx)(n.EuiFlexGroup,{responsive:!1,alignItems:"center",gutterSize:"s"},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldNumber,{"aria-labelledby":s,autoFocus:e,compressed:!0,isInvalid:r,placeholder:g.i18n.translate("visDefaultEditor.controls.numberList.enterValuePlaceholder",{defaultMessage:"Enter a value"}),onChange:m,value:i.value,fullWidth:!0,min:o.min,max:o.max,onBlur:l})),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButtonIcon,{"aria-label":u,title:u,color:"danger",iconType:"trash",onClick:f,disabled:t})))}const je=Object(n.htmlIdGenerator)();function xe({agg:e,aggParam:t,value:i,setValue:s,setTouched:o}){const[l,c]=Object(a.useState)(he(i&&Object(u.isArray)(i)?i:[de])),d=Object(a.useMemo)((()=>fe("[-Infinity,Infinity]")),[]);Object(a.useEffect)((()=>{!Object(u.isArray)(i)||i.length===l.length&&i.every(((e,t)=>e===l[t].value))||c(i.map((e=>({id:je(),value:e,isInvalid:!1}))))}),[l,i]);const g=Object(a.useCallback)((e=>{c(e),s(e.map((({value:e})=>e)))}),[s]),m=Object(a.useCallback)((e=>{g(l.map((t=>t.id===e.id?{id:e.id,value:me(e.value),isInvalid:!1}:t)))}),[l,g]),b=Object(a.useCallback)((()=>{const e=[...l,{id:je(),value:de,isInvalid:!1}];g(e)}),[l,g]),h=Object(a.useCallback)((e=>g(l.filter((t=>t.id!==e)))),[l,g]);return Object(p.jsx)(n.EuiFormRow,{id:`${t.name}-${e.id}}`,label:t.displayName||t.name,fullWidth:!0,display:"rowCompressed"},Object(p.jsx)(r.a.Fragment,null,l.map(((i,r)=>Object(p.jsx)(a.Fragment,{key:i.id},Object(p.jsx)(ve,{isInvalid:i.isInvalid,disableDelete:1===l.length,model:i,labelledbyId:`${t.name}-${e.id}-legend`,range:d,onDelete:h,onChange:m,onBlur:o,autoFocus:1!==l.length&&r===l.length-1}),l.length-1!==r&&Object(p.jsx)(n.EuiSpacer,{size:"s"})))),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiButtonEmpty,{iconType:"plusInCircleFilled",onClick:b,size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.includeExclude.addUnitButtonLabel",defaultMessage:"Add value"})))))}const{isNumberType:Ee}=v.search.aggs;function ye(e){const{agg:t,value:i,setValue:r}=e,n=Ee(t);return Object(a.useEffect)((()=>{if(n&&!Array.isArray(i)&&void 0!==i){const e=i.split("|").map((e=>parseFloat(e))).filter((e=>Number.isFinite(e)));r(e.length?e:[""])}else!n&&Array.isArray(i)&&void 0!==i&&r(i.filter((e=>""!==e)).join("|"))}),[n,r,i]),n?Object(p.jsx)(xe,d()({},e,{value:i})):Object(p.jsx)(se,d()({},e,{value:i}))}const we=g.i18n.translate("visDefaultEditor.controls.IpPrefix.prefixLength",{defaultMessage:"Prefix length"}),Oe=g.i18n.translate("visDefaultEditor.controls.IpPrefix.isIpv6",{defaultMessage:"Prefix applies to IPv6 addresses"}),_e=Object(n.htmlIdGenerator)(),Se=(e,t)=>{const i={model:e||"",isInvalid:!1};if(!e)return i.isInvalid=!1,i;try{return i.model=new t(e).toString(),i.isInvalid=!1,i}catch(e){return i.isInvalid=!0,i}};function Te({config:e,list:t,onChange:i,setValidity:s}){const{defaultValue:o,getModelValue:l,modelNames:c,onChangeFn:d,validateClass:g}=e,[m,b]=Object(a.useState)((()=>t.map((e=>({id:_e(),...l(e)}))))),h=m.some(e.hasInvalidValuesFn),v=Object(a.useCallback)((e=>{b(e),i(e.map(d))}),[d,i]),j=Object(a.useCallback)(((e,t,i)=>{const{model:a,isInvalid:r}=Se(t,g);v(m.map(((n,s)=>s===e?{...n,[i]:{value:t,model:a,isInvalid:r}}:n)))}),[m,v,g]),x=Object(a.useCallback)((e=>v(m.filter((t=>t.id!==e)))),[m,v]),E=Object(a.useCallback)((()=>v([...m,{id:_e(),...l()}])),[l,m,v]);return Object(a.useEffect)((()=>{t.length||v([{id:_e(),...o}])}),[o,t.length,v]),Object(a.useEffect)((()=>{s(!h)}),[h,s]),Object(a.useEffect)((()=>{(t.length!==m.length||t.some(((e,t)=>{const i=Object(u.mapValues)(Object(u.pick)(m[t],c),"model");return!Object(u.isEqual)(e,Object(u.omitBy)(i,u.isEmpty))})))&&b(t.map((e=>({id:_e(),...l(e)}))))}),[l,t,c,m]),Object(p.jsx)(r.a.Fragment,null,m.map(((t,i)=>Object(p.jsx)(a.Fragment,{key:t.id},Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",responsive:!1},e.renderInputRow(t,i,j),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButtonIcon,{"aria-label":e.getRemoveBtnAriaLabel(t),title:e.getRemoveBtnAriaLabel(t),disabled:1===m.length,color:"danger",iconType:"trash",onClick:()=>x(t.id)}))),Object(p.jsx)(n.EuiSpacer,{size:"xs"})))),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiButtonEmpty,{iconType:"plusInCircleFilled",onClick:E,size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.ipRanges.addRangeButtonLabel",defaultMessage:"Add range"}))))}const ke={defaultValue:{from:{value:"0.0.0.0",model:"0.0.0.0",isInvalid:!1},to:{value:"255.255.255.255",model:"255.255.255.255",isInvalid:!1}},validateClass:v.search.aggs.IpAddress,getModelValue:(e={})=>({from:{value:e.from||"",model:e.from||"",isInvalid:!1},to:{value:e.to||"",model:e.to||"",isInvalid:!1}}),getRemoveBtnAriaLabel:e=>g.i18n.translate("visDefaultEditor.controls.ipRanges.removeRangeAriaLabel",{defaultMessage:"Remove the range of {from} to {to}",values:{from:e.from.value||"*",to:e.to.value||"*"}}),onChangeFn:({from:e,to:t})=>{const i={};return e.model&&(i.from=e.model),t.model&&(i.to=t.model),i},hasInvalidValuesFn:({from:e,to:t})=>e.isInvalid||t.isInvalid,modelNames:["from","to"]};function Ae({showValidation:e,onBlur:t,...i}){const s=Object(a.useCallback)(((i,a,s)=>Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldText,{"aria-label":g.i18n.translate("visDefaultEditor.controls.ipRanges.ipRangeFromAriaLabel",{defaultMessage:"IP range from: {value}",values:{value:i.from.value||"*"}}),compressed:!0,isInvalid:!!e&&i.from.isInvalid,placeholder:"*",onChange:e=>{s(a,e.target.value,"from")},value:i.from.value,onBlur:t})),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiIcon,{type:"sortRight",color:"subdued"})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldText,{"aria-label":g.i18n.translate("visDefaultEditor.controls.ipRanges.ipRangeToAriaLabel",{defaultMessage:"IP range to: {value}",values:{value:i.to.value||"*"}}),compressed:!0,isInvalid:!!e&&i.to.isInvalid,placeholder:"*",onChange:e=>{s(a,e.target.value,"to")},value:i.to.value,onBlur:t})))),[t,e]),o={...ke,renderInputRow:s};return Object(p.jsx)(Te,d()({config:o},i))}const Ce={defaultValue:{mask:{model:"0.0.0.0/1",value:"0.0.0.0/1",isInvalid:!1}},validateClass:v.search.aggs.CidrMask,getModelValue:(e={})=>({mask:{model:e.mask||"",value:e.mask||"",isInvalid:!1}}),getRemoveBtnAriaLabel:e=>e.mask.value?g.i18n.translate("visDefaultEditor.controls.ipRanges.removeCidrMaskButtonAriaLabel",{defaultMessage:"Remove the CIDR mask value of {mask}",values:{mask:e.mask.value}}):g.i18n.translate("visDefaultEditor.controls.ipRanges.removeEmptyCidrMaskButtonAriaLabel",{defaultMessage:"Remove the CIDR mask default value"}),onChangeFn:({mask:e})=>e.model?{mask:e.model}:{},hasInvalidValuesFn:({mask:e})=>e.isInvalid,modelNames:"mask"};function Ie({showValidation:e,onBlur:t,...i}){const r=Object(a.useCallback)((({mask:i},a,r)=>Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldText,{"aria-label":g.i18n.translate("visDefaultEditor.controls.ipRanges.cidrMaskAriaLabel",{defaultMessage:"CIDR mask: {mask}",values:{mask:i.value||"*"}}),compressed:!0,fullWidth:!0,isInvalid:!!e&&i.isInvalid,placeholder:"*",onChange:e=>{r(a,e.target.value,"mask")},value:i.value,onBlur:t}))),[t,e]),s={...Ce,renderInputRow:r};return Object(p.jsx)(Te,d()({config:s},i))}var Me=function(e){return e.MASK="mask",e.FROM_TO="fromTo",e}(Me||{});const Re=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev"],Le="EMPTY_VALUE",Pe=[{text:"",value:Le,hidden:!0}],De=Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.numberInterval.minimumIntervalLabel",defaultMessage:"Minimum interval"})," ",Object(p.jsx)(n.EuiIconTip,{position:"right",content:Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.numberInterval.minimumIntervalTooltip",defaultMessage:"Interval will be automatically scaled in the event that the provided value creates more buckets than specified by Advanced Setting's {histogramMaxBars}",values:{histogramMaxBars:v.UI_SETTINGS.HISTOGRAM_MAX_BARS}}),type:"questionInCircle"})),Fe="auto",Ne=g.i18n.translate("visDefaultEditor.controls.numberInterval.selectIntervalPlaceholder",{defaultMessage:"Enter an interval"}),Be=g.i18n.translate("visDefaultEditor.controls.numberInterval.autoInteralIsUsed",{defaultMessage:"Auto interval is used"}),Ve=g.i18n.translate("visDefaultEditor.controls.useAutoInterval",{defaultMessage:"Use auto interval"}),{termsAggFilter:ze}=v.search.aggs,Ge="_key",$e=[{text:g.i18n.translate("visDefaultEditor.controls.orderAgg.alphabeticalLabel",{defaultMessage:"Alphabetical"}),value:Ge}],qe=Object(Q.b)(ze);function We({labelledbyId:e,numberArray:t,range:i,showValidation:s,unitName:o,validateAscendingOrder:l=!1,disallowDuplicates:c=!1,onChange:d,setTouched:u,setValidity:m}){const b=Object(a.useMemo)((()=>fe(i)),[i]),[h,v]=Object(a.useState)(he(t));Object(a.useEffect)((()=>{v((e=>function(e,t,i,a=!1,r=!1){return e.length?e.map(((n,s)=>{const o=t[s]||{id:ge()},l=void 0===n?de:n,c=i?function(e,t){const i={isInvalid:!1};return e===de?(i.isInvalid=!0,i.error=de):t.within(e)||(i.isInvalid=!0,i.error=g.i18n.translate("visDefaultEditor.controls.numberList.invalidRangeErrorMessage",{defaultMessage:"The value should be in the range of {min} to {max}.",values:{min:t.min,max:t.max}})),i}(l,i):{isInvalid:!1},d=a?function(e,t,i){const a={isInvalidOrder:!1},r=i[t-1];return void 0!==r&&void 0!==e&&e<=r&&(a.isInvalidOrder=!0,a.error=g.i18n.translate("visDefaultEditor.controls.numberList.invalidAscOrderErrorMessage",{defaultMessage:"Value is not in ascending order."})),a}(l,s,e):{isInvalidOrder:!1},u=r?function(e,t,i){const a={isDuplicate:!1};return e!==de&&i.indexOf(e)!==t&&(a.isDuplicate=!0,a.error=g.i18n.translate("visDefaultEditor.controls.numberList.duplicateValueErrorMessage",{defaultMessage:"Duplicate value."})),a}(l,s,e):{isDuplicate:!1},p=[c.error,d.error,u.error].filter(Boolean).join(" ");return{...o,value:l,isInvalid:c.isInvalid||d.isInvalidOrder||u.isDuplicate,error:p===de?void 0:p}})):[pe]}(t,e,b,l,c)))}),[t,b,l,c]),Object(a.useEffect)((()=>{t.length||d([h[0].value])}),[h,t.length,d]);const j=!h.find((({isInvalid:e})=>e));Object(Q.g)(m,j);const x=Object(a.useCallback)((e=>{v(e),d(e.map((({value:e})=>e===de?void 0:e)))}),[d]),E=Object(a.useCallback)((({id:e,value:t})=>{const i=me(t);x(h.map((t=>t.id===e?{id:e,value:i,isInvalid:!1}:t)))}),[h,x]),y=Object(a.useCallback)((()=>{const e=[...h,be(h,b)];x(e)}),[h,b,x]),w=Object(a.useCallback)((e=>{const t=h.filter((t=>t.id!==e));x(t)}),[h,x]);return Object(p.jsx)(r.a.Fragment,null,h.map(((t,i)=>Object(p.jsx)(a.Fragment,{key:t.id},Object(p.jsx)(ve,{isInvalid:!!s&&t.isInvalid,disableDelete:1===h.length,model:t,labelledbyId:e,range:b,onDelete:w,onChange:E,onBlur:u,autoFocus:1!==h.length&&i===h.length-1}),s&&t.isInvalid&&t.error&&Object(p.jsx)(n.EuiFormErrorText,null,t.error),h.length-1!==i&&Object(p.jsx)(n.EuiSpacer,{size:"s"})))),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiButtonEmpty,{iconType:"plusInCircleFilled",onClick:y,size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.numberList.addUnitButtonLabel",defaultMessage:"Add {unitName}",values:{unitName:o}}))))}var Ue=i(8),He=i(32),Ke=i(33),Je=i(34);function Ye({disabled:e,iconTip:t,value:i,setValue:s,showValidation:o,setValidity:l,setTouched:c}){const d=Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.sizeLabel",defaultMessage:"Size"}),t),g=e||Number(i)>0;return Object(a.useEffect)((()=>{l(g)}),[g,l]),Object(p.jsx)(n.EuiFormRow,{label:d,fullWidth:!0,isInvalid:!!o&&!g,display:"rowCompressed"},Object(p.jsx)(n.EuiFieldNumber,{value:Object(u.isUndefined)(i)?"":i,onChange:e=>s(""===e.target.value?"":parseFloat(e.target.value)),fullWidth:!0,compressed:!0,isInvalid:!!o&&!g,onBlur:c,min:1,disabled:e,"data-test-subj":"sizeParamEditor"}))}function Xe({agg:e,aggParam:t,formIsTouched:i,metricAggs:a,state:s,setValue:o,setValidity:l,setTouched:c,schemas:d}){const u=g.i18n.translate("visDefaultEditor.controls.metrics.metricTitle",{defaultMessage:"Metric"}),m=g.i18n.translate("visDefaultEditor.controls.metrics.bucketTitle",{defaultMessage:"Bucket"}),f=t.name,b="customMetric"===f,h=b?u:m,j=b?v.AggGroupNames.Metrics:v.AggGroupNames.Buckets;K()((()=>{e.params[f]?o(e.params[f]):o(t.makeAgg(e))}));const{onAggTypeChange:x,setAggParamValue:E}=Object(Q.f)(e,t,e.params[f],o);return e.params[f]?Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiFormLabel,null,h),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(jt,{agg:e.params[f],allowedAggs:t.allowedAggs,groupName:j,className:"visEditorAgg__subAgg",formIsTouched:i,indexPattern:e.getIndexPattern(),metricAggs:a,state:s,setAggParamValue:E,onAggTypeChange:x,setValidity:l,setTouched:c,schemas:d,hideCustomLabel:!b})):null}const{parseEsInterval:Qe,InvalidEsCalendarIntervalError:Ze}=v.search.aggs;function et(e){if("0ms"===e)return{isValidCalendarValue:!0};try{return Qe(e),{isValidCalendarValue:!0}}catch(e){return e instanceof Ze?{isValidCalendarValue:!1,error:e.message}:{isValidCalendarValue:!0}}}const tt=g.i18n.translate("visDefaultEditor.controls.timeInterval.invalidFormatErrorMessage",{defaultMessage:"Invalid interval format."}),it="auto",at=Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.timeInterval.createsTooManyBucketsTooltip",defaultMessage:"This interval creates too many buckets to show in the selected time range, so it has been scaled up."}),rt=Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.timeInterval.createsTooLargeBucketsTooltip",defaultMessage:"This interval creates buckets that are too large to show in the selected time range, so it has been scaled down."}),nt=Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.timeInterval.selectOptionHelpText",defaultMessage:"Select an option or create a custom value. Examples: 30s, 20m, 24h, 2d, 1w, 1M"});function st(e){const{options:t=[]}=e.getAggParams().find((({name:e})=>"aggregate"===e));return t.filter((t=>t.isCompatible(e)))}function ot(e){const t=g.i18n.translate("visDefaultEditor.controls.sortOnLabel",{defaultMessage:"Sort on"});return Object(p.jsx)(ee,d()({},e,{customLabel:t}))}function lt({aggParam:e,value:t,showValidation:i,setValue:r,setValidity:s,setTouched:o}){const l=g.i18n.translate("visDefaultEditor.controls.orderLabel",{defaultMessage:"Order"}),c=!!t;return Object(a.useEffect)((()=>{s(c)}),[c,s]),Object(p.jsx)(n.EuiFormRow,{label:l,fullWidth:!0,isInvalid:!!i&&!c,display:"rowCompressed"},Object(p.jsx)(n.EuiSelect,{options:e.options,value:t&&t.value,onChange:t=>r(e.options.find((e=>e.value===t.target.value))),fullWidth:!0,compressed:!0,isInvalid:!!i&&!c,onBlur:o}))}const ct=g.i18n.translate("visDefaultEditor.controls.maxBars.autoPlaceholder",{defaultMessage:"Auto"}),dt=Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.maxBars.maxBarsLabel",defaultMessage:"Max bars"})," ",Object(p.jsx)(n.EuiIconTip,{position:"right",content:Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.maxBars.maxBarsHelpText",defaultMessage:"Intervals will be selected automatically based on the available data. The maximum number of bars can never be greater than the Advanced Setting's {histogramMaxBars}",values:{histogramMaxBars:v.UI_SETTINGS.HISTOGRAM_MAX_BARS}}),type:"questionInCircle"})),{siblingPipelineType:ut,parentPipelineType:gt}=v.search.aggs,pt={[v.BUCKET_TYPES.DATE_HISTOGRAM]:{scaleMetricValues:function(e){return Object(p.jsx)(X,d()({dataTestSubj:"scaleMetricsSwitch",displayLabel:g.i18n.translate("visDefaultEditor.controls.scaleMetricsLabel",{defaultMessage:"Scale metric values (deprecated)"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.scaleMetricsTooltip",{defaultMessage:"If you select a manual minimum interval and a larger interval will be used, enabling this will cause count and sum metrics to be scaled to the manual selected interval."})},e))},interval:function({agg:e,aggParam:t,editorConfig:i,value:s,setValue:o,showValidation:l,setTouched:c,setValidity:d}){const m=Object(u.get)(i,"interval.timeBase"),b=m?[]:(t.options||[]).reduce(((t,i)=>(i.enabled&&!i.enabled(e)||t.push({label:i.display,key:i.val}),t)),[]);let h,j=[];s&&(h=Object(u.find)(b,{key:s}),j=h?[h]:s===it?[]:[{label:s,key:"custom"}]);const{isValid:x,error:E,interval:y}=function(e,t,i,a){var r,n;if(i)return{isValid:!0,interval:null===(n=e.buckets)||void 0===n?void 0:n.getInterval()};if(!t||t===it&&!i)return{isValid:!1};if(!a){const{isValidCalendarValue:e,error:i}=et(t);if(!e)return{isValid:!1,error:i}}const s=v.search.aggs.isValidInterval(t,a);if(!s)return{isValid:!1,error:tt};const o=null===(r=e.buckets)||void 0===r?void 0:r.getInterval(),{isValidCalendarValue:l,error:c}=et(o.expression);return l?{isValid:s,interval:o}:{isValid:!1,error:c}}(e,s,h,m),w=y&&y.scaled?Object(p.jsx)("strong",{"data-test-subj":"currentlyScaledText",className:"eui-displayBlock"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.timeInterval.scaledHelpText",defaultMessage:"Currently scaled to {bucketDescription}",values:{bucketDescription:Object(u.get)(y,"description")||""}})," ",Object(p.jsx)(n.EuiIconTip,{position:"right",type:"questionInCircle",content:y.scale<=1?at:rt})):null,O=Object(p.jsx)(r.a.Fragment,null,w,Object(u.get)(i,"interval.help")||nt);return Object(a.useEffect)((()=>{d(x)}),[x,d]),Object(p.jsx)(n.EuiFormRow,{display:"rowCompressed",error:E,fullWidth:!0,helpText:O,isInvalid:l&&!x,label:g.i18n.translate("visDefaultEditor.controls.timeInterval.minimumIntervalLabel",{defaultMessage:"Minimum interval"})},Object(p.jsx)(n.EuiComboBox,{compressed:!0,fullWidth:!0,"data-test-subj":"visEditorInterval",isInvalid:l&&!x,noSuggestions:!!m,onChange:e=>{const t=Object(u.get)(e,"0");o(t?t.key:"")},onCreateOption:e=>o(e.trim()),options:b,selectedOptions:j,singleSelection:{asPlainText:!0},placeholder:g.i18n.translate("visDefaultEditor.controls.timeInterval.selectIntervalPlaceholder",{defaultMessage:"Select an interval"}),onBlur:c}))},drop_partials:function(e){return Object(p.jsx)(X,d()({dataTestSubj:"dropPartialBucketsCheckbox",displayLabel:g.i18n.translate("visDefaultEditor.controls.dropPartialBucketsLabel",{defaultMessage:"Drop partial buckets"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.dropPartialBucketsTooltip",{defaultMessage:"Remove buckets that span time outside the time range so the histogram doesn't start and end with incomplete buckets."})},e))}},[v.BUCKET_TYPES.DATE_RANGE]:{ranges:function({value:e=[],setValue:t,setValidity:i}){const{services:s}=Object(o.useKibana)(),[l,c]=Object(a.useState)((()=>e.map((e=>({...e,id:J()}))))),d=e.some((({from:e,to:t})=>!e&&!t||!Y(e)||!Y(t))),m=Object(a.useCallback)((e=>{t(e.map((e=>Object(u.omit)(e,"id")))),c(e)}),[t]),b=Object(a.useCallback)((()=>m([...l,{id:J()}])),[l,m]);K()((()=>{e.length||b()})),Object(a.useEffect)((()=>{(e.length!==l.length||e.some(((e,t)=>!Object(u.isEqual)(e,Object(u.omit)(l[t],"id")))))&&c(e.map((e=>({...e,id:J()}))))}),[l,e]),Object(a.useEffect)((()=>{i(!d)}),[d,i]);const h=(e,t,i)=>m(l.map((a=>a.id===e?{...a,[t]:""===i?void 0:i}:a)));return Object(p.jsx)(n.EuiFormRow,{display:"rowCompressed",fullWidth:!0},Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiText,{size:"xs"},Object(p.jsx)(n.EuiLink,{href:s.docLinks.links.date.dateMath,target:"_blank"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.dateRanges.acceptedDateFormatsLinkText",defaultMessage:"Acceptable date formats"}))),Object(p.jsx)(n.EuiSpacer,{size:"s"}),l.map((({from:t,to:i,id:r},s)=>{const o=g.i18n.translate("visDefaultEditor.controls.dateRanges.removeRangeButtonAriaLabel",{defaultMessage:"Remove the range of {from} to {to}",values:{from:t||"",to:i||"+"}}),c=!t&&!i;return Object(p.jsx)(a.Fragment,{key:r},Object(p.jsx)(n.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center"},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldText,{"aria-label":g.i18n.translate("visDefaultEditor.controls.dateRanges.fromColumnLabel",{defaultMessage:"From",description:"Beginning of a date range, e.g. *From* 2018-02-26 To 2018-02-28"}),compressed:!0,fullWidth:!0,isInvalid:c||!Y(t),placeholder:"",value:t||"",onChange:e=>h(r,"from",e.target.value),"data-test-subj":`visEditorDateRange${s}__from`})),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiIcon,{type:"sortRight",color:"subdued"})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldText,{"aria-label":g.i18n.translate("visDefaultEditor.controls.dateRanges.toColumnLabel",{defaultMessage:"To",description:"End of a date range, e.g. From 2018-02-26 *To* 2018-02-28"}),"data-test-subj":`visEditorDateRange${s}__to`,compressed:!0,fullWidth:!0,isInvalid:c||!Y(i),placeholder:"+",value:i||"",onChange:e=>h(r,"to",e.target.value)})),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiButtonIcon,{title:o,"aria-label":o,disabled:1===e.length,color:"danger",iconType:"trash",onClick:()=>(e=>m(l.filter((t=>t.id!==e))))(r)}))),Object(p.jsx)(n.EuiSpacer,{size:"xs"}))})),d&&Object(p.jsx)(n.EuiFormErrorText,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.dateRanges.errorMessage",defaultMessage:"Each range should have at least one valid date."})),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiButtonEmpty,{iconType:"plusInCircleFilled",onClick:b,size:"xs","data-test-subj":"visEditorAddDateRange"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.dateRanges.addRangeButtonLabel",defaultMessage:"Add range"})))))}},[v.BUCKET_TYPES.FILTERS]:{filters:function({agg:e,value:t=[],setValue:i}){const[s,l]=Object(a.useState)((()=>t.map((e=>({...e,id:re()})))));K()((()=>{i(s.map((e=>Object(u.omit)({...e,input:e.input},"id"))))})),Object(a.useEffect)((()=>{(t.length!==s.length||t.some(((e,t)=>!Object(u.isEqual)(e,Object(u.omit)(s[t],"id")))))&&l(t.map((e=>({...e,id:re()}))))}),[s,t]);const c=e=>{i(e.map((e=>Object(u.omit)(e,"id")))),l(e)},{services:d}=Object(o.useKibana)(),g=e=>c(s.filter((t=>t.id!==e))),m=(e,t,i)=>c(s.map((a=>a.id===e?{...a,input:t,label:i}:a)));return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),s.map((({input:t,label:i,id:a},r)=>Object(p.jsx)(ae,{key:a,id:a,arrayIndex:r,customLabel:i,value:t,autoFocus:r===s.length-1,disableRemove:0===r&&1===s.length,dataTestSubj:`visEditorFilterInput_${e.id}_${r}`,agg:e,onChangeValue:m,onRemoveFilter:g}))),Object(p.jsx)(n.EuiButton,{iconType:"plusInCircle",fill:!0,fullWidth:!0,onClick:()=>c([...s,{input:d.data.query.queryString.getDefaultQuery(),label:"",id:re()}]),size:"s","data-test-subj":"visEditorAddFilterButton"},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.filters.addFilterButtonLabel",defaultMessage:"Add filter"})),Object(p.jsx)(n.EuiSpacer,{size:"m"}))}},[v.BUCKET_TYPES.HISTOGRAM]:{interval:function({agg:e,editorConfig:t,showValidation:i,value:r,setTouched:s,setValidity:o,setValue:l}){const c=e.getField(),d=!c||"number"===c.type,g=d&&(e=>e===Fe)(r),m=Object(u.get)(t,"interval.base"),f=m||0,b=""!==r&&void 0!==r&&(g||Number(r)>=f);Object(a.useEffect)((()=>{o(b)}),[b,o]);const h=Object(a.useCallback)((({target:e})=>l(isNaN(e.valueAsNumber)?"":e.valueAsNumber)),[l]),v=Object(a.useCallback)((e=>{const t=e.target.checked;l(t?Fe:"")}),[l]);return Object(p.jsx)(n.EuiFormRow,{display:"rowCompressed",label:De,fullWidth:!0,isInvalid:i&&!b,helpText:Object(u.get)(t,"interval.help")},Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"s",responsive:!1,direction:"column"},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiSwitch,{label:Ve,onChange:v,checked:g,compressed:!0,disabled:!d,"data-test-subj":`visEditorIntervalSwitch${e.id}`})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldNumber,{value:g?"":r,min:f,step:m||"any","data-test-subj":`visEditorInterval${e.id}`,isInvalid:i&&!b,onChange:h,onBlur:s,disabled:g,fullWidth:!0,compressed:!0,placeholder:g?Be:Ne}))))},maxBars:function({disabled:e,iconTip:t,value:i,setValue:r,showValidation:s,setValidity:l,setTouched:c}){var d;const{services:u}=Object(o.useKibana)(),g=null===(d=u.uiSettings)||void 0===d?void 0:d.get(v.UI_SETTINGS.HISTOGRAM_MAX_BARS),m=e||void 0===i||""===i||Number(i)>0||i<g;Object(a.useEffect)((()=>{l(m)}),[m,l]);const f=Object(a.useCallback)((e=>r(""===e.target.value?"":parseFloat(e.target.value))),[r]);return Object(p.jsx)(n.EuiFormRow,{label:dt,fullWidth:!0,isInvalid:!!s&&!m,display:"rowCompressed"},Object(p.jsx)(n.EuiFieldNumber,{value:i||"",placeholder:ct,onChange:f,min:1,fullWidth:!0,compressed:!0,max:g,isInvalid:!!s&&!m,onBlur:c,disabled:e,"data-test-subj":"maxBarsParamEditor"}))},min_doc_count:function(e){return Object(p.jsx)(X,d()({displayLabel:g.i18n.translate("visDefaultEditor.controls.showEmptyBucketsLabel",{defaultMessage:"Show empty buckets"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.showEmptyBucketsTooltip",{defaultMessage:"Show all buckets, not only the buckets with results"})},e))},has_extended_bounds:function(e){const{agg:t,setValue:i,value:r}=e,n=Object(a.useRef)(t.params.min_doc_count);return Object(a.useEffect)((()=>{n.current!==t.params.min_doc_count&&(n.current=t.params.min_doc_count,i(r&&t.params.min_doc_count))}),[t.params.min_doc_count,i,r]),Object(p.jsx)(X,d()({},e,{displayLabel:g.i18n.translate("visDefaultEditor.controls.extendedBoundsLabel",{defaultMessage:"Extend bounds"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.extendedBoundsTooltip",{defaultMessage:"Min and Max do not filter the results, but rather extend the bounds of the result set."}),disabled:!e.agg.params.min_doc_count||!(ne("number")(e.agg)||ne("date")(e.agg))}))},extended_bounds:function({value:e={},setValue:t,setValidity:i,showValidation:a,setTouched:r}){const s=g.i18n.translate("visDefaultEditor.controls.extendedBounds.minLabel",{defaultMessage:"Min"}),o=g.i18n.translate("visDefaultEditor.controls.extendedBounds.maxLabel",{defaultMessage:"Max"}),l=function({min:e,max:t}){return""!==e&&""!==t&&t>=e}(e);let c;l||(c=g.i18n.translate("visDefaultEditor.controls.extendedBounds.errorMessage",{defaultMessage:"Min should be less than or equal to Max."})),Object(Q.g)(i,l);const d=(i,a)=>{t({...e,[a]:""===i.target.value?"":parseFloat(i.target.value)})};return Object(p.jsx)(n.EuiFormRow,{fullWidth:!0,isInvalid:!!a&&!l,error:c},Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldNumber,{value:Object(u.isUndefined)(e.min)?"":e.min,onChange:e=>d(e,"min"),onBlur:r,fullWidth:!0,isInvalid:!!a&&!l,"aria-label":s,prepend:s,compressed:!0})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldNumber,{value:Object(u.isUndefined)(e.max)?"":e.max,onChange:e=>d(e,"max"),onBlur:r,fullWidth:!0,isInvalid:!!a&&!l,"aria-label":o,prepend:o,compressed:!0}))))}},[v.BUCKET_TYPES.IP_PREFIX]:{ipPrefix:function({agg:e,value:t={},setTouched:i,setValue:r,setValidity:s,showValidation:o}){const l=function({prefixLength:e,isIpv6:t}){return!(e<0||e>32&&!t||e>128&&t)}(t);let c;l||(c=t.isIpv6?g.i18n.translate("visDefaultEditor.controls.ipPrefix.errorMessageIpv6",{defaultMessage:"Prefix length must be between 0 and 128 for IPv6 addresses."}):g.i18n.translate("visDefaultEditor.controls.ipPrefix.errorMessageIpv4",{defaultMessage:"Prefix length must be between 0 and 32 for IPv4 addresses."})),Object(Q.g)(s,l);const d=Object(a.useCallback)((e=>{r({...t,prefixLength:e.target.valueAsNumber})}),[r,t]),u=Object(a.useCallback)((e=>{r({...t,isIpv6:e.target.checked})}),[r,t]);return Object(p.jsx)(n.EuiFormRow,{fullWidth:!0,display:"rowCompressed",label:we,isInvalid:!!o&&!l,error:c},Object(p.jsx)(n.EuiFlexGroup,{gutterSize:"m",responsive:!1,direction:"column"},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiFieldNumber,{value:t.prefixLength,onChange:d,fullWidth:!0,compressed:!0,onBlur:i,min:0,max:t.isIpv6?128:32,"data-test-subj":"visEditorIpPrefixPrefixLength"})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiSwitch,{checked:t.isIpv6,label:Oe,onChange:u,compressed:!0,"data-test-subj":"visEditorIpPrefixIsIpv6"}))))}},[v.BUCKET_TYPES.IP_RANGE]:{ipRangeType:function({agg:e,value:t,setValue:i}){const a=[{id:`visEditorIpRangeFromToLabel${e.id}`,label:g.i18n.translate("visDefaultEditor.controls.ipRanges.fromToButtonLabel",{defaultMessage:"From/to"})},{id:`visEditorIpRangeCidrLabel${e.id}`,label:g.i18n.translate("visDefaultEditor.controls.ipRanges.cidrMasksButtonLabel",{defaultMessage:"CIDR masks"})}];return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiButtonGroup,{isFullWidth:!0,onChange:e=>{i(e===a[0].id?Me.FROM_TO:Me.MASK)},idSelected:t===Me.FROM_TO?a[0].id:a[1].id,options:a,legend:g.i18n.translate("visDefaultEditor.controls.ipRangesAriaLabel",{defaultMessage:"IP ranges"})}),Object(p.jsx)(n.EuiSpacer,{size:"s"}))},ranges:function({agg:e,value:t={fromTo:[],mask:[]},setTouched:i,setValue:r,setValidity:s,showValidation:o}){const l=Object(a.useCallback)((e=>r({...t,[Me.MASK]:e})),[r,t]),c=Object(a.useCallback)((e=>r({...t,[Me.FROM_TO]:e})),[r,t]);return Object(p.jsx)(n.EuiFormRow,{fullWidth:!0,id:`visEditorIpRange${e.id}`,display:"rowCompressed"},e.params.ipRangeType===Me.MASK?Object(p.jsx)(Ie,{list:t.mask,showValidation:o,onBlur:i,onChange:l,setValidity:s}):Object(p.jsx)(Ae,{list:t.fromTo,showValidation:o,onBlur:i,onChange:c,setValidity:s}))}},[v.BUCKET_TYPES.RANGE]:{ranges:e=>Object(p.jsx)(Ue.a,{value:e.value,setValue:e.setValue})},[v.BUCKET_TYPES.SIGNIFICANT_TERMS]:{size:Ye},[v.BUCKET_TYPES.TERMS]:{include:ye,exclude:ye,orderBy:function({agg:e,value:t,showValidation:i,setValue:a,setValidity:r,setTouched:s,metricAggs:o}){const l=g.i18n.translate("visDefaultEditor.controls.orderAgg.orderByLabel",{defaultMessage:"Order by"}),c=!!t;Object(Q.g)(r,c),K()((()=>{if(!t){let e={id:Ge};o&&(e=o.filter(qe)[0]||e),a(e.id)}})),Object(Q.e)(a,ze,o,t,Ge);const d=Object(Q.d)(ze,o,$e);return Object(p.jsx)(n.EuiFormRow,{label:l,fullWidth:!0,isInvalid:i&&!c,display:"rowCompressed"},Object(p.jsx)(n.EuiSelect,{options:d,value:t,onChange:e=>a(e.target.value),fullWidth:!0,compressed:!0,isInvalid:i&&!c,onBlur:s,"data-test-subj":`visEditorOrderBy${e.id}`}))},orderAgg:function({agg:e,aggParam:t,formIsTouched:i,value:s,metricAggs:o,state:l,setValue:c,setValidity:d,setTouched:u,schemas:g}){const m=e.params.orderBy;Object(a.useEffect)((()=>{"custom"!==m||s||c(t.makeAgg(e)),"custom"!==m&&s&&c(void 0)}),[e,t,m,c,s]);const{onAggTypeChange:f,setAggParamValue:b}=Object(Q.f)(e,t,s,c);return e.params.orderAgg?Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(jt,{agg:s,allowedAggs:t.allowedAggs,hideCustomLabel:!0,groupName:v.AggGroupNames.Metrics,className:"visEditorAgg__subAgg",formIsTouched:i,indexPattern:e.getIndexPattern(),metricAggs:o,state:l,setAggParamValue:b,onAggTypeChange:f,setValidity:d,setTouched:u,schemas:g})):null},order:Object(Q.h)(lt),size:Object(Q.h)(Ye),otherBucket:function(e){return Object(p.jsx)(X,d()({dataTestSubj:"otherBucketSwitch",displayLabel:g.i18n.translate("visDefaultEditor.controls.otherBucket.groupValuesLabel",{defaultMessage:"Group other values in separate bucket"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.otherBucket.groupValuesTooltip",{defaultMessage:"Values not in the top N are grouped in this bucket. To include documents with missing values, enable 'Show missing values'."})},e))},missingBucket:function(e){const t=!v.search.aggs.isStringType(e.agg),{setValue:i}=e;return Object(a.useEffect)((()=>{t&&i(!1)}),[t,i]),Object(p.jsx)(X,d()({},e,{dataTestSubj:"missingBucketSwitch",displayLabel:g.i18n.translate("visDefaultEditor.controls.otherBucket.showMissingValuesLabel",{defaultMessage:"Show missing values"}),displayToolTip:g.i18n.translate("visDefaultEditor.controls.otherBucket.showMissingValuesTooltip",{defaultMessage:'Only works for fields of type "string". When enabled, include documents with missing values in the search. If this bucket is in the top N, it appears in the chart. If not in the top N, and you enable "Group other values in separate bucket", Elasticsearch adds the missing values to the "other" bucket.'}),disabled:t}))}}},mt={[v.METRIC_TYPES.TOP_HITS]:{field:function(e){const t=st(e.agg);let i;return e.value&&!t.length&&(i=g.i18n.translate("visDefaultEditor.controls.aggregateWith.noAggsErrorTooltip",{defaultMessage:"The chosen field has no compatible aggregations."})),Object(p.jsx)(ee,d()({},e,{customError:i}))},aggregate:Object(Q.h)((function({agg:e,aggParam:t,value:i,showValidation:s,setValue:o,setValidity:l,setTouched:c}){const d=Object(a.useRef)(!0),u=e.params.field&&e.params.field.type,m={text:"",value:"EMPTY_VALUE",disabled:!0,hidden:!0},b=st(e).map((({text:e,value:t})=>({text:e,value:t}))).sort(((e,t)=>e.text.toLowerCase().localeCompare(t.text.toLowerCase()))),h=[m,...b],v=u&&!b.length,j=v||!!i,x=Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.aggregateWithLabel",defaultMessage:"Aggregate with"})," ",Object(p.jsx)(n.EuiIconTip,{position:"right",type:"questionInCircle",content:g.i18n.translate("visDefaultEditor.controls.aggregateWithTooltip",{defaultMessage:"Choose a strategy for combining multiple hits or a multi-valued field into a single metric."})}));return Object(a.useEffect)((()=>{l(j)}),[j,l]),Object(a.useEffect)((()=>{if(d.current)d.current=!1;else{if(i){if(t.options.find((e=>e.value===i.value)))return;o()}1===b.length&&o(t.options.find((e=>e.value===b[0].value)))}}),[t.options,u,b,o,i]),Object(p.jsx)(n.EuiFormRow,{label:x,fullWidth:!0,isInvalid:!!s&&!j,display:"rowCompressed"},Object(p.jsx)(n.EuiSelect,{options:h,value:i?i.value:m.value,onChange:e=>{e.target.value===m.value?o():o(t.options.find((t=>t.value===e.target.value)))},fullWidth:!0,compressed:!0,isInvalid:!!s&&!j,disabled:v,onBlur:c,"data-test-subj":"visDefaultEditorAggregateWith"}))})),size:Object(Q.h)((function(e){const t=Object(p.jsx)(r.a.Fragment,null," ",Object(p.jsx)(n.EuiIconTip,{position:"right",content:g.i18n.translate("visDefaultEditor.controls.sizeTooltip",{defaultMessage:"Request top-K hits. Multiple hits will be combined via 'aggregate with'."}),type:"questionInCircle"})),i=e.agg.params.field&&e.agg.params.field.type&&!st(e.agg).length;return Object(p.jsx)(Ye,d()({},e,{iconTip:t,disabled:i}))})),sortField:ot,sortOrder:lt},[v.METRIC_TYPES.TOP_METRICS]:{field:ee,sortField:ot,sortOrder:lt},[v.METRIC_TYPES.PERCENTILES]:{percents:function({agg:e,showValidation:t,value:i=[],setTouched:r,setValidity:s,setValue:o}){const l=g.i18n.translate("visDefaultEditor.controls.percentiles.percentsLabel",{defaultMessage:"Percents"}),[c,d]=Object(a.useState)(!0),u=Object(a.useCallback)((e=>{d(e),s(e)}),[s]);return Object(p.jsx)(n.EuiFormRow,{label:l,labelType:"legend",fullWidth:!0,id:`visEditorPercentileLabel${e.id}`,isInvalid:!!t&&!c,display:"rowCompressed","data-test-subj":"visEditorPercentile"},Object(p.jsx)(We,{labelledbyId:`visEditorPercentileLabel${e.id}-legend`,numberArray:i,range:"[0,100]",disallowDuplicates:!0,unitName:g.i18n.translate("visDefaultEditor.controls.percentileRanks.percentUnitNameText",{defaultMessage:"percent"}),showValidation:t,onChange:o,setTouched:r,setValidity:u}))}},[v.METRIC_TYPES.PERCENTILE_RANKS]:{values:function({agg:e,showValidation:t,value:i=[],setTouched:r,setValidity:s,setValue:o}){const l=g.i18n.translate("visDefaultEditor.controls.percentileRanks.valuesLabel",{defaultMessage:"Values"}),[c,d]=Object(a.useState)(!0),u=Object(a.useCallback)((e=>{d(e),s(e)}),[s]);return Object(p.jsx)(n.EuiFormRow,{label:l,labelType:"legend",fullWidth:!0,id:`visEditorPercentileRanksLabel${e.id}`,isInvalid:!!t&&!c,display:"rowCompressed","data-test-subj":"visEditorPercentileRanks"},Object(p.jsx)(We,{labelledbyId:`visEditorPercentileRanksLabel${e.id}-legend`,numberArray:i,range:"[-Infinity,Infinity]",unitName:g.i18n.translate("visDefaultEditor.controls.percentileRanks.valueUnitNameText",{defaultMessage:"value"}),validateAscendingOrder:!0,showValidation:t,onChange:o,setTouched:r,setValidity:u}))}}},ft={common:{string:se,json:function({showValidation:e,value:t="",setValidity:i,setValue:s,setTouched:o}){const[l,c]=Object(a.useState)(!0),d=Object(a.useMemo)((()=>g.i18n.translate("visDefaultEditor.controls.jsonInputTooltip",{defaultMessage:"Any JSON formatted properties you add here will be merged with the elasticsearch aggregation definition for this section. For example 'shard_size' on a terms aggregation."})),[]),u=Object(a.useMemo)((()=>g.i18n.translate("visDefaultEditor.controls.jsonInputLabel",{defaultMessage:"JSON input"})),[]),m=Object(a.useMemo)((()=>Object(p.jsx)(r.a.Fragment,null,u," ",Object(p.jsx)(n.EuiIconTip,{position:"right",content:d,type:"questionInCircle"}))),[u,d]),f=Object(a.useCallback)((e=>{s(e);let t=!0;try{e&&JSON.parse(Je.XJson.collapseLiteralStrings(e))}catch(e){t=!1}c(t),i(t)}),[i,c,s]);return Object(p.jsx)(n.EuiFormRow,{label:m,isInvalid:!!e&&!l,fullWidth:!0,display:"rowCompressed",onBlur:o},Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(Ke.CodeEditor,{"aria-label":u,"aria-describedby":"jsonEditorDescription",languageId:He.XJsonLang.ID,languageConfiguration:{autoClosingPairs:[{open:"{",close:"}"}]},width:"100%",height:"250px",value:t,onChange:f,options:{renderValidationDecorations:t?"on":"off",lineNumbers:"on",fontSize:14,minimap:{enabled:!1},scrollBeyondLastLine:!1,folding:!0,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0}})))},field:ee},[ut]:{customBucket:Xe,customMetric:Xe},[gt]:{metricAgg:function({agg:e,value:t,showValidation:i,setValue:r,setValidity:s,setTouched:o,metricAggs:l=[]}){const c=g.i18n.translate("visDefaultEditor.controls.metricLabel",{defaultMessage:"Metric"}),d=!!t;Object(Q.g)(s,d),Object(Q.e)(r,Re,l,t);const u=Object(a.useMemo)((()=>l.filter((t=>t.type.name!==e.type.name))),[l,e.type.name]),m=Object(Q.d)(Re,u,Pe),f=Object(a.useCallback)((e=>r(e.target.value)),[r]);return Object(p.jsx)(n.EuiFormRow,{label:c,fullWidth:!0,isInvalid:i&&!d,display:"rowCompressed"},Object(p.jsx)(n.EuiSelect,{compressed:!0,fullWidth:!0,options:m,value:t||Le,onChange:f,isInvalid:i&&!d,onBlur:o,"data-test-subj":`visEditorSubAggMetric${e.id}`}))},customMetric:function({agg:e,aggParam:t,formIsTouched:i,metricAggs:s,state:o,setValue:l,setValidity:c,setTouched:d,schemas:u}){Object(a.useEffect)((()=>{"custom"!==e.params.metricAgg?l(void 0):e.params.customMetric||l(t.makeAgg(e))}),[s,e,l,t]);const{onAggTypeChange:g,setAggParamValue:m}=Object(Q.f)(e,t,e.params.customMetric,l);return"custom"===e.params.metricAgg&&e.params.customMetric?Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(jt,{agg:e.params.customMetric,allowedAggs:t.allowedAggs,groupName:v.AggGroupNames.Metrics,className:"visEditorAgg__subAgg",formIsTouched:i,indexPattern:e.getIndexPattern(),metricAggs:s,state:o,setAggParamValue:m,onAggTypeChange:g,setValidity:c,setTouched:d,schemas:u,hideCustomLabel:!0})):null}},[v.AggGroupNames.Buckets]:pt,[v.AggGroupNames.Metrics]:mt};function bt(e){let t="";if(e.type&&e.type.makeLabel)try{t=e.type.makeLabel(e)}catch(e){}return t}const ht="fixedValue",vt="default";function jt({agg:e,aggError:t,aggIndex:i=0,aggIsTooLow:s=!1,className:l,disabledParams:c,groupName:m,formIsTouched:f,indexPattern:b,metricAggs:h,state:j,setAggParamValue:E,onAggTypeChange:y,setTouched:w,setValidity:O,schemas:_,allowedAggs:S=[],hideCustomLabel:T=!1}){var k,A,C;const I=Object(a.useMemo)((()=>x(_,e.schema)),[e.schema,_]),R=Object(a.useMemo)((()=>[...S,...I.aggFilter||[]]),[S,I.aggFilter]),{services:V}=Object(o.useKibana)(),z=Object(a.useMemo)((()=>V.data.search.aggs.types.getAll()),[V.data.search.aggs.types]),W=Object(a.useMemo)((()=>function(e,t,i,a,r){const n=function(e,t,i,a){return e.filter((e=>G.every((r=>r(e,t,i,a)))))}(e[a],i,t,r);return Object(q.a)(n,"subtype","title")}(z,e,b,m,R)),[z,e,b,m,R]),U=s?g.i18n.translate("visDefaultEditor.aggParams.errors.aggWrongRunOrderErrorMessage",{defaultMessage:'"{schema}" aggs must run before all other buckets!',values:{schema:I.title}}):"",H=null===(k=e.type)||void 0===k?void 0:k.name,K=null===(A=e.params)||void 0===A||null===(C=A.field)||void 0===C?void 0:C.name,J=Object(a.useMemo)((()=>function(e,t,i){const a=e.getAggregationRestrictions();if(!a||!t||!i)return{};if("terms"===t)return{otherBucket:{hidden:!0},missingBucket:{hidden:!0}};const r=a[t]&&a[t][i];if(!r)return{};if("histogram"===t){const e=r.interval;return e?{intervalBase:{fixedValue:e},interval:{base:e,help:g.i18n.translate("visDefaultEditor.editorConfig.histogram.interval.helpText",{defaultMessage:"Must be a multiple of configuration interval: {interval}",values:{interval:e}})}}:{}}if("date_histogram"===t){const e=r.calendar_interval||r.fixed_interval;return{useNormalizedEsInterval:{fixedValue:!1},interval:{default:e,timeBase:e,help:g.i18n.translate("visDefaultEditor.editorConfig.dateHistogram.customInterval.helpText",{defaultMessage:"Must be a multiple of configuration interval: {interval}",values:{interval:e}})}}}return{}}(b,H,K)),[b,H,K]),Y=Object(a.useMemo)((()=>function({agg:e,editorConfig:t,metricAggs:i,state:a,schemas:r,hideCustomLabel:n}){const s={basic:[],advanced:[]},o=e.type&&e.type.params.filter((e=>!Object(u.get)(t,[e.name,"hidden"],!1)))||[],l=x(r,e.schema);return o.forEach(((o,c)=>{let d,g=[];if(n&&"customLabel"===o.name)return;if("timeShift"===o.name)return;if("field"===o.type){let t=o.getAvailableFields(e);if("top_hits"===e.type.name&&"field"===o.name&&(Object(u.get)(l,`aggSettings[${e.type.name}].allowStrings`,!1)||(t=t.filter((e=>"number"===e.type)))),d=function(e,t){return e.filter((e=>$.every((i=>i(e,t)))))}(t,e),g=Object(q.a)(d,"type","displayName","name"),d&&!g.length&&c>0)return}const p=o.advanced?"advanced":"basic";let m;if(e.type.subtype&&ft[e.type.subtype])m=Object(u.get)(ft,[e.type.subtype,o.name]);else{const t=e.type.type,i=e.type.name,a=Object(u.get)(ft,[t,i],{});m=Object(u.get)(a,o.name)}m||(m=Object(u.get)(ft,["common",o.type])),m&&s[p].push({agg:e,aggParam:o,editorConfig:t,indexedFields:g,paramEditor:m,metricAggs:i,state:a,value:e.params[o.name],schemas:r,hideCustomLabel:n})})),s}({agg:e,editorConfig:J,metricAggs:h,state:j,schemas:_,hideCustomLabel:T})),[e,J,h,j,_,T]),X=[...Y.basic,...Y.advanced],[Q,Z]=Object(a.useReducer)(D,X,F),[ee,te]=Object(a.useReducer)(L,{touched:!1,valid:!0}),ie=!U&&ee.valid&&Object.entries(Q).every((([,e])=>e.valid)),ae=!!U||function(e,t,i){if(!e)return t.touched;const a=Object.values(i).filter((e=>!e.valid));return!Object(u.isEmpty)(a)&&a.every((e=>e.touched))}(e.type,ee,Q),re=Object(a.useCallback)((t=>{e.type!==t&&(y(e.id,t),Z({type:P.RESET}))}),[y,e]);return M()((()=>O(!0))),Object(a.useEffect)((()=>{Object.entries(J).forEach((([t,i])=>{const a=e.type.params.find((e=>e.name===t)),r=i.hasOwnProperty(ht),n=i.hasOwnProperty(vt);if(r||n){let r,s=ht,o=i;n&&(s=vt,o=i),r=a&&a.deserialize?a.deserialize(o[s]):o[s],e.params[t]!==r&&E(e.id,t,r)}}))}),[J]),Object(a.useEffect)((()=>{w(!1)}),[e.type,w]),Object(a.useEffect)((()=>{O(ie)}),[ie,e.type,O]),Object(a.useEffect)((()=>{w(ae)}),[ae,w]),Object(p.jsx)(n.EuiForm,{className:l,isInvalid:!!U,error:U,"data-test-subj":"visAggEditorParams"},Object(p.jsx)(N,{aggError:t,id:e.id,indexPattern:b,value:e.type,aggTypeOptions:W,isSubAggregation:i>=1&&m===v.AggGroupNames.Buckets,showValidation:f||ee.touched,setValue:re,onChangeAggType:te}),Y.basic.map((t=>{const i=Q[t.aggParam.name]||{touched:!1,valid:!0};return Object(p.jsx)(B,d()({key:`${t.aggParam.name}${e.type?e.type.name:""}`,disabled:c&&c.includes(t.aggParam.name),formIsTouched:f,showValidation:f||i.touched,setAggParamValue:E,onChangeParamsState:Z},t))})),Y.advanced.length?Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),Object(p.jsx)(n.EuiAccordion,{id:"advancedAccordion","data-test-subj":`advancedParams-${e.id}`,buttonContent:g.i18n.translate("visDefaultEditor.advancedToggle.advancedLinkLabel",{defaultMessage:"Advanced"})},Object(p.jsx)(n.EuiSpacer,{size:"s"}),Y.advanced.map((t=>{const i=Q[t.aggParam.name]||{touched:!1,valid:!0};return Object(p.jsx)(B,d()({key:`${t.aggParam.name}${e.type?e.type.name:""}`,disabled:c&&c.includes(t.aggParam.name),formIsTouched:f,showValidation:f||i.touched,setAggParamValue:E,onChangeParamsState:Z},t))})))):null)}let xt=function(e){return e.TOUCHED="aggsTouched",e.VALID="aggsValid",e}({});function Et(e,t){const i=e[t.aggId]||{touched:!1,valid:!0};switch(t.type){case xt.TOUCHED:return{...e,[t.aggId]:{...i,touched:t.payload}};case xt.VALID:return{...e,[t.aggId]:{...i,valid:t.payload}};default:throw new Error}}function yt(e){return e.reduce(((e,t)=>(e[t.id]={touched:!1,valid:!0},e)),{})}const wt={NAME:"row",ROWS:"visEditorSplitBy__true",COLUMNS:"visEditorSplitBy__false"};function Ot({editorStateParams:e,setStateParamValue:t}){void 0===e.row&&t(wt.NAME,!0);const i=`visEditorSplitBy__${e.row}`,s=[{id:wt.ROWS,label:g.i18n.translate("visDefaultEditor.controls.rowsLabel",{defaultMessage:"Rows"}),"data-test-subj":"visEditorSplitBy-Rows"},{id:wt.COLUMNS,label:g.i18n.translate("visDefaultEditor.controls.columnsLabel",{defaultMessage:"Columns"}),"data-test-subj":"visEditorSplitBy-Columns"}],o=Object(a.useCallback)((e=>t(wt.NAME,e===wt.ROWS)),[t]);return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiFormRow,{display:"rowCompressed",fullWidth:!0},Object(p.jsx)(n.EuiButtonGroup,{"data-test-subj":"visEditorSplitBy",legend:g.i18n.translate("visDefaultEditor.controls.splitByLegend",{defaultMessage:"Split chart by rows or columns."}),options:s,isFullWidth:!0,idSelected:i,onChange:o})),Object(p.jsx)(n.EuiSpacer,{size:"m"}))}const _t=50,St="radiusRatio";function Tt({editorStateParams:e,setStateParamValue:t}){const i=Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.controls.dotSizeRatioLabel",defaultMessage:"Dot size ratio"})," ",Object(p.jsx)(n.EuiIconTip,{content:g.i18n.translate("visDefaultEditor.controls.dotSizeRatioHelpText",{defaultMessage:"Change the ratio of the radius of the smallest point to the largest point."}),position:"right"}));K()((()=>{e.radiusRatio||t(St,_t)}));const s=Object(a.useCallback)((e=>t(St,parseFloat(e.currentTarget.value))),[t]);return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiFormRow,{fullWidth:!0,label:i,display:"rowCompressed"},Object(p.jsx)(n.EuiRange,{compressed:!0,fullWidth:!0,min:1,max:100,value:e.radiusRatio||_t,onChange:s,showRange:!0,showValue:!0,valueAppend:"%"})),Object(p.jsx)(n.EuiSpacer,{size:"m"}))}function kt({agg:e,aggIndex:t,aggIsTooLow:i,dragHandleProps:s,formIsTouched:o,groupName:l,isDisabled:c,isDraggable:u,isLastBucket:m,isRemovable:f,metricAggs:b,lastParentPipelineAggTitle:h,state:v,setAggParamValue:j,setStateParamValue:E,onAggTypeChange:y,onToggleEnableAgg:w,removeAgg:O,setAggsState:_,schemas:S,timeRange:T}){var k;const[A,C]=Object(a.useState)(e.brandNew),[I,M]=Object(a.useState)(!0),R=!A&&I,L=!A&&!I,P=null===(k=e.type)||void 0===k?void 0:k.name,D=x(S,e.schema).title;let F,N;const B=m&&h&&e.type;let V;"split"===e.schema&&(V=Ot),"radius"===e.schema&&(V=Tt),B&&(["date_histogram","histogram"].includes(P)?F=["min_doc_count"]:N=g.i18n.translate("visDefaultEditor.metrics.wrongLastBucketTypeErrorMessage",{defaultMessage:'Last bucket aggregation must be "Date Histogram" or "Histogram" when using "{type}" metric aggregation.',values:{type:h},description:"Date Histogram and Histogram should not be translated"}));const[z,G]=Object(a.useState)(bt(e));Object(a.useEffect)((()=>{T&&"date_histogram"===P&&e.aggConfigs.setTimeRange(T),G(bt(e))}),[e,P,T]),Object(a.useEffect)((()=>{B&&["date_histogram","histogram"].includes(P)&&j(e.id,"min_doc_count","histogram"===P||0)}),[P,B,e.id,j]);const $=Object(a.useCallback)((t=>{_({type:xt.TOUCHED,payload:t,aggId:e.id})}),[e.id,_]),q=Object(a.useCallback)((t=>{_({type:xt.VALID,payload:t,aggId:e.id}),M(t)}),[e.id,_]),W=Object(a.useCallback)((e=>{C(e),e||$(!0)}),[$]),U=Object(p.jsx)(r.a.Fragment,null,D||e.schema," ",R&&Object(p.jsx)("span",null,z));return Object(p.jsx)(n.EuiAccordion,{id:`visEditorAggAccordion${e.id}`,initialIsOpen:A,buttonContent:U,buttonClassName:"eui-textTruncate",buttonContentClassName:"visEditorSidebar__aggGroupAccordionButtonContent eui-textTruncate",className:"visEditorSidebar__section visEditorSidebar__collapsible visEditorSidebar__collapsible--marginBottom","aria-label":g.i18n.translate("visDefaultEditor.agg.toggleEditorButtonAriaLabel",{defaultMessage:"Toggle {schema} editor",values:{schema:D||e.schema}}),"data-test-subj":`visEditorAggAccordion${e.id}`,extraAction:(()=>{var t,i;const a=[],o=null===(t=e.type)||void 0===t||null===(i=t.title)||void 0===i?void 0:i.toLowerCase();return L&&a.push({id:"hasErrors",color:"danger",type:"error",tooltip:g.i18n.translate("visDefaultEditor.agg.errorsAriaLabel",{defaultMessage:"{schemaTitle} {aggTitle} aggregation has errors",values:{aggTitle:o,schemaTitle:D}}),dataTestSubj:"hasErrorsAggregationIcon"}),e.enabled&&f&&a.push({id:"disableAggregation",color:"text",disabled:c,type:"eye",onClick:()=>w(e.id,!1),tooltip:g.i18n.translate("visDefaultEditor.agg.disableAggButtonTooltip",{defaultMessage:"Disable {schemaTitle} {aggTitle} aggregation",values:{aggTitle:o,schemaTitle:D}}),dataTestSubj:"toggleDisableAggregationBtn disable"}),e.enabled||a.push({id:"enableAggregation",color:"text",type:"eyeClosed",onClick:()=>w(e.id,!0),tooltip:g.i18n.translate("visDefaultEditor.agg.enableAggButtonTooltip",{defaultMessage:"Enable {schemaTitle} {aggTitle} aggregation",values:{aggTitle:o,schemaTitle:D}}),dataTestSubj:"toggleDisableAggregationBtn enable"}),u&&a.push({id:"dragHandle",color:"text",type:"grab",tooltip:g.i18n.translate("visDefaultEditor.agg.modifyPriorityButtonTooltip",{defaultMessage:"Modify priority of {schemaTitle} {aggTitle} by dragging",values:{aggTitle:o,schemaTitle:D}}),dataTestSubj:"dragHandleBtn"}),f&&a.push({id:"removeDimension",color:"danger",type:"cross",onClick:()=>O(e.id),tooltip:g.i18n.translate("visDefaultEditor.agg.removeDimensionButtonTooltip",{defaultMessage:"Remove {schemaTitle} {aggTitle} aggregation",values:{aggTitle:o,schemaTitle:D}}),dataTestSubj:"removeDimensionBtn"}),a.length?Object(p.jsx)(r.a.Fragment,null,a.map((e=>Object(p.jsx)(n.EuiToolTip,{key:e.id,position:"bottom",content:e.tooltip},Object(p.jsx)(n.EuiButtonIcon,d()({disabled:e.disabled,iconType:e.type,color:e.color,onClick:e.onClick,"aria-label":e.tooltip,"data-test-subj":e.dataTestSubj},"dragHandle"===e.id?s:{})))))):null})(),onToggle:W},Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiSpacer,{size:"m"}),V&&Object(p.jsx)(V,{agg:e,editorStateParams:v.params,setAggParamValue:j,setStateParamValue:E}),Object(p.jsx)(jt,{agg:e,aggError:N,aggIndex:t,aggIsTooLow:i,disabledParams:F,formIsTouched:o,groupName:l,indexPattern:e.getIndexPattern(),metricAggs:b,state:v,setAggParamValue:j,onAggTypeChange:y,setTouched:$,setValidity:q,schemas:S})))}function At({group:e=[],groupName:t,schemas:i,addSchema:r,stats:s}){const[o,l]=Object(a.useState)(!1),c=t===v.AggGroupNames.Buckets?g.i18n.translate("visDefaultEditor.aggAdd.bucketLabel",{defaultMessage:"bucket"}):g.i18n.translate("visDefaultEditor.aggAdd.metricLabel",{defaultMessage:"metric"}),d=Object(p.jsx)(n.EuiButtonEmpty,{size:"s",iconType:"plusInCircleFilled","data-test-subj":`visEditorAdd_${t}`,onClick:()=>l(!o),"aria-label":g.i18n.translate("visDefaultEditor.aggAdd.addGroupButtonLabel",{defaultMessage:"Add {groupNameLabel}",values:{groupNameLabel:c}})},Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggAdd.addButtonLabel",defaultMessage:"Add"})),u=(e,t)=>{var i;return null!==(i=e.disabled)&&void 0!==i?i:t},m=g.i18n.translate("visDefaultEditor.aggAdd.maxBuckets",{defaultMessage:"Max {groupNameLabel} count reached",values:{groupNameLabel:c}});return Object(p.jsx)(n.EuiFlexGroup,{justifyContent:"center",responsive:!1},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiPopover,{id:`addGroupButtonPopover_${t}`,button:d,isOpen:o,panelPaddingSize:"none",repositionOnScroll:!0,closePopover:()=>l(!1)},Object(p.jsx)(n.EuiPopoverTitle,{paddingSize:"s"},(t!==v.AggGroupNames.Buckets||!s.count)&&Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggAdd.addGroupButtonLabel",defaultMessage:"Add {groupNameLabel}",values:{groupNameLabel:c}}),t===v.AggGroupNames.Buckets&&s.count>0&&Object(p.jsx)(f.FormattedMessage,{id:"visDefaultEditor.aggAdd.addSubGroupButtonLabel",defaultMessage:"Add sub-{groupNameLabel}",values:{groupNameLabel:c}})),Object(p.jsx)(n.EuiContextMenuPanel,{items:i.map((i=>{var a;const s=(t=>e.filter((e=>e.schema===t.name)).length>=t.max)(i);return Object(p.jsx)(n.EuiContextMenuItem,{key:`${i.name}_${i.title}`,"data-test-subj":`visEditorAdd_${t}_${i.title}`,disabled:o&&u(i,s),onClick:()=>(e=>{l(!1),r(e)})(i),toolTipContent:null!==(a=i.tooltip)&&void 0!==a?a:s?m:void 0},i.title)}))}))))}function Ct({formIsTouched:e,groupName:t,lastParentPipelineAggTitle:i,metricAggs:s,state:o,schemas:l=[],addSchema:c,setAggParamValue:d,setStateParamValue:m,onAggTypeChange:f,onToggleEnableAgg:b,removeAgg:h,reorderAggs:j,setTouched:x,setValidity:O,timeRange:_}){const S=v.AggGroupLabels[t],T=l.map((e=>e.name)),k=Object(a.useMemo)((()=>{var e;return(null===(e=o.data.aggs)||void 0===e?void 0:e.aggs.filter((e=>e.schema&&T.includes(e.schema))))||[]}),[o.data.aggs,T]),A={max:0,count:k.length};l.forEach((e=>{A.max+=e.max}));const[C,I]=Object(a.useReducer)(Et,k,yt),M=i&&t===v.AggGroupNames.Buckets&&!k.length?g.i18n.translate("visDefaultEditor.buckets.mustHaveBucketErrorMessage",{defaultMessage:'Add a bucket with "Date Histogram" or "Histogram" aggregation.',description:"Date Histogram and Histogram should not be translated"}):void 0,R=!M&&Object.values(C).every((e=>e.valid)),L=function(e){const t=Object.values(e).filter((e=>!e.valid));return!Object(u.isEmpty)(t)&&t.every((e=>e.touched))}(C),P=Object(a.useMemo)((()=>t===v.AggGroupNames.Metrics&&1===y(k)),[t,k]);Object(a.useEffect)((()=>{x(L)}),[L,x]),Object(a.useEffect)((()=>{e&&!L&&Object.keys(C).map((([e])=>{I({type:xt.TOUCHED,payload:!0,aggId:e})}))}),[e]),Object(a.useEffect)((()=>{O(`aggGroup__${t}`,R)}),[t,R,O]);const D=Object(a.useCallback)((({source:e,destination:t})=>{e&&t&&j(k[e.index],k[t.index])}),[j,k]);return Object(p.jsx)(n.EuiDragDropContext,{onDragEnd:D},Object(p.jsx)(n.EuiPanel,{"data-test-subj":`${t}AggGroup`,paddingSize:"s"},Object(p.jsx)(n.EuiTitle,{size:"xs"},Object(p.jsx)("h3",null,S)),Object(p.jsx)(n.EuiSpacer,{size:"s"}),M&&Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiFormErrorText,{"data-test-subj":"bucketsError"},M),Object(p.jsx)(n.EuiSpacer,{size:"s"})),Object(p.jsx)(n.EuiDroppable,{droppableId:`agg_group_dnd_${t}`,className:"visEditorSidebar__collapsible--marginBottom"},Object(p.jsx)(r.a.Fragment,null,k.map(((e,a)=>Object(p.jsx)(n.EuiDraggable,{key:e.id,index:a,draggableId:`agg_group_dnd_${t}_${e.id}`,customDragHandle:!0,disableInteractiveElementBlocking:!0},(r=>Object(p.jsx)(kt,{agg:e,aggIndex:a,aggIsTooLow:w(e,a,k,l),dragHandleProps:r.dragHandleProps||null,formIsTouched:!!C[e.id]&&C[e.id].touched,groupName:t,isDraggable:A.count>1,isLastBucket:t===v.AggGroupNames.Buckets&&a===k.length-1,isRemovable:E(e,k,l),isDisabled:"metric"===e.schema&&P,lastParentPipelineAggTitle:i,metricAggs:s,state:o,setAggParamValue:d,setStateParamValue:m,onAggTypeChange:f,onToggleEnableAgg:b,removeAgg:h,setAggsState:I,schemas:l,timeRange:_}))))))),A.max>A.count&&Object(p.jsx)(At,{group:k,groupName:t,schemas:l,stats:A,addSchema:c})))}function It({dispatch:e,formIsTouched:t,metricAggs:i,schemas:s,state:o,setTouched:l,setValidity:c,setStateValue:g,timeRange:m}){const f=Object(a.useMemo)((()=>Object(u.findLast)(i,(({type:e})=>e.subtype===v.search.aggs.parentPipelineType))),[i]),b=f&&f.type.title,h=Object(a.useCallback)((t=>e((e=>({type:j.ADD_NEW_AGG,payload:{schema:e}}))(t))),[e]),x=Object(a.useCallback)((t=>e(((e,t)=>({type:j.REMOVE_AGG,payload:{aggId:e,schemas:t}}))(t,s.all||[]))),[e,s]),E=Object(a.useCallback)(((...t)=>e(((e,t)=>({type:j.REORDER_AGGS,payload:{sourceAgg:e,destinationAgg:t}}))(...t))),[e]),y=Object(a.useCallback)(((...t)=>e(((e,t,i)=>({type:j.SET_AGG_PARAM_VALUE,payload:{aggId:e,paramName:t,value:i}}))(...t))),[e]),w=Object(a.useCallback)(((...t)=>e(((e,t)=>({type:j.CHANGE_AGG_TYPE,payload:{aggId:e,value:t}}))(...t))),[e]),O=Object(a.useCallback)(((...t)=>e(((e,t)=>({type:j.TOGGLE_ENABLED_AGG,payload:{aggId:e,enabled:t}}))(...t))),[e]),_={addSchema:h,formIsTouched:t,lastParentPipelineAggTitle:b,metricAggs:i,state:o,reorderAggs:E,setAggParamValue:y,setStateParamValue:g,onAggTypeChange:w,onToggleEnableAgg:O,setValidity:c,setTouched:l,removeAgg:x};return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(Ct,d()({groupName:v.AggGroupNames.Metrics,schemas:s.metrics},_)),Object(p.jsx)(n.EuiSpacer,{size:"s"}),Object(p.jsx)(Ct,d()({groupName:v.AggGroupNames.Buckets,schemas:s.buckets,timeRange:m},_)))}function Mt({embeddableHandler:e,isCollapsed:t,onClickCollapse:i,uiState:s,vis:l,isLinkedSearch:c,eventEmitter:f,savedSearch:b,timeRange:h}){const[x,E]=Object(a.useState)(!1),[w,k]=function(e,t){const{services:i}=Object(o.useKibana)(),[r,n]=Object(a.useReducer)((({aggs:{createAggConfigs:e}})=>(t,i)=>{switch(i.type){case j.ADD_NEW_AGG:{const{schema:a}=i.payload,r=!t.data.aggs.aggs.find((e=>e.schema===a.name))&&a.defaults?a.defaults.slice(0,a.max):{schema:a.name},n=t.data.aggs.createAggConfig(r,{addToAggConfigs:!1});n.brandNew=!0;const s=[...t.data.aggs.aggs,n];return{...t,data:{...t.data,aggs:e(t.data.indexPattern,s)}}}case j.DISCARD_CHANGES:return O(i.payload.vis);case j.CHANGE_AGG_TYPE:{const{aggId:a,value:r}=i.payload,n=t.data.aggs.aggs.map((e=>e.id===a?(e.type=r,e.serialize()):e));return{...t,data:{...t.data,aggs:e(t.data.indexPattern,n)}}}case j.SET_AGG_PARAM_VALUE:{const{aggId:a,paramName:r,value:n}=i.payload,s=t.data.aggs.aggs.map((e=>{if(e.id===a){const t=e.serialize();return{...t,params:{...t.params,[r]:n}}}return e}));return{...t,data:{...t.data,aggs:e(t.data.indexPattern,s)}}}case j.SET_STATE_PARAM_VALUE:{const{paramName:e,value:a}=i.payload;return{...t,params:{...t.params,[e]:a}}}case j.REMOVE_AGG:{let a=!1;const r=t.data.aggs.aggs.filter((({id:e,schema:t})=>{if(e===i.payload.aggId){const e=i.payload.schemas.find((e=>e.name===t));return e&&e.group===v.AggGroupNames.Metrics&&(a=!0),!1}return!0}));if(a&&0===y(r)){const e=r.find((e=>"metric"===e.schema));e&&(e.enabled=!0)}return{...t,data:{...t.data,aggs:e(t.data.indexPattern,r)}}}case j.REORDER_AGGS:{const{sourceAgg:a,destinationAgg:r}=i.payload,n=t.data.aggs.aggs.indexOf(r),s=[...t.data.aggs.aggs];return s.splice(n,0,s.splice(t.data.aggs.aggs.indexOf(a),1)[0]),{...t,data:{...t.data,aggs:e(t.data.indexPattern,s)}}}case j.TOGGLE_ENABLED_AGG:{const{aggId:a,enabled:r}=i.payload,n=t.data.aggs.aggs.map((e=>e.id===a?{...e.serialize(),enabled:r}:e));return{...t,data:{...t.data,aggs:e(t.data.indexPattern,n)}}}case j.UPDATE_STATE_PARAMS:{const{params:e}=i.payload;return{...t,params:Object(u.cloneDeep)(e)}}}})(i.data.search),e,O);return[r,Object(a.useCallback)((e=>{n(e),t.emit("dirtyStateChange",{isDirty:e.type!==j.DISCARD_CHANGES})}),[t])]}(l,f),{formState:A,setTouched:I,setValidity:M,resetValidity:R}=function(){const[e,t]=Object(a.useState)(_),i=Object(a.useCallback)(((e,i)=>{t((t=>{const a={...t.validity,[e]:i};return{...t,validity:a,invalid:Object.values(a).some((e=>!e))}}))}),[]),r=Object(a.useCallback)((()=>{t(_)}),[]);return{formState:e,setValidity:i,setTouched:Object(a.useCallback)((e=>{t((t=>({...t,touched:e})))}),[]),resetValidity:r}}(),[L,P]=(({type:e})=>{const[t,i]=Object(a.useState)((()=>{var t,i;const a=[...null!==(t=e.schemas.buckets)&&void 0!==t&&t.length||null!==(i=e.schemas.metrics)&&void 0!==i&&i.length?[{name:"data",title:g.i18n.translate("visDefaultEditor.sidebar.tabs.dataLabel",{defaultMessage:"Data"}),editor:It}]:[],...!e.editorConfig.optionTabs&&e.editorConfig.optionsTemplate?[{name:"options",title:g.i18n.translate("visDefaultEditor.sidebar.tabs.optionsLabel",{defaultMessage:"Options"}),editor:e.editorConfig.optionsTemplate}]:e.editorConfig.optionTabs];return a[0].isSelected=!0,a}));return[t,Object(a.useCallback)((e=>{i((t=>t.map((t=>({...t,isSelected:t.name===e})))))}),[])]})(l),D=Object(a.useMemo)((()=>w.data.aggs?w.data.aggs.getResponseAggs():[]),[w.data.aggs]),F=(l.type.schemas.metrics||[]).map((e=>e.name)),N=Object(a.useMemo)((()=>D.filter((e=>e.schema&&F.includes(e.schema)))),[D,F]),B=Object(a.useMemo)((()=>D.some((e=>"histogram"===e.type.name))),[D]),V=Object(a.useCallback)((e=>{M("visOptions",e)}),[M]),z=Object(a.useCallback)(((e,t)=>{!Object(u.isEqual)(w.params[e],t)&&k(((e,t)=>({type:j.SET_STATE_PARAM_VALUE,payload:{paramName:e,value:t}}))(e,t))}),[k,w.params]),G=Object(a.useCallback)((()=>{!A.invalid&&x?(l.setState({...l.serialize(),params:w.params,data:{aggs:w.data.aggs?w.data.aggs.aggs.map((e=>e.serialize())):[]}}),e.reload(),f.emit("dirtyStateChange",{isDirty:!1}),I(!1)):I(!0)}),[l,w,A.invalid,I,x,f,e]),$=Object(a.useCallback)((e=>{e.ctrlKey&&e.key===n.keys.ENTER&&(e.preventDefault(),e.stopPropagation(),G())}),[G]);Object(a.useEffect)((()=>{const e=({isDirty:e})=>{E(e),e||R()};return f.on("dirtyStateChange",e),()=>{f.off("dirtyStateChange",e)}}),[R,f]),Object(a.useEffect)((()=>{const e=()=>k(S(l));return f.on("updateEditor",e),()=>{f.off("updateEditor",e)}}),[k,l,f]);const q={dispatch:k,formIsTouched:A.touched,metricAggs:N,state:w,schemas:l.type.schemas,setValidity:M,setTouched:I,setStateValue:z},W={aggs:w.data.aggs,hasHistogramAgg:B,stateParams:w.params,vis:l,uiState:s,setValue:z,setValidity:V,setTouched:I};return Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(n.EuiFlexGroup,{className:"visEditorSidebar",direction:"column",justifyContent:"spaceBetween",gutterSize:"none",responsive:!1},Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)("form",{className:"visEditorSidebar__form",name:"visualizeEditor",onKeyDownCapture:$},l.type.requiresSearch&&Object(p.jsx)(C,{isLinkedSearch:c,savedSearch:b,vis:l,eventEmitter:f}),L.length>1&&Object(p.jsx)(m,{optionTabs:L,setSelectedTab:P}),L.map((({editor:e,name:t,isSelected:i=!1})=>Object(p.jsx)("div",{key:t,className:"visEditorSidebar__config "+(i?"":"visEditorSidebar__config-isHidden")},Object(p.jsx)(e,d()({isTabSelected:i},"data"===t?q:W,{timeRange:h}))))))),Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(T,{applyChanges:G,dispatch:k,isDirty:x,isTouched:A.touched,isInvalid:A.invalid,vis:l}))),Object(p.jsx)(n.EuiButtonIcon,{"aria-expanded":!t,"aria-label":g.i18n.translate("visDefaultEditor.sidebar.collapseButtonAriaLabel",{defaultMessage:"Toggle sidebar"}),className:"visEditor__collapsibleSidebarButton","data-test-subj":"collapseSideBarButton",color:"text",iconType:t?"menuLeft":"menuRight",onClick:i}))}const Rt=Object(a.memo)(Mt);var Lt=i(16);const Pt=new l.Storage(window.localStorage);function Dt({core:e,data:t,vis:i,uiState:l,timeRange:c,filters:d,query:u,embeddableHandler:g,eventEmitter:m,linked:f,savedSearch:b}){const h=Object(a.useRef)(null),[v,j]=Object(a.useState)(!1),x=Object(a.useCallback)((()=>{j((e=>!e))}),[]),E=Object(a.useCallback)((()=>{}),[]);Object(a.useEffect)((()=>{if(h.current)return g.render(h.current).then((()=>{setTimeout((async()=>{m.emit("embeddableRendered")}))})),()=>g.destroy()}),[g,m]),Object(a.useEffect)((()=>{g.updateInput({timeRange:c,filters:d,query:u})}),[g,c,d,u]);const y=Object(Lt.b)(i.type.editorConfig.defaultSize);return Object(p.jsx)(s.a,e,Object(p.jsx)(o.KibanaContextProvider,{services:{appName:"vis_default_editor",storage:Pt,data:t,...e}},Object(p.jsx)(n.EuiResizableContainer,{className:"visEditor--default",onMouseLeave:E},((e,t)=>Object(p.jsx)(r.a.Fragment,null,Object(p.jsx)(e,{className:"visEditor__visualization",initialSize:100-y,minSize:"25%",paddingSize:"none",wrapperProps:{className:"visEditor__visualization__wrapper "+(v?"visEditor__visualization__wrapper-expanded":"")}},Object(p.jsx)("div",{className:"visEditor__canvas",ref:h,"data-shared-items-container":!0})),Object(p.jsx)(t,{alignIndicator:"start",className:"visEditor__resizer "+(v?"visEditor__resizer-isHidden":"")}),Object(p.jsx)(e,{initialSize:y,minSize:v?"0":"350px",paddingSize:"none",wrapperProps:{className:"visEditor__collapsibleSidebar "+(v?"visEditor__collapsibleSidebar-isClosed":"")}},Object(p.jsx)(Rt,{embeddableHandler:g,isCollapsed:v,onClickCollapse:x,vis:i,uiState:l,isLinkedSearch:f,savedSearch:b,timeRange:c,eventEmitter:m})))))))}}}]);