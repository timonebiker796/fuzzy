/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[8],{107:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var s=a(10),r=a.n(s),i=a(4),n=a(2),o=a.n(n),u=a(3),l=a(13),c=a(11),d=a(54),m=a(17),j=a(88),g=a(27),b=a(0);const p=({username:e,defaultValues:t={current_password:"",password:"",confirm_password:""},onSuccess:a,onCancel:s})=>{const{services:p}=Object(c.useKibana)(),{value:f,loading:x}=Object(m.c)(),O=(null==f?void 0:f.username)===e,v="kibana"===e||"kibana_system"===e,[h,{onBlur:M,...w}]=Object(j.a)({onSubmit:async t=>{try{await new g.UserAPIClient(p.http).changePassword(e,t.password,t.current_password),p.notifications.toasts.addSuccess(u.i18n.translate("xpack.security.management.users.changePasswordForm.successMessage",{defaultMessage:"Password successfully changed"})),null==a||a()}catch(e){var s,r;if(403!==(null===(s=e.body)||void 0===s?void 0:s.statusCode))throw p.notifications.toasts.addDanger({title:u.i18n.translate("xpack.security.management.users.changePasswordForm.errorMessage",{defaultMessage:"Could not change password"}),text:(null===(r=e.body)||void 0===r?void 0:r.message)||e.message}),e;h.setError("current_password",u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordInvalidError",{defaultMessage:"Invalid password."}))}},validate:async e=>((e,t)=>{const a={};return t&&(e.current_password||(a.current_password=u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordRequiredError",{defaultMessage:"Enter your current password."}))),e.password?e.password.length<6?a.password=u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordInvalidError",{defaultMessage:"Enter at least 6 characters."}):e.password!==e.confirm_password&&(a.confirm_password=u.i18n.translate("xpack.security.management.users.changePasswordForm.confirmPasswordInvalidError",{defaultMessage:"Passwords do not match."})):a.password=u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordRequiredError",{defaultMessage:"Enter a new password."}),a})(e,O),defaultValues:t}),y=function(e=[]){const t=Object(n.useRef)(null);return Object(n.useEffect)((()=>{t.current&&t.current.focus()}),e),t}([x]),P=Object(i.useGeneratedHtmlId)({prefix:"modalForm"});return Object(b.jsx)(i.EuiModal,{onClose:s},Object(b.jsx)(i.EuiModalHeader,null,Object(b.jsx)(i.EuiModalHeaderTitle,{"data-test-subj":"confirmModalTitleText"},Object(b.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.title",defaultMessage:"Change password"}))),Object(b.jsx)(i.EuiModalBody,null,Object(b.jsx)(i.EuiSkeletonText,{isLoading:x},Object(b.jsx)(i.EuiForm,r()({id:P,component:"form",noValidate:!0},w,{onBlur:e=>{requestAnimationFrame((()=>M(e)))}}),v?Object(b.jsx)(o.a.Fragment,null,Object(b.jsx)(i.EuiCallOut,{title:u.i18n.translate("xpack.security.management.users.changePasswordForm.systemUserTitle",{defaultMessage:"Kibana will lose connection to Elasticsearch"}),color:"danger",iconType:"warning",style:{maxWidth:d.euiThemeVars.euiFormMaxWidth}},Object(b.jsx)("p",null,Object(b.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.systemUserWarning",defaultMessage:"After changing the password for the {username} user, Kibana will be unusable.",values:{username:e}})),Object(b.jsx)("p",null,Object(b.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.systemUserDescription",defaultMessage:"To regain access, update your config file with the new password and restart Kibana."}))),Object(b.jsx)(i.EuiSpacer,null)):void 0,O?Object(b.jsx)(o.a.Fragment,null,Object(b.jsx)(i.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordLabel",{defaultMessage:"Current password"}),error:h.errors.current_password,isInvalid:h.touched.current_password&&!!h.errors.current_password},Object(b.jsx)(i.EuiFieldPassword,{name:"current_password",type:"dual",defaultValue:h.values.current_password,isInvalid:h.touched.current_password&&!!h.errors.current_password,autoComplete:"current-password",inputRef:y,"data-test-subj":"editUserChangePasswordCurrentPasswordInput"}))):Object(b.jsx)(i.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.userLabel",{defaultMessage:"User"})},Object(b.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(b.jsx)(i.EuiFlexItem,{grow:!1},Object(b.jsx)(i.EuiIcon,{type:"user"})),Object(b.jsx)(i.EuiFlexItem,null,Object(b.jsx)(i.EuiSpacer,{size:"xs"}),Object(b.jsx)(i.EuiText,null,e),Object(b.jsx)(i.EuiSpacer,{size:"xs"})))),Object(b.jsx)(i.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordLabel",{defaultMessage:"New password"}),helpText:u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordHelpText",{defaultMessage:"Password must be at least 6 characters."}),error:h.errors.password,isInvalid:h.touched.password&&!!h.errors.password},Object(b.jsx)(i.EuiFieldPassword,{name:"password",type:"dual",defaultValue:h.values.password,isInvalid:h.touched.password&&!!h.errors.password,autoComplete:"new-password",inputRef:O?void 0:y,"data-test-subj":"editUserChangePasswordNewPasswordInput"})),Object(b.jsx)(i.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.confirmPasswordLabel",{defaultMessage:"Confirm password"}),error:h.errors.confirm_password,isInvalid:h.touched.confirm_password&&!!h.errors.confirm_password},Object(b.jsx)(i.EuiFieldPassword,{name:"confirm_password",type:"dual",defaultValue:h.values.confirm_password,isInvalid:h.touched.confirm_password&&!!h.errors.confirm_password,autoComplete:"new-password","data-test-subj":"editUserChangePasswordConfirmPasswordInput"}))))),Object(b.jsx)(i.EuiModalFooter,null,Object(b.jsx)(i.EuiButtonEmpty,{"data-test-subj":"changePasswordFormCancelButton",isDisabled:h.isSubmitting,onClick:s},Object(b.jsx)(l.FormattedMessage,{id:"xpack.security.changePasswordForm.cancelButton",defaultMessage:"Cancel"})),Object(b.jsx)(i.EuiButton,{iconType:"lock",type:"submit",form:P,"data-test-subj":"changePasswordFormSubmitButton",isLoading:h.isSubmitting,isDisabled:x||h.isSubmitted&&h.isInvalid,color:v?"danger":void 0,fill:!0},Object(b.jsx)(l.FormattedMessage,{id:"xpack.security.changePasswordForm.confirmButton",defaultMessage:"{isSubmitting, select, true{Changing passwordâ€¦} other{Change password}}",values:{isSubmitting:h.isSubmitting}}))))}},173:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2),r=a(174);t.default=function(e,t){var a=r.useFirstMountState();s.useEffect((function(){if(!a)return e()}),t)}},174:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var s=a(2);t.useFirstMountState=function(){var e=s.useRef(!0);return e.current?(e.current=!1,!0):e.current}},316:function(e,t,a){"use strict";a.r(t),a.d(t,"AccountManagementPage",(function(){return D}));var s=a(4),r=a(2),i=a.n(r),n=a(3),o=a(11),u=a(0),l=a(83),c=a(173),d=a.n(c),m=a(13),j=a(128),g=a(311),b=a(63),p=a(15),f=a.n(p),x=a(16),O=a(62);const v={notificationSuccess:{title:n.i18n.translate("userProfileComponents.updateUserProfile.notification.submitSuccessTitle",{defaultMessage:"Profile updated"}),pageReloadText:n.i18n.translate("userProfileComponents.updateUserProfile.notification.requiresPageReloadDescription",{defaultMessage:"One or more settings require you to reload the page to take effect."})}};var h=a(8);const M=64;const w=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;var y=a(21),P=a(14),F=a(7),k=a(107),E=a(84);const S={name:"ew5m45",styles:".euiFormRow__label{flex:1;}"},T=({user:e})=>{const{services:t}=Object(o.useKibana)();return Object(y.a)(e,t.application.capabilities)?Object(u.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,title:Object(u.jsx)("h2",null,Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.detailsGroupTitle",defaultMessage:"Details"})),description:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.detailsGroupDescription",defaultMessage:"Provide some basic information about yourself."})},Object(u.jsx)(j.d,{css:S,label:Object(u.jsx)(j.c,{for:"user.full_name"},Object(u.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameLabel",defaultMessage:"Full name"}),Object(u.jsx)(j.e,null))),fullWidth:!0},Object(u.jsx)(j.b,{name:"user.full_name","data-test-subj":"userProfileFullName",fullWidth:!0})),Object(u.jsx)(j.d,{css:S,label:Object(u.jsx)(j.c,{for:"user.email"},Object(u.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailLabel",defaultMessage:"Email address"}),Object(u.jsx)(j.e,null))),fullWidth:!0},Object(u.jsx)(j.b,{type:"email",name:"user.email","data-test-subj":"userProfileEmail",fullWidth:!0}))):null},C=({formik:e,isThemeOverridden:t,isOverriddenThemeDarkMode:a})=>{if(!e.values.data)return null;let r=e.values.data.userSettings.darkMode;t&&(r=a?"dark":"light");const i=({id:a,label:i,icon:n})=>Object(u.jsx)(s.EuiKeyPadMenuItem,{name:a,label:i,"data-test-subj":`themeKeyPadItem${i}`,checkable:"single",isSelected:r===a,isDisabled:t,onChange:()=>e.setFieldValue("data.userSettings.darkMode",a)},Object(u.jsx)(s.EuiIcon,{type:n,size:"l"}));return Object(u.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,fieldFlexItemProps:{style:{alignSelf:"flex-start"}},title:Object(u.jsx)("h2",null,Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.userSettingsTitle",defaultMessage:"Theme"})),description:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.themeFormGroupDescription",defaultMessage:"Select the appearance of your interface."})},Object(u.jsx)(j.d,{name:"data.userSettings.darkMode",fullWidth:!0},(e=>{const t=Object(u.jsx)(s.EuiKeyPadMenu,{"aria-label":n.i18n.translate("xpack.security.accountManagement.userProfile.userSettings.themeGroupDescription",{defaultMessage:"Elastic theme"}),"data-test-subj":"themeMenu",checkable:{legend:Object(u.jsx)(j.c,{for:"data.userSettings.darkMode"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.userSettings.theme",defaultMessage:"Mode"}))}},i({id:"",label:n.i18n.translate("xpack.security.accountManagement.userProfile.defaultModeButton",{defaultMessage:"Space default"}),icon:"spaces"}),i({id:"light",label:n.i18n.translate("xpack.security.accountManagement.userProfile.lightModeButton",{defaultMessage:"Light"}),icon:"sun"}),i({id:"dark",label:n.i18n.translate("xpack.security.accountManagement.userProfile.darkModeButton",{defaultMessage:"Dark"}),icon:"moon"}));return e?Object(u.jsx)(s.EuiToolTip,{"data-test-subj":"themeOverrideTooltip",content:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.overriddenMessage",defaultMessage:"This setting is overridden by the Kibana server and can not be changed."})},t):t})(t)))};function _({user:e,formik:t}){const{euiTheme:a}=Object(s.useEuiTheme)();if(!t.values.data)return null;const r=Object(E.c)(e);return Object(u.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,fieldFlexItemProps:{style:{alignSelf:"flex-start"}},title:Object(u.jsx)("h2",null,Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarGroupTitle",defaultMessage:"Avatar"})),description:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarGroupDescription",defaultMessage:"Provide your initials or upload an image to represent yourself."})},Object(u.jsx)(s.EuiFlexGroup,{responsive:!1},Object(u.jsx)(s.EuiFlexItem,{grow:!1},"image"!==t.values.avatarType||t.values.data.avatar.imageUrl?Object(u.jsx)(b.a,{user:{username:e.username,full_name:t.values.user.full_name},avatar:{imageUrl:"image"===t.values.avatarType?t.values.data.avatar.imageUrl:void 0,initials:t.values.data.avatar.initials||"?",color:w.test(t.values.data.avatar.color)?t.values.data.avatar.color:void 0},size:"xl"}):Object(u.jsx)(b.a,{size:"xl"})),Object(u.jsx)(s.EuiFlexItem,null,Object(u.jsx)(j.d,{name:"avatarType",label:Object(u.jsx)(j.c,{for:"avatarType"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarTypeGroupDescription",defaultMessage:"Avatar type"})),fullWidth:!0},Object(u.jsx)(s.EuiButtonGroup,{legend:n.i18n.translate("xpack.security.accountManagement.userProfile.avatarTypeGroupDescription",{defaultMessage:"Avatar type"}),buttonSize:"m",idSelected:t.values.avatarType,options:[{id:"initials",label:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.initialsAvatarTypeLabel",defaultMessage:"Initials"})},{id:"image",label:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageAvatarTypeLabel",defaultMessage:"Image"}),iconType:"image"}],onChange:e=>t.setFieldValue("avatarType",e),isFullWidth:!0})))),Object(u.jsx)(s.EuiSpacer,null),"image"===t.values.avatarType?Object(u.jsx)(j.d,{label:Object(u.jsx)(j.c,{for:"data.avatar.imageUrl"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageUrlLabel",defaultMessage:"Image"})),fullWidth:!0},Object(u.jsx)(j.b,{as:s.EuiFilePicker,name:"data.avatar.imageUrl",value:void 0,initialPromptText:t.values.data.avatar.imageUrl?Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.prepopulatedImageUrlPromptText",defaultMessage:"Select or drag and drop a replacement image"}):Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageUrlPromptText",defaultMessage:"Select or drag and drop an image"}),onChange:(i=e=>{t.setFieldValue("data.avatar.imageUrl",null!=e?e:"")},async e=>{if(!e||!e.length)return void i(void 0);const t=e[0];if(-1!==h.d.indexOf(t.type)){const e=await(a=t,new Promise(((e,t)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=t,s.readAsDataURL(a)}))),s=await function(e,t){return new Promise(((a,s)=>{const r=new Image;r.onload=()=>{if(r.width<=t&&r.height<=t)return a(e);try{const e=document.createElement("canvas"),s=e.getContext("2d");if(s){r.width>=r.height?(e.width=t,e.height=Math.floor(r.height*t/r.width)):(e.height=t,e.width=Math.floor(r.width*t/r.height)),s.drawImage(r,0,0,e.width,e.height);const i=e.toDataURL();return a(i)}}catch(e){return s(e)}return s()},r.onerror=s,r.src=e}))}(e,M);i(s)}var a}),validate:{required:n.i18n.translate("xpack.security.accountManagement.userProfile.imageUrlRequiredError",{defaultMessage:"Upload an image."})},accept:h.d.join(","),display:"default",fullWidth:!0})):Object(u.jsx)(s.EuiFlexGroup,{responsive:!1},Object(u.jsx)(s.EuiFlexItem,{grow:!1,style:{width:64}},Object(u.jsx)(j.d,{label:Object(u.jsx)(j.c,{for:"data.avatar.initials"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.initialsLabel",defaultMessage:"Initials"})),fullWidth:!0},Object(u.jsx)(j.b,{name:"data.avatar.initials",maxLength:2,validate:{required:n.i18n.translate("xpack.security.accountManagement.userProfile.initialsRequiredError",{defaultMessage:"Add initials"}),maxLength:{value:2,message:n.i18n.translate("xpack.security.accountManagement.userProfile.initialsMaxLengthError",{defaultMessage:"Enter no more than 2 characters."})}},fullWidth:!0}))),Object(u.jsx)(s.EuiFlexItem,null,Object(u.jsx)(j.d,{label:Object(u.jsx)(j.c,{for:"data.avatar.color"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.colorLabel",defaultMessage:"Color"})),labelAppend:r?null:Object(u.jsx)(s.EuiButtonEmpty,{onClick:()=>t.setFieldValue("data.avatar.color","#"+String(Math.floor(16777215*Math.random()).toString(16)).padStart(6,"0")),size:"xs",flush:"right",style:{height:a.base}},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.randomizeButton",defaultMessage:"Randomize"})),fullWidth:!0},Object(u.jsx)(j.b,{as:s.EuiColorPicker,name:"data.avatar.color",color:t.values.data.avatar.color,validate:{required:n.i18n.translate("xpack.security.accountManagement.userProfile.colorRequiredError",{defaultMessage:"Select a color."}),pattern:{value:w,message:n.i18n.translate("xpack.security.accountManagement.userProfile.colorPatternError",{defaultMessage:"Enter a valid HEX color code."})}},onChange:e=>{t.setFieldValue("data.avatar.color",e)},fullWidth:!0})))));var i}function I({user:e,onShowPasswordForm:t}){return Object(y.b)(e)?Object(u.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,title:Object(u.jsx)("h2",null,Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordGroupTitle",defaultMessage:"Password"})),description:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordGroupDescription",defaultMessage:"Protect your data with a strong password."})},Object(u.jsx)(s.EuiFormRow,{label:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordLabel",defaultMessage:"Password"}),fullWidth:!0},Object(u.jsx)(s.EuiButton,{onClick:t,iconType:"lock","data-test-subj":"openChangePasswordForm"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.changePasswordButton",defaultMessage:"Change password"})))):null}const R=({user:e})=>{const{euiTheme:t}=Object(s.useEuiTheme)(),[a,n]=Object(r.useState)(!1),o=()=>n((e=>!e)),l=()=>n(!1),[c]=e.roles,d=e.roles.slice(1);return Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)("div",{style:{maxWidth:t.breakpoint.m/6,display:"inline-block"}},Object(u.jsx)(s.EuiBadge,{key:c,color:"hollow","data-test-subj":`role${c}`},c)),d.length?(()=>{const e=Object(u.jsx)(s.EuiButtonEmpty,{size:"xs",onClick:o,"data-test-subj":"userRolesExpand"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesCountLabel",defaultMessage:"+{count} more",values:{count:d.length}}));return Object(u.jsx)(s.EuiPopover,{panelPaddingSize:"s",button:e,isOpen:a,closePopover:l,"data-test-subj":"userRolesPopover"},Object(u.jsx)(s.EuiBadgeGroup,{gutterSize:"xs","data-test-subj":"remainingRoles",style:{maxWidth:"200px"}},d.map((e=>Object(u.jsx)(s.EuiBadge,{color:"hollow",key:e},e)))))})():null)},B=({user:e,data:t})=>{const{euiTheme:a}=Object(s.useEuiTheme)(),{services:c}=Object(o.useKibana)(),b=function({user:e,data:t}){var a,i,c,m,j,g,b,p;const{services:h}=Object(o.useKibana)(),{users:M}=Object(P.d)(),{update:w,showSuccessNotification:F}=(({notificationSuccess:e={},pageReloadChecker:t}={})=>{const{userProfileApiClient:a,notifySuccess:i}=Object(O.b)(),{userProfile$:o,enabled$:l}=a,{enabled:c=!0,title:d=v.notificationSuccess.title,pageReloadText:m=v.notificationSuccess.pageReloadText}=e,[j,g]=Object(r.useState)(!1),b=f()(o),p=f()(l),h=Object(r.useRef)(),M=Object(r.useRef)(!1),w=Object(r.useCallback)((({isRefreshRequired:e=!1}={})=>{e?i({title:d,text:Object(u.jsx)(s.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)("p",null,m),Object(u.jsx)(s.EuiButton,{size:"s",onClick:()=>window.location.reload(),"data-test-subj":"windowReloadButton"},n.i18n.translate("userProfileComponents.updateUserProfile.notification.requiresPageReloadButtonLabel",{defaultMessage:"Reload page"}))))},{durationMs:3e5}):i({title:d})}),[d,i,m]),y=Object(r.useCallback)((e=>{if(M.current&&g(!1),c){const a=null==t?void 0:t(h.current,e);w({isRefreshRequired:a})}}),[c,w,t]),P=Object(r.useCallback)((e=>(h.current=Object(x.merge)({},b),g(!0),a.partialUpdate(e).then((()=>y(e))))),[a,y,b]);return Object(r.useEffect)((()=>(M.current=!0,()=>{M.current=!1})),[]),{update:P,showSuccessNotification:w,userProfileData:b,isLoading:j,userProfileEnabled:p}})({notificationSuccess:{enabled:!1}}),[k,E]=Object(r.useState)({user:{full_name:e.full_name||"",email:e.email||""},data:t?{avatar:{initials:(null===(a=t.avatar)||void 0===a?void 0:a.initials)||Object(y.g)(e),color:(null===(i=t.avatar)||void 0===i?void 0:i.color)||Object(y.f)(e),imageUrl:(null===(c=t.avatar)||void 0===c?void 0:c.imageUrl)||""},userSettings:{darkMode:(null===(m=t.userSettings)||void 0===m?void 0:m.darkMode)||""}}:void 0,avatarType:null!=t&&null!==(j=t.avatar)&&void 0!==j&&j.imageUrl?"image":"initials"}),[S,T]=Object(r.useState)(!1),C=Object(l.useFormik)({onSubmit:async t=>{var a,s;const r=[];if(Object(y.a)(e,h.application.capabilities)&&r.push(M.saveUser({username:e.username,roles:e.roles,enabled:e.enabled,full_name:t.user.full_name,email:t.user.email})),t.data&&r.push(w("image"===t.avatarType?t.data:{...t.data,avatar:{...t.data.avatar,imageUrl:null}})),0===r.length)return;try{await Promise.all(r)}catch(e){return void h.notifications.toasts.addError(e,{title:n.i18n.translate("xpack.security.accountManagement.userProfile.submitErrorTitle",{defaultMessage:"Couldn't update profile"})})}E(t);let i=!1;(null===(a=k.data)||void 0===a?void 0:a.userSettings.darkMode)!==(null===(s=t.data)||void 0===s?void 0:s.userSettings.darkMode)&&(i=!0),F({isRefreshRequired:i})},initialValues:k,enableReinitialize:!0,validateOnBlur:S,validateOnChange:S});C.submitCount>0&&!S?T(!0):0===C.submitCount&&S&&T(!1);const _=Object(r.useRef)(!(null==t||null===(g=t.avatar)||void 0===g||!g.initials)&&(null===(b=t.avatar)||void 0===b?void 0:b.initials)!==Object(y.g)(e));return d()((()=>{if(!_.current){const t=Object(y.g)({username:e.username,full_name:C.values.user.full_name});C.setFieldValue("data.avatar.initials",t)}}),[C.values.user.full_name]),d()((()=>{if(!_.current&&C.values.data){const t=Object(y.g)({username:e.username,full_name:C.values.user.full_name});_.current=C.values.data.avatar.initials!==t}}),[null===(p=C.values.data)||void 0===p?void 0:p.avatar.initials]),C}({user:e,data:t}),p=Object(j.f)(),h=Object(s.useGeneratedHtmlId)(),[M,w]=Object(r.useState)(!1),E=Object(y.a)(e,c.application.capabilities),S=e.elastic_cloud_user,{isThemeOverridden:B,isOverriddenThemeDarkMode:D}=(L=c.settings.client,G=c.theme,{isThemeOverridden:L.isOverridden("theme:darkMode"),isOverriddenThemeDarkMode:G.getTheme().darkMode});var L,G;const W=[{title:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.usernameLabel",defaultMessage:"Username"}),description:e.username,helpText:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.usernameHelpText",defaultMessage:"User name cannot be changed after account creation."}),testSubj:"username"}];return E||(W.push({title:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameLabel",defaultMessage:"Full name"}),description:e.full_name,helpText:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameHelpText",defaultMessage:"Please contact an administrator to change your full name."}),testSubj:"full_name"}),W.push({title:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailLabel",defaultMessage:"Email address"}),description:e.email,helpText:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailHelpText",defaultMessage:"Please contact an administrator to change your email address."}),testSubj:"email"})),W.push({title:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesLabel",defaultMessage:"{roles, plural, one {Role} other {Roles} }",values:{roles:e.roles.length}}),description:Object(u.jsx)(R,{user:e}),helpText:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesHelpText",defaultMessage:"Roles control access and permissions across the Elastic Stack."}),testSubj:"userRoles"}),Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(l.FormikProvider,{value:b},Object(u.jsx)(j.a,{value:p},Object(u.jsx)(F.a,{text:n.i18n.translate("xpack.security.accountManagement.userProfile.title",{defaultMessage:"Profile"})},M?Object(u.jsx)(k.a,{username:e.username,onCancel:()=>w(!1),onSuccess:()=>w(!1)}):null,Object(u.jsx)(g.a,{className:"eui-fullHeight",restrictWidth:1e3},Object(u.jsx)(g.a.Header,{pageTitle:Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.title",defaultMessage:"Profile"}),id:h,rightSideItems:W.reverse().map((e=>Object(u.jsx)(s.EuiDescriptionList,{textStyle:"reverse",listItems:[{title:Object(u.jsx)(s.EuiText,{color:a.colors.darkestShade,size:"s"},Object(u.jsx)(s.EuiFlexGroup,{responsive:!1,alignItems:"center",gutterSize:"none"},Object(u.jsx)(s.EuiFlexItem,{grow:!1},e.title),Object(u.jsx)(s.EuiFlexItem,{grow:!1,style:{marginLeft:"0.33em"}},Object(u.jsx)(s.EuiIconTip,{type:"questionInCircle",content:e.helpText})))),description:Object(u.jsx)("span",{"data-test-subj":e.testSubj},e.description||Object(u.jsx)(s.EuiText,{color:a.colors.disabledText,size:"s"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.noneProvided",defaultMessage:"None provided"})))}],compressed:!0})))}),Object(u.jsx)(g.a.Section,null,Object(u.jsx)(l.Form,{"aria-labelledby":h},Object(u.jsx)(T,{user:e}),S?null:Object(u.jsx)(_,{user:e,formik:b}),Object(u.jsx)(I,{user:e,onShowPasswordForm:()=>w(!0)}),S?null:Object(u.jsx)(C,{formik:b,isThemeOverridden:B,isOverriddenThemeDarkMode:D}))),p.count>0?Object(u.jsx)(g.a.BottomBar,{paddingSize:"m",position:"fixed","data-test-subj":"userProfileBottomBar"},Object(u.jsx)(U,null)):null)))))},U=()=>{const e=Object(l.useFormikContext)(),{count:t}=Object(j.g)();return Object(u.jsx)(s.EuiFlexGroup,{alignItems:"center",style:{width:"100%"},responsive:!1},Object(u.jsx)(s.EuiFlexItem,null,Object(u.jsx)(s.EuiFlexGroup,{responsive:!1,gutterSize:"xs"},Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)(s.EuiIcon,{type:"dot",color:"success"})),Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.unsavedChangesMessage",defaultMessage:"{count, plural, one {# unsaved change} other {# unsaved changes}}",values:{count:t}})))),Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)(s.EuiButtonEmpty,{onClick:e.handleReset,color:"text"},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.discardChangesButton",defaultMessage:"Discard"}))),Object(u.jsx)(s.EuiFlexItem,{grow:!1},Object(u.jsx)(s.EuiButton,{onClick:e.submitForm,"data-test-subj":"saveProfileChangesButton",isLoading:e.isSubmitting,isDisabled:e.submitCount>0&&!e.isValid,color:"success",iconType:"save",fill:!0},Object(u.jsx)(m.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.saveChangesButton",defaultMessage:"{isSubmitting, select, true{Saving changesâ€¦} other{Save changes}}",values:{isSubmitting:e.isSubmitting}}))))},D=()=>{var e;const{services:t}=Object(o.useKibana)(),a=Object(P.c)(),r=Object(P.e)("avatar,userSettings"),i=r.error&&a.value&&Object(y.c)(a.value)?r.error:void 0,l=a.error||i;return l?Object(u.jsx)(s.EuiEmptyPrompt,{iconType:"warning",title:Object(u.jsx)("h2",null,l.message)}):!a.value||Object(y.c)(a.value)&&!r.value?null:Object(u.jsx)(F.a,{text:n.i18n.translate("xpack.security.accountManagement.userSettingsBreadcrumbRootLabel",{defaultMessage:"User settings"}),href:t.http.basePath.prepend("/security/account")},Object(u.jsx)(B,{user:a.value,data:null===(e=r.value)||void 0===e?void 0:e.data}))}},84:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));var s=a(3);const r=e=>{var t,a;return null!==(t=null===(a=e.metadata)||void 0===a?void 0:a._reserved)&&void 0!==t&&t},i=e=>{var t,a;return null!==(t=null===(a=e.metadata)||void 0===a?void 0:a._deprecated)&&void 0!==t&&t},n=e=>{var t,a;const r=null!==(t=null===(a=e.metadata)||void 0===a?void 0:a._deprecated_reason)&&void 0!==t?t:"";return s.i18n.translate("xpack.security.management.users.extendedUserDeprecationNotice",{defaultMessage:"The {username} user is deprecated. {reason}",values:{username:e.username,reason:r}})}},88:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var s=a(16),r=a(2),i=a(33),n=a.n(i),o=a(58);function u(e){const t=function({onSubmit:e,validate:t,defaultValues:a}){const[i,o]=Object(r.useState)(a),[u,c]=Object(r.useState)({}),[d,m]=Object(r.useState)({}),[j,g]=Object(r.useState)(0),[b,p]=n()((async e=>{const a=await t(e);return c(a),0===Object.keys(a).length&&g(0),a}),[t]),[f,x]=n()((async t=>{const a=await p(t);if(m(function(e,t){return Object(s.cloneDeepWith)(e,(e=>{if("object"!=typeof e&&null!==e)return true}))}(t)),g(j+1),0===Object.keys(a).length)return e(t)}),[p,e]);return{setValue:async(e,t)=>{const a=l(i,e,t);o(a),await p(a)},setTouched:async(e,t=!0)=>{m(l(d,e,t)),await p(i)},setError:(e,t)=>{c(l(u,e,t)),m(l(d,e,!0))},reset:e=>{o(e),c({}),m({}),g(0)},submit:()=>x(i),values:i,errors:u,touched:d,isValidating:b.loading,isSubmitting:f.loading,submitError:f.error,isInvalid:Object.keys(u).length>0,isSubmitted:j>0}}(e),a={onSubmit:e=>{e.preventDefault(),t.submit()},onChange:e=>{const{name:a,type:s,checked:r,value:i}=e.target;a&&t.setValue(a,"checkbox"===s?r:i)},onBlur:e=>{const{name:a}=e.target;a&&t.setTouched(e.target.name)}};return[t,a]}function l(e,t,a){return Object(s.get)(e,t)!==a?Object(o.set)(Object(s.cloneDeep)(e),t,a):e}}}]);