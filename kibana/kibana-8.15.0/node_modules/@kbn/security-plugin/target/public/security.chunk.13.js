/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[13],{104:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var s=a(4),i=a(2),n=a(11),r=a(0);const c=({app:e,doc:t,children:a})=>{const[,c]=function(){const{services:e}=Object(n.useKibana)(),{links:t,ELASTIC_WEBSITE_URL:a,DOC_LINK_VERSION:s}=e.docLinks;return[t,Object(i.useCallback)(((e,t)=>`${a}guide/en/${e}/reference/${s}/${t}`),[a,s])]}();return Object(r.jsx)(s.EuiLink,{href:c(e,t),target:"_blank",external:!0},a)}},310:function(e,t,a){"use strict";a.r(t),a.d(t,"APIKeysGridPage",(function(){return pe}));var s=a(10),i=a.n(s),n=a(4),r=a(2),c=a.n(r),l=a(9),o=a(33),u=a.n(o),d=a(64),p=a(3),j=a(13),y=a(11),x=a(83),m=a(65),g=a.n(m),b=a(56),O=a(128);const f="/internal/security/api_key";class APIKeysAPIClient{constructor(e){this.http=e}async queryApiKeys(e){return await this.http.post(`${f}/_query`,{body:JSON.stringify(e||{})})}async invalidateApiKeys(e,t=!1){return await this.http.post(`${f}/invalidate`,{body:JSON.stringify({apiKeys:e,isAdmin:t})})}async createApiKey(e){return await this.http.post(f,{body:JSON.stringify(e)})}async updateApiKey(e){return await this.http.put(f,{body:JSON.stringify(e)})}}var h=a(0);const M=({app:e,doc:t,children:a})=>{const[,s]=function(){const{services:e}=Object(y.useKibana)(),{links:t,ELASTIC_WEBSITE_URL:a,DOC_LINK_VERSION:s}=e.docLinks;return[t,Object(r.useCallback)(((e,t)=>`${a}guide/en/${e}/reference/${s}/${t}`),[a,s])]}();return Object(h.jsx)(n.EuiLink,{href:s(e,t),target:"_blank",external:!0},a)},E=()=>Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.typeLabel",defaultMessage:"Type"}),F=()=>Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.nameLabel",defaultMessage:"Name"}),k=p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.invalidJsonError",{defaultMessage:"Enter valid JSON."}),K={name:"",type:"rest",expiration:"",includeMetadata:!1,metadata:"{}",customExpiration:!1,customPrivileges:!1,access:JSON.stringify({search:[{names:["*"]}],replication:[{names:["*"]}]},null,2),role_descriptors:"{}"},C=p.i18n.translate("xpack.security.httpError",{defaultMessage:"Could not initialize http client."}),v=({onSuccess:e,onCancel:t,defaultExpiration:a,defaultMetadata:s,defaultRoleDescriptors:i,apiKey:l,canManageCrossClusterApiKeys:o=!1,readOnly:d=!1,currentUser:m,isLoadingCurrentUser:f})=>{const{euiTheme:v}=Object(n.useEuiTheme)(),A=Object(y.useDarkMode)(),{services:{http:P}}=Object(y.useKibana)(),[B,z]=Object(r.useState)(void 0),[{value:L,loading:_},D]=u()((()=>P?P.get("/api/security/role"):Promise.resolve([])),[P]),N=Object(x.useFormik)({onSubmit:async t=>{if(!P)throw z({message:C,statusCode:0}),new Error(C);try{if(l){const a=await new APIKeysAPIClient(P).updateApiKey(function(e,t,a){const s=a.includeMetadata?JSON.parse(a.metadata):"{}";return"cross_cluster"===e?{type:e,id:t,metadata:s,access:JSON.parse(a.access)}:{id:t,metadata:s,role_descriptors:a.customPrivileges?JSON.parse(a.role_descriptors):"{}"}}(l.type,l.id,t));null==e||e(a)}else{const a=await new APIKeysAPIClient(P).createApiKey(function(e){const{type:t,name:a}=e,s=e.customExpiration?`${e.expiration}d`:void 0,i=e.includeMetadata?JSON.parse(e.metadata):"{}";return"cross_cluster"===t?{type:t,name:a,expiration:s,metadata:i,access:JSON.parse(e.access)}:{name:a,expiration:s,metadata:i,role_descriptors:e.customPrivileges?JSON.parse(e.role_descriptors):"{}"}}(t));null==e||e(a)}z(void 0)}catch(e){throw z(e.body),e}},initialValues:l?S(l):K});Object(r.useEffect)((()=>{D()}),[]),Object(r.useEffect)((()=>{if(m&&L){const e=m.roles.reduce(((e,t)=>{const a=L.find((e=>e.name===t));return a&&(e[a.name]=a.elasticsearch),e}),{});N.touched.role_descriptors||l||N.setFieldValue("role_descriptors",JSON.stringify(e,null,2))}}),[m,L]),Object(r.useEffect)((()=>{i&&!l&&N.setFieldValue("role_descriptors",i)}),[i]),Object(r.useEffect)((()=>{s&&!l&&N.setFieldValue("metadata",s)}),[s]),Object(r.useEffect)((()=>{a&&!l&&(N.setFieldValue("expiration",a),N.setFieldValue("customExpiration",!0))}),[a]);const R=f||_,q=!(!m||!l)&&m.username===l.username,H=!!l&&l.expiration&&g()(l.expiration).isBefore(),G=q&&!H,J=Object(r.useRef)(null);Object(r.useEffect)((()=>{null!=J&&J.current&&(null==J||J.current.focus())}),[R]);const V=Object(n.htmlIdGenerator)("formFlyout")("title"),U=d||l&&!G,W=R||N.submitCount>0&&!N.isValid||d||l&&!G,$=l?d||!G?p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.viewTitle",{defaultMessage:"API key details"}):p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.updateTitle",{defaultMessage:"Update API key"}):p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.createTitle",{defaultMessage:"Create API key"}),Y=l?p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.updateSubmitButton",{defaultMessage:"{isSubmitting, select, true{Updating API key…} other{Update API key}}",values:{isSubmitting:N.isSubmitting}}):p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.createSubmitButton",{defaultMessage:"{isSubmitting, select, true{Creating API key…} other{Create API key}}",values:{isSubmitting:N.isSubmitting}});let Q;return N.values.customExpiration&&(Q=new Date,Q.setDate(Q.getDate()+parseInt(N.values.expiration,10))),Object(h.jsx)(x.FormikProvider,{value:N},Object(h.jsx)(n.EuiFlyout,{onClose:t,"aria-labelledby":V,size:"m",ownFocus:!0},Object(h.jsx)(x.Form,{onSubmit:N.handleSubmit,style:{display:"flex",flexDirection:"column",height:"100%"}},Object(h.jsx)(n.EuiFlyoutHeader,{hasBorder:!0},Object(h.jsx)(n.EuiTitle,{size:"m"},Object(h.jsx)("h2",{id:V},$))),Object(h.jsx)(n.EuiFlyoutBody,null,Object(h.jsx)(n.EuiSkeletonText,{isLoading:R},B&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiCallOut,{"data-test-subj":"apiKeyFlyoutResponseError",color:"danger",title:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.responseErrorTitle",defaultMessage:"Error creating API key"})},B.message),Object(h.jsx)(n.EuiSpacer,null)),l&&!d?q?H?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiCallOut,{iconType:"lock",title:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.readonlyExpiredWarning",defaultMessage:"This API key has expired. You can no longer update it."})}),Object(h.jsx)(n.EuiSpacer,null)):null:Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiCallOut,{iconType:"lock",title:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.readonlyOwnedByOtherUserWarning",defaultMessage:"You can’t update this API key. It belongs to another user."})}),Object(h.jsx)(n.EuiSpacer,null)):null,Object(h.jsx)(n.EuiPanel,{hasBorder:!0},l?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.overviewLabel",defaultMessage:"Overview"}))),Object(h.jsx)(n.EuiSpacer,null),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("strong",null,Object(h.jsx)(F,null)))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},l.name)),Object(h.jsx)(n.EuiHorizontalRule,{margin:"s"}),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("strong",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.ownerLabel",defaultMessage:"Owner"})))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"xs"},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiIcon,{type:"user"})),Object(h.jsx)(n.EuiFlexItem,{grow:!1},l.username)))),Object(h.jsx)(n.EuiHorizontalRule,{margin:"s"}),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("strong",null,Object(h.jsx)(E,null)))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(I,{type:l.type}))),Object(h.jsx)(n.EuiHorizontalRule,{margin:"s"}),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("strong",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.createdLabel",defaultMessage:"Created"})))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(T,{timestamp:l.creation}))),Object(h.jsx)(n.EuiHorizontalRule,{margin:"s"}),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("strong",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.statusLabel",defaultMessage:"Status"})))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(w,{expiration:l.expiration})))):Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiFlexGroup,{justifyContent:"flexStart",alignItems:"center",gutterSize:"s"},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiIcon,{type:"gear"})),Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.setup.title",defaultMessage:"Setup"}))))),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{color:"subdued",size:"xs"},Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.setup.description",defaultMessage:"Basic configuration details to create your API key."}))),Object(h.jsx)(n.EuiSpacer,{size:"s"}),Object(h.jsx)(O.d,{label:Object(h.jsx)(F,null),fullWidth:!0},Object(h.jsx)(O.b,{name:"name",inputRef:J,"data-test-subj":"apiKeyNameInput",disabled:d||!!l,validate:{required:p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.nameRequired",{defaultMessage:"Enter a name."})},fullWidth:!0})),o?Object(h.jsx)(O.d,{name:"type",label:Object(h.jsx)(E,null),fullWidth:!0},Object(h.jsx)(n.EuiFlexGroup,{gutterSize:"m"},Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiCheckableCard,{id:"rest",label:Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiTitle,{size:"xxs"},Object(h.jsx)("h2",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.restTypeLabel",defaultMessage:"User API key"}))),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{size:"s"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.restTypeDescription",defaultMessage:"Allow external services to access the Elastic Stack on your behalf."}))),onChange:()=>N.setFieldValue("type","rest"),checked:"rest"===N.values.type})),Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiCheckableCard,{id:"cross_cluster",label:Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiTitle,{size:"xxs"},Object(h.jsx)("h2",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.crossClusterTypeLabel",defaultMessage:"Cross-cluster API key"}))),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{size:"s"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.crossClusterTypeDescription",defaultMessage:"Allow other clusters to connect to this cluster."}))),onChange:()=>N.setFieldValue("type","cross_cluster"),checked:"cross_cluster"===N.values.type})))):Object(h.jsx)(n.EuiFormRow,{label:Object(h.jsx)(E,null)},Object(h.jsx)(I,{type:"rest"})))),Object(h.jsx)(n.EuiSpacer,null),!l&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiPanel,{hasBorder:!0},Object(h.jsx)("div",{style:{paddingRight:v.size.s}},Object(h.jsx)(n.EuiSwitch,{"data-test-subj":"apiKeyCustomExpirationSwitch",label:Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.applyExpirationDateLabel",defaultMessage:"Apply expiration date"}))),checked:Boolean(N.values.customExpiration),disabled:d||!!l,onChange:e=>N.setFieldValue("customExpiration",e.target.checked)}),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{color:"subdued",size:"xs"},Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.expiresFieldHelpText",defaultMessage:"Setting an expiration date is a security best practice. Defaults to no expiration."})))),N.values.customExpiration&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiSpacer,null),Object(h.jsx)(n.EuiFormRow,{fullWidth:!0,helpText:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.expirationHelpText",defaultMessage:"This API Key will expire on {expirationDate}",values:{expirationDate:Object(h.jsx)("strong",null,Object(h.jsx)(j.FormattedDate,{year:"numeric",month:"long",day:"numeric",value:Q}))}})},Object(h.jsx)(O.b,{as:n.EuiFieldNumber,name:"expiration",min:0,append:p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.expirationUnit",{defaultMessage:"days"}),validate:{min:{value:1,message:p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.expirationRequired",{defaultMessage:"Enter a valid duration or disable this option."})}},disabled:d||!!l,"data-test-subj":"apiKeyCustomExpirationInput"})))),Object(h.jsx)(n.EuiSpacer,{size:"l"})),"cross_cluster"===N.values.type?Object(h.jsx)(n.EuiPanel,{hasBorder:!0},Object(h.jsx)("div",{style:{paddingRight:v.size.s}},Object(h.jsx)(n.EuiFlexGroup,{justifyContent:"flexStart",alignItems:"center",gutterSize:"s"},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiIcon,{type:"lock"})),Object(h.jsx)(n.EuiFlexItem,null,Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.accessPermissions.title",{defaultMessage:"Access Permissions"})))))),Object(h.jsx)(O.d,{"data-test-subj":"apiKeysAccessCodeEditor",label:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.accessLabel",defaultMessage:"Access"}),helpText:Object(h.jsx)(M,{app:"elasticsearch",doc:"security-api-create-cross-cluster-api-key.html#security-api-create-cross-cluster-api-key-request-body"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.accessHelpText",defaultMessage:"Learn how to structure access permissions."})),fullWidth:!0},Object(h.jsx)(O.b,{as:b.CodeEditorField,name:"access","aria-label":p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.accessCodeEditor",{defaultMessage:"Code editor for access permissions"}),value:N.values.access,options:{readOnly:d||l&&!G},onChange:e=>N.setFieldValue("access",e),validate:e=>{if(!e)return p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.accessRequired",{defaultMessage:"Enter access permissions or disable this option."});try{JSON.parse(e)}catch(e){return k}},fullWidth:!0,languageId:"xjson",height:200,useDarkTheme:A}))):Object(h.jsx)(n.EuiPanel,{hasBorder:!0},Object(h.jsx)("div",{style:{paddingRight:v.size.s}},Object(h.jsx)(n.EuiSwitch,{label:Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.privileges.title",{defaultMessage:"Control security privileges"}))),checked:N.values.customPrivileges,"data-test-subj":"apiKeysRoleDescriptorsSwitch",onChange:e=>N.setFieldValue("customPrivileges",e.target.checked),disabled:d||l&&!G}),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{color:"subdued",size:"xs"},Object(h.jsx)("p",null,p.i18n.translate("xpack.security.accountManagement.apiKeyFlyout.privileges.description",{defaultMessage:"Control access to specific Elasticsearch APIs and resources using predefined roles or custom privileges per API key."})))),N.values.customPrivileges&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiSpacer,null),Object(h.jsx)(n.EuiPanel,{hasShadow:!1,color:"subdued"},Object(h.jsx)(n.EuiFlexGroup,{gutterSize:"none",justifyContent:"flexEnd",alignItems:"baseline"},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiText,{size:"xs"},Object(h.jsx)("h4",null,p.i18n.translate("xpack.security.apiKey.privileges.boilerplate.label",{defaultMessage:"Replace with boilerplate:"})))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiButtonEmpty,{"data-test-subj":"apiKeysReadOnlyDescriptors",onClick:()=>N.setFieldValue("role_descriptors",'{\n  "read-only-role": {\n    "cluster": [],\n    "indices": [\n      {\n        "names": ["*"],\n        "privileges": ["read"]\n      }\n    ]\n  }\n}')},p.i18n.translate("xpack.security.apiKeys.apiKeyFlyout.roleDescriptors.readOnlyLabel",{defaultMessage:"Read-only"}))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiButtonEmpty,{"data-test-subj":"apiKeysWriteOnlyDescriptors",onClick:()=>N.setFieldValue("role_descriptors",'{\n  "write-only-role": {\n    "cluster": [],\n    "indices": [\n      {\n        "names": ["*"],\n        "privileges": ["write"]\n      }\n    ]\n  }\n}')},p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.roleDescriptors.writeOnlyLabel",{defaultMessage:"Write-only"}))))),Object(h.jsx)(O.d,{helpText:Object(h.jsx)(M,{app:"elasticsearch",doc:"security-api-create-api-key.html#security-api-create-api-key-request-body"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.roleDescriptorsHelpText",defaultMessage:"Learn how to structure role descriptors."})),fullWidth:!0,"data-test-subj":"apiKeysRoleDescriptorsCodeEditor"},Object(h.jsx)(O.b,{as:b.CodeEditorField,name:"role_descriptors","aria-label":p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.roleDescriptorsCodeEditor",{defaultMessage:"Code editor for role descriptors of this API key"}),value:N.values.role_descriptors,options:{readOnly:d||l&&!G},onChange:e=>N.setFieldValue("role_descriptors",e),validate:e=>{if(!e)return p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.roleDescriptorsRequired",{defaultMessage:"Enter role descriptors or disable this option."});try{JSON.parse(e)}catch(e){return k}},fullWidth:!0,languageId:"xjson",height:200,useDarkTheme:A})))),Object(h.jsx)(n.EuiSpacer,{size:"l"}),Object(h.jsx)(n.EuiPanel,{hasBorder:!0},Object(h.jsx)("div",{style:{paddingRight:v.size.s}},Object(h.jsx)(n.EuiSwitch,{label:Object(h.jsx)(n.EuiTitle,{size:"xs"},Object(h.jsx)("h4",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.metadata.title",defaultMessage:"Add metadata"}))),"data-test-subj":"apiKeysMetadataSwitch",checked:N.values.includeMetadata,disabled:d||l&&!G,onChange:e=>N.setFieldValue("includeMetadata",e.target.checked)}),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{color:"subdued",size:"xs"},Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.metadata.description",defaultMessage:"Use configurable key-value pairs to add information about the API key or customize Elasticsearch resource access."})))),N.values.includeMetadata&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiSpacer,null),Object(h.jsx)(O.d,{"data-test-subj":"apiKeysMetadataCodeEditor",helpText:Object(h.jsx)(M,{app:"elasticsearch",doc:"security-api-create-api-key.html#security-api-create-api-key-request-body"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyFlyout.metadataHelpText",defaultMessage:"Learn how to structure metadata."})),fullWidth:!0},Object(h.jsx)(O.b,{as:b.CodeEditorField,name:"metadata","aria-label":p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.metadataCodeEditor",{defaultMessage:"Code editor for arbitrary metadata associated with the API key"}),options:{readOnly:d||l&&!G},value:N.values.metadata,onChange:e=>N.setFieldValue("metadata",e),validate:e=>{if(!e)return p.i18n.translate("xpack.security.management.apiKeys.apiKeyFlyout.metadataRequired",{defaultMessage:"Enter metadata or disable this option."});try{JSON.parse(e)}catch(e){return k}},fullWidth:!0,languageId:"xjson",height:200,useDarkTheme:A})))))),Object(h.jsx)(n.EuiFlyoutFooter,null,Object(h.jsx)(n.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiButtonEmpty,{"data-test-subj":"formFlyoutCancelButton",flush:"right",isDisabled:R,onClick:t},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.formFlyout.cancelButton",defaultMessage:"Cancel"}))),!U&&Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiButton,{"data-test-subj":"formFlyoutSubmitButton",isLoading:N.isSubmitting,isDisabled:W,fill:!0,type:"submit"},Y)))))))};function S(e){const t=Object.keys(e.metadata).length>0,a="cross_cluster"!==e.type&&Object.keys(e.role_descriptors).length>0;return{name:e.name,type:e.type,customExpiration:!!e.expiration,expiration:e.expiration?e.expiration.toString():"",includeMetadata:t,metadata:t?JSON.stringify(e.metadata,null,2):"{}",customPrivileges:a,role_descriptors:a?JSON.stringify("cross_cluster"!==e.type&&e.role_descriptors,null,2):"{}",access:"cross_cluster"===e.type?JSON.stringify(e.access,null,2):"{}"}}const I=({type:e})=>"cross_cluster"===e?Object(h.jsx)(n.EuiToolTip,{content:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.crossClusterDescription",defaultMessage:"Allows remote clusters to connect to your local cluster."})},Object(h.jsx)(n.EuiBadge,{color:"hollow",iconType:"cluster"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.crossClusterLabel",defaultMessage:"Cross-Cluster"}))):"managed"===e?Object(h.jsx)(n.EuiToolTip,{content:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.managedDescription",defaultMessage:"Created and managed by Kibana to correctly run background tasks."})},Object(h.jsx)(n.EuiBadge,{color:"hollow",iconType:"gear"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.managedTitle",defaultMessage:"Managed"}))):Object(h.jsx)(n.EuiToolTip,{content:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.restDescription",defaultMessage:"Allows external services to access the Elastic Stack on behalf of a user."})},Object(h.jsx)(n.EuiBadge,{color:"hollow",iconType:"user"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.restTitle",defaultMessage:"Personal"})));var A=a(59),P=a.n(A);const T=({timestamp:e,children:t})=>Object(h.jsx)(n.EuiToolTip,{content:P()(e).format("LLL")},Object(h.jsx)("span",null,null!=t?t:P()(e).fromNow())),w=({expiration:e})=>e?Date.now()>e?Object(h.jsx)(n.EuiHealth,{color:"subdued","data-test-subj":"apiKeyStatus"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpired",defaultMessage:"Expired"})):Object(h.jsx)(n.EuiHealth,{color:"warning","data-test-subj":"apiKeyStatus"},Object(h.jsx)(T,{timestamp:e},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusExpires",defaultMessage:"Expires {timeFromNow}",values:{timeFromNow:P()(e).fromNow()}}))):Object(h.jsx)(n.EuiHealth,{color:"primary","data-test-subj":"apiKeyStatus"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusActive",defaultMessage:"Active"}));var B=a(54);const z=e=>Object(h.jsx)(n.EuiFormControlLayout,i()({},e,{append:Object(h.jsx)(n.EuiCopy,{textToCopy:e.value},(e=>Object(h.jsx)(n.EuiButtonIcon,{"aria-label":p.i18n.translate("xpack.security.copyTokenField.copyButton",{defaultMessage:"Copy to clipboard"}),iconType:"copyClipboard",color:"success",style:{backgroundColor:"transparent"},onClick:e}))),style:{backgroundColor:"transparent"},readOnly:!0}),Object(h.jsx)(n.EuiFieldText,{"data-test-subj":"apiKeyTokenField",controlOnly:!0,"aria-label":p.i18n.translate("xpack.security.copyTokenField.tokenLabel",{defaultMessage:"Token"}),value:e.value,style:{fontFamily:B.euiThemeVars.euiCodeFontFamily,fontSize:B.euiThemeVars.euiFontSizeXS,backgroundColor:"transparent"},onFocus:e=>e.currentTarget.select(),readOnly:!0})),L=e=>{const{options:t,...a}=e,[s,c]=Object(r.useState)(!1),[l,o]=Object(r.useState)(t[0]);Object(r.useEffect)((()=>{t.length>0&&o(t[0])}),[t]);const u=t.findIndex((e=>e.key===l.key)),d=()=>c(!1);return Object(h.jsx)(z,i()({},a,{prepend:Object(h.jsx)(n.EuiPopover,{button:Object(h.jsx)(n.EuiButtonEmpty,{"data-test-subj":"selectableTokenFieldButton",size:"xs",iconType:"arrowDown",iconSide:"right",color:"success",onClick:()=>c(!s)},l.label),isOpen:s,panelPaddingSize:"none",closePopover:d},Object(h.jsx)(n.EuiContextMenuPanel,{initialFocusedItemIndex:2*u,items:t.reduce(((e,a,s)=>(e.push(Object(h.jsx)(n.EuiContextMenuItem,{key:a.key,icon:a.icon,layoutAlign:"top",onClick:()=>{d(),o(a)}},Object(h.jsx)("strong",null,a.label),Object(h.jsx)(n.EuiSpacer,{size:"xs"}),Object(h.jsx)(n.EuiText,{size:"s",color:"subdued"},Object(h.jsx)("p",null,a.description)))),s<t.length-1&&e.push(Object(h.jsx)(n.EuiHorizontalRule,{key:`${a.key}-seperator`,margin:"none"})),e)),[])})),value:l.value}))},_=({createdApiKey:e})=>Object(h.jsx)(n.EuiCallOut,{color:"success",iconType:"check",title:p.i18n.translate("xpack.security.management.apiKeys.createSuccessMessage",{defaultMessage:"Created API key ''{name}''",values:{name:e.name}})},Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.successDescription",defaultMessage:"Copy this key now. You will not be able to view it again."})),Object(h.jsx)(D,{createdApiKey:e})),D=({createdApiKey:e})=>{const t=`${e.id}:${e.api_key}`;return Object(h.jsx)(L,{options:[{key:"encoded",value:e.encoded,icon:"empty",label:p.i18n.translate("xpack.security.management.apiKeys.encodedLabel",{defaultMessage:"Encoded"}),description:p.i18n.translate("xpack.security.management.apiKeys.encodedDescription",{defaultMessage:"Format used to make requests to Elasticsearch REST API."})},{key:"beats",value:t,icon:"logoBeats",label:p.i18n.translate("xpack.security.management.apiKeys.beatsLabel",{defaultMessage:"Beats"}),description:p.i18n.translate("xpack.security.management.apiKeys.beatsDescription",{defaultMessage:"Format used to configure Beats."})},{key:"logstash",value:t,icon:"logoLogstash",label:p.i18n.translate("xpack.security.management.apiKeys.logstashLabel",{defaultMessage:"Logstash"}),description:p.i18n.translate("xpack.security.management.apiKeys.logstashDescription",{defaultMessage:"Format used to configure Logstash."})}]})};var N=a(311),R=a(37),q=a(112),H=a(104);const G=({error:e,readOnly:t,children:a})=>{const{euiTheme:s}=Object(n.useEuiTheme)(),i=(l="apiKeysEmptyPrompt",o="accordion",Object(r.useMemo)((()=>Object(n.htmlIdGenerator)(l)(o)),[l,o]));var l,o;if(e){if(function(e){var t;return-1!==((null===(t=e.body)||void 0===t?void 0:t.message)||"").indexOf('disabled.feature="api_keys"')}(e))return Object(h.jsx)(N.a.EmptyPrompt,{iconType:"warning",body:Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.disabledErrorMessage",defaultMessage:"API keys are disabled."})),Object(h.jsx)("p",null,Object(h.jsx)(H.a,{app:"elasticsearch",doc:"security-settings.html#api-key-service-settings"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.docsLinkText",defaultMessage:"Learn how to enable API keys."}))))});if(function(e){var t;return 403===(null===(t=e.body)||void 0===t?void 0:t.statusCode)}(e))return Object(h.jsx)(N.a.EmptyPrompt,{iconType:"lock",body:Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.forbiddenErrorMessage",defaultMessage:"You do not have permission to manage API keys."}))});const t=()=>{throw e},r=J(e)?Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.badQueryErrorMessage",defaultMessage:"Could not load API keys as the query is incorrect."}):Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.errorMessage",defaultMessage:"Could not load API keys."});return Object(h.jsx)(N.a.EmptyPrompt,{iconType:"warning",body:Object(h.jsx)("p",null,r),actions:Object(h.jsx)(c.a.Fragment,null,a,Object(h.jsx)(n.EuiSpacer,{size:"xl"}),Object(h.jsx)(n.EuiAccordion,{id:i,buttonClassName:Object(q.css)({name:"zl1inp",styles:"display:flex;justify-content:center"}),buttonContent:Object(h.jsx)(n.EuiText,{size:"xs",className:Object(q.css)({fontWeight:s.font.weight.medium},"","")},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.technicalDetailsButton",defaultMessage:"Technical details"})),arrowDisplay:"right",paddingSize:"m"},Object(h.jsx)(n.EuiText,{textAlign:"left"},Object(h.jsx)(n.EuiErrorBoundary,null,Object(h.jsx)(t,null)))))})}return t?Object(h.jsx)(N.a.EmptyPrompt,{iconType:"error",title:Object(h.jsx)("h1",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.readOnlyEmptyTitle",defaultMessage:"You do not have permission to create API keys"})),body:Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.readOnlyEmptyMessage",defaultMessage:"Please contact your administrator for more information"}))}):Object(h.jsx)(N.a.EmptyPrompt,{iconType:"managementApp",title:Object(h.jsx)("h1",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyTitle",defaultMessage:"Create your first API key"})),body:Object(h.jsx)("p",null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeysEmptyPrompt.emptyMessage",defaultMessage:"Allow external services to access the Elastic Stack on your behalf."})),actions:a})};function J(e){const t=(null==e?void 0:e.message)||"";return((null==e?void 0:e.name)||"").indexOf("ResponseError")>-1||t.indexOf("illegal_argument_exception")>-1}var V=a(25),U=a(63);const W="null",$=({selectedOptions:e,defaultOptions:t,options:a,onChange:s,onSearchChange:i,isLoading:l=!1,singleSelection:o=!1,limit:u,height:d,loadingMessage:y,noMatchesMessage:x,emptyMessage:m,errorMessage:g,searchPlaceholder:b,searchInputId:O,selectedStatusMessage:f,limitReachedMessage:M,nullOptionLabel:E,nullOptionProps:F,defaultOptionsLabel:k,clearButtonLabel:K,...C})=>{const[v,S]=Object(r.useState)([]),[I,A]=Object(r.useState)(""),P=e?e.length:0,T=!!u&&P>=u,w=()=>{a||S((a=>{const s=[...a],i=e?e.filter((e=>!s.find((t=>Q(t,e))))).map((e=>Y(e,E,F))):[],n=t?t.filter((e=>!s.find((t=>Q(t,e)))&&!i.find((t=>Q(t,e))))).map((e=>Y(e,E,F))):[];if(n.length){const e=(e=>{let t=e.findIndex((e=>e.isGroupLabel));return-1===t&&(t=e.push({label:null!=k?k:p.i18n.translate("userProfileComponents.userProfilesSelectable.defaultOptionsLabel",{defaultMessage:"Suggested"}),isGroupLabel:!0})-1),t})(s);s.splice(e,0,...i),s.push(...n)}else s.push(...i);return s}))};return Object(r.useEffect)((()=>{a?S(a.map((e=>Y(e,E,F)))):(S([]),w())}),[a]),Object(r.useEffect)(w,[t,e]),Object(r.useEffect)((()=>{S((t=>t.map((t=>{if(e){var a;const s=void 0===e.find((e=>Q(t,e)))?void 0:"on",i=!s&&T;return{...t,checked:s,disabled:i,prepend:t.data?Object(h.jsx)(U.a,{user:t.data.user,avatar:null===(a=t.data.data)||void 0===a?void 0:a.avatar,size:"s",isDisabled:i}):void 0}}return{...t,checked:void 0,disabled:void 0}}))))}),[a,t,e]),Object(h.jsx)(n.EuiSelectable,{"data-test-subj":C["data-test-subj"],options:v,onChange:t=>{if(!s)return;const a=t.filter((t=>!(t.isGroupLabel||"on"!==t.checked||e&&void 0!==e.find((e=>Q(t,e)))))).map((e=>e.key===W?null:e.data));e&&!o&&e.forEach((e=>{const s=t.find((t=>Q(t,e)));void 0!==s&&"on"!==s.checked||(s&&s.key===W?a.unshift(e):a.push(e))})),s(a)},style:{maxHeight:d},singleSelection:o,searchable:!0,searchProps:{placeholder:null!=b?b:p.i18n.translate("userProfileComponents.userProfilesSelectable.searchPlaceholder",{defaultMessage:"Search"}),value:I,onChange:e=>{A(e),null==i||i(e)},isLoading:l,isClearable:!l,id:O},isPreFiltered:!0,listProps:{onFocusBadge:!1,rowHeight:48},loadingMessage:y,noMatchesMessage:x,emptyMessage:m,errorMessage:g,renderOption:(e,t)=>{if(e.user){const a=Object(V.e)(e.user);return Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)("div",{className:"eui-textTruncate"},Object(h.jsx)(n.EuiHighlight,{search:t},a)),e.user.email&&e.user.email!==a?Object(h.jsx)(n.EuiText,{size:"xs",color:e.disabled?"disabled":"subdued",className:"eui-textTruncate"},t?Object(h.jsx)(n.EuiHighlight,{search:t},e.user.email):e.user.email):void 0)}return Object(h.jsx)(n.EuiHighlight,{search:t},e.label)}},((e,t)=>Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiPanel,{hasShadow:!1,paddingSize:"s"},t,o?void 0:Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiSpacer,{size:"s"}),Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s",responsive:!1},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiText,{size:"xs",color:"subdued"},f?f(P):Object(h.jsx)(j.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.selectedStatusMessage",defaultMessage:"{count, plural, one {# user selected} other {# users selected}}",values:{count:P}}))),Object(h.jsx)(n.EuiFlexItem,{grow:!1},P?Object(h.jsx)(n.EuiButtonEmpty,{size:"xs",flush:"right",onClick:()=>null==s?void 0:s([]),style:{height:"1rem"}},null!=K?K:Object(h.jsx)(j.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.clearButtonLabel",defaultMessage:"Remove all users"})):void 0)))),u&&P>=u?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiHorizontalRule,{margin:"none"}),Object(h.jsx)(n.EuiCallOut,{title:M?M(u):Object(h.jsx)(j.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.limitReachedMessage",defaultMessage:"You've selected the maximum of {count, plural, one {# user} other {# users}}",values:{count:u}}),color:"warning",size:"s"})):void 0,Object(h.jsx)(n.EuiHorizontalRule,{margin:"none"}),e)))};function Y(e,t,a){return e?{key:e.uid,label:Object(V.d)(e.user),data:e,"data-test-subj":`userProfileSelectableOption-${e.user.username}`}:{key:W,label:null!=t?t:p.i18n.translate("userProfileComponents.userProfilesSelectable.nullOptionLabel",{defaultMessage:"No users"}),"data-test-subj":"userProfileSelectableOption-null",...a}}function Q(e,t){return e.key===(t?t.uid:W)}const X=({title:e,selectableProps:t,...a})=>{const s=Object(n.useGeneratedHtmlId)({prefix:"searchInput",conditionalId:t.searchInputId});return Object(h.jsx)(n.EuiPopover,i()({panelPaddingSize:"none",initialFocus:`#${s}`},a),Object(h.jsx)(n.EuiContextMenuPanel,{title:e},Object(h.jsx)($,i()({},t,{searchInputId:s}))))},Z=1e4,ee=Object(r.createContext)({types:[],usernames:[],filters:{},onFilterChange:()=>{}}),te=({apiKeys:e,createdApiKey:t,currentUser:a,onClick:s,onDelete:i,canManageApiKeys:l=!1,canManageOwnApiKeys:o=!1,readOnly:u=!1,loading:d=!1,totalItemCount:y=0,onTableChange:x,pagination:m,onSearchChange:g,aggregations:b,sortingOptions:O,queryErrors:f,resetQuery:M,query:E,queryFilters:F,onFilterChange:k})=>{const K=[],[C,v]=Object(r.useState)([]),{typeFilters:S,usernameFilters:A,expired:P}=re(b),B=e=>l||o&&e.username===a.username,z=f&&J(f),L=z?[]:e;K.push({field:"name",name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.nameColumnName",defaultMessage:"Name"}),sortable:!0,render:(e,t)=>Object(h.jsx)(n.EuiLink,{onClick:()=>s(t),"data-test-subj":`apiKeyRowName-${t.name}`},e)},{field:"type",name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.typeColumnName",defaultMessage:"Type"}),sortable:!0,render:(e,t)=>{var a;let s=e;return 0!==t.name.indexOf("Alerting: ")&&!0!==(null===(a=t.metadata)||void 0===a?void 0:a.managed)||(s="managed"),Object(h.jsx)(I,{type:s})}}),(l||A.length>1)&&K.push({field:"username",name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.ownerColumnName",defaultMessage:"Owner"}),sortable:!0,render:e=>Object(h.jsx)(ne,{username:e})}),K.push({field:"creation",name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createdColumnName",defaultMessage:"Created"}),sortable:!0,mobileOptions:{show:!1},render:(e,a)=>Object(h.jsx)(T,{timestamp:e},a.id===(null==t?void 0:t.id)?Object(h.jsx)(n.EuiBadge,{color:"success"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createdBadge",defaultMessage:"Just now"})):null)},{field:"expiration",name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.statusColumnName",defaultMessage:"Status"}),sortable:!0,render:e=>Object(h.jsx)(w,{expiration:e})}),u||K.push({width:"40px",actions:[{name:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.deleteAction",defaultMessage:"Delete"}),description:p.i18n.translate("xpack.security.management.apiKeys.table.deleteDescription",{defaultMessage:"Delete this API key"}),icon:"trash",type:"icon",color:"danger",onClick:e=>i([e]),available:B,"data-test-subj":"apiKeysTableDeleteAction"}]});const _=[];S.length>1&&_.push({type:"custom_component",component:ae}),P>0&&_.push({type:"custom_component",component:se}),A.length>1&&_.push({type:"custom_component",component:ie});const D=y>Z;return Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(ee.Provider,{value:{types:[...S],usernames:[...A],filters:F,onFilterChange:k}},Object(h.jsx)(n.EuiSearchBar,{query:E,box:{incremental:!0,schema:{strict:!0,fields:{name:{type:"string"},type:{type:"string"},username:{type:"string"},owner:{type:"string"},expired:{type:"boolean"}}}},filters:_,onChange:g,toolsLeft:C.length?Object(h.jsx)(n.EuiButton,{onClick:()=>i(C),color:"danger",iconType:"trash","data-test-subj":"bulkInvalidateActionButton"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.invalidateApiKeyButton",defaultMessage:"Delete {count, plural, one {API key} other {# API keys}}",values:{count:C.length}})):void 0})),Object(h.jsx)(n.EuiSpacer,{size:"s"}),z?Object(h.jsx)(G,{error:f},Object(h.jsx)(n.EuiButton,{iconType:"refresh",onClick:()=>{M()}},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeys.resetQueryButton",defaultMessage:"Reset query"}))):Object(h.jsx)(c.a.Fragment,null,D&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiText,{color:"subdued",size:"s","data-test-subj":"apiKeysTableTooManyResultsLabel"},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.tooManyResultsLabel",defaultMessage:"Showing {limit} of {totalItemCount, plural, one {# api key} other {# api keys}}",values:{totalItemCount:y,limit:Z}})),Object(h.jsx)(n.EuiSpacer,{size:"s"})),Object(h.jsx)(n.EuiBasicTable,{items:L,itemId:"id",columns:K,loading:d,pagination:m,onChange:x,selection:u?void 0:{selectable:B,onSelectionChange:v},sorting:{sort:{field:O.field,direction:O.direction}}})))},ae=({query:e,onChange:t})=>{const{types:a,filters:s,onFilterChange:i}=Object(r.useContext)(ee);return t?Object(h.jsx)(c.a.Fragment,null,a.includes("rest")?Object(h.jsx)(n.EuiFilterButton,{iconType:"user",iconSide:"left",hasActiveFilters:"rest"===s.type,onClick:()=>{i({...s,type:"rest"===s.type?void 0:"rest"})},withNext:a.includes("cross_cluster")||a.includes("managed")},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.restTitle",defaultMessage:"Personal"})):null,a.includes("cross_cluster")?Object(h.jsx)(n.EuiFilterButton,{iconType:"cluster",iconSide:"left",hasActiveFilters:"cross_cluster"===s.type,onClick:()=>{i({...s,type:"cross_cluster"===s.type?void 0:"cross_cluster"})},withNext:a.includes("managed")},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.crossClusterLabel",defaultMessage:"Cross-Cluster"})):null,a.includes("managed")?Object(h.jsx)(n.EuiFilterButton,{iconType:"gear",iconSide:"left",hasActiveFilters:"managed"===s.type,onClick:()=>{i({...s,type:"managed"===s.type?void 0:"managed"})}},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeyBadge.managedTitle",defaultMessage:"Managed"})):null):null},se=({query:e,onChange:t})=>{const{filters:a,onFilterChange:s}=Object(r.useContext)(ee);return t?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiFilterButton,{hasActiveFilters:!1===a.expired,onClick:()=>{!1===a.expired?s({...a,expired:void 0}):s({...a,expired:!1})},withNext:!0},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.activeFilter",defaultMessage:"Active"})),Object(h.jsx)(n.EuiFilterButton,{hasActiveFilters:!0===a.expired,onClick:()=>{!0===a.expired?s({...a,expired:void 0}):s({...a,expired:!0})}},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.expiredFilter",defaultMessage:"Expired"}))):null},ie=({query:e,onChange:t})=>{const{usernames:a,filters:s,onFilterChange:i}=Object(r.useContext)(ee),c=s.usernames||[],[l,o]=Object(r.useState)(!1),[u,d]=Object(r.useState)("");if(!t)return null;let p=0;const y=s.usernames||[];y.length&&(p=y.length);const x=u?a.filter((e=>e.includes(u))):a;return Object(h.jsx)(X,{button:Object(h.jsx)(n.EuiFilterButton,{iconType:"arrowDown",onClick:()=>o((e=>!e)),isSelected:l,numFilters:a.length,hasActiveFilters:!!p,numActiveFilters:p},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.ownerFilter",defaultMessage:"Owner"})),isOpen:l,panelPaddingSize:"none",anchorPosition:"downCenter",panelClassName:"euiFilterGroup__popoverPanel",closePopover:()=>o(!1),selectableProps:{options:x.map((e=>({uid:e,user:{username:e},enabled:!1,data:{}}))),onSearchChange:d,selectedOptions:a.filter((e=>c.includes(e))).map((e=>({uid:e,user:{username:e},enabled:!1,data:{}}))),onChange:e=>{const t=e.map((e=>e.user.username));i({...s,usernames:t})}}})},ne=({username:e})=>Object(h.jsx)(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(U.a,{user:{username:e},size:"s"})),Object(h.jsx)(n.EuiFlexItem,{grow:!1},Object(h.jsx)(n.EuiText,{size:"s","data-test-subj":"apiKeyUsername"},e))),re=e=>{const t=[],a=[];let s=0;if(e&&Object.keys(e).length>0){var i;const{usernames:n,types:r,expired:c,managed:l}=e,o=null!=r&&r.buckets.length?r.buckets:[],u=null!=n&&n.buckets.length?n.buckets:[];o.forEach((e=>{t.push(e.key)})),u.forEach((e=>{a.push(e.key)}));const{namePrefixBased:d,metadataBased:p}=(null==l?void 0:l.buckets)||{};(null!=d&&d.doc_count&&d.doc_count>0||null!=p&&p.doc_count&&p.doc_count>0)&&t.push("managed"),s=null!==(i=null==c?void 0:c.doc_count)&&void 0!==i?i:0}return{typeFilters:t,usernameFilters:a,expired:s}},ce=({isAdmin:e,children:t,notifications:a,apiKeysAPIClient:s})=>{const[i,c]=Object(r.useState)([]),[l,o]=Object(r.useState)(!1),u=Object(r.useRef)(null),d=()=>{o(!1),c([])},j=async()=>{let t,n,r;try{t=await s.invalidateApiKeys(i,e)}catch(e){n=e}if(d(),t){const{itemsInvalidated:e}=t;if(({errors:r}=t),e&&e.length){const t=e.length>1?p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successMultipleNotificationTitle",{defaultMessage:"Deleted {count} API keys",values:{count:e.length}}):p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.successSingleNotificationTitle",{defaultMessage:"Deleted API key ''{name}''",values:{name:e[0].name}});a.toasts.addSuccess(t),u.current&&u.current([...e])}}if(n||r&&r.length){const e=r&&r.length>1||n&&i.length>1?p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorMultipleNotificationTitle",{defaultMessage:"Error deleting {count} apiKeys",values:{count:r&&r.length||i.length}}):p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.errorSingleNotificationTitle",{defaultMessage:"Error deleting API key ''{name}''",values:{name:r&&r[0].name||i[0].name}});a.toasts.addDanger(e)}};return Object(h.jsx)(r.Fragment,null,t(((e,t=(()=>{}))=>{if(!e||!e.length)throw new Error("No API key IDs specified for deletion");o(!0),c(e),u.current=t})),(()=>{if(!l)return null;const e=1===i.length;return Object(h.jsx)(n.EuiConfirmModal,{role:"dialog",title:e?p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteSingleTitle",{defaultMessage:"Delete API key ''{name}''?",values:{name:i[0].name}}):p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleTitle",{defaultMessage:"Delete {count} API keys?",values:{count:i.length}}),onCancel:d,onConfirm:j,cancelButtonText:p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.cancelButtonLabel",{defaultMessage:"Cancel"}),confirmButtonText:p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.confirmButtonLabel",{defaultMessage:"Delete {count, plural, one {API key} other {API keys}}",values:{count:i.length}}),buttonColor:"danger","data-test-subj":"invalidateApiKeyConfirmationModal"},e?null:Object(h.jsx)(r.Fragment,null,Object(h.jsx)("p",null,p.i18n.translate("xpack.security.management.apiKeys.deleteApiKey.confirmModal.deleteMultipleListDescription",{defaultMessage:"You are about to delete these API keys:"})),Object(h.jsx)("ul",null,i.map((({name:e,id:t})=>Object(h.jsx)("li",{key:t},e))))))})())};var le=a(7),oe=a(38),ue=a(17);const de={query:n.EuiSearchBar.Query.MATCH_ALL,sort:{field:"creation",direction:"desc"},from:0,size:25,filters:{}},pe=()=>{const{services:e}=Object(y.useKibana)(),t=Object(l.useHistory)(),a=Object(ue.b)(),[s,o]=Object(r.useState)(),[x,m]=Object(r.useState)(),g=!Object(oe.a)("api_keys").save,[b,O]=Object(r.useState)(de),[f,M]=u()((t=>{const s=n.EuiSearchBar.Query.toESQuery(t.query),i={...t,query:s};return Promise.all([new APIKeysAPIClient(e.http).queryApiKeys(i),a.getCurrentUser()])}),[]),E=()=>{O(de),M(de)},F=({page:e,sort:t})=>{const a={...b,from:(null==e?void 0:e.index)*(null==e?void 0:e.size),size:null==e?void 0:e.size,sort:null!=t?t:b.sort};O(a),M(a)},k=e=>{if(!e.error){const t={...b,query:e.query};O(t),M(t)}},K=e=>{const t={...b,filters:{...b.filters,...e}};O(t),M(t)};if(Object(r.useEffect)((()=>{M(de)}),[]),!f.value)return f.loading?Object(h.jsx)(d.SectionLoading,null,Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.loadingApiKeysDescription",defaultMessage:"Loading API keys…"})):Object(h.jsx)(G,{error:f.error},Object(h.jsx)(n.EuiButton,{iconType:"refresh",onClick:()=>M(b)},Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.accountManagement.apiKeys.retryButton",defaultMessage:"Try again"})));const[{aggregations:C,canManageApiKeys:S,apiKeys:I,canManageOwnApiKeys:A,canManageCrossClusterApiKeys:P,aggregationTotal:T,total:w,queryError:B},z]=f.value,L=B?[]:I.map((e=>e)),D=Math.min(w,T,Z),q={pageIndex:b.from/b.size,pageSize:b.size,totalItemCount:D,pageSizeOptions:[25,50,100]};return Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(R.b,{path:"/create"},Object(h.jsx)(le.a,{text:p.i18n.translate("xpack.security.management.apiKeys.createBreadcrumb",{defaultMessage:"Create"}),href:"/create"},Object(h.jsx)(v,{onSuccess:e=>{t.push({pathname:"/"}),o(e),M(b)},onCancel:()=>t.push({pathname:"/"}),canManageCrossClusterApiKeys:P,currentUser:z,isLoadingCurrentUser:f.loading,readOnly:g}))),x&&Object(h.jsx)(v,{onSuccess:()=>{e.notifications.toasts.addSuccess({title:p.i18n.translate("xpack.security.management.apiKeys.updateSuccessMessage",{defaultMessage:"Updated API key ''{name}''",values:{name:x.name}}),"data-test-subj":"updateApiKeySuccessToast"}),m(void 0),M(de)},onCancel:()=>m(void 0),apiKey:x,readOnly:g,canManageCrossClusterApiKeys:P,currentUser:z,isLoadingCurrentUser:f.loading}),0===T?Object(h.jsx)(G,{readOnly:g},Object(h.jsx)(n.EuiButton,i()({},Object(y.reactRouterNavigate)(t,"/create"),{fill:!0,iconType:"plusInCircleFilled","data-test-subj":"apiKeysCreatePromptButton"}),Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"}))):Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(N.a.Header,{pageTitle:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysTitle",defaultMessage:"API keys"}),description:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.apiKeysAllDescription",defaultMessage:"Allow external services to access the Elastic Stack on behalf of a user."}),rightSideItems:g?void 0:[Object(h.jsx)(n.EuiButton,i()({},Object(y.reactRouterNavigate)(t,"/create"),{fill:!0,iconType:"plusInCircleFilled","data-test-subj":"apiKeysCreateTableButton"}),Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.createButton",defaultMessage:"Create API key"}))],paddingSize:"none",bottomBorder:!0}),Object(h.jsx)(n.EuiSpacer,null),Object(h.jsx)(N.a.Section,{paddingSize:"none"},s&&Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(_,{createdApiKey:s}),Object(h.jsx)(n.EuiSpacer,null)),A&&!S?Object(h.jsx)(c.a.Fragment,null,Object(h.jsx)(n.EuiCallOut,{title:Object(h.jsx)(j.FormattedMessage,{id:"xpack.security.management.apiKeys.table.manageOwnKeysWarning",defaultMessage:"You only have permission to manage your own API keys."})}),Object(h.jsx)(n.EuiSpacer,null)):void 0,Object(h.jsx)(ce,{isAdmin:S,notifications:e.notifications,apiKeysAPIClient:new APIKeysAPIClient(e.http)},(e=>Object(h.jsx)(te,{apiKeys:L,onClick:e=>m(e),query:b.query,queryFilters:b.filters,onDelete:t=>e(t.map((({name:e,id:t})=>({name:e,id:t}))),(()=>M(b))),currentUser:z,createdApiKey:s,canManageCrossClusterApiKeys:P,canManageApiKeys:S,canManageOwnApiKeys:A,readOnly:g,loading:f.loading,totalItemCount:w,pagination:q,onTableChange:F,onSearchChange:k,onFilterChange:K,aggregations:C,sortingOptions:b.sort,queryErrors:B,resetQuery:E}))))))}}}]);