/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[14],{315:function(e,t,s){"use strict";s.r(t),s.d(t,"RolesGridPage",(function(){return k}));var a=s(10),o=s.n(a),n=s(4),l=s(16),r=s.n(l),i=s(2),c=s.n(i),d=s(3),u=s(13),m=s(11),j=s(311),g=s(1),b=s.n(g),p=s(29),x=s(0);class confirm_delete_ConfirmDelete extends i.Component{constructor(e){super(e),b()(this,"onConfirmDelete",(()=>{this.setState({deleteInProgress:!0},(()=>{this.deleteRoles()}))})),b()(this,"deleteRoles",(async()=>{const{rolesToDelete:e,callback:t,rolesAPIClient:s,notifications:a,buildFlavor:o}=this.props,l=[],r=e.map((e=>(async()=>{try{await s.deleteRole(e),"traditional"===o&&a.toasts.addSuccess(d.i18n.translate("xpack.security.management.roles.confirmDelete.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role {roleName}",values:{roleName:e}}))}catch(t){l.push(e),a.toasts.addDanger(d.i18n.translate("xpack.security.management.roles.confirmDelete.roleDeletingErrorNotificationMessage",{defaultMessage:"Error deleting role {roleName}",values:{roleName:e}}))}})()));await Promise.all(r),"serverless"===o&&this.props.notifications.toasts.addDanger({title:d.i18n.translate("xpack.security.management.roles.deleteRolesSuccessTitle",{defaultMessage:"{numberOfCustomRoles, plural, one {# custom role} other {# custom roles}} deleted",values:{numberOfCustomRoles:r.length}}),text:Object(p.a)(Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)("p",null,d.i18n.translate("xpack.security.management.roles.deleteRolesSuccessMessage",{defaultMessage:"The deleted role will still appear listed on the user profile in Organization\n                  Management and on the User Profile for those that don't have admin access."})),Object(x.jsx)(n.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(x.jsx)(n.EuiFlexItem,{grow:!1},Object(x.jsx)(n.EuiButton,{size:"s",href:this.props.cloudOrgUrl},"Manage Members")))),this.props)}),t(e,l)})),this.state={deleteInProgress:!1}}render(){const{rolesToDelete:e,buildFlavor:t}=this.props,s=e.length>1,a=d.i18n.translate("xpack.security.management.roles.deleteRoleTitle",{defaultMessage:"Delete role{value, plural, one {{roleName}} other {s}}?",values:{value:e.length,roleName:` ${e[0]}`}});return Object(x.jsx)(n.EuiModal,{onClose:this.props.onCancel},Object(x.jsx)(n.EuiModalHeader,null,Object(x.jsx)(n.EuiModalHeaderTitle,{"data-test-subj":"confirmModalTitleText"},a)),Object(x.jsx)(n.EuiModalBody,null,Object(x.jsx)(n.EuiText,null,s?Object(x.jsx)(i.Fragment,null,"traditional"===t&&Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.removingRolesDescription",defaultMessage:"You are about to delete these roles:"})),"serverless"===t&&Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.serverless.removingRolesDescription",defaultMessage:"Users with the following roles assigned may lose access to the project if they are not assigned any other roles:"})),Object(x.jsx)("ul",null,e.map((e=>Object(x.jsx)("li",{key:e},e))))):Object(x.jsx)(i.Fragment,null,"serverless"===t&&Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.serverless.removingSingleRoleDescription",defaultMessage:"Users with the {roleName} role assigned may lose access to the project if they are not assigned any other roles.",values:{roleName:e[0]}}))),"traditional"===t&&Object(x.jsx)("p",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.deletingRolesWarningMessage",defaultMessage:"You can't undo this operation."})))),Object(x.jsx)(n.EuiModalFooter,null,Object(x.jsx)(n.EuiButtonEmpty,{"data-test-subj":"confirmModalCancelButton",onClick:this.props.onCancel,isDisabled:this.state.deleteInProgress},Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.cancelButtonLabel",defaultMessage:"Cancel"})),Object(x.jsx)(n.EuiButton,{"data-test-subj":"confirmModalConfirmButton",onClick:this.onConfirmDelete,fill:!0,color:"danger",isLoading:this.state.deleteInProgress},Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.confirmDelete.deleteButtonLabel",defaultMessage:"Delete"}))))}}const O=()=>Object(x.jsx)(n.EuiPageSection,{alignment:"center",color:"danger"},Object(x.jsx)(n.EuiEmptyPrompt,{iconType:"securityApp",title:Object(x.jsx)("h2",null,Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.deniedPermissionTitle",defaultMessage:"You need permission to manage roles"})),body:Object(x.jsx)("p",{"data-test-subj":"permissionDeniedMessage"},Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.noPermissionToManageRolesDescription",defaultMessage:"Contact your system administrator."}))}));var f=s(21),h=s(86);const y=(e,t)=>`/${e}${t?`/${encodeURIComponent(t)}`:""}`,M=(e,t,s)=>e.filter((e=>{const a=`${e.name}`.toLowerCase(),o=t.toLowerCase();return-1!==a.indexOf(o)&&(s||!Object(f.m)(e))})),v={query:n.EuiSearchBar.Query.MATCH_ALL,sort:{field:"creation",direction:"desc"},from:0,size:25,filters:{}},k=({notifications:e,rolesAPIClient:t,history:s,readOnly:a,buildFlavor:l,cloudOrgUrl:g,analytics:b,theme:p,i18n:k})=>{const[C,R]=Object(i.useState)([]),[E,F]=Object(i.useState)([]),[S,D]=Object(i.useState)([]),[N,T]=Object(i.useState)(""),[w,B]=Object(i.useState)(!1),[P,z]=Object(i.useState)(!1),[I,L]=Object(i.useState)(!0),[A,_]=Object(i.useState)(!1),[$,U]=Object(i.useState)(v);Object(i.useEffect)((()=>{H()}),[]);const H=async()=>{try{_(!0);const e=await t.getRoles();R(e),F(M(e,N,I))}catch(t){403===r.a.get(t,"body.statusCode")?z(!0):e.toasts.addDanger(d.i18n.translate("xpack.security.management.roles.fetchingRolesErrorMessage",{defaultMessage:"Error fetching roles: {message}",values:{message:r.a.get(t,"body.message","")}}))}finally{_(!1)}},G=e=>{L(e.target.checked),F(M(C,N,e.target.checked))},q={pageIndex:$.from/$.size,pageSize:$.size,totalItemCount:E.length,pageSizeOptions:[25,50,100]};return P?Object(x.jsx)(O,null):Object(x.jsx)(c.a.Fragment,null,Object(x.jsx)(j.a.Header,{bottomBorder:!0,"data-test-subj":"rolesGridPageHeader",pageTitle:"serverless"===l?Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.customRoleTitle",defaultMessage:"Custom Roles"}):Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.roleTitle",defaultMessage:"Roles"}),description:"serverless"===l?Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.customRolesSubtitle",defaultMessage:"In addition to the predefined roles on the system, you can create your own roles and provide your users with the exact set of privileges that they need."}):Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.subtitle",defaultMessage:"Apply roles to groups of users and manage permissions across the stack."}),rightSideItems:a?void 0:[Object(x.jsx)(n.EuiButton,o()({"data-test-subj":"createRoleButton"},Object(m.reactRouterNavigate)(s,y("edit")),{fill:!0,iconType:"plusInCircleFilled"}),Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.createRoleButtonLabel",defaultMessage:"Create role"})),"serverless"===l&&Object(x.jsx)(n.EuiButtonEmpty,{href:g,target:"_blank",iconSide:"right",iconType:"popout"},Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.assignRolesLinkLabel",defaultMessage:"Assign roles"}))]}),Object(x.jsx)(n.EuiSpacer,{size:"l"}),Object(x.jsx)(j.a.Section,{paddingSize:"none"},w?Object(x.jsx)(confirm_delete_ConfirmDelete,{onCancel:()=>{B(!1)},rolesToDelete:S.map((e=>e.name)),callback:()=>{D([]),B(!1),H()},cloudOrgUrl:g,notifications:e,rolesAPIClient:t,buildFlavor:l,theme:p,analytics:b,i18n:k}):null,Object(x.jsx)(n.EuiSearchBar,{box:{incremental:!0,"data-test-subj":"searchRoles"},onChange:e=>{T(e.queryText),F(M(C,e.queryText,I))},toolsLeft:(()=>{if(0===S.length)return;const e=S.length;return Object(x.jsx)(n.EuiButton,{"data-test-subj":"deleteRoleButton",color:"danger",onClick:()=>B(!0)},Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.deleteSelectedRolesButtonLabel",defaultMessage:"Delete {numSelected} role{numSelected, plural, one { } other {s}}",values:{numSelected:e}}))})(),toolsRight:(()=>{if("serverless"!==l)return Object(x.jsx)(n.EuiSwitch,{"data-test-subj":"showReservedRolesSwitch",label:Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.showReservedRolesLabel",defaultMessage:"Show reserved roles"}),checked:I,onChange:G})})()}),Object(x.jsx)(n.EuiSpacer,{size:"s"}),Object(x.jsx)(n.EuiBasicTable,{"data-test-subj":"rolesTable",itemId:"name",columns:(()=>{const e=[{field:"name",name:d.i18n.translate("xpack.security.management.roles.nameColumnName",{defaultMessage:"Role"}),sortable:!0,render:e=>Object(x.jsx)(n.EuiText,{color:"subdued",size:"s"},Object(x.jsx)(n.EuiLink,o()({"data-test-subj":"roleRowName"},Object(m.reactRouterNavigate)(s,y("edit",e))),e))},{field:"description",name:d.i18n.translate("xpack.security.management.roles.descriptionColumnName",{defaultMessage:"Role Description"}),sortable:!0,truncateText:{lines:3},render:(e,t)=>Object(x.jsx)(n.EuiToolTip,{position:"top",content:e,display:"block"},Object(x.jsx)(n.EuiText,{color:"subdued",size:"s","data-test-subj":`roleRowDescription-${t.name}`},e))}];return"serverless"!==l&&e.push({field:"metadata",name:d.i18n.translate("xpack.security.management.roles.statusColumnName",{defaultMessage:"Status"}),sortable:e=>Object(f.k)(e)&&!Object(f.j)(e),render:(e,t)=>(e=>{const t=Object(f.k)(e),s=Object(f.j)(e),a=Object(f.m)(e),o=[];return t||o.push(Object(x.jsx)(h.b,{"data-test-subj":"roleDisabled"})),a&&o.push(Object(x.jsx)(h.d,{"data-test-subj":"roleReserved",tooltipContent:Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.reservedRoleBadgeTooltip",defaultMessage:"Reserved roles are built-in and cannot be edited or removed."})})),s&&o.push(Object(x.jsx)(h.a,{"data-test-subj":"roleDeprecated",tooltipContent:Object(f.e)(e)})),Object(x.jsx)(n.EuiFlexGroup,{gutterSize:"s"},o.map(((e,t)=>Object(x.jsx)(n.EuiFlexItem,{key:t,grow:!1},e))))})(t)}),a||e.push({name:d.i18n.translate("xpack.security.management.roles.actionsColumnName",{defaultMessage:"Actions"}),width:"150px",actions:[{type:"icon",icon:"copy",isPrimary:!0,available:e=>!Object(f.m)(e),name:d.i18n.translate("xpack.security.management.roles.cloneRoleActionName",{defaultMessage:"Clone"}),description:e=>d.i18n.translate("xpack.security.management.roles.cloneRoleActionLabel",{defaultMessage:"Clone {roleName}",values:{roleName:e.name}}),href:e=>Object(m.reactRouterNavigate)(s,y("clone",e.name)).href,onClick:(e,t)=>Object(m.reactRouterNavigate)(s,y("clone",e.name)).onClick(t),"data-test-subj":e=>`clone-role-action-${e.name}`},{type:"icon",icon:"trash",color:"danger",name:d.i18n.translate("xpack.security.management.roles.deleteRoleActionName",{defaultMessage:"Delete"}),description:e=>d.i18n.translate("xpack.security.management.roles.deleteRoleActionLabel",{defaultMessage:"Delete {roleName}",values:{roleName:e.name}}),"data-test-subj":e=>`delete-role-action-${e.name}`,onClick:e=>(D([e]),void B(!0)),available:e=>!e.metadata||!e.metadata._reserved},{isPrimary:!0,type:"icon",icon:"pencil",name:d.i18n.translate("xpack.security.management.roles.editRoleActionName",{defaultMessage:"Edit"}),description:e=>d.i18n.translate("xpack.security.management.roles.editRoleActionLabel",{defaultMessage:"Edit {roleName}",values:{roleName:e.name}}),"data-test-subj":e=>`edit-role-action-${e.name}`,href:e=>Object(m.reactRouterNavigate)(s,y("edit",e.name)).href,onClick:(e,t)=>Object(m.reactRouterNavigate)(s,y("edit",e.name)).onClick(t),available:e=>!Object(f.l)(e),enabled:()=>0===S.length}]}),e})(),selection:a?void 0:{selectable:e=>!e.metadata||!e.metadata._reserved,selectableMessage:e=>e?"":"Role is reserved",onSelectionChange:e=>D(e),selected:S},onChange:({page:e,sort:t})=>{const s={...$,from:(null==e?void 0:e.index)*(null==e?void 0:e.size),size:null==e?void 0:e.size};U(s)},pagination:q,noItemsMessage:"serverless"===l?Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.noCustomRolesFound",defaultMessage:"No custom roles to show"}):Object(x.jsx)(u.FormattedMessage,{id:"xpack.security.management.roles.noRolesFound",defaultMessage:"No items found"}),items:E,loading:A,sorting:{sort:{field:"name",direction:"asc"}},rowProps:{"data-test-subj":"roleRow"}})))}},86:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return c})),s.d(t,"d",(function(){return d}));var a=s(4),o=(s(2),s(13)),n=s(0);const l=e=>e.tooltipContent?Object(n.jsx)(a.EuiToolTip,{content:e.tooltipContent},e.children):e.children,r=e=>Object(n.jsx)(l,{tooltipContent:e.tooltipContent},Object(n.jsx)(a.EuiBadge,{"data-test-subj":e["data-test-subj"],color:"warning"},Object(n.jsx)(o.FormattedMessage,{id:"xpack.security.management.deprecatedBadge",defaultMessage:"Deprecated"}))),i=e=>Object(n.jsx)(l,{tooltipContent:e.tooltipContent},Object(n.jsx)(a.EuiBadge,{"data-test-subj":e["data-test-subj"],color:"hollow"},Object(n.jsx)(o.FormattedMessage,{id:"xpack.security.management.disabledBadge",defaultMessage:"Disabled"}))),c=e=>Object(n.jsx)(l,{tooltipContent:e.tooltipContent},Object(n.jsx)(a.EuiBadge,{"data-test-subj":e["data-test-subj"],color:"success"},Object(n.jsx)(o.FormattedMessage,{id:"xpack.security.management.enabledBadge",defaultMessage:"Enabled"}))),d=e=>Object(n.jsx)(l,{tooltipContent:e.tooltipContent},Object(n.jsx)(a.EuiBadge,{"data-test-subj":e["data-test-subj"],color:"primary"},Object(n.jsx)(o.FormattedMessage,{id:"xpack.security.management.reservedBadge",defaultMessage:"Reserved"})))}}]);