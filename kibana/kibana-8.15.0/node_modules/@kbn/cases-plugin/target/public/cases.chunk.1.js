/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.cases_bundle_jsonpfunction=window.cases_bundle_jsonpfunction||[]).push([[1],{134:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"o",(function(){return c})),n.d(t,"L",(function(){return o})),n.d(t,"A",(function(){return l})),n.d(t,"bb",(function(){return u})),n.d(t,"V",(function(){return d})),n.d(t,"E",(function(){return f})),n.d(t,"U",(function(){return b})),n.d(t,"p",(function(){return p})),n.d(t,"nb",(function(){return g})),n.d(t,"S",(function(){return m})),n.d(t,"mb",(function(){return v})),n.d(t,"I",(function(){return j})),n.d(t,"q",(function(){return O})),n.d(t,"M",(function(){return x})),n.d(t,"T",(function(){return k})),n.d(t,"H",(function(){return w})),n.d(t,"x",(function(){return y})),n.d(t,"y",(function(){return h})),n.d(t,"eb",(function(){return M})),n.d(t,"j",(function(){return E})),n.d(t,"r",(function(){return S})),n.d(t,"l",(function(){return C})),n.d(t,"m",(function(){return T})),n.d(t,"K",(function(){return V})),n.d(t,"J",(function(){return P})),n.d(t,"fb",(function(){return I})),n.d(t,"hb",(function(){return L})),n.d(t,"D",(function(){return A})),n.d(t,"C",(function(){return F})),n.d(t,"B",(function(){return N})),n.d(t,"a",(function(){return R})),n.d(t,"e",(function(){return z})),n.d(t,"N",(function(){return $})),n.d(t,"d",(function(){return D})),n.d(t,"cb",(function(){return _})),n.d(t,"G",(function(){return B})),n.d(t,"Q",(function(){return U})),n.d(t,"g",(function(){return q})),n.d(t,"db",(function(){return J})),n.d(t,"h",(function(){return G})),n.d(t,"kb",(function(){return H}));var a=n(1),s=n(20);n.d(t,"c",(function(){return s.b})),n.d(t,"i",(function(){return s.l})),n.d(t,"k",(function(){return s.o})),n.d(t,"n",(function(){return s.r})),n.d(t,"s",(function(){return s.x})),n.d(t,"t",(function(){return s.y})),n.d(t,"u",(function(){return s.z})),n.d(t,"v",(function(){return s.D})),n.d(t,"w",(function(){return s.E})),n.d(t,"z",(function(){return s.F})),n.d(t,"O",(function(){return s.M})),n.d(t,"R",(function(){return s.Y})),n.d(t,"X",(function(){return s.ab})),n.d(t,"Y",(function(){return s.cb})),n.d(t,"Z",(function(){return s.db})),n.d(t,"gb",(function(){return s.hb})),n.d(t,"ib",(function(){return s.kb})),n.d(t,"jb",(function(){return s.ob})),n.d(t,"lb",(function(){return s.pb}));var i=n(80);n.d(t,"f",(function(){return i.a})),n.d(t,"F",(function(){return i.b})),n.d(t,"P",(function(){return i.e})),n.d(t,"W",(function(){return i.i})),n.d(t,"ab",(function(){return i.k}));const r=a.i18n.translate("xpack.cases.caseView.actionLabel.addedField",{defaultMessage:"added"}),c=a.i18n.translate("xpack.cases.caseView.actionLabel.changededField",{defaultMessage:"changed"}),o=a.i18n.translate("xpack.cases.caseView.actionLabel.enabledSetting",{defaultMessage:"enabled"}),l=a.i18n.translate("xpack.cases.caseView.actionLabel.disableSetting",{defaultMessage:"disabled"}),u=e=>a.i18n.translate("xpack.cases.caseView.actionLabel.selectedThirdParty",{values:{thirdParty:e},defaultMessage:"selected { thirdParty } as incident management system"}),d=a.i18n.translate("xpack.cases.caseView.actionLabel.removedThirdParty",{defaultMessage:"removed external incident management system"}),f=a.i18n.translate("xpack.cases.caseView.actionLabel.editedField",{defaultMessage:"edited"}),b=a.i18n.translate("xpack.cases.caseView.actionLabel.removedField",{defaultMessage:"removed"}),p=e=>a.i18n.translate("xpack.cases.caseView.actionLabel.changeFieldToEmpty",{values:{field:e},defaultMessage:'changed {field} to "None"'}),g=e=>a.i18n.translate("xpack.cases.caseView.actionLabel.viewIncident",{defaultMessage:"View {incidentNumber}",values:{incidentNumber:e}}),m=a.i18n.translate("xpack.cases.caseView.actionLabel.pushedNewIncident",{defaultMessage:"pushed as new incident"}),v=a.i18n.translate("xpack.cases.caseView.actionLabel.updateIncident",{defaultMessage:"updated incident"}),j=(a.i18n.translate("xpack.cases.caseView.actionLabel.addDescription",{defaultMessage:"added description"}),a.i18n.translate("xpack.cases.caseView.edit.description",{defaultMessage:"Edit description"})),O=a.i18n.translate("xpack.cases.caseView.description.collapse",{defaultMessage:"Collapse description"}),x=a.i18n.translate("xpack.cases.caseView.description.expand",{defaultMessage:"Expand description"}),k=a.i18n.translate("xpack.cases.caseView.edit.quote",{defaultMessage:"Quote"}),w=a.i18n.translate("xpack.cases.caseView.edit.comment",{defaultMessage:"Edit comment"}),y=a.i18n.translate("xpack.cases.caseView.delete.comment",{defaultMessage:"Delete comment"}),h=a.i18n.translate("xpack.cases.caseView.deleteTitle.comment",{defaultMessage:"Delete this comment?"}),M=(a.i18n.translate("xpack.cases.caseView.actionLabel.on",{defaultMessage:"on"}),a.i18n.translate("xpack.cases.caseView.statusLabel",{defaultMessage:"Status"})),E=a.i18n.translate("xpack.cases.caseView.case",{defaultMessage:"case"}),S=a.i18n.translate("xpack.cases.caseView.comment",{defaultMessage:"comment"}),C=a.i18n.translate("xpack.cases.caseView.caseRefresh",{defaultMessage:"Refresh case"}),T=(a.i18n.translate("xpack.cases.caseView.activity",{defaultMessage:"Activity"}),a.i18n.translate("xpack.cases.caseView.caseSettings",{defaultMessage:"Case settings"})),V=e=>a.i18n.translate("xpack.cases.caseView.emailSubject",{values:{caseTitle:e},defaultMessage:"Security Case - {caseTitle}"}),P=e=>a.i18n.translate("xpack.cases.caseView.emailBody",{values:{caseUrl:e},defaultMessage:"Case reference: {caseUrl}"}),I=(a.i18n.translate("xpack.cases.caseView.fieldChanged",{defaultMessage:"changed connector field"}),a.i18n.translate("xpack.cases.caseView.syncAlertsLabel",{defaultMessage:"Sync alerts"})),L=a.i18n.translate("xpack.cases.caseView.syncAlertsLowercaseLabel",{defaultMessage:"sync alerts"}),A=a.i18n.translate("xpack.cases.caseView.doesNotExist.title",{defaultMessage:"This case does not exist"}),F=e=>a.i18n.translate("xpack.cases.caseView.doesNotExist.description",{values:{caseId:e},defaultMessage:"A case with id {caseId} could not be found. This likely means the case has been deleted, or the id is incorrect."}),N=a.i18n.translate("xpack.cases.caseView.doesNotExist.button",{defaultMessage:"Back to Cases"}),R=a.i18n.translate("xpack.cases.caseView.tabs.activity",{defaultMessage:"Activity"}),z=a.i18n.translate("xpack.cases.caseView.tabs.alerts",{defaultMessage:"Alerts"}),$=a.i18n.translate("xpack.cases.caseView.tabs.files",{defaultMessage:"Files"}),D=a.i18n.translate("xpack.cases.caseView.tabs.alerts.emptyDescription",{defaultMessage:"No alerts have been added to this case."}),_=e=>a.i18n.translate("xpack.cases.caseView.sendEmalLinkAria",{values:{user:e},defaultMessage:"click to send an email to {user}"}),B=a.i18n.translate("xpack.cases.caseView.editAssigneesAriaLabel",{defaultMessage:"click to edit assignees"}),U=a.i18n.translate("xpack.cases.caseView.noAssignees",{defaultMessage:"No users are assigned"}),q=a.i18n.translate("xpack.cases.caseView.assignUser",{defaultMessage:"Assign a user"}),J=a.i18n.translate("xpack.cases.caseView.spacedOrText",{defaultMessage:" or "}),G=a.i18n.translate("xpack.cases.caseView.assignYourself",{defaultMessage:"assign yourself"}),H=e=>a.i18n.translate("xpack.cases.caseView.totalUsersAssigned",{defaultMessage:"{total} assigned",values:{total:e}})},144:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(2),s=n(8),i=n(145);const r=(e=i.a)=>{const{capabilities:t}=Object(s.g)().services.application;return Object.entries(t).reduce(((t,[n,a])=>{if(!n.endsWith("Cases"))return t;for(const n of e)if(!a[`${n}_cases`])return t;return t.push(c(n)),t}),[])},c=e=>e===a.Q?a.c:e.replace("Cases","")},145:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));const a=e=>!e.all&&!e.create&&!e.update&&!e.delete&&!e.push&&e.read,s=["create","read","update","delete","push"],i=e=>s.filter((t=>t!==e))},160:function(e,t,n){"use strict";n.d(t,"c",(function(){return A})),n.d(t,"b",(function(){return J})),n.d(t,"d",(function(){return K})),n.d(t,"a",(function(){return ne}));var a=n(59),s=n.n(a),i=n(4),r=n.n(i),c=n(39),o=n(5),l=n(3);const u=({disableLinks:e,href:t,target:n,children:a,...s})=>Object(l.jsx)(o.EuiToolTip,{content:t},Object(l.jsx)(o.EuiLink,{href:e?void 0:t,"data-test-subj":"markdown-link",rel:"nofollow",target:"_blank"},a));u.displayName="MarkdownLink";const d=Object(i.memo)(u);var f=n(199),b=n(8),p=n(115),g=n(1),m=n(113),v=n(27),j=n(125),O=n(85);const x=r.a.createContext(null);var k=n(201),w=n(170),y=n(2),h=n(40);const M={from:"now-7d",to:"now",mode:"relative"};var E={name:"18axvdo",styles:"display:inline-flex;.euiToolTipAnchor{display:inline-flex;}"};const S=({node:e,onCancel:t,onSave:n})=>{const a=Object(v.useLocation)(),{application:{currentAppId$:s},embeddable:r,lens:c,storage:u,contentManagement:d,uiSettings:f,data:{query:{timefilter:{timefilter:w}}}}=Object(b.g)().services,[S,C]=Object(i.useState)(void 0),{draftComment:T,clearDraftComment:V}=Object(k.a)(),P=Object(i.useContext)(x),I=Object(i.useContext)(o.EuiMarkdownContext),L=(()=>{const{appId:e}=Object(h.a)();return e===y.Zb})(),{euiTheme:A}=Object(o.useEuiTheme)(),F=Object(i.useCallback)((()=>{S&&(null==r||r.getStateTransfer().getIncomingEmbeddablePackage(S,!0),V()),t()}),[V,S,r,t]),N=Object(i.useCallback)(((e,t)=>{n(`!{${O.b}${JSON.stringify({timeRange:t,attributes:e})}}`,{block:!0}),F()}),[F,n]),R=Object(i.useCallback)(((e,t,n)=>{I.replaceNode(n,`!{${O.b}${JSON.stringify({timeRange:t,attributes:e})}}`),F()}),[F,I]),z=Object(i.useMemo)((()=>L?`/insightsAndAlerting/cases${a.pathname}${a.search}`:`${a.pathname}${a.search}`),[L,a.pathname,a.search]),$=Object(i.useCallback)((()=>{u.set(O.a,{commentId:null==P?void 0:P.editorId,comment:null==P?void 0:P.value,position:null==e?void 0:e.position,caseTitle:null==P?void 0:P.caseTitle,caseTags:null==P?void 0:P.caseTags}),null==c||c.navigateToPrefilledEditor(void 0,{originatingApp:S,originatingPath:z})}),[u,null==P?void 0:P.editorId,null==P?void 0:P.value,null==P?void 0:P.caseTitle,null==P?void 0:P.caseTags,null==e?void 0:e.position,c,S,z]),D=Object(i.useCallback)(((t,n=M)=>{u.set(O.a,{commentId:null==P?void 0:P.editorId,comment:null==P?void 0:P.value,position:null==e?void 0:e.position,caseTitle:null==P?void 0:P.caseTitle,caseTags:null==P?void 0:P.caseTags}),null==c||c.navigateToPrefilledEditor(t||null!=e&&e.attributes?{id:"",timeRange:n,attributes:t||(null==e?void 0:e.attributes)}:void 0,{originatingApp:S,originatingPath:z})}),[u,null==P?void 0:P.editorId,null==P?void 0:P.value,null==P?void 0:P.caseTitle,null==P?void 0:P.caseTags,null==e?void 0:e.position,null==e?void 0:e.attributes,c,S,z]),_=Object(i.useCallback)(((e,t,n,a)=>{D({...a.attributes,title:"",references:a.references})}),[D]),B=Object(i.useMemo)((()=>[{type:"lens",getIconForSavedObject:()=>"lensApp",name:g.i18n.translate("xpack.cases.markdownEditor.plugins.lens.insertLensSavedObjectModal.searchSelection.savedObjectType.lens",{defaultMessage:"Lens"}),includeFields:["*"]}]),[]);Object(i.useEffect)((()=>{null!=e&&e.attributes&&S&&D(e.attributes,e.timeRange)}),[D,e,S]),Object(i.useEffect)((()=>{(async()=>{const e=await s.pipe(Object(p.first)()).toPromise();C(e)})()}),[s]),Object(i.useEffect)((()=>{var e,t,n;let a;if(S&&(a=null==r?void 0:r.getStateTransfer().getIncomingEmbeddablePackage(S,!0)),"lens"===(null===(e=a)||void 0===e?void 0:e.type)&&null!==(t=a)&&void 0!==t&&null!==(n=t.input)&&void 0!==n&&n.attributes){const e=w.getTime(),t=null!=e&&e.from&&null!=e&&e.to?{from:e.from,to:e.to,mode:[e.from,e.to].join("").includes("now")?"relative":"absolute"}:void 0;var s,i;if(null!=T&&T.position)return void R(null===(s=a)||void 0===s?void 0:s.input.attributes,t,T.position);T&&N(null===(i=a)||void 0===i?void 0:i.input.attributes,t)}}),[r,u,w,S,N,R,T]);const U=Object(l.jsx)(o.EuiButton,{onClick:$,iconType:"plusInCircle"},Object(l.jsx)(m.FormattedMessage,{id:"xpack.cases.markdownEditor.plugins.lens.createVisualizationButtonLabel",defaultMessage:"Create new"}));return Object(l.jsx)(o.EuiFlexGroup,{css:Object(l.css)("width:",A.breakpoint.m,";height:100%;.euiModalBody{min-height:300px;}",""),direction:"column",gutterSize:"none"},Object(l.jsx)(o.EuiModalHeader,null,Object(l.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiModalHeaderTitle,null,Object(l.jsx)(m.FormattedMessage,{id:"xpack.cases.markdownEditor.plugins.lens.addVisualizationModalTitle",defaultMessage:"Add visualization"}))),Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)("span",{css:E},Object(l.jsx)(o.EuiBetaBadge,{label:g.i18n.translate("xpack.cases.markdownEditor.plugins.lens.betaLabel",{defaultMessage:"Beta"}),tooltipContent:g.i18n.translate("xpack.cases.markdownEditor.plugins.lens.betaDescription",{defaultMessage:"This module is not GA. You can only insert one lens per comment for now. Please help us by reporting bugs."})}))))),Object(l.jsx)(o.EuiModalBody,null,Object(l.jsx)(j.SavedObjectFinder,{key:"searchSavedObjectFinder",onChoose:_,showFilter:!1,noItemsMessage:Object(l.jsx)(m.FormattedMessage,{id:"xpack.cases.markdownEditor.plugins.lens.insertLensSavedObjectModal.searchSelection.notFoundLabel",defaultMessage:"No matching lens found."}),savedObjectMetaData:B,fixedPageSize:10,services:{contentClient:d.client,uiSettings:f},leftChildren:U,helpText:g.i18n.translate("xpack.cases.markdownEditor.plugins.lens.savedObjects.finder.searchInputHelpText",{defaultMessage:"Insert an existing lens visualization or create a new one. Any changes or new visualizations will only apply to this comment."})})),Object(l.jsx)(o.EuiModalFooter,null,Object(l.jsx)(o.EuiButton,{onClick:F,fill:!0},Object(l.jsx)(m.FormattedMessage,{id:"xpack.cases.markdownEditor.plugins.lens.closeButtonLabel",defaultMessage:"Close"}))))};S.displayName="LensEditor";const C=r.a.memo(S),T={name:O.b,button:{label:w.a,iconType:"lensApp"},helpText:Object(l.jsx)(o.EuiCodeBlock,{language:"md",paddingSize:"s",fontSize:"l"},"!{lens<config>}"),editor:C},V=function(){const e=this.Parser,t=e.prototype.blockTokenizers,n=e.prototype.blockMethods;t.lens=function(e,t,n){if(!1===t.startsWith(O.c))return!1;const a=t[6];if("{"!==a&&"}"!==a)return!1;if(n)return!0;const s="{"===a;let i=O.c,r={};if(s){let n="",a=0;for(let e=6;e<t.length;e++){const s=t[e];if("{"===s)a++,n+=s;else if("}"===s){if(a--,-1===a)break;n+=s}else n+=s}i+=n;try{r=JSON.parse(n)}catch(t){const n=e.now();this.file.fail(`Unable to parse lens JSON configuration: ${t}`,{line:n.line,column:n.column+6})}}return i+="}",e(i)({type:O.b,...r})},n.splice(n.indexOf("text"),0,O.b)};var P=n(96);const I=e=>{var t,n;const a=b.b.getConfig(),s=null===(t=Object(f.a)())||void 0===t?void 0:t.editor_plugins,r=Object(b.c)();return Object(i.useMemo)((()=>{var t;const n=Object(o.getDefaultEuiMarkdownUiPlugins)(),i=Object(o.getDefaultEuiMarkdownParsingPlugins)(),c=Object(o.getDefaultEuiMarkdownProcessingPlugins)();return s&&(n.push(s.uiPlugin),i.push(s.parsingPlugin),c[1][1].components.timeline=s.processingPluginRenderer),null==a||null===(t=a.markdownPlugins)||void 0===t||!t.lens||null!=e&&e.includes(O.b)||null==r||!r.visualize.crud||n.push(T),i.push(V),c[1][1].components.lens=P.a,{uiPlugins:n,parsingPlugins:i,processingPlugins:c}}),[null==r?void 0:r.visualize.crud,e,null==a||null===(n=a.markdownPlugins)||void 0===n?void 0:n.lens,s])},L=({children:e,disableLinks:t,textSize:n})=>{const{processingPlugins:a,parsingPlugins:r}=I(),u=Object(c.cloneDeep)(a);return u[1][1].components.a=Object(i.useMemo)((()=>(e=>{const t=Object(i.memo)((t=>Object(l.jsx)(d,s()({},t,{disableLinks:e}))));return t.displayName="MarkdownLinkProcessingComponent",t})(t)),[t]),Object(l.jsx)(o.EuiMarkdownFormat,{parsingPluginList:r,processingPluginList:u,grow:!0,textSize:n},e)};L.displayName="MarkdownRenderer";const A=Object(i.memo)(L);var F=n(12),N=n(166),R=n.n(N);const z="euiButtonIcon-isDisabled",$=Object(i.forwardRef)((({ariaLabel:e,dataTestSubj:t,editorId:n,height:a,onChange:s,value:r,disabledUiPlugins:c},u)=>{const d=Object(i.useRef)(void 0),[f,b]=Object(i.useState)([]),p=Object(i.useCallback)(((e,{messages:t,ast:n})=>{b(e?[e]:t),d.current=n}),[]),{parsingPlugins:g,processingPlugins:m,uiPlugins:v}=I(c),j=Object(i.useRef)(null);return(({astRef:e,editorRef:t,uiPlugins:n,value:a})=>{const s=Object(i.useRef)(!1),[r,c]=Object(i.useState)(!1),o=Object(i.useCallback)((()=>{var e,n;if(null!=t&&null!==(e=t.current)&&void 0!==e&&e.textarea&&null!==(n=t.current)&&void 0!==n&&n.toolbar){var a,s;const e=null===(a=t.current)||void 0===a||null===(s=a.toolbar)||void 0===s?void 0:s.querySelector(`[aria-label="${w.a}"]`);if(e){const t=e.className.includes(z),n=e.getAttribute("style");t&&n&&(e.className=e.className.replace(z,""),e.setAttribute("style",n.replace("pointer-events: none;","")))}}}),[t]),l=Object(i.useCallback)((()=>{var e;if(null!=t&&null!==(e=t.current)&&void 0!==e&&e.textarea&&t.current.toolbar){var n;const e=null===(n=t.current.toolbar)||void 0===n?void 0:n.querySelector(`[aria-label="${w.a}"]`);e&&(e.className.includes(z)||(e.className+=` ${z}`,e.setAttribute("style","pointer-events: none;")))}}),[t]);Object(i.useEffect)((()=>{s.current=Object(F.some)(n,["name","lens"])}),[n]),R()((()=>{r||null==a||!a.includes(O.c)?o():l()}),100,[a,r]),Object(i.useEffect)((()=>{var n,a;if(null==(null==t||null===(n=t.current)||void 0===n?void 0:n.textarea)||null==(null==e?void 0:e.current)||!s.current)return;const i=()=>{var n;const{selectionStart:a}=null===(n=t.current)||void 0===n?void 0:n.textarea;let s=e.current;e:for(;;){if(s.children)for(let e=0;e<s.children.length;e++){const t=s.children[e];if(t.position&&t.position.start.offset<a&&a<t.position.end.offset){if("text"===t.type)break e;s=t;continue e}}break}c("lens"===s.type)},r=null===(a=t.current)||void 0===a?void 0:a.textarea;return r.addEventListener("keyup",i),r.addEventListener("mouseup",i),()=>{r.removeEventListener("keyup",i),r.removeEventListener("mouseup",i)}}),[e,t])})({astRef:d,uiPlugins:v,editorRef:u,value:r}),Object(i.useImperativeHandle)(u,(()=>{var e,t;if(!j.current)return null;const n=null===(e=j.current)||void 0===e||null===(t=e.textarea)||void 0===t?void 0:t.closest(".euiMarkdownEditor");return{...j.current,toolbar:null==n?void 0:n.querySelector(".euiMarkdownEditorToolbar")}})),Object(l.jsx)(o.EuiMarkdownEditor,{ref:j,"aria-label":e,editorId:n,onChange:s,value:r,uiPlugins:v,parsingPluginList:g,processingPluginList:m,onParse:p,errors:f,"data-test-subj":t,height:a})}));$.displayName="MarkdownEditor";const D=Object(i.memo)($);var _=n(21),B=n(20),U=n(267),q=n.n(U);const J=r.a.memo(Object(i.forwardRef)((({id:e,field:t,dataTestSubj:n,idAria:a,bottomRightContent:s,caseTitle:r,caseTags:c,draftStorageKey:u,disabledUiPlugins:d,initialValue:f},b)=>{const{isInvalid:p,errorMessage:g}=Object(_.getFieldValidityAndErrorMessage)(t),{hasConflicts:m}=(({field:e,sessionKey:t,initialValue:n})=>{const[a,s]=Object(i.useState)(!1),r=Object(i.useRef)(!0),c=Object(i.useRef)(n),[o,l]=q()(t,"",!0);return Object(F.isEmpty)(o)||Object(F.isEmpty)(t)||!r.current||e.setValue(o),r.current&&(r.current=!1),n!==c.current&&n!==e.value&&(c.current=n,s(!0)),R()((()=>{Object(F.isEmpty)(t)||l(e.value)}),500,[e.value]),{hasConflicts:a}})({field:t,sessionKey:null!=u?u:"",initialValue:f}),{euiTheme:v}=Object(o.useEuiTheme)(),j=B.rb("description"===e?e:"comment"),O=Object(i.useMemo)((()=>({editorId:e,value:t.value,caseTitle:r,caseTags:c})),[e,t.value,r,c]);return Object(l.jsx)(x.Provider,{value:O},Object(l.jsx)(o.EuiFormRow,{"data-test-subj":n,describedByIds:a?[a]:void 0,fullWidth:!0,error:g,helpText:t.helpText,isInvalid:p,label:t.label,labelAppend:t.labelAppend},Object(l.jsx)(D,{ref:b,ariaLabel:a,editorId:e,onChange:t.setValue,value:t.value,disabledUiPlugins:d,"data-test-subj":`${n}-markdown-editor`})),s&&Object(l.jsx)(o.EuiFlexGroup,{css:Object(l.css)("padding:",v.size.m," 0;",""),justifyContent:"flexEnd"},Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiText,{color:"danger",size:"s"},m&&j),Object(l.jsx)(o.EuiSpacer,{size:"s"}),s)))})));J.displayName="MarkdownEditorForm";const G=e=>Object(l.css)("padding:",`${e.size.m} ${e.size.l}`,";text-overflow:ellipsis;word-break:break-word;display:-webkit-box;-webkit-box-orient:vertical;",""),H=({content:e})=>{const{euiTheme:t}=Object(o.useEuiTheme)();return Object(l.jsx)("div",{className:"eui-xScroll",css:G(t),"data-test-subj":"scrollable-markdown"},Object(l.jsx)(A,null,e))};H.displayName="ScrollableMarkdownRenderer";const K=r.a.memo(H);var Q=n(58),W=n(171),Y=n(134);const Z=({handleSaveAction:e,handleCancelAction:t,isSaveDisabled:n})=>Object(l.jsx)(o.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd",responsive:!1},Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiButtonEmpty,{"data-test-subj":"editable-cancel-markdown",size:"s",onClick:t,iconType:"cross"},Y.i)),Object(l.jsx)(o.EuiFlexItem,{grow:!1},Object(l.jsx)(o.EuiButton,{"data-test-subj":"editable-save-markdown",color:"success",fill:!0,iconType:"save",onClick:e,disabled:n,size:"s"},Y.Z)));Z.displayName="EditableMarkdownFooterComponent";const X=r.a.memo(Z);var ee=n(57);const te=Object(i.forwardRef)((({id:e,content:t,caseId:n,fieldName:a,onChangeEditable:s,onSaveContent:r,editorRef:c,formSchema:o},u)=>{const{owner:d}=Object(ee.a)(),f=Object(W.a)({appId:d[0],caseId:n,commentId:e}),b={content:t},{form:p}=Object(_.useForm)({defaultValue:b,options:{stripEmptyFields:!1},schema:o}),{submit:g,setFieldValue:m,isValid:v}=p,j=Object(i.useCallback)((e=>{m(a,e)}),[m,a]);Object(i.useImperativeHandle)(u,(()=>({setComment:j,editor:c.current})));const O=Object(i.useCallback)((()=>{s(e),Object(Q.n)(f)}),[e,s,f]),x=Object(i.useCallback)((async()=>{const{isValid:n,data:a}=await g();n&&a.content!==t&&r(a.content),s(e),Object(Q.n)(f)}),[t,e,s,r,g,f]);return Object(l.jsx)(_.Form,{form:p,"data-test-subj":"editable-markdown-form"},Object(l.jsx)(_.UseField,{path:a,component:J,componentProps:{ref:c,"aria-label":"Cases markdown editor",value:t,id:e,draftStorageKey:f,bottomRightContent:Object(l.jsx)(X,{handleSaveAction:x,handleCancelAction:O,isSaveDisabled:void 0!==v&&!v}),initialValue:t}}))}));te.displayName="EditableMarkDownRenderer";const ne=r.a.memo(te)},164:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var a=n(2);const s=async({http:e,name:t,size:n=a.O,owners:s,signal:i})=>await e.post(a.fb,{body:JSON.stringify({name:t,size:n,owners:s}),signal:i}),i=async({security:e,uids:t})=>0===t.length?[]:e.userProfiles.bulkGet({uids:new Set(t),dataPath:"avatar"}),r=async({security:e})=>e.userProfiles.getCurrent({dataPath:"avatar"})},166:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(107),s=n(4),i=a.__importDefault(n(190));t.default=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[]);var a=i.default(e,t),r=a[0],c=a[1],o=a[2];return s.useEffect(o,n),[r,c]}},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(44),s=n(46),i=n(8),r=n(76),c=n(164);const o=()=>{const{security:e}=Object(i.g)().services,t=Object(i.j)();return Object(a.useQuery)(r.e.currentUser(),(()=>Object(c.b)({security:e})),{retry:!1,onError:e=>{var n;"AbortError"!==e.name&&404!==(null===(n=e.body)||void 0===n?void 0:n.statusCode)&&t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:s.e})}})}},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=n(1).i18n.translate("xpack.cases.markdownEditor.plugins.lens.visualizationButtonLabel",{defaultMessage:"Visualization"})},171:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=({caseId:e,commentId:t,appId:n})=>`cases.${n&&""!==n?n:"cases"}.${""!==e?e:"case"}.${""!==t?t:"comment"}.markdownEditor`},190:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(4);t.default=function(e,t){void 0===t&&(t=0);var n=a.useRef(!1),s=a.useRef(),i=a.useRef(e),r=a.useCallback((function(){return n.current}),[]),c=a.useCallback((function(){n.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout((function(){n.current=!0,i.current()}),t)}),[t]),o=a.useCallback((function(){n.current=null,s.current&&clearTimeout(s.current)}),[]);return a.useEffect((function(){i.current=e}),[e]),a.useEffect((function(){return c(),o}),[t]),[r,o,c]}},199:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(4),s=n(200);const i=()=>Object(a.useContext)(s.a)},200:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c}));var a=n(4),s=n.n(a),i=n(3);const r=s.a.createContext(null),c=({children:e,timelineIntegration:t})=>{const[n]=Object(a.useState)(null!=t?t:null);return Object(i.jsx)(r.Provider,{value:n},e)}},201:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(4),s=n(115),i=n(8),r=n(85),c=n(170);const o=()=>{const{application:{currentAppId$:e},embeddable:t,storage:n}=Object(i.g)().services,[o,l]=Object(a.useState)(null),[u,d]=Object(a.useState)(!1);return Object(a.useEffect)((()=>{(async()=>{const a=await e.pipe(Object(s.first)()).toPromise();if(!a)return;const i=null==t?void 0:t.getStateTransfer().getIncomingEmbeddablePackage(a),c=n.get(r.a);d(!!i),c&&l(c)})()}),[e,t,n]),{draftComment:o,hasIncomingLensState:u,openLensModal:Object(a.useCallback)((({editorRef:e})=>{if(e&&e.textarea&&e.toolbar){var t;const n=null===(t=e.toolbar)||void 0===t?void 0:t.querySelector(`[aria-label="${c.a}"]`);n&&n.click()}}),[]),clearDraftComment:Object(a.useCallback)((()=>{n.remove(r.a),l(null)}),[n])}}},228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeepEqual=t.off=t.on=t.isClient=void 0;var a=n(107).__importDefault(n(268));t.isClient="object"==typeof window,t.on=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.removeEventListener.apply(e,t)},t.isDeepEqual=a.default},267:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(228);t.default=function(e,t,n){if(!s.isClient)return[t,function(){}];var i=a.useState((function(){try{var a=sessionStorage.getItem(e);return"string"!=typeof a?(sessionStorage.setItem(e,n?String(t):JSON.stringify(t)),t):n?a:JSON.parse(a||"null")}catch(e){return t}})),r=i[0],c=i[1];return a.useEffect((function(){try{var t=n?String(r):JSON.stringify(r);sessionStorage.setItem(e,t)}catch(e){}})),[r,c]}},268:function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var a,s,i;if(Array.isArray(t)){if((a=t.length)!=n.length)return!1;for(s=a;0!=s--;)if(!e(t[s],n[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((a=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(s=a;0!=s--;)if(!Object.prototype.hasOwnProperty.call(n,i[s]))return!1;for(s=a;0!=s--;){var r=i[s];if(!("_owner"===r&&t.$$typeof||e(t[r],n[r])))return!1}return!0}return t!=t&&n!=n}}}]);