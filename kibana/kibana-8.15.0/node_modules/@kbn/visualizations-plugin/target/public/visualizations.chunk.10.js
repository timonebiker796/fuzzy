(window.visualizations_bundle_jsonpfunction=window.visualizations_bundle_jsonpfunction||[]).push([[10,14],{108:function(t,e,i){"use strict";i.r(e),i.d(e,"VisualizationError",(function(){return VisualizationError}));var s=i(10),a=i(3),n=i.n(a),r=i(6);class VisualizationError extends n.a.Component{render(){return Object(r.jsx)(s.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger","data-test-subj":"visualization-error",body:Object(r.jsx)(s.EuiText,{size:"xs","data-test-subj":"visualization-error-text"},"string"==typeof this.props.error?this.props.error:this.props.error.message)})}componentDidMount(){this.afterRender()}componentDidUpdate(){this.afterRender()}afterRender(){this.props.onInit&&this.props.onInit()}}e.default=VisualizationError},214:function(t,e,i){"use strict";i.r(e),i.d(e,"VisualizeEmbeddable",(function(){return visualize_embeddable_VisualizeEmbeddable}));var s=i(1),a=i.n(s),n=i(7),r=i.n(n),o=i(0),d=i(4),h=(i(3),i(22)),l=i(10),u=i(68),p=i(49),c=i(79),v=i(11),b=i(72),g=i(9),m=i(18),y=i(85),f=i(205),C=i(6);const x=({savedObjectMeta:t,application:e,message:i,renderMode:s})=>{const{management:a}=e.capabilities.navLinks,n=e.capabilities.management.kibana.indexPatterns;return Object(C.jsx)(l.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger","data-test-subj":"visualization-missed-data-view-error",actions:t.savedObjectType===m.DATA_VIEW_SAVED_OBJECT_TYPE&&"edit"===s&&a&&n?Object(C.jsx)(f.a,{navigateToUrl:e.navigateToUrl},Object(C.jsx)("a",{href:e.getUrlForApp("management",{path:"/kibana/indexPatterns/create"}),"data-test-subj":"configuration-failure-reconfigure-indexpatterns",style:{width:"100%"}},d.i18n.translate("visualizations.missedDataView.dataViewReconfigure",{defaultMessage:"Recreate it in the data view management page"}))):null,body:Object(C.jsx)("p",null,i)})};var j=i(108),S=i(21),T=i(2),E=i(47),O=i(13),w=i(80);class visualize_embeddable_VisualizeEmbeddable extends v.Embeddable{constructor(t,{vis:e,editPath:i,editUrl:s,indexPatterns:n,deps:h,capabilities:l},u,p,c){if(super(u,{defaultTitle:e.title,defaultDescription:e.description,editPath:i,editApp:"visualize",editUrl:s,indexPatterns:n,visTypeName:e.type.name},c),a()(this,"handler",void 0),a()(this,"timefilter",void 0),a()(this,"timeRange",void 0),a()(this,"query",void 0),a()(this,"filters",void 0),a()(this,"searchSessionId",void 0),a()(this,"syncColors",void 0),a()(this,"syncTooltips",void 0),a()(this,"syncCursor",void 0),a()(this,"embeddableTitle",void 0),a()(this,"visCustomizations",void 0),a()(this,"subscriptions",[]),a()(this,"expression",void 0),a()(this,"vis",void 0),a()(this,"domNode",void 0),a()(this,"warningDomNode",void 0),a()(this,"type",S.b),a()(this,"abortController",void 0),a()(this,"deps",void 0),a()(this,"inspectorAdapters",void 0),a()(this,"attributeService",void 0),a()(this,"expressionVariables",void 0),a()(this,"expressionVariablesSubject",new o.ReplaySubject(1)),a()(this,"getInspectorAdapters",(()=>{if(this.handler&&(!this.inspectorAdapters||Object.keys(this.inspectorAdapters).length))return this.handler.inspect()})),a()(this,"openInspector",(()=>{if(!this.handler)return;const t=this.handler.inspect();return t?this.deps.start().plugins.inspector.open(t,{title:this.getTitle()||d.i18n.translate("visualizations.embeddable.inspectorTitle",{defaultMessage:"Inspector"})}):void 0})),a()(this,"hasInspector",(()=>Boolean(this.getInspectorAdapters()))),a()(this,"onContainerLoading",(()=>{this.renderComplete.dispatchInProgress(),this.updateOutput({...this.getOutput(),loading:!0,rendered:!1,error:void 0})})),a()(this,"onContainerData",(()=>{this.handleWarnings(),this.updateOutput({...this.getOutput(),loading:!1})})),a()(this,"onContainerRender",(()=>{this.renderComplete.dispatchComplete(),this.updateOutput({...this.getOutput(),rendered:!0})})),a()(this,"onContainerError",(t=>{var e;this.abortController&&this.abortController.abort(),this.renderComplete.dispatchError(),Object(y.f)(this.vis.data.indexPattern)&&(t=new Error(d.i18n.translate("visualizations.missedDataView.errorMessage",{defaultMessage:"Could not find the {type}: {id}",values:{id:null!==(e=this.vis.data.indexPattern.id)&&void 0!==e?e:"-",type:this.vis.data.savedSearchId?d.i18n.translate("visualizations.noSearch.label",{defaultMessage:"search"}):d.i18n.translate("visualizations.noDataView.label",{defaultMessage:"data view"})}}))),this.updateOutput({...this.getOutput(),rendered:!0,error:t})})),a()(this,"reload",(async()=>{await this.handleVisUpdate()})),a()(this,"handleVisUpdate",(async()=>{this.handleChanges(),await this.updateHandler()})),a()(this,"uiStateChangeHandler",(()=>{this.updateInput({...this.vis.uiState.toJSON()})})),a()(this,"inputIsRefType",(t=>{if(!this.attributeService)throw new Error("AttributeService must be defined for getInputAsRefType");return this.attributeService.inputIsRefType(t)})),a()(this,"getInputAsValueType",(async()=>{const t={savedVis:this.vis.serialize()};return delete t.savedVis.id,r.a.unset(t,"savedVis.title"),new Promise((e=>{e({...t})}))})),a()(this,"getInputAsRefType",(async()=>{const{plugins:t,core:e}=this.deps.start(),{data:i,spaces:s,savedObjectsTaggingOss:a}=t,n=await Object(O.e)({search:i.search,dataViews:i.dataViews,spaces:s,savedObjectsTagging:null==a?void 0:a.getTaggingApi(),...e});if(!n)throw new Error("Error creating a saved vis object");if(!this.attributeService)throw new Error("AttributeService must be defined for getInputAsRefType");const r=this.getTitle()?this.getTitle():d.i18n.translate("visualizations.embeddable.placeholderTitle",{defaultMessage:"Placeholder Title"}),o={savedVis:n,vis:this.vis,title:this.vis.title};return this.attributeService.getInputAsRefType({id:this.id,attributes:o},{showSaveModal:!0,saveModalTitle:r})})),this.deps=h,this.timefilter=t,this.syncColors=this.input.syncColors,this.syncTooltips=this.input.syncTooltips,this.syncCursor=this.input.syncCursor,this.searchSessionId=this.input.searchSessionId,this.query=this.input.query,this.embeddableTitle=this.getTitle(),this.vis=e,this.vis.uiState.on("change",this.uiStateChangeHandler),this.vis.uiState.on("reload",this.reload),this.attributeService=p,this.attributeService){const t=Boolean(e.type.disableEdit),i=!this.inputIsRefType(u),s=!t&&(l.visualizeSave||i&&l.dashboardSave&&l.visualizeOpen);this.updateOutput({...this.getOutput(),editable:s})}this.subscriptions.push(this.getInput$().subscribe((()=>{this.handleChanges()&&this.handler&&this.updateHandler()})));const v=this.vis.type.inspectorAdapters;v&&(this.inspectorAdapters="function"==typeof v?v():v)}reportsEmbeddableLoad(){return!0}getVis(){return this.vis}getFilters(){var t,e;const i=null!==(t=null===(e=this.vis.serialize().data.searchSource)||void 0===e?void 0:e.filter)&&void 0!==t?t:[];return Object(g.mapAndFlattenFilters)(r.a.cloneDeep(i))}getQuery(){return this.vis.serialize().data.searchSource.query}transferCustomizationsToUiState(){const t={vis:this.input.vis,table:this.input.table};t.vis||t.table?r.a.isEqual(t,this.visCustomizations)||(this.visCustomizations=t,this.vis.uiState.off("change",this.uiStateChangeHandler),this.vis.uiState.clearAllKeys(),Object.entries(t).forEach((([t,e])=>{e&&this.vis.uiState.set(t,e)})),this.vis.uiState.on("change",this.uiStateChangeHandler)):this.parent&&this.vis.uiState.clearAllKeys()}handleChanges(){this.transferCustomizationsToUiState();let t=!1;const e=void 0!==this.input.timeslice?{from:new Date(this.input.timeslice[0]).toISOString(),to:new Date(this.input.timeslice[1]).toISOString(),mode:"absolute"}:this.input.timeRange;return r.a.isEqual(e,this.timeRange)||(this.timeRange=r.a.cloneDeep(e),t=!0),Object(u.onlyDisabledFiltersChanged)(this.input.filters,this.filters)||(this.filters=this.input.filters,t=!0),r.a.isEqual(this.input.query,this.query)||(this.query=this.input.query,t=!0),this.searchSessionId!==this.input.searchSessionId&&(this.searchSessionId=this.input.searchSessionId,t=!0),this.syncColors!==this.input.syncColors&&(this.syncColors=this.input.syncColors,t=!0),this.syncTooltips!==this.input.syncTooltips&&(this.syncTooltips=this.input.syncTooltips,t=!0),this.syncCursor!==this.input.syncCursor&&(this.syncCursor=this.input.syncCursor,t=!0),this.embeddableTitle!==this.getTitle()&&(this.embeddableTitle=this.getTitle(),t=!0),this.vis.description&&this.domNode&&this.domNode.setAttribute("data-description",this.vis.description),t}handleWarnings(){var t;const e=[];if(null!==(t=this.getInspectorAdapters())&&void 0!==t&&t.requests&&this.deps.start().plugins.data.search.showWarnings(this.getInspectorAdapters().requests,(t=>{var i,s;return function(t){return"incomplete"===t.type&&Object.values(t.clusters).some((t=>!!t.failures&&t.failures.some((t=>{var e;return"unsupported_aggregation_on_downsampled_index"===(null===(e=t.reason)||void 0===e?void 0:e.type)}))))}(t)?(e.push(d.i18n.translate("visualizations.embeddable.tsdbRollupWarning",{defaultMessage:"Visualization uses a function that is unsupported by rolled up data. Select a different function or change the time range."})),!0):!(null===(i=(s=this.vis.type).suppressWarnings)||void 0===i||!i.call(s))||void 0})),this.warningDomNode){const{core:t}=this.deps.start();Object(h.render)(Object(C.jsx)(p.a,t,Object(C.jsx)(c.Warnings,{warnings:e||[]})),this.warningDomNode)}}async render(t){this.timeRange=r.a.cloneDeep(this.input.timeRange),this.transferCustomizationsToUiState();const e=document.createElement("div");e.className="visualize panel-content panel-content--fullWidth",t.appendChild(e);const i=document.createElement("div");i.className="visPanel__warnings",t.appendChild(i),this.warningDomNode=i,this.domNode=e,super.render(this.domNode);const{core:s}=this.deps.start();Object(h.render)(Object(C.jsx)(p.a,s,Object(C.jsx)("div",{className:"visChart__spinner"},Object(C.jsx)(l.EuiLoadingChart,{mono:!0,size:"l"}))),this.domNode);const a=Object(T.i)();this.handler=await a.loader(this.domNode,void 0,{renderMode:this.input.renderMode||"view",onRenderError:(t,e)=>{this.onContainerError(e)},executionContext:this.getExecutionContext()}),this.subscriptions.push(this.handler.events$.pipe(Object(o.mergeMap)((async t=>{if(!function(t){return"chartSize"===t.name}(t)&&!this.input.disableTriggers){const s=Object(n.get)(E.a,t.name,E.a.filter);let a;var e,i;a=s===E.a.applyFilter?{embeddable:this,timeFieldName:null===(e=this.vis.data.indexPattern)||void 0===e?void 0:e.timeFieldName,...t.data}:{embeddable:this,data:{timeFieldName:null===(i=this.vis.data.indexPattern)||void 0===i?void 0:i.timeFieldName,...t.data}},await Object(T.s)().getTrigger(s).exec(a)}}))).subscribe()),this.vis.description&&e.setAttribute("data-description",this.vis.description),e.setAttribute("data-test-subj","visualizationLoader"),e.setAttribute("data-shared-item",""),this.subscriptions.push(this.handler.loading$.subscribe(this.onContainerLoading)),this.subscriptions.push(this.handler.data$.subscribe(this.onContainerData)),this.subscriptions.push(this.handler.render$.subscribe(this.onContainerRender)),this.subscriptions.push(this.getUpdated$().subscribe((()=>{const{error:t}=this.getOutput();t&&Object(h.render)(this.renderError(t),this.domNode)}))),await this.updateHandler()}renderError(t){var e;return Object(y.f)(this.vis.data.indexPattern)?Object(C.jsx)(x,{renderMode:null!==(e=this.input.renderMode)&&void 0!==e?e:"view",savedObjectMeta:{savedObjectType:this.vis.data.savedSearchId?"search":b.DATA_VIEW_SAVED_OBJECT_TYPE},application:Object(T.c)(),message:"string"==typeof t?t:t.message}):Object(C.jsx)(j.default,{error:t})}destroy(){super.destroy(),this.subscriptions.forEach((t=>t.unsubscribe())),this.vis.uiState.off("change",this.uiStateChangeHandler),this.vis.uiState.off("reload",this.reload),this.handler&&(this.handler.destroy(),this.handler.getElement().remove())}getExecutionContext(){var t,e;return{...(null===(t=this.parent)||void 0===t?void 0:t.getInput().executionContext)||Object(T.h)().get(),child:{type:"agg_based",name:this.vis.type.name,id:null!==(e=this.vis.id)&&void 0!==e?e:"new",description:this.vis.title||this.input.title||this.vis.type.name,url:this.output.editUrl}}}async updateHandler(){var t,e;const i=this.getExecutionContext();this.expressionVariables=await(null===(t=(e=this.vis.type).getExpressionVariables)||void 0===t?void 0:t.call(e,this.vis,this.timefilter)),this.expressionVariablesSubject.next(this.expressionVariables);const s={searchContext:{timeRange:this.timeRange,query:this.input.query,filters:this.input.filters,disableWarningToasts:!0},variables:{embeddableTitle:this.getTitle(),...this.expressionVariables},searchSessionId:this.input.searchSessionId,syncColors:this.input.syncColors,syncTooltips:this.input.syncTooltips,syncCursor:this.input.syncCursor,uiState:this.vis.uiState,interactive:!this.input.disableTriggers,inspectorAdapters:this.inspectorAdapters,executionContext:i};this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const a=this.abortController;try{this.expression=await(async(t,e)=>{var i,s;if(!t.type.toExpressionAst)throw new Error("Visualization type definition should have toExpressionAst function defined");const a=null===(i=t.data.searchSource)||void 0===i?void 0:i.createCopy();if(t.data.aggs){const e=t.data.aggs.clone({opts:{hierarchical:t.isHierarchical(),partialRows:"function"==typeof t.type.hasPartialRows?t.type.hasPartialRows(t):t.type.hasPartialRows}});null==a||a.setField("aggs",e)}const n=await t.type.toExpressionAst(t,e),r=null==a?void 0:a.toExpressionAst({asDatatable:t.type.fetchDatatable});return{...n,chain:[Object(w.buildExpressionFunction)("kibana",{}).toAst(),...null!==(s=null==r?void 0:r.chain)&&void 0!==s?s:[],...n.chain]}})(this.vis,{timefilter:this.timefilter,timeRange:this.timeRange,abortSignal:this.abortController.signal})}catch(t){this.onContainerError(t)}this.handler&&!a.signal.aborted&&this.handler.update(this.expression,s)}supportedTriggers(){var t,e,i;return null!==(t=null===(e=(i=this.vis.type).getSupportedTriggers)||void 0===e?void 0:e.call(i,this.vis.params))&&void 0!==t?t:[]}getExpressionVariables$(){return this.expressionVariablesSubject.asObservable()}getExpressionVariables(){return this.expressionVariables}}}}]);